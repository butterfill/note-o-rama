{
    "settings": {
        "name": "nrama",
        "load": "lib/app",
        "modules": "lib",
        "templates": "templates",
        "attachments": [
            "static",
            "xdm",
            "bkmrklt"
        ],
        "base_template": "base.html"
    },
    "lib": {
        "app": "/**\n * Values exported from this module will automatically be used to generate\n * the design doc pushed to CouchDB.\n */\n\nmodule.exports = {\n    types: require('./types'),\n    shows: require('./shows'),\n    lists: require('./lists'),\n    views: require('./views'),\n    updates: require('./updates'),\n    filters: require('./filters'),\n    rewrites: require('./rewrites'),\n    validate_doc_update: require('./validate'),\n    events: require('./events')\n};\n\n\n",
        "bibtex": "/**\n * Modified from\n * http://bibtex-js.googlecode.com/svn/trunk/src/bibtex_js.js\n * MIT License\n * Copyright (c) 2010 henrik.muehe\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n * \n */\n\n// Issues:\n//  no comment handling within strings\n//  no string concatenation\n//  no variable values yet\n\n// Grammar implemented here:\n//  bibtex -> (string | preamble | comment | entry)*;\n//  string -> '@STRING' '{' key_equals_value '}';\n//  preamble -> '@PREAMBLE' '{' value '}';\n//  comment -> '@COMMENT' '{' value '}';\n//  entry -> '@' key '{' key ',' key_value_list '}';\n//  key_value_list -> key_equals_value (',' key_equals_value)*;\n//  key_equals_value -> key '=' value;\n//  value -> value_quotes | value_braces | key;\n//  value_quotes -> '\"' .*? '\"'; // not quite\n//  value_braces -> '{' .*? '\"'; // not quite\nfunction BibtexParser() {\n  this.pos = 0;\n  this.input = \"\";\n  \n  this.entries = {};\n  this.strings = {\n      JAN: \"January\",\n      FEB: \"February\",\n      MAR: \"March\",      \n      APR: \"April\",\n      MAY: \"May\",\n      JUN: \"June\",\n      JUL: \"July\",\n      AUG: \"August\",\n      SEP: \"September\",\n      OCT: \"October\",\n      NOV: \"November\",\n      DEC: \"December\"\n  };\n  this.currentKey = \"\";\n  this.currentEntry = \"\";\n  \n\n  this.setInput = function(t) {\n    this.input = t;\n  }\n  \n  this.getEntries = function() {\n      return this.entries;\n  }\n\n  this.isWhitespace = function(s) {\n    return (s == ' ' || s == '\\r' || s == '\\t' || s == '\\n');\n  }\n\n  this.match = function(s) {\n    this.skipWhitespace();\n    if (this.input.substring(this.pos, this.pos+s.length) == s) {\n      this.pos += s.length;\n    } else {\n      throw \"Token mismatch, expected \" + s + \", found \" + this.input.substring(this.pos);\n    }\n    this.skipWhitespace();\n  }\n\n  this.tryMatch = function(s) {\n    this.skipWhitespace();\n    if (this.input.substring(this.pos, this.pos+s.length) == s) {\n      return true;\n    } else {\n      return false;\n    }\n    this.skipWhitespace();\n  }\n\n  this.skipWhitespace = function() {\n    while (this.isWhitespace(this.input[this.pos])) {\n      this.pos++;\n    }\n    if (this.input[this.pos] == \"%\") {\n      while(this.input[this.pos] != \"\\n\") {\n        this.pos++;\n      }\n      this.skipWhitespace();\n    }\n  }\n\n  this.value_braces = function() {\n    var bracecount = 0;\n    this.match(\"{\");\n    var start = this.pos;\n    while(true) {\n      if (this.input[this.pos] == '}' && this.input[this.pos-1] != '\\\\') {\n        if (bracecount > 0) {\n          bracecount--;\n        } else {\n          var end = this.pos;\n          this.match(\"}\");\n          return this.input.substring(start, end);\n        }\n      } else if (this.input[this.pos] == '{') {\n        bracecount++;\n      } else if (this.pos == this.input.length-1) {\n        throw \"Unterminated value\";\n      }\n      this.pos++;\n    }\n  }\n\n  this.value_quotes = function() {\n    this.match('\"');\n    var start = this.pos;\n    while(true) {\n      if (this.input[this.pos] == '\"' && this.input[this.pos-1] != '\\\\') {\n          var end = this.pos;\n          this.match('\"');\n          return this.input.substring(start, end);\n      } else if (this.pos == this.input.length-1) {\n        throw \"Unterminated value:\" + this.input.substring(start);\n      }\n      this.pos++;\n    }\n  }\n  \n  this.single_value = function() {\n    var start = this.pos;\n    if (this.tryMatch(\"{\")) {\n      return this.value_braces();\n    } else if (this.tryMatch('\"')) {\n      return this.value_quotes();\n    } else {\n      var k = this.key();\n      if (this.strings[k.toUpperCase()]) {\n        return this.strings[k];\n      } else if (k.match(\"^[0-9]+$\")) {\n        return k;\n      } else {\n        throw \"Value expected:\" + this.input.substring(start);\n      }\n    }\n  }\n  \n  this.value = function() {\n    var values = [];\n    values.push(this.single_value());\n    while (this.tryMatch(\"#\")) {\n      this.match(\"#\");\n      values.push(this.single_value());\n    }\n    return values.join(\"\");\n  }\n\n  this.key = function() {\n    var start = this.pos;\n    while(true) {\n      if (this.pos == this.input.length) {\n        throw \"Runaway key\";\n      }\n    \n      if (this.input[this.pos].match(\"[a-zA-Z0-9_:\\\\./-]\")) {\n        this.pos++\n      } else {\n        return this.input.substring(start, this.pos).toUpperCase();\n      }\n    }\n  }\n\n  this.key_equals_value = function() {\n    var key = this.key();\n    if (this.tryMatch(\"=\")) {\n      this.match(\"=\");\n      var val = this.value();\n      return [ key, val ];\n    } else {\n      throw \"... = value expected, equals sign missing:\" + this.input.substring(this.pos);\n    }\n  }\n\n  this.key_value_list = function() {\n    var kv = this.key_equals_value();\n    this.entries[this.currentEntry][kv[0]] = kv[1];\n    while (this.tryMatch(\",\")) {\n      this.match(\",\");\n      // fixes problems with commas at the end of a list\n      if (this.tryMatch(\"}\")) {\n        break;\n      }\n      kv = this.key_equals_value();\n      this.entries[this.currentEntry][kv[0]] = kv[1];\n    }\n  }\n\n  this.entry_body = function() {\n    this.currentEntry = this.key();\n    this.entries[this.currentEntry] = new Object();    \n    this.match(\",\");\n    this.key_value_list();\n  }\n\n  this.directive = function () {\n    this.match(\"@\");\n    return \"@\"+this.key();\n  }\n\n  this.string = function () {\n    var kv = this.key_equals_value();\n    this.strings[kv[0].toUpperCase()] = kv[1];\n  }\n\n  this.preamble = function() {\n    this.value();\n  }\n\n  this.comment = function() {\n    this.value(); // this is wrong\n  }\n\n  this.entry = function() {\n    this.entry_body();\n  }\n\n  this.bibtex = function() {\n    while(this.tryMatch(\"@\")) {\n      var d = this.directive().toUpperCase();\n      this.match(\"{\");\n      if (d == \"@STRING\") {\n        this.string();\n      } else if (d == \"@PREAMBLE\") {\n        this.preamble();\n      } else if (d == \"@COMMENT\") {\n        this.comment();\n      } else {\n        this.entry();\n      }\n      this.match(\"}\");\n    }\n  }\n}\n\nfunction BibtexDisplay() {\n  this.fixValue = function (value) {\n    value = value.replace(/\\\\glqq\\s?/g, \"&bdquo;\");\n    value = value.replace(/\\\\grqq\\s?/g, '&rdquo;');\n    value = value.replace(/\\\\ /g, '&nbsp;');\n    value = value.replace(/\\\\url/g, '');\n    value = value.replace(/---/g, '&mdash;');\n    value = value.replace(/{\\\\\"a}/g, '&auml;');\n    value = value.replace(/\\{\\\\\"o\\}/g, '&ouml;');\n    value = value.replace(/{\\\\\"u}/g, '&uuml;');\n    value = value.replace(/{\\\\\"A}/g, '&Auml;');\n    value = value.replace(/{\\\\\"O}/g, '&Ouml;');\n    value = value.replace(/{\\\\\"U}/g, '&Uuml;');\n    value = value.replace(/\\\\ss/g, '&szlig;');\n    value = value.replace(/\\{(.*?)\\}/g, '$1');\n    return value;\n  }\n  \n  this.displayBibtex2 = function(i, o) {\n    var b = new BibtexParser();\n    b.setInput(i);\n    b.bibtex();\n\n    var e = b.getEntries();\n    var old = o.find(\"*\");\n  \n    for (var item in e) {\n      var tpl = $(\".bibtex_template\").clone().removeClass('bibtex_template');\n      tpl.addClass(\"unused\");\n      \n      for (var key in e[item]) {\n      \n        var fields = tpl.find(\".\" + key.toLowerCase());\n        for (var i = 0; i < fields.size(); i++) {\n          var f = $(fields[i]);\n          f.removeClass(\"unused\");\n          var value = this.fixValue(e[item][key]);\n          if (f.is(\"a\")) {\n            f.attr(\"href\", value);\n          } else {\n            var currentHTML = f.html() || \"\";\n            if (currentHTML.match(\"%\")) {\n              // \"complex\" template field\n              f.html(currentHTML.replace(\"%\", value));\n            } else {\n              // simple field\n              f.html(value);\n            }\n          }\n        }\n      }\n    \n      var emptyFields = tpl.find(\"span .unused\");\n      emptyFields.each(function (key,f) {\n        if (f.innerHTML.match(\"%\")) {\n          f.innerHTML = \"\";\n        }\n      });\n    \n      o.append(tpl);\n      tpl.show();\n    }\n    \n    old.remove();\n  }\n\n\n  this.displayBibtex = function(input, output) {\n    // parse bibtex input\n    var b = new BibtexParser();\n    b.setInput(input);\n    b.bibtex();\n    \n    // save old entries to remove them later\n    var old = output.find(\"*\");    \n\n    // iterate over bibTeX entries\n    var entries = b.getEntries();\n    for (var entryKey in entries) {\n      var entry = entries[entryKey];\n      \n      // find template\n      var tpl = $(\".bibtex_template\").clone().removeClass('bibtex_template');\n      \n      // find all keys in the entry\n      var keys = [];\n      for (var key in entry) {\n        keys.push(key.toUpperCase());\n      }\n      \n      // find all ifs and check them\n      var removed = false;\n      do {\n        // find next if\n        var conds = tpl.find(\".if\");\n        if (conds.size() == 0) {\n          break;\n        }\n        \n        // check if\n        var cond = conds.first();\n        cond.removeClass(\"if\");\n        var ifTrue = true;\n        var classList = cond.attr('class').split(' ');\n        $.each( classList, function(index, cls){\n          if(keys.indexOf(cls.toUpperCase()) < 0) {\n            ifTrue = false;\n          }\n          cond.removeClass(cls);\n        });\n        \n        // remove false ifs\n        if (!ifTrue) {\n          cond.remove();\n        }\n      } while (true);\n      \n      // fill in remaining fields \n      for (var index in keys) {\n        var key = keys[index];\n        var value = entry[key] || \"\";\n        tpl.find(\"span:not(a).\" + key.toLowerCase()).html(this.fixValue(value));\n        tpl.find(\"a.\" + key.toLowerCase()).attr('href', this.fixValue(value));\n      }\n      \n      output.append(tpl);\n      tpl.show();\n    }\n    \n    // remove old entries\n    old.remove();\n  }\n\n}\n\nfunction bibtex_js_draw() {\n    // check for template, add default\n    if ($(\".bibtex_template\").size() == 0) {\n      $(\"body\").append(\"<div class=\\\"bibtex_template\\\"><div class=\\\"if author\\\" style=\\\"font-weight: bold;\\\">\\n  <span class=\\\"if year\\\">\\n    <span class=\\\"year\\\"></span>, \\n  </span>\\n  <span class=\\\"author\\\"></span>\\n  <span class=\\\"if url\\\" style=\\\"margin-left: 20px\\\">\\n    <a class=\\\"url\\\" style=\\\"color:black; font-size:10px\\\">(view online)</a>\\n  </span>\\n</div>\\n<div style=\\\"margin-left: 10px; margin-bottom:5px;\\\">\\n  <span class=\\\"title\\\"></span>\\n</div></div>\");\n    }    \n    $(\".bibtex_template\").hide();\n    (new BibtexDisplay()).displayBibtex($(\"#bibtex_input\").val(), $(\"#bibtex_display\"));\n}\n\n\n\n/**\n * Parses a string into bibtex\n */\nexports.BibtexParser = BibtexParser;",
        "events": "/**\n * Bindings to Kanso events\n *\n * (most of this is taken from the kanso admin app example,\n *      https://github.com/caolan/kanso/blob/master/admin/lib/app.js)\n */\n\nvar events = require('kanso/events'),\n    session = require('kanso/session'),\n    templates = require('kanso/templates'),\n    events = require('kanso/events'),\n    db = require('kanso/db');\n\n\n\n/**\n * The init method fires when the app is initially loaded from a page rendered\n * by CouchDB.  (DOESN'T SEEM TO WORK)\n */\nevents.on('init', function () {\n    bindSessionControls();\n});\n\n\n/**\n * The sessionChange event fires when the app is first loaded and the user's\n * session information becomes available. It is also fired whenever a change\n * to the user's session is detected, for example after logging in or out.\n */\nevents.on('sessionChange', function (userCtx, req) {\n    $('#session').replaceWith(templates.render('session.html', req, userCtx));\n    $('#registration').replaceWith(templates.render('registration.html', req, userCtx));\n});\n\n\n\n/**\n * The updateFailure event fires when an update function returns a document as\n * the first part of an array, but the client-side request to update the\n * document fails.\n */\n\nevents.on('updateFailure', function (err, info, req, res, doc) {\n    alert(err.message || err.toString());\n});\n\n\n// --- nrama only after here\n\n/**\n * afterResponse is not documented, but I think it fires after the\n * document has been rendered by the client (and not after rendering by the server)\n */\nevents.on('afterResponse', function(info, req, res) {\n\tif( req.client && typeof $ !=='undefined' ) {\n        $('._timeago').timeago();\n        $('._sort-me').sortlist();\n        $('textarea._nrama-note-content').autogrow();\n\t}\n});\n\n\n/**\n * --- modified from the kanso admin app\n * it's live = call only once\n */\nvar bindSessionControls = function () {\n    $('#session .logout a').die().live('click', function (ev) {\n        ev.preventDefault();\n        session.logout();\n        return false;\n    });\n    $('.login a').die().live('click', function (ev) {\n        ev.preventDefault();\n        var div = $('<div><h2>Login</h2></div>');\n        div.append('<form id=\"login_form\" action=\"/_session\" method=\"POST\">' +\n            '<div class=\"general_errors\"></div>' +\n            '<div class=\"username field\">' +\n                '<label for=\"id_name\">Username</label>' +\n                '<input id=\"id_name\" name=\"name\" type=\"text\" />' +\n                '<div class=\"errors\"></div>' +\n            '</div>' +\n            '<div class=\"password field\">' +\n                '<label for=\"id_password\">Password</label>' +\n                '<input id=\"id_password\" name=\"password\" type=\"password\" />' +\n                '<div class=\"errors\"></div>' +\n            '</div>' +\n            '<div class=\"actions\">' +\n                '<input type=\"button\" id=\"id_cancel\" value=\"Cancel\" />' +\n                '<input type=\"submit\" id=\"id_login\" value=\"Login\" />' +\n            '</div>' +\n        '</form>');\n        $('#id_cancel', div).click(function () {\n            $.modal.close();\n        });\n        $('form', div).submit(function (ev) {\n            ev.preventDefault();\n            var username = $('input[name=\"name\"]', div).val();\n            var password = $('input[name=\"password\"]', div).val();\n            console.log($('.username .errors', div));\n            $('.username .errors', div).text(\n                username ? '': 'Please enter a username'\n            );\n            $('.password .errors', div).text(\n                password ? '': 'Please enter a password'\n            );\n            if (username && password) {\n                session.login(username, password, function (err) {\n                    $('.general_errors', div).text(err ? err.toString(): '');\n                    if (!err) {\n                        $(div).fadeOut('slow', function () {\n                            $.modal.close();\n                        });\n                    }\n                });\n            }\n            return false;\n        });\n        div.modal({autoResize: true, overlayClose: true});\n        return false;\n    });\n    $('.signup a').die().live('click', function (ev) {\n        ev.preventDefault();\n        var div = $('<div><h2>Create an account</h2></div>');\n        div.append(\"<p>It's free.</p>\");\n        div.append('<form id=\"signup_form\" action=\"/_session\" method=\"POST\">' +\n            '<div class=\"general_errors\"></div>' +\n            '<div class=\"username field\">' +\n                '<label for=\"id_name\">Username</label>' +\n                '<input id=\"id_name\" name=\"name\" type=\"text\" />' +\n                '<div class=\"errors\"></div>' +\n            '</div>' +\n            '<div class=\"password field\">' +\n                '<label for=\"id_password\">Password</label>' +\n                '<input id=\"id_password\" name=\"password\" type=\"password\" />' +\n                '<div class=\"errors\"></div>' +\n            '</div>' +\n            '<div class=\"actions\">' +\n                '<input type=\"button\" id=\"id_cancel\" value=\"Cancel\" />' +\n                '<input type=\"submit\" id=\"id_create\" value=\"Create\" />' +\n            '</div>' +\n        '</form>');\n        $('#id_cancel', div).click(function () {\n            $.modal.close();\n        });\n        $('form', div).submit(function (ev) {\n            ev.preventDefault();\n            var username = $('input[name=\"name\"]', div).val();\n            var password = $('input[name=\"password\"]', div).val();\n            console.log($('.username .errors', div));\n            $('.username .errors', div).text(\n                username ? '': 'Please enter a username'\n            );\n            $('.password .errors', div).text(\n                password ? '': 'Please enter a password'\n            );\n            if (username && password) {\n                session.signup(username, password, function (error) {\n                    $('.general_errors', div).text(error ? error.toString(): '');\n                    if( error ) {\n                        if( error.status === 409 || error.error === 'conflict' ) {\n                            $('.general_errors', div).text('That username is already taken');\n                        }\n                    } else {\n                        session.login(username, password, function (error) {\n                            $('.general_errors', div).text(error ? error.toString(): '');\n                            $(div).fadeOut('slow', function () {\n                                $.modal.close();\n                            });\n                        });\n                    }\n                });\n            }\n            return false;\n        });\n        div.modal({autoResize: true, overlayClose: true});\n        return false;\n    });\n};",
        "filters": "/**\n * Filter functions to be exported from the design doc.\n */\n",
        "lists": "/**\n * List functions to be exported from the design doc.\n */\nvar templates = require('kanso/templates'),\n    events = require('kanso/events'),\n    db = require('kanso/db'),\n    _ = require('./underscore')._,\n    nrama_init = require('./nrama2_init').init;\n\n\n/**\n * set the title element for a page based on the query\n */\nvar make_title = function(what, req) {\n    var title = 'Note-o-rama : ';\n    if( req.query && req.query.user ) {\n        title += req.query.user+\"'s \"+what;\n    } else {\n        title += what;\n    }\n    return title;\n}\n\n/**\n * The templates need to know what's in the path of the current url and how to\n * include parts of that in creating links.\n * This may include garbage like 'group' and 'descending' parameters.\n *\n * Use: e.g. <a href=\"{baseURL}{query_user_url}/authors/{author}\">{author}</a>\n *  will provide a link to /users/user/authors/author from a page with a user in its path,\n *  and a link to /authors/author from a page with no such link.\n */\nvar _make_query_urls = function( req) {\n    var query_urls = {}\n    _(req.query).each(function(value, key){\n        query_urls['query_'+key] = value;\n        query_urls['query_'+key+'_url'] = '/'+key+'s/'+encodeURIComponent( value );\n    });\n    return query_urls;\n}\n\n/**\n * used in templates : true if broswer-rendered and the current notes & quotes are the user's\n *  (combine the two things because we're mainly interested in whether the user can edit)\n */\nvar _is_users_own_page = function(req) {\n    return {\n        is_users_own_page : req.client && req.query.user && req.query.user==req.userCtx.name\n    };\n}\n\n\n/**\n *\n */\nvar make_universal_template_data = function(req) {\n    var universal_template_data = _.extend(\n        _make_query_urls(req),\n        _is_users_own_page(req),\n        { req_client : req.client }\n    );\n\n    //TODO remove (for testing only)\n    if( req.client ) {\n        window.req = req;\n        window.utd = universal_template_data;\n        window._ = _;\n    }\n    \n    return universal_template_data;\n}\n\nexports.all_users = function (head, req) {\n\n    start({code: 200, headers: {'Content-Type': 'text/html'}});\n\n    // fetch all the rows\n    var users = [];\n    var row;\n    while( row = getRow() ) {\n        var updated_time = '';\n        try {\n            updated_time = new Date(parseInt(row.value.max)).toISOString()\n        } catch(e) {}\n        users.push({\n            user_id : row.key,\n            updated_time : updated_time    //this is time a source was updated\n        });\n    }\n\n    // generate the markup for a list of users\n    var content = templates.render('all_users.html', req, _({\n            users : users\n        }).extend( make_universal_template_data(req) )\n    );\n\n    return {title: make_title('users',req), content: content};\n\n};\n\n\n/**\n * list all sources for single user or for all users\n * works with view userId_source\n * The sources are listed in the order they were last updated\n */\nexports.sources = function(head, req) {\n    start({code: 200, headers: {'Content-Type': 'text/html'}});\n\n    var sources = [];\n    var row;\n    while( row = getRow() ) {\n        if( row.doc ) {\n            var thing = row.doc;\n            if( thing.type && thing.type == 'source' ) {\n                if( thing.page_id ) {\n                    thing.page_id_enc = encodeURIComponent(thing.page_id);\n                }\n                if( thing.updated ) {\n                    thing.updated_time = new Date(thing.updated).toISOString();   //human-readable\n                }\n                sources.push(thing);\n            }\n        }\n    }\n    \n    var content = templates.render('sources.html', req, _({\n            sources : sources\n        }).extend( make_universal_template_data(req) )\n    );\n    \n    return {title: make_title('sources',req), content: content };\n};\n\n\n/**\n * list authors (and their sources)\n * use with userId_author view\n *\n * Here we exploit the fact that the rows are sorted by author.\n * The query should provide author_index_in_key to specify where in the view-provided\n *   key an author's name can be found.\n */\nexports.authors = function (head, req) {\n\n    start({code: 200, headers: {'Content-Type': 'text/html'}});\n\n    var authors = [];   //keys will be authors, values will be a list of sources\n    var author_index_in_key = parseInt( req.query.author_index_in_key );\n\n    var row = getRow();\n    while( row ) {\n        if( !row || !row.key || !row.key[author_index_in_key] ) {\n            row = getRow();\n            continue;\n        }\n        var current_author = row.key[author_index_in_key];\n        author_sources = {\n            author_name : current_author,\n            sources : [row.doc]\n        };\n        row = getRow();\n        while( row && row.key[author_index_in_key] == current_author ) {\n            author_sources.sources.push(row.doc)\n            row = getRow();\n        }\n        authors.push(author_sources);\n    }\n\n    var content = templates.render('authors.html', req, _({\n            authors : authors\n        }).extend( make_universal_template_data(req) )\n    );\n\n    return {title: make_title('authors',req), content: content};\n\n};\n\n/**\n * tag cloud for [all users' | a user's] tags\n * user with views: tags_all and tags\n *\n * the query should include tag_index_in_key which specifies the index of the tag\n *   in the key provided by the view\n */\nexports.tags = function(head, req) {\n    start({code: 200, headers: {'Content-Type': 'text/html'}});\n\n    var tag_index_in_key = parseInt( req.query.tag_index_in_key );\n    \n    var tags = [];\n    \n    var row ;\n    while( row = getRow() ) {\n        if( !row.key || !row.key[tag_index_in_key] ) {\n            continue;\n        }\n        tags.push({\n           text : row.key[tag_index_in_key],\n           weight : row.value,\n           url : \"/\"\n        });\n    }\n    var content = templates.render('tags.html', req, _({\n            tags : tags\n        }).extend( make_universal_template_data(req) )\n    );\n\n    if( req.client ) {\n        window.tags = tags; //todo remove\n        $(document).one('nrama_page_loaded', function(){\n            $('#tag_cloud').jQCloud(tags, {\n                callback : function() {\n                    $('#tag_cloud a').each(function(){\n                        $(this).attr('href', req.userCtx.baseURL + (req.query.user ? '/users/'+encodeURIComponent(req.query.user) : '') + '/tags/'+ $(this).text());\n                    });\n                }\n            });\n        });\n    }\n\n\n    return {title: make_title('tags',req), content: content};\n}\n\n/**\n * Written for single or multi-users.\n * TODO factor out common parts with exports.quotes\n * (most of this is duplicated, and the nrama part is VERBATIM)\n */\nexports.flow = function(head, req) {\n    start({code: 200, headers: {'Content-Type': 'text/html'}});\n\n    var find_source = {};   //indexed by _id\n    var find_quote = {};    //indexed by quote_hash, priority to the first we find\n    var find_note = {}; //indexed by _id\n   \n    var row;\n    while( row  = getRow() ) {\n        var thing = row.doc;        // <-- NB must be used with ?include_docs=true\n        \n        if( !thing || !thing.type ) {\n            continue;\n        }\n        \n        if( thing.type == 'source' ) {\n            var source = thing;\n            find_source[source._id] = source;\n            source.updated_time = new Date(source.updated).toISOString();   //nb should not persist this property\n        }\n        if( thing.type == 'quote' ) {\n            var quote = thing;\n            if( !find_quote[quote.hash] ) {\n                find_quote[quote.hash] = quote;\n                quote.users = [];   //nb should not persist this property (quotes are not updated)\n            }\n            find_quote[quote.hash].users.push(quote.user_id);\n        }\n        if( thing.type == 'note' ) {\n            var note = thing;\n            find_note[note._id] = note;\n        }\n    }\n\n    //attach notes to quotes\n    var notes = _.values(find_note);\n    var note_orphan_ids = [];   //ids of notes with no quote found; \n    _.each(notes, function(note) {\n        var quote = find_quote[note.quote_hash];\n        if( !quote ) {\n            note_orphan_ids.push(note._id);\n        }else {\n            if( !quote.notes ){\n                quote.notes = [];\n            }\n            quote.notes.push(note);\n        }\n    });\n    // for now we don't do anything with the note orphans\n    \n    //attach sources to quotes\n    var quotes = _.values(find_quote);\n    _.each(quotes, function(quote){\n        quote.source = find_source[quote.source_id]; //may be undefined\n    });\n    \n    if( req.client ) {\n        window.quotes = quotes; //TODO debug only\n\n        $(document).one('nrama_page_loaded', function(){\n            $('._sort-me').sortlist();\n            $('textarea._nrama-note-content').autogrow();\n        });\n    }\n    \n    var content = templates.render('flow.html', req, _({\n            quotes : quotes\n        }).extend( make_universal_template_data(req) )\n    );\n\n\n    // -- configure nrama, attach event listners (copied verbatim from exports.quotes)\n    if( req.client ) {\n        \n        var nrama = nrama_init(find_source);\n        window.nrama = nrama;                   //TODO remove!\n        \n        $(document).one('nrama_page_loaded', function(){\n            $('._nrama-note').each(function(){\n                var $note = $(this);\n                var note_id = $note.attr('id');\n                $note.data('nrama_note', find_note[note_id]);\n            });\n            \n            //save after notes have been edited\n            $('textarea._nrama-note-content').one('blur', nrama.notes.update_on_blur);\n            \n            //configure add a note\n            $('.add-a-note').die().live('click', function(){\n                console.log('add a note ...');\n                var $quote = $(this).parents('._nrama-quote').first();\n                var quote = find_quote[$quote.attr('id')];\n                var note = nrama.notes.create(quote);\n                //add to page data\n                find_note[note._id] = note;\n                //display note\n                var note_html = '<li id=\"'+note._id+'\" class=\"_nrama-note\"><textarea class=\"_nrama-note-content\">'+note.content+'</textarea></li>';\n                var $note = $(note_html);\n                $('ul.notes',$quote).prepend($note);\n                $note = $('#'+note._id);        //overwrite after prepend\n                $note.data('nrama_note',note);\n                $('textarea', $note).focus().select().one('blur', nrama.notes.update_on_blur);\n                $note.hide().show(500, function(){ $('#'+note._id).autogrow().focus().select(); });\n                console.log('done');\n            });\n            \n            //TODO can only do this if user owns the quote!!!\n            \n            //configure delete a quote\n            var delete_on_meta_click = function(e){\n                if( !e.altKey && !e.metaKey ) {\n                    return;\n                }\n                var $quote = $(this).parents('._nrama-quote').first();\n                var quote = find_quote[ $quote.attr('id') ];\n                if( quote.user_id[0] != '*' ) {\n                    if( !req.userCtx || req.userCtx.name != quote.user_id ) {\n                        console.log('cannot delete another users quotes');\n                        return;\n                    }\n                }\n                var $notes =  $('._nrama-note', $quote);  \n                if( $notes.length != 0 ) {\n                    //don't delete quotes with notes attached ...\n                    $quote.css({'border-top':'1px dashed red',\n                                     'border-bottom':'1px dashed red'})\n                    //... instead make the relevant notes bounce\n                    $notes.effect('bounce', function(){\n                        $quote.css({'border-top':'none',\n                                         'border-bottom':'none'},500);\n                    });\n                    return;\n                }\n                //remove the quote\n                $quote.css('background-color','orange');\n                nrama.persist.rm(quote, function(error, data){\n                    if( error ) {\n                        nrama._debug({msg:'nrama: error removing quote',error:error});\n                    } else {\n                        $quote.css('background-color','red').\n                            animate({'background-color':'black'}, function(){\n                                $quote.remove();\n                            });\n                    }\n                });\n            }\n            $('.quote-content').die().live('click', delete_on_meta_click);\n        });\n    }\n    \n    \n\n    return {title: make_title('flow',req), content: content};\n\n}\n\n\n\n/**\n * lists quotes organised by source.\n * can handle one or more sources.\n * makes no assumptions about keys or values; can only be used with include_docs\n * \n * for use with\n *   -  /sources/:source\n *   -  /users/:user/sources/:source\n *   - /tags/:tag\n *   - /users/:user/tags/:tag\n */\nexports.quotes = function(head, req) {\n    start({code: 200, headers: {'Content-Type': 'text/html'}});\n\n    var find_source = {};   //indexed by page_id, the first source we find gets priority\n    var find_quote = {};    //indexed by quote_hash \n    var notes_for_quotes = {};\n    var find_note = {}; //indexed by _id\n   \n    var row;\n    while( row  = getRow() ) {\n        var thing = row.doc;        // <-- NB must be used with ?include_docs=true\n        \n        if( !thing || !thing.type ) {\n            continue;\n        }\n        \n        if( thing.type == 'source' ) {\n            var source = thing;\n            if( !find_source[source.page_id] ) {\n                find_source[source.page_id] = source;\n                source.updated_time = new Date(source.updated).toISOString();   //nb should not persist this property\n                source.users = [];          //nb should not persist this property\n            }\n            find_source[source.page_id].users.push(source.user_id);\n        }\n        if( thing.type == 'quote' ) {\n            var quote = thing;\n            if( !find_quote[quote.hash] ) {\n                find_quote[quote.hash] = quote;\n                quote.users = [];   //nb should not persist this property (quotes are not updated)\n            }\n            find_quote[quote.hash].users.push(quote.user_id);\n        }\n        if( thing.type == 'note' ) {\n            var note = thing;\n            find_note[note._id] = note;\n            if( !notes_for_quotes[note.quote_hash]  ) {\n                notes_for_quotes[note.quote_hash] = [];\n            }\n            notes_for_quotes[note.quote_hash].push(note);\n        }\n    }\n\n    // -- attach notes to quotes and quotes to sources\n    var quotes = _(find_quote).values();\n    var orphaned_quotes = [];        //for now we don't do anything with oprhans\n    _(quotes).each(function(quote) {\n        quote.notes = notes_for_quotes[quote.hash] || [];\n        var source = find_source[quote.page_id];\n        if( !source ) {\n            orphaned_quotes.push(quote);\n        } else{\n            if( !source.quotes ) {\n                source.quotes = [];\n            }\n            source.quotes.push(quote);\n        }\n    });\n    var sources = _(find_source).values();\n\n    // -- for each source, sort its quotes by page_order\n    var array_comparitor = function(a,b){\n        if( a.length == 0 ) {\n            return b.length == 0 ? 0 : -1 /*b first*/;\n        }\n        if( b.length == 0 ) {\n            return a.length == 0 ? 0 : 1 /* a first */;\n        }\n        var left = a[0];\n        var right = b[0];\n        if( left == right ) {\n            return array_comparitor(a.slice(1),b.slice(1)); //nb slice does not modify in place\n        }\n        return left - right /* +ve = a first */;\n    };\n    var page_order_comparitor = function(a,b) {\n        // -- arrays\n        if( a instanceof Array && b instanceof Array ) {\n            return array_comparitor(a,b);\n        } else {\n            if( a instanceof Array ) { return 1; } //arrays before everything else\n            if( b instanceof Array ) { return -1; }\n        }\n        // -- numbers\n        var a_num = parseFloat(a),\n            b_num = parseFloat(b),\n            _is_num = function(n){ return !isNaN(n) && isFinite(n); }  //thank you http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric\n            a_is_num = _is_num(a_num),\n            b_is_num = _is_num(b_num);\n        if( a_is_num && b_is_num ) {  \n            return a_num - b_num;\n        } else {\n            if( a_num ) { return 1; }\n            if( b_num ) { return -1; }\n        }\n        // -- whatever else\n        return a > b ? 1 : (a < b ? -1 : 0);\n    }\n    var quote_sorter = function(a,b){ return page_order_comparitor(a.page_order, b.page_order) };    // <-- NB b,a because we want ascending order\n    _(sources).each(function(source){\n        var source_quotes = source.quotes;\n        if( source_quotes ) {\n            source_quotes.sort(quote_sorter);\n        }\n    });\n    \n    \n    // -- configure nrama, attach event listners\n    if( req.client ) {\n        \n        var nrama = nrama_init(find_source);\n        window.nrama = nrama;                   //TODO remove!\n        \n        $(document).one('nrama_page_loaded', function(){\n            $('._nrama-note').each(function(){\n                var $note = $(this);\n                var note_id = $note.attr('id');\n                $note.data('nrama_note', find_note[note_id]);\n            });\n            \n            //save after notes have been edited\n            $('textarea._nrama-note-content').one('blur', nrama.notes.update_on_blur);\n            \n            //configure add a note\n            $('.add-a-note').die().live('click', function(){\n                console.log('add a note ...');\n                var $quote = $(this).parents('._nrama-quote').first();\n                var quote = find_quote[$quote.attr('id')];\n                var note = nrama.notes.create(quote);\n                //add to page data\n                find_note[note._id] = note;\n                //display note\n                var note_html = '<li id=\"'+note._id+'\" class=\"_nrama-note\"><textarea class=\"_nrama-note-content\">'+note.content+'</textarea></li>';\n                var $note = $(note_html);\n                $('ul.notes',$quote).prepend($note);\n                $note = $('#'+note._id);        //overwrite after prepend\n                $note.data('nrama_note',note);\n                $('textarea', $note).focus().select().one('blur', nrama.notes.update_on_blur);\n                $note.hide().show(500, function(){ $('#'+note._id).autogrow().focus().select(); });\n                console.log('done');\n            });\n            \n            //TODO can only do this if user owns the quote!!!\n            \n            //configure delete a quote\n            var delete_on_meta_click = function(e){\n                if( !e.altKey && !e.metaKey ) {\n                    return;\n                }\n                var $quote = $(this).parents('._nrama-quote').first();\n                var quote = find_quote[ $quote.attr('id') ];\n                if( quote.user_id[0] != '*' ) {\n                    if( !req.userCtx || req.userCtx.name != quote.user_id ) {\n                        console.log('cannot delete another users quotes');\n                        return;\n                    }\n                }\n                var $notes =  $('._nrama-note', $quote);  \n                if( $notes.length != 0 ) {\n                    //don't delete quotes with notes attached ...\n                    $quote.css({'border-top':'1px dashed red',\n                                     'border-bottom':'1px dashed red'})\n                    //... instead make the relevant notes bounce\n                    $notes.effect('bounce', function(){\n                        $quote.css({'border-top':'none',\n                                         'border-bottom':'none'},500);\n                    });\n                    return;\n                }\n                //remove the quote\n                $quote.css('background-color','orange');\n                nrama.persist.rm(quote, function(error, data){\n                    if( error ) {\n                        nrama._debug({msg:'nrama: error removing quote',error:error});\n                    } else {\n                        $quote.css('background-color','red').\n                            animate({'background-color':'black'}, function(){\n                                $quote.remove();\n                            });\n                    }\n                });\n            }\n            $('.quote-content').die().live('click', delete_on_meta_click);\n        });\n    }\n    \n    \n    \n    //TODO remove !\n    if( req.client ) {\n        window.sources = sources;\n        window.find_quote = find_quote;\n    }\n    var content = templates.render('quotes.html', req, _({\n            sources : sources,\n            no_sources : (sources.length == 0)  //because !![] == true\n        }).extend( make_universal_template_data(req) )\n    );\n\n    return {title: make_title('notes',req), content: content };\n}\n\n\n\n",
        "md5": "/*\n * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message\n * Digest Algorithm, as defined in RFC 1321.\n * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for more info.\n */\n\n/*\n * Configurable variables. You may need to tweak these to be compatible with\n * the server-side, but the defaults work in most cases.\n */\nvar hexcase = 0;   /* hex output format. 0 - lowercase; 1 - uppercase        */\nvar b64pad  = \"\";  /* base-64 pad character. \"=\" for strict RFC compliance   */\n\n/*\n * These are the functions you'll usually want to call\n * They take string arguments and return either hex or base-64 encoded strings\n */\nfunction hex_md5(s)    { return rstr2hex(rstr_md5(str2rstr_utf8(s))); }\nfunction b64_md5(s)    { return rstr2b64(rstr_md5(str2rstr_utf8(s))); }\nfunction any_md5(s, e) { return rstr2any(rstr_md5(str2rstr_utf8(s)), e); }\nfunction hex_hmac_md5(k, d)\n  { return rstr2hex(rstr_hmac_md5(str2rstr_utf8(k), str2rstr_utf8(d))); }\nfunction b64_hmac_md5(k, d)\n  { return rstr2b64(rstr_hmac_md5(str2rstr_utf8(k), str2rstr_utf8(d))); }\nfunction any_hmac_md5(k, d, e)\n  { return rstr2any(rstr_hmac_md5(str2rstr_utf8(k), str2rstr_utf8(d)), e); }\n\n/*\n * Perform a simple self-test to see if the VM is working\n */\nfunction md5_vm_test()\n{\n  return hex_md5(\"abc\").toLowerCase() == \"900150983cd24fb0d6963f7d28e17f72\";\n}\n\n/*\n * Calculate the MD5 of a raw string\n */\nfunction rstr_md5(s)\n{\n  return binl2rstr(binl_md5(rstr2binl(s), s.length * 8));\n}\n\n/*\n * Calculate the HMAC-MD5, of a key and some data (raw strings)\n */\nfunction rstr_hmac_md5(key, data)\n{\n  var bkey = rstr2binl(key);\n  if(bkey.length > 16) bkey = binl_md5(bkey, key.length * 8);\n\n  var ipad = Array(16), opad = Array(16);\n  for(var i = 0; i < 16; i++)\n  {\n    ipad[i] = bkey[i] ^ 0x36363636;\n    opad[i] = bkey[i] ^ 0x5C5C5C5C;\n  }\n\n  var hash = binl_md5(ipad.concat(rstr2binl(data)), 512 + data.length * 8);\n  return binl2rstr(binl_md5(opad.concat(hash), 512 + 128));\n}\n\n/*\n * Convert a raw string to a hex string\n */\nfunction rstr2hex(input)\n{\n  try { hexcase } catch(e) { hexcase=0; }\n  var hex_tab = hexcase ? \"0123456789ABCDEF\" : \"0123456789abcdef\";\n  var output = \"\";\n  var x;\n  for(var i = 0; i < input.length; i++)\n  {\n    x = input.charCodeAt(i);\n    output += hex_tab.charAt((x >>> 4) & 0x0F)\n           +  hex_tab.charAt( x        & 0x0F);\n  }\n  return output;\n}\n\n/*\n * Convert a raw string to a base-64 string\n */\nfunction rstr2b64(input)\n{\n  try { b64pad } catch(e) { b64pad=''; }\n  var tab = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n  var output = \"\";\n  var len = input.length;\n  for(var i = 0; i < len; i += 3)\n  {\n    var triplet = (input.charCodeAt(i) << 16)\n                | (i + 1 < len ? input.charCodeAt(i+1) << 8 : 0)\n                | (i + 2 < len ? input.charCodeAt(i+2)      : 0);\n    for(var j = 0; j < 4; j++)\n    {\n      if(i * 8 + j * 6 > input.length * 8) output += b64pad;\n      else output += tab.charAt((triplet >>> 6*(3-j)) & 0x3F);\n    }\n  }\n  return output;\n}\n\n/*\n * Convert a raw string to an arbitrary string encoding\n */\nfunction rstr2any(input, encoding)\n{\n  var divisor = encoding.length;\n  var i, j, q, x, quotient;\n\n  /* Convert to an array of 16-bit big-endian values, forming the dividend */\n  var dividend = Array(Math.ceil(input.length / 2));\n  for(i = 0; i < dividend.length; i++)\n  {\n    dividend[i] = (input.charCodeAt(i * 2) << 8) | input.charCodeAt(i * 2 + 1);\n  }\n\n  /*\n   * Repeatedly perform a long division. The binary array forms the dividend,\n   * the length of the encoding is the divisor. Once computed, the quotient\n   * forms the dividend for the next step. All remainders are stored for later\n   * use.\n   */\n  var full_length = Math.ceil(input.length * 8 /\n                                    (Math.log(encoding.length) / Math.log(2)));\n  var remainders = Array(full_length);\n  for(j = 0; j < full_length; j++)\n  {\n    quotient = Array();\n    x = 0;\n    for(i = 0; i < dividend.length; i++)\n    {\n      x = (x << 16) + dividend[i];\n      q = Math.floor(x / divisor);\n      x -= q * divisor;\n      if(quotient.length > 0 || q > 0)\n        quotient[quotient.length] = q;\n    }\n    remainders[j] = x;\n    dividend = quotient;\n  }\n\n  /* Convert the remainders to the output string */\n  var output = \"\";\n  for(i = remainders.length - 1; i >= 0; i--)\n    output += encoding.charAt(remainders[i]);\n\n  return output;\n}\n\n/*\n * Encode a string as utf-8.\n * For efficiency, this assumes the input is valid utf-16.\n */\nfunction str2rstr_utf8(input)\n{\n  var output = \"\";\n  var i = -1;\n  var x, y;\n\n  while(++i < input.length)\n  {\n    /* Decode utf-16 surrogate pairs */\n    x = input.charCodeAt(i);\n    y = i + 1 < input.length ? input.charCodeAt(i + 1) : 0;\n    if(0xD800 <= x && x <= 0xDBFF && 0xDC00 <= y && y <= 0xDFFF)\n    {\n      x = 0x10000 + ((x & 0x03FF) << 10) + (y & 0x03FF);\n      i++;\n    }\n\n    /* Encode output as utf-8 */\n    if(x <= 0x7F)\n      output += String.fromCharCode(x);\n    else if(x <= 0x7FF)\n      output += String.fromCharCode(0xC0 | ((x >>> 6 ) & 0x1F),\n                                    0x80 | ( x         & 0x3F));\n    else if(x <= 0xFFFF)\n      output += String.fromCharCode(0xE0 | ((x >>> 12) & 0x0F),\n                                    0x80 | ((x >>> 6 ) & 0x3F),\n                                    0x80 | ( x         & 0x3F));\n    else if(x <= 0x1FFFFF)\n      output += String.fromCharCode(0xF0 | ((x >>> 18) & 0x07),\n                                    0x80 | ((x >>> 12) & 0x3F),\n                                    0x80 | ((x >>> 6 ) & 0x3F),\n                                    0x80 | ( x         & 0x3F));\n  }\n  return output;\n}\n\n/*\n * Encode a string as utf-16\n */\nfunction str2rstr_utf16le(input)\n{\n  var output = \"\";\n  for(var i = 0; i < input.length; i++)\n    output += String.fromCharCode( input.charCodeAt(i)        & 0xFF,\n                                  (input.charCodeAt(i) >>> 8) & 0xFF);\n  return output;\n}\n\nfunction str2rstr_utf16be(input)\n{\n  var output = \"\";\n  for(var i = 0; i < input.length; i++)\n    output += String.fromCharCode((input.charCodeAt(i) >>> 8) & 0xFF,\n                                   input.charCodeAt(i)        & 0xFF);\n  return output;\n}\n\n/*\n * Convert a raw string to an array of little-endian words\n * Characters >255 have their high-byte silently ignored.\n */\nfunction rstr2binl(input)\n{\n  var output = Array(input.length >> 2);\n  for(var i = 0; i < output.length; i++)\n    output[i] = 0;\n  for(var i = 0; i < input.length * 8; i += 8)\n    output[i>>5] |= (input.charCodeAt(i / 8) & 0xFF) << (i%32);\n  return output;\n}\n\n/*\n * Convert an array of little-endian words to a string\n */\nfunction binl2rstr(input)\n{\n  var output = \"\";\n  for(var i = 0; i < input.length * 32; i += 8)\n    output += String.fromCharCode((input[i>>5] >>> (i % 32)) & 0xFF);\n  return output;\n}\n\n/*\n * Calculate the MD5 of an array of little-endian words, and a bit length.\n */\nfunction binl_md5(x, len)\n{\n  /* append padding */\n  x[len >> 5] |= 0x80 << ((len) % 32);\n  x[(((len + 64) >>> 9) << 4) + 14] = len;\n\n  var a =  1732584193;\n  var b = -271733879;\n  var c = -1732584194;\n  var d =  271733878;\n\n  for(var i = 0; i < x.length; i += 16)\n  {\n    var olda = a;\n    var oldb = b;\n    var oldc = c;\n    var oldd = d;\n\n    a = md5_ff(a, b, c, d, x[i+ 0], 7 , -680876936);\n    d = md5_ff(d, a, b, c, x[i+ 1], 12, -389564586);\n    c = md5_ff(c, d, a, b, x[i+ 2], 17,  606105819);\n    b = md5_ff(b, c, d, a, x[i+ 3], 22, -1044525330);\n    a = md5_ff(a, b, c, d, x[i+ 4], 7 , -176418897);\n    d = md5_ff(d, a, b, c, x[i+ 5], 12,  1200080426);\n    c = md5_ff(c, d, a, b, x[i+ 6], 17, -1473231341);\n    b = md5_ff(b, c, d, a, x[i+ 7], 22, -45705983);\n    a = md5_ff(a, b, c, d, x[i+ 8], 7 ,  1770035416);\n    d = md5_ff(d, a, b, c, x[i+ 9], 12, -1958414417);\n    c = md5_ff(c, d, a, b, x[i+10], 17, -42063);\n    b = md5_ff(b, c, d, a, x[i+11], 22, -1990404162);\n    a = md5_ff(a, b, c, d, x[i+12], 7 ,  1804603682);\n    d = md5_ff(d, a, b, c, x[i+13], 12, -40341101);\n    c = md5_ff(c, d, a, b, x[i+14], 17, -1502002290);\n    b = md5_ff(b, c, d, a, x[i+15], 22,  1236535329);\n\n    a = md5_gg(a, b, c, d, x[i+ 1], 5 , -165796510);\n    d = md5_gg(d, a, b, c, x[i+ 6], 9 , -1069501632);\n    c = md5_gg(c, d, a, b, x[i+11], 14,  643717713);\n    b = md5_gg(b, c, d, a, x[i+ 0], 20, -373897302);\n    a = md5_gg(a, b, c, d, x[i+ 5], 5 , -701558691);\n    d = md5_gg(d, a, b, c, x[i+10], 9 ,  38016083);\n    c = md5_gg(c, d, a, b, x[i+15], 14, -660478335);\n    b = md5_gg(b, c, d, a, x[i+ 4], 20, -405537848);\n    a = md5_gg(a, b, c, d, x[i+ 9], 5 ,  568446438);\n    d = md5_gg(d, a, b, c, x[i+14], 9 , -1019803690);\n    c = md5_gg(c, d, a, b, x[i+ 3], 14, -187363961);\n    b = md5_gg(b, c, d, a, x[i+ 8], 20,  1163531501);\n    a = md5_gg(a, b, c, d, x[i+13], 5 , -1444681467);\n    d = md5_gg(d, a, b, c, x[i+ 2], 9 , -51403784);\n    c = md5_gg(c, d, a, b, x[i+ 7], 14,  1735328473);\n    b = md5_gg(b, c, d, a, x[i+12], 20, -1926607734);\n\n    a = md5_hh(a, b, c, d, x[i+ 5], 4 , -378558);\n    d = md5_hh(d, a, b, c, x[i+ 8], 11, -2022574463);\n    c = md5_hh(c, d, a, b, x[i+11], 16,  1839030562);\n    b = md5_hh(b, c, d, a, x[i+14], 23, -35309556);\n    a = md5_hh(a, b, c, d, x[i+ 1], 4 , -1530992060);\n    d = md5_hh(d, a, b, c, x[i+ 4], 11,  1272893353);\n    c = md5_hh(c, d, a, b, x[i+ 7], 16, -155497632);\n    b = md5_hh(b, c, d, a, x[i+10], 23, -1094730640);\n    a = md5_hh(a, b, c, d, x[i+13], 4 ,  681279174);\n    d = md5_hh(d, a, b, c, x[i+ 0], 11, -358537222);\n    c = md5_hh(c, d, a, b, x[i+ 3], 16, -722521979);\n    b = md5_hh(b, c, d, a, x[i+ 6], 23,  76029189);\n    a = md5_hh(a, b, c, d, x[i+ 9], 4 , -640364487);\n    d = md5_hh(d, a, b, c, x[i+12], 11, -421815835);\n    c = md5_hh(c, d, a, b, x[i+15], 16,  530742520);\n    b = md5_hh(b, c, d, a, x[i+ 2], 23, -995338651);\n\n    a = md5_ii(a, b, c, d, x[i+ 0], 6 , -198630844);\n    d = md5_ii(d, a, b, c, x[i+ 7], 10,  1126891415);\n    c = md5_ii(c, d, a, b, x[i+14], 15, -1416354905);\n    b = md5_ii(b, c, d, a, x[i+ 5], 21, -57434055);\n    a = md5_ii(a, b, c, d, x[i+12], 6 ,  1700485571);\n    d = md5_ii(d, a, b, c, x[i+ 3], 10, -1894986606);\n    c = md5_ii(c, d, a, b, x[i+10], 15, -1051523);\n    b = md5_ii(b, c, d, a, x[i+ 1], 21, -2054922799);\n    a = md5_ii(a, b, c, d, x[i+ 8], 6 ,  1873313359);\n    d = md5_ii(d, a, b, c, x[i+15], 10, -30611744);\n    c = md5_ii(c, d, a, b, x[i+ 6], 15, -1560198380);\n    b = md5_ii(b, c, d, a, x[i+13], 21,  1309151649);\n    a = md5_ii(a, b, c, d, x[i+ 4], 6 , -145523070);\n    d = md5_ii(d, a, b, c, x[i+11], 10, -1120210379);\n    c = md5_ii(c, d, a, b, x[i+ 2], 15,  718787259);\n    b = md5_ii(b, c, d, a, x[i+ 9], 21, -343485551);\n\n    a = safe_add(a, olda);\n    b = safe_add(b, oldb);\n    c = safe_add(c, oldc);\n    d = safe_add(d, oldd);\n  }\n  return Array(a, b, c, d);\n}\n\n/*\n * These functions implement the four basic operations the algorithm uses.\n */\nfunction md5_cmn(q, a, b, x, s, t)\n{\n  return safe_add(bit_rol(safe_add(safe_add(a, q), safe_add(x, t)), s),b);\n}\nfunction md5_ff(a, b, c, d, x, s, t)\n{\n  return md5_cmn((b & c) | ((~b) & d), a, b, x, s, t);\n}\nfunction md5_gg(a, b, c, d, x, s, t)\n{\n  return md5_cmn((b & d) | (c & (~d)), a, b, x, s, t);\n}\nfunction md5_hh(a, b, c, d, x, s, t)\n{\n  return md5_cmn(b ^ c ^ d, a, b, x, s, t);\n}\nfunction md5_ii(a, b, c, d, x, s, t)\n{\n  return md5_cmn(c ^ (b | (~d)), a, b, x, s, t);\n}\n\n/*\n * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n * to work around bugs in some JS interpreters.\n */\nfunction safe_add(x, y)\n{\n  var lsw = (x & 0xFFFF) + (y & 0xFFFF);\n  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n  return (msw << 16) | (lsw & 0xFFFF);\n}\n\n/*\n * Bitwise rotate a 32-bit number to the left.\n */\nfunction bit_rol(num, cnt)\n{\n  return (num << cnt) | (num >>> (32 - cnt));\n}\n\nexports.b64_hmac_md5 = b64_hmac_md5;",
        "nrama2_init": "/**\n * Call this (not nrama2) to load the functions.\n * NB can only be called client side!\n * \n */\nvar db = require('kanso/db'),\n    utils = require('kanso/utils'),\n    session = require('kanso/session'),\n    _ = require('./underscore')._,\n    BibtexParser = require('./bibtex').BibtexParser,      //nb this is more uptodate than that incl. with kanso 0.0.7\n    b64_hmac_md5 = require('./md5').b64_hmac_md5,\n    uuid_sync = require('./uuid');\n    nrama_constructors = require('./nrama2');\n\n/**\n * requires global $\n */\nvar _init = function(){\n    if( typeof window === 'undefined' || typeof document === 'undefine' ) {\n        throw new Error(\"nrama.init can only be run in the browser (window or document not defined)\");\n    }\n    if( typeof $ === 'undefined' ) {\n        throw new Error(\"nrama.init requires global $ (jQuery)\");\n    }\n\n    var lib = {\n        '$' : $,\n        '_' : _,\n        BibtexParser : BibtexParser,\n        b64_hmac_md5 : b64_hmac_md5\n    };\n    \n    // temporary patch (kanso's db lacks updates)\n    if( !db.doUpdate ) {\n        db.doUpdate = function( doc, update_name, callback ) {\n            var url = utils.getBaseURL() + '/update/' + update_name +'/' + db.encode( doc._id );\n            var req = {\n                type: 'PUT',\n                url: url,\n                data: JSON.stringify(doc),\n                processData: false,\n                contentType: 'application/json',\n                expect_json:false               //as of couchdb 1.1.0, updates seem to defy attempts to alter headers & return text/html header.\n            };\n            db.request(req, callback);\n        };\n    }\n    var nrama = {};\n    nrama.uuid = nrama_constructors._make_uuid(uuid_sync);\n    nrama.settings = _.extend( nrama_constructors._make_settings( nrama.uuid ), {\n        // -- internals\n        is_embedded : false,     //set to false when being used on the server\n        debug : true,\n        user_id : '*ERROR',\n        // -- quotes & note settings\n        note_style : {},\n        note_inner_style : {},\n        note_editor_style : {}\n    });\n    nrama._debug = nrama_constructors._make_debug(nrama.settings, window, lib);\n    nrama.log = nrama_constructors._make_logging(nrama.settings, $);\n    nrama.db = db;\n    nrama.session = session;\n    nrama.persist = nrama_constructors._make_persist(nrama.db, nrama.session, nrama.uuid, nrama._debug);\n    nrama.sources = nrama_constructors._make_sources(nrama.settings, nrama.persist, nrama._debug, lib);\n    \n    nrama.notes = nrama_constructors._make_notes(nrama.settings, nrama.uuid, nrama.persist,\n                                                 nrama.sources, null/*quotes*/, nrama._debug);\n    \n    /**\n     * return urls for various things (varies depending on current url)\n     */\n    nrama.kanso_urls = {}\n    nrama.kanso_urls.tag = function(tag, req) {\n        return req.userCtx.baseURL + (req.query.user ? '/users/'+encodeURIComponent(req.query.user) : '') + '/tags/'+ tag;\n    }\n    \n    \n    return nrama;\n};\n\n\nexports.init = _.once(_init);",
        "rewrites": "/**\n * Rewrite settings to be exported from the design doc\n *\n * NB : for nrama, the parameter names matter because req.query is used\n *      in templating.  Their names must match the urls used to access them,\n *      e.g. ':user' for something reprenseted in a url as /users/:user\n *\n */\n\nmodule.exports = [\n    {from: '/static/*', to: 'static/*'},\n    {from: '/xdm/*', to: 'xdm/*'},\n    // -- for the nrama application\n    {\n        from : '/sources',              //all sources\n        to : '_list/sources/source',\n        query : {\n            include_docs : 'true',  //for some reason it must be 'true', not true.\n            descending : 'true'\n        } \n    },\n    {\n        from: '/users',                   //list all users; intended as an entry point for search engines : TODO needs updating!\n        to: '_list/all_users/all_user_ids',\n        method : 'GET',\n        query : {\n          group : 'true'\n        } \n    },\n    {\n        from : '/users/:user',      //currently all sources for a particular user, probably modified in future\n        to : '_list/flow/quotes',\n        query : {\n            end_key: [\":user\"],\n            start_key : [\":user\", {}],\n            include_docs : 'true',\n            descending : 'true'\n        } \n    },\n    {\n        from : '/users/:user/sources',      //currently all sources for a particular user, probably modified in future\n        to : '_list/sources/userId_source',\n        query : {\n            end_key: [\":user\"],\n            start_key : [\":user\", {}],\n            include_docs : 'true',\n            descending : 'true'\n        } \n    },\n    {\n        from : '/authors',\n        to : '_list/authors/author_userId',\n        query : {\n            include_docs : 'true',\n            descending : 'false',\n            reduce : 'false',\n            author_index_in_key : '0'\n        }\n    },\n    {\n        from : '/authors/:author',   //all sources for an author \n        to : '_list/authors/author_userId',\n        query : {\n            start_key :  [\":author\"],\n            end_key : [\":author\", {}],\n            include_docs : 'true',\n            descending : 'false',\n            reduce : 'false',\n            author_index_in_key : '0'\n        }\n    },\n    {\n        from : '/users/:user/authors',              //list a user's authors\n        to : '_list/authors/userId_author',\n        query : {\n            start_key : [\":user\"],\n            end_key : [\":user\",{}],\n            reduce : 'false',\n            include_docs : 'true',   //docs are sources \n            author_index_in_key : '1'\n        }\n    },\n    {\n        from : '/users/:user/authors/:author',    //all sources for an author & user\n        to : '_list/authors/author_userId',\n        query : {\n            start_key :  [\":author\", \":user\"],\n            end_key : [\":author\", \":user\", {}],\n            include_docs : 'true',\n            descending : 'false',\n            reduce : 'false',\n            author_index_in_key : '0'\n        }\n    },\n    {\n        from : '/sources/:source',                  //everyone's notes on a source\n        to : '_list/quotes/pageId_userId',\n        query : {\n            startkey : [\":source\"],\n            endkey : [\":source\",{}],\n            include_docs : 'true'\n        }\n    },\n    {\n        from : '/users/:user/sources/:source',    //the user's notes on a source\n        to : '_list/quotes/pageId_userId',\n        query : {\n            key : [\":source\",\":user\"],\n            include_docs : 'true'\n        }\n    },\n    {\n        from : '/tags',                         //all tags, with frequency\n        to : '_list/tags/tags_all',\n        query : {\n            group : 'true',\n            tag_index_in_key : '0'\n        }\n    },\n    {\n        from : '/tags/:tag',                   //show everything marked with a particular tag\n        to : '_list/quotes/tags',\n        query : {\n            endkey : [\":tag\"],\n            startkey : [\":tag\", {}],\n            reduce : 'false',\n            descending : 'true',\n            include_docs : 'true'\n        }\n    },\n    {\n        from : '/tags/:tag/recent',            //same as previous but with flow\n        to : '_list/flow/tags',\n        query : {\n            endkey : [\":tag\"],\n            startkey : [\":tag\", {}],\n            reduce : 'false',\n            descending : 'true',\n            include_docs : 'true'\n        }\n    },\n    {\n        from : '/users/:user/tags',\n        to : '_list/tags/tags_user',\n        query : {\n            startkey : [\":user\"],\n            endkey : [\":user\", {}],\n            group_level : '2',\n            tag_index_in_key : '1'\n        }\n    },\n    {\n        from : '/users/:user/tags/:tag',                 //show everything of a users' marked with a particular tag\n        to : '_list/quotes/tags',\n        query : {\n          endkey : [\":tag\",\":user\"],\n          startkey : [\":tag\", \":user\", {}],\n          reduce : 'false',\n          descending : 'true',\n          include_docs : 'true'\n        }\n    },\n    {\n        from : '/users/:user/tags/:tag/recent',                 //show everything of a users' marked with a particular tag\n        to : '_list/flow/tags',\n        query : {\n          endkey : [\":tag\",\":user\"],\n          startkey : [\":tag\", \":user\", {}],\n          reduce : 'false',\n          descending : 'true',\n          include_docs : 'true'\n        }\n    },\n    \n    // -- for the bookmarklet/embeded client\n    {\n        from : '/update/source/:id',\n        to : '_update/source/:id'\n    },\n    \n    // -- generic\n    { from: '/', to: '_show/welcome' },\n    {from: '*', to: '_show/not_found'}\n];\n",
        "shows": "/**\n * Show functions to be exported from the design doc.\n */\n\nvar templates = require('kanso/templates'),\n    uuid_sync = require('./uuid');\n    nrama_constructors = require('./nrama2');\n\nvar nrama = {};\nnrama.uuid = nrama_constructors._make_uuid(uuid_sync);\n\nexports.welcome = function (doc, req) {\n    var data = {\n        anon_user_name : '*'+nrama.uuid(true).slice(0,10)\n    };\n\n    return {\n        title: 'Note-o-rama : note - quote - analyse',\n        content: templates.render('welcome.html', req, data)\n    };\n};\n\nexports.not_found = function (doc, req) {\n    return {\n        title: '404 - Not Found',\n        content: templates.render('404.html', req, {})\n    };\n};\n",
        "types": "/**\n * Kanso document types to export\n */\nvar Type = require('kanso/types').Type,\n    fields = require('kanso/fields'),\n    widgets = require('kanso/widgets');\n\n\n",
        "underscore": "//     Underscore.js 1.1.7\n//     (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.\n//     Underscore is freely distributable under the MIT license.\n//     Portions of Underscore are inspired or borrowed from Prototype,\n//     Oliver Steele's Functional, and John Resig's Micro-Templating.\n//     For all details and documentation:\n//     http://documentcloud.github.com/underscore\n\n(function() {\n\n  // Baseline setup\n  // --------------\n\n  // Establish the root object, `window` in the browser, or `global` on the server.\n  var root = this;\n\n  // Save the previous value of the `_` variable.\n  var previousUnderscore = root._;\n\n  // Establish the object that gets returned to break out of a loop iteration.\n  var breaker = {};\n\n  // Save bytes in the minified (but not gzipped) version:\n  var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;\n\n  // Create quick reference variables for speed access to core prototypes.\n  var slice            = ArrayProto.slice,\n      unshift          = ArrayProto.unshift,\n      toString         = ObjProto.toString,\n      hasOwnProperty   = ObjProto.hasOwnProperty;\n\n  // All **ECMAScript 5** native function implementations that we hope to use\n  // are declared here.\n  var\n    nativeForEach      = ArrayProto.forEach,\n    nativeMap          = ArrayProto.map,\n    nativeReduce       = ArrayProto.reduce,\n    nativeReduceRight  = ArrayProto.reduceRight,\n    nativeFilter       = ArrayProto.filter,\n    nativeEvery        = ArrayProto.every,\n    nativeSome         = ArrayProto.some,\n    nativeIndexOf      = ArrayProto.indexOf,\n    nativeLastIndexOf  = ArrayProto.lastIndexOf,\n    nativeIsArray      = Array.isArray,\n    nativeKeys         = Object.keys,\n    nativeBind         = FuncProto.bind;\n\n  // Create a safe reference to the Underscore object for use below.\n  var _ = function(obj) { return new wrapper(obj); };\n\n  // Export the Underscore object for **CommonJS**, with backwards-compatibility\n  // for the old `require()` API. If we're not in CommonJS, add `_` to the\n  // global object.\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = _;\n    _._ = _;\n  } else {\n    // Exported as a string, for Closure Compiler \"advanced\" mode.\n    root['_'] = _;\n  }\n\n  // Current version.\n  _.VERSION = '1.1.7';\n\n  // Collection Functions\n  // --------------------\n\n  // The cornerstone, an `each` implementation, aka `forEach`.\n  // Handles objects with the built-in `forEach`, arrays, and raw objects.\n  // Delegates to **ECMAScript 5**'s native `forEach` if available.\n  var each = _.each = _.forEach = function(obj, iterator, context) {\n    if (obj == null) return;\n    if (nativeForEach && obj.forEach === nativeForEach) {\n      obj.forEach(iterator, context);\n    } else if (obj.length === +obj.length) {\n      for (var i = 0, l = obj.length; i < l; i++) {\n        if (i in obj && iterator.call(context, obj[i], i, obj) === breaker) return;\n      }\n    } else {\n      for (var key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n          if (iterator.call(context, obj[key], key, obj) === breaker) return;\n        }\n      }\n    }\n  };\n\n  // Return the results of applying the iterator to each element.\n  // Delegates to **ECMAScript 5**'s native `map` if available.\n  _.map = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeMap && obj.map === nativeMap) return obj.map(iterator, context);\n    each(obj, function(value, index, list) {\n      results[results.length] = iterator.call(context, value, index, list);\n    });\n    return results;\n  };\n\n  // **Reduce** builds up a single result from a list of values, aka `inject`,\n  // or `foldl`. Delegates to **ECMAScript 5**'s native `reduce` if available.\n  _.reduce = _.foldl = _.inject = function(obj, iterator, memo, context) {\n    var initial = memo !== void 0;\n    if (obj == null) obj = [];\n    if (nativeReduce && obj.reduce === nativeReduce) {\n      if (context) iterator = _.bind(iterator, context);\n      return initial ? obj.reduce(iterator, memo) : obj.reduce(iterator);\n    }\n    each(obj, function(value, index, list) {\n      if (!initial) {\n        memo = value;\n        initial = true;\n      } else {\n        memo = iterator.call(context, memo, value, index, list);\n      }\n    });\n    if (!initial) throw new TypeError(\"Reduce of empty array with no initial value\");\n    return memo;\n  };\n\n  // The right-associative version of reduce, also known as `foldr`.\n  // Delegates to **ECMAScript 5**'s native `reduceRight` if available.\n  _.reduceRight = _.foldr = function(obj, iterator, memo, context) {\n    if (obj == null) obj = [];\n    if (nativeReduceRight && obj.reduceRight === nativeReduceRight) {\n      if (context) iterator = _.bind(iterator, context);\n      return memo !== void 0 ? obj.reduceRight(iterator, memo) : obj.reduceRight(iterator);\n    }\n    var reversed = (_.isArray(obj) ? obj.slice() : _.toArray(obj)).reverse();\n    return _.reduce(reversed, iterator, memo, context);\n  };\n\n  // Return the first value which passes a truth test. Aliased as `detect`.\n  _.find = _.detect = function(obj, iterator, context) {\n    var result;\n    any(obj, function(value, index, list) {\n      if (iterator.call(context, value, index, list)) {\n        result = value;\n        return true;\n      }\n    });\n    return result;\n  };\n\n  // Return all the elements that pass a truth test.\n  // Delegates to **ECMAScript 5**'s native `filter` if available.\n  // Aliased as `select`.\n  _.filter = _.select = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeFilter && obj.filter === nativeFilter) return obj.filter(iterator, context);\n    each(obj, function(value, index, list) {\n      if (iterator.call(context, value, index, list)) results[results.length] = value;\n    });\n    return results;\n  };\n\n  // Return all the elements for which a truth test fails.\n  _.reject = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    each(obj, function(value, index, list) {\n      if (!iterator.call(context, value, index, list)) results[results.length] = value;\n    });\n    return results;\n  };\n\n  // Determine whether all of the elements match a truth test.\n  // Delegates to **ECMAScript 5**'s native `every` if available.\n  // Aliased as `all`.\n  _.every = _.all = function(obj, iterator, context) {\n    var result = true;\n    if (obj == null) return result;\n    if (nativeEvery && obj.every === nativeEvery) return obj.every(iterator, context);\n    each(obj, function(value, index, list) {\n      if (!(result = result && iterator.call(context, value, index, list))) return breaker;\n    });\n    return result;\n  };\n\n  // Determine if at least one element in the object matches a truth test.\n  // Delegates to **ECMAScript 5**'s native `some` if available.\n  // Aliased as `any`.\n  var any = _.some = _.any = function(obj, iterator, context) {\n    iterator = iterator || _.identity;\n    var result = false;\n    if (obj == null) return result;\n    if (nativeSome && obj.some === nativeSome) return obj.some(iterator, context);\n    each(obj, function(value, index, list) {\n      if (result |= iterator.call(context, value, index, list)) return breaker;\n    });\n    return !!result;\n  };\n\n  // Determine if a given value is included in the array or object using `===`.\n  // Aliased as `contains`.\n  _.include = _.contains = function(obj, target) {\n    var found = false;\n    if (obj == null) return found;\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) return obj.indexOf(target) != -1;\n    any(obj, function(value) {\n      if (found = value === target) return true;\n    });\n    return found;\n  };\n\n  // Invoke a method (with arguments) on every item in a collection.\n  _.invoke = function(obj, method) {\n    var args = slice.call(arguments, 2);\n    return _.map(obj, function(value) {\n      return (method.call ? method || value : value[method]).apply(value, args);\n    });\n  };\n\n  // Convenience version of a common use case of `map`: fetching a property.\n  _.pluck = function(obj, key) {\n    return _.map(obj, function(value){ return value[key]; });\n  };\n\n  // Return the maximum element or (element-based computation).\n  _.max = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj)) return Math.max.apply(Math, obj);\n    var result = {computed : -Infinity};\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      computed >= result.computed && (result = {value : value, computed : computed});\n    });\n    return result.value;\n  };\n\n  // Return the minimum element (or element-based computation).\n  _.min = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj)) return Math.min.apply(Math, obj);\n    var result = {computed : Infinity};\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      computed < result.computed && (result = {value : value, computed : computed});\n    });\n    return result.value;\n  };\n\n  // Sort the object's values by a criterion produced by an iterator.\n  _.sortBy = function(obj, iterator, context) {\n    return _.pluck(_.map(obj, function(value, index, list) {\n      return {\n        value : value,\n        criteria : iterator.call(context, value, index, list)\n      };\n    }).sort(function(left, right) {\n      var a = left.criteria, b = right.criteria;\n      return a < b ? -1 : a > b ? 1 : 0;\n    }), 'value');\n  };\n\n  // Groups the object's values by a criterion produced by an iterator\n  _.groupBy = function(obj, iterator) {\n    var result = {};\n    each(obj, function(value, index) {\n      var key = iterator(value, index);\n      (result[key] || (result[key] = [])).push(value);\n    });\n    return result;\n  };\n\n  // Use a comparator function to figure out at what index an object should\n  // be inserted so as to maintain order. Uses binary search.\n  _.sortedIndex = function(array, obj, iterator) {\n    iterator || (iterator = _.identity);\n    var low = 0, high = array.length;\n    while (low < high) {\n      var mid = (low + high) >> 1;\n      iterator(array[mid]) < iterator(obj) ? low = mid + 1 : high = mid;\n    }\n    return low;\n  };\n\n  // Safely convert anything iterable into a real, live array.\n  _.toArray = function(iterable) {\n    if (!iterable)                return [];\n    if (iterable.toArray)         return iterable.toArray();\n    if (_.isArray(iterable))      return slice.call(iterable);\n    if (_.isArguments(iterable))  return slice.call(iterable);\n    return _.values(iterable);\n  };\n\n  // Return the number of elements in an object.\n  _.size = function(obj) {\n    return _.toArray(obj).length;\n  };\n\n  // Array Functions\n  // ---------------\n\n  // Get the first element of an array. Passing **n** will return the first N\n  // values in the array. Aliased as `head`. The **guard** check allows it to work\n  // with `_.map`.\n  _.first = _.head = function(array, n, guard) {\n    return (n != null) && !guard ? slice.call(array, 0, n) : array[0];\n  };\n\n  // Returns everything but the first entry of the array. Aliased as `tail`.\n  // Especially useful on the arguments object. Passing an **index** will return\n  // the rest of the values in the array from that index onward. The **guard**\n  // check allows it to work with `_.map`.\n  _.rest = _.tail = function(array, index, guard) {\n    return slice.call(array, (index == null) || guard ? 1 : index);\n  };\n\n  // Get the last element of an array.\n  _.last = function(array) {\n    return array[array.length - 1];\n  };\n\n  // Trim out all falsy values from an array.\n  _.compact = function(array) {\n    return _.filter(array, function(value){ return !!value; });\n  };\n\n  // Return a completely flattened version of an array.\n  _.flatten = function(array) {\n    return _.reduce(array, function(memo, value) {\n      if (_.isArray(value)) return memo.concat(_.flatten(value));\n      memo[memo.length] = value;\n      return memo;\n    }, []);\n  };\n\n  // Return a version of the array that does not contain the specified value(s).\n  _.without = function(array) {\n    return _.difference(array, slice.call(arguments, 1));\n  };\n\n  // Produce a duplicate-free version of the array. If the array has already\n  // been sorted, you have the option of using a faster algorithm.\n  // Aliased as `unique`.\n  _.uniq = _.unique = function(array, isSorted) {\n    return _.reduce(array, function(memo, el, i) {\n      if (0 == i || (isSorted === true ? _.last(memo) != el : !_.include(memo, el))) memo[memo.length] = el;\n      return memo;\n    }, []);\n  };\n\n  // Produce an array that contains the union: each distinct element from all of\n  // the passed-in arrays.\n  _.union = function() {\n    return _.uniq(_.flatten(arguments));\n  };\n\n  // Produce an array that contains every item shared between all the\n  // passed-in arrays. (Aliased as \"intersect\" for back-compat.)\n  _.intersection = _.intersect = function(array) {\n    var rest = slice.call(arguments, 1);\n    return _.filter(_.uniq(array), function(item) {\n      return _.every(rest, function(other) {\n        return _.indexOf(other, item) >= 0;\n      });\n    });\n  };\n\n  // Take the difference between one array and another.\n  // Only the elements present in just the first array will remain.\n  _.difference = function(array, other) {\n    return _.filter(array, function(value){ return !_.include(other, value); });\n  };\n\n  // Zip together multiple lists into a single array -- elements that share\n  // an index go together.\n  _.zip = function() {\n    var args = slice.call(arguments);\n    var length = _.max(_.pluck(args, 'length'));\n    var results = new Array(length);\n    for (var i = 0; i < length; i++) results[i] = _.pluck(args, \"\" + i);\n    return results;\n  };\n\n  // If the browser doesn't supply us with indexOf (I'm looking at you, **MSIE**),\n  // we need this function. Return the position of the first occurrence of an\n  // item in an array, or -1 if the item is not included in the array.\n  // Delegates to **ECMAScript 5**'s native `indexOf` if available.\n  // If the array is large and already in sort order, pass `true`\n  // for **isSorted** to use binary search.\n  _.indexOf = function(array, item, isSorted) {\n    if (array == null) return -1;\n    var i, l;\n    if (isSorted) {\n      i = _.sortedIndex(array, item);\n      return array[i] === item ? i : -1;\n    }\n    if (nativeIndexOf && array.indexOf === nativeIndexOf) return array.indexOf(item);\n    for (i = 0, l = array.length; i < l; i++) if (array[i] === item) return i;\n    return -1;\n  };\n\n\n  // Delegates to **ECMAScript 5**'s native `lastIndexOf` if available.\n  _.lastIndexOf = function(array, item) {\n    if (array == null) return -1;\n    if (nativeLastIndexOf && array.lastIndexOf === nativeLastIndexOf) return array.lastIndexOf(item);\n    var i = array.length;\n    while (i--) if (array[i] === item) return i;\n    return -1;\n  };\n\n  // Generate an integer Array containing an arithmetic progression. A port of\n  // the native Python `range()` function. See\n  // [the Python documentation](http://docs.python.org/library/functions.html#range).\n  _.range = function(start, stop, step) {\n    if (arguments.length <= 1) {\n      stop = start || 0;\n      start = 0;\n    }\n    step = arguments[2] || 1;\n\n    var len = Math.max(Math.ceil((stop - start) / step), 0);\n    var idx = 0;\n    var range = new Array(len);\n\n    while(idx < len) {\n      range[idx++] = start;\n      start += step;\n    }\n\n    return range;\n  };\n\n  // Function (ahem) Functions\n  // ------------------\n\n  // Create a function bound to a given object (assigning `this`, and arguments,\n  // optionally). Binding with arguments is also known as `curry`.\n  // Delegates to **ECMAScript 5**'s native `Function.bind` if available.\n  // We check for `func.bind` first, to fail fast when `func` is undefined.\n  _.bind = function(func, obj) {\n    if (func.bind === nativeBind && nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));\n    var args = slice.call(arguments, 2);\n    return function() {\n      return func.apply(obj, args.concat(slice.call(arguments)));\n    };\n  };\n\n  // Bind all of an object's methods to that object. Useful for ensuring that\n  // all callbacks defined on an object belong to it.\n  _.bindAll = function(obj) {\n    var funcs = slice.call(arguments, 1);\n    if (funcs.length == 0) funcs = _.functions(obj);\n    each(funcs, function(f) { obj[f] = _.bind(obj[f], obj); });\n    return obj;\n  };\n\n  // Memoize an expensive function by storing its results.\n  _.memoize = function(func, hasher) {\n    var memo = {};\n    hasher || (hasher = _.identity);\n    return function() {\n      var key = hasher.apply(this, arguments);\n      return hasOwnProperty.call(memo, key) ? memo[key] : (memo[key] = func.apply(this, arguments));\n    };\n  };\n\n  // Delays a function for the given number of milliseconds, and then calls\n  // it with the arguments supplied.\n  _.delay = function(func, wait) {\n    var args = slice.call(arguments, 2);\n    return setTimeout(function(){ return func.apply(func, args); }, wait);\n  };\n\n  // Defers a function, scheduling it to run after the current call stack has\n  // cleared.\n  _.defer = function(func) {\n    return _.delay.apply(_, [func, 1].concat(slice.call(arguments, 1)));\n  };\n\n  // Internal function used to implement `_.throttle` and `_.debounce`.\n  var limit = function(func, wait, debounce) {\n    var timeout;\n    return function() {\n      var context = this, args = arguments;\n      var throttler = function() {\n        timeout = null;\n        func.apply(context, args);\n      };\n      if (debounce) clearTimeout(timeout);\n      if (debounce || !timeout) timeout = setTimeout(throttler, wait);\n    };\n  };\n\n  // Returns a function, that, when invoked, will only be triggered at most once\n  // during a given window of time.\n  _.throttle = function(func, wait) {\n    return limit(func, wait, false);\n  };\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds.\n  _.debounce = function(func, wait) {\n    return limit(func, wait, true);\n  };\n\n  // Returns a function that will be executed at most one time, no matter how\n  // often you call it. Useful for lazy initialization.\n  _.once = function(func) {\n    var ran = false, memo;\n    return function() {\n      if (ran) return memo;\n      ran = true;\n      return memo = func.apply(this, arguments);\n    };\n  };\n\n  // Returns the first function passed as an argument to the second,\n  // allowing you to adjust arguments, run code before and after, and\n  // conditionally execute the original function.\n  _.wrap = function(func, wrapper) {\n    return function() {\n      var args = [func].concat(slice.call(arguments));\n      return wrapper.apply(this, args);\n    };\n  };\n\n  // Returns a function that is the composition of a list of functions, each\n  // consuming the return value of the function that follows.\n  _.compose = function() {\n    var funcs = slice.call(arguments);\n    return function() {\n      var args = slice.call(arguments);\n      for (var i = funcs.length - 1; i >= 0; i--) {\n        args = [funcs[i].apply(this, args)];\n      }\n      return args[0];\n    };\n  };\n\n  // Returns a function that will only be executed after being called N times.\n  _.after = function(times, func) {\n    return function() {\n      if (--times < 1) { return func.apply(this, arguments); }\n    };\n  };\n\n\n  // Object Functions\n  // ----------------\n\n  // Retrieve the names of an object's properties.\n  // Delegates to **ECMAScript 5**'s native `Object.keys`\n  _.keys = nativeKeys || function(obj) {\n    if (obj !== Object(obj)) throw new TypeError('Invalid object');\n    var keys = [];\n    for (var key in obj) if (hasOwnProperty.call(obj, key)) keys[keys.length] = key;\n    return keys;\n  };\n\n  // Retrieve the values of an object's properties.\n  _.values = function(obj) {\n    return _.map(obj, _.identity);\n  };\n\n  // Return a sorted list of the function names available on the object.\n  // Aliased as `methods`\n  _.functions = _.methods = function(obj) {\n    var names = [];\n    for (var key in obj) {\n      if (_.isFunction(obj[key])) names.push(key);\n    }\n    return names.sort();\n  };\n\n  // Extend a given object with all the properties in passed-in object(s).\n  _.extend = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      for (var prop in source) {\n        if (source[prop] !== void 0) obj[prop] = source[prop];\n      }\n    });\n    return obj;\n  };\n\n  // Fill in a given object with default properties.\n  _.defaults = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      for (var prop in source) {\n        if (obj[prop] == null) obj[prop] = source[prop];\n      }\n    });\n    return obj;\n  };\n\n  // Create a (shallow-cloned) duplicate of an object.\n  _.clone = function(obj) {\n    return _.isArray(obj) ? obj.slice() : _.extend({}, obj);\n  };\n\n  // Invokes interceptor with the obj, and then returns obj.\n  // The primary purpose of this method is to \"tap into\" a method chain, in\n  // order to perform operations on intermediate results within the chain.\n  _.tap = function(obj, interceptor) {\n    interceptor(obj);\n    return obj;\n  };\n\n  // Perform a deep comparison to check if two objects are equal.\n  _.isEqual = function(a, b) {\n    // Check object identity.\n    if (a === b) return true;\n    // Different types?\n    var atype = typeof(a), btype = typeof(b);\n    if (atype != btype) return false;\n    // Basic equality test (watch out for coercions).\n    if (a == b) return true;\n    // One is falsy and the other truthy.\n    if ((!a && b) || (a && !b)) return false;\n    // Unwrap any wrapped objects.\n    if (a._chain) a = a._wrapped;\n    if (b._chain) b = b._wrapped;\n    // One of them implements an isEqual()?\n    if (a.isEqual) return a.isEqual(b);\n    if (b.isEqual) return b.isEqual(a);\n    // Check dates' integer values.\n    if (_.isDate(a) && _.isDate(b)) return a.getTime() === b.getTime();\n    // Both are NaN?\n    if (_.isNaN(a) && _.isNaN(b)) return false;\n    // Compare regular expressions.\n    if (_.isRegExp(a) && _.isRegExp(b))\n      return a.source     === b.source &&\n             a.global     === b.global &&\n             a.ignoreCase === b.ignoreCase &&\n             a.multiline  === b.multiline;\n    // If a is not an object by this point, we can't handle it.\n    if (atype !== 'object') return false;\n    // Check for different array lengths before comparing contents.\n    if (a.length && (a.length !== b.length)) return false;\n    // Nothing else worked, deep compare the contents.\n    var aKeys = _.keys(a), bKeys = _.keys(b);\n    // Different object sizes?\n    if (aKeys.length != bKeys.length) return false;\n    // Recursive comparison of contents.\n    for (var key in a) if (!(key in b) || !_.isEqual(a[key], b[key])) return false;\n    return true;\n  };\n\n  // Is a given array or object empty?\n  _.isEmpty = function(obj) {\n    if (_.isArray(obj) || _.isString(obj)) return obj.length === 0;\n    for (var key in obj) if (hasOwnProperty.call(obj, key)) return false;\n    return true;\n  };\n\n  // Is a given value a DOM element?\n  _.isElement = function(obj) {\n    return !!(obj && obj.nodeType == 1);\n  };\n\n  // Is a given value an array?\n  // Delegates to ECMA5's native Array.isArray\n  _.isArray = nativeIsArray || function(obj) {\n    return toString.call(obj) === '[object Array]';\n  };\n\n  // Is a given variable an object?\n  _.isObject = function(obj) {\n    return obj === Object(obj);\n  };\n\n  // Is a given variable an arguments object?\n  _.isArguments = function(obj) {\n    return !!(obj && hasOwnProperty.call(obj, 'callee'));\n  };\n\n  // Is a given value a function?\n  _.isFunction = function(obj) {\n    return !!(obj && obj.constructor && obj.call && obj.apply);\n  };\n\n  // Is a given value a string?\n  _.isString = function(obj) {\n    return !!(obj === '' || (obj && obj.charCodeAt && obj.substr));\n  };\n\n  // Is a given value a number?\n  _.isNumber = function(obj) {\n    return !!(obj === 0 || (obj && obj.toExponential && obj.toFixed));\n  };\n\n  // Is the given value `NaN`? `NaN` happens to be the only value in JavaScript\n  // that does not equal itself.\n  _.isNaN = function(obj) {\n    return obj !== obj;\n  };\n\n  // Is a given value a boolean?\n  _.isBoolean = function(obj) {\n    return obj === true || obj === false;\n  };\n\n  // Is a given value a date?\n  _.isDate = function(obj) {\n    return !!(obj && obj.getTimezoneOffset && obj.setUTCFullYear);\n  };\n\n  // Is the given value a regular expression?\n  _.isRegExp = function(obj) {\n    return !!(obj && obj.test && obj.exec && (obj.ignoreCase || obj.ignoreCase === false));\n  };\n\n  // Is a given value equal to null?\n  _.isNull = function(obj) {\n    return obj === null;\n  };\n\n  // Is a given variable undefined?\n  _.isUndefined = function(obj) {\n    return obj === void 0;\n  };\n\n  // Utility Functions\n  // -----------------\n\n  // Run Underscore.js in *noConflict* mode, returning the `_` variable to its\n  // previous owner. Returns a reference to the Underscore object.\n  _.noConflict = function() {\n    root._ = previousUnderscore;\n    return this;\n  };\n\n  // Keep the identity function around for default iterators.\n  _.identity = function(value) {\n    return value;\n  };\n\n  // Run a function **n** times.\n  _.times = function (n, iterator, context) {\n    for (var i = 0; i < n; i++) iterator.call(context, i);\n  };\n\n  // Add your own custom functions to the Underscore object, ensuring that\n  // they're correctly added to the OOP wrapper as well.\n  _.mixin = function(obj) {\n    each(_.functions(obj), function(name){\n      addToWrapper(name, _[name] = obj[name]);\n    });\n  };\n\n  // Generate a unique integer id (unique within the entire client session).\n  // Useful for temporary DOM ids.\n  var idCounter = 0;\n  _.uniqueId = function(prefix) {\n    var id = idCounter++;\n    return prefix ? prefix + id : id;\n  };\n\n  // By default, Underscore uses ERB-style template delimiters, change the\n  // following template settings to use alternative delimiters.\n  _.templateSettings = {\n    evaluate    : /<%([\\s\\S]+?)%>/g,\n    interpolate : /<%=([\\s\\S]+?)%>/g\n  };\n\n  // JavaScript micro-templating, similar to John Resig's implementation.\n  // Underscore templating handles arbitrary delimiters, preserves whitespace,\n  // and correctly escapes quotes within interpolated code.\n  _.template = function(str, data) {\n    var c  = _.templateSettings;\n    var tmpl = 'var __p=[],print=function(){__p.push.apply(__p,arguments);};' +\n      'with(obj||{}){__p.push(\\'' +\n      str.replace(/\\\\/g, '\\\\\\\\')\n         .replace(/'/g, \"\\\\'\")\n         .replace(c.interpolate, function(match, code) {\n           return \"',\" + code.replace(/\\\\'/g, \"'\") + \",'\";\n         })\n         .replace(c.evaluate || null, function(match, code) {\n           return \"');\" + code.replace(/\\\\'/g, \"'\")\n                              .replace(/[\\r\\n\\t]/g, ' ') + \"__p.push('\";\n         })\n         .replace(/\\r/g, '\\\\r')\n         .replace(/\\n/g, '\\\\n')\n         .replace(/\\t/g, '\\\\t')\n         + \"');}return __p.join('');\";\n    var func = new Function('obj', tmpl);\n    return data ? func(data) : func;\n  };\n\n  // The OOP Wrapper\n  // ---------------\n\n  // If Underscore is called as a function, it returns a wrapped object that\n  // can be used OO-style. This wrapper holds altered versions of all the\n  // underscore functions. Wrapped objects may be chained.\n  var wrapper = function(obj) { this._wrapped = obj; };\n\n  // Expose `wrapper.prototype` as `_.prototype`\n  _.prototype = wrapper.prototype;\n\n  // Helper function to continue chaining intermediate results.\n  var result = function(obj, chain) {\n    return chain ? _(obj).chain() : obj;\n  };\n\n  // A method to easily add functions to the OOP wrapper.\n  var addToWrapper = function(name, func) {\n    wrapper.prototype[name] = function() {\n      var args = slice.call(arguments);\n      unshift.call(args, this._wrapped);\n      return result(func.apply(_, args), this._chain);\n    };\n  };\n\n  // Add all of the Underscore functions to the wrapper object.\n  _.mixin(_);\n\n  // Add all mutator Array functions to the wrapper.\n  each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {\n    var method = ArrayProto[name];\n    wrapper.prototype[name] = function() {\n      method.apply(this._wrapped, arguments);\n      return result(this._wrapped, this._chain);\n    };\n  });\n\n  // Add all accessor Array functions to the wrapper.\n  each(['concat', 'join', 'slice'], function(name) {\n    var method = ArrayProto[name];\n    wrapper.prototype[name] = function() {\n      return result(method.apply(this._wrapped, arguments), this._chain);\n    };\n  });\n\n  // Start chaining a wrapped Underscore object.\n  wrapper.prototype.chain = function() {\n    this._chain = true;\n    return this;\n  };\n\n  // Extracts the result from a wrapped and chained object.\n  wrapper.prototype.value = function() {\n    return this._wrapped;\n  };\n\n})();",
        "updates": "/**\n * Update functions to be exported from the design doc.\n */\n\nvar utils = require('./utils'),\n    _ = require('./underscore')._;  //nb NOT the version shipped with kanso 0.0.7 -- that lacks _.union\n\n\n\n/**\n * This will only accept json data (no submission)\n *  to remove kanso wrapping around it, modify the _design entry to: {\n   \"source\": \"function(doc, req){var fn = require(\\\"lib/app\\\")[\\\"updates\\\"][\\\"source\\\"];return fn(doc,req);}\"\n}\n */\nexports.source = function (doc, req) {\n\n    var make_error = function(msg) {\n        var form_str;\n        for( var i in req.form ) { form_str+=i+' : '+ req.form[i]+ '\\n'; };\n        return [null, {\n            code: 400,  //doesn't currently work, see https://issues.apache.org/jira/browse/COUCHDB-648\n            headers: {\"Content-Type\" : \"application/json\"}, //doesn't currently work\n            body: '{\"error\":\"'+msg+'\",\"req_form\":\"'+form_str+'\",\"req_body\":\"'+req.body+'\"}'\n        }];\n    };\n    \n    if( !doc ) {\n        //create new source\n        //var data = req.form;\n        var data = JSON.parse(req.body);\n        \n        if( !data._id ) {\n            return make_error('error: no doc_id supplied in submitted data');\n        }\n        if ( !data.type || !data.type == 'source' ) {\n            return make_error('error: type missing or not set to source.');\n        }\n        var new_source = _.extend({}, data, {\n            _id : data._id,\n            created : new Date().getTime(),\n            updated : new Date().getTime()\n        });\n        return [new_source, 'created'];\n    } else {\n        additions = JSON.parse(req.body);\n        //-- append tags \n        var new_tags = _.union(doc.tags||[], additions.tags||[]);\n        doc = _.extend(doc, additions, {tags:new_tags});\n        \n        doc.updated = new Date().getTime();\n        return [doc,  'updated'\n          /*{\n            code: 200,  //doesn't currently work, see https://issues.apache.org/jira/browse/COUCHDB-648\n            //headers: {\"Content-Type\" : \"application/json\"}, //doesn't seem to work either\n            headers: {\"Content-Type\" : 'text/html'},        //this is what you get \n            body: 'updated'\n          }*/\n        ];\n    }\n};\n\n\n",
        "utils": "/**\n * utilities for nrama\n *\n * Copyright (c) 2011 Stephen A. Butterfill, http://note-o-rama.com\n * \n */\n\n ",
        "uuid": "(function() {\n  /*\n  * Generate a RFC4122(v4) UUID\n  *\n  * Documentation at https://github.com/broofa/node-uuid\n  *\n  * MIT & GPL dual license\n  */\n\n  // Use node.js Buffer class if available, otherwise use the Array class\n  var BufferClass = typeof(Buffer) == 'function' ? Buffer : Array;\n\n  // Buffer used for generating string uuids\n  var _buf = new BufferClass(16);\n\n  // Cache number <-> hex string for octet values\n  var toString = [];\n  var toNumber = {};\n  for (var i = 0; i < 256; i++) {\n    toString[i] = (i + 0x100).toString(16).substr(1);\n    toNumber[toString[i]] = i;\n  }\n\n  function parse(s) {\n    var buf = new BufferClass(16);\n    var i = 0;\n    s.toLowerCase().replace(/[0-9a-f][0-9a-f]/g, function(octet) {\n      buf[i++] = toNumber[octet];\n    });\n    return buf;\n  }\n\n  function unparse(buf) {\n    var tos = toString, b = buf;\n    return tos[b[0]] + tos[b[1]] + tos[b[2]] + tos[b[3]] + '-' +\n           tos[b[4]] + tos[b[5]] + '-' +\n           tos[b[6]] + tos[b[7]] + '-' +\n           tos[b[8]] + tos[b[9]] + '-' +\n           tos[b[10]] + tos[b[11]] + tos[b[12]] +\n           tos[b[13]] + tos[b[14]] + tos[b[15]];\n  }\n\n  var b32 = 0x100000000, ff = 0xff;\n  function uuid(fmt, buf, offset) {\n    var b = fmt != 'binary' ? _buf : (buf ? buf : new BufferClass(16));\n    var i = buf && offset || 0;\n\n    var r = Math.random()*b32;\n    b[i++] = r & ff;\n    b[i++] = r>>>8 & ff;\n    b[i++] = r>>>16 & ff;\n    b[i++] = r>>>24 & ff;\n    r = Math.random()*b32;\n    b[i++] = r & ff;\n    b[i++] = r>>>8 & ff;\n    b[i++] = r>>>16 & 0x0f | 0x40; // See RFC4122 sect. 4.1.3\n    b[i++] = r>>>24 & ff;\n    r = Math.random()*b32;\n    b[i++] = r & 0x3f | 0x80; // See RFC4122 sect. 4.4\n    b[i++] = r>>>8 & ff;\n    b[i++] = r>>>16 & ff;\n    b[i++] = r>>>24 & ff;\n    r = Math.random()*b32;\n    b[i++] = r & ff;\n    b[i++] = r>>>8 & ff;\n    b[i++] = r>>>16 & ff;\n    b[i++] = r>>>24 & ff;\n\n    return fmt === undefined ? unparse(b) : b;\n  };\n\n  uuid.parse = parse;\n  uuid.unparse = unparse;\n  uuid.BufferClass = BufferClass;\n\n  if (typeof(module) != 'undefined') {\n    module.exports = uuid;\n  } else {\n    // In browser? Set as top-level function\n    this.uuid = uuid;\n  }\n})();",
        "validate": "/**\n * The validate_doc_update function to be exported from the design doc.\n */\n\nvar types = require('kanso/types'),\n    app_types = require('./types');\n\n\nmodule.exports = function (newDoc, oldDoc, userCtx) {\n    types.validate_doc_update(app_types, newDoc, oldDoc, userCtx);\n    \n    /**\n     * if user_id of a documentcontains @, must be logged in as that user to make changes\n     */\n    var verify_user = function verify_user(user_id) {\n        if( user_id && user_id[0] != '*' ) {\n            if (userCtx.name == null ) {\n                throw({forbidden: 'This user must be logged in to make changes (* policy). user_id:'+user_id});\n            }\n            if( userCtx.name != user_id ) {\n                throw({forbidden: 'This user cannot make changes to another user\\'s documents (* policy).user_id:'+user_id});\n            }\n        }\n    }\n    if( newDoc ) {\n        verify_user(newDoc.user_id);\n    }\n    if( oldDoc ) {\n        verify_user(oldDoc.user_id);\n    }\n    \n};\n",
        "views": "/**\n * View functions to be exported from the design doc.\n */\n\n// === for the bookmarklet (/other) client\n\n/**\n * to request all notes or all quotes on a particular source,\n *   either for a particular user or for all users\n * TODO : should probably skip doc.type and provide everything\n */\nexports.pageId_type_userId = {\n    map : function(doc) {\n        if( doc.page_id && doc.type ) {\n            if( doc.user_id ) {\n                emit([doc.page_id, doc.type, doc.user_id],doc);\n            } else {\n            //no user_id\n            emit([doc.page_id, doc.type, null],doc);\n            }\n        }\n    }\n};\n\n\n\n// === for the couchApp\n\n/**\n * all users\n * http://localhost:5984/nrama/_design/nrama/_view/all_user_ids\n*/ \nexports.all_user_ids = {\n    map : function(doc) {\n        if( doc.type == 'source' && doc.updated) {\n            emit(doc.user_id, doc.updated);\n        }\n    },\n    reduce : '_stats'\n};\n\n/**\n * to display all sources (for all users) ordered by most recently updated\n */\nexports.source = {\n    map : function(doc) {\n        if( doc.type && doc.type == \"source\" ) {\n            if( doc.updated && doc.page_id ) {\n                emit([doc.updated, doc.page_id], null);\n            }\n        }\n    }\n};\n\n/**\n * to display all sources for a particular user\n */\nexports.userId_source = {\n    map : function(doc) {\n        if( doc.type && doc.type == \"source\" ) {\n            if( doc.user_id && doc.page_id && doc.updated ) {\n                emit([doc.user_id, doc.updated], null);\n            }\n        }\n    }\n};\n\n/**\n * to display [all users' | a user's] notes on a single source.\n * e.g.\n *   http://localhost:5984/nrama/_design/nrama/_view/pageId_userId?key=[\"http://en.wikipedia.org/wiki/Komodo_dragons?h=i\",\"steve@gmail.com\"]\n */\nexports.pageId_userId= {\n  map : function(doc) {\n    if( doc.user_id && doc.page_id ) {\n      emit([doc.page_id, doc.user_id], null);\n    }\n  }\n};\n\n\n// -- author views\n//    these differ almost only in order of emissions but don't have elegant way to express this relation\n\n/**\n * to display a user's authors and, for each author, the sources\n */\nexports.userId_author = {\n  map : function(doc) {\n    if( doc.type && doc.type == 'source' ) {\n      if( doc.AUTHOR && doc.user_id ) {\n        var year = doc.YEAR || 0;    //order is [null, 1965, 1990, 2000],  (typically reversed)\n        for( idx in doc.AUTHOR ) {\n          emit( [ doc.user_id, doc.AUTHOR[idx], 5000-year ], 1 );\n        }\n      }\n    }\n  },\n  reduce : \"_count\"\n}\n/**\n * to display all sources by an author, or all of a user's sources by an author,\n * sorted by year.\n * & to display all authors with each author's sources \n * (We are treating authors like tags; authors tag sources, not notes)\n */\nexports.author_userId = {\n  map : function(doc) {\n    if( doc.type && doc.type == 'source' ) {\n      if( doc.AUTHOR && doc.user_id ) {\n        var year_order = 5000 - parseInt(doc.YEAR) || 5000;    //order is [null, 1965, 1990, 2000],  (typically reversed)\n        for( idx in doc.AUTHOR ) {\n          emit( [doc.AUTHOR[idx], doc.user_id, year_order], 1 );\n        }\n      }\n    }\n  },\n  reduce : \"_count\"\n};\n\n\n// -- tags\n\n/**\n * to display all tags\n */\nexports.tags_all= {\n  map : function(doc) {\n    if( doc.type && doc.type == 'note' ) {\n      if( doc.tags ) {\n        for( idx in doc.tags ) {\n          var tag = doc.tags[idx];\n          emit([tag], 1);\n        }\n      }\n    }\n  },\n  reduce : '_count'\n};\nexports.tags_user= {\n  map : function(doc) {\n    if( doc.type && doc.type == 'note' ) {\n      if( doc.tags && doc.user_id ) {\n        for( idx in doc.tags ) {\n          var tag = doc.tags[idx];\n          emit([doc.user_id, tag], 1);\n        }\n      }\n    }\n  },\n  reduce : '_count'\n};\n/**\n * to show [all users' | a user's] notes on a tag organised by source,\n *   where the sources are sorted by most recently updated\n *\n * used with include_docs, it will grab triples of a note, a source & a quote.\n * see http://blog.couchbase.com/what%E2%80%99s-new-apache-couchdb-011-%E2%80%94-part-two-views-joins-redux-raw-collation-speed\n */\nexports.tags = {\n  map : function(doc) {\n    if( doc.type && doc.type == 'note' ) {\n      var note = doc;\n      if( note.tags ) {\n        if( note.user_id && note.source_id && note.quote_id && note.updated) {\n          for( var idx in note.tags ) {\n            var tag = note.tags[idx];\n            emit([ tag, note.user_id, note.updated ], null);                  //include the note iteself\n            emit([ tag, note.user_id, note.updated ], {_id:note.source_id});  //include the source\n            emit([ tag, note.user_id, note.updated ], {_id:note.quote_id});   //include the quote\n          }\n        }\n      }\n    }\n  },\n  reduce : \"_count\"\n};\n\n/**\n * for the flow, show notes by recency.  Allows a quote-centred view rather than\n *  source-centred.\n *\n * Wasteful -- emits source for every note and again for every quote.\n * Because quotes are emitted in order of CREATION (not in order notes are updated,\n * this view ends up being out of order).\n * If limited, there might be notes with missing quotes (this could happen where\n * there is a delay between creating a quote and adding a note).\n * (Could fix both problems by having updates to notes causing quotes to be updated\n * too, just as sources are.)\n *\n * Like tags, it provides note-quote-source triples and must be used with\n *  include_docs\n */ \nexports.quotes = {\n  map : function(doc) {\n    if( doc.type && doc.user_id && doc.source_id && doc.updated ) {\n      if( doc.type == 'note' && doc.quote_id ) {\n        var note = doc;\n        emit([ note.user_id, note.updated ], null);                  //include the note iteself\n        emit([ note.user_id, note.updated ], {_id:note.source_id});  //include the source\n        //emit([ note.user_id, note.updated ], {_id:note.quote_id});   //include the quote\n      }\n      if( doc.type == 'quote' ) {\n        var quote = doc;\n        emit([ quote.user_id, quote.created ], null);\n        emit([ quote.user_id, quote.created ], {_id:quote.source_id})\n      }\n    }\n  }\n};",
        "nrama2": "/**\n * note-o-rama, second attempt\n * Copyright (c) 2011 Stephen A. Butterfill\n *\n * For dependencies see lib.js\n *\n * To run as bookmarklet (change url; delete the 'now' param if not in developent mode):\n *   javascript:(function(){delete module;delete exports;_nrama_bkmklt=true;_nrama_user='steve';document.body.appendChild(document.createElement('script')).src='http://localhost:5984/nrama/_design/nrama/bkmrklt/nrama2.js?now=new Date().getTime()'; })();\n *\n * To embed in page:\n *   <script src='lib.min.js\" ></script>\n *   <script>\n *     _nrama_bkmklt = false;\n *   </script>\n *   <script src=\"nrama2_base.js\" ></script>\n *\n * To use as a commonJS module (see near the end for a list of dependencies):\n *   nrama = require('./nrama');\n *   \n * NB: nrama will only work if users accept cookies from all websites (because XDM needed)\n *\n * TODO -- load settings from server for logged-in users\n */\n\n/*\n    This file is part of Note-o-rama.\n\n    Note-o-rama is free software: you can redistribute it and/or modify\n    it under the terms of the GNU General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    Note-o-rama is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with Note-o-rama.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/**\n * Wrapping for both <script> and commonJS require() use\n * Thanks to http://caolanmcmahon.com/posts/writing_for_node_and_the_browser\n * The function may be called with exports undefined to prevent execution (this\n * is to allow checking nrama not already loaded, see below).\n */\n(function(exports){\n    var _NRAMA_LIB_URL = \"http://localhost:5984/nrama/_design/nrama/bkmrklt/lib.min.js\"; //where to load lib from (for bookmarklet only)\n\n    /**\n     * fix uuids so that it doesn't include dashes (no good for couchDB)\n     * also include a trailing N to mark the source\n     */\n    exports._make_uuid = function(uuid) {\n        var new_uuid = function (use_b36/*optional*/){\n            if( use_b36 ) {\n                return parseInt(uuid().replace(/-/g,''), 16).toString(36);\n            } else {\n                return  uuid().replace(/-/g,'')+'N';\n            }\n        }\n        return new_uuid;\n    };\n\n    /**\n     * These are some settings for embedded mode (bkmrklt or <script>).\n     * Others are added during init (see page_id and root_node).\n     * When used on the server, some settings are overriden.\n     */\n    exports._make_settings = function(nrama_uuid){\n        var $ = jQuery;\n        var settings = {\n            // -- internals\n            is_embedded : true,     //set to false when being used on the server\n            debug : true,\n            db_name : 'nrama',\n            //xdm_url: 'http://noteorama.iriscouch.com/_design/nrama/_rewrite/xdm/provider.html',\n            xdm_url : 'http://localhost:5984/nrama/_design/nrama/_rewrite/xdm/provider.html',\n            //xdm_url : 'http://localhost:5984/nrama/_design/nrama/_rewrite/xdm/provider.debug.html',\n            // -- user identification\n            user_id : '*'+nrama_uuid(true).slice(0,10), //default to random anonymous user\n            password : 'new',   //TODO think of clever way to store this\n            me_only : true,    //show only my notes and quotes\n            // -- quotes & note settings\n            note_default_text : 'type now',\n            background_color : '#FCF6CF',   //for quotes\n            background_color_other : 'rgba(240,240,240,0.5)',   //color for other ppl's notes and quotes (TODO)\n            note_background_color : 'rgba(240,240,240,0.9)', \n            persist_started_color : '#FFBF00',  //#FFBF00=orange\n            note_width : 150, //pixels\n            max_quote_length : 5000,  //useful because prevents\n            // -- styling\n            style : {   //applies to note_editor & dialogs\n                fontFamily : \"Palatino, 'Palatino Linotype', Georgia, Times, 'Times New Roman', serif\",\n                fontSize : '12px',\n                color : 'rgb(0,0,0)'\n            },\n            note_style : {\n                'border' : '1px solid',\n                'background-color' : 'rgb(229,229,299)',    //default in case options.note_background_color fails\n                'border-color' : '#CDC0B0',\n                'box-shadow' : '0 0 8px rgba(0,0,0,0.2)',\n                '-moz-box-shadow' : '0 0 8px rgba(0,0,0,0.2)',\n                '-webkit-box-shadow' : '0 0 8px rgba(0,0,0,0.2)',\n                'padding' : '3px',\n                'cursor' : 'move',\n                'height' : 'auto',\n                'z-index' : '9998' //try to ensure always on top\n            },\n            note_inner_style : {},\n            note_editor_style : {\n                'wrap' : 'soft',\n                'padding-left' : '1px',\n                'padding-top' : '1px',\n                'padding-right' : '0px',\n                'padding-bottom' : '0px',\n                'border' : 'none',\n                'resize' : 'none',      //remove draggable resize handle in chrome\n                'line-height' : '1.3em',\n                'background-color' : 'inherit',\n                'text-shadow' : '1px 1px 20px rgba(250,250,250,1), -1px -1px 20px rgba(250,250,250,1), 0 0 1px rgba(250,250,250,1)',\n                '-moz-text-shadow' : '1px 1px 20px rgba(250,250,250,1), -1px -1px 20px rgba(250,250,250,1), 0 0 1px rgba(250,250,250,1)',\n                '-webkit-text-shadow' : '1px 1px 20px rgba(250,250,250,1), -1px -1px 20px rgba(250,250,250,1), 0 0 1px rgba(250,250,250,1)'\n            },\n            simplemodal : {\n                autoResize: true,\n                overlayClose: true,\n                zIndex : 32000,\n                overlayCss : { 'background-color' : '#000' },\n                containerCss : {\n                    height : 'auto',\n                    backgroundColor : '#fff',\n                    border: '8px solid #444',\n                    padding: '12px'\n                },\n                onShow : function(){\n                    _.delay( function() { $('.simplemodal-container').css({height:'auto'}); }, 50 )\n                }\n            }\n        };\n        settings.note_style.width = settings.note_width+\"px\";\n        settings.note_editor_style.width = settings.note_width+\"px\";\n        $.extend(settings.note_editor_style, settings.style);\n        $.extend(settings.simplemodal.containerCss, settings.style);\n        return settings;\n    };\n        \n\n    /**\n     * caution : if settings.debug, this will add to window (if defined)\n     */\n    exports._make_debug = function(settings, window) {\n        var $ = jQuery;\n        var _debug = function(){};    //does nothing if not debugging\n        if( settings.debug && typeof window !== 'undefined' ) {\n            //window.$=jQuery;                        //<-- nb breaks noConflict\n            _debug = function _debug(){\n                var map_or_array = arguments.length == 1 ? arguments[0] : arguments;\n                $.each(map_or_array, function(key,val){\n                        if( isFinite(key) ) {\n                            key = 'a'+key;      //allows us to handle arrays\n                        }\n                        if( typeof $.log === 'function' ) {\n                            $.log('nrama_debug setting '+key+'='+val);\n                            window[key]=val;\n                        }\n                });\n            };\n            //convenience callback for testing async\n            window.cb = function(){ $.log('window.cb called, sending arguments to _debug'); _debug(arguments); }; \n        }\n        return _debug;\n    };\n    \n    /**\n     * caution: extends $\n     */\n    exports._make_logging = function(settings, $) {\n        var logger = function(){ return false; };\n        if( settings.debug ) {\n            logger = function(){\n                // will not log anything unless in debug mode\n                try {\n                    var args = Array.prototype.slice.call(arguments);\n                    $.each(args, function(idx, arg){\n                        console.log(arg);\n                    });\n                    return true;\n                } catch(e) {\n                    return false;\n                }\n            }\n        }\n        $.extend({\"log\":logger});\n        return logger;\n    };\n\n    /**\n     * @returns the rpc transport for xdm \n     */\n    exports._make_rpc = function(settings, easyXDM, $) {\n        var rpc = {};\n        rpc.$ = $;\n        \n        //local functions allow communication from the server to user\n        var local = {};\n        local.get_version = {\n            method : function(success, error){ success(\"0.2\"); }\n        };\n        local.msg = {\n            method : function(message, success, error){\n                if( typeof message === 'string' ) {\n                    alert(message);\n                    success('done');\n                }\n            }\n        };\n        /**\n         * display a dialog using jQuery.simplemodal, minimsing xss vulnerabilities\n         */\n        local.modal = {\n            method : function(div_str, success, error){\n                if( typeof div_str === 'string') {\n                    var $div = rpc.$('<div>'+div_str+'</div>');\n                    rpc.$('#id_ok', $div).click(function () {\n                        rpc.$.modal.close();\n                        success('ok');          //nb this only triggers cb on remote end (no function is passed)\n                    });\n                    $div.beResetCSS().modal(settings.simplemodal);\n                }\n            }\n        };\n        var rpc_names = ['db_saveDoc', 'db_removeDoc', 'db_getView', 'db_doUpdate',\n                         'session_login', 'session_logout', 'session_info'];\n        var remote = { };\n        rpc.$.each(rpc_names, function(idx,name){\n            remote[name] = {};      //create a stub      \n        });\n        if( settings.debug ) {\n            remote.test = {};\n        }\n        \n        var _rpc = new easyXDM.Rpc({ remote:settings.xdm_url },{ remote:remote, local:local });\n        //ideally _rpc would be all we need, but some tweaking is needed ...\n        \n        /**\n         * get rpc to work with kanso.db and kanso.session : callback arguments passed as an array.\n         * (See the corresponding wrappers in xdm/provider.js|html to get full picture.)\n         * wrap_unarray is for undoing the effects of executing callbacks with all parameters\n         * collapsed into an array (easyXDM only allows for callbacks with a single parameter).\n         */\n        var _callback_wrapper = function(fn){\n            return function(){\n                var new_args = arguments[0];\n                fn.apply(null, new_args);\n            }\n        };\n        var _wrap_unarray = function( method ) {\n            return function( ) {\n                var new_arguments = _.map(arguments, function(arg){\n                    if( typeof(arg) == 'function' ) {\n                        return _callback_wrapper(arg);    //wrap because we're putting parameters into array for xdm\n                    }\n                    return arg;\n                });\n                method.apply(null, new_arguments);  \n            }\n        }\n\n        // finally, add the rpc functions\n        rpc.$.each(rpc_names, function(idx,name){\n            rpc[name] = _wrap_unarray( _rpc[name] );      \n        });\n        \n        return rpc;\n    };\n    \n    \n    /**\n     * @return a subset of kanso's db module, same API\n     * Any 403 Forbidden errors will trigger a custom event, 'nrama_403'\n     */\n    exports._make_db = function(rpc, $) {\n        var db = {};\n        db.$ = $;\n        \n        /**\n         * we want to capture 403 (forbidden) errors so that the user can login\n         * caution : assumes last argument is the unique callback (as node js)\n         */\n        var _wrap_403_callback = function( callback ) {\n            return function(error, data) {\n                if( error && ( error.status === 403 || error.error === 'forbidden' ) ) {\n                    var user_id = '';\n                    try {\n                        user_id = error.message.slice(error.message.indexOf('user_id:')+8);\n                    } catch(e) {}\n                    db.$(document).trigger('nrama_403', user_id);\n                }\n                callback(error, data);\n            }\n        };\n        var _wrap_403 = function( fn ) {\n            return function() {\n                var args = Array.prototype.slice.call(arguments);\n                args[args.length-1] = _wrap_403_callback( args[args.length-1] );\n                return fn.apply(null, args);\n            }\n        }\n        db.saveDoc = _wrap_403( rpc.db_saveDoc );\n        db.removeDoc = _wrap_403( rpc.db_removeDoc );\n        db.getView = _wrap_403( rpc.db_getView );\n        db.doUpdate = _wrap_403( rpc.db_doUpdate )\n        \n        return db;\n    };\n\n    /**\n     * @return a subset of kanso's session module, same API\n     */\n    exports._make_session = function(rpc) {\n        return {\n            login : rpc.session_login,\n            logout : rpc.session_logout,\n            info : rpc.session_info \n        };\n    };\n\n\n    /**\n     * @param db{Object} implements (a subset of) kanso's db module\n     * @param session{Object} implements (a subset of) kanso's session module\n     * @param uuid{function} returns a uuid synchroniously\n     */\n    exports._make_persist = function(db, session, uuid, _debug) {\n        persist = {};\n        persist.$ = jQuery;\n\n        //log errors (used to wrap callbacks from db & session)\n        var _debug_wrap = function(name, callback) {\n            return function(error, data){\n                if( error ) {\n                    _debug({msg:'nrama_'+name+': error',error:error});\n                }\n                callback(error, data);\n            }\n        };\n    \n        /**\n         * save a note or a quote (or that JSON.stringify will work on, really).\n         * NB: If successful, will update a _rev property on thing and insert _id\n         * NB: if options.clone_on_conflict, @param thing will have its properties updated  incl. new _id\n         */\n        persist.save = function(thing, options/*optional*/, callback/*required*/ ) {\n            if( !callback ) {\n                callback = options;\n                options = {}\n            }\n            var defaults = {\n                clone_on_conflict : false   //e.g. set to true used when saving notes\n            };\n            var settings = persist.$.extend(true, {}, defaults, options);\n\n            db.saveDoc(thing, function(error, data){\n                if( error ) {\n                    if( settings.clone_on_conflict ) {\n                        if( error.status == 409 || error.error == \"conflict\")  {\n                            persist.$.log('nrama_persist.save: conflict on save for '+(thing.type || '')+' '+thing._id+' --- started cloning');\n                            persist.clone(thing, callback);\n                            return;\n                        }\n                    }\n                    _debug({msg:'nrama_persist.save: error',error:error});\n                } else {\n                    thing._rev = data.rev;\n                    thing._id = data.id;\n                }\n                callback(error, data);\n            });\n        };\n            \n        /**\n         * create and persist a clone of a note or quote, updating the\n         * passed thing in place.\n         */\n        persist.clone = function(thing, callback) {\n            var new_id = uuid();\n            var updates = {\n                _id : new_id,\n                replaces_id : thing._id };\n            var cloned_thing = persist.$.extend(true, {}, thing, updates); \n            delete cloned_thing._rev;  //revision is no longer valid\n            persist.save(cloned_thing, function(error, data){\n                if( !error ) {\n                    thing = cloned_thing;   //messy\n                }\n                callback(error,data);   \n            });\n        };\n\n        /**\n         * assumes that thing.type (e.g. 'source') is the name of the couchdb update function\n         * thing must have .type and ._id attributes\n         */\n        persist.update = function(thing, callback) {\n            db.doUpdate( thing, encodeURIComponent( thing.type ), _debug_wrap('persist.update', callback) );\n        };\n\n        /**\n         * deletes a quote or note from the server providing it has a '_rev' property.\n         * if no _rev property, nothing happens but this is callback'ed as success.\n         *  (we exploit this -- absence of _rev means it's not been persisted)\n         */\n        persist.rm = function(thing, callback) {\n            if( !thing._rev ) {\n                callback(null, { deleted:false, message:'nrama_persist.rm did not delete because '+(thing.type ||'')+' '+(thing._id || '')+' has no _rev'});\n            }\n            db.removeDoc(thing, _debug_wrap('persist.rm',callback));\n        };\n            \n        /**\n         * loads data for a page (e.g. all quotes)\n         * @param options.page_id is the page to load stuff for (required)\n         * @param options.type{String} specifies which type of objects to load (required)\n         * @param options.user_id{String} [optional] omit if loading for all users\n         */\n        persist.load = function(options, callback) {\n            var defaults = {\n                page_id : undefined, type : null, user_id : null,\n                success : null, error : null\n            };\n            var load_settings = persist.$.extend({}, defaults, options);\n            \n            var query;\n            if( !load_settings.type ) {\n                query = {startkey:'[\"'+load_settings.page_id+'\"]', endkey:'[\"'+load_settings.page_id+'\",{}]'};\n            } else { //type is specified\n                if( !load_settings.user_id ) {\n                    query = {\n                        startkey:'[\"'+load_settings.page_id+'\",\"'+load_settings.type+'\"]',\n                        endkey:'[\"'+load_settings.page_id+'\",\"'+load_settings.type+'\",{}]'\n                    };\n                } else {    //type and user_id are specified\n                    query = {key:'[\"'+load_settings.page_id+'\",\"'+load_settings.type+'\",\"'+load_settings.user_id+'\"]' };\n                }\n            }\n            db.getView('pageId_type_userId', query, _debug_wrap('persist.load',callback));\n        };\n    \n        return persist;\n    };\n\n\n    /**\n     * Ways of serializing and restoring rangy range objects.\n     * These would ideally work across browsers; rangy_1_2 claims not to.  \n     * (Having multiple ways allow us to upgrade the method of serialization\n     * while still being able to correctly deserialize quotes created with older\n     * methods.)\n     * @param lib{map} provides rangy\n     */\n    exports._make_serializers = function(settings, lib){\n        var serializers = {\n            rangy_1_2 : {\n                id : 'rangy_1_2',   // id must match the name\n                serialize : function(range) {\n                    // second param means do not compute checksum (because adding highlights to page screws it up)\n                    return lib.rangy.serializeRange(range, true, settings.root_node);\n                },\n                deserialize : function(text) {\n                    return lib.rangy.deserializeRange(text, settings.root_node);\n                }\n            }\n        }\n        serializers.current = serializers.rangy_1_2;   // the serializer to be used in creating new quotes\n        return serializers;\n    };\n\n\n\n    /**\n     * for each page_id with notes, each user must create a source.  \n     *  @param lib{map} provides dependencies : \n     *    - b64_hmac_md5    from md5.js \n     *    - BibtexParser    from bibtex.js\n     *    - $               from jQuery\n     */\n    exports._make_sources = function(settings, persist, _debug, lib/*optional*/) {\n        var sources = {};\n        lib.$.extend(sources, lib); //add lib.b64_hmac_md5 etc to sources\n        \n        /**\n         * @returns the id of a source record for the user and page\n         * @param o{map} should contain user_id and page_id\n         */\n        sources.calculate_id = function(o) {\n            return 'source_'+sources.b64_hmac_md5(o.user_id, o.page_id);\n        };\n        \n        /**\n         * @param attrs must contain page_id & user_id ; can be note or quote\n         */\n        sources.create = function(attrs) {\n            var defaults = {\n                tags : []     //the persist.update will append, not remove tags\n            };\n            if( settings.is_embedded ) {\n                defaults.page_title = document.title;\n                defaults.url = document.location.href;\n            }\n            var source = sources.$.extend(true, defaults, attrs);\n            source._id = sources.calculate_id(source);  //nb must overwrite _id in case called with note or quote object!\n            source.type = 'source';\n            return source;\n        }\n        \n        /**\n         * Create or update a source.\n         * @param source must contain (TITLE or page_title), url, page_id\n         *      & user_id if update is being called to create a new source\n         * Can be called with either a source or a note or a quote\n         * Caution: if called with source, source will be modified in place.\n         */\n        sources.update = function(thing, callback) {\n            var source = ( thing.type == 'source' ? thing : sources.create(thing) );\n            persist.update(source, callback);\n        }\n\n        /**\n         * call update once per source only (but if it fails, will repeat next\n         * time it is called)\n         * can be called with either a source or a note or a quote \n         */\n        var _update_memo = [];\n        sources.update_once = function(thing, callback) {\n            var source_id = ( thing.type == 'source' ? thing._id : thing.source_id );\n            var already_done = ( sources._.indexOf(_update_memo, source_id) != -1 );\n            if( already_done  ) {\n                callback(null, 'already done');\n                return;\n            }\n            sources.update(thing, function(error, data){\n                if(!error){\n                    _update_memo.push(source_id);\n                }\n                callback(error, data);\n            });\n        };\n        \n        /**\n         * This should return an array of strings which canonically represent authors\n         * @param authors{string} is the authors.\n         * TODO: make this work (see js-bibtex?)\n         */\n        var _parse_authors = function( authors/*String*/ ) {\n            _debug({authors:authors});\n            return authors.split(' and ');\n        };\n        /**\n         * quickly attempt to guess whether something is bibtex\n         */\n        // like this: @text { = , }\n        var _bib_rex = /(^|[^0-9A-Z&\\/\\?]+)(@)([0-9A-Z_]*[A-Z_]+[a-z0-9_]*)([\\s\\S]*?{)([\\s\\S]*?=)([\\s\\S]*?,)([\\s\\S]*?})/gi\n        sources.detect_bibtex = function( text ) {\n            return !!( text.match(_bib_rex) );\n        }\n        /**\n         * given a string, attempts to parse it as bibtex and update the source\n         * with the results.\n         * @param thing can be a source, quote or note\n         * E.g.\n         *   b='@incollection{Baillargeon:1995lu,\tAddress = {Oxford},\tAuthor = {Baillargeon, Ren{\\'e}e and Kotovsky, Laura and Needham, Amy},\tBooktitle = {Causal cognition. A multidisciplinary debate},\tDate-Added = {2010-08-04 17:40:21 +0100},\tDate-Modified = {2010-08-04 17:40:38 +0100},\tEditor = {Sperber, Dan and Premack, David},\tPages = {79-115},\tPublisher = {Clarendon},\tTitle = {The Acquisition of Physical Knowledge In Infancy},\tYear = {1995}}'\n         */\n        sources.update_from_bibtex = function(bib_str, thing, callback) {\n            var parser = new sources.BibtexParser();\n            var results;\n            try {\n                parser.setInput(bib_str);\n                parser.bibtex();\n                results = parser.getEntries();\n            } catch(e) {\n                _debug(\"caught error parsing bibtex\",e)\n                callback('error parsing bibtex '+e);\n                return;\n            }\n            if( sources._.size(results) != 1 ) {\n                callback('nrama_sources.parse_bibtex: input contained '+sources._.size(results)+' entries ('+bib_str+')');\n                return;\n            }\n            var entry = sources._.toArray(results)[0];\n            if( entry.AUTHOR ) {\n                entry.AUTHOR_TEXT = entry.AUTHOR;\n                entry.AUTHOR = _parse_authors(entry.AUTHOR_TEXT);\n            }\n            entry.bibtex = bib_str;\n            var source = sources.create(thing);\n            source = sources.$.extend(true, {}, source, entry);\n            sources.update(source, callback);\n        };\n        return sources;\n    };\n    \n    \n    /**\n     * This is only intended to work embedded in a page, not on the server.\n     * lib must include\n            b64_hmac_md5 \n            rangy \n            $ ( jQuery )\n            _ : window._\n     */\n    exports._make_quotes = function(settings, uuid, persist,\n                                    sources, serializers, _debug,\n                                    lib) {\n        var quotes = {};\n        lib.$.extend(quotes, lib);  //add items in lib to quotes\n\n        /**\n         * @returns a hash for determining whether two quotes are the same\n         *     across different users.\n         */\n        quotes.calculate_hash = function(quote) {\n            var hash = quotes.b64_hmac_md5(quote.page_id, quote.content);\n            return hash;\n        };\n            \n        /**\n         * @param range is a Rangy range object\n         */\n        quotes.create = function(range) {\n            var new_quote = {\n                _id : 'q_'+uuid(),  \n                type : 'quote',\n                content : quotes.$.trim( range.toString() ),\n                background_color : settings.background_color,\n                url : document.location.href,\n                page_id : settings.page_id,  \n                page_title : document.title,\n                //the xpointer to the quote (well, it isn't actually an xpointer but  any serialized representation of the raneg)\n                xptr : serializers.current.serialize(range),\n                //the name of the method used to seralise\n                xptr_method : serializers.current.id,\n                page_order : quotes.calculate_page_order(range),\n                created : new Date().getTime(),\n                updated : new Date().getTime(),\n                user_id : settings.user_id\n            };\n            new_quote.hash = quotes.calculate_hash(new_quote);\n            new_quote.source_id = sources.calculate_id({\n                user_id : new_quote.user_id,\n                page_id : new_quote.page_id\n            });\n            return new_quote;\n        };\n        \n        quotes.save = function(quote, options/*optional*/, callback) {\n            if( !callback ) {\n                callback = options;\n                options = {};\n            }\n            //update the source before saving any quotes\n            sources.update_once(quote, function(error, data) {\n                if( error ) {\n                    quotes.$.log('error in nrama_quotes.save is due to call to sources.update_once.')\n                    callback(error, data);\n                    return;\n                }\n                persist.save(quote, options, callback);\n            });\n        },\n        \n        /**\n         * attempt to highlight quote into the HTML document.  May fail if range\n         * cannot be decoded; fails silently.  Nodes added to the DOM will have the\n         * quote object stored with jQuery.data (key:'nrama_quote')\n         *\n         * Checks that quote not already on page; will not re-display if it is.\n         *\n         * depends Rangy + its highlight module\n         *\n         * @returns true if successful (or quote already displayed), false otherwise\n         */\n        quotes.display = function(quote) {\n            if( quotes.$('.'+quote._id).length != 0 ) {\n                return true;  //quote already displayed\n            }\n            var range = quotes.get_range(quote);\n            if( range == null ) {\n                return false;\n            }\n            var _rangy_highlighter = quotes.rangy.createCssClassApplier(\"_nrama-quote \"+quote._id,false);\n            try{\n                _rangy_highlighter.applyToRange(range);\n            } catch(error) { //seems to be rare\n                if( settings.debug ) {\n                    quotes.$.log(\"nrama: error using Randy's createCssClassApplier.applyToRange, re-throwing\");\n                    throw error;\n                } else {\n                    return false;   //silently fail if not in debug mode\n                }\n            }\n            quotes.$('.'+quote._id).css('background-color',quote.background_color).data('nrama_quote',quote);\n            return true;\n        };\n        \n        /**\n         * remove a quote's highlights from the HTML document.\n         * leaves jQuery.data('nrama_quote') and _id as class intact, so quote can\n         *   still be found (todo: not sure this is a good idea!).\n         * todo -- this would ideally remove the elements so that subsequent quotes\n         *  had more reliable xpointers (as long as we don't have a way of getting\n         *  good xpointers).\n         */\n        quotes.undisplay = function(quote) {\n            quotes.$('.'+quote._id).\n                removeClass('_nrama-quote').\n                css({'border-top':'none', 'border-bottom':'none', 'box-shadow':'none'}).\n                //removeClass(quote._id). //not sure whether I want to do this yet\n                css('background-color','red').\n                animate({'background-color':'black'}, function(){\n                    quotes.$(this).css('background-color','inherit');\n                });\n        };\n        \n        quotes.flash = function(quote_id) {\n            var $quote_nodes = quotes.$('.'+quote_id);\n            $quote_nodes.css({'border-top':'1px dashed black',\n                             'border-bottom':'1px dashed black',\n                             'box-shadow':'0 0 20px' + settings.background_color });\n            window.setTimeout(function(){\n                $quote_nodes.css({'border-top':'none', 'border-bottom':'none', 'box-shadow':'none'});            \n            },600);\n        };\n        \n        /**\n         * request quote delete from server and remove from page if successful\n         */\n        quotes.remove = function(quote) {\n            quotes.$('.'+quote._id).css('background-color','orange');\n            persist.rm(quote, function(error, data){\n                if( !error ) {\n                    quotes.undisplay(quote);\n                }\n            });\n        };\n        \n        /**\n         * load quotes from server and display on this page\n         */\n        quotes.load = function(page_id, callback) {\n            var user_id = settings.me_only ? settings.user_id : undefined;\n            persist.load({\n                page_id : page_id,\n                type : 'quote',\n                user_id : user_id\n            }, function(error, data){\n                if( !error && data ) {\n                    quotes.$.log('nrama_quotes.load got ' + ( data.rows ? data.rows.length : 0 ) + ' quotes from server for user '+user_id);\n                    //need to sort quotes by the time they were added to page for best chance of displaying them\n                    var _sorter = function(a,b){ return a.value.created - b.value.created };\n                    data.rows.sort(_sorter);\n                    var _failing_quotes = []\n                    quotes.$.each(data.rows, function(index, row){\n                        var quote = row.value;\n                        var success = quotes.display(quote);  //this won't re-display quotes already present\n                        if( !success ) {\n                            _failing_quotes.push(quote._id);\n                        }\n                    });\n                    if( _failing_quotes.length > 0 ) {\n                        quotes.$.log('failed to display '+_failing_quotes.length+' quotes, _ids: '+_failing_quotes.join('\\n\\t'));\n                    }\n                }\n                callback(error, data);\n           });\n        };\n        \n        /**\n         * @returns the range for the specified quote or null if not possible.\n         * caution: this may fail once the quote has been highlighted!\n         */\n        quotes.get_range = function(quote) {\n            var method = quote.xptr_method || '_method_unspecified'; //method for recovering the range from the quote\n            if( ! (method in serializers) ) {\n                quotes.$.log('unknown xptr_method ('+method+') for quote '+quote._id);\n                return null;\n            }\n            try {\n                var serializer = serializers[method];\n                return serializer.deserialize(quote.xptr);\n            } catch(error) {\n                //quotes.$.log('nrama_quotes.display FAIL with range = '+quote.xptr+'\\n\\t for quote '+quote._id);\n                //_debug({catch_error:error});  //not usually informative\n                return null;\n            }\n        };\n        \n        /**\n         * @returns a quote object (or null if not found)\n         */\n        quotes.get_from_page = function(quote_id) {\n            return quotes.$('.'+quote_id).first().data('nrama_quote') || null;\n        };\n        \n        /**\n         * @param range{Rangy}\n         * @returns an array representing the order this quote probably appears\n         * on the page.  Assumes that earlier in DOM means earlier on screen.\n         * (the alternative would be to use height, but that fails for columns\n         * & varying height)\n         */\n        quotes.calculate_page_order = function calculate_page_order(range) {\n            var doc_height = quotes.$(settings.root_node).height();\n            var doc_width = quotes.$(settings.root_node).width();\n            //todo\n            var node = range.startContainer;\n            var page_order = [range.startOffset];   //create in reverse order, will reverse it\n            while ( node && node != document.body ) {\n                page_order.push(quotes.rangy.dom.getNodeIndex(node, true));\n                node = node.parentNode;\n            }\n            page_order.reverse();\n            return page_order;\n        };\n        \n        /**\n         * calculate the offset (.top, .left) of a quote\n         */\n        quotes.offset = function(quote_id) {\n            return quotes.$('.'+quote_id).first().offset();\n        };\n        \n        return quotes;\n    };\n    \n    \n    /**\n     *  @param quotes can be set to null; if provided it is used to position noes\n     */\n    exports._make_notes = function(settings, uuid, persist,\n                               sources, quotes, _debug) {\n        var notes = {};\n        var $ = jQuery;\n        /**\n         * Create a new note for a specified quote.\n         */\n        notes.create = function(quote){\n            var new_note = {\n                _id : 'n_'+uuid(),  \n                type : 'note',\n                content : settings.note_default_text,\n                quote_id : quote._id,\n                quote_hash : quote.hash,    //can attach to the same quote from other users\n                tags : [],                  //will cache the #s to save us parsing text in creating a view\n                background_color : settings.note_background_color,\n                width : settings.note_width,\n                page_id : quote.page_id,  \n                created : new Date().getTime(),\n                updated : new Date().getTime(),\n                user_id : quote.user_id\n            };\n            new_note.source_id = sources.calculate_id({\n                user_id : new_note.user_id,\n                page_id : new_note.page_id\n            });\n            return new_note;\n        };\n            \n        /**\n         * extract tags from note\n         * losely based on lines 106-7 of https://raw.github.com/bcherry/twitter-text-js/master/twitter-text.js\n         */\n        var _hashtag_regex = /(^|[^0-9A-Z&\\/\\?]+)(#|)([0-9A-Z_]*[A-Z_]+[a-z0-9_]*)/gi;\n        notes.get_tags = function(note) {\n            var tags = [];\n            note.content.replace(_hashtag_regex, function(match, before, hash, hashText) {\n                tags.push(hashText);  \n            });\n            return tags;\n        };\n            \n        notes.save = function(note, options/*optional*/, callback) {\n            if( !callback ) {\n                callback = options;\n                options = {};\n            }\n            //extract and store the tags\n            note.tags = notes.get_tags(note);\n            //update the source before saving any quotes\n            sources.update_once(note, function(error, data) {\n                if( error ) {\n                    $.log('error in nrama_notes.save, due to call to nrama_sources.update_once.')\n                    callback(error, data);\n                } else {\n                    persist.save(note, options, callback);\n                }\n            });\n        };\n            \n        var _zindex_counter = 10000; //used for bringing notes to the front and to ensure new notes are on top\n        notes.bring_to_front = function($note) {\n            $note.css('z-index', _zindex_counter++);  //move note to frong\n        }\n\n        /**\n         * dispaly a note on the page -- i.e. create and style the HTML and add it\n         * to the approriate part of the document (the #_nrama_notes).\n         * If note does not have position info (either because it is newly created,\n         * or because it was created on the server), attempt to position it near the quote.\n         */\n        notes.display = function(note, options) {\n            var options_defaults = {\n                focus : true        //set focus to the note's textarea after creating it?\n            };\n            var display_settings = $.extend(true, {}, options_defaults, options );\n            \n            // --- apply some positioning defaults to notes\n            var note_defaults = {};\n            var viewport_width = $(window).width();\n            //shift quotes horizontally by 1/30 of viewport_width\n            var random_shift = function(){return Math.floor(Math.random()*(viewport_width/30))};\n            var note_right_gap = Math.min(15, viewport_width/65);\n            note_defaults.left = viewport_width - note_right_gap - (note.width || settings.note_width) - random_shift();\n            //to get default for top we need position of associated quote --- only compute this if we really need it\n            if( !note.top ) {\n                var quote_offset = null;\n                if( note.quote_id && quotes ) {\n                    quote_offset = quotes.offset(note.quote_id);    //may return null if can't be computed\n                }\n                if( quote_offset ) {\n                    note_defaults.top = quote_offset.top + random_shift();\n                } else {\n                    note_defaults.top = 0 + random_shift(); //put note at top of screen if can't do better\n                    $.log(\"nrama unable to get default position for note \" + note._id + \" because no quote offset found for quote \" + note.quote_id + \"(has the quote been added to the page?)\");\n                }\n            } \n            note = $.extend(true, {}, note_defaults, note );\n            \n            // -- check the note container div exists, append to document.body if not\n            if( $('#_nrama_notes').length == 0 ) {\n                $('<div id=\"_nrama_notes\"></div>').appendTo('body').\n                    css({position:\"absolute\", left:\"0px\", top:\"0px\",width:\"0%\", height:\"0%\"});\n            }\n\n            // --- start properly here\n            if( $('#'+note._id).length != 0 ) {  \n                notes.undisplay(note); //If note already displayed, undisplay it first.\n            }\n            var pos_attrs = {\n                \"position\":\"absolute\",\n                \"left\":note.left+\"px\",\n                \"top\":note.top+\"px\"\n            };\n            var textarea = $('<textarea></textarea>').\n                                val(note.content).\n                                css(settings.note_editor_style).\n                                one('blur', notes.update_on_blur).  //make sure edits are saved\n                                autogrow();\n            var inner_div = $('<div></div>').css(settings.note_inner_style).\n                                append(textarea);\n            var edit_note = $('<div></div').\n                                attr('id',note._id).\n                                addClass('_nrama-note').\n                                beResetCSS().\n                                css(pos_attrs).\n                                css(settings.note_style).\n                                css('z-index',_zindex_counter++).\n                                css('background-color', note.background_color || settings.note_background_color).\n                                data('nrama_note',note).\n                                append(inner_div).\n                                appendTo('#_nrama_notes').\n                                draggable({ cursor:'move', opacity:0.66, stop:notes.update_on_drag }).\n                                hide().show(\"scale\",{},200, function(){\n                                    if( display_settings.focus ) {\n                                        textarea.focus().select();\n                                    }\n                                }\n                            );\n        };\n            \n        /**\n         * remove HTML node represening note from the page\n         */\n        notes.undisplay = function(note) {\n            $('#'+note._id).remove();\n        };\n\n        // -- call this to re-enable note when error saving or deleting\n        var _finally = function _finally($note, restore_background ){\n            var $textarea = $('textarea', $note);\n            //make changes to textarea possible & ensure they trigger updates\n            $textarea.removeAttr(\"disabled\");\n            $textarea.unbind('blur', notes.update_on_blur).one('blur', notes.update_on_blur);  //make sure edits are saved\n            if( restore_background ) {\n                $textarea.parents('._nrama-note').css({backgroundColor:settings.note_background_color});\n            }\n        };\n        /**\n         * event handler for blur event on TEXTAREA of $note\n         * This handles display, logic & persistence.\n         * if & when successfully persisted, the note is stored as a jquery.data attr\n         * on the $note (key:nrama_note)\n         */\n        notes.update_on_blur = function(e) {\n            var $textarea = $(this);\n            $textarea.unbind('blur', notes.update_on_blur).\n                attr(\"disabled\", \"disabled\");   //disable text area while attempting to persist\n            $note = $textarea.parents('._nrama-note').first();\n            $note.css('background-color', settings.persist_started_color);\n            \n            \n            // -- delete note if note content is empty\n            var new_content = $textarea.val();\n            if( $.trim(new_content) == '' ) {\n                $.log(\"nrama_notes.update -- deleting note \"+$note.attr('id'));\n                notes.remove($note); \n                return;\n            }\n            \n            var note = $note.data('nrama_note');\n            \n            // -- if content unchanged, do nothing (so moving a note won't trigger a change)\n            var old_content = note.content;\n            if( old_content == new_content ) {\n                _finally($note, true);\n                return;\n            }\n    \n            var updates = {\n                content : new_content,\n                updated : new Date().getTime()\n            };\n            if( settings.is_embedded ) {\n                $.extend(updates, {\n                    background_color : settings.note_background_color,\n                    left : $note.offset().left,\n                    top : $note.offset().top,\n                    doc_height : $(document).height(),\n                    doc_width : $(document).width()\n                });\n            }\n            var new_note = $.extend(true, {}, note, updates);   \n            \n            notes.save(new_note, {clone_on_conflict:true}, function(error,data){\n                if( error ) {\n                    $note.css({backgroundColor : settings.persist_failed_color});\n                    _finally($note, false);\n                } else {\n                    //$.log(\"nrama_notes.update_on_blur: was persisted note _id:\"+new_note._id+\" for quote:\"+new_note.quote_id);\n                    $note.attr('id',new_note._id); //may have changed (save can clone)\n                    $note = $('#'+new_note._id);   //have to update after changing id attribute\n                    $note.data('nrama_note', new_note);\n                    //check for bibtex (do this after save to avoid conflicts)\n                    if( sources.detect_bibtex(new_note.content) ) {\n                        sources.update_from_bibtex(new_note.content, new_note, function(error, data){\n                            if( !error ) {\n                                $('#'+note._id).css({border:'1px solid #01DF01'})\n                            }\n                            _finally( $note, true );\n                        });\n                    } else {\n                        _finally( $note, true );\n                    }\n                }\n            });\n        };\n            \n        notes.update_on_drag = function(e) {\n            var $textarea = $('textarea', $(this) ).first();\n            if( $textarea.attr('disabled') ) {\n                $.log('nrama_notes.update_on_drag: save currently in progress');\n                return;\n            }\n            $.log(\"nrama_notes.update_on_drag starting\");\n            $textarea.attr('disabled','disabled');\n            var $note =  $(this);\n            var note = $note.data('nrama_note');\n            var updates = {\n                left : $note.offset().left,\n                top : $note.offset().top,\n                doc_height : $(document).height(),\n                doc_width : $(document).width()\n            };\n            note = $.extend(true, note, updates);   \n            notes.save(note, {clone_on_conflict:false}, function(error, data){\n                //errors are ignored -- note location not critical\n                $textarea.removeAttr('disabled');\n            });\n        };\n        \n        /**\n         * request delete from server & remove from document if succeeds\n         */\n        notes.remove = function($note) {\n            var note_id = $note.attr('id');\n            $note.css('background-color','red');\n            var note = $note.data('nrama_note');\n            persist.rm(note, function(error, data){\n                if( error ) {\n                    _finally($note, false);\n                } else {\n                    $.log(\"nrama_notes.remove deleted note \"+note_id+\" from server.\");\n                    $('#'+note_id).hide('puff',{},300+Math.floor(Math.random()*600), function(){\n                        $('#'+note_id).remove();\n                    });\n                }\n            });\n        };\n    \n        /**\n         * load notes from server and display on this page\n         * run after quotes have been loaded and displayed in case notes need positioning\n         */\n        notes.load = function(page_id, callback) {\n            var user_id = settings.me_only ? settings.user_id : undefined;\n            persist.load({\n                page_id : page_id,\n                type : 'note',\n                user_id : user_id\n            }, function(error, data){\n                if( error ) {\n                    _debug({msg:'nrama_notes.load error:', error:error})\n                    callback(error, data);\n                    return;\n                }\n                $.log('nrama_notes.load got ' + ( data ? (data.rows ? data.rows.length : 0 ) : 0) + ' notes from server for user '+user_id);\n                if( data && data.rows ) {\n                    $.each(data.rows, function(index,row){\n                        var note = row.value;\n                        notes.display(note, {focus:false});\n                    });\n                }\n                callback(error, data);\n            });\n        };\n            \n        /**\n         * @returns _ids of notes if @param quote has notes attached\n         */\n        notes.find = function(quote) {\n            var _ids = [];\n            $('._nrama-note').each(function(){\n                var rel_quote_id = $(this).data('nrama_note').quote_id;\n                if( rel_quote_id == quote._id ) {\n                    _ids.push($(this).attr('id'));  //add _id of the note to the list\n                }\n            });\n            return _ids;\n        };\n        \n        return notes;\n    };\n    \n    \n    \n    \n    /**\n     * for dialogs (todo -- move event handlers)\n     */\n    exports._make_ui = function(settings, session, _debug){\n        var $ = jQuery;\n        var ui = {};\n        \n        var _update_user_id = function(data) {\n            if( data && data.userCtx && data.userCtx.name ) {\n                var logged_in_as = data.userCtx.name;\n                if( logged_in_as != settings.user_id ) {\n                    //username has changed\n                    ui.dialogs.warn_user_discrepancy(logged_in_as);\n                    settings.user_id = logged_in_as;\n                }\n            }\n        };\n        /** \n         * may update settings.user_id.  may result in modal dialog warning\n         */\n        ui.info = function(callback){\n            session.info(function(error, data){\n                if( !error ) {\n                    _update_user_id(data);\n                }\n                callback(error,data);\n            });\n        };\n        /**\n         * may update settings.user_id.  may result in modal dialog warning\n         */\n        ui.login = function(username, password, callback){\n            session.login(username, password, function(error,data){\n                if( !error ) {\n                    _update_user_id(data);\n                }\n                callback(error,data);\n            });\n        };\n\n\n        ui.dialogs = {};\n        /**\n         * switch user_id if logged in; otherwise check whether configured for\n         * anonymous user and request user to log in if not.\n         */\n        ui.dialogs.login_if_necessary = function(callback) {\n            ui.info( function(error,data) {\n                if( data && data.userCtx && data.userCtx.name ) {\n                    callback(null, 'already logged in');\n                } else {\n                    //not logged in\n                    if( settings.user_id && settings.user_id[0] == '*' ) {\n                        //anonymous\n                        callback(null, 'anonymous user');\n                    } else {\n                        ui.dialogs.login(settings.user_id, callback);\n                    }\n                }\n            });\n        };\n        \n        /**\n         * dispaly a login dialog.\n         * @param callback{Function} will be called with an error if the user cancels.\n         */\n        ui.dialogs.login = function(username, msg/*optional*/, callback) {\n            if( !callback ) {\n                callback = msg;\n                msg = '';\n            }\n            var last_error = {message:'you cancelled'};  //report results of last error if user cancels\n            var $div = $('<div><h2><a href=\"http://www.note-o-rama.com\" target=\"_blank\">Note-o-rama</a> : login</h2></div>');\n            $div.append('<form id=\"login_form\" action=\"/_session\" method=\"POST\">' +\n                '<div class=\"general_errors\">'+msg+'</div>' +\n                '<div class=\"username field\">' +\n                    '<label for=\"id_name\">Username</label>' +\n                    '<input id=\"id_name\" name=\"name\" type=\"text\" />' +\n                    '<div class=\"errors\">&nbsp;</div>' +\n                '</div>' +\n                '<div class=\"password field\">' +\n                    '<label for=\"id_password\">Password</label>' +\n                    '<input id=\"id_password\" name=\"password\" type=\"password\" />' +\n                    '<div class=\"errors\">&nbsp;</div>' +\n                '</div>' +\n                '<div class=\"actions\">' +\n                    '<input type=\"button\" id=\"id_cancel\" value=\"Cancel\" />' +\n                    '<input type=\"submit\" id=\"id_login\" value=\"Login\" />' +\n                '</div>' +\n            '</form>');\n            $div.beResetCSS();\n            $('.general_errors, .errors', $div).css({color:'red'});\n            $('#id_name',$div).val(username||'');\n            $('#id_cancel', $div).click(function () {\n                $.modal.close();\n                callback(last_error);\n            });\n            $('form', $div).submit(function (ev) {\n                ev.preventDefault();\n                var username = $('input[name=\"name\"]', $div).val();\n                var password = $('input[name=\"password\"]', $div).val();\n                $('.username .errors', $div).text(\n                    username ? '': 'Please enter a username'\n                );\n                $('.password .errors', $div).text(\n                    password ? '': 'Please enter a password'\n                );\n                if (username && password) {\n                    ui.login(username, password, function (error, data) {\n                        _debug({error:error});\n                        if( error ) {\n                            last_error = error;\n                            var error_msg = error.message || \"Error \"+(error.status || '')+\" logging in (network connection?)\";\n                            $('.general_errors', $div).text(error_msg);\n                        } else {\n                            $($div).fadeOut('slow', function () {\n                                $.modal.close();\n                                callback(null, data);\n                            });\n                        }\n                    });\n                }\n                return false;\n            });\n            $div.modal(settings.simplemodal);\n            _.delay( function(){\n                if( username ) {\n                    $('#id_password').focus();\n                }\n            }, 50 );\n        };\n        \n        ui.dialogs.warn_user_discrepancy = function(name, callback) {\n            if( !callback ) { callback = function(){}; }\n            var who = settings.user_id[0]=='*' ? 'anonymous users' : settings.user_id;\n            $.log('user logged in as '+name+' but this bookmarklet was configured for '+who );\n            callback(null, 'not implemented yet');\n        };\n        return ui;\n    };\n\n\n    /**\n     * put nrama together when used as bkmrklt or embedded <script>\n     * (see nrama2_init.js for the corresponing init for the server parts)\n     * caution: some init requires page load to be complete\n     * @param callback{Function} is called when init done.\n     */\n    var _nrama_init = function(nrama, jQuery, callback) {\n        nrama.$ = jQuery;\n\n        nrama.uuid = exports._make_uuid(uuid);\n\n        nrama.settings = exports._make_settings(nrama.uuid);\n        //detect user if set by bkmrklt or script (will be overriden by session cookies)\n        if( typeof _nrama_user !== 'undefined' && _nrama_user ) {\n            nrama.settings.user_id = _nrama_user;\n        }\n\n        nrama._debug = exports._make_debug(nrama.settings, window);\n        nrama.log = exports._make_logging(nrama.settings, nrama.$);\n        nrama.rpc = exports._make_rpc(nrama.settings, easyXDM, nrama.$);\n        nrama.db = exports._make_db(nrama.rpc, nrama.$);\n        nrama.session = exports._make_session(nrama.rpc);\n        nrama.persist = exports._make_persist(nrama.db, nrama.session, nrama.uuid, nrama._debug);\n        \n        var lib = {\n            b64_hmac_md5 : window.b64_hmac_md5,\n            rangy : window.rangy,\n            BibtexParser : window.BibtexParser,\n            $ : jQuery,\n            _ : window._\n        };\n        nrama.serializers = exports._make_serializers(nrama.settings, lib);\n        nrama.sources = exports._make_sources(nrama.settings, nrama.persist, nrama._debug, lib);\n        nrama.quotes = exports._make_quotes(nrama.settings, nrama.uuid, nrama.persist,\n                                            nrama.sources, nrama.serializers, nrama._debug,\n                                            lib);\n        nrama.notes = exports._make_notes(nrama.settings, nrama.uuid, nrama.persist,\n                                          nrama.sources, nrama.quotes, nrama._debug);\n        nrama.ui = exports._make_ui(nrama.settings, nrama.session, nrama._debug);\n\n        /**\n         * main setup:\n         *  - init dependencies & nrama\n         *  - load notes & quotes;\n         *  - configure events (select to create quote, etc)\n         */\n        nrama.$(document).ready(function(){\n            /**\n             * nrama.settings.page_id is a value s.t. two page instances have the same page_id exactly\n             *   when we want to load the same notes & quotes onto those pages.  This is really\n             *   hard to compute (e.g. DOI helps but if different users see an article with\n             *   different formatting, should we load the same notes & quotes?  Probably.)\n             * In future this might be doi or similar\n             */\n            nrama.settings.page_id = window.location.protocol+\"//\"+window.location.host+window.location.pathname;  //the url with no ?query or #anchor details\n            //remove trailing slash\n            var last = nrama.settings.page_id.length-1;\n            if( nrama.settings.page_id[last]=='/' ) {\n                nrama.settings.page_id = nrama.settings.page_id.slice(0,last);\n            }\n            \n            /**\n             * this is the node within which notes and quotes are possible and\n             * relative to which their locations are defined.\n             * Might eventually be configured per-site\n             */\n            //nrama.settings.root_node = nrama.$('#readOverlay')[0]; \n            nrama.settings.root_node = document.body;\n    \n            rangy.init();\n    \n            nrama.$.log('nrama: starting ...');\n            nrama.ui.dialogs.login_if_necessary(function(error, ignore){\n                if( error ) {\n                    nrama._debug({msg:'error logging in',error:error});\n                } else {\n                    //_.defer means wait until callstack cleared\n                    _.defer(nrama.quotes.load, nrama.settings.page_id, function(error, data){\n                        _.defer(nrama.notes.load, nrama.settings.page_id, nrama._debug );\n                    });\n                }\n            });\n            \n            // --- configure events ---\n            \n            // deal with 403 Forbidden events (session expires, etc)\n            nrama.$(document).bind('nrama_403', function(e, user_id){\n                nrama.ui.dialogs.login(user_id, 'Please login and re-try.', nrama._debug);\n            });\n            \n            //throttle2 is like _.throttle(fn) but this calls fn BEFORE timout\n            var throttle2 = function(func) {\n                var timeout;\n                return function() {\n                    var context = this,\n                        args = arguments;\n                    var reset_timeout = function() {\n                        timeout = null;\n                    };\n                    if( !timeout ) {\n                        timeout = setTimeout(reset_timeout, nrama.settings.event_delay);\n                        func.apply(context, args);\n                    }\n                };\n            };\n            \n            // highlighting text creates a quote\n            var create_quote_from_selection = function(e){\n                if( e.shiftKey || e.ctrlKey || e.altKey || e.metaKey) {\n                    //any modifier key cancels quote creation\n                    return;\n                }\n                //nrama.$.log(\"nrama2 caught mouse up\");\n                var selection = rangy.getSelection();\n                if( selection.isCollapsed ) {\n                    return;\n                }\n                var range = selection.getRangeAt(0);\n                //check that not too much text has been selected (avoid accidental selecting loads of doc)\n                if( nrama.settings.max_quote_length > 0 ) {\n                    if( range.toString().length > nrama.settings.max_quote_length ){\n                        nrama.$.log('nrama no quote -- ' + range.toString().length + ' characters selected.');\n                        return;\n                    }\n                }\n                var quote = nrama.quotes.create(range);\n                if( quote.content != '' ) {\n                    nrama.quotes.save(quote, function(error, data){\n                        //(todo -- some indicate that it has failed?\n                        if( !error ) {\n                            nrama.quotes.display(quote);   //display the quote only after it has been saved\n                        }\n                    });\n                    nrama._debug((function(){ var a={}; a[quote._id]=quote; return a; })()); \n                }\n            };\n            nrama.$(document).bind(\"mouseup\", throttle2(create_quote_from_selection) );\n            \n            //click a quote to create a note\n            var create_note_from_quote_click = function(e){\n                if( e.shiftKey || e.ctrlKey ) {\n                    //shift key cancels notecreation, so does ctrl\n                    return;\n                }\n                if( e.altKey || e.metaKey ) {\n                    //alt key causes quote deletion (in separate handler)\n                    return;\n                }   \n                var quote = nrama.$(this).data('nrama_quote');\n                var note = nrama.notes.create(quote);\n                nrama.notes.display(note);\n            };\n            nrama.$('._nrama-quote').live('click', throttle2(create_note_from_quote_click) );\n            \n            // alt- or meta-click a quote to delete it (after checking there are no linked notes)\n            nrama.$('._nrama-quote').live('click', function(e){\n                if( e.altKey || e.metaKey ) {\n                    var quote = nrama.$(this).data('nrama_quote');\n                    var note_ids = nrama.notes.find(quote);\n                    if( note_ids.length != 0 ) {\n                        //don't delete quotes with notes attached ...\n                        var $quote_nodes = nrama.$('.'+quote._id);\n                        $quote_nodes.css({'border-top':'1px dashed red',\n                                         'border-bottom':'1px dashed red'})\n                        //... instead make the relevant notes bounce\n                        var idstr = '#' + note_ids.join(', #');\n                        nrama.$(idstr).effect('bounce', function(){\n                            $quote_nodes.css({'border-top':'none',\n                                             'border-bottom':'none'},500)\n                        });\n                        return;\n                    }\n                    nrama.quotes.remove(quote);\n                }\n            });\n        \n            //click on a note to enable editing, bring it to the front and flash the associated quote\n            nrama.$('._nrama-note textarea').live('click',function(e){\n                var $textarea = nrama.$(this);\n                var $note = nrama.$(this).parents('._nrama-note').first();\n                nrama.notes.bring_to_front($note);\n                var note= $note.data('nrama_note');\n                nrama.quotes.flash(note.quote_id);\n            });\n            \n            //tabbing out of a note doesn't move to next note (because weird).\n            //thank you http://stackoverflow.com/questions/1314450/jquery-how-to-capture-the-tab-keypress-within-a-textbox\n            nrama.$('._nrama-note').live('keydown',function(e){\n                if( e.which == 9 ) {\n                    nrama.$('textarea', this).blur();\n                    e.preventDefault();\n                }\n            });\n            \n            // === init done\n            callback();\n        });\n    }\n    \n    /**\n     * IT ALL STARTS HERE\n     * Determine how to initialize depending on whether bookmarklet or embedded in page\n     */\n    if( typeof exports !== 'undefined' ) {    //exports undefined means nrama is already loaded -- bookmarklet may be called more than once)\n\n        if( typeof _nrama_bkmklt === 'undefined' && typeof require !== 'undefined' ) {\n            //this script is being used as a commonJS module\n            //already defined exports; initialisation is handled in another module.\n        } else {\n            if( typeof _nrama_bkmklt === 'undefined' || !_nrama_bkmklt ) {\n                //run as embedded <script> \n                _nrama_init(exports, jQuery, function(){\n                    exports._initalized = true;\n                });\n            } else {\n                // run in bookmarklet mode\n                // first remove head -- for some reason this seems to help avoid clashes in FF\n                var old_head = document.head.innerHTML;\n                var restore_document_head = function(){\n                    document.head.innerHTML = old_head;\n                }; \n                try {\n                    document.head.innerHTML = '';\n                } catch(e) {\n                    //alt. method -- can't set innerHTML with safari (others?)\n                    var head = document.head;\n                    var children = [];\n                    while(head.firstChild){\n                        var child = head.firstChild;\n                        if( child.nodeName !== 'SCRIPT' ) {\n                            children.push( child );\n                        }\n                        head.removeChild( child )\n                    }\n                    restore_document_head = function(){\n                        while( children.length ) {\n                            head.appendChild( children.pop() );\n                        }\n                    }\n                }\n     \n                // load libraries & only start work after they loaded\n                // adapted from jQuery ajaxTransport, thank you also http://stackoverflow.com/questions/756382/bookmarklet-wait-until-javascript-is-loaded\n                var loadScript2 = function(url, callback) {\n                    var head = document.head || document.getElementsByTagName( \"head\" )[0] || document.documentElement;\n                    var script = document.createElement( \"script\" );\n                    //script.charset = set this?$\n                    script.src = url;\n                    script.onload = script.onreadystatechange = function( _, isAbort ) {\n                        if ( isAbort || !script.readyState || /loaded|complete/.test( script.readyState ) ) {\n                            // Handle memory leak in IE\n                            script.onload = script.onreadystatechange = null;\n                            // Remove the script\n                            if ( head && script.parentNode ) {\n                                head.removeChild( script );\n                            }\n                            // Dereference the script\n                            script = undefined;\n                            if ( !isAbort ) {\n                                callback( 200, \"success\" );\n                            }\n                        }\n                    };\n                    // Use insertBefore instead of appendChild  to circumvent an IE6 bug.\n                    head.insertBefore( script, head.firstChild );\n                }\n                loadScript2(_NRAMA_LIB_URL, function() {\n                    jQuery.noConflict();\n                    _nrama_init(exports, jQuery, function(){\n                        restore_document_head();\n                        exports._initalized = true;\n                    });\n                });\n            }\n        }\n    }\n// if exports is not defined, or if _nrama_bkmklt exists, attach everything to this.nrama\n//     but if nrama is already defined, do nothing (send undefined)\n// otherwise behave as a commonJS module\n})(\n    ( typeof exports !== 'undefined' && typeof _nrama_bkmklt === 'undefined' ) ?\n        exports\n    :(\n        ( typeof nrama === 'undefined' || !nrama._initalized ) ?\n            nrama={}\n        :\n            undefined   //prevent execution if nrama already defined\n    )\n);   "
    },
    "_attachments": {
        "xdm/db.ex-kanso.js": {
            "content_type": "application/javascript",
            "data": "LypnbG9iYWwgJDogZmFsc2UsIGthbnNvOiB0cnVlICovCgovKioKICogbW9kaWZpZWQgdG8gdXNlIGluZGVwZW5kZW50bHkgb2Yga2Fuc28uCiAqIGFkZGVkIGRvVXBkYXRlIGZvciB1cGRhdGVzIChvbmx5IHBhcnRpYWxseSBpbXBsZW1lbnRlZCwgY3VycmVudGx5IGEgbmFzdHkgaGFjaykKICoKICogTkI6IGJlZm9yZSB1c2luZyBiZSBzdXJlIHRvIGRlZmluZToKICogIC0gc2V0dGluZ3MuZGJfbmFtZQogKiAgLSBzZXR0aW5ncy5hcHBfbmFtZQogKiAgCiAqIGNvbnZlcnRlZCBmcm9tIENvbW1vbkpTIHRvIG9yZGluYXJ5LCBlbWJlZGRhYmxlIEpTOgogKiAgZXhwb3J0cyBiZWNvbWVzIGRiCiAqCiAqIGRlcGVuZHM6CiAqICAtIHNlc3Npb24ubnJhbWEuanMgKGdsb2JhbDogJ3Nlc3Npb24nKQogKiAgLSBqUXVlcnkgKGZvciAkLmFqYXgpCiAqCiAqIENvbnRhaW5zIGZ1bmN0aW9ucyBmb3IgcXVlcnlpbmcgYW5kIHN0b3JpbmcgZGF0YSBpbiBDb3VjaERCLgogKgogKiBAbW9kdWxlCiAqLwoKLyoqCiAqIE5COiBkbyBzb21ldGhpbmcgbGlrZSB0aGlzIGJlZm9yZSB1c2luZyBkYi5ucmFtYS5qcwogKgpzZXR0aW5ncyA9IHsKICAgIGRiX25hbWUgOiAnbnJhbWEnLCAgICAgICAgIC8vIDwtLSBOQiwgc2V0IHRoaXMgKHNhbWUgYXMgJ25hbWUnIGluIGthbnNvLmpzb24gaW4gdGhlIHJvb3Qgb2YgeW91ciBwcm9qZWN0KQogICAgYXBwX25hbWUgOiAnbnJhbWEnCn0KKi8KCgovKioKICogTW9kdWxlIGRlcGVuZGVuY2llcwogKiAtLS0gd2UnbGwgZmFrZSB0aGVzZSAtLS0KICogCnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMnKSwKICAgIHNldHRpbmdzID0gcmVxdWlyZSgnLi9zZXR0aW5ncycpLAogICAgc2Vzc2lvbiA9IG51bGw7CiAqLwoKLyogQXZvaWQgYSBjaXJjdWxhciByZXF1aXJlIGluIENvdWNoREIgKi8KLyoKaWYgKHV0aWxzLmlzQnJvd3NlcikgewogICAgc2Vzc2lvbiA9IHJlcXVpcmUoJy4vc2Vzc2lvbicpOyAgICAgLy9UaGlzIElTIG5lZWRlZCwgdXNlIHNlc3Npb24ubnJhbWEuanMKfQoqLwoKLy8gVGhpcyBpcyBubyBsb25nZXIgQ29tbW9uSlMKZGIgPSB7fTsKKGZ1bmN0aW9uKGV4cG9ydHMpIHsKICAgIAogICAgLyoqCiAgICAgKiBhZGRlZCBmb3IgZXgta2Fuc28gOiBmYWtlIHRoZSBwYXJ0cyBvZiBrYW5zby91dGlscyB0aGF0IHdlIG5lZWQKICAgICAqLyAKICAgIHV0aWxzID0gewogICAgICAgIGlzQnJvd3NlciA6IGZ1bmN0aW9uKCl7IHJldHVybiB0cnVlOyB9LAogICAgICAgIGdldEJhc2VVUkwgOiBmdW5jdGlvbigpeyByZXR1cm4gc2V0dGluZ3MuYmFzZVVSTDsgfSAgCiAgICB9OwoKICAgIC8qKgogICAgICogV2hlbiBhIGRiIGNhbGwgcmVzdWx0cyBpbiBhbiB1bmF1dGhvcml6ZWQgcmVzcG9uc2UsIHRoZSB1c2VyJ3Mgc2Vzc2lvbiBpcwogICAgICogY2hlY2tlZCB0byBzZWUgaWYgdGhlaXIgc2Vzc2lvbiBoYXMgdGltZWQgb3V0IG9yIHRoZXkndmUgbG9nZ2VkIG91dCBpbgogICAgICogYW5vdGhlciBzY3JlZW4uCiAgICAgKgogICAgICogVGhpcyBjaGVjayBpcyB0aHJvdHRsZWQgdG8gb25jZSBwZXIgc2Vjb25kLCB0byBhdm9pZCBmbG9vZGluZyB0aGUgc2VydmVyIGlmCiAgICAgKiBtdWx0aXBsZSByZXF1ZXN0cyBhcmUgbWFkZSB3aXRoIGluY29ycmVjdCBwZXJtaXNzaW9ucy4KICAgICAqLwogICAgCiAgICB2YXIgbGFzdF9zZXNzaW9uX2NoZWNrID0gMDsKICAgIAogICAgCiAgICAvKioKICAgICAqIENhY2hlIGZvciBkZXNpZ24gZG9jdW1lbnRzIGZldGNoZWQgdmlhIGdldERlc2lnbkRvYy4KICAgICAqLwogICAgCiAgICBleHBvcnRzLmRlc2lnbl9kb2NzID0ge307CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBUYWtlbiBmcm9tIGpRdWVyeSAxLjQuNCBzbyB3ZSBjYW4gc3VwcG9ydCBtb3JlIHJlY2VudCB2ZXJzaW9ucyBvZiBqUXVlcnkuCiAgICAgKi8KICAgIAogICAgdmFyIGh0dHBEYXRhID0gZnVuY3Rpb24gKHhociwgdHlwZSwgcykgewogICAgICAgIHZhciBjdCA9IHhoci5nZXRSZXNwb25zZUhlYWRlcigiY29udGVudC10eXBlIikgfHwgIiIsCiAgICAgICAgICAgIHhtbCA9IHR5cGUgPT09ICJ4bWwiIHx8ICF0eXBlICYmIGN0LmluZGV4T2YoInhtbCIpID49IDAsCiAgICAgICAgICAgIGRhdGEgPSB4bWwgPyB4aHIucmVzcG9uc2VYTUwgOiB4aHIucmVzcG9uc2VUZXh0OwogICAgCiAgICAgICAgaWYgKHhtbCAmJiBkYXRhLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSA9PT0gInBhcnNlcmVycm9yIikgewogICAgICAgICAgICAkLmVycm9yKCJwYXJzZXJlcnJvciIpOwogICAgICAgIH0KICAgICAgICBpZiAocyAmJiBzLmRhdGFGaWx0ZXIpIHsKICAgICAgICAgICAgZGF0YSA9IHMuZGF0YUZpbHRlcihkYXRhLCB0eXBlKTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAic3RyaW5nIikgewogICAgICAgICAgICBpZiAodHlwZSA9PT0gImpzb24iIHx8ICF0eXBlICYmIGN0LmluZGV4T2YoImpzb24iKSA+PSAwKSB7CiAgICAgICAgICAgICAgICBkYXRhID0gJC5wYXJzZUpTT04oZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gInNjcmlwdCIgfHwgIXR5cGUgJiYgY3QuaW5kZXhPZigiamF2YXNjcmlwdCIpID49IDApIHsKICAgICAgICAgICAgICAgICQuZ2xvYmFsRXZhbChkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZGF0YTsKICAgIH07CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgZnVuY3Rpb24gZm9yIGhhbmRsaW5nIGFqYXggcmVzcG9uc2VkIGZyb20ganF1ZXJ5IGFuZCBjYWxscwogICAgICogdGhlIGNhbGxiYWNrIHdpdGggdGhlIGRhdGEgb3IgYXBwcm9wcmlhdGUgZXJyb3IuCiAgICAgKgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqIEBhcGkgcHJpdmF0ZQogICAgICovCiAgICAKICAgIGZ1bmN0aW9uIG9uQ29tcGxldGUob3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHJlcSkgewogICAgICAgICAgICB2YXIgcmVzcDsKICAgICAgICAgICAgdmFyIGN0eXBlID0gcmVxLmdldFJlc3BvbnNlSGVhZGVyKCdDb250ZW50LVR5cGUnKTsKICAgICAgICAgICAgaWYgKGN0eXBlID09PSAnYXBwbGljYXRpb24vanNvbicgfHwgY3R5cGUgPT09ICd0ZXh0L2pzb24nKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJlc3AgPSBodHRwRGF0YShyZXEsICJqc29uIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmV4cGVjdF9qc29uKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgRXJyb3IoJ0V4cGVjdGVkIEpTT04gcmVzcG9uc2UsIGdvdCAnICsgY3R5cGUpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3AgPSByZXEucmVzcG9uc2VUZXh0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXEuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgICAgIC8vIHJldHVybmVkICdVbmF1dGhvcml6ZWQnLCBjaGVjayB0aGUgdXNlcidzIHNlc3Npb24gaWYgaXQncyBub3QKICAgICAgICAgICAgICAgIC8vIGJlZW4gY2hlY2tlZCBvbiBhbiAnVW5hdXRob3JpemVkJyByZXBzb25zZSBpbiB0aGUgbGFzdCBzZWNvbmQKICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uICYmIGxhc3Rfc2Vzc2lvbl9jaGVjayA8IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gMTAwMCkgewogICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaW5mbygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXEuc3RhdHVzID09PSAyMDAgfHwgcmVxLnN0YXR1cyA9PT0gMjAxIHx8IHJlcS5zdGF0dXMgPT09IDIwMikgewogICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzcCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAocmVzcC5lcnJvcikgewogICAgICAgICAgICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcihyZXNwLnJlYXNvbiB8fCByZXNwLmVycm9yKTsKICAgICAgICAgICAgICAgIGVyci5lcnJvciA9IHJlc3AuZXJyb3I7CiAgICAgICAgICAgICAgICBlcnIucmVhc29uID0gcmVzcC5yZWFzb247CiAgICAgICAgICAgICAgICBlcnIuc3RhdHVzID0gcmVxLnN0YXR1czsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBUT0RPOiBtYXAgc3RhdHVzIGNvZGUgdG8gbWVhbmluZ2Z1bCBlcnJvciBtZXNzYWdlCiAgICAgICAgICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoJ1JldHVybmVkIHN0YXR1cyBjb2RlOiAnICsgcmVxLnN0YXR1cykpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBFbmNvZGVzIGEgZG9jdW1lbnQgaWQgb3IgdmlldywgbGlzdCBvciBzaG93IG5hbWUuCiAgICAgKgogICAgICogQG5hbWUgZW5jb2RlKHN0cikKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHIKICAgICAqIEByZXR1cm5zIHtTdHJpbmd9CiAgICAgKiBAYXBpIHB1YmxpYwogICAgICovCiAgICAKICAgIGV4cG9ydHMuZW5jb2RlID0gZnVuY3Rpb24gKHN0cikgewogICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoc3RyKS5yZXBsYWNlKC9eX2Rlc2lnbiUyRi8sICdfZGVzaWduLycpOwogICAgfTsKICAgIAogICAgCiAgICAvKioKICAgICAqIE1ha2UgYSByZXF1ZXN0LCB3aXRoIHNvbWUgZGVmYXVsdCBzZXR0aW5ncyBhbmQgcHJvcGVyIGNhbGxiYWNrCiAgICAgKiBoYW5kbGluZy4gVXNlZCBiZWhpbmQtdGhlLXNjZW5lcyBieSBtb3N0IG90aGVyIERCIG1vZHVsZSBmdW5jdGlvbnMuCiAgICAgKgogICAgICogQG5hbWUgcmVxdWVzdChvcHRpb25zLCBjYWxsYmFjaykKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICogQGFwaSBwdWJsaWMKICAgICAqLwogICAgCiAgICBleHBvcnRzLnJlcXVlc3QgPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICBvcHRpb25zLmNvbXBsZXRlID0gb25Db21wbGV0ZShvcHRpb25zLCBjYWxsYmFjayk7CiAgICAgICAgb3B0aW9ucy5kYXRhVHlwZSA9ICdqc29uJzsKICAgICAgICAkLmFqYXgob3B0aW9ucyk7CiAgICB9OwogICAgCiAgICAKICAgIC8qKgogICAgICogRmV0Y2hlcyBhIHJld3JpdGUgZnJvbSB0aGUgZGF0YWJhc2UgdGhlIGFwcCBpcyBydW5uaW5nIG9uLiBSZXN1bHRzCiAgICAgKiBhcmUgcGFzc2VkIHRvIHRoZSBjYWxsYmFjaywgd2l0aCB0aGUgZmlyc3QgYXJndW1lbnQgb2YgdGhlIGNhbGxiYWNrCiAgICAgKiByZXNlcnZlZCBmb3IgYW55IGV4Y2VwdGlvbnMgdGhhdCBvY2N1cnJlZCAobm9kZS5qcyBzdHlsZSkuCiAgICAgKgogICAgICogQG5hbWUgZ2V0UmV3cml0ZShwYXRoLCBbcV0sIGNhbGxiYWNrKQogICAgICogQHBhcmFtIHtTdHJpbmd9IHBhdGgKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBxIChvcHRpb25hbCkKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgKiBAYXBpIHB1YmxpYwogICAgICovCiAgICAKICAgIGV4cG9ydHMuZ2V0UmV3cml0ZSA9IGZ1bmN0aW9uIChwYXRoLCAvKm9wdGlvbmFsKi9xLCBjYWxsYmFjaykgewogICAgICAgIGlmICghdXRpbHMuaXNCcm93c2VyKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdnZXRSZXdyaXRlIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgICAgICBjYWxsYmFjayA9IHE7CiAgICAgICAgICAgIHEgPSB7fTsKICAgICAgICB9CiAgICAgICAgLy8gcHJlcGVuZCBmb3J3YXJkLXNsYXNoIGlmIG1pc3NpbmcKICAgICAgICBwYXRoID0gKHBhdGhbMF0gPT09ICcvJykgPyBwYXRoOiAnLycgKyBwYXRoOwogICAgCiAgICAgICAgdmFyIGJhc2UgPSB1dGlscy5nZXRCYXNlVVJMKCk7CiAgICAgICAgdmFyIG5hbWUgPSBleHBvcnRzLmVuY29kZShzZXR0aW5ncy5uYW1lKTsKICAgICAgICB2YXIgcmVxID0gewogICAgICAgICAgICB1cmw6IGJhc2UgKyAnL19kYi9fZGVzaWduLycgKyBuYW1lICsgJy9fcmV3cml0ZScgKyBwYXRoLAogICAgICAgICAgICBkYXRhOiBleHBvcnRzLnN0cmluZ2lmeVF1ZXJ5KHEpCiAgICAgICAgfTsKICAgICAgICBleHBvcnRzLnJlcXVlc3QocmVxLCBjYWxsYmFjayk7CiAgICB9OwogICAgCiAgICAKICAgIC8qKgogICAgICogRmV0Y2hlcyBhIGRvY3VtZW50IGZyb20gdGhlIGRhdGFiYXNlIHRoZSBhcHAgaXMgcnVubmluZyBvbi4gUmVzdWx0cyBhcmUKICAgICAqIHBhc3NlZCB0byB0aGUgY2FsbGJhY2ssIHdpdGggdGhlIGZpcnN0IGFyZ3VtZW50IG9mIHRoZSBjYWxsYmFjayByZXNlcnZlZAogICAgICogZm9yIGFueSBleGNlcHRpb25zIHRoYXQgb2NjdXJyZWQgKG5vZGUuanMgc3R5bGUpLgogICAgICoKICAgICAqIEBuYW1lIGdldERvYyhpZCwgW3EsIG9wdGlvbnNdLCBjYWxsYmFjaykKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpZAogICAgICogQHBhcmFtIHtPYmplY3R9IHEgKG9wdGlvbmFsKQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgKG9wdGlvbmFsKQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqIEBhcGkgcHVibGljCiAgICAgKi8KICAgIAogICAgZXhwb3J0cy5nZXREb2MgPSBmdW5jdGlvbiAoaWQsIC8qb3B0aW9uYWwqL3EsIC8qb3B0aW9uYWwqL29wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKCF1dGlscy5pc0Jyb3dzZXIoKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2dldERvYyBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICAgICAgfQogICAgICAgIGlmICghaWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdnZXREb2MgcmVxdWlyZXMgYW4gaWQgcGFyYW1ldGVyIHRvIHdvcmsgcHJvcGVybHknKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgICAgICBpZiAoIW9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIC8qIEFyaXR5ID0gMjogT21pdHMgcSwgb3B0aW9ucyAqLwogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBxOwogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgcSA9IHt9OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8qIEFyaXR5ID0gMzogT21pdHMgb3B0aW9ucyAqLwogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zOwogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciB1cmw7CiAgICAgICAgaWYgKG9wdGlvbnMuZGIpIHsKICAgICAgICAgICAgLyogRm9yY2UgbGVhZGluZyBzbGFzaDsgbWFrZSBhYnNvbHV0ZSBwYXRoICovCiAgICAgICAgICAgIHVybCA9IChvcHRpb25zLmRiLnN1YnN0cigwLCAxKSAhPT0gJy8nID8gJy8nIDogJycpICsgb3B0aW9ucy5kYjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1cmwgPSB1dGlscy5nZXRCYXNlVVJMKCkgKyAnL19kYic7CiAgICAgICAgfQogICAgICAgIHZhciByZXEgPSB7CiAgICAgICAgICAgIHVybDogdXJsICsgJy8nICsgZXhwb3J0cy5lbmNvZGUoaWQpLAogICAgICAgICAgICBkYXRhOiBleHBvcnRzLnN0cmluZ2lmeVF1ZXJ5KHEpLAogICAgICAgICAgICBleHBlY3RfanNvbjogdHJ1ZQogICAgICAgIH07CiAgICAgICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgY2FsbGJhY2spOwogICAgfTsKICAgIAogICAgCiAgICAvKioKICAgICAqIFNhdmVzIGEgZG9jdW1lbnQgdG8gdGhlIGRhdGFiYXNlIHRoZSBhcHAgaXMgcnVubmluZyBvbi4gUmVzdWx0cyBhcmUKICAgICAqIHBhc3NlZCB0byB0aGUgY2FsbGJhY2ssIHdpdGggdGhlIGZpcnN0IGFyZ3VtZW50IG9mIHRoZSBjYWxsYmFjayByZXNlcnZlZAogICAgICogZm9yIGFueSBleGNlcHRpb25zIHRoYXQgb2NjdXJyZWQgKG5vZGUuanMgc3R5bGUpLgogICAgICoKICAgICAqIEBuYW1lIHNhdmVEb2MoZG9jLCBbb3B0aW9uc10sIGNhbGxiYWNrKQogICAgICogQHBhcmFtIHtPYmplY3R9IGRvYwogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgKG9wdGlvbmFsKQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqIEBhcGkgcHVibGljCiAgICAgKi8KICAgIAogICAgZXhwb3J0cy5zYXZlRG9jID0gZnVuY3Rpb24gKGRvYywgLypvcHRpb25hbCovb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignc2F2ZURvYyBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICAgICAgfQogICAgICAgIHZhciBtZXRob2QsIHVybDsKICAgICAgICBpZiAob3B0aW9ucy5kYikgewogICAgICAgICAgICAvKiBGb3JjZSBsZWFkaW5nIHNsYXNoOyBtYWtlIGFic29sdXRlIHBhdGggKi8KICAgICAgICAgICAgdXJsID0gKG9wdGlvbnMuZGIuc3Vic3RyKDAsIDEpICE9PSAnLycgPyAnLycgOiAnJykgKyBvcHRpb25zLmRiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVybCA9IHV0aWxzLmdldEJhc2VVUkwoKSArICcvX2RiJzsKICAgICAgICB9CiAgICAgICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgICAgICAvKiBBcml0eSA9IDI6IE9taXRzIG9wdGlvbnMgKi8KICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zOwogICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgfQogICAgICAgIGlmIChkb2MuX2lkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgbWV0aG9kID0gIlBPU1QiOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbWV0aG9kID0gIlBVVCI7CiAgICAgICAgICAgIHVybCArPSAnLycgKyBleHBvcnRzLmVuY29kZSggZG9jLl9pZCApOwogICAgICAgIH0KICAgICAgICB2YXIgcmVxID0gewogICAgICAgICAgICB0eXBlOiBtZXRob2QsCiAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShkb2MpLAogICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsCiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgIGV4cGVjdF9qc29uOiB0cnVlCiAgICAgICAgfTsKICAgICAgICBleHBvcnRzLnJlcXVlc3QocmVxLCBjYWxsYmFjayk7CiAgICB9OwogICAgCiAgICAKICAgIC8qKgogICAgICogIEFkZGVkIGJ5IFN0ZXZlIGZvciBucmFtYS4gVE9ETzogbm90IGEgY29tcGxldGUgaW1wbGVtZW50YXRpb24gLS0tIGFzc3VtZXMKICAgICAqICB0aGF0IGRvYyBhbHJlYWR5IGhhcyBfaWQgcHJvcGVydHkgKEkgdGhpbmsgdGhlIGNvdWNoZGIgQVBJIGFsbG93cyBmb3IKICAgICAqICBwdXNoZXMgdy9vIGlkIHNldCkKICAgICAqLwogICAgCiAgICBleHBvcnRzLmRvVXBkYXRlID0gZnVuY3Rpb24oIGRvYywgdXBkYXRlX25hbWUsIGNhbGxiYWNrICkgewogICAgICAgIGlmICghdXRpbHMuaXNCcm93c2VyKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdkb1VwZGF0ZSBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICAgICAgfQogICAgICAgIHZhciB1cmwgPSB1dGlscy5nZXRCYXNlVVJMKCkgKyAnL3VwZGF0ZS8nICsgdXBkYXRlX25hbWUgKycvJyArIGV4cG9ydHMuZW5jb2RlKCBkb2MuX2lkICk7CiAgICAgICAgdmFyIHJlcSA9IHsKICAgICAgICAgICAgdHlwZTogJ1BVVCcsCiAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShkb2MpLAogICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsCiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgIGV4cGVjdF9qc29uOmZhbHNlICAgICAgICAgICAgICAgLy9hcyBvZiBjb3VjaGRiIDEuMS4wLCB1cGRhdGVzIHNlZW0gdG8gZGVmeSBhdHRlbXB0cyB0byBhbHRlciBoZWFkZXJzICYgcmV0dXJuIHRleHQvaHRtbCBoZWFkZXIuCiAgICAgICAgfTsKICAgICAgICBleHBvcnRzLnJlcXVlc3QocmVxLCBjYWxsYmFjayk7CiAgICB9OwoKICAgIAogICAgLyoqCiAgICAgKiBEZWxldGVzIGEgZG9jdW1lbnQgZnJvbSB0aGUgZGF0YWJhc2UgdGhlIGFwcCBpcyBydW5uaW5nIG9uLiBSZXN1bHRzIGFyZQogICAgICogcGFzc2VkIHRvIHRoZSBjYWxsYmFjaywgd2l0aCB0aGUgZmlyc3QgYXJndW1lbnQgb2YgdGhlIGNhbGxiYWNrIHJlc2VydmVkCiAgICAgKiBmb3IgYW55IGV4Y2VwdGlvbnMgdGhhdCBvY2N1cnJlZCAobm9kZS5qcyBzdHlsZSkuCiAgICAgKgogICAgICogQG5hbWUgcmVtb3ZlRG9jKGRvYywgW29wdGlvbnNdLCBjYWxsYmFjaykKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkb2MKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgKiBAYXBpIHB1YmxpYwogICAgICovCiAgICAKICAgIGV4cG9ydHMucmVtb3ZlRG9jID0gZnVuY3Rpb24gKGRvYywgLypvcHRpb25hbCovb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncmVtb3ZlRG9jIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFkb2MuX2lkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncmVtb3ZlRG9jIHJlcXVpcmVzIGFuIF9pZCBmaWVsZCBpbiB5b3VyIGRvY3VtZW50Jyk7CiAgICAgICAgfQogICAgICAgIGlmICghZG9jLl9yZXYpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdyZW1vdmVEb2MgcmVxdWlyZXMgYSBfcmV2IGZpZWxkIGluIHlvdXIgZG9jdW1lbnQnKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgICAgICAvKiBBcml0eSA9IDI6IE9taXRzIG9wdGlvbnMgKi8KICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zOwogICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgfQogICAgICAgIHZhciB1cmw7CiAgICAgICAgaWYgKG9wdGlvbnMuZGIpIHsKICAgICAgICAgICAgLyogRm9yY2UgbGVhZGluZyBzbGFzaDsgbWFrZSBhYnNvbHV0ZSBwYXRoICovCiAgICAgICAgICAgIHVybCA9IChvcHRpb25zLmRiLnN1YnN0cigwLCAxKSAhPT0gJy8nID8gJy8nIDogJycpICsgb3B0aW9ucy5kYiArICcvJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1cmwgPSB1dGlscy5nZXRCYXNlVVJMKCkgKyAnL19kYi8nOwogICAgICAgIH0KICAgICAgICB1cmwgKz0gZXhwb3J0cy5lbmNvZGUoZG9jLl9pZCkgKyAnP3Jldj0nICsgZXhwb3J0cy5lbmNvZGUoZG9jLl9yZXYpOwogICAgICAgIHZhciByZXEgPSB7CiAgICAgICAgICAgIHR5cGU6ICdERUxFVEUnLAogICAgICAgICAgICB1cmw6IHVybAogICAgICAgIH07CiAgICAgICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgY2FsbGJhY2spOwogICAgfTsKICAgIAogICAgCiAgICAvKioKICAgICAqIEZldGNoZXMgYSB2aWV3IGZyb20gdGhlIGRhdGFiYXNlIHRoZSBhcHAgaXMgcnVubmluZyBvbi4gUmVzdWx0cyBhcmUKICAgICAqIHBhc3NlZCB0byB0aGUgY2FsbGJhY2ssIHdpdGggdGhlIGZpcnN0IGFyZ3VtZW50IG9mIHRoZSBjYWxsYmFjayByZXNlcnZlZAogICAgICogZm9yIGFueSBleGNlcHRpb25zIHRoYXQgb2NjdXJyZWQgKG5vZGUuanMgc3R5bGUpLgogICAgICoKICAgICAqIEBuYW1lIGdldFZpZXcodmlldywgW3FdLCBjYWxsYmFjaykKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2aWV3CiAgICAgKiBAcGFyYW0ge09iamVjdH0gcSAob3B0aW9uYWwpCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICogQGFwaSBwdWJsaWMKICAgICAqLwogICAgCiAgICBleHBvcnRzLmdldFZpZXcgPSBmdW5jdGlvbiAodmlldywgLypvcHRpb25hbCovcSwgLypvcHRpb25hbCovb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignZ2V0VmlldyBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICAgICAgfQogICAgICAgIGlmICghY2FsbGJhY2spIHsKICAgICAgICAgICAgaWYgKCFvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAvKiBBcml0eSA9IDI6IE9taXRzIHEsIG9wdGlvbnMgKi8KICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gcTsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgICAgIHEgPSB7fTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvKiBBcml0eSA9IDM6IE9taXRzIG9wdGlvbnMgKi8KICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9uczsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgYmFzZTsKICAgICAgICBpZiAob3B0aW9ucy5kYikgewogICAgICAgICAgICAvKiBGb3JjZSBsZWFkaW5nIHNsYXNoOyBtYWtlIGFic29sdXRlIHBhdGggKi8KICAgICAgICAgICAgYmFzZSA9IChvcHRpb25zLmRiLnN1YnN0cigwLCAxKSAhPT0gJy8nID8gJy8nIDogJycpICsgb3B0aW9ucy5kYjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiYXNlID0gdXRpbHMuZ2V0QmFzZVVSTCgpOwogICAgICAgIH0KICAgICAgICB2YXIgbmFtZSA9IGV4cG9ydHMuZW5jb2RlKHNldHRpbmdzLm5hbWUpOwogICAgICAgIHZhciB2aWV3bmFtZSA9IGV4cG9ydHMuZW5jb2RlKHZpZXcpOwogICAgICAgIHZhciByZXEgPSB7CiAgICAgICAgICAgIHVybDogKAogICAgICAgICAgICAgICAgYmFzZSArIChvcHRpb25zLmRiID8gJycgOiAnL19kYicpICsgJy9fZGVzaWduLycgKwogICAgICAgICAgICAgICAgICAgIChvcHRpb25zLmRiIHx8IG5hbWUpICsgJy9fdmlldy8nICsgdmlld25hbWUKICAgICAgICAgICAgKSwKICAgICAgICAgICAgZGF0YTogZXhwb3J0cy5zdHJpbmdpZnlRdWVyeShxKSwKICAgICAgICAgICAgZXhwZWN0X2pzb246IHRydWUKICAgICAgICB9OwogICAgICAgIGV4cG9ydHMucmVxdWVzdChyZXEsIGNhbGxiYWNrKTsKICAgIH07CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBUcmFuc2Zvcm1zIGFuZCBmZXRjaGVzIGEgdmlldyB0aHJvdWdoIGEgbGlzdCBmcm9tIHRoZSBkYXRhYmFzZSB0aGUgYXBwCiAgICAgKiBpcyBydW5uaW5nIG9uLiBSZXN1bHRzIGFyZSBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrLCB3aXRoIHRoZSBmaXJzdAogICAgICogYXJndW1lbnQgb2YgdGhlIGNhbGxiYWNrIHJlc2VydmVkIGZvciBhbnkgZXhjZXB0aW9ucyB0aGF0IG9jY3VycmVkCiAgICAgKiAobm9kZS5qcyBzdHlsZSkuCiAgICAgKgogICAgICogQG5hbWUgZ2V0TGlzdChsaXN0LCB2aWV3LCBbcV0sIGNhbGxiYWNrKQogICAgICogQHBhcmFtIHtTdHJpbmd9IGxpc3QKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2aWV3CiAgICAgKiBAcGFyYW0ge09iamVjdH0gcSAob3B0aW9uYWwpCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICogQGFwaSBwdWJsaWMKICAgICAqLwogICAgCiAgICAvLyBUT0RPOiBydW4gbGlzdCBmdW5jdGlvbiBjbGllbnQtc2lkZT8KICAgIGV4cG9ydHMuZ2V0TGlzdCA9IGZ1bmN0aW9uIChsaXN0LCB2aWV3LCAvKm9wdGlvbmFsKi9xLCBjYWxsYmFjaykgewogICAgICAgIGlmICghdXRpbHMuaXNCcm93c2VyKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdnZXRMaXN0IGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgICAgICBjYWxsYmFjayA9IHE7CiAgICAgICAgICAgIHEgPSB7fTsKICAgICAgICB9CiAgICAgICAgdmFyIGJhc2UgPSB1dGlscy5nZXRCYXNlVVJMKCk7CiAgICAgICAgdmFyIG5hbWUgPSBleHBvcnRzLmVuY29kZShzZXR0aW5ncy5uYW1lKTsKICAgICAgICB2YXIgbGlzdG5hbWUgPSBleHBvcnRzLmVuY29kZShsaXN0KTsKICAgICAgICB2YXIgdmlld25hbWUgPSBleHBvcnRzLmVuY29kZSh2aWV3KTsKICAgICAgICB2YXIgcmVxID0gewogICAgICAgICAgICB1cmw6IGJhc2UgKyAnL19kYi9fZGVzaWduLycgKyBuYW1lICsgJy9fbGlzdC8nICsgbGlzdG5hbWUgKwogICAgICAgICAgICAgICAgICcvJyArIHZpZXduYW1lLAogICAgICAgICAgICBkYXRhOiBleHBvcnRzLnN0cmluZ2lmeVF1ZXJ5KHEpCiAgICAgICAgfTsKICAgICAgICBleHBvcnRzLnJlcXVlc3QocmVxLCBjYWxsYmFjayk7CiAgICB9OwogICAgCiAgICAvKioKICAgICAqIFRyYW5zZm9ybXMgYW5kIGZldGNoZXMgYSBkb2N1bWVudCB0aHJvdWdoIGEgc2hvdyBmcm9tIHRoZSBkYXRhYmFzZSB0aGUgYXBwCiAgICAgKiBpcyBydW5uaW5nIG9uLiBSZXN1bHRzIGFyZSBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrLCB3aXRoIHRoZSBmaXJzdAogICAgICogYXJndW1lbnQgb2YgdGhlIGNhbGxiYWNrIHJlc2VydmVkIGZvciBhbnkgZXhjZXB0aW9ucyB0aGF0IG9jY3VycmVkCiAgICAgKiAobm9kZS5qcyBzdHlsZSkuCiAgICAgKgogICAgICogQG5hbWUgZ2V0U2hvdyhzaG93LCBkb2NpZCwgW3FdLCBjYWxsYmFjaykKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzaG93CiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZG9jaWQKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBxIChvcHRpb25hbCkKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgKiBAYXBpIHB1YmxpYwogICAgICovCiAgICAKICAgIC8vIFRPRE86IHJ1biBzaG93IGZ1bmN0aW9uIGNsaWVudC1zaWRlPwogICAgZXhwb3J0cy5nZXRTaG93ID0gZnVuY3Rpb24gKHNob3csIGRvY2lkLCAvKm9wdGlvbmFsKi9xLCBjYWxsYmFjaykgewogICAgICAgIGlmICghdXRpbHMuaXNCcm93c2VyKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdnZXRTaG93IGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgICAgICBjYWxsYmFjayA9IHE7CiAgICAgICAgICAgIHEgPSB7fTsKICAgICAgICB9CiAgICAgICAgdmFyIGJhc2UgPSB1dGlscy5nZXRCYXNlVVJMKCk7CiAgICAgICAgdmFyIG5hbWUgPSBleHBvcnRzLmVuY29kZShzZXR0aW5ncy5uYW1lKTsKICAgICAgICB2YXIgc2hvd25hbWUgPSBleHBvcnRzLmVuY29kZShzaG93KTsKICAgICAgICB2YXIgc2hvd191cmwgPSBiYXNlICsgJy9fZGIvX2Rlc2lnbi8nICsgbmFtZSArICcvX3Nob3cvJyArIHNob3duYW1lOwogICAgICAgIHZhciByZXEgPSB7CiAgICAgICAgICAgIHVybDogc2hvd191cmwgKyAoZG9jaWQgPyAnLycgKyBleHBvcnRzLmVuY29kZShkb2NpZCk6ICcnKSwKICAgICAgICAgICAgZGF0YTogZXhwb3J0cy5zdHJpbmdpZnlRdWVyeShxKQogICAgICAgIH07CiAgICAgICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgY2FsbGJhY2spOwogICAgfTsKICAgIAogICAgCiAgICAvKioKICAgICAqIEdldCBhbGwgZG9jdW1lbnRzIChpbmNsdWRpbmcgZGVzaWduIGRvY3MpLgogICAgICoKICAgICAqIEBuYW1lIGFsbChbcV0sIGNhbGxiYWNrKQogICAgICogQHBhcmFtIHtPYmplY3R9IHEgKG9wdGlvbmFsKQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqIEBhcGkgcHVibGljCiAgICAgKi8KICAgIAogICAgZXhwb3J0cy5hbGwgPSBmdW5jdGlvbiAoLypvcHRpb25hbCovcSwgY2FsbGJhY2spIHsKICAgICAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYWxsIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgICAgICBjYWxsYmFjayA9IHE7CiAgICAgICAgICAgIHEgPSB7fTsKICAgICAgICB9CiAgICAgICAgdmFyIGJhc2UgPSB1dGlscy5nZXRCYXNlVVJMKCk7CiAgICAgICAgdmFyIHJlcSA9IHsKICAgICAgICAgICAgdXJsOiBiYXNlICsgJy9fZGIvX2FsbF9kb2NzJywKICAgICAgICAgICAgZGF0YTogZXhwb3J0cy5zdHJpbmdpZnlRdWVyeShxKSwKICAgICAgICAgICAgZXhwZWN0X2pzb246IHRydWUKICAgICAgICB9OwogICAgICAgIGV4cG9ydHMucmVxdWVzdChyZXEsIGNhbGxiYWNrKTsKICAgIH07CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBQcm9wZXJseSBlbmNvZGVzIHF1ZXJ5IHBhcmFtZXRlcnMgdG8gQ291Y2hEQiB2aWV3cyBldGMuIEhhbmRsZSBjb21wbGV4CiAgICAgKiBrZXlzIGFuZCBvdGhlciBub24tc3RyaW5nIHBhcmFtZXRlcnMgYnkgcGFzc2luZyB0aHJvdWdoIEpTT04uc3RyaW5naWZ5LgogICAgICogUmV0dXJucyBhIHNoYWxsb3ctY29waWVkIGNsb25lIG9mIHRoZSBvcmlnaW5hbCBxdWVyeSBhZnRlciBjb21wbGV4IHZhbHVlcwogICAgICogaGF2ZSBiZWVuIHN0cmluZ2lmaWVkLgogICAgICoKICAgICAqIEBuYW1lIHN0cmluZ2lmeVF1ZXJ5KHF1ZXJ5KQogICAgICogQHBhcmFtIHtPYmplY3R9IHF1ZXJ5CiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fQogICAgICogQGFwaSBwdWJsaWMKICAgICAqLwogICAgCiAgICBleHBvcnRzLnN0cmluZ2lmeVF1ZXJ5ID0gZnVuY3Rpb24gKHF1ZXJ5KSB7CiAgICAgICAgdmFyIHEgPSB7fTsKICAgICAgICBmb3IgKHZhciBrIGluIHF1ZXJ5KSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgcXVlcnlba10gIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICBxW2tdID0gSlNPTi5zdHJpbmdpZnkocXVlcnlba10pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcVtrXSA9IHF1ZXJ5W2tdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBxOwogICAgfTsKICAgIAogICAgCiAgICAvKioKICAgICAqIFJldHVybnMgYSBuZXcgVVVJRCBnZW5lcmF0ZWQgYnkgQ291Y2hEQi4gSXRzIHBvc3NpYmxlIHRvIGNhY2hlCiAgICAgKiBtdWx0aXBsZSBVVUlEcyBmb3IgbGF0ZXIgdXNlLCB0byBhdm9pZCBtYWtpbmcgdG9vIG1hbnkgcmVxdWVzdHMuCiAgICAgKgogICAgICogQG5hbWUgbmV3VVVJRChjYWNoZU51bSwgY2FsbGJhY2spCiAgICAgKiBAcGFyYW0ge051bWJlcn0gY2FjaGVOdW0gKG9wdGlvbmFsLCBkZWZhdWx0OiAxKQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqIEBhcGkgcHVibGljCiAgICAgKi8KICAgIAogICAgdmFyIHV1aWRDYWNoZSA9IFtdOwogICAgCiAgICBleHBvcnRzLm5ld1VVSUQgPSBmdW5jdGlvbiAoY2FjaGVOdW0sIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKCF1dGlscy5pc0Jyb3dzZXIoKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ25ld1VVSUQgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpOwogICAgICAgIH0KICAgICAgICBpZiAoIWNhbGxiYWNrKSB7CiAgICAgICAgICAgIGNhbGxiYWNrID0gY2FjaGVOdW07CiAgICAgICAgICAgIGNhY2hlTnVtID0gMTsKICAgICAgICB9CiAgICAgICAgaWYgKHV1aWRDYWNoZS5sZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHV1aWRDYWNoZS5zaGlmdCgpKTsKICAgICAgICB9CiAgICAgICAgdmFyIGJhc2UgPSB1dGlscy5nZXRCYXNlVVJMKCk7CiAgICAgICAgdmFyIHJlcSA9IHsKICAgICAgICAgICAgdXJsOiAnL191dWlkcycsCiAgICAgICAgICAgIGRhdGE6IHtjb3VudDogY2FjaGVOdW19LAogICAgICAgICAgICBleHBlY3RfanNvbjogdHJ1ZQogICAgICAgIH07CiAgICAgICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgZnVuY3Rpb24gKGVyciwgcmVzcCkgewogICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB1dWlkQ2FjaGUgPSByZXNwLnV1aWRzOwogICAgICAgICAgICBjYWxsYmFjayhudWxsLCB1dWlkQ2FjaGUuc2hpZnQoKSk7CiAgICAgICAgfSk7CiAgICB9OwogICAgCiAgICAvKioKICAgICAqIENyZWF0ZXMgYSBDb3VjaERCIGRhdGFiYXNlLgogICAgICoKICAgICAqIElmIHlvdSdyZSBydW5uaW5nIGJlaGluZCBhIHZpcnR1YWwgaG9zdCB5b3UnbGwgbmVlZCB0byBzZXQgdXAKICAgICAqIGFwcHJvcHJpYXRlIHJld3JpdGVzIGZvciBhIFBVVCByZXF1ZXN0IHRvICcvJyBhbmQgdHVybiBvZmYgc2FmZSByZXdyaXRlcy4KICAgICAqCiAgICAgKiBAbmFtZSBjcmVhdGVEYXRhYmFzZShuYW1lLCBjYWxsYmFjaykKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICogQGFwaSBwdWJsaWMKICAgICAqLwogICAgCiAgICBleHBvcnRzLmNyZWF0ZURhdGFiYXNlID0gZnVuY3Rpb24gKG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKCF1dGlscy5pc0Jyb3dzZXIoKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NyZWF0ZURhdGFiYXNlIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgICAgICB9CiAgICAgICAgdmFyIHJlcSA9IHsKICAgICAgICAgICAgdHlwZTogJ1BVVCcsCiAgICAgICAgICAgIHVybDogJy8nICsgZXhwb3J0cy5lbmNvZGUobmFtZS5yZXBsYWNlKC9eXC8rLywgJycpKQogICAgICAgIH07CiAgICAgICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgY2FsbGJhY2spOwogICAgfTsKICAgIAogICAgLyoqCiAgICAgKiBEZWxldGVzIGEgQ291Y2hEQiBkYXRhYmFzZS4KICAgICAqCiAgICAgKiBJZiB5b3UncmUgcnVubmluZyBiZWhpbmQgYSB2aXJ0dWFsIGhvc3QgeW91J2xsIG5lZWQgdG8gc2V0IHVwCiAgICAgKiBhcHByb3ByaWF0ZSByZXdyaXRlcyBmb3IgYSBERUxFVEUgcmVxdWVzdCB0byAnLycgYW5kIHR1cm4gb2ZmIHNhZmUgcmV3cml0ZXMuCiAgICAgKgogICAgICogQG5hbWUgZGVsZXRlRGF0YWJhc2UobmFtZSwgY2FsbGJhY2spCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqIEBhcGkgcHVibGljCiAgICAgKi8KICAgIAogICAgZXhwb3J0cy5kZWxldGVEYXRhYmFzZSA9IGZ1bmN0aW9uIChuYW1lLCBjYWxsYmFjaykgewogICAgICAgIGlmICghdXRpbHMuaXNCcm93c2VyKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdkZWxldGVEYXRhYmFzZSBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICAgICAgfQogICAgICAgIHZhciByZXEgPSB7CiAgICAgICAgICAgIHR5cGU6ICdERUxFVEUnLAogICAgICAgICAgICB1cmw6ICcvJyArIGV4cG9ydHMuZW5jb2RlKG5hbWUucmVwbGFjZSgvXlwvKy8sICcnKSkKICAgICAgICB9OwogICAgICAgIGV4cG9ydHMucmVxdWVzdChyZXEsIGNhbGxiYWNrKTsKICAgIH07CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBGZXRjaGVzIHRoZSBtb3N0IHJlY2VudCByZXZpc2lvbiBvZiB0aGUgcmVwbGljYXRpb24gZG9jdW1lbnQKICAgICAqIHJlZmVycmVkIHRvIGJ5IHRoZSBpZCBwYXJhbWV0ZXIuCiAgICAgKgogICAgICogSWYgeW91J3JlIHJ1bm5pbmcgYmVoaW5kIGEgdmlydHVhbCBob3N0IHlvdSdsbCBuZWVkIHRvIHNldCB1cAogICAgICogYXBwcm9wcmlhdGUgcmV3cml0ZXMgdG8gL19yZXBsaWNhdG9yLCB3aGljaCB3aWxsIGFsc28gbWVhbiB0dXJuaW5nCiAgICAgKiBvZmYgc2FmZSByZXdyaXRlcy4KICAgICAqCiAgICAgKiBUaGlzIGZ1bmN0aW9uIG9ubHkgd29ya3Mgd2l0aCBDb3VjaERCID49IDEuMSwgc2luY2UgaXQgdXNlcyB0aGUKICAgICAqIF9yZXBsaWNhdG9yIGRhdGFiYXNlLgogICAgICoKICAgICAqIEBuYW1lIGdldFJlcGxpY2F0aW9uKGlkLCBjYWxsYmFjaykKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpZAogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqIEBhcGkgcHVibGljCiAgICAgKi8KICAgIAogICAgZXhwb3J0cy5nZXRSZXBsaWNhdGlvbiA9IGZ1bmN0aW9uIChpZCwgY2FsbGJhY2spIHsKICAgICAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignZ2V0UmVwbGljYXRpb24gY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpOwogICAgICAgIH0KICAgICAgICB2YXIgcmVxID0gewogICAgICAgICAgICB1cmw6ICcvX3JlcGxpY2F0b3IvJyArIGV4cG9ydHMuZW5jb2RlKGlkKSwKICAgICAgICAgICAgY2FjaGU6IGZhbHNlIC8qIFdvcmsgYXJvdW5kIElFNyBpc3N1ZSAqLwogICAgICAgIH07CiAgICAgICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgY2FsbGJhY2spOwogICAgfTsKICAgIAogICAgLyoqCiAgICAgKiBSZXBsaWNhdGVzIG9wdGlvbnMuc291cmNlIHRvIG9wdGlvbnMudGFyZ2V0LiBUaGUgc3RyaW5ncwogICAgICogb3B0aW9ucy5zb3VyY2UgYW5kIG9wdGlvbnMudGFyZ2V0IGFyZSBlYWNoIGVpdGhlciBhCiAgICAgKiBDb3VjaERCIGRhdGFiYXNlIG5hbWUgb3IgYSBDb3VjaERCIGRhdGFiYXNlIFVSSS4KICAgICAqCiAgICAgKiBJZiB5b3UncmUgcnVubmluZyBiZWhpbmQgYSB2aXJ0dWFsIGhvc3QgeW91J2xsIG5lZWQgdG8gc2V0IHVwCiAgICAgKiBhcHByb3ByaWF0ZSByZXdyaXRlcyB0byAvX3JlcGxpY2F0b3IsIHdoaWNoIHdpbGwgYWxzbyBtZWFuIHR1cm5pbmcKICAgICAqIG9mZiBzYWZlIHJld3JpdGVzLgogICAgICoKICAgICAqIFRoaXMgZnVuY3Rpb24gb25seSB3b3JrcyB3aXRoIENvdWNoREIgPj0gMS4xLCBzaW5jZSBpdCB1c2VzIHRoZQogICAgICogX3JlcGxpY2F0b3IgZGF0YWJhc2UuCiAgICAgKgogICAgICogQG5hbWUgc3RhcnRSZXBsaWNhdGlvbihvcHRpb25zLCBjYWxsYmFjaykKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICogQGFwaSBwdWJsaWMKICAgICAqLwogICAgCiAgICBleHBvcnRzLnN0YXJ0UmVwbGljYXRpb24gPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignc3RhcnRSZXBsaWNhdGlvbiBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICAgICAgfQogICAgICAgIGlmICghb3B0aW9ucy5zb3VyY2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzb3VyY2UgcGFyYW1ldGVyIG11c3QgYmUgcHJvdmlkZWQnKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFvcHRpb25zLnRhcmdldCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3RhcmdldCBwYXJhbWV0ZXIgbXVzdCBiZSBwcm92aWRlZCcpOwogICAgICAgIH0KICAgICAgICB2YXIgcmVxID0gewogICAgICAgICAgICB0eXBlOiAnUE9TVCcsCiAgICAgICAgICAgIHVybDogJy9fcmVwbGljYXRvcicsCiAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KG9wdGlvbnMpLAogICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgICAgfTsKICAgICAgICBleHBvcnRzLnJlcXVlc3QocmVxLCBjYWxsYmFjayk7CiAgICB9OwogICAgCiAgICAvKioKICAgICAqIFdhaXRzIGZvciBhIHJlcGxpY2F0aW9uIG9wZXJhdGlvbiB0byBlbnRlciBhIHNwZWNpZmljIHN0YXRlLgogICAgICogd2FpdFJlcGxpY2F0aW9uIHBvbGxzIHRoZSBfcmVwbGljYXRpb24gZGF0YWJhc2UgdXNpbmcgdGhlCiAgICAgKiBkb2MgcHJvdmlkZWQsIGFuZCBldmFsdWF0ZXMgc3RhdGVfZnVuY3Rpb24oZG9jKSBhdCBlYWNoIGl0ZXJhdGlvbi4KICAgICAqIFRoaXMgZnVuY3Rpb24gc3RvcHMgcG9sbGluZyBhbmQgaW52b2tlcyBjYWxsYmFjayB3aGVuIHRoZQogICAgICogc3RhdGVfZnVuY3Rpb24gZXZhbHVhdGVzIHRvIHRydWUuIElmIHN0YXRlX2Z1bmN0aW9uIGlzIG5vdAogICAgICogcHJvdmlkZWQsIHdhaXRSZXBsaWNhdGlvbiB3YWl0cyBmb3IgdGhlIGRvYydzIF9yZXBsaWNhdGlvbl9zdGF0ZQogICAgICogdG8gY2hhbmdlIGZyb20gJ3RyaWdnZXJlZCcgdG8gJ2NvbXBsZXRlZCcgKG9yICdlcnJvcicpLgogICAgICoKICAgICAqIElmIHlvdSdyZSBydW5uaW5nIGJlaGluZCBhIHZpcnR1YWwgaG9zdCB5b3UnbGwgbmVlZCB0byBzZXQgdXAKICAgICAqIGFwcHJvcHJpYXRlIHJld3JpdGVzIHRvIC9fcmVwbGljYXRvciwgd2hpY2ggd2lsbCBhbHNvIG1lYW4gdHVybmluZwogICAgICogb2ZmIHNhZmUgcmV3cml0ZXMuCiAgICAgKgogICAgICogVGhpcyBmdW5jdGlvbiBvbmx5IHdvcmtzIHdpdGggQ291Y2hEQiA+PSAxLjEsIHNpbmNlIGl0IHVzZXMgdGhlCiAgICAgKiBfcmVwbGljYXRvciBkYXRhYmFzZS4KICAgICAqCiAgICAgKiBAbmFtZSB3YWl0UmVwbGljYXRpb24oZG9jLCBbb3B0aW9ucywgc3RhdGVfZnVuY3Rpb25dLCBjYWxsYmFjaykKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkb2MKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHN0YXRlX2Z1bmN0aW9uIChvcHRpb25hbCkKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgKiBAYXBpIHB1YmxpYwogICAgICovCiAgICAKICAgIGV4cG9ydHMud2FpdFJlcGxpY2F0aW9uID0gZnVuY3Rpb24gKGRvYywgLypvcHRpb25hbCovb3B0aW9ucywgLypvcHRpb25hbCovc3RhdGVfZnVuY3Rpb24sIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKCF1dGlscy5pc0Jyb3dzZXIoKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3dhaXRSZXBsaWNhdGlvbiBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICAgICAgfQogICAgICAgIHZhciBkZWZhdWx0X3N0YXRlX2Z1bmN0aW9uID0gZnVuY3Rpb24gKHJlY2VudF9kb2MsIGluaXRpYWxfZG9jKSB7CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgcmVjZW50X2RvYy5fcmVwbGljYXRpb25fc3RhdGUgPT09ICdjb21wbGV0ZWQnIHx8CiAgICAgICAgICAgICAgICAgIHJlY2VudF9kb2MuX3JlcGxpY2F0aW9uX3N0YXRlID09PSAnZXJyb3InCiAgICAgICAgICAgICk7CiAgICAgICAgfTsKICAgICAgICBpZiAoIWNhbGxiYWNrKSB7CiAgICAgICAgICAgIGlmICghc3RhdGVfZnVuY3Rpb24pIHsKICAgICAgICAgICAgICAgIC8qIEFyaXR5ID0gMjogZG9jLCBjYWxsYmFjayAqLwogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zOwogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgc3RhdGVfZnVuY3Rpb24gPSBkZWZhdWx0X3N0YXRlX2Z1bmN0aW9uOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLyogQXJpdHkgPSAzOiBkb2MsIG9wdGlvbnMsIGNhbGxiYWNrICovCiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IHN0YXRlX2Z1bmN0aW9uOwogICAgICAgICAgICAgICAgc3RhdGVfZnVuY3Rpb24gPSBkZWZhdWx0X3N0YXRlX2Z1bmN0aW9uOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy5saW1pdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIG9wdGlvbnMubGltaXQgPSAxMDA7IC8qIHRpbWVzICovCiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLmRlbGF5ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgb3B0aW9ucy5kZWxheSA9IDIwMDA7IC8qIG1zICovCiAgICAgICAgfQogICAgCiAgICAgICAgLyogRmV0Y2ggbGF0ZXN0IHJldmlzaW9uICovCiAgICAgICAgZXhwb3J0cy5nZXRSZXBsaWNhdGlvbihkb2MuaWQsIGZ1bmN0aW9uIChlcnIsIHJ2KSB7CiAgICAKICAgICAgICAgICAgLyogQ2hlY2sgZm9yIGVycm9yLCB0aGVuIGZvciBhbiBpbnRlcmVzdGluZyBldmVudCAqLwogICAgICAgICAgICBpZiAoZXJyIHx8IHN0YXRlX2Z1bmN0aW9uKHJ2LCBkb2MpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyLCBydiwgZG9jKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvKiBUZXJtaW5hdGlvbiBjb25kaXRpb24gZm9yIHJlY3Vyc2lvbi4uLiAqLwogICAgICAgICAgICBpZiAob3B0aW9ucy5saW1pdCA+IDApIHsKICAgIAogICAgICAgICAgICAgICAgLyogLi4ud2l0aCB3ZWxsLWRlZmluZWQgcHJvZ3Jlc3MgdG93YXJkIGl0ICovCiAgICAgICAgICAgICAgICBvcHRpb25zLmxpbWl0IC09IDE7CiAgICAKICAgICAgICAgICAgICAgIC8qIEdvIGFyb3VuZCAqLwogICAgICAgICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBleHBvcnRzLndhaXRSZXBsaWNhdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgZG9jLCBvcHRpb25zLCBzdGF0ZV9mdW5jdGlvbiwgY2FsbGJhY2sKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSwgb3B0aW9ucy5kZWxheSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CiAgICAKICAgIC8qKgogICAgICogU3RvcHMgYSByZXBsaWNhdGlvbiBvcGVyYXRpb24gYWxyZWFkeSBpbiBwcm9ncmVzcy4KICAgICAqIFRoZSBkb2MgcGFyYW1ldGVyIGNhbiBiZSBvYnRhaW5lZCBieSBjYWxsaW5nIGdldFJlcGxpY2F0aW9uLgogICAgICoKICAgICAqIElmIHlvdSdyZSBydW5uaW5nIGJlaGluZCBhIHZpcnR1YWwgaG9zdCB5b3UnbGwgbmVlZCB0byBzZXQgdXAKICAgICAqIGFwcHJvcHJpYXRlIHJld3JpdGVzIHRvIC9fcmVwbGljYXRvciwgd2hpY2ggd2lsbCBhbHNvIG1lYW4gdHVybmluZwogICAgICogb2ZmIHNhZmUgcmV3cml0ZXMuCiAgICAgKgogICAgICogVGhpcyBmdW5jdGlvbiBvbmx5IHdvcmtzIHdpdGggQ291Y2hEQiA+PSAxLjEsIHNpbmNlIGl0IHVzZXMgdGhlCiAgICAgKiBfcmVwbGljYXRvciBkYXRhYmFzZS4KICAgICAqCiAgICAgKiBAbmFtZSBzdG9wUmVwbGljYXRpb24oZG9jLCBjYWxsYmFjaywgW29wdGlvbnNdKQogICAgICogQHBhcmFtIHtTdHJpbmd9IGlkCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gb3B0aW9ucwogICAgICogQGFwaSBwdWJsaWMKICAgICAqLwogICAgCiAgICBleHBvcnRzLnN0b3BSZXBsaWNhdGlvbiA9IGZ1bmN0aW9uIChkb2MsIGNhbGxiYWNrLCAvKm9wdGlvbmFsKi9vcHRpb25zKSB7CiAgICAKICAgICAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignc3RvcFJlcGxpY2F0aW9uIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgICAgICB9CiAgICAKICAgICAgICBpZiAob3B0aW9ucyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMubGltaXQgPT09IHVuZGVmaW5lZCB8fCBvcHRpb25zLmxpbWl0ID09PSBudWxsKSB7CiAgICAgICAgICAgIG9wdGlvbnMubGltaXQgPSAzOyAvKiB0aW1lcyAqLwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy5kZWxheSA9PT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMuZGVsYXkgPT09IG51bGwpIHsKICAgICAgICAgICAgb3B0aW9ucy5kZWxheSA9IDUwMDsgLyogbXMgKi8KICAgICAgICB9CiAgICAKICAgICAgICB2YXIgcmVxID0gewogICAgICAgICAgICB0eXBlOiAnREVMRVRFJywKICAgICAgICAgICAgdXJsOiAnL19yZXBsaWNhdG9yLycgKwogICAgICAgICAgICAgIGV4cG9ydHMuZW5jb2RlKGRvYy5faWQpICsKICAgICAgICAgICAgICAnP3Jldj0nICsgZXhwb3J0cy5lbmNvZGUoZG9jLl9yZXYpCiAgICAgICAgfTsKICAgIAogICAgICAgIGV4cG9ydHMucmVxdWVzdChyZXEsIGZ1bmN0aW9uIChlcnIsIHJ2KSB7CiAgICAKICAgICAgICAgICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzID09PSA0MDkpIHsgIC8qIERvY3VtZW50IHVwZGF0ZSBjb25mbGljdCAqLwogICAgCiAgICAgICAgICAgICAgICAvKiBSYWNlIGNvbmRpdGlvbjoKICAgICAgICAgICAgICAgICAgICBUaGUgQ291Y2hEQiByZXBsaWNhdGlvbiBmaW5pc2hlZCAob3Igd2FzIHVwZGF0ZWQpIGJldHdlZW4KICAgICAgICAgICAgICAgICAgICB0aGUgY2FsbGVyJ3MgZ2V0UmVwbGljYXRpb24gYW5kIG5vdy4gU3ViamVjdCB0byByZXN0cmljdGlvbnMKICAgICAgICAgICAgICAgICAgICBpbiBvcHRpb25zLCBjYWxsIGdldFJlcGxpY2F0aW9uIGFuZCB0aGVuIHRyeSBhZ2Fpbi4gKi8KICAgIAogICAgICAgICAgICAgICAgLyogVGVybWluYXRpb24gY29uZGl0aW9uIGZvciByZWN1cnNpb24uLi4gKi8KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmxpbWl0ID4gMCkgewogICAgCiAgICAgICAgICAgICAgICAgICAgLyogLi4ud2l0aCB3ZWxsLWRlZmluZWQgcHJvZ3Jlc3MgdG93YXJkIGl0ICovCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5saW1pdCAtPSAxOwogICAgCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4cG9ydHMuZ2V0UmVwbGljYXRpb24oZG9jLl9pZCwgZnVuY3Rpb24gKGUsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1RoZSBzcGVjaWZpZWQgcmVwbGljYXRpb24gZG9jdW1lbnQgY2hhbmdlZCAnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NpbmNlIGxhc3QgcmVhZCwgYW5kIHdlIGZhaWxlZCB0byByZS1yZXF1ZXN0IGl0JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvKiBHbyBhcm91bmQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5zdG9wUmVwbGljYXRpb24oZCwgY2FsbGJhY2ssIG9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCBvcHRpb25zLmRlbGF5KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICB9IGVsc2UgewogICAgCiAgICAgICAgICAgICAgICAvKiBOb3JtYWwgY2FzZToKICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGlvbiBkb2N1bWVudCB3YXMgbm90IGNoYW5nZWQgc2luY2UgdGhlIGxhc3QKICAgICAgICAgICAgICAgICAgICByZWFkOyBnbyBhaGVhZCBhbmQgaW52b2tlIHRoZSBjYWxsYmFjayBhbmQgcmV0dXJuLiAqLwogICAgCiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyLCBydik7CiAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICAvKiBOb3QgcmVhY2hlZCAqLwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAKICAgICAgICB9KTsKICAgIAogICAgfTsKICAgIAogICAgLyoqCiAgICAgKiBEZWxldGVzIGFuIGV4aXN0aW5nIHVzZXIgZG9jdW1lbnQsIGdpdmVuIGl0cyB1c2VybmFtZS4gWW91CiAgICAgKiBtdXN0IGJlIGxvZ2dlZCBpbiBhcyBhbiBhZG1pbmlzdHJhdGl2ZSB1c2VyIGZvciB0aGlzIGZ1bmN0aW9uCiAgICAgKiB0byBzdWNjZWVkLgogICAgICoKICAgICAqIEBuYW1lIGRlbGV0ZVVzZXIodXNlcm5hbWUsIGNhbGxiYWNrKQogICAgICogQHBhcmFtIHtTdHJpbmd9IHVzZXJuYW1lCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICogQGFwaSBwdWJsaWMKICAgICAqLwogICAgCiAgICBleHBvcnRzLmRlbGV0ZVVzZXIgPSBmdW5jdGlvbiAodXNlcm5hbWUsIGNhbGxiYWNrKSB7CiAgICAgICAgdmFyIGlkID0gJ29yZy5jb3VjaGRiLnVzZXI6JyArIHVzZXJuYW1lOwogICAgCiAgICAgICAgZXhwb3J0cy51c2VyRGIoZnVuY3Rpb24gKGVyciwgdXNlcmRiKSB7CiAgICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByZXEgPSB7CiAgICAgICAgICAgICAgICB0eXBlOiAnREVMRVRFJywKICAgICAgICAgICAgICAgIHVybDogJy8nICsgZXhwb3J0cy5lbmNvZGUodXNlcmRiKSArICcvJyArIGV4cG9ydHMuZW5jb2RlKGlkKSwKICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgY2FsbGJhY2spOwogICAgICAgIH0pOwogICAgfTsKICAgIAogICAgLyoqCiAgICAgKiBGZXRjaCBhIGRlc2lnbiBkb2N1bWVudCBmcm9tIENvdWNoREIuIEJ5IGRlZmF1bHQsIHRoZQogICAgICogcmVzdWx0cyBvZiB0aGlzIGZ1bmN0aW9uIGFyZSBjYWNoZWQgd2l0aGluIHRoZSBqYXZhc2NyaXB0CiAgICAgKiBlbmdpbmUuIFRvIGF2b2lkIHRoaXMsIHBhc3MgdHJ1ZSBmb3IgdGhlIG5vX2NhY2hlIGFyZ3VtZW50LgogICAgICoKICAgICAqIEBuYW1lIGdldERlc2lnbkRvYyhuYW1lLCBjYWxsYmFjaywgbm9fY2FjaGUpCiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiAoaS5lLiBwYXRoIHRvKSB0aGUgZGVzaWduIGRvY3VtZW50LgogICAgICogQHBhcmFtIGNhbGxiYWNrIFRoZSBjYWxsYmFjayB0byBpbnZva2Ugd2hlbiB0aGUgcmVxdWVzdCBjb21wbGV0ZXMuCiAgICAgKiBAcGFyYW0gbm9fY2FjaGUgb3B0aW9uYWw7IHRydWUgdG8gZm9yY2UgYSBjYWNoZSBtaXNzIGZvciB0aGlzIHJlcXVlc3QuCiAgICAgKiBAYXBpIHB1YmxpYwogICAgICovCiAgICAKICAgIGV4cG9ydHMuZ2V0RGVzaWduRG9jID0gZnVuY3Rpb24gKG5hbWUsIGNhbGxiYWNrLCBub19jYWNoZSkgewogICAgICAgIGlmICghbm9fY2FjaGUgJiYgZXhwb3J0cy5kZXNpZ25fZG9jc1tuYW1lXSkgewogICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgZXhwb3J0cy5kZXNpZ25fZG9jc1tuYW1lXSk7CiAgICAgICAgfQogICAgICAgIGV4cG9ydHMuZ2V0RG9jKCdfZGVzaWduLycgKyBuYW1lLCB7fSwgZnVuY3Rpb24gKGVyciwgZGRvYykgewogICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBleHBvcnRzLmRlc2lnbl9kb2NzW25hbWVdID0gZGRvYzsKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIGV4cG9ydHMuZGVzaWduX2RvY3NbbmFtZV0pOwogICAgICAgIH0pOwogICAgfTsKfSkoZGIpOwoK"
        },
        "xdm/easyXDM.min.js": {
            "content_type": "application/javascript",
            "data": "LyoqCiAqIGVhc3lYRE0KICogaHR0cDovL2Vhc3l4ZG0ubmV0LwogKiBDb3B5cmlnaHQoYykgMjAwOS0yMDExLCDDmHl2aW5kIFNlYW4gS2luc2V5LCBveXZpbmRAa2luc2V5Lm5vLgogKgogKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5CiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKICogdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKICoKICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KICogYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAogKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgogKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLAogKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOCiAqIFRIRSBTT0ZUV0FSRS4KICovCihmdW5jdGlvbihOLGQscCxLLGssSCl7dmFyIGI9dGhpczt2YXIgbj1NYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMTAwMDApO3ZhciBxPUZ1bmN0aW9uLnByb3RvdHlwZTt2YXIgUT0vXigoaHR0cC4/OilcL1wvKFteOlwvXHNdKykoOlxkKykqKS87dmFyIFI9L1tcLVx3XStcL1wuXC5cLy87dmFyIEY9LyhbXjpdKVwvXC8vZzt2YXIgST0iIjt2YXIgbz17fTt2YXIgTT1OLmVhc3lYRE07dmFyIFU9ImVhc3lYRE1fIjt2YXIgRTt2YXIgeT1mYWxzZTt2YXIgaTt2YXIgaDtmdW5jdGlvbiBDKFgsWil7dmFyIFk9dHlwZW9mIFhbWl07cmV0dXJuIFk9PSJmdW5jdGlvbiJ8fCghIShZPT0ib2JqZWN0IiYmWFtaXSkpfHxZPT0idW5rbm93biJ9ZnVuY3Rpb24gdShYLFkpe3JldHVybiAhISh0eXBlb2YoWFtZXSk9PSJvYmplY3QiJiZYW1ldKX1mdW5jdGlvbiByKFgpe3JldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoWCk9PT0iW29iamVjdCBBcnJheV0ifWZ1bmN0aW9uIGMoKXt0cnl7dmFyIFg9bmV3IEFjdGl2ZVhPYmplY3QoIlNob2Nrd2F2ZUZsYXNoLlNob2Nrd2F2ZUZsYXNoIik7aT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChYLkdldFZhcmlhYmxlKCIkdmVyc2lvbiIpLm1hdGNoKC8oXGQrKSwoXGQrKSwoXGQrKSwoXGQrKS8pLDEpO2g9cGFyc2VJbnQoaVswXSwxMCk+OSYmcGFyc2VJbnQoaVsxXSwxMCk+MDtYPW51bGw7cmV0dXJuIHRydWV9Y2F0Y2goWSl7cmV0dXJuIGZhbHNlfX12YXIgdix4O2lmKEMoTiwiYWRkRXZlbnRMaXN0ZW5lciIpKXt2PWZ1bmN0aW9uKFosWCxZKXtaLmFkZEV2ZW50TGlzdGVuZXIoWCxZLGZhbHNlKX07eD1mdW5jdGlvbihaLFgsWSl7Wi5yZW1vdmVFdmVudExpc3RlbmVyKFgsWSxmYWxzZSl9fWVsc2V7aWYoQyhOLCJhdHRhY2hFdmVudCIpKXt2PWZ1bmN0aW9uKFgsWixZKXtYLmF0dGFjaEV2ZW50KCJvbiIrWixZKX07eD1mdW5jdGlvbihYLFosWSl7WC5kZXRhY2hFdmVudCgib24iK1osWSl9fWVsc2V7dGhyb3cgbmV3IEVycm9yKCJCcm93c2VyIG5vdCBzdXBwb3J0ZWQiKX19dmFyIFc9ZmFsc2UsSj1bXSxMO2lmKCJyZWFkeVN0YXRlIiBpbiBkKXtMPWQucmVhZHlTdGF0ZTtXPUw9PSJjb21wbGV0ZSJ8fCh+bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJBcHBsZVdlYktpdC8iKSYmKEw9PSJsb2FkZWQifHxMPT0iaW50ZXJhY3RpdmUiKSl9ZWxzZXtXPSEhZC5ib2R5fWZ1bmN0aW9uIHMoKXtpZihXKXtyZXR1cm59Vz10cnVlO2Zvcih2YXIgWD0wO1g8Si5sZW5ndGg7WCsrKXtKW1hdKCl9Si5sZW5ndGg9MH1pZighVyl7aWYoQyhOLCJhZGRFdmVudExpc3RlbmVyIikpe3YoZCwiRE9NQ29udGVudExvYWRlZCIscyl9ZWxzZXt2KGQsInJlYWR5c3RhdGVjaGFuZ2UiLGZ1bmN0aW9uKCl7aWYoZC5yZWFkeVN0YXRlPT0iY29tcGxldGUiKXtzKCl9fSk7aWYoZC5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwmJk49PT10b3Ape3ZhciBnPWZ1bmN0aW9uKCl7aWYoVyl7cmV0dXJufXRyeXtkLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCgibGVmdCIpfWNhdGNoKFgpe0soZywxKTtyZXR1cm59cygpfTtnKCl9fXYoTiwibG9hZCIscyl9ZnVuY3Rpb24gRyhZLFgpe2lmKFcpe1kuY2FsbChYKTtyZXR1cm59Si5wdXNoKGZ1bmN0aW9uKCl7WS5jYWxsKFgpfSl9ZnVuY3Rpb24gbSgpe3ZhciBaPXBhcmVudDtpZihJIT09IiIpe2Zvcih2YXIgWD0wLFk9SS5zcGxpdCgiLiIpO1g8WS5sZW5ndGg7WCsrKXtaPVpbWVtYXV19fXJldHVybiBaLmVhc3lYRE19ZnVuY3Rpb24gZShYKXtOLmVhc3lYRE09TTtJPVg7aWYoSSl7VT0iZWFzeVhETV8iK0kucmVwbGFjZSgiLiIsIl8iKSsiXyJ9cmV0dXJuIG99ZnVuY3Rpb24geihYKXtyZXR1cm4gWC5tYXRjaChRKVszXX1mdW5jdGlvbiBmKFgpe3JldHVybiBYLm1hdGNoKFEpWzRdfHwiIn1mdW5jdGlvbiBqKFope3ZhciBYPVoudG9Mb3dlckNhc2UoKS5tYXRjaChRKTt2YXIgYWE9WFsyXSxhYj1YWzNdLFk9WFs0XXx8IiI7aWYoKGFhPT0iaHR0cDoiJiZZPT0iOjgwIil8fChhYT09Imh0dHBzOiImJlk9PSI6NDQzIikpe1k9IiJ9cmV0dXJuIGFhKyIvLyIrYWIrWX1mdW5jdGlvbiBCKFgpe1g9WC5yZXBsYWNlKEYsIiQxLyIpO2lmKCFYLm1hdGNoKC9eKGh0dHB8fGh0dHBzKTpcL1wvLykpe3ZhciBZPShYLnN1YnN0cmluZygwLDEpPT09Ii8iKT8iIjpwLnBhdGhuYW1lO2lmKFkuc3Vic3RyaW5nKFkubGVuZ3RoLTEpIT09Ii8iKXtZPVkuc3Vic3RyaW5nKDAsWS5sYXN0SW5kZXhPZigiLyIpKzEpfVg9cC5wcm90b2NvbCsiLy8iK3AuaG9zdCtZK1h9d2hpbGUoUi50ZXN0KFgpKXtYPVgucmVwbGFjZShSLCIiKX1yZXR1cm4gWH1mdW5jdGlvbiBQKFgsYWEpe3ZhciBhYz0iIixaPVguaW5kZXhPZigiIyIpO2lmKFohPT0tMSl7YWM9WC5zdWJzdHJpbmcoWik7WD1YLnN1YnN0cmluZygwLFopfXZhciBhYj1bXTtmb3IodmFyIFkgaW4gYWEpe2lmKGFhLmhhc093blByb3BlcnR5KFkpKXthYi5wdXNoKFkrIj0iK0goYWFbWV0pKX19cmV0dXJuIFgrKHk/IiMiOihYLmluZGV4T2YoIj8iKT09LTE/Ij8iOiImIikpK2FiLmpvaW4oIiYiKSthY312YXIgUz0oZnVuY3Rpb24oWCl7WD1YLnN1YnN0cmluZygxKS5zcGxpdCgiJiIpO3ZhciBaPXt9LGFhLFk9WC5sZW5ndGg7d2hpbGUoWS0tKXthYT1YW1ldLnNwbGl0KCI9Iik7WlthYVswXV09ayhhYVsxXSl9cmV0dXJuIFp9KC94ZG1fZT0vLnRlc3QocC5zZWFyY2gpP3Auc2VhcmNoOnAuaGFzaCkpO2Z1bmN0aW9uIHQoWCl7cmV0dXJuIHR5cGVvZiBYPT09InVuZGVmaW5lZCJ9dmFyIE89ZnVuY3Rpb24oKXt2YXIgWT17fTt2YXIgWj17YTpbMSwyLDNdfSxYPSd7ImEiOlsxLDIsM119JztpZih0eXBlb2YgSlNPTiE9InVuZGVmaW5lZCImJnR5cGVvZiBKU09OLnN0cmluZ2lmeT09PSJmdW5jdGlvbiImJkpTT04uc3RyaW5naWZ5KFopLnJlcGxhY2UoKC9ccy9nKSwiIik9PT1YKXtyZXR1cm4gSlNPTn1pZihPYmplY3QudG9KU09OKXtpZihPYmplY3QudG9KU09OKFopLnJlcGxhY2UoKC9ccy9nKSwiIik9PT1YKXtZLnN0cmluZ2lmeT1PYmplY3QudG9KU09OfX1pZih0eXBlb2YgU3RyaW5nLnByb3RvdHlwZS5ldmFsSlNPTj09PSJmdW5jdGlvbiIpe1o9WC5ldmFsSlNPTigpO2lmKFouYSYmWi5hLmxlbmd0aD09PTMmJlouYVsyXT09PTMpe1kucGFyc2U9ZnVuY3Rpb24oYWEpe3JldHVybiBhYS5ldmFsSlNPTigpfX19aWYoWS5zdHJpbmdpZnkmJlkucGFyc2Upe089ZnVuY3Rpb24oKXtyZXR1cm4gWX07cmV0dXJuIFl9cmV0dXJuIG51bGx9O2Z1bmN0aW9uIFQoWCxZLFope3ZhciBhYjtmb3IodmFyIGFhIGluIFkpe2lmKFkuaGFzT3duUHJvcGVydHkoYWEpKXtpZihhYSBpbiBYKXthYj1ZW2FhXTtpZih0eXBlb2YgYWI9PT0ib2JqZWN0Iil7VChYW2FhXSxhYixaKX1lbHNle2lmKCFaKXtYW2FhXT1ZW2FhXX19fWVsc2V7WFthYV09WVthYV19fX1yZXR1cm4gWH1mdW5jdGlvbiBhKCl7dmFyIFk9ZC5ib2R5LmFwcGVuZENoaWxkKGQuY3JlYXRlRWxlbWVudCgiZm9ybSIpKSxYPVkuYXBwZW5kQ2hpbGQoZC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpKTtYLm5hbWU9VSsiVEVTVCIrbjtFPVghPT1ZLmVsZW1lbnRzW1gubmFtZV07ZC5ib2R5LnJlbW92ZUNoaWxkKFkpfWZ1bmN0aW9uIEEoWCl7aWYodChFKSl7YSgpfXZhciBaO2lmKEUpe1o9ZC5jcmVhdGVFbGVtZW50KCc8aWZyYW1lIG5hbWU9IicrWC5wcm9wcy5uYW1lKyciLz4nKX1lbHNle1o9ZC5jcmVhdGVFbGVtZW50KCJJRlJBTUUiKTtaLm5hbWU9WC5wcm9wcy5uYW1lfVouaWQ9Wi5uYW1lPVgucHJvcHMubmFtZTtkZWxldGUgWC5wcm9wcy5uYW1lO2lmKFgub25Mb2FkKXt2KFosImxvYWQiLFgub25Mb2FkKX1pZih0eXBlb2YgWC5jb250YWluZXI9PSJzdHJpbmciKXtYLmNvbnRhaW5lcj1kLmdldEVsZW1lbnRCeUlkKFguY29udGFpbmVyKX1pZighWC5jb250YWluZXIpe1QoWi5zdHlsZSx7cG9zaXRpb246ImFic29sdXRlIix0b3A6Ii0yMDAwcHgifSk7WC5jb250YWluZXI9ZC5ib2R5fXZhciBZPVgucHJvcHMuc3JjO2RlbGV0ZSBYLnByb3BzLnNyYztUKFosWC5wcm9wcyk7Wi5ib3JkZXI9Wi5mcmFtZUJvcmRlcj0wO1ouYWxsb3dUcmFuc3BhcmVuY3k9dHJ1ZTtYLmNvbnRhaW5lci5hcHBlbmRDaGlsZChaKTtaLnNyYz1ZO1gucHJvcHMuc3JjPVk7cmV0dXJuIFp9ZnVuY3Rpb24gVihhYSxaKXtpZih0eXBlb2YgYWE9PSJzdHJpbmciKXthYT1bYWFdfXZhciBZLFg9YWEubGVuZ3RoO3doaWxlKFgtLSl7WT1hYVtYXTtZPW5ldyBSZWdFeHAoWS5zdWJzdHIoMCwxKT09Il4iP1k6KCJeIitZLnJlcGxhY2UoLyhcKikvZywiLiQxIikucmVwbGFjZSgvXD8vZywiLiIpKyIkIikpO2lmKFkudGVzdChaKSl7cmV0dXJuIHRydWV9fXJldHVybiBmYWxzZX1mdW5jdGlvbiBsKFope3ZhciBhZT1aLnByb3RvY29sLFk7Wi5pc0hvc3Q9Wi5pc0hvc3R8fHQoUy54ZG1fcCk7eT1aLmhhc2h8fGZhbHNlO2lmKCFaLnByb3BzKXtaLnByb3BzPXt9fWlmKCFaLmlzSG9zdCl7Wi5jaGFubmVsPVMueGRtX2M7Wi5zZWNyZXQ9Uy54ZG1fcztaLnJlbW90ZT1TLnhkbV9lO2FlPVMueGRtX3A7aWYoWi5hY2wmJiFWKFouYWNsLFoucmVtb3RlKSl7dGhyb3cgbmV3IEVycm9yKCJBY2Nlc3MgZGVuaWVkIGZvciAiK1oucmVtb3RlKX19ZWxzZXtaLnJlbW90ZT1CKFoucmVtb3RlKTtaLmNoYW5uZWw9Wi5jaGFubmVsfHwiZGVmYXVsdCIrbisrO1ouc2VjcmV0PU1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygyKTtpZih0KGFlKSl7aWYoaihwLmhyZWYpPT1qKFoucmVtb3RlKSl7YWU9IjQifWVsc2V7aWYoQyhOLCJwb3N0TWVzc2FnZSIpfHxDKGQsInBvc3RNZXNzYWdlIikpe2FlPSIxIn1lbHNle2lmKFouc3dmJiZDKE4sIkFjdGl2ZVhPYmplY3QiKSYmYygpKXthZT0iNiJ9ZWxzZXtpZihuYXZpZ2F0b3IucHJvZHVjdD09PSJHZWNrbyImJiJmcmFtZUVsZW1lbnQiIGluIE4mJm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiV2ViS2l0Iik9PS0xKXthZT0iNSJ9ZWxzZXtpZihaLnJlbW90ZUhlbHBlcil7Wi5yZW1vdGVIZWxwZXI9QihaLnJlbW90ZUhlbHBlcik7YWU9IjIifWVsc2V7YWU9IjAifX19fX19fVoucHJvdG9jb2w9YWU7c3dpdGNoKGFlKXtjYXNlIjAiOlQoWix7aW50ZXJ2YWw6MTAwLGRlbGF5OjIwMDAsdXNlUmVzaXplOnRydWUsdXNlUGFyZW50OmZhbHNlLHVzZVBvbGxpbmc6ZmFsc2V9LHRydWUpO2lmKFouaXNIb3N0KXtpZighWi5sb2NhbCl7dmFyIGFjPXAucHJvdG9jb2wrIi8vIitwLmhvc3QsWD1kLmJvZHkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImltZyIpLGFkO3ZhciBhYT1YLmxlbmd0aDt3aGlsZShhYS0tKXthZD1YW2FhXTtpZihhZC5zcmMuc3Vic3RyaW5nKDAsYWMubGVuZ3RoKT09PWFjKXtaLmxvY2FsPWFkLnNyYzticmVha319aWYoIVoubG9jYWwpe1oubG9jYWw9Tn19dmFyIGFiPXt4ZG1fYzpaLmNoYW5uZWwseGRtX3A6MH07aWYoWi5sb2NhbD09PU4pe1oudXNlUG9sbGluZz10cnVlO1oudXNlUGFyZW50PXRydWU7Wi5sb2NhbD1wLnByb3RvY29sKyIvLyIrcC5ob3N0K3AucGF0aG5hbWUrcC5zZWFyY2g7YWIueGRtX2U9Wi5sb2NhbDthYi54ZG1fcGE9MX1lbHNle2FiLnhkbV9lPUIoWi5sb2NhbCl9aWYoWi5jb250YWluZXIpe1oudXNlUmVzaXplPWZhbHNlO2FiLnhkbV9wbz0xfVoucmVtb3RlPVAoWi5yZW1vdGUsYWIpfWVsc2V7VChaLHtjaGFubmVsOlMueGRtX2MscmVtb3RlOlMueGRtX2UsdXNlUGFyZW50OiF0KFMueGRtX3BhKSx1c2VQb2xsaW5nOiF0KFMueGRtX3BvKSx1c2VSZXNpemU6Wi51c2VQYXJlbnQ/ZmFsc2U6Wi51c2VSZXNpemV9KX1ZPVtuZXcgby5zdGFjay5IYXNoVHJhbnNwb3J0KFopLG5ldyBvLnN0YWNrLlJlbGlhYmxlQmVoYXZpb3Ioe30pLG5ldyBvLnN0YWNrLlF1ZXVlQmVoYXZpb3Ioe2VuY29kZTp0cnVlLG1heExlbmd0aDo0MDAwLVoucmVtb3RlLmxlbmd0aH0pLG5ldyBvLnN0YWNrLlZlcmlmeUJlaGF2aW9yKHtpbml0aWF0ZTpaLmlzSG9zdH0pXTticmVhaztjYXNlIjEiOlk9W25ldyBvLnN0YWNrLlBvc3RNZXNzYWdlVHJhbnNwb3J0KFopXTticmVhaztjYXNlIjIiOlk9W25ldyBvLnN0YWNrLk5hbWVUcmFuc3BvcnQoWiksbmV3IG8uc3RhY2suUXVldWVCZWhhdmlvcigpLG5ldyBvLnN0YWNrLlZlcmlmeUJlaGF2aW9yKHtpbml0aWF0ZTpaLmlzSG9zdH0pXTticmVhaztjYXNlIjMiOlk9W25ldyBvLnN0YWNrLk5peFRyYW5zcG9ydChaKV07YnJlYWs7Y2FzZSI0IjpZPVtuZXcgby5zdGFjay5TYW1lT3JpZ2luVHJhbnNwb3J0KFopXTticmVhaztjYXNlIjUiOlk9W25ldyBvLnN0YWNrLkZyYW1lRWxlbWVudFRyYW5zcG9ydChaKV07YnJlYWs7Y2FzZSI2IjppZighaSl7YygpfVk9W25ldyBvLnN0YWNrLkZsYXNoVHJhbnNwb3J0KFopXTticmVha31ZLnB1c2gobmV3IG8uc3RhY2suUXVldWVCZWhhdmlvcih7bGF6eTpaLmxhenkscmVtb3ZlOnRydWV9KSk7cmV0dXJuIFl9ZnVuY3Rpb24gRChhYSl7dmFyIGFiLFo9e2luY29taW5nOmZ1bmN0aW9uKGFkLGFjKXt0aGlzLnVwLmluY29taW5nKGFkLGFjKX0sb3V0Z29pbmc6ZnVuY3Rpb24oYWMsYWQpe3RoaXMuZG93bi5vdXRnb2luZyhhYyxhZCl9LGNhbGxiYWNrOmZ1bmN0aW9uKGFjKXt0aGlzLnVwLmNhbGxiYWNrKGFjKX0saW5pdDpmdW5jdGlvbigpe3RoaXMuZG93bi5pbml0KCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmRvd24uZGVzdHJveSgpfX07Zm9yKHZhciBZPTAsWD1hYS5sZW5ndGg7WTxYO1krKyl7YWI9YWFbWV07VChhYixaLHRydWUpO2lmKFkhPT0wKXthYi5kb3duPWFhW1ktMV19aWYoWSE9PVgtMSl7YWIudXA9YWFbWSsxXX19cmV0dXJuIGFifWZ1bmN0aW9uIHcoWCl7WC51cC5kb3duPVguZG93bjtYLmRvd24udXA9WC51cDtYLnVwPVguZG93bj1udWxsfVQobyx7dmVyc2lvbjoiMi40LjE1LjExOCIscXVlcnk6UyxzdGFjazp7fSxhcHBseTpULGdldEpTT05PYmplY3Q6Tyx3aGVuUmVhZHk6Ryxub0NvbmZsaWN0OmV9KTtvLkRvbUhlbHBlcj17b246dix1bjp4LHJlcXVpcmVzSlNPTjpmdW5jdGlvbihYKXtpZighdShOLCJKU09OIikpe2Qud3JpdGUoJzxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9IicrWCsnIj48XC9zY3JpcHQ+Jyl9fX07KGZ1bmN0aW9uKCl7dmFyIFg9e307by5Gbj17c2V0OmZ1bmN0aW9uKFksWil7WFtZXT1afSxnZXQ6ZnVuY3Rpb24oWixZKXt2YXIgYWE9WFtaXTtpZihZKXtkZWxldGUgWFtaXX1yZXR1cm4gYWF9fX0oKSk7by5Tb2NrZXQ9ZnVuY3Rpb24oWSl7dmFyIFg9RChsKFkpLmNvbmNhdChbe2luY29taW5nOmZ1bmN0aW9uKGFiLGFhKXtZLm9uTWVzc2FnZShhYixhYSl9LGNhbGxiYWNrOmZ1bmN0aW9uKGFhKXtpZihZLm9uUmVhZHkpe1kub25SZWFkeShhYSl9fX1dKSksWj1qKFkucmVtb3RlKTt0aGlzLm9yaWdpbj1qKFkucmVtb3RlKTt0aGlzLmRlc3Ryb3k9ZnVuY3Rpb24oKXtYLmRlc3Ryb3koKX07dGhpcy5wb3N0TWVzc2FnZT1mdW5jdGlvbihhYSl7WC5vdXRnb2luZyhhYSxaKX07WC5pbml0KCl9O28uUnBjPWZ1bmN0aW9uKFosWSl7aWYoWS5sb2NhbCl7Zm9yKHZhciBhYiBpbiBZLmxvY2FsKXtpZihZLmxvY2FsLmhhc093blByb3BlcnR5KGFiKSl7dmFyIGFhPVkubG9jYWxbYWJdO2lmKHR5cGVvZiBhYT09PSJmdW5jdGlvbiIpe1kubG9jYWxbYWJdPXttZXRob2Q6YWF9fX19fXZhciBYPUQobChaKS5jb25jYXQoW25ldyBvLnN0YWNrLlJwY0JlaGF2aW9yKHRoaXMsWSkse2NhbGxiYWNrOmZ1bmN0aW9uKGFjKXtpZihaLm9uUmVhZHkpe1oub25SZWFkeShhYyl9fX1dKSk7dGhpcy5vcmlnaW49aihaLnJlbW90ZSk7dGhpcy5kZXN0cm95PWZ1bmN0aW9uKCl7WC5kZXN0cm95KCl9O1guaW5pdCgpfTtvLnN0YWNrLlNhbWVPcmlnaW5UcmFuc3BvcnQ9ZnVuY3Rpb24oWSl7dmFyIFosYWIsYWEsWDtyZXR1cm4oWj17b3V0Z29pbmc6ZnVuY3Rpb24oYWQsYWUsYWMpe2FhKGFkKTtpZihhYyl7YWMoKX19LGRlc3Ryb3k6ZnVuY3Rpb24oKXtpZihhYil7YWIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhYik7YWI9bnVsbH19LG9uRE9NUmVhZHk6ZnVuY3Rpb24oKXtYPWooWS5yZW1vdGUpO2lmKFkuaXNIb3N0KXtUKFkucHJvcHMse3NyYzpQKFkucmVtb3RlLHt4ZG1fZTpwLnByb3RvY29sKyIvLyIrcC5ob3N0K3AucGF0aG5hbWUseGRtX2M6WS5jaGFubmVsLHhkbV9wOjR9KSxuYW1lOlUrWS5jaGFubmVsKyJfcHJvdmlkZXIifSk7YWI9QShZKTtvLkZuLnNldChZLmNoYW5uZWwsZnVuY3Rpb24oYWMpe2FhPWFjO0soZnVuY3Rpb24oKXtaLnVwLmNhbGxiYWNrKHRydWUpfSwwKTtyZXR1cm4gZnVuY3Rpb24oYWQpe1oudXAuaW5jb21pbmcoYWQsWCl9fSl9ZWxzZXthYT1tKCkuRm4uZ2V0KFkuY2hhbm5lbCx0cnVlKShmdW5jdGlvbihhYyl7Wi51cC5pbmNvbWluZyhhYyxYKX0pO0soZnVuY3Rpb24oKXtaLnVwLmNhbGxiYWNrKHRydWUpfSwwKX19LGluaXQ6ZnVuY3Rpb24oKXtHKFoub25ET01SZWFkeSxaKX19KX07by5zdGFjay5GbGFzaFRyYW5zcG9ydD1mdW5jdGlvbihhYSl7dmFyIGFjLFgsYWIsYWQsWSxhZTtmdW5jdGlvbiBhZihhaCxhZyl7SyhmdW5jdGlvbigpe2FjLnVwLmluY29taW5nKGFoLGFkKX0sMCl9ZnVuY3Rpb24gWihhaCl7dmFyIGFnPWFhLnN3ZisiP2hvc3Q9IithYS5pc0hvc3Q7dmFyIGFqPSJlYXN5WERNX3N3Zl8iK01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoxMDAwMCk7by5Gbi5zZXQoImZsYXNoX2xvYWRlZCIrYWgucmVwbGFjZSgvW1wtLl0vZywiXyIpLGZ1bmN0aW9uKCl7by5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF0uc3dmPVk9YWUuZmlyc3RDaGlsZDt2YXIgYWs9by5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF0ucXVldWU7Zm9yKHZhciBhbD0wO2FsPGFrLmxlbmd0aDthbCsrKXtha1thbF0oKX1hay5sZW5ndGg9MH0pO2lmKGFhLnN3ZkNvbnRhaW5lcil7YWU9KHR5cGVvZiBhYS5zd2ZDb250YWluZXI9PSJzdHJpbmciKT9kLmdldEVsZW1lbnRCeUlkKGFhLnN3ZkNvbnRhaW5lcik6YWEuc3dmQ29udGFpbmVyfWVsc2V7YWU9ZC5jcmVhdGVFbGVtZW50KCJkaXYiKTtUKGFlLnN0eWxlLGgmJmFhLnN3Zk5vVGhyb3R0bGU/e2hlaWdodDoiMjBweCIsd2lkdGg6IjIwcHgiLHBvc2l0aW9uOiJmaXhlZCIscmlnaHQ6MCx0b3A6MH06e2hlaWdodDoiMXB4Iix3aWR0aDoiMXB4Iixwb3NpdGlvbjoiYWJzb2x1dGUiLG92ZXJmbG93OiJoaWRkZW4iLHJpZ2h0OjAsdG9wOjB9KTtkLmJvZHkuYXBwZW5kQ2hpbGQoYWUpfXZhciBhaT0iY2FsbGJhY2s9Zmxhc2hfbG9hZGVkIithaC5yZXBsYWNlKC9bXC0uXS9nLCJfIikrIiZwcm90bz0iK2IubG9jYXRpb24ucHJvdG9jb2wrIiZkb21haW49Iit6KGIubG9jYXRpb24uaHJlZikrIiZwb3J0PSIrZihiLmxvY2F0aW9uLmhyZWYpKyImbnM9IitJO2FlLmlubmVySFRNTD0iPG9iamVjdCBoZWlnaHQ9JzIwJyB3aWR0aD0nMjAnIHR5cGU9J2FwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoJyBpZD0nIithaisiJyBkYXRhPSciK2FnKyInPjxwYXJhbSBuYW1lPSdhbGxvd1NjcmlwdEFjY2VzcycgdmFsdWU9J2Fsd2F5cyc+PC9wYXJhbT48cGFyYW0gbmFtZT0nd21vZGUnIHZhbHVlPSd0cmFuc3BhcmVudCc+PHBhcmFtIG5hbWU9J21vdmllJyB2YWx1ZT0nIithZysiJz48L3BhcmFtPjxwYXJhbSBuYW1lPSdmbGFzaHZhcnMnIHZhbHVlPSciK2FpKyInPjwvcGFyYW0+PGVtYmVkIHR5cGU9J2FwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoJyBGbGFzaFZhcnM9JyIrYWkrIicgYWxsb3dTY3JpcHRBY2Nlc3M9J2Fsd2F5cycgd21vZGU9J3RyYW5zcGFyZW50JyBzcmM9JyIrYWcrIicgaGVpZ2h0PScxJyB3aWR0aD0nMSc+PC9lbWJlZD48L29iamVjdD4ifXJldHVybihhYz17b3V0Z29pbmc6ZnVuY3Rpb24oYWgsYWksYWcpe1kucG9zdE1lc3NhZ2UoYWEuY2hhbm5lbCxhaC50b1N0cmluZygpKTtpZihhZyl7YWcoKX19LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0cnl7WS5kZXN0cm95Q2hhbm5lbChhYS5jaGFubmVsKX1jYXRjaChhZyl7fVk9bnVsbDtpZihYKXtYLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoWCk7WD1udWxsfX0sb25ET01SZWFkeTpmdW5jdGlvbigpe2FkPWFhLnJlbW90ZTtvLkZuLnNldCgiZmxhc2hfIithYS5jaGFubmVsKyJfaW5pdCIsZnVuY3Rpb24oKXtLKGZ1bmN0aW9uKCl7YWMudXAuY2FsbGJhY2sodHJ1ZSl9KX0pO28uRm4uc2V0KCJmbGFzaF8iK2FhLmNoYW5uZWwrIl9vbk1lc3NhZ2UiLGFmKTthYS5zd2Y9QihhYS5zd2YpO3ZhciBhaD16KGFhLnN3Zik7dmFyIGFnPWZ1bmN0aW9uKCl7by5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF0uaW5pdD10cnVlO1k9by5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF0uc3dmO1kuY3JlYXRlQ2hhbm5lbChhYS5jaGFubmVsLGFhLnNlY3JldCxqKGFhLnJlbW90ZSksYWEuaXNIb3N0KTtpZihhYS5pc0hvc3Qpe2lmKGgmJmFhLnN3Zk5vVGhyb3R0bGUpe1QoYWEucHJvcHMse3Bvc2l0aW9uOiJmaXhlZCIscmlnaHQ6MCx0b3A6MCxoZWlnaHQ6IjIwcHgiLHdpZHRoOiIyMHB4In0pfVQoYWEucHJvcHMse3NyYzpQKGFhLnJlbW90ZSx7eGRtX2U6aihwLmhyZWYpLHhkbV9jOmFhLmNoYW5uZWwseGRtX3A6Nix4ZG1fczphYS5zZWNyZXR9KSxuYW1lOlUrYWEuY2hhbm5lbCsiX3Byb3ZpZGVyIn0pO1g9QShhYSl9fTtpZihvLnN0YWNrLkZsYXNoVHJhbnNwb3J0W2FoXSYmby5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF0uaW5pdCl7YWcoKX1lbHNle2lmKCFvLnN0YWNrLkZsYXNoVHJhbnNwb3J0W2FoXSl7by5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF09e3F1ZXVlOlthZ119O1ooYWgpfWVsc2V7by5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF0ucXVldWUucHVzaChhZyl9fX0saW5pdDpmdW5jdGlvbigpe0coYWMub25ET01SZWFkeSxhYyl9fSl9O28uc3RhY2suUG9zdE1lc3NhZ2VUcmFuc3BvcnQ9ZnVuY3Rpb24oYWEpe3ZhciBhYyxhZCxZLFo7ZnVuY3Rpb24gWChhZSl7aWYoYWUub3JpZ2luKXtyZXR1cm4gaihhZS5vcmlnaW4pfWlmKGFlLnVyaSl7cmV0dXJuIGooYWUudXJpKX1pZihhZS5kb21haW4pe3JldHVybiBwLnByb3RvY29sKyIvLyIrYWUuZG9tYWlufXRocm93IlVuYWJsZSB0byByZXRyaWV2ZSB0aGUgb3JpZ2luIG9mIHRoZSBldmVudCJ9ZnVuY3Rpb24gYWIoYWYpe3ZhciBhZT1YKGFmKTtpZihhZT09WiYmYWYuZGF0YS5zdWJzdHJpbmcoMCxhYS5jaGFubmVsLmxlbmd0aCsxKT09YWEuY2hhbm5lbCsiICIpe2FjLnVwLmluY29taW5nKGFmLmRhdGEuc3Vic3RyaW5nKGFhLmNoYW5uZWwubGVuZ3RoKzEpLGFlKX19cmV0dXJuKGFjPXtvdXRnb2luZzpmdW5jdGlvbihhZixhZyxhZSl7WS5wb3N0TWVzc2FnZShhYS5jaGFubmVsKyIgIithZixhZ3x8Wik7aWYoYWUpe2FlKCl9fSxkZXN0cm95OmZ1bmN0aW9uKCl7eChOLCJtZXNzYWdlIixhYik7aWYoYWQpe1k9bnVsbDthZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFkKTthZD1udWxsfX0sb25ET01SZWFkeTpmdW5jdGlvbigpe1o9aihhYS5yZW1vdGUpO2lmKGFhLmlzSG9zdCl7dmFyIGFlPWZ1bmN0aW9uKGFmKXtpZihhZi5kYXRhPT1hYS5jaGFubmVsKyItcmVhZHkiKXtZPSgicG9zdE1lc3NhZ2UiIGluIGFkLmNvbnRlbnRXaW5kb3cpP2FkLmNvbnRlbnRXaW5kb3c6YWQuY29udGVudFdpbmRvdy5kb2N1bWVudDt4KE4sIm1lc3NhZ2UiLGFlKTt2KE4sIm1lc3NhZ2UiLGFiKTtLKGZ1bmN0aW9uKCl7YWMudXAuY2FsbGJhY2sodHJ1ZSl9LDApfX07dihOLCJtZXNzYWdlIixhZSk7VChhYS5wcm9wcyx7c3JjOlAoYWEucmVtb3RlLHt4ZG1fZTpqKHAuaHJlZikseGRtX2M6YWEuY2hhbm5lbCx4ZG1fcDoxfSksbmFtZTpVK2FhLmNoYW5uZWwrIl9wcm92aWRlciJ9KTthZD1BKGFhKX1lbHNle3YoTiwibWVzc2FnZSIsYWIpO1k9KCJwb3N0TWVzc2FnZSIgaW4gTi5wYXJlbnQpP04ucGFyZW50Ok4ucGFyZW50LmRvY3VtZW50O1kucG9zdE1lc3NhZ2UoYWEuY2hhbm5lbCsiLXJlYWR5IixaKTtLKGZ1bmN0aW9uKCl7YWMudXAuY2FsbGJhY2sodHJ1ZSl9LDApfX0saW5pdDpmdW5jdGlvbigpe0coYWMub25ET01SZWFkeSxhYyl9fSl9O28uc3RhY2suRnJhbWVFbGVtZW50VHJhbnNwb3J0PWZ1bmN0aW9uKFkpe3ZhciBaLGFiLGFhLFg7cmV0dXJuKFo9e291dGdvaW5nOmZ1bmN0aW9uKGFkLGFlLGFjKXthYS5jYWxsKHRoaXMsYWQpO2lmKGFjKXthYygpfX0sZGVzdHJveTpmdW5jdGlvbigpe2lmKGFiKXthYi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFiKTthYj1udWxsfX0sb25ET01SZWFkeTpmdW5jdGlvbigpe1g9aihZLnJlbW90ZSk7aWYoWS5pc0hvc3Qpe1QoWS5wcm9wcyx7c3JjOlAoWS5yZW1vdGUse3hkbV9lOmoocC5ocmVmKSx4ZG1fYzpZLmNoYW5uZWwseGRtX3A6NX0pLG5hbWU6VStZLmNoYW5uZWwrIl9wcm92aWRlciJ9KTthYj1BKFkpO2FiLmZuPWZ1bmN0aW9uKGFjKXtkZWxldGUgYWIuZm47YWE9YWM7SyhmdW5jdGlvbigpe1oudXAuY2FsbGJhY2sodHJ1ZSl9LDApO3JldHVybiBmdW5jdGlvbihhZCl7Wi51cC5pbmNvbWluZyhhZCxYKX19fWVsc2V7aWYoZC5yZWZlcnJlciYmaihkLnJlZmVycmVyKSE9Uy54ZG1fZSl7Ti50b3AubG9jYXRpb249Uy54ZG1fZX1hYT1OLmZyYW1lRWxlbWVudC5mbihmdW5jdGlvbihhYyl7Wi51cC5pbmNvbWluZyhhYyxYKX0pO1oudXAuY2FsbGJhY2sodHJ1ZSl9fSxpbml0OmZ1bmN0aW9uKCl7RyhaLm9uRE9NUmVhZHksWil9fSl9O28uc3RhY2suTmFtZVRyYW5zcG9ydD1mdW5jdGlvbihhYil7dmFyIGFjO3ZhciBhZSxhaSxhYSxhZyxhaCxZLFg7ZnVuY3Rpb24gYWYoYWwpe3ZhciBhaz1hYi5yZW1vdGVIZWxwZXIrKGFlPyIjXzMiOiIjXzIiKSthYi5jaGFubmVsO2FpLmNvbnRlbnRXaW5kb3cuc2VuZE1lc3NhZ2UoYWwsYWspfWZ1bmN0aW9uIGFkKCl7aWYoYWUpe2lmKCsrYWc9PT0yfHwhYWUpe2FjLnVwLmNhbGxiYWNrKHRydWUpfX1lbHNle2FmKCJyZWFkeSIpO2FjLnVwLmNhbGxiYWNrKHRydWUpfX1mdW5jdGlvbiBhaihhayl7YWMudXAuaW5jb21pbmcoYWssWSl9ZnVuY3Rpb24gWigpe2lmKGFoKXtLKGZ1bmN0aW9uKCl7YWgodHJ1ZSl9LDApfX1yZXR1cm4oYWM9e291dGdvaW5nOmZ1bmN0aW9uKGFsLGFtLGFrKXthaD1hazthZihhbCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXthaS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFpKTthaT1udWxsO2lmKGFlKXthYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFhKTthYT1udWxsfX0sb25ET01SZWFkeTpmdW5jdGlvbigpe2FlPWFiLmlzSG9zdDthZz0wO1k9aihhYi5yZW1vdGUpO2FiLmxvY2FsPUIoYWIubG9jYWwpO2lmKGFlKXtvLkZuLnNldChhYi5jaGFubmVsLGZ1bmN0aW9uKGFsKXtpZihhZSYmYWw9PT0icmVhZHkiKXtvLkZuLnNldChhYi5jaGFubmVsLGFqKTthZCgpfX0pO1g9UChhYi5yZW1vdGUse3hkbV9lOmFiLmxvY2FsLHhkbV9jOmFiLmNoYW5uZWwseGRtX3A6Mn0pO1QoYWIucHJvcHMse3NyYzpYKyIjIithYi5jaGFubmVsLG5hbWU6VSthYi5jaGFubmVsKyJfcHJvdmlkZXIifSk7YWE9QShhYil9ZWxzZXthYi5yZW1vdGVIZWxwZXI9YWIucmVtb3RlO28uRm4uc2V0KGFiLmNoYW5uZWwsYWopfWFpPUEoe3Byb3BzOntzcmM6YWIubG9jYWwrIiNfNCIrYWIuY2hhbm5lbH0sb25Mb2FkOmZ1bmN0aW9uIGFrKCl7dmFyIGFsPWFpfHx0aGlzO3goYWwsImxvYWQiLGFrKTtvLkZuLnNldChhYi5jaGFubmVsKyJfbG9hZCIsWik7KGZ1bmN0aW9uIGFtKCl7aWYodHlwZW9mIGFsLmNvbnRlbnRXaW5kb3cuc2VuZE1lc3NhZ2U9PSJmdW5jdGlvbiIpe2FkKCl9ZWxzZXtLKGFtLDUwKX19KCkpfX0pfSxpbml0OmZ1bmN0aW9uKCl7RyhhYy5vbkRPTVJlYWR5LGFjKX19KX07by5zdGFjay5IYXNoVHJhbnNwb3J0PWZ1bmN0aW9uKFope3ZhciBhYzt2YXIgYWg9dGhpcyxhZixhYSxYLGFkLGFtLGFiLGFsO3ZhciBhZyxZO2Z1bmN0aW9uIGFrKGFvKXtpZighYWwpe3JldHVybn12YXIgYW49Wi5yZW1vdGUrIiMiKyhhbSsrKSsiXyIrYW87KChhZnx8IWFnKT9hbC5jb250ZW50V2luZG93OmFsKS5sb2NhdGlvbj1hbn1mdW5jdGlvbiBhZShhbil7YWQ9YW47YWMudXAuaW5jb21pbmcoYWQuc3Vic3RyaW5nKGFkLmluZGV4T2YoIl8iKSsxKSxZKX1mdW5jdGlvbiBhaigpe2lmKCFhYil7cmV0dXJufXZhciBhbj1hYi5sb2NhdGlvbi5ocmVmLGFwPSIiLGFvPWFuLmluZGV4T2YoIiMiKTtpZihhbyE9LTEpe2FwPWFuLnN1YnN0cmluZyhhbyl9aWYoYXAmJmFwIT1hZCl7YWUoYXApfX1mdW5jdGlvbiBhaSgpe2FhPXNldEludGVydmFsKGFqLFgpfXJldHVybihhYz17b3V0Z29pbmc6ZnVuY3Rpb24oYW4sYW8pe2FrKGFuKX0sZGVzdHJveTpmdW5jdGlvbigpe04uY2xlYXJJbnRlcnZhbChhYSk7aWYoYWZ8fCFhZyl7YWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhbCl9YWw9bnVsbH0sb25ET01SZWFkeTpmdW5jdGlvbigpe2FmPVouaXNIb3N0O1g9Wi5pbnRlcnZhbDthZD0iIyIrWi5jaGFubmVsO2FtPTA7YWc9Wi51c2VQYXJlbnQ7WT1qKFoucmVtb3RlKTtpZihhZil7Wi5wcm9wcz17c3JjOloucmVtb3RlLG5hbWU6VStaLmNoYW5uZWwrIl9wcm92aWRlciJ9O2lmKGFnKXtaLm9uTG9hZD1mdW5jdGlvbigpe2FiPU47YWkoKTthYy51cC5jYWxsYmFjayh0cnVlKX19ZWxzZXt2YXIgYXA9MCxhbj1aLmRlbGF5LzUwOyhmdW5jdGlvbiBhbygpe2lmKCsrYXA+YW4pe3Rocm93IG5ldyBFcnJvcigiVW5hYmxlIHRvIHJlZmVyZW5jZSBsaXN0ZW5lcndpbmRvdyIpfXRyeXthYj1hbC5jb250ZW50V2luZG93LmZyYW1lc1tVK1ouY2hhbm5lbCsiX2NvbnN1bWVyIl19Y2F0Y2goYXEpe31pZihhYil7YWkoKTthYy51cC5jYWxsYmFjayh0cnVlKX1lbHNle0soYW8sNTApfX0oKSl9YWw9QShaKX1lbHNle2FiPU47YWkoKTtpZihhZyl7YWw9cGFyZW50O2FjLnVwLmNhbGxiYWNrKHRydWUpfWVsc2V7VChaLHtwcm9wczp7c3JjOloucmVtb3RlKyIjIitaLmNoYW5uZWwrbmV3IERhdGUoKSxuYW1lOlUrWi5jaGFubmVsKyJfY29uc3VtZXIifSxvbkxvYWQ6ZnVuY3Rpb24oKXthYy51cC5jYWxsYmFjayh0cnVlKX19KTthbD1BKFopfX19LGluaXQ6ZnVuY3Rpb24oKXtHKGFjLm9uRE9NUmVhZHksYWMpfX0pfTtvLnN0YWNrLlJlbGlhYmxlQmVoYXZpb3I9ZnVuY3Rpb24oWSl7dmFyIGFhLGFjO3ZhciBhYj0wLFg9MCxaPSIiO3JldHVybihhYT17aW5jb21pbmc6ZnVuY3Rpb24oYWYsYWQpe3ZhciBhZT1hZi5pbmRleE9mKCJfIiksYWc9YWYuc3Vic3RyaW5nKDAsYWUpLnNwbGl0KCIsIik7YWY9YWYuc3Vic3RyaW5nKGFlKzEpO2lmKGFnWzBdPT1hYil7Wj0iIjtpZihhYyl7YWModHJ1ZSl9fWlmKGFmLmxlbmd0aD4wKXthYS5kb3duLm91dGdvaW5nKGFnWzFdKyIsIithYisiXyIrWixhZCk7aWYoWCE9YWdbMV0pe1g9YWdbMV07YWEudXAuaW5jb21pbmcoYWYsYWQpfX19LG91dGdvaW5nOmZ1bmN0aW9uKGFmLGFkLGFlKXtaPWFmO2FjPWFlO2FhLmRvd24ub3V0Z29pbmcoWCsiLCIrKCsrYWIpKyJfIithZixhZCl9fSl9O28uc3RhY2suUXVldWVCZWhhdmlvcj1mdW5jdGlvbihaKXt2YXIgYWMsYWQ9W10sYWc9dHJ1ZSxhYT0iIixhZixYPTAsWT1mYWxzZSxhYj1mYWxzZTtmdW5jdGlvbiBhZSgpe2lmKFoucmVtb3ZlJiZhZC5sZW5ndGg9PT0wKXt3KGFjKTtyZXR1cm59aWYoYWd8fGFkLmxlbmd0aD09PTB8fGFmKXtyZXR1cm59YWc9dHJ1ZTt2YXIgYWg9YWQuc2hpZnQoKTthYy5kb3duLm91dGdvaW5nKGFoLmRhdGEsYWgub3JpZ2luLGZ1bmN0aW9uKGFpKXthZz1mYWxzZTtpZihhaC5jYWxsYmFjayl7SyhmdW5jdGlvbigpe2FoLmNhbGxiYWNrKGFpKX0sMCl9YWUoKX0pfXJldHVybihhYz17aW5pdDpmdW5jdGlvbigpe2lmKHQoWikpe1o9e319aWYoWi5tYXhMZW5ndGgpe1g9Wi5tYXhMZW5ndGg7YWI9dHJ1ZX1pZihaLmxhenkpe1k9dHJ1ZX1lbHNle2FjLmRvd24uaW5pdCgpfX0sY2FsbGJhY2s6ZnVuY3Rpb24oYWkpe2FnPWZhbHNlO3ZhciBhaD1hYy51cDthZSgpO2FoLmNhbGxiYWNrKGFpKX0saW5jb21pbmc6ZnVuY3Rpb24oYWssYWkpe2lmKGFiKXt2YXIgYWo9YWsuaW5kZXhPZigiXyIpLGFoPXBhcnNlSW50KGFrLnN1YnN0cmluZygwLGFqKSwxMCk7YWErPWFrLnN1YnN0cmluZyhhaisxKTtpZihhaD09PTApe2lmKFouZW5jb2RlKXthYT1rKGFhKX1hYy51cC5pbmNvbWluZyhhYSxhaSk7YWE9IiJ9fWVsc2V7YWMudXAuaW5jb21pbmcoYWssYWkpfX0sb3V0Z29pbmc6ZnVuY3Rpb24oYWwsYWksYWspe2lmKFouZW5jb2RlKXthbD1IKGFsKX12YXIgYWg9W10sYWo7aWYoYWIpe3doaWxlKGFsLmxlbmd0aCE9PTApe2FqPWFsLnN1YnN0cmluZygwLFgpO2FsPWFsLnN1YnN0cmluZyhhai5sZW5ndGgpO2FoLnB1c2goYWopfXdoaWxlKChhaj1haC5zaGlmdCgpKSl7YWQucHVzaCh7ZGF0YTphaC5sZW5ndGgrIl8iK2FqLG9yaWdpbjphaSxjYWxsYmFjazphaC5sZW5ndGg9PT0wP2FrOm51bGx9KX19ZWxzZXthZC5wdXNoKHtkYXRhOmFsLG9yaWdpbjphaSxjYWxsYmFjazpha30pfWlmKFkpe2FjLmRvd24uaW5pdCgpfWVsc2V7YWUoKX19LGRlc3Ryb3k6ZnVuY3Rpb24oKXthZj10cnVlO2FjLmRvd24uZGVzdHJveSgpfX0pfTtvLnN0YWNrLlZlcmlmeUJlaGF2aW9yPWZ1bmN0aW9uKGFiKXt2YXIgYWMsYWEsWSxaPWZhbHNlO2Z1bmN0aW9uIFgoKXthYT1NYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMik7YWMuZG93bi5vdXRnb2luZyhhYSl9cmV0dXJuKGFjPXtpbmNvbWluZzpmdW5jdGlvbihhZixhZCl7dmFyIGFlPWFmLmluZGV4T2YoIl8iKTtpZihhZT09PS0xKXtpZihhZj09PWFhKXthYy51cC5jYWxsYmFjayh0cnVlKX1lbHNle2lmKCFZKXtZPWFmO2lmKCFhYi5pbml0aWF0ZSl7WCgpfWFjLmRvd24ub3V0Z29pbmcoYWYpfX19ZWxzZXtpZihhZi5zdWJzdHJpbmcoMCxhZSk9PT1ZKXthYy51cC5pbmNvbWluZyhhZi5zdWJzdHJpbmcoYWUrMSksYWQpfX19LG91dGdvaW5nOmZ1bmN0aW9uKGFmLGFkLGFlKXthYy5kb3duLm91dGdvaW5nKGFhKyJfIithZixhZCxhZSl9LGNhbGxiYWNrOmZ1bmN0aW9uKGFkKXtpZihhYi5pbml0aWF0ZSl7WCgpfX19KX07by5zdGFjay5ScGNCZWhhdmlvcj1mdW5jdGlvbihhZCxZKXt2YXIgYWEsYWY9WS5zZXJpYWxpemVyfHxPKCk7dmFyIGFlPTAsYWM9e307ZnVuY3Rpb24gWChhZyl7YWcuanNvbnJwYz0iMi4wIjthYS5kb3duLm91dGdvaW5nKGFmLnN0cmluZ2lmeShhZykpfWZ1bmN0aW9uIGFiKGFnLGFpKXt2YXIgYWg9QXJyYXkucHJvdG90eXBlLnNsaWNlO3JldHVybiBmdW5jdGlvbigpe3ZhciBhaj1hcmd1bWVudHMubGVuZ3RoLGFsLGFrPXttZXRob2Q6YWl9O2lmKGFqPjAmJnR5cGVvZiBhcmd1bWVudHNbYWotMV09PT0iZnVuY3Rpb24iKXtpZihhaj4xJiZ0eXBlb2YgYXJndW1lbnRzW2FqLTJdPT09ImZ1bmN0aW9uIil7YWw9e3N1Y2Nlc3M6YXJndW1lbnRzW2FqLTJdLGVycm9yOmFyZ3VtZW50c1thai0xXX07YWsucGFyYW1zPWFoLmNhbGwoYXJndW1lbnRzLDAsYWotMil9ZWxzZXthbD17c3VjY2Vzczphcmd1bWVudHNbYWotMV19O2FrLnBhcmFtcz1haC5jYWxsKGFyZ3VtZW50cywwLGFqLTEpfWFjWyIiKygrK2FlKV09YWw7YWsuaWQ9YWV9ZWxzZXthay5wYXJhbXM9YWguY2FsbChhcmd1bWVudHMsMCl9aWYoYWcubmFtZWRQYXJhbXMmJmFrLnBhcmFtcy5sZW5ndGg9PT0xKXthay5wYXJhbXM9YWsucGFyYW1zWzBdfVgoYWspfX1mdW5jdGlvbiBaKGFuLGFtLGFpLGFsKXtpZighYWkpe2lmKGFtKXtYKHtpZDphbSxlcnJvcjp7Y29kZTotMzI2MDEsbWVzc2FnZToiUHJvY2VkdXJlIG5vdCBmb3VuZC4ifX0pfXJldHVybn12YXIgYWssYWg7aWYoYW0pe2FrPWZ1bmN0aW9uKGFvKXthaz1xO1goe2lkOmFtLHJlc3VsdDphb30pfTthaD1mdW5jdGlvbihhbyxhcCl7YWg9cTt2YXIgYXE9e2lkOmFtLGVycm9yOntjb2RlOi0zMjA5OSxtZXNzYWdlOmFvfX07aWYoYXApe2FxLmVycm9yLmRhdGE9YXB9WChhcSl9fWVsc2V7YWs9YWg9cX1pZighcihhbCkpe2FsPVthbF19dHJ5e3ZhciBhZz1haS5tZXRob2QuYXBwbHkoYWkuc2NvcGUsYWwuY29uY2F0KFthayxhaF0pKTtpZighdChhZykpe2FrKGFnKX19Y2F0Y2goYWope2FoKGFqLm1lc3NhZ2UpfX1yZXR1cm4oYWE9e2luY29taW5nOmZ1bmN0aW9uKGFoLGFnKXt2YXIgYWk9YWYucGFyc2UoYWgpO2lmKGFpLm1ldGhvZCl7aWYoWS5oYW5kbGUpe1kuaGFuZGxlKGFpLFgpfWVsc2V7WihhaS5tZXRob2QsYWkuaWQsWS5sb2NhbFthaS5tZXRob2RdLGFpLnBhcmFtcyl9fWVsc2V7dmFyIGFqPWFjW2FpLmlkXTtpZihhaS5lcnJvcil7aWYoYWouZXJyb3Ipe2FqLmVycm9yKGFpLmVycm9yKX19ZWxzZXtpZihhai5zdWNjZXNzKXthai5zdWNjZXNzKGFpLnJlc3VsdCl9fWRlbGV0ZSBhY1thaS5pZF19fSxpbml0OmZ1bmN0aW9uKCl7aWYoWS5yZW1vdGUpe2Zvcih2YXIgYWcgaW4gWS5yZW1vdGUpe2lmKFkucmVtb3RlLmhhc093blByb3BlcnR5KGFnKSl7YWRbYWddPWFiKFkucmVtb3RlW2FnXSxhZyl9fX1hYS5kb3duLmluaXQoKX0sZGVzdHJveTpmdW5jdGlvbigpe2Zvcih2YXIgYWcgaW4gWS5yZW1vdGUpe2lmKFkucmVtb3RlLmhhc093blByb3BlcnR5KGFnKSYmYWQuaGFzT3duUHJvcGVydHkoYWcpKXtkZWxldGUgYWRbYWddfX1hYS5kb3duLmRlc3Ryb3koKX19KX07Yi5lYXN5WERNPW99KSh3aW5kb3csZG9jdW1lbnQsbG9jYXRpb24sd2luZG93LnNldFRpbWVvdXQsZGVjb2RlVVJJQ29tcG9uZW50LGVuY29kZVVSSUNvbXBvbmVudCk7"
        },
        "xdm/jquery.couch.js": {
            "content_type": "application/javascript",
            "data": "Ly8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90Ci8vIHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mCi8vIHRoZSBMaWNlbnNlIGF0Ci8vCi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCi8vCi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywgV0lUSE9VVAovLyBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUKLy8gTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIKLy8gdGhlIExpY2Vuc2UuCgooZnVuY3Rpb24oJCkgewogICQuY291Y2ggPSAkLmNvdWNoIHx8IHt9OwoKICBmdW5jdGlvbiBlbmNvZGVEb2NJZChkb2NJRCkgewogICAgdmFyIHBhcnRzID0gZG9jSUQuc3BsaXQoIi8iKTsKICAgIGlmIChwYXJ0c1swXSA9PSAiX2Rlc2lnbiIpIHsKICAgICAgcGFydHMuc2hpZnQoKTsKICAgICAgcmV0dXJuICJfZGVzaWduLyIgKyBlbmNvZGVVUklDb21wb25lbnQocGFydHMuam9pbignLycpKTsKICAgIH0KICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoZG9jSUQpOwogIH07CgogIHZhciB1dWlkQ2FjaGUgPSBbXTsKCiAgJC5leHRlbmQoJC5jb3VjaCwgewogICAgdXJsUHJlZml4OiAnJywKICAgIGFjdGl2ZVRhc2tzOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIGFqYXgoCiAgICAgICAge3VybDogdGhpcy51cmxQcmVmaXggKyAiL19hY3RpdmVfdGFza3MifSwKICAgICAgICBvcHRpb25zLAogICAgICAgICJBY3RpdmUgdGFzayBzdGF0dXMgY291bGQgbm90IGJlIHJldHJpZXZlZCIKICAgICAgKTsKICAgIH0sCgogICAgYWxsRGJzOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIGFqYXgoCiAgICAgICAge3VybDogdGhpcy51cmxQcmVmaXggKyAiL19hbGxfZGJzIn0sCiAgICAgICAgb3B0aW9ucywKICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgcmV0cmlldmluZyB0aGUgbGlzdCBvZiBhbGwgZGF0YWJhc2VzIgogICAgICApOwogICAgfSwKCiAgICBjb25maWc6IGZ1bmN0aW9uKG9wdGlvbnMsIHNlY3Rpb24sIG9wdGlvbiwgdmFsdWUpIHsKICAgICAgdmFyIHJlcSA9IHt1cmw6IHRoaXMudXJsUHJlZml4ICsgIi9fY29uZmlnLyJ9OwogICAgICBpZiAoc2VjdGlvbikgewogICAgICAgIHJlcS51cmwgKz0gZW5jb2RlVVJJQ29tcG9uZW50KHNlY3Rpb24pICsgIi8iOwogICAgICAgIGlmIChvcHRpb24pIHsKICAgICAgICAgIHJlcS51cmwgKz0gZW5jb2RlVVJJQ29tcG9uZW50KG9wdGlvbik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHJlcS50eXBlID0gIkRFTEVURSI7ICAgICAgICAKICAgICAgfSBlbHNlIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmVxLnR5cGUgPSAiUFVUIjsKICAgICAgICByZXEuZGF0YSA9IHRvSlNPTih2YWx1ZSk7CiAgICAgICAgcmVxLmNvbnRlbnRUeXBlID0gImFwcGxpY2F0aW9uL2pzb24iOwogICAgICAgIHJlcS5wcm9jZXNzRGF0YSA9IGZhbHNlCiAgICAgIH0KCiAgICAgIGFqYXgocmVxLCBvcHRpb25zLAogICAgICAgICJBbiBlcnJvciBvY2N1cnJlZCByZXRyaWV2aW5nL3VwZGF0aW5nIHRoZSBzZXJ2ZXIgY29uZmlndXJhdGlvbiIKICAgICAgKTsKICAgIH0sCiAgICAKICAgIHNlc3Npb246IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgICQuYWpheCh7CiAgICAgICAgdHlwZTogIkdFVCIsIHVybDogdGhpcy51cmxQcmVmaXggKyAiL19zZXNzaW9uIiwKICAgICAgICBiZWZvcmVTZW5kOiBmdW5jdGlvbih4aHIpIHsKICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7CiAgICAgICAgfSwKICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24ocmVxKSB7CiAgICAgICAgICB2YXIgcmVzcCA9IGh0dHBEYXRhKHJlcSwgImpzb24iKTsKICAgICAgICAgIGlmIChyZXEuc3RhdHVzID09IDIwMCkgewogICAgICAgICAgICBpZiAob3B0aW9ucy5zdWNjZXNzKSBvcHRpb25zLnN1Y2Nlc3MocmVzcCk7CiAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuZXJyb3IpIHsKICAgICAgICAgICAgb3B0aW9ucy5lcnJvcihyZXEuc3RhdHVzLCByZXNwLmVycm9yLCByZXNwLnJlYXNvbik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGVydCgiQW4gZXJyb3Igb2NjdXJyZWQgZ2V0dGluZyBzZXNzaW9uIGluZm86ICIgKyByZXNwLnJlYXNvbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgdXNlckRiIDogZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgICAgJC5jb3VjaC5zZXNzaW9uKHsKICAgICAgICBzdWNjZXNzIDogZnVuY3Rpb24ocmVzcCkgewogICAgICAgICAgdmFyIHVzZXJEYiA9ICQuY291Y2guZGIocmVzcC5pbmZvLmF1dGhlbnRpY2F0aW9uX2RiKTsKICAgICAgICAgIGNhbGxiYWNrKHVzZXJEYik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgc2lnbnVwOiBmdW5jdGlvbih1c2VyX2RvYywgcGFzc3dvcmQsIG9wdGlvbnMpIHsgICAgICAKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgIC8vIHByZXBhcmUgdXNlciBkb2MgYmFzZWQgb24gbmFtZSBhbmQgcGFzc3dvcmQKICAgICAgdXNlcl9kb2MgPSB0aGlzLnByZXBhcmVVc2VyRG9jKHVzZXJfZG9jLCBwYXNzd29yZCk7CiAgICAgICQuY291Y2gudXNlckRiKGZ1bmN0aW9uKGRiKSB7CiAgICAgICAgZGIuc2F2ZURvYyh1c2VyX2RvYywgb3B0aW9ucyk7CiAgICAgIH0pOwogICAgfSwKCiAgICBwcmVwYXJlVXNlckRvYzogZnVuY3Rpb24odXNlcl9kb2MsIG5ld19wYXNzd29yZCkgewogICAgICBpZiAodHlwZW9mIGhleF9zaGExID09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgYWxlcnQoImNyZWF0aW5nIGEgdXNlciBkb2MgcmVxdWlyZXMgc2hhMS5qcyB0byBiZSBsb2FkZWQgaW4gdGhlIHBhZ2UiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIHVzZXJfcHJlZml4ID0gIm9yZy5jb3VjaGRiLnVzZXI6IjsKICAgICAgdXNlcl9kb2MuX2lkID0gdXNlcl9kb2MuX2lkIHx8IHVzZXJfcHJlZml4ICsgdXNlcl9kb2MubmFtZTsKICAgICAgaWYgKG5ld19wYXNzd29yZCkgewogICAgICAgIC8vIGhhbmRsZSB0aGUgcGFzc3dvcmQgY3J5cHRvCiAgICAgICAgdXNlcl9kb2Muc2FsdCA9ICQuY291Y2gubmV3VVVJRCgpOwogICAgICAgIHVzZXJfZG9jLnBhc3N3b3JkX3NoYSA9IGhleF9zaGExKG5ld19wYXNzd29yZCArIHVzZXJfZG9jLnNhbHQpOwogICAgICB9CiAgICAgIHVzZXJfZG9jLnR5cGUgPSAidXNlciI7CiAgICAgIGlmICghdXNlcl9kb2Mucm9sZXMpIHsKICAgICAgICB1c2VyX2RvYy5yb2xlcyA9IFtdOwogICAgICB9CiAgICAgIHJldHVybiB1c2VyX2RvYzsKICAgIH0sCgogICAgbG9naW46IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgICQuYWpheCh7CiAgICAgICAgdHlwZTogIlBPU1QiLCB1cmw6IHRoaXMudXJsUHJlZml4ICsgIi9fc2Vzc2lvbiIsIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgZGF0YToge25hbWU6IG9wdGlvbnMubmFtZSwgcGFzc3dvcmQ6IG9wdGlvbnMucGFzc3dvcmR9LAogICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uKHhocikgewogICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICB9LAogICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihyZXEpIHsKICAgICAgICAgIHZhciByZXNwID0gaHR0cERhdGEocmVxLCAianNvbiIpOwogICAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT0gMjAwKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MpIG9wdGlvbnMuc3VjY2VzcyhyZXNwKTsKICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5lcnJvcikgewogICAgICAgICAgICBvcHRpb25zLmVycm9yKHJlcS5zdGF0dXMsIHJlc3AuZXJyb3IsIHJlc3AucmVhc29uKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsZXJ0KCJBbiBlcnJvciBvY2N1cnJlZCBsb2dnaW5nIGluOiAiICsgcmVzcC5yZWFzb24pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgbG9nb3V0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAkLmFqYXgoewogICAgICAgIHR5cGU6ICJERUxFVEUiLCB1cmw6IHRoaXMudXJsUHJlZml4ICsgIi9fc2Vzc2lvbiIsIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgdXNlcm5hbWUgOiAiXyIsIHBhc3N3b3JkIDogIl8iLAogICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uKHhocikgewogICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICB9LAogICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihyZXEpIHsKICAgICAgICAgIHZhciByZXNwID0gaHR0cERhdGEocmVxLCAianNvbiIpOwogICAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT0gMjAwKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MpIG9wdGlvbnMuc3VjY2VzcyhyZXNwKTsKICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5lcnJvcikgewogICAgICAgICAgICBvcHRpb25zLmVycm9yKHJlcS5zdGF0dXMsIHJlc3AuZXJyb3IsIHJlc3AucmVhc29uKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsZXJ0KCJBbiBlcnJvciBvY2N1cnJlZCBsb2dnaW5nIG91dDogIiArIHJlc3AucmVhc29uKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBkYjogZnVuY3Rpb24obmFtZSwgZGJfb3B0cykgewogICAgICBkYl9vcHRzID0gZGJfb3B0cyB8fCB7fTsKICAgICAgdmFyIHJhd0RvY3MgPSB7fTsKICAgICAgZnVuY3Rpb24gbWF5YmVBcHBseVZlcnNpb24oZG9jKSB7CiAgICAgICAgaWYgKGRvYy5faWQgJiYgZG9jLl9yZXYgJiYgcmF3RG9jc1tkb2MuX2lkXSAmJiByYXdEb2NzW2RvYy5faWRdLnJldiA9PSBkb2MuX3JldikgewogICAgICAgICAgLy8gdG9kbzogY2FuIHdlIHVzZSBjb21tb25qcyByZXF1aXJlIGhlcmU/CiAgICAgICAgICBpZiAodHlwZW9mIEJhc2U2NCA9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICBhbGVydCgicGxlYXNlIGluY2x1ZGUgL191dGlscy9zY3JpcHQvYmFzZTY0LmpzIGluIHRoZSBwYWdlIGZvciBiYXNlNjQgc3VwcG9ydCIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkb2MuX2F0dGFjaG1lbnRzID0gZG9jLl9hdHRhY2htZW50cyB8fCB7fTsKICAgICAgICAgICAgZG9jLl9hdHRhY2htZW50c1sicmV2LSIrZG9jLl9yZXYuc3BsaXQoIi0iKVswXV0gPSB7CiAgICAgICAgICAgICAgY29udGVudF90eXBlIDoiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAgICAgZGF0YSA6IEJhc2U2NC5lbmNvZGUocmF3RG9jc1tkb2MuX2lkXS5yYXcpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIHVyaTogdGhpcy51cmxQcmVmaXggKyAiLyIgKyBlbmNvZGVVUklDb21wb25lbnQobmFtZSkgKyAiLyIsCgogICAgICAgIGNvbXBhY3Q6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICQuZXh0ZW5kKG9wdGlvbnMsIHtzdWNjZXNzU3RhdHVzOiAyMDJ9KTsKICAgICAgICAgIGFqYXgoewogICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwgdXJsOiB0aGlzLnVyaSArICJfY29tcGFjdCIsCiAgICAgICAgICAgICAgZGF0YTogIiIsIHByb2Nlc3NEYXRhOiBmYWxzZQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiVGhlIGRhdGFiYXNlIGNvdWxkIG5vdCBiZSBjb21wYWN0ZWQiCiAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgdmlld0NsZWFudXA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICQuZXh0ZW5kKG9wdGlvbnMsIHtzdWNjZXNzU3RhdHVzOiAyMDJ9KTsKICAgICAgICAgIGFqYXgoewogICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwgdXJsOiB0aGlzLnVyaSArICJfdmlld19jbGVhbnVwIiwKICAgICAgICAgICAgICBkYXRhOiAiIiwgcHJvY2Vzc0RhdGE6IGZhbHNlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgICJUaGUgdmlld3MgY291bGQgbm90IGJlIGNsZWFuZWQgdXAiCiAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgY29tcGFjdFZpZXc6IGZ1bmN0aW9uKGdyb3VwbmFtZSwgb3B0aW9ucykgewogICAgICAgICAgJC5leHRlbmQob3B0aW9ucywge3N1Y2Nlc3NTdGF0dXM6IDIwMn0pOwogICAgICAgICAgYWpheCh7CiAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLCB1cmw6IHRoaXMudXJpICsgIl9jb21wYWN0LyIgKyBncm91cG5hbWUsCiAgICAgICAgICAgICAgZGF0YTogIiIsIHByb2Nlc3NEYXRhOiBmYWxzZQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiVGhlIHZpZXcgY291bGQgbm90IGJlIGNvbXBhY3RlZCIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICQuZXh0ZW5kKG9wdGlvbnMsIHtzdWNjZXNzU3RhdHVzOiAyMDF9KTsKICAgICAgICAgIGFqYXgoewogICAgICAgICAgICAgIHR5cGU6ICJQVVQiLCB1cmw6IHRoaXMudXJpLCBjb250ZW50VHlwZTogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICAgICAgIGRhdGE6ICIiLCBwcm9jZXNzRGF0YTogZmFsc2UKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3B0aW9ucywKICAgICAgICAgICAgIlRoZSBkYXRhYmFzZSBjb3VsZCBub3QgYmUgY3JlYXRlZCIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBkcm9wOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICBhamF4KAogICAgICAgICAgICB7dHlwZTogIkRFTEVURSIsIHVybDogdGhpcy51cml9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiVGhlIGRhdGFiYXNlIGNvdWxkIG5vdCBiZSBkZWxldGVkIgogICAgICAgICAgKTsKICAgICAgICB9LAogICAgICAgIGluZm86IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgIGFqYXgoCiAgICAgICAgICAgIHt1cmw6IHRoaXMudXJpfSwKICAgICAgICAgICAgb3B0aW9ucywKICAgICAgICAgICAgIkRhdGFiYXNlIGluZm9ybWF0aW9uIGNvdWxkIG5vdCBiZSByZXRyaWV2ZWQiCiAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgY2hhbmdlczogZnVuY3Rpb24oc2luY2UsIG9wdGlvbnMpIHsKICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgLy8gc2V0IHVwIHRoZSBwcm9taXNlIG9iamVjdCB3aXRoaW4gYSBjbG9zdXJlIGZvciB0aGlzIGhhbmRsZXIKICAgICAgICAgIHZhciB0aW1lb3V0ID0gMTAwLCBkYiA9IHRoaXMsIGFjdGl2ZSA9IHRydWUsCiAgICAgICAgICAgIGxpc3RlbmVycyA9IFtdLAogICAgICAgICAgICBwcm9taXNlID0gewogICAgICAgICAgICBvbkNoYW5nZSA6IGZ1bmN0aW9uKGZ1bikgewogICAgICAgICAgICAgIGxpc3RlbmVycy5wdXNoKGZ1bik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHN0b3AgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBhY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIC8vIGNhbGwgZWFjaCBsaXN0ZW5lciB3aGVuIHRoZXJlIGlzIGEgY2hhbmdlCiAgICAgICAgICBmdW5jdGlvbiB0cmlnZ2VyTGlzdGVuZXJzKHJlc3ApIHsKICAgICAgICAgICAgJC5lYWNoKGxpc3RlbmVycywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcyhyZXNwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwogICAgICAgICAgLy8gd2hlbiB0aGVyZSBpcyBhIGNoYW5nZSwgY2FsbCBhbnkgbGlzdGVuZXJzLCB0aGVuIGNoZWNrIGZvciBhbm90aGVyIGNoYW5nZQogICAgICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkgewogICAgICAgICAgICB0aW1lb3V0ID0gMTAwOwogICAgICAgICAgICBpZiAoYWN0aXZlKSB7CiAgICAgICAgICAgICAgc2luY2UgPSByZXNwLmxhc3Rfc2VxOwogICAgICAgICAgICAgIHRyaWdnZXJMaXN0ZW5lcnMocmVzcCk7CiAgICAgICAgICAgICAgZ2V0Q2hhbmdlc1NpbmNlKCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9OwogICAgICAgICAgb3B0aW9ucy5lcnJvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoYWN0aXZlKSB7CiAgICAgICAgICAgICAgc2V0VGltZW91dChnZXRDaGFuZ2VzU2luY2UsIHRpbWVvdXQpOwogICAgICAgICAgICAgIHRpbWVvdXQgPSB0aW1lb3V0ICogMjsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIC8vIGFjdHVhbGx5IG1ha2UgdGhlIGNoYW5nZXMgcmVxdWVzdAogICAgICAgICAgZnVuY3Rpb24gZ2V0Q2hhbmdlc1NpbmNlKCkgewogICAgICAgICAgICB2YXIgb3B0cyA9ICQuZXh0ZW5kKHtoZWFydGJlYXQgOiAxMCAqIDEwMDB9LCBvcHRpb25zLCB7CiAgICAgICAgICAgICAgZmVlZCA6ICJsb25ncG9sbCIsCiAgICAgICAgICAgICAgc2luY2UgOiBzaW5jZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYWpheCgKICAgICAgICAgICAgICB7dXJsOiBkYi51cmkgKyAiX2NoYW5nZXMiK2VuY29kZU9wdGlvbnMob3B0cyl9LAogICAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgICAgIkVycm9yIGNvbm5lY3RpbmcgdG8gIitkYi51cmkrIi9fY2hhbmdlcy4iCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBzdGFydCB0aGUgZmlyc3QgcmVxdWVzdAogICAgICAgICAgaWYgKHNpbmNlKSB7CiAgICAgICAgICAgIGdldENoYW5nZXNTaW5jZSgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGIuaW5mbyh7CiAgICAgICAgICAgICAgc3VjY2VzcyA6IGZ1bmN0aW9uKGluZm8pIHsKICAgICAgICAgICAgICAgIHNpbmNlID0gaW5mby51cGRhdGVfc2VxOwogICAgICAgICAgICAgICAgZ2V0Q2hhbmdlc1NpbmNlKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBwcm9taXNlOwogICAgICAgIH0sCiAgICAgICAgYWxsRG9jczogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgdmFyIHR5cGUgPSAiR0VUIjsKICAgICAgICAgIHZhciBkYXRhID0gbnVsbDsKICAgICAgICAgIGlmIChvcHRpb25zWyJrZXlzIl0pIHsKICAgICAgICAgICAgdHlwZSA9ICJQT1NUIjsKICAgICAgICAgICAgdmFyIGtleXMgPSBvcHRpb25zWyJrZXlzIl07CiAgICAgICAgICAgIGRlbGV0ZSBvcHRpb25zWyJrZXlzIl07CiAgICAgICAgICAgIGRhdGEgPSB0b0pTT04oeyAia2V5cyI6IGtleXMgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBhamF4KHsKICAgICAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArICJfYWxsX2RvY3MiICsgZW5jb2RlT3B0aW9ucyhvcHRpb25zKQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgcmV0cmlldmluZyBhIGxpc3Qgb2YgYWxsIGRvY3VtZW50cyIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBhbGxEZXNpZ25Eb2NzOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICB0aGlzLmFsbERvY3MoJC5leHRlbmQoe3N0YXJ0a2V5OiJfZGVzaWduIiwgZW5ka2V5OiJfZGVzaWduMCJ9LCBvcHRpb25zKSk7CiAgICAgICAgfSwKICAgICAgICBhbGxBcHBzOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgIGlmIChvcHRpb25zLmVhY2hBcHApIHsKICAgICAgICAgICAgdGhpcy5hbGxEZXNpZ25Eb2NzKHsKICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgICAgICAgICAkLmVhY2gocmVzcC5yb3dzLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgc2VsZi5vcGVuRG9jKHRoaXMuaWQsIHsKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkZG9jKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXgsIGFwcFBhdGgsIGFwcE5hbWUgPSBkZG9jLl9pZC5zcGxpdCgnLycpOwogICAgICAgICAgICAgICAgICAgICAgYXBwTmFtZS5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgICAgYXBwTmFtZSA9IGFwcE5hbWUuam9pbignLycpOwogICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBkZG9jLmNvdWNoYXBwICYmIGRkb2MuY291Y2hhcHAuaW5kZXg7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBwUGF0aCA9IFsnJywgbmFtZSwgZGRvYy5faWQsIGluZGV4XS5qb2luKCcvJyk7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRkb2MuX2F0dGFjaG1lbnRzICYmIGRkb2MuX2F0dGFjaG1lbnRzWyJpbmRleC5odG1sIl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBwUGF0aCA9IFsnJywgbmFtZSwgZGRvYy5faWQsICJpbmRleC5odG1sIl0uam9pbignLycpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgaWYgKGFwcFBhdGgpIG9wdGlvbnMuZWFjaEFwcChhcHBOYW1lLCBhcHBQYXRoLCBkZG9jKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsZXJ0KCJQbGVhc2UgcHJvdmlkZSBhbiBlYWNoQXBwIGZ1bmN0aW9uIGZvciBhbGxBcHBzKCkiKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG9wZW5Eb2M6IGZ1bmN0aW9uKGRvY0lkLCBvcHRpb25zLCBhamF4T3B0aW9ucykgewogICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgICAgICBpZiAoZGJfb3B0cy5hdHRhY2hQcmV2UmV2IHx8IG9wdGlvbnMuYXR0YWNoUHJldlJldikgewogICAgICAgICAgICAkLmV4dGVuZChvcHRpb25zLCB7CiAgICAgICAgICAgICAgYmVmb3JlU3VjY2VzcyA6IGZ1bmN0aW9uKHJlcSwgZG9jKSB7CiAgICAgICAgICAgICAgICByYXdEb2NzW2RvYy5faWRdID0gewogICAgICAgICAgICAgICAgICByZXYgOiBkb2MuX3JldiwKICAgICAgICAgICAgICAgICAgcmF3IDogcmVxLnJlc3BvbnNlVGV4dAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJC5leHRlbmQob3B0aW9ucywgewogICAgICAgICAgICAgIGJlZm9yZVN1Y2Nlc3MgOiBmdW5jdGlvbihyZXEsIGRvYykgewogICAgICAgICAgICAgICAgaWYgKGRvY1sianF1ZXJ5LmNvdWNoLmF0dGFjaFByZXZSZXYiXSkgewogICAgICAgICAgICAgICAgICByYXdEb2NzW2RvYy5faWRdID0gewogICAgICAgICAgICAgICAgICAgIHJldiA6IGRvYy5fcmV2LAogICAgICAgICAgICAgICAgICAgIHJhdyA6IHJlcS5yZXNwb25zZVRleHQKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgYWpheCh7dXJsOiB0aGlzLnVyaSArIGVuY29kZURvY0lkKGRvY0lkKSArIGVuY29kZU9wdGlvbnMob3B0aW9ucyl9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiVGhlIGRvY3VtZW50IGNvdWxkIG5vdCBiZSByZXRyaWV2ZWQiLAogICAgICAgICAgICBhamF4T3B0aW9ucwogICAgICAgICAgKTsKICAgICAgICB9LAogICAgICAgIHNhdmVEb2M6IGZ1bmN0aW9uKGRvYywgb3B0aW9ucykgewogICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgICAgICB2YXIgZGIgPSB0aGlzOwogICAgICAgICAgdmFyIGJlZm9yZVNlbmQgPSBmdWxsQ29tbWl0KG9wdGlvbnMpOwogICAgICAgICAgaWYgKGRvYy5faWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB2YXIgbWV0aG9kID0gIlBPU1QiOwogICAgICAgICAgICB2YXIgdXJpID0gdGhpcy51cmk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgbWV0aG9kID0gIlBVVCI7CiAgICAgICAgICAgIHZhciB1cmkgPSB0aGlzLnVyaSArIGVuY29kZURvY0lkKGRvYy5faWQpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHZlcnNpb25lZCA9IG1heWJlQXBwbHlWZXJzaW9uKGRvYyk7CiAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB0eXBlOiBtZXRob2QsIHVybDogdXJpICsgZW5jb2RlT3B0aW9ucyhvcHRpb25zKSwKICAgICAgICAgICAgY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwgZGF0YTogdG9KU09OKGRvYyksCiAgICAgICAgICAgIGJlZm9yZVNlbmQgOiBiZWZvcmVTZW5kLAogICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24ocmVxKSB7CiAgICAgICAgICAgICAgdmFyIHJlc3AgPSBodHRwRGF0YShyZXEsICJqc29uIik7CiAgICAgICAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT0gMjAwIHx8IHJlcS5zdGF0dXMgPT0gMjAxIHx8IHJlcS5zdGF0dXMgPT0gMjAyKSB7CiAgICAgICAgICAgICAgICBkb2MuX2lkID0gcmVzcC5pZDsKICAgICAgICAgICAgICAgIGRvYy5fcmV2ID0gcmVzcC5yZXY7CiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbmVkKSB7CiAgICAgICAgICAgICAgICAgIGRiLm9wZW5Eb2MoZG9jLl9pZCwgewogICAgICAgICAgICAgICAgICAgIGF0dGFjaFByZXZSZXYgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgOiBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgICBkb2MuX2F0dGFjaG1lbnRzID0gZC5fYXR0YWNobWVudHM7CiAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdWNjZXNzKSBvcHRpb25zLnN1Y2Nlc3MocmVzcCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MpIG9wdGlvbnMuc3VjY2VzcyhyZXNwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuZXJyb3IpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMuZXJyb3IocmVxLnN0YXR1cywgcmVzcC5lcnJvciwgcmVzcC5yZWFzb24pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhbGVydCgiVGhlIGRvY3VtZW50IGNvdWxkIG5vdCBiZSBzYXZlZDogIiArIHJlc3AucmVhc29uKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYnVsa1NhdmU6IGZ1bmN0aW9uKGRvY3MsIG9wdGlvbnMpIHsKICAgICAgICAgIHZhciBiZWZvcmVTZW5kID0gZnVsbENvbW1pdChvcHRpb25zKTsKICAgICAgICAgICQuZXh0ZW5kKG9wdGlvbnMsIHtzdWNjZXNzU3RhdHVzOiAyMDEsIGJlZm9yZVNlbmQgOiBiZWZvcmVTZW5kfSk7CiAgICAgICAgICBhamF4KHsKICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArICJfYnVsa19kb2NzIiArIGVuY29kZU9wdGlvbnMob3B0aW9ucyksCiAgICAgICAgICAgICAgY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiwgZGF0YTogdG9KU09OKGRvY3MpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgICJUaGUgZG9jdW1lbnRzIGNvdWxkIG5vdCBiZSBzYXZlZCIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICByZW1vdmVEb2M6IGZ1bmN0aW9uKGRvYywgb3B0aW9ucykgewogICAgICAgICAgYWpheCh7CiAgICAgICAgICAgICAgdHlwZTogIkRFTEVURSIsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArCiAgICAgICAgICAgICAgICAgICBlbmNvZGVEb2NJZChkb2MuX2lkKSArCiAgICAgICAgICAgICAgICAgICBlbmNvZGVPcHRpb25zKHtyZXY6IGRvYy5fcmV2fSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3B0aW9ucywKICAgICAgICAgICAgIlRoZSBkb2N1bWVudCBjb3VsZCBub3QgYmUgZGVsZXRlZCIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBidWxrUmVtb3ZlOiBmdW5jdGlvbihkb2NzLCBvcHRpb25zKXsKICAgICAgICAgIGRvY3MuZG9jcyA9ICQuZWFjaCgKICAgICAgICAgICAgZG9jcy5kb2NzLCBmdW5jdGlvbihpLCBkb2MpewogICAgICAgICAgICAgIGRvYy5fZGVsZXRlZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICk7CiAgICAgICAgICAkLmV4dGVuZChvcHRpb25zLCB7c3VjY2Vzc1N0YXR1czogMjAxfSk7CiAgICAgICAgICBhamF4KHsKICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArICJfYnVsa19kb2NzIiArIGVuY29kZU9wdGlvbnMob3B0aW9ucyksCiAgICAgICAgICAgICAgZGF0YTogdG9KU09OKGRvY3MpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgICJUaGUgZG9jdW1lbnRzIGNvdWxkIG5vdCBiZSBkZWxldGVkIgogICAgICAgICAgKTsKICAgICAgICB9LAogICAgICAgIGNvcHlEb2M6IGZ1bmN0aW9uKGRvY0lkLCBvcHRpb25zLCBhamF4T3B0aW9ucykgewogICAgICAgICAgYWpheE9wdGlvbnMgPSAkLmV4dGVuZChhamF4T3B0aW9ucywgewogICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24ocmVxKSB7CiAgICAgICAgICAgICAgdmFyIHJlc3AgPSBodHRwRGF0YShyZXEsICJqc29uIik7CiAgICAgICAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT0gMjAxKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdWNjZXNzKSBvcHRpb25zLnN1Y2Nlc3MocmVzcCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLmVycm9yKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zLmVycm9yKHJlcS5zdGF0dXMsIHJlc3AuZXJyb3IsIHJlc3AucmVhc29uKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWxlcnQoIlRoZSBkb2N1bWVudCBjb3VsZCBub3QgYmUgY29waWVkOiAiICsgcmVzcC5yZWFzb24pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBhamF4KHsKICAgICAgICAgICAgICB0eXBlOiAiQ09QWSIsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArIGVuY29kZURvY0lkKGRvY0lkKQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiVGhlIGRvY3VtZW50IGNvdWxkIG5vdCBiZSBjb3BpZWQiLAogICAgICAgICAgICBhamF4T3B0aW9ucwogICAgICAgICAgKTsKICAgICAgICB9LAogICAgICAgIHF1ZXJ5OiBmdW5jdGlvbihtYXBGdW4sIHJlZHVjZUZ1biwgbGFuZ3VhZ2UsIG9wdGlvbnMpIHsKICAgICAgICAgIGxhbmd1YWdlID0gbGFuZ3VhZ2UgfHwgImphdmFzY3JpcHQiOwogICAgICAgICAgaWYgKHR5cGVvZihtYXBGdW4pICE9PSAic3RyaW5nIikgewogICAgICAgICAgICBtYXBGdW4gPSBtYXBGdW4udG9Tb3VyY2UgPyBtYXBGdW4udG9Tb3VyY2UoKSA6ICIoIiArIG1hcEZ1bi50b1N0cmluZygpICsgIikiOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGJvZHkgPSB7bGFuZ3VhZ2U6IGxhbmd1YWdlLCBtYXA6IG1hcEZ1bn07CiAgICAgICAgICBpZiAocmVkdWNlRnVuICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZihyZWR1Y2VGdW4pICE9PSAic3RyaW5nIikKICAgICAgICAgICAgICByZWR1Y2VGdW4gPSByZWR1Y2VGdW4udG9Tb3VyY2UgPyByZWR1Y2VGdW4udG9Tb3VyY2UoKSA6ICIoIiArIHJlZHVjZUZ1bi50b1N0cmluZygpICsgIikiOwogICAgICAgICAgICBib2R5LnJlZHVjZSA9IHJlZHVjZUZ1bjsKICAgICAgICAgIH0KICAgICAgICAgIGFqYXgoewogICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICB1cmw6IHRoaXMudXJpICsgIl90ZW1wX3ZpZXciICsgZW5jb2RlT3B0aW9ucyhvcHRpb25zKSwKICAgICAgICAgICAgICBjb250ZW50VHlwZTogImFwcGxpY2F0aW9uL2pzb24iLCBkYXRhOiB0b0pTT04oYm9keSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3B0aW9ucywKICAgICAgICAgICAgIkFuIGVycm9yIG9jY3VycmVkIHF1ZXJ5aW5nIHRoZSBkYXRhYmFzZSIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBsaXN0OiBmdW5jdGlvbihsaXN0LCB2aWV3LCBvcHRpb25zKSB7CiAgICAgICAgICB2YXIgbGlzdCA9IGxpc3Quc3BsaXQoJy8nKTsKICAgICAgICAgIHZhciBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICAgIHZhciB0eXBlID0gJ0dFVCc7CiAgICAgICAgICB2YXIgZGF0YSA9IG51bGw7CiAgICAgICAgICBpZiAob3B0aW9uc1sna2V5cyddKSB7CiAgICAgICAgICAgIHR5cGUgPSAnUE9TVCc7CiAgICAgICAgICAgIHZhciBrZXlzID0gb3B0aW9uc1sna2V5cyddOwogICAgICAgICAgICBkZWxldGUgb3B0aW9uc1sna2V5cyddOwogICAgICAgICAgICBkYXRhID0gdG9KU09OKHsna2V5cyc6IGtleXMgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBhamF4KHsKICAgICAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArICdfZGVzaWduLycgKyBsaXN0WzBdICsKICAgICAgICAgICAgICAgICAgICcvX2xpc3QvJyArIGxpc3RbMV0gKyAnLycgKyB2aWV3ICsgZW5jb2RlT3B0aW9ucyhvcHRpb25zKQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb3B0aW9ucywgJ0FuIGVycm9yIG9jY3VyZWQgYWNjZXNzaW5nIHRoZSBsaXN0JwogICAgICAgICAgKTsKICAgICAgICB9LAogICAgICAgIHZpZXc6IGZ1bmN0aW9uKG5hbWUsIG9wdGlvbnMpIHsKICAgICAgICAgIHZhciBuYW1lID0gbmFtZS5zcGxpdCgnLycpOwogICAgICAgICAgdmFyIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgdmFyIHR5cGUgPSAiR0VUIjsKICAgICAgICAgIHZhciBkYXRhPSBudWxsOwogICAgICAgICAgaWYgKG9wdGlvbnNbImtleXMiXSkgewogICAgICAgICAgICB0eXBlID0gIlBPU1QiOwogICAgICAgICAgICB2YXIga2V5cyA9IG9wdGlvbnNbImtleXMiXTsKICAgICAgICAgICAgZGVsZXRlIG9wdGlvbnNbImtleXMiXTsKICAgICAgICAgICAgZGF0YSA9IHRvSlNPTih7ICJrZXlzIjoga2V5cyB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGFqYXgoewogICAgICAgICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICB1cmw6IHRoaXMudXJpICsgIl9kZXNpZ24vIiArIG5hbWVbMF0gKwogICAgICAgICAgICAgICAgICAgIi9fdmlldy8iICsgbmFtZVsxXSArIGVuY29kZU9wdGlvbnMob3B0aW9ucykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3B0aW9ucywgIkFuIGVycm9yIG9jY3VycmVkIGFjY2Vzc2luZyB0aGUgdmlldyIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBnZXREYlByb3BlcnR5OiBmdW5jdGlvbihwcm9wTmFtZSwgb3B0aW9ucywgYWpheE9wdGlvbnMpIHsKICAgICAgICAgIGFqYXgoe3VybDogdGhpcy51cmkgKyBwcm9wTmFtZSArIGVuY29kZU9wdGlvbnMob3B0aW9ucyl9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiVGhlIHByb3BlcnR5IGNvdWxkIG5vdCBiZSByZXRyaWV2ZWQiLAogICAgICAgICAgICBhamF4T3B0aW9ucwogICAgICAgICAgKTsKICAgICAgICB9LAoKICAgICAgICBzZXREYlByb3BlcnR5OiBmdW5jdGlvbihwcm9wTmFtZSwgcHJvcFZhbHVlLCBvcHRpb25zLCBhamF4T3B0aW9ucykgewogICAgICAgICAgYWpheCh7CiAgICAgICAgICAgIHR5cGU6ICJQVVQiLCAKICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArIHByb3BOYW1lICsgZW5jb2RlT3B0aW9ucyhvcHRpb25zKSwKICAgICAgICAgICAgZGF0YSA6IEpTT04uc3RyaW5naWZ5KHByb3BWYWx1ZSkKICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgICJUaGUgcHJvcGVydHkgY291bGQgbm90IGJlIHVwZGF0ZWQiLAogICAgICAgICAgICBhamF4T3B0aW9ucwogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH07CiAgICB9LAoKICAgIGVuY29kZURvY0lkOiBlbmNvZGVEb2NJZCwgCgogICAgaW5mbzogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBhamF4KAogICAgICAgIHt1cmw6IHRoaXMudXJsUHJlZml4ICsgIi8ifSwKICAgICAgICBvcHRpb25zLAogICAgICAgICJTZXJ2ZXIgaW5mb3JtYXRpb24gY291bGQgbm90IGJlIHJldHJpZXZlZCIKICAgICAgKTsKICAgIH0sCgogICAgcmVwbGljYXRlOiBmdW5jdGlvbihzb3VyY2UsIHRhcmdldCwgYWpheE9wdGlvbnMsIHJlcE9wdHMpIHsKICAgICAgcmVwT3B0cyA9ICQuZXh0ZW5kKHtzb3VyY2U6IHNvdXJjZSwgdGFyZ2V0OiB0YXJnZXR9LCByZXBPcHRzKTsKICAgICAgaWYgKHJlcE9wdHMuY29udGludW91cyAmJiAhcmVwT3B0cy5jYW5jZWwpIHsKICAgICAgICBhamF4T3B0aW9ucy5zdWNjZXNzU3RhdHVzID0gMjAyOwogICAgICB9CiAgICAgIGFqYXgoewogICAgICAgICAgdHlwZTogIlBPU1QiLCB1cmw6IHRoaXMudXJsUHJlZml4ICsgIi9fcmVwbGljYXRlIiwKICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHJlcE9wdHMpLAogICAgICAgICAgY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIgogICAgICAgIH0sCiAgICAgICAgYWpheE9wdGlvbnMsCiAgICAgICAgIlJlcGxpY2F0aW9uIGZhaWxlZCIKICAgICAgKTsKICAgIH0sCgogICAgbmV3VVVJRDogZnVuY3Rpb24oY2FjaGVOdW0pIHsKICAgICAgaWYgKGNhY2hlTnVtID09PSB1bmRlZmluZWQpIHsKICAgICAgICBjYWNoZU51bSA9IDE7CiAgICAgIH0KICAgICAgaWYgKCF1dWlkQ2FjaGUubGVuZ3RoKSB7CiAgICAgICAgYWpheCh7dXJsOiB0aGlzLnVybFByZWZpeCArICIvX3V1aWRzIiwgZGF0YToge2NvdW50OiBjYWNoZU51bX0sIGFzeW5jOiBmYWxzZX0sIHsKICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcCkgewogICAgICAgICAgICAgIHV1aWRDYWNoZSA9IHJlc3AudXVpZHM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAiRmFpbGVkIHRvIHJldHJpZXZlIFVVSUQgYmF0Y2guIgogICAgICAgICk7CiAgICAgIH0KICAgICAgcmV0dXJuIHV1aWRDYWNoZS5zaGlmdCgpOwogICAgfQogIH0pOwoKICB2YXIgaHR0cERhdGEgPSAkLmh0dHBEYXRhIHx8IGZ1bmN0aW9uKCB4aHIsIHR5cGUsIHMgKSB7IC8vIGxpZnRlZCBmcm9tIGpxMS40LjQKICAgIHZhciBjdCA9IHhoci5nZXRSZXNwb25zZUhlYWRlcigiY29udGVudC10eXBlIikgfHwgIiIsCiAgICAgIHhtbCA9IHR5cGUgPT09ICJ4bWwiIHx8ICF0eXBlICYmIGN0LmluZGV4T2YoInhtbCIpID49IDAsCiAgICAgIGRhdGEgPSB4bWwgPyB4aHIucmVzcG9uc2VYTUwgOiB4aHIucmVzcG9uc2VUZXh0OwoKICAgIGlmICggeG1sICYmIGRhdGEuZG9jdW1lbnRFbGVtZW50Lm5vZGVOYW1lID09PSAicGFyc2VyZXJyb3IiICkgewogICAgICAkLmVycm9yKCAicGFyc2VyZXJyb3IiICk7CiAgICB9CiAgICBpZiAoIHMgJiYgcy5kYXRhRmlsdGVyICkgewogICAgICBkYXRhID0gcy5kYXRhRmlsdGVyKCBkYXRhLCB0eXBlICk7CiAgICB9CiAgICBpZiAoIHR5cGVvZiBkYXRhID09PSAic3RyaW5nIiApIHsKICAgICAgaWYgKCB0eXBlID09PSAianNvbiIgfHwgIXR5cGUgJiYgY3QuaW5kZXhPZigianNvbiIpID49IDAgKSB7CiAgICAgICAgZGF0YSA9ICQucGFyc2VKU09OKCBkYXRhICk7CiAgICAgIH0gZWxzZSBpZiAoIHR5cGUgPT09ICJzY3JpcHQiIHx8ICF0eXBlICYmIGN0LmluZGV4T2YoImphdmFzY3JpcHQiKSA+PSAwICkgewogICAgICAgICQuZ2xvYmFsRXZhbCggZGF0YSApOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9OwoKICBmdW5jdGlvbiBhamF4KG9iaiwgb3B0aW9ucywgZXJyb3JNZXNzYWdlLCBhamF4T3B0aW9ucykgewoKICAgIHZhciBkZWZhdWx0QWpheE9wdHMgPSB7CiAgICAgIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgIGhlYWRlcnM6eyJBY2NlcHQiOiAiYXBwbGljYXRpb24vanNvbiJ9CiAgICB9OwoKICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7c3VjY2Vzc1N0YXR1czogMjAwfSwgb3B0aW9ucyk7CiAgICBhamF4T3B0aW9ucyA9ICQuZXh0ZW5kKGRlZmF1bHRBamF4T3B0cywgYWpheE9wdGlvbnMpOwogICAgZXJyb3JNZXNzYWdlID0gZXJyb3JNZXNzYWdlIHx8ICJVbmtub3duIGVycm9yIjsKICAgICQuYWpheCgkLmV4dGVuZCgkLmV4dGVuZCh7CiAgICAgIHR5cGU6ICJHRVQiLCBkYXRhVHlwZTogImpzb24iLCBjYWNoZSA6ICEkLmJyb3dzZXIubXNpZSwKICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24oeGhyKXsKICAgICAgICBpZihhamF4T3B0aW9ucyAmJiBhamF4T3B0aW9ucy5oZWFkZXJzKXsKICAgICAgICAgIGZvciAodmFyIGhlYWRlciBpbiBhamF4T3B0aW9ucy5oZWFkZXJzKXsKICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyLCBhamF4T3B0aW9ucy5oZWFkZXJzW2hlYWRlcl0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKHJlcSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgcmVzcCA9IGh0dHBEYXRhKHJlcSwgImpzb24iKTsKICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgIGlmIChvcHRpb25zLmVycm9yKSB7CiAgICAgICAgICAgIG9wdGlvbnMuZXJyb3IocmVxLnN0YXR1cywgcmVxLCBlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsZXJ0KGVycm9yTWVzc2FnZSArICI6ICIgKyBlKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMuYWpheFN0YXJ0KSB7CiAgICAgICAgICBvcHRpb25zLmFqYXhTdGFydChyZXNwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT0gb3B0aW9ucy5zdWNjZXNzU3RhdHVzKSB7CiAgICAgICAgICBpZiAob3B0aW9ucy5iZWZvcmVTdWNjZXNzKSBvcHRpb25zLmJlZm9yZVN1Y2Nlc3MocmVxLCByZXNwKTsKICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MpIG9wdGlvbnMuc3VjY2VzcyhyZXNwKTsKICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuZXJyb3IpIHsKICAgICAgICAgIG9wdGlvbnMuZXJyb3IocmVxLnN0YXR1cywgcmVzcCAmJiByZXNwLmVycm9yIHx8IGVycm9yTWVzc2FnZSwgcmVzcCAmJiByZXNwLnJlYXNvbiB8fCAibm8gcmVzcG9uc2UiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWxlcnQoZXJyb3JNZXNzYWdlICsgIjogIiArIHJlc3AucmVhc29uKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIG9iaiksIGFqYXhPcHRpb25zKSk7CiAgfQoKICBmdW5jdGlvbiBmdWxsQ29tbWl0KG9wdGlvbnMpIHsKICAgIHZhciBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5lbnN1cmVfZnVsbF9jb21taXQgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIHZhciBjb21taXQgPSBvcHRpb25zLmVuc3VyZV9mdWxsX2NvbW1pdDsKICAgICAgZGVsZXRlIG9wdGlvbnMuZW5zdXJlX2Z1bGxfY29tbWl0OwogICAgICByZXR1cm4gZnVuY3Rpb24oeGhyKSB7CiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7CiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoIlgtQ291Y2gtRnVsbC1Db21taXQiLCBjb21taXQudG9TdHJpbmcoKSk7CiAgICAgIH07CiAgICB9CiAgfTsKCiAgLy8gQ29udmVydCBhIG9wdGlvbnMgb2JqZWN0IHRvIGFuIHVybCBxdWVyeSBzdHJpbmcuCiAgLy8gZXg6IHtrZXk6J3ZhbHVlJyxrZXkyOid2YWx1ZTInfSBiZWNvbWVzICc/a2V5PSJ2YWx1ZSIma2V5Mj0idmFsdWUyIicKICBmdW5jdGlvbiBlbmNvZGVPcHRpb25zKG9wdGlvbnMpIHsKICAgIHZhciBidWYgPSBbXTsKICAgIGlmICh0eXBlb2Yob3B0aW9ucykgPT09ICJvYmplY3QiICYmIG9wdGlvbnMgIT09IG51bGwpIHsKICAgICAgZm9yICh2YXIgbmFtZSBpbiBvcHRpb25zKSB7CiAgICAgICAgaWYgKCQuaW5BcnJheShuYW1lLCBbImVycm9yIiwgInN1Y2Nlc3MiLCAiYmVmb3JlU3VjY2VzcyIsICJhamF4U3RhcnQiXSkgPj0gMCkKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIHZhciB2YWx1ZSA9IG9wdGlvbnNbbmFtZV07CiAgICAgICAgaWYgKCQuaW5BcnJheShuYW1lLCBbImtleSIsICJzdGFydGtleSIsICJlbmRrZXkiXSkgPj0gMCkgewogICAgICAgICAgdmFsdWUgPSB0b0pTT04odmFsdWUpOwogICAgICAgIH0KICAgICAgICBidWYucHVzaChlbmNvZGVVUklDb21wb25lbnQobmFtZSkgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGJ1Zi5sZW5ndGggPyAiPyIgKyBidWYuam9pbigiJiIpIDogIiI7CiAgfQoKICBmdW5jdGlvbiB0b0pTT04ob2JqKSB7CiAgICByZXR1cm4gb2JqICE9PSBudWxsID8gSlNPTi5zdHJpbmdpZnkob2JqKSA6IG51bGw7CiAgfQoKfSkoalF1ZXJ5KTs="
        },
        "xdm/json2.min.js": {
            "content_type": "application/javascript",
            "data": "LyoKICAgIGh0dHA6Ly93d3cuSlNPTi5vcmcvanNvbjIuanMKICAgIDIwMTAtMDMtMjAKCiAgICBQdWJsaWMgRG9tYWluLgoKICAgIE5PIFdBUlJBTlRZIEVYUFJFU1NFRCBPUiBJTVBMSUVELiBVU0UgQVQgWU9VUiBPV04gUklTSy4KCiAgICBTZWUgaHR0cDovL3d3dy5KU09OLm9yZy9qcy5odG1sCgoKICAgIFRoaXMgY29kZSBzaG91bGQgYmUgbWluaWZpZWQgYmVmb3JlIGRlcGxveW1lbnQuCiAgICBTZWUgaHR0cDovL2phdmFzY3JpcHQuY3JvY2tmb3JkLmNvbS9qc21pbi5odG1sCgogICAgVVNFIFlPVVIgT1dOIENPUFkuIElUIElTIEVYVFJFTUVMWSBVTldJU0UgVE8gTE9BRCBDT0RFIEZST00gU0VSVkVSUyBZT1UgRE8KICAgIE5PVCBDT05UUk9MLgoKCiAgICBUaGlzIGZpbGUgY3JlYXRlcyBhIGdsb2JhbCBKU09OIG9iamVjdCBjb250YWluaW5nIHR3byBtZXRob2RzOiBzdHJpbmdpZnkKICAgIGFuZCBwYXJzZS4KCiAgICAgICAgSlNPTi5zdHJpbmdpZnkodmFsdWUsIHJlcGxhY2VyLCBzcGFjZSkKICAgICAgICAgICAgdmFsdWUgICAgICAgYW55IEphdmFTY3JpcHQgdmFsdWUsIHVzdWFsbHkgYW4gb2JqZWN0IG9yIGFycmF5LgoKICAgICAgICAgICAgcmVwbGFjZXIgICAgYW4gb3B0aW9uYWwgcGFyYW1ldGVyIHRoYXQgZGV0ZXJtaW5lcyBob3cgb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcyBhcmUgc3RyaW5naWZpZWQgZm9yIG9iamVjdHMuIEl0IGNhbiBiZSBhCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG9yIGFuIGFycmF5IG9mIHN0cmluZ3MuCgogICAgICAgICAgICBzcGFjZSAgICAgICBhbiBvcHRpb25hbCBwYXJhbWV0ZXIgdGhhdCBzcGVjaWZpZXMgdGhlIGluZGVudGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIG9mIG5lc3RlZCBzdHJ1Y3R1cmVzLiBJZiBpdCBpcyBvbWl0dGVkLCB0aGUgdGV4dCB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAgIGJlIHBhY2tlZCB3aXRob3V0IGV4dHJhIHdoaXRlc3BhY2UuIElmIGl0IGlzIGEgbnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICBpdCB3aWxsIHNwZWNpZnkgdGhlIG51bWJlciBvZiBzcGFjZXMgdG8gaW5kZW50IGF0IGVhY2gKICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWwuIElmIGl0IGlzIGEgc3RyaW5nIChzdWNoIGFzICdcdCcgb3IgJyZuYnNwOycpLAogICAgICAgICAgICAgICAgICAgICAgICBpdCBjb250YWlucyB0aGUgY2hhcmFjdGVycyB1c2VkIHRvIGluZGVudCBhdCBlYWNoIGxldmVsLgoKICAgICAgICAgICAgVGhpcyBtZXRob2QgcHJvZHVjZXMgYSBKU09OIHRleHQgZnJvbSBhIEphdmFTY3JpcHQgdmFsdWUuCgogICAgICAgICAgICBXaGVuIGFuIG9iamVjdCB2YWx1ZSBpcyBmb3VuZCwgaWYgdGhlIG9iamVjdCBjb250YWlucyBhIHRvSlNPTgogICAgICAgICAgICBtZXRob2QsIGl0cyB0b0pTT04gbWV0aG9kIHdpbGwgYmUgY2FsbGVkIGFuZCB0aGUgcmVzdWx0IHdpbGwgYmUKICAgICAgICAgICAgc3RyaW5naWZpZWQuIEEgdG9KU09OIG1ldGhvZCBkb2VzIG5vdCBzZXJpYWxpemU6IGl0IHJldHVybnMgdGhlCiAgICAgICAgICAgIHZhbHVlIHJlcHJlc2VudGVkIGJ5IHRoZSBuYW1lL3ZhbHVlIHBhaXIgdGhhdCBzaG91bGQgYmUgc2VyaWFsaXplZCwKICAgICAgICAgICAgb3IgdW5kZWZpbmVkIGlmIG5vdGhpbmcgc2hvdWxkIGJlIHNlcmlhbGl6ZWQuIFRoZSB0b0pTT04gbWV0aG9kCiAgICAgICAgICAgIHdpbGwgYmUgcGFzc2VkIHRoZSBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoZSB2YWx1ZSwgYW5kIHRoaXMgd2lsbCBiZQogICAgICAgICAgICBib3VuZCB0byB0aGUgdmFsdWUKCiAgICAgICAgICAgIEZvciBleGFtcGxlLCB0aGlzIHdvdWxkIHNlcmlhbGl6ZSBEYXRlcyBhcyBJU08gc3RyaW5ncy4KCiAgICAgICAgICAgICAgICBEYXRlLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZihuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcm1hdCBpbnRlZ2VycyB0byBoYXZlIGF0IGxlYXN0IHR3byBkaWdpdHMuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuIDwgMTAgPyAnMCcgKyBuIDogbjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFVUQ0Z1bGxZZWFyKCkgICArICctJyArCiAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDTW9udGgoKSArIDEpICsgJy0nICsKICAgICAgICAgICAgICAgICAgICAgICAgIGYodGhpcy5nZXRVVENEYXRlKCkpICAgICAgKyAnVCcgKwogICAgICAgICAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ0hvdXJzKCkpICAgICArICc6JyArCiAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDTWludXRlcygpKSAgICsgJzonICsKICAgICAgICAgICAgICAgICAgICAgICAgIGYodGhpcy5nZXRVVENTZWNvbmRzKCkpICAgKyAnWic7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgWW91IGNhbiBwcm92aWRlIGFuIG9wdGlvbmFsIHJlcGxhY2VyIG1ldGhvZC4gSXQgd2lsbCBiZSBwYXNzZWQgdGhlCiAgICAgICAgICAgIGtleSBhbmQgdmFsdWUgb2YgZWFjaCBtZW1iZXIsIHdpdGggdGhpcyBib3VuZCB0byB0aGUgY29udGFpbmluZwogICAgICAgICAgICBvYmplY3QuIFRoZSB2YWx1ZSB0aGF0IGlzIHJldHVybmVkIGZyb20geW91ciBtZXRob2Qgd2lsbCBiZQogICAgICAgICAgICBzZXJpYWxpemVkLiBJZiB5b3VyIG1ldGhvZCByZXR1cm5zIHVuZGVmaW5lZCwgdGhlbiB0aGUgbWVtYmVyIHdpbGwKICAgICAgICAgICAgYmUgZXhjbHVkZWQgZnJvbSB0aGUgc2VyaWFsaXphdGlvbi4KCiAgICAgICAgICAgIElmIHRoZSByZXBsYWNlciBwYXJhbWV0ZXIgaXMgYW4gYXJyYXkgb2Ygc3RyaW5ncywgdGhlbiBpdCB3aWxsIGJlCiAgICAgICAgICAgIHVzZWQgdG8gc2VsZWN0IHRoZSBtZW1iZXJzIHRvIGJlIHNlcmlhbGl6ZWQuIEl0IGZpbHRlcnMgdGhlIHJlc3VsdHMKICAgICAgICAgICAgc3VjaCB0aGF0IG9ubHkgbWVtYmVycyB3aXRoIGtleXMgbGlzdGVkIGluIHRoZSByZXBsYWNlciBhcnJheSBhcmUKICAgICAgICAgICAgc3RyaW5naWZpZWQuCgogICAgICAgICAgICBWYWx1ZXMgdGhhdCBkbyBub3QgaGF2ZSBKU09OIHJlcHJlc2VudGF0aW9ucywgc3VjaCBhcyB1bmRlZmluZWQgb3IKICAgICAgICAgICAgZnVuY3Rpb25zLCB3aWxsIG5vdCBiZSBzZXJpYWxpemVkLiBTdWNoIHZhbHVlcyBpbiBvYmplY3RzIHdpbGwgYmUKICAgICAgICAgICAgZHJvcHBlZDsgaW4gYXJyYXlzIHRoZXkgd2lsbCBiZSByZXBsYWNlZCB3aXRoIG51bGwuIFlvdSBjYW4gdXNlCiAgICAgICAgICAgIGEgcmVwbGFjZXIgZnVuY3Rpb24gdG8gcmVwbGFjZSB0aG9zZSB3aXRoIEpTT04gdmFsdWVzLgogICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh1bmRlZmluZWQpIHJldHVybnMgdW5kZWZpbmVkLgoKICAgICAgICAgICAgVGhlIG9wdGlvbmFsIHNwYWNlIHBhcmFtZXRlciBwcm9kdWNlcyBhIHN0cmluZ2lmaWNhdGlvbiBvZiB0aGUKICAgICAgICAgICAgdmFsdWUgdGhhdCBpcyBmaWxsZWQgd2l0aCBsaW5lIGJyZWFrcyBhbmQgaW5kZW50YXRpb24gdG8gbWFrZSBpdAogICAgICAgICAgICBlYXNpZXIgdG8gcmVhZC4KCiAgICAgICAgICAgIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBub24tZW1wdHkgc3RyaW5nLCB0aGVuIHRoYXQgc3RyaW5nIHdpbGwKICAgICAgICAgICAgYmUgdXNlZCBmb3IgaW5kZW50YXRpb24uIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBudW1iZXIsIHRoZW4KICAgICAgICAgICAgdGhlIGluZGVudGF0aW9uIHdpbGwgYmUgdGhhdCBtYW55IHNwYWNlcy4KCiAgICAgICAgICAgIEV4YW1wbGU6CgogICAgICAgICAgICB0ZXh0ID0gSlNPTi5zdHJpbmdpZnkoWydlJywge3BsdXJpYnVzOiAndW51bSd9XSk7CiAgICAgICAgICAgIC8vIHRleHQgaXMgJ1siZSIseyJwbHVyaWJ1cyI6InVudW0ifV0nCgoKICAgICAgICAgICAgdGV4dCA9IEpTT04uc3RyaW5naWZ5KFsnZScsIHtwbHVyaWJ1czogJ3VudW0nfV0sIG51bGwsICdcdCcpOwogICAgICAgICAgICAvLyB0ZXh0IGlzICdbXG5cdCJlIixcblx0e1xuXHRcdCJwbHVyaWJ1cyI6ICJ1bnVtIlxuXHR9XG5dJwoKICAgICAgICAgICAgdGV4dCA9IEpTT04uc3RyaW5naWZ5KFtuZXcgRGF0ZSgpXSwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzW2tleV0gaW5zdGFuY2VvZiBEYXRlID8KICAgICAgICAgICAgICAgICAgICAnRGF0ZSgnICsgdGhpc1trZXldICsgJyknIDogdmFsdWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyB0ZXh0IGlzICdbIkRhdGUoLS0tY3VycmVudCB0aW1lLS0tKSJdJwoKCiAgICAgICAgSlNPTi5wYXJzZSh0ZXh0LCByZXZpdmVyKQogICAgICAgICAgICBUaGlzIG1ldGhvZCBwYXJzZXMgYSBKU09OIHRleHQgdG8gcHJvZHVjZSBhbiBvYmplY3Qgb3IgYXJyYXkuCiAgICAgICAgICAgIEl0IGNhbiB0aHJvdyBhIFN5bnRheEVycm9yIGV4Y2VwdGlvbi4KCiAgICAgICAgICAgIFRoZSBvcHRpb25hbCByZXZpdmVyIHBhcmFtZXRlciBpcyBhIGZ1bmN0aW9uIHRoYXQgY2FuIGZpbHRlciBhbmQKICAgICAgICAgICAgdHJhbnNmb3JtIHRoZSByZXN1bHRzLiBJdCByZWNlaXZlcyBlYWNoIG9mIHRoZSBrZXlzIGFuZCB2YWx1ZXMsCiAgICAgICAgICAgIGFuZCBpdHMgcmV0dXJuIHZhbHVlIGlzIHVzZWQgaW5zdGVhZCBvZiB0aGUgb3JpZ2luYWwgdmFsdWUuCiAgICAgICAgICAgIElmIGl0IHJldHVybnMgd2hhdCBpdCByZWNlaXZlZCwgdGhlbiB0aGUgc3RydWN0dXJlIGlzIG5vdCBtb2RpZmllZC4KICAgICAgICAgICAgSWYgaXQgcmV0dXJucyB1bmRlZmluZWQgdGhlbiB0aGUgbWVtYmVyIGlzIGRlbGV0ZWQuCgogICAgICAgICAgICBFeGFtcGxlOgoKICAgICAgICAgICAgLy8gUGFyc2UgdGhlIHRleHQuIFZhbHVlcyB0aGF0IGxvb2sgbGlrZSBJU08gZGF0ZSBzdHJpbmdzIHdpbGwKICAgICAgICAgICAgLy8gYmUgY29udmVydGVkIHRvIERhdGUgb2JqZWN0cy4KCiAgICAgICAgICAgIG15RGF0YSA9IEpTT04ucGFyc2UodGV4dCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICBhID0KL14oXGR7NH0pLShcZHsyfSktKFxkezJ9KVQoXGR7Mn0pOihcZHsyfSk6KFxkezJ9KD86XC5cZCopPylaJC8uZXhlYyh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKCthWzFdLCArYVsyXSAtIDEsICthWzNdLCArYVs0XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICthWzVdLCArYVs2XSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBteURhdGEgPSBKU09OLnBhcnNlKCdbIkRhdGUoMDkvMDkvMjAwMSkiXScsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICB2YXIgZDsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNsaWNlKDAsIDUpID09PSAnRGF0ZSgnICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNsaWNlKC0xKSA9PT0gJyknKSB7CiAgICAgICAgICAgICAgICAgICAgZCA9IG5ldyBEYXRlKHZhbHVlLnNsaWNlKDUsIC0xKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9KTsKCgogICAgVGhpcyBpcyBhIHJlZmVyZW5jZSBpbXBsZW1lbnRhdGlvbi4gWW91IGFyZSBmcmVlIHRvIGNvcHksIG1vZGlmeSwgb3IKICAgIHJlZGlzdHJpYnV0ZS4KKi8vKmpzbGludCBldmlsOiB0cnVlLCBzdHJpY3Q6IGZhbHNlICovLyptZW1iZXJzICIiLCAiXGIiLCAiXHQiLCAiXG4iLCAiXGYiLCAiXHIiLCAiXCIiLCBKU09OLCAiXFwiLCBhcHBseSwKICAgIGNhbGwsIGNoYXJDb2RlQXQsIGdldFVUQ0RhdGUsIGdldFVUQ0Z1bGxZZWFyLCBnZXRVVENIb3VycywKICAgIGdldFVUQ01pbnV0ZXMsIGdldFVUQ01vbnRoLCBnZXRVVENTZWNvbmRzLCBoYXNPd25Qcm9wZXJ0eSwgam9pbiwKICAgIGxhc3RJbmRleCwgbGVuZ3RoLCBwYXJzZSwgcHJvdG90eXBlLCBwdXNoLCByZXBsYWNlLCBzbGljZSwgc3RyaW5naWZ5LAogICAgdGVzdCwgdG9KU09OLCB0b1N0cmluZywgdmFsdWVPZgoqLy8vIENyZWF0ZSBhIEpTT04gb2JqZWN0IG9ubHkgaWYgb25lIGRvZXMgbm90IGFscmVhZHkgZXhpc3QuIFdlIGNyZWF0ZSB0aGUKLy8gbWV0aG9kcyBpbiBhIGNsb3N1cmUgdG8gYXZvaWQgY3JlYXRpbmcgZ2xvYmFsIHZhcmlhYmxlcy4KdGhpcy5KU09OfHwodGhpcy5KU09OPXt9KSxmdW5jdGlvbigpe2Z1bmN0aW9uIGYoYSl7cmV0dXJuIGE8MTA/IjAiK2E6YX1mdW5jdGlvbiBxdW90ZShhKXtyZXR1cm4gZXNjYXBhYmxlLmxhc3RJbmRleD0wLGVzY2FwYWJsZS50ZXN0KGEpPyciJythLnJlcGxhY2UoZXNjYXBhYmxlLGZ1bmN0aW9uKGEpe3ZhciBiPW1ldGFbYV07cmV0dXJuIHR5cGVvZiBiPT0ic3RyaW5nIj9iOiJcXHUiKygiMDAwMCIrYS5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTQpfSkrJyInOiciJythKyciJ31mdW5jdGlvbiBzdHIoYSxiKXt2YXIgYyxkLGUsZixnPWdhcCxoLGk9YlthXTtpJiZ0eXBlb2YgaT09Im9iamVjdCImJnR5cGVvZiBpLnRvSlNPTj09ImZ1bmN0aW9uIiYmKGk9aS50b0pTT04oYSkpLHR5cGVvZiByZXA9PSJmdW5jdGlvbiImJihpPXJlcC5jYWxsKGIsYSxpKSk7c3dpdGNoKHR5cGVvZiBpKXtjYXNlInN0cmluZyI6cmV0dXJuIHF1b3RlKGkpO2Nhc2UibnVtYmVyIjpyZXR1cm4gaXNGaW5pdGUoaSk/U3RyaW5nKGkpOiJudWxsIjtjYXNlImJvb2xlYW4iOmNhc2UibnVsbCI6cmV0dXJuIFN0cmluZyhpKTtjYXNlIm9iamVjdCI6aWYoIWkpcmV0dXJuIm51bGwiO2dhcCs9aW5kZW50LGg9W107aWYoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5hcHBseShpKT09PSJbb2JqZWN0IEFycmF5XSIpe2Y9aS5sZW5ndGg7Zm9yKGM9MDtjPGY7Yys9MSloW2NdPXN0cihjLGkpfHwibnVsbCI7cmV0dXJuIGU9aC5sZW5ndGg9PT0wPyJbXSI6Z2FwPyJbXG4iK2dhcCtoLmpvaW4oIixcbiIrZ2FwKSsiXG4iK2crIl0iOiJbIitoLmpvaW4oIiwiKSsiXSIsZ2FwPWcsZX1pZihyZXAmJnR5cGVvZiByZXA9PSJvYmplY3QiKXtmPXJlcC5sZW5ndGg7Zm9yKGM9MDtjPGY7Yys9MSlkPXJlcFtjXSx0eXBlb2YgZD09InN0cmluZyImJihlPXN0cihkLGkpLGUmJmgucHVzaChxdW90ZShkKSsoZ2FwPyI6ICI6IjoiKStlKSl9ZWxzZSBmb3IoZCBpbiBpKU9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGksZCkmJihlPXN0cihkLGkpLGUmJmgucHVzaChxdW90ZShkKSsoZ2FwPyI6ICI6IjoiKStlKSk7cmV0dXJuIGU9aC5sZW5ndGg9PT0wPyJ7fSI6Z2FwPyJ7XG4iK2dhcCtoLmpvaW4oIixcbiIrZ2FwKSsiXG4iK2crIn0iOiJ7IitoLmpvaW4oIiwiKSsifSIsZ2FwPWcsZX19dHlwZW9mIERhdGUucHJvdG90eXBlLnRvSlNPTiE9ImZ1bmN0aW9uIiYmKERhdGUucHJvdG90eXBlLnRvSlNPTj1mdW5jdGlvbihhKXtyZXR1cm4gaXNGaW5pdGUodGhpcy52YWx1ZU9mKCkpP3RoaXMuZ2V0VVRDRnVsbFllYXIoKSsiLSIrZih0aGlzLmdldFVUQ01vbnRoKCkrMSkrIi0iK2YodGhpcy5nZXRVVENEYXRlKCkpKyJUIitmKHRoaXMuZ2V0VVRDSG91cnMoKSkrIjoiK2YodGhpcy5nZXRVVENNaW51dGVzKCkpKyI6IitmKHRoaXMuZ2V0VVRDU2Vjb25kcygpKSsiWiI6bnVsbH0sU3RyaW5nLnByb3RvdHlwZS50b0pTT049TnVtYmVyLnByb3RvdHlwZS50b0pTT049Qm9vbGVhbi5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnZhbHVlT2YoKX0pO3ZhciBjeD0vW1x1MDAwMFx1MDBhZFx1MDYwMC1cdTA2MDRcdTA3MGZcdTE3YjRcdTE3YjVcdTIwMGMtXHUyMDBmXHUyMDI4LVx1MjAyZlx1MjA2MC1cdTIwNmZcdWZlZmZcdWZmZjAtXHVmZmZmXS9nLGVzY2FwYWJsZT0vW1xcXCJceDAwLVx4MWZceDdmLVx4OWZcdTAwYWRcdTA2MDAtXHUwNjA0XHUwNzBmXHUxN2I0XHUxN2I1XHUyMDBjLVx1MjAwZlx1MjAyOC1cdTIwMmZcdTIwNjAtXHUyMDZmXHVmZWZmXHVmZmYwLVx1ZmZmZl0vZyxnYXAsaW5kZW50LG1ldGE9eyJcYiI6IlxcYiIsIlx0IjoiXFx0IiwiXG4iOiJcXG4iLCJcZiI6IlxcZiIsIlxyIjoiXFxyIiwnIic6J1xcIicsIlxcIjoiXFxcXCJ9LHJlcDt0eXBlb2YgSlNPTi5zdHJpbmdpZnkhPSJmdW5jdGlvbiImJihKU09OLnN0cmluZ2lmeT1mdW5jdGlvbihhLGIsYyl7dmFyIGQ7Z2FwPSIiLGluZGVudD0iIjtpZih0eXBlb2YgYz09Im51bWJlciIpZm9yKGQ9MDtkPGM7ZCs9MSlpbmRlbnQrPSIgIjtlbHNlIHR5cGVvZiBjPT0ic3RyaW5nIiYmKGluZGVudD1jKTtyZXA9YjtpZighYnx8dHlwZW9mIGI9PSJmdW5jdGlvbiJ8fHR5cGVvZiBiPT0ib2JqZWN0IiYmdHlwZW9mIGIubGVuZ3RoPT0ibnVtYmVyIilyZXR1cm4gc3RyKCIiLHsiIjphfSk7dGhyb3cgbmV3IEVycm9yKCJKU09OLnN0cmluZ2lmeSIpfSksdHlwZW9mIEpTT04ucGFyc2UhPSJmdW5jdGlvbiImJihKU09OLnBhcnNlPWZ1bmN0aW9uKHRleHQscmV2aXZlcil7ZnVuY3Rpb24gd2FsayhhLGIpe3ZhciBjLGQsZT1hW2JdO2lmKGUmJnR5cGVvZiBlPT0ib2JqZWN0Iilmb3IoYyBpbiBlKU9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsYykmJihkPXdhbGsoZSxjKSxkIT09dW5kZWZpbmVkP2VbY109ZDpkZWxldGUgZVtjXSk7cmV0dXJuIHJldml2ZXIuY2FsbChhLGIsZSl9dmFyIGo7dGV4dD1TdHJpbmcodGV4dCksY3gubGFzdEluZGV4PTAsY3gudGVzdCh0ZXh0KSYmKHRleHQ9dGV4dC5yZXBsYWNlKGN4LGZ1bmN0aW9uKGEpe3JldHVybiJcXHUiKygiMDAwMCIrYS5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTQpfSkpO2lmKC9eW1xdLDp7fVxzXSokLy50ZXN0KHRleHQucmVwbGFjZSgvXFwoPzpbIlxcXC9iZm5ydF18dVswLTlhLWZBLUZdezR9KS9nLCJAIikucmVwbGFjZSgvIlteIlxcXG5ccl0qInx0cnVlfGZhbHNlfG51bGx8LT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/L2csIl0iKS5yZXBsYWNlKC8oPzpefDp8LCkoPzpccypcWykrL2csIiIpKSlyZXR1cm4gaj1ldmFsKCIoIit0ZXh0KyIpIiksdHlwZW9mIHJldml2ZXI9PSJmdW5jdGlvbiI/d2Fsayh7IiI6an0sIiIpOmo7dGhyb3cgbmV3IFN5bnRheEVycm9yKCJKU09OLnBhcnNlIil9KX0oKQ=="
        },
        "xdm/json2.js": {
            "content_type": "application/javascript",
            "data": "LyoKICAgIGh0dHA6Ly93d3cuSlNPTi5vcmcvanNvbjIuanMKICAgIDIwMTAtMDMtMjAKCiAgICBQdWJsaWMgRG9tYWluLgoKICAgIE5PIFdBUlJBTlRZIEVYUFJFU1NFRCBPUiBJTVBMSUVELiBVU0UgQVQgWU9VUiBPV04gUklTSy4KCiAgICBTZWUgaHR0cDovL3d3dy5KU09OLm9yZy9qcy5odG1sCgoKICAgIFRoaXMgY29kZSBzaG91bGQgYmUgbWluaWZpZWQgYmVmb3JlIGRlcGxveW1lbnQuCiAgICBTZWUgaHR0cDovL2phdmFzY3JpcHQuY3JvY2tmb3JkLmNvbS9qc21pbi5odG1sCgogICAgVVNFIFlPVVIgT1dOIENPUFkuIElUIElTIEVYVFJFTUVMWSBVTldJU0UgVE8gTE9BRCBDT0RFIEZST00gU0VSVkVSUyBZT1UgRE8KICAgIE5PVCBDT05UUk9MLgoKCiAgICBUaGlzIGZpbGUgY3JlYXRlcyBhIGdsb2JhbCBKU09OIG9iamVjdCBjb250YWluaW5nIHR3byBtZXRob2RzOiBzdHJpbmdpZnkKICAgIGFuZCBwYXJzZS4KCiAgICAgICAgSlNPTi5zdHJpbmdpZnkodmFsdWUsIHJlcGxhY2VyLCBzcGFjZSkKICAgICAgICAgICAgdmFsdWUgICAgICAgYW55IEphdmFTY3JpcHQgdmFsdWUsIHVzdWFsbHkgYW4gb2JqZWN0IG9yIGFycmF5LgoKICAgICAgICAgICAgcmVwbGFjZXIgICAgYW4gb3B0aW9uYWwgcGFyYW1ldGVyIHRoYXQgZGV0ZXJtaW5lcyBob3cgb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcyBhcmUgc3RyaW5naWZpZWQgZm9yIG9iamVjdHMuIEl0IGNhbiBiZSBhCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG9yIGFuIGFycmF5IG9mIHN0cmluZ3MuCgogICAgICAgICAgICBzcGFjZSAgICAgICBhbiBvcHRpb25hbCBwYXJhbWV0ZXIgdGhhdCBzcGVjaWZpZXMgdGhlIGluZGVudGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIG9mIG5lc3RlZCBzdHJ1Y3R1cmVzLiBJZiBpdCBpcyBvbWl0dGVkLCB0aGUgdGV4dCB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAgIGJlIHBhY2tlZCB3aXRob3V0IGV4dHJhIHdoaXRlc3BhY2UuIElmIGl0IGlzIGEgbnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICBpdCB3aWxsIHNwZWNpZnkgdGhlIG51bWJlciBvZiBzcGFjZXMgdG8gaW5kZW50IGF0IGVhY2gKICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWwuIElmIGl0IGlzIGEgc3RyaW5nIChzdWNoIGFzICdcdCcgb3IgJyZuYnNwOycpLAogICAgICAgICAgICAgICAgICAgICAgICBpdCBjb250YWlucyB0aGUgY2hhcmFjdGVycyB1c2VkIHRvIGluZGVudCBhdCBlYWNoIGxldmVsLgoKICAgICAgICAgICAgVGhpcyBtZXRob2QgcHJvZHVjZXMgYSBKU09OIHRleHQgZnJvbSBhIEphdmFTY3JpcHQgdmFsdWUuCgogICAgICAgICAgICBXaGVuIGFuIG9iamVjdCB2YWx1ZSBpcyBmb3VuZCwgaWYgdGhlIG9iamVjdCBjb250YWlucyBhIHRvSlNPTgogICAgICAgICAgICBtZXRob2QsIGl0cyB0b0pTT04gbWV0aG9kIHdpbGwgYmUgY2FsbGVkIGFuZCB0aGUgcmVzdWx0IHdpbGwgYmUKICAgICAgICAgICAgc3RyaW5naWZpZWQuIEEgdG9KU09OIG1ldGhvZCBkb2VzIG5vdCBzZXJpYWxpemU6IGl0IHJldHVybnMgdGhlCiAgICAgICAgICAgIHZhbHVlIHJlcHJlc2VudGVkIGJ5IHRoZSBuYW1lL3ZhbHVlIHBhaXIgdGhhdCBzaG91bGQgYmUgc2VyaWFsaXplZCwKICAgICAgICAgICAgb3IgdW5kZWZpbmVkIGlmIG5vdGhpbmcgc2hvdWxkIGJlIHNlcmlhbGl6ZWQuIFRoZSB0b0pTT04gbWV0aG9kCiAgICAgICAgICAgIHdpbGwgYmUgcGFzc2VkIHRoZSBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoZSB2YWx1ZSwgYW5kIHRoaXMgd2lsbCBiZQogICAgICAgICAgICBib3VuZCB0byB0aGUgdmFsdWUKCiAgICAgICAgICAgIEZvciBleGFtcGxlLCB0aGlzIHdvdWxkIHNlcmlhbGl6ZSBEYXRlcyBhcyBJU08gc3RyaW5ncy4KCiAgICAgICAgICAgICAgICBEYXRlLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZihuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcm1hdCBpbnRlZ2VycyB0byBoYXZlIGF0IGxlYXN0IHR3byBkaWdpdHMuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuIDwgMTAgPyAnMCcgKyBuIDogbjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFVUQ0Z1bGxZZWFyKCkgICArICctJyArCiAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDTW9udGgoKSArIDEpICsgJy0nICsKICAgICAgICAgICAgICAgICAgICAgICAgIGYodGhpcy5nZXRVVENEYXRlKCkpICAgICAgKyAnVCcgKwogICAgICAgICAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ0hvdXJzKCkpICAgICArICc6JyArCiAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDTWludXRlcygpKSAgICsgJzonICsKICAgICAgICAgICAgICAgICAgICAgICAgIGYodGhpcy5nZXRVVENTZWNvbmRzKCkpICAgKyAnWic7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgWW91IGNhbiBwcm92aWRlIGFuIG9wdGlvbmFsIHJlcGxhY2VyIG1ldGhvZC4gSXQgd2lsbCBiZSBwYXNzZWQgdGhlCiAgICAgICAgICAgIGtleSBhbmQgdmFsdWUgb2YgZWFjaCBtZW1iZXIsIHdpdGggdGhpcyBib3VuZCB0byB0aGUgY29udGFpbmluZwogICAgICAgICAgICBvYmplY3QuIFRoZSB2YWx1ZSB0aGF0IGlzIHJldHVybmVkIGZyb20geW91ciBtZXRob2Qgd2lsbCBiZQogICAgICAgICAgICBzZXJpYWxpemVkLiBJZiB5b3VyIG1ldGhvZCByZXR1cm5zIHVuZGVmaW5lZCwgdGhlbiB0aGUgbWVtYmVyIHdpbGwKICAgICAgICAgICAgYmUgZXhjbHVkZWQgZnJvbSB0aGUgc2VyaWFsaXphdGlvbi4KCiAgICAgICAgICAgIElmIHRoZSByZXBsYWNlciBwYXJhbWV0ZXIgaXMgYW4gYXJyYXkgb2Ygc3RyaW5ncywgdGhlbiBpdCB3aWxsIGJlCiAgICAgICAgICAgIHVzZWQgdG8gc2VsZWN0IHRoZSBtZW1iZXJzIHRvIGJlIHNlcmlhbGl6ZWQuIEl0IGZpbHRlcnMgdGhlIHJlc3VsdHMKICAgICAgICAgICAgc3VjaCB0aGF0IG9ubHkgbWVtYmVycyB3aXRoIGtleXMgbGlzdGVkIGluIHRoZSByZXBsYWNlciBhcnJheSBhcmUKICAgICAgICAgICAgc3RyaW5naWZpZWQuCgogICAgICAgICAgICBWYWx1ZXMgdGhhdCBkbyBub3QgaGF2ZSBKU09OIHJlcHJlc2VudGF0aW9ucywgc3VjaCBhcyB1bmRlZmluZWQgb3IKICAgICAgICAgICAgZnVuY3Rpb25zLCB3aWxsIG5vdCBiZSBzZXJpYWxpemVkLiBTdWNoIHZhbHVlcyBpbiBvYmplY3RzIHdpbGwgYmUKICAgICAgICAgICAgZHJvcHBlZDsgaW4gYXJyYXlzIHRoZXkgd2lsbCBiZSByZXBsYWNlZCB3aXRoIG51bGwuIFlvdSBjYW4gdXNlCiAgICAgICAgICAgIGEgcmVwbGFjZXIgZnVuY3Rpb24gdG8gcmVwbGFjZSB0aG9zZSB3aXRoIEpTT04gdmFsdWVzLgogICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh1bmRlZmluZWQpIHJldHVybnMgdW5kZWZpbmVkLgoKICAgICAgICAgICAgVGhlIG9wdGlvbmFsIHNwYWNlIHBhcmFtZXRlciBwcm9kdWNlcyBhIHN0cmluZ2lmaWNhdGlvbiBvZiB0aGUKICAgICAgICAgICAgdmFsdWUgdGhhdCBpcyBmaWxsZWQgd2l0aCBsaW5lIGJyZWFrcyBhbmQgaW5kZW50YXRpb24gdG8gbWFrZSBpdAogICAgICAgICAgICBlYXNpZXIgdG8gcmVhZC4KCiAgICAgICAgICAgIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBub24tZW1wdHkgc3RyaW5nLCB0aGVuIHRoYXQgc3RyaW5nIHdpbGwKICAgICAgICAgICAgYmUgdXNlZCBmb3IgaW5kZW50YXRpb24uIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBudW1iZXIsIHRoZW4KICAgICAgICAgICAgdGhlIGluZGVudGF0aW9uIHdpbGwgYmUgdGhhdCBtYW55IHNwYWNlcy4KCiAgICAgICAgICAgIEV4YW1wbGU6CgogICAgICAgICAgICB0ZXh0ID0gSlNPTi5zdHJpbmdpZnkoWydlJywge3BsdXJpYnVzOiAndW51bSd9XSk7CiAgICAgICAgICAgIC8vIHRleHQgaXMgJ1siZSIseyJwbHVyaWJ1cyI6InVudW0ifV0nCgoKICAgICAgICAgICAgdGV4dCA9IEpTT04uc3RyaW5naWZ5KFsnZScsIHtwbHVyaWJ1czogJ3VudW0nfV0sIG51bGwsICdcdCcpOwogICAgICAgICAgICAvLyB0ZXh0IGlzICdbXG5cdCJlIixcblx0e1xuXHRcdCJwbHVyaWJ1cyI6ICJ1bnVtIlxuXHR9XG5dJwoKICAgICAgICAgICAgdGV4dCA9IEpTT04uc3RyaW5naWZ5KFtuZXcgRGF0ZSgpXSwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzW2tleV0gaW5zdGFuY2VvZiBEYXRlID8KICAgICAgICAgICAgICAgICAgICAnRGF0ZSgnICsgdGhpc1trZXldICsgJyknIDogdmFsdWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyB0ZXh0IGlzICdbIkRhdGUoLS0tY3VycmVudCB0aW1lLS0tKSJdJwoKCiAgICAgICAgSlNPTi5wYXJzZSh0ZXh0LCByZXZpdmVyKQogICAgICAgICAgICBUaGlzIG1ldGhvZCBwYXJzZXMgYSBKU09OIHRleHQgdG8gcHJvZHVjZSBhbiBvYmplY3Qgb3IgYXJyYXkuCiAgICAgICAgICAgIEl0IGNhbiB0aHJvdyBhIFN5bnRheEVycm9yIGV4Y2VwdGlvbi4KCiAgICAgICAgICAgIFRoZSBvcHRpb25hbCByZXZpdmVyIHBhcmFtZXRlciBpcyBhIGZ1bmN0aW9uIHRoYXQgY2FuIGZpbHRlciBhbmQKICAgICAgICAgICAgdHJhbnNmb3JtIHRoZSByZXN1bHRzLiBJdCByZWNlaXZlcyBlYWNoIG9mIHRoZSBrZXlzIGFuZCB2YWx1ZXMsCiAgICAgICAgICAgIGFuZCBpdHMgcmV0dXJuIHZhbHVlIGlzIHVzZWQgaW5zdGVhZCBvZiB0aGUgb3JpZ2luYWwgdmFsdWUuCiAgICAgICAgICAgIElmIGl0IHJldHVybnMgd2hhdCBpdCByZWNlaXZlZCwgdGhlbiB0aGUgc3RydWN0dXJlIGlzIG5vdCBtb2RpZmllZC4KICAgICAgICAgICAgSWYgaXQgcmV0dXJucyB1bmRlZmluZWQgdGhlbiB0aGUgbWVtYmVyIGlzIGRlbGV0ZWQuCgogICAgICAgICAgICBFeGFtcGxlOgoKICAgICAgICAgICAgLy8gUGFyc2UgdGhlIHRleHQuIFZhbHVlcyB0aGF0IGxvb2sgbGlrZSBJU08gZGF0ZSBzdHJpbmdzIHdpbGwKICAgICAgICAgICAgLy8gYmUgY29udmVydGVkIHRvIERhdGUgb2JqZWN0cy4KCiAgICAgICAgICAgIG15RGF0YSA9IEpTT04ucGFyc2UodGV4dCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICBhID0KL14oXGR7NH0pLShcZHsyfSktKFxkezJ9KVQoXGR7Mn0pOihcZHsyfSk6KFxkezJ9KD86XC5cZCopPylaJC8uZXhlYyh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKCthWzFdLCArYVsyXSAtIDEsICthWzNdLCArYVs0XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICthWzVdLCArYVs2XSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBteURhdGEgPSBKU09OLnBhcnNlKCdbIkRhdGUoMDkvMDkvMjAwMSkiXScsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICB2YXIgZDsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNsaWNlKDAsIDUpID09PSAnRGF0ZSgnICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNsaWNlKC0xKSA9PT0gJyknKSB7CiAgICAgICAgICAgICAgICAgICAgZCA9IG5ldyBEYXRlKHZhbHVlLnNsaWNlKDUsIC0xKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9KTsKCgogICAgVGhpcyBpcyBhIHJlZmVyZW5jZSBpbXBsZW1lbnRhdGlvbi4gWW91IGFyZSBmcmVlIHRvIGNvcHksIG1vZGlmeSwgb3IKICAgIHJlZGlzdHJpYnV0ZS4KKi8KCi8qanNsaW50IGV2aWw6IHRydWUsIHN0cmljdDogZmFsc2UgKi8KCi8qbWVtYmVycyAiIiwgIlxiIiwgIlx0IiwgIlxuIiwgIlxmIiwgIlxyIiwgIlwiIiwgSlNPTiwgIlxcIiwgYXBwbHksCiAgICBjYWxsLCBjaGFyQ29kZUF0LCBnZXRVVENEYXRlLCBnZXRVVENGdWxsWWVhciwgZ2V0VVRDSG91cnMsCiAgICBnZXRVVENNaW51dGVzLCBnZXRVVENNb250aCwgZ2V0VVRDU2Vjb25kcywgaGFzT3duUHJvcGVydHksIGpvaW4sCiAgICBsYXN0SW5kZXgsIGxlbmd0aCwgcGFyc2UsIHByb3RvdHlwZSwgcHVzaCwgcmVwbGFjZSwgc2xpY2UsIHN0cmluZ2lmeSwKICAgIHRlc3QsIHRvSlNPTiwgdG9TdHJpbmcsIHZhbHVlT2YKKi8KCgovLyBDcmVhdGUgYSBKU09OIG9iamVjdCBvbmx5IGlmIG9uZSBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0LiBXZSBjcmVhdGUgdGhlCi8vIG1ldGhvZHMgaW4gYSBjbG9zdXJlIHRvIGF2b2lkIGNyZWF0aW5nIGdsb2JhbCB2YXJpYWJsZXMuCgppZiAoIXRoaXMuSlNPTikgewogICAgdGhpcy5KU09OID0ge307Cn0KCihmdW5jdGlvbiAoKSB7CgogICAgZnVuY3Rpb24gZihuKSB7CiAgICAgICAgLy8gRm9ybWF0IGludGVnZXJzIHRvIGhhdmUgYXQgbGVhc3QgdHdvIGRpZ2l0cy4KICAgICAgICByZXR1cm4gbiA8IDEwID8gJzAnICsgbiA6IG47CiAgICB9CgogICAgaWYgKHR5cGVvZiBEYXRlLnByb3RvdHlwZS50b0pTT04gIT09ICdmdW5jdGlvbicpIHsKCiAgICAgICAgRGF0ZS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKGtleSkgewoKICAgICAgICAgICAgcmV0dXJuIGlzRmluaXRlKHRoaXMudmFsdWVPZigpKSA/CiAgICAgICAgICAgICAgICAgICB0aGlzLmdldFVUQ0Z1bGxZZWFyKCkgICArICctJyArCiAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ01vbnRoKCkgKyAxKSArICctJyArCiAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ0RhdGUoKSkgICAgICArICdUJyArCiAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ0hvdXJzKCkpICAgICArICc6JyArCiAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ01pbnV0ZXMoKSkgICArICc6JyArCiAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ1NlY29uZHMoKSkgICArICdaJyA6IG51bGw7CiAgICAgICAgfTsKCiAgICAgICAgU3RyaW5nLnByb3RvdHlwZS50b0pTT04gPQogICAgICAgIE51bWJlci5wcm90b3R5cGUudG9KU09OID0KICAgICAgICBCb29sZWFuLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlT2YoKTsKICAgICAgICB9OwogICAgfQoKICAgIHZhciBjeCA9IC9bXHUwMDAwXHUwMGFkXHUwNjAwLVx1MDYwNFx1MDcwZlx1MTdiNFx1MTdiNVx1MjAwYy1cdTIwMGZcdTIwMjgtXHUyMDJmXHUyMDYwLVx1MjA2Zlx1ZmVmZlx1ZmZmMC1cdWZmZmZdL2csCiAgICAgICAgZXNjYXBhYmxlID0gL1tcXFwiXHgwMC1ceDFmXHg3Zi1ceDlmXHUwMGFkXHUwNjAwLVx1MDYwNFx1MDcwZlx1MTdiNFx1MTdiNVx1MjAwYy1cdTIwMGZcdTIwMjgtXHUyMDJmXHUyMDYwLVx1MjA2Zlx1ZmVmZlx1ZmZmMC1cdWZmZmZdL2csCiAgICAgICAgZ2FwLAogICAgICAgIGluZGVudCwKICAgICAgICBtZXRhID0geyAgICAvLyB0YWJsZSBvZiBjaGFyYWN0ZXIgc3Vic3RpdHV0aW9ucwogICAgICAgICAgICAnXGInOiAnXFxiJywKICAgICAgICAgICAgJ1x0JzogJ1xcdCcsCiAgICAgICAgICAgICdcbic6ICdcXG4nLAogICAgICAgICAgICAnXGYnOiAnXFxmJywKICAgICAgICAgICAgJ1xyJzogJ1xccicsCiAgICAgICAgICAgICciJyA6ICdcXCInLAogICAgICAgICAgICAnXFwnOiAnXFxcXCcKICAgICAgICB9LAogICAgICAgIHJlcDsKCgogICAgZnVuY3Rpb24gcXVvdGUoc3RyaW5nKSB7CgovLyBJZiB0aGUgc3RyaW5nIGNvbnRhaW5zIG5vIGNvbnRyb2wgY2hhcmFjdGVycywgbm8gcXVvdGUgY2hhcmFjdGVycywgYW5kIG5vCi8vIGJhY2tzbGFzaCBjaGFyYWN0ZXJzLCB0aGVuIHdlIGNhbiBzYWZlbHkgc2xhcCBzb21lIHF1b3RlcyBhcm91bmQgaXQuCi8vIE90aGVyd2lzZSB3ZSBtdXN0IGFsc28gcmVwbGFjZSB0aGUgb2ZmZW5kaW5nIGNoYXJhY3RlcnMgd2l0aCBzYWZlIGVzY2FwZQovLyBzZXF1ZW5jZXMuCgogICAgICAgIGVzY2FwYWJsZS5sYXN0SW5kZXggPSAwOwogICAgICAgIHJldHVybiBlc2NhcGFibGUudGVzdChzdHJpbmcpID8KICAgICAgICAgICAgJyInICsgc3RyaW5nLnJlcGxhY2UoZXNjYXBhYmxlLCBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgdmFyIGMgPSBtZXRhW2FdOwogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBjID09PSAnc3RyaW5nJyA/IGMgOgogICAgICAgICAgICAgICAgICAgICdcXHUnICsgKCcwMDAwJyArIGEuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KTsKICAgICAgICAgICAgfSkgKyAnIicgOgogICAgICAgICAgICAnIicgKyBzdHJpbmcgKyAnIic7CiAgICB9CgoKICAgIGZ1bmN0aW9uIHN0cihrZXksIGhvbGRlcikgewoKLy8gUHJvZHVjZSBhIHN0cmluZyBmcm9tIGhvbGRlcltrZXldLgoKICAgICAgICB2YXIgaSwgICAgICAgICAgLy8gVGhlIGxvb3AgY291bnRlci4KICAgICAgICAgICAgaywgICAgICAgICAgLy8gVGhlIG1lbWJlciBrZXkuCiAgICAgICAgICAgIHYsICAgICAgICAgIC8vIFRoZSBtZW1iZXIgdmFsdWUuCiAgICAgICAgICAgIGxlbmd0aCwKICAgICAgICAgICAgbWluZCA9IGdhcCwKICAgICAgICAgICAgcGFydGlhbCwKICAgICAgICAgICAgdmFsdWUgPSBob2xkZXJba2V5XTsKCi8vIElmIHRoZSB2YWx1ZSBoYXMgYSB0b0pTT04gbWV0aG9kLCBjYWxsIGl0IHRvIG9idGFpbiBhIHJlcGxhY2VtZW50IHZhbHVlLgoKICAgICAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJgogICAgICAgICAgICAgICAgdHlwZW9mIHZhbHVlLnRvSlNPTiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnRvSlNPTihrZXkpOwogICAgICAgIH0KCi8vIElmIHdlIHdlcmUgY2FsbGVkIHdpdGggYSByZXBsYWNlciBmdW5jdGlvbiwgdGhlbiBjYWxsIHRoZSByZXBsYWNlciB0bwovLyBvYnRhaW4gYSByZXBsYWNlbWVudCB2YWx1ZS4KCiAgICAgICAgaWYgKHR5cGVvZiByZXAgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgdmFsdWUgPSByZXAuY2FsbChob2xkZXIsIGtleSwgdmFsdWUpOwogICAgICAgIH0KCi8vIFdoYXQgaGFwcGVucyBuZXh0IGRlcGVuZHMgb24gdGhlIHZhbHVlJ3MgdHlwZS4KCiAgICAgICAgc3dpdGNoICh0eXBlb2YgdmFsdWUpIHsKICAgICAgICBjYXNlICdzdHJpbmcnOgogICAgICAgICAgICByZXR1cm4gcXVvdGUodmFsdWUpOwoKICAgICAgICBjYXNlICdudW1iZXInOgoKLy8gSlNPTiBudW1iZXJzIG11c3QgYmUgZmluaXRlLiBFbmNvZGUgbm9uLWZpbml0ZSBudW1iZXJzIGFzIG51bGwuCgogICAgICAgICAgICByZXR1cm4gaXNGaW5pdGUodmFsdWUpID8gU3RyaW5nKHZhbHVlKSA6ICdudWxsJzsKCiAgICAgICAgY2FzZSAnYm9vbGVhbic6CiAgICAgICAgY2FzZSAnbnVsbCc6CgovLyBJZiB0aGUgdmFsdWUgaXMgYSBib29sZWFuIG9yIG51bGwsIGNvbnZlcnQgaXQgdG8gYSBzdHJpbmcuIE5vdGU6Ci8vIHR5cGVvZiBudWxsIGRvZXMgbm90IHByb2R1Y2UgJ251bGwnLiBUaGUgY2FzZSBpcyBpbmNsdWRlZCBoZXJlIGluCi8vIHRoZSByZW1vdGUgY2hhbmNlIHRoYXQgdGhpcyBnZXRzIGZpeGVkIHNvbWVkYXkuCgogICAgICAgICAgICByZXR1cm4gU3RyaW5nKHZhbHVlKTsKCi8vIElmIHRoZSB0eXBlIGlzICdvYmplY3QnLCB3ZSBtaWdodCBiZSBkZWFsaW5nIHdpdGggYW4gb2JqZWN0IG9yIGFuIGFycmF5IG9yCi8vIG51bGwuCgogICAgICAgIGNhc2UgJ29iamVjdCc6CgovLyBEdWUgdG8gYSBzcGVjaWZpY2F0aW9uIGJsdW5kZXIgaW4gRUNNQVNjcmlwdCwgdHlwZW9mIG51bGwgaXMgJ29iamVjdCcsCi8vIHNvIHdhdGNoIG91dCBmb3IgdGhhdCBjYXNlLgoKICAgICAgICAgICAgaWYgKCF2YWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICdudWxsJzsKICAgICAgICAgICAgfQoKLy8gTWFrZSBhbiBhcnJheSB0byBob2xkIHRoZSBwYXJ0aWFsIHJlc3VsdHMgb2Ygc3RyaW5naWZ5aW5nIHRoaXMgb2JqZWN0IHZhbHVlLgoKICAgICAgICAgICAgZ2FwICs9IGluZGVudDsKICAgICAgICAgICAgcGFydGlhbCA9IFtdOwoKLy8gSXMgdGhlIHZhbHVlIGFuIGFycmF5PwoKICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkodmFsdWUpID09PSAnW29iamVjdCBBcnJheV0nKSB7CgovLyBUaGUgdmFsdWUgaXMgYW4gYXJyYXkuIFN0cmluZ2lmeSBldmVyeSBlbGVtZW50LiBVc2UgbnVsbCBhcyBhIHBsYWNlaG9sZGVyCi8vIGZvciBub24tSlNPTiB2YWx1ZXMuCgogICAgICAgICAgICAgICAgbGVuZ3RoID0gdmFsdWUubGVuZ3RoOwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcGFydGlhbFtpXSA9IHN0cihpLCB2YWx1ZSkgfHwgJ251bGwnOwogICAgICAgICAgICAgICAgfQoKLy8gSm9pbiBhbGwgb2YgdGhlIGVsZW1lbnRzIHRvZ2V0aGVyLCBzZXBhcmF0ZWQgd2l0aCBjb21tYXMsIGFuZCB3cmFwIHRoZW0gaW4KLy8gYnJhY2tldHMuCgogICAgICAgICAgICAgICAgdiA9IHBhcnRpYWwubGVuZ3RoID09PSAwID8gJ1tdJyA6CiAgICAgICAgICAgICAgICAgICAgZ2FwID8gJ1tcbicgKyBnYXAgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGlhbC5qb2luKCcsXG4nICsgZ2FwKSArICdcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbmQgKyAnXScgOgogICAgICAgICAgICAgICAgICAgICAgICAgICdbJyArIHBhcnRpYWwuam9pbignLCcpICsgJ10nOwogICAgICAgICAgICAgICAgZ2FwID0gbWluZDsKICAgICAgICAgICAgICAgIHJldHVybiB2OwogICAgICAgICAgICB9CgovLyBJZiB0aGUgcmVwbGFjZXIgaXMgYW4gYXJyYXksIHVzZSBpdCB0byBzZWxlY3QgdGhlIG1lbWJlcnMgdG8gYmUgc3RyaW5naWZpZWQuCgogICAgICAgICAgICBpZiAocmVwICYmIHR5cGVvZiByZXAgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICBsZW5ndGggPSByZXAubGVuZ3RoOwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgayA9IHJlcFtpXTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGsgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBzdHIoaywgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGlhbC5wdXNoKHF1b3RlKGspICsgKGdhcCA/ICc6ICcgOiAnOicpICsgdik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CgovLyBPdGhlcndpc2UsIGl0ZXJhdGUgdGhyb3VnaCBhbGwgb2YgdGhlIGtleXMgaW4gdGhlIG9iamVjdC4KCiAgICAgICAgICAgICAgICBmb3IgKGsgaW4gdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodmFsdWUsIGspKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBzdHIoaywgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGlhbC5wdXNoKHF1b3RlKGspICsgKGdhcCA/ICc6ICcgOiAnOicpICsgdik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCi8vIEpvaW4gYWxsIG9mIHRoZSBtZW1iZXIgdGV4dHMgdG9nZXRoZXIsIHNlcGFyYXRlZCB3aXRoIGNvbW1hcywKLy8gYW5kIHdyYXAgdGhlbSBpbiBicmFjZXMuCgogICAgICAgICAgICB2ID0gcGFydGlhbC5sZW5ndGggPT09IDAgPyAne30nIDoKICAgICAgICAgICAgICAgIGdhcCA/ICd7XG4nICsgZ2FwICsgcGFydGlhbC5qb2luKCcsXG4nICsgZ2FwKSArICdcbicgKwogICAgICAgICAgICAgICAgICAgICAgICBtaW5kICsgJ30nIDogJ3snICsgcGFydGlhbC5qb2luKCcsJykgKyAnfSc7CiAgICAgICAgICAgIGdhcCA9IG1pbmQ7CiAgICAgICAgICAgIHJldHVybiB2OwogICAgICAgIH0KICAgIH0KCi8vIElmIHRoZSBKU09OIG9iamVjdCBkb2VzIG5vdCB5ZXQgaGF2ZSBhIHN0cmluZ2lmeSBtZXRob2QsIGdpdmUgaXQgb25lLgoKICAgIGlmICh0eXBlb2YgSlNPTi5zdHJpbmdpZnkgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICBKU09OLnN0cmluZ2lmeSA9IGZ1bmN0aW9uICh2YWx1ZSwgcmVwbGFjZXIsIHNwYWNlKSB7CgovLyBUaGUgc3RyaW5naWZ5IG1ldGhvZCB0YWtlcyBhIHZhbHVlIGFuZCBhbiBvcHRpb25hbCByZXBsYWNlciwgYW5kIGFuIG9wdGlvbmFsCi8vIHNwYWNlIHBhcmFtZXRlciwgYW5kIHJldHVybnMgYSBKU09OIHRleHQuIFRoZSByZXBsYWNlciBjYW4gYmUgYSBmdW5jdGlvbgovLyB0aGF0IGNhbiByZXBsYWNlIHZhbHVlcywgb3IgYW4gYXJyYXkgb2Ygc3RyaW5ncyB0aGF0IHdpbGwgc2VsZWN0IHRoZSBrZXlzLgovLyBBIGRlZmF1bHQgcmVwbGFjZXIgbWV0aG9kIGNhbiBiZSBwcm92aWRlZC4gVXNlIG9mIHRoZSBzcGFjZSBwYXJhbWV0ZXIgY2FuCi8vIHByb2R1Y2UgdGV4dCB0aGF0IGlzIG1vcmUgZWFzaWx5IHJlYWRhYmxlLgoKICAgICAgICAgICAgdmFyIGk7CiAgICAgICAgICAgIGdhcCA9ICcnOwogICAgICAgICAgICBpbmRlbnQgPSAnJzsKCi8vIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBudW1iZXIsIG1ha2UgYW4gaW5kZW50IHN0cmluZyBjb250YWluaW5nIHRoYXQKLy8gbWFueSBzcGFjZXMuCgogICAgICAgICAgICBpZiAodHlwZW9mIHNwYWNlID09PSAnbnVtYmVyJykgewogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNwYWNlOyBpICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICBpbmRlbnQgKz0gJyAnOwogICAgICAgICAgICAgICAgfQoKLy8gSWYgdGhlIHNwYWNlIHBhcmFtZXRlciBpcyBhIHN0cmluZywgaXQgd2lsbCBiZSB1c2VkIGFzIHRoZSBpbmRlbnQgc3RyaW5nLgoKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc3BhY2UgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICBpbmRlbnQgPSBzcGFjZTsKICAgICAgICAgICAgfQoKLy8gSWYgdGhlcmUgaXMgYSByZXBsYWNlciwgaXQgbXVzdCBiZSBhIGZ1bmN0aW9uIG9yIGFuIGFycmF5LgovLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yLgoKICAgICAgICAgICAgcmVwID0gcmVwbGFjZXI7CiAgICAgICAgICAgIGlmIChyZXBsYWNlciAmJiB0eXBlb2YgcmVwbGFjZXIgIT09ICdmdW5jdGlvbicgJiYKICAgICAgICAgICAgICAgICAgICAodHlwZW9mIHJlcGxhY2VyICE9PSAnb2JqZWN0JyB8fAogICAgICAgICAgICAgICAgICAgICB0eXBlb2YgcmVwbGFjZXIubGVuZ3RoICE9PSAnbnVtYmVyJykpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSlNPTi5zdHJpbmdpZnknKTsKICAgICAgICAgICAgfQoKLy8gTWFrZSBhIGZha2Ugcm9vdCBvYmplY3QgY29udGFpbmluZyBvdXIgdmFsdWUgdW5kZXIgdGhlIGtleSBvZiAnJy4KLy8gUmV0dXJuIHRoZSByZXN1bHQgb2Ygc3RyaW5naWZ5aW5nIHRoZSB2YWx1ZS4KCiAgICAgICAgICAgIHJldHVybiBzdHIoJycsIHsnJzogdmFsdWV9KTsKICAgICAgICB9OwogICAgfQoKCi8vIElmIHRoZSBKU09OIG9iamVjdCBkb2VzIG5vdCB5ZXQgaGF2ZSBhIHBhcnNlIG1ldGhvZCwgZ2l2ZSBpdCBvbmUuCgogICAgaWYgKHR5cGVvZiBKU09OLnBhcnNlICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgSlNPTi5wYXJzZSA9IGZ1bmN0aW9uICh0ZXh0LCByZXZpdmVyKSB7CgovLyBUaGUgcGFyc2UgbWV0aG9kIHRha2VzIGEgdGV4dCBhbmQgYW4gb3B0aW9uYWwgcmV2aXZlciBmdW5jdGlvbiwgYW5kIHJldHVybnMKLy8gYSBKYXZhU2NyaXB0IHZhbHVlIGlmIHRoZSB0ZXh0IGlzIGEgdmFsaWQgSlNPTiB0ZXh0LgoKICAgICAgICAgICAgdmFyIGo7CgogICAgICAgICAgICBmdW5jdGlvbiB3YWxrKGhvbGRlciwga2V5KSB7CgovLyBUaGUgd2FsayBtZXRob2QgaXMgdXNlZCB0byByZWN1cnNpdmVseSB3YWxrIHRoZSByZXN1bHRpbmcgc3RydWN0dXJlIHNvCi8vIHRoYXQgbW9kaWZpY2F0aW9ucyBjYW4gYmUgbWFkZS4KCiAgICAgICAgICAgICAgICB2YXIgaywgdiwgdmFsdWUgPSBob2xkZXJba2V5XTsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChrIGluIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgaykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSB3YWxrKHZhbHVlLCBrKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVtrXSA9IHY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB2YWx1ZVtrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXZpdmVyLmNhbGwoaG9sZGVyLCBrZXksIHZhbHVlKTsKICAgICAgICAgICAgfQoKCi8vIFBhcnNpbmcgaGFwcGVucyBpbiBmb3VyIHN0YWdlcy4gSW4gdGhlIGZpcnN0IHN0YWdlLCB3ZSByZXBsYWNlIGNlcnRhaW4KLy8gVW5pY29kZSBjaGFyYWN0ZXJzIHdpdGggZXNjYXBlIHNlcXVlbmNlcy4gSmF2YVNjcmlwdCBoYW5kbGVzIG1hbnkgY2hhcmFjdGVycwovLyBpbmNvcnJlY3RseSwgZWl0aGVyIHNpbGVudGx5IGRlbGV0aW5nIHRoZW0sIG9yIHRyZWF0aW5nIHRoZW0gYXMgbGluZSBlbmRpbmdzLgoKICAgICAgICAgICAgdGV4dCA9IFN0cmluZyh0ZXh0KTsKICAgICAgICAgICAgY3gubGFzdEluZGV4ID0gMDsKICAgICAgICAgICAgaWYgKGN4LnRlc3QodGV4dCkpIHsKICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoY3gsIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdcXHUnICsKICAgICAgICAgICAgICAgICAgICAgICAgKCcwMDAwJyArIGEuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgovLyBJbiB0aGUgc2Vjb25kIHN0YWdlLCB3ZSBydW4gdGhlIHRleHQgYWdhaW5zdCByZWd1bGFyIGV4cHJlc3Npb25zIHRoYXQgbG9vawovLyBmb3Igbm9uLUpTT04gcGF0dGVybnMuIFdlIGFyZSBlc3BlY2lhbGx5IGNvbmNlcm5lZCB3aXRoICcoKScgYW5kICduZXcnCi8vIGJlY2F1c2UgdGhleSBjYW4gY2F1c2UgaW52b2NhdGlvbiwgYW5kICc9JyBiZWNhdXNlIGl0IGNhbiBjYXVzZSBtdXRhdGlvbi4KLy8gQnV0IGp1c3QgdG8gYmUgc2FmZSwgd2Ugd2FudCB0byByZWplY3QgYWxsIHVuZXhwZWN0ZWQgZm9ybXMuCgovLyBXZSBzcGxpdCB0aGUgc2Vjb25kIHN0YWdlIGludG8gNCByZWdleHAgb3BlcmF0aW9ucyBpbiBvcmRlciB0byB3b3JrIGFyb3VuZAovLyBjcmlwcGxpbmcgaW5lZmZpY2llbmNpZXMgaW4gSUUncyBhbmQgU2FmYXJpJ3MgcmVnZXhwIGVuZ2luZXMuIEZpcnN0IHdlCi8vIHJlcGxhY2UgdGhlIEpTT04gYmFja3NsYXNoIHBhaXJzIHdpdGggJ0AnIChhIG5vbi1KU09OIGNoYXJhY3RlcikuIFNlY29uZCwgd2UKLy8gcmVwbGFjZSBhbGwgc2ltcGxlIHZhbHVlIHRva2VucyB3aXRoICddJyBjaGFyYWN0ZXJzLiBUaGlyZCwgd2UgZGVsZXRlIGFsbAovLyBvcGVuIGJyYWNrZXRzIHRoYXQgZm9sbG93IGEgY29sb24gb3IgY29tbWEgb3IgdGhhdCBiZWdpbiB0aGUgdGV4dC4gRmluYWxseSwKLy8gd2UgbG9vayB0byBzZWUgdGhhdCB0aGUgcmVtYWluaW5nIGNoYXJhY3RlcnMgYXJlIG9ubHkgd2hpdGVzcGFjZSBvciAnXScgb3IKLy8gJywnIG9yICc6JyBvciAneycgb3IgJ30nLiBJZiB0aGF0IGlzIHNvLCB0aGVuIHRoZSB0ZXh0IGlzIHNhZmUgZm9yIGV2YWwuCgogICAgICAgICAgICBpZiAoL15bXF0sOnt9XHNdKiQvLgp0ZXN0KHRleHQucmVwbGFjZSgvXFwoPzpbIlxcXC9iZm5ydF18dVswLTlhLWZBLUZdezR9KS9nLCAnQCcpLgpyZXBsYWNlKC8iW14iXFxcblxyXSoifHRydWV8ZmFsc2V8bnVsbHwtP1xkKyg/OlwuXGQqKT8oPzpbZUVdWytcLV0/XGQrKT8vZywgJ10nKS4KcmVwbGFjZSgvKD86Xnw6fCwpKD86XHMqXFspKy9nLCAnJykpKSB7CgovLyBJbiB0aGUgdGhpcmQgc3RhZ2Ugd2UgdXNlIHRoZSBldmFsIGZ1bmN0aW9uIHRvIGNvbXBpbGUgdGhlIHRleHQgaW50byBhCi8vIEphdmFTY3JpcHQgc3RydWN0dXJlLiBUaGUgJ3snIG9wZXJhdG9yIGlzIHN1YmplY3QgdG8gYSBzeW50YWN0aWMgYW1iaWd1aXR5Ci8vIGluIEphdmFTY3JpcHQ6IGl0IGNhbiBiZWdpbiBhIGJsb2NrIG9yIGFuIG9iamVjdCBsaXRlcmFsLiBXZSB3cmFwIHRoZSB0ZXh0Ci8vIGluIHBhcmVucyB0byBlbGltaW5hdGUgdGhlIGFtYmlndWl0eS4KCiAgICAgICAgICAgICAgICBqID0gZXZhbCgnKCcgKyB0ZXh0ICsgJyknKTsKCi8vIEluIHRoZSBvcHRpb25hbCBmb3VydGggc3RhZ2UsIHdlIHJlY3Vyc2l2ZWx5IHdhbGsgdGhlIG5ldyBzdHJ1Y3R1cmUsIHBhc3NpbmcKLy8gZWFjaCBuYW1lL3ZhbHVlIHBhaXIgdG8gYSByZXZpdmVyIGZ1bmN0aW9uIGZvciBwb3NzaWJsZSB0cmFuc2Zvcm1hdGlvbi4KCiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHJldml2ZXIgPT09ICdmdW5jdGlvbicgPwogICAgICAgICAgICAgICAgICAgIHdhbGsoeycnOiBqfSwgJycpIDogajsKICAgICAgICAgICAgfQoKLy8gSWYgdGhlIHRleHQgaXMgbm90IEpTT04gcGFyc2VhYmxlLCB0aGVuIGEgU3ludGF4RXJyb3IgaXMgdGhyb3duLgoKICAgICAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCdKU09OLnBhcnNlJyk7CiAgICAgICAgfTsKICAgIH0KfSgpKTsK"
        },
        "xdm/kanso.js": {
            "content_type": "application/javascript",
            "data": "LypnbG9iYWwgd2luZG93OiBmYWxzZSwgJDogZmFsc2UsIHBhZ2VUcmFja2VyOiBmYWxzZSwga2Fuc286IHRydWUgKi8KCi8qKgogKiBib290c3RyYXBwZWQga2Fuc28gY29kZSwKICogcmVxdWlyZWQgYmVmb3JlIHRoZSBjb21tb25qcyBlbnZpcm9ubWVudCBpcyBhdmFpbGFibGUuCiAqLwoKKGZ1bmN0aW9uIChleHBvcnRzKSB7CgogICAgZXhwb3J0cy5tb2R1bGVDYWNoZSA9IHt9OwoKICAgIGV4cG9ydHMubm9ybWFsaXplUGF0aCA9IGZ1bmN0aW9uIChwKSB7CiAgICAgICAgdmFyIHBhdGggPSBbXTsKICAgICAgICB2YXIgcGFydHMgPSBwLnNwbGl0KCcvJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICBpZiAocGFydHNbaV0gPT09ICcuLicpIHsKICAgICAgICAgICAgICAgIHBhdGgucG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAocGFydHNbaV0gIT09ICcuJykgewogICAgICAgICAgICAgICAgcGF0aC5wdXNoKHBhcnRzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcGF0aC5qb2luKCcvJyk7CiAgICB9OwoKICAgIGV4cG9ydHMuZGlybmFtZSA9IGZ1bmN0aW9uIChwKSB7CiAgICAgICAgaWYgKHAgPT09ICcvJykgewogICAgICAgICAgICByZXR1cm4gcDsKICAgICAgICB9CiAgICAgICAgdmFyIHBhcnRzID0gcC5zcGxpdCgnLycpOwogICAgICAgIHBhcnRzLnBvcCgpOwogICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDEgJiYgcGFydHNbMF0gPT09ICcnKSB7CiAgICAgICAgICAgIHJldHVybiAnLyc7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYXJ0cy5qb2luKCcvJyk7CiAgICB9OwoKICAgIGV4cG9ydHMuY3JlYXRlUmVxdWlyZSA9IGZ1bmN0aW9uIChjdXJyZW50KSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHsKICAgICAgICAgICAgdmFyIHBhdGg7CiAgICAgICAgICAgIGlmICh0YXJnZXQuY2hhckF0KDApID09PSAnLicpIHsKICAgICAgICAgICAgICAgIHZhciBkaXIgPSBleHBvcnRzLmRpcm5hbWUoY3VycmVudCk7CiAgICAgICAgICAgICAgICBwYXRoID0gZXhwb3J0cy5ub3JtYWxpemVQYXRoKGRpciArICcvJyArIHRhcmdldCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBwYXRoID0gZXhwb3J0cy5ub3JtYWxpemVQYXRoKHRhcmdldCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG0gPSBrYW5zby5tb2R1bGVDYWNoZVtwYXRoXTsKICAgICAgICAgICAgaWYgKCFtKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHN1Y2ggbW9kdWxlOiAnICsgcGF0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFtLmxvYWRlZCkgewogICAgICAgICAgICAgICAgbS5leHBvcnRzID0ge307CiAgICAgICAgICAgICAgICAvLyBzZXQgdGhpcyB0byB0cnVlICpiZWZvcmUqIGNhbGxpbmcgbS5sb2FkIHNvIGNpcmN1bGFyCiAgICAgICAgICAgICAgICAvLyByZXF1aXJlcyBkb24ndCBibG93IHRoZSBjYWxsIHN0YWNrCiAgICAgICAgICAgICAgICBtLmxvYWRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBtLmxvYWQobSwgbS5leHBvcnRzLCBleHBvcnRzLmNyZWF0ZVJlcXVpcmUocGF0aCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtLmV4cG9ydHM7CiAgICAgICAgfTsKICAgIH07CgogICAgaWYgKHR5cGVvZiByZXF1aXJlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIC8vIG1ha2UgcmVxdWlyZSBhdmFpbGFibGUgZ2xvYmFsbHksIHVubGVzcyBhbHJlYWR5IGluIGEgY29tbW9uanMKICAgICAgICAvLyBlbnZpcm9ubWVudAogICAgICAgIHRoaXMucmVxdWlyZSA9IGV4cG9ydHMuY3JlYXRlUmVxdWlyZSgnJyk7CiAgICB9CgogICAgZXhwb3J0cy5pbml0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBrYW5zbyA9IHJlcXVpcmUoJ2thbnNvL2NvcmUnKTsKICAgICAgICBmb3IgKHZhciBrIGluIGthbnNvKSB7CiAgICAgICAgICAgIGlmIChrYW5zby5oYXNPd25Qcm9wZXJ0eShrKSkgewogICAgICAgICAgICAgICAgZXhwb3J0c1trXSA9IGthbnNvW2tdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGthbnNvLmluaXQoKTsKICAgIH07Cgp9KCh0eXBlb2YgZXhwb3J0cyA9PT0gJ3VuZGVmaW5lZCcpID8gdGhpcy5rYW5zbyA9IHt9OiBtb2R1bGUuZXhwb3J0cykpOwoKCi8qKgogKiBsaWIvYXBwLmpzIGFkZHMgdGhlIHdyYXBwZWQgYW5kIGNvbmNhdGVuYXRlZCBsaXN0IG9mIGNvbW1vbmpzIG1vZHVsZXMgYWZ0ZXIKICogdGhpcyBjb2RlLgogKi8KCgo="
        },
        "xdm/make-xdm-all.sh": {
            "content_type": "application/x-sh",
            "data": "IyEgL2Jpbi9iYXNoCgpjYXQganF1ZXJ5Lm1pbi5qcyA+eGRtLWFsbC5qcwplY2hvICcnID4+eGRtLWFsbC5qcwpjYXQgZGIuZXgta2Fuc28uanMgfCBqc21pbiAgPj54ZG0tYWxsLmpzCmVjaG8gJycgPj54ZG0tYWxsLmpzCmNhdCBzZXNzaW9uLmV4LWthbnNvLmpzIHwganNtaW4gPj54ZG0tYWxsLmpzCmVjaG8gJycgPj54ZG0tYWxsLmpzCmNhdCBlYXN5WERNLm1pbi5qcyA+PnhkbS1hbGwuanMKZWNobyAnJyA+PnhkbS1hbGwuanMKdWdsaWZ5anMgcHJvdmlkZXIuanMgPj54ZG0tYWxsLmpzCg=="
        },
        "xdm/provider.debug.html": {
            "content_type": "text/html",
            "data": "PCFkb2N0eXBlIGh0bWw+CjxodG1sPgogIDxoZWFkPgogICAgPHRpdGxlPm5yYW1hIHhkbS1jb3VjaGRiIHByb3ZpZGVyPC90aXRsZT4KICAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9ImpxdWVyeS5taW4uanMiPjwvc2NyaXB0PgogICAgPCEtLSBmb3IgY291Y2hkYiAtLT4KICAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiA+CiAgICAgICAvLyBzZXR0aW5ncyByZXF1aXJlZCBmb3IgZGIuZXgta2Fuc28uanMgJiBzZXNzaW9uLmV4LWthbnNvLmpzCiAgICAgICAvLyBOQiBjaGFuZ2UgdGhlc2UKICAgICAgIHNldHRpbmdzID0gewogICAgICAgICAgIG5hbWUgOiAnbnJhbWEnLCAgICAgICAgIC8vc2hvdWxkIGJlIHNhbWUgYXMgJ25hbWUnIGluIGthbnNvLmpzb24gaW4gdGhlIHJvb3Qgb2YgeW91ciBwcm9qZWN0CiAgICAgICAgICAgYmFzZVVSTCA6ICcvbnJhbWEvX2Rlc2lnbi9ucmFtYS9fcmV3cml0ZScgICAgLy91c2VkIHRvIGJ1aWxkIHVybCBmb3IgcmVxdWVzdHMKICAgICAgIH0KICAgIDwvc2NyaXB0PgogICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iZGIuZXgta2Fuc28uanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0ic2Vzc2lvbi5leC1rYW5zby5qcyI+PC9zY3JpcHQ+CiAgICA8IS0tIGZvciB4ZG0gLS0+CiAgICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgc3JjPSJlYXN5WERNLm1pbi5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+CiAgICAgIGVhc3lYRE0uRG9tSGVscGVyLnJlcXVpcmVzSlNPTigianNvbjIuanMiKTsKICAgIDwvc2NyaXB0PgogICAgCiAgICA8IS0tIGV4cG9zZXMgZnVuY3Rpb25zIHRocm91Z2ggcnBjIC0tPgogICAgPHNjcmlwdCBzcmM9InByb3ZpZGVyLmpzIj48L3NjcmlwdD4KCiAgPC9oZWFkPgogIDxib2R5PgogICAgPHNjcmlwdD4KICAgICAgLy90byBoZWxwIGNoZWNraW5nIGl0cyB3b3JraW5nIHdoZW4gbG9hZGVkIGluIHRoZSBicm93c2VyCiAgICAgIGNiPWZ1bmN0aW9uKCl7IGNvbnNvbGUubG9nKCdzdWNjZXNzJyk7IGZvcihpIGluIGFyZ3VtZW50cyl7IGNvbnNvbGUubG9nKGkrJzonK2FyZ3VtZW50c1tpXSk7IHdpbmRvd1snYScraV09YXJndW1lbnRzW2ldOyB9IH07CiAgICAgIGNiZT1mdW5jdGlvbigpeyBjb25zb2xlLmxvZygnZXJyb3InKTsgZm9yKGkgaW4gYXJndW1lbnRzKXsgY29uc29sZS5sb2coaSsnOicrYXJndW1lbnRzW2ldKTsgd2luZG93WydhJytpXT1hcmd1bWVudHNbaV07IH0gIH07CiAgICAgIG89e2NyZWF0ZWQ6bmV3IERhdGUoKS5nZXRUaW1lKCksZmllbGQ6J3ZhbHVlIGZvciBtc3RldmUnLGFudW06TWF0aC5yYW5kb20oMSkqMTB9O28uYW51bQogICAgPC9zY3JpcHQ+CiAgPC9ib2R5Pgo8L2h0bWw+CgoK"
        },
        "xdm/provider.html": {
            "content_type": "text/html",
            "data": "PCFkb2N0eXBlIGh0bWw+CjxodG1sPgogIDxoZWFkPgogICAgPHRpdGxlPk5vdGUtby1yYW1hIHhkbS1jb3VjaGRiIHByb3ZpZGVyPC90aXRsZT4KICAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiA+CiAgICAgICAvLyBzZXR0aW5ncyByZXF1aXJlZCBmb3IgZGIuZXgta2Fuc28uanMgJiBzZXNzaW9uLmV4LWthbnNvLmpzCiAgICAgICBzZXR0aW5ncyA9IHsKICAgICAgICAgICBuYW1lIDogJ25yYW1hJywgICAgICAgICAKICAgICAgICAgICBiYXNlVVJMIDogJy9ucmFtYS9fZGVzaWduL25yYW1hL19yZXdyaXRlJyAgICAKICAgICAgIH0KICAgIDwvc2NyaXB0PgogICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0ieGRtLWFsbC5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+CiAgICAgIGVhc3lYRE0uRG9tSGVscGVyLnJlcXVpcmVzSlNPTigianNvbjIuanMiKTsKICAgIDwvc2NyaXB0PgogIDwvaGVhZD4KICA8Ym9keT4KICA8L2JvZHk+CjwvaHRtbD4KCg=="
        },
        "xdm/provider.js": {
            "content_type": "application/javascript",
            "data": "LyoqCiAqIEhvdyB0byBtYWtlIGNvdWNoZGIgd29yayB3aXRoIGVhc3lYRE0ncyBycGMuCiAqIAogKiB3ZSdsbCBoYXZlIHRvIGRvIHNvbWUgd3JhcHBpbmcgdG8gbWFrZSBlYXN5WERNIHBsYXkgbmljZWx5OgogKiAKICogIDEuIHdoZW4gZWFzeVhETSBleGVjdXRlcyB0aGUgcmVtb3RlIGNhbGxzIGl0IGNhbGxzIHRoZSBtZXRob2RzIGRlZmluZWQgaGVyZQogKiAgd2l0aCBUV08gY2FsbGJhY2tzLCBzdWNjZXNzIGFuZCBlcnJvci4gIFRoaXMgbWVzc2VzIHVwIGhvdyBkYi5ucmFtYS5qcyAmCiAqICBzZXNzaW9uLm5yYW1hLmpzIGhhbmRsZSB0aGUgb3B0aW9uYWwgcGFyYW1ldGVycyAod2hpY2ggaXMgYSB3ZWFrbmVzcykuIFNlZQogKiAgbGluZSAyNzU4IGluIGVhc3lYRE0uZGVidWcuanMKICoKICogIDIuIGVhc3lYRE0gd3JhcHMgY2FsbGJhY2tzIGluIHN1Y2ggYSB3YXkgdGhhdCBvbmx5IHRoZSBmaXJzdCBwYXJhbWV0ZXIKICogIGlzIHBhc3NlZCB1cCB0byB0aGUgb3JpZ2luYWwgY2FsbGJhY2sgKGxpbmUgMjcyOCBpbiBlYXN5WERNLmRlYnVnLmpzKS4KICoKICogIFRvIGFyb3VuZCB0aGVzZSBwb2ludHMsIHdlIHdyYXAgdGhlIG1ldGhvZHMgc28gYXMgdG8gKGkpIGRlbGV0ZSB0aGUgZmluYWwKICogIGFyZ3VtZW50IHdpdGggd2hpY2ggdGhleSBhcmUgY2FsbGVkLCBhbmQgKGlpKSBpbnZva2UgdGhlIGNhbGxiYWNrIHdpdGgKICogIHBhcmFtZXRlcnMgYXMgYW4gYXJyYXkuICBUaGlzIChpaSkgcmVxdWlyZXMgY29tcGxlbWVudGFyeSB3cmFwcGluZyBhdCB0aGUKICogIG90aGVyIGVuZCAodGhlIGNvbnN1bWVyKS4KICovCgovKgogICAgVGhpcyBmaWxlIGlzIHBhcnQgb2YgTm90ZS1vLXJhbWEuCgogICAgTm90ZS1vLXJhbWEgaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQogICAgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKICAgIE5vdGUtby1yYW1hIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogICAgYWxvbmcgd2l0aCBOb3RlLW8tcmFtYS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKi8KCgp2YXIgX2FycmF5X3dyYXAgPSBmdW5jdGlvbihmbikgewogICAgcmV0dXJuIGZ1bmN0aW9uKCl7CiAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgICAgIGZuKGFyZ3MpOwogICAgfQp9CnZhciBfd3JhcCA9IGZ1bmN0aW9uKGZuKSB7CiAgICByZXR1cm4gewogICAgICAgIG1ldGhvZCA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHZhciB3cmFwcGVkX2FyZ3VtZW50cyA9IFtdOwogICAgICAgICAgICAkLmVhY2goYXJndW1lbnRzLCBmdW5jdGlvbihpZHgsIGFyZyl7CiAgICAgICAgICAgICAgICBpZiggdHlwZW9mIGFyZyA9PT0gImZ1bmN0aW9uIiApIHsKICAgICAgICAgICAgICAgICAgICB3cmFwcGVkX2FyZ3VtZW50cy5wdXNoKCBfYXJyYXlfd3JhcChhcmcpICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHdyYXBwZWRfYXJndW1lbnRzLnB1c2goYXJnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vIHJlbW92ZSB0aGUgbGFzdCBhcmd1bWVudCAtLSBpdCdzIGEgY2FsbGJhY2sgKGV2aWx5IGluc2VydGVkIGJ5IGVhc3lYRE0gdG8gY29uZnVzZSB1cykKICAgICAgICAgICAgdmFyIGxlbiA9IHdyYXBwZWRfYXJndW1lbnRzLmxlbmd0aDsKICAgICAgICAgICAgd3JhcHBlZF9hcmd1bWVudHMuc3BsaWNlKGxlbi0xLDEpOwogICAgICAgICAgICBmbi5hcHBseSh0aGlzLHdyYXBwZWRfYXJndW1lbnRzKTsKICAgICAgICB9CiAgICB9Cn0KdmFyIGxvY2FsID0gewogICAgdGVzdCA6IHsKICAgICAgICBtZXRob2QgOiBmdW5jdGlvbihvYmplY3QsIG9uX3N1Y2Nlc3MsIG9uX2Vycm9yKSB7CiAgICAgICAgICAgIHJldHVybiBvbl9zdWNjZXNzKG9iamVjdCk7CiAgICAgICAgfQogICAgfSwKICAgIGRiX3NhdmVEb2MgOiBfd3JhcCggZGIuc2F2ZURvYyApLAogICAgZGJfcmVtb3ZlRG9jIDogX3dyYXAoIGRiLnJlbW92ZURvYyApLAogICAgZGJfZ2V0VmlldyA6IF93cmFwKCBkYi5nZXRWaWV3ICksCiAgICBkYl9kb1VwZGF0ZSA6IF93cmFwKCBkYi5kb1VwZGF0ZSApLAogICAgc2Vzc2lvbl9sb2dpbjogX3dyYXAoIHNlc3Npb24ubG9naW4gKSwKICAgIHNlc3Npb25fbG9nb3V0IDogX3dyYXAoIHNlc3Npb24ubG9nb3V0ICksCiAgICBzZXNzaW9uX2luZm8gOiBfd3JhcCggc2Vzc2lvbi5pbmZvICkKfTsKLyoKICAvLyBzaG9ydGN1dCBmb3IgdGVzdGluZwokLmVhY2goZGIsIGZ1bmN0aW9uKGtleSwgbWV0aG9kKXsKICBpZiggdHlwZW9mKG1ldGhvZCk9PT0iZnVuY3Rpb24iKSB7CiAgICAgIGNvbnNvbGUubG9nKCdkYl8nK2tleSk7CiAgICAgIGV4cG9zZVsnZGJfJytrZXldID0gbWV0aG9kX2FycmF5X3dyYXAobWV0aG9kKTsKICB9Cn0pOwokLmVhY2goc2Vzc2lvbiwgZnVuY3Rpb24oa2V5LCBtZXRob2QpewogIGlmKCB0eXBlb2YobWV0aG9kKT09PSJmdW5jdGlvbiIpIHsKICAgICAgY29uc29sZS5sb2coJ3Nlc3Npb25fJytrZXkpOwogICAgICBleHBvc2VbJ3Nlc3Npb25fJytrZXldID0gbWV0aG9kX2FycmF5X3dyYXAobWV0aG9kKTsKICB9Cn0pOwoqLwovL3N0dWJzIGZvciByZW1vdGUgbWV0aG9kcwp2YXIgcmVtb3RlID0gewogICAgZ2V0X3ZlcnNpb24gOiB7fSwKICAgIG1zZyA6IHt9LAogICAgbW9kYWwgOiB7fQp9Owp2YXIgb25SZWFkeSA9IGZ1bmN0aW9uKCl7CiAgICAvL3Rlc3QxCiAgICAvKgogICAgX3JwYy5nZXRfdmVyc2lvbihmdW5jdGlvbih2ZXJzaW9uKXsKICAgICAgICBfcnBjLm1zZygnaGVsbG8gZnJvbSByZW1vdGUgdG8gbnJhbWEgY2xpZW50IHZlcnNpb24gJyt2ZXJzaW9uKTsKICAgIH0pOwogICAgKi8KICAgIAogICAgLy90ZXN0MgogICAgLyoKICAgIF9ycGMuZ2V0X3ZlcnNpb24oIGZ1bmN0aW9uKHZlcnNpb24pewogICAgICAgIF9ycGMubW9kYWwobWFrZV9tb2RhbF9zdHIodmVyc2lvbikpOwogICAgfSk7CiAgICAqLwp9Owp2YXIgX3JwYyA9IG5ldyBlYXN5WERNLlJwYyh7IG9uUmVhZHk6b25SZWFkeSB9LCB7bG9jYWw6bG9jYWwsIHJlbW90ZTpyZW1vdGV9ICk7CgovKioKICogVGhpcyBpcyBob3cgdG8gZG8gdGhlIHNhbWUgZm9yIGpxdWVyeS5jb3VjaC5kYiBpbnN0ZWFkCiAqIE5vdGUgdGhhdCBjYWxsYmFja3MgY2Fubm90IGJlIHdyYXBwZWQgaW4gb2JqZWN0cyB3aGVuIHBhc3NlZCBhcyBwYXJhbWV0ZXJzCiAqIAp2YXIgJGRiID0gJC5jb3VjaC5kYignbnJhbWEnKTsgIC8vIDwtLSB5b3VyIGRiIG5hbWUgZ29lcyBoZXJlCnZhciBleHBvc2UgPSB7CiAgICB0ZXN0IDogewogICAgICAgIG1ldGhvZCA6IGZ1bmN0aW9uKG9uX3N1Y2Nlc3MsIG9uX2Vycm9yLCBvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIG9uX3N1Y2Nlc3MoJ3RoYXQgd29ya2VkIScsIG9iamVjdCk7CiAgICAgICAgfQogICAgfSwKICAgICRsb2dpbiA6IHsKICAgICAgICBtZXRob2QgOiBmdW5jdGlvbihuYW1lLCBwYXNzd29yZCwgc3VjY2VzcywgZXJyb3IpIHsKICAgICAgICAgICAgJC5jb3VjaC5sb2dpbih7CiAgICAgICAgICAgICAgICBuYW1lOm5hbWUsCiAgICAgICAgICAgICAgICBwYXNzd29yZDpwYXNzd29yZCwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6c3VjY2VzcywKICAgICAgICAgICAgICAgIGVycm9yOmVycm9yCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0sCiAgICAkbG9nb3V0IDogewogICAgICAgIG1ldGhvZCA6IGZ1bmN0aW9uKHN1Y2Nlc3MsIGVycm9yKSB7CiAgICAgICAgICAgICQuY291Y2gubG9nb3V0KHtzdWNjZXNzOnN1Y2Nlc3MsIGVycm9yOmVycm9yfSk7CiAgICAgICAgfQogICAgfSwKICAgICRzZXNzaW9uIDogewogICAgICAgIG1ldGhvZCA6IGZ1bmN0aW9uKHN1Y2Nlc3MsZXJyb3IpIHsKICAgICAgICAgICAgJC5jb3VjaC5zZXNzaW9uKHtzdWNjZXNzOnN1Y2Nlc3MsIGVycm9yOmVycm9yfSk7CiAgICAgICAgfQogICAgfSwKICAgICRzYXZlRG9jIDogewogICAgICAgIG1ldGhvZCA6IGZ1bmN0aW9uKGRvYywgc3VjY2VzcywgZXJyb3IpIHsKICAgICAgICAgICAgJGRiLnNhdmVEb2MoZG9jLCB7c3VjY2VzczpzdWNjZXNzLCBlcnJvcjplcnJvcn0pOwogICAgICAgIH0KICAgIH0KICAgIC8vIGV0Ywp9OwogKi8KCgovKioKICogdGhpcyBpcyBmb3IgdGVzdGluZyBtb2RhbCAtLS0gY2FuIGJlIGRpcGxheWVkIG9uIHRoZSBjbGllbnQKICoKdmFyIG1ha2VfbW9kYWxfc3RyID0gZnVuY3Rpb24odmVyc2lvbikgewogICAgdmFyICRtb2RhbCA9ICQoJzxkaXY+PGgyPlVwZGF0ZSBOZWVkZWQ8L2gyPjwvZGl2PicpOwogICAgJG1vZGFsLmFwcGVuZCgnPGZvcm0gaWQ9ImluZm9fZm9ybSI+JyArCiAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJpbmZvIj4nICsKICAgICAgICAgICAgICAgICc8cD5QbGVhc2UgdXBkYXRlIHlvdXIgYm9va21hcmtsZXQsIHRoaXMgdmVyc2lvbiAoJyt2ZXJzaW9uKycpIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQ8L3A+JyArCiAgICAgICAgICAgICAgICAnPHA+PGEgaHJlZj0iaHR0cDovL3d3dy5ub3RlLW8tcmFtYS5jb20iPmdldCB0aGUgbmV3IHZlcnNpb248L2E+PC9wPicgKwogICAgICAgICAgICAnPC9kaXY+JyArCiAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJhY3Rpb25zIj4nICsKICAgICAgICAgICAgICAgICc8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0iaWRfb2siIHZhbHVlPSJPSyIgLz4nICsKICAgICAgICAgICAgJzwvZGl2PicgKwogICAgICAgICc8L2Zvcm0+Jyk7CiAgICBtb2RhbF9zdHI9JG1vZGFsLmh0bWwoKTsKICAgIHJldHVybiBtb2RhbF9zdHI7Cn0KKi8KCmZuID0gZnVuY3Rpb24oKXsKICAgICQuZWFjaChhcmd1bWVudHMsIGZ1bmN0aW9uKGlkeCwgYXJnKXsKICAgICAgICBjb25zb2xlLmxvZyhhcmcpOwogICAgfSk7Cn0="
        },
        "xdm/provider.min.js": {
            "content_type": "application/javascript",
            "data": "LyoqCiAqIEhvdyB0byBtYWtlIGNvdWNoZGIgd29yayB3aXRoIGVhc3lYRE0ncyBycGMuCiAqIAogKiB3ZSdsbCBoYXZlIHRvIGRvIHNvbWUgd3JhcHBpbmcgdG8gbWFrZSBlYXN5WERNIHBsYXkgbmljZWx5OgogKiAKICogIDEuIHdoZW4gZWFzeVhETSBleGVjdXRlcyB0aGUgcmVtb3RlIGNhbGxzIGl0IGNhbGxzIHRoZSBtZXRob2RzIGRlZmluZWQgaGVyZQogKiAgd2l0aCBUV08gY2FsbGJhY2tzLCBzdWNjZXNzIGFuZCBlcnJvci4gIFRoaXMgbWVzc2VzIHVwIGhvdyBkYi5ucmFtYS5qcyAmCiAqICBzZXNzaW9uLm5yYW1hLmpzIGhhbmRsZSB0aGUgb3B0aW9uYWwgcGFyYW1ldGVycyAod2hpY2ggaXMgYSB3ZWFrbmVzcykuIFNlZQogKiAgbGluZSAyNzU4IGluIGVhc3lYRE0uZGVidWcuanMKICoKICogIDIuIGVhc3lYRE0gd3JhcHMgY2FsbGJhY2tzIGluIHN1Y2ggYSB3YXkgdGhhdCBvbmx5IHRoZSBmaXJzdCBwYXJhbWV0ZXIKICogIGlzIHBhc3NlZCB1cCB0byB0aGUgb3JpZ2luYWwgY2FsbGJhY2sgKGxpbmUgMjcyOCBpbiBlYXN5WERNLmRlYnVnLmpzKS4KICoKICogIFRvIGFyb3VuZCB0aGVzZSBwb2ludHMsIHdlIHdyYXAgdGhlIG1ldGhvZHMgc28gYXMgdG8gKGkpIGRlbGV0ZSB0aGUgZmluYWwKICogIGFyZ3VtZW50IHdpdGggd2hpY2ggdGhleSBhcmUgY2FsbGVkLCBhbmQgKGlpKSBpbnZva2UgdGhlIGNhbGxiYWNrIHdpdGgKICogIHBhcmFtZXRlcnMgYXMgYW4gYXJyYXkuICBUaGlzIChpaSkgcmVxdWlyZXMgY29tcGxlbWVudGFyeSB3cmFwcGluZyBhdCB0aGUKICogIG90aGVyIGVuZCAodGhlIGNvbnN1bWVyKS4KICovdmFyIF9hcnJheV93cmFwPWZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbigpe3ZhciBiPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7YShiKX19LF93cmFwPWZ1bmN0aW9uKGEpe3JldHVybnttZXRob2Q6ZnVuY3Rpb24oKXt2YXIgYj1bXTskLmVhY2goYXJndW1lbnRzLGZ1bmN0aW9uKGEsYyl7dHlwZW9mIGM9PSJmdW5jdGlvbiI/Yi5wdXNoKF9hcnJheV93cmFwKGMpKTpiLnB1c2goYyl9KTt2YXIgYz1iLmxlbmd0aDtiLnNwbGljZShjLTEsMSksYS5hcHBseSh0aGlzLGIpfX19LGxvY2FsPXt0ZXN0OnttZXRob2Q6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBiKGEpfX0sZGJfc2F2ZURvYzpfd3JhcChkYi5zYXZlRG9jKSxkYl9yZW1vdmVEb2M6X3dyYXAoZGIucmVtb3ZlRG9jKSxkYl9nZXRWaWV3Ol93cmFwKGRiLmdldFZpZXcpLGRiX2RvVXBkYXRlOl93cmFwKGRiLmRvVXBkYXRlKSxzZXNzaW9uX2xvZ2luOl93cmFwKHNlc3Npb24ubG9naW4pLHNlc3Npb25fbG9nb3V0Ol93cmFwKHNlc3Npb24ubG9nb3V0KSxzZXNzaW9uX2luZm86X3dyYXAoc2Vzc2lvbi5pbmZvKX0scmVtb3RlPXtnZXRfdmVyc2lvbjp7fSxtc2c6e30sbW9kYWw6e319LG9uUmVhZHk9ZnVuY3Rpb24oKXt9LF9ycGM9bmV3IGVhc3lYRE0uUnBjKHtvblJlYWR5Om9uUmVhZHl9LHtsb2NhbDpsb2NhbCxyZW1vdGU6cmVtb3RlfSk7Zm49ZnVuY3Rpb24oKXskLmVhY2goYXJndW1lbnRzLGZ1bmN0aW9uKGEsYil7Y29uc29sZS5sb2coYil9KX0="
        },
        "xdm/session.ex-kanso.js": {
            "content_type": "application/javascript",
            "data": "LyoqCiAqIG1vZGlmaWVkIHRvIHVzZSBpbiBicm93c2VyIGluZGVwZW5kZW50bHkgb2YgdGhlIHdob2xlIGthbnNvIGFwcAogKiBTb21lIG1ldGhvZHMgaGF2ZSBiZWVuIHJlbW92ZWQgKGUuZy4gc2lnbnVwLCB3aGljaCB3b3VsZCBhZGQgZGVwZW5kZW5jaWVzKS4KICoKICogY29udmVydGVkIGZyb20gQ29tbW9uSlMgdG8gb3JkaW5hcnksIGVtYmVkZGFibGUgSlM6CiAqICBleHBvcnRzIGJlY29tZXMgc2Vzc2lvbgogKgogKiBkZXBlbmRzOiBkYi5ucmFtYS5qcwogKgogKiBNb2RpZnlpbmcgaW5kaXZpZHVhbCBmdW5jdGlvbnMgaGFzIGJlZW4gYXZvaWRlZDogdGhleSBhcmUgZWl0aGVyIGRlbGV0ZWQgb3Igc3R1YmJlZC4KICogCiAqIEZ1bmN0aW9ucyByZWxhdGVkIHRvIHRoZSBtYW5hZ2VtZW50IG9mIHVzZXIgc2Vzc2lvbnMgYW5kIGFjY291bnQgaW5mb3JtYXRpb24uCiAqCiAqIEBtb2R1bGUKICovCgovLyBUaGlzIGlzIG5vIGxvbmdlciBDb21tb25KUwpzZXNzaW9uID0ge307CihmdW5jdGlvbihleHBvcnRzKXsKCiAgICAvKioKICAgICAqIGFkZGVkIGZvciBleC1rYW5zbyA6IGZha2UgdGhlIHBhcnRzIG9mIGthbnNvL3V0aWxzIHRoYXQgd2UgbmVlZAogICAgICovIAogICAgdXRpbHMgPSB7CiAgICAgICAgaXNCcm93c2VyIDogZnVuY3Rpb24oKXsgcmV0dXJuIHRydWU7IH0sCiAgICAgICAgZ2V0QmFzZVVSTCA6IGZ1bmN0aW9uKCl7IHJldHVybiBzZXR0aW5ncy5iYXNlVVJMOyB9IAogICAgfTsKCiAgICAvKioKICAgICAqIE1vZHVsZSBkZXBlbmRlbmNpZXMKICAgICAqLwogICAgLyoKICAgIHZhciBkYiA9IHJlcXVpcmUoJy4vZGInKSwgICAgICAgLy90aGlzIGlzIHJlcXVpcmVkIAogICAgICAgIHNoYTEgPSByZXF1aXJlKCcuL3NoYTEnKSwgICAvL25vdCByZXF1aXJlZAogICAgICAgIGNvb2tpZXMgPSByZXF1aXJlKCcuL2Nvb2tpZXMnKSwgLy9ub3QgcmVxdWlyZWQKICAgICAgICBldmVudHMgPSByZXF1aXJlKCcuL2V2ZW50cycpICAvL25vdCByZXF1aXJlZAogICAgICAgIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpOyAgLy9zZWUgYWJvdmUKICAgICovCiAgICAKICAgIAogICAgLyoqCiAgICAgKiBleHBvcnRzLmZha2VSZXF1ZXN0IGRlbGV0ZWQKICAgICAqLwogICAgCiAgICAvKioKICAgICAqIGV4cG9ydHMuc2Vzc2lvbkNoYW5nZSBzdHViYmVkCiAgICAgKi8KICAgIGV4cG9ydHMuc2Vzc2lvbkNoYW5nZSA9IGZ1bmN0aW9uICh1c2VyQ3R4LCBjYWxsYmFjaykgewogICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgIH0KICAgIH07CiAgICAKICAgIC8qKgogICAgICogTG9ncyBvdXQgdGhlIGN1cnJlbnQgdXNlci4KICAgICAqCiAgICAgKiBAbmFtZSBsb2dvdXQoY2FsbGJhY2spCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICogQGFwaSBwdWJsaWMKICAgICAqLwogICAgZXhwb3J0cy5sb2dvdXQgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbG9nb3V0IGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgICAgICB9CiAgICAgICAgZGIucmVxdWVzdCh7CiAgICAgICAgICAgIHR5cGU6ICJERUxFVEUiLAogICAgICAgICAgICB1cmw6ICIvX3Nlc3Npb24iLCAvLyBkb24ndCBuZWVkIGJhc2VVUkwsIC9fc2Vzc2lvbiBhbHdheXMgYXZhaWxhYmxlCiAgICAgICAgICAgIHVzZXJuYW1lOiAiXyIsCiAgICAgICAgICAgIHBhc3N3b3JkIDogIl8iCiAgICAgICAgfSwKICAgICAgICBmdW5jdGlvbiAoZXJyLCByZXNwKSB7CiAgICAgICAgICAgIGlmIChyZXNwICYmIHJlc3Aub2spIHsKICAgICAgICAgICAgICAgIHV0aWxzLnVzZXJDdHggPSB7bmFtZTogbnVsbCwgcm9sZXM6IFtdfTsKICAgICAgICAgICAgICAgIHV0aWxzLnNlc3Npb24gPSB7dXNlckN0eDogdXRpbHMudXNlckN0eH07CiAgICAgICAgICAgICAgICBleHBvcnRzLnNlc3Npb25DaGFuZ2UodXRpbHMudXNlckN0eCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIsIHJlc3ApOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwogICAgCiAgICAvKioKICAgICAqIEF0dGVtcHQgdG8gbG9naW4gdXNpbmcgdGhlIHVzZXJuYW1lIGFuZCBwYXNzd29yZCBwcm92aWRlZC4KICAgICAqCiAgICAgKiBAbmFtZSBsb2dpbih1c2VybmFtZSwgcGFzc3dvcmQsIGNhbGxiYWNrKQogICAgICogQHBhcmFtIHtTdHJpbmd9IHVzZXJuYW1lCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcGFzc3dvcmQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgKiBAYXBpIHB1YmxpYwogICAgICovCiAgICAKICAgIGV4cG9ydHMubG9naW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkLCBjYWxsYmFjaykgewogICAgICAgIGlmICghdXRpbHMuaXNCcm93c2VyKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdsb2dpbiBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICAgICAgfQogICAgICAgIGRiLnJlcXVlc3QoewogICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgIHVybDogIi9fc2Vzc2lvbiIsCiAgICAgICAgICAgIGRhdGE6IHtuYW1lOiB1c2VybmFtZSwgcGFzc3dvcmQ6IHBhc3N3b3JkfQogICAgICAgIH0sCiAgICAgICAgZnVuY3Rpb24gKGVyciwgcmVzcCkgewogICAgICAgICAgICBpZiAocmVzcCAmJiByZXNwLm9rKSB7CiAgICAgICAgICAgICAgICAvLyBUT0RPOiBmb3Igc29tZSByZWFzb24gcmVzcC5uYW1lIGlzIHNldCB0byBudWxsIGluIHRoZSByZXNwb25zZQogICAgICAgICAgICAgICAgLy8gZXZlbiB0aG91Z2ggdGhlIHJvbGVzIGFyZSBjb3JyZWN0IGZvciB0aGUgdXNlciEgTG9vayBpbnRvIHRoaXMKICAgICAgICAgICAgICAgIC8vIGFuZCBzZWUgaWYgaXRzIGEgYnVnIGluIGNvdWNoZGIsIGZvciBub3csIGp1c3QgdXNpbmcgdGhlIHVzZXJuYW1lCiAgICAgICAgICAgICAgICAvLyBnaXZlbiB0byB0aGUgbG9naW4gZnVuY3Rpb24gaW5zdGVhZCwgc2luY2Ugd2Uga25vdyB0aGUgbG9naW4KICAgICAgICAgICAgICAgIC8vIHJlcXVlc3Qgd2FzIGFjY2VwdGVkLgogICAgICAgICAgICAgICAgLy91dGlscy51c2VyQ3R4ID0ge25hbWU6IHJlc3AubmFtZSwgcm9sZXM6IHJlc3Aucm9sZXN9OwogICAgICAgICAgICAgICAgdXRpbHMudXNlckN0eCA9IHtuYW1lOiB1c2VybmFtZSwgcm9sZXM6IHJlc3Aucm9sZXN9OwogICAgICAgICAgICAgICAgdXRpbHMuc2Vzc2lvbiA9IHt1c2VyQ3R4OiB1dGlscy51c2VyQ3R4fTsKICAgICAgICAgICAgICAgIGV4cG9ydHMuc2Vzc2lvbkNoYW5nZSh1dGlscy51c2VyQ3R4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVyciwgcmVzcCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHVzZXIncyBzZXNzaW9uIGluZm9ybWF0aW9uLgogICAgICoKICAgICAqIEBuYW1lIGluZm8oY2FsbGJhY2spCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICogQGFwaSBwdWJsaWMKICAgICAqLwogICAgCiAgICBleHBvcnRzLmluZm8gPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW5mbyBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICAgICAgfQogICAgICAgIGRiLnJlcXVlc3QoewogICAgICAgICAgICB0eXBlOiAiR0VUIiwKICAgICAgICAgICAgdXJsOiAiL19zZXNzaW9uIgogICAgICAgIH0sCiAgICAgICAgZnVuY3Rpb24gKGVyciwgcmVzcCkgewogICAgICAgICAgICB2YXIgb2xkVXNlckN0eCA9IHV0aWxzLnVzZXJDdHg7CiAgICAgICAgICAgIHV0aWxzLnNlc3Npb24gPSByZXNwOwogICAgICAgICAgICB1dGlscy51c2VyQ3R4ID0gKHJlc3AgJiYgcmVzcC51c2VyQ3R4KSB8fCB7bmFtZTogbnVsbCwgcm9sZXM6IFtdfTsKICAgICAgICAgICAgLy8gVE9ETzogc2hvdWxkIHRoaXMgY2hlY2sgZm9yIGRpZmZlcmVuY2VzIGluIG1vcmUgdGhhbiBqdXN0IG5hbWU/CiAgICAgICAgICAgIGlmICghb2xkVXNlckN0eCB8fCBvbGRVc2VyQ3R4Lm5hbWUgIT09IHV0aWxzLnVzZXJDdHgubmFtZSkgewogICAgICAgICAgICAgICAgZXhwb3J0cy5zZXNzaW9uQ2hhbmdlKHV0aWxzLnVzZXJDdHgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyLCByZXNwKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfTsKICAgIAogICAgLyoqCiAgICAgKiBleHBvcnRzLnVzZXJEYiByZW1vdmVkCiAgICAgKi8KICAgIAogICAgCiAgICAvKioKICAgICAqIGV4cG9ydHMuc2lnbnVwICByZW1vdmVkCiAgICAgKi8KICAgIAp9KShzZXNzaW9uKTs="
        },
        "static/style.css": {
            "content_type": "text/css",
            "data": "LyoqCiAqIG1vZGlmaWVkIGZyb20ga2Fuc28gYWRtaW4gYXBwLCBuZWVkcyBtb3JlIHdvcmsuCiAqIGxpY2Vuc2UgaXMgbGljZW5zZSBmb3Iga2Fuc28gYXBwLgogKiBUT0RPIGluY2x1ZGUgcHJvcGVyIHRleHQgbGF5b3V0IHN0eWxlCiAqLwoKLyoqCiAqIGJpYmxpb2dyYXBoaWMKICovCi5ib29rdGl0bGUgewogICAgZm9udC1zdHlsZTogaXRhbGljOwp9Ci5qb3VybmFsIHsKICAgIHRleHQtZGVjb3JhdGlvbiA6IHVuZGVybGluZTsKfQouYmlibGlvZ3JhcGhpYy1kZXRhaWxzIHsKfQouYmlibGlvZ3JhcGhpYy1kZXRhaWxzLmNvbXBhY3QgewogICAgcGFkZGluZy10b3A6IDAuMzNlbTsKfQpkaXYuYmlibGlvZ3JhcGhpYy1kZXRhaWxzLmNvbXBhY3QsIGRpdi5iaWJsaW9ncmFwaGljLWRldGFpbHMuY29tcGFjdCBhIHsKICAgIGNvbG9yIDogcmdiKDc1LDc1LDc1KTsKICAgIHRleHQtYWxpZ24gOiByaWdodDsKfQoKCi8qKgogKiBsaW5rcyAtLS0gSSBwcmVmZXIgdW5kZXJsaW5lIGJ1dCBpdCdzIHRvbyBkaXN0cmFjdGluZyBpbiB0aGlzIGFwcCAobG90cyBvZiBsaW5rcykKICovCmEsIGE6dmlzaXRlZCB7CiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICBjb2xvciA6IGJsYWNrOwp9CmE6aG92ZXIgewogICAgLypib3JkZXItYm90dG9tIDogMXB4IGRvdHRlZCByZ2IoMTI1LDEyNSwxMjUpOyovCiAgICB0ZXh0LWRlY29yYXRpb24gOiB1bmRlcmxpbmU7CiAgICBiYWNrZ3JvdW5kLWNvbG9yIDogI0YyRjJGMjsKICAgIHRleHQtc2hhZG93OiAwIDAgM3B4IHJnYigyNTUsMjU1LDI1NSksIDAgMCAxcHggcmdiKDI1NSwyNTUsMjU1KTsKfQouaW5zdHJ1Y3Rpb25zIGEgewogICAgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7CiAgICBjb2xvciA6ICMwODI5OEE7Cn0KCgovKioKICogdGhlIGxvZ28gJiBsb2dpbiBiaXQsIHRvcCByaWdodAogKi8KCiNzZXNzaW9uLWNvbnRhaW5lciB7CiAgICBjb2xvcjogI2NjYzsKICAgIGZvbnQtc2l6ZSA6IDE1cHg7CiAgICBmb250LWZhbWlseSA6ICdIZWx2ZXRpY2EgTmV1ZScsICdIZWx2ZXRpY2EnLCBBcmlhbCwgRnJlZVNhbnMsIHNhbnMtc2VyaWY7CiAgICBiYWNrZ3JvdW5kOiMwMDA7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7CiAgICByaWdodDogMDsKICAgIG1hcmdpbjogMDsKICAgIHBhZGRpbmctYm90dG9tOiAwLjJlbTsKICAgIHotaW5kZXg6IDk5OTk7CiAgICBib3gtc2hhZG93IDogLTFweCAtMXB4IDEwcHggcmdiYSgwLDAsMCwgMC41KTsKICAgIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDVweDsKICAgIC1tb3otYm9yZGVyLXJhZGl1cy1ib3R0b21sZWZ0IDogNXB4Owp9CgpkaXYjc2Vzc2lvbiB7CiAgIGRpc3BsYXk6aW5saW5lOyAKICAgIG1hcmdpbjogMC4yZW0gMWVtOwp9Cgojc2Vzc2lvbiAudXNlcm5hbWUgYSB7CiAgICBjb2xvcjogI0ZGRjsKICAgIG1hcmdpbi1yaWdodDogMWVtOwogICAgdGV4dC1zaGFkb3cgOiAwIDAgNXB4ICNmZmYsIDAgMCAxMHB4ICNmZmYsIDAgMCAxNXB4ICNmZmYsIDAgMCAyMHB4ICNmZjJkOTUsIDAgMCAzMHB4ICNmZjJkOTUsIDAgMCA0MHB4ICNmZjJkOTUsIDAgMCA1MHB4ICNmZjJkOTUsIDAgMCA3NXB4ICNmZjJkOTU7CiAgICBib3JkZXItbGVmdDogMXB4IHNvbGlkICM2NjY7CiAgICBwYWRkaW5nOiAwIDAgMCAxZW07Cn0KI3Nlc3Npb24gLnVzZXJuYW1lIGE6aG92ZXIgewogICAgYmFja2dyb3VuZC1jb2xvciA6IGluaGVyaXQ7CiAgICB0ZXh0LWRlY29yYXRpb24gOiBub25lOwogICAgY29sb3IgOiAjMDAwOwogICAgdGV4dC1zaGFkb3cgOiAwIDAgMnB4ICNmZmYsIDAgMCAzcHggI2ZmZiwgMCAwIDVweCAjZmZmLCAwIDAgN3B4ICNmZjJkOTUsIDAgMCAxMHB4ICNmZjJkOTUsIDAgMCAxNHB4ICNmZjJkOTUsIDAgMCAxN3B4ICNmZjJkOTUsIDAgMCAyN3B4ICNmZjJkOTU7Cn0KCiNzZXNzaW9uIHVsLmFjdGlvbnMsCiNzZXNzaW9uIHVsLmFjdGlvbnMgbGkgewogICAgbGlzdC1zdHlsZS10eXBlOiBub25lOwogICAgZGlzcGxheTogaW5saW5lOwogICAgaGVpZ2h0OiAyZW07CiAgICBsaW5lLWhlaWdodDogMmVtOwogICAgbWFyZ2luOiAwOwogICAgcGFkZGluZzogMDsKfQoKI3Nlc3Npb24gdWwuYWN0aW9ucyBsaSBhIHsKICAgIGNvbG9yOiAjOTk5OwogICAgdGV4dC1kZWNvcmF0aW9uOiBub25lOwp9Cgojc2Vzc2lvbiB1bC5hY3Rpb25zIGxpIGE6aG92ZXIgewogICAgY29sb3I6ICNGRkY7CiAgICBiYWNrZ3JvdW5kLWNvbG9yIDogaW5oZXJpdDsKICAgIHRleHQtc2hhZG93IDogMCAwIDJweCAjZmZmLCAwIDAgM3B4ICNmZmYsIDAgMCA1cHggI2ZmZiwgMCAwIDdweCAjZmYyZDk1LCAwIDAgMTBweCAjZmYyZDk1LCAwIDAgMTRweCAjZmYyZDk1LCAwIDAgMTdweCAjZmYyZDk1LCAwIDAgMjdweCAjZmYyZDk1Owp9Cgojc2Vzc2lvbiB1bC5hY3Rpb25zLHNwYW4udXNlcm5hbWUgewogICAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjNjY2Owp9Cgojc2Vzc2lvbiB1bC5hY3Rpb25zIGxpIHsKICAgIHBhZGRpbmc6IDAgMCAwIDFlbTsKfQoKLmxvZ2dlZG91dCAubG9nb3V0IHsgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OyB9Ci5sb2dnZWRvdXQgLmxvZ2luIHsgZGlzcGxheTogaW5saW5lICFpbXBvcnRhbnQ7IH0KLmxvZ2dlZG91dCAuc2lnbnVwIHsgZGlzcGxheTogaW5saW5lICFpbXBvcnRhbnQ7IH0KLmxvZ2dlZGluIC5sb2dvdXQgeyBkaXNwbGF5OiBpbmxpbmUgIWltcG9ydGFudDsgfQoubG9nZ2VkaW4gLmxvZ2luIHsgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OyB9Ci5sb2dnZWRpbiAuc2lnbnVwIHsgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OyB9CgojbG9naW5fZm9ybSAuYWN0aW9ucywKI3NpZ251cF9mb3JtIC5hY3Rpb25zIHsKICAgIHRleHQtYWxpZ246IHJpZ2h0Owp9CgojbG9naW5fZm9ybSBsYWJlbCwKI3NpZ251cF9mb3JtIGxhYmVsIHsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIHdpZHRoOiA5MHB4Owp9CgojbG9naW5fZm9ybSAuZXJyb3JzLAojc2lnbnVwX2Zvcm0gLmVycm9ycyB7CiAgICBmb250LXNpemU6IDAuOGVtOwogICAgY29sb3I6IHJlZDsKICAgIHBhZGRpbmctbGVmdDogOTBweDsKfQoKI2xvZ2luX2Zvcm0gLmdlbmVyYWxfZXJyb3JzLAojc2lnbnVwX2Zvcm0gLmdlbmVyYWxfZXJyb3JzIHsKICAgIGZvbnQtc2l6ZTogMC44ZW07CiAgICBjb2xvcjogcmVkOwogICAgZm9udC13ZWlnaHQ6IGJvbGQ7Cn0KCgojbnJhbWFfbG9nbyB7CiAgICBjb2xvciA6ICMwMDA7CiAgICBwYWRkaW5nLWxlZnQgOiAxZW07CiAgICB0ZXh0LXNoYWRvdyA6IDAgMCAycHggI2ZmZiwgMCAwIDNweCAjZmZmLCAwIDAgNXB4ICNmZmYsIDAgMCA3cHggI2ZmMmQ5NSwgMCAwIDEwcHggI2ZmMmQ5NSwgMCAwIDE0cHggI2ZmMmQ5NSwgMCAwIDE3cHggI2ZmMmQ5NSwgMCAwIDI3cHggI2ZmMmQ5NTsKICAgIGRpc3BsYXkgOiBpbmxpbmU7Cn0KI25yYW1hX2xvZ28gOmhvdmVyIHsKICAgIGNvbG9yIDogI2ZmZjsKICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICAgIGJhY2tncm91bmQtY29sb3IgOiBpbmhlcml0OwogICAgdGV4dC1zaGFkb3cgOiAwIDAgNXB4ICNmZmYsIDAgMCAxMHB4ICNmZmYsIDAgMCAxNXB4ICNmZmYsIDAgMCAyMHB4ICNmZjJkOTUsIDAgMCAzMHB4ICNmZjJkOTUsIDAgMCA0MHB4ICNmZjJkOTUsIDAgMCA1MHB4ICNmZjJkOTUsIDAgMCA3NXB4ICNmZjJkOTU7Cn0KCi8qKgogKiBmb3IgdGhlIGNvbnRlbnQKICovCgphYmJyIHsKICAgIGJvcmRlciA6IG5vbmU7Cn0KCmJvZHkgewogICAgZm9udC1zaXplOiAxNHB4OwogICAgZm9udC1mYW1pbHk6IFBhbGF0aW5vLCAnUGFsYXRpbm8gTGlub3R5cGUnLCBHZW9yZ2lhLCBUaW1lcywgJ1RpbWVzIE5ldyBSb21hbicsIHNlcmlmOwogICAgbWFyZ2luOiAwOwogICAgbWF4LXdpZHRoIDogODAwcHg7Cn0KCmhyIHsKICAgIGJvcmRlcjogbm9uZTsKICAgIHdpZHRoOiAzMyU7CiAgICBjb2xvcjogI0JCQjsKICAgIGhlaWdodDogMXB4OwogICAgYmFja2dyb3VuZC1jb2xvcjogI0JCQjsKICAgIG1hcmdpbi10b3A6IDVlbTsKfQoKI2NvbnRlbnQgewogICAgbWFyZ2luLWxlZnQ6IDI1cHg7CiAgICBtYXJnaW4tcmlnaHQgOiAyNXB4Owp9CgpkaXYuc3BhY2VyIHsKICAgIHBhZGRpbmcgOiAwLjVlbTsKfQoKCmgxLnRpdGxlLWxpbmUgewogICAgcGFkZGluZy10b3AgOiAxZW07CiAgICBwYWRkaW5nLWJvdHRvbSA6IDA7CiAgICBtYXJnaW4tYm90dG9tIDogMDsKICAgIGZvbnQtc2l6ZSA6IDI0cHg7CiAgICBmb250LXdlaWdodDpib2xkOwp9CmgyLnRpdGxlLWxpbmUgewogICAgcGFkZGluZy10b3AgOiAxZW07CiAgICBwYWRkaW5nLWJvdHRvbSA6IDA7CiAgICBtYXJnaW4tYm90dG9tIDogMDsKICAgIGZvbnQtc2l6ZSA6IDE4cHg7CiAgICBmb250LXdlaWdodDpib2xkOwp9CgpoMi51c2VyLWxpbmUgeyAgICAgICAgCiAgICBwYWRkaW5nLWJvdHRvbSA6IDA7CiAgICBtYXJnaW4tYm90dG9tIDogMDsKICAgIGZvbnQtc2l6ZSA6IDE4cHg7CiAgICBmb250LXdlaWdodDpib2xkOwp9CgpkaXYucXVvdGVzIHsKICAgIG1hcmdpbi10b3AgOiAyZW07CiAgICBsaW5lLWhlaWdodCA6IDEuNWVtOwp9Ci5pbnN0cnVjdGlvbnMgaDIgewogICAgcGFkZGluZy10b3AgOiAxZW07Cn0KCmE6aG92ZXIgLmljb24gewogICAgY29sb3I6ICM2NjY7CiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7Cn0KCi8qIHRpdGxlIHdpdGhpbiBzb3VyY2UgZGlzcGxheSAqLwouc291cmNlIC50aXRsZS1saW5lIHsKICAgIGZvbnQtc2l6ZSA6IDE4cHg7Cn0KCi8qIHNvdXJjZSB3aXRoaW4gcXVvdGUgKi8KLl9ucmFtYS1xdW90ZSAudGl0bGUtbGluZSB7CiAgICB0ZXh0LWFsaWduIDogcmlnaHQ7Cn0KLnNvdXJjZS1mb3Itc2luZ2xlLXF1b3RlIHsKICAgIHRleHQtYWxpZ24gOiByaWdodDsKfQovKiBxdW90ZSBpbiB0aGUgZmxvdyAtLSBiaWdnZXIgdGhhbiB1c3VhbCAqLwoucXVvdGUtbGluZS5mbG93IHsKICAgIGZvbnQtc2l6ZSA6IDE2cHg7CiAgICBwYWRkaW5nLXRvcCA6IDFlbTsKICAgIGxpbmUtaGVpZ2h0IDogMS41ZW07Cn0KLl9ucmFtYS1ub3RlIHRleHRhcmVhIHsKICAgIGxpbmUtaGVpZ2h0IDogMS41ZW07Cn0KLl9ucmFtYS1ub3RlLWNvbnRlbnQgewogICAgbWFyZ2luLWJvdHRvbTogMWVtOwp9Cgp1bCB7CiAgICAtd2Via2l0LXBhZGRpbmctc3RhcnQgOiAwcHg7CiAgICBwYWRkaW5nLWxlZnQgOiAwZW07Cn0KdWwubm90ZXMsIHVsLmluc3RydWN0aW9ucyAgewogICAgcGFkZGluZy1sZWZ0IDogMmVtOwp9CnVsLm5vdGVzLl9ub3RfdXNlcl9wYWdlIHsKICAgIG1hcmdpbi1ib3R0b20gOiAyZW07Cn0KdWwubm90ZXMuX25vdF91c2VyX3BhZ2UgbGksIGxpLnVzZXItbGluZSB7CiAgICBtYXJnaW4tYm90dG9tIDogMWVtOwp9CmxpIHsKICAgIGRpc3BsYXk6YmxvY2s7Cn0KLmluc3RydWN0aW9ucyBsaSB7CiAgICBkaXNwbGF5OiBsaXN0LWl0ZW07CiAgICBsaXN0LXN0eWxlOiBjaXJjbGU7CiAgICBwYWRkaW5nLWJvdHRvbTogMC41ZW07Cn0KbGkuc291cmNlIHsKICAgIHBhZGRpbmctYm90dG9tIDogMmVtOwp9CmxpLnRhZyB7CiAgICBkaXNwbGF5OmJsb2NrOwogICAgcGFkZGluZy1ib3R0b20gOiAxZW07CiAgICBmb250LXNpemUgOiAxNnB4OwogICAgcGFkZGluZy1sZWZ0IDogMmVtOwp9CnRleHRhcmVhLl9ucmFtYS1ub3RlLWNvbnRlbnQgewogICAgYmFja2dyb3VuZC1jb2xvciA6IGluaGVyaXQ7CiAgICBmb250LXNpemU6IDE0cHg7CiAgICBmb250LWZhbWlseTogUGFsYXRpbm8sICdQYWxhdGlubyBMaW5vdHlwZScsIEdlb3JnaWEsIFRpbWVzLCAnVGltZXMgTmV3IFJvbWFuJywgc2VyaWY7CiAgICBib3JkZXIgOiBub25lOwogICAgcmVzaXplOm5vbmU7CiAgICB3aWR0aDoxMDAlOwogICAgaGVpZ2h0OmF1dG87CiAgICBwYWRkaW5nIDogMDsKICAgIG1hcmdpbiA6IDA7Cn0KCnRoIHsKICAgIHRleHQtYWxpZ246IGxlZnQ7Cn0KCiNtYWluIHsKICAgIHBhZGRpbmc6IDE4cHg7Cn0KCnAgewogICAgbWFyZ2luOiAxZW0gMDsKICAgIHBhZGRpbmc6IDA7Cn0KCgouc2ltcGxlbW9kYWwtZGF0YSBoMiB7CiAgICBtYXJnaW4tdG9wOiAwOwp9Cgp0YWJsZS50eXBlbGlzdCwKdGFibGUudmlld2xpc3QgewogICAgY2xlYXI6IGxlZnQ7CiAgICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOwogICAgYm9yZGVyLXNwYWNpbmc6IDA7CiAgICBtYXJnaW46IDAgMCAxOHB4IDA7CiAgICBsaW5lLWhlaWdodDogMDsKICAgIC8qIHdpZHRoOiAxMDAlOyAqLwp9CgoudHlwZWxpc3QgdGgsCi52aWV3bGlzdCB0aCB7CiAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICM5OTk7CiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzk5OTsKfQoKLnR5cGVsaXN0IHRoLAoudmlld2xpc3QgdGggewogICAgcGFkZGluZzogMGVtIDFlbTsKICAgIGxpbmUtaGVpZ2h0OiAxLjYxOGVtOwp9CgoudHlwZWxpc3QgdGQuYWN0aW9ucywKLnZpZXdsaXN0IHRkLmFjdGlvbnMgewogICAgcGFkZGluZzogMC42MThlbSAxZW0gMCAwLjYxOGVtOwp9CgoKLnR5cGVsaXN0IHRkLAoudmlld2xpc3QgdGQgewogICAgdmVydGljYWwtYWxpZ246IHRvcDsKICAgIGJhY2tncm91bmQtY29sb3I6ICNmZWZlZmU7CiAgICBwYWRkaW5nOiAxZW0gMDsKICAgIG1hcmdpbjogMDsKICAgIGJvcmRlcjogMDsKfQoudHlwZWxpc3QgdHIub2RkIHRkLAoudmlld2xpc3QgdHIub2RkIHRkIHsKICAgIGJhY2tncm91bmQtY29sb3I6ICNmOWY5Zjk7Cn0KCi50eXBlbGlzdCB0ZC5kYXRhLAoudmlld2xpc3QgdGQuZGF0YSB7CiAgICBmb250LXNpemU6IDAuOWVtOwogICAgcGFkZGluZzogMS40ZW0gMWVtIDEuNGVtIDA7Cn0KCi50eXBlbGlzdCB0cjpob3ZlciB0ZCwKLnZpZXdsaXN0IHRyOmhvdmVyIHRkIHsKICAgIGJhY2tncm91bmQtY29sb3I6ICNlZWU7Cn0KCi50eXBlbGlzdCB0ZC5kYXRhIGEsCi52aWV3bGlzdCB0ZC5kYXRhIGEgewogICAgZGlzcGxheTogYmxvY2s7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQ6IG5vbmU7CiAgICBjb2xvcjogYmxhY2s7CiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICBwYWRkaW5nOiAwIDFlbTsKfQoKdGguYWN0aW9ucywKdGQuYWN0aW9ucyB7CiAgICB3aWR0aDogMjEwcHg7CiAgICBwYWRkaW5nOiAwOwogICAgbWFyZ2luOiAwOwogICAgcGFkZGluZy1sZWZ0OiA1MHB4ICFpbXBvcnRhbnQ7Cn0KCmZvcm0uZGVsZXRlX2Zvcm0gewogICAgZGlzcGxheTogaW5saW5lOwogICAgbWFyZ2luOiAwOwogICAgcGFkZGluZzogMDsKfQoKLnJlbmRlci10YWJsZSB0aCB7CiAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgcGFkZGluZy1yaWdodDogMjBweDsKICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7Cn0KCi5yZW5kZXItdGFibGUgdGQgewogICAgdmVydGljYWwtYWxpZ246IHRvcDsKfQoKLnJlbmRlci10YWJsZSB0Ym9keS5oZWFkIHRoIHsKICAgIGNvbG9yOiAjNTU1OwogICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICBmb250LXNpemU6IDEuMWVtOwogICAgcGFkZGluZy10b3A6IDEuNWVtOwogICAgYm9yZGVyLWJvdHRvbTogc29saWQgMXB4ICM4ODg7Cn0KCi5kZXNjcmlwdGlvbiwKLmhpbnQgewogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsKICAgIGNvbG9yOiAjNjY2OwogICAgZm9udC1zaXplOiAwLjg1ZW07CiAgICBtYXJnaW4tYm90dG9tOiAxZW07Cn0KcC5kZXNjcmlwdGlvbiB7CiAgICBtYXJnaW4tYm90dG9tOiAyZW07Cn0KCi5yZW5kZXItdGFibGUgdWwuZXJyb3JzIHsKICAgIG1hcmdpbjogMDsKICAgIHBhZGRpbmc6IDA7CiAgICBmb250LXNpemU6IDAuOWVtOwogICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICBsaXN0LXN0eWxlLXR5cGU6IG5vbmU7Cn0KCi5yZW5kZXItdGFibGUgdWwuZXJyb3JzIGxpIHsKICAgIHBhZGRpbmc6IDA7CiAgICBtYXJnaW46IDA7CiAgICBjb2xvcjogI2Y4ODsKfQoKLmJ1dHRvbiB7CiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICBjb2xvcjogIzY2NjsKICAgIGZvbnQtc2l6ZTogMC44ZW07CiAgICBiYWNrZ3JvdW5kOiBub25lOwogICAgZGlzcGxheTogaW5saW5lOwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgbWFyZ2luOiAwOwp9CgouYnV0dG9uIC5sYWJlbCB7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB0b3A6IC0wLjI4NmVtOwogICAgbWFyZ2luOiAwOwogICAgcGFkZGluZzogMDsKICAgIG1hcmdpbi1ib3R0b206IC0wLjI4NmVtOwp9CgouYnV0dG9uIGlucHV0IHsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICAgIGNvbG9yOiAjNjY2OwogICAgYmFja2dyb3VuZDogbm9uZTsKICAgIGRpc3BsYXk6IGlubGluZTsKICAgIHBhZGRpbmc6IDA7CiAgICBtYXJnaW46IDA7CiAgICBtYXJnaW4tbGVmdDogLTAuNWVtOwogICAgYm9yZGVyOiAwOwp9Ci5idXR0b24gaW5wdXQuaWNvbiB7CiAgICBtYXJnaW46IDA7CiAgICBwYWRkaW5nOiAwOwogICAgZm9udC1zaXplOiAyZW07CiAgICBjb2xvcjogIzk5OTsKfQoKLmJ1dHRvbiBpbnB1dC5sYWJlbCB7CiAgICBtYXJnaW46IDA7CiAgICBwYWRkaW5nOiAwOwogICAgZm9udC1zaXplOiAxMS4ycHg7CiAgICBmb250LWZhbWlseSA6ICdIZWx2ZXRpY2EgTmV1ZScsICdIZWx2ZXRpY2EnLCBBcmlhbCwgRnJlZVNhbnMsIHNhbnMtc2VyaWY7Cn0KCgouYnV0dG9uOmhvdmVyIHsKICAgIGNvbG9yOiAjMDAwOwp9CgouYnV0dG9uOmhvdmVyIGlucHV0IHsKICAgIGNvbG9yOiAjMDAwOwp9Ci5idXR0b246aG92ZXIgaW5wdXQuaWNvbiB7CiAgICBjb2xvcjogIzY2NjsKfQoKLnRvcF9hY3Rpb25zIHsKICAgIG1hcmdpbjogMnB4IDAgMTJweCAwOwp9Ci5ib3R0b21fYWN0aW9ucyB7CiAgICBtYXJnaW46IDEycHggMDsKfQoKLmJvdHRvbV9hY3Rpb25zIC5idXR0b24gaW5wdXQuaWNvbiB7CiAgICBtYXJnaW4tcmlnaHQ6IDAuMjM2ZW07Cn0KLnRvcF9hY3Rpb25zIC5idXR0b24sCi5ib3R0b21fYWN0aW9ucyAuYnV0dG9uIHsKICAgIG1hcmdpbi1yaWdodDogMTJweDsKfQoKdGQuYWN0aW9ucyAuYnV0dG9uIHsKICAgIG1hcmdpbi1yaWdodDogMThweDsKfQoKLnZpZXd0eXBlIHRoIHsKICAgIHBhZGRpbmctcmlnaHQ6IDIwcHg7CiAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOwp9CgoKI2ZsYXNobWVzc2FnZXMgewogICAgbGlzdC1zdHlsZS10eXBlOiBub25lOwogICAgcGFkZGluZzogMDsKICAgIG1hcmdpbjogMCAwIDFlbSAwOwp9CgojZmxhc2htZXNzYWdlcyBsaSB7CiAgICBwYWRkaW5nOiAwLjVlbSAxZW07CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZWVlOwogICAgYm9yZGVyLXJhZGl1czogM3B4Owp9CgojZmxhc2htZXNzYWdlcyBsaS5lcnJvciB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmRkOwp9CgojZmxhc2htZXNzYWdlcyBsaS5zdWNjZXNzIHsKICAgIGJhY2tncm91bmQtY29sb3I6ICNkZmQ7Cn0KCgovKioKICogc2ltcGxlbW9kYWwgc3R1ZmYKICovCgojc2ltcGxlbW9kYWwtb3ZlcmxheSB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwOwp9Cgojc2ltcGxlbW9kYWwtY29udGFpbmVyIHsKICAgIGJhY2tncm91bmQtY29sb3I6I2ZmZjsKICAgIGJvcmRlcjogOHB4CiAgICBzb2xpZCAjNDQ0OwogICAgcGFkZGluZzogMTJweDsKfQoKCi8qKgogKiB0YWcgY2xvdWQgCiAqLwpkaXYuanFjbG91ZCB7CiAgZm9udC1mYW1pbHk6ICJIZWx2ZXRpY2EiLCAiQXJpYWwiLCBzYW5zLXNlcmlmOwogIGNvbG9yOiAjMDlmOwogIG92ZXJmbG93OiBoaWRkZW47CiAgcG9zaXRpb246IHJlbGF0aXZlOwp9CmRpdi5qcWNsb3VkIGEgewogIGNvbG9yOiBpbmhlcml0OwogIGZvbnQtc2l6ZTogaW5oZXJpdDsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7Cn0KZGl2LmpxY2xvdWQgYTpob3ZlciB7CiAgY29sb3I6ICMwZGY7Cn0KZGl2LmpxY2xvdWQgYTpob3ZlciB7CiAgY29sb3I6ICMwY2Y7Cn0KZGl2LmpxY2xvdWQgc3BhbiB7CiAgcGFkZGluZzogMDsKfQpkaXYuanFjbG91ZCBzcGFuLncxMCB7CiAgZm9udC1zaXplOiA1NHB4OwogIGNvbG9yOiAjMGNmOwp9CmRpdi5qcWNsb3VkIHNwYW4udzkgewogIGZvbnQtc2l6ZTogNTBweDsKICBjb2xvcjogIzBjZjsKfQpkaXYuanFjbG91ZCBzcGFuLnc4IHsKICBmb250LXNpemU6IDQ0cHg7CiAgY29sb3I6ICMwY2Y7Cn0KZGl2LmpxY2xvdWQgc3Bhbi53NyB7CiAgZm9udC1zaXplOiA0MHB4OwogIGNvbG9yOiAjMzlkOwp9CmRpdi5qcWNsb3VkIHNwYW4udzYgewogIGZvbnQtc2l6ZTogMzRweDsKICBjb2xvcjogIzkwYzVmMDsKfQpkaXYuanFjbG91ZCBzcGFuLnc1IHsKICBmb250LXNpemU6IDMwcHg7CiAgY29sb3I6ICM5MGEwZGQ7Cn0KZGl2LmpxY2xvdWQgc3Bhbi53NCB7CiAgZm9udC1zaXplOiAyNHB4OwogIGNvbG9yOiAjOTBjNWYwOwp9CmRpdi5qcWNsb3VkIHNwYW4udzMgewogIGZvbnQtc2l6ZTogMjBweDsKICBjb2xvcjogI2EwZGRmZjsKfQpkaXYuanFjbG91ZCBzcGFuLncyIHsKICBmb250LXNpemU6IDE0cHg7CiAgY29sb3I6ICM5OWNjZWU7Cn0KZGl2LmpxY2xvdWQgc3Bhbi53MSB7CiAgZm9udC1zaXplOiAxMHB4OwogIGNvbG9yOiAjYWFiNWYwOwp9CgoKCgoKCi8qKgogKiBjYW4gZ28/CiAqLwoKLnNwaW5uZXIgewogICAgZGlzcGxheTogaW5saW5lOwogICAgYmFja2dyb3VuZDogdXJsKCJpbWFnZXMvc3Bpbm5lci1zbWFsbC5naWYiKTsKICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CiAgICBsaW5lLWhlaWdodDogMWVtOwogICAgcGFkZGluZzogMWVtOwp9Cgoud2lkZ2V0IC5zZWxlY3RvciBzZWxlY3QgewogICAgbWluLXdpZHRoOiAxMGVtOwp9CgoucmlnaHQgewogICAgZmxvYXQ6IHJpZ2h0Owp9CgoubGVmdCB7CiAgICBmbG9hdDogbGVmdDsKfQoKLmxheW91dCB7CiAgICBvdmVyZmxvdzogaGlkZGVuOwp9CgouZW1iZWRsaXN0IC5pdGVtIHsKICAgIGNsZWFyOiBib3RoOwp9CgouZW1iZWRsaXN0IC5hY3Rpb25zIHsKICAgIGZsb2F0OiBub25lOwogICAgb3ZlcmZsb3c6IHZpc2libGU7CiAgICBwYWRkaW5nLWxlZnQ6IDA7Cn0KCi5lbWJlZGxpc3QgLml0ZW0gLmFjdGlvbnMgewogICAgZmxvYXQ6IHJpZ2h0OwogICAgb3ZlcmZsb3c6IGhpZGRlbjsKfQoKLmVtYmVkbGlzdCAuZW1iZWQgewogICAgZmxvYXQ6IG5vbmU7CiAgICBvdmVyZmxvdzogdmlzaWJsZTsKfQoKLmVtYmVkbGlzdCAuaXRlbSAuZW1iZWQgewogICAgZmxvYXQ6IGxlZnQ7CiAgICBvdmVyZmxvdzogaGlkZGVuOwp9Cg=="
        },
        "static/js/jquery.autogrow-textarea.js": {
            "content_type": "application/javascript",
            "data": "LyoqCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9qYXozMDMvanF1ZXJ5LWdyYWItYmFnCiAqIE1JVCBsaWNlbmNlCiAqLwooZnVuY3Rpb24oJCkgewoKICAgIC8qCiAgICAgKiBBdXRvLWdyb3dpbmcgdGV4dGFyZWFzOyB0ZWNobmlxdWUgcmlwcGVkIGZyb20gRmFjZWJvb2sKICAgICAqLwogICAgJC5mbi5hdXRvZ3JvdyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAKICAgICAgICB0aGlzLmZpbHRlcigndGV4dGFyZWEnKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAKICAgICAgICAgICAgdmFyICR0aGlzICAgICAgID0gJCh0aGlzKSwKICAgICAgICAgICAgICAgIG1pbkhlaWdodCAgID0gJHRoaXMuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ICA9ICR0aGlzLmNzcygnbGluZUhlaWdodCcpOwogICAgICAgICAgICAKICAgICAgICAgICAgdmFyIHNoYWRvdyA9ICQoJzxkaXY+PC9kaXY+JykuY3NzKHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAgICdhYnNvbHV0ZScsCiAgICAgICAgICAgICAgICB0b3A6ICAgICAgICAtMTAwMDAsCiAgICAgICAgICAgICAgICBsZWZ0OiAgICAgICAtMTAwMDAsCiAgICAgICAgICAgICAgICB3aWR0aDogICAgICAkKHRoaXMpLndpZHRoKCkgLSBwYXJzZUludCgkdGhpcy5jc3MoJ3BhZGRpbmdMZWZ0JykpIC0gcGFyc2VJbnQoJHRoaXMuY3NzKCdwYWRkaW5nUmlnaHQnKSksCiAgICAgICAgICAgICAgICBmb250U2l6ZTogICAkdGhpcy5jc3MoJ2ZvbnRTaXplJyksCiAgICAgICAgICAgICAgICBmb250RmFtaWx5OiAkdGhpcy5jc3MoJ2ZvbnRGYW1pbHknKSwKICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICR0aGlzLmNzcygnbGluZUhlaWdodCcpLAogICAgICAgICAgICAgICAgcmVzaXplOiAgICAgJ25vbmUnCiAgICAgICAgICAgIH0pLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpOwogICAgICAgICAgICAKICAgICAgICAgICAgdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgCiAgICAgICAgICAgICAgICB2YXIgdGltZXMgPSBmdW5jdGlvbihzdHJpbmcsIG51bWJlcikgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCByID0gJyc7IGkgPCBudW1iZXI7IGkgKyspIHIgKz0gc3RyaW5nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIHZhbCA9IHRoaXMudmFsdWUucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8+L2csICcmZ3Q7JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xuJC8sICc8YnIvPiZuYnNwOycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cbi9nLCAnPGJyLz4nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvIHsyLH0vZywgZnVuY3Rpb24oc3BhY2UpIHsgcmV0dXJuIHRpbWVzKCcmbmJzcDsnLCBzcGFjZS5sZW5ndGggLTEpICsgJyAnIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzaGFkb3cuaHRtbCh2YWwpOwogICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ2hlaWdodCcsIE1hdGgubWF4KHNoYWRvdy5oZWlnaHQoKSArIDIwLCBtaW5IZWlnaHQpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICQodGhpcykuY2hhbmdlKHVwZGF0ZSkua2V5dXAodXBkYXRlKS5rZXlkb3duKHVwZGF0ZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICB1cGRhdGUuYXBwbHkodGhpcyk7CiAgICAgICAgICAgIAogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIAogICAgfQogICAgCn0pKGpRdWVyeSk7"
        },
        "static/js/jquery.jqcloud.min.js": {
            "content_type": "application/javascript",
            "data": "LyohCiAqIGpRQ2xvdWQgUGx1Z2luIGZvciBqUXVlcnkKICoKICogVmVyc2lvbiAwLjIuNAogKgogKiBDb3B5cmlnaHQgMjAxMSwgTHVjYSBPbmdhcm8KICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKgogKiBEYXRlOiBTdW4gQXVnIDE0IDAwOjA5OjA3ICswMjAwIDIwMTEKICovCihmdW5jdGlvbihhKXthLmZuLmpRQ2xvdWQ9ZnVuY3Rpb24oYixjKXt2YXIgZD10aGlzLGU9ZC5hdHRyKCJpZCIpLGY9e3dpZHRoOmQud2lkdGgoKSxoZWlnaHQ6ZC5oZWlnaHQoKSxjZW50ZXI6e3g6ZC53aWR0aCgpLzIseTpkLmhlaWdodCgpLzJ9LGRlbGF5ZWRNb2RlOmIubGVuZ3RoPjUwLHJhbmRvbUNsYXNzZXM6MH07dHlwZW9mIGM9PSJmdW5jdGlvbiImJihjPXtjYWxsYmFjazpjfSksYz1hLmV4dGVuZChmLGN8fHt9KSxkLmFkZENsYXNzKCJqcWNsb3VkIik7dmFyIGc9ZnVuY3Rpb24oKXt2YXIgZj1mdW5jdGlvbihhLGIpe3ZhciBjPWZ1bmN0aW9uKGEsYil7aWYoTWF0aC5hYnMoMiphLm9mZnNldExlZnQrYS5vZmZzZXRXaWR0aC0yKmIub2Zmc2V0TGVmdC1iLm9mZnNldFdpZHRoKTxhLm9mZnNldFdpZHRoK2Iub2Zmc2V0V2lkdGgmJk1hdGguYWJzKDIqYS5vZmZzZXRUb3ArYS5vZmZzZXRIZWlnaHQtMipiLm9mZnNldFRvcC1iLm9mZnNldEhlaWdodCk8YS5vZmZzZXRIZWlnaHQrYi5vZmZzZXRIZWlnaHQpcmV0dXJuITA7cmV0dXJuITF9LGQ9MDtmb3IoZD0wO2Q8Yi5sZW5ndGg7ZCsrKWlmKGMoYSxiW2RdKSlyZXR1cm4hMDtyZXR1cm4hMX07Zm9yKGk9MDtpPGIubGVuZ3RoO2krKyliW2ldLndlaWdodD1wYXJzZUZsb2F0KGJbaV0ud2VpZ2h0LDEwKTtiLnNvcnQoZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS53ZWlnaHQ8Yi53ZWlnaHQ/MTphLndlaWdodD5iLndlaWdodD8tMTowfSk7dmFyIGc9MixoPVtdLGo9Yy53aWR0aC9jLmhlaWdodCxrPWZ1bmN0aW9uKGksayl7dmFyIGw9ZSsiX3dvcmRfIitpLG09IiMiK2wsbj10eXBlb2YgYy5yYW5kb21DbGFzc2VzPT0ibnVtYmVyIiYmYy5yYW5kb21DbGFzc2VzPjA/IiByIitNYXRoLmNlaWwoTWF0aC5yYW5kb20oKSpjLnJhbmRvbUNsYXNzZXMpOmEuaXNBcnJheShjLnJhbmRvbUNsYXNzZXMpJiZjLnJhbmRvbUNsYXNzZXMubGVuZ3RoPjA/IiAiK2MucmFuZG9tQ2xhc3Nlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqYy5yYW5kb21DbGFzc2VzLmxlbmd0aCldOiIiLG89Ni4yOCpNYXRoLnJhbmRvbSgpLHA9MCxxPU1hdGgucm91bmQoKGsud2VpZ2h0LWJbYi5sZW5ndGgtMV0ud2VpZ2h0KS8oYlswXS53ZWlnaHQtYltiLmxlbmd0aC0xXS53ZWlnaHQpKjkpKzEscj1rLnVybCE9PXVuZGVmaW5lZD8iPGEgaHJlZj0nIitlbmNvZGVVUkkoay51cmwpLnJlcGxhY2UoLycvZywiJTI3IikrIic+IitrLnRleHQrIjwvYT4iOmsudGV4dDtkLmFwcGVuZCgiPHNwYW4gaWQ9JyIrbCsiJyBjbGFzcz0ndyIrcStuKyInIHRpdGxlPSciKyhrLnRpdGxlfHwiIikrIic+IityKyI8L3NwYW4+Iik7dmFyIHM9YShtLGQpLHQ9cy53aWR0aCgpLHU9cy5oZWlnaHQoKSx2PWMuY2VudGVyLngtdC8yLHc9Yy5jZW50ZXIueS11LzIseD1zWzBdLnN0eWxlO3gucG9zaXRpb249ImFic29sdXRlIix4LmxlZnQ9disicHgiLHgudG9wPXcrInB4Ijt3aGlsZShmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGwpLGgpKXArPWcsbys9KGklMj09PTA/MTotMSkqZyx2PWMuY2VudGVyLngtdC8yK3AqTWF0aC5jb3Mobykqaix3PWMuY2VudGVyLnkrcCpNYXRoLnNpbihvKS11LzIseC5sZWZ0PXYrInB4Iix4LnRvcD13KyJweCI7aC5wdXNoKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGwpKX0sbD1mdW5jdGlvbihhKXthPWF8fDAsYTxiLmxlbmd0aD8oayhhLGJbYV0pLHNldFRpbWVvdXQoZnVuY3Rpb24oKXtsKGErMSl9LDEwKSk6dHlwZW9mIGMuY2FsbGJhY2s9PSJmdW5jdGlvbiImJmMuY2FsbGJhY2suY2FsbCh0aGlzKX07Yy5kZWxheWVkTW9kZXx8Yy5kZWxheWVkX21vZGU/bCgpOihhLmVhY2goYixrKSx0eXBlb2YgYy5jYWxsYmFjaz09ImZ1bmN0aW9uIiYmYy5jYWxsYmFjay5jYWxsKHRoaXMpKX07c2V0VGltZW91dChmdW5jdGlvbigpe2coKX0sMTApO3JldHVybiB0aGlzfX0pKGpRdWVyeSk="
        },
        "static/js/jquery.simplemodal-1.4.1.js": {
            "content_type": "application/javascript",
            "data": "LyoKICogU2ltcGxlTW9kYWwgMS40LjEgLSBqUXVlcnkgUGx1Z2luCiAqIGh0dHA6Ly93d3cuZXJpY21tYXJ0aW4uY29tL3Byb2plY3RzL3NpbXBsZW1vZGFsLwogKiBDb3B5cmlnaHQgKGMpIDIwMTAgRXJpYyBNYXJ0aW4gKGh0dHA6Ly90d2l0dGVyLmNvbS9lcmljbW1hcnRpbikKICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGFuZCBHUEwgbGljZW5zZXMKICogUmV2aXNpb246ICRJZDoganF1ZXJ5LnNpbXBsZW1vZGFsLmpzIDI2MSAyMDEwLTExLTA1IDIxOjE2OjIwWiBlbWFydGluMjQgJAogKi8KCi8qKgogKiBTaW1wbGVNb2RhbCBpcyBhIGxpZ2h0d2VpZ2h0IGpRdWVyeSBwbHVnaW4gdGhhdCBwcm92aWRlcyBhIHNpbXBsZQogKiBpbnRlcmZhY2UgdG8gY3JlYXRlIGEgbW9kYWwgZGlhbG9nLgogKgogKiBUaGUgZ29hbCBvZiBTaW1wbGVNb2RhbCBpcyB0byBwcm92aWRlIGRldmVsb3BlcnMgd2l0aCBhIGNyb3NzLWJyb3dzZXIKICogb3ZlcmxheSBhbmQgY29udGFpbmVyIHRoYXQgd2lsbCBiZSBwb3B1bGF0ZWQgd2l0aCBkYXRhIHByb3ZpZGVkIHRvCiAqIFNpbXBsZU1vZGFsLgogKgogKiBUaGVyZSBhcmUgdHdvIHdheXMgdG8gY2FsbCBTaW1wbGVNb2RhbDoKICogMSkgQXMgYSBjaGFpbmVkIGZ1bmN0aW9uIG9uIGEgalF1ZXJ5IG9iamVjdCwgbGlrZSAkKCcjbXlEaXYnKS5tb2RhbCgpOy4KICogVGhpcyBjYWxsIHdvdWxkIHBsYWNlIHRoZSBET00gb2JqZWN0LCAjbXlEaXYsIGluc2lkZSBhIG1vZGFsIGRpYWxvZy4KICogQ2hhaW5pbmcgcmVxdWlyZXMgYSBqUXVlcnkgb2JqZWN0LiBBbiBvcHRpb25hbCBvcHRpb25zIG9iamVjdCBjYW4gYmUKICogcGFzc2VkIGFzIGEgcGFyYW1ldGVyLgogKgogKiBAZXhhbXBsZSAkKCc8ZGl2Pm15IGRhdGE8L2Rpdj4nKS5tb2RhbCh7b3B0aW9uc30pOwogKiBAZXhhbXBsZSAkKCcjbXlEaXYnKS5tb2RhbCh7b3B0aW9uc30pOwogKiBAZXhhbXBsZSBqUXVlcnlPYmplY3QubW9kYWwoe29wdGlvbnN9KTsKICoKICogMikgQXMgYSBzdGFuZC1hbG9uZSBmdW5jdGlvbiwgbGlrZSAkLm1vZGFsKGRhdGEpLiBUaGUgZGF0YSBwYXJhbWV0ZXIKICogaXMgcmVxdWlyZWQgYW5kIGFuIG9wdGlvbmFsIG9wdGlvbnMgb2JqZWN0IGNhbiBiZSBwYXNzZWQgYXMgYSBzZWNvbmQKICogcGFyYW1ldGVyLiBUaGlzIG1ldGhvZCBwcm92aWRlcyBtb3JlIGZsZXhpYmlsaXR5IGluIHRoZSB0eXBlcyBvZiBkYXRhCiAqIHRoYXQgYXJlIGFsbG93ZWQuIFRoZSBkYXRhIGNvdWxkIGJlIGEgRE9NIG9iamVjdCwgYSBqUXVlcnkgb2JqZWN0LCBIVE1MCiAqIG9yIGEgc3RyaW5nLgogKgogKiBAZXhhbXBsZSAkLm1vZGFsKCc8ZGl2Pm15IGRhdGE8L2Rpdj4nLCB7b3B0aW9uc30pOwogKiBAZXhhbXBsZSAkLm1vZGFsKCdteSBkYXRhJywge29wdGlvbnN9KTsKICogQGV4YW1wbGUgJC5tb2RhbCgkKCcjbXlEaXYnKSwge29wdGlvbnN9KTsKICogQGV4YW1wbGUgJC5tb2RhbChqUXVlcnlPYmplY3QsIHtvcHRpb25zfSk7CiAqIEBleGFtcGxlICQubW9kYWwoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ215RGl2JyksIHtvcHRpb25zfSk7CiAqCiAqIEEgU2ltcGxlTW9kYWwgY2FsbCBjYW4gY29udGFpbiBtdWx0aXBsZSBlbGVtZW50cywgYnV0IG9ubHkgb25lIG1vZGFsCiAqIGRpYWxvZyBjYW4gYmUgY3JlYXRlZCBhdCBhIHRpbWUuIFdoaWNoIG1lYW5zIHRoYXQgYWxsIG9mIHRoZSBtYXRjaGVkCiAqIGVsZW1lbnRzIHdpbGwgYmUgZGlzcGxheWVkIHdpdGhpbiB0aGUgbW9kYWwgY29udGFpbmVyLgogKgogKiBTaW1wbGVNb2RhbCBpbnRlcm5hbGx5IHNldHMgdGhlIENTUyBuZWVkZWQgdG8gZGlzcGxheSB0aGUgbW9kYWwgZGlhbG9nCiAqIHByb3Blcmx5IGluIGFsbCBicm93c2VycywgeWV0IHByb3ZpZGVzIHRoZSBkZXZlbG9wZXIgd2l0aCB0aGUgZmxleGliaWxpdHkKICogdG8gZWFzaWx5IGNvbnRyb2wgdGhlIGxvb2sgYW5kIGZlZWwuIFRoZSBzdHlsaW5nIGZvciBTaW1wbGVNb2RhbCBjYW4gYmUKICogZG9uZSB0aHJvdWdoIGV4dGVybmFsIHN0eWxlc2hlZXRzLCBvciB0aHJvdWdoIFNpbXBsZU1vZGFsLCB1c2luZyB0aGUKICogb3ZlcmxheUNzcywgY29udGFpbmVyQ3NzLCBhbmQgZGF0YUNzcyBvcHRpb25zLgogKgogKiBTaW1wbGVNb2RhbCBoYXMgYmVlbiB0ZXN0ZWQgaW4gdGhlIGZvbGxvd2luZyBicm93c2VyczoKICogLSBJRSA2LCA3LCA4LCA5CiAqIC0gRmlyZWZveCAyLCAzLCA0CiAqIC0gT3BlcmEgOSwgMTAKICogLSBTYWZhcmkgMywgNCwgNQogKiAtIENocm9tZSAxLCAyLCAzLCA0LCA1LCA2CiAqCiAqIEBuYW1lIFNpbXBsZU1vZGFsCiAqIEB0eXBlIGpRdWVyeQogKiBAcmVxdWlyZXMgalF1ZXJ5IHYxLjIuNAogKiBAY2F0IFBsdWdpbnMvV2luZG93cyBhbmQgT3ZlcmxheXMKICogQGF1dGhvciBFcmljIE1hcnRpbiAoaHR0cDovL2VyaWNtbWFydGluLmNvbSkKICogQHZlcnNpb24gMS40LjEKICovCjsoZnVuY3Rpb24gKCQpIHsKCXZhciBpZTYgPSAkLmJyb3dzZXIubXNpZSAmJiBwYXJzZUludCgkLmJyb3dzZXIudmVyc2lvbikgPT09IDYgJiYgdHlwZW9mIHdpbmRvd1snWE1MSHR0cFJlcXVlc3QnXSAhPT0gJ29iamVjdCcsCgkJaWU3ID0gJC5icm93c2VyLm1zaWUgJiYgcGFyc2VJbnQoJC5icm93c2VyLnZlcnNpb24pID09PSA3LAoJCWllUXVpcmtzID0gbnVsbCwKCQl3ID0gW107CgoJLyoKCSAqIENyZWF0ZSBhbmQgZGlzcGxheSBhIG1vZGFsIGRpYWxvZy4KCSAqCgkgKiBAcGFyYW0ge3N0cmluZywgb2JqZWN0fSBkYXRhIEEgc3RyaW5nLCBqUXVlcnkgb2JqZWN0IG9yIERPTSBvYmplY3QKCSAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gQW4gb3B0aW9uYWwgb2JqZWN0IGNvbnRhaW5pbmcgb3B0aW9ucyBvdmVycmlkZXMKCSAqLwoJJC5tb2RhbCA9IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7CgkJcmV0dXJuICQubW9kYWwuaW1wbC5pbml0KGRhdGEsIG9wdGlvbnMpOwoJfTsKCgkvKgoJICogQ2xvc2UgdGhlIG1vZGFsIGRpYWxvZy4KCSAqLwoJJC5tb2RhbC5jbG9zZSA9IGZ1bmN0aW9uICgpIHsKCQkkLm1vZGFsLmltcGwuY2xvc2UoKTsKCX07CgoJLyoKCSAqIFNldCBmb2N1cyBvbiBmaXJzdCBvciBsYXN0IHZpc2libGUgaW5wdXQgaW4gdGhlIG1vZGFsIGRpYWxvZy4gVG8gZm9jdXMgb24gdGhlIGxhc3QKCSAqIGVsZW1lbnQsIGNhbGwgJC5tb2RhbC5mb2N1cygnbGFzdCcpLiBJZiBubyBpbnB1dCBlbGVtZW50cyBhcmUgZm91bmQsIGZvY3VzIGlzIHBsYWNlZAoJICogb24gdGhlIGRhdGEgd3JhcHBlciBlbGVtZW50LgoJICovCgkkLm1vZGFsLmZvY3VzID0gZnVuY3Rpb24gKHBvcykgewoJCSQubW9kYWwuaW1wbC5mb2N1cyhwb3MpOwoJfTsKCgkvKgoJICogRGV0ZXJtaW5lIGFuZCBzZXQgdGhlIGRpbWVuc2lvbnMgb2YgdGhlIG1vZGFsIGRpYWxvZyBjb250YWluZXIuCgkgKiBzZXRQb3NpdGlvbigpIGlzIGNhbGxlZCBpZiB0aGUgYXV0b1Bvc2l0aW9uIG9wdGlvbiBpcyB0cnVlLgoJICovCgkkLm1vZGFsLnNldENvbnRhaW5lckRpbWVuc2lvbnMgPSBmdW5jdGlvbiAoKSB7CgkJJC5tb2RhbC5pbXBsLnNldENvbnRhaW5lckRpbWVuc2lvbnMoKTsKCX07CgoJLyoKCSAqIFJlLXBvc2l0aW9uIHRoZSBtb2RhbCBkaWFsb2cuCgkgKi8KCSQubW9kYWwuc2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7CgkJJC5tb2RhbC5pbXBsLnNldFBvc2l0aW9uKCk7Cgl9OwoKCS8qCgkgKiBVcGRhdGUgdGhlIG1vZGFsIGRpYWxvZy4gSWYgbmV3IGRpbWVuc2lvbnMgYXJlIHBhc3NlZCwgdGhleSB3aWxsIGJlIHVzZWQgdG8gZGV0ZXJtaW5lCgkgKiB0aGUgZGltZW5zaW9ucyBvZiB0aGUgY29udGFpbmVyLgoJICoKCSAqIHNldENvbnRhaW5lckRpbWVuc2lvbnMoKSBpcyBjYWxsZWQsIHdoaWNoIGluIHR1cm4gY2FsbHMgc2V0UG9zaXRpb24oKSwgaWYgZW5hYmxlZC4KCSAqIExhc3RseSwgZm9jdXMoKSBpcyBjYWxsZWQgaXMgdGhlIGZvY3VzIG9wdGlvbiBpcyB0cnVlLgoJICovCgkkLm1vZGFsLnVwZGF0ZSA9IGZ1bmN0aW9uIChoZWlnaHQsIHdpZHRoKSB7CgkJJC5tb2RhbC5pbXBsLnVwZGF0ZShoZWlnaHQsIHdpZHRoKTsKCX07CgoJLyoKCSAqIENoYWluZWQgZnVuY3Rpb24gdG8gY3JlYXRlIGEgbW9kYWwgZGlhbG9nLgoJICoKCSAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gQW4gb3B0aW9uYWwgb2JqZWN0IGNvbnRhaW5pbmcgb3B0aW9ucyBvdmVycmlkZXMKCSAqLwoJJC5mbi5tb2RhbCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CgkJcmV0dXJuICQubW9kYWwuaW1wbC5pbml0KHRoaXMsIG9wdGlvbnMpOwoJfTsKCgkvKgoJICogU2ltcGxlTW9kYWwgZGVmYXVsdCBvcHRpb25zCgkgKgoJICogYXBwZW5kVG86CQkoU3RyaW5nOidib2R5JykgVGhlIGpRdWVyeSBzZWxlY3RvciB0byBhcHBlbmQgdGhlIGVsZW1lbnRzIHRvLiBGb3IgLk5FVCwgdXNlICdmb3JtJy4KCSAqIGZvY3VzOgkJCShCb29sZWFuOnRydWUpIEZvY3VzIGluIHRoZSBmaXJzdCB2aXNpYmxlLCBlbmFibGVkIGVsZW1lbnQ/CgkgKiBvcGFjaXR5OgkJCShOdW1iZXI6NTApIFRoZSBvcGFjaXR5IHZhbHVlIGZvciB0aGUgb3ZlcmxheSBkaXYsIGZyb20gMCAtIDEwMAoJICogb3ZlcmxheUlkOgkJKFN0cmluZzonc2ltcGxlbW9kYWwtb3ZlcmxheScpIFRoZSBET00gZWxlbWVudCBpZCBmb3IgdGhlIG92ZXJsYXkgZGl2CgkgKiBvdmVybGF5Q3NzOgkJKE9iamVjdDp7fSkgVGhlIENTUyBzdHlsaW5nIGZvciB0aGUgb3ZlcmxheSBkaXYKCSAqIGNvbnRhaW5lcklkOgkJKFN0cmluZzonc2ltcGxlbW9kYWwtY29udGFpbmVyJykgVGhlIERPTSBlbGVtZW50IGlkIGZvciB0aGUgY29udGFpbmVyIGRpdgoJICogY29udGFpbmVyQ3NzOgkoT2JqZWN0Ont9KSBUaGUgQ1NTIHN0eWxpbmcgZm9yIHRoZSBjb250YWluZXIgZGl2CgkgKiBkYXRhSWQ6CQkJKFN0cmluZzonc2ltcGxlbW9kYWwtZGF0YScpIFRoZSBET00gZWxlbWVudCBpZCBmb3IgdGhlIGRhdGEgZGl2CgkgKiBkYXRhQ3NzOgkJCShPYmplY3Q6e30pIFRoZSBDU1Mgc3R5bGluZyBmb3IgdGhlIGRhdGEgZGl2CgkgKiBtaW5IZWlnaHQ6CQkoTnVtYmVyOm51bGwpIFRoZSBtaW5pbXVtIGhlaWdodCBmb3IgdGhlIGNvbnRhaW5lcgoJICogbWluV2lkdGg6CQkoTnVtYmVyOm51bGwpIFRoZSBtaW5pbXVtIHdpZHRoIGZvciB0aGUgY29udGFpbmVyCgkgKiBtYXhIZWlnaHQ6CQkoTnVtYmVyOm51bGwpIFRoZSBtYXhpbXVtIGhlaWdodCBmb3IgdGhlIGNvbnRhaW5lci4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHdpbmRvdyBoZWlnaHQgaXMgdXNlZC4KCSAqIG1heFdpZHRoOgkJKE51bWJlcjpudWxsKSBUaGUgbWF4aW11bSB3aWR0aCBmb3IgdGhlIGNvbnRhaW5lci4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHdpbmRvdyB3aWR0aCBpcyB1c2VkLgoJICogYXV0b1Jlc2l6ZToJCShCb29sZWFuOmZhbHNlKSBBdXRvbWF0aWNhbGx5IHJlc2l6ZSB0aGUgY29udGFpbmVyIGlmIGl0IGV4Y2VlZHMgdGhlIGJyb3dzZXIgd2luZG93IGRpbWVuc2lvbnM/CgkgKiBhdXRvUG9zaXRpb246CShCb29sZWFuOnRydWUpIEF1dG9tYXRpY2FsbHkgcG9zaXRpb24gdGhlIGNvbnRhaW5lciB1cG9uIGNyZWF0aW9uIGFuZCBvbiB3aW5kb3cgcmVzaXplPwoJICogekluZGV4OgkJCShOdW1iZXI6IDEwMDApIFN0YXJ0aW5nIHotaW5kZXggdmFsdWUKCSAqIGNsb3NlOgkJCShCb29sZWFuOnRydWUpIElmIHRydWUsIGNsb3NlSFRNTCwgZXNjQ2xvc2UgYW5kIG92ZXJDbG9zZSB3aWxsIGJlIHVzZWQgaWYgc2V0LgoJIAkJCQkJCQlJZiBmYWxzZSwgbm9uZSBvZiB0aGVtIHdpbGwgYmUgdXNlZC4KCSAqIGNsb3NlSFRNTDoJCShTdHJpbmc6JzxhIGNsYXNzPSJtb2RhbENsb3NlSW1nIiB0aXRsZT0iQ2xvc2UiPjwvYT4nKSBUaGUgSFRNTCBmb3IgdGhlIGRlZmF1bHQgY2xvc2UgbGluay4KCQkJCQkJCQlTaW1wbGVNb2RhbCB3aWxsIGF1dG9tYXRpY2FsbHkgYWRkIHRoZSBjbG9zZUNsYXNzIHRvIHRoaXMgZWxlbWVudC4KCSAqIGNsb3NlQ2xhc3M6CQkoU3RyaW5nOidzaW1wbGVtb2RhbC1jbG9zZScpIFRoZSBDU1MgY2xhc3MgdXNlZCB0byBiaW5kIHRvIHRoZSBjbG9zZSBldmVudAoJICogZXNjQ2xvc2U6CQkoQm9vbGVhbjp0cnVlKSBBbGxvdyBFc2Mga2V5cHJlc3MgdG8gY2xvc2UgdGhlIGRpYWxvZz8KCSAqIG92ZXJsYXlDbG9zZToJKEJvb2xlYW46ZmFsc2UpIEFsbG93IGNsaWNrIG9uIG92ZXJsYXkgdG8gY2xvc2UgdGhlIGRpYWxvZz8KCSAqIHBvc2l0aW9uOgkJKEFycmF5Om51bGwpIFBvc2l0aW9uIG9mIGNvbnRhaW5lciBbdG9wLCBsZWZ0XS4gQ2FuIGJlIG51bWJlciBvZiBwaXhlbHMgb3IgcGVyY2VudGFnZQoJICogcGVyc2lzdDoJCQkoQm9vbGVhbjpmYWxzZSkgUGVyc2lzdCB0aGUgZGF0YSBhY3Jvc3MgbW9kYWwgY2FsbHM/IE9ubHkgdXNlZCBmb3IgZXhpc3RpbmcKCQkJCQkJCQlET00gZWxlbWVudHMuIElmIHRydWUsIHRoZSBkYXRhIHdpbGwgYmUgbWFpbnRhaW5lZCBhY3Jvc3MgbW9kYWwgY2FsbHMsIGlmIGZhbHNlLAoJCQkJCQkJCXRoZSBkYXRhIHdpbGwgYmUgcmV2ZXJ0ZWQgdG8gaXRzIG9yaWdpbmFsIHN0YXRlLgoJICogbW9kYWw6CQkJKEJvb2xlYW46dHJ1ZSkgVXNlciB3aWxsIGJlIHVuYWJsZSB0byBpbnRlcmFjdCB3aXRoIHRoZSBwYWdlIGJlbG93IHRoZSBtb2RhbCBvciB0YWIgYXdheSBmcm9tIHRoZSBkaWFsb2cuCgkJCQkJCQkJSWYgZmFsc2UsIHRoZSBvdmVybGF5LCBpZnJhbWUsIGFuZCBjZXJ0YWluIGV2ZW50cyB3aWxsIGJlIGRpc2FibGVkIGFsbG93aW5nIHRoZSB1c2VyIHRvIGludGVyYWN0CgkJCQkJCQkJd2l0aCB0aGUgcGFnZSBiZWxvdyB0aGUgZGlhbG9nLgoJICogb25PcGVuOgkJCShGdW5jdGlvbjpudWxsKSBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gdXNlZCBpbiBwbGFjZSBvZiBTaW1wbGVNb2RhbCdzIG9wZW4KCSAqIG9uU2hvdzoJCQkoRnVuY3Rpb246bnVsbCkgVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHVzZWQgYWZ0ZXIgdGhlIG1vZGFsIGRpYWxvZyBoYXMgb3BlbmVkCgkgKiBvbkNsb3NlOgkJCShGdW5jdGlvbjpudWxsKSBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gdXNlZCBpbiBwbGFjZSBvZiBTaW1wbGVNb2RhbCdzIGNsb3NlCgkgKi8KCSQubW9kYWwuZGVmYXVsdHMgPSB7CgkJYXBwZW5kVG86ICdib2R5JywKCQlmb2N1czogdHJ1ZSwKCQlvcGFjaXR5OiA1MCwKCQlvdmVybGF5SWQ6ICdzaW1wbGVtb2RhbC1vdmVybGF5JywKCQlvdmVybGF5Q3NzOiB7fSwKCQljb250YWluZXJJZDogJ3NpbXBsZW1vZGFsLWNvbnRhaW5lcicsCgkJY29udGFpbmVyQ3NzOiB7fSwKCQlkYXRhSWQ6ICdzaW1wbGVtb2RhbC1kYXRhJywKCQlkYXRhQ3NzOiB7fSwKCQltaW5IZWlnaHQ6IG51bGwsCgkJbWluV2lkdGg6IG51bGwsCgkJbWF4SGVpZ2h0OiBudWxsLAoJCW1heFdpZHRoOiBudWxsLAoJCWF1dG9SZXNpemU6IGZhbHNlLAoJCWF1dG9Qb3NpdGlvbjogdHJ1ZSwKCQl6SW5kZXg6IDEwMDAsCgkJY2xvc2U6IHRydWUsCgkJY2xvc2VIVE1MOiAnPGEgY2xhc3M9Im1vZGFsQ2xvc2VJbWciIHRpdGxlPSJDbG9zZSI+PC9hPicsCgkJY2xvc2VDbGFzczogJ3NpbXBsZW1vZGFsLWNsb3NlJywKCQllc2NDbG9zZTogdHJ1ZSwKCQlvdmVybGF5Q2xvc2U6IGZhbHNlLAoJCXBvc2l0aW9uOiBudWxsLAoJCXBlcnNpc3Q6IGZhbHNlLAoJCW1vZGFsOiB0cnVlLAoJCW9uT3BlbjogbnVsbCwKCQlvblNob3c6IG51bGwsCgkJb25DbG9zZTogbnVsbAoJfTsKCgkvKgoJICogTWFpbiBtb2RhbCBvYmplY3QKCSAqIG8gPSBvcHRpb25zCgkgKi8KCSQubW9kYWwuaW1wbCA9IHsKCQkvKgoJCSAqIENvbnRhaW5zIHRoZSBtb2RhbCBkaWFsb2cgZWxlbWVudHMgYW5kIGlzIHRoZSBvYmplY3QgcGFzc2VkCgkJICogYmFjayB0byB0aGUgY2FsbGJhY2sgKG9uT3Blbiwgb25TaG93LCBvbkNsb3NlKSBmdW5jdGlvbnMKCQkgKi8KCQlkOiB7fSwKCQkvKgoJCSAqIEluaXRpYWxpemUgdGhlIG1vZGFsIGRpYWxvZwoJCSAqLwoJCWluaXQ6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7CgkJCXZhciBzID0gdGhpczsKCgkJCS8vIGRvbid0IGFsbG93IG11bHRpcGxlIGNhbGxzCgkJCWlmIChzLmQuZGF0YSkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgoJCQkvLyAkLmJveE1vZGVsIGlzIHVuZGVmaW5lZCBpZiBjaGVja2VkIGVhcmxpZXIKCQkJaWVRdWlya3MgPSAkLmJyb3dzZXIubXNpZSAmJiAhJC5ib3hNb2RlbDsKCgkJCS8vIG1lcmdlIGRlZmF1bHRzIGFuZCB1c2VyIG9wdGlvbnMKCQkJcy5vID0gJC5leHRlbmQoe30sICQubW9kYWwuZGVmYXVsdHMsIG9wdGlvbnMpOwoKCQkJLy8ga2VlcCB0cmFjayBvZiB6LWluZGV4CgkJCXMuekluZGV4ID0gcy5vLnpJbmRleDsKCgkJCS8vIHNldCB0aGUgb25DbG9zZSBjYWxsYmFjayBmbGFnCgkJCXMub2NjYiA9IGZhbHNlOwoKCQkJLy8gZGV0ZXJtaW5lIGhvdyB0byBoYW5kbGUgdGhlIGRhdGEgYmFzZWQgb24gaXRzIHR5cGUKCQkJaWYgKHR5cGVvZiBkYXRhID09PSAnb2JqZWN0JykgewoJCQkJLy8gY29udmVydCBET00gb2JqZWN0IHRvIGEgalF1ZXJ5IG9iamVjdAoJCQkJZGF0YSA9IGRhdGEgaW5zdGFuY2VvZiBqUXVlcnkgPyBkYXRhIDogJChkYXRhKTsKCQkJCXMuZC5wbGFjZWhvbGRlciA9IGZhbHNlOwoKCQkJCS8vIGlmIHRoZSBvYmplY3QgY2FtZSBmcm9tIHRoZSBET00sIGtlZXAgdHJhY2sgb2YgaXRzIHBhcmVudAoJCQkJaWYgKGRhdGEucGFyZW50KCkucGFyZW50KCkuc2l6ZSgpID4gMCkgewoJCQkJCWRhdGEuYmVmb3JlKCQoJzxzcGFuPjwvc3Bhbj4nKQoJCQkJCQkuYXR0cignaWQnLCAnc2ltcGxlbW9kYWwtcGxhY2Vob2xkZXInKQoJCQkJCQkuY3NzKHtkaXNwbGF5OiAnbm9uZSd9KSk7CgoJCQkJCXMuZC5wbGFjZWhvbGRlciA9IHRydWU7CgkJCQkJcy5kaXNwbGF5ID0gZGF0YS5jc3MoJ2Rpc3BsYXknKTsKCgkJCQkJLy8gcGVyc2lzdCBjaGFuZ2VzPyBpZiBub3QsIG1ha2UgYSBjbG9uZSBvZiB0aGUgZWxlbWVudAoJCQkJCWlmICghcy5vLnBlcnNpc3QpIHsKCQkJCQkJcy5kLm9yaWcgPSBkYXRhLmNsb25lKHRydWUpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIGRhdGEgPT09ICdudW1iZXInKSB7CgkJCQkvLyBqdXN0IGluc2VydCB0aGUgZGF0YSBhcyBpbm5lckhUTUwKCQkJCWRhdGEgPSAkKCc8ZGl2PjwvZGl2PicpLmh0bWwoZGF0YSk7CgkJCX0KCQkJZWxzZSB7CgkJCQkvLyB1bnN1cHBvcnRlZCBkYXRhIHR5cGUhCgkJCQlhbGVydCgnU2ltcGxlTW9kYWwgRXJyb3I6IFVuc3VwcG9ydGVkIGRhdGEgdHlwZTogJyArIHR5cGVvZiBkYXRhKTsKCQkJCXJldHVybiBzOwoJCQl9CgoJCQkvLyBjcmVhdGUgdGhlIG1vZGFsIG92ZXJsYXksIGNvbnRhaW5lciBhbmQsIGlmIG5lY2Vzc2FyeSwgaWZyYW1lCgkJCXMuY3JlYXRlKGRhdGEpOwoJCQlkYXRhID0gbnVsbDsKCgkJCS8vIGRpc3BsYXkgdGhlIG1vZGFsIGRpYWxvZwoJCQlzLm9wZW4oKTsKCgkJCS8vIHVzZWZ1bCBmb3IgYWRkaW5nIGV2ZW50cy9tYW5pcHVsYXRpbmcgZGF0YSBpbiB0aGUgbW9kYWwgZGlhbG9nCgkJCWlmICgkLmlzRnVuY3Rpb24ocy5vLm9uU2hvdykpIHsKCQkJCXMuby5vblNob3cuYXBwbHkocywgW3MuZF0pOwoJCQl9CgoJCQkvLyBkb24ndCBicmVhayB0aGUgY2hhaW4gPSkKCQkJcmV0dXJuIHM7CgkJfSwKCQkvKgoJCSAqIENyZWF0ZSBhbmQgYWRkIHRoZSBtb2RhbCBvdmVybGF5IGFuZCBjb250YWluZXIgdG8gdGhlIHBhZ2UKCQkgKi8KCQljcmVhdGU6IGZ1bmN0aW9uIChkYXRhKSB7CgkJCXZhciBzID0gdGhpczsKCgkJCS8vIGdldCB0aGUgd2luZG93IHByb3BlcnRpZXMKCQkJdyA9IHMuZ2V0RGltZW5zaW9ucygpOwoKCQkJLy8gYWRkIGFuIGlmcmFtZSB0byBwcmV2ZW50IHNlbGVjdCBvcHRpb25zIGZyb20gYmxlZWRpbmcgdGhyb3VnaAoJCQlpZiAocy5vLm1vZGFsICYmIGllNikgewoJCQkJcy5kLmlmcmFtZSA9ICQoJzxpZnJhbWUgc3JjPSJqYXZhc2NyaXB0OmZhbHNlOyI+PC9pZnJhbWU+JykKCQkJCQkuY3NzKCQuZXh0ZW5kKHMuby5pZnJhbWVDc3MsIHsKCQkJCQkJZGlzcGxheTogJ25vbmUnLAoJCQkJCQlvcGFjaXR5OiAwLAoJCQkJCQlwb3NpdGlvbjogJ2ZpeGVkJywKCQkJCQkJaGVpZ2h0OiB3WzBdLAoJCQkJCQl3aWR0aDogd1sxXSwKCQkJCQkJekluZGV4OiBzLm8uekluZGV4LAoJCQkJCQl0b3A6IDAsCgkJCQkJCWxlZnQ6IDAKCQkJCQl9KSkKCQkJCQkuYXBwZW5kVG8ocy5vLmFwcGVuZFRvKTsKCQkJfQoKCQkJLy8gY3JlYXRlIHRoZSBvdmVybGF5CgkJCXMuZC5vdmVybGF5ID0gJCgnPGRpdj48L2Rpdj4nKQoJCQkJLmF0dHIoJ2lkJywgcy5vLm92ZXJsYXlJZCkKCQkJCS5hZGRDbGFzcygnc2ltcGxlbW9kYWwtb3ZlcmxheScpCgkJCQkuY3NzKCQuZXh0ZW5kKHMuby5vdmVybGF5Q3NzLCB7CgkJCQkJZGlzcGxheTogJ25vbmUnLAoJCQkJCW9wYWNpdHk6IHMuby5vcGFjaXR5IC8gMTAwLAoJCQkJCWhlaWdodDogcy5vLm1vZGFsID8gd1swXSA6IDAsCgkJCQkJd2lkdGg6IHMuby5tb2RhbCA/IHdbMV0gOiAwLAoJCQkJCXBvc2l0aW9uOiAnZml4ZWQnLAoJCQkJCWxlZnQ6IDAsCgkJCQkJdG9wOiAwLAoJCQkJCXpJbmRleDogcy5vLnpJbmRleCArIDEKCQkJCX0pKQoJCQkJLmFwcGVuZFRvKHMuby5hcHBlbmRUbyk7CgoJCQkvLyBjcmVhdGUgdGhlIGNvbnRhaW5lcgoJCQlzLmQuY29udGFpbmVyID0gJCgnPGRpdj48L2Rpdj4nKQoJCQkJLmF0dHIoJ2lkJywgcy5vLmNvbnRhaW5lcklkKQoJCQkJLmFkZENsYXNzKCdzaW1wbGVtb2RhbC1jb250YWluZXInKQoJCQkJLmNzcygkLmV4dGVuZChzLm8uY29udGFpbmVyQ3NzLCB7CgkJCQkJZGlzcGxheTogJ25vbmUnLAoJCQkJCXBvc2l0aW9uOiAnZml4ZWQnLAoJCQkJCXpJbmRleDogcy5vLnpJbmRleCArIDIKCQkJCX0pKQoJCQkJLmFwcGVuZChzLm8uY2xvc2UgJiYgcy5vLmNsb3NlSFRNTAoJCQkJCT8gJChzLm8uY2xvc2VIVE1MKS5hZGRDbGFzcyhzLm8uY2xvc2VDbGFzcykKCQkJCQk6ICcnKQoJCQkJLmFwcGVuZFRvKHMuby5hcHBlbmRUbyk7CgoJCQlzLmQud3JhcCA9ICQoJzxkaXY+PC9kaXY+JykKCQkJCS5hdHRyKCd0YWJJbmRleCcsIC0xKQoJCQkJLmFkZENsYXNzKCdzaW1wbGVtb2RhbC13cmFwJykKCQkJCS5jc3Moe2hlaWdodDogJzEwMCUnLCBvdXRsaW5lOiAwLCB3aWR0aDogJzEwMCUnfSkKCQkJCS5hcHBlbmRUbyhzLmQuY29udGFpbmVyKTsKCgkJCS8vIGFkZCBzdHlsaW5nIGFuZCBhdHRyaWJ1dGVzIHRvIHRoZSBkYXRhCgkJCS8vIGFwcGVuZCB0byBib2R5IHRvIGdldCBjb3JyZWN0IGRpbWVuc2lvbnMsIHRoZW4gbW92ZSB0byB3cmFwCgkJCXMuZC5kYXRhID0gZGF0YQoJCQkJLmF0dHIoJ2lkJywgZGF0YS5hdHRyKCdpZCcpIHx8IHMuby5kYXRhSWQpCgkJCQkuYWRkQ2xhc3MoJ3NpbXBsZW1vZGFsLWRhdGEnKQoJCQkJLmNzcygkLmV4dGVuZChzLm8uZGF0YUNzcywgewoJCQkJCQlkaXNwbGF5OiAnbm9uZScKCQkJCX0pKQoJCQkJLmFwcGVuZFRvKCdib2R5Jyk7CgkJCWRhdGEgPSBudWxsOwoKCQkJcy5zZXRDb250YWluZXJEaW1lbnNpb25zKCk7CgkJCXMuZC5kYXRhLmFwcGVuZFRvKHMuZC53cmFwKTsKCgkJCS8vIGZpeCBpc3N1ZXMgd2l0aCBJRQoJCQlpZiAoaWU2IHx8IGllUXVpcmtzKSB7CgkJCQlzLmZpeElFKCk7CgkJCX0KCQl9LAoJCS8qCgkJICogQmluZCBldmVudHMKCQkgKi8KCQliaW5kRXZlbnRzOiBmdW5jdGlvbiAoKSB7CgkJCXZhciBzID0gdGhpczsKCgkJCS8vIGJpbmQgdGhlIGNsb3NlIGV2ZW50IHRvIGFueSBlbGVtZW50IHdpdGggdGhlIGNsb3NlQ2xhc3MgY2xhc3MKCQkJJCgnLicgKyBzLm8uY2xvc2VDbGFzcykuYmluZCgnY2xpY2suc2ltcGxlbW9kYWwnLCBmdW5jdGlvbiAoZSkgewoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJcy5jbG9zZSgpOwoJCQl9KTsKCgkJCS8vIGJpbmQgdGhlIG92ZXJsYXkgY2xpY2sgdG8gdGhlIGNsb3NlIGZ1bmN0aW9uLCBpZiBlbmFibGVkCgkJCWlmIChzLm8ubW9kYWwgJiYgcy5vLmNsb3NlICYmIHMuby5vdmVybGF5Q2xvc2UpIHsKCQkJCXMuZC5vdmVybGF5LmJpbmQoJ2NsaWNrLnNpbXBsZW1vZGFsJywgZnVuY3Rpb24gKGUpIHsKCQkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQkJcy5jbG9zZSgpOwoJCQkJfSk7CgkJCX0KCgkJCS8vIGJpbmQga2V5ZG93biBldmVudHMKCQkJJChkb2N1bWVudCkuYmluZCgna2V5ZG93bi5zaW1wbGVtb2RhbCcsIGZ1bmN0aW9uIChlKSB7CgkJCQlpZiAocy5vLm1vZGFsICYmIGUua2V5Q29kZSA9PT0gOSkgeyAvLyBUQUIKCQkJCQlzLndhdGNoVGFiKGUpOwoJCQkJfQoJCQkJZWxzZSBpZiAoKHMuby5jbG9zZSAmJiBzLm8uZXNjQ2xvc2UpICYmIGUua2V5Q29kZSA9PT0gMjcpIHsgLy8gRVNDCgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCXMuY2xvc2UoKTsKCQkJCX0KCQkJfSk7CgoJCQkvLyB1cGRhdGUgd2luZG93IHNpemUKCQkJJCh3aW5kb3cpLmJpbmQoJ3Jlc2l6ZS5zaW1wbGVtb2RhbCcsIGZ1bmN0aW9uICgpIHsKCQkJCS8vIHJlZGV0ZXJtaW5lIHRoZSB3aW5kb3cgd2lkdGgvaGVpZ2h0CgkJCQl3ID0gcy5nZXREaW1lbnNpb25zKCk7CgoJCQkJLy8gcmVwb3NpdGlvbiB0aGUgZGlhbG9nCgkJCQlzLm8uYXV0b1Jlc2l6ZSA/IHMuc2V0Q29udGFpbmVyRGltZW5zaW9ucygpIDogcy5vLmF1dG9Qb3NpdGlvbiAmJiBzLnNldFBvc2l0aW9uKCk7CgoJCQkJaWYgKGllNiB8fCBpZVF1aXJrcykgewoJCQkJCXMuZml4SUUoKTsKCQkJCX0KCQkJCWVsc2UgaWYgKHMuby5tb2RhbCkgewoJCQkJCS8vIHVwZGF0ZSB0aGUgaWZyYW1lICYgb3ZlcmxheQoJCQkJCXMuZC5pZnJhbWUgJiYgcy5kLmlmcmFtZS5jc3Moe2hlaWdodDogd1swXSwgd2lkdGg6IHdbMV19KTsKCQkJCQlzLmQub3ZlcmxheS5jc3Moe2hlaWdodDogd1swXSwgd2lkdGg6IHdbMV19KTsKCQkJCX0KCQkJfSk7CgkJfSwKCQkvKgoJCSAqIFVuYmluZCBldmVudHMKCQkgKi8KCQl1bmJpbmRFdmVudHM6IGZ1bmN0aW9uICgpIHsKCQkJJCgnLicgKyB0aGlzLm8uY2xvc2VDbGFzcykudW5iaW5kKCdjbGljay5zaW1wbGVtb2RhbCcpOwoJCQkkKGRvY3VtZW50KS51bmJpbmQoJ2tleWRvd24uc2ltcGxlbW9kYWwnKTsKCQkJJCh3aW5kb3cpLnVuYmluZCgncmVzaXplLnNpbXBsZW1vZGFsJyk7CgkJCXRoaXMuZC5vdmVybGF5LnVuYmluZCgnY2xpY2suc2ltcGxlbW9kYWwnKTsKCQl9LAoJCS8qCgkJICogRml4IGlzc3VlcyBpbiBJRTYgYW5kIElFNyBpbiBxdWlya3MgbW9kZQoJCSAqLwoJCWZpeElFOiBmdW5jdGlvbiAoKSB7CgkJCXZhciBzID0gdGhpcywgcCA9IHMuby5wb3NpdGlvbjsKCgkJCS8vIHNpbXVsYXRlIGZpeGVkIHBvc2l0aW9uIC0gYWRhcHRlZCBmcm9tIEJsb2NrVUkKCQkJJC5lYWNoKFtzLmQuaWZyYW1lIHx8IG51bGwsICFzLm8ubW9kYWwgPyBudWxsIDogcy5kLm92ZXJsYXksIHMuZC5jb250YWluZXJdLCBmdW5jdGlvbiAoaSwgZWwpIHsKCQkJCWlmIChlbCkgewoJCQkJCXZhciBiY2ggPSAnZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQnLCBiY3cgPSAnZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCcsCgkJCQkJCWJzaCA9ICdkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodCcsIGJzbCA9ICdkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQnLAoJCQkJCQlic3QgPSAnZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AnLCBic3cgPSAnZG9jdW1lbnQuYm9keS5zY3JvbGxXaWR0aCcsCgkJCQkJCWNoID0gJ2RvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQnLCBjdyA9ICdkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgnLAoJCQkJCQlzbCA9ICdkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCcsIHN0ID0gJ2RvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AnLAoJCQkJCQlzID0gZWxbMF0uc3R5bGU7CgoJCQkJCXMucG9zaXRpb24gPSAnYWJzb2x1dGUnOwoJCQkJCWlmIChpIDwgMikgewoJCQkJCQlzLnJlbW92ZUV4cHJlc3Npb24oJ2hlaWdodCcpOwoJCQkJCQlzLnJlbW92ZUV4cHJlc3Npb24oJ3dpZHRoJyk7CgkJCQkJCXMuc2V0RXhwcmVzc2lvbignaGVpZ2h0JywnJyArIGJzaCArICcgPiAnICsgYmNoICsgJyA/ICcgKyBic2ggKyAnIDogJyArIGJjaCArICcgKyAicHgiJyk7CgkJCQkJCXMuc2V0RXhwcmVzc2lvbignd2lkdGgnLCcnICsgYnN3ICsgJyA+ICcgKyBiY3cgKyAnID8gJyArIGJzdyArICcgOiAnICsgYmN3ICsgJyArICJweCInKTsKCQkJCQl9CgkJCQkJZWxzZSB7CgkJCQkJCXZhciB0ZSwgbGU7CgkJCQkJCWlmIChwICYmIHAuY29uc3RydWN0b3IgPT09IEFycmF5KSB7CgkJCQkJCQl2YXIgdG9wID0gcFswXQoJCQkJCQkJCT8gdHlwZW9mIHBbMF0gPT09ICdudW1iZXInID8gcFswXS50b1N0cmluZygpIDogcFswXS5yZXBsYWNlKC9weC8sICcnKQoJCQkJCQkJCTogZWwuY3NzKCd0b3AnKS5yZXBsYWNlKC9weC8sICcnKTsKCQkJCQkJCXRlID0gdG9wLmluZGV4T2YoJyUnKSA9PT0gLTEKCQkJCQkJCQk/IHRvcCArICcgKyAodCA9ICcgKyBzdCArICcgPyAnICsgc3QgKyAnIDogJyArIGJzdCArICcpICsgInB4IicKCQkJCQkJCQk6IHBhcnNlSW50KHRvcC5yZXBsYWNlKC8lLywgJycpKSArICcgKiAoKCcgKyBjaCArICcgfHwgJyArIGJjaCArICcpIC8gMTAwKSArICh0ID0gJyArIHN0ICsgJyA/ICcgKyBzdCArICcgOiAnICsgYnN0ICsgJykgKyAicHgiJzsKCgkJCQkJCQlpZiAocFsxXSkgewoJCQkJCQkJCXZhciBsZWZ0ID0gdHlwZW9mIHBbMV0gPT09ICdudW1iZXInID8gcFsxXS50b1N0cmluZygpIDogcFsxXS5yZXBsYWNlKC9weC8sICcnKTsKCQkJCQkJCQlsZSA9IGxlZnQuaW5kZXhPZignJScpID09PSAtMQoJCQkJCQkJCQk/IGxlZnQgKyAnICsgKHQgPSAnICsgc2wgKyAnID8gJyArIHNsICsgJyA6ICcgKyBic2wgKyAnKSArICJweCInCgkJCQkJCQkJCTogcGFyc2VJbnQobGVmdC5yZXBsYWNlKC8lLywgJycpKSArICcgKiAoKCcgKyBjdyArICcgfHwgJyArIGJjdyArICcpIC8gMTAwKSArICh0ID0gJyArIHNsICsgJyA/ICcgKyBzbCArICcgOiAnICsgYnNsICsgJykgKyAicHgiJzsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQllbHNlIHsKCQkJCQkJCXRlID0gJygnICsgY2ggKyAnIHx8ICcgKyBiY2ggKyAnKSAvIDIgLSAodGhpcy5vZmZzZXRIZWlnaHQgLyAyKSArICh0ID0gJyArIHN0ICsgJyA/ICcgKyBzdCArICcgOiAnICsgYnN0ICsgJykgKyAicHgiJzsKCQkJCQkJCWxlID0gJygnICsgY3cgKyAnIHx8ICcgKyBiY3cgKyAnKSAvIDIgLSAodGhpcy5vZmZzZXRXaWR0aCAvIDIpICsgKHQgPSAnICsgc2wgKyAnID8gJyArIHNsICsgJyA6ICcgKyBic2wgKyAnKSArICJweCInOwoJCQkJCQl9CgkJCQkJCXMucmVtb3ZlRXhwcmVzc2lvbigndG9wJyk7CgkJCQkJCXMucmVtb3ZlRXhwcmVzc2lvbignbGVmdCcpOwoJCQkJCQlzLnNldEV4cHJlc3Npb24oJ3RvcCcsIHRlKTsKCQkJCQkJcy5zZXRFeHByZXNzaW9uKCdsZWZ0JywgbGUpOwoJCQkJCX0KCQkJCX0KCQkJfSk7CgkJfSwKCQkvKgoJCSAqIFBsYWNlIGZvY3VzIG9uIHRoZSBmaXJzdCBvciBsYXN0IHZpc2libGUgaW5wdXQKCQkgKi8KCQlmb2N1czogZnVuY3Rpb24gKHBvcykgewoJCQl2YXIgcyA9IHRoaXMsIHAgPSBwb3MgJiYgJC5pbkFycmF5KHBvcywgWydmaXJzdCcsICdsYXN0J10pICE9PSAtMSA/IHBvcyA6ICdmaXJzdCc7CgoJCQkvLyBmb2N1cyBvbiBkaWFsb2cgb3IgdGhlIGZpcnN0IHZpc2libGUvZW5hYmxlZCBpbnB1dCBlbGVtZW50CgkJCXZhciBpbnB1dCA9ICQoJzppbnB1dDplbmFibGVkOnZpc2libGU6JyArIHAsIHMuZC53cmFwKTsKCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCQlpbnB1dC5sZW5ndGggPiAwID8gaW5wdXQuZm9jdXMoKSA6IHMuZC53cmFwLmZvY3VzKCk7CgkJCX0sIDApOwoJCX0sCgkJZ2V0RGltZW5zaW9uczogZnVuY3Rpb24gKCkgewoJCQl2YXIgZWwgPSAkKHdpbmRvdyk7CgoJCQkvLyBmaXggYSBqUXVlcnkvT3BlcmEgYnVnIHdpdGggZGV0ZXJtaW5pbmcgdGhlIHdpbmRvdyBoZWlnaHQKCQkJdmFyIGggPSAkLmJyb3dzZXIub3BlcmEgJiYgJC5icm93c2VyLnZlcnNpb24gPiAnOS41JyAmJiAkLmZuLmpxdWVyeSA8ICcxLjMnCgkJCQkJCXx8ICQuYnJvd3Nlci5vcGVyYSAmJiAkLmJyb3dzZXIudmVyc2lvbiA8ICc5LjUnICYmICQuZm4uanF1ZXJ5ID4gJzEuMi42JwoJCQkJPyBlbFswXS5pbm5lckhlaWdodCA6IGVsLmhlaWdodCgpOwoKCQkJcmV0dXJuIFtoLCBlbC53aWR0aCgpXTsKCQl9LAoJCWdldFZhbDogZnVuY3Rpb24gKHYsIGQpIHsKCQkJcmV0dXJuIHYgPyAodHlwZW9mIHYgPT09ICdudW1iZXInID8gdgoJCQkJCTogdiA9PT0gJ2F1dG8nID8gMAoJCQkJCTogdi5pbmRleE9mKCclJykgPiAwID8gKChwYXJzZUludCh2LnJlcGxhY2UoLyUvLCAnJykpIC8gMTAwKSAqIChkID09PSAnaCcgPyB3WzBdIDogd1sxXSkpCgkJCQkJOiBwYXJzZUludCh2LnJlcGxhY2UoL3B4LywgJycpKSkKCQkJCTogbnVsbDsKCQl9LAoJCS8qCgkJICogVXBkYXRlIHRoZSBjb250YWluZXIuIFNldCBuZXcgZGltZW5zaW9ucywgaWYgcHJvdmlkZWQuCgkJICogRm9jdXMsIGlmIGVuYWJsZWQuIFJlLWJpbmQgZXZlbnRzLgoJCSAqLwoJCXVwZGF0ZTogZnVuY3Rpb24gKGhlaWdodCwgd2lkdGgpIHsKCQkJdmFyIHMgPSB0aGlzOwoKCQkJLy8gcHJldmVudCB1cGRhdGUgaWYgZGlhbG9nIGRvZXMgbm90IGV4aXN0CgkJCWlmICghcy5kLmRhdGEpIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJLy8gcmVzZXQgb3JpZyB2YWx1ZXMKCQkJcy5kLm9yaWdIZWlnaHQgPSBzLmdldFZhbChoZWlnaHQsICdoJyk7CgkJCXMuZC5vcmlnV2lkdGggPSBzLmdldFZhbCh3aWR0aCwgJ3cnKTsKCgkJCS8vIGhpZGUgZGF0YSB0byBwcmV2ZW50IHNjcmVlbiBmbGlja2VyCgkJCXMuZC5kYXRhLmhpZGUoKTsKCQkJaGVpZ2h0ICYmIHMuZC5jb250YWluZXIuY3NzKCdoZWlnaHQnLCBoZWlnaHQpOwoJCQl3aWR0aCAmJiBzLmQuY29udGFpbmVyLmNzcygnd2lkdGgnLCB3aWR0aCk7CgkJCXMuc2V0Q29udGFpbmVyRGltZW5zaW9ucygpOwoJCQlzLmQuZGF0YS5zaG93KCk7CgkJCXMuby5mb2N1cyAmJiBzLmZvY3VzKCk7CgoJCQkvLyByZWJpbmQgZXZlbnRzCgkJCXMudW5iaW5kRXZlbnRzKCk7CgkJCXMuYmluZEV2ZW50cygpOwoJCX0sCgkJc2V0Q29udGFpbmVyRGltZW5zaW9uczogZnVuY3Rpb24gKCkgewoJCQl2YXIgcyA9IHRoaXMsCgkJCQliYWRJRSA9IGllNiB8fCBpZTc7CgoJCQkvLyBnZXQgdGhlIGRpbWVuc2lvbnMgZm9yIHRoZSBjb250YWluZXIgYW5kIGRhdGEKCQkJdmFyIGNoID0gcy5kLm9yaWdIZWlnaHQgPyBzLmQub3JpZ0hlaWdodCA6ICQuYnJvd3Nlci5vcGVyYSA/IHMuZC5jb250YWluZXIuaGVpZ2h0KCkgOiBzLmdldFZhbChiYWRJRSA/IHMuZC5jb250YWluZXJbMF0uY3VycmVudFN0eWxlWydoZWlnaHQnXSA6IHMuZC5jb250YWluZXIuY3NzKCdoZWlnaHQnKSwgJ2gnKSwKCQkJCWN3ID0gcy5kLm9yaWdXaWR0aCA/IHMuZC5vcmlnV2lkdGggOiAkLmJyb3dzZXIub3BlcmEgPyBzLmQuY29udGFpbmVyLndpZHRoKCkgOiBzLmdldFZhbChiYWRJRSA/IHMuZC5jb250YWluZXJbMF0uY3VycmVudFN0eWxlWyd3aWR0aCddIDogcy5kLmNvbnRhaW5lci5jc3MoJ3dpZHRoJyksICd3JyksCgkJCQlkaCA9IHMuZC5kYXRhLm91dGVySGVpZ2h0KHRydWUpLCBkdyA9IHMuZC5kYXRhLm91dGVyV2lkdGgodHJ1ZSk7CgoJCQlzLmQub3JpZ0hlaWdodCA9IHMuZC5vcmlnSGVpZ2h0IHx8IGNoOwoJCQlzLmQub3JpZ1dpZHRoID0gcy5kLm9yaWdXaWR0aCB8fCBjdzsKCgkJCS8vIG14b2ggPSBtYXggb3B0aW9uIGhlaWdodCwgbXhvdyA9IG1heCBvcHRpb24gd2lkdGgKCQkJdmFyIG14b2ggPSBzLm8ubWF4SGVpZ2h0ID8gcy5nZXRWYWwocy5vLm1heEhlaWdodCwgJ2gnKSA6IG51bGwsCgkJCQlteG93ID0gcy5vLm1heFdpZHRoID8gcy5nZXRWYWwocy5vLm1heFdpZHRoLCAndycpIDogbnVsbCwKCQkJCW1oID0gbXhvaCAmJiBteG9oIDwgd1swXSA/IG14b2ggOiB3WzBdLAoJCQkJbXcgPSBteG93ICYmIG14b3cgPCB3WzFdID8gbXhvdyA6IHdbMV07CgoJCQkvLyBtb2ggPSBtaW4gb3B0aW9uIGhlaWdodAoJCQl2YXIgbW9oID0gcy5vLm1pbkhlaWdodCA/IHMuZ2V0VmFsKHMuby5taW5IZWlnaHQsICdoJykgOiAnYXV0byc7CgkJCWlmICghY2gpIHsKCQkJCWlmICghZGgpIHtjaCA9IG1vaDt9CgkJCQllbHNlIHsKCQkJCQlpZiAoZGggPiBtaCkge2NoID0gbWg7fQoJCQkJCWVsc2UgaWYgKHMuby5taW5IZWlnaHQgJiYgbW9oICE9PSAnYXV0bycgJiYgZGggPCBtb2gpIHtjaCA9IG1vaDt9CgkJCQkJZWxzZSB7Y2ggPSBkaDt9CgkJCQl9CgkJCX0KCQkJZWxzZSB7CgkJCQljaCA9IHMuby5hdXRvUmVzaXplICYmIGNoID4gbWggPyBtaCA6IGNoIDwgbW9oID8gbW9oIDogY2g7CgkJCX0KCgkJCS8vIG1vdyA9IG1pbiBvcHRpb24gd2lkdGgKCQkJdmFyIG1vdyA9IHMuby5taW5XaWR0aCA/IHMuZ2V0VmFsKHMuby5taW5XaWR0aCwgJ3cnKSA6ICdhdXRvJzsKCQkJaWYgKCFjdykgewoJCQkJaWYgKCFkdykge2N3ID0gbW93O30KCQkJCWVsc2UgewoJCQkJCWlmIChkdyA+IG13KSB7Y3cgPSBtdzt9CgkJCQkJZWxzZSBpZiAocy5vLm1pbldpZHRoICYmIG1vdyAhPT0gJ2F1dG8nICYmIGR3IDwgbW93KSB7Y3cgPSBtb3c7fQoJCQkJCWVsc2Uge2N3ID0gZHc7fQoJCQkJfQoJCQl9CgkJCWVsc2UgewoJCQkJY3cgPSBzLm8uYXV0b1Jlc2l6ZSAmJiBjdyA+IG13ID8gbXcgOiBjdyA8IG1vdyA/IG1vdyA6IGN3OwoJCQl9CgoJCQlzLmQuY29udGFpbmVyLmNzcyh7aGVpZ2h0OiBjaCwgd2lkdGg6IGN3fSk7CgkJCXMuZC53cmFwLmNzcyh7b3ZlcmZsb3c6IChkaCA+IGNoIHx8IGR3ID4gY3cpID8gJ2F1dG8nIDogJ3Zpc2libGUnfSk7CgkJCXMuby5hdXRvUG9zaXRpb24gJiYgcy5zZXRQb3NpdGlvbigpOwoJCX0sCgkJc2V0UG9zaXRpb246IGZ1bmN0aW9uICgpIHsKCQkJdmFyIHMgPSB0aGlzLCB0b3AsIGxlZnQsCgkJCQloYyA9ICh3WzBdLzIpIC0gKHMuZC5jb250YWluZXIub3V0ZXJIZWlnaHQodHJ1ZSkvMiksCgkJCQl2YyA9ICh3WzFdLzIpIC0gKHMuZC5jb250YWluZXIub3V0ZXJXaWR0aCh0cnVlKS8yKTsKCgkJCWlmIChzLm8ucG9zaXRpb24gJiYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHMuby5wb3NpdGlvbikgPT09ICdbb2JqZWN0IEFycmF5XScpIHsKCQkJCXRvcCA9IHMuby5wb3NpdGlvblswXSB8fCBoYzsKCQkJCWxlZnQgPSBzLm8ucG9zaXRpb25bMV0gfHwgdmM7CgkJCX0gZWxzZSB7CgkJCQl0b3AgPSBoYzsKCQkJCWxlZnQgPSB2YzsKCQkJfQoJCQlzLmQuY29udGFpbmVyLmNzcyh7bGVmdDogbGVmdCwgdG9wOiB0b3B9KTsKCQl9LAoJCXdhdGNoVGFiOiBmdW5jdGlvbiAoZSkgewoJCQl2YXIgcyA9IHRoaXM7CgoJCQlpZiAoJChlLnRhcmdldCkucGFyZW50cygnLnNpbXBsZW1vZGFsLWNvbnRhaW5lcicpLmxlbmd0aCA+IDApIHsKCQkJCS8vIHNhdmUgdGhlIGxpc3Qgb2YgaW5wdXRzCgkJCQlzLmlucHV0cyA9ICQoJzppbnB1dDplbmFibGVkOnZpc2libGU6Zmlyc3QsIDppbnB1dDplbmFibGVkOnZpc2libGU6bGFzdCcsIHMuZC5kYXRhWzBdKTsKCgkJCQkvLyBpZiBpdCdzIHRoZSBmaXJzdCBvciBsYXN0IHRhYmJhYmxlIGVsZW1lbnQsIHJlZm9jdXMKCQkJCWlmICgoIWUuc2hpZnRLZXkgJiYgZS50YXJnZXQgPT09IHMuaW5wdXRzW3MuaW5wdXRzLmxlbmd0aCAtMV0pIHx8CgkJCQkJCShlLnNoaWZ0S2V5ICYmIGUudGFyZ2V0ID09PSBzLmlucHV0c1swXSkgfHwKCQkJCQkJcy5pbnB1dHMubGVuZ3RoID09PSAwKSB7CgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCXZhciBwb3MgPSBlLnNoaWZ0S2V5ID8gJ2xhc3QnIDogJ2ZpcnN0JzsKCQkJCQlzLmZvY3VzKHBvcyk7CgkJCQl9CgkJCX0KCQkJZWxzZSB7CgkJCQkvLyBtaWdodCBiZSBuZWNlc3Nhcnkgd2hlbiBjdXN0b20gb25TaG93IGNhbGxiYWNrIGlzIHVzZWQKCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCXMuZm9jdXMoKTsKCQkJfQoJCX0sCgkJLyoKCQkgKiBPcGVuIHRoZSBtb2RhbCBkaWFsb2cgZWxlbWVudHMKCQkgKiAtIE5vdGU6IElmIHlvdSB1c2UgdGhlIG9uT3BlbiBjYWxsYmFjaywgeW91IG11c3QgInNob3ciIHRoZQoJCSAqCSAgICAgICAgb3ZlcmxheSBhbmQgY29udGFpbmVyIGVsZW1lbnRzIG1hbnVhbGx5CgkJICogICAgICAgICAodGhlIGlmcmFtZSB3aWxsIGJlIGhhbmRsZWQgYnkgU2ltcGxlTW9kYWwpCgkJICovCgkJb3BlbjogZnVuY3Rpb24gKCkgewoJCQl2YXIgcyA9IHRoaXM7CgkJCS8vIGRpc3BsYXkgdGhlIGlmcmFtZQoJCQlzLmQuaWZyYW1lICYmIHMuZC5pZnJhbWUuc2hvdygpOwoKCQkJaWYgKCQuaXNGdW5jdGlvbihzLm8ub25PcGVuKSkgewoJCQkJLy8gZXhlY3V0ZSB0aGUgb25PcGVuIGNhbGxiYWNrCgkJCQlzLm8ub25PcGVuLmFwcGx5KHMsIFtzLmRdKTsKCQkJfQoJCQllbHNlIHsKCQkJCS8vIGRpc3BsYXkgdGhlIHJlbWFpbmluZyBlbGVtZW50cwoJCQkJcy5kLm92ZXJsYXkuc2hvdygpOwoJCQkJcy5kLmNvbnRhaW5lci5zaG93KCk7CgkJCQlzLmQuZGF0YS5zaG93KCk7CgkJCX0KCgkJCXMuby5mb2N1cyAmJiBzLmZvY3VzKCk7CgoJCQkvLyBiaW5kIGRlZmF1bHQgZXZlbnRzCgkJCXMuYmluZEV2ZW50cygpOwoJCX0sCgkJLyoKCQkgKiBDbG9zZSB0aGUgbW9kYWwgZGlhbG9nCgkJICogLSBOb3RlOiBJZiB5b3UgdXNlIGFuIG9uQ2xvc2UgY2FsbGJhY2ssIHlvdSBtdXN0IHJlbW92ZSB0aGUKCQkgKiAgICAgICAgIG92ZXJsYXksIGNvbnRhaW5lciBhbmQgaWZyYW1lIGVsZW1lbnRzIG1hbnVhbGx5CgkJICoKCQkgKiBAcGFyYW0ge2Jvb2xlYW59IGV4dGVybmFsIEluZGljYXRlcyB3aGV0aGVyIHRoZSBjYWxsIHRvIHRoaXMKCQkgKiAgICAgZnVuY3Rpb24gd2FzIGludGVybmFsIG9yIGV4dGVybmFsLiBJZiBpdCB3YXMgZXh0ZXJuYWwsIHRoZQoJCSAqICAgICBvbkNsb3NlIGNhbGxiYWNrIHdpbGwgYmUgaWdub3JlZAoJCSAqLwoJCWNsb3NlOiBmdW5jdGlvbiAoKSB7CgkJCXZhciBzID0gdGhpczsKCgkJCS8vIHByZXZlbnQgY2xvc2Ugd2hlbiBkaWFsb2cgZG9lcyBub3QgZXhpc3QKCQkJaWYgKCFzLmQuZGF0YSkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgoJCQkvLyByZW1vdmUgdGhlIGRlZmF1bHQgZXZlbnRzCgkJCXMudW5iaW5kRXZlbnRzKCk7CgoJCQlpZiAoJC5pc0Z1bmN0aW9uKHMuby5vbkNsb3NlKSAmJiAhcy5vY2NiKSB7CgkJCQkvLyBzZXQgdGhlIG9uQ2xvc2UgY2FsbGJhY2sgZmxhZwoJCQkJcy5vY2NiID0gdHJ1ZTsKCgkJCQkvLyBleGVjdXRlIHRoZSBvbkNsb3NlIGNhbGxiYWNrCgkJCQlzLm8ub25DbG9zZS5hcHBseShzLCBbcy5kXSk7CgkJCX0KCQkJZWxzZSB7CgkJCQkvLyBpZiB0aGUgZGF0YSBjYW1lIGZyb20gdGhlIERPTSwgcHV0IGl0IGJhY2sKCQkJCWlmIChzLmQucGxhY2Vob2xkZXIpIHsKCQkJCQl2YXIgcGggPSAkKCcjc2ltcGxlbW9kYWwtcGxhY2Vob2xkZXInKTsKCQkJCQkvLyBzYXZlIGNoYW5nZXMgdG8gdGhlIGRhdGE/CgkJCQkJaWYgKHMuby5wZXJzaXN0KSB7CgkJCQkJCS8vIGluc2VydCB0aGUgKHBvc3NpYmx5KSBtb2RpZmllZCBkYXRhIGJhY2sgaW50byB0aGUgRE9NCgkJCQkJCXBoLnJlcGxhY2VXaXRoKHMuZC5kYXRhLnJlbW92ZUNsYXNzKCdzaW1wbGVtb2RhbC1kYXRhJykuY3NzKCdkaXNwbGF5Jywgcy5kaXNwbGF5KSk7CgkJCQkJfQoJCQkJCWVsc2UgewoJCQkJCQkvLyByZW1vdmUgdGhlIGN1cnJlbnQgYW5kIGluc2VydCB0aGUgb3JpZ2luYWwsCgkJCQkJCS8vIHVubW9kaWZpZWQgZGF0YSBiYWNrIGludG8gdGhlIERPTQoJCQkJCQlzLmQuZGF0YS5oaWRlKCkucmVtb3ZlKCk7CgkJCQkJCXBoLnJlcGxhY2VXaXRoKHMuZC5vcmlnKTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlIHsKCQkJCQkvLyBvdGhlcndpc2UsIHJlbW92ZSBpdAoJCQkJCXMuZC5kYXRhLmhpZGUoKS5yZW1vdmUoKTsKCQkJCX0KCgkJCQkvLyByZW1vdmUgdGhlIHJlbWFpbmluZyBlbGVtZW50cwoJCQkJcy5kLmNvbnRhaW5lci5oaWRlKCkucmVtb3ZlKCk7CgkJCQlzLmQub3ZlcmxheS5oaWRlKCk7CgkJCQlzLmQuaWZyYW1lICYmIHMuZC5pZnJhbWUuaGlkZSgpLnJlbW92ZSgpOwoJCQkJc2V0VGltZW91dChmdW5jdGlvbigpewoJCQkJCS8vIG9wZXJhIHdvcmstYXJvdW5kCgkJCQkJcy5kLm92ZXJsYXkucmVtb3ZlKCk7CgoJCQkJCS8vIHJlc2V0IHRoZSBkaWFsb2cgb2JqZWN0CgkJCQkJcy5kID0ge307CgkJCQl9LCAwKTsKCQkJfQoJCX0KCX07Cn0pKGpRdWVyeSk7"
        },
        "static/js/jquery.sortlist.js": {
            "content_type": "application/javascript",
            "data": "LyoqCiAqIGFkYXB0ZWQgYnkgU3RlcGhlbiBBLiBCdXR0ZXJmaWxsCiAqIHNlZSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzExMzQ5NzYvaG93LW1heS1pLXNvcnQtYS1saXN0LWFscGhhYmV0aWNhbGx5LXVzaW5nLWpxdWVyeQogKi8KKGZ1bmN0aW9uKCQpIHsKCiAgICAkLmZuLnNvcnRsaXN0ID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgIHRoaXMuZmlsdGVyKCd1bCxvbCcpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciAkbGlzdCA9ICQodGhpcyk7CiAgICAgICAgICAgIHZhciAkaXRlbXMgPSAkbGlzdC5jaGlsZHJlbignbGknKQogICAgICAgICAgICB2YXIgaXRlbXMgPSAkaXRlbXMuZ2V0KCk7ICAvL3BsYWluIGFycmF5CiAgICAgICAgICAgIGl0ZW1zLnNvcnQoIGZ1bmN0aW9uKGEsYikgewogICAgICAgICAgICAgICAgdmFyIGNvbXBBID0gJC50cmltKCQoYSkudGV4dCgpLnRvVXBwZXJDYXNlKCkpOwogICAgICAgICAgICAgICAgdmFyIGNvbXBCID0gJC50cmltKCQoYikudGV4dCgpLnRvVXBwZXJDYXNlKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIChjb21wQSA8IGNvbXBCKSA/IC0xIDogKGNvbXBBID4gY29tcEIpID8gMSA6IDA7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkLmVhY2goaXRlbXMsIGZ1bmN0aW9uKGlkeCwgaXRlbSkgewogICAgICAgICAgICAgICAgLy92YXIgJGl0ZW0gPSAkKGl0ZW0pOwogICAgICAgICAgICAgICAgLy8kaXRlbS5oaWRlKDIwMCwgZnVuY3Rpb24oKXsgJGxpc3QuYXBwZW5kKCRpdGVtKTsgJGl0ZW0uc2hvdygyMDApOyB9KTsKICAgICAgICAgICAgICAgICRsaXN0LmFwcGVuZChpdGVtKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9Cn0pKGpRdWVyeSk7"
        },
        "static/js/jquery.timeago.js": {
            "content_type": "application/javascript",
            "data": "LyoKICogdGltZWFnbzogYSBqUXVlcnkgcGx1Z2luLCB2ZXJzaW9uOiAwLjkuMyAoMjAxMS0wMS0yMSkKICogQHJlcXVpcmVzIGpRdWVyeSB2MS4yLjMgb3IgbGF0ZXIKICoKICogVGltZWFnbyBpcyBhIGpRdWVyeSBwbHVnaW4gdGhhdCBtYWtlcyBpdCBlYXN5IHRvIHN1cHBvcnQgYXV0b21hdGljYWxseQogKiB1cGRhdGluZyBmdXp6eSB0aW1lc3RhbXBzIChlLmcuICI0IG1pbnV0ZXMgYWdvIiBvciAiYWJvdXQgMSBkYXkgYWdvIikuCiAqCiAqIEZvciB1c2FnZSBhbmQgZXhhbXBsZXMsIHZpc2l0OgogKiBodHRwOi8vdGltZWFnby55YXJwLmNvbS8KICoKICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVDoKICogaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHAKICoKICogQ29weXJpZ2h0IChjKSAyMDA4LTIwMTEsIFJ5YW4gTWNHZWFyeSAocnlhbm9uamF2YXNjcmlwdCAtW2F0XS0gbWNnZWFyeSBbKmRvdCpdIG9yZykKICovCihmdW5jdGlvbigkKSB7CiAgJC50aW1lYWdvID0gZnVuY3Rpb24odGltZXN0YW1wKSB7CiAgICBpZiAodGltZXN0YW1wIGluc3RhbmNlb2YgRGF0ZSkgewogICAgICByZXR1cm4gaW5Xb3Jkcyh0aW1lc3RhbXApOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdGltZXN0YW1wID09PSAic3RyaW5nIikgewogICAgICByZXR1cm4gaW5Xb3JkcygkLnRpbWVhZ28ucGFyc2UodGltZXN0YW1wKSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gaW5Xb3JkcygkLnRpbWVhZ28uZGF0ZXRpbWUodGltZXN0YW1wKSk7CiAgICB9CiAgfTsKICB2YXIgJHQgPSAkLnRpbWVhZ287CgogICQuZXh0ZW5kKCQudGltZWFnbywgewogICAgc2V0dGluZ3M6IHsKICAgICAgcmVmcmVzaE1pbGxpczogNjAwMDAsCiAgICAgIGFsbG93RnV0dXJlOiBmYWxzZSwKICAgICAgc3RyaW5nczogewogICAgICAgIHByZWZpeEFnbzogbnVsbCwKICAgICAgICBwcmVmaXhGcm9tTm93OiBudWxsLAogICAgICAgIHN1ZmZpeEFnbzogImFnbyIsCiAgICAgICAgc3VmZml4RnJvbU5vdzogImZyb20gbm93IiwKICAgICAgICBzZWNvbmRzOiAibGVzcyB0aGFuIGEgbWludXRlIiwKICAgICAgICBtaW51dGU6ICJhYm91dCBhIG1pbnV0ZSIsCiAgICAgICAgbWludXRlczogIiVkIG1pbnV0ZXMiLAogICAgICAgIGhvdXI6ICJhYm91dCBhbiBob3VyIiwKICAgICAgICBob3VyczogImFib3V0ICVkIGhvdXJzIiwKICAgICAgICBkYXk6ICJhIGRheSIsCiAgICAgICAgZGF5czogIiVkIGRheXMiLAogICAgICAgIG1vbnRoOiAiYWJvdXQgYSBtb250aCIsCiAgICAgICAgbW9udGhzOiAiJWQgbW9udGhzIiwKICAgICAgICB5ZWFyOiAiYWJvdXQgYSB5ZWFyIiwKICAgICAgICB5ZWFyczogIiVkIHllYXJzIiwKICAgICAgICBudW1iZXJzOiBbXQogICAgICB9CiAgICB9LAogICAgaW5Xb3JkczogZnVuY3Rpb24oZGlzdGFuY2VNaWxsaXMpIHsKICAgICAgdmFyICRsID0gdGhpcy5zZXR0aW5ncy5zdHJpbmdzOwogICAgICB2YXIgcHJlZml4ID0gJGwucHJlZml4QWdvOwogICAgICB2YXIgc3VmZml4ID0gJGwuc3VmZml4QWdvOwogICAgICBpZiAodGhpcy5zZXR0aW5ncy5hbGxvd0Z1dHVyZSkgewogICAgICAgIGlmIChkaXN0YW5jZU1pbGxpcyA8IDApIHsKICAgICAgICAgIHByZWZpeCA9ICRsLnByZWZpeEZyb21Ob3c7CiAgICAgICAgICBzdWZmaXggPSAkbC5zdWZmaXhGcm9tTm93OwogICAgICAgIH0KICAgICAgICBkaXN0YW5jZU1pbGxpcyA9IE1hdGguYWJzKGRpc3RhbmNlTWlsbGlzKTsKICAgICAgfQoKICAgICAgdmFyIHNlY29uZHMgPSBkaXN0YW5jZU1pbGxpcyAvIDEwMDA7CiAgICAgIHZhciBtaW51dGVzID0gc2Vjb25kcyAvIDYwOwogICAgICB2YXIgaG91cnMgPSBtaW51dGVzIC8gNjA7CiAgICAgIHZhciBkYXlzID0gaG91cnMgLyAyNDsKICAgICAgdmFyIHllYXJzID0gZGF5cyAvIDM2NTsKCiAgICAgIGZ1bmN0aW9uIHN1YnN0aXR1dGUoc3RyaW5nT3JGdW5jdGlvbiwgbnVtYmVyKSB7CiAgICAgICAgdmFyIHN0cmluZyA9ICQuaXNGdW5jdGlvbihzdHJpbmdPckZ1bmN0aW9uKSA/IHN0cmluZ09yRnVuY3Rpb24obnVtYmVyLCBkaXN0YW5jZU1pbGxpcykgOiBzdHJpbmdPckZ1bmN0aW9uOwogICAgICAgIHZhciB2YWx1ZSA9ICgkbC5udW1iZXJzICYmICRsLm51bWJlcnNbbnVtYmVyXSkgfHwgbnVtYmVyOwogICAgICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgvJWQvaSwgdmFsdWUpOwogICAgICB9CgogICAgICB2YXIgd29yZHMgPSBzZWNvbmRzIDwgNDUgJiYgc3Vic3RpdHV0ZSgkbC5zZWNvbmRzLCBNYXRoLnJvdW5kKHNlY29uZHMpKSB8fAogICAgICAgIHNlY29uZHMgPCA5MCAmJiBzdWJzdGl0dXRlKCRsLm1pbnV0ZSwgMSkgfHwKICAgICAgICBtaW51dGVzIDwgNDUgJiYgc3Vic3RpdHV0ZSgkbC5taW51dGVzLCBNYXRoLnJvdW5kKG1pbnV0ZXMpKSB8fAogICAgICAgIG1pbnV0ZXMgPCA5MCAmJiBzdWJzdGl0dXRlKCRsLmhvdXIsIDEpIHx8CiAgICAgICAgaG91cnMgPCAyNCAmJiBzdWJzdGl0dXRlKCRsLmhvdXJzLCBNYXRoLnJvdW5kKGhvdXJzKSkgfHwKICAgICAgICBob3VycyA8IDQ4ICYmIHN1YnN0aXR1dGUoJGwuZGF5LCAxKSB8fAogICAgICAgIGRheXMgPCAzMCAmJiBzdWJzdGl0dXRlKCRsLmRheXMsIE1hdGguZmxvb3IoZGF5cykpIHx8CiAgICAgICAgZGF5cyA8IDYwICYmIHN1YnN0aXR1dGUoJGwubW9udGgsIDEpIHx8CiAgICAgICAgZGF5cyA8IDM2NSAmJiBzdWJzdGl0dXRlKCRsLm1vbnRocywgTWF0aC5mbG9vcihkYXlzIC8gMzApKSB8fAogICAgICAgIHllYXJzIDwgMiAmJiBzdWJzdGl0dXRlKCRsLnllYXIsIDEpIHx8CiAgICAgICAgc3Vic3RpdHV0ZSgkbC55ZWFycywgTWF0aC5mbG9vcih5ZWFycykpOwoKICAgICAgcmV0dXJuICQudHJpbShbcHJlZml4LCB3b3Jkcywgc3VmZml4XS5qb2luKCIgIikpOwogICAgfSwKICAgIHBhcnNlOiBmdW5jdGlvbihpc284NjAxKSB7CiAgICAgIHZhciBzID0gJC50cmltKGlzbzg2MDEpOwogICAgICBzID0gcy5yZXBsYWNlKC9cLlxkXGRcZCsvLCIiKTsgLy8gcmVtb3ZlIG1pbGxpc2Vjb25kcwogICAgICBzID0gcy5yZXBsYWNlKC8tLywiLyIpLnJlcGxhY2UoLy0vLCIvIik7CiAgICAgIHMgPSBzLnJlcGxhY2UoL1QvLCIgIikucmVwbGFjZSgvWi8sIiBVVEMiKTsKICAgICAgcyA9IHMucmVwbGFjZSgvKFtcK1wtXVxkXGQpXDo/KFxkXGQpLywiICQxJDIiKTsgLy8gLTA0OjAwIC0+IC0wNDAwCiAgICAgIHJldHVybiBuZXcgRGF0ZShzKTsKICAgIH0sCiAgICBkYXRldGltZTogZnVuY3Rpb24oZWxlbSkgewogICAgICAvLyBqUXVlcnkncyBgaXMoKWAgZG9lc24ndCBwbGF5IHdlbGwgd2l0aCBIVE1MNSBpbiBJRQogICAgICB2YXIgaXNUaW1lID0gJChlbGVtKS5nZXQoMCkudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAidGltZSI7IC8vICQoZWxlbSkuaXMoInRpbWUiKTsKICAgICAgdmFyIGlzbzg2MDEgPSBpc1RpbWUgPyAkKGVsZW0pLmF0dHIoImRhdGV0aW1lIikgOiAkKGVsZW0pLmF0dHIoInRpdGxlIik7CiAgICAgIHJldHVybiAkdC5wYXJzZShpc284NjAxKTsKICAgIH0KICB9KTsKCiAgJC5mbi50aW1lYWdvID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBzZWxmLmVhY2gocmVmcmVzaCk7CgogICAgdmFyICRzID0gJHQuc2V0dGluZ3M7CiAgICBpZiAoJHMucmVmcmVzaE1pbGxpcyA+IDApIHsKICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7IHNlbGYuZWFjaChyZWZyZXNoKTsgfSwgJHMucmVmcmVzaE1pbGxpcyk7CiAgICB9CiAgICByZXR1cm4gc2VsZjsKICB9OwoKICBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgdmFyIGRhdGEgPSBwcmVwYXJlRGF0YSh0aGlzKTsKICAgIGlmICghaXNOYU4oZGF0YS5kYXRldGltZSkpIHsKICAgICAgJCh0aGlzKS50ZXh0KGluV29yZHMoZGF0YS5kYXRldGltZSkpOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBmdW5jdGlvbiBwcmVwYXJlRGF0YShlbGVtZW50KSB7CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIGlmICghZWxlbWVudC5kYXRhKCJ0aW1lYWdvIikpIHsKICAgICAgZWxlbWVudC5kYXRhKCJ0aW1lYWdvIiwgeyBkYXRldGltZTogJHQuZGF0ZXRpbWUoZWxlbWVudCkgfSk7CiAgICAgIHZhciB0ZXh0ID0gJC50cmltKGVsZW1lbnQudGV4dCgpKTsKICAgICAgaWYgKHRleHQubGVuZ3RoID4gMCkgewogICAgICAgIGVsZW1lbnQuYXR0cigidGl0bGUiLCB0ZXh0KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGVsZW1lbnQuZGF0YSgidGltZWFnbyIpOwogIH0KCiAgZnVuY3Rpb24gaW5Xb3JkcyhkYXRlKSB7CiAgICByZXR1cm4gJHQuaW5Xb3JkcyhkaXN0YW5jZShkYXRlKSk7CiAgfQoKICBmdW5jdGlvbiBkaXN0YW5jZShkYXRlKSB7CiAgICByZXR1cm4gKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gZGF0ZS5nZXRUaW1lKCkpOwogIH0KCiAgLy8gZml4IGZvciBJRTYgc3Vja2FnZQogIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImFiYnIiKTsKICBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0aW1lIik7Cn0oalF1ZXJ5KSk7"
        },
        "static/js/json2.js": {
            "content_type": "application/javascript",
            "data": "LyoKICAgIGh0dHA6Ly93d3cuSlNPTi5vcmcvanNvbjIuanMKICAgIDIwMTAtMTEtMTcKCiAgICBQdWJsaWMgRG9tYWluLgoKICAgIE5PIFdBUlJBTlRZIEVYUFJFU1NFRCBPUiBJTVBMSUVELiBVU0UgQVQgWU9VUiBPV04gUklTSy4KCiAgICBTZWUgaHR0cDovL3d3dy5KU09OLm9yZy9qcy5odG1sCgoKICAgIFRoaXMgY29kZSBzaG91bGQgYmUgbWluaWZpZWQgYmVmb3JlIGRlcGxveW1lbnQuCiAgICBTZWUgaHR0cDovL2phdmFzY3JpcHQuY3JvY2tmb3JkLmNvbS9qc21pbi5odG1sCgogICAgVVNFIFlPVVIgT1dOIENPUFkuIElUIElTIEVYVFJFTUVMWSBVTldJU0UgVE8gTE9BRCBDT0RFIEZST00gU0VSVkVSUyBZT1UgRE8KICAgIE5PVCBDT05UUk9MLgoKCiAgICBUaGlzIGZpbGUgY3JlYXRlcyBhIGdsb2JhbCBKU09OIG9iamVjdCBjb250YWluaW5nIHR3byBtZXRob2RzOiBzdHJpbmdpZnkKICAgIGFuZCBwYXJzZS4KCiAgICAgICAgSlNPTi5zdHJpbmdpZnkodmFsdWUsIHJlcGxhY2VyLCBzcGFjZSkKICAgICAgICAgICAgdmFsdWUgICAgICAgYW55IEphdmFTY3JpcHQgdmFsdWUsIHVzdWFsbHkgYW4gb2JqZWN0IG9yIGFycmF5LgoKICAgICAgICAgICAgcmVwbGFjZXIgICAgYW4gb3B0aW9uYWwgcGFyYW1ldGVyIHRoYXQgZGV0ZXJtaW5lcyBob3cgb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcyBhcmUgc3RyaW5naWZpZWQgZm9yIG9iamVjdHMuIEl0IGNhbiBiZSBhCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG9yIGFuIGFycmF5IG9mIHN0cmluZ3MuCgogICAgICAgICAgICBzcGFjZSAgICAgICBhbiBvcHRpb25hbCBwYXJhbWV0ZXIgdGhhdCBzcGVjaWZpZXMgdGhlIGluZGVudGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIG9mIG5lc3RlZCBzdHJ1Y3R1cmVzLiBJZiBpdCBpcyBvbWl0dGVkLCB0aGUgdGV4dCB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAgIGJlIHBhY2tlZCB3aXRob3V0IGV4dHJhIHdoaXRlc3BhY2UuIElmIGl0IGlzIGEgbnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICBpdCB3aWxsIHNwZWNpZnkgdGhlIG51bWJlciBvZiBzcGFjZXMgdG8gaW5kZW50IGF0IGVhY2gKICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWwuIElmIGl0IGlzIGEgc3RyaW5nIChzdWNoIGFzICdcdCcgb3IgJyZuYnNwOycpLAogICAgICAgICAgICAgICAgICAgICAgICBpdCBjb250YWlucyB0aGUgY2hhcmFjdGVycyB1c2VkIHRvIGluZGVudCBhdCBlYWNoIGxldmVsLgoKICAgICAgICAgICAgVGhpcyBtZXRob2QgcHJvZHVjZXMgYSBKU09OIHRleHQgZnJvbSBhIEphdmFTY3JpcHQgdmFsdWUuCgogICAgICAgICAgICBXaGVuIGFuIG9iamVjdCB2YWx1ZSBpcyBmb3VuZCwgaWYgdGhlIG9iamVjdCBjb250YWlucyBhIHRvSlNPTgogICAgICAgICAgICBtZXRob2QsIGl0cyB0b0pTT04gbWV0aG9kIHdpbGwgYmUgY2FsbGVkIGFuZCB0aGUgcmVzdWx0IHdpbGwgYmUKICAgICAgICAgICAgc3RyaW5naWZpZWQuIEEgdG9KU09OIG1ldGhvZCBkb2VzIG5vdCBzZXJpYWxpemU6IGl0IHJldHVybnMgdGhlCiAgICAgICAgICAgIHZhbHVlIHJlcHJlc2VudGVkIGJ5IHRoZSBuYW1lL3ZhbHVlIHBhaXIgdGhhdCBzaG91bGQgYmUgc2VyaWFsaXplZCwKICAgICAgICAgICAgb3IgdW5kZWZpbmVkIGlmIG5vdGhpbmcgc2hvdWxkIGJlIHNlcmlhbGl6ZWQuIFRoZSB0b0pTT04gbWV0aG9kCiAgICAgICAgICAgIHdpbGwgYmUgcGFzc2VkIHRoZSBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoZSB2YWx1ZSwgYW5kIHRoaXMgd2lsbCBiZQogICAgICAgICAgICBib3VuZCB0byB0aGUgdmFsdWUKCiAgICAgICAgICAgIEZvciBleGFtcGxlLCB0aGlzIHdvdWxkIHNlcmlhbGl6ZSBEYXRlcyBhcyBJU08gc3RyaW5ncy4KCiAgICAgICAgICAgICAgICBEYXRlLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZihuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcm1hdCBpbnRlZ2VycyB0byBoYXZlIGF0IGxlYXN0IHR3byBkaWdpdHMuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuIDwgMTAgPyAnMCcgKyBuIDogbjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFVUQ0Z1bGxZZWFyKCkgICArICctJyArCiAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDTW9udGgoKSArIDEpICsgJy0nICsKICAgICAgICAgICAgICAgICAgICAgICAgIGYodGhpcy5nZXRVVENEYXRlKCkpICAgICAgKyAnVCcgKwogICAgICAgICAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ0hvdXJzKCkpICAgICArICc6JyArCiAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDTWludXRlcygpKSAgICsgJzonICsKICAgICAgICAgICAgICAgICAgICAgICAgIGYodGhpcy5nZXRVVENTZWNvbmRzKCkpICAgKyAnWic7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgWW91IGNhbiBwcm92aWRlIGFuIG9wdGlvbmFsIHJlcGxhY2VyIG1ldGhvZC4gSXQgd2lsbCBiZSBwYXNzZWQgdGhlCiAgICAgICAgICAgIGtleSBhbmQgdmFsdWUgb2YgZWFjaCBtZW1iZXIsIHdpdGggdGhpcyBib3VuZCB0byB0aGUgY29udGFpbmluZwogICAgICAgICAgICBvYmplY3QuIFRoZSB2YWx1ZSB0aGF0IGlzIHJldHVybmVkIGZyb20geW91ciBtZXRob2Qgd2lsbCBiZQogICAgICAgICAgICBzZXJpYWxpemVkLiBJZiB5b3VyIG1ldGhvZCByZXR1cm5zIHVuZGVmaW5lZCwgdGhlbiB0aGUgbWVtYmVyIHdpbGwKICAgICAgICAgICAgYmUgZXhjbHVkZWQgZnJvbSB0aGUgc2VyaWFsaXphdGlvbi4KCiAgICAgICAgICAgIElmIHRoZSByZXBsYWNlciBwYXJhbWV0ZXIgaXMgYW4gYXJyYXkgb2Ygc3RyaW5ncywgdGhlbiBpdCB3aWxsIGJlCiAgICAgICAgICAgIHVzZWQgdG8gc2VsZWN0IHRoZSBtZW1iZXJzIHRvIGJlIHNlcmlhbGl6ZWQuIEl0IGZpbHRlcnMgdGhlIHJlc3VsdHMKICAgICAgICAgICAgc3VjaCB0aGF0IG9ubHkgbWVtYmVycyB3aXRoIGtleXMgbGlzdGVkIGluIHRoZSByZXBsYWNlciBhcnJheSBhcmUKICAgICAgICAgICAgc3RyaW5naWZpZWQuCgogICAgICAgICAgICBWYWx1ZXMgdGhhdCBkbyBub3QgaGF2ZSBKU09OIHJlcHJlc2VudGF0aW9ucywgc3VjaCBhcyB1bmRlZmluZWQgb3IKICAgICAgICAgICAgZnVuY3Rpb25zLCB3aWxsIG5vdCBiZSBzZXJpYWxpemVkLiBTdWNoIHZhbHVlcyBpbiBvYmplY3RzIHdpbGwgYmUKICAgICAgICAgICAgZHJvcHBlZDsgaW4gYXJyYXlzIHRoZXkgd2lsbCBiZSByZXBsYWNlZCB3aXRoIG51bGwuIFlvdSBjYW4gdXNlCiAgICAgICAgICAgIGEgcmVwbGFjZXIgZnVuY3Rpb24gdG8gcmVwbGFjZSB0aG9zZSB3aXRoIEpTT04gdmFsdWVzLgogICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh1bmRlZmluZWQpIHJldHVybnMgdW5kZWZpbmVkLgoKICAgICAgICAgICAgVGhlIG9wdGlvbmFsIHNwYWNlIHBhcmFtZXRlciBwcm9kdWNlcyBhIHN0cmluZ2lmaWNhdGlvbiBvZiB0aGUKICAgICAgICAgICAgdmFsdWUgdGhhdCBpcyBmaWxsZWQgd2l0aCBsaW5lIGJyZWFrcyBhbmQgaW5kZW50YXRpb24gdG8gbWFrZSBpdAogICAgICAgICAgICBlYXNpZXIgdG8gcmVhZC4KCiAgICAgICAgICAgIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBub24tZW1wdHkgc3RyaW5nLCB0aGVuIHRoYXQgc3RyaW5nIHdpbGwKICAgICAgICAgICAgYmUgdXNlZCBmb3IgaW5kZW50YXRpb24uIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBudW1iZXIsIHRoZW4KICAgICAgICAgICAgdGhlIGluZGVudGF0aW9uIHdpbGwgYmUgdGhhdCBtYW55IHNwYWNlcy4KCiAgICAgICAgICAgIEV4YW1wbGU6CgogICAgICAgICAgICB0ZXh0ID0gSlNPTi5zdHJpbmdpZnkoWydlJywge3BsdXJpYnVzOiAndW51bSd9XSk7CiAgICAgICAgICAgIC8vIHRleHQgaXMgJ1siZSIseyJwbHVyaWJ1cyI6InVudW0ifV0nCgoKICAgICAgICAgICAgdGV4dCA9IEpTT04uc3RyaW5naWZ5KFsnZScsIHtwbHVyaWJ1czogJ3VudW0nfV0sIG51bGwsICdcdCcpOwogICAgICAgICAgICAvLyB0ZXh0IGlzICdbXG5cdCJlIixcblx0e1xuXHRcdCJwbHVyaWJ1cyI6ICJ1bnVtIlxuXHR9XG5dJwoKICAgICAgICAgICAgdGV4dCA9IEpTT04uc3RyaW5naWZ5KFtuZXcgRGF0ZSgpXSwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzW2tleV0gaW5zdGFuY2VvZiBEYXRlID8KICAgICAgICAgICAgICAgICAgICAnRGF0ZSgnICsgdGhpc1trZXldICsgJyknIDogdmFsdWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyB0ZXh0IGlzICdbIkRhdGUoLS0tY3VycmVudCB0aW1lLS0tKSJdJwoKCiAgICAgICAgSlNPTi5wYXJzZSh0ZXh0LCByZXZpdmVyKQogICAgICAgICAgICBUaGlzIG1ldGhvZCBwYXJzZXMgYSBKU09OIHRleHQgdG8gcHJvZHVjZSBhbiBvYmplY3Qgb3IgYXJyYXkuCiAgICAgICAgICAgIEl0IGNhbiB0aHJvdyBhIFN5bnRheEVycm9yIGV4Y2VwdGlvbi4KCiAgICAgICAgICAgIFRoZSBvcHRpb25hbCByZXZpdmVyIHBhcmFtZXRlciBpcyBhIGZ1bmN0aW9uIHRoYXQgY2FuIGZpbHRlciBhbmQKICAgICAgICAgICAgdHJhbnNmb3JtIHRoZSByZXN1bHRzLiBJdCByZWNlaXZlcyBlYWNoIG9mIHRoZSBrZXlzIGFuZCB2YWx1ZXMsCiAgICAgICAgICAgIGFuZCBpdHMgcmV0dXJuIHZhbHVlIGlzIHVzZWQgaW5zdGVhZCBvZiB0aGUgb3JpZ2luYWwgdmFsdWUuCiAgICAgICAgICAgIElmIGl0IHJldHVybnMgd2hhdCBpdCByZWNlaXZlZCwgdGhlbiB0aGUgc3RydWN0dXJlIGlzIG5vdCBtb2RpZmllZC4KICAgICAgICAgICAgSWYgaXQgcmV0dXJucyB1bmRlZmluZWQgdGhlbiB0aGUgbWVtYmVyIGlzIGRlbGV0ZWQuCgogICAgICAgICAgICBFeGFtcGxlOgoKICAgICAgICAgICAgLy8gUGFyc2UgdGhlIHRleHQuIFZhbHVlcyB0aGF0IGxvb2sgbGlrZSBJU08gZGF0ZSBzdHJpbmdzIHdpbGwKICAgICAgICAgICAgLy8gYmUgY29udmVydGVkIHRvIERhdGUgb2JqZWN0cy4KCiAgICAgICAgICAgIG15RGF0YSA9IEpTT04ucGFyc2UodGV4dCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICBhID0KL14oXGR7NH0pLShcZHsyfSktKFxkezJ9KVQoXGR7Mn0pOihcZHsyfSk6KFxkezJ9KD86XC5cZCopPylaJC8uZXhlYyh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKCthWzFdLCArYVsyXSAtIDEsICthWzNdLCArYVs0XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICthWzVdLCArYVs2XSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBteURhdGEgPSBKU09OLnBhcnNlKCdbIkRhdGUoMDkvMDkvMjAwMSkiXScsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICB2YXIgZDsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNsaWNlKDAsIDUpID09PSAnRGF0ZSgnICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNsaWNlKC0xKSA9PT0gJyknKSB7CiAgICAgICAgICAgICAgICAgICAgZCA9IG5ldyBEYXRlKHZhbHVlLnNsaWNlKDUsIC0xKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9KTsKCgogICAgVGhpcyBpcyBhIHJlZmVyZW5jZSBpbXBsZW1lbnRhdGlvbi4gWW91IGFyZSBmcmVlIHRvIGNvcHksIG1vZGlmeSwgb3IKICAgIHJlZGlzdHJpYnV0ZS4KKi8KCi8qanNsaW50IGV2aWw6IHRydWUsIHN0cmljdDogZmFsc2UsIHJlZ2V4cDogZmFsc2UgKi8KCi8qbWVtYmVycyAiIiwgIlxiIiwgIlx0IiwgIlxuIiwgIlxmIiwgIlxyIiwgIlwiIiwgSlNPTiwgIlxcIiwgYXBwbHksCiAgICBjYWxsLCBjaGFyQ29kZUF0LCBnZXRVVENEYXRlLCBnZXRVVENGdWxsWWVhciwgZ2V0VVRDSG91cnMsCiAgICBnZXRVVENNaW51dGVzLCBnZXRVVENNb250aCwgZ2V0VVRDU2Vjb25kcywgaGFzT3duUHJvcGVydHksIGpvaW4sCiAgICBsYXN0SW5kZXgsIGxlbmd0aCwgcGFyc2UsIHByb3RvdHlwZSwgcHVzaCwgcmVwbGFjZSwgc2xpY2UsIHN0cmluZ2lmeSwKICAgIHRlc3QsIHRvSlNPTiwgdG9TdHJpbmcsIHZhbHVlT2YKKi8KCgovLyBDcmVhdGUgYSBKU09OIG9iamVjdCBvbmx5IGlmIG9uZSBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0LiBXZSBjcmVhdGUgdGhlCi8vIG1ldGhvZHMgaW4gYSBjbG9zdXJlIHRvIGF2b2lkIGNyZWF0aW5nIGdsb2JhbCB2YXJpYWJsZXMuCgppZiAoIXRoaXMuSlNPTikgewogICAgdGhpcy5KU09OID0ge307Cn0KCihmdW5jdGlvbiAoKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgZnVuY3Rpb24gZihuKSB7CiAgICAgICAgLy8gRm9ybWF0IGludGVnZXJzIHRvIGhhdmUgYXQgbGVhc3QgdHdvIGRpZ2l0cy4KICAgICAgICByZXR1cm4gbiA8IDEwID8gJzAnICsgbiA6IG47CiAgICB9CgogICAgaWYgKHR5cGVvZiBEYXRlLnByb3RvdHlwZS50b0pTT04gIT09ICdmdW5jdGlvbicpIHsKCiAgICAgICAgRGF0ZS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKGtleSkgewoKICAgICAgICAgICAgcmV0dXJuIGlzRmluaXRlKHRoaXMudmFsdWVPZigpKSA/CiAgICAgICAgICAgICAgICAgICB0aGlzLmdldFVUQ0Z1bGxZZWFyKCkgICArICctJyArCiAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ01vbnRoKCkgKyAxKSArICctJyArCiAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ0RhdGUoKSkgICAgICArICdUJyArCiAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ0hvdXJzKCkpICAgICArICc6JyArCiAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ01pbnV0ZXMoKSkgICArICc6JyArCiAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ1NlY29uZHMoKSkgICArICdaJyA6IG51bGw7CiAgICAgICAgfTsKCiAgICAgICAgU3RyaW5nLnByb3RvdHlwZS50b0pTT04gPQogICAgICAgIE51bWJlci5wcm90b3R5cGUudG9KU09OID0KICAgICAgICBCb29sZWFuLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlT2YoKTsKICAgICAgICB9OwogICAgfQoKICAgIHZhciBjeCA9IC9bXHUwMDAwXHUwMGFkXHUwNjAwLVx1MDYwNFx1MDcwZlx1MTdiNFx1MTdiNVx1MjAwYy1cdTIwMGZcdTIwMjgtXHUyMDJmXHUyMDYwLVx1MjA2Zlx1ZmVmZlx1ZmZmMC1cdWZmZmZdL2csCiAgICAgICAgZXNjYXBhYmxlID0gL1tcXFwiXHgwMC1ceDFmXHg3Zi1ceDlmXHUwMGFkXHUwNjAwLVx1MDYwNFx1MDcwZlx1MTdiNFx1MTdiNVx1MjAwYy1cdTIwMGZcdTIwMjgtXHUyMDJmXHUyMDYwLVx1MjA2Zlx1ZmVmZlx1ZmZmMC1cdWZmZmZdL2csCiAgICAgICAgZ2FwLAogICAgICAgIGluZGVudCwKICAgICAgICBtZXRhID0geyAgICAvLyB0YWJsZSBvZiBjaGFyYWN0ZXIgc3Vic3RpdHV0aW9ucwogICAgICAgICAgICAnXGInOiAnXFxiJywKICAgICAgICAgICAgJ1x0JzogJ1xcdCcsCiAgICAgICAgICAgICdcbic6ICdcXG4nLAogICAgICAgICAgICAnXGYnOiAnXFxmJywKICAgICAgICAgICAgJ1xyJzogJ1xccicsCiAgICAgICAgICAgICciJyA6ICdcXCInLAogICAgICAgICAgICAnXFwnOiAnXFxcXCcKICAgICAgICB9LAogICAgICAgIHJlcDsKCgogICAgZnVuY3Rpb24gcXVvdGUoc3RyaW5nKSB7CgovLyBJZiB0aGUgc3RyaW5nIGNvbnRhaW5zIG5vIGNvbnRyb2wgY2hhcmFjdGVycywgbm8gcXVvdGUgY2hhcmFjdGVycywgYW5kIG5vCi8vIGJhY2tzbGFzaCBjaGFyYWN0ZXJzLCB0aGVuIHdlIGNhbiBzYWZlbHkgc2xhcCBzb21lIHF1b3RlcyBhcm91bmQgaXQuCi8vIE90aGVyd2lzZSB3ZSBtdXN0IGFsc28gcmVwbGFjZSB0aGUgb2ZmZW5kaW5nIGNoYXJhY3RlcnMgd2l0aCBzYWZlIGVzY2FwZQovLyBzZXF1ZW5jZXMuCgogICAgICAgIGVzY2FwYWJsZS5sYXN0SW5kZXggPSAwOwogICAgICAgIHJldHVybiBlc2NhcGFibGUudGVzdChzdHJpbmcpID8KICAgICAgICAgICAgJyInICsgc3RyaW5nLnJlcGxhY2UoZXNjYXBhYmxlLCBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgdmFyIGMgPSBtZXRhW2FdOwogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBjID09PSAnc3RyaW5nJyA/IGMgOgogICAgICAgICAgICAgICAgICAgICdcXHUnICsgKCcwMDAwJyArIGEuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KTsKICAgICAgICAgICAgfSkgKyAnIicgOgogICAgICAgICAgICAnIicgKyBzdHJpbmcgKyAnIic7CiAgICB9CgoKICAgIGZ1bmN0aW9uIHN0cihrZXksIGhvbGRlcikgewoKLy8gUHJvZHVjZSBhIHN0cmluZyBmcm9tIGhvbGRlcltrZXldLgoKICAgICAgICB2YXIgaSwgICAgICAgICAgLy8gVGhlIGxvb3AgY291bnRlci4KICAgICAgICAgICAgaywgICAgICAgICAgLy8gVGhlIG1lbWJlciBrZXkuCiAgICAgICAgICAgIHYsICAgICAgICAgIC8vIFRoZSBtZW1iZXIgdmFsdWUuCiAgICAgICAgICAgIGxlbmd0aCwKICAgICAgICAgICAgbWluZCA9IGdhcCwKICAgICAgICAgICAgcGFydGlhbCwKICAgICAgICAgICAgdmFsdWUgPSBob2xkZXJba2V5XTsKCi8vIElmIHRoZSB2YWx1ZSBoYXMgYSB0b0pTT04gbWV0aG9kLCBjYWxsIGl0IHRvIG9idGFpbiBhIHJlcGxhY2VtZW50IHZhbHVlLgoKICAgICAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJgogICAgICAgICAgICAgICAgdHlwZW9mIHZhbHVlLnRvSlNPTiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnRvSlNPTihrZXkpOwogICAgICAgIH0KCi8vIElmIHdlIHdlcmUgY2FsbGVkIHdpdGggYSByZXBsYWNlciBmdW5jdGlvbiwgdGhlbiBjYWxsIHRoZSByZXBsYWNlciB0bwovLyBvYnRhaW4gYSByZXBsYWNlbWVudCB2YWx1ZS4KCiAgICAgICAgaWYgKHR5cGVvZiByZXAgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgdmFsdWUgPSByZXAuY2FsbChob2xkZXIsIGtleSwgdmFsdWUpOwogICAgICAgIH0KCi8vIFdoYXQgaGFwcGVucyBuZXh0IGRlcGVuZHMgb24gdGhlIHZhbHVlJ3MgdHlwZS4KCiAgICAgICAgc3dpdGNoICh0eXBlb2YgdmFsdWUpIHsKICAgICAgICBjYXNlICdzdHJpbmcnOgogICAgICAgICAgICByZXR1cm4gcXVvdGUodmFsdWUpOwoKICAgICAgICBjYXNlICdudW1iZXInOgoKLy8gSlNPTiBudW1iZXJzIG11c3QgYmUgZmluaXRlLiBFbmNvZGUgbm9uLWZpbml0ZSBudW1iZXJzIGFzIG51bGwuCgogICAgICAgICAgICByZXR1cm4gaXNGaW5pdGUodmFsdWUpID8gU3RyaW5nKHZhbHVlKSA6ICdudWxsJzsKCiAgICAgICAgY2FzZSAnYm9vbGVhbic6CiAgICAgICAgY2FzZSAnbnVsbCc6CgovLyBJZiB0aGUgdmFsdWUgaXMgYSBib29sZWFuIG9yIG51bGwsIGNvbnZlcnQgaXQgdG8gYSBzdHJpbmcuIE5vdGU6Ci8vIHR5cGVvZiBudWxsIGRvZXMgbm90IHByb2R1Y2UgJ251bGwnLiBUaGUgY2FzZSBpcyBpbmNsdWRlZCBoZXJlIGluCi8vIHRoZSByZW1vdGUgY2hhbmNlIHRoYXQgdGhpcyBnZXRzIGZpeGVkIHNvbWVkYXkuCgogICAgICAgICAgICByZXR1cm4gU3RyaW5nKHZhbHVlKTsKCi8vIElmIHRoZSB0eXBlIGlzICdvYmplY3QnLCB3ZSBtaWdodCBiZSBkZWFsaW5nIHdpdGggYW4gb2JqZWN0IG9yIGFuIGFycmF5IG9yCi8vIG51bGwuCgogICAgICAgIGNhc2UgJ29iamVjdCc6CgovLyBEdWUgdG8gYSBzcGVjaWZpY2F0aW9uIGJsdW5kZXIgaW4gRUNNQVNjcmlwdCwgdHlwZW9mIG51bGwgaXMgJ29iamVjdCcsCi8vIHNvIHdhdGNoIG91dCBmb3IgdGhhdCBjYXNlLgoKICAgICAgICAgICAgaWYgKCF2YWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICdudWxsJzsKICAgICAgICAgICAgfQoKLy8gTWFrZSBhbiBhcnJheSB0byBob2xkIHRoZSBwYXJ0aWFsIHJlc3VsdHMgb2Ygc3RyaW5naWZ5aW5nIHRoaXMgb2JqZWN0IHZhbHVlLgoKICAgICAgICAgICAgZ2FwICs9IGluZGVudDsKICAgICAgICAgICAgcGFydGlhbCA9IFtdOwoKLy8gSXMgdGhlIHZhbHVlIGFuIGFycmF5PwoKICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkodmFsdWUpID09PSAnW29iamVjdCBBcnJheV0nKSB7CgovLyBUaGUgdmFsdWUgaXMgYW4gYXJyYXkuIFN0cmluZ2lmeSBldmVyeSBlbGVtZW50LiBVc2UgbnVsbCBhcyBhIHBsYWNlaG9sZGVyCi8vIGZvciBub24tSlNPTiB2YWx1ZXMuCgogICAgICAgICAgICAgICAgbGVuZ3RoID0gdmFsdWUubGVuZ3RoOwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcGFydGlhbFtpXSA9IHN0cihpLCB2YWx1ZSkgfHwgJ251bGwnOwogICAgICAgICAgICAgICAgfQoKLy8gSm9pbiBhbGwgb2YgdGhlIGVsZW1lbnRzIHRvZ2V0aGVyLCBzZXBhcmF0ZWQgd2l0aCBjb21tYXMsIGFuZCB3cmFwIHRoZW0gaW4KLy8gYnJhY2tldHMuCgogICAgICAgICAgICAgICAgdiA9IHBhcnRpYWwubGVuZ3RoID09PSAwID8gJ1tdJyA6CiAgICAgICAgICAgICAgICAgICAgZ2FwID8gJ1tcbicgKyBnYXAgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGlhbC5qb2luKCcsXG4nICsgZ2FwKSArICdcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbmQgKyAnXScgOgogICAgICAgICAgICAgICAgICAgICAgICAgICdbJyArIHBhcnRpYWwuam9pbignLCcpICsgJ10nOwogICAgICAgICAgICAgICAgZ2FwID0gbWluZDsKICAgICAgICAgICAgICAgIHJldHVybiB2OwogICAgICAgICAgICB9CgovLyBJZiB0aGUgcmVwbGFjZXIgaXMgYW4gYXJyYXksIHVzZSBpdCB0byBzZWxlY3QgdGhlIG1lbWJlcnMgdG8gYmUgc3RyaW5naWZpZWQuCgogICAgICAgICAgICBpZiAocmVwICYmIHR5cGVvZiByZXAgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICBsZW5ndGggPSByZXAubGVuZ3RoOwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgayA9IHJlcFtpXTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGsgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBzdHIoaywgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGlhbC5wdXNoKHF1b3RlKGspICsgKGdhcCA/ICc6ICcgOiAnOicpICsgdik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CgovLyBPdGhlcndpc2UsIGl0ZXJhdGUgdGhyb3VnaCBhbGwgb2YgdGhlIGtleXMgaW4gdGhlIG9iamVjdC4KCiAgICAgICAgICAgICAgICBmb3IgKGsgaW4gdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodmFsdWUsIGspKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBzdHIoaywgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGlhbC5wdXNoKHF1b3RlKGspICsgKGdhcCA/ICc6ICcgOiAnOicpICsgdik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCi8vIEpvaW4gYWxsIG9mIHRoZSBtZW1iZXIgdGV4dHMgdG9nZXRoZXIsIHNlcGFyYXRlZCB3aXRoIGNvbW1hcywKLy8gYW5kIHdyYXAgdGhlbSBpbiBicmFjZXMuCgogICAgICAgICAgICB2ID0gcGFydGlhbC5sZW5ndGggPT09IDAgPyAne30nIDoKICAgICAgICAgICAgICAgIGdhcCA/ICd7XG4nICsgZ2FwICsgcGFydGlhbC5qb2luKCcsXG4nICsgZ2FwKSArICdcbicgKwogICAgICAgICAgICAgICAgICAgICAgICBtaW5kICsgJ30nIDogJ3snICsgcGFydGlhbC5qb2luKCcsJykgKyAnfSc7CiAgICAgICAgICAgIGdhcCA9IG1pbmQ7CiAgICAgICAgICAgIHJldHVybiB2OwogICAgICAgIH0KICAgIH0KCi8vIElmIHRoZSBKU09OIG9iamVjdCBkb2VzIG5vdCB5ZXQgaGF2ZSBhIHN0cmluZ2lmeSBtZXRob2QsIGdpdmUgaXQgb25lLgoKICAgIGlmICh0eXBlb2YgSlNPTi5zdHJpbmdpZnkgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICBKU09OLnN0cmluZ2lmeSA9IGZ1bmN0aW9uICh2YWx1ZSwgcmVwbGFjZXIsIHNwYWNlKSB7CgovLyBUaGUgc3RyaW5naWZ5IG1ldGhvZCB0YWtlcyBhIHZhbHVlIGFuZCBhbiBvcHRpb25hbCByZXBsYWNlciwgYW5kIGFuIG9wdGlvbmFsCi8vIHNwYWNlIHBhcmFtZXRlciwgYW5kIHJldHVybnMgYSBKU09OIHRleHQuIFRoZSByZXBsYWNlciBjYW4gYmUgYSBmdW5jdGlvbgovLyB0aGF0IGNhbiByZXBsYWNlIHZhbHVlcywgb3IgYW4gYXJyYXkgb2Ygc3RyaW5ncyB0aGF0IHdpbGwgc2VsZWN0IHRoZSBrZXlzLgovLyBBIGRlZmF1bHQgcmVwbGFjZXIgbWV0aG9kIGNhbiBiZSBwcm92aWRlZC4gVXNlIG9mIHRoZSBzcGFjZSBwYXJhbWV0ZXIgY2FuCi8vIHByb2R1Y2UgdGV4dCB0aGF0IGlzIG1vcmUgZWFzaWx5IHJlYWRhYmxlLgoKICAgICAgICAgICAgdmFyIGk7CiAgICAgICAgICAgIGdhcCA9ICcnOwogICAgICAgICAgICBpbmRlbnQgPSAnJzsKCi8vIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBudW1iZXIsIG1ha2UgYW4gaW5kZW50IHN0cmluZyBjb250YWluaW5nIHRoYXQKLy8gbWFueSBzcGFjZXMuCgogICAgICAgICAgICBpZiAodHlwZW9mIHNwYWNlID09PSAnbnVtYmVyJykgewogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNwYWNlOyBpICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICBpbmRlbnQgKz0gJyAnOwogICAgICAgICAgICAgICAgfQoKLy8gSWYgdGhlIHNwYWNlIHBhcmFtZXRlciBpcyBhIHN0cmluZywgaXQgd2lsbCBiZSB1c2VkIGFzIHRoZSBpbmRlbnQgc3RyaW5nLgoKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc3BhY2UgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICBpbmRlbnQgPSBzcGFjZTsKICAgICAgICAgICAgfQoKLy8gSWYgdGhlcmUgaXMgYSByZXBsYWNlciwgaXQgbXVzdCBiZSBhIGZ1bmN0aW9uIG9yIGFuIGFycmF5LgovLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yLgoKICAgICAgICAgICAgcmVwID0gcmVwbGFjZXI7CiAgICAgICAgICAgIGlmIChyZXBsYWNlciAmJiB0eXBlb2YgcmVwbGFjZXIgIT09ICdmdW5jdGlvbicgJiYKICAgICAgICAgICAgICAgICAgICAodHlwZW9mIHJlcGxhY2VyICE9PSAnb2JqZWN0JyB8fAogICAgICAgICAgICAgICAgICAgICB0eXBlb2YgcmVwbGFjZXIubGVuZ3RoICE9PSAnbnVtYmVyJykpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSlNPTi5zdHJpbmdpZnknKTsKICAgICAgICAgICAgfQoKLy8gTWFrZSBhIGZha2Ugcm9vdCBvYmplY3QgY29udGFpbmluZyBvdXIgdmFsdWUgdW5kZXIgdGhlIGtleSBvZiAnJy4KLy8gUmV0dXJuIHRoZSByZXN1bHQgb2Ygc3RyaW5naWZ5aW5nIHRoZSB2YWx1ZS4KCiAgICAgICAgICAgIHJldHVybiBzdHIoJycsIHsnJzogdmFsdWV9KTsKICAgICAgICB9OwogICAgfQoKCi8vIElmIHRoZSBKU09OIG9iamVjdCBkb2VzIG5vdCB5ZXQgaGF2ZSBhIHBhcnNlIG1ldGhvZCwgZ2l2ZSBpdCBvbmUuCgogICAgaWYgKHR5cGVvZiBKU09OLnBhcnNlICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgSlNPTi5wYXJzZSA9IGZ1bmN0aW9uICh0ZXh0LCByZXZpdmVyKSB7CgovLyBUaGUgcGFyc2UgbWV0aG9kIHRha2VzIGEgdGV4dCBhbmQgYW4gb3B0aW9uYWwgcmV2aXZlciBmdW5jdGlvbiwgYW5kIHJldHVybnMKLy8gYSBKYXZhU2NyaXB0IHZhbHVlIGlmIHRoZSB0ZXh0IGlzIGEgdmFsaWQgSlNPTiB0ZXh0LgoKICAgICAgICAgICAgdmFyIGo7CgogICAgICAgICAgICBmdW5jdGlvbiB3YWxrKGhvbGRlciwga2V5KSB7CgovLyBUaGUgd2FsayBtZXRob2QgaXMgdXNlZCB0byByZWN1cnNpdmVseSB3YWxrIHRoZSByZXN1bHRpbmcgc3RydWN0dXJlIHNvCi8vIHRoYXQgbW9kaWZpY2F0aW9ucyBjYW4gYmUgbWFkZS4KCiAgICAgICAgICAgICAgICB2YXIgaywgdiwgdmFsdWUgPSBob2xkZXJba2V5XTsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChrIGluIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgaykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSB3YWxrKHZhbHVlLCBrKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVtrXSA9IHY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB2YWx1ZVtrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXZpdmVyLmNhbGwoaG9sZGVyLCBrZXksIHZhbHVlKTsKICAgICAgICAgICAgfQoKCi8vIFBhcnNpbmcgaGFwcGVucyBpbiBmb3VyIHN0YWdlcy4gSW4gdGhlIGZpcnN0IHN0YWdlLCB3ZSByZXBsYWNlIGNlcnRhaW4KLy8gVW5pY29kZSBjaGFyYWN0ZXJzIHdpdGggZXNjYXBlIHNlcXVlbmNlcy4gSmF2YVNjcmlwdCBoYW5kbGVzIG1hbnkgY2hhcmFjdGVycwovLyBpbmNvcnJlY3RseSwgZWl0aGVyIHNpbGVudGx5IGRlbGV0aW5nIHRoZW0sIG9yIHRyZWF0aW5nIHRoZW0gYXMgbGluZSBlbmRpbmdzLgoKICAgICAgICAgICAgdGV4dCA9IFN0cmluZyh0ZXh0KTsKICAgICAgICAgICAgY3gubGFzdEluZGV4ID0gMDsKICAgICAgICAgICAgaWYgKGN4LnRlc3QodGV4dCkpIHsKICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoY3gsIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdcXHUnICsKICAgICAgICAgICAgICAgICAgICAgICAgKCcwMDAwJyArIGEuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgovLyBJbiB0aGUgc2Vjb25kIHN0YWdlLCB3ZSBydW4gdGhlIHRleHQgYWdhaW5zdCByZWd1bGFyIGV4cHJlc3Npb25zIHRoYXQgbG9vawovLyBmb3Igbm9uLUpTT04gcGF0dGVybnMuIFdlIGFyZSBlc3BlY2lhbGx5IGNvbmNlcm5lZCB3aXRoICcoKScgYW5kICduZXcnCi8vIGJlY2F1c2UgdGhleSBjYW4gY2F1c2UgaW52b2NhdGlvbiwgYW5kICc9JyBiZWNhdXNlIGl0IGNhbiBjYXVzZSBtdXRhdGlvbi4KLy8gQnV0IGp1c3QgdG8gYmUgc2FmZSwgd2Ugd2FudCB0byByZWplY3QgYWxsIHVuZXhwZWN0ZWQgZm9ybXMuCgovLyBXZSBzcGxpdCB0aGUgc2Vjb25kIHN0YWdlIGludG8gNCByZWdleHAgb3BlcmF0aW9ucyBpbiBvcmRlciB0byB3b3JrIGFyb3VuZAovLyBjcmlwcGxpbmcgaW5lZmZpY2llbmNpZXMgaW4gSUUncyBhbmQgU2FmYXJpJ3MgcmVnZXhwIGVuZ2luZXMuIEZpcnN0IHdlCi8vIHJlcGxhY2UgdGhlIEpTT04gYmFja3NsYXNoIHBhaXJzIHdpdGggJ0AnIChhIG5vbi1KU09OIGNoYXJhY3RlcikuIFNlY29uZCwgd2UKLy8gcmVwbGFjZSBhbGwgc2ltcGxlIHZhbHVlIHRva2VucyB3aXRoICddJyBjaGFyYWN0ZXJzLiBUaGlyZCwgd2UgZGVsZXRlIGFsbAovLyBvcGVuIGJyYWNrZXRzIHRoYXQgZm9sbG93IGEgY29sb24gb3IgY29tbWEgb3IgdGhhdCBiZWdpbiB0aGUgdGV4dC4gRmluYWxseSwKLy8gd2UgbG9vayB0byBzZWUgdGhhdCB0aGUgcmVtYWluaW5nIGNoYXJhY3RlcnMgYXJlIG9ubHkgd2hpdGVzcGFjZSBvciAnXScgb3IKLy8gJywnIG9yICc6JyBvciAneycgb3IgJ30nLiBJZiB0aGF0IGlzIHNvLCB0aGVuIHRoZSB0ZXh0IGlzIHNhZmUgZm9yIGV2YWwuCgogICAgICAgICAgICBpZiAoL15bXF0sOnt9XHNdKiQvCi50ZXN0KHRleHQucmVwbGFjZSgvXFwoPzpbIlxcXC9iZm5ydF18dVswLTlhLWZBLUZdezR9KS9nLCAnQCcpCi5yZXBsYWNlKC8iW14iXFxcblxyXSoifHRydWV8ZmFsc2V8bnVsbHwtP1xkKyg/OlwuXGQqKT8oPzpbZUVdWytcLV0/XGQrKT8vZywgJ10nKQoucmVwbGFjZSgvKD86Xnw6fCwpKD86XHMqXFspKy9nLCAnJykpKSB7CgovLyBJbiB0aGUgdGhpcmQgc3RhZ2Ugd2UgdXNlIHRoZSBldmFsIGZ1bmN0aW9uIHRvIGNvbXBpbGUgdGhlIHRleHQgaW50byBhCi8vIEphdmFTY3JpcHQgc3RydWN0dXJlLiBUaGUgJ3snIG9wZXJhdG9yIGlzIHN1YmplY3QgdG8gYSBzeW50YWN0aWMgYW1iaWd1aXR5Ci8vIGluIEphdmFTY3JpcHQ6IGl0IGNhbiBiZWdpbiBhIGJsb2NrIG9yIGFuIG9iamVjdCBsaXRlcmFsLiBXZSB3cmFwIHRoZSB0ZXh0Ci8vIGluIHBhcmVucyB0byBlbGltaW5hdGUgdGhlIGFtYmlndWl0eS4KCiAgICAgICAgICAgICAgICBqID0gZXZhbCgnKCcgKyB0ZXh0ICsgJyknKTsKCi8vIEluIHRoZSBvcHRpb25hbCBmb3VydGggc3RhZ2UsIHdlIHJlY3Vyc2l2ZWx5IHdhbGsgdGhlIG5ldyBzdHJ1Y3R1cmUsIHBhc3NpbmcKLy8gZWFjaCBuYW1lL3ZhbHVlIHBhaXIgdG8gYSByZXZpdmVyIGZ1bmN0aW9uIGZvciBwb3NzaWJsZSB0cmFuc2Zvcm1hdGlvbi4KCiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHJldml2ZXIgPT09ICdmdW5jdGlvbicgPwogICAgICAgICAgICAgICAgICAgIHdhbGsoeycnOiBqfSwgJycpIDogajsKICAgICAgICAgICAgfQoKLy8gSWYgdGhlIHRleHQgaXMgbm90IEpTT04gcGFyc2VhYmxlLCB0aGVuIGEgU3ludGF4RXJyb3IgaXMgdGhyb3duLgoKICAgICAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCdKU09OLnBhcnNlJyk7CiAgICAgICAgfTsKICAgIH0KfSgpKTsK"
        },
        "bkmrklt/nrama2.js": {
            "content_type": "application/javascript",
            "data": "LyoqCiAqIG5vdGUtby1yYW1hLCBzZWNvbmQgYXR0ZW1wdAogKiBDb3B5cmlnaHQgKGMpIDIwMTEgU3RlcGhlbiBBLiBCdXR0ZXJmaWxsCiAqCiAqIEZvciBkZXBlbmRlbmNpZXMgc2VlIGxpYi5qcwogKgogKiBUbyBydW4gYXMgYm9va21hcmtsZXQgKGNoYW5nZSB1cmw7IGRlbGV0ZSB0aGUgJ25vdycgcGFyYW0gaWYgbm90IGluIGRldmVsb3BlbnQgbW9kZSk6CiAqICAgamF2YXNjcmlwdDooZnVuY3Rpb24oKXtkZWxldGUgbW9kdWxlO2RlbGV0ZSBleHBvcnRzO19ucmFtYV9ia21rbHQ9dHJ1ZTtfbnJhbWFfdXNlcj0nc3RldmUnO2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JykpLnNyYz0naHR0cDovL2xvY2FsaG9zdDo1OTg0L25yYW1hL19kZXNpZ24vbnJhbWEvYmttcmtsdC9ucmFtYTIuanM/bm93PW5ldyBEYXRlKCkuZ2V0VGltZSgpJzsgfSkoKTsKICoKICogVG8gZW1iZWQgaW4gcGFnZToKICogICA8c2NyaXB0IHNyYz0nbGliLm1pbi5qcyIgPjwvc2NyaXB0PgogKiAgIDxzY3JpcHQ+CiAqICAgICBfbnJhbWFfYmtta2x0ID0gZmFsc2U7CiAqICAgPC9zY3JpcHQ+CiAqICAgPHNjcmlwdCBzcmM9Im5yYW1hMl9iYXNlLmpzIiA+PC9zY3JpcHQ+CiAqCiAqIFRvIHVzZSBhcyBhIGNvbW1vbkpTIG1vZHVsZSAoc2VlIG5lYXIgdGhlIGVuZCBmb3IgYSBsaXN0IG9mIGRlcGVuZGVuY2llcyk6CiAqICAgbnJhbWEgPSByZXF1aXJlKCcuL25yYW1hJyk7CiAqICAgCiAqIE5COiBucmFtYSB3aWxsIG9ubHkgd29yayBpZiB1c2VycyBhY2NlcHQgY29va2llcyBmcm9tIGFsbCB3ZWJzaXRlcyAoYmVjYXVzZSBYRE0gbmVlZGVkKQogKgogKiBUT0RPIC0tIGxvYWQgc2V0dGluZ3MgZnJvbSBzZXJ2ZXIgZm9yIGxvZ2dlZC1pbiB1c2VycwogKi8KCi8qCiAgICBUaGlzIGZpbGUgaXMgcGFydCBvZiBOb3RlLW8tcmFtYS4KCiAgICBOb3RlLW8tcmFtYSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgTm90ZS1vLXJhbWEgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIE5vdGUtby1yYW1hLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoqLwoKLyoqCiAqIFdyYXBwaW5nIGZvciBib3RoIDxzY3JpcHQ+IGFuZCBjb21tb25KUyByZXF1aXJlKCkgdXNlCiAqIFRoYW5rcyB0byBodHRwOi8vY2FvbGFubWNtYWhvbi5jb20vcG9zdHMvd3JpdGluZ19mb3Jfbm9kZV9hbmRfdGhlX2Jyb3dzZXIKICogVGhlIGZ1bmN0aW9uIG1heSBiZSBjYWxsZWQgd2l0aCBleHBvcnRzIHVuZGVmaW5lZCB0byBwcmV2ZW50IGV4ZWN1dGlvbiAodGhpcwogKiBpcyB0byBhbGxvdyBjaGVja2luZyBucmFtYSBub3QgYWxyZWFkeSBsb2FkZWQsIHNlZSBiZWxvdykuCiAqLwooZnVuY3Rpb24oZXhwb3J0cyl7CiAgICB2YXIgX05SQU1BX0xJQl9VUkwgPSAiaHR0cDovL2xvY2FsaG9zdDo1OTg0L25yYW1hL19kZXNpZ24vbnJhbWEvYmttcmtsdC9saWIubWluLmpzIjsgLy93aGVyZSB0byBsb2FkIGxpYiBmcm9tIChmb3IgYm9va21hcmtsZXQgb25seSkKCiAgICAvKioKICAgICAqIGZpeCB1dWlkcyBzbyB0aGF0IGl0IGRvZXNuJ3QgaW5jbHVkZSBkYXNoZXMgKG5vIGdvb2QgZm9yIGNvdWNoREIpCiAgICAgKiBhbHNvIGluY2x1ZGUgYSB0cmFpbGluZyBOIHRvIG1hcmsgdGhlIHNvdXJjZQogICAgICovCiAgICBleHBvcnRzLl9tYWtlX3V1aWQgPSBmdW5jdGlvbih1dWlkKSB7CiAgICAgICAgdmFyIG5ld191dWlkID0gZnVuY3Rpb24gKHVzZV9iMzYvKm9wdGlvbmFsKi8pewogICAgICAgICAgICBpZiggdXNlX2IzNiApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludCh1dWlkKCkucmVwbGFjZSgvLS9nLCcnKSwgMTYpLnRvU3RyaW5nKDM2KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAgdXVpZCgpLnJlcGxhY2UoLy0vZywnJykrJ04nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXdfdXVpZDsKICAgIH07CgogICAgLyoqCiAgICAgKiBUaGVzZSBhcmUgc29tZSBzZXR0aW5ncyBmb3IgZW1iZWRkZWQgbW9kZSAoYmttcmtsdCBvciA8c2NyaXB0PikuCiAgICAgKiBPdGhlcnMgYXJlIGFkZGVkIGR1cmluZyBpbml0IChzZWUgcGFnZV9pZCBhbmQgcm9vdF9ub2RlKS4KICAgICAqIFdoZW4gdXNlZCBvbiB0aGUgc2VydmVyLCBzb21lIHNldHRpbmdzIGFyZSBvdmVycmlkZW4uCiAgICAgKi8KICAgIGV4cG9ydHMuX21ha2Vfc2V0dGluZ3MgPSBmdW5jdGlvbihucmFtYV91dWlkKXsKICAgICAgICB2YXIgJCA9IGpRdWVyeTsKICAgICAgICB2YXIgc2V0dGluZ3MgPSB7CiAgICAgICAgICAgIC8vIC0tIGludGVybmFscwogICAgICAgICAgICBpc19lbWJlZGRlZCA6IHRydWUsICAgICAvL3NldCB0byBmYWxzZSB3aGVuIGJlaW5nIHVzZWQgb24gdGhlIHNlcnZlcgogICAgICAgICAgICBkZWJ1ZyA6IHRydWUsCiAgICAgICAgICAgIGRiX25hbWUgOiAnbnJhbWEnLAogICAgICAgICAgICAvL3hkbV91cmw6ICdodHRwOi8vbm90ZW9yYW1hLmlyaXNjb3VjaC5jb20vX2Rlc2lnbi9ucmFtYS9fcmV3cml0ZS94ZG0vcHJvdmlkZXIuaHRtbCcsCiAgICAgICAgICAgIHhkbV91cmwgOiAnaHR0cDovL2xvY2FsaG9zdDo1OTg0L25yYW1hL19kZXNpZ24vbnJhbWEvX3Jld3JpdGUveGRtL3Byb3ZpZGVyLmh0bWwnLAogICAgICAgICAgICAvL3hkbV91cmwgOiAnaHR0cDovL2xvY2FsaG9zdDo1OTg0L25yYW1hL19kZXNpZ24vbnJhbWEvX3Jld3JpdGUveGRtL3Byb3ZpZGVyLmRlYnVnLmh0bWwnLAogICAgICAgICAgICAvLyAtLSB1c2VyIGlkZW50aWZpY2F0aW9uCiAgICAgICAgICAgIHVzZXJfaWQgOiAnKicrbnJhbWFfdXVpZCh0cnVlKS5zbGljZSgwLDEwKSwgLy9kZWZhdWx0IHRvIHJhbmRvbSBhbm9ueW1vdXMgdXNlcgogICAgICAgICAgICBwYXNzd29yZCA6ICduZXcnLCAgIC8vVE9ETyB0aGluayBvZiBjbGV2ZXIgd2F5IHRvIHN0b3JlIHRoaXMKICAgICAgICAgICAgbWVfb25seSA6IHRydWUsICAgIC8vc2hvdyBvbmx5IG15IG5vdGVzIGFuZCBxdW90ZXMKICAgICAgICAgICAgLy8gLS0gcXVvdGVzICYgbm90ZSBzZXR0aW5ncwogICAgICAgICAgICBub3RlX2RlZmF1bHRfdGV4dCA6ICd0eXBlIG5vdycsCiAgICAgICAgICAgIGJhY2tncm91bmRfY29sb3IgOiAnI0ZDRjZDRicsICAgLy9mb3IgcXVvdGVzCiAgICAgICAgICAgIGJhY2tncm91bmRfY29sb3Jfb3RoZXIgOiAncmdiYSgyNDAsMjQwLDI0MCwwLjUpJywgICAvL2NvbG9yIGZvciBvdGhlciBwcGwncyBub3RlcyBhbmQgcXVvdGVzIChUT0RPKQogICAgICAgICAgICBub3RlX2JhY2tncm91bmRfY29sb3IgOiAncmdiYSgyNDAsMjQwLDI0MCwwLjkpJywgCiAgICAgICAgICAgIHBlcnNpc3Rfc3RhcnRlZF9jb2xvciA6ICcjRkZCRjAwJywgIC8vI0ZGQkYwMD1vcmFuZ2UKICAgICAgICAgICAgbm90ZV93aWR0aCA6IDE1MCwgLy9waXhlbHMKICAgICAgICAgICAgbWF4X3F1b3RlX2xlbmd0aCA6IDUwMDAsICAvL3VzZWZ1bCBiZWNhdXNlIHByZXZlbnRzCiAgICAgICAgICAgIC8vIC0tIHN0eWxpbmcKICAgICAgICAgICAgc3R5bGUgOiB7ICAgLy9hcHBsaWVzIHRvIG5vdGVfZWRpdG9yICYgZGlhbG9ncwogICAgICAgICAgICAgICAgZm9udEZhbWlseSA6ICJQYWxhdGlubywgJ1BhbGF0aW5vIExpbm90eXBlJywgR2VvcmdpYSwgVGltZXMsICdUaW1lcyBOZXcgUm9tYW4nLCBzZXJpZiIsCiAgICAgICAgICAgICAgICBmb250U2l6ZSA6ICcxMnB4JywKICAgICAgICAgICAgICAgIGNvbG9yIDogJ3JnYigwLDAsMCknCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG5vdGVfc3R5bGUgOiB7CiAgICAgICAgICAgICAgICAnYm9yZGVyJyA6ICcxcHggc29saWQnLAogICAgICAgICAgICAgICAgJ2JhY2tncm91bmQtY29sb3InIDogJ3JnYigyMjksMjI5LDI5OSknLCAgICAvL2RlZmF1bHQgaW4gY2FzZSBvcHRpb25zLm5vdGVfYmFja2dyb3VuZF9jb2xvciBmYWlscwogICAgICAgICAgICAgICAgJ2JvcmRlci1jb2xvcicgOiAnI0NEQzBCMCcsCiAgICAgICAgICAgICAgICAnYm94LXNoYWRvdycgOiAnMCAwIDhweCByZ2JhKDAsMCwwLDAuMiknLAogICAgICAgICAgICAgICAgJy1tb3otYm94LXNoYWRvdycgOiAnMCAwIDhweCByZ2JhKDAsMCwwLDAuMiknLAogICAgICAgICAgICAgICAgJy13ZWJraXQtYm94LXNoYWRvdycgOiAnMCAwIDhweCByZ2JhKDAsMCwwLDAuMiknLAogICAgICAgICAgICAgICAgJ3BhZGRpbmcnIDogJzNweCcsCiAgICAgICAgICAgICAgICAnY3Vyc29yJyA6ICdtb3ZlJywKICAgICAgICAgICAgICAgICdoZWlnaHQnIDogJ2F1dG8nLAogICAgICAgICAgICAgICAgJ3otaW5kZXgnIDogJzk5OTgnIC8vdHJ5IHRvIGVuc3VyZSBhbHdheXMgb24gdG9wCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG5vdGVfaW5uZXJfc3R5bGUgOiB7fSwKICAgICAgICAgICAgbm90ZV9lZGl0b3Jfc3R5bGUgOiB7CiAgICAgICAgICAgICAgICAnd3JhcCcgOiAnc29mdCcsCiAgICAgICAgICAgICAgICAncGFkZGluZy1sZWZ0JyA6ICcxcHgnLAogICAgICAgICAgICAgICAgJ3BhZGRpbmctdG9wJyA6ICcxcHgnLAogICAgICAgICAgICAgICAgJ3BhZGRpbmctcmlnaHQnIDogJzBweCcsCiAgICAgICAgICAgICAgICAncGFkZGluZy1ib3R0b20nIDogJzBweCcsCiAgICAgICAgICAgICAgICAnYm9yZGVyJyA6ICdub25lJywKICAgICAgICAgICAgICAgICdyZXNpemUnIDogJ25vbmUnLCAgICAgIC8vcmVtb3ZlIGRyYWdnYWJsZSByZXNpemUgaGFuZGxlIGluIGNocm9tZQogICAgICAgICAgICAgICAgJ2xpbmUtaGVpZ2h0JyA6ICcxLjNlbScsCiAgICAgICAgICAgICAgICAnYmFja2dyb3VuZC1jb2xvcicgOiAnaW5oZXJpdCcsCiAgICAgICAgICAgICAgICAndGV4dC1zaGFkb3cnIDogJzFweCAxcHggMjBweCByZ2JhKDI1MCwyNTAsMjUwLDEpLCAtMXB4IC0xcHggMjBweCByZ2JhKDI1MCwyNTAsMjUwLDEpLCAwIDAgMXB4IHJnYmEoMjUwLDI1MCwyNTAsMSknLAogICAgICAgICAgICAgICAgJy1tb3otdGV4dC1zaGFkb3cnIDogJzFweCAxcHggMjBweCByZ2JhKDI1MCwyNTAsMjUwLDEpLCAtMXB4IC0xcHggMjBweCByZ2JhKDI1MCwyNTAsMjUwLDEpLCAwIDAgMXB4IHJnYmEoMjUwLDI1MCwyNTAsMSknLAogICAgICAgICAgICAgICAgJy13ZWJraXQtdGV4dC1zaGFkb3cnIDogJzFweCAxcHggMjBweCByZ2JhKDI1MCwyNTAsMjUwLDEpLCAtMXB4IC0xcHggMjBweCByZ2JhKDI1MCwyNTAsMjUwLDEpLCAwIDAgMXB4IHJnYmEoMjUwLDI1MCwyNTAsMSknCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNpbXBsZW1vZGFsIDogewogICAgICAgICAgICAgICAgYXV0b1Jlc2l6ZTogdHJ1ZSwKICAgICAgICAgICAgICAgIG92ZXJsYXlDbG9zZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHpJbmRleCA6IDMyMDAwLAogICAgICAgICAgICAgICAgb3ZlcmxheUNzcyA6IHsgJ2JhY2tncm91bmQtY29sb3InIDogJyMwMDAnIH0sCiAgICAgICAgICAgICAgICBjb250YWluZXJDc3MgOiB7CiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0IDogJ2F1dG8nLAogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvciA6ICcjZmZmJywKICAgICAgICAgICAgICAgICAgICBib3JkZXI6ICc4cHggc29saWQgIzQ0NCcsCiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogJzEycHgnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb25TaG93IDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICBfLmRlbGF5KCBmdW5jdGlvbigpIHsgJCgnLnNpbXBsZW1vZGFsLWNvbnRhaW5lcicpLmNzcyh7aGVpZ2h0OidhdXRvJ30pOyB9LCA1MCApCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHNldHRpbmdzLm5vdGVfc3R5bGUud2lkdGggPSBzZXR0aW5ncy5ub3RlX3dpZHRoKyJweCI7CiAgICAgICAgc2V0dGluZ3Mubm90ZV9lZGl0b3Jfc3R5bGUud2lkdGggPSBzZXR0aW5ncy5ub3RlX3dpZHRoKyJweCI7CiAgICAgICAgJC5leHRlbmQoc2V0dGluZ3Mubm90ZV9lZGl0b3Jfc3R5bGUsIHNldHRpbmdzLnN0eWxlKTsKICAgICAgICAkLmV4dGVuZChzZXR0aW5ncy5zaW1wbGVtb2RhbC5jb250YWluZXJDc3MsIHNldHRpbmdzLnN0eWxlKTsKICAgICAgICByZXR1cm4gc2V0dGluZ3M7CiAgICB9OwogICAgICAgIAoKICAgIC8qKgogICAgICogY2F1dGlvbiA6IGlmIHNldHRpbmdzLmRlYnVnLCB0aGlzIHdpbGwgYWRkIHRvIHdpbmRvdyAoaWYgZGVmaW5lZCkKICAgICAqLwogICAgZXhwb3J0cy5fbWFrZV9kZWJ1ZyA9IGZ1bmN0aW9uKHNldHRpbmdzLCB3aW5kb3cpIHsKICAgICAgICB2YXIgJCA9IGpRdWVyeTsKICAgICAgICB2YXIgX2RlYnVnID0gZnVuY3Rpb24oKXt9OyAgICAvL2RvZXMgbm90aGluZyBpZiBub3QgZGVidWdnaW5nCiAgICAgICAgaWYoIHNldHRpbmdzLmRlYnVnICYmIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICkgewogICAgICAgICAgICAvL3dpbmRvdy4kPWpRdWVyeTsgICAgICAgICAgICAgICAgICAgICAgICAvLzwtLSBuYiBicmVha3Mgbm9Db25mbGljdAogICAgICAgICAgICBfZGVidWcgPSBmdW5jdGlvbiBfZGVidWcoKXsKICAgICAgICAgICAgICAgIHZhciBtYXBfb3JfYXJyYXkgPSBhcmd1bWVudHMubGVuZ3RoID09IDEgPyBhcmd1bWVudHNbMF0gOiBhcmd1bWVudHM7CiAgICAgICAgICAgICAgICAkLmVhY2gobWFwX29yX2FycmF5LCBmdW5jdGlvbihrZXksdmFsKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIGlzRmluaXRlKGtleSkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkgPSAnYScra2V5OyAgICAgIC8vYWxsb3dzIHVzIHRvIGhhbmRsZSBhcnJheXMKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiggdHlwZW9mICQubG9nID09PSAnZnVuY3Rpb24nICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5sb2coJ25yYW1hX2RlYnVnIHNldHRpbmcgJytrZXkrJz0nK3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3dba2V5XT12YWw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwogICAgICAgICAgICAvL2NvbnZlbmllbmNlIGNhbGxiYWNrIGZvciB0ZXN0aW5nIGFzeW5jCiAgICAgICAgICAgIHdpbmRvdy5jYiA9IGZ1bmN0aW9uKCl7ICQubG9nKCd3aW5kb3cuY2IgY2FsbGVkLCBzZW5kaW5nIGFyZ3VtZW50cyB0byBfZGVidWcnKTsgX2RlYnVnKGFyZ3VtZW50cyk7IH07IAogICAgICAgIH0KICAgICAgICByZXR1cm4gX2RlYnVnOwogICAgfTsKICAgIAogICAgLyoqCiAgICAgKiBjYXV0aW9uOiBleHRlbmRzICQKICAgICAqLwogICAgZXhwb3J0cy5fbWFrZV9sb2dnaW5nID0gZnVuY3Rpb24oc2V0dGluZ3MsICQpIHsKICAgICAgICB2YXIgbG9nZ2VyID0gZnVuY3Rpb24oKXsgcmV0dXJuIGZhbHNlOyB9OwogICAgICAgIGlmKCBzZXR0aW5ncy5kZWJ1ZyApIHsKICAgICAgICAgICAgbG9nZ2VyID0gZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIC8vIHdpbGwgbm90IGxvZyBhbnl0aGluZyB1bmxlc3MgaW4gZGVidWcgbW9kZQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGFyZ3MsIGZ1bmN0aW9uKGlkeCwgYXJnKXsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkLmV4dGVuZCh7ImxvZyI6bG9nZ2VyfSk7CiAgICAgICAgcmV0dXJuIGxvZ2dlcjsKICAgIH07CgogICAgLyoqCiAgICAgKiBAcmV0dXJucyB0aGUgcnBjIHRyYW5zcG9ydCBmb3IgeGRtIAogICAgICovCiAgICBleHBvcnRzLl9tYWtlX3JwYyA9IGZ1bmN0aW9uKHNldHRpbmdzLCBlYXN5WERNLCAkKSB7CiAgICAgICAgdmFyIHJwYyA9IHt9OwogICAgICAgIHJwYy4kID0gJDsKICAgICAgICAKICAgICAgICAvL2xvY2FsIGZ1bmN0aW9ucyBhbGxvdyBjb21tdW5pY2F0aW9uIGZyb20gdGhlIHNlcnZlciB0byB1c2VyCiAgICAgICAgdmFyIGxvY2FsID0ge307CiAgICAgICAgbG9jYWwuZ2V0X3ZlcnNpb24gPSB7CiAgICAgICAgICAgIG1ldGhvZCA6IGZ1bmN0aW9uKHN1Y2Nlc3MsIGVycm9yKXsgc3VjY2VzcygiMC4yIik7IH0KICAgICAgICB9OwogICAgICAgIGxvY2FsLm1zZyA9IHsKICAgICAgICAgICAgbWV0aG9kIDogZnVuY3Rpb24obWVzc2FnZSwgc3VjY2VzcywgZXJyb3IpewogICAgICAgICAgICAgICAgaWYoIHR5cGVvZiBtZXNzYWdlID09PSAnc3RyaW5nJyApIHsKICAgICAgICAgICAgICAgICAgICBhbGVydChtZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzKCdkb25lJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIGRpc3BsYXkgYSBkaWFsb2cgdXNpbmcgalF1ZXJ5LnNpbXBsZW1vZGFsLCBtaW5pbXNpbmcgeHNzIHZ1bG5lcmFiaWxpdGllcwogICAgICAgICAqLwogICAgICAgIGxvY2FsLm1vZGFsID0gewogICAgICAgICAgICBtZXRob2QgOiBmdW5jdGlvbihkaXZfc3RyLCBzdWNjZXNzLCBlcnJvcil7CiAgICAgICAgICAgICAgICBpZiggdHlwZW9mIGRpdl9zdHIgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRkaXYgPSBycGMuJCgnPGRpdj4nK2Rpdl9zdHIrJzwvZGl2PicpOwogICAgICAgICAgICAgICAgICAgIHJwYy4kKCcjaWRfb2snLCAkZGl2KS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJwYy4kLm1vZGFsLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MoJ29rJyk7ICAgICAgICAgIC8vbmIgdGhpcyBvbmx5IHRyaWdnZXJzIGNiIG9uIHJlbW90ZSBlbmQgKG5vIGZ1bmN0aW9uIGlzIHBhc3NlZCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkZGl2LmJlUmVzZXRDU1MoKS5tb2RhbChzZXR0aW5ncy5zaW1wbGVtb2RhbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHZhciBycGNfbmFtZXMgPSBbJ2RiX3NhdmVEb2MnLCAnZGJfcmVtb3ZlRG9jJywgJ2RiX2dldFZpZXcnLCAnZGJfZG9VcGRhdGUnLAogICAgICAgICAgICAgICAgICAgICAgICAgJ3Nlc3Npb25fbG9naW4nLCAnc2Vzc2lvbl9sb2dvdXQnLCAnc2Vzc2lvbl9pbmZvJ107CiAgICAgICAgdmFyIHJlbW90ZSA9IHsgfTsKICAgICAgICBycGMuJC5lYWNoKHJwY19uYW1lcywgZnVuY3Rpb24oaWR4LG5hbWUpewogICAgICAgICAgICByZW1vdGVbbmFtZV0gPSB7fTsgICAgICAvL2NyZWF0ZSBhIHN0dWIgICAgICAKICAgICAgICB9KTsKICAgICAgICBpZiggc2V0dGluZ3MuZGVidWcgKSB7CiAgICAgICAgICAgIHJlbW90ZS50ZXN0ID0ge307CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHZhciBfcnBjID0gbmV3IGVhc3lYRE0uUnBjKHsgcmVtb3RlOnNldHRpbmdzLnhkbV91cmwgfSx7IHJlbW90ZTpyZW1vdGUsIGxvY2FsOmxvY2FsIH0pOwogICAgICAgIC8vaWRlYWxseSBfcnBjIHdvdWxkIGJlIGFsbCB3ZSBuZWVkLCBidXQgc29tZSB0d2Vha2luZyBpcyBuZWVkZWQgLi4uCiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogZ2V0IHJwYyB0byB3b3JrIHdpdGgga2Fuc28uZGIgYW5kIGthbnNvLnNlc3Npb24gOiBjYWxsYmFjayBhcmd1bWVudHMgcGFzc2VkIGFzIGFuIGFycmF5LgogICAgICAgICAqIChTZWUgdGhlIGNvcnJlc3BvbmRpbmcgd3JhcHBlcnMgaW4geGRtL3Byb3ZpZGVyLmpzfGh0bWwgdG8gZ2V0IGZ1bGwgcGljdHVyZS4pCiAgICAgICAgICogd3JhcF91bmFycmF5IGlzIGZvciB1bmRvaW5nIHRoZSBlZmZlY3RzIG9mIGV4ZWN1dGluZyBjYWxsYmFja3Mgd2l0aCBhbGwgcGFyYW1ldGVycwogICAgICAgICAqIGNvbGxhcHNlZCBpbnRvIGFuIGFycmF5IChlYXN5WERNIG9ubHkgYWxsb3dzIGZvciBjYWxsYmFja3Mgd2l0aCBhIHNpbmdsZSBwYXJhbWV0ZXIpLgogICAgICAgICAqLwogICAgICAgIHZhciBfY2FsbGJhY2tfd3JhcHBlciA9IGZ1bmN0aW9uKGZuKXsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgbmV3X2FyZ3MgPSBhcmd1bWVudHNbMF07CiAgICAgICAgICAgICAgICBmbi5hcHBseShudWxsLCBuZXdfYXJncyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHZhciBfd3JhcF91bmFycmF5ID0gZnVuY3Rpb24oIG1ldGhvZCApIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCApIHsKICAgICAgICAgICAgICAgIHZhciBuZXdfYXJndW1lbnRzID0gXy5tYXAoYXJndW1lbnRzLCBmdW5jdGlvbihhcmcpewogICAgICAgICAgICAgICAgICAgIGlmKCB0eXBlb2YoYXJnKSA9PSAnZnVuY3Rpb24nICkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NhbGxiYWNrX3dyYXBwZXIoYXJnKTsgICAgLy93cmFwIGJlY2F1c2Ugd2UncmUgcHV0dGluZyBwYXJhbWV0ZXJzIGludG8gYXJyYXkgZm9yIHhkbQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJnOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBtZXRob2QuYXBwbHkobnVsbCwgbmV3X2FyZ3VtZW50cyk7ICAKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gZmluYWxseSwgYWRkIHRoZSBycGMgZnVuY3Rpb25zCiAgICAgICAgcnBjLiQuZWFjaChycGNfbmFtZXMsIGZ1bmN0aW9uKGlkeCxuYW1lKXsKICAgICAgICAgICAgcnBjW25hbWVdID0gX3dyYXBfdW5hcnJheSggX3JwY1tuYW1lXSApOyAgICAgIAogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIHJldHVybiBycGM7CiAgICB9OwogICAgCiAgICAKICAgIC8qKgogICAgICogQHJldHVybiBhIHN1YnNldCBvZiBrYW5zbydzIGRiIG1vZHVsZSwgc2FtZSBBUEkKICAgICAqIEFueSA0MDMgRm9yYmlkZGVuIGVycm9ycyB3aWxsIHRyaWdnZXIgYSBjdXN0b20gZXZlbnQsICducmFtYV80MDMnCiAgICAgKi8KICAgIGV4cG9ydHMuX21ha2VfZGIgPSBmdW5jdGlvbihycGMsICQpIHsKICAgICAgICB2YXIgZGIgPSB7fTsKICAgICAgICBkYi4kID0gJDsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiB3ZSB3YW50IHRvIGNhcHR1cmUgNDAzIChmb3JiaWRkZW4pIGVycm9ycyBzbyB0aGF0IHRoZSB1c2VyIGNhbiBsb2dpbgogICAgICAgICAqIGNhdXRpb24gOiBhc3N1bWVzIGxhc3QgYXJndW1lbnQgaXMgdGhlIHVuaXF1ZSBjYWxsYmFjayAoYXMgbm9kZSBqcykKICAgICAgICAgKi8KICAgICAgICB2YXIgX3dyYXBfNDAzX2NhbGxiYWNrID0gZnVuY3Rpb24oIGNhbGxiYWNrICkgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXJyb3IsIGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmKCBlcnJvciAmJiAoIGVycm9yLnN0YXR1cyA9PT0gNDAzIHx8IGVycm9yLmVycm9yID09PSAnZm9yYmlkZGVuJyApICkgewogICAgICAgICAgICAgICAgICAgIHZhciB1c2VyX2lkID0gJyc7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9pZCA9IGVycm9yLm1lc3NhZ2Uuc2xpY2UoZXJyb3IubWVzc2FnZS5pbmRleE9mKCd1c2VyX2lkOicpKzgpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkge30KICAgICAgICAgICAgICAgICAgICBkYi4kKGRvY3VtZW50KS50cmlnZ2VyKCducmFtYV80MDMnLCB1c2VyX2lkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgdmFyIF93cmFwXzQwMyA9IGZ1bmN0aW9uKCBmbiApIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgYXJnc1thcmdzLmxlbmd0aC0xXSA9IF93cmFwXzQwM19jYWxsYmFjayggYXJnc1thcmdzLmxlbmd0aC0xXSApOwogICAgICAgICAgICAgICAgcmV0dXJuIGZuLmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRiLnNhdmVEb2MgPSBfd3JhcF80MDMoIHJwYy5kYl9zYXZlRG9jICk7CiAgICAgICAgZGIucmVtb3ZlRG9jID0gX3dyYXBfNDAzKCBycGMuZGJfcmVtb3ZlRG9jICk7CiAgICAgICAgZGIuZ2V0VmlldyA9IF93cmFwXzQwMyggcnBjLmRiX2dldFZpZXcgKTsKICAgICAgICBkYi5kb1VwZGF0ZSA9IF93cmFwXzQwMyggcnBjLmRiX2RvVXBkYXRlICkKICAgICAgICAKICAgICAgICByZXR1cm4gZGI7CiAgICB9OwoKICAgIC8qKgogICAgICogQHJldHVybiBhIHN1YnNldCBvZiBrYW5zbydzIHNlc3Npb24gbW9kdWxlLCBzYW1lIEFQSQogICAgICovCiAgICBleHBvcnRzLl9tYWtlX3Nlc3Npb24gPSBmdW5jdGlvbihycGMpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsb2dpbiA6IHJwYy5zZXNzaW9uX2xvZ2luLAogICAgICAgICAgICBsb2dvdXQgOiBycGMuc2Vzc2lvbl9sb2dvdXQsCiAgICAgICAgICAgIGluZm8gOiBycGMuc2Vzc2lvbl9pbmZvIAogICAgICAgIH07CiAgICB9OwoKCiAgICAvKioKICAgICAqIEBwYXJhbSBkYntPYmplY3R9IGltcGxlbWVudHMgKGEgc3Vic2V0IG9mKSBrYW5zbydzIGRiIG1vZHVsZQogICAgICogQHBhcmFtIHNlc3Npb257T2JqZWN0fSBpbXBsZW1lbnRzIChhIHN1YnNldCBvZikga2Fuc28ncyBzZXNzaW9uIG1vZHVsZQogICAgICogQHBhcmFtIHV1aWR7ZnVuY3Rpb259IHJldHVybnMgYSB1dWlkIHN5bmNocm9uaW91c2x5CiAgICAgKi8KICAgIGV4cG9ydHMuX21ha2VfcGVyc2lzdCA9IGZ1bmN0aW9uKGRiLCBzZXNzaW9uLCB1dWlkLCBfZGVidWcpIHsKICAgICAgICBwZXJzaXN0ID0ge307CiAgICAgICAgcGVyc2lzdC4kID0galF1ZXJ5OwoKICAgICAgICAvL2xvZyBlcnJvcnMgKHVzZWQgdG8gd3JhcCBjYWxsYmFja3MgZnJvbSBkYiAmIHNlc3Npb24pCiAgICAgICAgdmFyIF9kZWJ1Z193cmFwID0gZnVuY3Rpb24obmFtZSwgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCBlcnJvciApIHsKICAgICAgICAgICAgICAgICAgICBfZGVidWcoe21zZzonbnJhbWFfJytuYW1lKyc6IGVycm9yJyxlcnJvcjplcnJvcn0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIAogICAgICAgIC8qKgogICAgICAgICAqIHNhdmUgYSBub3RlIG9yIGEgcXVvdGUgKG9yIHRoYXQgSlNPTi5zdHJpbmdpZnkgd2lsbCB3b3JrIG9uLCByZWFsbHkpLgogICAgICAgICAqIE5COiBJZiBzdWNjZXNzZnVsLCB3aWxsIHVwZGF0ZSBhIF9yZXYgcHJvcGVydHkgb24gdGhpbmcgYW5kIGluc2VydCBfaWQKICAgICAgICAgKiBOQjogaWYgb3B0aW9ucy5jbG9uZV9vbl9jb25mbGljdCwgQHBhcmFtIHRoaW5nIHdpbGwgaGF2ZSBpdHMgcHJvcGVydGllcyB1cGRhdGVkICBpbmNsLiBuZXcgX2lkCiAgICAgICAgICovCiAgICAgICAgcGVyc2lzdC5zYXZlID0gZnVuY3Rpb24odGhpbmcsIG9wdGlvbnMvKm9wdGlvbmFsKi8sIGNhbGxiYWNrLypyZXF1aXJlZCovICkgewogICAgICAgICAgICBpZiggIWNhbGxiYWNrICkgewogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zOwogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGRlZmF1bHRzID0gewogICAgICAgICAgICAgICAgY2xvbmVfb25fY29uZmxpY3QgOiBmYWxzZSAgIC8vZS5nLiBzZXQgdG8gdHJ1ZSB1c2VkIHdoZW4gc2F2aW5nIG5vdGVzCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHBlcnNpc3QuJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsKCiAgICAgICAgICAgIGRiLnNhdmVEb2ModGhpbmcsIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCBlcnJvciApIHsKICAgICAgICAgICAgICAgICAgICBpZiggc2V0dGluZ3MuY2xvbmVfb25fY29uZmxpY3QgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBlcnJvci5zdGF0dXMgPT0gNDA5IHx8IGVycm9yLmVycm9yID09ICJjb25mbGljdCIpICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJzaXN0LiQubG9nKCducmFtYV9wZXJzaXN0LnNhdmU6IGNvbmZsaWN0IG9uIHNhdmUgZm9yICcrKHRoaW5nLnR5cGUgfHwgJycpKycgJyt0aGluZy5faWQrJyAtLS0gc3RhcnRlZCBjbG9uaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJzaXN0LmNsb25lKHRoaW5nLCBjYWxsYmFjayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgX2RlYnVnKHttc2c6J25yYW1hX3BlcnNpc3Quc2F2ZTogZXJyb3InLGVycm9yOmVycm9yfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaW5nLl9yZXYgPSBkYXRhLnJldjsKICAgICAgICAgICAgICAgICAgICB0aGluZy5faWQgPSBkYXRhLmlkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGRhdGEpOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBjcmVhdGUgYW5kIHBlcnNpc3QgYSBjbG9uZSBvZiBhIG5vdGUgb3IgcXVvdGUsIHVwZGF0aW5nIHRoZQogICAgICAgICAqIHBhc3NlZCB0aGluZyBpbiBwbGFjZS4KICAgICAgICAgKi8KICAgICAgICBwZXJzaXN0LmNsb25lID0gZnVuY3Rpb24odGhpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBuZXdfaWQgPSB1dWlkKCk7CiAgICAgICAgICAgIHZhciB1cGRhdGVzID0gewogICAgICAgICAgICAgICAgX2lkIDogbmV3X2lkLAogICAgICAgICAgICAgICAgcmVwbGFjZXNfaWQgOiB0aGluZy5faWQgfTsKICAgICAgICAgICAgdmFyIGNsb25lZF90aGluZyA9IHBlcnNpc3QuJC5leHRlbmQodHJ1ZSwge30sIHRoaW5nLCB1cGRhdGVzKTsgCiAgICAgICAgICAgIGRlbGV0ZSBjbG9uZWRfdGhpbmcuX3JldjsgIC8vcmV2aXNpb24gaXMgbm8gbG9uZ2VyIHZhbGlkCiAgICAgICAgICAgIHBlcnNpc3Quc2F2ZShjbG9uZWRfdGhpbmcsIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpbmcgPSBjbG9uZWRfdGhpbmc7ICAgLy9tZXNzeQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsZGF0YSk7ICAgCiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIGFzc3VtZXMgdGhhdCB0aGluZy50eXBlIChlLmcuICdzb3VyY2UnKSBpcyB0aGUgbmFtZSBvZiB0aGUgY291Y2hkYiB1cGRhdGUgZnVuY3Rpb24KICAgICAgICAgKiB0aGluZyBtdXN0IGhhdmUgLnR5cGUgYW5kIC5faWQgYXR0cmlidXRlcwogICAgICAgICAqLwogICAgICAgIHBlcnNpc3QudXBkYXRlID0gZnVuY3Rpb24odGhpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGRiLmRvVXBkYXRlKCB0aGluZywgZW5jb2RlVVJJQ29tcG9uZW50KCB0aGluZy50eXBlICksIF9kZWJ1Z193cmFwKCdwZXJzaXN0LnVwZGF0ZScsIGNhbGxiYWNrKSApOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIGRlbGV0ZXMgYSBxdW90ZSBvciBub3RlIGZyb20gdGhlIHNlcnZlciBwcm92aWRpbmcgaXQgaGFzIGEgJ19yZXYnIHByb3BlcnR5LgogICAgICAgICAqIGlmIG5vIF9yZXYgcHJvcGVydHksIG5vdGhpbmcgaGFwcGVucyBidXQgdGhpcyBpcyBjYWxsYmFjaydlZCBhcyBzdWNjZXNzLgogICAgICAgICAqICAod2UgZXhwbG9pdCB0aGlzIC0tIGFic2VuY2Ugb2YgX3JldiBtZWFucyBpdCdzIG5vdCBiZWVuIHBlcnNpc3RlZCkKICAgICAgICAgKi8KICAgICAgICBwZXJzaXN0LnJtID0gZnVuY3Rpb24odGhpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGlmKCAhdGhpbmcuX3JldiApIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHsgZGVsZXRlZDpmYWxzZSwgbWVzc2FnZTonbnJhbWFfcGVyc2lzdC5ybSBkaWQgbm90IGRlbGV0ZSBiZWNhdXNlICcrKHRoaW5nLnR5cGUgfHwnJykrJyAnKyh0aGluZy5faWQgfHwgJycpKycgaGFzIG5vIF9yZXYnfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGIucmVtb3ZlRG9jKHRoaW5nLCBfZGVidWdfd3JhcCgncGVyc2lzdC5ybScsY2FsbGJhY2spKTsKICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBsb2FkcyBkYXRhIGZvciBhIHBhZ2UgKGUuZy4gYWxsIHF1b3RlcykKICAgICAgICAgKiBAcGFyYW0gb3B0aW9ucy5wYWdlX2lkIGlzIHRoZSBwYWdlIHRvIGxvYWQgc3R1ZmYgZm9yIChyZXF1aXJlZCkKICAgICAgICAgKiBAcGFyYW0gb3B0aW9ucy50eXBle1N0cmluZ30gc3BlY2lmaWVzIHdoaWNoIHR5cGUgb2Ygb2JqZWN0cyB0byBsb2FkIChyZXF1aXJlZCkKICAgICAgICAgKiBAcGFyYW0gb3B0aW9ucy51c2VyX2lke1N0cmluZ30gW29wdGlvbmFsXSBvbWl0IGlmIGxvYWRpbmcgZm9yIGFsbCB1c2VycwogICAgICAgICAqLwogICAgICAgIHBlcnNpc3QubG9hZCA9IGZ1bmN0aW9uKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBkZWZhdWx0cyA9IHsKICAgICAgICAgICAgICAgIHBhZ2VfaWQgOiB1bmRlZmluZWQsIHR5cGUgOiBudWxsLCB1c2VyX2lkIDogbnVsbCwKICAgICAgICAgICAgICAgIHN1Y2Nlc3MgOiBudWxsLCBlcnJvciA6IG51bGwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGxvYWRfc2V0dGluZ3MgPSBwZXJzaXN0LiQuZXh0ZW5kKHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7CiAgICAgICAgICAgIAogICAgICAgICAgICB2YXIgcXVlcnk7CiAgICAgICAgICAgIGlmKCAhbG9hZF9zZXR0aW5ncy50eXBlICkgewogICAgICAgICAgICAgICAgcXVlcnkgPSB7c3RhcnRrZXk6J1siJytsb2FkX3NldHRpbmdzLnBhZ2VfaWQrJyJdJywgZW5ka2V5OidbIicrbG9hZF9zZXR0aW5ncy5wYWdlX2lkKyciLHt9XSd9OwogICAgICAgICAgICB9IGVsc2UgeyAvL3R5cGUgaXMgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICBpZiggIWxvYWRfc2V0dGluZ3MudXNlcl9pZCApIHsKICAgICAgICAgICAgICAgICAgICBxdWVyeSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRrZXk6J1siJytsb2FkX3NldHRpbmdzLnBhZ2VfaWQrJyIsIicrbG9hZF9zZXR0aW5ncy50eXBlKyciXScsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZGtleTonWyInK2xvYWRfc2V0dGluZ3MucGFnZV9pZCsnIiwiJytsb2FkX3NldHRpbmdzLnR5cGUrJyIse31dJwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9IGVsc2UgeyAgICAvL3R5cGUgYW5kIHVzZXJfaWQgYXJlIHNwZWNpZmllZAogICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0ge2tleTonWyInK2xvYWRfc2V0dGluZ3MucGFnZV9pZCsnIiwiJytsb2FkX3NldHRpbmdzLnR5cGUrJyIsIicrbG9hZF9zZXR0aW5ncy51c2VyX2lkKyciXScgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBkYi5nZXRWaWV3KCdwYWdlSWRfdHlwZV91c2VySWQnLCBxdWVyeSwgX2RlYnVnX3dyYXAoJ3BlcnNpc3QubG9hZCcsY2FsbGJhY2spKTsKICAgICAgICB9OwogICAgCiAgICAgICAgcmV0dXJuIHBlcnNpc3Q7CiAgICB9OwoKCiAgICAvKioKICAgICAqIFdheXMgb2Ygc2VyaWFsaXppbmcgYW5kIHJlc3RvcmluZyByYW5neSByYW5nZSBvYmplY3RzLgogICAgICogVGhlc2Ugd291bGQgaWRlYWxseSB3b3JrIGFjcm9zcyBicm93c2VyczsgcmFuZ3lfMV8yIGNsYWltcyBub3QgdG8uICAKICAgICAqIChIYXZpbmcgbXVsdGlwbGUgd2F5cyBhbGxvdyB1cyB0byB1cGdyYWRlIHRoZSBtZXRob2Qgb2Ygc2VyaWFsaXphdGlvbgogICAgICogd2hpbGUgc3RpbGwgYmVpbmcgYWJsZSB0byBjb3JyZWN0bHkgZGVzZXJpYWxpemUgcXVvdGVzIGNyZWF0ZWQgd2l0aCBvbGRlcgogICAgICogbWV0aG9kcy4pCiAgICAgKiBAcGFyYW0gbGlie21hcH0gcHJvdmlkZXMgcmFuZ3kKICAgICAqLwogICAgZXhwb3J0cy5fbWFrZV9zZXJpYWxpemVycyA9IGZ1bmN0aW9uKHNldHRpbmdzLCBsaWIpewogICAgICAgIHZhciBzZXJpYWxpemVycyA9IHsKICAgICAgICAgICAgcmFuZ3lfMV8yIDogewogICAgICAgICAgICAgICAgaWQgOiAncmFuZ3lfMV8yJywgICAvLyBpZCBtdXN0IG1hdGNoIHRoZSBuYW1lCiAgICAgICAgICAgICAgICBzZXJpYWxpemUgOiBmdW5jdGlvbihyYW5nZSkgewogICAgICAgICAgICAgICAgICAgIC8vIHNlY29uZCBwYXJhbSBtZWFucyBkbyBub3QgY29tcHV0ZSBjaGVja3N1bSAoYmVjYXVzZSBhZGRpbmcgaGlnaGxpZ2h0cyB0byBwYWdlIHNjcmV3cyBpdCB1cCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGliLnJhbmd5LnNlcmlhbGl6ZVJhbmdlKHJhbmdlLCB0cnVlLCBzZXR0aW5ncy5yb290X25vZGUpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlc2VyaWFsaXplIDogZnVuY3Rpb24odGV4dCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBsaWIucmFuZ3kuZGVzZXJpYWxpemVSYW5nZSh0ZXh0LCBzZXR0aW5ncy5yb290X25vZGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNlcmlhbGl6ZXJzLmN1cnJlbnQgPSBzZXJpYWxpemVycy5yYW5neV8xXzI7ICAgLy8gdGhlIHNlcmlhbGl6ZXIgdG8gYmUgdXNlZCBpbiBjcmVhdGluZyBuZXcgcXVvdGVzCiAgICAgICAgcmV0dXJuIHNlcmlhbGl6ZXJzOwogICAgfTsKCgoKICAgIC8qKgogICAgICogZm9yIGVhY2ggcGFnZV9pZCB3aXRoIG5vdGVzLCBlYWNoIHVzZXIgbXVzdCBjcmVhdGUgYSBzb3VyY2UuICAKICAgICAqICBAcGFyYW0gbGlie21hcH0gcHJvdmlkZXMgZGVwZW5kZW5jaWVzIDogCiAgICAgKiAgICAtIGI2NF9obWFjX21kNSAgICBmcm9tIG1kNS5qcyAKICAgICAqICAgIC0gQmlidGV4UGFyc2VyICAgIGZyb20gYmlidGV4LmpzCiAgICAgKiAgICAtICQgICAgICAgICAgICAgICBmcm9tIGpRdWVyeQogICAgICovCiAgICBleHBvcnRzLl9tYWtlX3NvdXJjZXMgPSBmdW5jdGlvbihzZXR0aW5ncywgcGVyc2lzdCwgX2RlYnVnLCBsaWIvKm9wdGlvbmFsKi8pIHsKICAgICAgICB2YXIgc291cmNlcyA9IHt9OwogICAgICAgIGxpYi4kLmV4dGVuZChzb3VyY2VzLCBsaWIpOyAvL2FkZCBsaWIuYjY0X2htYWNfbWQ1IGV0YyB0byBzb3VyY2VzCiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybnMgdGhlIGlkIG9mIGEgc291cmNlIHJlY29yZCBmb3IgdGhlIHVzZXIgYW5kIHBhZ2UKICAgICAgICAgKiBAcGFyYW0gb3ttYXB9IHNob3VsZCBjb250YWluIHVzZXJfaWQgYW5kIHBhZ2VfaWQKICAgICAgICAgKi8KICAgICAgICBzb3VyY2VzLmNhbGN1bGF0ZV9pZCA9IGZ1bmN0aW9uKG8pIHsKICAgICAgICAgICAgcmV0dXJuICdzb3VyY2VfJytzb3VyY2VzLmI2NF9obWFjX21kNShvLnVzZXJfaWQsIG8ucGFnZV9pZCk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0gYXR0cnMgbXVzdCBjb250YWluIHBhZ2VfaWQgJiB1c2VyX2lkIDsgY2FuIGJlIG5vdGUgb3IgcXVvdGUKICAgICAgICAgKi8KICAgICAgICBzb3VyY2VzLmNyZWF0ZSA9IGZ1bmN0aW9uKGF0dHJzKSB7CiAgICAgICAgICAgIHZhciBkZWZhdWx0cyA9IHsKICAgICAgICAgICAgICAgIHRhZ3MgOiBbXSAgICAgLy90aGUgcGVyc2lzdC51cGRhdGUgd2lsbCBhcHBlbmQsIG5vdCByZW1vdmUgdGFncwogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiggc2V0dGluZ3MuaXNfZW1iZWRkZWQgKSB7CiAgICAgICAgICAgICAgICBkZWZhdWx0cy5wYWdlX3RpdGxlID0gZG9jdW1lbnQudGl0bGU7CiAgICAgICAgICAgICAgICBkZWZhdWx0cy51cmwgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBzb3VyY2UgPSBzb3VyY2VzLiQuZXh0ZW5kKHRydWUsIGRlZmF1bHRzLCBhdHRycyk7CiAgICAgICAgICAgIHNvdXJjZS5faWQgPSBzb3VyY2VzLmNhbGN1bGF0ZV9pZChzb3VyY2UpOyAgLy9uYiBtdXN0IG92ZXJ3cml0ZSBfaWQgaW4gY2FzZSBjYWxsZWQgd2l0aCBub3RlIG9yIHF1b3RlIG9iamVjdCEKICAgICAgICAgICAgc291cmNlLnR5cGUgPSAnc291cmNlJzsKICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlIG9yIHVwZGF0ZSBhIHNvdXJjZS4KICAgICAgICAgKiBAcGFyYW0gc291cmNlIG11c3QgY29udGFpbiAoVElUTEUgb3IgcGFnZV90aXRsZSksIHVybCwgcGFnZV9pZAogICAgICAgICAqICAgICAgJiB1c2VyX2lkIGlmIHVwZGF0ZSBpcyBiZWluZyBjYWxsZWQgdG8gY3JlYXRlIGEgbmV3IHNvdXJjZQogICAgICAgICAqIENhbiBiZSBjYWxsZWQgd2l0aCBlaXRoZXIgYSBzb3VyY2Ugb3IgYSBub3RlIG9yIGEgcXVvdGUKICAgICAgICAgKiBDYXV0aW9uOiBpZiBjYWxsZWQgd2l0aCBzb3VyY2UsIHNvdXJjZSB3aWxsIGJlIG1vZGlmaWVkIGluIHBsYWNlLgogICAgICAgICAqLwogICAgICAgIHNvdXJjZXMudXBkYXRlID0gZnVuY3Rpb24odGhpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBzb3VyY2UgPSAoIHRoaW5nLnR5cGUgPT0gJ3NvdXJjZScgPyB0aGluZyA6IHNvdXJjZXMuY3JlYXRlKHRoaW5nKSApOwogICAgICAgICAgICBwZXJzaXN0LnVwZGF0ZShzb3VyY2UsIGNhbGxiYWNrKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIGNhbGwgdXBkYXRlIG9uY2UgcGVyIHNvdXJjZSBvbmx5IChidXQgaWYgaXQgZmFpbHMsIHdpbGwgcmVwZWF0IG5leHQKICAgICAgICAgKiB0aW1lIGl0IGlzIGNhbGxlZCkKICAgICAgICAgKiBjYW4gYmUgY2FsbGVkIHdpdGggZWl0aGVyIGEgc291cmNlIG9yIGEgbm90ZSBvciBhIHF1b3RlIAogICAgICAgICAqLwogICAgICAgIHZhciBfdXBkYXRlX21lbW8gPSBbXTsKICAgICAgICBzb3VyY2VzLnVwZGF0ZV9vbmNlID0gZnVuY3Rpb24odGhpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBzb3VyY2VfaWQgPSAoIHRoaW5nLnR5cGUgPT0gJ3NvdXJjZScgPyB0aGluZy5faWQgOiB0aGluZy5zb3VyY2VfaWQgKTsKICAgICAgICAgICAgdmFyIGFscmVhZHlfZG9uZSA9ICggc291cmNlcy5fLmluZGV4T2YoX3VwZGF0ZV9tZW1vLCBzb3VyY2VfaWQpICE9IC0xICk7CiAgICAgICAgICAgIGlmKCBhbHJlYWR5X2RvbmUgICkgewogICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgJ2FscmVhZHkgZG9uZScpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNvdXJjZXMudXBkYXRlKHRoaW5nLCBmdW5jdGlvbihlcnJvciwgZGF0YSl7CiAgICAgICAgICAgICAgICBpZighZXJyb3IpewogICAgICAgICAgICAgICAgICAgIF91cGRhdGVfbWVtby5wdXNoKHNvdXJjZV9pZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgZGF0YSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogVGhpcyBzaG91bGQgcmV0dXJuIGFuIGFycmF5IG9mIHN0cmluZ3Mgd2hpY2ggY2Fub25pY2FsbHkgcmVwcmVzZW50IGF1dGhvcnMKICAgICAgICAgKiBAcGFyYW0gYXV0aG9yc3tzdHJpbmd9IGlzIHRoZSBhdXRob3JzLgogICAgICAgICAqIFRPRE86IG1ha2UgdGhpcyB3b3JrIChzZWUganMtYmlidGV4PykKICAgICAgICAgKi8KICAgICAgICB2YXIgX3BhcnNlX2F1dGhvcnMgPSBmdW5jdGlvbiggYXV0aG9ycy8qU3RyaW5nKi8gKSB7CiAgICAgICAgICAgIF9kZWJ1Zyh7YXV0aG9yczphdXRob3JzfSk7CiAgICAgICAgICAgIHJldHVybiBhdXRob3JzLnNwbGl0KCcgYW5kICcpOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogcXVpY2tseSBhdHRlbXB0IHRvIGd1ZXNzIHdoZXRoZXIgc29tZXRoaW5nIGlzIGJpYnRleAogICAgICAgICAqLwogICAgICAgIC8vIGxpa2UgdGhpczogQHRleHQgeyA9ICwgfQogICAgICAgIHZhciBfYmliX3JleCA9IC8oXnxbXjAtOUEtWiZcL1w/XSspKEApKFswLTlBLVpfXSpbQS1aX10rW2EtejAtOV9dKikoW1xzXFNdKj97KShbXHNcU10qPz0pKFtcc1xTXSo/LCkoW1xzXFNdKj99KS9naQogICAgICAgIHNvdXJjZXMuZGV0ZWN0X2JpYnRleCA9IGZ1bmN0aW9uKCB0ZXh0ICkgewogICAgICAgICAgICByZXR1cm4gISEoIHRleHQubWF0Y2goX2JpYl9yZXgpICk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIGdpdmVuIGEgc3RyaW5nLCBhdHRlbXB0cyB0byBwYXJzZSBpdCBhcyBiaWJ0ZXggYW5kIHVwZGF0ZSB0aGUgc291cmNlCiAgICAgICAgICogd2l0aCB0aGUgcmVzdWx0cy4KICAgICAgICAgKiBAcGFyYW0gdGhpbmcgY2FuIGJlIGEgc291cmNlLCBxdW90ZSBvciBub3RlCiAgICAgICAgICogRS5nLgogICAgICAgICAqICAgYj0nQGluY29sbGVjdGlvbntCYWlsbGFyZ2VvbjoxOTk1bHUsCUFkZHJlc3MgPSB7T3hmb3JkfSwJQXV0aG9yID0ge0JhaWxsYXJnZW9uLCBSZW57XCdlfWUgYW5kIEtvdG92c2t5LCBMYXVyYSBhbmQgTmVlZGhhbSwgQW15fSwJQm9va3RpdGxlID0ge0NhdXNhbCBjb2duaXRpb24uIEEgbXVsdGlkaXNjaXBsaW5hcnkgZGViYXRlfSwJRGF0ZS1BZGRlZCA9IHsyMDEwLTA4LTA0IDE3OjQwOjIxICswMTAwfSwJRGF0ZS1Nb2RpZmllZCA9IHsyMDEwLTA4LTA0IDE3OjQwOjM4ICswMTAwfSwJRWRpdG9yID0ge1NwZXJiZXIsIERhbiBhbmQgUHJlbWFjaywgRGF2aWR9LAlQYWdlcyA9IHs3OS0xMTV9LAlQdWJsaXNoZXIgPSB7Q2xhcmVuZG9ufSwJVGl0bGUgPSB7VGhlIEFjcXVpc2l0aW9uIG9mIFBoeXNpY2FsIEtub3dsZWRnZSBJbiBJbmZhbmN5fSwJWWVhciA9IHsxOTk1fX0nCiAgICAgICAgICovCiAgICAgICAgc291cmNlcy51cGRhdGVfZnJvbV9iaWJ0ZXggPSBmdW5jdGlvbihiaWJfc3RyLCB0aGluZywgY2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBzb3VyY2VzLkJpYnRleFBhcnNlcigpOwogICAgICAgICAgICB2YXIgcmVzdWx0czsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHBhcnNlci5zZXRJbnB1dChiaWJfc3RyKTsKICAgICAgICAgICAgICAgIHBhcnNlci5iaWJ0ZXgoKTsKICAgICAgICAgICAgICAgIHJlc3VsdHMgPSBwYXJzZXIuZ2V0RW50cmllcygpOwogICAgICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgICAgIF9kZWJ1ZygiY2F1Z2h0IGVycm9yIHBhcnNpbmcgYmlidGV4IixlKQogICAgICAgICAgICAgICAgY2FsbGJhY2soJ2Vycm9yIHBhcnNpbmcgYmlidGV4ICcrZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoIHNvdXJjZXMuXy5zaXplKHJlc3VsdHMpICE9IDEgKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjaygnbnJhbWFfc291cmNlcy5wYXJzZV9iaWJ0ZXg6IGlucHV0IGNvbnRhaW5lZCAnK3NvdXJjZXMuXy5zaXplKHJlc3VsdHMpKycgZW50cmllcyAoJytiaWJfc3RyKycpJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGVudHJ5ID0gc291cmNlcy5fLnRvQXJyYXkocmVzdWx0cylbMF07CiAgICAgICAgICAgIGlmKCBlbnRyeS5BVVRIT1IgKSB7CiAgICAgICAgICAgICAgICBlbnRyeS5BVVRIT1JfVEVYVCA9IGVudHJ5LkFVVEhPUjsKICAgICAgICAgICAgICAgIGVudHJ5LkFVVEhPUiA9IF9wYXJzZV9hdXRob3JzKGVudHJ5LkFVVEhPUl9URVhUKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbnRyeS5iaWJ0ZXggPSBiaWJfc3RyOwogICAgICAgICAgICB2YXIgc291cmNlID0gc291cmNlcy5jcmVhdGUodGhpbmcpOwogICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2VzLiQuZXh0ZW5kKHRydWUsIHt9LCBzb3VyY2UsIGVudHJ5KTsKICAgICAgICAgICAgc291cmNlcy51cGRhdGUoc291cmNlLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gc291cmNlczsKICAgIH07CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBUaGlzIGlzIG9ubHkgaW50ZW5kZWQgdG8gd29yayBlbWJlZGRlZCBpbiBhIHBhZ2UsIG5vdCBvbiB0aGUgc2VydmVyLgogICAgICogbGliIG11c3QgaW5jbHVkZQogICAgICAgICAgICBiNjRfaG1hY19tZDUgCiAgICAgICAgICAgIHJhbmd5IAogICAgICAgICAgICAkICggalF1ZXJ5ICkKICAgICAgICAgICAgXyA6IHdpbmRvdy5fCiAgICAgKi8KICAgIGV4cG9ydHMuX21ha2VfcXVvdGVzID0gZnVuY3Rpb24oc2V0dGluZ3MsIHV1aWQsIHBlcnNpc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXMsIHNlcmlhbGl6ZXJzLCBfZGVidWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYikgewogICAgICAgIHZhciBxdW90ZXMgPSB7fTsKICAgICAgICBsaWIuJC5leHRlbmQocXVvdGVzLCBsaWIpOyAgLy9hZGQgaXRlbXMgaW4gbGliIHRvIHF1b3RlcwoKICAgICAgICAvKioKICAgICAgICAgKiBAcmV0dXJucyBhIGhhc2ggZm9yIGRldGVybWluaW5nIHdoZXRoZXIgdHdvIHF1b3RlcyBhcmUgdGhlIHNhbWUKICAgICAgICAgKiAgICAgYWNyb3NzIGRpZmZlcmVudCB1c2Vycy4KICAgICAgICAgKi8KICAgICAgICBxdW90ZXMuY2FsY3VsYXRlX2hhc2ggPSBmdW5jdGlvbihxdW90ZSkgewogICAgICAgICAgICB2YXIgaGFzaCA9IHF1b3Rlcy5iNjRfaG1hY19tZDUocXVvdGUucGFnZV9pZCwgcXVvdGUuY29udGVudCk7CiAgICAgICAgICAgIHJldHVybiBoYXNoOwogICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIEBwYXJhbSByYW5nZSBpcyBhIFJhbmd5IHJhbmdlIG9iamVjdAogICAgICAgICAqLwogICAgICAgIHF1b3Rlcy5jcmVhdGUgPSBmdW5jdGlvbihyYW5nZSkgewogICAgICAgICAgICB2YXIgbmV3X3F1b3RlID0gewogICAgICAgICAgICAgICAgX2lkIDogJ3FfJyt1dWlkKCksICAKICAgICAgICAgICAgICAgIHR5cGUgOiAncXVvdGUnLAogICAgICAgICAgICAgICAgY29udGVudCA6IHF1b3Rlcy4kLnRyaW0oIHJhbmdlLnRvU3RyaW5nKCkgKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRfY29sb3IgOiBzZXR0aW5ncy5iYWNrZ3JvdW5kX2NvbG9yLAogICAgICAgICAgICAgICAgdXJsIDogZG9jdW1lbnQubG9jYXRpb24uaHJlZiwKICAgICAgICAgICAgICAgIHBhZ2VfaWQgOiBzZXR0aW5ncy5wYWdlX2lkLCAgCiAgICAgICAgICAgICAgICBwYWdlX3RpdGxlIDogZG9jdW1lbnQudGl0bGUsCiAgICAgICAgICAgICAgICAvL3RoZSB4cG9pbnRlciB0byB0aGUgcXVvdGUgKHdlbGwsIGl0IGlzbid0IGFjdHVhbGx5IGFuIHhwb2ludGVyIGJ1dCAgYW55IHNlcmlhbGl6ZWQgcmVwcmVzZW50YXRpb24gb2YgdGhlIHJhbmVnKQogICAgICAgICAgICAgICAgeHB0ciA6IHNlcmlhbGl6ZXJzLmN1cnJlbnQuc2VyaWFsaXplKHJhbmdlKSwKICAgICAgICAgICAgICAgIC8vdGhlIG5hbWUgb2YgdGhlIG1ldGhvZCB1c2VkIHRvIHNlcmFsaXNlCiAgICAgICAgICAgICAgICB4cHRyX21ldGhvZCA6IHNlcmlhbGl6ZXJzLmN1cnJlbnQuaWQsCiAgICAgICAgICAgICAgICBwYWdlX29yZGVyIDogcXVvdGVzLmNhbGN1bGF0ZV9wYWdlX29yZGVyKHJhbmdlKSwKICAgICAgICAgICAgICAgIGNyZWF0ZWQgOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSwKICAgICAgICAgICAgICAgIHVwZGF0ZWQgOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSwKICAgICAgICAgICAgICAgIHVzZXJfaWQgOiBzZXR0aW5ncy51c2VyX2lkCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG5ld19xdW90ZS5oYXNoID0gcXVvdGVzLmNhbGN1bGF0ZV9oYXNoKG5ld19xdW90ZSk7CiAgICAgICAgICAgIG5ld19xdW90ZS5zb3VyY2VfaWQgPSBzb3VyY2VzLmNhbGN1bGF0ZV9pZCh7CiAgICAgICAgICAgICAgICB1c2VyX2lkIDogbmV3X3F1b3RlLnVzZXJfaWQsCiAgICAgICAgICAgICAgICBwYWdlX2lkIDogbmV3X3F1b3RlLnBhZ2VfaWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBuZXdfcXVvdGU7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBxdW90ZXMuc2F2ZSA9IGZ1bmN0aW9uKHF1b3RlLCBvcHRpb25zLypvcHRpb25hbCovLCBjYWxsYmFjaykgewogICAgICAgICAgICBpZiggIWNhbGxiYWNrICkgewogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zOwogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vdXBkYXRlIHRoZSBzb3VyY2UgYmVmb3JlIHNhdmluZyBhbnkgcXVvdGVzCiAgICAgICAgICAgIHNvdXJjZXMudXBkYXRlX29uY2UocXVvdGUsIGZ1bmN0aW9uKGVycm9yLCBkYXRhKSB7CiAgICAgICAgICAgICAgICBpZiggZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgcXVvdGVzLiQubG9nKCdlcnJvciBpbiBucmFtYV9xdW90ZXMuc2F2ZSBpcyBkdWUgdG8gY2FsbCB0byBzb3VyY2VzLnVwZGF0ZV9vbmNlLicpCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGRhdGEpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBlcnNpc3Quc2F2ZShxdW90ZSwgb3B0aW9ucywgY2FsbGJhY2spOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIGF0dGVtcHQgdG8gaGlnaGxpZ2h0IHF1b3RlIGludG8gdGhlIEhUTUwgZG9jdW1lbnQuICBNYXkgZmFpbCBpZiByYW5nZQogICAgICAgICAqIGNhbm5vdCBiZSBkZWNvZGVkOyBmYWlscyBzaWxlbnRseS4gIE5vZGVzIGFkZGVkIHRvIHRoZSBET00gd2lsbCBoYXZlIHRoZQogICAgICAgICAqIHF1b3RlIG9iamVjdCBzdG9yZWQgd2l0aCBqUXVlcnkuZGF0YSAoa2V5OiducmFtYV9xdW90ZScpCiAgICAgICAgICoKICAgICAgICAgKiBDaGVja3MgdGhhdCBxdW90ZSBub3QgYWxyZWFkeSBvbiBwYWdlOyB3aWxsIG5vdCByZS1kaXNwbGF5IGlmIGl0IGlzLgogICAgICAgICAqCiAgICAgICAgICogZGVwZW5kcyBSYW5neSArIGl0cyBoaWdobGlnaHQgbW9kdWxlCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHN1Y2Nlc3NmdWwgKG9yIHF1b3RlIGFscmVhZHkgZGlzcGxheWVkKSwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgICAgICovCiAgICAgICAgcXVvdGVzLmRpc3BsYXkgPSBmdW5jdGlvbihxdW90ZSkgewogICAgICAgICAgICBpZiggcXVvdGVzLiQoJy4nK3F1b3RlLl9pZCkubGVuZ3RoICE9IDAgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsgIC8vcXVvdGUgYWxyZWFkeSBkaXNwbGF5ZWQKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcmFuZ2UgPSBxdW90ZXMuZ2V0X3JhbmdlKHF1b3RlKTsKICAgICAgICAgICAgaWYoIHJhbmdlID09IG51bGwgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIF9yYW5neV9oaWdobGlnaHRlciA9IHF1b3Rlcy5yYW5neS5jcmVhdGVDc3NDbGFzc0FwcGxpZXIoIl9ucmFtYS1xdW90ZSAiK3F1b3RlLl9pZCxmYWxzZSk7CiAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgIF9yYW5neV9oaWdobGlnaHRlci5hcHBseVRvUmFuZ2UocmFuZ2UpOwogICAgICAgICAgICB9IGNhdGNoKGVycm9yKSB7IC8vc2VlbXMgdG8gYmUgcmFyZQogICAgICAgICAgICAgICAgaWYoIHNldHRpbmdzLmRlYnVnICkgewogICAgICAgICAgICAgICAgICAgIHF1b3Rlcy4kLmxvZygibnJhbWE6IGVycm9yIHVzaW5nIFJhbmR5J3MgY3JlYXRlQ3NzQ2xhc3NBcHBsaWVyLmFwcGx5VG9SYW5nZSwgcmUtdGhyb3dpbmciKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAgIC8vc2lsZW50bHkgZmFpbCBpZiBub3QgaW4gZGVidWcgbW9kZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHF1b3Rlcy4kKCcuJytxdW90ZS5faWQpLmNzcygnYmFja2dyb3VuZC1jb2xvcicscXVvdGUuYmFja2dyb3VuZF9jb2xvcikuZGF0YSgnbnJhbWFfcXVvdGUnLHF1b3RlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiByZW1vdmUgYSBxdW90ZSdzIGhpZ2hsaWdodHMgZnJvbSB0aGUgSFRNTCBkb2N1bWVudC4KICAgICAgICAgKiBsZWF2ZXMgalF1ZXJ5LmRhdGEoJ25yYW1hX3F1b3RlJykgYW5kIF9pZCBhcyBjbGFzcyBpbnRhY3QsIHNvIHF1b3RlIGNhbgogICAgICAgICAqICAgc3RpbGwgYmUgZm91bmQgKHRvZG86IG5vdCBzdXJlIHRoaXMgaXMgYSBnb29kIGlkZWEhKS4KICAgICAgICAgKiB0b2RvIC0tIHRoaXMgd291bGQgaWRlYWxseSByZW1vdmUgdGhlIGVsZW1lbnRzIHNvIHRoYXQgc3Vic2VxdWVudCBxdW90ZXMKICAgICAgICAgKiAgaGFkIG1vcmUgcmVsaWFibGUgeHBvaW50ZXJzIChhcyBsb25nIGFzIHdlIGRvbid0IGhhdmUgYSB3YXkgb2YgZ2V0dGluZwogICAgICAgICAqICBnb29kIHhwb2ludGVycykuCiAgICAgICAgICovCiAgICAgICAgcXVvdGVzLnVuZGlzcGxheSA9IGZ1bmN0aW9uKHF1b3RlKSB7CiAgICAgICAgICAgIHF1b3Rlcy4kKCcuJytxdW90ZS5faWQpLgogICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoJ19ucmFtYS1xdW90ZScpLgogICAgICAgICAgICAgICAgY3NzKHsnYm9yZGVyLXRvcCc6J25vbmUnLCAnYm9yZGVyLWJvdHRvbSc6J25vbmUnLCAnYm94LXNoYWRvdyc6J25vbmUnfSkuCiAgICAgICAgICAgICAgICAvL3JlbW92ZUNsYXNzKHF1b3RlLl9pZCkuIC8vbm90IHN1cmUgd2hldGhlciBJIHdhbnQgdG8gZG8gdGhpcyB5ZXQKICAgICAgICAgICAgICAgIGNzcygnYmFja2dyb3VuZC1jb2xvcicsJ3JlZCcpLgogICAgICAgICAgICAgICAgYW5pbWF0ZSh7J2JhY2tncm91bmQtY29sb3InOidibGFjayd9LCBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIHF1b3Rlcy4kKHRoaXMpLmNzcygnYmFja2dyb3VuZC1jb2xvcicsJ2luaGVyaXQnKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgcXVvdGVzLmZsYXNoID0gZnVuY3Rpb24ocXVvdGVfaWQpIHsKICAgICAgICAgICAgdmFyICRxdW90ZV9ub2RlcyA9IHF1b3Rlcy4kKCcuJytxdW90ZV9pZCk7CiAgICAgICAgICAgICRxdW90ZV9ub2Rlcy5jc3Moeydib3JkZXItdG9wJzonMXB4IGRhc2hlZCBibGFjaycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JvcmRlci1ib3R0b20nOicxcHggZGFzaGVkIGJsYWNrJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYm94LXNoYWRvdyc6JzAgMCAyMHB4JyArIHNldHRpbmdzLmJhY2tncm91bmRfY29sb3IgfSk7CiAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAkcXVvdGVfbm9kZXMuY3NzKHsnYm9yZGVyLXRvcCc6J25vbmUnLCAnYm9yZGVyLWJvdHRvbSc6J25vbmUnLCAnYm94LXNoYWRvdyc6J25vbmUnfSk7ICAgICAgICAgICAgCiAgICAgICAgICAgIH0sNjAwKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIHJlcXVlc3QgcXVvdGUgZGVsZXRlIGZyb20gc2VydmVyIGFuZCByZW1vdmUgZnJvbSBwYWdlIGlmIHN1Y2Nlc3NmdWwKICAgICAgICAgKi8KICAgICAgICBxdW90ZXMucmVtb3ZlID0gZnVuY3Rpb24ocXVvdGUpIHsKICAgICAgICAgICAgcXVvdGVzLiQoJy4nK3F1b3RlLl9pZCkuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywnb3JhbmdlJyk7CiAgICAgICAgICAgIHBlcnNpc3Qucm0ocXVvdGUsIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgcXVvdGVzLnVuZGlzcGxheShxdW90ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogbG9hZCBxdW90ZXMgZnJvbSBzZXJ2ZXIgYW5kIGRpc3BsYXkgb24gdGhpcyBwYWdlCiAgICAgICAgICovCiAgICAgICAgcXVvdGVzLmxvYWQgPSBmdW5jdGlvbihwYWdlX2lkLCBjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgdXNlcl9pZCA9IHNldHRpbmdzLm1lX29ubHkgPyBzZXR0aW5ncy51c2VyX2lkIDogdW5kZWZpbmVkOwogICAgICAgICAgICBwZXJzaXN0LmxvYWQoewogICAgICAgICAgICAgICAgcGFnZV9pZCA6IHBhZ2VfaWQsCiAgICAgICAgICAgICAgICB0eXBlIDogJ3F1b3RlJywKICAgICAgICAgICAgICAgIHVzZXJfaWQgOiB1c2VyX2lkCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgJiYgZGF0YSApIHsKICAgICAgICAgICAgICAgICAgICBxdW90ZXMuJC5sb2coJ25yYW1hX3F1b3Rlcy5sb2FkIGdvdCAnICsgKCBkYXRhLnJvd3MgPyBkYXRhLnJvd3MubGVuZ3RoIDogMCApICsgJyBxdW90ZXMgZnJvbSBzZXJ2ZXIgZm9yIHVzZXIgJyt1c2VyX2lkKTsKICAgICAgICAgICAgICAgICAgICAvL25lZWQgdG8gc29ydCBxdW90ZXMgYnkgdGhlIHRpbWUgdGhleSB3ZXJlIGFkZGVkIHRvIHBhZ2UgZm9yIGJlc3QgY2hhbmNlIG9mIGRpc3BsYXlpbmcgdGhlbQogICAgICAgICAgICAgICAgICAgIHZhciBfc29ydGVyID0gZnVuY3Rpb24oYSxiKXsgcmV0dXJuIGEudmFsdWUuY3JlYXRlZCAtIGIudmFsdWUuY3JlYXRlZCB9OwogICAgICAgICAgICAgICAgICAgIGRhdGEucm93cy5zb3J0KF9zb3J0ZXIpOwogICAgICAgICAgICAgICAgICAgIHZhciBfZmFpbGluZ19xdW90ZXMgPSBbXQogICAgICAgICAgICAgICAgICAgIHF1b3Rlcy4kLmVhY2goZGF0YS5yb3dzLCBmdW5jdGlvbihpbmRleCwgcm93KXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHF1b3RlID0gcm93LnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHF1b3Rlcy5kaXNwbGF5KHF1b3RlKTsgIC8vdGhpcyB3b24ndCByZS1kaXNwbGF5IHF1b3RlcyBhbHJlYWR5IHByZXNlbnQKICAgICAgICAgICAgICAgICAgICAgICAgaWYoICFzdWNjZXNzICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2ZhaWxpbmdfcXVvdGVzLnB1c2gocXVvdGUuX2lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmKCBfZmFpbGluZ19xdW90ZXMubGVuZ3RoID4gMCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVvdGVzLiQubG9nKCdmYWlsZWQgdG8gZGlzcGxheSAnK19mYWlsaW5nX3F1b3Rlcy5sZW5ndGgrJyBxdW90ZXMsIF9pZHM6ICcrX2ZhaWxpbmdfcXVvdGVzLmpvaW4oJ1xuXHQnKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGRhdGEpOwogICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybnMgdGhlIHJhbmdlIGZvciB0aGUgc3BlY2lmaWVkIHF1b3RlIG9yIG51bGwgaWYgbm90IHBvc3NpYmxlLgogICAgICAgICAqIGNhdXRpb246IHRoaXMgbWF5IGZhaWwgb25jZSB0aGUgcXVvdGUgaGFzIGJlZW4gaGlnaGxpZ2h0ZWQhCiAgICAgICAgICovCiAgICAgICAgcXVvdGVzLmdldF9yYW5nZSA9IGZ1bmN0aW9uKHF1b3RlKSB7CiAgICAgICAgICAgIHZhciBtZXRob2QgPSBxdW90ZS54cHRyX21ldGhvZCB8fCAnX21ldGhvZF91bnNwZWNpZmllZCc7IC8vbWV0aG9kIGZvciByZWNvdmVyaW5nIHRoZSByYW5nZSBmcm9tIHRoZSBxdW90ZQogICAgICAgICAgICBpZiggISAobWV0aG9kIGluIHNlcmlhbGl6ZXJzKSApIHsKICAgICAgICAgICAgICAgIHF1b3Rlcy4kLmxvZygndW5rbm93biB4cHRyX21ldGhvZCAoJyttZXRob2QrJykgZm9yIHF1b3RlICcrcXVvdGUuX2lkKTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgc2VyaWFsaXplciA9IHNlcmlhbGl6ZXJzW21ldGhvZF07CiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWFsaXplci5kZXNlcmlhbGl6ZShxdW90ZS54cHRyKTsKICAgICAgICAgICAgfSBjYXRjaChlcnJvcikgewogICAgICAgICAgICAgICAgLy9xdW90ZXMuJC5sb2coJ25yYW1hX3F1b3Rlcy5kaXNwbGF5IEZBSUwgd2l0aCByYW5nZSA9ICcrcXVvdGUueHB0cisnXG5cdCBmb3IgcXVvdGUgJytxdW90ZS5faWQpOwogICAgICAgICAgICAgICAgLy9fZGVidWcoe2NhdGNoX2Vycm9yOmVycm9yfSk7ICAvL25vdCB1c3VhbGx5IGluZm9ybWF0aXZlCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybnMgYSBxdW90ZSBvYmplY3QgKG9yIG51bGwgaWYgbm90IGZvdW5kKQogICAgICAgICAqLwogICAgICAgIHF1b3Rlcy5nZXRfZnJvbV9wYWdlID0gZnVuY3Rpb24ocXVvdGVfaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHF1b3Rlcy4kKCcuJytxdW90ZV9pZCkuZmlyc3QoKS5kYXRhKCducmFtYV9xdW90ZScpIHx8IG51bGw7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0gcmFuZ2V7UmFuZ3l9CiAgICAgICAgICogQHJldHVybnMgYW4gYXJyYXkgcmVwcmVzZW50aW5nIHRoZSBvcmRlciB0aGlzIHF1b3RlIHByb2JhYmx5IGFwcGVhcnMKICAgICAgICAgKiBvbiB0aGUgcGFnZS4gIEFzc3VtZXMgdGhhdCBlYXJsaWVyIGluIERPTSBtZWFucyBlYXJsaWVyIG9uIHNjcmVlbi4KICAgICAgICAgKiAodGhlIGFsdGVybmF0aXZlIHdvdWxkIGJlIHRvIHVzZSBoZWlnaHQsIGJ1dCB0aGF0IGZhaWxzIGZvciBjb2x1bW5zCiAgICAgICAgICogJiB2YXJ5aW5nIGhlaWdodCkKICAgICAgICAgKi8KICAgICAgICBxdW90ZXMuY2FsY3VsYXRlX3BhZ2Vfb3JkZXIgPSBmdW5jdGlvbiBjYWxjdWxhdGVfcGFnZV9vcmRlcihyYW5nZSkgewogICAgICAgICAgICB2YXIgZG9jX2hlaWdodCA9IHF1b3Rlcy4kKHNldHRpbmdzLnJvb3Rfbm9kZSkuaGVpZ2h0KCk7CiAgICAgICAgICAgIHZhciBkb2Nfd2lkdGggPSBxdW90ZXMuJChzZXR0aW5ncy5yb290X25vZGUpLndpZHRoKCk7CiAgICAgICAgICAgIC8vdG9kbwogICAgICAgICAgICB2YXIgbm9kZSA9IHJhbmdlLnN0YXJ0Q29udGFpbmVyOwogICAgICAgICAgICB2YXIgcGFnZV9vcmRlciA9IFtyYW5nZS5zdGFydE9mZnNldF07ICAgLy9jcmVhdGUgaW4gcmV2ZXJzZSBvcmRlciwgd2lsbCByZXZlcnNlIGl0CiAgICAgICAgICAgIHdoaWxlICggbm9kZSAmJiBub2RlICE9IGRvY3VtZW50LmJvZHkgKSB7CiAgICAgICAgICAgICAgICBwYWdlX29yZGVyLnB1c2gocXVvdGVzLnJhbmd5LmRvbS5nZXROb2RlSW5kZXgobm9kZSwgdHJ1ZSkpOwogICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYWdlX29yZGVyLnJldmVyc2UoKTsKICAgICAgICAgICAgcmV0dXJuIHBhZ2Vfb3JkZXI7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBjYWxjdWxhdGUgdGhlIG9mZnNldCAoLnRvcCwgLmxlZnQpIG9mIGEgcXVvdGUKICAgICAgICAgKi8KICAgICAgICBxdW90ZXMub2Zmc2V0ID0gZnVuY3Rpb24ocXVvdGVfaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHF1b3Rlcy4kKCcuJytxdW90ZV9pZCkuZmlyc3QoKS5vZmZzZXQoKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIHJldHVybiBxdW90ZXM7CiAgICB9OwogICAgCiAgICAKICAgIC8qKgogICAgICogIEBwYXJhbSBxdW90ZXMgY2FuIGJlIHNldCB0byBudWxsOyBpZiBwcm92aWRlZCBpdCBpcyB1c2VkIHRvIHBvc2l0aW9uIG5vZXMKICAgICAqLwogICAgZXhwb3J0cy5fbWFrZV9ub3RlcyA9IGZ1bmN0aW9uKHNldHRpbmdzLCB1dWlkLCBwZXJzaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlcywgcXVvdGVzLCBfZGVidWcpIHsKICAgICAgICB2YXIgbm90ZXMgPSB7fTsKICAgICAgICB2YXIgJCA9IGpRdWVyeTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgYSBuZXcgbm90ZSBmb3IgYSBzcGVjaWZpZWQgcXVvdGUuCiAgICAgICAgICovCiAgICAgICAgbm90ZXMuY3JlYXRlID0gZnVuY3Rpb24ocXVvdGUpewogICAgICAgICAgICB2YXIgbmV3X25vdGUgPSB7CiAgICAgICAgICAgICAgICBfaWQgOiAnbl8nK3V1aWQoKSwgIAogICAgICAgICAgICAgICAgdHlwZSA6ICdub3RlJywKICAgICAgICAgICAgICAgIGNvbnRlbnQgOiBzZXR0aW5ncy5ub3RlX2RlZmF1bHRfdGV4dCwKICAgICAgICAgICAgICAgIHF1b3RlX2lkIDogcXVvdGUuX2lkLAogICAgICAgICAgICAgICAgcXVvdGVfaGFzaCA6IHF1b3RlLmhhc2gsICAgIC8vY2FuIGF0dGFjaCB0byB0aGUgc2FtZSBxdW90ZSBmcm9tIG90aGVyIHVzZXJzCiAgICAgICAgICAgICAgICB0YWdzIDogW10sICAgICAgICAgICAgICAgICAgLy93aWxsIGNhY2hlIHRoZSAjcyB0byBzYXZlIHVzIHBhcnNpbmcgdGV4dCBpbiBjcmVhdGluZyBhIHZpZXcKICAgICAgICAgICAgICAgIGJhY2tncm91bmRfY29sb3IgOiBzZXR0aW5ncy5ub3RlX2JhY2tncm91bmRfY29sb3IsCiAgICAgICAgICAgICAgICB3aWR0aCA6IHNldHRpbmdzLm5vdGVfd2lkdGgsCiAgICAgICAgICAgICAgICBwYWdlX2lkIDogcXVvdGUucGFnZV9pZCwgIAogICAgICAgICAgICAgICAgY3JlYXRlZCA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLAogICAgICAgICAgICAgICAgdXBkYXRlZCA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLAogICAgICAgICAgICAgICAgdXNlcl9pZCA6IHF1b3RlLnVzZXJfaWQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbmV3X25vdGUuc291cmNlX2lkID0gc291cmNlcy5jYWxjdWxhdGVfaWQoewogICAgICAgICAgICAgICAgdXNlcl9pZCA6IG5ld19ub3RlLnVzZXJfaWQsCiAgICAgICAgICAgICAgICBwYWdlX2lkIDogbmV3X25vdGUucGFnZV9pZAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG5ld19ub3RlOwogICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIGV4dHJhY3QgdGFncyBmcm9tIG5vdGUKICAgICAgICAgKiBsb3NlbHkgYmFzZWQgb24gbGluZXMgMTA2LTcgb2YgaHR0cHM6Ly9yYXcuZ2l0aHViLmNvbS9iY2hlcnJ5L3R3aXR0ZXItdGV4dC1qcy9tYXN0ZXIvdHdpdHRlci10ZXh0LmpzCiAgICAgICAgICovCiAgICAgICAgdmFyIF9oYXNodGFnX3JlZ2V4ID0gLyhefFteMC05QS1aJlwvXD9dKykoI3zvvIMpKFswLTlBLVpfXSpbQS1aX10rW2EtejAtOV9dKikvZ2k7CiAgICAgICAgbm90ZXMuZ2V0X3RhZ3MgPSBmdW5jdGlvbihub3RlKSB7CiAgICAgICAgICAgIHZhciB0YWdzID0gW107CiAgICAgICAgICAgIG5vdGUuY29udGVudC5yZXBsYWNlKF9oYXNodGFnX3JlZ2V4LCBmdW5jdGlvbihtYXRjaCwgYmVmb3JlLCBoYXNoLCBoYXNoVGV4dCkgewogICAgICAgICAgICAgICAgdGFncy5wdXNoKGhhc2hUZXh0KTsgIAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHRhZ3M7CiAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgbm90ZXMuc2F2ZSA9IGZ1bmN0aW9uKG5vdGUsIG9wdGlvbnMvKm9wdGlvbmFsKi8sIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGlmKCAhY2FsbGJhY2sgKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9leHRyYWN0IGFuZCBzdG9yZSB0aGUgdGFncwogICAgICAgICAgICBub3RlLnRhZ3MgPSBub3Rlcy5nZXRfdGFncyhub3RlKTsKICAgICAgICAgICAgLy91cGRhdGUgdGhlIHNvdXJjZSBiZWZvcmUgc2F2aW5nIGFueSBxdW90ZXMKICAgICAgICAgICAgc291cmNlcy51cGRhdGVfb25jZShub3RlLCBmdW5jdGlvbihlcnJvciwgZGF0YSkgewogICAgICAgICAgICAgICAgaWYoIGVycm9yICkgewogICAgICAgICAgICAgICAgICAgICQubG9nKCdlcnJvciBpbiBucmFtYV9ub3Rlcy5zYXZlLCBkdWUgdG8gY2FsbCB0byBucmFtYV9zb3VyY2VzLnVwZGF0ZV9vbmNlLicpCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGRhdGEpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwZXJzaXN0LnNhdmUobm90ZSwgb3B0aW9ucywgY2FsbGJhY2spOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICB2YXIgX3ppbmRleF9jb3VudGVyID0gMTAwMDA7IC8vdXNlZCBmb3IgYnJpbmdpbmcgbm90ZXMgdG8gdGhlIGZyb250IGFuZCB0byBlbnN1cmUgbmV3IG5vdGVzIGFyZSBvbiB0b3AKICAgICAgICBub3Rlcy5icmluZ190b19mcm9udCA9IGZ1bmN0aW9uKCRub3RlKSB7CiAgICAgICAgICAgICRub3RlLmNzcygnei1pbmRleCcsIF96aW5kZXhfY291bnRlcisrKTsgIC8vbW92ZSBub3RlIHRvIGZyb25nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBkaXNwYWx5IGEgbm90ZSBvbiB0aGUgcGFnZSAtLSBpLmUuIGNyZWF0ZSBhbmQgc3R5bGUgdGhlIEhUTUwgYW5kIGFkZCBpdAogICAgICAgICAqIHRvIHRoZSBhcHByb3JpYXRlIHBhcnQgb2YgdGhlIGRvY3VtZW50ICh0aGUgI19ucmFtYV9ub3RlcykuCiAgICAgICAgICogSWYgbm90ZSBkb2VzIG5vdCBoYXZlIHBvc2l0aW9uIGluZm8gKGVpdGhlciBiZWNhdXNlIGl0IGlzIG5ld2x5IGNyZWF0ZWQsCiAgICAgICAgICogb3IgYmVjYXVzZSBpdCB3YXMgY3JlYXRlZCBvbiB0aGUgc2VydmVyKSwgYXR0ZW1wdCB0byBwb3NpdGlvbiBpdCBuZWFyIHRoZSBxdW90ZS4KICAgICAgICAgKi8KICAgICAgICBub3Rlcy5kaXNwbGF5ID0gZnVuY3Rpb24obm90ZSwgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgb3B0aW9uc19kZWZhdWx0cyA9IHsKICAgICAgICAgICAgICAgIGZvY3VzIDogdHJ1ZSAgICAgICAgLy9zZXQgZm9jdXMgdG8gdGhlIG5vdGUncyB0ZXh0YXJlYSBhZnRlciBjcmVhdGluZyBpdD8KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGRpc3BsYXlfc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgb3B0aW9uc19kZWZhdWx0cywgb3B0aW9ucyApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIGFwcGx5IHNvbWUgcG9zaXRpb25pbmcgZGVmYXVsdHMgdG8gbm90ZXMKICAgICAgICAgICAgdmFyIG5vdGVfZGVmYXVsdHMgPSB7fTsKICAgICAgICAgICAgdmFyIHZpZXdwb3J0X3dpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7CiAgICAgICAgICAgIC8vc2hpZnQgcXVvdGVzIGhvcml6b250YWxseSBieSAxLzMwIG9mIHZpZXdwb3J0X3dpZHRoCiAgICAgICAgICAgIHZhciByYW5kb21fc2hpZnQgPSBmdW5jdGlvbigpe3JldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqKHZpZXdwb3J0X3dpZHRoLzMwKSl9OwogICAgICAgICAgICB2YXIgbm90ZV9yaWdodF9nYXAgPSBNYXRoLm1pbigxNSwgdmlld3BvcnRfd2lkdGgvNjUpOwogICAgICAgICAgICBub3RlX2RlZmF1bHRzLmxlZnQgPSB2aWV3cG9ydF93aWR0aCAtIG5vdGVfcmlnaHRfZ2FwIC0gKG5vdGUud2lkdGggfHwgc2V0dGluZ3Mubm90ZV93aWR0aCkgLSByYW5kb21fc2hpZnQoKTsKICAgICAgICAgICAgLy90byBnZXQgZGVmYXVsdCBmb3IgdG9wIHdlIG5lZWQgcG9zaXRpb24gb2YgYXNzb2NpYXRlZCBxdW90ZSAtLS0gb25seSBjb21wdXRlIHRoaXMgaWYgd2UgcmVhbGx5IG5lZWQgaXQKICAgICAgICAgICAgaWYoICFub3RlLnRvcCApIHsKICAgICAgICAgICAgICAgIHZhciBxdW90ZV9vZmZzZXQgPSBudWxsOwogICAgICAgICAgICAgICAgaWYoIG5vdGUucXVvdGVfaWQgJiYgcXVvdGVzICkgewogICAgICAgICAgICAgICAgICAgIHF1b3RlX29mZnNldCA9IHF1b3Rlcy5vZmZzZXQobm90ZS5xdW90ZV9pZCk7ICAgIC8vbWF5IHJldHVybiBudWxsIGlmIGNhbid0IGJlIGNvbXB1dGVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiggcXVvdGVfb2Zmc2V0ICkgewogICAgICAgICAgICAgICAgICAgIG5vdGVfZGVmYXVsdHMudG9wID0gcXVvdGVfb2Zmc2V0LnRvcCArIHJhbmRvbV9zaGlmdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBub3RlX2RlZmF1bHRzLnRvcCA9IDAgKyByYW5kb21fc2hpZnQoKTsgLy9wdXQgbm90ZSBhdCB0b3Agb2Ygc2NyZWVuIGlmIGNhbid0IGRvIGJldHRlcgogICAgICAgICAgICAgICAgICAgICQubG9nKCJucmFtYSB1bmFibGUgdG8gZ2V0IGRlZmF1bHQgcG9zaXRpb24gZm9yIG5vdGUgIiArIG5vdGUuX2lkICsgIiBiZWNhdXNlIG5vIHF1b3RlIG9mZnNldCBmb3VuZCBmb3IgcXVvdGUgIiArIG5vdGUucXVvdGVfaWQgKyAiKGhhcyB0aGUgcXVvdGUgYmVlbiBhZGRlZCB0byB0aGUgcGFnZT8pIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gCiAgICAgICAgICAgIG5vdGUgPSAkLmV4dGVuZCh0cnVlLCB7fSwgbm90ZV9kZWZhdWx0cywgbm90ZSApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0gY2hlY2sgdGhlIG5vdGUgY29udGFpbmVyIGRpdiBleGlzdHMsIGFwcGVuZCB0byBkb2N1bWVudC5ib2R5IGlmIG5vdAogICAgICAgICAgICBpZiggJCgnI19ucmFtYV9ub3RlcycpLmxlbmd0aCA9PSAwICkgewogICAgICAgICAgICAgICAgJCgnPGRpdiBpZD0iX25yYW1hX25vdGVzIj48L2Rpdj4nKS5hcHBlbmRUbygnYm9keScpLgogICAgICAgICAgICAgICAgICAgIGNzcyh7cG9zaXRpb246ImFic29sdXRlIiwgbGVmdDoiMHB4IiwgdG9wOiIwcHgiLHdpZHRoOiIwJSIsIGhlaWdodDoiMCUifSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLSBzdGFydCBwcm9wZXJseSBoZXJlCiAgICAgICAgICAgIGlmKCAkKCcjJytub3RlLl9pZCkubGVuZ3RoICE9IDAgKSB7ICAKICAgICAgICAgICAgICAgIG5vdGVzLnVuZGlzcGxheShub3RlKTsgLy9JZiBub3RlIGFscmVhZHkgZGlzcGxheWVkLCB1bmRpc3BsYXkgaXQgZmlyc3QuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHBvc19hdHRycyA9IHsKICAgICAgICAgICAgICAgICJwb3NpdGlvbiI6ImFic29sdXRlIiwKICAgICAgICAgICAgICAgICJsZWZ0Ijpub3RlLmxlZnQrInB4IiwKICAgICAgICAgICAgICAgICJ0b3AiOm5vdGUudG9wKyJweCIKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIHRleHRhcmVhID0gJCgnPHRleHRhcmVhPjwvdGV4dGFyZWE+JykuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsKG5vdGUuY29udGVudCkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzKHNldHRpbmdzLm5vdGVfZWRpdG9yX3N0eWxlKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmUoJ2JsdXInLCBub3Rlcy51cGRhdGVfb25fYmx1cikuICAvL21ha2Ugc3VyZSBlZGl0cyBhcmUgc2F2ZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvZ3JvdygpOwogICAgICAgICAgICB2YXIgaW5uZXJfZGl2ID0gJCgnPGRpdj48L2Rpdj4nKS5jc3Moc2V0dGluZ3Mubm90ZV9pbm5lcl9zdHlsZSkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kKHRleHRhcmVhKTsKICAgICAgICAgICAgdmFyIGVkaXRfbm90ZSA9ICQoJzxkaXY+PC9kaXYnKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyKCdpZCcsbm90ZS5faWQpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKCdfbnJhbWEtbm90ZScpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlUmVzZXRDU1MoKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3MocG9zX2F0dHJzKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3Moc2V0dGluZ3Mubm90ZV9zdHlsZSkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzKCd6LWluZGV4JyxfemluZGV4X2NvdW50ZXIrKykuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgbm90ZS5iYWNrZ3JvdW5kX2NvbG9yIHx8IHNldHRpbmdzLm5vdGVfYmFja2dyb3VuZF9jb2xvcikuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSgnbnJhbWFfbm90ZScsbm90ZSkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kKGlubmVyX2RpdikuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kVG8oJyNfbnJhbWFfbm90ZXMnKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGUoeyBjdXJzb3I6J21vdmUnLCBvcGFjaXR5OjAuNjYsIHN0b3A6bm90ZXMudXBkYXRlX29uX2RyYWcgfSkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlkZSgpLnNob3coInNjYWxlIix7fSwyMDAsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBkaXNwbGF5X3NldHRpbmdzLmZvY3VzICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGFyZWEuZm9jdXMoKS5zZWxlY3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogcmVtb3ZlIEhUTUwgbm9kZSByZXByZXNlbmluZyBub3RlIGZyb20gdGhlIHBhZ2UKICAgICAgICAgKi8KICAgICAgICBub3Rlcy51bmRpc3BsYXkgPSBmdW5jdGlvbihub3RlKSB7CiAgICAgICAgICAgICQoJyMnK25vdGUuX2lkKS5yZW1vdmUoKTsKICAgICAgICB9OwoKICAgICAgICAvLyAtLSBjYWxsIHRoaXMgdG8gcmUtZW5hYmxlIG5vdGUgd2hlbiBlcnJvciBzYXZpbmcgb3IgZGVsZXRpbmcKICAgICAgICB2YXIgX2ZpbmFsbHkgPSBmdW5jdGlvbiBfZmluYWxseSgkbm90ZSwgcmVzdG9yZV9iYWNrZ3JvdW5kICl7CiAgICAgICAgICAgIHZhciAkdGV4dGFyZWEgPSAkKCd0ZXh0YXJlYScsICRub3RlKTsKICAgICAgICAgICAgLy9tYWtlIGNoYW5nZXMgdG8gdGV4dGFyZWEgcG9zc2libGUgJiBlbnN1cmUgdGhleSB0cmlnZ2VyIHVwZGF0ZXMKICAgICAgICAgICAgJHRleHRhcmVhLnJlbW92ZUF0dHIoImRpc2FibGVkIik7CiAgICAgICAgICAgICR0ZXh0YXJlYS51bmJpbmQoJ2JsdXInLCBub3Rlcy51cGRhdGVfb25fYmx1cikub25lKCdibHVyJywgbm90ZXMudXBkYXRlX29uX2JsdXIpOyAgLy9tYWtlIHN1cmUgZWRpdHMgYXJlIHNhdmVkCiAgICAgICAgICAgIGlmKCByZXN0b3JlX2JhY2tncm91bmQgKSB7CiAgICAgICAgICAgICAgICAkdGV4dGFyZWEucGFyZW50cygnLl9ucmFtYS1ub3RlJykuY3NzKHtiYWNrZ3JvdW5kQ29sb3I6c2V0dGluZ3Mubm90ZV9iYWNrZ3JvdW5kX2NvbG9yfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIGV2ZW50IGhhbmRsZXIgZm9yIGJsdXIgZXZlbnQgb24gVEVYVEFSRUEgb2YgJG5vdGUKICAgICAgICAgKiBUaGlzIGhhbmRsZXMgZGlzcGxheSwgbG9naWMgJiBwZXJzaXN0ZW5jZS4KICAgICAgICAgKiBpZiAmIHdoZW4gc3VjY2Vzc2Z1bGx5IHBlcnNpc3RlZCwgdGhlIG5vdGUgaXMgc3RvcmVkIGFzIGEganF1ZXJ5LmRhdGEgYXR0cgogICAgICAgICAqIG9uIHRoZSAkbm90ZSAoa2V5Om5yYW1hX25vdGUpCiAgICAgICAgICovCiAgICAgICAgbm90ZXMudXBkYXRlX29uX2JsdXIgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciAkdGV4dGFyZWEgPSAkKHRoaXMpOwogICAgICAgICAgICAkdGV4dGFyZWEudW5iaW5kKCdibHVyJywgbm90ZXMudXBkYXRlX29uX2JsdXIpLgogICAgICAgICAgICAgICAgYXR0cigiZGlzYWJsZWQiLCAiZGlzYWJsZWQiKTsgICAvL2Rpc2FibGUgdGV4dCBhcmVhIHdoaWxlIGF0dGVtcHRpbmcgdG8gcGVyc2lzdAogICAgICAgICAgICAkbm90ZSA9ICR0ZXh0YXJlYS5wYXJlbnRzKCcuX25yYW1hLW5vdGUnKS5maXJzdCgpOwogICAgICAgICAgICAkbm90ZS5jc3MoJ2JhY2tncm91bmQtY29sb3InLCBzZXR0aW5ncy5wZXJzaXN0X3N0YXJ0ZWRfY29sb3IpOwogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC0tIGRlbGV0ZSBub3RlIGlmIG5vdGUgY29udGVudCBpcyBlbXB0eQogICAgICAgICAgICB2YXIgbmV3X2NvbnRlbnQgPSAkdGV4dGFyZWEudmFsKCk7CiAgICAgICAgICAgIGlmKCAkLnRyaW0obmV3X2NvbnRlbnQpID09ICcnICkgewogICAgICAgICAgICAgICAgJC5sb2coIm5yYW1hX25vdGVzLnVwZGF0ZSAtLSBkZWxldGluZyBub3RlICIrJG5vdGUuYXR0cignaWQnKSk7CiAgICAgICAgICAgICAgICBub3Rlcy5yZW1vdmUoJG5vdGUpOyAKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgdmFyIG5vdGUgPSAkbm90ZS5kYXRhKCducmFtYV9ub3RlJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLSBpZiBjb250ZW50IHVuY2hhbmdlZCwgZG8gbm90aGluZyAoc28gbW92aW5nIGEgbm90ZSB3b24ndCB0cmlnZ2VyIGEgY2hhbmdlKQogICAgICAgICAgICB2YXIgb2xkX2NvbnRlbnQgPSBub3RlLmNvbnRlbnQ7CiAgICAgICAgICAgIGlmKCBvbGRfY29udGVudCA9PSBuZXdfY29udGVudCApIHsKICAgICAgICAgICAgICAgIF9maW5hbGx5KCRub3RlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgCiAgICAgICAgICAgIHZhciB1cGRhdGVzID0gewogICAgICAgICAgICAgICAgY29udGVudCA6IG5ld19jb250ZW50LAogICAgICAgICAgICAgICAgdXBkYXRlZCA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmKCBzZXR0aW5ncy5pc19lbWJlZGRlZCApIHsKICAgICAgICAgICAgICAgICQuZXh0ZW5kKHVwZGF0ZXMsIHsKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kX2NvbG9yIDogc2V0dGluZ3Mubm90ZV9iYWNrZ3JvdW5kX2NvbG9yLAogICAgICAgICAgICAgICAgICAgIGxlZnQgOiAkbm90ZS5vZmZzZXQoKS5sZWZ0LAogICAgICAgICAgICAgICAgICAgIHRvcCA6ICRub3RlLm9mZnNldCgpLnRvcCwKICAgICAgICAgICAgICAgICAgICBkb2NfaGVpZ2h0IDogJChkb2N1bWVudCkuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgZG9jX3dpZHRoIDogJChkb2N1bWVudCkud2lkdGgoKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG5ld19ub3RlID0gJC5leHRlbmQodHJ1ZSwge30sIG5vdGUsIHVwZGF0ZXMpOyAgIAogICAgICAgICAgICAKICAgICAgICAgICAgbm90ZXMuc2F2ZShuZXdfbm90ZSwge2Nsb25lX29uX2NvbmZsaWN0OnRydWV9LCBmdW5jdGlvbihlcnJvcixkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCBlcnJvciApIHsKICAgICAgICAgICAgICAgICAgICAkbm90ZS5jc3Moe2JhY2tncm91bmRDb2xvciA6IHNldHRpbmdzLnBlcnNpc3RfZmFpbGVkX2NvbG9yfSk7CiAgICAgICAgICAgICAgICAgICAgX2ZpbmFsbHkoJG5vdGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8kLmxvZygibnJhbWFfbm90ZXMudXBkYXRlX29uX2JsdXI6IHdhcyBwZXJzaXN0ZWQgbm90ZSBfaWQ6IituZXdfbm90ZS5faWQrIiBmb3IgcXVvdGU6IituZXdfbm90ZS5xdW90ZV9pZCk7CiAgICAgICAgICAgICAgICAgICAgJG5vdGUuYXR0cignaWQnLG5ld19ub3RlLl9pZCk7IC8vbWF5IGhhdmUgY2hhbmdlZCAoc2F2ZSBjYW4gY2xvbmUpCiAgICAgICAgICAgICAgICAgICAgJG5vdGUgPSAkKCcjJytuZXdfbm90ZS5faWQpOyAgIC8vaGF2ZSB0byB1cGRhdGUgYWZ0ZXIgY2hhbmdpbmcgaWQgYXR0cmlidXRlCiAgICAgICAgICAgICAgICAgICAgJG5vdGUuZGF0YSgnbnJhbWFfbm90ZScsIG5ld19ub3RlKTsKICAgICAgICAgICAgICAgICAgICAvL2NoZWNrIGZvciBiaWJ0ZXggKGRvIHRoaXMgYWZ0ZXIgc2F2ZSB0byBhdm9pZCBjb25mbGljdHMpCiAgICAgICAgICAgICAgICAgICAgaWYoIHNvdXJjZXMuZGV0ZWN0X2JpYnRleChuZXdfbm90ZS5jb250ZW50KSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlcy51cGRhdGVfZnJvbV9iaWJ0ZXgobmV3X25vdGUuY29udGVudCwgbmV3X25vdGUsIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycrbm90ZS5faWQpLmNzcyh7Ym9yZGVyOicxcHggc29saWQgIzAxREYwMSd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2ZpbmFsbHkoICRub3RlLCB0cnVlICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9maW5hbGx5KCAkbm90ZSwgdHJ1ZSApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgbm90ZXMudXBkYXRlX29uX2RyYWcgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciAkdGV4dGFyZWEgPSAkKCd0ZXh0YXJlYScsICQodGhpcykgKS5maXJzdCgpOwogICAgICAgICAgICBpZiggJHRleHRhcmVhLmF0dHIoJ2Rpc2FibGVkJykgKSB7CiAgICAgICAgICAgICAgICAkLmxvZygnbnJhbWFfbm90ZXMudXBkYXRlX29uX2RyYWc6IHNhdmUgY3VycmVudGx5IGluIHByb2dyZXNzJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJC5sb2coIm5yYW1hX25vdGVzLnVwZGF0ZV9vbl9kcmFnIHN0YXJ0aW5nIik7CiAgICAgICAgICAgICR0ZXh0YXJlYS5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgIHZhciAkbm90ZSA9ICAkKHRoaXMpOwogICAgICAgICAgICB2YXIgbm90ZSA9ICRub3RlLmRhdGEoJ25yYW1hX25vdGUnKTsKICAgICAgICAgICAgdmFyIHVwZGF0ZXMgPSB7CiAgICAgICAgICAgICAgICBsZWZ0IDogJG5vdGUub2Zmc2V0KCkubGVmdCwKICAgICAgICAgICAgICAgIHRvcCA6ICRub3RlLm9mZnNldCgpLnRvcCwKICAgICAgICAgICAgICAgIGRvY19oZWlnaHQgOiAkKGRvY3VtZW50KS5oZWlnaHQoKSwKICAgICAgICAgICAgICAgIGRvY193aWR0aCA6ICQoZG9jdW1lbnQpLndpZHRoKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbm90ZSA9ICQuZXh0ZW5kKHRydWUsIG5vdGUsIHVwZGF0ZXMpOyAgIAogICAgICAgICAgICBub3Rlcy5zYXZlKG5vdGUsIHtjbG9uZV9vbl9jb25mbGljdDpmYWxzZX0sIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIC8vZXJyb3JzIGFyZSBpZ25vcmVkIC0tIG5vdGUgbG9jYXRpb24gbm90IGNyaXRpY2FsCiAgICAgICAgICAgICAgICAkdGV4dGFyZWEucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiByZXF1ZXN0IGRlbGV0ZSBmcm9tIHNlcnZlciAmIHJlbW92ZSBmcm9tIGRvY3VtZW50IGlmIHN1Y2NlZWRzCiAgICAgICAgICovCiAgICAgICAgbm90ZXMucmVtb3ZlID0gZnVuY3Rpb24oJG5vdGUpIHsKICAgICAgICAgICAgdmFyIG5vdGVfaWQgPSAkbm90ZS5hdHRyKCdpZCcpOwogICAgICAgICAgICAkbm90ZS5jc3MoJ2JhY2tncm91bmQtY29sb3InLCdyZWQnKTsKICAgICAgICAgICAgdmFyIG5vdGUgPSAkbm90ZS5kYXRhKCducmFtYV9ub3RlJyk7CiAgICAgICAgICAgIHBlcnNpc3Qucm0obm90ZSwgZnVuY3Rpb24oZXJyb3IsIGRhdGEpewogICAgICAgICAgICAgICAgaWYoIGVycm9yICkgewogICAgICAgICAgICAgICAgICAgIF9maW5hbGx5KCRub3RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICQubG9nKCJucmFtYV9ub3Rlcy5yZW1vdmUgZGVsZXRlZCBub3RlICIrbm90ZV9pZCsiIGZyb20gc2VydmVyLiIpOwogICAgICAgICAgICAgICAgICAgICQoJyMnK25vdGVfaWQpLmhpZGUoJ3B1ZmYnLHt9LDMwMCtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqNjAwKSwgZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycrbm90ZV9pZCkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAKICAgICAgICAvKioKICAgICAgICAgKiBsb2FkIG5vdGVzIGZyb20gc2VydmVyIGFuZCBkaXNwbGF5IG9uIHRoaXMgcGFnZQogICAgICAgICAqIHJ1biBhZnRlciBxdW90ZXMgaGF2ZSBiZWVuIGxvYWRlZCBhbmQgZGlzcGxheWVkIGluIGNhc2Ugbm90ZXMgbmVlZCBwb3NpdGlvbmluZwogICAgICAgICAqLwogICAgICAgIG5vdGVzLmxvYWQgPSBmdW5jdGlvbihwYWdlX2lkLCBjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgdXNlcl9pZCA9IHNldHRpbmdzLm1lX29ubHkgPyBzZXR0aW5ncy51c2VyX2lkIDogdW5kZWZpbmVkOwogICAgICAgICAgICBwZXJzaXN0LmxvYWQoewogICAgICAgICAgICAgICAgcGFnZV9pZCA6IHBhZ2VfaWQsCiAgICAgICAgICAgICAgICB0eXBlIDogJ25vdGUnLAogICAgICAgICAgICAgICAgdXNlcl9pZCA6IHVzZXJfaWQKICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IsIGRhdGEpewogICAgICAgICAgICAgICAgaWYoIGVycm9yICkgewogICAgICAgICAgICAgICAgICAgIF9kZWJ1Zyh7bXNnOiducmFtYV9ub3Rlcy5sb2FkIGVycm9yOicsIGVycm9yOmVycm9yfSkKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJC5sb2coJ25yYW1hX25vdGVzLmxvYWQgZ290ICcgKyAoIGRhdGEgPyAoZGF0YS5yb3dzID8gZGF0YS5yb3dzLmxlbmd0aCA6IDAgKSA6IDApICsgJyBub3RlcyBmcm9tIHNlcnZlciBmb3IgdXNlciAnK3VzZXJfaWQpOwogICAgICAgICAgICAgICAgaWYoIGRhdGEgJiYgZGF0YS5yb3dzICkgewogICAgICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLnJvd3MsIGZ1bmN0aW9uKGluZGV4LHJvdyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub3RlID0gcm93LnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICBub3Rlcy5kaXNwbGF5KG5vdGUsIHtmb2N1czpmYWxzZX0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGRhdGEpOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBAcmV0dXJucyBfaWRzIG9mIG5vdGVzIGlmIEBwYXJhbSBxdW90ZSBoYXMgbm90ZXMgYXR0YWNoZWQKICAgICAgICAgKi8KICAgICAgICBub3Rlcy5maW5kID0gZnVuY3Rpb24ocXVvdGUpIHsKICAgICAgICAgICAgdmFyIF9pZHMgPSBbXTsKICAgICAgICAgICAgJCgnLl9ucmFtYS1ub3RlJykuZWFjaChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHJlbF9xdW90ZV9pZCA9ICQodGhpcykuZGF0YSgnbnJhbWFfbm90ZScpLnF1b3RlX2lkOwogICAgICAgICAgICAgICAgaWYoIHJlbF9xdW90ZV9pZCA9PSBxdW90ZS5faWQgKSB7CiAgICAgICAgICAgICAgICAgICAgX2lkcy5wdXNoKCQodGhpcykuYXR0cignaWQnKSk7ICAvL2FkZCBfaWQgb2YgdGhlIG5vdGUgdG8gdGhlIGxpc3QKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBfaWRzOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgcmV0dXJuIG5vdGVzOwogICAgfTsKICAgIAogICAgCiAgICAKICAgIAogICAgLyoqCiAgICAgKiBmb3IgZGlhbG9ncyAodG9kbyAtLSBtb3ZlIGV2ZW50IGhhbmRsZXJzKQogICAgICovCiAgICBleHBvcnRzLl9tYWtlX3VpID0gZnVuY3Rpb24oc2V0dGluZ3MsIHNlc3Npb24sIF9kZWJ1Zyl7CiAgICAgICAgdmFyICQgPSBqUXVlcnk7CiAgICAgICAgdmFyIHVpID0ge307CiAgICAgICAgCiAgICAgICAgdmFyIF91cGRhdGVfdXNlcl9pZCA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgaWYoIGRhdGEgJiYgZGF0YS51c2VyQ3R4ICYmIGRhdGEudXNlckN0eC5uYW1lICkgewogICAgICAgICAgICAgICAgdmFyIGxvZ2dlZF9pbl9hcyA9IGRhdGEudXNlckN0eC5uYW1lOwogICAgICAgICAgICAgICAgaWYoIGxvZ2dlZF9pbl9hcyAhPSBzZXR0aW5ncy51c2VyX2lkICkgewogICAgICAgICAgICAgICAgICAgIC8vdXNlcm5hbWUgaGFzIGNoYW5nZWQKICAgICAgICAgICAgICAgICAgICB1aS5kaWFsb2dzLndhcm5fdXNlcl9kaXNjcmVwYW5jeShsb2dnZWRfaW5fYXMpOwogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLnVzZXJfaWQgPSBsb2dnZWRfaW5fYXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIC8qKiAKICAgICAgICAgKiBtYXkgdXBkYXRlIHNldHRpbmdzLnVzZXJfaWQuICBtYXkgcmVzdWx0IGluIG1vZGFsIGRpYWxvZyB3YXJuaW5nCiAgICAgICAgICovCiAgICAgICAgdWkuaW5mbyA9IGZ1bmN0aW9uKGNhbGxiYWNrKXsKICAgICAgICAgICAgc2Vzc2lvbi5pbmZvKGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgX3VwZGF0ZV91c2VyX2lkKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsZGF0YSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogbWF5IHVwZGF0ZSBzZXR0aW5ncy51c2VyX2lkLiAgbWF5IHJlc3VsdCBpbiBtb2RhbCBkaWFsb2cgd2FybmluZwogICAgICAgICAqLwogICAgICAgIHVpLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkLCBjYWxsYmFjayl7CiAgICAgICAgICAgIHNlc3Npb24ubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkLCBmdW5jdGlvbihlcnJvcixkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgX3VwZGF0ZV91c2VyX2lkKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsZGF0YSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgoKICAgICAgICB1aS5kaWFsb2dzID0ge307CiAgICAgICAgLyoqCiAgICAgICAgICogc3dpdGNoIHVzZXJfaWQgaWYgbG9nZ2VkIGluOyBvdGhlcndpc2UgY2hlY2sgd2hldGhlciBjb25maWd1cmVkIGZvcgogICAgICAgICAqIGFub255bW91cyB1c2VyIGFuZCByZXF1ZXN0IHVzZXIgdG8gbG9nIGluIGlmIG5vdC4KICAgICAgICAgKi8KICAgICAgICB1aS5kaWFsb2dzLmxvZ2luX2lmX25lY2Vzc2FyeSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHVpLmluZm8oIGZ1bmN0aW9uKGVycm9yLGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmKCBkYXRhICYmIGRhdGEudXNlckN0eCAmJiBkYXRhLnVzZXJDdHgubmFtZSApIHsKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCAnYWxyZWFkeSBsb2dnZWQgaW4nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy9ub3QgbG9nZ2VkIGluCiAgICAgICAgICAgICAgICAgICAgaWYoIHNldHRpbmdzLnVzZXJfaWQgJiYgc2V0dGluZ3MudXNlcl9pZFswXSA9PSAnKicgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vYW5vbnltb3VzCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsICdhbm9ueW1vdXMgdXNlcicpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpLmRpYWxvZ3MubG9naW4oc2V0dGluZ3MudXNlcl9pZCwgY2FsbGJhY2spOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBkaXNwYWx5IGEgbG9naW4gZGlhbG9nLgogICAgICAgICAqIEBwYXJhbSBjYWxsYmFja3tGdW5jdGlvbn0gd2lsbCBiZSBjYWxsZWQgd2l0aCBhbiBlcnJvciBpZiB0aGUgdXNlciBjYW5jZWxzLgogICAgICAgICAqLwogICAgICAgIHVpLmRpYWxvZ3MubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgbXNnLypvcHRpb25hbCovLCBjYWxsYmFjaykgewogICAgICAgICAgICBpZiggIWNhbGxiYWNrICkgewogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBtc2c7CiAgICAgICAgICAgICAgICBtc2cgPSAnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbGFzdF9lcnJvciA9IHttZXNzYWdlOid5b3UgY2FuY2VsbGVkJ307ICAvL3JlcG9ydCByZXN1bHRzIG9mIGxhc3QgZXJyb3IgaWYgdXNlciBjYW5jZWxzCiAgICAgICAgICAgIHZhciAkZGl2ID0gJCgnPGRpdj48aDI+PGEgaHJlZj0iaHR0cDovL3d3dy5ub3RlLW8tcmFtYS5jb20iIHRhcmdldD0iX2JsYW5rIj5Ob3RlLW8tcmFtYTwvYT4gOiBsb2dpbjwvaDI+PC9kaXY+Jyk7CiAgICAgICAgICAgICRkaXYuYXBwZW5kKCc8Zm9ybSBpZD0ibG9naW5fZm9ybSIgYWN0aW9uPSIvX3Nlc3Npb24iIG1ldGhvZD0iUE9TVCI+JyArCiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iZ2VuZXJhbF9lcnJvcnMiPicrbXNnKyc8L2Rpdj4nICsKICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJ1c2VybmFtZSBmaWVsZCI+JyArCiAgICAgICAgICAgICAgICAgICAgJzxsYWJlbCBmb3I9ImlkX25hbWUiPlVzZXJuYW1lPC9sYWJlbD4nICsKICAgICAgICAgICAgICAgICAgICAnPGlucHV0IGlkPSJpZF9uYW1lIiBuYW1lPSJuYW1lIiB0eXBlPSJ0ZXh0IiAvPicgKwogICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJlcnJvcnMiPiZuYnNwOzwvZGl2PicgKwogICAgICAgICAgICAgICAgJzwvZGl2PicgKwogICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9InBhc3N3b3JkIGZpZWxkIj4nICsKICAgICAgICAgICAgICAgICAgICAnPGxhYmVsIGZvcj0iaWRfcGFzc3dvcmQiPlBhc3N3b3JkPC9sYWJlbD4nICsKICAgICAgICAgICAgICAgICAgICAnPGlucHV0IGlkPSJpZF9wYXNzd29yZCIgbmFtZT0icGFzc3dvcmQiIHR5cGU9InBhc3N3b3JkIiAvPicgKwogICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJlcnJvcnMiPiZuYnNwOzwvZGl2PicgKwogICAgICAgICAgICAgICAgJzwvZGl2PicgKwogICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImFjdGlvbnMiPicgKwogICAgICAgICAgICAgICAgICAgICc8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0iaWRfY2FuY2VsIiB2YWx1ZT0iQ2FuY2VsIiAvPicgKwogICAgICAgICAgICAgICAgICAgICc8aW5wdXQgdHlwZT0ic3VibWl0IiBpZD0iaWRfbG9naW4iIHZhbHVlPSJMb2dpbiIgLz4nICsKICAgICAgICAgICAgICAgICc8L2Rpdj4nICsKICAgICAgICAgICAgJzwvZm9ybT4nKTsKICAgICAgICAgICAgJGRpdi5iZVJlc2V0Q1NTKCk7CiAgICAgICAgICAgICQoJy5nZW5lcmFsX2Vycm9ycywgLmVycm9ycycsICRkaXYpLmNzcyh7Y29sb3I6J3JlZCd9KTsKICAgICAgICAgICAgJCgnI2lkX25hbWUnLCRkaXYpLnZhbCh1c2VybmFtZXx8JycpOwogICAgICAgICAgICAkKCcjaWRfY2FuY2VsJywgJGRpdikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJC5tb2RhbC5jbG9zZSgpOwogICAgICAgICAgICAgICAgY2FsbGJhY2sobGFzdF9lcnJvcik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkKCdmb3JtJywgJGRpdikuc3VibWl0KGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHZhciB1c2VybmFtZSA9ICQoJ2lucHV0W25hbWU9Im5hbWUiXScsICRkaXYpLnZhbCgpOwogICAgICAgICAgICAgICAgdmFyIHBhc3N3b3JkID0gJCgnaW5wdXRbbmFtZT0icGFzc3dvcmQiXScsICRkaXYpLnZhbCgpOwogICAgICAgICAgICAgICAgJCgnLnVzZXJuYW1lIC5lcnJvcnMnLCAkZGl2KS50ZXh0KAogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID8gJyc6ICdQbGVhc2UgZW50ZXIgYSB1c2VybmFtZScKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkKCcucGFzc3dvcmQgLmVycm9ycycsICRkaXYpLnRleHQoCiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQgPyAnJzogJ1BsZWFzZSBlbnRlciBhIHBhc3N3b3JkJwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICh1c2VybmFtZSAmJiBwYXNzd29yZCkgewogICAgICAgICAgICAgICAgICAgIHVpLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZCwgZnVuY3Rpb24gKGVycm9yLCBkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9kZWJ1Zyh7ZXJyb3I6ZXJyb3J9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIGVycm9yICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9lcnJvciA9IGVycm9yOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yX21zZyA9IGVycm9yLm1lc3NhZ2UgfHwgIkVycm9yICIrKGVycm9yLnN0YXR1cyB8fCAnJykrIiBsb2dnaW5nIGluIChuZXR3b3JrIGNvbm5lY3Rpb24/KSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuZ2VuZXJhbF9lcnJvcnMnLCAkZGl2KS50ZXh0KGVycm9yX21zZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCRkaXYpLmZhZGVPdXQoJ3Nsb3cnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5tb2RhbC5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRkaXYubW9kYWwoc2V0dGluZ3Muc2ltcGxlbW9kYWwpOwogICAgICAgICAgICBfLmRlbGF5KCBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgaWYoIHVzZXJuYW1lICkgewogICAgICAgICAgICAgICAgICAgICQoJyNpZF9wYXNzd29yZCcpLmZvY3VzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIDUwICk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB1aS5kaWFsb2dzLndhcm5fdXNlcl9kaXNjcmVwYW5jeSA9IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGlmKCAhY2FsbGJhY2sgKSB7IGNhbGxiYWNrID0gZnVuY3Rpb24oKXt9OyB9CiAgICAgICAgICAgIHZhciB3aG8gPSBzZXR0aW5ncy51c2VyX2lkWzBdPT0nKicgPyAnYW5vbnltb3VzIHVzZXJzJyA6IHNldHRpbmdzLnVzZXJfaWQ7CiAgICAgICAgICAgICQubG9nKCd1c2VyIGxvZ2dlZCBpbiBhcyAnK25hbWUrJyBidXQgdGhpcyBib29rbWFya2xldCB3YXMgY29uZmlndXJlZCBmb3IgJyt3aG8gKTsKICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgJ25vdCBpbXBsZW1lbnRlZCB5ZXQnKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiB1aTsKICAgIH07CgoKICAgIC8qKgogICAgICogcHV0IG5yYW1hIHRvZ2V0aGVyIHdoZW4gdXNlZCBhcyBia21ya2x0IG9yIGVtYmVkZGVkIDxzY3JpcHQ+CiAgICAgKiAoc2VlIG5yYW1hMl9pbml0LmpzIGZvciB0aGUgY29ycmVzcG9uaW5nIGluaXQgZm9yIHRoZSBzZXJ2ZXIgcGFydHMpCiAgICAgKiBjYXV0aW9uOiBzb21lIGluaXQgcmVxdWlyZXMgcGFnZSBsb2FkIHRvIGJlIGNvbXBsZXRlCiAgICAgKiBAcGFyYW0gY2FsbGJhY2t7RnVuY3Rpb259IGlzIGNhbGxlZCB3aGVuIGluaXQgZG9uZS4KICAgICAqLwogICAgdmFyIF9ucmFtYV9pbml0ID0gZnVuY3Rpb24obnJhbWEsIGpRdWVyeSwgY2FsbGJhY2spIHsKICAgICAgICBucmFtYS4kID0galF1ZXJ5OwoKICAgICAgICBucmFtYS51dWlkID0gZXhwb3J0cy5fbWFrZV91dWlkKHV1aWQpOwoKICAgICAgICBucmFtYS5zZXR0aW5ncyA9IGV4cG9ydHMuX21ha2Vfc2V0dGluZ3MobnJhbWEudXVpZCk7CiAgICAgICAgLy9kZXRlY3QgdXNlciBpZiBzZXQgYnkgYmttcmtsdCBvciBzY3JpcHQgKHdpbGwgYmUgb3ZlcnJpZGVuIGJ5IHNlc3Npb24gY29va2llcykKICAgICAgICBpZiggdHlwZW9mIF9ucmFtYV91c2VyICE9PSAndW5kZWZpbmVkJyAmJiBfbnJhbWFfdXNlciApIHsKICAgICAgICAgICAgbnJhbWEuc2V0dGluZ3MudXNlcl9pZCA9IF9ucmFtYV91c2VyOwogICAgICAgIH0KCiAgICAgICAgbnJhbWEuX2RlYnVnID0gZXhwb3J0cy5fbWFrZV9kZWJ1ZyhucmFtYS5zZXR0aW5ncywgd2luZG93KTsKICAgICAgICBucmFtYS5sb2cgPSBleHBvcnRzLl9tYWtlX2xvZ2dpbmcobnJhbWEuc2V0dGluZ3MsIG5yYW1hLiQpOwogICAgICAgIG5yYW1hLnJwYyA9IGV4cG9ydHMuX21ha2VfcnBjKG5yYW1hLnNldHRpbmdzLCBlYXN5WERNLCBucmFtYS4kKTsKICAgICAgICBucmFtYS5kYiA9IGV4cG9ydHMuX21ha2VfZGIobnJhbWEucnBjLCBucmFtYS4kKTsKICAgICAgICBucmFtYS5zZXNzaW9uID0gZXhwb3J0cy5fbWFrZV9zZXNzaW9uKG5yYW1hLnJwYyk7CiAgICAgICAgbnJhbWEucGVyc2lzdCA9IGV4cG9ydHMuX21ha2VfcGVyc2lzdChucmFtYS5kYiwgbnJhbWEuc2Vzc2lvbiwgbnJhbWEudXVpZCwgbnJhbWEuX2RlYnVnKTsKICAgICAgICAKICAgICAgICB2YXIgbGliID0gewogICAgICAgICAgICBiNjRfaG1hY19tZDUgOiB3aW5kb3cuYjY0X2htYWNfbWQ1LAogICAgICAgICAgICByYW5neSA6IHdpbmRvdy5yYW5neSwKICAgICAgICAgICAgQmlidGV4UGFyc2VyIDogd2luZG93LkJpYnRleFBhcnNlciwKICAgICAgICAgICAgJCA6IGpRdWVyeSwKICAgICAgICAgICAgXyA6IHdpbmRvdy5fCiAgICAgICAgfTsKICAgICAgICBucmFtYS5zZXJpYWxpemVycyA9IGV4cG9ydHMuX21ha2Vfc2VyaWFsaXplcnMobnJhbWEuc2V0dGluZ3MsIGxpYik7CiAgICAgICAgbnJhbWEuc291cmNlcyA9IGV4cG9ydHMuX21ha2Vfc291cmNlcyhucmFtYS5zZXR0aW5ncywgbnJhbWEucGVyc2lzdCwgbnJhbWEuX2RlYnVnLCBsaWIpOwogICAgICAgIG5yYW1hLnF1b3RlcyA9IGV4cG9ydHMuX21ha2VfcXVvdGVzKG5yYW1hLnNldHRpbmdzLCBucmFtYS51dWlkLCBucmFtYS5wZXJzaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5yYW1hLnNvdXJjZXMsIG5yYW1hLnNlcmlhbGl6ZXJzLCBucmFtYS5fZGVidWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGliKTsKICAgICAgICBucmFtYS5ub3RlcyA9IGV4cG9ydHMuX21ha2Vfbm90ZXMobnJhbWEuc2V0dGluZ3MsIG5yYW1hLnV1aWQsIG5yYW1hLnBlcnNpc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5yYW1hLnNvdXJjZXMsIG5yYW1hLnF1b3RlcywgbnJhbWEuX2RlYnVnKTsKICAgICAgICBucmFtYS51aSA9IGV4cG9ydHMuX21ha2VfdWkobnJhbWEuc2V0dGluZ3MsIG5yYW1hLnNlc3Npb24sIG5yYW1hLl9kZWJ1Zyk7CgogICAgICAgIC8qKgogICAgICAgICAqIG1haW4gc2V0dXA6CiAgICAgICAgICogIC0gaW5pdCBkZXBlbmRlbmNpZXMgJiBucmFtYQogICAgICAgICAqICAtIGxvYWQgbm90ZXMgJiBxdW90ZXM7CiAgICAgICAgICogIC0gY29uZmlndXJlIGV2ZW50cyAoc2VsZWN0IHRvIGNyZWF0ZSBxdW90ZSwgZXRjKQogICAgICAgICAqLwogICAgICAgIG5yYW1hLiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBucmFtYS5zZXR0aW5ncy5wYWdlX2lkIGlzIGEgdmFsdWUgcy50LiB0d28gcGFnZSBpbnN0YW5jZXMgaGF2ZSB0aGUgc2FtZSBwYWdlX2lkIGV4YWN0bHkKICAgICAgICAgICAgICogICB3aGVuIHdlIHdhbnQgdG8gbG9hZCB0aGUgc2FtZSBub3RlcyAmIHF1b3RlcyBvbnRvIHRob3NlIHBhZ2VzLiAgVGhpcyBpcyByZWFsbHkKICAgICAgICAgICAgICogICBoYXJkIHRvIGNvbXB1dGUgKGUuZy4gRE9JIGhlbHBzIGJ1dCBpZiBkaWZmZXJlbnQgdXNlcnMgc2VlIGFuIGFydGljbGUgd2l0aAogICAgICAgICAgICAgKiAgIGRpZmZlcmVudCBmb3JtYXR0aW5nLCBzaG91bGQgd2UgbG9hZCB0aGUgc2FtZSBub3RlcyAmIHF1b3Rlcz8gIFByb2JhYmx5LikKICAgICAgICAgICAgICogSW4gZnV0dXJlIHRoaXMgbWlnaHQgYmUgZG9pIG9yIHNpbWlsYXIKICAgICAgICAgICAgICovCiAgICAgICAgICAgIG5yYW1hLnNldHRpbmdzLnBhZ2VfaWQgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wrIi8vIit3aW5kb3cubG9jYXRpb24uaG9zdCt3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7ICAvL3RoZSB1cmwgd2l0aCBubyA/cXVlcnkgb3IgI2FuY2hvciBkZXRhaWxzCiAgICAgICAgICAgIC8vcmVtb3ZlIHRyYWlsaW5nIHNsYXNoCiAgICAgICAgICAgIHZhciBsYXN0ID0gbnJhbWEuc2V0dGluZ3MucGFnZV9pZC5sZW5ndGgtMTsKICAgICAgICAgICAgaWYoIG5yYW1hLnNldHRpbmdzLnBhZ2VfaWRbbGFzdF09PScvJyApIHsKICAgICAgICAgICAgICAgIG5yYW1hLnNldHRpbmdzLnBhZ2VfaWQgPSBucmFtYS5zZXR0aW5ncy5wYWdlX2lkLnNsaWNlKDAsbGFzdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiB0aGlzIGlzIHRoZSBub2RlIHdpdGhpbiB3aGljaCBub3RlcyBhbmQgcXVvdGVzIGFyZSBwb3NzaWJsZSBhbmQKICAgICAgICAgICAgICogcmVsYXRpdmUgdG8gd2hpY2ggdGhlaXIgbG9jYXRpb25zIGFyZSBkZWZpbmVkLgogICAgICAgICAgICAgKiBNaWdodCBldmVudHVhbGx5IGJlIGNvbmZpZ3VyZWQgcGVyLXNpdGUKICAgICAgICAgICAgICovCiAgICAgICAgICAgIC8vbnJhbWEuc2V0dGluZ3Mucm9vdF9ub2RlID0gbnJhbWEuJCgnI3JlYWRPdmVybGF5JylbMF07IAogICAgICAgICAgICBucmFtYS5zZXR0aW5ncy5yb290X25vZGUgPSBkb2N1bWVudC5ib2R5OwogICAgCiAgICAgICAgICAgIHJhbmd5LmluaXQoKTsKICAgIAogICAgICAgICAgICBucmFtYS4kLmxvZygnbnJhbWE6IHN0YXJ0aW5nIC4uLicpOwogICAgICAgICAgICBucmFtYS51aS5kaWFsb2dzLmxvZ2luX2lmX25lY2Vzc2FyeShmdW5jdGlvbihlcnJvciwgaWdub3JlKXsKICAgICAgICAgICAgICAgIGlmKCBlcnJvciApIHsKICAgICAgICAgICAgICAgICAgICBucmFtYS5fZGVidWcoe21zZzonZXJyb3IgbG9nZ2luZyBpbicsZXJyb3I6ZXJyb3J9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy9fLmRlZmVyIG1lYW5zIHdhaXQgdW50aWwgY2FsbHN0YWNrIGNsZWFyZWQKICAgICAgICAgICAgICAgICAgICBfLmRlZmVyKG5yYW1hLnF1b3Rlcy5sb2FkLCBucmFtYS5zZXR0aW5ncy5wYWdlX2lkLCBmdW5jdGlvbihlcnJvciwgZGF0YSl7CiAgICAgICAgICAgICAgICAgICAgICAgIF8uZGVmZXIobnJhbWEubm90ZXMubG9hZCwgbnJhbWEuc2V0dGluZ3MucGFnZV9pZCwgbnJhbWEuX2RlYnVnICk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIGNvbmZpZ3VyZSBldmVudHMgLS0tCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBkZWFsIHdpdGggNDAzIEZvcmJpZGRlbiBldmVudHMgKHNlc3Npb24gZXhwaXJlcywgZXRjKQogICAgICAgICAgICBucmFtYS4kKGRvY3VtZW50KS5iaW5kKCducmFtYV80MDMnLCBmdW5jdGlvbihlLCB1c2VyX2lkKXsKICAgICAgICAgICAgICAgIG5yYW1hLnVpLmRpYWxvZ3MubG9naW4odXNlcl9pZCwgJ1BsZWFzZSBsb2dpbiBhbmQgcmUtdHJ5LicsIG5yYW1hLl9kZWJ1Zyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy90aHJvdHRsZTIgaXMgbGlrZSBfLnRocm90dGxlKGZuKSBidXQgdGhpcyBjYWxscyBmbiBCRUZPUkUgdGltb3V0CiAgICAgICAgICAgIHZhciB0aHJvdHRsZTIgPSBmdW5jdGlvbihmdW5jKSB7CiAgICAgICAgICAgICAgICB2YXIgdGltZW91dDsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc2V0X3RpbWVvdXQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBpZiggIXRpbWVvdXQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KHJlc2V0X3RpbWVvdXQsIG5yYW1hLnNldHRpbmdzLmV2ZW50X2RlbGF5KTsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gaGlnaGxpZ2h0aW5nIHRleHQgY3JlYXRlcyBhIHF1b3RlCiAgICAgICAgICAgIHZhciBjcmVhdGVfcXVvdGVfZnJvbV9zZWxlY3Rpb24gPSBmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgIGlmKCBlLnNoaWZ0S2V5IHx8IGUuY3RybEtleSB8fCBlLmFsdEtleSB8fCBlLm1ldGFLZXkpIHsKICAgICAgICAgICAgICAgICAgICAvL2FueSBtb2RpZmllciBrZXkgY2FuY2VscyBxdW90ZSBjcmVhdGlvbgogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vbnJhbWEuJC5sb2coIm5yYW1hMiBjYXVnaHQgbW91c2UgdXAiKTsKICAgICAgICAgICAgICAgIHZhciBzZWxlY3Rpb24gPSByYW5neS5nZXRTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICAgIGlmKCBzZWxlY3Rpb24uaXNDb2xsYXBzZWQgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gc2VsZWN0aW9uLmdldFJhbmdlQXQoMCk7CiAgICAgICAgICAgICAgICAvL2NoZWNrIHRoYXQgbm90IHRvbyBtdWNoIHRleHQgaGFzIGJlZW4gc2VsZWN0ZWQgKGF2b2lkIGFjY2lkZW50YWwgc2VsZWN0aW5nIGxvYWRzIG9mIGRvYykKICAgICAgICAgICAgICAgIGlmKCBucmFtYS5zZXR0aW5ncy5tYXhfcXVvdGVfbGVuZ3RoID4gMCApIHsKICAgICAgICAgICAgICAgICAgICBpZiggcmFuZ2UudG9TdHJpbmcoKS5sZW5ndGggPiBucmFtYS5zZXR0aW5ncy5tYXhfcXVvdGVfbGVuZ3RoICl7CiAgICAgICAgICAgICAgICAgICAgICAgIG5yYW1hLiQubG9nKCducmFtYSBubyBxdW90ZSAtLSAnICsgcmFuZ2UudG9TdHJpbmcoKS5sZW5ndGggKyAnIGNoYXJhY3RlcnMgc2VsZWN0ZWQuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgcXVvdGUgPSBucmFtYS5xdW90ZXMuY3JlYXRlKHJhbmdlKTsKICAgICAgICAgICAgICAgIGlmKCBxdW90ZS5jb250ZW50ICE9ICcnICkgewogICAgICAgICAgICAgICAgICAgIG5yYW1hLnF1b3Rlcy5zYXZlKHF1b3RlLCBmdW5jdGlvbihlcnJvciwgZGF0YSl7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vKHRvZG8gLS0gc29tZSBpbmRpY2F0ZSB0aGF0IGl0IGhhcyBmYWlsZWQ/CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBucmFtYS5xdW90ZXMuZGlzcGxheShxdW90ZSk7ICAgLy9kaXNwbGF5IHRoZSBxdW90ZSBvbmx5IGFmdGVyIGl0IGhhcyBiZWVuIHNhdmVkCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBucmFtYS5fZGVidWcoKGZ1bmN0aW9uKCl7IHZhciBhPXt9OyBhW3F1b3RlLl9pZF09cXVvdGU7IHJldHVybiBhOyB9KSgpKTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG5yYW1hLiQoZG9jdW1lbnQpLmJpbmQoIm1vdXNldXAiLCB0aHJvdHRsZTIoY3JlYXRlX3F1b3RlX2Zyb21fc2VsZWN0aW9uKSApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy9jbGljayBhIHF1b3RlIHRvIGNyZWF0ZSBhIG5vdGUKICAgICAgICAgICAgdmFyIGNyZWF0ZV9ub3RlX2Zyb21fcXVvdGVfY2xpY2sgPSBmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgIGlmKCBlLnNoaWZ0S2V5IHx8IGUuY3RybEtleSApIHsKICAgICAgICAgICAgICAgICAgICAvL3NoaWZ0IGtleSBjYW5jZWxzIG5vdGVjcmVhdGlvbiwgc28gZG9lcyBjdHJsCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoIGUuYWx0S2V5IHx8IGUubWV0YUtleSApIHsKICAgICAgICAgICAgICAgICAgICAvL2FsdCBrZXkgY2F1c2VzIHF1b3RlIGRlbGV0aW9uIChpbiBzZXBhcmF0ZSBoYW5kbGVyKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gICAKICAgICAgICAgICAgICAgIHZhciBxdW90ZSA9IG5yYW1hLiQodGhpcykuZGF0YSgnbnJhbWFfcXVvdGUnKTsKICAgICAgICAgICAgICAgIHZhciBub3RlID0gbnJhbWEubm90ZXMuY3JlYXRlKHF1b3RlKTsKICAgICAgICAgICAgICAgIG5yYW1hLm5vdGVzLmRpc3BsYXkobm90ZSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG5yYW1hLiQoJy5fbnJhbWEtcXVvdGUnKS5saXZlKCdjbGljaycsIHRocm90dGxlMihjcmVhdGVfbm90ZV9mcm9tX3F1b3RlX2NsaWNrKSApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gYWx0LSBvciBtZXRhLWNsaWNrIGEgcXVvdGUgdG8gZGVsZXRlIGl0IChhZnRlciBjaGVja2luZyB0aGVyZSBhcmUgbm8gbGlua2VkIG5vdGVzKQogICAgICAgICAgICBucmFtYS4kKCcuX25yYW1hLXF1b3RlJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgIGlmKCBlLmFsdEtleSB8fCBlLm1ldGFLZXkgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHF1b3RlID0gbnJhbWEuJCh0aGlzKS5kYXRhKCducmFtYV9xdW90ZScpOwogICAgICAgICAgICAgICAgICAgIHZhciBub3RlX2lkcyA9IG5yYW1hLm5vdGVzLmZpbmQocXVvdGUpOwogICAgICAgICAgICAgICAgICAgIGlmKCBub3RlX2lkcy5sZW5ndGggIT0gMCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9kb24ndCBkZWxldGUgcXVvdGVzIHdpdGggbm90ZXMgYXR0YWNoZWQgLi4uCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkcXVvdGVfbm9kZXMgPSBucmFtYS4kKCcuJytxdW90ZS5faWQpOwogICAgICAgICAgICAgICAgICAgICAgICAkcXVvdGVfbm9kZXMuY3NzKHsnYm9yZGVyLXRvcCc6JzFweCBkYXNoZWQgcmVkJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYm9yZGVyLWJvdHRvbSc6JzFweCBkYXNoZWQgcmVkJ30pCiAgICAgICAgICAgICAgICAgICAgICAgIC8vLi4uIGluc3RlYWQgbWFrZSB0aGUgcmVsZXZhbnQgbm90ZXMgYm91bmNlCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHN0ciA9ICcjJyArIG5vdGVfaWRzLmpvaW4oJywgIycpOwogICAgICAgICAgICAgICAgICAgICAgICBucmFtYS4kKGlkc3RyKS5lZmZlY3QoJ2JvdW5jZScsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVvdGVfbm9kZXMuY3NzKHsnYm9yZGVyLXRvcCc6J25vbmUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYm9yZGVyLWJvdHRvbSc6J25vbmUnfSw1MDApCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG5yYW1hLnF1b3Rlcy5yZW1vdmUocXVvdGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAKICAgICAgICAgICAgLy9jbGljayBvbiBhIG5vdGUgdG8gZW5hYmxlIGVkaXRpbmcsIGJyaW5nIGl0IHRvIHRoZSBmcm9udCBhbmQgZmxhc2ggdGhlIGFzc29jaWF0ZWQgcXVvdGUKICAgICAgICAgICAgbnJhbWEuJCgnLl9ucmFtYS1ub3RlIHRleHRhcmVhJykubGl2ZSgnY2xpY2snLGZ1bmN0aW9uKGUpewogICAgICAgICAgICAgICAgdmFyICR0ZXh0YXJlYSA9IG5yYW1hLiQodGhpcyk7CiAgICAgICAgICAgICAgICB2YXIgJG5vdGUgPSBucmFtYS4kKHRoaXMpLnBhcmVudHMoJy5fbnJhbWEtbm90ZScpLmZpcnN0KCk7CiAgICAgICAgICAgICAgICBucmFtYS5ub3Rlcy5icmluZ190b19mcm9udCgkbm90ZSk7CiAgICAgICAgICAgICAgICB2YXIgbm90ZT0gJG5vdGUuZGF0YSgnbnJhbWFfbm90ZScpOwogICAgICAgICAgICAgICAgbnJhbWEucXVvdGVzLmZsYXNoKG5vdGUucXVvdGVfaWQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vdGFiYmluZyBvdXQgb2YgYSBub3RlIGRvZXNuJ3QgbW92ZSB0byBuZXh0IG5vdGUgKGJlY2F1c2Ugd2VpcmQpLgogICAgICAgICAgICAvL3RoYW5rIHlvdSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEzMTQ0NTAvanF1ZXJ5LWhvdy10by1jYXB0dXJlLXRoZS10YWIta2V5cHJlc3Mtd2l0aGluLWEtdGV4dGJveAogICAgICAgICAgICBucmFtYS4kKCcuX25yYW1hLW5vdGUnKS5saXZlKCdrZXlkb3duJyxmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgIGlmKCBlLndoaWNoID09IDkgKSB7CiAgICAgICAgICAgICAgICAgICAgbnJhbWEuJCgndGV4dGFyZWEnLCB0aGlzKS5ibHVyKCk7CiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vID09PSBpbml0IGRvbmUKICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICB9KTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBJVCBBTEwgU1RBUlRTIEhFUkUKICAgICAqIERldGVybWluZSBob3cgdG8gaW5pdGlhbGl6ZSBkZXBlbmRpbmcgb24gd2hldGhlciBib29rbWFya2xldCBvciBlbWJlZGRlZCBpbiBwYWdlCiAgICAgKi8KICAgIGlmKCB0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcgKSB7ICAgIC8vZXhwb3J0cyB1bmRlZmluZWQgbWVhbnMgbnJhbWEgaXMgYWxyZWFkeSBsb2FkZWQgLS0gYm9va21hcmtsZXQgbWF5IGJlIGNhbGxlZCBtb3JlIHRoYW4gb25jZSkKCiAgICAgICAgaWYoIHR5cGVvZiBfbnJhbWFfYmtta2x0ID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgcmVxdWlyZSAhPT0gJ3VuZGVmaW5lZCcgKSB7CiAgICAgICAgICAgIC8vdGhpcyBzY3JpcHQgaXMgYmVpbmcgdXNlZCBhcyBhIGNvbW1vbkpTIG1vZHVsZQogICAgICAgICAgICAvL2FscmVhZHkgZGVmaW5lZCBleHBvcnRzOyBpbml0aWFsaXNhdGlvbiBpcyBoYW5kbGVkIGluIGFub3RoZXIgbW9kdWxlLgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmKCB0eXBlb2YgX25yYW1hX2JrbWtsdCA9PT0gJ3VuZGVmaW5lZCcgfHwgIV9ucmFtYV9ia21rbHQgKSB7CiAgICAgICAgICAgICAgICAvL3J1biBhcyBlbWJlZGRlZCA8c2NyaXB0PiAKICAgICAgICAgICAgICAgIF9ucmFtYV9pbml0KGV4cG9ydHMsIGpRdWVyeSwgZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICBleHBvcnRzLl9pbml0YWxpemVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gcnVuIGluIGJvb2ttYXJrbGV0IG1vZGUKICAgICAgICAgICAgICAgIC8vIGZpcnN0IHJlbW92ZSBoZWFkIC0tIGZvciBzb21lIHJlYXNvbiB0aGlzIHNlZW1zIHRvIGhlbHAgYXZvaWQgY2xhc2hlcyBpbiBGRgogICAgICAgICAgICAgICAgdmFyIG9sZF9oZWFkID0gZG9jdW1lbnQuaGVhZC5pbm5lckhUTUw7CiAgICAgICAgICAgICAgICB2YXIgcmVzdG9yZV9kb2N1bWVudF9oZWFkID0gZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5oZWFkLmlubmVySFRNTCA9IG9sZF9oZWFkOwogICAgICAgICAgICAgICAgfTsgCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgICAgICAgICAvL2FsdC4gbWV0aG9kIC0tIGNhbid0IHNldCBpbm5lckhUTUwgd2l0aCBzYWZhcmkgKG90aGVycz8pCiAgICAgICAgICAgICAgICAgICAgdmFyIGhlYWQgPSBkb2N1bWVudC5oZWFkOwogICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IFtdOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKGhlYWQuZmlyc3RDaGlsZCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IGhlYWQuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIGNoaWxkLm5vZGVOYW1lICE9PSAnU0NSSVBUJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goIGNoaWxkICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaGVhZC5yZW1vdmVDaGlsZCggY2hpbGQgKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXN0b3JlX2RvY3VtZW50X2hlYWQgPSBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSggY2hpbGRyZW4ubGVuZ3RoICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZC5hcHBlbmRDaGlsZCggY2hpbGRyZW4ucG9wKCkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAKICAgICAgICAgICAgICAgIC8vIGxvYWQgbGlicmFyaWVzICYgb25seSBzdGFydCB3b3JrIGFmdGVyIHRoZXkgbG9hZGVkCiAgICAgICAgICAgICAgICAvLyBhZGFwdGVkIGZyb20galF1ZXJ5IGFqYXhUcmFuc3BvcnQsIHRoYW5rIHlvdSBhbHNvIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNzU2MzgyL2Jvb2ttYXJrbGV0LXdhaXQtdW50aWwtamF2YXNjcmlwdC1pcy1sb2FkZWQKICAgICAgICAgICAgICAgIHZhciBsb2FkU2NyaXB0MiA9IGZ1bmN0aW9uKHVybCwgY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaGVhZCA9IGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICJoZWFkIiApWzBdIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICAgICAgICAgICAgICAgICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggInNjcmlwdCIgKTsKICAgICAgICAgICAgICAgICAgICAvL3NjcmlwdC5jaGFyc2V0ID0gc2V0IHRoaXM/JAogICAgICAgICAgICAgICAgICAgIHNjcmlwdC5zcmMgPSB1cmw7CiAgICAgICAgICAgICAgICAgICAgc2NyaXB0Lm9ubG9hZCA9IHNjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiggXywgaXNBYm9ydCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBpc0Fib3J0IHx8ICFzY3JpcHQucmVhZHlTdGF0ZSB8fCAvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KCBzY3JpcHQucmVhZHlTdGF0ZSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIG1lbW9yeSBsZWFrIGluIElFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHQub25sb2FkID0gc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHNjcmlwdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBoZWFkICYmIHNjcmlwdC5wYXJlbnROb2RlICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQucmVtb3ZlQ2hpbGQoIHNjcmlwdCApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVyZWZlcmVuY2UgdGhlIHNjcmlwdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0ID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhaXNBYm9ydCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayggMjAwLCAic3VjY2VzcyIgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIGluc2VydEJlZm9yZSBpbnN0ZWFkIG9mIGFwcGVuZENoaWxkICB0byBjaXJjdW12ZW50IGFuIElFNiBidWcuCiAgICAgICAgICAgICAgICAgICAgaGVhZC5pbnNlcnRCZWZvcmUoIHNjcmlwdCwgaGVhZC5maXJzdENoaWxkICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2FkU2NyaXB0MihfTlJBTUFfTElCX1VSTCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5Lm5vQ29uZmxpY3QoKTsKICAgICAgICAgICAgICAgICAgICBfbnJhbWFfaW5pdChleHBvcnRzLCBqUXVlcnksIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3RvcmVfZG9jdW1lbnRfaGVhZCgpOwogICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzLl9pbml0YWxpemVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQovLyBpZiBleHBvcnRzIGlzIG5vdCBkZWZpbmVkLCBvciBpZiBfbnJhbWFfYmtta2x0IGV4aXN0cywgYXR0YWNoIGV2ZXJ5dGhpbmcgdG8gdGhpcy5ucmFtYQovLyAgICAgYnV0IGlmIG5yYW1hIGlzIGFscmVhZHkgZGVmaW5lZCwgZG8gbm90aGluZyAoc2VuZCB1bmRlZmluZWQpCi8vIG90aGVyd2lzZSBiZWhhdmUgYXMgYSBjb21tb25KUyBtb2R1bGUKfSkoCiAgICAoIHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgX25yYW1hX2JrbWtsdCA9PT0gJ3VuZGVmaW5lZCcgKSA/CiAgICAgICAgZXhwb3J0cwogICAgOigKICAgICAgICAoIHR5cGVvZiBucmFtYSA9PT0gJ3VuZGVmaW5lZCcgfHwgIW5yYW1hLl9pbml0YWxpemVkICkgPwogICAgICAgICAgICBucmFtYT17fQogICAgICAgIDoKICAgICAgICAgICAgdW5kZWZpbmVkICAgLy9wcmV2ZW50IGV4ZWN1dGlvbiBpZiBucmFtYSBhbHJlYWR5IGRlZmluZWQKICAgICkKKTsgICA="
        },
        "static/img/nrama_demo.png": {
            "content_type": "image/png",
            "data": "iVBORw0KGgoAAAANSUhEUgAAAokAAADOCAYAAABSFZjcAACtkklEQVR42uzdBZQk1dXAcdw1OAQnuAQLrou7wwLB3d1Z3N1tcXf3hcXdkyDBAiQhQeJEvkh9+3vhdmpqukd6enZml3fPeWemS55Vdde/rr1R/vnPfxa55JJLLrnkkiVLlixlGSX/MOaSSy655JIhMUuWLBkSc8kll1xyyZCYJUuWDIm55JJLLrlkSMySJUuGxFxyySWXXDIkZsmSJUNiLrnkkksuGRKzZMmSITGXXHLJJZcMiVmyZMmQmEsuueSSS/+DxCFDhhTbbbddcdJJJxX//ve/a9tvvfXW4uabb85P1ixZMiTmkksuueTyXYTEX/ziF8VKK61UTDDBBMUrr7yStv3lL38pVl555eKzzz7rFw+3jz76qFh33XVr/cuSJUuGxFxyySWXXIaDufnTTz8txhprrOKHP/xh8a9//au47LLLivvuu6+2/x//+EcCx2+++Sbt/89//pP+/v3vf0/aR+X//u//UrFP+3/729/SMc4pi2OdF8fYX9ZgqqPcFnn22WdT/1566aXasY5zjLq0qcS5SpybJUuWDIm55JJLLrn0wCcRGI466qjFqaeeWqy++uoJ4Mj7779fLLfccsVVV11VLLzwwsUee+yRYOywww4rZp999uK3v/1tce211xYLLrhgOvfXv/51sfnmmxfTTDNNcdRRRxVTTjllm3YuuuiiYt55503HzDfffMXkk09eXHjhhTVYXXHFFVN9q622WrHRRhslEDzkkEOK0UYbrVh88cWL2267rfjVr35VDBw4sDj88MOL+eefv3jqqaeKP/7xj+mcSy65pNhmm22KJ598MlNBliwZEnPJJZdccukpJH799dfFDDPMUIwzzjjFJ598UtP6zTPPPMVWW22VPl9//fXF6KOPXnzxxRfFG2+8UYwyyijF73//+7TPeWeeeWb6/6GHHkr7zjnnnOLss89u0w4Ttn18IP/85z8X0003XbHhhhsmTSAoBKTkkUceSdD62muvFc8991wx7rjjFm+++WY6DpAeeeSR6fyZZpqp2GGHHdK+WWedtXjrrbeSCf2nP/1ppoIsWTIk5pJLz0qYyXLJpS9Kf4FE8LX++usX008/fW0bAARn+++/f/r89ttvJ8B7/PHHE4QBxoDEiSeeuKYRfOaZZ9JxxleV3/zmN2nfjTfemD7TDvI3ZDZm7l577bXT9o8//jgdd91117WBRKZk2wHt0ksvnc4HojSatJJgdZJJJikeffTRTAVZsmRIzCWX1sMhH6xccml1GZ6w2IyAxO9///u1z8BNQEtoEt95552k3QN6NHZg7Ze//GU6js/gBRdc0GVIvOGGG9LnJZdcMkEiH8LFFluspkmkDXScYBX1gT/aS22NMcYYxSqrrNKm3t/97nfF66+/nuoFunvuuWemgixZMiTmkkvP4LD6IPcQyiWX3iqdgWNfQSKN4FJLLZW0cLR4Ucfpp59ezDjjjAkQBw0aVKy55ppp+1//+tdisskmKxZZZJGUQmfMMccsjjjiiFQP/0WA9+6777YJSiG0gfaddtppye+RXyIwdN4111yTfBl/9rOfJeBcaKGFij/96U/p89hjj11sscUWxauvvlocf/zxqb1jjjmmGDp0aPHEE0+k7drl1+g8/2fJkqUEif/55s0il1xyaVzqAWI8vD2wFA+/XHLprRL3WRkaewMUuyvMtS+++GLxwgsvJC1haAFp+Jh7r7766hQgwncx5L333kuaOz6MzqX1469Io6ceYFmFRBpC+0Ad07FjX3755dS+tmy//PLLk0n7888/T2ZwdfBN5OvID9Fn2kVBMKKw9UngiqAW/REFbV6zZMmSITGXXLoNiWWtYYChKErFg8uDKJdcWl0itYsSwFjWLvYlJGbJkiVDYi65fGfLv//yRjsNYuRpCzCkjfjDH/6QCvNXFP5OueTS3VK+h+K+co+VgbEMiq3UJmbJkiVLhsQOyjdfvVh8/uFjxZ9++3yej+94+eefXit+8/HjdQEx4DBg8Kuvviq+/PLLVJjOcsmlpyXuJ/dWwGPAYiNQzJCYJSSShXdFqub9LFkyJJbKrdeeVswy7RTFBKONVow9yiipnHH8vu2OG/rg4GLrjVcvnnhocIaokbj89hdDi43XWr6YfvJJirGG3QvzzjZb8dmnn7YDxIBDD3TRl3yhJAWWtFf0Zi65NFvcQ+4l95R7yz0WsFgFxQyJvS+CcvqrvyK/TPdKWQTmRPR3ZyIKnV9mWdSn3ixZMiR+W/7159eL24fB4njfQuLpx+3T7pjZp5867Zt3lunznI2k5bP3HilmnXbKdP3feO7mYsLRR0ugeMO11yZ/MOa+AMTXn7g7l1yGewlQdC+6J8vaxAyJvSN33313mu+eyk9+8pPi4osvbmnfrBIjiTixckyIJOONINGShbfffnv6/4QTTijuueeeNvvV19nqM4KSWjEnWTIkjlBlyQXnbgiJKy+1cNq30ZrL57kaScsOW6ydXhT++Jvn0ueXnri2uPiCC5JfWGgRmf1odTyww2csl1yGR3HPuffcg6FN7K+Q+MEHH6Q0M5EA26op9957b4osZt6Upuauu+5Ky+lFcu2ydgy43HLLLWlsDzzwQIIaUKwOKXGcf+edd6bE2SKVP/zww6QRAzgiqP0vstkc3XrrrUkbSPOqTdHMknyrW72A6OSTT07Rz4SZHxhaLUabEUVdHVOIbaK4RVgbTwQV3XHHHWkMoriZfi1juOuuu6a+6Jf+6wtNMVGHPpe1eMYlNY+lDvXr5z//eXpRMD5aZnOj/+qzCo0obfeEJQzN1bnnnttmfvXj6KOPTqmHaK1POeWUNIdnnHFGig43Tuc9//zztT49+OCDbSLUzeMGG2xQPPbYY+k+NN/SDz399NNpv/b1y+o5otxpxgGy+cuSIXGELmuusHhDc/Ofv3ihuP+284q//e7lPFcjYeGLOs6waz/frNO3CVzxYx+mZg8mP9ApZUeGxFz6ABLde+5B92LV5Dy8IBFIBJzG/0rZB84ayfomjyHA+MEPfpDaACjM6LvvvnvSRIGQWJ2FgA7HqptmjNbr/vvvT3kV1Q/ejH2//fZLx9qvLttWWGGFtHSf1DdS3fifgDfnHnDAAQlU9EPuRn2XQPuggw5KACb3IiiUx9F4QCKoDQFWMaaygKjll18+gbDk4gD00ksvTWCkLUm8Xb9jjz222GeffVJeRnCmz9L3OIeJGDCaK1BVlo033ji9HOjPj3/84zQW4/P3/PPPT+tdW81GPVIFmbtll102geVZZ52VwDTEfWK+5IsEo9bO9tn/1t9WJ2CW6xI0glH7yuD60UcfpfmzQo17EAwaJ3B0vrW6wezDDz9cbLrppsl87VoC9CwZEkdaSMxl5C6PP3BZuvZLLTRPDRCVCFgJU7Mfa2/wGRJz6QtIdO+5B8PkHAEsrfBL7KpYSm+llVZK8MHs6H9arLLfnuTVElQfdthhSTs277zzJlAAR0DNOeqxDcSVTbJzzz13MsuCD5oxMDjVVFMlQHY8EFl11VVr5yu0k1tvvXWtHvM055xzJqCmKXPOOuusUwNZx4IXgBXmVpADgCz1p30ARksYwjQbYyqvDEPrZrxk8ODBKY/jtttuW2sLHNJ+gsBYhpDPYPRfknB5I60eo49VjZv5MS/6ucQSS6Q+0lCqHzged9xx6bi99tqrds5mm22WIFhfIpl5iPZoVwlIDJ9EsEgArmULweyPfvSjYr311ku5Ksuy884718zNwN05Epfrk7bBL4h0f2TJkJghMZcRvlx+/qB07VdZeuF2kEi74EHlQU3jQBOSITGXvoBE95570Gf3ZPglDk9I7IoAMP1ca621EsjMNttsqa9gDkiAJCAXmskQMDLTTDMlLVs5QhewHXzwwQmmwufOXMT56qVtLAutXazoQoBlBHnQdqnbfpATkKhPINX8RlLuemOSPDyESTVA7corr0yaTBDFrByQSEMIVmMZwu233z6Ze6P/VpoBXUCQibgslhbcaaedEjCrQ9/ND2Hepp0tQx4B7ep17sorr9ymPprCgETa1ptvvjn9HxpHWkrmZxpRfQKRAbchO+ywQ9pHY2g9bPePMROJztVFwxrXliYy5iPLSAqJD991YXH0wTsV++y8WbHNJqsXt193evH1L58ujjlk52KFxRZIgHX84bsWf/j82brn/+MPrxTXXHJssd6qSxfzzzZDsci8Pyh+vOGqxYtDr21z3MdvP1iccMRuxYF7bJl8xE4+ao+0XXubrrNiijD+5L2Hu11vufzlyxeKM0/cL0WxLjTnzMVaA5Yozj7pgGKZReZtB4nPPX51ceyhuxT777ZFsf3ma6cxVuv7++9fSeevueLixQ9nn6lY/kcLFAfsvkWaryg3X31K8e4b96Tz7VNX+D7ed+u5xQarL1ssMvesxa7brF88M+SqWt2P3X9pGvfCc82S5pjJu7sA5DqdesxexYZrLFcs8IMZUz3XXnpcSvPSzDWK4jrstu0GxRI/nCv1fcsNVimOPGD7dH+0O/bdh9I8rLbsosWP5pu92G7gWsXdN53V43obld/96pk013xIF5xj5jQm19H28nHXXXZ86pd7wLUXoOTzUQftmOaiDIkeNh4SHhYZEnPpC0gMUAm/xFYGr7RSmHZpkpg7Cc0Ucy5tlz4zEwNHsMScXA2KoFUDPUy4xPiYhUP4+c0yyywJDJkx+SLSAIaGLfz5mE3LvoM0cbRntJv6scYaa6R6wSD4A0833XRTsfDCCyfQ4W/XaExlrWkA6HnnnVcceuihCc5mnXXW1BZw1Cd9nnzyyZNp2bKB1rym0TReRb38HQMeQ1zrFVdcMf1Pm0obG7LLLrsUa6+9dgI24CxamYl8nnnmSaZnZfbZZ08a1RBjB+IgEEyqg9l4yy23TBpBfaINpE01HpAfQF8GcOZppvG55porzZVrMWTIkDSW8ccfv5h55pmTZtTcasOcZBmJIREsAZhIE7PZugOKVZdZpNhv14EJ6ET92g4ufv7mPe2gzLHfn2ySFDX6169fSrAz2bhjFxONMXrxylPX14799QdDipMG7ZG2qw/QHLrPNgkuZpp68rTtsH237Xa9Ud58/pYESlNMMG5x45UnpZQnIAjYjV0nuvmNF24tDtl7q1qKHO1VcysuvsCcxcRjjlE8eMf5xf/98dUEtBEpve1maxY7brlOcdGZhyb4GXTg9ilq1j7gYu6WXXS+Ys8dNi5mnGqytF3fX3riuuLw/bZLoLTXjpvUoqsV6Xi6et1ef/amYo4ZpkmwZY7M2Vkn7Z/q2XeXzZq6RsqHP3ugmHLC8RJEmqOXn7wugR2/vgFLLNgufdB035u42Gqj1YoPf3p/iiLeY/uNUh+Mv9l6GxWQPdt0U6V7EoB/8ckTxb23nFP84PtTp3RH5TRG4H6nH69be0GYYcrvpc+u2Rkn7NcOEv1I+2HMkNhciehwJrr4XC290a4HeLkP1cKEC1zq7etOnzo6n+mPpqwnkOjecw/2d0ikQdK/ADZ/9bWsNdRmo9QyxlTuk/Or0bo+d5Sahlm2qr1yfFfGWm2/3pg6E+erpyyuUZwPnsr7gVq9um0L83a9eSj3rytpb6r96EjAZ73j9D3mp6xx1T7trO8TVwjaX0stAs0s3xFzM63h2N8+sCMKNGDJNvs8cJnqYh+NjO3fG2esNnXR1thOO1hth7bNPrB1ydmHt4kwDkjsbr1ACDzYxwetvO/3v36mmHbSCRtGNx+851ZtzJFRaJ3qtbX0wvOk7eCwWhcwsg94Xnnh0bXtgmIAnX2g89xTDvzf8nDD4BOM2rfJ2it06VoZE+gDeQIzYvsNV5xYm1sBOc3MJU2o7V98+mSb7TSEi80/x/8CQj4emkCT9rB8T0g7FGN99rGrul1vo+I819E4qi8rb710exozYK3Wf96pB7V5CdBXfWwFJDYCh2qJ9Ca9CUvd7VNHpZl2bBPUMIoo8hb0oSuFdmPAgAEN5xlA7rbbbsW0007ba30QoTreeOOlYIDvAiT2tQiaoMXrKjRlaY2ARVpGmlJa4NCidhWss4wEkLj5+iunhyk4qu57+9U7a9ouSarLJlNAtNyi87dLZO1YAFGt68wT9k37aBBj26/efzRp/wBpM/UyWZaDE7rjk1iFiCig0Xbaz/J2IGs7M2ajsVWBU6GZtY+JtLqPGd4+WsGuXKtD9vov2AKs8vaLzzqsdp1o2ZqZy4DgV5++oZ0mkFk7PtNWOu7Sc45o17+dt1ov7dtl6/W7XW+jEhpKJup6+91P9tPcNguJzEGdQWJ3IYKpS+qJnmqyehsMW1H4lY066qjJr2p4tMdkuM0226T2Gs0zP6rpp5++1/qgbVG70oT0BBLdexkSOxc+cFUt3sgq/Q2EaRC5RLjv+2sS8ix9BInKovPMlvbvvt2G7XzEqgmsgVX4gTUCqXqQ1Wy9TOG2801rFSTym7Qd8JS382G0na9hd8YGphIIzvuDdvuYse2beZrJu3StmFcdX9ZIKjTAJx65e/LHa3Yuw/WA1o6/I4Cv1wd9ddwt15ya/E3LhX9rFZa7Wm+jEi4JAlHq7Y/xuBd6CxK7Cw/K/PPPn9KBtEqD11MwjH6VS6uAieZu7LHHrttGb7XJJy7mWV656n6mYD5UrehTo/MERDCzNwv9GRKzVCV8MrNkGWEgUZBFIy2ZQkPEx89DOsync880XdOQ2NV6mZrH+VZ7dsUFR7UMEgX02M6MXd4uIMb2qy8+tltju+zcIxtqV++4/oy0j19dZ/Nh/enQFjqvO9e4K9eIf2X4UCrmdu2Vliweueei2jGCmGK/lUzUUa+ss/JS3aq3USm31yjA56qLjkn7xx911BRw1EpI5Hi+wAILJP8beco4psupFvAgSpDjPsd2zuZMMuABHErxIWJQ2g/bRBgeeeSRyYn8xBNPbAiLHO3LdcqXVg8OOfQLHBClyKmd87vjRFtKXSG1h2O0LY3HoosumqIsl1xyyWKOOeZITv/8i2jD5G0TrRnAVK2jkTaPmZlGTz/GHXfcNKfqqM4Lh/oAq+o82MbkeuCBB6Z2OeoDr0ZzH/UYa715jiJaVaCBhMdgzhxx8LfPHFfnrlHfjNVxMR/OLb8ICCRwjHQqhxxySC1S+bsOifoud1+WzkWgTyT0HjRoUEpc3RfiuyYIJ0uGxG5BYmjWrF5S3n7TVSengBGAQ1sG2u684cx0bDmBcXchsav1CojpDJqagcQwyfK723unTYqnHrmi5r9YDcoYnpBIAxfjbRRF3Oxc1vz/PnkimZOnmmi8WluK8Vfn/MmHL+/yPdZZvY0K7WQc+9CdF9Q95vrLT6wdE/6YrYJED38QAl5AAUiZYYYZ0v+vvPJKir4MMAIaEuP6X9JbkZp85/jxAC25zQJuJplkknR+FbyizvjMBws0NdJuicCU8wz8WGmCc7mUGvZFxKP/9REMSY/hf/V+73vfSw7o5kDOOz52jq1XR7XdyLcmZYnPNHnjjDNOqrujeYl5iPWyzYP8a9Jz0AzaLn+cFCSRS8/c+78891Gk64h51qfyPnBNu2kVDOdrg49izEd17hr1LebDdn5xMacKiBXhaj7B6MisSdQvsLzjjjumlwD3jv6CeWDjupeFdtkLguhh5lPz7Fo6vtw3LwiSbzvO/SRnoTkx79LkRLqZiGxWL1cCKWQEsYB5KW9E7ZYFzLtngD8BP5EKRvs+6495Nh4R0K6ldDLGKQ8ifzzfCy8N2nC/edGKZNOie+VK7AiGo68gkB+fFzapZEQXGxtTrkTiivptk0dRNHKAo3vN98MLjDYFn+jDFVdckb5bPus/f0HfnbKYU+MUsa0ec2vOrB4jv2IZ6jfZZJPUvmAscytKXNBK3IvmwoulMftuuCb6GEnOs3xHITFSiYgOjW3nn3ZwTRsFHKr+btLGNAOJ3a1XRHOjYJKeQKIgCNowEbnGzXewXmT18IREkDPJWGOm4/W9s+ObuUblgBsgam4CwF54/JrUh0nHHit95kva3XutUb0djVnAiuOk+Kk79yfuV1fz2ypzM782wAEc/CjSmPmx9YPtx7+suZImgiZJ3bR1sdwYE5LcZn7oPWTs82CSWkLKEMUPvIet3GQBZM6fcMIJkz9W+VgPB/XKTQdOynDk4UMj4GGnPwFrtGA0b/6nRZRGI/YBUQ/PRnVUzaweoh6c8dmDPjSJ1XkBfTEvjebBw3yKKaZID0qpT4xdXeY+tLMiW8vayijlea5CIoCM4wW3jDbaaOnh57NUHuW5a9S3mA8PxuqcgkTn0CKG1nFEhESgAsT0If43X+WcgtLFmDvQI82Ke5J2FYRoS+qZsi+d7wOA8cLkPCABkmiX3WshtqlHmhftxwuKdDr+giJBSvolYbfvoOJamh9aZGleLCkXYk5dF/AUL2q0vNoCSBJum2tacGN0zwFV7dNau/f1Wa7EWNHF9ZfM2xjBKqADUa4dwG0k7iHnAzDtaxsoBpT5a5UY8Kx9kCZPov99v50rFY570P/S1PirD+5Z4OYlDVzrm/kOcY+5R80D7by0O+4r6W3c5156QiLlTmjr5XdUnxVWLG9Iu8n/1vfQy5a/rqnrT5ue5TsMiRGxWgaxGaaYNG0DR+VjgUOjQIyuQGJ3643I7Eb59pqBRLkGjVmanq7O4fCAREUdjl9/tWUaHhNBQN2ZSxq7eoE1ijQ35esvvU+kAuooCru79TYqAm860joKkrF/4Hor9RokSowLABwXvnci/kJDpoAgD67QrnmgBOBYd3XfffdNP/Tai3NoVyKnmjdzdZY1hx7E2gNhftD9gMex9nuIlM2fttPwSdKrHdrC2GdpMg8K//vr4RH75DwrLysmp506tF+uIwooCs2oQvMQAFdvXkYfffQ09kbzoAg+0Q/aw3iIzzjjjOlhXAXR8nlyusU8VyGRKb3cD9pB19xnWq7y3A0cODD1vdo388FUH3Oqjtg333zzJeCZbLLJEoyMqJDo5WS66aZLAAI+/M+UXg4UkfDZPeg6ARP9pI2NKFcuC+V8gPZzISDmyIsN4SsKCsti/O4LYAY+JK9ecMEFU93mZcopp0x/waljXCPfC0LTVc35Z+y+G6LPadBoJM8888y0z30BaMGhCHjiGgM+fS4n8KbNC3F9gSsXC/AoWEvewTHGGCMl7W4UVEMr6MXJvR9zYf4IwCX6GH6IIDH+jxdGcBzz7OWGNhVoxuonAFoeyIkmmihpKUN8zyXGdi7N7AQTTJDq8/0C2lUBj9JGEdfa98F1N3bX3Xhdv0hcDiR9twG5ucsyAkCi9CSrL/ejVDpKPl0PEgVmVPfJhxfaqIAPCZpDC1QNoDjn5APTdsEujUBKgupGybm7W+89N5+dtstTKFq2WueKi/8w7Y8E3vUgoupr+c5rd6XtcvLRXkmtI8ehSO9y2pmuji0gsV7gSkBiVwNXrht8Qm2O6mk2BfCIgO7uXIYZWYLwap0ROR0+gTSBkfvxndfvanc8c7ZckICsO/U2Kg/cfl5NU6jO8j65H5mw+Tm++eKtHV7fZs3N3ppDk8ikOdZYY9VMzzRV4cvnx5kWIgDCA4U2xf8eUEAj1uhtFDRhtQUarIgkBJHlVC/V4oHB3BN1edjQ4sUauADP/wooDE0ijQDzcwAXE2KYotUB1mynQagHibQ+gI2WxTkeeh7aYRYuz4sxmBf7Gs0DLU2YgdVNa+V/fogBgLRB9YJjgCBtU3W7hxnILPtJ0tjEfqAQ7Soe3h601b4BAvOjHqY8kBhz6kXAXDJFAhnzO7Kam0EyQKK1pWHSNwASmiv3TDktinHQDBP3EeAIMzBTaVVo9Whw9TsCoYCN6w741M09wAsb7bQXMsL8GSu1hIBG95/tEkpLU6R+AnZcU/UBN39p8WkS9dkLTgiYDW0bH9ypp546fe+M33m2uWbAkt8tbWZ5TWTb+AAbk5c/4jvAzOv8WDmFuZr5N4A9Vk9hNXAvePELqHMvxlrP+h1aW/eqY8qmX79Xk046abqn7XPPhza3ulRg1O1aqSv67boZl5c03x8AH/eWdgGq+qruBln6KSRGbjxljeUX6xYkTj7eOG3SlEhKDSSYF6s5CGmhnCOYA6xIpiyJcWj2mEXBVj2Nj4AHK4bU60sz9Yo2to/2j58cQHr/rXuTPyG/wkiR8+uPHm9znoTWkWw50saEJjFM7PUKrV8VemJsYO+rz55qs++gb3MoghlzWt53ytF71vIrlled6cj8utKSC6Vzpp54/OL2a09LEcyvPXNj0nxK5m383Z1LfY4+Pnr3RW3mgiZPHfwZY7uVbcb+Nj+hHI38JdU/+LxB6YWCBrGZehuV8Iut+oTGvEtoXj0nrq+gGe4DzUAiXzVQwEQF3Pzog0TmKPuZYmiggJEfU1qQgAsPGD+0wM+PtM9gicbCw9aPbr28iupzrDY8uPy414tuBl98/zygmHsC6sCpdWbBI80Cp3gAy5eO1sXDgWbDZ/ucx3RMEwQAwCVTdNRh/MCtCmEAwGoT66+/fjIRmhdmv47mJeYBXMQ8eJDrD3Mbs5+HHPDgS8gEzcTrgc8HDpgG2MU8xDyHmTIKeDM/TGwefvwG9S2Anh8mcOCHFn3T78UXXzzNO/MkWDGnYBM8aFsfzIe5Aw3MfI5zr4BaD/iRERL5vAF8wAbW9NV9Bw5dZ1Be1eaBHK4JoMq1pk2MdZmrAp7KoAGawBMQMlcR4MEkCjKXX375ZOa1iot6y6ZucERbxq0iIA8YOs49Gu27xr4//FH33nvvdDyYA/tgyn1ovOoyVtfWveSFwnWioXSfOZ+5lksHaCqb8X0PaOndx0BbnausskoCKwW0usdoIwGx74W5cP19L3zPfSeN0zwDZHMPJu13j3h54XcIhssryhBL9NH8m0fJvWlA1UUrWE21Y65Atd8m97XvuHuexlK7YNWLKS28681dQ98DcLOMAJAIQpjXaNaqSZQ7g0RRrx6oEjtvu+kaxfSTT5KSaFehTAEdARsBmKcdu3d6EAe0RbqYj995MAVJlEGLFsqKKD2pt5yUmvYsVlDxl6nVihzMsj5LQE0zCGIATaTOiQKEyz5vzKXmQPt89+aacdoEk9HGON8m7643NmCqLpG2zq3ui1QuluUr75Nsux7s1NO4As9YwSYieyWtDm1vd+dSwIf6JNq2Oop7QVT7NJNMWKy7ytI16CvDqpQ79pfHILjJ6i5xXHfr7QiOLzzj0DR/5g0ceoEBqeX8nRHgU72+vg+h3Ww2T2IZ0MowwvzF3FovRYp6yxpDGg7Hd5YGR32dreTRKJgF7IQWr7sl6nE+LU5nKWEc06itGEO9fTEP5W0eXtVtXU2Z4+HaKJG5PgDRjlLZdNa3enPaKHn6yKpJBFSgR70gTZ8DButBH4l1neN/Y2qUhJnPW3lfrErS2bZGUl5BJM6ttu+YzuqrrkRSHm95TLRtMSdlqZd4OtambjRX9aSjee5of3fmLPpR73+g62VIO7T74LXenGYZQXwS5cur5wPXmU8i852l0wBQdQWLeuX9n9xX/OTlO9qZAa3ra13j8ooc3SnN1AuQaBKtwhH7AWR32nU8OAQVcvpV160GPYJZqoE8fVH0lYmVS0BVQ9nMXAoqKddrqbuu5DRk5h9y3yXtVkMpB6s0U2+jMbs/Lc1Xz72gM9DsKST2RhLrkSmpdl+U/jIfI3ueRNHDfNAErrRSc8Q8S3NWjcod0WRkByVQSKtI806rXF47OssIBokepJY7u+D0Q1oSuPJdKhHUQYPa6BgpcRxDI/Zdn68RqbQSEnsCI8NrPeXhATz9HcL6O+TnZNpZsmQZrpDIv2uzdQek5c66qsXLkPi/Aqw7ipYuB49UA0Jy+e5BYi65ZEjMkiXLCAOJ/NKsdRvBC10pEQiRNWNvFh/+9P6Ue5G5WSLqMmgDcKux8NsUPd6dOc4lQ2IrtF0ZrDIkZkjMkiVL05BYXpassyISWnqQsoO/oIDu5AccGYtIYdG7Ai4A4YAlFkzmZ4ElonGtXMJ3M4NXhsTeBENBIVKr8P3hKC7KubegUYqf7kTljkhFRLqo6QyJWbJk+c5DYnd+QD784IPipRdeaFfeeuONHv0wjSzFj/Vnn35avPHaa8XHH32UfrjzvIy4xQPXg7e3ILG7PmwdHSPdjlQYktZKPyEVjGCB3vCNE/krebbo4lbX3V8CSOSOlHokQ2KWLFkyJOaSSy69Dom9CToSBIsgjLQt8pPJp9ad1DBd7b/UJnLZtSpYoz9GPsv/aHWQDIlZsmTJkJhLLrn0GiQOD7ixPFoZCiWflkeuKzkOG8FS+W+5zDzzzEnLNrKnyLGaivyHGRKzZMmSITGXXHLpMSRaacEaslYW8NlqEcstt1xafQGA8OPba6+90soJViHgO2i7FRmcZ6UEn61cYPk4foZWZ1AH7Z2l8SSpLSd6pvWyGoqVJayUoJ9Wl7BKSCwvV26Tz53tVlzQppUd9NXyWVYZUbeVFGjSLJ9XBihLnFlBJCDTqieW77Pai9VhrCBilYfoW3W8sVxhuZgrK3NYYs1KKJYZtJIF7ag5sLJLOTG15cWsHGHVFyvb2NZRPzqaWytFWC/YXFg5I44xH1a0AN4ZErNkyZIhMZdccukxJAIPS889+eSTCTYsQWVtY/9bQsyybwE7YM/SbfHZmscSD8eaqqOMMkptH2CztJkEtaCvrBG0hB3I4osYK3+ARMe++uqrqc1Yj7jcpm2ALDSOoAxolZevqwLdkCFD0vJ0ZUidaqqpEmTF+tQzzDBD+r88XsdH2/VWYwG/ltfzP1A1F5bVM9/aA6v2AeY111wz9d25lgA0Rp+jH7EedPTD53pzazuAPPvss9P/1pUFidFfywOC0AyJWbJkyZCYSy65tMTcvO+++yZtFdAor7lM+yUgIuAKlIw//vgp6MTn6aabrnjjjTfS/84Zc8wxa3Bn/VMat0amY9qz8nrJAYnVNq2nWm4z1hwGt8cee2wyJVsv9vnnn2+nRVSs9Wq92XLb008/fdKIBrDSNOp3tW0aT21bMaNarzqBteOGDh2a1oKOsQNLMOezdXNXXnnlBHY0jyAXNNvXqB8dzS2YFOTjeoloDmj19+ijj06BQBkSs2TJkiExl1xyaQkk0mxNO+20CcSARoDQ3nvvXWy55ZY1aLJ/1FFHTdHCVZD59NNP20AiUy3TbSNI5INY9klknmZu7qxNYEQLeeWVVyZoBXYglzbPsVWYA3igqgqJP//5z2sANvbYY6d+V9s2b9q2nmt1TWeQGFo8gDrffPPV9u28887JJK7OgQMHJg2f9ZLV15V+xNyC1Hpza960YVyDBg2qQSJzNvN9hsQsWbJkSMwll1xaFrgiunjbbbdNfn4BRMzBfAdp7YAIiAN3ATlABrRphwk4TKKKwBTroNYDRPu1J+VNfObbZ93caDN8+mgXy20az6STTpo0ij7TxE0zzTQJyhoFdjD/Gn/U4fjQ4H322WfFGGOMkfrQ0Xir5mZQyA/R/0899VQx55xz1iCO9jB8LWkUBZTIBVmdg0b9iLl99NFH281tzKn/wWJogJWYQ9eTj2aGxCxZsnznIDEnTc5lZCx9DYnnn39+MouWo4OBzYYbbpgCMQDUnnvumcyiAToCPPjRCaAQpDL66KMnky+4mnvuudP2CIApAxKAAWM77LBD8rsDmrPMMkvS5PFR7KhNxX4m2+gnUzXfw0bRzTR5N998czr39ttvLyaccMIEcUBUYIt+X3fddWmuqm1/8MEH7eq7//77k+ZVcIuo6cMOOywBX5jP+Uauv/76SdNpDjfddNNi8cUXr5nKaSYBcqN+dDS33AGApzl0Lk2kPrm+/DONwbbxxhuvX+RNzJCYJUuWDIm55DKCQyKtGPCqlwYHuEWASbXYzpTalbyG9QJAGhX1/uIXv6ib/oYJudzH+Nyo2C+SmoawUbv1xtuKcUQxR43msKM5iLktF0nBgXO5D7vvvnsC4BgzOM2axPriPFD+n//8JwUrZcmSJUNiLrlkSOwAEo855ph0bG/mTOyNHIxdhRW+k4I+Wll/f8mTKE2PSOy8LF/X5PXXX09BRH/729+KXXfdNT9Vs2TJkNj9Yo3ozz8eWvzxN89liBmJS3+5zs0AYbUEIHr4ffPNN0nrRKNEk8bn7bWhd6UHdbmIut1xxx2Tr1t1X6PSGRh0tZ6u1teTurvbbqvr6+3SyvnojbH2R0gEiMz1AJsva5YsWTIkdrmssNgCxaRjj1WMPcooqRx98E4ZpkbC0t+uc0/gMEoAoofwX/7yl/QQ5O/GZClC9tXH70zQWC7SuDz99NPttueSS5SewGJ/gkTfAxHkItZFi4811ljJ15P/rP5UhTn63//+d/rf3/i/ntjneOVf//pXu33VbY3acVy1Hdsc01HbHdWfJUuGxBaXN164tZh8vHESPBx10I4ZqkbS0p+uc3fh0AO2XMqASIvoYRzJsqWP4cf2ymN3JGjMJZfuls7AcUSARH6cu+22WwoyEhgkTZMgJYFAZcjS78cee6w44IADUhonEf+i9VdbbbWUQF2/A+7ee++9YvDgwcUaa6yRApIEJwlUiv1ewARDCQoTmGUuQ8yj6H0BUnJtanOVVVapBWY5X8DVSiutlPKOinKvisAw/rbqlyNTGqgsWTIkDoey3qpLZ0islC8+fbL45c8fLf78xQsjTZ/7y3XuLiB6yAYYluGQBjFW9/AQ8nCWg08QxEtDbk8PkVxy6W7xsqGUobEroNjfzM3GIp8kkVtTCqKy+C7ZbxUiaYesliMvpyToo402Wio33XRTOlb0uOUTHaeIRPdXOiQil+dSSy1VrLvuumnZRfskXecG4nsK7CaaaKK0XQJ2x2qHpnOyySZL8CpVlMh/x0w88cRpHkMs6bjEEkuklY1mnHHGdIzUSa5NliwZEnu5bL7+ytncXCnrrLxUmpOLzjx0pOlzf7nOXYHERlrDgMOI0o3oVg9EWkSmZqlcXnj41mRyyyWX7hQ+reBECWAsaxdHJEgEduecc076H7wZW9X0S6u4zTbbJOiSDN33S59pEmNbmHkFwQQk0k5aQlFqJGLNbhH66rRko2MmmGCCWmS1/g8YMCBtl+/Sd9o8WafbNhpG22hAQaNtfIdDrLNuPKHRtJ85XZ+yZMmQmCExQ+J3ABI7Ckwpaw0jiMHD20Pcw4b5CyB6yHgwPfPAjSmAJZdcOiqgLgottOJeKgNjGRQ70ib2N0i0hCM/XG3T6jWqQ9Qz6DrttNNq2+S4tM265GXoDEj0fz0xR0zFAFH+ytBegjtmbOfeeOONaZv5oD20jak5tJtW57FNPtOqmGdma1pJfpbGmCVLhsQMiRkSv0OQWAXEgEMPXg+hAEMPcdpDD3aAyMwsubI0KU/ee33SbOSSS3cKf9aAx4DFRqDYnyGR2RikgTVAxaw7ySST1PXjoxUEZaeffnptmzRRtvFlDDE3AYn+D6GNtGwjTeGss86a/Bv5QoYmMSBRXWUgNCaJ122TcD3AMczJl156aU2L+eKLLyZgZY6WMJ5JmyaRD2WWLBkSG5R//OGV4ppLjk2+ZvPPNkOxyLw/KH684arFi0OvbRoS//mn14rB5w0q1lxh8WKhOWcuNl5r+eL1Z29qeO7vfvVMcfzhuxYbrbl8seAcM6e+HHvoLml7+bjHH7gsHbf/blsU2266RvHgHefX9l16zhGp7X123qzYZpPVi3tvOaddO5+893Cx27YbFEv8cK5ikblnLbbcYJXiyAO2T8e3O/bdh1J9qy27aPGj+WYvthu4VnH3TWd1aS7OO/WgdO7cM02X5gR4+ayY62bGXk5Bc/ZJBxRrrrh48cPZZyqW/9ECxQG7b1GrX7n56lO6PZau9rkn17kr/fj47QeLE47YrThwjy2LHbZYuzj5qD3S9tuvO73YdJ0Vi603Xj1dx65AYhUQy3Dowe0B7oEccMj0xQwFEJmghtxxVQLGXHLprNCKcVFwD9FEl2GxCoojCiSCPD58AFCwh2CQ4447rm7kcEBiWZMYkChIpTNIpM0TOc0/0fxoY6655kqr7PhOBiSutdZa6dzwczQfiy22WNomeKUKiZdddlnaZl1vWkOmaddAXfPPP38xzjjjpJygWbJkSKxT/vLlC8WqyyxSfH+ySYo3nru5+OvXLxX333ZeMdm4YxcTjTF68cpT13cbEvfbdWCx+nI/KtYasESx6zbrF1NNNF7aPslYYxafvfdIu/OeGXJVMdt0UxXzzjJ9cd+t5xZffPJEArwffH/qYpZppyieeGhw7dhnH7uq2Gqj1WppWM45+cDavluuObXYe6dNavvOOH7fNu18+LMHiiknHC8BsCjdl5+8LgHjOMOOHbDEgm2OHfrg4GK6702c2vrwp/enfu+x/UapXvDS2VwAz51+vG4xwxSTpnOWXnie9Fk588T9mhq78s1XLxaLLzBnMfGYYyRA/r8/vprgabxvx7ztZmsWO265ThstYFfH0tU+N3udu9qPX38wpDhp0B7p/rMPgB66zzYJLGeaevK07bB9t+1yguxIbePB4wGcSy7DuwQo0lrTwpW1if3d3CxARB9o5N5+++2Gx+2yyy4Jyo4//vjaNssv2ibgJCR8ARUwHQL6IlCFVv/5559PwTBVTWL4OVpysWputkRj1dx8wQUXpG3W7aYJpaU0v6B0qqmmyprELBkSO4IZGiIP3e+NM1ab7SJXbae16S4kTjvphMULj1/TRlMGOu075pCd20XSOl77P3/znjb73nrp9gQ/wMJx5X3zzPz9VB+NWrUfIMq+04/bp8327TdfO22v1kWbtdj8c9Q+SxStvzRd//7LG7Xt//rz68UcM0yT6gCrXZkT8FmF2Z6MnRau3nUBdPVMxM2MpaM+N3udm+kH7ajt5uGSsw9P21ZeauFuQWJoET1saQ86WkGlnGg5Agy++uK3fZZ8OZeRo7jnaMyASWgTRxRI1NYyyyyT4IwGsZ4w49KgLr300jX/Q/DnHIEktk0xxRQpEEX/+QgGJApU8b0k/B5jO5ijubQWt/yMzMjO5ZsoR2NENwNuWkDrmtu2ySabJMAUkCZqObSY5pKpmaYy6heEM/PMM9fW/zbWLFkyJFbKY/dfWkww2mjFcovO32b7rdeelh7GHurdhURan+o+ZkL7aJHK20OTxOxbr07aI/v33GHjNtuZWBuBDM1TPU1igNSrT9/QTsO44RrL1T7vu8tm6Tjm62rdO2+1Xtq3y9br9xgSmxn7Kkv/F5Jo2srHgibbafXK25sZS1chsTvXuZl+nHnCvmm7eYhtv3r/0eLGK09KGtXOILG6iooHRYbEXPoCEpmeaRP5vlZNzv0ZErVLo0eqqW9C1Hn//fcnU6+1sOVJfPTRRxM8vvrqqwnwlCFDhqQx33LLLelY2xzrmKiHtk+ks6CUqDfqNHdxrmIbQLzrrrtqbSvWljZHzrXPtrfeeivVJxiGdvPaa69Nc+lz1F9OlZMlS4bEik9c+TPtDgjxgJ59+qlbErhy3GG7pH3rrrJ0m+1hPrz8/EF164x+8JXsKSQyiYYG7NRj9krAUa/Nmaf5b5+Yr/nHlQt/R/vAWk8hsZmx89GzDViVj+WjafsGqy/b47F0FRK7c52b6UdAYhV8Owpcqa6kEqZmD2VanAyJufQFJNKs0SaGyTkCWOr5JfbHZfmyZMnyHYbEKDRsh+y9VYKSMNkKYmgFJArMsE9QRmz7w+fP1vwH+UHWq/Oqi45J+8cfddQUsNETSBTsMONUk9Xa5Iu49kpLFo/cc1HdPs067ZRp/PWKoI6eQGKzY3/4rgvTNn6M5WMFjdh+9cXH9ngsPYHEzq5zd/rRU0j0YI1VVCL/Yfch8YsMOiNZGd5rOLvnBLPQJjKFelkJv8QMiVmyZOn3kHjTVScXC/xgxhQowRwomOXOG85MD+j5Zp2+1yCRFing4aE7L6hb5/WXn1g7prwCSDOQmPwAP3kimT4jyCLKwXtuVQuaiG1PPnx5j9O0NAKunoydKwD/PkE6Tz1yRep7vYCaZsfSakhsth/NQmI5aCX8ET2UaXG6C4lff5khcWQAws5Kb0Minz2QGH6JHQWvZEjMkiVLv4HE8087uKYx9DCv+iRKsdJbkCiAQdCG7ddeelx9UDhxv7qas2YhMcrffvdySr0isjsARhCGPk069n/7xPettyCxJ2MXyELrJkpbJLN0MfWi0JsdS6shsdl+tBISY6m9nkBiV4GjlWVkh7PeGGt32jzvvPNSoIUUSL0JidLjZEjMkiXLCAeJke7EA7m83cPcdrkEewsSFQEzZU1etQhmsH/geiu12R5RrpFDrzNIpLmTg7BeG5FSJyKDl110vlo6mUZj/f2vn+kWcNUD1mbGLi+haOB6QSP1SjNj6ajPzV7nZvrRl5AY5euvvhwuMCj32zPPPNMrENXbkNps3SCpVePt6vzyT410SP7qg2hX90ZvQXmGxCxZsoyQkCiJdmjRzj2lrdaIFsn2ReeZrduQKH1OI3ioBjQ8cPt5NW2ZgJnyPjkbmYX5Dr754q1t9kmkXY18jbyPc804bdp3ytF7tjN5VpNMKxefdVgb30AaRp/l6Xvn9bvaHc8ULxl3tb/1Cp/HyClY3dfM2N957a50jryKNJCSi7/0xHXF26/eWXz+4WPt2mhmLB31udnr3Ew/AhIlDW8FJHrwdgaJ7TSKLYTEAJR6RY442qzytmYAri+0nc3MA2gTydrbY603v+W2Rb5LhwLayks1thoSJdvOkJglS5YRTpNIU+hBLPCByVKCY7kHV1hsgVpiZGDSGQxJ6izXYCQ/9rm8X16/MGv/6bfPt9kXEbtVn7rQpA06cPuG/nrS91x54dHFH3/zXEpMDXAAlH1LLTRP8kF0/FefPZW2Aa9H776ojWaORs/4AWZst3LI2N/mKbzhihNTJLS5sbqIMdBMdgWcaePUM/XE4yftrNVIyoEy3R27/tKslf0py4VfaRWEuzuWjvrck+vc3X7EHAh2+fqXT/cRJH7VKeC1ooCVrhzXaljrjba6MlYrXTz11FO9NtZG81tt22d5+ABbud0MiVmyZMmQOKwAwwBCZfLxxilOO3bv5EcmnUpsr6ZWKRcrhUQ6lyhWcAFtlvaLZd6iALW7bjyrjc/ahWccmoIxFp5rlgQHNJhggm9kXS3SMFgqr7yigD1Au/5qyxQTjj5aMqXzqbS6isAPWizaL6uuiN6W02+aSSZMWq8qoOjTiUfunvaX21hywbnTyjRd1a5aWaQcUa1fNHE9GTuzLE2qa2V8NKczTPm9BMwRtU3D2OxYGvW5Fde5K/34+J0HU8BU+RjXjh9qb0GiPGmWFZOjzdqwluWz/ZabbyqWW265tGrDPPPMU5xyyikJJOR4O+GEE5JWauONNy6OPfbY4rHHHkvnOHaLLbYoFlxwwZTXzfFnnXVWscACCxQ33HBDseyyy6Y1Y6+55pq0b/DgwelYOd2YPQ888MBUx1ZbbVU899xz6ZgLL7ywOPLII4utt966OPHEE9v1/6ijjkp1WBXD54svvjj1+4UXXkjnG5/ExjE+Oe9sP+OMM4of/vCHNVP3fvvtl5YtAzH6Xh17uc0Y0/XXX99uTIrcdfXaBGhWuthhhx2Kc845J4GapMrl8TnO9TIXki+bC+v6ltu33ZhPPvnkdI2tmnHqqaemcx9++OG0ysfVV1/dZn7LbZ977rmpbStuyJe35JJLptU4XNtWgmIzkOg+yJCYJUuWPofEKO//5L7iJy/f0c7saa3dd9+4p80qGb1VaKUAHRiR4LpLEDbsOECkj+V6GgWrxH4mXEveNcqVWG1jyH2XtFsVpatF4mcQ9NNX7kj/Nzt2x4BD0CbPo9Qy5f1AWDALqBLQ0pOxdKXPPSk9ndNWQqLku0Ap4AYMbbnllv8Fhd99nQIb1ltvveKhhx5KiXc98K0pCzDU/b3vfS8tESbFjoe/1Rvsc7yVIPyvgBOw538wZTWJ2DfffPMVd999d3HmmWcWZ599dtomATBIBGtrrrlm2qZPk0wySepzWfMl754lzKxa4TPoA7H2O3ahhRaqtRXjC02a/r/88svpsyhcPnpxbHnsoK+qoTMmEOn/8phiTuu1af5mmWWWlFyZCbg8PvtjfAAWiNpm3d2qz6btc8wxRwI8/x988MEJWqNNoF6dX76B2gb02rbP2r2SK/v/kksuSZrGDIlZsmTJkJjLCFUimGiZReZteIyUOI6hJR3Z56NVkEiDtfPOO9eAC5BMOOGEKekxSARJl112WQ2MQAnoCAABKta0jf1gkXaNhmv88cevHWct2dCmSa487rjj1sBoscUWSytEgBVLmNHoWbXCvu222y5pxcAj7Zf2aAarwOac/fffP/1/xBFHpPH6vzy+AC7jMyexfJmVK0J7x/wa/VpnnXXajL1ajInW1f9yAcaYtL/TTjvVjgO85iLaNAb9aDQ+QAo6Yy4eeeSRumZk4z3kkEMSdB1zzDFpmTVr8tKg0iLGcdb2Nb/annPOOWtt+6zP4a+on9r0f19ConRNjsmQmCVLlgyJuXSpXHD6IQkAt9mk8Xra1w0+oW4gUobExpC4zz77pHVg4zM4tJ4rbQ5ItMZrGco8vGnY9t577+Loo4+uadIUS4wBEqCizUknnbQGiTPOOGPx3nvv1WCsCon33Xdf+iyoYpdddklaOmbkzTffPPURfOpbI2DTNmjTLvN3GR632Wab2mf7xxhjjAQi2mMmDki0Kgjza/SLmThM5vX8/GgOy2OilbM95rTc5mijjVZrkyY2gHngwIENx3fPPfekuZhyyikT7Fb7wKy86KKLFldccUUCPMfsu+++yewcwSjV+S23HZpES+b5/O677xaTTTZZn0NiaKV9LkNiJIvPkJglS5YMibm08xWcYoJxk7lZAvSyC4CgG6ux8CVcfbkfpcj1DIldg0Qaq/DD85lpdfnll/+vyXHYg5w2zVqyZTg5/vjji8cffzwdUw46YeKlQbONDx1TbkAijV3ACc3VWGONVdu3yCKLJHOoKNzYBmoOOOCAZIIGnuXgikZl6aWXTv52r7/+em0b7STtHJO0zzG+2E/7RmupTVpSMBd9YAbmR9kIEo0pNInlMZlTZt1o88EHH0x+i3Gu+abNc6zxAb3q+LQbcwsWQ0taLiAL1Jknn82vPoXvaPQz5tf/s88+extNoj5//PHHtfOBfV9DomNi7iwtaYnJDIlZsmTJkJhLh+W1Z25MUcICOQChnIbMzxOPOUaK0LZijvQ534W5aBUkelBvuummSWPHn5Amim+efQ/ef38KemASffHFF2tgAcb43DGTKocffng6HhjONttsxbbbbpuAb6KJJkpmTkETYIYJ2sP/nXfeSZpEIATaBExol18dsyvzqmPBBZjgXyeIxH5t0XLWAzcBK7R/5W3G73yaPeOjWWQaLmsaQZsxCiDRL5AH7JjVaSGff/75dm3xzwRUJ510Um1MtHJM7do0p7SE6qJ1LbepPwJF9CfGByIPOuigND4ax0GDBiWfRNpCwSw0lvWCjjbaaKPUl6h7wIAByecwPpfnF6hpy/XTT+0zvQNV9wHfzPHGGy9pjvsSEt2v9rnXvvnmmwSJrTA1Z0jMkiVLO0js6Y9KLv2vAKDPPv20eOO114qPP/ooQVGel56lwKFN8iAv+77Jk1iFI/5ugMODn3mWJg2EiK4N7VZogZop6uSzWN3OBGl7R6lfRO8C0nqpYIxNqdemsYOXZlLQdDQW9YaWrlrCZzKK9mPcUbf+gsuO2ndegJZzOzLJN2q7N1e6aQYS3T/hjwgSW+WPmCExS5YsGRJzyZDYgzyJ5Yc2SPxf+SqVww87LPkhMkX/blj5/bAHPfPtbz7/9bDPXzUuX3Xhc7vyZZfL74fVccopJ3frnBGhfN1J6XpdHc9xrc4vv6iVr5Qvftuj4p4bcsdVxZP3Xl88+8CNxQsP31q8NOT24pXH7iheffzO4rWhd6VjyiVWhGFqbmXQSobELFmyZEjMJUNii5Jp19vH7Cw/InMs3z+mUP/3xVrNsca0/Ih89uT46+11maPN4bkWdLTZURmebXWnJPAbdp/QODOZc2WgXeXD6Z5kWqdddI/SIAYghhaxbGrOkJglS5YMibnk0seQWAW26j4+gfze+Op99e2qLL219m9XIIYJXER1fwCm/gRqfQmHZUgEiEzOzOng0P0T0dxlONSPKiCWtYgZErNkyZIhMZdc+gEktnJ95OGlcetv/cnlvz6JUusEINIcBhjySyz7U7pfmZgbAWKGxCxZsmRIzCWXPobEnq4l3AxM/OQnP6lF1fbUbA0+aBerdQmYqK5cMrJDWneuF3CjHW6lNtY9J/gGIEb+Q/XHfSaCOcBQcd+WAbGVWsQMiVmyZMmQmEuGxCYgMdZEtiawCONqPr5mo5W7AingQcLnarvNtieNjOX1yttpsHbbbbdi2mmn7TEENxPp3Bvz1sq+uE9i3loxF+VoZT6IsdRe2ecw4DDAMOCwngYxQ2KWLFkyJOaSSx9BotVTPLwt71ZOkC1IRWLrVgJQtVhazrrOraoPbI466qi1pNhR5AG0Kkur4Kw356SZfvW0DWlqzFuroDkg0fXwIhD+q+FzWE9rWNUethIQMyRmyZKlHSTmJNS5jGxJs1sNiZI9S4JtuT1/d9xxx5opcP7550/5B6vA1VHpLpxY9eT9999vuL87bSu0hrG8XrmIstVWV/rbX+CwM3Ds7jkdXS/aPvPWakhkahbBHKvKRGqb6koq9UqrX6SyZMmSJUNiLhkSuwGJNGzWCH766afTXzAFHsChNZQtdXfuueemBzyNn1U7FlpooeRDGKAh/Yxl+WgeN95447R+sgho4HHggQem3IpbbbVV8dxzz7WBFkEN5XWc9cex1TasxLLAAgukVVqsTmLNZUvuRfuiZ4844oi0QorVWdRp/GUY4vco8fdll11WzD333MU888yTViSxzzrRVpexTz8uueSSVA/fxvJcmcd649HPvfbaqzj00EPTqi+WuFPvGWeckeq1Gk15hRdaNedow5zqi+X0nCNSW13rrbdegnZ+fFaDsTbz1ltvnVwD6gFjed5izWmrtlTnzSowMSfS0jAzl+et1ZBobWiRzNVVVBqZlXsDDjMkZsmSJUNiLhkSm4BE5sBzzjknwcFxxx1XAwjaPWsQgz0PemBjKTf1Wi7OvgA00GW7+qzZfNVVVyUwAEkAz3FvvfVWDZaiDBkypJh33nlrbVbbmGmmmdJ2nwEroPI/0JlhhhnSPn2zvjNtlc9PPvlkWiKvColSsdCU3XnnnWmfvvFR9D8t1+STT57O1S8BLtaorsJYvfG88soraZnCaAfsWQYw+m0+gLjPgjj4/dmu0N6CQbBqeT3QZsk+1y3qAnzWkfbZ9kkmmSS1We4XkDRvjlFXzJvS1Xl74okn0ry1GhLde+7BWEWl1QmyMyRmyZJlhIfEf/zh1eLrXz5T/PmLF7q1L5cMib0JifaBE1AHkE477bQaNChzzjln8eabb9Y+20crBV6s+6sNybRpqwJ85pprruLtt99Ox4OSKaecMmnQrMlcNXk+/vjjSfNV3qYNawtbv3n88cevwR5/wqhXSpXQFtKy0bDF+bSX9TSJIBHYxnaardFGGy0FVvhsuUH91EfaterydYrxTDHFFG3GQ8O300471doBj/oN3HyebrrpijfeeKPWtzHHHLPWh3XWWSdpL+NcEEqbW+63daWtkQ1OaXTnmGOOpIWst3Rho3kLzWZ53oBjed6Mtzc0iRkSs2TJ0m8h8a9fv1Tccs2pxQarL1u89syNw/0hv8XmGxUrrrBCsfTSS6dy4TnHdGlfLiNPcd+5/9yH7sf+BIlDhw5N0GFpPaBHi0VzGOAA+AIwrM+8+OKLJ3OoOsGSNmj/Vl999QRZAmDARxly7r333gQ+NFrMuuV96rE9Pr/66qtJuxVtTDrppLV9YIfWMmCLVlD7zNxrrLFG7TgBGI00iczN8RnETTTRRDWtnfHRLNoegTz1ivHsvPPOafyDBg0q9tlnn2LLLbdsU68AENBWhUT+eWVIZJoum+1PPfXUYv3112/T74EDB6Y21GdO6vlR0iwuuuiiaUUcGlzaxu7OG1jOmsQsWbJ8pyBxxqkmKxadZ7bihitOLJ4del1x7FH71S0vPnVTm4fzTdeeVfe4p4Zc221IeOW5W4sBA1ZMIHh+BQQ72pfLSKIN/NNr6f5zH7of333jnn5lbmZi9pf/GhNkGVBmn332miaRL9yuu+6a6pVPb+qpp67BzkknnZSAM9KbxPk33XRTzewKriyfVw2cEByjf/5n4qWVczxTLkgMDeU000xT0yTq5xhjjJG233///Ql8mHJ9vvLKK9uAWDlwBTDF9ttuu63YY4892hwDULfddtsEjPUAkRa1DIs0ildffXUy7zJZq4Nm1fc56gSJtI7afeCBB9qYm8G1OuNYPprM3pavK2sXF1544Vr99frlGgo4sp+pHCSW5y1Av968RVsxbxkSs2TJ8p2BxCUXnLv4++9fSQ/c33zyZHHLdWcXq6+2Sk17t/ce2xdPPHJ18cWnT7V5OH/wsweLe2+/qNh2683ScausvFJxw9VnFL/+eGhToHDQ/rs0BMGO9uUy8hT34RI/nKuYZdopig9/9kC/gURaM3+lv6lGwQqEcG8yYwrSoHUUyMJPjgYQEGmHJnKRRRZJPnaKIJIICGEmBUnMoKHRCtjxFziqLwBHYIdAihtvvLGYYIIJUgoegTHAh/YLLIGp0UcfPfVL+yK07We+FdBi38UXX9wGAAXm8J00HiCoP8ZdPkaeSKbdRtHOzNCgjb+kvvAhNMcbbrhhCtgBjHvuuWcy60adglD4AQp0oWXVN+Z9c6c/ttMAxvGAz3wa02GHHZY0k5tuumnS4porKYNoBMv9M7YZZ5wx+UKCTmbjmDduAdV5C7/PRvP2XYdE/TTvinGQf//732mu4//YbxstrPlrVgTymKN//etfff7Q/M9//pO08dw+mj3ftRag1Gpxz7j3ad97Iu473wfaedkQWEPU3ar5c194yXUflcU96Drb728UffGdCInk/3Gc/vnedDSezvrvnlWH/lXntJX3nXu53PcYXyvaUIe6zEe1uOeagsT3f3JfuwfvT1+9qwaJl15wfIcPaRpGxz3z+HU9AoSjj9ynoUm5o325jFzF/Tj5eOMU8882Q/GvP7/eLyCxUYqXso9f/M+PLzRaUZiGDzjggBToQlNFawUmI0paYAxoamS+ZR5lUo1667XRlRJLvTXaH2bleADW08oJ3qBh7CgVjvNpLavnAgX76rVtX9nXs7MUQtqh4av6HHY0j/Hj2Z20QY6NH9lWJhYf0SHR9VpqqaWSJl2EO3nnnXeKJZZYovZQ9iLEzcB1WmGFFZLGuKtibrxshHj58JLlAdvXog98kfmrNiOurxcavwmtFvcQawYNeLPi90awmBcjPsZXXHFFcrs488wzWwaJl19+efJ35l5SnRsvhywkfvNYWrxEzzfffGlBAe42hGuMzAbcfbx8yDzAd9t3qSqsOsbCTYU1CAyWxXdNm140vUQGrPk94oPuWrmHWyXgkIWGEsGceuHnxuOFvjv34M0335wyUpTFb+Bmm22WXvC1Ef7hrFwsKU1BYqOH7647bZXAbMP11y7+/Zc3Gj6krx58arH9tpv3GA4yJOYSZacfr1uMPcooxQO3n9cvIbFePsCOQIO2UMqY+KzdAQMG1LQsXSlM2n5E+jr3IG1qX6600tOk2n290svIZG7efvvtk+nfS5IHv4cwVwEadXLwwQcnDS6hmfZQ76oAA+4aIR7U/Fb7i9CQ1wOSrghrgbEBzarWqhUCwPgSNyPucSmpVllllTaaNy+3d911V8v6CPa4bqi3nnD54KJThh/WBi8KAXHAkZsJ4Sfu3rvnnnvaaQfBozmXQQF8qqt6r7EkAM6VVlopneNldoMNNki/3eqtntNTAZ/jjTdegl3fH+PdfPPNu3w+ywqrhsDGslAgmAvy6KOPpr47llTnpseQyJQc2sSXn7m54UMaIN57x8UZEvtB+d3nzxWHHrR7sf02Axse89evXy4uu/CEYo/dti3WWXv1dOwpJx5cfPTOwx3W3d3zzjvzqOLMUw7rUqmee/t1pydIXH+1Zfo1JHYEHmVIFDThB8eXFuwJvmCO7auVQ5opUgDxhWTi7i/L8w3PfrQaDkcGSOR64EHFRO8h7KHNdE8zAn5EnQcEuXdoz0Wq+y2X2qkMTV6aaHLiYSxKXc5KJklZBWiVQsAi31huF9wCqhoWvqTqox3Sp0svvbSN6ZBLwoorrphcPMLdgYsIkGUC9iLExEprbjuNaFlomGjXBGUZn2h92hoPaKmYuKCECb6enH766Umz4wGuDyG01TR3m2yySQI9gVZlEz1NLTcL7he04iG051xYaGtpeLlTgCFwYJ7OO++8NmZX/TZ+LixVSOV+QcNn7qrav4AzLi9yioI215O4f80J7a971zWgKQ0TsOtCs2VMricN2FhjjZUsDlxRqnMmQAxIldt3PwGrgFeASLtI5F+VS7VqcgbztGlRhzbNTxUkzQstODj22bH+ugdcJ9e2lUKjaSx8yH3/QaLrEn12fcyJefW9pA2llQevERwZri++P+V5imvqO6bvjo19YNg9bS591/iNh8aeGxAtNO2udh3jO9gQEv/y5YvFgBX/G1l83KB96x7z4dsPFautunLxt9+9XHc//0Rgsefu2xXbbL1pCmx58tFrWg6JXWnnF+89WlxxyUnF2acfWRx39P7FdVeclrY//dh1xYH771L8eIuNi1OOP7h448Xba+eAY9Bl3957bt/QpP5/f3ytuP/OS4oD9t25GLjpBsXWP960GHT4XsVPXrmrzXG//PDx1IdzzxhUHH/M/sXVg0+p9YHf5ZZbbFTsu9cODeeoXnnrlTuLC84+OsHbyt8G+GzXABLfffPeYtON1yvWWmu14rknbkjXzfmbb7ZhOvfR+y9v2XkRbNRZ2WjDddqd+4fPny0mGPZDNc6wG/xX7z/a7yGxK+DhC+kHxxc2VtYYHhDSqkIj5IHd3/s5opURGRKZmT2EAg68DHnQMkHrP9/QENH7E088cXqogRkgAsSMmcmND50HJZAwB4BNaih107QEGIANGkkuG6DpoIMOagdwHqb6xb+Vic3/NDZEdgLgBWL4mtLme1A6Rp2Ai6kWoGjTeKomPQ9xgMSsB5xAqPPBJTOf/6WdamQONn5jlEkg5ooAJr+JtLOCpGQIUJeANyZgfWJ+NU8xt17aNtpoowQEQNGcOIaWzryaR5kEYvwg1rx4YZUGiqtLFV6cG9rgqvgN489rv//NFbD1u8adQJ/NaWSDcC+DejAHSgXemW/90S/Xj893XK8QbZTdDQjAcU74MapTm7vvvnuaM/Nf9eujVROYFsLES3NYFfc+94nVVlutDTgDYn2zClIrRR/MvxctMMjMHb6Vxm2uXGcZMbRt7PrhetJ2+l74Dpk/bkv1JLSrAYnEd86qWto0Zos7eJHycuR+0S9zqA3z6n7tME8iOHTTeuCDxnraorNPO6JhxPKaa6xaHHX43sVnHzxWfP6LJ4rTTjw41QeSWgWJXW3n84+fKC45n8P7cmkfoLN/p+23LE476ZBinXXWSNvd3HwyLzr32ARbp518WAKZgBrtVTVsAG3NNVcbBlP3FX/9/SsJJsGTun72+v8idQX/XHXZKWl7CgoaBp5nnXp40sbqQ7md54Ze3yVIfH0Y1AJkxVicu/OOP66rCdx4w3XT/tdfuK3Nvl99NDS9ECy77DLFx+8+0pLz3DPrr7dWMfiiE4s7bj6/uOvWC4q7b7uwVkTHq/O+Blro2aefOmkTH7v/0hEGEvvadJlLhsThCYn6CSgEJNHGxcPPg+nuu+9O2sAQ8EDzR0CMY2ggPZA9GGlUJFxnsiZgEkBVxQOTthIg0MgBq6o2jNZb/QQE0R6BKP0FGR7A4fdGq+WhKKE7CAMstJCAVt0eoFXwoGGitQKjRN+1F4EB4JapvZ7QfHrwA2pgQBsU5kBiW4zbfaFeIBHBHkBWcn2mSfcHkAhfQRpND3vgqP8xX2CCxhJgGz9NmoTyxl81QYLTeprEEPlfARxo1R/t0EBph7nW/+GKQNOnTZpbYKK/znG9QWKYm2Mc8qmWIbHsA2n87jGQ5zsRkEirRqx+pd9lrSkBpMYZQptd1ix3FRLrBRkJmgPrnRVazqofpO9JaBKrGlvz4zrLauG7Feb5yPoQn81ZI5hvBInqB4Zeligr+Jqqx4uQNGJ+d2jX3Seh7e8QEmnSAlqqJmXaM5ol2sTqeRJfgyRavbI/o0CEjb4FjjdfuqPHkNhMO8DQ9uWWWzaZ1MuRtXHOisMg7ubrzv5fMu8/vVaL4j7koN3a1EeDGCBd3i7gx/ajjti73XhqfVh22TaQpJ0dtvtvtCyNYnfNzeefdVQ6d7ddtm637+Lzjkv7zFW9c0G2/YcfskdLzjMfb718Z8O+gmVa13/+qX5wyuILzJkg8brLjh8hfBI7Kn64vOXXSz7dXVj0o+IHPwNWhsT+kAKH2TE0b+HT5gGv0ICF0Oh5QBNR5R5CggEEc9EMgkoPL9o5YgnFepAY/li0Z9pwTERUhzg3IBGEOI7vFlOd7TSJNIYAMgJhtAtiwR3Nlwe44I16EdketEAtIJG5rwyJougBRD2hneFqQpMXGkgQEcJUH+MGC/aDWtoi9YI3JlGmQOOunk/0mZa0bLoFwwGdNHbm3nxUzbPMmo5hdqwnAojMJ8uIexWAgYt6kMh/0H1Mi8xsWb5O3G7KPonqoWVsZG5WDygEcQFcTNcBiebKy0O13+4VLwkhUnGVXR3KkAicqpBo3hppEgF2V0v1RYbLkXsMDJbF7zug9h2R/stLQ7wA6Ed8R/lXdgaJYW4uv4TE/QHuZW4AmzS+YNFyqvFi5TwvEp1CIvDaYL2164LHYw9emYJb6p1HO+acO28+v92+E487MO07edjfnkJiM+1cf9UZafseu27T7pwzTzsi7ZPEu7qPmdg+pucqSAPOnXbYst38NIKrjvpw7RWnNTTDdhUS69UbWsZjGrgODHngitoLwTdfvdTj8zbdeP2G/fzD588Vq668Ujq30TFrLL9YgsRTj9mr30Y3d1b4scRfXzqq/lZoGvl3ebhmyMqQ2NeQyMRHGwa6Qvg8ud+NKUQkMBMtAYT2u4etZkQDRBMEKvjjEb5uk002WXqIlSOafS/CF5DGkMm2mkaFyVT9NIAeeCAWmBkf/zQJ2mm0QFJopQYPHpzOETFq/j04aRfLaVfKaUakZopAA1ox59KuEUEptGdVATIezGX/QHOiT+HzBhLBYOQMFUTChB7RwOaJxjX8PvkcWiUJdAEZGi/wCUDKQSCA3fjlQTXP7jlm/Or4jA3IAiuaYPOkHWNjyqalBHe0UwAPmNGOqke/WMlo3wCcgBHXjiYU9EW+UxoskOO+iehm+91L5T5LdQUIASkTrDrdMyG0vMZv3O4FY2YCr6avoX3kKmP+jV8fuDcw3fo/jqP5lN6rrPWLezWubavk2GOPTbAN/soiODGus/ljFibmWz8C6uWpdRy3Bs+VehJ9B7pVlwfzvcwyy6TrLd2YlzbXKe4BoEr7by46XZYvNGIKc25sZyp94O76psD11l3zv87JwyCAH165CFSoBzLNQGIz7QSg1dPUgU37+BRW9z3+0FVpnzbbQc9vn2/zmSaTpqwR7HXUB2Zm+/h6thISw0ewnqlfoXGN6/z+Tx/o8XmNNIQKH0pz3FHU/JYbrJIgcZ+dN+s3kNgVsItgFVoRb4MRzexL6EeqXoqV7gKjBwLNZIasDIl9DYl8VWm1ykJLFhoeImUSzRstjoeztcGBlMAGEGc7s5oHIm2j880BEANr5aAB8xQ+VWAnUqKExDrh/NBABggBYuAT7NCigE+aNkAQAlrAmu8oATRh6qsKc7k+0Dzyx6Pt0R6tKvACeczRYCnEOEEOE2JoaFgEaFFp2WiNwA748/DXR8FuITRO0qSAbWOhtQMSHujmmmZIu8DAvIAh5lvzyPwNjN1v2la342nm6uUOjBQ1oq/Nk/PVyRfT8bvttlu6ZtLO0D6FOR5Amgdw454wR7S6QEOwDehWF+2X6+e60NyBHD6F5sY+Wli+hsZrbgRxhI9o+XoZo+OMm3bV72Kj66Vd9xYtqvGx7uhn+g6+/noai+tpXvltxiIKrqPtrp0XmlaIa0BbbPwgl9tFCAg2Li8gtNuuAXDUP/NBuw2y/S7wGzRv5qKe76j5dA2Y0QOGQ8x7+NrGd7AMrF4q3Cfa7RQSP/n5kBoE8HuzDSxKuF0vYMX6ynE8n7RNNl6vbtlvn516BInNttMRoN11ywUNtX9DH76q1lajuXr79XsSADGjhnlaH7oFiU/ckPaZ31ZC4rrf+lweeVh9zdyn7//vOkue3tPzGpXffvpUWmpRsE5Hx/14w1X7FSR2BQzLKW58Qf2Ix2dv3x52XcnL1xVQ9NYrkjGDVobEvoREAFDPZ687dRlvaPS6kgDZNpqdZnMm0raBwXIf9bncVkS8Dm8BU6DEb0F1Ds1TvXnVV+DQ1WTX6qmOv9G19ZvlvixfY5Dl3gW1VTOqa1IvKbTj4reyL8Q1L5u79adVycFbLY2+D/XmtJ6muytSrj/monot1d1p4EqUXb7NmUgrRvsjqOP0OqlLIjgjoOG152/rtRQ4zbbTG5D4yH2Xp0hf+2gjBXs88fDV6fjNNl2/X0CitqL//Emr+2lfa0Ezw/rQ0/MaFWlzmLA7O27NFRbvF+Zm+70Ne/P15sk/yI8N8wdTEDOGz1Jg+HH3Y027wsTB7MZkox0mL+Yjfi9MZHKOBRjStHDK5lvkjT+WiNOWNzlvv95oOY1Hv2gZOGVn0MqQmJflGznE/PO19PvQ7MM/S5ZWS5cgUWRqgMALT95YrL3W6sV7b93X0I8xUuc8fN/gXoPEZttpNSTecv05NY1heenC8EkEj/0BEl8qBSFd+236n/Jclt0KRIL39LxGWmnBOh3l3Yxieb7+ELhiH58bIMhMQC0fb8TMJ1T9/hcJGdFnTAb8hESX8duxjQ9ILPXGZ4im0XnMZcxjsV4yEGS+CoBkVmZi0HasdKJfnMXlWsuglSExQ+LIIQIcBHzwlYv8g1myjBCQ+McvXkgmQiAgkKWzFVYi2KFRfsWos6c+ic2002pIBMxp7d5h9Za3A9d6gS59BYnKOWcOqgGdPI5S0cjVKACpvAZ3q86rFufKZdmVsfSnFDh8ZviFyIEmt1UAHH8YkZCxNB+TcsAe/xc+HmFuBomA0WeO7nxJbOc3JBAl6nSONjiM+2w5KQ+Mqilaqg455TJoZUjsS0iMZNLlwJX+LkyoHa2gwffO97mvxbVv5GdnDNUch32h+XTt+6vZNstwhMRyqhMFTHV0rGTQkXOwmj9PYYqVg7C8Nm+A4PkdQGJ1XzPtBKDt0wEk1gtcCUgsB64wv8aclFPmKJEHcKsfb9IQEvfpABKbCVyJ1Dq7NIg6VyS+FoktzY+x8Nmk2QuNYL0ciz05738Jue9Lx3WUFqe2csyvninGGwaIyucfPlbKdTm0WH25H6Xy4tBrhwskcoTntCyNAD8ojtz1IJGDfBUSw2xsm2hBbfjsISTlg+2iHaXSiDrBoSAXDzGfmZ85+5chUb84sEuwmkErQ2JfQSLfMy4RglJowJsRkClSk5mVny1Hfiuc1PNra4WIKqXxryZqLgv3jvJKKPX67IVPlLWXOL8PIkVFg7YqClbwDquFl8uqRPoUUci9KQI1/GYLjBEsw6oheTNfRPAquthcRrBPlu84JD7/5I0dJtaulkMO3C0dL9H1w/cOTgELEl0zXTPN8mUrR8JGfkBasLLvW0f7utuOcvK3qXGAjlQs9TRmAA2oVNeojvyKZbMqTaHtVkuROFvbN15zZs2Pkwa2unRd9IFWstoHsBngKSiky0vyDevvNt9q9ZjhJb7uKHq4uo/2tCvBJ82et/8wqJTAvCtjufnqU5IWcZO1V2iz/ZpLjk3bFSlyhgckinCT4w2ciVasQqKHSaSrCHOzfczNZU0i8BNo4rNcWBNMMEHafvXVV6eHAV9G++RBM5/RhqhHkZbVIBa+jcxTGbQyJPYVJIrsFQ0qRUuzK1J4KfJdsYKE8foeyKvXW5AoGIOmvl5C5a5CIg2eqNFYis810m+JwLmdtEpApwjTqsRLKJeT3hQwzCda9LB7Uq5Jv3GxYknko6zmqczyHYVE2jiRridW8g52BBNXXnpyMpuWl2Gz5i+tUhwnyjVS2USxegng6mhfd9uxOoggkvIxEnE/cNclxT/+8GryHazuY1Ytg2AU2jSrt9inLwGE6byVByTfPf2y3F9s93+9PoDuO74Ndqm2Q0MqP2NH8/zQPZclQK635J2+3H7TeZ1eq/CflNaoO5rLrp4HWB1Xvh4dle0GrpVA8NF72yZw/+0vhharLrNIMeHooxXfG2es4QKJglD8SPITBGtyWwkYiTVfpTEQkejBIu+XnFP2WYc21l4FgjSJ0jioMxKh0hD6bO1S6TYcJxmtB00AozQg6rcEWgCivkoNou8ZtDIk9hUkSlwsWIupGSQCOy9SAIz/LXCKPHfyFBqTPIRl4b/rhYk7R4jk1JGbz/cPSFpGL74vIV66pDeR7iP6rg/Sd9guD2KIOZV6h+ZTe1YWaRYS+Q3S5JXXTyYgyjy4Zvp0ySWXpLQwvrP6BabVaz+49J1mVQgxXr8xXv7MFQiUUoZ7ivkJANWGQDa5GOXAc07Z9EzL6XdHHyJilbZPHVxXItWJa8NCYq5oBqvRrUQ6GGl6iLYANusKAfblVUC0QfsovUw5/Y9rJlDPKjrmyHE5MGcEgsQ3Xri1y1Ag8ODrXz/bbTPorz54LAVAfPLzR7t9bn9sp1EqmA9+9mAb03asK23d6I60en1Zvvzl0wn+aUirGs9Wncd38YhD9+xSve7Hiccco/jRfLM3nDPBLPYPL59EP2oeVOVUOKHp8yDy418vnQ2/ps5S3kTxwFNXV9LgMDP5Mc6QlSGxryBRbjd+tXL60a4DsDvuuCNF5rqX/QUYYIg2HExwrSivBEIApPxv9ssdx5wJcgALn1vb5XSzT1uRXFiON9kFQJ9+SKbsHPn5vNDJLEDbBs7MI3PpSSedlF7I1OmFrBlI1AbtnhyDjUSOQf0Fz8bmhdE1lq8uVu/wMuh/gEcEsJkz/WehAIwg0Hwxw8uO4EXT74N0Lkz82jBGbi7OdT9JeG29aZkY1A8UwSBzuGvEjM1VJTSBaaGEY46pLUNYFVkU9IF2l8XD707ApDmMJeuMyfWwDB0XHC/TQNWx5l4wjhcFx5u/aoLnLP0YEn84+0zFX758oV8CTC69WyS/3nD9tVPwzSvP3tIr51nH2trOXQFQ96H7cb5Zp2/ji9h2OchXi8Xmn6O44PRD+s2KK10Fwe4kz26UI5FWoZwKJ5cMiX0BiR7+lrCT7FefwdhEE02U/AkJrR8XC766oAEc0PBFAt9yPVaTACE09o4DSe55S8f5TKMOdEAeWPI9kh2AJhNM8WMEpOaLDx9NmXa1T1unT47RlvkEREzlzUCifvAnNu5GfppWIbGuNIm1kL0w0q6xNoToq7HpkzHTshGaPfcASNRX/weQ+f6HJlFSa2OyxrE2aGDNm/vItVQnaHN9WC4kL9cHdRiHusGavukXzWA9SASHXGRoiF3j0MKWIdF1VYfE1OYAqEourh8g3pj01dxxzckygkHizNNMXpx54n7FN1+9mOHpO1AkQ7ekId/FXXfeuk3qnlaeRxMoCOi4o/fv8Dj3nfvPfeh+/GUDTTCI3GzdAcWGayxX0zL21drNzcJeK5blyyVDYn8wN5chUf8BQwSwxFJ1TJO0juV1Z8si+XKYK4GLYCzAQ8MYa8jG2rMAhDaNdtLqKLRoNHK0j7SYAZW0hUy1/IlpJa2sQvMXGjDn1luTuavmZr6H2qkXIS0Tgn2W+SMg1Wfgal1kWr8QpltgGOfYX5Z99903gR6RmN+8gDWQyA3F/BMQbl5YIswBSwOtLeiWPYEARLAH5AYMGJAgWpuCURwLpOtFUhsrl4IQK5cA1LK5WX+Yk2OpRdeR9pe7jftYGyCeCwKtaG/5m2bpJUj0sH3qkSuKPbbfqHjrpdszRI3kZcftt0gaQOAm+vsff3qt186TBog5+lcfPNbhce4795/7sCOz/Pabr52O+8cfXunTtZtbAY4ZkHIZ0SGRpguoxeogIIZ2jwA7QGIsTKAAol6qFFDD7zAEDAERcxMgE5AIvJhuQQYAqmrzzJ0+WNatrKkcOHBg0prFCiK0anyHm4VECfRBWYy1LK6XPgTADRkyJLUHho3TeFznWM/dfnNnrvg6lgUAA9rwB6QZBdzGaezgmPCRFkAUZmxzY44Et0mV5RpY49d5kvszH4NnwMoVoCMBdwGJtLb6IGUXoVmMwBUR6qEtNs+WjAOK/qe1dU1cz1h7OMtIGLiSy8hRJEGv+k321nkCVX766l0t6/vff/9Kn67dnEsuGRL/F3Ai8hXQnXXWWQkGaPMAyvHHH5/2CdRiiqTNAk6Sv1eDPfjt8a+zBrC0NMACDKovIJEWkH8iOKF1C2gS1CG4z3a+cs7xP5MovzvRx+ZPKio+e+AIvAk6EShm3puBRHUytdLm0coJYNPW4YcfnnyX7bPmMPM4nz8BG8Q15UcoEEQqHqZzvpPO0abPNHdS6wBR5+orbaT+mENBIaBMWhpR4eaF1pTmlog8BrBWb7IfrBm/dDXmlU+n6wEiw0zNpEz7WJ0PIOslgA8hTSSNrEwP7k9wbw61xZTsvlWP666PfCDDtcA1pcXUZ9rFNdZYI13bLCMIJA7PH6BccunLkiExlwyJvbviCq0i82d31j2OpNG0ZGVTZJibY+WiqgBQmQKqia8da3tZa2UumWpbbeo0Xm2B13J0MJAzpmp75hgYA9p680Aj11nkrzqNzbiBWLUu26taW/157rnn2uVxFJSn/61KY8PkzTcy+mQsQNaKUUCWmd817QjCs2RIzCWXDIm55JKX5etQwscwzM1ZRjyJKPQQfpfM71mTmCExl1wyJOaSS4bEpkVeP0ESlsPsD8vkZem+0K4KwGESZwpn7g/TeJYMibnkkiExl1wyJKbADaWVYm7MWVnMGdMpOKln0u3LyFp9qwZu6GO9fvYHcS921rd6Y+oqPJavSb1E3l2pI85rdL178/wRRYyLa0az3+8MiblkSMyQmEuGxF6FREEcHUUUNyNyDPIzLIsVTqxi4m/kKgzhkyciu6+Er145gtm1FSHcUc7GvhSR0J1BdXVMXRH3utQ/TM++A1LpBKyJ1BbMI5BH4BPto30CkwTP8E/12ffE6j2Sg/ML9T9fzxD+oLfddlsteIbvpcAqQTagyfnuEdHlzpeU3VhC5HLULy4PRKJxq9VI9TOiwaSxSj0khVSGxFxyyZCYS4bEfgeJIn5jdZEQEcoBcoJdyqlruiLVpfXAg0jr0HDVS1FjRZO+FEEcZaH1jNyS/UlENscazd0dUz0RuQ7i3Nei1d3nANlyiyK5QwS+lNMluWeAmoh54CZ62ndCah/BQiK2pd2xBGLAm1RA7g3HOd7n9dZbL2nTgK9oby8tXBi8uFiVxuozcb6XCfU5Xoog8AiyfD9sF2A1ooksANVE9hkSc8klQ2IuGRL7BSRKpEwzs8IKK6RUMTRUAFHeQyleaNPWWmutBI6A0lJxkjx7uJkfIFFNNq3OqinZ0nMBjDRSm2++eW15QGJlFyIVDygFjaAhtkk/Awz0pxxRDSCkspEGxnmOlWbGcnO0VoCDltLqMYAXlLh2QIM/npQwgNCY5DJcZZVV0jV3raXDkT5GodVilpcI3DE0YATEnHrqqUkbpl5aNql3LOdXNS1KbWO1E6lotCFRttQ1xgO4/K9NsGbbNttsU0ttE2JpwVj7mgbP9QBbopS1cf7556fE5+6Z6piiDyuuuGLSwDlPqiC+pXJmSp1jKdP77rsvQV5ZWxlpj9QrEtt3xP9xjHmJ8ZsnfqvmvBzNbRzS7Uhgrp+it10nQoNpGwD2HaNNFFFePv+oo45K62e7h0CmFw9LPRLjB5ruWX8jZ2SIcbnvjH+BBRZI2kxi3Fa/4Z+pXfeQYnwxp+bCtapGt9OiWtLRtXe8Y+S9NMZYdcc9uO6666ZUUuZLfZaq9H1z37hvfd+sVBQr+4BG97B8m9VsBM53/7iGGRJzyZCYITGXDIm9DokeRkAJlIAhD1+wYtxSo4As8OWhb5UOgMS8uNlmmyWQC5gjoAxklAXUlLVS4NC80v7QdnmYeqiaY/n69EWOQiBgzqeeeurUL4AEHsrQpH80SB6eHtpyGEYCfQ9i1wrkat8YJKC2H4iBJPADaqwGA1g9wGnHbAMw+km7BS4c7xgPc7Bp1Rrg4Z6gjQOwEnObH3kUgWgIrSTwA1XmZ+aZZ071yWsJKvRTrkRmWkv0ScptDgBMzK8xlrWbwNv8mRvQoD19iAjl6pi0TcvHvAlczAMA1p4xiFbnEmAsVq0BuiCqnBtTmyClnLLHsWDVcc41JnWbC/BrngJ2wI8ckaBMuh15IENLCJpidRr3Hk2i+sCk882flxcQGEsSSkzu+tBOq0+9UjRFm77DiuvpxcT8mANzrj73g3nxouRlRx1bbbVVujbg2jgApX6YX3W5x50DYrVhDWxjNzbAbS7dz/rpejoWzBqXbfpnG02rNoCvddXd78Yvz6f9TPuulftAu74fvjOO0V5Opp3Ld6ZYzUVC8H/+6bW0astfv36p+NNvny++/uXTxa8/evxbSPwql1rJEJchsXWQGOZhYGjsHqQeRqGhCTCh4QiNHxACGlVhbqzm/KPxCo1h2QzqYQ2MQKKHvIcnSCTm2brO6pJwGkTQ2tEIlUWy7Fg+UH3WJg6/QlpCD1gwCwAcJypbFK9E4eWgDA91AmxofUAFUyzRL5pMMCThNZihSdVHgCAJtzmUKJx2EpTxkytrnuwLs6n2Ywk9MAt4zLs5AD6ABPxEJDkNKAEpfAPLJnEaKBo415EWjw9fdUwg0JiMnzYO8NIgEi8G5bQ37m1tAkR1ghdQFJBIQKn+xnWSjL08VuM0fjADzFx7sGTVHveTNgCRfoM+Agj5L8b55lObQNf3j59rzAEt6DrrrFPTTLtHwJnvqrXJgZ8XA9fSS0O8OAB6LwuuLUh0T5h78+Hecp3N0fTTT5/6f/fddyetbGjB9Uld6nYcOAVyNLDEPGif8JEEjer1/XEtADgNZ9l3kiYRCJpTLy409hLMR5/8BvEt1a75A9VxfobEXDIkZkjMkJghsdd9EgMIAZCx8wfzAI9AAabEgJuNNtooPZhpUTxEPbA9XCNSOjSDITQyTMexzQMuPnsIxsPfNg9KD2gaF/97ODrOA1s/AF/Uo23Xg3nSAzXaAgh81exjqnU8UNEOiLQaDI3ihBNOWAt+IAAiYIU2CowAKv2lJaNl01/mTBogmjsg5d4AzCCFpjNWcYmI8YcffjjdK+qMACHHWxEltFy0TPppDsyxfgUsA3aatAhGqZqxt9xyy2QO1Q8rsND2NhoT+AM8oDMg0flx/QJuQJ0500/3h/kCriAx5t+8h/YMbNE4hhuAv4BIMIr7g3ZOm8ZCC6sOcGofSDM/tMCx5rYXAdpTfaWVpLV2v4Uwz5aDWWhmjU1/AJfvqPE6tyxAHWi5NnwZQei4446bILMcza5vNH4g3Jyav6qoB/Dpe7wsgUEaSfWAcpAK+Hx/aSfNCZM0n88QsEzr6X6XtxKUW5nIvV4vupxGGJhmSMwlQ2KGxAyJGRJ7HRI9uD20QFFEpXp486tjxqVFoj0EJx7ctB00JiBNv2ipaD+I46v+iaCKX1aIduTk86APoPHwpLEBIraBPoEToEEb+gKg+NjxS3Qt+I2BGEDjgQxaPJQ9cNXt/FjOTr9BA+DhdwloQJ86aMv0WfuOpy2lQXQPxJKEYe4FFc4BJepxnvNBHLADH2CRJjGibc2V+8ZYmO2BJuDRVyCuLm2BAn0AJObMHIElx9EOut8AWWjwQowjlkQE++5X4npVx+Q+1n/mTRpfx5onGjGQ4t4GwAG3wM7fAE0vANoAwuZYvTRk/B5puIwZ2IBh3xEgZ25iFRf7zJd7zDUg2jO+WL7RMWDbXLoPne/4eMHQRuRzBFD6F30mNHnuIWBZFuMzH14W9M2Lj+sK9rwE6JeXjAjWihcI4435LYtrCviYol1TfaXJtXwjc7zvgntXm/wUAa9rCUhpvx1jXlwPkdyxTKY5Mx5afX2qpqdynzgfxGZIzCVDYhkSf/9l8buvhz2wf/dlhsQMcRkS+0BAQWin6kkEQ5SlDIjNCPNraB4jYKHs6/ddkQjQ6U0RsdzTuQWtAarNCLituhSMKAK2w2Q+PCRDYqm89syNxQarL1vccs2pCSBGtP4PfXBwsfXGqxdPPDQ4X89uQuJSC86dHtjezJRffvZJt4Dqiy8+Lz75xcfpb4bEXDIkNi+iOJnWwiw4PMSc07YwJ9IC5aUAs/RHcZ/StNIcZ0jsgwIebrjixGLReWYrZpxqsuLdN+4Zofo/+/RTF2OPMkox7yzT5+v5bXn92ZuKQQduX6w14P/bOw8oK4rsca/+DSxrQAwrIggqoqKIgIqRjOQgUcmSlSBJQJCcUUCQICIZBBTJKFFEQLJiIuckYFzdddej1r+/C/V+9Xr6vZl582YY5N5z7hno6qquqq5X9fW9FR42N11zpcl+Q2ZT9KH7TO8uzcyhXctMn5eam8VzRoYsibt2xQaJe3bvlnh79+xWSFRVSFRRUflLiEJigP73hy3m4Xx3mVtvut7s+2rJeZPvko8WEEisVq5IusvbqcMfmaO7l5ufT21Ik+dhMRzQvaX5x0UXmUfz5zHT3+pvDux43+zevsCMeqWTyZzhMnP1pZeYy7z6Gj6wQwgSDxzYFxMk7t93Jt7BA/sVElUVElVUVBQS/8q654tF5rqMGUze27MLcJwPeQbAFr870vz6/eZ0l7eKJR8VgB0ztEuaWIRLP/GAPK9q2cLml9MbEribP1k5SUARSHy1b1tz4sCHMmAfPLg/Jkj84YfT5uQ3x2VOo0KianIgkUUbCokqKioKieeZNq1bSUBjyZyRWh/nESSOHPyiPCvbdZnC5pb65yR2a/+sQOLAHq1SDIm6cEVVIVFFRUUhMYJ+f2K96fLi86ZRg6cj3vOf7zabN0f3My2fa2gqVigj9w7q38ns37E0atqxxkM3rplphgx8yTRrUtfUr1vTtGnVyIx+rVeS4s6Z9orARpXSjyvonSeQeGLfSnP9FX+XZ/Xu0jzqwpXj3r1X/r+LTb+XnzMnDyokKiSeG0hk6wu2nFBIVFFRSXeQCHy1ev5Z06B+TdO7Rzvz0fIpSR6QP98y14wa3lPgrWTxYrJb97MRIHHn9oWmZvXKpnz50mb96hniEiX+M7WqStzli9+Ka7zfftpmXhvaXfLUp2d7893xdXL90O7lAovFvbgfLHgzavl+PLHOXHHxxSaDBxzH9ixP8TzH4QM6mHLFCpl8d+QwRR68z3R4vrbp2alpSGdNHhQO3sfWmr5dW8gcw/tz5zSVn3xMwIfr7n3rV02W6+2fq20aPVNB4tiwA1+/b/p1e850bFnHNK5dwQzs0VKuL3pnhLhi89+ZUxZ1zJ85LG759lv1uOfuHFkF3IBFG2/KG71jKm80JV2egx7a+UECSETd1c1lij5kenVuZk4dWp0QEn/41pw4ftQc2L/P7N27R+Ybfnv6mzCQOn3qhHfvYXPk8EFZ3Xz06OFgd/T3p8wxL4w09u7ZI2meOHFUnhF27w+n5TpzI7lvn/fcQ16eTkdaNe3df/zYkTN59O7fv2+v5IX8W/3mxDFfXk5LPkN58Z5FGRJu+6MQlxaQyCpeIJH/u5AIICokqqionFNI7NG1jTmyd6U5cXC1GdK/k0DViFe7J23l6MY5YuFDmzaqI3Gx2AVZAqtXrSThn254Nyzs2P4PTfFiRc0TTzxuDuxcFpd46JgRvSVeyxYNEswpBBifLFlCwrE0JmXF8MrF42IGxH9/u9EUuu9OWSjx/nuvewC7VayUGc/CTMNa5UyTOhXDrGxrV0wyt2f9p6xUBuiAmIWzXzO5br5RFtS429x8tuEd07lNPQFa0nvy8YKhsON7V8gCjqsu+X8SVq5oIdO2eS1ZzNGqcfVQ+VDyltJ8+/XlDo3EbZ/9+mskzmMF8sj/0aH928VU3mgKYPIc8gwQRoJEysIHx9Z1M82WtTNkYY0LiYAW4IUePnTA7N61S67v8pR9FC1IAY1HDh+S64Tv9+73gxz37NmzW4CPfzN/8ZgHdtx/2HuOO6+R+DzL3sc8R1Zck/5pH6ASTpqEnTx5Zj7kN98cC23jA7Qe8vJ+/PiRMKhlJTarsEn7ew9e+cs1NHwLH4W4tIBE9mtjw2ZOXmD/Pza2VUhUUVFJF5DoDqTAVLWzULZ903vJAqHXh/WQeM81r58gbOzIPhKGtTIoLqBKeNfOLeMSD+AtVrSohH24dFJg3CEDOks4rms/TLgKJAEd097sGzMkWusWexi61wGmIBcswMJ2LSysYDVumPV20xyBtKyZr5b73LBOrepJeqUeK5AgD1gSCWO17+SxvR2L69ZQPrAopiTf0bT4w/dLnNcGdgxc+RxLeYPUWiwjbQNkXc6UGyspIPzTN+tlr0QXEgE113qHle3/tsdJaC0EFAUS9+1LYLUjLT9cYt2zMPfD2cUuWBAtiLppYA200JeU6/v27ZXrLhyiAKHNy3ffnkwAsrbc3KeQmHaQyHxETvTgtAY2GQYSz4WrWSFRRUUlAST6B9H+fToKPA3s0zEmSMRyl2AByFkrY6/ubQPjrlgyIXRA9r+/3ZTieFPeGhy6/r8ftwbGXf/h9NA9Oz5bGLFcZYs8JNAxuFfrmCERaCMNLHru9ZfaNgyEs5aNqsn1Ok+VCkzPrtzFEhi0YMO1JFod2q9tRIAc0ruNhGFVTEm+Y4XEWMub0GK9SaYGRCqnf14ikGg31P7h+NpwS2LAnETcs0FQhh4/axn0WxItPPrjAHAWEi2UnTp5QgAOl7F7r7UOYjUM2nbnmM/FfeQsPB7w5eXwoYNntuk5GLxND3kX6+ahgwqJaQiJWBHtfEQg8VzNR1RIVFFRSQCJR/etMq4OHfRSRNiLFRKLn52vGMmNjdXSAtueL5ekOF6/Xu3lGvMYI+V39xdLQnGXLorsygRcgI4XmtWKGRKZC0gazepVDrvOHEKuc8qLez3HjdfJ9bdeDy430EY42/MkFxKDwA5XMmE3Xv2PFOU7VkiMtbxBeyNmuuxSuZe5lkk5dQWXM1vkYE1kwFZVTWvFimhdzedy0YpCooqKSgJIrFG9sgnSdi80jRskVqpYVsJefinYGnd4z4oQsK1eNjnF8Z5v3kCu1a0d2fJ06sjHobiTx0deeFG36pMphsSl80ZLGsy5c68DMlx33b8slrFzBNnzMCi9SWN6hVzHWMNSCokfzB0lYVkyXRlzvmOFxJSUN0jZBJ17gcWgaQR2XqLrcsaaaEGxWvkisi3Oi63rybxIVj2zPQ6bbTPvk7DSRR6U/7va7+XnJazIQ/eFru35YrFcQyeM7pkgTjRdOn+MWE7vzJHVFLj7NkkjV7Ybw+6ZOWmgXAey3ev33J5Nro/w2oO9tuvzhaG8TBvfL/CZrw3qKOG49w/uWiqbPKvGR9nmhlXMLFJhDiIuZiyIFhCtFdF1NSskqqiopDt3c6waDRLbtm4sYVUql5dVx/5wLJgW2FjBnNJ4bMXDtWpVK0bM76Hd/weY894ZFfE+Fnqk1N2MvjN1iLn275ebNk1rmDXLJoTmDzJX0L2P1cgWmoC3oLQ4PcTe455gEm9ITE6+Y4XElJQ3SFndbe8NOi3HhUS7gMUFxeoVigoodW7TQFZVo8xXRLu2O7OvYtlihULXrA7q2VrCihXKF7r25Zb3QmA23QMzf5wgHT+qh7n71pvNLTdea4YNaO99CC0zU8f1lTSYb+m/f+LYXuaaDJeZZvUry/GCbZrUkHtbNa4Wdt+nn8wO5YV3GvTscSNeDt1zaPcyARnV+CkrmFELh7iY/YDoWhEVElVUVC4ISNy0dlYIyKZOGJJg0B43qm8o/MSB1SmOxz6IXCtWJPLxdKyWtnFZpZ2YZSolC1fs4gy2f8EyyYpgtqXZsmZ6IMSwgINnTh3XJzAtVgUHWfhSAxKTmu9YITEl5Q1SrJsWEtmqJxIkWlDE5Tysf3tZwILruWbFYgJJzLsESJmvaPXlDmcgsVzxQmJ1dHVI7xckjHLaa1hJ7dF/hPvj+PWVPmfSuCN7FrP7s/mh61O8euH6PbdnTxAHyC5b9CFTq2JxU79mWTmnmpXg/vvIyzWXXyrpjBvRLfD5/Xu0lPBbs1wv/wdkVFOuwKBVOxfRwiEu5kiAqJCooqKSbiHxp2SesRsNElG7ZyHavWtrM//d0eLmbdG0nmlYv5ZcL1WyRFzirVkxNXCuoqtvTx4aAskfPQBIzS1wsFjl9gb+Li8kbZ5n4QfyyjOx2gWFN69fRcKfrlwiVSExuflOCiRyBF68yhtpXiLb+1iXM27UaNbEaeP7mgolHhGLIsBYs1JxASVOY8G66GqPTk0kjPv9YUP7tZOwEo/mD7teMM8ZVzGg7Y9j9buja+QvJ8Rw76CercLCJ7/RW67j5nev/3zqE3FBY9WNlLarjxe4R9Jp3+KZwPDGtStKeI0KRc+k70GMavzVgiHKHEQXEM+lFVEhUUVFJQEkBu0xuHrpZNkUOzlnFrO4BOhq3rRexHvY+Lpp4zoCZpUrlZN5j5vXzgpZBIP2WIw1XuNna0sY8BqUZr26NSR8/Jj+kU+RObZW5mehnOQR2mLnwIemTOEHRTd+ODXRutmxbV5oWxasZauWvGk2rZ5mvt46NyxdqxwDaC1n/nfA4P3PqzLKKt7tG98JhMSglb0WEtkUOxIk+heuJDff0RSwIq12LZ6OW3kjWonXzQzt5fjgvXfIXpFBkEh6lJl9JgFitJYDiUCjq706Nw1Boj9s+ID2ZyDxkfxh1yeN7R1y4W5YNTlBvB4vNjEdn68jrm5737D+7cLusQDK3ET3Ovnnep6cN5uJo3uaZQvGmPUrJkl5Du9cmuBZC2YNl/tvu+kG8+v3m8LCsBzecOWZk2q2rHv7zGbjHsCopo4ChhYOgyyICokqKirpAhLLlX3SLF043pw8vEb2F2R+HgtXmO+X5CP5PJhqcNaqxwbXuHKj7T3oD2MfRP/ik5TG+3LrPFOmdCkBy22fhG/EPeGNARKPk1f+E2UhBCeJXH7WsuJe56QQ69Jki5ykWBKx4Nk4fmWzaP+pJXZlsX/un7Wq4Vb0P6d1kxoSlv2GzLLoIigez/r2yJpwwB/UUcIAsT1fLEpRviMpFkQLom9PHCAgB9SkpLzRdO6MobL3ooXPCaN6mD2fLxQI3fflYjl5hrzMnjI4ZFX87w+bBSovO/teASkLj2jdqqUl7K5bbpItc9wwtvEhLNv115jj+1eGrmOhxIpKGLBLfeHC3/zRdNOpdT1TqRQWxo1yb4G7bpX77s+dQz4+Dn79vgBikQfzynVc119snhNKm/wC/RYu/Zozy3VS124+n326/Blr4nPPhF1vWrdyCI5D6Z8FGNX4q7Ua+q2H5xIQFRJVVFQSQCIgZV2zdnPpndsXJWkg5lg7INONb7VkyeJmzsyRiaax8v2Jcj9nKicHApIS75tDH5kXWjcWdzQbbwOH3F+kSGHZqDuxlbIMqEDG8oVjw66z4hWXLuf+Mp8uKfkFKhrWLGuuy5hBjrcDNIA5e0oKgIalzgXi0a92kUUjwAOw9ECe22VTaRYehJ0+s2e5bA/jAtw1l18m1r8DO943996WLSyMPL8xvKtYr0g7gxPGySzMO4w135EUMLvln9eGnkPdPVOlZEzlTapiQQTw7bY4doW0hXsW4lirIqe7kD8Xsng293yycrKU2w3D6vbe9FfNkV1LpX7dMJ43eWwvAU8U2MRaSJntPVg6aV+4jO19m1ZPDQEhSl2wIAZg4/xwe51/2zi4qhvUKCP33pfrFpkeAKhSzsvOlnnFojdC95PW60M6SxvAfc32RgXvvk2AGoC198l8TR/IqMZH/UCYHuBQIVFFRSUQEgUy9q6URSKcaxyvhSxJ0dNHP5ZtbgoXfsLs37E01eKxIAHL4qoPJskcxUgbbLuKyw7LDZalSFZRFrMQHi0dLElAFoDACmkWELjhLI6w2+ywMCQoPnnhqLqg1bqppSnNd6TjCT9bP0tW/fLvSM+Nd3lJc/sns2XLGOaWHtq1NOqCltRSXLiUDaj+5sCqiPdh8eSkGYDOvQ7w7/h0XmjBDXB4xcUXyRxGYN69l4U27PEJKGKlDcoLK56BYwA+KB/RYEY1vnqu4VAhUUVFJSIkngsF1qpWqWAqlC9jtqybnerxkqNY2LCaYSGKNPcO8Hgob24z6pXOUdPC3QdIPV7wnoj3YK3iHlbWnqv38VfJ94WiafF+0gu4qCokqqioXCCQeGTvSjNscFeZu9iiWX1z6vCaVI2XHMW6xXYrzOUCEo9GsKwCkSxwqFq2cNS5lygQyUCN1SfSPWxuzD3MDUwvEHK+5vtC0bR4PwpNCokqKioKiWk2sDVpVFssgH16tpcV1P/717ZUjZdcxcXHAgQ7Vy3ahs3ch8suKXPxrr/i7+K2xd3ppgtscqoJc+FYKZ2U9NJKz9d8XyiaFu9HoUkhUUVFRSExzQa2XZ8vSta2OimNl1qa2IIXv25b+7apXr6ILAph4Ga1K25C5jyyeGDca91kq5f0BiLna74vFE3t96PQpJCooqJygUOidoxpp+yPduTwYfPZtm3mwP79shWG5ltV34+qQqKKiopCoqqqqqqqQqKKiopCoqqqqqqqQqKKiopCoqqqqqqqQqKKiopCoqqqqqqqQqKKiopCoqqqqqqqQqKKiopCoqqqqqqqQqKKiopCoqqqqqqqQqKKioqKQqKqqqqqqkKiioqKQqKqqqqqqkKiioqKQqKqqqqqqkKiiopKuoJEjgg7deqU+fHHHxOE/fzzz+bEiRN6bJiqqqqqQqKKispfERI3b95sevToIX/ttdq1a5tixYqZxx57THTUqFFy/eDBg6Zq1aqmcOHCobDt27drh5wOdPPGjeapcuXMrBkzBOC1TlRVFRJVVFRUQpA4ffp007NnT/P000+bkiVLmrp165qXXnrJfPTRR2L169evX4KOBOgD9mrWrJkAHosXLy5hr7/+eug6lsPZs2crJKYz5b1MnzLFFLj3HnPLP/9pvv7qqxSniQW5YZ06EXXFsmVa96qqCokqKirnAyQCh/PmzTN79+413377rVmzZo1p27atwJwFPn9H8vzzz8v1Tp06JQh78cUXE0CiBRJrTUwPkEhZjx8/bv71r39d8APDv//9b1Mo//3m1ptuMnt2704xeM6fO9e0atHCZPzb38zlZ7We187ee/ddc+zoUR2MVVUVElVUVM4HSASW/B3F//73PzNgwICQ5c8/hxCwAiaBC39crJKuu9lVC53pARLbtWsneXnnnXd0cPB0186d5rqMGU3eXLnk/ccjzQa1awsgZs6QIW5pqqqqKiSqqKikESRG6iyYo1a5cmUBqSAYjKQKieevNm3QQKBu0YIFcUmv9XPPSXo3X3ut1q+qqkJiAvnzzz9FVVTOlfzxxx/ndf5T+zcUdeHKzJkzBaR++uknhcQAd3WXLl3Ms88+a6KB9rhx40zLli1NhQoV5N5BgwaJaz9a2rHGQz/55BMzZMgQ06xZM1O/fn3Tpk0beRdJifvOrFkCdVXKllVIVFVVSIwo+/fvNxs3bjSTJk0yH3/8sXnllVfMzp07JWzLli0hj9TChQvN6tWrzYEDB8T75MqhQ4fMo48+KrthBMmvv/4qac+YMcP88MMPCQbGZcuWmT179oT+v2vXLplLn56FOtqwYUOS7p07d670+4nJBx98YF5++eW4gsLWrVvN559/Hvr/b7/9JusK3nrrrVQDtQ8//NAMHDgw5nLQ7r744osk34/xq1SpUmbt2rVxKwdeVtZx0G7jJStWrJAxPEh2795tynrjNd7eWOX06dNm5cqVsUEiC1cAqe+//17+/9lnn5k333zTDBs2zPTp08eMHz8+ZkhESQOQYaEMPwgaYlA+jh49at544w3TqlUrub93797SoNx7jhw5Ig14+PDhku7EiRPlOhUMzLEa+9ixYwK+pFWjRg3JC7DI/1E6tGj1QZ5Hjhwp8GbLEgkSv/76a3lG+fLlzbp168wvv/wi8ZkDStylS5fGNR4d6muvvSZ5ovx2GgGdM3VG3CVLlkQt33fffWeuuPhik8EDu8NeB55akLjX69j7eO+jvQewjerVM/2998n1BfPmmae8cue76y5TvmRJM3fOHB24VVXTISQCdosXLzb9+/eXPgqvkx3s2eUCiEQYfOi/gTn6YuTVV1+VrdIQ7qWvCpLRo0ebw4cPS//XunXrMGDhufSJdjAGQN9//32ZE5+e5csvv0wyQND/16lTJ0ngyXz/eAogu23btgQQhtEhtYSPCowisULi+vXrzaeffprofbCB/ZhgrE0qtCdVunfvbuZ4Y1c8BOjF6OMXYNrKU089JXUXq5w8eVJ+OzFBIsqP285JpDECSXYBCrAUCyRSiS+88IIAJ8D35JNPhhbC+BeSsGIaUiYOX54sNuHrivsBQnvfN998YyZMmGCKFCkiYTRmFs8AlpUqVQrlacyYMUL6NEauNW7cWP6PTps2LWpd8KOxQNmkSROJj8UuyBJYvXp1CeeLzA+z1MMTTzxh9u3bF5d4KGUjHouK/PP/6IRtHWNpjFbGO7JnF7CLxyrkSJB4xOv4+/XqZa665BIJL1O8mGnj5fuRAgVMK68+bR7QxYmAu6qq6rlxN9NfYYVgUKcfxdpH/9K1a1fToEEDuadv374CdRgU6LeJU7p0aTNlyhT5KOXfGB2qVKkiQOgKY4S1EtbzPib9wnPoJ62Qf8aJSEIeOnfuLGPI2LFjxVsD1DJuMAcfa+jvv/8u3iXGOTxo/N20aVNYOow1PPuZZ56RZzIesAUcRhUgEKME6TPu7NixIywu/TQKKAK6I0aMMNWqVZOt4hDGO4CY8QVLbcOGDQWSuZexEehmTCPfwHcvrx/l2exMgmDQoc7bt28vY4bf6vSc1ydjlOGdRBLCeFcYVBDKQByeQ7qu2HLwTN451kfGa+oQwUgB0FAnWO4mT54s5cdwAfwsWrRIQI1n8J6J27FjR4Fj+/Ewf/58yQ8gQ5vhHfPOaHPWgsaYx3OwdmIMoU2Rp1q1asl7cUGUtobRiLzxHJiAsRWLrLWSkxbvmDxb4X1Qf3AA/6Yu2M1jwYIFAmpYzBHqg8XA5BvDDR9RtJHly5fLxxHc0q1bt5Dl3Qr3wSG00VWrVkl9kBb17rZznlmmTBmpY9oEu8zQdmEH2jZCHVC/5MEV6p/0qRPKze9w1qxZUh8IkD148GBp9zwfnotpn0QatgWSWCCRjLrXgZ5y5cpJGBm31/laJQ4NyrUy8qL5YXE/hXLTonFwHZiac9YSZVdju3lq0aKFXHv77bdNSuqARuMPowyEke+guDRywvnhxSMeDcPuUUknEhSXF28tn5EstuhD+fIJnE05a4lNTXczlkTC/3HRRWaiY5XGKvpowYIShkVRB29V1fQ9J5GBb+rUqWIlBBwzZcok4MP/EQZSwAfAou/GK8UATz9NH84Azb9dad68eejfxPULA61rOSL/QFO0uVtYH6016auvvhJrHYMt0AXkvPfeewJqACrACIxgMbUCCDMYk3eezV9gDDi2Fh1cmPyfvvi+++4LywOGCCCIPg4gAvQYD3k2AzcwRD7xrJEP+mvuxajBs7Es5cyZU0CBPHIv8GEhkZ1JABHKBsS6Vjk8ZZSJ61gFo9XT0KFDRYEyYINrjJV+SORZeL3IO+MShiM+BBhriJvPG08Yb6hjIA9PGGMVMMuYj3UZICpQoICkx1/qE6CnnWAdBOBtW6EOcK0DOgCQbbPkj3zSDgE78sS4CDwBXi6Ike6Ms3sDs+UfHkjaLO8NML333nslz5SXunWFsRkuoX4tRGOJJH+0C4R3CCTCNbAHbYt2RVsCFoFDynjbbbeFWQBhCfLMO+J9kwfKTlnJnxXiAr+kwz0lSpSQ3xr5pX3TbgBc0gEmaStWSJ+6IU+0MYyAtAXaBPmljolHHfNM8hwTJNq5irFaEoPmJPLSCKMB0ZFwjQ6Ga3MC3I4QNmH8da/zI+Q6X1uu25xOiAYSb0gMAmVrZaQuguIyl8auHHctp7HGo5Ox1/nRBsVl3oW956so+yGWLlZU4Gyg9xWW2pD4ive1RniJwoUThA3yftiEYVXUwVtVNX1DIgM9A5IdVAE8vDlYr6zb2UIf3hfAB8HDwaCL9Qb4ccUFQwZQvwAlrkuUATOaJREBChhc+WhGsHABIgh9JECBVYuB2cKt64rjHixRFr4AEu4FTosWLSrXsPwwhgGAN9xwQ9jzgQc8Zi4EM8UIKMCqg4vdChZMLIkIgziDPTBwxx13CGwBbHYupoVEgAFAwIoGmNh88pdxlGczZgGx0QQrK8DF+GjnIWLN8kMiwlhr6woLHADCewVoc+fOLe+EcZpxh/qzaTAtirEZveWWWySPTFvgLxBZqFAhqVugBo8jwId1l7/W6ucKRhbGZYRpZNZFbuvbbVfWxYwlkTzR9mm/sEmuXLlCeebduEK9ux8OABVQiNopF9QB75k2YMuKxZX5u4AklmLKjrXZhUQsz+4HEpZ1YBlrpF9gLytAL5BK/eJJJW3qnzoDnF1I5N0Aw7xLfj+2/WGpp70AyPAHZeB3Cej/zX+kHi7gSHr07B53qQGJVKiFGL4uuGZXVwNH0LOrNJQgSLOQyBdVtM4wNSHRltN1h7vKF6gtKz/wlMajQ+AaP6ZI+aVjtHH5gUW6r7bXiIGz1gEW0tSCxCBrIW5mwm68+iodvFVV0zkk0n9fffXVIfcqY0XBggVDkAI8YhVDGjVqFJqTyKDGnCisGFmzZk0AH3zYAwYMaAzIDIRWsMjh9nPd33bgswO6X8gHA6h1xTIw2kEYFxtuOsoATJJ30nMticQDIoAYaxkkDoMuBg47aAM+3HvNNdeEPR9QswBj64MyYVUEqnAdWgHkAE6EAyywcjGXLkeOHDL16pFHHhHYZgyzz2awt3XkupQZ7O+///7Q2JcYJAKrjLGMM7iDgRCMNoyrfgH6bV0C2RZEgJybb75Z2gbXUPJv55cCYli2WCuQ/awxAFCj3t99912BUwDdfiBYoALeqHO/8P6wfroQhVWtQ4cOYfcB3vbDgLLhJqauGH/JT5YsWaRN2jz75+Lec889oQ8HysP7pH4sJPLBwHsmDd6fdRtTHurHtif/YhPi28VC1koMSFprfCQrOx8YpEVcFoLBT3a6R9C0AqznvB/yZ9sflkna35133im/I35rgXMSeRBmYajYAgtKApjnqaDUgkS/Oxr6tc/ny42XGaS8oPQGiXYOJCbboLh8DdqyuQtwYo1n3el8FUXKLw3Cxp0YxZVcx6vT9ACJSxYtkrAsmTLp4K2qeh5sgePOEUOwjFnBFY1lEbhibMDahcuZARurDkCBu9adPwasYRXBGkL/BVjaVZ7Epe9nehFjBWMTliQsN3xMA2h8bAetosWaYy2Z/AUiGDfoFwlnkMStyHUsQsCHWzfAEIM0rkPyC/QS384jBJqwThFGmdy5gVjosI4BKUAwZcTaynjEcykrYxdWJ0CDMRY4ZK4dUMl1XIrADOMk8MiYTR64D/choMgY7q4mJ//UOWDGmBdtYYX0zR4g4uq0Hj3GFsDIusqtMJYDNPwFaDBYUIfANWMUwALkMV7yDnk2aVBu8oMLnOvAMUBKGYnLXEUrlIVrQBbth3jWkOJakbEOYwGjbmkbWKfJl52e5a4W5v0RzjuwDEC9Y73lQ8Lm2XXzWqFN2vmEfMTQ7nkvjNtYtpnfh1GN3wJjM+nywUL+KCvtgzTsvE13kQr3kx/yQZmoe96ZHyh5N4AnENy0aVOZC0s7Ag75PQDLWMmxRAaJC568A9qfXdhLfvktJbpwhUZkoWK37xSO1IJEu5iExuZaFu2WCknR9ACJ9sQa4JYflD+cTsOWDapPaTwaA9foMCLl1wVM5iJEuo9FJGntblZIVFU9/yHRb3WJtEqV60ndm8615iR1PzjuARJcmLECZABcbjr8G8tJ0LVI6RNm8xXPffaC8hLtetCzgyxg0e4HhAFXq0HzOlNSxqB8R9vvL9K7iOcWP4mVJ9rz/O0wWr6S27aivbvk7I2YWJ1Fu+6PFxESoXELFZiqUxsS7cRUwvlisebfxNyj6RES+TK2dedfpEO5gGAbDr2nNJ5d2YzrJlJ+cYfYuHztRLqP4/nSauGKQqKqqp64klobDPsFFyYWFD1ZJiE4Y8m1ylQBFZVzAol2e5ogSGQ5un0eZmB3IQdfNpHyyWqnlEAibpB4QyJq9yy07mO+1nBnYObGxcL1kgFwFEs85lQEzVV0dfr06SGQ9NdZWm+Bo5CoqqqQqKKich5AYqTVsMwnsODhP9/ZQmK0LXDYozASJAI1kbaNcVcr2zwQL2hvQFbUMYfB3RfQQiLzJKJ1hta1i+8+ls6UORHEB94i3cM8BOYLkH8mpeICYc6KtQgG7bEYazzmRRAGvAalyTwVwpkrESm/zL/I6IEZevTIkTArZuP69U3+PHnMsmRYdVt7dRNt8YmFxHIlikeERF24oqqqkKiionKOIJGJm9Zy526+zORQC4l2SxqrTK7lOnMIXYDEZWxhBYD0z6uz6TEJ1rVOYlnEOsbkVb/VkuXrxGH1F25oJgMzaZd5dSxcOeLAjLs1DvP67EkxQYoFkftY6YY7m2XgiW007cIUE0SJj0scV260vQf9YUyK9i8+SWk8VjaxMgyw9M/hZMKv3X8x2jncM6dPFzCrUalS2PU1HtTbza2DtquJdHrLA3nzhuKRtn+T7+Ye4BN26003yYTeMEvtq69KGKe/7Nq5UwdwVVWFRBUVlbSGxIoVK4aAj5VhWJwADVZQYXVyLXgAGtct7FlIYiUSK6nsljVW2SyTVTfEBU6shRHLGM9jhQ8QSBqs4Ak6IxpQYl8iAMhNGwsiK6TcRR2swnbvoRyRrHVsIWDLbu8FjKN1oCy7B1bdZ1gFcpnzklgnzMoqeyJMcjrvpMQDnrGgkhfqk5VN3E/ZsNRGA0S0oQfvgJnfWoh7GpAjbMjZFW/RzrTOlS2bWCMv92nmDBnMtMmTzb69e809t9+eIGyM1zZoA/fffbfAoQ3jZBaO8dNBXFX1rwOJTNDnwzHeCz9IL9LEfPvMeC2CsIc7nAuhLIyPkRZBpMXz4/HukvrO4tlOzrXYhSdumXmPtKdI9WB5KJ4LeJI8JxErDps9suEpUOd3L8dDcWsDe+6WLCzfZrFGtDlyrjKplvuZvxiPPLF8HdBk2wB3o+3UUsrMNjcca7jXA6XUikdZsCwClsxRjDSlIGwPxq1bzdWXXirWvyCrKGkc8FmcVVVVFRJjFYwO7OsWtM1IUoQtQxiz3IGXD3W7yXSQsOCPPQX5GI2HMB6xpcu5EMZNNtb2H/2XFoKniHOy+ZtSwZNn9xMMErY3yp8/f4JjBpMjQCbz+9OD4LklLyyics8tx0PLlk7+7W6sMPazWbrdozNNIVE19ZVthNiiBgsqeyCldrzkKB3mfblzi3XvqM99r6qqqpAYT2EvO7uZNl4kd6BMjtA3uptpI0wbIk2/sK+chRA8XJxYFavw0W5PZGFPOhYYpqUAEgADwrF/9lSbSMLcfXsSSTyFOgXgUioYfW699dYE14Em+wHBxwSAH6tg+HA/KM6lAHmsnWBBrgt87kbb9qPHv9IcT6ZC4l9McWvzxUDHxYpq//zOeMdLjtJRDh00yOTMkkUg8dDBg/rOVFUVEpMk7GBB/wSYYc1iQ2f6LI5T44MWwaPB8WBMe2GOOh+kWENYhAccli5dWjZgBgKwsCCcsMV0Ge5higybEwOWWJOwnllhk2XmoFvQYKoNp04xNckVQI4pOHYzZqZFMUA//vjjsn8sggWS/7OxMPmizwWseKY9o9cKYMpcdqYfkTb5o+x4e/g/5SS/nCzCfHtX8PJggSN9rEm4GAFO6pJ6AwAR8sV1pne51jrqgzonfSxrDzzwgGzSzOk2FpjZyJs6IC172geWOjx3Vvg36ZOHhx9+WOqGTch5T2wMzY4aWLTYiJpFnuTPunvZBJr1AJz4AiTifcSaCsQBYkA45eJ9srCTvGDJA/pI3563TVzywP133XVXWD2xsTjthHfA2MeUKcpBHeEdQzjtBEC3dWaFbe3YCQQPIWXhXVNOewoLUE25WI9BfRLOtDfqmbZHXlmzQN7sxwxlJ//cS32Rd/LB/0mHd87exdQzC3OZpsfaAd4R7dJuvm2FdBl/Xesp5XOPG+SZbOTuCm1MIfEvpGzhY+de8jXHjy414yVXt3s/1pZNm5rV3jOiLbxRVVVVSPQLIAMcAl30Hxz1xcDIQr7b8UocPSrXCGPHBgZ6BlcWKBKPwZgpNNZtDHSwhyvzzRk8+YvVjvnUQBhnA7sbZM+aNUsAhsGdee7EsWdI+92VwBYDt91/F0sckEf+EJ5LGKexADgsTGROvj2pyhUgDPjBXQ4Ucq4y8NqtWzexEBGP9Ih7/fXXh+UZYAB6eAaLK3kmoMGuIEAD8+QBSaCWMMDPPc+Z5xGPNQCk++CDD8oJIRytBrwg9lhbykwaFqZdwOY6xwcCeMAd7waoo/zUIVDDiTK8J2CFYwp5T5QN8KeuKQt1S1rUOdPBqOOMGTPKderQ7tHLvr9sq4dl8IorrpC6I03aAAst/ZDIOyV/1CPjHx8R1AWLSzlekLxwmg15ow3YI+asEJc6ZrErzyc9FsxS9xyrZ3dpoe6ATaAXYKQc1AfrLIBM16oHfPJ+aIeUk/ZK3ogPpJMXdiWh7EAm7Yw8UI9JmUeIZRZIte0RsGUh8Pz58+V3hdgFuQqJfxG1HWFaxVNVVVVNC0hkcARssBxa0AIwGDwZJDmzGKsIgzUCMHINCwqLCS04YZHjfgAlZ86cYj3kUAXSxXoF2HC8H9f9gtWPo/N4jj2fF6umHxIRLHd2oOYDHIsmFiXctfS1DNAsqmRqD8LuHAz+FmRdoYwscrTQxolXdm4dQAA0Mi8SCxcWOneOmU0f4R4sTRyBZ49owwIG8OTLl08shOybC+S4AnxZCyiWRMYLIChPnjzyDtnWjTRJC4BjASPrAfxCGW3esNxSLsDPCiBs525iWbTnKNt2Qv6su5l3T1lYPHnVVVcJqLII1tY5QEja1Al1BIjysUA4VmA/JCIAkgUi3gHp0444WxkYf+ihh6Sd8N78cyN5J7hu7bncgDcfHVgx+YDBKoiV0q5HyJQpk1gd+ZjBOOMeC2gFOLSn0QBttF07t/aSSy6RdLBI8xFBXeEaxqLuWgcTg0Sg1VpSAWosxpSNdmbbj0Kiqqqqqmq6hkQGQ+ANl5uFRFxhDLpAzpVXXhka/BnwGCzZggsowCpo3XhYsLgfQMmaNavcV7RoUYEbFAG07JnNrrANGu5LwAErGsADDNn8uIJ3xgIL4Qy6WMvIHzAIMPE8yoBgEcK6CSRixfIvIMBlbCER2EMAC6x+wAeWJMR/NCCwZN3CdoENIDBjxgy5BlhRX8Ar4Bx0hBsuTeuaz5s3r1gRZVeJXLkEkgsUKCBlsZZEzosGzPxCGbGe8TyeyzsBAq0AgYA4wgcB5eYvewSTLq59C4lY9QinbBkyZBCgI2+AE8Lz7TnC1AkWvTvvvFNACEsZC3D8Agxb+MPNzBQs0s2cObOc3c1UALsoM2i+Ku/WztckH1gSgVjiA3bu6mwAkvJSFzly5AgEO87stvNPsZpmz55d3j9TCoBk3hXAbg+1ACQBYbv6Hdin3NEgEUiN5m6mnhUSVVVVVVXTNSQymDKPi4GTOXkMlFhvsKJg/cNyx6AOyAFu/LUDMnCJpQugYS4b1h0GbyxXQAduQOYpAk6AHy5Oe0iAK7ibASxrwcFCiQWHfFjLixVAEwsb7lXC+QtwMJ8MyGT+GWc6A0C4U3k+8AIMYVmifBYycQvj4uRZzD9jcGfwB5BwjVM3wBRWM6xPfsDk+aSNm5U6wRJmT/4iPnPbAAruI9/UoytYyMgTYA0kkwcsfuQJ8LXxcPGSb4AFCHbdpwjQRBwgkjyTN+aPAsfkC4Dj/fDucINSfq7h2sd9TZ0TZg+2IC3eHe+BOqXs5AU3LTBKnnkHtBlreeWd41Zl/ibg5grvg/dL/u2BErQP4BaXMOmQX6yKQYIV0S5Qoo1hLQWu2cmFqQFYDq0LHvc1igCz/jqnPji1DNe9BV8+Cmib5N+2bcJYgILwTlyLJPH9VmFXqFP/whX7MWAFK7hCoqqqqqqqbqatkqqC1TDSdisqaS98WDCtItJ+kAAvVuJYdwNQSFRVVVVVVUhUSVSwlDFflIUgKulDmHaBdT0SuDN9A6tqWv9OFRJVVVVVVRUSVVRUFBJVVVVVVRUSVVRUFBJVVVVVVRUSVVRUFBJVVVVVVRUSVVRUFBJVVVVVVRUSVVRUFBJVVVVVVRUSVVRUFBJVVVVVVRUSVVRUFBJVL0RlJ/7jx47J8Utp8Tw2JD165IjstK/1r6qqkKiiopIESNy1c6dpULu2GTtqVFw6m1Uc8F2rlvy9kDvd9F4P5yp/+e6802S67DJz+d/+JtqlY8dUe9bst982t950k7ni4otDzxsyYIBCgaqqQqKKikpSILFhnTqhAfTggQMp7mzuyJ5d0spz220XdKeb3uvhXOYPMM2cIYM8v3OHDqn6LA5Znz1zpsl4to0P7t9foUBVVSFRRUUlKZDY6+WXZfDMdv315j//+U+KO5sSTzwh6VWrUCFuHRiHqB86eFAOb08vnWpieUqNeoinnuv8PVW+fJpAotWHC+RPdUhMj+1UVVUhUUVFJWZI/O2338zypUtlgItHZ8MAuXD+fPPLL7/ErQOr+OSTMsCPGjEi3XSqieUpNeohnnqu81fv6adT3d3sapnixVLd3Zwe26mqqkJi6sqff/6plaDy14XE80HPR0hUVUhUVVVI/GvLyJEjzZw5c9Jl3jAAHDhw4IJ5F0wtOnXqlDZKhUTNk0KiQqKq6vkMif/973/N9OnTzdq1a8+7wfOnn34yn3/+ufx72bJl5vXXXw8L37Jlixk3blzUNIC377//PtFnHTx4UEA0Funo9a3dunVLtXr4+uuvA69v3LhRAHXVqlXy/xMnTphDhw7F5ZlA4HvvvWdeffXVsOtMlevatasZ4fW9KnGCxLenTTM9vQbUrnVr07h+ffNM1aqBrsfTp0+bPt27y9w1VqZWLlNa5jFy3b1v7Zo1cr1tq1bm2bp1JY4N27tnj+nTo4dp36aNaVSvnunfu7dcXzBvnsxNy3fXXaZ8yZJmrvdF5qY5YuhQ08N78XflzCmDL4Mw/0cnvfVWoh0fDYf7yHPeXLlMwbz3mjo1apj1XscUKQ6NcGDfvpKvvHfcIXAxecIE6dSSkqdo9RBLvcZad5E0Nd5TcuovGiSuXL5c8kPeGjzzjFm8cGEojNX31HHr556TuPPnzg18Ph340EGDTPWKFUP5HTZkiHn8wQeiQuL+ffsk/VJFipgH8uaVBV1JrdNobeLNsWOlPv3KAOFuB/Tu7Nlh17Z5A40/zs8//5zs9qOqmh4hcaz3u6hUqZKp6P1Oh3i/z/NJAMMXX3xR/g0Ivfnmm2Hhf/zxh/n999+jptG0aVOByaS4shNLK5LM9vqUXr16pVo9tGjRIsG1Tz75xDzp9X+NGzc2tWvXlmuDvP6YD4J4SCtvbKjhjeEPPvigWblyZVjY+vXrzejRo5Xu4gWJK7yG3uOll0yOG28MrW727yG3ZvVqc/vNN8sKWECBLwIG51zZssnWIu72KZ9u3Wo6tW8f2m6kVOHCobAjhw+bfl5jveqSSyQMcGjz/PPmkQIFTKtmzUIrbVEXDLp17myaNmggi2oIe7RgQfk/CghE6/SABfJw87XXmq2bN8sAyxy8a//+d8nHRq8x++Ns2bTJ5L7lFpM/Tx6JQxrDBg+WZ5PfpOQpWj3EUq+x1l0kTY33lJz6iwaJH3/0kalTs2boGcNfeSUUNmvGDNPK65SibWUDWAGm11/xDzNj6lRz/Phx+SAo8nChULyghSvUd9bMmeXZu3ftklX+Lb1OnPuBs8TqNFqbIJ+vDx9ursuYUcL4O8EbVABDG/+9d9+VMHcbqpMnT5rxb7xhrrn8cnPDlVeY0SNHhkA7Oe1HVTU9QuKOHTvMtm3bzKxZs2Sv1H3eR1qZMmXMDO93DkABFkePHhUg6O/9ZidNmiTWtw8++MC09/qvmTNnmv379wtkvvPOO+YZ76MSIALYLJxwfaHXTwEtO3fuDD2b+fflvY/YPd5HMaB2ww03SF/R2/so3uT1YXO939KRI0fMW95HP67kBt7v2J13+Nprr5maXl+x1etLP/zwQ9OkSRO5t4L3wUY6/BtIIv+UgzQBSyuUt7DX7wLHx44dM/369ZN8Tps2LYGFjOuUjf6gcuXKYlVs166d6dChg5ngfXxXq1ZNPsyB7urVqwuMUf7FixeLxa2v98HOHrEDBw4UqGrevLmM8+Sf8lJnz3kf3tQv6X/22WdmzZo1Zr43VpI+lkjeFWWjPkmbOuZa6dKlzYIFC8yvv/4ayi/9GuVaunSpQBt9VsOGDeWd8Y7ff/99s2TJElOlShWpez6M3/D6Od474Ad0ox95Y4EfvpGJEyfKe+Mvz8IQNHnyZEm3Xr16Ug+8q+FenzvP6xvf9fpW2g9lLlu2rLyPPn36SD2QN94T7xDoZ56+SoC7ealXuXYAdS0Z/JBuuiaTbFWy4+uvwzqU7Z9+KluKMLD6F7x0bNtW0ioRAEcMuIT946KLzMTx40PXaWQMrIRh+fHHK/bYYwmgITHFqkcc8u9eB4y5zh6B7vVvv/1WgBJAYtNle336lClyP+V1V60mlqdI9RBrvcZad5E03u8pufUXzd189623ShgWQH/YQ/nyBcIeQAo4EYZF0p836jwoHht68+GA9ZBFXO7WOQAvcYDXpNRptDYx1euECbv60ksTrH5++qkqEgbM+uPdmSOHAHJK24+qanqBRCxj69atE1fzeK9/sZBRp04d8WYBIAW9fgZp1KhR2JwzwBCwrOX13wiDPQIkAHOIhTrAgPs7depkFi1aFJYHIGXv3r0CXxm9Dzfcx8WKFRNg4KPrJW+cABABm9tvvz3MNQyAAV0I91uw4y/prPY+4gBHIAgwAbr8c+Xq1q1rvvjiC4FE0ie/9GG5cuUKg65d3kcr8GPLyv+/+uorc/fdd8s1XN1AE+DV1uvTEeD18ccfF9gFEkd5H58AIS5fys0zW7duLXmnn3j00UdD5SIOz+EZu3fvFpglP88++6zcA9gDpkgbb5zwWz2BZKB38ODBUncIIAp0Wlc91wE1IBTLIxZP+sTMXr8FuAHCA7yPa57lWlHpnykvcXjf/J+/FsCBUiCR/v6+++6T/JBe/vz5BSaBbdodecjr9fe4xQsVKmQOHz4sYL9hwwYlwyBIxMUYZEm0lpTa3tdJUKeCW45wLEx+11skC9or3g8rEpgM8hoWYVir4gGJWEqxlhUu9FCCDZZJCyhwr7/ofZ1xHTejex0Ljq0fOo+k5ilSPcRar7HWXTQXaTzfU3LrLxokWstfUN1GmluINY/rWD2TMycRC6ffime1qfcFTFhzr4NMKSRiybbWxDneF7m9jlUBqLOWXTa3t2E7vcEyZ5YsYfAaa/tRVU0vkAgIYqEaNmyYed77/THuIPXr1xfrEGDHwI5Y8EGwkgFeWJoY8BGsYAhgZt2fzby2DxRgWQMAcEECQK7g6gau6JOARAAUKAKorOULYAIiATxcyFYATguG5IVyIDxn+/btAl/ALYCCBROrVsuWLcOej0UOEAPcsmXLFrLCPfDAA/J7dyEReLblIs/kk/usZY1nYLnr7PWByKfexyJuWSAXQCN/PXr0CJUF8CI/H3/8sUxPwdKKALPE4T3wHO6nfwK2eLadh/jUU08leDcWEt/2xlcAlPoF5pCePXtKnREOgFJm8o1i5aQuyCPPRGgPWF+f9sYILJVWgD/yjTVwqDd+yXQy7+MbK6T9UAASyXfu3LlDYFm8eHH5S3qbz3oVgUSg8t577xVQpl5oAyrJgETrhmZOVVCngluScOb6JRc+gixeuC8Ju/Hqq+ICiXbeln9jZZtvP+TgquP6CO/H717nC7Kv18ineA06OXmKVA+x1musdZcSSEzOs5Jbf/GGROqL68zLSw4kAmFcx1rHb8FV5j9GguXkQqKUuVYtCWcuqL2G65n5n0+VKydhzBO2YeSVOcPxaD+qqunJ3Yy7mMEalyCCdatUqVICRUAPFjVgqGrVqgKGQBoQBnABcljocD8DIyzuwOUIvAADABoAhDuU57zwwgtisXQF9yLWLCDj0ksvFbckrl2eCXQAWqSDBcw/9w1XKO5X7iVdgAzwxc3K88gL+QMyARfKxL9dwV2MtQ0IA2ZJh+eQH//8xxIlSoj1DRc59wCm1A9965gxY8SyynOwCGKVw0KHZQ7wAu6Ii+UV9/OKFSskr1gUgW6gtoD3YQ0sA5pY8CgDZQLssLYBdZSXd0S9YF0EgIE73P9u+wHWsdBiubTC+wIcyS/Ai1u9S5cuYo2FOYA3yoF7mWdQF7QB3gP5coX8Ux5AEMGlT96Aw+7du8t7BR6xfGJ1pB2QHm0NSzEQDJgCkVhyAWTc3dSzQmIyIJGGa68xjy+oU2Fwsy5Jd35VrPCxxGuQhGXJlClukGh104YNMg+PgdO6K1lkYMMpty0vCwjiAQRB9ZCSeo217uINiUHPiqX+4gmJuA8ynH0+8/iSConu+7gta1ZpE0HKQpR4tAk79xB3sZ1fWLpYUXGPWws37mVrOcQKvs7r5OLRflRV/wpb4AA4yRHXdeu3emFBcucaAjH8Lt17gJGgfRCBDte6GEmwfrmWQTdtYMadJ5mS9wDksJqZvjBSeQGqpC6C4X76m8RWqCcVrOiL3JXIVoBUwA2DDpZH3OPkEfBPSv1GaxdYBxOrU8rJsyO1kwtZ/j+8M+w6PQ19NAAAAABJRU5ErkJggg=="
        },
        "xdm/easyXDM.debug.js": {
            "content_type": "application/javascript",
            "data": "LyoqCiAqIGVhc3lYRE0KICogaHR0cDovL2Vhc3l4ZG0ubmV0LwogKiBDb3B5cmlnaHQoYykgMjAwOS0yMDExLCDDmHl2aW5kIFNlYW4gS2luc2V5LCBveXZpbmRAa2luc2V5Lm5vLgogKgogKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5CiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKICogdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKICoKICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KICogYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAogKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgogKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLAogKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOCiAqIFRIRSBTT0ZUV0FSRS4KICovCihmdW5jdGlvbiAod2luZG93LCBkb2N1bWVudCwgbG9jYXRpb24sIHNldFRpbWVvdXQsIGRlY29kZVVSSUNvbXBvbmVudCwgZW5jb2RlVVJJQ29tcG9uZW50KSB7DQovKmpzbGludCBldmlsOiB0cnVlLCBicm93c2VyOiB0cnVlLCBpbW1lZDogdHJ1ZSwgcGFzc2ZhaWw6IHRydWUsIHVuZGVmOiB0cnVlLCBuZXdjYXA6IHRydWUqLw0KLypnbG9iYWwgSlNPTiwgWE1MSHR0cFJlcXVlc3QsIHdpbmRvdywgZXNjYXBlLCB1bmVzY2FwZSwgQWN0aXZlWE9iamVjdCAqLw0KLy8NCi8vIGVhc3lYRE0NCi8vIGh0dHA6Ly9lYXN5eGRtLm5ldC8NCi8vIENvcHlyaWdodChjKSAyMDA5LTIwMTEsIMOYeXZpbmQgU2VhbiBLaW5zZXksIG95dmluZEBraW5zZXkubm8uDQovLw0KLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQ0KLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwNCi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMNCi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwNCi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcw0KLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoNCi8vDQovLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbg0KLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuDQovLw0KLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1INCi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLA0KLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFDQovLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSDQovLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLA0KLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTg0KLy8gVEhFIFNPRlRXQVJFLg0KLy8NCg0KdmFyIGdsb2JhbCA9IHRoaXM7DQp2YXIgY2hhbm5lbElkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApOyAvLyByYW5kb21pemUgdGhlIGluaXRpYWwgaWQgaW4gY2FzZSBvZiBtdWx0aXBsZSBjbG9zdXJlcyBsb2FkZWQgDQp2YXIgZW1wdHlGbiA9IEZ1bmN0aW9uLnByb3RvdHlwZTsNCnZhciByZVVSSSA9IC9eKChodHRwLj86KVwvXC8oW146XC9cc10rKSg6XGQrKSopLzsgLy8gcmV0dXJucyBncm91cHMgZm9yIHByb3RvY29sICgyKSwgZG9tYWluICgzKSBhbmQgcG9ydCAoNCkgDQp2YXIgcmVQYXJlbnQgPSAvW1wtXHddK1wvXC5cLlwvLzsgLy8gbWF0Y2hlcyBhIGZvby8uLi8gZXhwcmVzc2lvbiANCnZhciByZURvdWJsZVNsYXNoID0gLyhbXjpdKVwvXC8vZzsgLy8gbWF0Y2hlcyAvLyBhbnl3aGVyZSBidXQgaW4gdGhlIHByb3RvY29sDQp2YXIgbmFtZXNwYWNlID0gIiI7IC8vIHN0b3JlcyBuYW1lc3BhY2UgdW5kZXIgd2hpY2ggZWFzeVhETSBvYmplY3QgaXMgc3RvcmVkIG9uIHRoZSBwYWdlIChlbXB0eSBpZiBvYmplY3QgaXMgZ2xvYmFsKQ0KdmFyIGVhc3lYRE0gPSB7fTsNCnZhciBfZWFzeVhETSA9IHdpbmRvdy5lYXN5WERNOyAvLyBtYXAgb3ZlciBnbG9iYWwgZWFzeVhETSBpbiBjYXNlIG9mIG92ZXJ3cml0ZQ0KdmFyIElGUkFNRV9QUkVGSVggPSAiZWFzeVhETV8iOw0KdmFyIEhBU19OQU1FX1BST1BFUlRZX0JVRzsNCnZhciB1c2VIYXNoID0gZmFsc2U7IC8vIHdoZXRoZXIgdG8gdXNlIHRoZSBoYXNoIG92ZXIgdGhlIHF1ZXJ5DQp2YXIgZmxhc2hWZXJzaW9uOyAvLyB3aWxsIGJlIHNldCBpZiB1c2luZyBmbGFzaA0KdmFyIEhBU19GTEFTSF9USFJPVFRMRURfQlVHOw0KdmFyIF90cmFjZSA9IGVtcHR5Rm47DQoNCg0KLy8gaHR0cDovL3BldGVyLm1pY2hhdXguY2EvYXJ0aWNsZXMvZmVhdHVyZS1kZXRlY3Rpb24tc3RhdGUtb2YtdGhlLWFydC1icm93c2VyLXNjcmlwdGluZw0KZnVuY3Rpb24gaXNIb3N0TWV0aG9kKG9iamVjdCwgcHJvcGVydHkpew0KICAgIHZhciB0ID0gdHlwZW9mIG9iamVjdFtwcm9wZXJ0eV07DQogICAgcmV0dXJuIHQgPT0gJ2Z1bmN0aW9uJyB8fA0KICAgICghISh0ID09ICdvYmplY3QnICYmIG9iamVjdFtwcm9wZXJ0eV0pKSB8fA0KICAgIHQgPT0gJ3Vua25vd24nOw0KfQ0KDQpmdW5jdGlvbiBpc0hvc3RPYmplY3Qob2JqZWN0LCBwcm9wZXJ0eSl7DQogICAgcmV0dXJuICEhKHR5cGVvZihvYmplY3RbcHJvcGVydHldKSA9PSAnb2JqZWN0JyAmJiBvYmplY3RbcHJvcGVydHldKTsNCn0NCg0KLy8gZW5kDQoNCi8vIGh0dHA6Ly9wZXJmZWN0aW9ua2lsbHMuY29tL2luc3RhbmNlb2YtY29uc2lkZXJlZC1oYXJtZnVsLW9yLWhvdy10by13cml0ZS1hLXJvYnVzdC1pc2FycmF5Lw0KZnVuY3Rpb24gaXNBcnJheShvKXsNCiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pID09PSAnW29iamVjdCBBcnJheV0nOw0KfQ0KDQovLyBlbmQNCmZ1bmN0aW9uIGhhc0ZsYXNoKCl7DQogICAgdHJ5IHsNCiAgICAgICAgdmFyIGFjdGl2ZVggPSBuZXcgQWN0aXZlWE9iamVjdCgiU2hvY2t3YXZlRmxhc2guU2hvY2t3YXZlRmxhc2giKTsNCiAgICAgICAgZmxhc2hWZXJzaW9uID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYWN0aXZlWC5HZXRWYXJpYWJsZSgiJHZlcnNpb24iKS5tYXRjaCgvKFxkKyksKFxkKyksKFxkKyksKFxkKykvKSwgMSk7DQogICAgICAgIEhBU19GTEFTSF9USFJPVFRMRURfQlVHID0gcGFyc2VJbnQoZmxhc2hWZXJzaW9uWzBdLCAxMCkgPiA5ICYmIHBhcnNlSW50KGZsYXNoVmVyc2lvblsxXSwgMTApID4gMDsNCiAgICAgICAgYWN0aXZlWCA9IG51bGw7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0gDQogICAgY2F0Y2ggKG5vdFN1cHBvcnRlZEV4Y2VwdGlvbikgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KfQ0KDQovKg0KICogQ3Jvc3MgQnJvd3NlciBpbXBsZW1lbnRhdGlvbiBmb3IgYWRkaW5nIGFuZCByZW1vdmluZyBldmVudCBsaXN0ZW5lcnMuDQogKi8NCnZhciBvbiwgdW47DQppZiAoaXNIb3N0TWV0aG9kKHdpbmRvdywgImFkZEV2ZW50TGlzdGVuZXIiKSkgew0KICAgIG9uID0gZnVuY3Rpb24odGFyZ2V0LCB0eXBlLCBsaXN0ZW5lcil7DQogICAgICAgIF90cmFjZSgiYWRkaW5nIGxpc3RlbmVyICIgKyB0eXBlKTsNCiAgICAgICAgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIsIGZhbHNlKTsNCiAgICB9Ow0KICAgIHVuID0gZnVuY3Rpb24odGFyZ2V0LCB0eXBlLCBsaXN0ZW5lcil7DQogICAgICAgIF90cmFjZSgicmVtb3ZpbmcgbGlzdGVuZXIgIiArIHR5cGUpOw0KICAgICAgICB0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lciwgZmFsc2UpOw0KICAgIH07DQp9DQplbHNlIGlmIChpc0hvc3RNZXRob2Qod2luZG93LCAiYXR0YWNoRXZlbnQiKSkgew0KICAgIG9uID0gZnVuY3Rpb24ob2JqZWN0LCBzRXZlbnQsIGZwTm90aWZ5KXsNCiAgICAgICAgX3RyYWNlKCJhZGRpbmcgbGlzdGVuZXIgIiArIHNFdmVudCk7DQogICAgICAgIG9iamVjdC5hdHRhY2hFdmVudCgib24iICsgc0V2ZW50LCBmcE5vdGlmeSk7DQogICAgfTsNCiAgICB1biA9IGZ1bmN0aW9uKG9iamVjdCwgc0V2ZW50LCBmcE5vdGlmeSl7DQogICAgICAgIF90cmFjZSgicmVtb3ZpbmcgbGlzdGVuZXIgIiArIHNFdmVudCk7DQogICAgICAgIG9iamVjdC5kZXRhY2hFdmVudCgib24iICsgc0V2ZW50LCBmcE5vdGlmeSk7DQogICAgfTsNCn0NCmVsc2Ugew0KICAgIHRocm93IG5ldyBFcnJvcigiQnJvd3NlciBub3Qgc3VwcG9ydGVkIik7DQp9DQoNCi8qDQogKiBDcm9zcyBCcm93c2VyIGltcGxlbWVudGF0aW9uIG9mIERPTUNvbnRlbnRMb2FkZWQuDQogKi8NCnZhciBkb21Jc1JlYWR5ID0gZmFsc2UsIGRvbVJlYWR5UXVldWUgPSBbXSwgcmVhZHlTdGF0ZTsNCmlmICgicmVhZHlTdGF0ZSIgaW4gZG9jdW1lbnQpIHsNCiAgICAvLyBJZiBicm93c2VyIGlzIFdlYktpdC1wb3dlcmVkLCBjaGVjayBmb3IgYm90aCAnbG9hZGVkJyAobGVnYWN5IGJyb3dzZXJzKSBhbmQNCiAgICAvLyAnaW50ZXJhY3RpdmUnIChIVE1MNSBzcGVjcywgcmVjZW50IFdlYktpdCBidWlsZHMpIHN0YXRlcy4NCiAgICAvLyBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NDUxMTkNCiAgICByZWFkeVN0YXRlID0gZG9jdW1lbnQucmVhZHlTdGF0ZTsNCiAgICBkb21Jc1JlYWR5ID0gcmVhZHlTdGF0ZSA9PSAiY29tcGxldGUiIHx8ICh+IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQXBwbGVXZWJLaXQvJykgJiYgKHJlYWR5U3RhdGUgPT0gImxvYWRlZCIgfHwgcmVhZHlTdGF0ZSA9PSAiaW50ZXJhY3RpdmUiKSk7DQp9DQplbHNlIHsNCiAgICAvLyBJZiByZWFkeVN0YXRlIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhlIGJyb3dzZXIsIHRoZW4gaW4gb3JkZXIgdG8gYmUgYWJsZSB0byBmaXJlIHdoZW5SZWFkeSBmdW5jdGlvbnMgYXByb3ByaWF0ZWx5DQogICAgLy8gd2hlbiBhZGRlZCBkeW5hbWljYWxseSBfYWZ0ZXJfIERPTSBsb2FkLCB3ZSBoYXZlIHRvIGRlZHVjZSB3ZXRoZXIgdGhlIERPTSBpcyByZWFkeSBvciBub3QuDQogICAgLy8gV2Ugb25seSBuZWVkIGEgYm9keSB0byBhZGQgZWxlbWVudHMgdG8sIHNvIHRoZSBleGlzdGVuY2Ugb2YgZG9jdW1lbnQuYm9keSBpcyBlbm91Z2ggZm9yIHVzLg0KICAgIGRvbUlzUmVhZHkgPSAhIWRvY3VtZW50LmJvZHk7DQp9DQoNCmZ1bmN0aW9uIGRvbV9vblJlYWR5KCl7DQogICAgaWYgKGRvbUlzUmVhZHkpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBkb21Jc1JlYWR5ID0gdHJ1ZTsNCiAgICBfdHJhY2UoImZpcmluZyBkb21fb25SZWFkeSIpOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZG9tUmVhZHlRdWV1ZS5sZW5ndGg7IGkrKykgew0KICAgICAgICBkb21SZWFkeVF1ZXVlW2ldKCk7DQogICAgfQ0KICAgIGRvbVJlYWR5UXVldWUubGVuZ3RoID0gMDsNCn0NCg0KDQppZiAoIWRvbUlzUmVhZHkpIHsNCiAgICBpZiAoaXNIb3N0TWV0aG9kKHdpbmRvdywgImFkZEV2ZW50TGlzdGVuZXIiKSkgew0KICAgICAgICBvbihkb2N1bWVudCwgIkRPTUNvbnRlbnRMb2FkZWQiLCBkb21fb25SZWFkeSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBvbihkb2N1bWVudCwgInJlYWR5c3RhdGVjaGFuZ2UiLCBmdW5jdGlvbigpew0KICAgICAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT0gImNvbXBsZXRlIikgew0KICAgICAgICAgICAgICAgIGRvbV9vblJlYWR5KCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsICYmIHdpbmRvdyA9PT0gdG9wKSB7DQogICAgICAgICAgICB2YXIgZG9TY3JvbGxDaGVjayA9IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgaWYgKGRvbUlzUmVhZHkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyBodHRwOi8vamF2YXNjcmlwdC5ud2JveC5jb20vSUVDb250ZW50TG9hZGVkLw0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCgibGVmdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGRvU2Nyb2xsQ2hlY2ssIDEpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGRvbV9vblJlYWR5KCk7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgZG9TY3JvbGxDaGVjaygpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIC8vIEEgZmFsbGJhY2sgdG8gd2luZG93Lm9ubG9hZCwgdGhhdCB3aWxsIGFsd2F5cyB3b3JrDQogICAgb24od2luZG93LCAibG9hZCIsIGRvbV9vblJlYWR5KTsNCn0NCi8qKg0KICogVGhpcyB3aWxsIGFkZCBhIGZ1bmN0aW9uIHRvIHRoZSBxdWV1ZSBvZiBmdW5jdGlvbnMgdG8gYmUgcnVuIG9uY2UgdGhlIERPTSByZWFjaGVzIGEgcmVhZHkgc3RhdGUuDQogKiBJZiBmdW5jdGlvbnMgYXJlIGFkZGVkIGFmdGVyIHRoaXMgZXZlbnQgdGhlbiB0aGV5IHdpbGwgYmUgZXhlY3V0ZWQgaW1tZWRpYXRlbHkuDQogKiBAcGFyYW0ge2Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gYWRkDQogKiBAcGFyYW0ge09iamVjdH0gc2NvcGUgQW4gb3B0aW9uYWwgc2NvcGUgZm9yIHRoZSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgd2l0aC4NCiAqLw0KZnVuY3Rpb24gd2hlblJlYWR5KGZuLCBzY29wZSl7DQogICAgaWYgKGRvbUlzUmVhZHkpIHsNCiAgICAgICAgZm4uY2FsbChzY29wZSk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgZG9tUmVhZHlRdWV1ZS5wdXNoKGZ1bmN0aW9uKCl7DQogICAgICAgIGZuLmNhbGwoc2NvcGUpOw0KICAgIH0pOw0KfQ0KDQovKioNCiAqIFJldHVybnMgYW4gaW5zdGFuY2Ugb2YgZWFzeVhETSBmcm9tIHRoZSBwYXJlbnQgd2luZG93IHdpdGgNCiAqIHJlc3BlY3QgdG8gdGhlIG5hbWVzcGFjZS4NCiAqDQogKiBAcmV0dXJuIEFuIGluc3RhbmNlIG9mIGVhc3lYRE0gKGluIHRoZSBwYXJlbnQgd2luZG93KQ0KICovDQpmdW5jdGlvbiBnZXRQYXJlbnRPYmplY3QoKXsNCiAgICB2YXIgb2JqID0gcGFyZW50Ow0KICAgIGlmIChuYW1lc3BhY2UgIT09ICIiKSB7DQogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IG5hbWVzcGFjZS5zcGxpdCgiLiIpOyBpIDwgaWkubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGlmICghb2JqKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGlpLnNsaWNlKDAsIGkgKyAxKS5qb2luKCcuJykgKyAnIGlzIG5vdCBhbiBvYmplY3QnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG9iaiA9IG9ialtpaVtpXV07DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKCFvYmogfHwgIW9iai5lYXN5WERNKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IGZpbmQgZWFzeVhETSBpbiBwYXJlbnQuJyArIG5hbWVzcGFjZSk7DQogICAgfQ0KICAgIHJldHVybiBvYmouZWFzeVhETTsNCn0NCg0KLyoqDQogKiBSZW1vdmVzIGVhc3lYRE0gdmFyaWFibGUgZnJvbSB0aGUgZ2xvYmFsIHNjb3BlLiBJdCBhbHNvIHJldHVybnMgY29udHJvbA0KICogb2YgdGhlIGVhc3lYRE0gdmFyaWFibGUgdG8gd2hhdGV2ZXIgY29kZSB1c2VkIGl0IGJlZm9yZS4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gbnMgQSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYW4gb2JqZWN0IHRoYXQgd2lsbCBob2xkDQogKiAgICAgICAgICAgICAgICAgICAgYW4gaW5zdGFuY2Ugb2YgZWFzeVhETS4NCiAqIEByZXR1cm4gQW4gaW5zdGFuY2Ugb2YgZWFzeVhETQ0KICovDQpmdW5jdGlvbiBub0NvbmZsaWN0KG5zKXsNCiAgICBpZiAodHlwZW9mIG5zICE9ICJzdHJpbmciIHx8ICFucykgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ25hbWVzcGFjZSBtdXN0IGJlIGEgbm9uLWVtcHR5IHN0cmluZycpOw0KICAgIH0NCiAgICBfdHJhY2UoIlNldHRpbmdzIG5hbWVzcGFjZSB0byAnIiArIG5zICsgIiciKTsNCiAgICANCiAgICB3aW5kb3cuZWFzeVhETSA9IF9lYXN5WERNOw0KICAgIG5hbWVzcGFjZSA9IG5zOw0KICAgIGlmIChuYW1lc3BhY2UpIHsNCiAgICAgICAgSUZSQU1FX1BSRUZJWCA9ICJlYXN5WERNXyIgKyBuYW1lc3BhY2UucmVwbGFjZSgiLiIsICJfIikgKyAiXyI7DQogICAgfQ0KICAgIHJldHVybiBlYXN5WERNOw0KfQ0KDQovKg0KICogTWV0aG9kcyBmb3Igd29ya2luZyB3aXRoIFVSTHMNCiAqLw0KLyoqDQogKiBHZXQgdGhlIGRvbWFpbiBuYW1lIGZyb20gYSB1cmwuDQogKiBAcGFyYW0ge1N0cmluZ30gdXJsIFRoZSB1cmwgdG8gZXh0cmFjdCB0aGUgZG9tYWluIGZyb20uDQogKiBAcmV0dXJuIFRoZSBkb21haW4gcGFydCBvZiB0aGUgdXJsLg0KICogQHR5cGUge1N0cmluZ30NCiAqLw0KZnVuY3Rpb24gZ2V0RG9tYWluTmFtZSh1cmwpew0KICAgIGlmICghdXJsKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigidXJsIGlzIHVuZGVmaW5lZCBvciBlbXB0eSIpOw0KICAgIH0NCiAgICByZXR1cm4gdXJsLm1hdGNoKHJlVVJJKVszXTsNCn0NCg0KLyoqDQogKiBHZXQgdGhlIHBvcnQgZm9yIGEgZ2l2ZW4gVVJMLCBvciAiIiBpZiBub25lDQogKiBAcGFyYW0ge1N0cmluZ30gdXJsIFRoZSB1cmwgdG8gZXh0cmFjdCB0aGUgcG9ydCBmcm9tLg0KICogQHJldHVybiBUaGUgcG9ydCBwYXJ0IG9mIHRoZSB1cmwuDQogKiBAdHlwZSB7U3RyaW5nfQ0KICovDQpmdW5jdGlvbiBnZXRQb3J0KHVybCl7DQogICAgaWYgKCF1cmwpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1cmwgaXMgdW5kZWZpbmVkIG9yIGVtcHR5Iik7DQogICAgfQ0KICAgIHJldHVybiB1cmwubWF0Y2gocmVVUkkpWzRdIHx8ICIiOw0KfQ0KDQovKioNCiAqIFJldHVybnMgIGEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHNjaGVtYSwgZG9tYWluIGFuZCBpZiBwcmVzZW50IHRoZSBwb3J0DQogKiBAcGFyYW0ge1N0cmluZ30gdXJsIFRoZSB1cmwgdG8gZXh0cmFjdCB0aGUgbG9jYXRpb24gZnJvbQ0KICogQHJldHVybiB7U3RyaW5nfSBUaGUgbG9jYXRpb24gcGFydCBvZiB0aGUgdXJsDQogKi8NCmZ1bmN0aW9uIGdldExvY2F0aW9uKHVybCl7DQogICAgaWYgKCF1cmwpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1cmwgaXMgdW5kZWZpbmVkIG9yIGVtcHR5Iik7DQogICAgfQ0KICAgIGlmICgvXmZpbGUvLnRlc3QodXJsKSkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBmaWxlOi8vIHByb3RvY29sIGlzIG5vdCBzdXBwb3J0ZWQiKTsNCiAgICB9DQogICAgdmFyIG0gPSB1cmwudG9Mb3dlckNhc2UoKS5tYXRjaChyZVVSSSk7DQogICAgdmFyIHByb3RvID0gbVsyXSwgZG9tYWluID0gbVszXSwgcG9ydCA9IG1bNF0gfHwgIiI7DQogICAgaWYgKChwcm90byA9PSAiaHR0cDoiICYmIHBvcnQgPT0gIjo4MCIpIHx8IChwcm90byA9PSAiaHR0cHM6IiAmJiBwb3J0ID09ICI6NDQzIikpIHsNCiAgICAgICAgcG9ydCA9ICIiOw0KICAgIH0NCiAgICByZXR1cm4gcHJvdG8gKyAiLy8iICsgZG9tYWluICsgcG9ydDsNCn0NCg0KLyoqDQogKiBSZXNvbHZlcyBhIHJlbGF0aXZlIHVybCBpbnRvIGFuIGFic29sdXRlIG9uZS4NCiAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgVGhlIHBhdGggdG8gcmVzb2x2ZS4NCiAqIEByZXR1cm4ge1N0cmluZ30gVGhlIHJlc29sdmVkIHVybC4NCiAqLw0KZnVuY3Rpb24gcmVzb2x2ZVVybCh1cmwpew0KICAgIGlmICghdXJsKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigidXJsIGlzIHVuZGVmaW5lZCBvciBlbXB0eSIpOw0KICAgIH0NCiAgICANCiAgICAvLyByZXBsYWNlIGFsbCAvLyBleGNlcHQgdGhlIG9uZSBpbiBwcm90byB3aXRoIC8NCiAgICB1cmwgPSB1cmwucmVwbGFjZShyZURvdWJsZVNsYXNoLCAiJDEvIik7DQogICAgDQogICAgLy8gSWYgdGhlIHVybCBpcyBhIHZhbGlkIHVybCB3ZSBkbyBub3RoaW5nDQogICAgaWYgKCF1cmwubWF0Y2goL14oaHR0cHx8aHR0cHMpOlwvXC8vKSkgew0KICAgICAgICAvLyBJZiB0aGlzIGlzIGEgcmVsYXRpdmUgcGF0aA0KICAgICAgICB2YXIgcGF0aCA9ICh1cmwuc3Vic3RyaW5nKDAsIDEpID09PSAiLyIpID8gIiIgOiBsb2NhdGlvbi5wYXRobmFtZTsNCiAgICAgICAgaWYgKHBhdGguc3Vic3RyaW5nKHBhdGgubGVuZ3RoIC0gMSkgIT09ICIvIikgew0KICAgICAgICAgICAgcGF0aCA9IHBhdGguc3Vic3RyaW5nKDAsIHBhdGgubGFzdEluZGV4T2YoIi8iKSArIDEpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICB1cmwgPSBsb2NhdGlvbi5wcm90b2NvbCArICIvLyIgKyBsb2NhdGlvbi5ob3N0ICsgcGF0aCArIHVybDsNCiAgICB9DQogICAgDQogICAgLy8gcmVkdWNlIGFsbCAneHl6Ly4uLycgdG8ganVzdCAnJyANCiAgICB3aGlsZSAocmVQYXJlbnQudGVzdCh1cmwpKSB7DQogICAgICAgIHVybCA9IHVybC5yZXBsYWNlKHJlUGFyZW50LCAiIik7DQogICAgfQ0KICAgIA0KICAgIF90cmFjZSgicmVzb2x2ZWQgdXJsICciICsgdXJsICsgIiciKTsNCiAgICByZXR1cm4gdXJsOw0KfQ0KDQovKioNCiAqIEFwcGVuZHMgdGhlIHBhcmFtZXRlcnMgdG8gdGhlIGdpdmVuIHVybC48YnIvPg0KICogVGhlIGJhc2UgdXJsIGNhbiBjb250YWluIGV4aXN0aW5nIHF1ZXJ5IHBhcmFtZXRlcnMuDQogKiBAcGFyYW0ge1N0cmluZ30gdXJsIFRoZSBiYXNlIHVybC4NCiAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbWV0ZXJzIFRoZSBwYXJhbWV0ZXJzIHRvIGFkZC4NCiAqIEByZXR1cm4ge1N0cmluZ30gQSBuZXcgdmFsaWQgdXJsIHdpdGggdGhlIHBhcmFtZXRlcnMgYXBwZW5kZWQuDQogKi8NCmZ1bmN0aW9uIGFwcGVuZFF1ZXJ5UGFyYW1ldGVycyh1cmwsIHBhcmFtZXRlcnMpew0KICAgIGlmICghcGFyYW1ldGVycykgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInBhcmFtZXRlcnMgaXMgdW5kZWZpbmVkIG9yIG51bGwiKTsNCiAgICB9DQogICAgDQogICAgdmFyIGhhc2ggPSAiIiwgaW5kZXhPZiA9IHVybC5pbmRleE9mKCIjIik7DQogICAgaWYgKGluZGV4T2YgIT09IC0xKSB7DQogICAgICAgIGhhc2ggPSB1cmwuc3Vic3RyaW5nKGluZGV4T2YpOw0KICAgICAgICB1cmwgPSB1cmwuc3Vic3RyaW5nKDAsIGluZGV4T2YpOw0KICAgIH0NCiAgICB2YXIgcSA9IFtdOw0KICAgIGZvciAodmFyIGtleSBpbiBwYXJhbWV0ZXJzKSB7DQogICAgICAgIGlmIChwYXJhbWV0ZXJzLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgIHEucHVzaChrZXkgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQocGFyYW1ldGVyc1trZXldKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHVybCArICh1c2VIYXNoID8gIiMiIDogKHVybC5pbmRleE9mKCI/IikgPT0gLTEgPyAiPyIgOiAiJiIpKSArIHEuam9pbigiJiIpICsgaGFzaDsNCn0NCg0KDQovLyBidWlsZCB0aGUgcXVlcnkgb2JqZWN0IGVpdGhlciBmcm9tIGxvY2F0aW9uLnF1ZXJ5LCBpZiBpdCBjb250YWlucyB0aGUgeGRtX2UgYXJndW1lbnQsIG9yIGZyb20gbG9jYXRpb24uaGFzaA0KdmFyIHF1ZXJ5ID0gKGZ1bmN0aW9uKGlucHV0KXsNCiAgICBpbnB1dCA9IGlucHV0LnN1YnN0cmluZygxKS5zcGxpdCgiJiIpOw0KICAgIHZhciBkYXRhID0ge30sIHBhaXIsIGkgPSBpbnB1dC5sZW5ndGg7DQogICAgd2hpbGUgKGktLSkgew0KICAgICAgICBwYWlyID0gaW5wdXRbaV0uc3BsaXQoIj0iKTsNCiAgICAgICAgZGF0YVtwYWlyWzBdXSA9IGRlY29kZVVSSUNvbXBvbmVudChwYWlyWzFdKTsNCiAgICB9DQogICAgcmV0dXJuIGRhdGE7DQp9KC94ZG1fZT0vLnRlc3QobG9jYXRpb24uc2VhcmNoKSA/IGxvY2F0aW9uLnNlYXJjaCA6IGxvY2F0aW9uLmhhc2gpKTsNCg0KLyoNCiAqIEhlbHBlciBtZXRob2RzDQogKi8NCi8qKg0KICogSGVscGVyIGZvciBjaGVja2luZyBpZiBhIHZhcmlhYmxlL3Byb3BlcnR5IGlzIHVuZGVmaW5lZA0KICogQHBhcmFtIHtPYmplY3R9IHYgVGhlIHZhcmlhYmxlIHRvIHRlc3QNCiAqIEByZXR1cm4ge0Jvb2xlYW59IFRydWUgaWYgdGhlIHBhc3NlZCB2YXJpYWJsZSBpcyB1bmRlZmluZWQNCiAqLw0KZnVuY3Rpb24gdW5kZWYodil7DQogICAgcmV0dXJuIHR5cGVvZiB2ID09PSAidW5kZWZpbmVkIjsNCn0NCg0KLyoqDQogKiBBIHNhZmUgaW1wbGVtZW50YXRpb24gb2YgSFRNTDUgSlNPTi4gRmVhdHVyZSB0ZXN0aW5nIGlzIHVzZWQgdG8gbWFrZSBzdXJlIHRoZSBpbXBsZW1lbnRhdGlvbiB3b3Jrcy4NCiAqIEByZXR1cm4ge0pTT059IEEgdmFsaWQgSlNPTiBjb25mb3JtaW5nIG9iamVjdCwgb3IgbnVsbCBpZiBub3QgZm91bmQuDQogKi8NCnZhciBnZXRKU09OID0gZnVuY3Rpb24oKXsNCiAgICB2YXIgY2FjaGVkID0ge307DQogICAgdmFyIG9iaiA9IHsNCiAgICAgICAgYTogWzEsIDIsIDNdDQogICAgfSwganNvbiA9ICJ7XCJhXCI6WzEsMiwzXX0iOw0KICAgIA0KICAgIGlmICh0eXBlb2YgSlNPTiAhPSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgSlNPTi5zdHJpbmdpZnkgPT09ICJmdW5jdGlvbiIgJiYgSlNPTi5zdHJpbmdpZnkob2JqKS5yZXBsYWNlKCgvXHMvZyksICIiKSA9PT0ganNvbikgew0KICAgICAgICAvLyB0aGlzIGlzIGEgd29ya2luZyBKU09OIGluc3RhbmNlDQogICAgICAgIHJldHVybiBKU09OOw0KICAgIH0NCiAgICBpZiAoT2JqZWN0LnRvSlNPTikgew0KICAgICAgICBpZiAoT2JqZWN0LnRvSlNPTihvYmopLnJlcGxhY2UoKC9ccy9nKSwgIiIpID09PSBqc29uKSB7DQogICAgICAgICAgICAvLyB0aGlzIGlzIGEgd29ya2luZyBzdHJpbmdpZnkgbWV0aG9kDQogICAgICAgICAgICBjYWNoZWQuc3RyaW5naWZ5ID0gT2JqZWN0LnRvSlNPTjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICBpZiAodHlwZW9mIFN0cmluZy5wcm90b3R5cGUuZXZhbEpTT04gPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgb2JqID0ganNvbi5ldmFsSlNPTigpOw0KICAgICAgICBpZiAob2JqLmEgJiYgb2JqLmEubGVuZ3RoID09PSAzICYmIG9iai5hWzJdID09PSAzKSB7DQogICAgICAgICAgICAvLyB0aGlzIGlzIGEgd29ya2luZyBwYXJzZSBtZXRob2QgICAgICAgICAgIA0KICAgICAgICAgICAgY2FjaGVkLnBhcnNlID0gZnVuY3Rpb24oc3RyKXsNCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyLmV2YWxKU09OKCk7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIGlmIChjYWNoZWQuc3RyaW5naWZ5ICYmIGNhY2hlZC5wYXJzZSkgew0KICAgICAgICAvLyBPbmx5IG1lbW9pemUgdGhlIHJlc3VsdCBpZiB3ZSBoYXZlIHZhbGlkIGluc3RhbmNlDQogICAgICAgIGdldEpTT04gPSBmdW5jdGlvbigpew0KICAgICAgICAgICAgcmV0dXJuIGNhY2hlZDsNCiAgICAgICAgfTsNCiAgICAgICAgcmV0dXJuIGNhY2hlZDsNCiAgICB9DQogICAgcmV0dXJuIG51bGw7DQp9Ow0KDQovKioNCiAqIEFwcGxpZXMgcHJvcGVydGllcyBmcm9tIHRoZSBzb3VyY2Ugb2JqZWN0IHRvIHRoZSB0YXJnZXQgb2JqZWN0Ljxici8+DQogKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRoZSB0YXJnZXQgb2YgdGhlIHByb3BlcnRpZXMuDQogKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBzb3VyY2Ugb2YgdGhlIHByb3BlcnRpZXMuDQogKiBAcGFyYW0ge0Jvb2xlYW59IG5vT3ZlcndyaXRlIFNldCB0byBUcnVlIHRvIG9ubHkgc2V0IG5vbi1leGlzdGluZyBwcm9wZXJ0aWVzLg0KICovDQpmdW5jdGlvbiBhcHBseShkZXN0aW5hdGlvbiwgc291cmNlLCBub092ZXJ3cml0ZSl7DQogICAgdmFyIG1lbWJlcjsNCiAgICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkgew0KICAgICAgICBpZiAoc291cmNlLmhhc093blByb3BlcnR5KHByb3ApKSB7DQogICAgICAgICAgICBpZiAocHJvcCBpbiBkZXN0aW5hdGlvbikgew0KICAgICAgICAgICAgICAgIG1lbWJlciA9IHNvdXJjZVtwcm9wXTsNCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lbWJlciA9PT0gIm9iamVjdCIpIHsNCiAgICAgICAgICAgICAgICAgICAgYXBwbHkoZGVzdGluYXRpb25bcHJvcF0sIG1lbWJlciwgbm9PdmVyd3JpdGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmICghbm9PdmVyd3JpdGUpIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25bcHJvcF0gPSBzb3VyY2VbcHJvcF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgZGVzdGluYXRpb25bcHJvcF0gPSBzb3VyY2VbcHJvcF07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGRlc3RpbmF0aW9uOw0KfQ0KDQovLyBUaGlzIHRlc3RzIGZvciB0aGUgYnVnIGluIElFIHdoZXJlIHNldHRpbmcgdGhlIFtuYW1lXSBwcm9wZXJ0eSB1c2luZyBqYXZhc2NyaXB0IGNhdXNlcyB0aGUgdmFsdWUgdG8gYmUgcmVkaXJlY3RlZCBpbnRvIFtzdWJtaXROYW1lXS4NCmZ1bmN0aW9uIHRlc3RGb3JOYW1lUHJvcGVydHlCdWcoKXsNCiAgICB2YXIgZm9ybSA9IGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZm9ybSIpKSwgaW5wdXQgPSBmb3JtLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0IikpOw0KICAgIGlucHV0Lm5hbWUgPSBJRlJBTUVfUFJFRklYICsgIlRFU1QiICsgY2hhbm5lbElkOyAvLyBhcHBlbmQgY2hhbm5lbElkIGluIG9yZGVyIHRvIGF2b2lkIGNhY2hpbmcgaXNzdWVzDQogICAgSEFTX05BTUVfUFJPUEVSVFlfQlVHID0gaW5wdXQgIT09IGZvcm0uZWxlbWVudHNbaW5wdXQubmFtZV07DQogICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChmb3JtKTsNCiAgICBfdHJhY2UoIkhBU19OQU1FX1BST1BFUlRZX0JVRzogIiArIEhBU19OQU1FX1BST1BFUlRZX0JVRyk7DQp9DQoNCi8qKg0KICogQ3JlYXRlcyBhIGZyYW1lIGFuZCBhcHBlbmRzIGl0IHRvIHRoZSBET00uDQogKiBAcGFyYW0gY29uZmlnIHtvYmplY3R9IFRoaXMgb2JqZWN0IGNhbiBoYXZlIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllcw0KICogPHVsPg0KICogPGxpPiB7b2JqZWN0fSBwcm9wIFRoZSBwcm9wZXJ0aWVzIHRoYXQgc2hvdWxkIGJlIHNldCBvbiB0aGUgZnJhbWUuIFRoaXMgc2hvdWxkIGluY2x1ZGUgdGhlICdzcmMnIHByb3BlcnR5LjwvbGk+DQogKiA8bGk+IHtvYmplY3R9IGF0dHIgVGhlIGF0dHJpYnV0ZXMgdGhhdCBzaG91bGQgYmUgc2V0IG9uIHRoZSBmcmFtZS48L2xpPg0KICogPGxpPiB7RE9NRWxlbWVudH0gY29udGFpbmVyIEl0cyBwYXJlbnQgZWxlbWVudCAoT3B0aW9uYWwpLjwvbGk+DQogKiA8bGk+IHtmdW5jdGlvbn0gb25Mb2FkIEEgbWV0aG9kIHRoYXQgc2hvdWxkIGJlIGNhbGxlZCB3aXRoIHRoZSBmcmFtZXMgY29udGVudFdpbmRvdyBhcyBhcmd1bWVudCB3aGVuIHRoZSBmcmFtZSBpcyBmdWxseSBsb2FkZWQuIChPcHRpb25hbCk8L2xpPg0KICogPC91bD4NCiAqIEByZXR1cm4gVGhlIGZyYW1lcyBET01FbGVtZW50DQogKiBAdHlwZSBET01FbGVtZW50DQogKi8NCmZ1bmN0aW9uIGNyZWF0ZUZyYW1lKGNvbmZpZyl7DQogICAgX3RyYWNlKCJjcmVhdGluZyBmcmFtZTogIiArIGNvbmZpZy5wcm9wcy5zcmMpOw0KICAgIGlmICh1bmRlZihIQVNfTkFNRV9QUk9QRVJUWV9CVUcpKSB7DQogICAgICAgIHRlc3RGb3JOYW1lUHJvcGVydHlCdWcoKTsNCiAgICB9DQogICAgdmFyIGZyYW1lOw0KICAgIC8vIFRoaXMgaXMgdG8gd29yayBhcm91bmQgdGhlIHByb2JsZW1zIGluIElFNi83IHdpdGggc2V0dGluZyB0aGUgbmFtZSBwcm9wZXJ0eS4gDQogICAgLy8gSW50ZXJuYWxseSB0aGlzIGlzIHNldCBhcyAnc3VibWl0TmFtZScgaW5zdGVhZCB3aGVuIHVzaW5nICdpZnJhbWUubmFtZSA9IC4uLicNCiAgICAvLyBUaGlzIGlzIG5vdCByZXF1aXJlZCBieSBlYXN5WERNIGl0c2VsZiwgYnV0IGlzIHRvIGZhY2lsaXRhdGUgb3RoZXIgdXNlIGNhc2VzIA0KICAgIGlmIChIQVNfTkFNRV9QUk9QRVJUWV9CVUcpIHsNCiAgICAgICAgZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCI8aWZyYW1lIG5hbWU9XCIiICsgY29uZmlnLnByb3BzLm5hbWUgKyAiXCIvPiIpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJJRlJBTUUiKTsNCiAgICAgICAgZnJhbWUubmFtZSA9IGNvbmZpZy5wcm9wcy5uYW1lOw0KICAgIH0NCiAgICANCiAgICBmcmFtZS5pZCA9IGZyYW1lLm5hbWUgPSBjb25maWcucHJvcHMubmFtZTsNCiAgICBkZWxldGUgY29uZmlnLnByb3BzLm5hbWU7DQogICAgDQogICAgaWYgKGNvbmZpZy5vbkxvYWQpIHsNCiAgICAgICAgb24oZnJhbWUsICJsb2FkIiwgY29uZmlnLm9uTG9hZCk7DQogICAgfQ0KICAgIA0KICAgIGlmICh0eXBlb2YgY29uZmlnLmNvbnRhaW5lciA9PSAic3RyaW5nIikgew0KICAgICAgICBjb25maWcuY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29uZmlnLmNvbnRhaW5lcik7DQogICAgfQ0KICAgIA0KICAgIGlmICghY29uZmlnLmNvbnRhaW5lcikgew0KICAgICAgICAvLyBUaGlzIG5lZWRzIHRvIGJlIGhpZGRlbiBsaWtlIHRoaXMsIHNpbXBseSBzZXR0aW5nIGRpc3BsYXk6bm9uZSBhbmQgdGhlIGxpa2Ugd2lsbCBjYXVzZSBmYWlsdXJlcyBpbiBzb21lIGJyb3dzZXJzLg0KICAgICAgICBhcHBseShmcmFtZS5zdHlsZSwgew0KICAgICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsDQogICAgICAgICAgICB0b3A6ICItMjAwMHB4Ig0KICAgICAgICB9KTsNCiAgICAgICAgY29uZmlnLmNvbnRhaW5lciA9IGRvY3VtZW50LmJvZHk7DQogICAgfQ0KICAgIA0KICAgIC8vIEhBQ0sgZm9yIHNvbWUgcmVhc29uLCBJRSBuZWVkcyB0aGUgc291cmNlIHNldA0KICAgIC8vIGFmdGVyIHRoZSBmcmFtZSBoYXMgYmVlbiBhcHBlbmRlZCBpbnRvIHRoZSBET00NCiAgICAvLyBzbyByZW1vdmUgdGhlIHNyYywgYW5kIHNldCBpdCBhZnRlcndhcmRzDQogICAgdmFyIHNyYyA9IGNvbmZpZy5wcm9wcy5zcmM7DQogICAgZGVsZXRlIGNvbmZpZy5wcm9wcy5zcmM7DQogICAgDQogICAgLy8gdHJhbnNmZXIgcHJvcGVydGllcyB0byB0aGUgZnJhbWUNCiAgICBhcHBseShmcmFtZSwgY29uZmlnLnByb3BzKTsNCiAgICANCiAgICBmcmFtZS5ib3JkZXIgPSBmcmFtZS5mcmFtZUJvcmRlciA9IDA7DQogICAgZnJhbWUuYWxsb3dUcmFuc3BhcmVuY3kgPSB0cnVlOw0KICAgIGNvbmZpZy5jb250YWluZXIuYXBwZW5kQ2hpbGQoZnJhbWUpOw0KICAgIA0KICAgIC8vIEhBQ0sgc2VlIGFib3ZlDQogICAgZnJhbWUuc3JjID0gc3JjOw0KICAgIGNvbmZpZy5wcm9wcy5zcmMgPSBzcmM7DQogICAgDQogICAgcmV0dXJuIGZyYW1lOw0KfQ0KDQovKioNCiAqIENoZWNrIHdoZXRoZXIgYSBkb21haW4gaXMgYWxsb3dlZCB1c2luZyBhbiBBY2Nlc3MgQ29udHJvbCBMaXN0Lg0KICogVGhlIEFDTCBjYW4gY29udGFpbiAqIGFuZCA/IGFzIHdpbGRjYXJkcywgb3IgY2FuIGJlIHJlZ3VsYXIgZXhwcmVzc2lvbnMuDQogKiBJZiByZWd1bGFyIGV4cHJlc3Npb25zIHRoZXkgbmVlZCB0byBiZWdpbiB3aXRoIF4gYW5kIGVuZCB3aXRoICQuDQogKiBAcGFyYW0ge0FycmF5L1N0cmluZ30gYWNsIFRoZSBsaXN0IG9mIGFsbG93ZWQgZG9tYWlucw0KICogQHBhcmFtIHtTdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIHRvIHRlc3QuDQogKiBAcmV0dXJuIHtCb29sZWFufSBUcnVlIGlmIHRoZSBkb21haW4gaXMgYWxsb3dlZCwgZmFsc2UgaWYgbm90Lg0KICovDQpmdW5jdGlvbiBjaGVja0FjbChhY2wsIGRvbWFpbil7DQogICAgLy8gbm9ybWFsaXplIGludG8gYW4gYXJyYXkNCiAgICBpZiAodHlwZW9mIGFjbCA9PSAic3RyaW5nIikgew0KICAgICAgICBhY2wgPSBbYWNsXTsNCiAgICB9DQogICAgdmFyIHJlLCBpID0gYWNsLmxlbmd0aDsNCiAgICB3aGlsZSAoaS0tKSB7DQogICAgICAgIHJlID0gYWNsW2ldOw0KICAgICAgICByZSA9IG5ldyBSZWdFeHAocmUuc3Vic3RyKDAsIDEpID09ICJeIiA/IHJlIDogKCJeIiArIHJlLnJlcGxhY2UoLyhcKikvZywgIi4kMSIpLnJlcGxhY2UoL1w/L2csICIuIikgKyAiJCIpKTsNCiAgICAgICAgaWYgKHJlLnRlc3QoZG9tYWluKSkgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGZhbHNlOw0KfQ0KDQovKg0KICogRnVuY3Rpb25zIHJlbGF0ZWQgdG8gc3RhY2tzDQogKi8NCi8qKg0KICogUHJlcGFyZXMgYW4gYXJyYXkgb2Ygc3RhY2stZWxlbWVudHMgc3VpdGFibGUgZm9yIHRoZSBjdXJyZW50IGNvbmZpZ3VyYXRpb24NCiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgVGhlIFRyYW5zcG9ydHMgY29uZmlndXJhdGlvbi4gU2VlIGVhc3lYRE0uU29ja2V0IGZvciBtb3JlLg0KICogQHJldHVybiB7QXJyYXl9IEFuIGFycmF5IG9mIHN0YWNrLWVsZW1lbnRzIHdpdGggdGhlIFRyYW5zcG9ydEVsZW1lbnQgYXQgaW5kZXggMC4NCiAqLw0KZnVuY3Rpb24gcHJlcGFyZVRyYW5zcG9ydFN0YWNrKGNvbmZpZyl7DQogICAgdmFyIHByb3RvY29sID0gY29uZmlnLnByb3RvY29sLCBzdGFja0VsczsNCiAgICBjb25maWcuaXNIb3N0ID0gY29uZmlnLmlzSG9zdCB8fCB1bmRlZihxdWVyeS54ZG1fcCk7DQogICAgdXNlSGFzaCA9IGNvbmZpZy5oYXNoIHx8IGZhbHNlOw0KICAgIF90cmFjZSgicHJlcGFyaW5nIHRyYW5zcG9ydCBzdGFjayIpOw0KICAgIA0KICAgIGlmICghY29uZmlnLnByb3BzKSB7DQogICAgICAgIGNvbmZpZy5wcm9wcyA9IHt9Ow0KICAgIH0NCiAgICBpZiAoIWNvbmZpZy5pc0hvc3QpIHsNCiAgICAgICAgX3RyYWNlKCJ1c2luZyBwYXJhbWV0ZXJzIGZyb20gcXVlcnkiKTsNCiAgICAgICAgY29uZmlnLmNoYW5uZWwgPSBxdWVyeS54ZG1fYzsNCiAgICAgICAgY29uZmlnLnNlY3JldCA9IHF1ZXJ5LnhkbV9zOw0KICAgICAgICBjb25maWcucmVtb3RlID0gcXVlcnkueGRtX2U7DQogICAgICAgIHByb3RvY29sID0gcXVlcnkueGRtX3A7DQogICAgICAgIGlmIChjb25maWcuYWNsICYmICFjaGVja0FjbChjb25maWcuYWNsLCBjb25maWcucmVtb3RlKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBY2Nlc3MgZGVuaWVkIGZvciAiICsgY29uZmlnLnJlbW90ZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGNvbmZpZy5yZW1vdGUgPSByZXNvbHZlVXJsKGNvbmZpZy5yZW1vdGUpOw0KICAgICAgICBjb25maWcuY2hhbm5lbCA9IGNvbmZpZy5jaGFubmVsIHx8ICJkZWZhdWx0IiArIGNoYW5uZWxJZCsrOw0KICAgICAgICBjb25maWcuc2VjcmV0ID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDIpOw0KICAgICAgICBpZiAodW5kZWYocHJvdG9jb2wpKSB7DQogICAgICAgICAgICBpZiAoZ2V0TG9jYXRpb24obG9jYXRpb24uaHJlZikgPT0gZ2V0TG9jYXRpb24oY29uZmlnLnJlbW90ZSkpIHsNCiAgICAgICAgICAgICAgICAvKg0KICAgICAgICAgICAgICAgICAqIEJvdGggZG9jdW1lbnRzIGhhcyB0aGUgc2FtZSBvcmlnaW4sIGxldHMgdXNlIGRpcmVjdCBhY2Nlc3MuDQogICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgcHJvdG9jb2wgPSAiNCI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChpc0hvc3RNZXRob2Qod2luZG93LCAicG9zdE1lc3NhZ2UiKSB8fCBpc0hvc3RNZXRob2QoZG9jdW1lbnQsICJwb3N0TWVzc2FnZSIpKSB7DQogICAgICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICAgICAgKiBUaGlzIGlzIHN1cHBvcnRlZCBpbiBJRTgrLCBGaXJlZm94IDMrLCBPcGVyYSA5KywgQ2hyb21lIDIrIGFuZCBTYWZhcmkgNCsNCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICBwcm90b2NvbCA9ICIxIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKGNvbmZpZy5zd2YgJiYgaXNIb3N0TWV0aG9kKHdpbmRvdywgIkFjdGl2ZVhPYmplY3QiKSAmJiBoYXNGbGFzaCgpKSB7DQogICAgICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICAgICAgKiBUaGUgRmxhc2ggdHJhbnNwb3J0IHN1cGVyc2VlZGVzIHRoZSBOaXhUcmFuc3BvcnQgYXMgdGhlIE5peFRyYW5zcG9ydCBoYXMgYmVlbiBibG9ja2VkIGJ5IE1TDQogICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgcHJvdG9jb2wgPSAiNiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChuYXZpZ2F0b3IucHJvZHVjdCA9PT0gIkdlY2tvIiAmJiAiZnJhbWVFbGVtZW50IiBpbiB3aW5kb3cgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdXZWJLaXQnKSA9PSAtMSkgew0KICAgICAgICAgICAgICAgIC8qDQogICAgICAgICAgICAgICAgICogVGhpcyBpcyBzdXBwb3J0ZWQgaW4gR2Vja28gKEZpcmVmb3ggMSspDQogICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgcHJvdG9jb2wgPSAiNSI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjb25maWcucmVtb3RlSGVscGVyKSB7DQogICAgICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICAgICAgKiBUaGlzIGlzIHN1cHBvcnRlZCBpbiBhbGwgYnJvd3NlcnMgdGhhdCByZXRhaW5zIHRoZSB2YWx1ZSBvZiB3aW5kb3cubmFtZSB3aGVuDQogICAgICAgICAgICAgICAgICogbmF2aWdhdGluZyBmcm9tIG9uZSBkb21haW4gdG8gYW5vdGhlciwgYW5kIHdoZXJlIHBhcmVudC5mcmFtZXNbZm9vXSBjYW4gYmUgdXNlZA0KICAgICAgICAgICAgICAgICAqIHRvIGdldCBhY2Nlc3MgdG8gYSBmcmFtZSBmcm9tIHRoZSBzYW1lIGRvbWFpbg0KICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgIGNvbmZpZy5yZW1vdGVIZWxwZXIgPSByZXNvbHZlVXJsKGNvbmZpZy5yZW1vdGVIZWxwZXIpOw0KICAgICAgICAgICAgICAgIHByb3RvY29sID0gIjIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICAgICAgKiBUaGlzIGlzIHN1cHBvcnRlZCBpbiBhbGwgYnJvd3NlcnMgd2hlcmUgW3dpbmRvd10ubG9jYXRpb24gaXMgd3JpdGFibGUgZm9yIGFsbA0KICAgICAgICAgICAgICAgICAqIFRoZSByZXNpemUgZXZlbnQgd2lsbCBiZSB1c2VkIGlmIHJlc2l6ZSBpcyBzdXBwb3J0ZWQgYW5kIHRoZSBpZnJhbWUgaXMgbm90IHB1dA0KICAgICAgICAgICAgICAgICAqIGludG8gYSBjb250YWluZXIsIGVsc2UgcG9sbGluZyB3aWxsIGJlIHVzZWQuDQogICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgcHJvdG9jb2wgPSAiMCI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfdHJhY2UoInNlbGVjdGluZyBwcm90b2NvbDogIiArIHByb3RvY29sKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIF90cmFjZSgidXNpbmcgcHJvdG9jb2w6ICIgKyBwcm90b2NvbCk7DQogICAgICAgIH0NCiAgICB9DQogICAgY29uZmlnLnByb3RvY29sID0gcHJvdG9jb2w7IC8vIGZvciBjb25kaXRpb25hbCBicmFuY2hpbmcNCiAgICBzd2l0Y2ggKHByb3RvY29sKSB7DQogICAgICAgIGNhc2UgIjAiOi8vIDAgPSBIYXNoVHJhbnNwb3J0DQogICAgICAgICAgICBhcHBseShjb25maWcsIHsNCiAgICAgICAgICAgICAgICBpbnRlcnZhbDogMTAwLA0KICAgICAgICAgICAgICAgIGRlbGF5OiAyMDAwLA0KICAgICAgICAgICAgICAgIHVzZVJlc2l6ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICB1c2VQYXJlbnQ6IGZhbHNlLA0KICAgICAgICAgICAgICAgIHVzZVBvbGxpbmc6IGZhbHNlDQogICAgICAgICAgICB9LCB0cnVlKTsNCiAgICAgICAgICAgIGlmIChjb25maWcuaXNIb3N0KSB7DQogICAgICAgICAgICAgICAgaWYgKCFjb25maWcubG9jYWwpIHsNCiAgICAgICAgICAgICAgICAgICAgX3RyYWNlKCJsb29raW5nIGZvciBpbWFnZSB0byB1c2UgYXMgbG9jYWwiKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgbm8gbG9jYWwgaXMgc2V0IHRoZW4gd2UgbmVlZCB0byBmaW5kIGFuIGltYWdlIGhvc3RlZCBvbiB0aGUgY3VycmVudCBkb21haW4NCiAgICAgICAgICAgICAgICAgICAgdmFyIGRvbWFpbiA9IGxvY2F0aW9uLnByb3RvY29sICsgIi8vIiArIGxvY2F0aW9uLmhvc3QsIGltYWdlcyA9IGRvY3VtZW50LmJvZHkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImltZyIpLCBpbWFnZTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBpbWFnZXMubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZSA9IGltYWdlc1tpXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbWFnZS5zcmMuc3Vic3RyaW5nKDAsIGRvbWFpbi5sZW5ndGgpID09PSBkb21haW4pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcubG9jYWwgPSBpbWFnZS5zcmM7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25maWcubG9jYWwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIF90cmFjZSgibm8gaW1hZ2UgZm91bmQsIGRlZmF1bHRpbmcgdG8gdXNpbmcgdGhlIHdpbmRvdyIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgbm8gbG9jYWwgd2FzIHNldCwgYW5kIHdlIGFyZSB1bmFibGUgdG8gZmluZCBhIHN1aXRhYmxlIGZpbGUsIHRoZW4gd2UgcmVzb3J0IHRvIHVzaW5nIHRoZSBjdXJyZW50IHdpbmRvdyANCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5sb2NhbCA9IHdpbmRvdzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB2YXIgcGFyYW1ldGVycyA9IHsNCiAgICAgICAgICAgICAgICAgICAgeGRtX2M6IGNvbmZpZy5jaGFubmVsLA0KICAgICAgICAgICAgICAgICAgICB4ZG1fcDogMA0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5sb2NhbCA9PT0gd2luZG93KSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFdlIGFyZSB1c2luZyB0aGUgY3VycmVudCB3aW5kb3cgdG8gbGlzdGVuIHRvDQogICAgICAgICAgICAgICAgICAgIGNvbmZpZy51c2VQb2xsaW5nID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgY29uZmlnLnVzZVBhcmVudCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5sb2NhbCA9IGxvY2F0aW9uLnByb3RvY29sICsgIi8vIiArIGxvY2F0aW9uLmhvc3QgKyBsb2NhdGlvbi5wYXRobmFtZSArIGxvY2F0aW9uLnNlYXJjaDsNCiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVycy54ZG1fZSA9IGNvbmZpZy5sb2NhbDsNCiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVycy54ZG1fcGEgPSAxOyAvLyB1c2UgcGFyZW50DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzLnhkbV9lID0gcmVzb2x2ZVVybChjb25maWcubG9jYWwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmNvbnRhaW5lcikgew0KICAgICAgICAgICAgICAgICAgICBjb25maWcudXNlUmVzaXplID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMueGRtX3BvID0gMTsgLy8gdXNlIHBvbGxpbmcNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29uZmlnLnJlbW90ZSA9IGFwcGVuZFF1ZXJ5UGFyYW1ldGVycyhjb25maWcucmVtb3RlLCBwYXJhbWV0ZXJzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGFwcGx5KGNvbmZpZywgew0KICAgICAgICAgICAgICAgICAgICBjaGFubmVsOiBxdWVyeS54ZG1fYywNCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlOiBxdWVyeS54ZG1fZSwNCiAgICAgICAgICAgICAgICAgICAgdXNlUGFyZW50OiAhdW5kZWYocXVlcnkueGRtX3BhKSwNCiAgICAgICAgICAgICAgICAgICAgdXNlUG9sbGluZzogIXVuZGVmKHF1ZXJ5LnhkbV9wbyksDQogICAgICAgICAgICAgICAgICAgIHVzZVJlc2l6ZTogY29uZmlnLnVzZVBhcmVudCA/IGZhbHNlIDogY29uZmlnLnVzZVJlc2l6ZQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3RhY2tFbHMgPSBbbmV3IGVhc3lYRE0uc3RhY2suSGFzaFRyYW5zcG9ydChjb25maWcpLCBuZXcgZWFzeVhETS5zdGFjay5SZWxpYWJsZUJlaGF2aW9yKHt9KSwgbmV3IGVhc3lYRE0uc3RhY2suUXVldWVCZWhhdmlvcih7DQogICAgICAgICAgICAgICAgZW5jb2RlOiB0cnVlLA0KICAgICAgICAgICAgICAgIG1heExlbmd0aDogNDAwMCAtIGNvbmZpZy5yZW1vdGUubGVuZ3RoDQogICAgICAgICAgICB9KSwgbmV3IGVhc3lYRE0uc3RhY2suVmVyaWZ5QmVoYXZpb3Ioew0KICAgICAgICAgICAgICAgIGluaXRpYXRlOiBjb25maWcuaXNIb3N0DQogICAgICAgICAgICB9KV07DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiMSI6DQogICAgICAgICAgICBzdGFja0VscyA9IFtuZXcgZWFzeVhETS5zdGFjay5Qb3N0TWVzc2FnZVRyYW5zcG9ydChjb25maWcpXTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICIyIjoNCiAgICAgICAgICAgIHN0YWNrRWxzID0gW25ldyBlYXN5WERNLnN0YWNrLk5hbWVUcmFuc3BvcnQoY29uZmlnKSwgbmV3IGVhc3lYRE0uc3RhY2suUXVldWVCZWhhdmlvcigpLCBuZXcgZWFzeVhETS5zdGFjay5WZXJpZnlCZWhhdmlvcih7DQogICAgICAgICAgICAgICAgaW5pdGlhdGU6IGNvbmZpZy5pc0hvc3QNCiAgICAgICAgICAgIH0pXTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICIzIjoNCiAgICAgICAgICAgIHN0YWNrRWxzID0gW25ldyBlYXN5WERNLnN0YWNrLk5peFRyYW5zcG9ydChjb25maWcpXTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICI0IjoNCiAgICAgICAgICAgIHN0YWNrRWxzID0gW25ldyBlYXN5WERNLnN0YWNrLlNhbWVPcmlnaW5UcmFuc3BvcnQoY29uZmlnKV07DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiNSI6DQogICAgICAgICAgICBzdGFja0VscyA9IFtuZXcgZWFzeVhETS5zdGFjay5GcmFtZUVsZW1lbnRUcmFuc3BvcnQoY29uZmlnKV07DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiNiI6DQogICAgICAgICAgICBpZiAoIWZsYXNoVmVyc2lvbikgew0KICAgICAgICAgICAgICAgIGhhc0ZsYXNoKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzdGFja0VscyA9IFtuZXcgZWFzeVhETS5zdGFjay5GbGFzaFRyYW5zcG9ydChjb25maWcpXTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgIH0NCiAgICAvLyB0aGlzIGJlaGF2aW9yIGlzIHJlc3BvbnNpYmxlIGZvciBidWZmZXJpbmcgb3V0Z29pbmcgbWVzc2FnZXMsIGFuZCBmb3IgcGVyZm9ybWluZyBsYXp5IGluaXRpYWxpemF0aW9uDQogICAgc3RhY2tFbHMucHVzaChuZXcgZWFzeVhETS5zdGFjay5RdWV1ZUJlaGF2aW9yKHsNCiAgICAgICAgbGF6eTogY29uZmlnLmxhenksDQogICAgICAgIHJlbW92ZTogdHJ1ZQ0KICAgIH0pKTsNCiAgICByZXR1cm4gc3RhY2tFbHM7DQp9DQoNCi8qKg0KICogQ2hhaW5zIGFsbCB0aGUgc2VwYXJhdGUgc3RhY2sgZWxlbWVudHMgaW50byBhIHNpbmdsZSB1c2FibGUgc3RhY2suPGJyLz4NCiAqIElmIGFuIGVsZW1lbnQgaXMgbWlzc2luZyBhIG5lY2Vzc2FyeSBtZXRob2QgdGhlbiBpdCB3aWxsIGhhdmUgYSBwYXNzLXRocm91Z2ggbWV0aG9kIGFwcGxpZWQuDQogKiBAcGFyYW0ge0FycmF5fSBzdGFja0VsZW1lbnRzIEFuIGFycmF5IG9mIHN0YWNrIGVsZW1lbnRzIHRvIGJlIGxpbmtlZC4NCiAqIEByZXR1cm4ge2Vhc3lYRE0uc3RhY2suU3RhY2tFbGVtZW50fSBUaGUgbGFzdCBlbGVtZW50IGluIHRoZSBjaGFpbi4NCiAqLw0KZnVuY3Rpb24gY2hhaW5TdGFjayhzdGFja0VsZW1lbnRzKXsNCiAgICB2YXIgc3RhY2tFbCwgZGVmYXVsdHMgPSB7DQogICAgICAgIGluY29taW5nOiBmdW5jdGlvbihtZXNzYWdlLCBvcmlnaW4pew0KICAgICAgICAgICAgdGhpcy51cC5pbmNvbWluZyhtZXNzYWdlLCBvcmlnaW4pOw0KICAgICAgICB9LA0KICAgICAgICBvdXRnb2luZzogZnVuY3Rpb24obWVzc2FnZSwgcmVjaXBpZW50KXsNCiAgICAgICAgICAgIHRoaXMuZG93bi5vdXRnb2luZyhtZXNzYWdlLCByZWNpcGllbnQpOw0KICAgICAgICB9LA0KICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3VjY2Vzcyl7DQogICAgICAgICAgICB0aGlzLnVwLmNhbGxiYWNrKHN1Y2Nlc3MpOw0KICAgICAgICB9LA0KICAgICAgICBpbml0OiBmdW5jdGlvbigpew0KICAgICAgICAgICAgdGhpcy5kb3duLmluaXQoKTsNCiAgICAgICAgfSwNCiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIHRoaXMuZG93bi5kZXN0cm95KCk7DQogICAgICAgIH0NCiAgICB9Ow0KICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzdGFja0VsZW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgIHN0YWNrRWwgPSBzdGFja0VsZW1lbnRzW2ldOw0KICAgICAgICBhcHBseShzdGFja0VsLCBkZWZhdWx0cywgdHJ1ZSk7DQogICAgICAgIGlmIChpICE9PSAwKSB7DQogICAgICAgICAgICBzdGFja0VsLmRvd24gPSBzdGFja0VsZW1lbnRzW2kgLSAxXTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaSAhPT0gbGVuIC0gMSkgew0KICAgICAgICAgICAgc3RhY2tFbC51cCA9IHN0YWNrRWxlbWVudHNbaSArIDFdOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBzdGFja0VsOw0KfQ0KDQovKioNCiAqIFRoaXMgd2lsbCByZW1vdmUgYSBzdGFja2VsZW1lbnQgZnJvbSBpdHMgc3RhY2sgd2hpbGUgbGVhdmluZyB0aGUgc3RhY2sgZnVuY3Rpb25hbC4NCiAqIEBwYXJhbSB7T2JqZWN0fSBlbGVtZW50IFRoZSBlbG1lbnQgdG8gcmVtb3ZlIGZyb20gdGhlIHN0YWNrLg0KICovDQpmdW5jdGlvbiByZW1vdmVGcm9tU3RhY2soZWxlbWVudCl7DQogICAgZWxlbWVudC51cC5kb3duID0gZWxlbWVudC5kb3duOw0KICAgIGVsZW1lbnQuZG93bi51cCA9IGVsZW1lbnQudXA7DQogICAgZWxlbWVudC51cCA9IGVsZW1lbnQuZG93biA9IG51bGw7DQp9DQoNCi8qDQogKiBFeHBvcnQgdGhlIG1haW4gb2JqZWN0IGFuZCBhbnkgb3RoZXIgbWV0aG9kcyBhcHBsaWNhYmxlDQogKi8NCi8qKiANCiAqIEBjbGFzcyBlYXN5WERNDQogKiBBIGphdmFzY3JpcHQgbGlicmFyeSBwcm92aWRpbmcgY3Jvc3MtYnJvd3NlciwgY3Jvc3MtZG9tYWluIG1lc3NhZ2luZy9SUEMuDQogKiBAdmVyc2lvbiAyLjQuMTUuMTE4DQogKiBAc2luZ2xldG9uDQogKi8NCmFwcGx5KGVhc3lYRE0sIHsNCiAgICAvKioNCiAgICAgKiBUaGUgdmVyc2lvbiBvZiB0aGUgbGlicmFyeQ0KICAgICAqIEB0eXBlIHtzdHJpbmd9DQogICAgICovDQogICAgdmVyc2lvbjogIjIuNC4xNS4xMTgiLA0KICAgIC8qKg0KICAgICAqIFRoaXMgaXMgYSBtYXAgY29udGFpbmluZyBhbGwgdGhlIHF1ZXJ5IHBhcmFtZXRlcnMgcGFzc2VkIHRvIHRoZSBkb2N1bWVudC4NCiAgICAgKiBBbGwgdGhlIHZhbHVlcyBoYXMgYmVlbiBkZWNvZGVkIHVzaW5nIGRlY29kZVVSSUNvbXBvbmVudC4NCiAgICAgKiBAdHlwZSB7b2JqZWN0fQ0KICAgICAqLw0KICAgIHF1ZXJ5OiBxdWVyeSwNCiAgICAvKioNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqLw0KICAgIHN0YWNrOiB7fSwNCiAgICAvKioNCiAgICAgKiBBcHBsaWVzIHByb3BlcnRpZXMgZnJvbSB0aGUgc291cmNlIG9iamVjdCB0byB0aGUgdGFyZ2V0IG9iamVjdC48YnIvPg0KICAgICAqIEBwYXJhbSB7b2JqZWN0fSB0YXJnZXQgVGhlIHRhcmdldCBvZiB0aGUgcHJvcGVydGllcy4NCiAgICAgKiBAcGFyYW0ge29iamVjdH0gc291cmNlIFRoZSBzb3VyY2Ugb2YgdGhlIHByb3BlcnRpZXMuDQogICAgICogQHBhcmFtIHtib29sZWFufSBub092ZXJ3cml0ZSBTZXQgdG8gVHJ1ZSB0byBvbmx5IHNldCBub24tZXhpc3RpbmcgcHJvcGVydGllcy4NCiAgICAgKi8NCiAgICBhcHBseTogYXBwbHksDQogICAgDQogICAgLyoqDQogICAgICogQSBzYWZlIGltcGxlbWVudGF0aW9uIG9mIEhUTUw1IEpTT04uIEZlYXR1cmUgdGVzdGluZyBpcyB1c2VkIHRvIG1ha2Ugc3VyZSB0aGUgaW1wbGVtZW50YXRpb24gd29ya3MuDQogICAgICogQHJldHVybiB7SlNPTn0gQSB2YWxpZCBKU09OIGNvbmZvcm1pbmcgb2JqZWN0LCBvciBudWxsIGlmIG5vdCBmb3VuZC4NCiAgICAgKi8NCiAgICBnZXRKU09OT2JqZWN0OiBnZXRKU09OLA0KICAgIC8qKg0KICAgICAqIFRoaXMgd2lsbCBhZGQgYSBmdW5jdGlvbiB0byB0aGUgcXVldWUgb2YgZnVuY3Rpb25zIHRvIGJlIHJ1biBvbmNlIHRoZSBET00gcmVhY2hlcyBhIHJlYWR5IHN0YXRlLg0KICAgICAqIElmIGZ1bmN0aW9ucyBhcmUgYWRkZWQgYWZ0ZXIgdGhpcyBldmVudCB0aGVuIHRoZXkgd2lsbCBiZSBleGVjdXRlZCBpbW1lZGlhdGVseS4NCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gYWRkDQogICAgICogQHBhcmFtIHtvYmplY3R9IHNjb3BlIEFuIG9wdGlvbmFsIHNjb3BlIGZvciB0aGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIHdpdGguDQogICAgICovDQogICAgd2hlblJlYWR5OiB3aGVuUmVhZHksDQogICAgLyoqDQogICAgICogUmVtb3ZlcyBlYXN5WERNIHZhcmlhYmxlIGZyb20gdGhlIGdsb2JhbCBzY29wZS4gSXQgYWxzbyByZXR1cm5zIGNvbnRyb2wNCiAgICAgKiBvZiB0aGUgZWFzeVhETSB2YXJpYWJsZSB0byB3aGF0ZXZlciBjb2RlIHVzZWQgaXQgYmVmb3JlLg0KICAgICAqDQogICAgICogQHBhcmFtIHtTdHJpbmd9IG5zIEEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIG9iamVjdCB0aGF0IHdpbGwgaG9sZA0KICAgICAqICAgICAgICAgICAgICAgICAgICBhbiBpbnN0YW5jZSBvZiBlYXN5WERNLg0KICAgICAqIEByZXR1cm4gQW4gaW5zdGFuY2Ugb2YgZWFzeVhETQ0KICAgICAqLw0KICAgIG5vQ29uZmxpY3Q6IG5vQ29uZmxpY3QNCn0pOw0KDQovLyBFeHBvc2UgaGVscGVyIGZ1bmN0aW9ucyBzbyB3ZSBjYW4gdGVzdCB0aGVtDQphcHBseShlYXN5WERNLCB7DQogICAgY2hlY2tBY2w6IGNoZWNrQWNsLA0KICAgIGdldERvbWFpbk5hbWU6IGdldERvbWFpbk5hbWUsDQogICAgZ2V0TG9jYXRpb246IGdldExvY2F0aW9uLA0KICAgIGFwcGVuZFF1ZXJ5UGFyYW1ldGVyczogYXBwZW5kUXVlcnlQYXJhbWV0ZXJzDQp9KTsNCi8qanNsaW50IGV2aWw6IHRydWUsIGJyb3dzZXI6IHRydWUsIGltbWVkOiB0cnVlLCBwYXNzZmFpbDogdHJ1ZSwgdW5kZWY6IHRydWUsIG5ld2NhcDogdHJ1ZSovDQovKmdsb2JhbCBjb25zb2xlLCBfRmlyZWJ1Z0NvbW1hbmRMaW5lLCAgZWFzeVhETSwgd2luZG93LCBlc2NhcGUsIHVuZXNjYXBlLCBpc0hvc3RPYmplY3QsIHVuZGVmLCBfdHJhY2UsIGRvbUlzUmVhZHksIGVtcHR5Rm4sIG5hbWVzcGFjZSAqLw0KLy8NCi8vIGVhc3lYRE0NCi8vIGh0dHA6Ly9lYXN5eGRtLm5ldC8NCi8vIENvcHlyaWdodChjKSAyMDA5LTIwMTEsIMOYeXZpbmQgU2VhbiBLaW5zZXksIG95dmluZEBraW5zZXkubm8uDQovLw0KLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQ0KLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwNCi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMNCi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwNCi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcw0KLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoNCi8vDQovLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbg0KLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuDQovLw0KLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1INCi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLA0KLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFDQovLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSDQovLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLA0KLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTg0KLy8gVEhFIFNPRlRXQVJFLg0KLy8NCg0KdmFyIGRlYnVnID0gew0KICAgIF9kZWZlcnJlZDogW10sDQogICAgZmx1c2g6IGZ1bmN0aW9uKCl7DQogICAgICAgIHRoaXMudHJhY2UoIi4uLiBkZWZlcnJlZCBtZXNzYWdlcyAuLi4iKTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX2RlZmVycmVkLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgICAgICB0aGlzLnRyYWNlKHRoaXMuX2RlZmVycmVkW2ldKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLl9kZWZlcnJlZC5sZW5ndGggPSAwOw0KICAgICAgICB0aGlzLnRyYWNlKCIuLi4gZW5kIG9mIGRlZmVycmVkIG1lc3NhZ2VzIC4uLiIpOw0KICAgIH0sDQogICAgZ2V0VGltZTogZnVuY3Rpb24oKXsNCiAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpLCBoID0gZC5nZXRIb3VycygpICsgIiIsIG0gPSBkLmdldE1pbnV0ZXMoKSArICIiLCBzID0gZC5nZXRTZWNvbmRzKCkgKyAiIiwgbXMgPSBkLmdldE1pbGxpc2Vjb25kcygpICsgIiIsIHplcm9zID0gIjAwMCI7DQogICAgICAgIGlmIChoLmxlbmd0aCA9PSAxKSB7DQogICAgICAgICAgICBoID0gIjAiICsgaDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobS5sZW5ndGggPT0gMSkgew0KICAgICAgICAgICAgbSA9ICIwIiArIG07DQogICAgICAgIH0NCiAgICAgICAgaWYgKHMubGVuZ3RoID09IDEpIHsNCiAgICAgICAgICAgIHMgPSAiMCIgKyBzOw0KICAgICAgICB9DQogICAgICAgIG1zID0gemVyb3Muc3Vic3RyaW5nKG1zLmxlbmd0aCkgKyBtczsNCiAgICAgICAgcmV0dXJuIGggKyAiOiIgKyBtICsgIjoiICsgcyArICIuIiArIG1zOw0KICAgIH0sDQogICAgLyoqDQogICAgICogTG9ncyB0aGUgbWVzc2FnZSB0byBjb25zb2xlLmxvZyBpZiBhdmFpbGFibGUNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbXNnIFRoZSBtZXNzYWdlIHRvIGxvZw0KICAgICAqLw0KICAgIGxvZzogZnVuY3Rpb24obXNnKXsNCiAgICAgICAgLy8gVXNlcyBtZW1vaXppbmcgdG8gY2FjaGUgdGhlIGltcGxlbWVudGF0aW9uDQogICAgICAgIGlmICghaXNIb3N0T2JqZWN0KHdpbmRvdywgImNvbnNvbGUiKSB8fCB1bmRlZihjb25zb2xlLmxvZykpIHsNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogU2V0cyBsb2cgdG8gYmUgYW4gZW1wdHkgZnVuY3Rpb24gc2luY2Ugd2UgaGF2ZSBubyBvdXRwdXQgYXZhaWxhYmxlDQogICAgICAgICAgICAgKiBAaWdub3JlDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIHRoaXMubG9nID0gZW1wdHlGbjsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogU2V0cyBsb2cgdG8gYmUgYSB3cmFwcGVyIGFyb3VuZCBjb25zb2xlLmxvZw0KICAgICAgICAgICAgICogQGlnbm9yZQ0KICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG1zZw0KICAgICAgICAgICAgICovDQogICAgICAgICAgICB0aGlzLmxvZyA9IGZ1bmN0aW9uKG1zZyl7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2cobG9jYXRpb24uaG9zdCArIChuYW1lc3BhY2UgPyAiOiIgKyBuYW1lc3BhY2UgOiAiIikgKyAiIC0gIiArIHRoaXMuZ2V0VGltZSgpICsgIjogIiArIG1zZyk7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICAgIHRoaXMubG9nKG1zZyk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBXaWxsIHRyeSB0byB0cmFjZSB0aGUgZ2l2ZW4gbWVzc2FnZSBlaXRoZXIgdG8gYSBET01FbGVtZW50IHdpdGggdGhlIGlkICJsb2ciLA0KICAgICAqIG9yIGJ5IHVzaW5nIGNvbnNvbGUuaW5mby4NCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbXNnIFRoZSBtZXNzYWdlIHRvIHRyYWNlDQogICAgICovDQogICAgdHJhY2U6IGZ1bmN0aW9uKG1zZyl7DQogICAgICAgIC8vIFVzZXMgbWVtb2l6aW5nIHRvIGNhY2hlIHRoZSBpbXBsZW1lbnRhdGlvbg0KICAgICAgICBpZiAoIWRvbUlzUmVhZHkpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLl9kZWZlcnJlZC5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICBlYXN5WERNLndoZW5SZWFkeShkZWJ1Zy5mbHVzaCwgZGVidWcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5fZGVmZXJyZWQucHVzaChtc2cpOw0KICAgICAgICAgICAgdGhpcy5sb2cobXNnKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2ciKTsNCiAgICAgICAgICAgIC8vIGlzIHRoZXJlIGEgbG9nIGVsZW1lbnQgcHJlc2VudD8NCiAgICAgICAgICAgIGlmIChlbCkgew0KICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAqIFNldHMgdHJhY2UgdG8gYmUgYSBmdW5jdGlvbiB0aGF0IG91dHB1dHMgdGhlIG1lc3NhZ2VzIHRvIHRoZSBET01FbGVtZW50IHdpdGggaWQgImxvZyINCiAgICAgICAgICAgICAgICAgKiBAaWdub3JlDQogICAgICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG1zZw0KICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgIHRoaXMudHJhY2UgPSBmdW5jdGlvbihtc2cpew0KICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikpLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxvY2F0aW9uLmhvc3QgKyAobmFtZXNwYWNlID8gIjoiICsgbmFtZXNwYWNlIDogIiIpICsgIiAtICIgKyB0aGlzLmdldFRpbWUoKSArICI6IiArIG1zZykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWwuc2Nyb2xsVG9wID0gZWwuc2Nyb2xsSGVpZ2h0Ow0KICAgICAgICAgICAgICAgICAgICB9IA0KICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy9JbiBjYXNlIHdlIGFyZSB1bmxvYWRpbmcNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChpc0hvc3RPYmplY3Qod2luZG93LCAiY29uc29sZSIpICYmICF1bmRlZihjb25zb2xlLmluZm8pKSB7DQogICAgICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgICAgICogU2V0cyB0cmFjZSB0byBiZSBhIHdyYXBwZXIgYXJvdW5kIGNvbnNvbGUuaW5mbw0KICAgICAgICAgICAgICAgICAqIEBpZ25vcmUNCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbXNnDQogICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgdGhpcy50cmFjZSA9IGZ1bmN0aW9uKG1zZyl7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhsb2NhdGlvbi5ob3N0ICsgKG5hbWVzcGFjZSA/ICI6IiArIG5hbWVzcGFjZSA6ICIiKSArICIgLSAiICsgdGhpcy5nZXRUaW1lKCkgKyAiOiIgKyBtc2cpOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAgICAgKiBDcmVhdGUgbG9nIHdpbmRvdw0KICAgICAgICAgICAgICAgICAqIEBpZ25vcmUNCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICB2YXIgZG9tYWluID0gbG9jYXRpb24uaG9zdCwgd2luZG93bmFtZSA9IGRvbWFpbi5yZXBsYWNlKC9cWy0uOl0vZywgIiIpICsgImVhc3l4ZG1fbG9nIiwgbG9nV2luOw0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGxvZ1dpbiA9IHdpbmRvdy5vcGVuKCIiLCB3aW5kb3duYW1lLCAid2lkdGg9ODAwLGhlaWdodD0yMDAsc3RhdHVzPTAsbmF2aWdhdGlvbj0wLHNjcm9sbGJhcnM9MSIpOw0KICAgICAgICAgICAgICAgIH0gDQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGxvZ1dpbikgew0KICAgICAgICAgICAgICAgICAgICB2YXIgZG9jID0gbG9nV2luLmRvY3VtZW50Ow0KICAgICAgICAgICAgICAgICAgICBlbCA9IGRvYy5nZXRFbGVtZW50QnlJZCgibG9nIik7DQogICAgICAgICAgICAgICAgICAgIGlmICghZWwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRvYy53cml0ZSgiPGh0bWw+PGhlYWQ+PHRpdGxlPmVhc3lYRE0gbG9nICIgKyBkb21haW4gKyAiPC90aXRsZT48L2hlYWQ+Iik7DQogICAgICAgICAgICAgICAgICAgICAgICBkb2Mud3JpdGUoIjxib2R5PjxkaXYgaWQ9XCJsb2dcIj48L2Rpdj48L2JvZHk+PC9odG1sPiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZG9jLmNsb3NlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbCA9IGRvYy5nZXRFbGVtZW50QnlJZCgibG9nIik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFjZSA9IGZ1bmN0aW9uKG1zZyl7DQogICAgICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKGRvYy5jcmVhdGVFbGVtZW50KCJkaXYiKSkuYXBwZW5kQ2hpbGQoZG9jLmNyZWF0ZVRleHROb2RlKGxvY2F0aW9uLmhvc3QgKyAobmFtZXNwYWNlID8gIjoiICsgbmFtZXNwYWNlIDogIiIpICsgIiAtICIgKyB0aGlzLmdldFRpbWUoKSArICI6IiArIG1zZykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLnNjcm9sbFRvcCA9IGVsLnNjcm9sbEhlaWdodDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gDQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vSW4gY2FzZSB3ZSBhcmUgdW5sb2FkaW5nDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIHRoaXMudHJhY2UoIi0tLS0gbmV3IGxvZ2dlciBhdCAiICsgbG9jYXRpb24uaHJlZik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICghZWwpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgYXJlIHVuYWJsZSB0byB1c2UgYW55IGxvZ2dpbmcNCiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFjZSA9IGVtcHR5Rm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy50cmFjZShtc2cpOw0KICAgICAgICB9DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgbWV0aG9kIHVzYWJsZSBmb3IgdHJhY2luZy4NCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBUaGUgbmFtZSB0aGUgbWVzc2FnZXMgc2hvdWxkIGJlIG1hcmtlZCB3aXRoDQogICAgICogQHJldHVybiB7RnVuY3Rpb259IEEgZnVuY3Rpb24gdGhhdCBhY2NlcHRzIGEgc2luZ2xlIHN0cmluZyBhcyBhcmd1bWVudC4NCiAgICAgKi8NCiAgICBnZXRUcmFjZXI6IGZ1bmN0aW9uKG5hbWUpew0KICAgICAgICByZXR1cm4gZnVuY3Rpb24obXNnKXsNCiAgICAgICAgICAgIGRlYnVnLnRyYWNlKG5hbWUgKyAiOiAiICsgbXNnKTsNCiAgICAgICAgfTsNCiAgICB9DQp9Ow0KZGVidWcubG9nKCJlYXN5WERNIHByZXNlbnQgb24gJyIgKyBsb2NhdGlvbi5ocmVmKTsNCmVhc3lYRE0uRGVidWcgPSBkZWJ1ZzsNCl90cmFjZSA9IGRlYnVnLmdldFRyYWNlcigie1ByaXZhdGV9Iik7DQovKmpzbGludCBldmlsOiB0cnVlLCBicm93c2VyOiB0cnVlLCBpbW1lZDogdHJ1ZSwgcGFzc2ZhaWw6IHRydWUsIHVuZGVmOiB0cnVlLCBuZXdjYXA6IHRydWUqLw0KLypnbG9iYWwgZWFzeVhETSwgd2luZG93LCBlc2NhcGUsIHVuZXNjYXBlLCBpc0hvc3RPYmplY3QsIGlzSG9zdE1ldGhvZCwgdW4sIG9uLCBjcmVhdGVGcmFtZSwgZGVidWcgKi8NCi8vDQovLyBlYXN5WERNDQovLyBodHRwOi8vZWFzeXhkbS5uZXQvDQovLyBDb3B5cmlnaHQoYykgMjAwOS0yMDExLCDDmHl2aW5kIFNlYW4gS2luc2V5LCBveXZpbmRAa2luc2V5Lm5vLg0KLy8NCi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQovLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQovLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQovLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQovLw0KLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4NCi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KLy8NCi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQovLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4NCi8vIFRIRSBTT0ZUV0FSRS4NCi8vDQoNCi8qKiANCiAqIEBjbGFzcyBlYXN5WERNLkRvbUhlbHBlcg0KICogQ29udGFpbnMgbWV0aG9kcyBmb3IgZGVhbGluZyB3aXRoIHRoZSBET00NCiAqIEBzaW5nbGV0b24NCiAqLw0KZWFzeVhETS5Eb21IZWxwZXIgPSB7DQogICAgLyoqDQogICAgICogUHJvdmlkZXMgYSBjb25zaXN0ZW50IGludGVyZmFjZSBmb3IgYWRkaW5nIGV2ZW50aGFuZGxlcnMNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRoZSB0YXJnZXQgdG8gYWRkIHRoZSBldmVudCB0bw0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBuYW1lIG9mIHRoZSBldmVudA0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGxpc3RlbmVyIFRoZSBsaXN0ZW5lcg0KICAgICAqLw0KICAgIG9uOiBvbiwNCiAgICAvKioNCiAgICAgKiBQcm92aWRlcyBhIGNvbnNpc3RlbnQgaW50ZXJmYWNlIGZvciByZW1vdmluZyBldmVudGhhbmRsZXJzDQogICAgICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgdGFyZ2V0IHRvIHJlbW92ZSB0aGUgZXZlbnQgZnJvbQ0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBuYW1lIG9mIHRoZSBldmVudA0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGxpc3RlbmVyIFRoZSBsaXN0ZW5lcg0KICAgICAqLw0KICAgIHVuOiB1biwNCiAgICAvKioNCiAgICAgKiBDaGVja3MgZm9yIHRoZSBwcmVzZW5jZSBvZiB0aGUgSlNPTiBvYmplY3QuDQogICAgICogSWYgaXQgaXMgbm90IHByZXNlbnQgaXQgd2lsbCB1c2UgdGhlIHN1cHBsaWVkIHBhdGggdG8gbG9hZCB0aGUgSlNPTjIgbGlicmFyeS4NCiAgICAgKiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgaW4gdGhlIGRvY3VtZW50cyBoZWFkIHJpZ2h0IGFmdGVyIHRoZSBlYXN5WERNIHNjcmlwdCB0YWcuDQogICAgICogaHR0cDovL2pzb24ub3JnL2pzb24yLmpzDQogICAgICogQHBhcmFtIHtTdHJpbmd9IHBhdGggQSB2YWxpZCBwYXRoIHRvIGpzb24yLmpzDQogICAgICovDQogICAgcmVxdWlyZXNKU09OOiBmdW5jdGlvbihwYXRoKXsNCiAgICAgICAgaWYgKCFpc0hvc3RPYmplY3Qod2luZG93LCAiSlNPTiIpKSB7DQogICAgICAgICAgICBkZWJ1Zy5sb2coImxvYWRpbmcgZXh0ZXJuYWwgSlNPTiIpOw0KICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBlbmNvZGUgdGhlIDwgaW4gb3JkZXIgdG8gYXZvaWQgYW4gaWxsZWdhbCB0b2tlbiBlcnJvcg0KICAgICAgICAgICAgLy8gd2hlbiB0aGUgc2NyaXB0IGlzIGlubGluZWQgaW4gYSBkb2N1bWVudC4NCiAgICAgICAgICAgIGRvY3VtZW50LndyaXRlKCc8JyArICdzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9IicgKyBwYXRoICsgJyI+PCcgKyAnL3NjcmlwdD4nKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGRlYnVnLmxvZygibmF0aXZlIEpTT04gZm91bmQiKTsNCiAgICAgICAgfQ0KICAgIH0NCn07DQovKmpzbGludCBldmlsOiB0cnVlLCBicm93c2VyOiB0cnVlLCBpbW1lZDogdHJ1ZSwgcGFzc2ZhaWw6IHRydWUsIHVuZGVmOiB0cnVlLCBuZXdjYXA6IHRydWUqLw0KLypnbG9iYWwgZWFzeVhETSwgd2luZG93LCBlc2NhcGUsIHVuZXNjYXBlLCBkZWJ1ZyAqLw0KLy8NCi8vIGVhc3lYRE0NCi8vIGh0dHA6Ly9lYXN5eGRtLm5ldC8NCi8vIENvcHlyaWdodChjKSAyMDA5LTIwMTEsIMOYeXZpbmQgU2VhbiBLaW5zZXksIG95dmluZEBraW5zZXkubm8uDQovLw0KLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQ0KLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwNCi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMNCi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwNCi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcw0KLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoNCi8vDQovLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbg0KLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuDQovLw0KLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1INCi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLA0KLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFDQovLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSDQovLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLA0KLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTg0KLy8gVEhFIFNPRlRXQVJFLg0KLy8NCg0KKGZ1bmN0aW9uKCl7DQogICAgLy8gVGhlIG1hcCBjb250YWluaW5nIHRoZSBzdG9yZWQgZnVuY3Rpb25zDQogICAgdmFyIF9tYXAgPSB7fTsNCiAgICANCiAgICAvKioNCiAgICAgKiBAY2xhc3MgZWFzeVhETS5Gbg0KICAgICAqIFRoaXMgY29udGFpbnMgbWV0aG9kcyByZWxhdGVkIHRvIGZ1bmN0aW9uIGhhbmRsaW5nLCBzdWNoIGFzIHN0b3JpbmcgY2FsbGJhY2tzLg0KICAgICAqIEBzaW5nbGV0b24NCiAgICAgKiBAbmFtZXNwYWNlIGVhc3lYRE0NCiAgICAgKi8NCiAgICBlYXN5WERNLkZuID0gew0KICAgICAgICAvKioNCiAgICAgICAgICogU3RvcmVzIGEgZnVuY3Rpb24gdXNpbmcgdGhlIGdpdmVuIG5hbWUgZm9yIHJlZmVyZW5jZQ0KICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBUaGUgbmFtZSB0aGF0IHRoZSBmdW5jdGlvbiBzaG91bGQgYmUgcmVmZXJyZWQgYnkNCiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGZ1bmN0aW9uIHRvIHN0b3JlDQogICAgICAgICAqIEBuYW1lc3BhY2UgZWFzeVhETS5mbg0KICAgICAgICAgKi8NCiAgICAgICAgc2V0OiBmdW5jdGlvbihuYW1lLCBmbil7DQogICAgICAgICAgICB0aGlzLl90cmFjZSgic3RvcmluZyBmdW5jdGlvbiAiICsgbmFtZSk7DQogICAgICAgICAgICBfbWFwW25hbWVdID0gZm47DQogICAgICAgIH0sDQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIGZ1bmN0aW9uIHJlZmVycmVkIHRvIGJ5IHRoZSBnaXZlbiBuYW1lDQogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBmdW5jdGlvbiB0byByZXRyaWV2ZQ0KICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGRlbCBJZiB0aGUgZnVuY3Rpb24gc2hvdWxkIGJlIGRlbGV0ZWQgYWZ0ZXIgcmV0cmlldmFsDQogICAgICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufSBUaGUgc3RvcmVkIGZ1bmN0aW9uDQogICAgICAgICAqIEBuYW1lc3BhY2UgZWFzeVhETS5mbg0KICAgICAgICAgKi8NCiAgICAgICAgZ2V0OiBmdW5jdGlvbihuYW1lLCBkZWwpew0KICAgICAgICAgICAgdGhpcy5fdHJhY2UoInJldHJpZXZpbmcgZnVuY3Rpb24gIiArIG5hbWUpOw0KICAgICAgICAgICAgdmFyIGZuID0gX21hcFtuYW1lXTsNCiAgICAgICAgICAgIGlmICghZm4pIHsNCiAgICAgICAgICAgICAgICB0aGlzLl90cmFjZShuYW1lICsgIiBub3QgZm91bmQiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKGRlbCkgew0KICAgICAgICAgICAgICAgIGRlbGV0ZSBfbWFwW25hbWVdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZuOw0KICAgICAgICB9DQogICAgfTsNCiAgICANCiAgICBlYXN5WERNLkZuLl90cmFjZSA9IGRlYnVnLmdldFRyYWNlcigiZWFzeVhETS5GbiIpOw0KfSgpKTsNCi8qanNsaW50IGV2aWw6IHRydWUsIGJyb3dzZXI6IHRydWUsIGltbWVkOiB0cnVlLCBwYXNzZmFpbDogdHJ1ZSwgdW5kZWY6IHRydWUsIG5ld2NhcDogdHJ1ZSovDQovKmdsb2JhbCBlYXN5WERNLCB3aW5kb3csIGVzY2FwZSwgdW5lc2NhcGUsIGNoYWluU3RhY2ssIHByZXBhcmVUcmFuc3BvcnRTdGFjaywgZ2V0TG9jYXRpb24sIGRlYnVnICovDQovLw0KLy8gZWFzeVhETQ0KLy8gaHR0cDovL2Vhc3l4ZG0ubmV0Lw0KLy8gQ29weXJpZ2h0KGMpIDIwMDktMjAxMSwgw5h5dmluZCBTZWFuIEtpbnNleSwgb3l2aW5kQGtpbnNleS5uby4NCi8vDQovLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5DQovLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbA0KLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cw0KLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbA0KLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzDQovLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOg0KLy8NCi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluDQovLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCi8vDQovLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUg0KLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksDQovLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUNCi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVINCi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sDQovLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElODQovLyBUSEUgU09GVFdBUkUuDQovLw0KDQovKioNCiAqIEBjbGFzcyBlYXN5WERNLlNvY2tldA0KICogVGhpcyBjbGFzcyBjcmVhdGVzIGEgdHJhbnNwb3J0IGNoYW5uZWwgYmV0d2VlbiB0d28gZG9tYWlucyB0aGF0IGlzIHVzYWJsZSBmb3Igc2VuZGluZyBhbmQgcmVjZWl2aW5nIHN0cmluZy1iYXNlZCBtZXNzYWdlcy48YnIvPg0KICogVGhlIGNoYW5uZWwgaXMgcmVsaWFibGUsIHN1cHBvcnRzIHF1ZXVlaW5nLCBhbmQgZW5zdXJlcyB0aGF0IHRoZSBtZXNzYWdlIG9yaWdpbmF0ZXMgZnJvbSB0aGUgZXhwZWN0ZWQgZG9tYWluLjxici8+DQogKiBJbnRlcm5hbGx5IGRpZmZlcmVudCBzdGFja3Mgd2lsbCBiZSB1c2VkIGRlcGVuZGluZyBvbiB0aGUgYnJvd3NlcnMgZmVhdHVyZXMgYW5kIHRoZSBhdmFpbGFibGUgcGFyYW1ldGVycy4NCiAqIDxoMj5Ib3cgdG8gc2V0IHVwPC9oMj4NCiAqIFNldHRpbmcgdXAgdGhlIHByb3ZpZGVyOg0KICogPHByZT48Y29kZT4NCiAqIHZhciBzb2NrZXQgPSBuZXcgZWFzeVhETS5Tb2NrZXQoew0KICogJm5ic3A7IGxvY2FsOiAibmFtZS5odG1sIiwNCiAqICZuYnNwOyBvblJlYWR5OiBmdW5jdGlvbigpew0KICogJm5ic3A7ICZuYnNwOyAmIzQ3OyYjNDc7IHlvdSBuZWVkIHRvIHdhaXQgZm9yIHRoZSBvblJlYWR5IGNhbGxiYWNrIGJlZm9yZSB1c2luZyB0aGUgc29ja2V0DQogKiAmbmJzcDsgJm5ic3A7IHNvY2tldC5wb3N0TWVzc2FnZSgiZm9vLW1lc3NhZ2UiKTsNCiAqICZuYnNwOyB9LA0KICogJm5ic3A7IG9uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKSB7DQogKiAmbmJzcDsmbmJzcDsgYWxlcnQoInJlY2VpdmVkICIgKyBtZXNzYWdlICsgIiBmcm9tICIgKyBvcmlnaW4pOw0KICogJm5ic3A7IH0NCiAqIH0pOw0KICogPC9jb2RlPjwvcHJlPg0KICogU2V0dGluZyB1cCB0aGUgY29uc3VtZXI6DQogKiA8cHJlPjxjb2RlPg0KICogdmFyIHNvY2tldCA9IG5ldyBlYXN5WERNLlNvY2tldCh7DQogKiAmbmJzcDsgcmVtb3RlOiAiaHR0cDomIzQ3OyYjNDc7cmVtb3RlZG9tYWluL3BhZ2UuaHRtbCIsDQogKiAmbmJzcDsgcmVtb3RlSGVscGVyOiAiaHR0cDomIzQ3OyYjNDc7cmVtb3RlZG9tYWluL25hbWUuaHRtbCIsDQogKiAmbmJzcDsgb25SZWFkeTogZnVuY3Rpb24oKXsNCiAqICZuYnNwOyAmbmJzcDsgJiM0NzsmIzQ3OyB5b3UgbmVlZCB0byB3YWl0IGZvciB0aGUgb25SZWFkeSBjYWxsYmFjayBiZWZvcmUgdXNpbmcgdGhlIHNvY2tldA0KICogJm5ic3A7ICZuYnNwOyBzb2NrZXQucG9zdE1lc3NhZ2UoImZvby1tZXNzYWdlIik7DQogKiAmbmJzcDsgfSwNCiAqICZuYnNwOyBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbikgew0KICogJm5ic3A7Jm5ic3A7IGFsZXJ0KCJyZWNlaXZlZCAiICsgbWVzc2FnZSArICIgZnJvbSAiICsgb3JpZ2luKTsNCiAqICZuYnNwOyB9DQogKiB9KTsNCiAqIDwvY29kZT48L3ByZT4NCiAqIElmIHlvdSBhcmUgdW5hYmxlIHRvIHVwbG9hZCB0aGUgPGNvZGU+bmFtZS5odG1sPC9jb2RlPiBmaWxlIHRvIHRoZSBjb25zdW1lcnMgZG9tYWluIHRoZW4gcmVtb3ZlIHRoZSA8Y29kZT5yZW1vdGVIZWxwZXI8L2NvZGU+IHByb3BlcnR5DQogKiBhbmQgZWFzeVhETSB3aWxsIGZhbGwgYmFjayB0byB1c2luZyB0aGUgSGFzaFRyYW5zcG9ydCBpbnN0ZWFkIG9mIHRoZSBOYW1lVHJhbnNwb3J0IHdoZW4gbm90IGFibGUgdG8gdXNlIGFueSBvZiB0aGUgcHJpbWFyeSB0cmFuc3BvcnRzLg0KICogQG5hbWVzcGFjZSBlYXN5WERNDQogKiBAY29uc3RydWN0b3INCiAqIEBjZmcge1N0cmluZy9XaW5kb3d9IGxvY2FsIFRoZSB1cmwgdG8gdGhlIGxvY2FsIG5hbWUuaHRtbCBkb2N1bWVudCwgYSBsb2NhbCBzdGF0aWMgZmlsZSwgb3IgYSByZWZlcmVuY2UgdG8gdGhlIGxvY2FsIHdpbmRvdy4NCiAqIEBjZmcge0Jvb2xlYW59IGxhenkgKENvbnN1bWVyIG9ubHkpIFNldCB0aGlzIHRvIHRydWUgaWYgeW91IHdhbnQgZWFzeVhETSB0byBkZWZlciBjcmVhdGluZyB0aGUgdHJhbnNwb3J0IHVudGlsIHJlYWxseSBuZWVkZWQuIA0KICogQGNmZyB7U3RyaW5nfSByZW1vdGUgKENvbnN1bWVyIG9ubHkpIFRoZSB1cmwgdG8gdGhlIHByb3ZpZGVycyBkb2N1bWVudC4NCiAqIEBjZmcge1N0cmluZ30gcmVtb3RlSGVscGVyIChDb25zdW1lciBvbmx5KSBUaGUgdXJsIHRvIHRoZSByZW1vdGUgbmFtZS5odG1sIGZpbGUuIFRoaXMgaXMgdG8gc3VwcG9ydCBOYW1lVHJhbnNwb3J0IGFzIGEgZmFsbGJhY2suIE9wdGlvbmFsLg0KICogQGNmZyB7TnVtYmVyfSBkZWxheSBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBlYXN5WERNIHNob3VsZCB0cnkgdG8gZ2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBsb2NhbCB3aW5kb3cuICBPcHRpb25hbCwgZGVmYXVsdHMgdG8gMjAwMC4NCiAqIEBjZmcge051bWJlcn0gaW50ZXJ2YWwgVGhlIGludGVydmFsIHVzZWQgd2hlbiBwb2xsaW5nIGZvciBtZXNzYWdlcy4gT3B0aW9uYWwsIGRlZmF1bHRzIHRvIDMwMC4NCiAqIEBjZmcge1N0cmluZ30gY2hhbm5lbCAoQ29uc3VtZXIgb25seSkgVGhlIG5hbWUgb2YgdGhlIGNoYW5uZWwgdG8gdXNlLiBDYW4gYmUgdXNlZCB0byBzZXQgY29uc2lzdGVudCBpZnJhbWUgbmFtZXMuIE11c3QgYmUgdW5pcXVlLiBPcHRpb25hbC4NCiAqIEBjZmcge0Z1bmN0aW9ufSBvbk1lc3NhZ2UgVGhlIG1ldGhvZCB0aGF0IHNob3VsZCBoYW5kbGUgaW5jb21pbmcgbWVzc2FnZXMuPGJyLz4gVGhpcyBtZXRob2Qgc2hvdWxkIGFjY2VwdCB0d28gYXJndW1lbnRzLCB0aGUgbWVzc2FnZSBhcyBhIHN0cmluZywgYW5kIHRoZSBvcmlnaW4gYXMgYSBzdHJpbmcuIE9wdGlvbmFsLg0KICogQGNmZyB7RnVuY3Rpb259IG9uUmVhZHkgQSBtZXRob2QgdGhhdCBzaG91bGQgYmUgY2FsbGVkIHdoZW4gdGhlIHRyYW5zcG9ydCBpcyByZWFkeS4gT3B0aW9uYWwuDQogKiBAY2ZnIHtET01FbGVtZW50fFN0cmluZ30gY29udGFpbmVyIChDb25zdW1lciBvbmx5KSBUaGUgZWxlbWVudCwgb3IgdGhlIGlkIG9mIHRoZSBlbGVtZW50IHRoYXQgdGhlIHByaW1hcnkgaWZyYW1lIHNob3VsZCBiZSBpbnNlcnRlZCBpbnRvLiBJZiBub3Qgc2V0IHRoZW4gdGhlIGlmcmFtZSB3aWxsIGJlIHBvc2l0aW9uZWQgb2ZmLXNjcmVlbi4gT3B0aW9uYWwuDQogKiBAY2ZnIHtBcnJheS9TdHJpbmd9IGFjbCAoUHJvdmlkZXIgb25seSkgSGVyZSB5b3UgY2FuIHNwZWNpZnkgd2hpY2ggJ1twcm90b2NvbF06Ly9bZG9tYWluXScgcGF0dGVybnMgdGhhdCBzaG91bGQgYmUgYWxsb3dlZCB0byBhY3QgYXMgdGhlIGNvbnN1bWVyIHRvd2FyZHMgdGhpcyBwcm92aWRlci48YnIvPg0KICogVGhpcyBjYW4gY29udGFpbiB0aGUgd2lsZGNhcmRzID8gYW5kICouICBFeGFtcGxlcyBhcmUgJ2h0dHA6Ly9leGFtcGxlLmNvbScsICcqLmZvby5jb20nIGFuZCAnKmRvbT8uY29tJy4gSWYgeW91IHdhbnQgdG8gdXNlIHJlcXVsYXIgZXhwcmVzc2lvbnMgdGhlbiB5b3UgcGF0dGVybiBuZWVkcyB0byBzdGFydCB3aXRoIF4gYW5kIGVuZCB3aXRoICQuDQogKiBJZiBub25lIG9mIHRoZSBwYXR0ZXJucyBtYXRjaCBhbiBFcnJvciB3aWxsIGJlIHRocm93bi4gIA0KICogQGNmZyB7T2JqZWN0fSBwcm9wcyAoQ29uc3VtZXIgb25seSkgQWRkaXRpb25hbCBwcm9wZXJ0aWVzIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gdGhlIGlmcmFtZS4gVGhpcyBjYW4gYWxzbyBjb250YWluIG5lc3RlZCBvYmplY3RzIGUuZzogPGNvZGU+e3N0eWxlOnt3aWR0aDoiMTAwcHgiLCBoZWlnaHQ6IjEwMHB4In19PC9jb2RlPi4gDQogKiBQcm9wZXJ0aWVzIHN1Y2ggYXMgJ25hbWUnIGFuZCAnc3JjJyB3aWxsIGJlIG92ZXJyaWRlZC4gT3B0aW9uYWwuDQogKi8NCmVhc3lYRE0uU29ja2V0ID0gZnVuY3Rpb24oY29uZmlnKXsNCiAgICB2YXIgdHJhY2UgPSBkZWJ1Zy5nZXRUcmFjZXIoImVhc3lYRE0uU29ja2V0Iik7DQogICAgdHJhY2UoImNvbnN0cnVjdG9yIik7DQogICAgDQogICAgLy8gY3JlYXRlIHRoZSBzdGFjaw0KICAgIHZhciBzdGFjayA9IGNoYWluU3RhY2socHJlcGFyZVRyYW5zcG9ydFN0YWNrKGNvbmZpZykuY29uY2F0KFt7DQogICAgICAgIGluY29taW5nOiBmdW5jdGlvbihtZXNzYWdlLCBvcmlnaW4pew0KICAgICAgICAgICAgY29uZmlnLm9uTWVzc2FnZShtZXNzYWdlLCBvcmlnaW4pOw0KICAgICAgICB9LA0KICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3VjY2Vzcyl7DQogICAgICAgICAgICBpZiAoY29uZmlnLm9uUmVhZHkpIHsNCiAgICAgICAgICAgICAgICBjb25maWcub25SZWFkeShzdWNjZXNzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH1dKSksIHJlY2lwaWVudCA9IGdldExvY2F0aW9uKGNvbmZpZy5yZW1vdGUpOw0KICAgIA0KICAgIC8vIHNldCB0aGUgb3JpZ2luDQogICAgdGhpcy5vcmlnaW4gPSBnZXRMb2NhdGlvbihjb25maWcucmVtb3RlKTsNCgkNCiAgICAvKioNCiAgICAgKiBJbml0aWF0ZXMgdGhlIGRlc3RydWN0aW9uIG9mIHRoZSBzdGFjay4NCiAgICAgKi8NCiAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbigpew0KICAgICAgICBzdGFjay5kZXN0cm95KCk7DQogICAgfTsNCiAgICANCiAgICAvKioNCiAgICAgKiBQb3N0cyBhIG1lc3NhZ2UgdG8gdGhlIHJlbW90ZSBlbmQgb2YgdGhlIGNoYW5uZWwNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBzZW5kDQogICAgICovDQogICAgdGhpcy5wb3N0TWVzc2FnZSA9IGZ1bmN0aW9uKG1lc3NhZ2Upew0KICAgICAgICBzdGFjay5vdXRnb2luZyhtZXNzYWdlLCByZWNpcGllbnQpOw0KICAgIH07DQogICAgDQogICAgc3RhY2suaW5pdCgpOw0KfTsNCi8qanNsaW50IGV2aWw6IHRydWUsIGJyb3dzZXI6IHRydWUsIGltbWVkOiB0cnVlLCBwYXNzZmFpbDogdHJ1ZSwgdW5kZWY6IHRydWUsIG5ld2NhcDogdHJ1ZSovDQovKmdsb2JhbCBlYXN5WERNLCB3aW5kb3csIGVzY2FwZSwgdW5lc2NhcGUsIHVuZGVmLCwgY2hhaW5TdGFjaywgcHJlcGFyZVRyYW5zcG9ydFN0YWNrLCBkZWJ1ZywgZ2V0TG9jYXRpb24gKi8NCi8vDQovLyBlYXN5WERNDQovLyBodHRwOi8vZWFzeXhkbS5uZXQvDQovLyBDb3B5cmlnaHQoYykgMjAwOS0yMDExLCDDmHl2aW5kIFNlYW4gS2luc2V5LCBveXZpbmRAa2luc2V5Lm5vLg0KLy8NCi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQovLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQovLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQovLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQovLw0KLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4NCi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KLy8NCi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQovLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4NCi8vIFRIRSBTT0ZUV0FSRS4NCi8vDQoNCi8qKiANCiAqIEBjbGFzcyBlYXN5WERNLlJwYw0KICogQ3JlYXRlcyBhIHByb3h5IG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIGNhbGwgbWV0aG9kcyBpbXBsZW1lbnRlZCBvbiB0aGUgcmVtb3RlIGVuZCBvZiB0aGUgY2hhbm5lbCwgYW5kIGFsc28gdG8gcHJvdmlkZSB0aGUgaW1wbGVtZW50YXRpb24NCiAqIG9mIG1ldGhvZHMgdG8gYmUgY2FsbGVkIGZyb20gdGhlIHJlbW90ZSBlbmQuPGJyLz4NCiAqIFRoZSBpbnN0YW50aWF0ZWQgb2JqZWN0IHdpbGwgaGF2ZSBtZXRob2RzIG1hdGNoaW5nIHRob3NlIHNwZWNpZmllZCBpbiA8Y29kZT5jb25maWcucmVtb3RlPC9jb2RlPi48YnIvPg0KICogVGhpcyByZXF1aXJlcyB0aGUgSlNPTiBvYmplY3QgcHJlc2VudCBpbiB0aGUgZG9jdW1lbnQsIGVpdGhlciBuYXRpdmVseSwgdXNpbmcganNvbi5vcmcncyBqc29uMiBvciBhcyBhIHdyYXBwZXIgYXJvdW5kIGxpYnJhcnkgc3Blc2lmaWMgbWV0aG9kcy4NCiAqIDxoMj5Ib3cgdG8gc2V0IHVwPC9oMj4NCiAqIDxwcmU+PGNvZGU+DQogKiB2YXIgcnBjID0gbmV3IGVhc3lYRE0uUnBjKHsNCiAqICZuYnNwOyAmIzQ3OyYjNDc7IHRoaXMgY29uZmlndXJhdGlvbiBpcyBlcXVhbCB0byB0aGF0IHVzZWQgYnkgdGhlIFNvY2tldC4NCiAqICZuYnNwOyByZW1vdGU6ICJodHRwOiYjNDc7JiM0NztyZW1vdGVkb21haW4vLi4uIiwNCiAqICZuYnNwOyBvblJlYWR5OiBmdW5jdGlvbigpew0KICogJm5ic3A7ICZuYnNwOyAmIzQ3OyYjNDc7IHlvdSBuZWVkIHRvIHdhaXQgZm9yIHRoZSBvblJlYWR5IGNhbGxiYWNrIGJlZm9yZSB1c2luZyB0aGUgcHJveHkNCiAqICZuYnNwOyAmbmJzcDsgcnBjLmZvbyguLi4NCiAqICZuYnNwOyB9DQogKiB9LHsNCiAqICZuYnNwOyBsb2NhbDogey4ufSwNCiAqICZuYnNwOyByZW1vdGU6IHsuLn0NCiAqIH0pOw0KICogPC9jb2RlPjwvcHJlPg0KICogDQogKiA8aDI+RXhwb3NpbmcgZnVuY3Rpb25zIChwcm9jZWR1cmVzKTwvaDI+DQogKiA8cHJlPjxjb2RlPg0KICogdmFyIHJwYyA9IG5ldyBlYXN5WERNLlJwYyh7DQogKiAmbmJzcDsgLi4uDQogKiB9LHsNCiAqICZuYnNwOyBsb2NhbDogew0KICogJm5ic3A7ICZuYnNwOyBuYW1lT2ZNZXRob2Q6IHsNCiAqICZuYnNwOyAmbmJzcDsgJm5ic3A7IG1ldGhvZDogZnVuY3Rpb24oYXJnMSwgYXJnMiwgc3VjY2VzcywgZXJyb3Ipew0KICogJm5ic3A7ICZuYnNwOyAmbmJzcDsgJm5ic3A7IC4uLg0KICogJm5ic3A7ICZuYnNwOyAmbmJzcDsgfQ0KICogJm5ic3A7ICZuYnNwOyB9LA0KICogJm5ic3A7ICZuYnNwOyAmIzQ3OyYjNDc7IHdpdGggc2hvcnRoYW5kIG5vdGF0aW9uIA0KICogJm5ic3A7ICZuYnNwOyBuYW1lT2ZBbm90aGVyTWV0aG9kOiAgZnVuY3Rpb24oYXJnMSwgYXJnMiwgc3VjY2VzcywgZXJyb3Ipew0KICogJm5ic3A7ICZuYnNwOyB9DQogKiAmbmJzcDsgfSwNCiAqICZuYnNwOyByZW1vdGU6IHsuLi59DQogKiB9KTsNCiAqIDwvY29kZT48L3ByZT4NCg0KICogVGhlIGZ1bmN0aW9uIHJlZmVyZW5jZWQgYnkgIFttZXRob2RdIHdpbGwgcmVjZWl2ZSB0aGUgcGFzc2VkIGFyZ3VtZW50cyBmb2xsb3dlZCBieSB0aGUgY2FsbGJhY2sgZnVuY3Rpb25zIDxjb2RlPnN1Y2Nlc3M8L2NvZGU+IGFuZCA8Y29kZT5lcnJvcjwvY29kZT4uPGJyLz4NCiAqIFRvIHNlbmQgYSBzdWNjZXNzZnVsbCByZXN1bHQgYmFjayB5b3UgY2FuIHVzZQ0KICogICAgIDxwcmU+PGNvZGU+DQogKiAgICAgcmV0dXJuIGZvbzsNCiAqICAgICA8L3ByZT48L2NvZGU+DQogKiBvcg0KICogICAgIDxwcmU+PGNvZGU+DQogKiAgICAgc3VjY2Vzcyhmb28pOw0KICogICAgIDwvcHJlPjwvY29kZT4NCiAqICBUbyByZXR1cm4gYW4gZXJyb3IgeW91IGNhbiB1c2UNCiAqICAgICA8cHJlPjxjb2RlPg0KICogICAgIHRocm93IG5ldyBFcnJvcigiZm9vIGVycm9yIik7DQogKiAgICAgPC9jb2RlPjwvcHJlPg0KICogb3INCiAqICAgICA8cHJlPjxjb2RlPg0KICogICAgIGVycm9yKCJmb28gZXJyb3IiKTsNCiAqICAgICA8L2NvZGU+PC9wcmU+DQogKg0KICogPGgyPkRlZmluaW5nIHJlbW90ZWx5IGV4cG9zZWQgbWV0aG9kcyAocHJvY2VkdXJlcy9ub3RpZmljYXRpb25zKTwvaDI+DQogKiBUaGUgZGVmaW5pdGlvbiBvZiB0aGUgcmVtb3RlIGVuZCBpcyBxdWl0ZSBzaW1pbGFyOg0KICogPHByZT48Y29kZT4NCiAqIHZhciBycGMgPSBuZXcgZWFzeVhETS5ScGMoew0KICogJm5ic3A7IC4uLg0KICogfSx7DQogKiAmbmJzcDsgbG9jYWw6IHsuLi59LA0KICogJm5ic3A7IHJlbW90ZTogew0KICogJm5ic3A7ICZuYnNwOyBuYW1lT2ZNZXRob2Q6IHt9DQogKiAmbmJzcDsgfQ0KICogfSk7DQogKiA8L2NvZGU+PC9wcmU+DQogKiBUbyBjYWxsIGEgcmVtb3RlIG1ldGhvZCB1c2UNCiAqIDxwcmU+PGNvZGU+DQogKiBycGMubmFtZU9mTWV0aG9kKCJhcmcxIiwgImFyZzIiLCBmdW5jdGlvbih2YWx1ZSkgew0KICogJm5ic3A7IGFsZXJ0KCJzdWNjZXNzOiAiICsgdmFsdWUpOw0KICogfSwgZnVuY3Rpb24obWVzc2FnZSkgew0KICogJm5ic3A7IGFsZXJ0KCJlcnJvcjogIiArIG1lc3NhZ2UgKyApOw0KICogfSk7DQogKiA8L2NvZGU+PC9wcmU+DQogKiBCb3RoIHRoZSA8Y29kZT5zdWNjZXNzPC9jb2RlPiBhbmQgPGNvZGU+ZXJycm9yPC9jb2RlPiBjYWxsYmFja3MgYXJlIG9wdGlvbmFsLjxici8+DQogKiBXaGVuIGNhbGxlZCB3aXRoIG5vIGNhbGxiYWNrIGEgSlNPTi1SUEMgMi4wIG5vdGlmaWNhdGlvbiB3aWxsIGJlIGV4ZWN1dGVkLg0KICogQmUgYXdhcmUgdGhhdCB5b3Ugd2lsbCBub3QgYmUgbm90aWZpZWQgb2YgYW55IGVycm9ycyB3aXRoIHRoaXMgbWV0aG9kLg0KICogPGJyLz4NCiAqIDxoMj5TcGVjaWZ5aW5nIGEgY3VzdG9tIHNlcmlhbGl6ZXI8L2gyPg0KICogSWYgeW91IGRvIG5vdCB3YW50IHRvIHVzZSB0aGUgSlNPTjIgbGlicmFyeSBmb3Igbm9uLW5hdGl2ZSBKU09OIHN1cHBvcnQsIGJ1dCBpbnN0ZWFkIGNhcGFiaWxpdGllcyBwcm92aWRlZCBieSBzb21lIG90aGVyIGxpYnJhcnkNCiAqIHRoZW4geW91IGNhbiBzcGVjaWZ5IGEgY3VzdG9tIHNlcmlhbGl6ZXIgdXNpbmcgPGNvZGU+c2VyaWFsaXplcjogZm9vPC9jb2RlPg0KICogPHByZT48Y29kZT4NCiAqIHZhciBycGMgPSBuZXcgZWFzeVhETS5ScGMoew0KICogJm5ic3A7IC4uLg0KICogfSx7DQogKiAmbmJzcDsgbG9jYWw6IHsuLi59LA0KICogJm5ic3A7IHJlbW90ZTogey4uLn0sDQogKiAmbmJzcDsgc2VyaWFsaXplciA6IHsNCiAqICZuYnNwOyAmbmJzcDsgcGFyc2U6IGZ1bmN0aW9uKHN0cmluZyl7IC4uLiB9LA0KICogJm5ic3A7ICZuYnNwOyBzdHJpbmdpZnk6IGZ1bmN0aW9uKG9iamVjdCkgey4uLn0NCiAqICZuYnNwOyB9DQogKiB9KTsNCiAqIDwvY29kZT48L3ByZT4NCiAqIElmIDxjb2RlPnNlcmlhbGl6ZXI8L2NvZGU+IGlzIHNldCB0aGVuIHRoZSBjbGFzcyB3aWxsIG5vdCBhdHRlbXB0IHRvIHVzZSB0aGUgbmF0aXZlIGltcGxlbWVudGF0aW9uLg0KICogQG5hbWVzcGFjZSBlYXN5WERNDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgVGhlIHVuZGVybHlpbmcgdHJhbnNwb3J0cyBjb25maWd1cmF0aW9uLiBTZWUgZWFzeVhETS5Tb2NrZXQgZm9yIGF2YWlsYWJsZSBwYXJhbWV0ZXJzLg0KICogQHBhcmFtIHtPYmplY3R9IGpzb25ScGNDb25maWcgVGhlIGRlc2NyaXB0aW9uIG9mIHRoZSBpbnRlcmZhY2UgdG8gaW1wbGVtZW50Lg0KICovDQplYXN5WERNLlJwYyA9IGZ1bmN0aW9uKGNvbmZpZywganNvblJwY0NvbmZpZyl7DQogICAgdmFyIHRyYWNlID0gZGVidWcuZ2V0VHJhY2VyKCJlYXN5WERNLlJwYyIpOw0KICAgIHRyYWNlKCJjb25zdHJ1Y3RvciIpOw0KICAgIA0KICAgIC8vIGV4cGFuZCBzaG9ydGhhbmQgbm90YXRpb24NCiAgICBpZiAoanNvblJwY0NvbmZpZy5sb2NhbCkgew0KICAgICAgICBmb3IgKHZhciBtZXRob2QgaW4ganNvblJwY0NvbmZpZy5sb2NhbCkgew0KICAgICAgICAgICAgaWYgKGpzb25ScGNDb25maWcubG9jYWwuaGFzT3duUHJvcGVydHkobWV0aG9kKSkgew0KICAgICAgICAgICAgICAgIHZhciBtZW1iZXIgPSBqc29uUnBjQ29uZmlnLmxvY2FsW21ldGhvZF07DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZW1iZXIgPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgICAgICAganNvblJwY0NvbmZpZy5sb2NhbFttZXRob2RdID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBtZW1iZXINCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoJDQogICAgLy8gY3JlYXRlIHRoZSBzdGFjaw0KICAgIHZhciBzdGFjayA9IGNoYWluU3RhY2socHJlcGFyZVRyYW5zcG9ydFN0YWNrKGNvbmZpZykuY29uY2F0KFtuZXcgZWFzeVhETS5zdGFjay5ScGNCZWhhdmlvcih0aGlzLCBqc29uUnBjQ29uZmlnKSwgew0KICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3VjY2Vzcyl7DQogICAgICAgICAgICBpZiAoY29uZmlnLm9uUmVhZHkpIHsNCiAgICAgICAgICAgICAgICBjb25maWcub25SZWFkeShzdWNjZXNzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH1dKSk7DQoJDQogICAgLy8gc2V0IHRoZSBvcmlnaW4gDQogICAgdGhpcy5vcmlnaW4gPSBnZXRMb2NhdGlvbihjb25maWcucmVtb3RlKTsNCgkNCiAgICANCiAgICAvKioNCiAgICAgKiBJbml0aWF0ZXMgdGhlIGRlc3RydWN0aW9uIG9mIHRoZSBzdGFjay4NCiAgICAgKi8NCiAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbigpew0KICAgICAgICBzdGFjay5kZXN0cm95KCk7DQogICAgfTsNCiAgICANCiAgICBzdGFjay5pbml0KCk7DQp9Ow0KLypqc2xpbnQgZXZpbDogdHJ1ZSwgYnJvd3NlcjogdHJ1ZSwgaW1tZWQ6IHRydWUsIHBhc3NmYWlsOiB0cnVlLCB1bmRlZjogdHJ1ZSwgbmV3Y2FwOiB0cnVlKi8NCi8qZ2xvYmFsIGVhc3lYRE0sIHdpbmRvdywgZXNjYXBlLCB1bmVzY2FwZSwgZ2V0TG9jYXRpb24sIGFwcGVuZFF1ZXJ5UGFyYW1ldGVycywgY3JlYXRlRnJhbWUsIGRlYnVnLCB1biwgb24sIGFwcGx5LCB3aGVuUmVhZHksIGdldFBhcmVudE9iamVjdCwgSUZSQU1FX1BSRUZJWCovDQovLw0KLy8gZWFzeVhETQ0KLy8gaHR0cDovL2Vhc3l4ZG0ubmV0Lw0KLy8gQ29weXJpZ2h0KGMpIDIwMDktMjAxMSwgw5h5dmluZCBTZWFuIEtpbnNleSwgb3l2aW5kQGtpbnNleS5uby4NCi8vDQovLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5DQovLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbA0KLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cw0KLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbA0KLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzDQovLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOg0KLy8NCi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluDQovLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCi8vDQovLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUg0KLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksDQovLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUNCi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVINCi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sDQovLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElODQovLyBUSEUgU09GVFdBUkUuDQovLw0KDQovKioNCiAqIEBjbGFzcyBlYXN5WERNLnN0YWNrLlNhbWVPcmlnaW5UcmFuc3BvcnQNCiAqIFNhbWVPcmlnaW5UcmFuc3BvcnQgaXMgYSB0cmFuc3BvcnQgY2xhc3MgdGhhdCBjYW4gYmUgdXNlZCB3aGVuIGJvdGggZG9tYWlucyBoYXZlIHRoZSBzYW1lIG9yaWdpbi48YnIvPg0KICogVGhpcyBjYW4gYmUgdXNlZnVsIGZvciB0ZXN0aW5nIGFuZCBmb3Igd2hlbiB0aGUgbWFpbiBhcHBsaWNhdGlvbiBzdXBwb3J0cyBib3RoIGludGVybmFsIGFuZCBleHRlcm5hbCBzb3VyY2VzLg0KICogQG5hbWVzcGFjZSBlYXN5WERNLnN0YWNrDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgVGhlIHRyYW5zcG9ydHMgY29uZmlndXJhdGlvbi4NCiAqIEBjZmcge1N0cmluZ30gcmVtb3RlIFRoZSByZW1vdGUgZG9jdW1lbnQgdG8gY29tbXVuaWNhdGUgd2l0aC4NCiAqLw0KZWFzeVhETS5zdGFjay5TYW1lT3JpZ2luVHJhbnNwb3J0ID0gZnVuY3Rpb24oY29uZmlnKXsNCiAgICB2YXIgdHJhY2UgPSBkZWJ1Zy5nZXRUcmFjZXIoImVhc3lYRE0uc3RhY2suU2FtZU9yaWdpblRyYW5zcG9ydCIpOw0KICAgIHRyYWNlKCJjb25zdHJ1Y3RvciIpOw0KICAgIHZhciBwdWIsIGZyYW1lLCBzZW5kLCB0YXJnZXRPcmlnaW47DQogICAgDQogICAgcmV0dXJuIChwdWIgPSB7DQogICAgICAgIG91dGdvaW5nOiBmdW5jdGlvbihtZXNzYWdlLCBkb21haW4sIGZuKXsNCiAgICAgICAgICAgIHNlbmQobWVzc2FnZSk7DQogICAgICAgICAgICBpZiAoZm4pIHsNCiAgICAgICAgICAgICAgICBmbigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpew0KICAgICAgICAgICAgdHJhY2UoImRlc3Ryb3kiKTsNCiAgICAgICAgICAgIGlmIChmcmFtZSkgew0KICAgICAgICAgICAgICAgIGZyYW1lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZnJhbWUpOw0KICAgICAgICAgICAgICAgIGZyYW1lID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgb25ET01SZWFkeTogZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIHRyYWNlKCJpbml0Iik7DQogICAgICAgICAgICB0YXJnZXRPcmlnaW4gPSBnZXRMb2NhdGlvbihjb25maWcucmVtb3RlKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKGNvbmZpZy5pc0hvc3QpIHsNCiAgICAgICAgICAgICAgICAvLyBzZXQgdXAgdGhlIGlmcmFtZQ0KICAgICAgICAgICAgICAgIGFwcGx5KGNvbmZpZy5wcm9wcywgew0KICAgICAgICAgICAgICAgICAgICBzcmM6IGFwcGVuZFF1ZXJ5UGFyYW1ldGVycyhjb25maWcucmVtb3RlLCB7DQogICAgICAgICAgICAgICAgICAgICAgICB4ZG1fZTogbG9jYXRpb24ucHJvdG9jb2wgKyAiLy8iICsgbG9jYXRpb24uaG9zdCArIGxvY2F0aW9uLnBhdGhuYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgeGRtX2M6IGNvbmZpZy5jaGFubmVsLA0KICAgICAgICAgICAgICAgICAgICAgICAgeGRtX3A6IDQgLy8gNCA9IFNhbWVPcmlnaW5UcmFuc3BvcnQNCiAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgIG5hbWU6IElGUkFNRV9QUkVGSVggKyBjb25maWcuY2hhbm5lbCArICJfcHJvdmlkZXIiDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgZnJhbWUgPSBjcmVhdGVGcmFtZShjb25maWcpOw0KICAgICAgICAgICAgICAgIGVhc3lYRE0uRm4uc2V0KGNvbmZpZy5jaGFubmVsLCBmdW5jdGlvbihzZW5kRm4pew0KICAgICAgICAgICAgICAgICAgICBzZW5kID0gc2VuZEZuOw0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgICAgICAgICBwdWIudXAuY2FsbGJhY2sodHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0sIDApOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24obXNnKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHB1Yi51cC5pbmNvbWluZyhtc2csIHRhcmdldE9yaWdpbik7DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBzZW5kID0gZ2V0UGFyZW50T2JqZWN0KCkuRm4uZ2V0KGNvbmZpZy5jaGFubmVsLCB0cnVlKShmdW5jdGlvbihtc2cpew0KICAgICAgICAgICAgICAgICAgICBwdWIudXAuaW5jb21pbmcobXNnLCB0YXJnZXRPcmlnaW4pOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICAgICAgcHViLnVwLmNhbGxiYWNrKHRydWUpOw0KICAgICAgICAgICAgICAgIH0sIDApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBpbml0OiBmdW5jdGlvbigpew0KICAgICAgICAgICAgd2hlblJlYWR5KHB1Yi5vbkRPTVJlYWR5LCBwdWIpOw0KICAgICAgICB9DQogICAgfSk7DQp9Ow0KLypqc2xpbnQgZXZpbDogdHJ1ZSwgYnJvd3NlcjogdHJ1ZSwgaW1tZWQ6IHRydWUsIHBhc3NmYWlsOiB0cnVlLCB1bmRlZjogdHJ1ZSwgbmV3Y2FwOiB0cnVlKi8NCi8qZ2xvYmFsIGdsb2JhbCwgZWFzeVhETSwgd2luZG93LCBnZXRMb2NhdGlvbiwgYXBwZW5kUXVlcnlQYXJhbWV0ZXJzLCBjcmVhdGVGcmFtZSwgZGVidWcsIGFwcGx5LCB3aGVuUmVhZHksIElGUkFNRV9QUkVGSVgsIG5hbWVzcGFjZSwgcmVzb2x2ZVVybCwgZ2V0RG9tYWluTmFtZSwgSEFTX0ZMQVNIX1RIUk9UVExFRF9CVUcsIGdldFBvcnQsIHF1ZXJ5Ki8NCi8vDQovLyBlYXN5WERNDQovLyBodHRwOi8vZWFzeXhkbS5uZXQvDQovLyBDb3B5cmlnaHQoYykgMjAwOS0yMDExLCDDmHl2aW5kIFNlYW4gS2luc2V5LCBveXZpbmRAa2luc2V5Lm5vLg0KLy8NCi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQovLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQovLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQovLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQovLw0KLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4NCi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KLy8NCi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQovLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4NCi8vIFRIRSBTT0ZUV0FSRS4NCi8vDQoNCi8qKg0KICogQGNsYXNzIGVhc3lYRE0uc3RhY2suRmxhc2hUcmFuc3BvcnQNCiAqIEZsYXNoVHJhbnNwb3J0IGlzIGEgdHJhbnNwb3J0IGNsYXNzIHRoYXQgdXNlcyBhbiBTV0Ygd2l0aCBMb2NhbENvbm5lY3Rpb24gdG8gcGFzcyBtZXNzYWdlcyBiYWNrIGFuZCBmb3J0aC4NCiAqIEBuYW1lc3BhY2UgZWFzeVhETS5zdGFjaw0KICogQGNvbnN0cnVjdG9yDQogKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIFRoZSB0cmFuc3BvcnRzIGNvbmZpZ3VyYXRpb24uDQogKiBAY2ZnIHtTdHJpbmd9IHJlbW90ZSBUaGUgcmVtb3RlIGRvbWFpbiB0byBjb21tdW5pY2F0ZSB3aXRoLg0KICogQGNmZyB7U3RyaW5nfSBzZWNyZXQgdGhlIHByZS1zaGFyZWQgc2VjcmV0IHVzZWQgdG8gc2VjdXJlIHRoZSBjb21tdW5pY2F0aW9uLg0KICogQGNmZyB7U3RyaW5nfSBzd2YgVGhlIHBhdGggdG8gdGhlIHN3ZiBmaWxlDQogKiBAY2ZnIHtCb29sZWFufSBzd2ZOb1Rocm90dGxlIFNldCB0aGlzIHRvIHRydWUgaWYgeW91IHdhbnQgdG8gdGFrZSBzdGVwcyB0byBhdm9pZCBiZWVpbmcgdGhyb3R0bGVkIHdoZW4gaGlkZGVuLg0KICogQGNmZyB7U3RyaW5nIHx8IERPTUVsZW1lbnR9IHN3ZkNvbnRhaW5lciBTZXQgdGhpcyBpZiB5b3Ugd2FudCB0byBjb250cm9sIHdoZXJlIHRoZSBzd2YgaXMgcGxhY2VkDQogKi8NCmVhc3lYRE0uc3RhY2suRmxhc2hUcmFuc3BvcnQgPSBmdW5jdGlvbihjb25maWcpew0KICAgIHZhciB0cmFjZSA9IGRlYnVnLmdldFRyYWNlcigiZWFzeVhETS5zdGFjay5GbGFzaFRyYW5zcG9ydCIpOw0KICAgIHRyYWNlKCJjb25zdHJ1Y3RvciIpOw0KICAgIGlmICghY29uZmlnLnN3Zikgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBhdGggdG8gZWFzeXhkbS5zd2YgaXMgbWlzc2luZyIpOw0KICAgIH0NCiAgICB2YXIgcHViLCAvLyB0aGUgcHVibGljIGludGVyZmFjZQ0KIGZyYW1lLCBzZW5kLCB0YXJnZXRPcmlnaW4sIHN3Ziwgc3dmQ29udGFpbmVyOw0KICAgIA0KICAgIGZ1bmN0aW9uIG9uTWVzc2FnZShtZXNzYWdlLCBvcmlnaW4pew0KICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQogICAgICAgICAgICB0cmFjZSgicmVjZWl2ZWQgbWVzc2FnZSIpOw0KICAgICAgICAgICAgcHViLnVwLmluY29taW5nKG1lc3NhZ2UsIHRhcmdldE9yaWdpbik7DQogICAgICAgIH0sIDApOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBUaGlzIG1ldGhvZCBhZGRzIHRoZSBTV0YgdG8gdGhlIERPTSBhbmQgcHJlcGFyZXMgdGhlIGluaXRpYWxpemF0aW9uIG9mIHRoZSBjaGFubmVsDQogICAgICovDQogICAgZnVuY3Rpb24gYWRkU3dmKGRvbWFpbil7DQogICAgICAgIHRyYWNlKCJjcmVhdGluZyBmYWN0b3J5IHdpdGggU1dGIGZyb20gIiArIGRvbWFpbik7DQogICAgICAgIC8vIHRoZSBkaWZmZXJlbnRpYXRpbmcgcXVlcnkgYXJndW1lbnQgaXMgbmVlZGVkIGluIEZsYXNoOSB0byBhdm9pZCBhIGNhY2hpbmcgaXNzdWUgd2hlcmUgTG9jYWxDb25uZWN0aW9uIHdvdWxkIHRocm93IGFuIGVycm9yLg0KICAgICAgICB2YXIgdXJsID0gY29uZmlnLnN3ZiArICI/aG9zdD0iICsgY29uZmlnLmlzSG9zdDsNCiAgICAgICAgdmFyIGlkID0gImVhc3lYRE1fc3dmXyIgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMCk7DQogICAgICAgIA0KICAgICAgICAvLyBwcmVwYXJlIHRoZSBpbml0IGZ1bmN0aW9uIHRoYXQgd2lsbCBmaXJlIG9uY2UgdGhlIHN3ZiBpcyByZWFkeQ0KICAgICAgICBlYXN5WERNLkZuLnNldCgiZmxhc2hfbG9hZGVkIiArIGRvbWFpbi5yZXBsYWNlKC9bXC0uXS9nLCAiXyIpLCBmdW5jdGlvbigpew0KICAgICAgICAgICAgZWFzeVhETS5zdGFjay5GbGFzaFRyYW5zcG9ydFtkb21haW5dLnN3ZiA9IHN3ZiA9IHN3ZkNvbnRhaW5lci5maXJzdENoaWxkOw0KICAgICAgICAgICAgdmFyIHF1ZXVlID0gZWFzeVhETS5zdGFjay5GbGFzaFRyYW5zcG9ydFtkb21haW5dLnF1ZXVlOw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBxdWV1ZS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIHF1ZXVlW2ldKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBxdWV1ZS5sZW5ndGggPSAwOw0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGlmIChjb25maWcuc3dmQ29udGFpbmVyKSB7DQogICAgICAgICAgICBzd2ZDb250YWluZXIgPSAodHlwZW9mIGNvbmZpZy5zd2ZDb250YWluZXIgPT0gInN0cmluZyIpID8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29uZmlnLnN3ZkNvbnRhaW5lcikgOiBjb25maWcuc3dmQ29udGFpbmVyOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gY3JlYXRlIHRoZSBjb250YWluZXIgdGhhdCB3aWxsIGhvbGQgdGhlIHN3Zg0KICAgICAgICAgICAgc3dmQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIGh0dHA6Ly9idWdzLmFkb2JlLmNvbS9qaXJhL2Jyb3dzZS9GUC00Nzk2DQogICAgICAgICAgICAvLyBodHRwOi8vdGVjaC5ncm91cHMueWFob28uY29tL2dyb3VwL2ZsZXhjb2RlcnMvbWVzc2FnZS8xNjIzNjUNCiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ3JvdXBzLmdvb2dsZS5jb20vZm9ydW0vIyF0b3BpYy9lYXN5eGRtL21KWkpoV2Fnb0xjDQogICAgICAgICAgICBhcHBseShzd2ZDb250YWluZXIuc3R5bGUsIEhBU19GTEFTSF9USFJPVFRMRURfQlVHICYmIGNvbmZpZy5zd2ZOb1Rocm90dGxlID8gew0KICAgICAgICAgICAgICAgIGhlaWdodDogIjIwcHgiLA0KICAgICAgICAgICAgICAgIHdpZHRoOiAiMjBweCIsDQogICAgICAgICAgICAgICAgcG9zaXRpb246ICJmaXhlZCIsDQogICAgICAgICAgICAgICAgcmlnaHQ6IDAsDQogICAgICAgICAgICAgICAgdG9wOiAwDQogICAgICAgICAgICB9IDogew0KICAgICAgICAgICAgICAgIGhlaWdodDogIjFweCIsDQogICAgICAgICAgICAgICAgd2lkdGg6ICIxcHgiLA0KICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLA0KICAgICAgICAgICAgICAgIG92ZXJmbG93OiAiaGlkZGVuIiwNCiAgICAgICAgICAgICAgICByaWdodDogMCwNCiAgICAgICAgICAgICAgICB0b3A6IDANCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzd2ZDb250YWluZXIpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBjcmVhdGUgdGhlIG9iamVjdC9lbWJlZA0KICAgICAgICB2YXIgZmxhc2hWYXJzID0gImNhbGxiYWNrPWZsYXNoX2xvYWRlZCIgKyBkb21haW4ucmVwbGFjZSgvW1wtLl0vZywgIl8iKSArICImcHJvdG89IiArIGdsb2JhbC5sb2NhdGlvbi5wcm90b2NvbCArICImZG9tYWluPSIgKyBnZXREb21haW5OYW1lKGdsb2JhbC5sb2NhdGlvbi5ocmVmKSArICImcG9ydD0iICsgZ2V0UG9ydChnbG9iYWwubG9jYXRpb24uaHJlZikgKyAiJm5zPSIgKyBuYW1lc3BhY2U7DQogICAgICAgIGZsYXNoVmFycyArPSAiJmxvZz10cnVlIjsNCiAgICAgICAgc3dmQ29udGFpbmVyLmlubmVySFRNTCA9ICI8b2JqZWN0IGhlaWdodD0nMjAnIHdpZHRoPScyMCcgdHlwZT0nYXBwbGljYXRpb24veC1zaG9ja3dhdmUtZmxhc2gnIGlkPSciICsgaWQgKyAiJyBkYXRhPSciICsgdXJsICsgIic+IiArDQogICAgICAgICI8cGFyYW0gbmFtZT0nYWxsb3dTY3JpcHRBY2Nlc3MnIHZhbHVlPSdhbHdheXMnPjwvcGFyYW0+IiArDQogICAgICAgICI8cGFyYW0gbmFtZT0nd21vZGUnIHZhbHVlPSd0cmFuc3BhcmVudCc+IiArDQogICAgICAgICI8cGFyYW0gbmFtZT0nbW92aWUnIHZhbHVlPSciICsNCiAgICAgICAgdXJsICsNCiAgICAgICAgIic+PC9wYXJhbT4iICsNCiAgICAgICAgIjxwYXJhbSBuYW1lPSdmbGFzaHZhcnMnIHZhbHVlPSciICsNCiAgICAgICAgZmxhc2hWYXJzICsNCiAgICAgICAgIic+PC9wYXJhbT4iICsNCiAgICAgICAgIjxlbWJlZCB0eXBlPSdhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCcgRmxhc2hWYXJzPSciICsNCiAgICAgICAgZmxhc2hWYXJzICsNCiAgICAgICAgIicgYWxsb3dTY3JpcHRBY2Nlc3M9J2Fsd2F5cycgd21vZGU9J3RyYW5zcGFyZW50JyBzcmM9JyIgKw0KICAgICAgICB1cmwgKw0KICAgICAgICAiJyBoZWlnaHQ9JzEnIHdpZHRoPScxJz48L2VtYmVkPiIgKw0KICAgICAgICAiPC9vYmplY3Q+IjsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIChwdWIgPSB7DQogICAgICAgIG91dGdvaW5nOiBmdW5jdGlvbihtZXNzYWdlLCBkb21haW4sIGZuKXsNCiAgICAgICAgICAgIHN3Zi5wb3N0TWVzc2FnZShjb25maWcuY2hhbm5lbCwgbWVzc2FnZS50b1N0cmluZygpKTsNCiAgICAgICAgICAgIGlmIChmbikgew0KICAgICAgICAgICAgICAgIGZuKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICB0cmFjZSgiZGVzdHJveSIpOw0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBzd2YuZGVzdHJveUNoYW5uZWwoY29uZmlnLmNoYW5uZWwpOw0KICAgICAgICAgICAgfSANCiAgICAgICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzd2YgPSBudWxsOw0KICAgICAgICAgICAgaWYgKGZyYW1lKSB7DQogICAgICAgICAgICAgICAgZnJhbWUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChmcmFtZSk7DQogICAgICAgICAgICAgICAgZnJhbWUgPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBvbkRPTVJlYWR5OiBmdW5jdGlvbigpew0KICAgICAgICAgICAgdHJhY2UoImluaXQiKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdGFyZ2V0T3JpZ2luID0gY29uZmlnLnJlbW90ZTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gUHJlcGFyZSB0aGUgY29kZSB0aGF0IHdpbGwgYmUgcnVuIGFmdGVyIHRoZSBzd2YgaGFzIGJlZW4gaW50aWFsaXplZA0KICAgICAgICAgICAgZWFzeVhETS5Gbi5zZXQoImZsYXNoXyIgKyBjb25maWcuY2hhbm5lbCArICJfaW5pdCIsIGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICAgICB0cmFjZSgiZmlyaW5nIG9uUmVhZHkiKTsNCiAgICAgICAgICAgICAgICAgICAgcHViLnVwLmNhbGxiYWNrKHRydWUpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIHNldCB1cCB0aGUgb21NZXNzYWdlIGhhbmRsZXINCiAgICAgICAgICAgIGVhc3lYRE0uRm4uc2V0KCJmbGFzaF8iICsgY29uZmlnLmNoYW5uZWwgKyAiX29uTWVzc2FnZSIsIG9uTWVzc2FnZSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbmZpZy5zd2YgPSByZXNvbHZlVXJsKGNvbmZpZy5zd2YpOyAvLyByZXBvcnRzIGhhdmUgYmVlbiBtYWRlIG9mIHJlcXVlc3RzIGdvbmUgcm9ndWUgd2hlbiB1c2luZyByZWxhdGl2ZSBwYXRocw0KICAgICAgICAgICAgdmFyIHN3ZmRvbWFpbiA9IGdldERvbWFpbk5hbWUoY29uZmlnLnN3Zik7DQogICAgICAgICAgICB2YXIgZm4gPSBmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgIC8vIHNldCBpbml0IHRvIHRydWUgaW4gY2FzZSB0aGUgZm4gd2FzIGNhbGxlZCB3YXMgaW52b2tlZCBmcm9tIGEgc2VwYXJhdGUgaW5zdGFuY2UNCiAgICAgICAgICAgICAgICBlYXN5WERNLnN0YWNrLkZsYXNoVHJhbnNwb3J0W3N3ZmRvbWFpbl0uaW5pdCA9IHRydWU7DQogICAgICAgICAgICAgICAgc3dmID0gZWFzeVhETS5zdGFjay5GbGFzaFRyYW5zcG9ydFtzd2Zkb21haW5dLnN3ZjsNCiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgdGhlIGNoYW5uZWwNCiAgICAgICAgICAgICAgICBzd2YuY3JlYXRlQ2hhbm5lbChjb25maWcuY2hhbm5lbCwgY29uZmlnLnNlY3JldCwgZ2V0TG9jYXRpb24oY29uZmlnLnJlbW90ZSksIGNvbmZpZy5pc0hvc3QpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChjb25maWcuaXNIb3N0KSB7DQogICAgICAgICAgICAgICAgICAgIC8vIGlmIEZsYXNoIGlzIGdvaW5nIHRvIGJlIHRocm90dGxlZCBhbmQgd2Ugd2FudCB0byBhdm9pZCB0aGlzDQogICAgICAgICAgICAgICAgICAgIGlmIChIQVNfRkxBU0hfVEhST1RUTEVEX0JVRyAmJiBjb25maWcuc3dmTm9UaHJvdHRsZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHkoY29uZmlnLnByb3BzLCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJmaXhlZCIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IDAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogIjIwcHgiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAiMjBweCINCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIC8vIHNldCB1cCB0aGUgaWZyYW1lDQogICAgICAgICAgICAgICAgICAgIGFwcGx5KGNvbmZpZy5wcm9wcywgew0KICAgICAgICAgICAgICAgICAgICAgICAgc3JjOiBhcHBlbmRRdWVyeVBhcmFtZXRlcnMoY29uZmlnLnJlbW90ZSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhkbV9lOiBnZXRMb2NhdGlvbihsb2NhdGlvbi5ocmVmKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ZG1fYzogY29uZmlnLmNoYW5uZWwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeGRtX3A6IDYsIC8vIDYgPSBGbGFzaFRyYW5zcG9ydA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhkbV9zOiBjb25maWcuc2VjcmV0DQogICAgICAgICAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IElGUkFNRV9QUkVGSVggKyBjb25maWcuY2hhbm5lbCArICJfcHJvdmlkZXIiDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICBmcmFtZSA9IGNyZWF0ZUZyYW1lKGNvbmZpZyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKGVhc3lYRE0uc3RhY2suRmxhc2hUcmFuc3BvcnRbc3dmZG9tYWluXSAmJiBlYXN5WERNLnN0YWNrLkZsYXNoVHJhbnNwb3J0W3N3ZmRvbWFpbl0uaW5pdCkgew0KICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBzd2YgaXMgaW4gcGxhY2UgYW5kIHdlIGFyZSB0aGUgY29uc3VtZXINCiAgICAgICAgICAgICAgICBmbigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gaWYgdGhlIHN3ZiBkb2VzIG5vdCB5ZXQgZXhpc3QNCiAgICAgICAgICAgICAgICBpZiAoIWVhc3lYRE0uc3RhY2suRmxhc2hUcmFuc3BvcnRbc3dmZG9tYWluXSkgew0KICAgICAgICAgICAgICAgICAgICAvLyBhZGQgdGhlIHF1ZXVlIHRvIGhvbGQgdGhlIGluaXQgZm4ncw0KICAgICAgICAgICAgICAgICAgICBlYXN5WERNLnN0YWNrLkZsYXNoVHJhbnNwb3J0W3N3ZmRvbWFpbl0gPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZTogW2ZuXQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICBhZGRTd2Yoc3dmZG9tYWluKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGVhc3lYRE0uc3RhY2suRmxhc2hUcmFuc3BvcnRbc3dmZG9tYWluXS5xdWV1ZS5wdXNoKGZuKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGluaXQ6IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICB3aGVuUmVhZHkocHViLm9uRE9NUmVhZHksIHB1Yik7DQogICAgICAgIH0NCiAgICB9KTsNCn07DQovKmpzbGludCBldmlsOiB0cnVlLCBicm93c2VyOiB0cnVlLCBpbW1lZDogdHJ1ZSwgcGFzc2ZhaWw6IHRydWUsIHVuZGVmOiB0cnVlLCBuZXdjYXA6IHRydWUqLw0KLypnbG9iYWwgZWFzeVhETSwgd2luZG93LCBlc2NhcGUsIHVuZXNjYXBlLCBnZXRMb2NhdGlvbiwgYXBwZW5kUXVlcnlQYXJhbWV0ZXJzLCBjcmVhdGVGcmFtZSwgZGVidWcsIHVuLCBvbiwgYXBwbHksIHdoZW5SZWFkeSwgSUZSQU1FX1BSRUZJWCovDQovLw0KLy8gZWFzeVhETQ0KLy8gaHR0cDovL2Vhc3l4ZG0ubmV0Lw0KLy8gQ29weXJpZ2h0KGMpIDIwMDktMjAxMSwgw5h5dmluZCBTZWFuIEtpbnNleSwgb3l2aW5kQGtpbnNleS5uby4NCi8vDQovLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5DQovLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbA0KLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cw0KLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbA0KLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzDQovLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOg0KLy8NCi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluDQovLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCi8vDQovLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUg0KLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksDQovLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUNCi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVINCi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sDQovLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElODQovLyBUSEUgU09GVFdBUkUuDQovLw0KDQovKioNCiAqIEBjbGFzcyBlYXN5WERNLnN0YWNrLlBvc3RNZXNzYWdlVHJhbnNwb3J0DQogKiBQb3N0TWVzc2FnZVRyYW5zcG9ydCBpcyBhIHRyYW5zcG9ydCBjbGFzcyB0aGF0IHVzZXMgSFRNTDUgcG9zdE1lc3NhZ2UgZm9yIGNvbW11bmljYXRpb24uPGJyLz4NCiAqIDxhIGhyZWY9Imh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9tczY0NDk0NChWUy44NSkuYXNweCI+aHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L21zNjQ0OTQ0KFZTLjg1KS5hc3B4PC9hPjxici8+DQogKiA8YSBocmVmPSJodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9ET00vd2luZG93LnBvc3RNZXNzYWdlIj5odHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9ET00vd2luZG93LnBvc3RNZXNzYWdlPC9hPg0KICogQG5hbWVzcGFjZSBlYXN5WERNLnN0YWNrDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgVGhlIHRyYW5zcG9ydHMgY29uZmlndXJhdGlvbi4NCiAqIEBjZmcge1N0cmluZ30gcmVtb3RlIFRoZSByZW1vdGUgZG9tYWluIHRvIGNvbW11bmljYXRlIHdpdGguDQogKi8NCmVhc3lYRE0uc3RhY2suUG9zdE1lc3NhZ2VUcmFuc3BvcnQgPSBmdW5jdGlvbihjb25maWcpew0KICAgIHZhciB0cmFjZSA9IGRlYnVnLmdldFRyYWNlcigiZWFzeVhETS5zdGFjay5Qb3N0TWVzc2FnZVRyYW5zcG9ydCIpOw0KICAgIHRyYWNlKCJjb25zdHJ1Y3RvciIpOw0KICAgIHZhciBwdWIsIC8vIHRoZSBwdWJsaWMgaW50ZXJmYWNlDQogZnJhbWUsIC8vIHRoZSByZW1vdGUgZnJhbWUsIGlmIGFueQ0KIGNhbGxlcldpbmRvdywgLy8gdGhlIHdpbmRvdyB0aGF0IHdlIHdpbGwgY2FsbCB3aXRoDQogdGFyZ2V0T3JpZ2luOyAvLyB0aGUgZG9tYWluIHRvIGNvbW11bmljYXRlIHdpdGgNCiAgICAvKioNCiAgICAgKiBSZXNvbHZlcyB0aGUgb3JpZ2luIGZyb20gdGhlIGV2ZW50IG9iamVjdA0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50IFRoZSBtZXNzYWdlZXZlbnQNCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFRoZSBzY2hlbWUsIGhvc3QgYW5kIHBvcnQgb2YgdGhlIG9yaWdpbg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIF9nZXRPcmlnaW4oZXZlbnQpew0KICAgICAgICBpZiAoZXZlbnQub3JpZ2luKSB7DQogICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBIVE1MNSBwcm9wZXJ0eQ0KICAgICAgICAgICAgcmV0dXJuIGdldExvY2F0aW9uKGV2ZW50Lm9yaWdpbik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGV2ZW50LnVyaSkgew0KICAgICAgICAgICAgLy8gRnJvbSBlYXJsaWVyIGltcGxlbWVudGF0aW9ucyANCiAgICAgICAgICAgIHJldHVybiBnZXRMb2NhdGlvbihldmVudC51cmkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChldmVudC5kb21haW4pIHsNCiAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGxhc3Qgb3B0aW9uIGFuZCB3aWxsIGZhaWwgaWYgdGhlIA0KICAgICAgICAgICAgLy8gb3JpZ2luIGlzIG5vdCB1c2luZyB0aGUgc2FtZSBzY2hlbWEgYXMgd2UgYXJlDQogICAgICAgICAgICByZXR1cm4gbG9jYXRpb24ucHJvdG9jb2wgKyAiLy8iICsgZXZlbnQuZG9tYWluOw0KICAgICAgICB9DQogICAgICAgIHRocm93ICJVbmFibGUgdG8gcmV0cmlldmUgdGhlIG9yaWdpbiBvZiB0aGUgZXZlbnQiOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBUaGlzIGlzIHRoZSBtYWluIGltcGxlbWVudGF0aW9uIGZvciB0aGUgb25NZXNzYWdlIGV2ZW50Ljxici8+DQogICAgICogSXQgY2hlY2tzIHRoZSB2YWxpZGl0eSBvZiB0aGUgb3JpZ2luIGFuZCBwYXNzZXMgdGhlIG1lc3NhZ2Ugb24gaWYgYXBwcm9wcmlhdGUuDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIG1lc3NhZ2VldmVudA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIF93aW5kb3dfb25NZXNzYWdlKGV2ZW50KXsNCiAgICAgICAgdmFyIG9yaWdpbiA9IF9nZXRPcmlnaW4oZXZlbnQpOw0KICAgICAgICB0cmFjZSgicmVjZWl2ZWQgbWVzc2FnZSAnIiArIGV2ZW50LmRhdGEgKyAiJyBmcm9tICIgKyBvcmlnaW4pOw0KICAgICAgICBpZiAob3JpZ2luID09IHRhcmdldE9yaWdpbiAmJiBldmVudC5kYXRhLnN1YnN0cmluZygwLCBjb25maWcuY2hhbm5lbC5sZW5ndGggKyAxKSA9PSBjb25maWcuY2hhbm5lbCArICIgIikgew0KICAgICAgICAgICAgcHViLnVwLmluY29taW5nKGV2ZW50LmRhdGEuc3Vic3RyaW5nKGNvbmZpZy5jaGFubmVsLmxlbmd0aCArIDEpLCBvcmlnaW4pOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIHJldHVybiAocHViID0gew0KICAgICAgICBvdXRnb2luZzogZnVuY3Rpb24obWVzc2FnZSwgZG9tYWluLCBmbil7DQogICAgICAgICAgICBjYWxsZXJXaW5kb3cucG9zdE1lc3NhZ2UoY29uZmlnLmNoYW5uZWwgKyAiICIgKyBtZXNzYWdlLCBkb21haW4gfHwgdGFyZ2V0T3JpZ2luKTsNCiAgICAgICAgICAgIGlmIChmbikgew0KICAgICAgICAgICAgICAgIGZuKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICB0cmFjZSgiZGVzdHJveSIpOw0KICAgICAgICAgICAgdW4od2luZG93LCAibWVzc2FnZSIsIF93aW5kb3dfb25NZXNzYWdlKTsNCiAgICAgICAgICAgIGlmIChmcmFtZSkgew0KICAgICAgICAgICAgICAgIGNhbGxlcldpbmRvdyA9IG51bGw7DQogICAgICAgICAgICAgICAgZnJhbWUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChmcmFtZSk7DQogICAgICAgICAgICAgICAgZnJhbWUgPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBvbkRPTVJlYWR5OiBmdW5jdGlvbigpew0KICAgICAgICAgICAgdHJhY2UoImluaXQiKTsNCiAgICAgICAgICAgIHRhcmdldE9yaWdpbiA9IGdldExvY2F0aW9uKGNvbmZpZy5yZW1vdGUpOw0KICAgICAgICAgICAgaWYgKGNvbmZpZy5pc0hvc3QpIHsNCiAgICAgICAgICAgICAgICAvLyBhZGQgdGhlIGV2ZW50IGhhbmRsZXIgZm9yIGxpc3RlbmluZw0KICAgICAgICAgICAgICAgIHZhciB3YWl0Rm9yUmVhZHkgPSBmdW5jdGlvbihldmVudCl7ICANCiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmRhdGEgPT0gY29uZmlnLmNoYW5uZWwgKyAiLXJlYWR5Iikgew0KICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2UoImZpcmluZyBvblJlYWR5Iik7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyByZXBsYWNlIHRoZSBldmVudGxpc3RlbmVyDQogICAgICAgICAgICAgICAgICAgICAgICBjYWxsZXJXaW5kb3cgPSAoInBvc3RNZXNzYWdlIiBpbiBmcmFtZS5jb250ZW50V2luZG93KSA/IGZyYW1lLmNvbnRlbnRXaW5kb3cgOiBmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50Ow0KICAgICAgICAgICAgICAgICAgICAgICAgdW4od2luZG93LCAibWVzc2FnZSIsIHdhaXRGb3JSZWFkeSk7DQogICAgICAgICAgICAgICAgICAgICAgICBvbih3aW5kb3csICJtZXNzYWdlIiwgX3dpbmRvd19vbk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1Yi51cC5jYWxsYmFjayh0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBvbih3aW5kb3csICJtZXNzYWdlIiwgd2FpdEZvclJlYWR5KTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzZXQgdXAgdGhlIGlmcmFtZQ0KICAgICAgICAgICAgICAgIGFwcGx5KGNvbmZpZy5wcm9wcywgew0KICAgICAgICAgICAgICAgICAgICBzcmM6IGFwcGVuZFF1ZXJ5UGFyYW1ldGVycyhjb25maWcucmVtb3RlLCB7DQogICAgICAgICAgICAgICAgICAgICAgICB4ZG1fZTogZ2V0TG9jYXRpb24obG9jYXRpb24uaHJlZiksDQogICAgICAgICAgICAgICAgICAgICAgICB4ZG1fYzogY29uZmlnLmNoYW5uZWwsDQogICAgICAgICAgICAgICAgICAgICAgICB4ZG1fcDogMSAvLyAxID0gUG9zdE1lc3NhZ2UNCiAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgIG5hbWU6IElGUkFNRV9QUkVGSVggKyBjb25maWcuY2hhbm5lbCArICJfcHJvdmlkZXIiDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgZnJhbWUgPSBjcmVhdGVGcmFtZShjb25maWcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gYWRkIHRoZSBldmVudCBoYW5kbGVyIGZvciBsaXN0ZW5pbmcNCiAgICAgICAgICAgICAgICBvbih3aW5kb3csICJtZXNzYWdlIiwgX3dpbmRvd19vbk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIGNhbGxlcldpbmRvdyA9ICgicG9zdE1lc3NhZ2UiIGluIHdpbmRvdy5wYXJlbnQpID8gd2luZG93LnBhcmVudCA6IHdpbmRvdy5wYXJlbnQuZG9jdW1lbnQ7DQogICAgICAgICAgICAgICAgY2FsbGVyV2luZG93LnBvc3RNZXNzYWdlKGNvbmZpZy5jaGFubmVsICsgIi1yZWFkeSIsIHRhcmdldE9yaWdpbik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICAgICBwdWIudXAuY2FsbGJhY2sodHJ1ZSk7DQogICAgICAgICAgICAgICAgfSwgMCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGluaXQ6IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICB3aGVuUmVhZHkocHViLm9uRE9NUmVhZHksIHB1Yik7DQogICAgICAgIH0NCiAgICB9KTsNCn07DQovKmpzbGludCBldmlsOiB0cnVlLCBicm93c2VyOiB0cnVlLCBpbW1lZDogdHJ1ZSwgcGFzc2ZhaWw6IHRydWUsIHVuZGVmOiB0cnVlLCBuZXdjYXA6IHRydWUqLw0KLypnbG9iYWwgZWFzeVhETSwgd2luZG93LCBlc2NhcGUsIHVuZXNjYXBlLCBnZXRMb2NhdGlvbiwgYXBwZW5kUXVlcnlQYXJhbWV0ZXJzLCBjcmVhdGVGcmFtZSwgZGVidWcsIGFwcGx5LCBxdWVyeSwgd2hlblJlYWR5LCBJRlJBTUVfUFJFRklYKi8NCi8vDQovLyBlYXN5WERNDQovLyBodHRwOi8vZWFzeXhkbS5uZXQvDQovLyBDb3B5cmlnaHQoYykgMjAwOS0yMDExLCDDmHl2aW5kIFNlYW4gS2luc2V5LCBveXZpbmRAa2luc2V5Lm5vLg0KLy8NCi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQovLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQovLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQovLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQovLw0KLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4NCi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KLy8NCi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQovLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4NCi8vIFRIRSBTT0ZUV0FSRS4NCi8vDQoNCi8qKg0KICogQGNsYXNzIGVhc3lYRE0uc3RhY2suRnJhbWVFbGVtZW50VHJhbnNwb3J0DQogKiBGcmFtZUVsZW1lbnRUcmFuc3BvcnQgaXMgYSB0cmFuc3BvcnQgY2xhc3MgdGhhdCBjYW4gYmUgdXNlZCB3aXRoIEdlY2tvLWJyb3dzZXIgYXMgdGhlc2UgYWxsb3cgcGFzc2luZyB2YXJpYWJsZXMgdXNpbmcgdGhlIGZyYW1lRWxlbWVudCBwcm9wZXJ0eS48YnIvPg0KICogU2VjdXJpdHkgaXMgbWFpbnRhaW5lZCBhcyBHZWNobyB1c2VzIExleGljYWwgQXV0aG9yaXphdGlvbiB0byBkZXRlcm1pbmUgdW5kZXIgd2hpY2ggc2NvcGUgYSBmdW5jdGlvbiBpcyBydW5uaW5nLg0KICogQG5hbWVzcGFjZSBlYXN5WERNLnN0YWNrDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgVGhlIHRyYW5zcG9ydHMgY29uZmlndXJhdGlvbi4NCiAqIEBjZmcge1N0cmluZ30gcmVtb3RlIFRoZSByZW1vdGUgZG9jdW1lbnQgdG8gY29tbXVuaWNhdGUgd2l0aC4NCiAqLw0KZWFzeVhETS5zdGFjay5GcmFtZUVsZW1lbnRUcmFuc3BvcnQgPSBmdW5jdGlvbihjb25maWcpew0KICAgIHZhciB0cmFjZSA9IGRlYnVnLmdldFRyYWNlcigiZWFzeVhETS5zdGFjay5GcmFtZUVsZW1lbnRUcmFuc3BvcnQiKTsNCiAgICB0cmFjZSgiY29uc3RydWN0b3IiKTsNCiAgICB2YXIgcHViLCBmcmFtZSwgc2VuZCwgdGFyZ2V0T3JpZ2luOw0KICAgIA0KICAgIHJldHVybiAocHViID0gew0KICAgICAgICBvdXRnb2luZzogZnVuY3Rpb24obWVzc2FnZSwgZG9tYWluLCBmbil7DQogICAgICAgICAgICBzZW5kLmNhbGwodGhpcywgbWVzc2FnZSk7DQogICAgICAgICAgICBpZiAoZm4pIHsNCiAgICAgICAgICAgICAgICBmbigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpew0KICAgICAgICAgICAgdHJhY2UoImRlc3Ryb3kiKTsNCiAgICAgICAgICAgIGlmIChmcmFtZSkgew0KICAgICAgICAgICAgICAgIGZyYW1lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZnJhbWUpOw0KICAgICAgICAgICAgICAgIGZyYW1lID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgb25ET01SZWFkeTogZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIHRyYWNlKCJpbml0Iik7DQogICAgICAgICAgICB0YXJnZXRPcmlnaW4gPSBnZXRMb2NhdGlvbihjb25maWcucmVtb3RlKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKGNvbmZpZy5pc0hvc3QpIHsNCiAgICAgICAgICAgICAgICAvLyBzZXQgdXAgdGhlIGlmcmFtZQ0KICAgICAgICAgICAgICAgIGFwcGx5KGNvbmZpZy5wcm9wcywgew0KICAgICAgICAgICAgICAgICAgICBzcmM6IGFwcGVuZFF1ZXJ5UGFyYW1ldGVycyhjb25maWcucmVtb3RlLCB7DQogICAgICAgICAgICAgICAgICAgICAgICB4ZG1fZTogZ2V0TG9jYXRpb24obG9jYXRpb24uaHJlZiksDQogICAgICAgICAgICAgICAgICAgICAgICB4ZG1fYzogY29uZmlnLmNoYW5uZWwsDQogICAgICAgICAgICAgICAgICAgICAgICB4ZG1fcDogNSAvLyA1ID0gRnJhbWVFbGVtZW50VHJhbnNwb3J0DQogICAgICAgICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICAgICAgICBuYW1lOiBJRlJBTUVfUFJFRklYICsgY29uZmlnLmNoYW5uZWwgKyAiX3Byb3ZpZGVyIg0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGZyYW1lID0gY3JlYXRlRnJhbWUoY29uZmlnKTsNCiAgICAgICAgICAgICAgICBmcmFtZS5mbiA9IGZ1bmN0aW9uKHNlbmRGbil7DQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBmcmFtZS5mbjsNCiAgICAgICAgICAgICAgICAgICAgc2VuZCA9IHNlbmRGbjsNCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICAgICAgICAgcHViLnVwLmNhbGxiYWNrKHRydWUpOw0KICAgICAgICAgICAgICAgICAgICB9LCAwKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHRoZSBmdW5jdGlvbiBzbyB0aGF0IGl0IGNhbm5vdCBiZSB1c2VkIHRvIG92ZXJ3cml0ZSB0aGUgc2VuZCBmdW5jdGlvbiBsYXRlciBvbg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24obXNnKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHB1Yi51cC5pbmNvbWluZyhtc2csIHRhcmdldE9yaWdpbik7DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdG8gbWl0aWdhdGUgb3JpZ2luLXNwb29maW5nDQogICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LnJlZmVycmVyICYmIGdldExvY2F0aW9uKGRvY3VtZW50LnJlZmVycmVyKSAhPSBxdWVyeS54ZG1fZSkgew0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cudG9wLmxvY2F0aW9uID0gcXVlcnkueGRtX2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNlbmQgPSB3aW5kb3cuZnJhbWVFbGVtZW50LmZuKGZ1bmN0aW9uKG1zZyl7DQogICAgICAgICAgICAgICAgICAgIHB1Yi51cC5pbmNvbWluZyhtc2csIHRhcmdldE9yaWdpbik7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgcHViLnVwLmNhbGxiYWNrKHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBpbml0OiBmdW5jdGlvbigpew0KICAgICAgICAgICAgd2hlblJlYWR5KHB1Yi5vbkRPTVJlYWR5LCBwdWIpOw0KICAgICAgICB9DQogICAgfSk7DQp9Ow0KLypqc2xpbnQgZXZpbDogdHJ1ZSwgYnJvd3NlcjogdHJ1ZSwgaW1tZWQ6IHRydWUsIHBhc3NmYWlsOiB0cnVlLCB1bmRlZjogdHJ1ZSwgbmV3Y2FwOiB0cnVlKi8NCi8qZ2xvYmFsIGVhc3lYRE0sIHdpbmRvdywgZXNjYXBlLCB1bmVzY2FwZSwgdW5kZWYsIGdldExvY2F0aW9uLCBhcHBlbmRRdWVyeVBhcmFtZXRlcnMsIHJlc29sdmVVcmwsIGNyZWF0ZUZyYW1lLCBkZWJ1ZywgdW4sIGFwcGx5LCB3aGVuUmVhZHksIElGUkFNRV9QUkVGSVgqLw0KLy8NCi8vIGVhc3lYRE0NCi8vIGh0dHA6Ly9lYXN5eGRtLm5ldC8NCi8vIENvcHlyaWdodChjKSAyMDA5LTIwMTEsIMOYeXZpbmQgU2VhbiBLaW5zZXksIG95dmluZEBraW5zZXkubm8uDQovLw0KLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQ0KLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwNCi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMNCi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwNCi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcw0KLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoNCi8vDQovLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbg0KLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuDQovLw0KLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1INCi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLA0KLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFDQovLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSDQovLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLA0KLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTg0KLy8gVEhFIFNPRlRXQVJFLg0KLy8NCg0KLyoqDQogKiBAY2xhc3MgZWFzeVhETS5zdGFjay5OYW1lVHJhbnNwb3J0DQogKiBOYW1lVHJhbnNwb3J0IHVzZXMgdGhlIHdpbmRvdy5uYW1lIHByb3BlcnR5IHRvIHJlbGF5IGRhdGEuDQogKiBUaGUgPGNvZGU+bG9jYWw8L2NvZGU+IHBhcmFtZXRlciBuZWVkcyB0byBiZSBzZXQgb24gYm90aCB0aGUgY29uc3VtZXIgYW5kIHByb3ZpZGVyLDxici8+DQogKiBhbmQgdGhlIDxjb2RlPnJlbW90ZUhlbHBlcjwvY29kZT4gcGFyYW1ldGVyIG5lZWRzIHRvIGJlIHNldCBvbiB0aGUgY29uc3VtZXIuDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgVGhlIHRyYW5zcG9ydHMgY29uZmlndXJhdGlvbi4NCiAqIEBjZmcge1N0cmluZ30gcmVtb3RlSGVscGVyIFRoZSB1cmwgdG8gdGhlIHJlbW90ZSBpbnN0YW5jZSBvZiBoYXNoLmh0bWwgLSB0aGlzIGlzIG9ubHkgbmVlZGVkIGZvciB0aGUgaG9zdC4NCiAqIEBuYW1lc3BhY2UgZWFzeVhETS5zdGFjaw0KICovDQplYXN5WERNLnN0YWNrLk5hbWVUcmFuc3BvcnQgPSBmdW5jdGlvbihjb25maWcpew0KICAgIHZhciB0cmFjZSA9IGRlYnVnLmdldFRyYWNlcigiZWFzeVhETS5zdGFjay5OYW1lVHJhbnNwb3J0Iik7DQogICAgdHJhY2UoImNvbnN0cnVjdG9yIik7DQogICAgaWYgKGNvbmZpZy5pc0hvc3QgJiYgdW5kZWYoY29uZmlnLnJlbW90ZUhlbHBlcikpIHsNCiAgICAgICAgdHJhY2UoIm1pc3NpbmcgcmVtb3RlSGVscGVyIik7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigibWlzc2luZyByZW1vdGVIZWxwZXIiKTsNCiAgICB9DQogICAgDQogICAgdmFyIHB1YjsgLy8gdGhlIHB1YmxpYyBpbnRlcmZhY2UNCiAgICB2YXIgaXNIb3N0LCBjYWxsZXJXaW5kb3csIHJlbW90ZVdpbmRvdywgcmVhZHlDb3VudCwgY2FsbGJhY2ssIHJlbW90ZU9yaWdpbiwgcmVtb3RlVXJsOw0KICAgIA0KICAgIGZ1bmN0aW9uIF9zZW5kTWVzc2FnZShtZXNzYWdlKXsNCiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5yZW1vdGVIZWxwZXIgKyAoaXNIb3N0ID8gIiNfMyIgOiAiI18yIikgKyBjb25maWcuY2hhbm5lbDsNCiAgICAgICAgdHJhY2UoInNlbmRpbmcgbWVzc2FnZSAiICsgbWVzc2FnZSk7DQogICAgICAgIHRyYWNlKCJuYXZpZ2F0aW5nIHRvICAnIiArIHVybCArICInIik7DQogICAgICAgIGNhbGxlcldpbmRvdy5jb250ZW50V2luZG93LnNlbmRNZXNzYWdlKG1lc3NhZ2UsIHVybCk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIF9vblJlYWR5KCl7DQogICAgICAgIGlmIChpc0hvc3QpIHsNCiAgICAgICAgICAgIGlmICgrK3JlYWR5Q291bnQgPT09IDIgfHwgIWlzSG9zdCkgew0KICAgICAgICAgICAgICAgIHB1Yi51cC5jYWxsYmFjayh0cnVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIF9zZW5kTWVzc2FnZSgicmVhZHkiKTsNCiAgICAgICAgICAgIHRyYWNlKCJjYWxsaW5nIG9uUmVhZHkiKTsNCiAgICAgICAgICAgIHB1Yi51cC5jYWxsYmFjayh0cnVlKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBfb25NZXNzYWdlKG1lc3NhZ2Upew0KICAgICAgICB0cmFjZSgicmVjZWl2ZWQgbWVzc2FnZSAiICsgbWVzc2FnZSk7DQogICAgICAgIHB1Yi51cC5pbmNvbWluZyhtZXNzYWdlLCByZW1vdGVPcmlnaW4pOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBfb25Mb2FkKCl7DQogICAgICAgIGlmIChjYWxsYmFjaykgew0KICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgIGNhbGxiYWNrKHRydWUpOw0KICAgICAgICAgICAgfSwgMCk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgcmV0dXJuIChwdWIgPSB7DQogICAgICAgIG91dGdvaW5nOiBmdW5jdGlvbihtZXNzYWdlLCBkb21haW4sIGZuKXsNCiAgICAgICAgICAgIGNhbGxiYWNrID0gZm47DQogICAgICAgICAgICBfc2VuZE1lc3NhZ2UobWVzc2FnZSk7DQogICAgICAgIH0sDQogICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICB0cmFjZSgiZGVzdHJveSIpOw0KICAgICAgICAgICAgY2FsbGVyV2luZG93LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoY2FsbGVyV2luZG93KTsNCiAgICAgICAgICAgIGNhbGxlcldpbmRvdyA9IG51bGw7DQogICAgICAgICAgICBpZiAoaXNIb3N0KSB7DQogICAgICAgICAgICAgICAgcmVtb3RlV2luZG93LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocmVtb3RlV2luZG93KTsNCiAgICAgICAgICAgICAgICByZW1vdGVXaW5kb3cgPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBvbkRPTVJlYWR5OiBmdW5jdGlvbigpew0KICAgICAgICAgICAgdHJhY2UoImluaXQiKTsNCiAgICAgICAgICAgIGlzSG9zdCA9IGNvbmZpZy5pc0hvc3Q7DQogICAgICAgICAgICByZWFkeUNvdW50ID0gMDsNCiAgICAgICAgICAgIHJlbW90ZU9yaWdpbiA9IGdldExvY2F0aW9uKGNvbmZpZy5yZW1vdGUpOw0KICAgICAgICAgICAgY29uZmlnLmxvY2FsID0gcmVzb2x2ZVVybChjb25maWcubG9jYWwpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoaXNIb3N0KSB7DQogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGNhbGxiYWNrDQogICAgICAgICAgICAgICAgZWFzeVhETS5Gbi5zZXQoY29uZmlnLmNoYW5uZWwsIGZ1bmN0aW9uKG1lc3NhZ2Upew0KICAgICAgICAgICAgICAgICAgICB0cmFjZSgicmVjZWl2ZWQgaW5pdGlhbCBtZXNzYWdlICIgKyBtZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzSG9zdCAmJiBtZXNzYWdlID09PSAicmVhZHkiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIHRoZSBoYW5kbGVyDQogICAgICAgICAgICAgICAgICAgICAgICBlYXN5WERNLkZuLnNldChjb25maWcuY2hhbm5lbCwgX29uTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBfb25SZWFkeSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gU2V0IHVwIHRoZSBmcmFtZSB0aGF0IHBvaW50cyB0byB0aGUgcmVtb3RlIGluc3RhbmNlDQogICAgICAgICAgICAgICAgcmVtb3RlVXJsID0gYXBwZW5kUXVlcnlQYXJhbWV0ZXJzKGNvbmZpZy5yZW1vdGUsIHsNCiAgICAgICAgICAgICAgICAgICAgeGRtX2U6IGNvbmZpZy5sb2NhbCwNCiAgICAgICAgICAgICAgICAgICAgeGRtX2M6IGNvbmZpZy5jaGFubmVsLA0KICAgICAgICAgICAgICAgICAgICB4ZG1fcDogMg0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGFwcGx5KGNvbmZpZy5wcm9wcywgew0KICAgICAgICAgICAgICAgICAgICBzcmM6IHJlbW90ZVVybCArICcjJyArIGNvbmZpZy5jaGFubmVsLA0KICAgICAgICAgICAgICAgICAgICBuYW1lOiBJRlJBTUVfUFJFRklYICsgY29uZmlnLmNoYW5uZWwgKyAiX3Byb3ZpZGVyIg0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHJlbW90ZVdpbmRvdyA9IGNyZWF0ZUZyYW1lKGNvbmZpZyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25maWcucmVtb3RlSGVscGVyID0gY29uZmlnLnJlbW90ZTsNCiAgICAgICAgICAgICAgICBlYXN5WERNLkZuLnNldChjb25maWcuY2hhbm5lbCwgX29uTWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBTZXQgdXAgdGhlIGlmcmFtZSB0aGF0IHdpbGwgYmUgdXNlZCBmb3IgdGhlIHRyYW5zcG9ydA0KICAgICAgICAgICAgDQogICAgICAgICAgICBjYWxsZXJXaW5kb3cgPSBjcmVhdGVGcmFtZSh7DQogICAgICAgICAgICAgICAgcHJvcHM6IHsNCiAgICAgICAgICAgICAgICAgICAgc3JjOiBjb25maWcubG9jYWwgKyAiI180IiArIGNvbmZpZy5jaGFubmVsDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBvbkxvYWQ6IGZ1bmN0aW9uIG9uTG9hZCgpew0KICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGhhbmRsZXINCiAgICAgICAgICAgICAgICAgICAgdmFyIHcgPSBjYWxsZXJXaW5kb3cgfHwgdGhpczsNCiAgICAgICAgICAgICAgICAgICAgdW4odywgImxvYWQiLCBvbkxvYWQpOw0KICAgICAgICAgICAgICAgICAgICBlYXN5WERNLkZuLnNldChjb25maWcuY2hhbm5lbCArICJfbG9hZCIsIF9vbkxvYWQpOw0KICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gdGVzdCgpew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3LmNvbnRlbnRXaW5kb3cuc2VuZE1lc3NhZ2UgPT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vblJlYWR5KCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHRlc3QsIDUwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSgpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSwNCiAgICAgICAgaW5pdDogZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIHdoZW5SZWFkeShwdWIub25ET01SZWFkeSwgcHViKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfTsNCi8qanNsaW50IGV2aWw6IHRydWUsIGJyb3dzZXI6IHRydWUsIGltbWVkOiB0cnVlLCBwYXNzZmFpbDogdHJ1ZSwgdW5kZWY6IHRydWUsIG5ld2NhcDogdHJ1ZSovDQovKmdsb2JhbCBlYXN5WERNLCB3aW5kb3csIGVzY2FwZSwgdW5lc2NhcGUsIGdldExvY2F0aW9uLCBjcmVhdGVGcmFtZSwgZGVidWcsIHVuLCBvbiwgYXBwbHksIHdoZW5SZWFkeSwgSUZSQU1FX1BSRUZJWCovDQovLw0KLy8gZWFzeVhETQ0KLy8gaHR0cDovL2Vhc3l4ZG0ubmV0Lw0KLy8gQ29weXJpZ2h0KGMpIDIwMDktMjAxMSwgw5h5dmluZCBTZWFuIEtpbnNleSwgb3l2aW5kQGtpbnNleS5uby4NCi8vDQovLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5DQovLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbA0KLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cw0KLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbA0KLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzDQovLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOg0KLy8NCi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluDQovLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCi8vDQovLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUg0KLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksDQovLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUNCi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVINCi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sDQovLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElODQovLyBUSEUgU09GVFdBUkUuDQovLw0KDQovKioNCiAqIEBjbGFzcyBlYXN5WERNLnN0YWNrLkhhc2hUcmFuc3BvcnQNCiAqIEhhc2hUcmFuc3BvcnQgaXMgYSB0cmFuc3BvcnQgY2xhc3MgdGhhdCB1c2VzIHRoZSBJRnJhbWUgVVJMIFRlY2huaXF1ZSBmb3IgY29tbXVuaWNhdGlvbi48YnIvPg0KICogPGEgaHJlZj0iaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2JiNzM1MzA1LmFzcHgiPmh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9iYjczNTMwNS5hc3B4PC9hPjxici8+DQogKiBAbmFtZXNwYWNlIGVhc3lYRE0uc3RhY2sNCiAqIEBjb25zdHJ1Y3Rvcg0KICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBUaGUgdHJhbnNwb3J0cyBjb25maWd1cmF0aW9uLg0KICogQGNmZyB7U3RyaW5nL1dpbmRvd30gbG9jYWwgVGhlIHVybCB0byB0aGUgbG9jYWwgZmlsZSB1c2VkIGZvciBwcm94eWluZyBtZXNzYWdlcywgb3IgdGhlIGxvY2FsIHdpbmRvdy4NCiAqIEBjZmcge051bWJlcn0gZGVsYXkgVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgZWFzeVhETSBzaG91bGQgdHJ5IHRvIGdldCBhIHJlZmVyZW5jZSB0byB0aGUgbG9jYWwgd2luZG93Lg0KICogQGNmZyB7TnVtYmVyfSBpbnRlcnZhbCBUaGUgaW50ZXJ2YWwgdXNlZCB3aGVuIHBvbGxpbmcgZm9yIG1lc3NhZ2VzLg0KICovDQplYXN5WERNLnN0YWNrLkhhc2hUcmFuc3BvcnQgPSBmdW5jdGlvbihjb25maWcpew0KICAgIHZhciB0cmFjZSA9IGRlYnVnLmdldFRyYWNlcigiZWFzeVhETS5zdGFjay5IYXNoVHJhbnNwb3J0Iik7DQogICAgdHJhY2UoImNvbnN0cnVjdG9yIik7DQogICAgdmFyIHB1YjsNCiAgICB2YXIgbWUgPSB0aGlzLCBpc0hvc3QsIF90aW1lciwgcG9sbEludGVydmFsLCBfbGFzdE1zZywgX21zZ05yLCBfbGlzdGVuZXJXaW5kb3csIF9jYWxsZXJXaW5kb3c7DQogICAgdmFyIHVzZVBhcmVudCwgX3JlbW90ZU9yaWdpbjsNCiAgICANCiAgICBmdW5jdGlvbiBfc2VuZE1lc3NhZ2UobWVzc2FnZSl7DQogICAgICAgIHRyYWNlKCJzZW5kaW5nIG1lc3NhZ2UgJyIgKyAoX21zZ05yICsgMSkgKyAiICIgKyBtZXNzYWdlICsgIicgdG8gIiArIF9yZW1vdGVPcmlnaW4pOw0KICAgICAgICBpZiAoIV9jYWxsZXJXaW5kb3cpIHsNCiAgICAgICAgICAgIHRyYWNlKCJubyBjYWxsZXIgd2luZG93Iik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5yZW1vdGUgKyAiIyIgKyAoX21zZ05yKyspICsgIl8iICsgbWVzc2FnZTsNCiAgICAgICAgKChpc0hvc3QgfHwgIXVzZVBhcmVudCkgPyBfY2FsbGVyV2luZG93LmNvbnRlbnRXaW5kb3cgOiBfY2FsbGVyV2luZG93KS5sb2NhdGlvbiA9IHVybDsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gX2hhbmRsZUhhc2goaGFzaCl7DQogICAgICAgIF9sYXN0TXNnID0gaGFzaDsNCiAgICAgICAgdHJhY2UoInJlY2VpdmVkIG1lc3NhZ2UgJyIgKyBfbGFzdE1zZyArICInIGZyb20gIiArIF9yZW1vdGVPcmlnaW4pOw0KICAgICAgICBwdWIudXAuaW5jb21pbmcoX2xhc3RNc2cuc3Vic3RyaW5nKF9sYXN0TXNnLmluZGV4T2YoIl8iKSArIDEpLCBfcmVtb3RlT3JpZ2luKTsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogQ2hlY2tzIGxvY2F0aW9uLmhhc2ggZm9yIGEgbmV3IG1lc3NhZ2UgYW5kIHJlbGF5cyB0aGlzIHRvIHRoZSByZWNlaXZlci4NCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIF9wb2xsSGFzaCgpew0KICAgICAgICBpZiAoIV9saXN0ZW5lcldpbmRvdykgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHZhciBocmVmID0gX2xpc3RlbmVyV2luZG93LmxvY2F0aW9uLmhyZWYsIGhhc2ggPSAiIiwgaW5kZXhPZiA9IGhyZWYuaW5kZXhPZigiIyIpOw0KICAgICAgICBpZiAoaW5kZXhPZiAhPSAtMSkgew0KICAgICAgICAgICAgaGFzaCA9IGhyZWYuc3Vic3RyaW5nKGluZGV4T2YpOw0KICAgICAgICB9DQogICAgICAgIGlmIChoYXNoICYmIGhhc2ggIT0gX2xhc3RNc2cpIHsNCiAgICAgICAgICAgIHRyYWNlKCJwb2xsOiBuZXcgbWVzc2FnZSIpOw0KICAgICAgICAgICAgX2hhbmRsZUhhc2goaGFzaCk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gX2F0dGFjaExpc3RlbmVycygpew0KICAgICAgICB0cmFjZSgic3RhcnRpbmcgcG9sbGluZyIpOw0KICAgICAgICBfdGltZXIgPSBzZXRJbnRlcnZhbChfcG9sbEhhc2gsIHBvbGxJbnRlcnZhbCk7DQogICAgfQ0KICAgIA0KICAgIHJldHVybiAocHViID0gew0KICAgICAgICBvdXRnb2luZzogZnVuY3Rpb24obWVzc2FnZSwgZG9tYWluKXsNCiAgICAgICAgICAgIF9zZW5kTWVzc2FnZShtZXNzYWdlKTsNCiAgICAgICAgfSwNCiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKF90aW1lcik7DQogICAgICAgICAgICBpZiAoaXNIb3N0IHx8ICF1c2VQYXJlbnQpIHsNCiAgICAgICAgICAgICAgICBfY2FsbGVyV2luZG93LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoX2NhbGxlcldpbmRvdyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfY2FsbGVyV2luZG93ID0gbnVsbDsNCiAgICAgICAgfSwNCiAgICAgICAgb25ET01SZWFkeTogZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIGlzSG9zdCA9IGNvbmZpZy5pc0hvc3Q7DQogICAgICAgICAgICBwb2xsSW50ZXJ2YWwgPSBjb25maWcuaW50ZXJ2YWw7DQogICAgICAgICAgICBfbGFzdE1zZyA9ICIjIiArIGNvbmZpZy5jaGFubmVsOw0KICAgICAgICAgICAgX21zZ05yID0gMDsNCiAgICAgICAgICAgIHVzZVBhcmVudCA9IGNvbmZpZy51c2VQYXJlbnQ7DQogICAgICAgICAgICBfcmVtb3RlT3JpZ2luID0gZ2V0TG9jYXRpb24oY29uZmlnLnJlbW90ZSk7DQogICAgICAgICAgICBpZiAoaXNIb3N0KSB7DQogICAgICAgICAgICAgICAgY29uZmlnLnByb3BzID0gew0KICAgICAgICAgICAgICAgICAgICBzcmM6IGNvbmZpZy5yZW1vdGUsDQogICAgICAgICAgICAgICAgICAgIG5hbWU6IElGUkFNRV9QUkVGSVggKyBjb25maWcuY2hhbm5lbCArICJfcHJvdmlkZXIiDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBpZiAodXNlUGFyZW50KSB7DQogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5vbkxvYWQgPSBmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICAgICAgICAgX2xpc3RlbmVyV2luZG93ID0gd2luZG93Ow0KICAgICAgICAgICAgICAgICAgICAgICAgX2F0dGFjaExpc3RlbmVycygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcHViLnVwLmNhbGxiYWNrKHRydWUpOw0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHRyaWVzID0gMCwgbWF4ID0gY29uZmlnLmRlbGF5IC8gNTA7DQogICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiBnZXRSZWYoKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgrK3RyaWVzID4gbWF4KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2UoInVuYWJsZSB0byBnZXQgcmVmZXJlbmNlIHRvIF9saXN0ZW5lcldpbmRvdywgZ2l2aW5nIHVwIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmFibGUgdG8gcmVmZXJlbmNlIGxpc3RlbmVyd2luZG93Iik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9saXN0ZW5lcldpbmRvdyA9IF9jYWxsZXJXaW5kb3cuY29udGVudFdpbmRvdy5mcmFtZXNbSUZSQU1FX1BSRUZJWCArIGNvbmZpZy5jaGFubmVsICsgIl9jb25zdW1lciJdOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSANCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChleCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9saXN0ZW5lcldpbmRvdykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hdHRhY2hMaXN0ZW5lcnMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFjZSgiZ290IGEgcmVmZXJlbmNlIHRvIF9saXN0ZW5lcldpbmRvdyIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1Yi51cC5jYWxsYmFjayh0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZ2V0UmVmLCA1MCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0oKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIF9jYWxsZXJXaW5kb3cgPSBjcmVhdGVGcmFtZShjb25maWcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgX2xpc3RlbmVyV2luZG93ID0gd2luZG93Ow0KICAgICAgICAgICAgICAgIF9hdHRhY2hMaXN0ZW5lcnMoKTsNCiAgICAgICAgICAgICAgICBpZiAodXNlUGFyZW50KSB7DQogICAgICAgICAgICAgICAgICAgIF9jYWxsZXJXaW5kb3cgPSBwYXJlbnQ7DQogICAgICAgICAgICAgICAgICAgIHB1Yi51cC5jYWxsYmFjayh0cnVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGFwcGx5KGNvbmZpZywgew0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvcHM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmM6IGNvbmZpZy5yZW1vdGUgKyAiIyIgKyBjb25maWcuY2hhbm5lbCArIG5ldyBEYXRlKCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogSUZSQU1FX1BSRUZJWCArIGNvbmZpZy5jaGFubmVsICsgIl9jb25zdW1lciINCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICBvbkxvYWQ6IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHViLnVwLmNhbGxiYWNrKHRydWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgX2NhbGxlcldpbmRvdyA9IGNyZWF0ZUZyYW1lKGNvbmZpZyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBpbml0OiBmdW5jdGlvbigpew0KICAgICAgICAgICAgd2hlblJlYWR5KHB1Yi5vbkRPTVJlYWR5LCBwdWIpOw0KICAgICAgICB9DQogICAgfSk7DQp9Ow0KLypqc2xpbnQgZXZpbDogdHJ1ZSwgYnJvd3NlcjogdHJ1ZSwgaW1tZWQ6IHRydWUsIHBhc3NmYWlsOiB0cnVlLCB1bmRlZjogdHJ1ZSwgbmV3Y2FwOiB0cnVlKi8NCi8qZ2xvYmFsIGVhc3lYRE0sIHdpbmRvdywgZXNjYXBlLCB1bmVzY2FwZSwgZGVidWcgKi8NCi8vDQovLyBlYXN5WERNDQovLyBodHRwOi8vZWFzeXhkbS5uZXQvDQovLyBDb3B5cmlnaHQoYykgMjAwOS0yMDExLCDDmHl2aW5kIFNlYW4gS2luc2V5LCBveXZpbmRAa2luc2V5Lm5vLg0KLy8NCi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQovLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQovLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQovLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQovLw0KLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4NCi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KLy8NCi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQovLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4NCi8vIFRIRSBTT0ZUV0FSRS4NCi8vDQoNCi8qKg0KICogQGNsYXNzIGVhc3lYRE0uc3RhY2suUmVsaWFibGVCZWhhdmlvcg0KICogVGhpcyBpcyBhIGJlaGF2aW9yIHRoYXQgdHJpZXMgdG8gbWFrZSB0aGUgdW5kZXJseWluZyB0cmFuc3BvcnQgcmVsaWFibGUgYnkgdXNpbmcgYWNrbm93bGVkZ2VtZW50cy4NCiAqIEBuYW1lc3BhY2UgZWFzeVhETS5zdGFjaw0KICogQGNvbnN0cnVjdG9yDQogKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIFRoZSBiZWhhdmlvcnMgY29uZmlndXJhdGlvbi4NCiAqLw0KZWFzeVhETS5zdGFjay5SZWxpYWJsZUJlaGF2aW9yID0gZnVuY3Rpb24oY29uZmlnKXsNCiAgICB2YXIgdHJhY2UgPSBkZWJ1Zy5nZXRUcmFjZXIoImVhc3lYRE0uc3RhY2suUmVsaWFibGVCZWhhdmlvciIpOw0KICAgIHRyYWNlKCJjb25zdHJ1Y3RvciIpOw0KICAgIHZhciBwdWIsIC8vIHRoZSBwdWJsaWMgaW50ZXJmYWNlDQogY2FsbGJhY2s7IC8vIHRoZSBjYWxsYmFjayB0byBleGVjdXRlIHdoZW4gd2UgaGF2ZSBhIGNvbmZpcm1lZCBzdWNjZXNzL2ZhaWx1cmUNCiAgICB2YXIgaWRPdXQgPSAwLCBpZEluID0gMCwgY3VycmVudE1lc3NhZ2UgPSAiIjsNCiAgICANCiAgICByZXR1cm4gKHB1YiA9IHsNCiAgICAgICAgaW5jb21pbmc6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7DQogICAgICAgICAgICB0cmFjZSgiaW5jb21pbmc6ICIgKyBtZXNzYWdlKTsNCiAgICAgICAgICAgIHZhciBpbmRleE9mID0gbWVzc2FnZS5pbmRleE9mKCJfIiksIGFjayA9IG1lc3NhZ2Uuc3Vic3RyaW5nKDAsIGluZGV4T2YpLnNwbGl0KCIsIik7DQogICAgICAgICAgICBtZXNzYWdlID0gbWVzc2FnZS5zdWJzdHJpbmcoaW5kZXhPZiArIDEpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoYWNrWzBdID09IGlkT3V0KSB7DQogICAgICAgICAgICAgICAgdHJhY2UoIm1lc3NhZ2UgZGVsaXZlcmVkIik7DQogICAgICAgICAgICAgICAgY3VycmVudE1lc3NhZ2UgPSAiIjsNCiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHsNCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sodHJ1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG1lc3NhZ2UubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgIHRyYWNlKCJzZW5kaW5nIGFjaywgYW5kIHBhc3Npbmcgb24gIiArIG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIHB1Yi5kb3duLm91dGdvaW5nKGFja1sxXSArICIsIiArIGlkT3V0ICsgIl8iICsgY3VycmVudE1lc3NhZ2UsIG9yaWdpbik7DQogICAgICAgICAgICAgICAgaWYgKGlkSW4gIT0gYWNrWzFdKSB7DQogICAgICAgICAgICAgICAgICAgIGlkSW4gPSBhY2tbMV07DQogICAgICAgICAgICAgICAgICAgIHB1Yi51cC5pbmNvbWluZyhtZXNzYWdlLCBvcmlnaW4pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICB9LA0KICAgICAgICBvdXRnb2luZzogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luLCBmbil7DQogICAgICAgICAgICBjdXJyZW50TWVzc2FnZSA9IG1lc3NhZ2U7DQogICAgICAgICAgICBjYWxsYmFjayA9IGZuOw0KICAgICAgICAgICAgcHViLmRvd24ub3V0Z29pbmcoaWRJbiArICIsIiArICgrK2lkT3V0KSArICJfIiArIG1lc3NhZ2UsIG9yaWdpbik7DQogICAgICAgIH0NCiAgICB9KTsNCn07DQovKmpzbGludCBldmlsOiB0cnVlLCBicm93c2VyOiB0cnVlLCBpbW1lZDogdHJ1ZSwgcGFzc2ZhaWw6IHRydWUsIHVuZGVmOiB0cnVlLCBuZXdjYXA6IHRydWUqLw0KLypnbG9iYWwgZWFzeVhETSwgd2luZG93LCBlc2NhcGUsIHVuZXNjYXBlLCBkZWJ1ZywgdW5kZWYsIHJlbW92ZUZyb21TdGFjayovDQovLw0KLy8gZWFzeVhETQ0KLy8gaHR0cDovL2Vhc3l4ZG0ubmV0Lw0KLy8gQ29weXJpZ2h0KGMpIDIwMDktMjAxMSwgw5h5dmluZCBTZWFuIEtpbnNleSwgb3l2aW5kQGtpbnNleS5uby4NCi8vDQovLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5DQovLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbA0KLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cw0KLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbA0KLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzDQovLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOg0KLy8NCi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluDQovLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCi8vDQovLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUg0KLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksDQovLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUNCi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVINCi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sDQovLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElODQovLyBUSEUgU09GVFdBUkUuDQovLw0KDQovKioNCiAqIEBjbGFzcyBlYXN5WERNLnN0YWNrLlF1ZXVlQmVoYXZpb3INCiAqIFRoaXMgaXMgYSBiZWhhdmlvciB0aGF0IGVuYWJsZXMgcXVldWVpbmcgb2YgbWVzc2FnZXMuIDxici8+DQogKiBJdCB3aWxsIGJ1ZmZlciBpbmNvbWluZyBtZXNzYWdlcyBhbmQgZGlzcGFjaCB0aGVzZSBhcyBmYXN0IGFzIHRoZSB1bmRlcmx5aW5nIHRyYW5zcG9ydCBhbGxvd3MuDQogKiBUaGlzIHdpbGwgYWxzbyBmcmFnbWVudC9kZWZyYWdtZW50IG1lc3NhZ2VzIHNvIHRoYXQgdGhlIG91dGdvaW5nIG1lc3NhZ2UgaXMgbmV2ZXIgYmlnZ2VyIHRoYW4gdGhlDQogKiBzZXQgbGVuZ3RoLg0KICogQG5hbWVzcGFjZSBlYXN5WERNLnN0YWNrDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgVGhlIGJlaGF2aW9ycyBjb25maWd1cmF0aW9uLiBPcHRpb25hbC4NCiAqIEBjZmcge051bWJlcn0gbWF4TGVuZ3RoIFRoZSBtYXhpbXVtIGxlbmd0aCBvZiBlYWNoIG91dGdvaW5nIG1lc3NhZ2UuIFNldCB0aGlzIHRvIGVuYWJsZSBmcmFnbWVudGF0aW9uLg0KICovDQplYXN5WERNLnN0YWNrLlF1ZXVlQmVoYXZpb3IgPSBmdW5jdGlvbihjb25maWcpew0KICAgIHZhciB0cmFjZSA9IGRlYnVnLmdldFRyYWNlcigiZWFzeVhETS5zdGFjay5RdWV1ZUJlaGF2aW9yIik7DQogICAgdHJhY2UoImNvbnN0cnVjdG9yIik7DQogICAgdmFyIHB1YiwgcXVldWUgPSBbXSwgd2FpdGluZyA9IHRydWUsIGluY29taW5nID0gIiIsIGRlc3Ryb3lpbmcsIG1heExlbmd0aCA9IDAsIGxhenkgPSBmYWxzZSwgZG9GcmFnbWVudCA9IGZhbHNlOw0KICAgIA0KICAgIGZ1bmN0aW9uIGRpc3BhdGNoKCl7DQogICAgICAgIGlmIChjb25maWcucmVtb3ZlICYmIHF1ZXVlLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgdHJhY2UoInJlbW92aW5nIG15c2VsZiBmcm9tIHRoZSBzdGFjayIpOw0KICAgICAgICAgICAgcmVtb3ZlRnJvbVN0YWNrKHB1Yik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKHdhaXRpbmcgfHwgcXVldWUubGVuZ3RoID09PSAwIHx8IGRlc3Ryb3lpbmcpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0cmFjZSgiZGlzcGF0Y2hpbmcgZnJvbSBxdWV1ZSIpOw0KICAgICAgICB3YWl0aW5nID0gdHJ1ZTsNCiAgICAgICAgdmFyIG1lc3NhZ2UgPSBxdWV1ZS5zaGlmdCgpOw0KICAgICAgICANCiAgICAgICAgcHViLmRvd24ub3V0Z29pbmcobWVzc2FnZS5kYXRhLCBtZXNzYWdlLm9yaWdpbiwgZnVuY3Rpb24oc3VjY2Vzcyl7DQogICAgICAgICAgICB3YWl0aW5nID0gZmFsc2U7DQogICAgICAgICAgICBpZiAobWVzc2FnZS5jYWxsYmFjaykgew0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5jYWxsYmFjayhzdWNjZXNzKTsNCiAgICAgICAgICAgICAgICB9LCAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRpc3BhdGNoKCk7DQogICAgICAgIH0pOw0KICAgIH0NCiAgICByZXR1cm4gKHB1YiA9IHsNCiAgICAgICAgaW5pdDogZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIGlmICh1bmRlZihjb25maWcpKSB7DQogICAgICAgICAgICAgICAgY29uZmlnID0ge307DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY29uZmlnLm1heExlbmd0aCkgew0KICAgICAgICAgICAgICAgIG1heExlbmd0aCA9IGNvbmZpZy5tYXhMZW5ndGg7DQogICAgICAgICAgICAgICAgZG9GcmFnbWVudCA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY29uZmlnLmxhenkpIHsNCiAgICAgICAgICAgICAgICBsYXp5ID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHB1Yi5kb3duLmluaXQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKHN1Y2Nlc3Mpew0KICAgICAgICAgICAgd2FpdGluZyA9IGZhbHNlOw0KICAgICAgICAgICAgdmFyIHVwID0gcHViLnVwOyAvLyBpbiBjYXNlIGRpc3BhdGNoIGNhbGxzIHJlbW92ZUZyb21TdGFjaw0KICAgICAgICAgICAgZGlzcGF0Y2goKTsNCiAgICAgICAgICAgIHVwLmNhbGxiYWNrKHN1Y2Nlc3MpOw0KICAgICAgICB9LA0KICAgICAgICBpbmNvbWluZzogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsNCiAgICAgICAgICAgIGlmIChkb0ZyYWdtZW50KSB7DQogICAgICAgICAgICAgICAgdmFyIGluZGV4T2YgPSBtZXNzYWdlLmluZGV4T2YoIl8iKSwgc2VxID0gcGFyc2VJbnQobWVzc2FnZS5zdWJzdHJpbmcoMCwgaW5kZXhPZiksIDEwKTsNCiAgICAgICAgICAgICAgICBpbmNvbWluZyArPSBtZXNzYWdlLnN1YnN0cmluZyhpbmRleE9mICsgMSk7DQogICAgICAgICAgICAgICAgaWYgKHNlcSA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICB0cmFjZSgicmVjZWl2ZWQgdGhlIGxhc3QgZnJhZ21lbnQiKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5lbmNvZGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGluY29taW5nID0gZGVjb2RlVVJJQ29tcG9uZW50KGluY29taW5nKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBwdWIudXAuaW5jb21pbmcoaW5jb21pbmcsIG9yaWdpbik7DQogICAgICAgICAgICAgICAgICAgIGluY29taW5nID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0cmFjZSgid2FpdGluZyBmb3IgbW9yZSBmcmFnbWVudHMsIHNlcT0iICsgbWVzc2FnZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcHViLnVwLmluY29taW5nKG1lc3NhZ2UsIG9yaWdpbik7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIG91dGdvaW5nOiBmdW5jdGlvbihtZXNzYWdlLCBvcmlnaW4sIGZuKXsNCiAgICAgICAgICAgIGlmIChjb25maWcuZW5jb2RlKSB7DQogICAgICAgICAgICAgICAgbWVzc2FnZSA9IGVuY29kZVVSSUNvbXBvbmVudChtZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBmcmFnbWVudHMgPSBbXSwgZnJhZ21lbnQ7DQogICAgICAgICAgICBpZiAoZG9GcmFnbWVudCkgew0KICAgICAgICAgICAgICAgIC8vIGZyYWdtZW50IGludG8gY2h1bmtzDQogICAgICAgICAgICAgICAgd2hpbGUgKG1lc3NhZ2UubGVuZ3RoICE9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gbWVzc2FnZS5zdWJzdHJpbmcoMCwgbWF4TGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2Uuc3Vic3RyaW5nKGZyYWdtZW50Lmxlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgIGZyYWdtZW50cy5wdXNoKGZyYWdtZW50KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gZW5xdWV1ZSB0aGUgY2h1bmtzDQogICAgICAgICAgICAgICAgd2hpbGUgKChmcmFnbWVudCA9IGZyYWdtZW50cy5zaGlmdCgpKSkgew0KICAgICAgICAgICAgICAgICAgICB0cmFjZSgiZW5xdWV1aW5nIik7DQogICAgICAgICAgICAgICAgICAgIHF1ZXVlLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZnJhZ21lbnRzLmxlbmd0aCArICJfIiArIGZyYWdtZW50LA0KICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiBvcmlnaW4sDQogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogZnJhZ21lbnRzLmxlbmd0aCA9PT0gMCA/IGZuIDogbnVsbA0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBxdWV1ZS5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgZGF0YTogbWVzc2FnZSwNCiAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiBvcmlnaW4sDQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmbg0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGxhenkpIHsNCiAgICAgICAgICAgICAgICBwdWIuZG93bi5pbml0KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBkaXNwYXRjaCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpew0KICAgICAgICAgICAgdHJhY2UoImRlc3Ryb3kiKTsNCiAgICAgICAgICAgIGRlc3Ryb3lpbmcgPSB0cnVlOw0KICAgICAgICAgICAgcHViLmRvd24uZGVzdHJveSgpOw0KICAgICAgICB9DQogICAgfSk7DQp9Ow0KLypqc2xpbnQgZXZpbDogdHJ1ZSwgYnJvd3NlcjogdHJ1ZSwgaW1tZWQ6IHRydWUsIHBhc3NmYWlsOiB0cnVlLCB1bmRlZjogdHJ1ZSwgbmV3Y2FwOiB0cnVlKi8NCi8qZ2xvYmFsIGVhc3lYRE0sIHdpbmRvdywgZXNjYXBlLCB1bmVzY2FwZSwgdW5kZWYsIGRlYnVnICovDQovLw0KLy8gZWFzeVhETQ0KLy8gaHR0cDovL2Vhc3l4ZG0ubmV0Lw0KLy8gQ29weXJpZ2h0KGMpIDIwMDktMjAxMSwgw5h5dmluZCBTZWFuIEtpbnNleSwgb3l2aW5kQGtpbnNleS5uby4NCi8vDQovLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5DQovLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbA0KLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cw0KLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbA0KLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzDQovLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOg0KLy8NCi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluDQovLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCi8vDQovLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUg0KLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksDQovLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUNCi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVINCi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sDQovLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElODQovLyBUSEUgU09GVFdBUkUuDQovLw0KDQovKioNCiAqIEBjbGFzcyBlYXN5WERNLnN0YWNrLlZlcmlmeUJlaGF2aW9yDQogKiBUaGlzIGJlaGF2aW9yIHdpbGwgdmVyaWZ5IHRoYXQgY29tbXVuaWNhdGlvbiB3aXRoIHRoZSByZW1vdGUgZW5kIGlzIHBvc3NpYmxlLCBhbmQgd2lsbCBhbHNvIHNpZ24gYWxsIG91dGdvaW5nLA0KICogYW5kIHZlcmlmeSBhbGwgaW5jb21pbmcgbWVzc2FnZXMuIFRoaXMgcmVtb3ZlcyB0aGUgcmlzayBvZiBzb21lb25lIGhpamFja2luZyB0aGUgaWZyYW1lIHRvIHNlbmQgbWFsaWNpb3VzIG1lc3NhZ2VzLg0KICogQG5hbWVzcGFjZSBlYXN5WERNLnN0YWNrDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgVGhlIGJlaGF2aW9ycyBjb25maWd1cmF0aW9uLg0KICogQGNmZyB7Qm9vbGVhbn0gaW5pdGlhdGUgSWYgdGhlIHZlcmlmaWNhdGlvbiBzaG91bGQgYmUgaW5pdGlhdGVkIGZyb20gdGhpcyBlbmQuDQogKi8NCmVhc3lYRE0uc3RhY2suVmVyaWZ5QmVoYXZpb3IgPSBmdW5jdGlvbihjb25maWcpew0KICAgIHZhciB0cmFjZSA9IGRlYnVnLmdldFRyYWNlcigiZWFzeVhETS5zdGFjay5WZXJpZnlCZWhhdmlvciIpOw0KICAgIHRyYWNlKCJjb25zdHJ1Y3RvciIpOw0KICAgIGlmICh1bmRlZihjb25maWcuaW5pdGlhdGUpKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigic2V0dGluZ3MuaW5pdGlhdGUgaXMgbm90IHNldCIpOw0KICAgIH0NCiAgICB2YXIgcHViLCBteVNlY3JldCwgdGhlaXJTZWNyZXQsIHZlcmlmaWVkID0gZmFsc2U7DQogICAgDQogICAgZnVuY3Rpb24gc3RhcnRWZXJpZmljYXRpb24oKXsNCiAgICAgICAgdHJhY2UoInJlcXVlc3RpbmcgdmVyaWZpY2F0aW9uIik7DQogICAgICAgIG15U2VjcmV0ID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDIpOw0KICAgICAgICBwdWIuZG93bi5vdXRnb2luZyhteVNlY3JldCk7DQogICAgfQ0KICAgIA0KICAgIHJldHVybiAocHViID0gew0KICAgICAgICBpbmNvbWluZzogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsNCiAgICAgICAgICAgIHZhciBpbmRleE9mID0gbWVzc2FnZS5pbmRleE9mKCJfIik7DQogICAgICAgICAgICBpZiAoaW5kZXhPZiA9PT0gLTEpIHsNCiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZSA9PT0gbXlTZWNyZXQpIHsNCiAgICAgICAgICAgICAgICAgICAgdHJhY2UoInZlcmlmaWVkLCBjYWxsaW5nIGNhbGxiYWNrIik7DQogICAgICAgICAgICAgICAgICAgIHB1Yi51cC5jYWxsYmFjayh0cnVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoIXRoZWlyU2VjcmV0KSB7DQogICAgICAgICAgICAgICAgICAgIHRyYWNlKCJyZXR1cm5pbmcgc2VjcmV0Iik7DQogICAgICAgICAgICAgICAgICAgIHRoZWlyU2VjcmV0ID0gbWVzc2FnZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25maWcuaW5pdGlhdGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0VmVyaWZpY2F0aW9uKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcHViLmRvd24ub3V0Z29pbmcobWVzc2FnZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc3Vic3RyaW5nKDAsIGluZGV4T2YpID09PSB0aGVpclNlY3JldCkgew0KICAgICAgICAgICAgICAgICAgICBwdWIudXAuaW5jb21pbmcobWVzc2FnZS5zdWJzdHJpbmcoaW5kZXhPZiArIDEpLCBvcmlnaW4pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgb3V0Z29pbmc6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbiwgZm4pew0KICAgICAgICAgICAgcHViLmRvd24ub3V0Z29pbmcobXlTZWNyZXQgKyAiXyIgKyBtZXNzYWdlLCBvcmlnaW4sIGZuKTsNCiAgICAgICAgfSwNCiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKHN1Y2Nlc3Mpew0KICAgICAgICAgICAgaWYgKGNvbmZpZy5pbml0aWF0ZSkgew0KICAgICAgICAgICAgICAgIHN0YXJ0VmVyaWZpY2F0aW9uKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9KTsNCn07DQovKmpzbGludCBldmlsOiB0cnVlLCBicm93c2VyOiB0cnVlLCBpbW1lZDogdHJ1ZSwgcGFzc2ZhaWw6IHRydWUsIHVuZGVmOiB0cnVlLCBuZXdjYXA6IHRydWUqLw0KLypnbG9iYWwgZWFzeVhETSwgd2luZG93LCBlc2NhcGUsIHVuZXNjYXBlLCB1bmRlZiwgZ2V0SlNPTiwgZGVidWcsIGVtcHR5Rm4sIGlzQXJyYXkgKi8NCi8vDQovLyBlYXN5WERNDQovLyBodHRwOi8vZWFzeXhkbS5uZXQvDQovLyBDb3B5cmlnaHQoYykgMjAwOS0yMDExLCDDmHl2aW5kIFNlYW4gS2luc2V5LCBveXZpbmRAa2luc2V5Lm5vLg0KLy8NCi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQovLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQovLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQovLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQovLw0KLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4NCi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KLy8NCi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQovLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4NCi8vIFRIRSBTT0ZUV0FSRS4NCi8vDQoNCi8qKg0KICogQGNsYXNzIGVhc3lYRE0uc3RhY2suUnBjQmVoYXZpb3INCiAqIFRoaXMgdXNlcyBKU09OLVJQQyAyLjAgdG8gZXhwb3NlIGxvY2FsIG1ldGhvZHMgYW5kIHRvIGludm9rZSByZW1vdGUgbWV0aG9kcyBhbmQgaGF2ZSByZXNwb25zZXMgcmV0dXJuZWQgb3ZlciB0aGUgdGhlIHN0cmluZyBiYXNlZCB0cmFuc3BvcnQgc3RhY2suPGJyLz4NCiAqIEV4cG9zZWQgbWV0aG9kcyBjYW4gcmV0dXJuIHZhbHVlcyBzeW5jaHJvbm91cywgYXN5bmNyb25vdXMsIG9yIGJldCBzZXQgdXAgdG8gbm90IHJldHVybiBhbnl0aGluZy4NCiAqIEBuYW1lc3BhY2UgZWFzeVhETS5zdGFjaw0KICogQGNvbnN0cnVjdG9yDQogKiBAcGFyYW0ge09iamVjdH0gcHJveHkgVGhlIG9iamVjdCB0byBhcHBseSB0aGUgbWV0aG9kcyB0by4NCiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgVGhlIGRlZmluaXRpb24gb2YgdGhlIGxvY2FsIGFuZCByZW1vdGUgaW50ZXJmYWNlIHRvIGltcGxlbWVudC4NCiAqIEBjZmcge09iamVjdH0gbG9jYWwgVGhlIGxvY2FsIGludGVyZmFjZSB0byBleHBvc2UuDQogKiBAY2ZnIHtPYmplY3R9IHJlbW90ZSBUaGUgcmVtb3RlIG1ldGhvZHMgdG8gZXhwb3NlIHRocm91Z2ggdGhlIHByb3h5Lg0KICogQGNmZyB7T2JqZWN0fSBzZXJpYWxpemVyIFRoZSBzZXJpYWxpemVyIHRvIHVzZSBmb3Igc2VyaWFsaXppbmcgYW5kIGRlc2VyaWFsaXppbmcgdGhlIEpTT04uIFNob3VsZCBiZSBjb21wYXRpYmxlIHdpdGggdGhlIEhUTUw1IEpTT04gb2JqZWN0LiBPcHRpb25hbCwgd2lsbCBkZWZhdWx0IHRvIEpTT04uDQogKi8NCmVhc3lYRE0uc3RhY2suUnBjQmVoYXZpb3IgPSBmdW5jdGlvbihwcm94eSwgY29uZmlnKXsNCiAgICB2YXIgdHJhY2UgPSBkZWJ1Zy5nZXRUcmFjZXIoImVhc3lYRE0uc3RhY2suUnBjQmVoYXZpb3IiKTsNCiAgICB2YXIgcHViLCBzZXJpYWxpemVyID0gY29uZmlnLnNlcmlhbGl6ZXIgfHwgZ2V0SlNPTigpOw0KICAgIHZhciBfY2FsbGJhY2tDb3VudGVyID0gMCwgX2NhbGxiYWNrcyA9IHt9Ow0KICAgIA0KICAgIC8qKg0KICAgICAqIFNlcmlhbGl6ZXMgYW5kIHNlbmRzIHRoZSBtZXNzYWdlDQogICAgICogQHByaXZhdGUNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgSlNPTi1SUEMgbWVzc2FnZSB0byBiZSBzZW50LiBUaGUganNvbnJwYyBwcm9wZXJ0eSB3aWxsIGJlIGFkZGVkLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIF9zZW5kKGRhdGEpew0KICAgICAgICBkYXRhLmpzb25ycGMgPSAiMi4wIjsNCiAgICAgICAgcHViLmRvd24ub3V0Z29pbmcoc2VyaWFsaXplci5zdHJpbmdpZnkoZGF0YSkpOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgbWV0aG9kIHRoYXQgaW1wbGVtZW50cyB0aGUgZ2l2ZW4gZGVmaW5pdGlvbg0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtPYmplY3R9IFRoZSBtZXRob2QgY29uZmlndXJhdGlvbg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXRob2QgVGhlIG5hbWUgb2YgdGhlIG1ldGhvZA0KICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufSBBIHN0dWIgY2FwYWJsZSBvZiBwcm94eWluZyB0aGUgcmVxdWVzdGVkIG1ldGhvZCBjYWxsDQogICAgICovDQogICAgZnVuY3Rpb24gX2NyZWF0ZU1ldGhvZChkZWZpbml0aW9uLCBtZXRob2Qpew0KICAgICAgICB2YXIgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7DQogICAgICAgIA0KICAgICAgICB0cmFjZSgiY3JlYXRpbmcgbWV0aG9kICIgKyBtZXRob2QpOw0KICAgICAgICByZXR1cm4gZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIHRyYWNlKCJleGVjdXRpbmcgbWV0aG9kICIgKyBtZXRob2QpOw0KICAgICAgICAgICAgdmFyIGwgPSBhcmd1bWVudHMubGVuZ3RoLCBjYWxsYmFjaywgbWVzc2FnZSA9IHsNCiAgICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZA0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKGwgPiAwICYmIHR5cGVvZiBhcmd1bWVudHNbbCAtIDFdID09PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgICAgICAgLy93aXRoIGNhbGxiYWNrLCBwcm9jZWR1cmUNCiAgICAgICAgICAgICAgICBpZiAobCA+IDEgJiYgdHlwZW9mIGFyZ3VtZW50c1tsIC0gMl0gPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gdHdvIGNhbGxiYWNrcywgc3VjY2VzcyBhbmQgZXJyb3INCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBhcmd1bWVudHNbbCAtIDJdLA0KICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGFyZ3VtZW50c1tsIC0gMV0NCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5wYXJhbXMgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMCwgbCAtIDIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gc2luZ2xlIGNhbGxiYWNrLCBzdWNjZXNzDQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogYXJndW1lbnRzW2wgLSAxXQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnBhcmFtcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAwLCBsIC0gMSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIF9jYWxsYmFja3NbIiIgKyAoKytfY2FsbGJhY2tDb3VudGVyKV0gPSBjYWxsYmFjazsNCiAgICAgICAgICAgICAgICBtZXNzYWdlLmlkID0gX2NhbGxiYWNrQ291bnRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIG5vIGNhbGxiYWNrcywgYSBub3RpZmljYXRpb24NCiAgICAgICAgICAgICAgICBtZXNzYWdlLnBhcmFtcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkZWZpbml0aW9uLm5hbWVkUGFyYW1zICYmIG1lc3NhZ2UucGFyYW1zLmxlbmd0aCA9PT0gMSkgew0KICAgICAgICAgICAgICAgIG1lc3NhZ2UucGFyYW1zID0gbWVzc2FnZS5wYXJhbXNbMF07DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBTZW5kIHRoZSBtZXRob2QgcmVxdWVzdA0KICAgICAgICAgICAgX3NlbmQobWVzc2FnZSk7DQogICAgICAgIH07DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqIEV4ZWN1dGVzIHRoZSBleHBvc2VkIG1ldGhvZA0KICAgICAqIEBwcml2YXRlDQogICAgICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZCBUaGUgbmFtZSBvZiB0aGUgbWV0aG9kDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IGlkIFRoZSBjYWxsYmFjayBpZCB0byB1c2UNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBtZXRob2QgVGhlIGV4cG9zZWQgaW1wbGVtZW50YXRpb24NCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwYXJhbXMgVGhlIHBhcmFtZXRlcnMgc3VwcGxpZWQgYnkgdGhlIHJlbW90ZSBlbmQNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBfZXhlY3V0ZU1ldGhvZChtZXRob2QsIGlkLCBmbiwgcGFyYW1zKXsNCiAgICAgICAgaWYgKCFmbikgew0KICAgICAgICAgICAgdHJhY2UoInJlcXVlc3RlZCB0byBleGVjdXRlIG5vbi1leGlzdGVudCBwcm9jZWR1cmUgIiArIG1ldGhvZCk7DQogICAgICAgICAgICBpZiAoaWQpIHsNCiAgICAgICAgICAgICAgICBfc2VuZCh7DQogICAgICAgICAgICAgICAgICAgIGlkOiBpZCwNCiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IC0zMjYwMSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJQcm9jZWR1cmUgbm90IGZvdW5kLiINCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICB0cmFjZSgicmVxdWVzdGVkIHRvIGV4ZWN1dGUgcHJvY2VkdXJlICIgKyBtZXRob2QpOw0KICAgICAgICB2YXIgc3VjY2VzcywgZXJyb3I7DQogICAgICAgIGlmIChpZCkgew0KICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uKHJlc3VsdCl7DQogICAgICAgICAgICAgICAgc3VjY2VzcyA9IGVtcHR5Rm47DQogICAgICAgICAgICAgICAgX3NlbmQoew0KICAgICAgICAgICAgICAgICAgICBpZDogaWQsDQogICAgICAgICAgICAgICAgICAgIHJlc3VsdDogcmVzdWx0DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbihtZXNzYWdlLCBkYXRhKXsNCiAgICAgICAgICAgICAgICBlcnJvciA9IGVtcHR5Rm47DQogICAgICAgICAgICAgICAgdmFyIG1zZyA9IHsNCiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLA0KICAgICAgICAgICAgICAgICAgICBlcnJvcjogew0KICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogLTMyMDk5LA0KICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBpZiAoZGF0YSkgew0KICAgICAgICAgICAgICAgICAgICBtc2cuZXJyb3IuZGF0YSA9IGRhdGE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIF9zZW5kKG1zZyk7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgc3VjY2VzcyA9IGVycm9yID0gZW1wdHlGbjsNCiAgICAgICAgfQ0KICAgICAgICAvLyBDYWxsIGxvY2FsIG1ldGhvZA0KICAgICAgICBpZiAoIWlzQXJyYXkocGFyYW1zKSkgew0KICAgICAgICAgICAgcGFyYW1zID0gW3BhcmFtc107DQogICAgICAgIH0NCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHZhciByZXN1bHQgPSBmbi5tZXRob2QuYXBwbHkoZm4uc2NvcGUsIHBhcmFtcy5jb25jYXQoW3N1Y2Nlc3MsIGVycm9yXSkpOw0KICAgICAgICAgICAgaWYgKCF1bmRlZihyZXN1bHQpKSB7DQogICAgICAgICAgICAgICAgc3VjY2VzcyhyZXN1bHQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IA0KICAgICAgICBjYXRjaCAoZXgxKSB7DQogICAgICAgICAgICBlcnJvcihleDEubWVzc2FnZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgcmV0dXJuIChwdWIgPSB7DQogICAgICAgIGluY29taW5nOiBmdW5jdGlvbihtZXNzYWdlLCBvcmlnaW4pew0KICAgICAgICAgICAgdmFyIGRhdGEgPSBzZXJpYWxpemVyLnBhcnNlKG1lc3NhZ2UpOw0KICAgICAgICAgICAgaWYgKGRhdGEubWV0aG9kKSB7DQogICAgICAgICAgICAgICAgdHJhY2UoInJlY2VpdmVkIHJlcXVlc3QgdG8gZXhlY3V0ZSBtZXRob2QgIiArIGRhdGEubWV0aG9kICsgKGRhdGEuaWQgPyAoIiB1c2luZyBjYWxsYmFjayBpZCAiICsgZGF0YS5pZCkgOiAiIikpOw0KICAgICAgICAgICAgICAgIC8vIEEgbWV0aG9kIGNhbGwgZnJvbSB0aGUgcmVtb3RlIGVuZA0KICAgICAgICAgICAgICAgIGlmIChjb25maWcuaGFuZGxlKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5oYW5kbGUoZGF0YSwgX3NlbmQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgX2V4ZWN1dGVNZXRob2QoZGF0YS5tZXRob2QsIGRhdGEuaWQsIGNvbmZpZy5sb2NhbFtkYXRhLm1ldGhvZF0sIGRhdGEucGFyYW1zKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB0cmFjZSgicmVjZWl2ZWQgcmV0dXJuIHZhbHVlIGRlc3RpbmVkIHRvIGNhbGxiYWNrIHdpdGggaWQgIiArIGRhdGEuaWQpOw0KICAgICAgICAgICAgICAgIC8vIEEgbWV0aG9kIHJlc3BvbnNlIGZyb20gdGhlIG90aGVyIGVuZA0KICAgICAgICAgICAgICAgIHZhciBjYWxsYmFjayA9IF9jYWxsYmFja3NbZGF0YS5pZF07DQogICAgICAgICAgICAgICAgaWYgKGRhdGEuZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrLmVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5lcnJvcihkYXRhLmVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNlKCJ1bmhhbmRsZWQgZXJyb3IgcmV0dXJuZWQuIik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoY2FsbGJhY2suc3VjY2Vzcykgew0KICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5zdWNjZXNzKGRhdGEucmVzdWx0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZGVsZXRlIF9jYWxsYmFja3NbZGF0YS5pZF07DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGluaXQ6IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICB0cmFjZSgiaW5pdCIpOw0KICAgICAgICAgICAgaWYgKGNvbmZpZy5yZW1vdGUpIHsNCiAgICAgICAgICAgICAgICB0cmFjZSgiY3JlYXRpbmcgc3R1YnMiKTsNCiAgICAgICAgICAgICAgICAvLyBJbXBsZW1lbnQgdGhlIHJlbW90ZSBzaWRlcyBleHBvc2VkIG1ldGhvZHMNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBtZXRob2QgaW4gY29uZmlnLnJlbW90ZSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnLnJlbW90ZS5oYXNPd25Qcm9wZXJ0eShtZXRob2QpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwcm94eVttZXRob2RdID0gX2NyZWF0ZU1ldGhvZChjb25maWcucmVtb3RlW21ldGhvZF0sIG1ldGhvZCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBwdWIuZG93bi5pbml0KCk7DQogICAgICAgIH0sDQogICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICB0cmFjZSgiZGVzdHJveSIpOw0KICAgICAgICAgICAgZm9yICh2YXIgbWV0aG9kIGluIGNvbmZpZy5yZW1vdGUpIHsNCiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLnJlbW90ZS5oYXNPd25Qcm9wZXJ0eShtZXRob2QpICYmIHByb3h5Lmhhc093blByb3BlcnR5KG1ldGhvZCkpIHsNCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHByb3h5W21ldGhvZF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcHViLmRvd24uZGVzdHJveSgpOw0KICAgICAgICB9DQogICAgfSk7DQp9Ow0KZ2xvYmFsLmVhc3lYRE0gPSBlYXN5WERNOw0KfSkod2luZG93LCBkb2N1bWVudCwgbG9jYXRpb24sIHdpbmRvdy5zZXRUaW1lb3V0LCBkZWNvZGVVUklDb21wb25lbnQsIGVuY29kZVVSSUNvbXBvbmVudCk7DQo="
        },
        "xdm/jquery.min.js": {
            "content_type": "application/javascript",
            "data": "LyohCiAqIGpRdWVyeSBKYXZhU2NyaXB0IExpYnJhcnkgdjEuNi4yCiAqIGh0dHA6Ly9qcXVlcnkuY29tLwogKgogKiBDb3B5cmlnaHQgMjAxMSwgSm9obiBSZXNpZwogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBJbmNsdWRlcyBTaXp6bGUuanMKICogaHR0cDovL3NpenpsZWpzLmNvbS8KICogQ29weXJpZ2h0IDIwMTEsIFRoZSBEb2pvIEZvdW5kYXRpb24KICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCwgQlNELCBhbmQgR1BMIExpY2Vuc2VzLgogKgogKiBEYXRlOiBUaHUgSnVuIDMwIDE0OjE2OjU2IDIwMTEgLTA0MDAKICovCihmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGN2KGEpe3JldHVybiBmLmlzV2luZG93KGEpP2E6YS5ub2RlVHlwZT09PTk/YS5kZWZhdWx0Vmlld3x8YS5wYXJlbnRXaW5kb3c6ITF9ZnVuY3Rpb24gY3MoYSl7aWYoIWNnW2FdKXt2YXIgYj1jLmJvZHksZD1mKCI8IithKyI+IikuYXBwZW5kVG8oYiksZT1kLmNzcygiZGlzcGxheSIpO2QucmVtb3ZlKCk7aWYoZT09PSJub25lInx8ZT09PSIiKXtjaHx8KGNoPWMuY3JlYXRlRWxlbWVudCgiaWZyYW1lIiksY2guZnJhbWVCb3JkZXI9Y2gud2lkdGg9Y2guaGVpZ2h0PTApLGIuYXBwZW5kQ2hpbGQoY2gpO2lmKCFjaXx8IWNoLmNyZWF0ZUVsZW1lbnQpY2k9KGNoLmNvbnRlbnRXaW5kb3d8fGNoLmNvbnRlbnREb2N1bWVudCkuZG9jdW1lbnQsY2kud3JpdGUoKGMuY29tcGF0TW9kZT09PSJDU1MxQ29tcGF0Ij8iPCFkb2N0eXBlIGh0bWw+IjoiIikrIjxodG1sPjxib2R5PiIpLGNpLmNsb3NlKCk7ZD1jaS5jcmVhdGVFbGVtZW50KGEpLGNpLmJvZHkuYXBwZW5kQ2hpbGQoZCksZT1mLmNzcyhkLCJkaXNwbGF5IiksYi5yZW1vdmVDaGlsZChjaCl9Y2dbYV09ZX1yZXR1cm4gY2dbYV19ZnVuY3Rpb24gY3IoYSxiKXt2YXIgYz17fTtmLmVhY2goY20uY29uY2F0LmFwcGx5KFtdLGNtLnNsaWNlKDAsYikpLGZ1bmN0aW9uKCl7Y1t0aGlzXT1hfSk7cmV0dXJuIGN9ZnVuY3Rpb24gY3EoKXtjbj1ifWZ1bmN0aW9uIGNwKCl7c2V0VGltZW91dChjcSwwKTtyZXR1cm4gY249Zi5ub3coKX1mdW5jdGlvbiBjZigpe3RyeXtyZXR1cm4gbmV3IGEuQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKX1jYXRjaChiKXt9fWZ1bmN0aW9uIGNlKCl7dHJ5e3JldHVybiBuZXcgYS5YTUxIdHRwUmVxdWVzdH1jYXRjaChiKXt9fWZ1bmN0aW9uIGIkKGEsYyl7YS5kYXRhRmlsdGVyJiYoYz1hLmRhdGFGaWx0ZXIoYyxhLmRhdGFUeXBlKSk7dmFyIGQ9YS5kYXRhVHlwZXMsZT17fSxnLGgsaT1kLmxlbmd0aCxqLGs9ZFswXSxsLG0sbixvLHA7Zm9yKGc9MTtnPGk7ZysrKXtpZihnPT09MSlmb3IoaCBpbiBhLmNvbnZlcnRlcnMpdHlwZW9mIGg9PSJzdHJpbmciJiYoZVtoLnRvTG93ZXJDYXNlKCldPWEuY29udmVydGVyc1toXSk7bD1rLGs9ZFtnXTtpZihrPT09IioiKWs9bDtlbHNlIGlmKGwhPT0iKiImJmwhPT1rKXttPWwrIiAiK2ssbj1lW21dfHxlWyIqICIra107aWYoIW4pe3A9Yjtmb3IobyBpbiBlKXtqPW8uc3BsaXQoIiAiKTtpZihqWzBdPT09bHx8alswXT09PSIqIil7cD1lW2pbMV0rIiAiK2tdO2lmKHApe289ZVtvXSxvPT09ITA/bj1wOnA9PT0hMCYmKG49byk7YnJlYWt9fX19IW4mJiFwJiZmLmVycm9yKCJObyBjb252ZXJzaW9uIGZyb20gIittLnJlcGxhY2UoIiAiLCIgdG8gIikpLG4hPT0hMCYmKGM9bj9uKGMpOnAobyhjKSkpfX1yZXR1cm4gY31mdW5jdGlvbiBiWihhLGMsZCl7dmFyIGU9YS5jb250ZW50cyxmPWEuZGF0YVR5cGVzLGc9YS5yZXNwb25zZUZpZWxkcyxoLGksaixrO2ZvcihpIGluIGcpaSBpbiBkJiYoY1tnW2ldXT1kW2ldKTt3aGlsZShmWzBdPT09IioiKWYuc2hpZnQoKSxoPT09YiYmKGg9YS5taW1lVHlwZXx8Yy5nZXRSZXNwb25zZUhlYWRlcigiY29udGVudC10eXBlIikpO2lmKGgpZm9yKGkgaW4gZSlpZihlW2ldJiZlW2ldLnRlc3QoaCkpe2YudW5zaGlmdChpKTticmVha31pZihmWzBdaW4gZClqPWZbMF07ZWxzZXtmb3IoaSBpbiBkKXtpZighZlswXXx8YS5jb252ZXJ0ZXJzW2krIiAiK2ZbMF1dKXtqPWk7YnJlYWt9a3x8KGs9aSl9aj1qfHxrfWlmKGope2ohPT1mWzBdJiZmLnVuc2hpZnQoaik7cmV0dXJuIGRbal19fWZ1bmN0aW9uIGJZKGEsYixjLGQpe2lmKGYuaXNBcnJheShiKSlmLmVhY2goYixmdW5jdGlvbihiLGUpe2N8fGJDLnRlc3QoYSk/ZChhLGUpOmJZKGErIlsiKyh0eXBlb2YgZT09Im9iamVjdCJ8fGYuaXNBcnJheShlKT9iOiIiKSsiXSIsZSxjLGQpfSk7ZWxzZSBpZighYyYmYiE9bnVsbCYmdHlwZW9mIGI9PSJvYmplY3QiKWZvcih2YXIgZSBpbiBiKWJZKGErIlsiK2UrIl0iLGJbZV0sYyxkKTtlbHNlIGQoYSxiKX1mdW5jdGlvbiBiWChhLGMsZCxlLGYsZyl7Zj1mfHxjLmRhdGFUeXBlc1swXSxnPWd8fHt9LGdbZl09ITA7dmFyIGg9YVtmXSxpPTAsaj1oP2gubGVuZ3RoOjAsaz1hPT09YlIsbDtmb3IoO2k8aiYmKGt8fCFsKTtpKyspbD1oW2ldKGMsZCxlKSx0eXBlb2YgbD09InN0cmluZyImJigha3x8Z1tsXT9sPWI6KGMuZGF0YVR5cGVzLnVuc2hpZnQobCksbD1iWChhLGMsZCxlLGwsZykpKTsoa3x8IWwpJiYhZ1siKiJdJiYobD1iWChhLGMsZCxlLCIqIixnKSk7cmV0dXJuIGx9ZnVuY3Rpb24gYlcoYSl7cmV0dXJuIGZ1bmN0aW9uKGIsYyl7dHlwZW9mIGIhPSJzdHJpbmciJiYoYz1iLGI9IioiKTtpZihmLmlzRnVuY3Rpb24oYykpe3ZhciBkPWIudG9Mb3dlckNhc2UoKS5zcGxpdChiTiksZT0wLGc9ZC5sZW5ndGgsaCxpLGo7Zm9yKDtlPGc7ZSsrKWg9ZFtlXSxqPS9eXCsvLnRlc3QoaCksaiYmKGg9aC5zdWJzdHIoMSl8fCIqIiksaT1hW2hdPWFbaF18fFtdLGlbaj8idW5zaGlmdCI6InB1c2giXShjKX19fWZ1bmN0aW9uIGJBKGEsYixjKXt2YXIgZD1iPT09IndpZHRoIj9hLm9mZnNldFdpZHRoOmEub2Zmc2V0SGVpZ2h0LGU9Yj09PSJ3aWR0aCI/YnY6Ync7aWYoZD4wKXtjIT09ImJvcmRlciImJmYuZWFjaChlLGZ1bmN0aW9uKCl7Y3x8KGQtPXBhcnNlRmxvYXQoZi5jc3MoYSwicGFkZGluZyIrdGhpcykpfHwwKSxjPT09Im1hcmdpbiI/ZCs9cGFyc2VGbG9hdChmLmNzcyhhLGMrdGhpcykpfHwwOmQtPXBhcnNlRmxvYXQoZi5jc3MoYSwiYm9yZGVyIit0aGlzKyJXaWR0aCIpKXx8MH0pO3JldHVybiBkKyJweCJ9ZD1ieChhLGIsYik7aWYoZDwwfHxkPT1udWxsKWQ9YS5zdHlsZVtiXXx8MDtkPXBhcnNlRmxvYXQoZCl8fDAsYyYmZi5lYWNoKGUsZnVuY3Rpb24oKXtkKz1wYXJzZUZsb2F0KGYuY3NzKGEsInBhZGRpbmciK3RoaXMpKXx8MCxjIT09InBhZGRpbmciJiYoZCs9cGFyc2VGbG9hdChmLmNzcyhhLCJib3JkZXIiK3RoaXMrIldpZHRoIikpfHwwKSxjPT09Im1hcmdpbiImJihkKz1wYXJzZUZsb2F0KGYuY3NzKGEsYyt0aGlzKSl8fDApfSk7cmV0dXJuIGQrInB4In1mdW5jdGlvbiBibShhLGIpe2Iuc3JjP2YuYWpheCh7dXJsOmIuc3JjLGFzeW5jOiExLGRhdGFUeXBlOiJzY3JpcHQifSk6Zi5nbG9iYWxFdmFsKChiLnRleHR8fGIudGV4dENvbnRlbnR8fGIuaW5uZXJIVE1MfHwiIikucmVwbGFjZShiZSwiLyokMCovIikpLGIucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGIpfWZ1bmN0aW9uIGJsKGEpe2Yubm9kZU5hbWUoYSwiaW5wdXQiKT9iayhhKToiZ2V0RWxlbWVudHNCeVRhZ05hbWUiaW4gYSYmZi5ncmVwKGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlucHV0IiksYmspfWZ1bmN0aW9uIGJrKGEpe2lmKGEudHlwZT09PSJjaGVja2JveCJ8fGEudHlwZT09PSJyYWRpbyIpYS5kZWZhdWx0Q2hlY2tlZD1hLmNoZWNrZWR9ZnVuY3Rpb24gYmooYSl7cmV0dXJuImdldEVsZW1lbnRzQnlUYWdOYW1lImluIGE/YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpOiJxdWVyeVNlbGVjdG9yQWxsImluIGE/YS5xdWVyeVNlbGVjdG9yQWxsKCIqIik6W119ZnVuY3Rpb24gYmkoYSxiKXt2YXIgYztpZihiLm5vZGVUeXBlPT09MSl7Yi5jbGVhckF0dHJpYnV0ZXMmJmIuY2xlYXJBdHRyaWJ1dGVzKCksYi5tZXJnZUF0dHJpYnV0ZXMmJmIubWVyZ2VBdHRyaWJ1dGVzKGEpLGM9Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmKGM9PT0ib2JqZWN0IiliLm91dGVySFRNTD1hLm91dGVySFRNTDtlbHNlIGlmKGMhPT0iaW5wdXQifHxhLnR5cGUhPT0iY2hlY2tib3giJiZhLnR5cGUhPT0icmFkaW8iKXtpZihjPT09Im9wdGlvbiIpYi5zZWxlY3RlZD1hLmRlZmF1bHRTZWxlY3RlZDtlbHNlIGlmKGM9PT0iaW5wdXQifHxjPT09InRleHRhcmVhIiliLmRlZmF1bHRWYWx1ZT1hLmRlZmF1bHRWYWx1ZX1lbHNlIGEuY2hlY2tlZCYmKGIuZGVmYXVsdENoZWNrZWQ9Yi5jaGVja2VkPWEuY2hlY2tlZCksYi52YWx1ZSE9PWEudmFsdWUmJihiLnZhbHVlPWEudmFsdWUpO2IucmVtb3ZlQXR0cmlidXRlKGYuZXhwYW5kbyl9fWZ1bmN0aW9uIGJoKGEsYil7aWYoYi5ub2RlVHlwZT09PTEmJiEhZi5oYXNEYXRhKGEpKXt2YXIgYz1mLmV4cGFuZG8sZD1mLmRhdGEoYSksZT1mLmRhdGEoYixkKTtpZihkPWRbY10pe3ZhciBnPWQuZXZlbnRzO2U9ZVtjXT1mLmV4dGVuZCh7fSxkKTtpZihnKXtkZWxldGUgZS5oYW5kbGUsZS5ldmVudHM9e307Zm9yKHZhciBoIGluIGcpZm9yKHZhciBpPTAsaj1nW2hdLmxlbmd0aDtpPGo7aSsrKWYuZXZlbnQuYWRkKGIsaCsoZ1toXVtpXS5uYW1lc3BhY2U/Ii4iOiIiKStnW2hdW2ldLm5hbWVzcGFjZSxnW2hdW2ldLGdbaF1baV0uZGF0YSl9fX19ZnVuY3Rpb24gYmcoYSxiKXtyZXR1cm4gZi5ub2RlTmFtZShhLCJ0YWJsZSIpP2EuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRib2R5IilbMF18fGEuYXBwZW5kQ2hpbGQoYS5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRib2R5IikpOmF9ZnVuY3Rpb24gVyhhLGIsYyl7Yj1ifHwwO2lmKGYuaXNGdW5jdGlvbihiKSlyZXR1cm4gZi5ncmVwKGEsZnVuY3Rpb24oYSxkKXt2YXIgZT0hIWIuY2FsbChhLGQsYSk7cmV0dXJuIGU9PT1jfSk7aWYoYi5ub2RlVHlwZSlyZXR1cm4gZi5ncmVwKGEsZnVuY3Rpb24oYSxkKXtyZXR1cm4gYT09PWI9PT1jfSk7aWYodHlwZW9mIGI9PSJzdHJpbmciKXt2YXIgZD1mLmdyZXAoYSxmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlVHlwZT09PTF9KTtpZihSLnRlc3QoYikpcmV0dXJuIGYuZmlsdGVyKGIsZCwhYyk7Yj1mLmZpbHRlcihiLGQpfXJldHVybiBmLmdyZXAoYSxmdW5jdGlvbihhLGQpe3JldHVybiBmLmluQXJyYXkoYSxiKT49MD09PWN9KX1mdW5jdGlvbiBWKGEpe3JldHVybiFhfHwhYS5wYXJlbnROb2RlfHxhLnBhcmVudE5vZGUubm9kZVR5cGU9PT0xMX1mdW5jdGlvbiBOKGEsYil7cmV0dXJuKGEmJmEhPT0iKiI/YSsiLiI6IiIpK2IucmVwbGFjZSh6LCJgIikucmVwbGFjZShBLCImIil9ZnVuY3Rpb24gTShhKXt2YXIgYixjLGQsZSxnLGgsaSxqLGssbCxtLG4sbyxwPVtdLHE9W10scj1mLl9kYXRhKHRoaXMsImV2ZW50cyIpO2lmKCEoYS5saXZlRmlyZWQ9PT10aGlzfHwhcnx8IXIubGl2ZXx8YS50YXJnZXQuZGlzYWJsZWR8fGEuYnV0dG9uJiZhLnR5cGU9PT0iY2xpY2siKSl7YS5uYW1lc3BhY2UmJihuPW5ldyBSZWdFeHAoIihefFxcLikiK2EubmFtZXNwYWNlLnNwbGl0KCIuIikuam9pbigiXFwuKD86LipcXC4pPyIpKyIoXFwufCQpIikpLGEubGl2ZUZpcmVkPXRoaXM7dmFyIHM9ci5saXZlLnNsaWNlKDApO2ZvcihpPTA7aTxzLmxlbmd0aDtpKyspZz1zW2ldLGcub3JpZ1R5cGUucmVwbGFjZSh4LCIiKT09PWEudHlwZT9xLnB1c2goZy5zZWxlY3Rvcik6cy5zcGxpY2UoaS0tLDEpO2U9ZihhLnRhcmdldCkuY2xvc2VzdChxLGEuY3VycmVudFRhcmdldCk7Zm9yKGo9MCxrPWUubGVuZ3RoO2o8aztqKyspe209ZVtqXTtmb3IoaT0wO2k8cy5sZW5ndGg7aSsrKXtnPXNbaV07aWYobS5zZWxlY3Rvcj09PWcuc2VsZWN0b3ImJighbnx8bi50ZXN0KGcubmFtZXNwYWNlKSkmJiFtLmVsZW0uZGlzYWJsZWQpe2g9bS5lbGVtLGQ9bnVsbDtpZihnLnByZVR5cGU9PT0ibW91c2VlbnRlciJ8fGcucHJlVHlwZT09PSJtb3VzZWxlYXZlIilhLnR5cGU9Zy5wcmVUeXBlLGQ9ZihhLnJlbGF0ZWRUYXJnZXQpLmNsb3Nlc3QoZy5zZWxlY3RvcilbMF0sZCYmZi5jb250YWlucyhoLGQpJiYoZD1oKTsoIWR8fGQhPT1oKSYmcC5wdXNoKHtlbGVtOmgsaGFuZGxlT2JqOmcsbGV2ZWw6bS5sZXZlbH0pfX19Zm9yKGo9MCxrPXAubGVuZ3RoO2o8aztqKyspe2U9cFtqXTtpZihjJiZlLmxldmVsPmMpYnJlYWs7YS5jdXJyZW50VGFyZ2V0PWUuZWxlbSxhLmRhdGE9ZS5oYW5kbGVPYmouZGF0YSxhLmhhbmRsZU9iaj1lLmhhbmRsZU9iaixvPWUuaGFuZGxlT2JqLm9yaWdIYW5kbGVyLmFwcGx5KGUuZWxlbSxhcmd1bWVudHMpO2lmKG89PT0hMXx8YS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKXtjPWUubGV2ZWwsbz09PSExJiYoYj0hMSk7aWYoYS5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpKWJyZWFrfX1yZXR1cm4gYn19ZnVuY3Rpb24gSyhhLGMsZCl7dmFyIGU9Zi5leHRlbmQoe30sZFswXSk7ZS50eXBlPWEsZS5vcmlnaW5hbEV2ZW50PXt9LGUubGl2ZUZpcmVkPWIsZi5ldmVudC5oYW5kbGUuY2FsbChjLGUpLGUuaXNEZWZhdWx0UHJldmVudGVkKCkmJmRbMF0ucHJldmVudERlZmF1bHQoKX1mdW5jdGlvbiBFKCl7cmV0dXJuITB9ZnVuY3Rpb24gRCgpe3JldHVybiExfWZ1bmN0aW9uIG0oYSxjLGQpe3ZhciBlPWMrImRlZmVyIixnPWMrInF1ZXVlIixoPWMrIm1hcmsiLGk9Zi5kYXRhKGEsZSxiLCEwKTtpJiYoZD09PSJxdWV1ZSJ8fCFmLmRhdGEoYSxnLGIsITApKSYmKGQ9PT0ibWFyayJ8fCFmLmRhdGEoYSxoLGIsITApKSYmc2V0VGltZW91dChmdW5jdGlvbigpeyFmLmRhdGEoYSxnLGIsITApJiYhZi5kYXRhKGEsaCxiLCEwKSYmKGYucmVtb3ZlRGF0YShhLGUsITApLGkucmVzb2x2ZSgpKX0sMCl9ZnVuY3Rpb24gbChhKXtmb3IodmFyIGIgaW4gYSlpZihiIT09InRvSlNPTiIpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gayhhLGMsZCl7aWYoZD09PWImJmEubm9kZVR5cGU9PT0xKXt2YXIgZT0iZGF0YS0iK2MucmVwbGFjZShqLCIkMS0kMiIpLnRvTG93ZXJDYXNlKCk7ZD1hLmdldEF0dHJpYnV0ZShlKTtpZih0eXBlb2YgZD09InN0cmluZyIpe3RyeXtkPWQ9PT0idHJ1ZSI/ITA6ZD09PSJmYWxzZSI/ITE6ZD09PSJudWxsIj9udWxsOmYuaXNOYU4oZCk/aS50ZXN0KGQpP2YucGFyc2VKU09OKGQpOmQ6cGFyc2VGbG9hdChkKX1jYXRjaChnKXt9Zi5kYXRhKGEsYyxkKX1lbHNlIGQ9Yn1yZXR1cm4gZH12YXIgYz1hLmRvY3VtZW50LGQ9YS5uYXZpZ2F0b3IsZT1hLmxvY2F0aW9uLGY9ZnVuY3Rpb24oKXtmdW5jdGlvbiBKKCl7aWYoIWUuaXNSZWFkeSl7dHJ5e2MuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKCJsZWZ0Iil9Y2F0Y2goYSl7c2V0VGltZW91dChKLDEpO3JldHVybn1lLnJlYWR5KCl9fXZhciBlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBlLmZuLmluaXQoYSxiLGgpfSxmPWEualF1ZXJ5LGc9YS4kLGgsaT0vXig/OltePF0qKDxbXHdcV10rPilbXj5dKiR8IyhbXHdcLV0qKSQpLyxqPS9cUy8saz0vXlxzKy8sbD0vXHMrJC8sbT0vXGQvLG49L148KFx3KylccypcLz8+KD86PFwvXDE+KT8kLyxvPS9eW1xdLDp7fVxzXSokLyxwPS9cXCg/OlsiXFxcL2JmbnJ0XXx1WzAtOWEtZkEtRl17NH0pL2cscT0vIlteIlxcXG5ccl0qInx0cnVlfGZhbHNlfG51bGx8LT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/L2cscj0vKD86Xnw6fCwpKD86XHMqXFspKy9nLHM9Lyh3ZWJraXQpWyBcL10oW1x3Ll0rKS8sdD0vKG9wZXJhKSg/Oi4qdmVyc2lvbik/WyBcL10oW1x3Ll0rKS8sdT0vKG1zaWUpIChbXHcuXSspLyx2PS8obW96aWxsYSkoPzouKj8gcnY6KFtcdy5dKykpPy8sdz0vLShbYS16XSkvaWcseD1mdW5jdGlvbihhLGIpe3JldHVybiBiLnRvVXBwZXJDYXNlKCl9LHk9ZC51c2VyQWdlbnQseixBLEIsQz1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLEQ9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxFPUFycmF5LnByb3RvdHlwZS5wdXNoLEY9QXJyYXkucHJvdG90eXBlLnNsaWNlLEc9U3RyaW5nLnByb3RvdHlwZS50cmltLEg9QXJyYXkucHJvdG90eXBlLmluZGV4T2YsST17fTtlLmZuPWUucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjplLGluaXQ6ZnVuY3Rpb24oYSxkLGYpe3ZhciBnLGgsaixrO2lmKCFhKXJldHVybiB0aGlzO2lmKGEubm9kZVR5cGUpe3RoaXMuY29udGV4dD10aGlzWzBdPWEsdGhpcy5sZW5ndGg9MTtyZXR1cm4gdGhpc31pZihhPT09ImJvZHkiJiYhZCYmYy5ib2R5KXt0aGlzLmNvbnRleHQ9Yyx0aGlzWzBdPWMuYm9keSx0aGlzLnNlbGVjdG9yPWEsdGhpcy5sZW5ndGg9MTtyZXR1cm4gdGhpc31pZih0eXBlb2YgYT09InN0cmluZyIpe2EuY2hhckF0KDApIT09IjwifHxhLmNoYXJBdChhLmxlbmd0aC0xKSE9PSI+Inx8YS5sZW5ndGg8Mz9nPWkuZXhlYyhhKTpnPVtudWxsLGEsbnVsbF07aWYoZyYmKGdbMV18fCFkKSl7aWYoZ1sxXSl7ZD1kIGluc3RhbmNlb2YgZT9kWzBdOmQsaz1kP2Qub3duZXJEb2N1bWVudHx8ZDpjLGo9bi5leGVjKGEpLGo/ZS5pc1BsYWluT2JqZWN0KGQpPyhhPVtjLmNyZWF0ZUVsZW1lbnQoalsxXSldLGUuZm4uYXR0ci5jYWxsKGEsZCwhMCkpOmE9W2suY3JlYXRlRWxlbWVudChqWzFdKV06KGo9ZS5idWlsZEZyYWdtZW50KFtnWzFdXSxba10pLGE9KGouY2FjaGVhYmxlP2UuY2xvbmUoai5mcmFnbWVudCk6ai5mcmFnbWVudCkuY2hpbGROb2Rlcyk7cmV0dXJuIGUubWVyZ2UodGhpcyxhKX1oPWMuZ2V0RWxlbWVudEJ5SWQoZ1syXSk7aWYoaCYmaC5wYXJlbnROb2RlKXtpZihoLmlkIT09Z1syXSlyZXR1cm4gZi5maW5kKGEpO3RoaXMubGVuZ3RoPTEsdGhpc1swXT1ofXRoaXMuY29udGV4dD1jLHRoaXMuc2VsZWN0b3I9YTtyZXR1cm4gdGhpc31yZXR1cm4hZHx8ZC5qcXVlcnk/KGR8fGYpLmZpbmQoYSk6dGhpcy5jb25zdHJ1Y3RvcihkKS5maW5kKGEpfWlmKGUuaXNGdW5jdGlvbihhKSlyZXR1cm4gZi5yZWFkeShhKTthLnNlbGVjdG9yIT09YiYmKHRoaXMuc2VsZWN0b3I9YS5zZWxlY3Rvcix0aGlzLmNvbnRleHQ9YS5jb250ZXh0KTtyZXR1cm4gZS5tYWtlQXJyYXkoYSx0aGlzKX0sc2VsZWN0b3I6IiIsanF1ZXJ5OiIxLjYuMiIsbGVuZ3RoOjAsc2l6ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmxlbmd0aH0sdG9BcnJheTpmdW5jdGlvbigpe3JldHVybiBGLmNhbGwodGhpcywwKX0sZ2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsP3RoaXMudG9BcnJheSgpOmE8MD90aGlzW3RoaXMubGVuZ3RoK2FdOnRoaXNbYV19LHB1c2hTdGFjazpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5jb25zdHJ1Y3RvcigpO2UuaXNBcnJheShhKT9FLmFwcGx5KGQsYSk6ZS5tZXJnZShkLGEpLGQucHJldk9iamVjdD10aGlzLGQuY29udGV4dD10aGlzLmNvbnRleHQsYj09PSJmaW5kIj9kLnNlbGVjdG9yPXRoaXMuc2VsZWN0b3IrKHRoaXMuc2VsZWN0b3I/IiAiOiIiKStjOmImJihkLnNlbGVjdG9yPXRoaXMuc2VsZWN0b3IrIi4iK2IrIigiK2MrIikiKTtyZXR1cm4gZH0sZWFjaDpmdW5jdGlvbihhLGIpe3JldHVybiBlLmVhY2godGhpcyxhLGIpfSxyZWFkeTpmdW5jdGlvbihhKXtlLmJpbmRSZWFkeSgpLEEuZG9uZShhKTtyZXR1cm4gdGhpc30sZXE6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT0tMT90aGlzLnNsaWNlKGEpOnRoaXMuc2xpY2UoYSwrYSsxKX0sZmlyc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lcSgwKX0sbGFzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKC0xKX0sc2xpY2U6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2soRi5hcHBseSh0aGlzLGFyZ3VtZW50cyksInNsaWNlIixGLmNhbGwoYXJndW1lbnRzKS5qb2luKCIsIikpfSxtYXA6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGUubWFwKHRoaXMsZnVuY3Rpb24oYixjKXtyZXR1cm4gYS5jYWxsKGIsYyxiKX0pKX0sZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHJldk9iamVjdHx8dGhpcy5jb25zdHJ1Y3RvcihudWxsKX0scHVzaDpFLHNvcnQ6W10uc29ydCxzcGxpY2U6W10uc3BsaWNlfSxlLmZuLmluaXQucHJvdG90eXBlPWUuZm4sZS5leHRlbmQ9ZS5mbi5leHRlbmQ9ZnVuY3Rpb24oKXt2YXIgYSxjLGQsZixnLGgsaT1hcmd1bWVudHNbMF18fHt9LGo9MSxrPWFyZ3VtZW50cy5sZW5ndGgsbD0hMTt0eXBlb2YgaT09ImJvb2xlYW4iJiYobD1pLGk9YXJndW1lbnRzWzFdfHx7fSxqPTIpLHR5cGVvZiBpIT0ib2JqZWN0IiYmIWUuaXNGdW5jdGlvbihpKSYmKGk9e30pLGs9PT1qJiYoaT10aGlzLC0taik7Zm9yKDtqPGs7aisrKWlmKChhPWFyZ3VtZW50c1tqXSkhPW51bGwpZm9yKGMgaW4gYSl7ZD1pW2NdLGY9YVtjXTtpZihpPT09Ziljb250aW51ZTtsJiZmJiYoZS5pc1BsYWluT2JqZWN0KGYpfHwoZz1lLmlzQXJyYXkoZikpKT8oZz8oZz0hMSxoPWQmJmUuaXNBcnJheShkKT9kOltdKTpoPWQmJmUuaXNQbGFpbk9iamVjdChkKT9kOnt9LGlbY109ZS5leHRlbmQobCxoLGYpKTpmIT09YiYmKGlbY109Zil9cmV0dXJuIGl9LGUuZXh0ZW5kKHtub0NvbmZsaWN0OmZ1bmN0aW9uKGIpe2EuJD09PWUmJihhLiQ9ZyksYiYmYS5qUXVlcnk9PT1lJiYoYS5qUXVlcnk9Zik7cmV0dXJuIGV9LGlzUmVhZHk6ITEscmVhZHlXYWl0OjEsaG9sZFJlYWR5OmZ1bmN0aW9uKGEpe2E/ZS5yZWFkeVdhaXQrKzplLnJlYWR5KCEwKX0scmVhZHk6ZnVuY3Rpb24oYSl7aWYoYT09PSEwJiYhLS1lLnJlYWR5V2FpdHx8YSE9PSEwJiYhZS5pc1JlYWR5KXtpZighYy5ib2R5KXJldHVybiBzZXRUaW1lb3V0KGUucmVhZHksMSk7ZS5pc1JlYWR5PSEwO2lmKGEhPT0hMCYmLS1lLnJlYWR5V2FpdD4wKXJldHVybjtBLnJlc29sdmVXaXRoKGMsW2VdKSxlLmZuLnRyaWdnZXImJmUoYykudHJpZ2dlcigicmVhZHkiKS51bmJpbmQoInJlYWR5Iil9fSxiaW5kUmVhZHk6ZnVuY3Rpb24oKXtpZighQSl7QT1lLl9EZWZlcnJlZCgpO2lmKGMucmVhZHlTdGF0ZT09PSJjb21wbGV0ZSIpcmV0dXJuIHNldFRpbWVvdXQoZS5yZWFkeSwxKTtpZihjLmFkZEV2ZW50TGlzdGVuZXIpYy5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixCLCExKSxhLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLGUucmVhZHksITEpO2Vsc2UgaWYoYy5hdHRhY2hFdmVudCl7Yy5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIixCKSxhLmF0dGFjaEV2ZW50KCJvbmxvYWQiLGUucmVhZHkpO3ZhciBiPSExO3RyeXtiPWEuZnJhbWVFbGVtZW50PT1udWxsfWNhdGNoKGQpe31jLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCYmYiYmSigpfX19LGlzRnVuY3Rpb246ZnVuY3Rpb24oYSl7cmV0dXJuIGUudHlwZShhKT09PSJmdW5jdGlvbiJ9LGlzQXJyYXk6QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oYSl7cmV0dXJuIGUudHlwZShhKT09PSJhcnJheSJ9LGlzV2luZG93OmZ1bmN0aW9uKGEpe3JldHVybiBhJiZ0eXBlb2YgYT09Im9iamVjdCImJiJzZXRJbnRlcnZhbCJpbiBhfSxpc05hTjpmdW5jdGlvbihhKXtyZXR1cm4gYT09bnVsbHx8IW0udGVzdChhKXx8aXNOYU4oYSl9LHR5cGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/U3RyaW5nKGEpOklbQy5jYWxsKGEpXXx8Im9iamVjdCJ9LGlzUGxhaW5PYmplY3Q6ZnVuY3Rpb24oYSl7aWYoIWF8fGUudHlwZShhKSE9PSJvYmplY3QifHxhLm5vZGVUeXBlfHxlLmlzV2luZG93KGEpKXJldHVybiExO2lmKGEuY29uc3RydWN0b3ImJiFELmNhbGwoYSwiY29uc3RydWN0b3IiKSYmIUQuY2FsbChhLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwiaXNQcm90b3R5cGVPZiIpKXJldHVybiExO3ZhciBjO2ZvcihjIGluIGEpO3JldHVybiBjPT09Ynx8RC5jYWxsKGEsYyl9LGlzRW1wdHlPYmplY3Q6ZnVuY3Rpb24oYSl7Zm9yKHZhciBiIGluIGEpcmV0dXJuITE7cmV0dXJuITB9LGVycm9yOmZ1bmN0aW9uKGEpe3Rocm93IGF9LHBhcnNlSlNPTjpmdW5jdGlvbihiKXtpZih0eXBlb2YgYiE9InN0cmluZyJ8fCFiKXJldHVybiBudWxsO2I9ZS50cmltKGIpO2lmKGEuSlNPTiYmYS5KU09OLnBhcnNlKXJldHVybiBhLkpTT04ucGFyc2UoYik7aWYoby50ZXN0KGIucmVwbGFjZShwLCJAIikucmVwbGFjZShxLCJdIikucmVwbGFjZShyLCIiKSkpcmV0dXJuKG5ldyBGdW5jdGlvbigicmV0dXJuICIrYikpKCk7ZS5lcnJvcigiSW52YWxpZCBKU09OOiAiK2IpfSxwYXJzZVhNTDpmdW5jdGlvbihiLGMsZCl7YS5ET01QYXJzZXI/KGQ9bmV3IERPTVBhcnNlcixjPWQucGFyc2VGcm9tU3RyaW5nKGIsInRleHQveG1sIikpOihjPW5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MRE9NIiksYy5hc3luYz0iZmFsc2UiLGMubG9hZFhNTChiKSksZD1jLmRvY3VtZW50RWxlbWVudCwoIWR8fCFkLm5vZGVOYW1lfHxkLm5vZGVOYW1lPT09InBhcnNlcmVycm9yIikmJmUuZXJyb3IoIkludmFsaWQgWE1MOiAiK2IpO3JldHVybiBjfSxub29wOmZ1bmN0aW9uKCl7fSxnbG9iYWxFdmFsOmZ1bmN0aW9uKGIpe2ImJmoudGVzdChiKSYmKGEuZXhlY1NjcmlwdHx8ZnVuY3Rpb24oYil7YS5ldmFsLmNhbGwoYSxiKX0pKGIpfSxjYW1lbENhc2U6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSh3LHgpfSxub2RlTmFtZTpmdW5jdGlvbihhLGIpe3JldHVybiBhLm5vZGVOYW1lJiZhLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk9PT1iLnRvVXBwZXJDYXNlKCl9LGVhY2g6ZnVuY3Rpb24oYSxjLGQpe3ZhciBmLGc9MCxoPWEubGVuZ3RoLGk9aD09PWJ8fGUuaXNGdW5jdGlvbihhKTtpZihkKXtpZihpKXtmb3IoZiBpbiBhKWlmKGMuYXBwbHkoYVtmXSxkKT09PSExKWJyZWFrfWVsc2UgZm9yKDtnPGg7KWlmKGMuYXBwbHkoYVtnKytdLGQpPT09ITEpYnJlYWt9ZWxzZSBpZihpKXtmb3IoZiBpbiBhKWlmKGMuY2FsbChhW2ZdLGYsYVtmXSk9PT0hMSlicmVha31lbHNlIGZvcig7ZzxoOylpZihjLmNhbGwoYVtnXSxnLGFbZysrXSk9PT0hMSlicmVhaztyZXR1cm4gYX0sdHJpbTpHP2Z1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsPyIiOkcuY2FsbChhKX06ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/IiI6KGErIiIpLnJlcGxhY2UoaywiIikucmVwbGFjZShsLCIiKX0sbWFrZUFycmF5OmZ1bmN0aW9uKGEsYil7dmFyIGM9Ynx8W107aWYoYSE9bnVsbCl7dmFyIGQ9ZS50eXBlKGEpO2EubGVuZ3RoPT1udWxsfHxkPT09InN0cmluZyJ8fGQ9PT0iZnVuY3Rpb24ifHxkPT09InJlZ2V4cCJ8fGUuaXNXaW5kb3coYSk/RS5jYWxsKGMsYSk6ZS5tZXJnZShjLGEpfXJldHVybiBjfSxpbkFycmF5OmZ1bmN0aW9uKGEsYil7aWYoSClyZXR1cm4gSC5jYWxsKGIsYSk7Zm9yKHZhciBjPTAsZD1iLmxlbmd0aDtjPGQ7YysrKWlmKGJbY109PT1hKXJldHVybiBjO3JldHVybi0xfSxtZXJnZTpmdW5jdGlvbihhLGMpe3ZhciBkPWEubGVuZ3RoLGU9MDtpZih0eXBlb2YgYy5sZW5ndGg9PSJudW1iZXIiKWZvcih2YXIgZj1jLmxlbmd0aDtlPGY7ZSsrKWFbZCsrXT1jW2VdO2Vsc2Ugd2hpbGUoY1tlXSE9PWIpYVtkKytdPWNbZSsrXTthLmxlbmd0aD1kO3JldHVybiBhfSxncmVwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD1bXSxlO2M9ISFjO2Zvcih2YXIgZj0wLGc9YS5sZW5ndGg7ZjxnO2YrKyllPSEhYihhW2ZdLGYpLGMhPT1lJiZkLnB1c2goYVtmXSk7cmV0dXJuIGR9LG1hcDpmdW5jdGlvbihhLGMsZCl7dmFyIGYsZyxoPVtdLGk9MCxqPWEubGVuZ3RoLGs9YSBpbnN0YW5jZW9mIGV8fGohPT1iJiZ0eXBlb2Ygaj09Im51bWJlciImJihqPjAmJmFbMF0mJmFbai0xXXx8aj09PTB8fGUuaXNBcnJheShhKSk7aWYoaylmb3IoO2k8ajtpKyspZj1jKGFbaV0saSxkKSxmIT1udWxsJiYoaFtoLmxlbmd0aF09Zik7ZWxzZSBmb3IoZyBpbiBhKWY9YyhhW2ddLGcsZCksZiE9bnVsbCYmKGhbaC5sZW5ndGhdPWYpO3JldHVybiBoLmNvbmNhdC5hcHBseShbXSxoKX0sZ3VpZDoxLHByb3h5OmZ1bmN0aW9uKGEsYyl7aWYodHlwZW9mIGM9PSJzdHJpbmciKXt2YXIgZD1hW2NdO2M9YSxhPWR9aWYoIWUuaXNGdW5jdGlvbihhKSlyZXR1cm4gYjt2YXIgZj1GLmNhbGwoYXJndW1lbnRzLDIpLGc9ZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShjLGYuY29uY2F0KEYuY2FsbChhcmd1bWVudHMpKSl9O2cuZ3VpZD1hLmd1aWQ9YS5ndWlkfHxnLmd1aWR8fGUuZ3VpZCsrO3JldHVybiBnfSxhY2Nlc3M6ZnVuY3Rpb24oYSxjLGQsZixnLGgpe3ZhciBpPWEubGVuZ3RoO2lmKHR5cGVvZiBjPT0ib2JqZWN0Iil7Zm9yKHZhciBqIGluIGMpZS5hY2Nlc3MoYSxqLGNbal0sZixnLGQpO3JldHVybiBhfWlmKGQhPT1iKXtmPSFoJiZmJiZlLmlzRnVuY3Rpb24oZCk7Zm9yKHZhciBrPTA7azxpO2srKylnKGFba10sYyxmP2QuY2FsbChhW2tdLGssZyhhW2tdLGMpKTpkLGgpO3JldHVybiBhfXJldHVybiBpP2coYVswXSxjKTpifSxub3c6ZnVuY3Rpb24oKXtyZXR1cm4obmV3IERhdGUpLmdldFRpbWUoKX0sdWFNYXRjaDpmdW5jdGlvbihhKXthPWEudG9Mb3dlckNhc2UoKTt2YXIgYj1zLmV4ZWMoYSl8fHQuZXhlYyhhKXx8dS5leGVjKGEpfHxhLmluZGV4T2YoImNvbXBhdGlibGUiKTwwJiZ2LmV4ZWMoYSl8fFtdO3JldHVybnticm93c2VyOmJbMV18fCIiLHZlcnNpb246YlsyXXx8IjAifX0sc3ViOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gYShiLGMpe3JldHVybiBuZXcgYS5mbi5pbml0KGIsYyl9ZS5leHRlbmQoITAsYSx0aGlzKSxhLnN1cGVyY2xhc3M9dGhpcyxhLmZuPWEucHJvdG90eXBlPXRoaXMoKSxhLmZuLmNvbnN0cnVjdG9yPWEsYS5zdWI9dGhpcy5zdWIsYS5mbi5pbml0PWZ1bmN0aW9uKGQsZil7ZiYmZiBpbnN0YW5jZW9mIGUmJiEoZiBpbnN0YW5jZW9mIGEpJiYoZj1hKGYpKTtyZXR1cm4gZS5mbi5pbml0LmNhbGwodGhpcyxkLGYsYil9LGEuZm4uaW5pdC5wcm90b3R5cGU9YS5mbjt2YXIgYj1hKGMpO3JldHVybiBhfSxicm93c2VyOnt9fSksZS5lYWNoKCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0Ii5zcGxpdCgiICIpLGZ1bmN0aW9uKGEsYil7SVsiW29iamVjdCAiK2IrIl0iXT1iLnRvTG93ZXJDYXNlKCl9KSx6PWUudWFNYXRjaCh5KSx6LmJyb3dzZXImJihlLmJyb3dzZXJbei5icm93c2VyXT0hMCxlLmJyb3dzZXIudmVyc2lvbj16LnZlcnNpb24pLGUuYnJvd3Nlci53ZWJraXQmJihlLmJyb3dzZXIuc2FmYXJpPSEwKSxqLnRlc3QoIsKgIikmJihrPS9eW1xzXHhBMF0rLyxsPS9bXHNceEEwXSskLyksaD1lKGMpLGMuYWRkRXZlbnRMaXN0ZW5lcj9CPWZ1bmN0aW9uKCl7Yy5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixCLCExKSxlLnJlYWR5KCl9OmMuYXR0YWNoRXZlbnQmJihCPWZ1bmN0aW9uKCl7Yy5yZWFkeVN0YXRlPT09ImNvbXBsZXRlIiYmKGMuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsQiksZS5yZWFkeSgpKX0pO3JldHVybiBlfSgpLGc9ImRvbmUgZmFpbCBpc1Jlc29sdmVkIGlzUmVqZWN0ZWQgcHJvbWlzZSB0aGVuIGFsd2F5cyBwaXBlIi5zcGxpdCgiICIpLGg9W10uc2xpY2U7Zi5leHRlbmQoe19EZWZlcnJlZDpmdW5jdGlvbigpe3ZhciBhPVtdLGIsYyxkLGU9e2RvbmU6ZnVuY3Rpb24oKXtpZighZCl7dmFyIGM9YXJndW1lbnRzLGcsaCxpLGosaztiJiYoaz1iLGI9MCk7Zm9yKGc9MCxoPWMubGVuZ3RoO2c8aDtnKyspaT1jW2ddLGo9Zi50eXBlKGkpLGo9PT0iYXJyYXkiP2UuZG9uZS5hcHBseShlLGkpOmo9PT0iZnVuY3Rpb24iJiZhLnB1c2goaSk7ayYmZS5yZXNvbHZlV2l0aChrWzBdLGtbMV0pfXJldHVybiB0aGlzfSxyZXNvbHZlV2l0aDpmdW5jdGlvbihlLGYpe2lmKCFkJiYhYiYmIWMpe2Y9Znx8W10sYz0xO3RyeXt3aGlsZShhWzBdKWEuc2hpZnQoKS5hcHBseShlLGYpfWZpbmFsbHl7Yj1bZSxmXSxjPTB9fXJldHVybiB0aGlzfSxyZXNvbHZlOmZ1bmN0aW9uKCl7ZS5yZXNvbHZlV2l0aCh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIHRoaXN9LGlzUmVzb2x2ZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hIWN8fCEhYn0sY2FuY2VsOmZ1bmN0aW9uKCl7ZD0xLGE9W107cmV0dXJuIHRoaXN9fTtyZXR1cm4gZX0sRGVmZXJyZWQ6ZnVuY3Rpb24oYSl7dmFyIGI9Zi5fRGVmZXJyZWQoKSxjPWYuX0RlZmVycmVkKCksZDtmLmV4dGVuZChiLHt0aGVuOmZ1bmN0aW9uKGEsYyl7Yi5kb25lKGEpLmZhaWwoYyk7cmV0dXJuIHRoaXN9LGFsd2F5czpmdW5jdGlvbigpe3JldHVybiBiLmRvbmUuYXBwbHkoYixhcmd1bWVudHMpLmZhaWwuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxmYWlsOmMuZG9uZSxyZWplY3RXaXRoOmMucmVzb2x2ZVdpdGgscmVqZWN0OmMucmVzb2x2ZSxpc1JlamVjdGVkOmMuaXNSZXNvbHZlZCxwaXBlOmZ1bmN0aW9uKGEsYyl7cmV0dXJuIGYuRGVmZXJyZWQoZnVuY3Rpb24oZCl7Zi5lYWNoKHtkb25lOlthLCJyZXNvbHZlIl0sZmFpbDpbYywicmVqZWN0Il19LGZ1bmN0aW9uKGEsYyl7dmFyIGU9Y1swXSxnPWNbMV0saDtmLmlzRnVuY3Rpb24oZSk/YlthXShmdW5jdGlvbigpe2g9ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksaCYmZi5pc0Z1bmN0aW9uKGgucHJvbWlzZSk/aC5wcm9taXNlKCkudGhlbihkLnJlc29sdmUsZC5yZWplY3QpOmRbZ10oaCl9KTpiW2FdKGRbZ10pfSl9KS5wcm9taXNlKCl9LHByb21pc2U6ZnVuY3Rpb24oYSl7aWYoYT09bnVsbCl7aWYoZClyZXR1cm4gZDtkPWE9e319dmFyIGM9Zy5sZW5ndGg7d2hpbGUoYy0tKWFbZ1tjXV09YltnW2NdXTtyZXR1cm4gYX19KSxiLmRvbmUoYy5jYW5jZWwpLmZhaWwoYi5jYW5jZWwpLGRlbGV0ZSBiLmNhbmNlbCxhJiZhLmNhbGwoYixiKTtyZXR1cm4gYn0sd2hlbjpmdW5jdGlvbihhKXtmdW5jdGlvbiBpKGEpe3JldHVybiBmdW5jdGlvbihjKXtiW2FdPWFyZ3VtZW50cy5sZW5ndGg+MT9oLmNhbGwoYXJndW1lbnRzLDApOmMsLS1lfHxnLnJlc29sdmVXaXRoKGcsaC5jYWxsKGIsMCkpfX12YXIgYj1hcmd1bWVudHMsYz0wLGQ9Yi5sZW5ndGgsZT1kLGc9ZDw9MSYmYSYmZi5pc0Z1bmN0aW9uKGEucHJvbWlzZSk/YTpmLkRlZmVycmVkKCk7aWYoZD4xKXtmb3IoO2M8ZDtjKyspYltjXSYmZi5pc0Z1bmN0aW9uKGJbY10ucHJvbWlzZSk/YltjXS5wcm9taXNlKCkudGhlbihpKGMpLGcucmVqZWN0KTotLWU7ZXx8Zy5yZXNvbHZlV2l0aChnLGIpfWVsc2UgZyE9PWEmJmcucmVzb2x2ZVdpdGgoZyxkP1thXTpbXSk7cmV0dXJuIGcucHJvbWlzZSgpfX0pLGYuc3VwcG9ydD1mdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudCgiZGl2IiksYj1jLmRvY3VtZW50RWxlbWVudCxkLGUsZyxoLGksaixrLGwsbSxuLG8scCxxLHIscyx0LHU7YS5zZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIsInQiKSxhLmlubmVySFRNTD0iICAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJyBzdHlsZT0ndG9wOjFweDtmbG9hdDpsZWZ0O29wYWNpdHk6LjU1Oyc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz4iLGQ9YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLGU9YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYSIpWzBdO2lmKCFkfHwhZC5sZW5ndGh8fCFlKXJldHVybnt9O2c9Yy5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKSxoPWcuYXBwZW5kQ2hpbGQoYy5jcmVhdGVFbGVtZW50KCJvcHRpb24iKSksaT1hLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpbnB1dCIpWzBdLGs9e2xlYWRpbmdXaGl0ZXNwYWNlOmEuZmlyc3RDaGlsZC5ub2RlVHlwZT09PTMsdGJvZHk6IWEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRib2R5IikubGVuZ3RoLGh0bWxTZXJpYWxpemU6ISFhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJsaW5rIikubGVuZ3RoLHN0eWxlOi90b3AvLnRlc3QoZS5nZXRBdHRyaWJ1dGUoInN0eWxlIikpLGhyZWZOb3JtYWxpemVkOmUuZ2V0QXR0cmlidXRlKCJocmVmIik9PT0iL2EiLG9wYWNpdHk6L14wLjU1JC8udGVzdChlLnN0eWxlLm9wYWNpdHkpLGNzc0Zsb2F0OiEhZS5zdHlsZS5jc3NGbG9hdCxjaGVja09uOmkudmFsdWU9PT0ib24iLG9wdFNlbGVjdGVkOmguc2VsZWN0ZWQsZ2V0U2V0QXR0cmlidXRlOmEuY2xhc3NOYW1lIT09InQiLHN1Ym1pdEJ1YmJsZXM6ITAsY2hhbmdlQnViYmxlczohMCxmb2N1c2luQnViYmxlczohMSxkZWxldGVFeHBhbmRvOiEwLG5vQ2xvbmVFdmVudDohMCxpbmxpbmVCbG9ja05lZWRzTGF5b3V0OiExLHNocmlua1dyYXBCbG9ja3M6ITEscmVsaWFibGVNYXJnaW5SaWdodDohMH0saS5jaGVja2VkPSEwLGsubm9DbG9uZUNoZWNrZWQ9aS5jbG9uZU5vZGUoITApLmNoZWNrZWQsZy5kaXNhYmxlZD0hMCxrLm9wdERpc2FibGVkPSFoLmRpc2FibGVkO3RyeXtkZWxldGUgYS50ZXN0fWNhdGNoKHYpe2suZGVsZXRlRXhwYW5kbz0hMX0hYS5hZGRFdmVudExpc3RlbmVyJiZhLmF0dGFjaEV2ZW50JiZhLmZpcmVFdmVudCYmKGEuYXR0YWNoRXZlbnQoIm9uY2xpY2siLGZ1bmN0aW9uKCl7ay5ub0Nsb25lRXZlbnQ9ITF9KSxhLmNsb25lTm9kZSghMCkuZmlyZUV2ZW50KCJvbmNsaWNrIikpLGk9Yy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpLGkudmFsdWU9InQiLGkuc2V0QXR0cmlidXRlKCJ0eXBlIiwicmFkaW8iKSxrLnJhZGlvVmFsdWU9aS52YWx1ZT09PSJ0IixpLnNldEF0dHJpYnV0ZSgiY2hlY2tlZCIsImNoZWNrZWQiKSxhLmFwcGVuZENoaWxkKGkpLGw9Yy5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksbC5hcHBlbmRDaGlsZChhLmZpcnN0Q2hpbGQpLGsuY2hlY2tDbG9uZT1sLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCxhLmlubmVySFRNTD0iIixhLnN0eWxlLndpZHRoPWEuc3R5bGUucGFkZGluZ0xlZnQ9IjFweCIsbT1jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0sbz1jLmNyZWF0ZUVsZW1lbnQobT8iZGl2IjoiYm9keSIpLHA9e3Zpc2liaWxpdHk6ImhpZGRlbiIsd2lkdGg6MCxoZWlnaHQ6MCxib3JkZXI6MCxtYXJnaW46MH0sbSYmZi5leHRlbmQocCx7cG9zaXRpb246ImFic29sdXRlIixsZWZ0Oi0xZTMsdG9wOi0xZTN9KTtmb3IodCBpbiBwKW8uc3R5bGVbdF09cFt0XTtvLmFwcGVuZENoaWxkKGEpLG49bXx8YixuLmluc2VydEJlZm9yZShvLG4uZmlyc3RDaGlsZCksay5hcHBlbmRDaGVja2VkPWkuY2hlY2tlZCxrLmJveE1vZGVsPWEub2Zmc2V0V2lkdGg9PT0yLCJ6b29tImluIGEuc3R5bGUmJihhLnN0eWxlLmRpc3BsYXk9ImlubGluZSIsYS5zdHlsZS56b29tPTEsay5pbmxpbmVCbG9ja05lZWRzTGF5b3V0PWEub2Zmc2V0V2lkdGg9PT0yLGEuc3R5bGUuZGlzcGxheT0iIixhLmlubmVySFRNTD0iPGRpdiBzdHlsZT0nd2lkdGg6NHB4Oyc+PC9kaXY+IixrLnNocmlua1dyYXBCbG9ja3M9YS5vZmZzZXRXaWR0aCE9PTIpLGEuaW5uZXJIVE1MPSI8dGFibGU+PHRyPjx0ZCBzdHlsZT0ncGFkZGluZzowO2JvcmRlcjowO2Rpc3BsYXk6bm9uZSc+PC90ZD48dGQ+dDwvdGQ+PC90cj48L3RhYmxlPiIscT1hLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ZCIpLHU9cVswXS5vZmZzZXRIZWlnaHQ9PT0wLHFbMF0uc3R5bGUuZGlzcGxheT0iIixxWzFdLnN0eWxlLmRpc3BsYXk9Im5vbmUiLGsucmVsaWFibGVIaWRkZW5PZmZzZXRzPXUmJnFbMF0ub2Zmc2V0SGVpZ2h0PT09MCxhLmlubmVySFRNTD0iIixjLmRlZmF1bHRWaWV3JiZjLmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUmJihqPWMuY3JlYXRlRWxlbWVudCgiZGl2Iiksai5zdHlsZS53aWR0aD0iMCIsai5zdHlsZS5tYXJnaW5SaWdodD0iMCIsYS5hcHBlbmRDaGlsZChqKSxrLnJlbGlhYmxlTWFyZ2luUmlnaHQ9KHBhcnNlSW50KChjLmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoaixudWxsKXx8e21hcmdpblJpZ2h0OjB9KS5tYXJnaW5SaWdodCwxMCl8fDApPT09MCksby5pbm5lckhUTUw9IiIsbi5yZW1vdmVDaGlsZChvKTtpZihhLmF0dGFjaEV2ZW50KWZvcih0IGlue3N1Ym1pdDoxLGNoYW5nZToxLGZvY3VzaW46MX0pcz0ib24iK3QsdT1zIGluIGEsdXx8KGEuc2V0QXR0cmlidXRlKHMsInJldHVybjsiKSx1PXR5cGVvZiBhW3NdPT0iZnVuY3Rpb24iKSxrW3QrIkJ1YmJsZXMiXT11O289bD1nPWg9bT1qPWE9aT1udWxsO3JldHVybiBrfSgpLGYuYm94TW9kZWw9Zi5zdXBwb3J0LmJveE1vZGVsO3ZhciBpPS9eKD86XHsuKlx9fFxbLipcXSkkLyxqPS8oW2Etel0pKFtBLVpdKS9nO2YuZXh0ZW5kKHtjYWNoZTp7fSx1dWlkOjAsZXhwYW5kbzoialF1ZXJ5IisoZi5mbi5qcXVlcnkrTWF0aC5yYW5kb20oKSkucmVwbGFjZSgvXEQvZywiIiksbm9EYXRhOntlbWJlZDohMCxvYmplY3Q6ImNsc2lkOkQyN0NEQjZFLUFFNkQtMTFjZi05NkI4LTQ0NDU1MzU0MDAwMCIsYXBwbGV0OiEwfSxoYXNEYXRhOmZ1bmN0aW9uKGEpe2E9YS5ub2RlVHlwZT9mLmNhY2hlW2FbZi5leHBhbmRvXV06YVtmLmV4cGFuZG9dO3JldHVybiEhYSYmIWwoYSl9LGRhdGE6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoISFmLmFjY2VwdERhdGEoYSkpe3ZhciBnPWYuZXhwYW5kbyxoPXR5cGVvZiBjPT0ic3RyaW5nIixpLGo9YS5ub2RlVHlwZSxrPWo/Zi5jYWNoZTphLGw9aj9hW2YuZXhwYW5kb106YVtmLmV4cGFuZG9dJiZmLmV4cGFuZG87aWYoKCFsfHxlJiZsJiYha1tsXVtnXSkmJmgmJmQ9PT1iKXJldHVybjtsfHwoaj9hW2YuZXhwYW5kb109bD0rK2YudXVpZDpsPWYuZXhwYW5kbyksa1tsXXx8KGtbbF09e30sanx8KGtbbF0udG9KU09OPWYubm9vcCkpO2lmKHR5cGVvZiBjPT0ib2JqZWN0Inx8dHlwZW9mIGM9PSJmdW5jdGlvbiIpZT9rW2xdW2ddPWYuZXh0ZW5kKGtbbF1bZ10sYyk6a1tsXT1mLmV4dGVuZChrW2xdLGMpO2k9a1tsXSxlJiYoaVtnXXx8KGlbZ109e30pLGk9aVtnXSksZCE9PWImJihpW2YuY2FtZWxDYXNlKGMpXT1kKTtpZihjPT09ImV2ZW50cyImJiFpW2NdKXJldHVybiBpW2ddJiZpW2ddLmV2ZW50cztyZXR1cm4gaD9pW2YuY2FtZWxDYXNlKGMpXXx8aVtjXTppfX0scmVtb3ZlRGF0YTpmdW5jdGlvbihiLGMsZCl7aWYoISFmLmFjY2VwdERhdGEoYikpe3ZhciBlPWYuZXhwYW5kbyxnPWIubm9kZVR5cGUsaD1nP2YuY2FjaGU6YixpPWc/YltmLmV4cGFuZG9dOmYuZXhwYW5kbztpZighaFtpXSlyZXR1cm47aWYoYyl7dmFyIGo9ZD9oW2ldW2VdOmhbaV07aWYoail7ZGVsZXRlIGpbY107aWYoIWwoaikpcmV0dXJufX1pZihkKXtkZWxldGUgaFtpXVtlXTtpZighbChoW2ldKSlyZXR1cm59dmFyIGs9aFtpXVtlXTtmLnN1cHBvcnQuZGVsZXRlRXhwYW5kb3x8aCE9YT9kZWxldGUgaFtpXTpoW2ldPW51bGwsaz8oaFtpXT17fSxnfHwoaFtpXS50b0pTT049Zi5ub29wKSxoW2ldW2VdPWspOmcmJihmLnN1cHBvcnQuZGVsZXRlRXhwYW5kbz9kZWxldGUgYltmLmV4cGFuZG9dOmIucmVtb3ZlQXR0cmlidXRlP2IucmVtb3ZlQXR0cmlidXRlKGYuZXhwYW5kbyk6YltmLmV4cGFuZG9dPW51bGwpfX0sX2RhdGE6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmLmRhdGEoYSxiLGMsITApfSxhY2NlcHREYXRhOmZ1bmN0aW9uKGEpe2lmKGEubm9kZU5hbWUpe3ZhciBiPWYubm9EYXRhW2Eubm9kZU5hbWUudG9Mb3dlckNhc2UoKV07aWYoYilyZXR1cm4gYiE9PSEwJiZhLmdldEF0dHJpYnV0ZSgiY2xhc3NpZCIpPT09Yn1yZXR1cm4hMH19KSxmLmZuLmV4dGVuZCh7ZGF0YTpmdW5jdGlvbihhLGMpe3ZhciBkPW51bGw7aWYodHlwZW9mIGE9PSJ1bmRlZmluZWQiKXtpZih0aGlzLmxlbmd0aCl7ZD1mLmRhdGEodGhpc1swXSk7aWYodGhpc1swXS5ub2RlVHlwZT09PTEpe3ZhciBlPXRoaXNbMF0uYXR0cmlidXRlcyxnO2Zvcih2YXIgaD0wLGk9ZS5sZW5ndGg7aDxpO2grKylnPWVbaF0ubmFtZSxnLmluZGV4T2YoImRhdGEtIik9PT0wJiYoZz1mLmNhbWVsQ2FzZShnLnN1YnN0cmluZyg1KSksayh0aGlzWzBdLGcsZFtnXSkpfX1yZXR1cm4gZH1pZih0eXBlb2YgYT09Im9iamVjdCIpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YuZGF0YSh0aGlzLGEpfSk7dmFyIGo9YS5zcGxpdCgiLiIpO2pbMV09alsxXT8iLiIralsxXToiIjtpZihjPT09Yil7ZD10aGlzLnRyaWdnZXJIYW5kbGVyKCJnZXREYXRhIitqWzFdKyIhIixbalswXV0pLGQ9PT1iJiZ0aGlzLmxlbmd0aCYmKGQ9Zi5kYXRhKHRoaXNbMF0sYSksZD1rKHRoaXNbMF0sYSxkKSk7cmV0dXJuIGQ9PT1iJiZqWzFdP3RoaXMuZGF0YShqWzBdKTpkfXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1mKHRoaXMpLGQ9W2pbMF0sY107Yi50cmlnZ2VySGFuZGxlcigic2V0RGF0YSIralsxXSsiISIsZCksZi5kYXRhKHRoaXMsYSxjKSxiLnRyaWdnZXJIYW5kbGVyKCJjaGFuZ2VEYXRhIitqWzFdKyIhIixkKX0pfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLnJlbW92ZURhdGEodGhpcyxhKX0pfX0pLGYuZXh0ZW5kKHtfbWFyazpmdW5jdGlvbihhLGMpe2EmJihjPShjfHwiZngiKSsibWFyayIsZi5kYXRhKGEsYywoZi5kYXRhKGEsYyxiLCEwKXx8MCkrMSwhMCkpfSxfdW5tYXJrOmZ1bmN0aW9uKGEsYyxkKXthIT09ITAmJihkPWMsYz1hLGE9ITEpO2lmKGMpe2Q9ZHx8ImZ4Ijt2YXIgZT1kKyJtYXJrIixnPWE/MDooZi5kYXRhKGMsZSxiLCEwKXx8MSktMTtnP2YuZGF0YShjLGUsZywhMCk6KGYucmVtb3ZlRGF0YShjLGUsITApLG0oYyxkLCJtYXJrIikpfX0scXVldWU6ZnVuY3Rpb24oYSxjLGQpe2lmKGEpe2M9KGN8fCJmeCIpKyJxdWV1ZSI7dmFyIGU9Zi5kYXRhKGEsYyxiLCEwKTtkJiYoIWV8fGYuaXNBcnJheShkKT9lPWYuZGF0YShhLGMsZi5tYWtlQXJyYXkoZCksITApOmUucHVzaChkKSk7cmV0dXJuIGV8fFtdfX0sZGVxdWV1ZTpmdW5jdGlvbihhLGIpe2I9Ynx8ImZ4Ijt2YXIgYz1mLnF1ZXVlKGEsYiksZD1jLnNoaWZ0KCksZTtkPT09ImlucHJvZ3Jlc3MiJiYoZD1jLnNoaWZ0KCkpLGQmJihiPT09ImZ4IiYmYy51bnNoaWZ0KCJpbnByb2dyZXNzIiksZC5jYWxsKGEsZnVuY3Rpb24oKXtmLmRlcXVldWUoYSxiKX0pKSxjLmxlbmd0aHx8KGYucmVtb3ZlRGF0YShhLGIrInF1ZXVlIiwhMCksbShhLGIsInF1ZXVlIikpfX0pLGYuZm4uZXh0ZW5kKHtxdWV1ZTpmdW5jdGlvbihhLGMpe3R5cGVvZiBhIT0ic3RyaW5nIiYmKGM9YSxhPSJmeCIpO2lmKGM9PT1iKXJldHVybiBmLnF1ZXVlKHRoaXNbMF0sYSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWYucXVldWUodGhpcyxhLGMpO2E9PT0iZngiJiZiWzBdIT09ImlucHJvZ3Jlc3MiJiZmLmRlcXVldWUodGhpcyxhKX0pfSxkZXF1ZXVlOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLmRlcXVldWUodGhpcyxhKX0pfSxkZWxheTpmdW5jdGlvbihhLGIpe2E9Zi5meD9mLmZ4LnNwZWVkc1thXXx8YTphLGI9Ynx8ImZ4IjtyZXR1cm4gdGhpcy5xdWV1ZShiLGZ1bmN0aW9uKCl7dmFyIGM9dGhpcztzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Zi5kZXF1ZXVlKGMsYil9LGEpfSl9LGNsZWFyUXVldWU6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucXVldWUoYXx8ImZ4IixbXSl9LHByb21pc2U6ZnVuY3Rpb24oYSxjKXtmdW5jdGlvbiBtKCl7LS1ofHxkLnJlc29sdmVXaXRoKGUsW2VdKX10eXBlb2YgYSE9InN0cmluZyImJihjPWEsYT1iKSxhPWF8fCJmeCI7dmFyIGQ9Zi5EZWZlcnJlZCgpLGU9dGhpcyxnPWUubGVuZ3RoLGg9MSxpPWErImRlZmVyIixqPWErInF1ZXVlIixrPWErIm1hcmsiLGw7d2hpbGUoZy0tKWlmKGw9Zi5kYXRhKGVbZ10saSxiLCEwKXx8KGYuZGF0YShlW2ddLGosYiwhMCl8fGYuZGF0YShlW2ddLGssYiwhMCkpJiZmLmRhdGEoZVtnXSxpLGYuX0RlZmVycmVkKCksITApKWgrKyxsLmRvbmUobSk7bSgpO3JldHVybiBkLnByb21pc2UoKX19KTt2YXIgbj0vW1xuXHRccl0vZyxvPS9ccysvLHA9L1xyL2cscT0vXig/OmJ1dHRvbnxpbnB1dCkkL2kscj0vXig/OmJ1dHRvbnxpbnB1dHxvYmplY3R8c2VsZWN0fHRleHRhcmVhKSQvaSxzPS9eYSg/OnJlYSk/JC9pLHQ9L14oPzphdXRvZm9jdXN8YXV0b3BsYXl8YXN5bmN8Y2hlY2tlZHxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZHxzZWxlY3RlZCkkL2ksdT0vXDp8Xm9uLyx2LHc7Zi5mbi5leHRlbmQoe2F0dHI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZi5hY2Nlc3ModGhpcyxhLGIsITAsZi5hdHRyKX0scmVtb3ZlQXR0cjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zi5yZW1vdmVBdHRyKHRoaXMsYSl9KX0scHJvcDpmdW5jdGlvbihhLGIpe3JldHVybiBmLmFjY2Vzcyh0aGlzLGEsYiwhMCxmLnByb3ApfSxyZW1vdmVQcm9wOmZ1bmN0aW9uKGEpe2E9Zi5wcm9wRml4W2FdfHxhO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt0cnl7dGhpc1thXT1iLGRlbGV0ZSB0aGlzW2FdfWNhdGNoKGMpe319KX0sYWRkQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGUsZyxoLGk7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zih0aGlzKS5hZGRDbGFzcyhhLmNhbGwodGhpcyxiLHRoaXMuY2xhc3NOYW1lKSl9KTtpZihhJiZ0eXBlb2YgYT09InN0cmluZyIpe2I9YS5zcGxpdChvKTtmb3IoYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKyl7ZT10aGlzW2NdO2lmKGUubm9kZVR5cGU9PT0xKWlmKCFlLmNsYXNzTmFtZSYmYi5sZW5ndGg9PT0xKWUuY2xhc3NOYW1lPWE7ZWxzZXtnPSIgIitlLmNsYXNzTmFtZSsiICI7Zm9yKGg9MCxpPWIubGVuZ3RoO2g8aTtoKyspfmcuaW5kZXhPZigiICIrYltoXSsiICIpfHwoZys9YltoXSsiICIpO2UuY2xhc3NOYW1lPWYudHJpbShnKX19fXJldHVybiB0aGlzfSxyZW1vdmVDbGFzczpmdW5jdGlvbihhKXt2YXIgYyxkLGUsZyxoLGksajtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmKHRoaXMpLnJlbW92ZUNsYXNzKGEuY2FsbCh0aGlzLGIsdGhpcy5jbGFzc05hbWUpKX0pO2lmKGEmJnR5cGVvZiBhPT0ic3RyaW5nInx8YT09PWIpe2M9KGF8fCIiKS5zcGxpdChvKTtmb3IoZD0wLGU9dGhpcy5sZW5ndGg7ZDxlO2QrKyl7Zz10aGlzW2RdO2lmKGcubm9kZVR5cGU9PT0xJiZnLmNsYXNzTmFtZSlpZihhKXtoPSgiICIrZy5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKG4sIiAiKTtmb3IoaT0wLGo9Yy5sZW5ndGg7aTxqO2krKyloPWgucmVwbGFjZSgiICIrY1tpXSsiICIsIiAiKTtnLmNsYXNzTmFtZT1mLnRyaW0oaCl9ZWxzZSBnLmNsYXNzTmFtZT0iIn19cmV0dXJuIHRoaXN9LHRvZ2dsZUNsYXNzOmZ1bmN0aW9uKGEsYil7dmFyIGM9dHlwZW9mIGEsZD10eXBlb2YgYj09ImJvb2xlYW4iO2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGMpe2YodGhpcykudG9nZ2xlQ2xhc3MoYS5jYWxsKHRoaXMsYyx0aGlzLmNsYXNzTmFtZSxiKSxiKX0pO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZihjPT09InN0cmluZyIpe3ZhciBlLGc9MCxoPWYodGhpcyksaT1iLGo9YS5zcGxpdChvKTt3aGlsZShlPWpbZysrXSlpPWQ/aTohaC5oYXNDbGFzcyhlKSxoW2k/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXShlKX1lbHNlIGlmKGM9PT0idW5kZWZpbmVkInx8Yz09PSJib29sZWFuIil0aGlzLmNsYXNzTmFtZSYmZi5fZGF0YSh0aGlzLCJfX2NsYXNzTmFtZV9fIix0aGlzLmNsYXNzTmFtZSksdGhpcy5jbGFzc05hbWU9dGhpcy5jbGFzc05hbWV8fGE9PT0hMT8iIjpmLl9kYXRhKHRoaXMsIl9fY2xhc3NOYW1lX18iKXx8IiJ9KX0saGFzQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGI9IiAiK2ErIiAiO2Zvcih2YXIgYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKylpZigoIiAiK3RoaXNbY10uY2xhc3NOYW1lKyIgIikucmVwbGFjZShuLCIgIikuaW5kZXhPZihiKT4tMSlyZXR1cm4hMDtyZXR1cm4hMX0sdmFsOmZ1bmN0aW9uKGEpe3ZhciBjLGQsZT10aGlzWzBdO2lmKCFhcmd1bWVudHMubGVuZ3RoKXtpZihlKXtjPWYudmFsSG9va3NbZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXXx8Zi52YWxIb29rc1tlLnR5cGVdO2lmKGMmJiJnZXQiaW4gYyYmKGQ9Yy5nZXQoZSwidmFsdWUiKSkhPT1iKXJldHVybiBkO2Q9ZS52YWx1ZTtyZXR1cm4gdHlwZW9mIGQ9PSJzdHJpbmciP2QucmVwbGFjZShwLCIiKTpkPT1udWxsPyIiOmR9cmV0dXJuIGJ9dmFyIGc9Zi5pc0Z1bmN0aW9uKGEpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZCl7dmFyIGU9Zih0aGlzKSxoO2lmKHRoaXMubm9kZVR5cGU9PT0xKXtnP2g9YS5jYWxsKHRoaXMsZCxlLnZhbCgpKTpoPWEsaD09bnVsbD9oPSIiOnR5cGVvZiBoPT0ibnVtYmVyIj9oKz0iIjpmLmlzQXJyYXkoaCkmJihoPWYubWFwKGgsZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/IiI6YSsiIn0pKSxjPWYudmFsSG9va3NbdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXXx8Zi52YWxIb29rc1t0aGlzLnR5cGVdO2lmKCFjfHwhKCJzZXQiaW4gYyl8fGMuc2V0KHRoaXMsaCwidmFsdWUiKT09PWIpdGhpcy52YWx1ZT1ofX0pfX0pLGYuZXh0ZW5kKHt2YWxIb29rczp7b3B0aW9uOntnZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5hdHRyaWJ1dGVzLnZhbHVlO3JldHVybiFifHxiLnNwZWNpZmllZD9hLnZhbHVlOmEudGV4dH19LHNlbGVjdDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiLGM9YS5zZWxlY3RlZEluZGV4LGQ9W10sZT1hLm9wdGlvbnMsZz1hLnR5cGU9PT0ic2VsZWN0LW9uZSI7aWYoYzwwKXJldHVybiBudWxsO2Zvcih2YXIgaD1nP2M6MCxpPWc/YysxOmUubGVuZ3RoO2g8aTtoKyspe3ZhciBqPWVbaF07aWYoai5zZWxlY3RlZCYmKGYuc3VwcG9ydC5vcHREaXNhYmxlZD8hai5kaXNhYmxlZDpqLmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKT09PW51bGwpJiYoIWoucGFyZW50Tm9kZS5kaXNhYmxlZHx8IWYubm9kZU5hbWUoai5wYXJlbnROb2RlLCJvcHRncm91cCIpKSl7Yj1mKGopLnZhbCgpO2lmKGcpcmV0dXJuIGI7ZC5wdXNoKGIpfX1pZihnJiYhZC5sZW5ndGgmJmUubGVuZ3RoKXJldHVybiBmKGVbY10pLnZhbCgpO3JldHVybiBkfSxzZXQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz1mLm1ha2VBcnJheShiKTtmKGEpLmZpbmQoIm9wdGlvbiIpLmVhY2goZnVuY3Rpb24oKXt0aGlzLnNlbGVjdGVkPWYuaW5BcnJheShmKHRoaXMpLnZhbCgpLGMpPj0wfSksYy5sZW5ndGh8fChhLnNlbGVjdGVkSW5kZXg9LTEpO3JldHVybiBjfX19LGF0dHJGbjp7dmFsOiEwLGNzczohMCxodG1sOiEwLHRleHQ6ITAsZGF0YTohMCx3aWR0aDohMCxoZWlnaHQ6ITAsb2Zmc2V0OiEwfSxhdHRyRml4Ont0YWJpbmRleDoidGFiSW5kZXgifSxhdHRyOmZ1bmN0aW9uKGEsYyxkLGUpe3ZhciBnPWEubm9kZVR5cGU7aWYoIWF8fGc9PT0zfHxnPT09OHx8Zz09PTIpcmV0dXJuIGI7aWYoZSYmYyBpbiBmLmF0dHJGbilyZXR1cm4gZihhKVtjXShkKTtpZighKCJnZXRBdHRyaWJ1dGUiaW4gYSkpcmV0dXJuIGYucHJvcChhLGMsZCk7dmFyIGgsaSxqPWchPT0xfHwhZi5pc1hNTERvYyhhKTtqJiYoYz1mLmF0dHJGaXhbY118fGMsaT1mLmF0dHJIb29rc1tjXSxpfHwodC50ZXN0KGMpP2k9dzp2JiZjIT09ImNsYXNzTmFtZSImJihmLm5vZGVOYW1lKGEsImZvcm0iKXx8dS50ZXN0KGMpKSYmKGk9dikpKTtpZihkIT09Yil7aWYoZD09PW51bGwpe2YucmVtb3ZlQXR0cihhLGMpO3JldHVybiBifWlmKGkmJiJzZXQiaW4gaSYmaiYmKGg9aS5zZXQoYSxkLGMpKSE9PWIpcmV0dXJuIGg7YS5zZXRBdHRyaWJ1dGUoYywiIitkKTtyZXR1cm4gZH1pZihpJiYiZ2V0ImluIGkmJmomJihoPWkuZ2V0KGEsYykpIT09bnVsbClyZXR1cm4gaDtoPWEuZ2V0QXR0cmlidXRlKGMpO3JldHVybiBoPT09bnVsbD9iOmh9LHJlbW92ZUF0dHI6ZnVuY3Rpb24oYSxiKXt2YXIgYzthLm5vZGVUeXBlPT09MSYmKGI9Zi5hdHRyRml4W2JdfHxiLGYuc3VwcG9ydC5nZXRTZXRBdHRyaWJ1dGU/YS5yZW1vdmVBdHRyaWJ1dGUoYik6KGYuYXR0cihhLGIsIiIpLGEucmVtb3ZlQXR0cmlidXRlTm9kZShhLmdldEF0dHJpYnV0ZU5vZGUoYikpKSx0LnRlc3QoYikmJihjPWYucHJvcEZpeFtiXXx8YilpbiBhJiYoYVtjXT0hMSkpfSxhdHRySG9va3M6e3R5cGU6e3NldDpmdW5jdGlvbihhLGIpe2lmKHEudGVzdChhLm5vZGVOYW1lKSYmYS5wYXJlbnROb2RlKWYuZXJyb3IoInR5cGUgcHJvcGVydHkgY2FuJ3QgYmUgY2hhbmdlZCIpO2Vsc2UgaWYoIWYuc3VwcG9ydC5yYWRpb1ZhbHVlJiZiPT09InJhZGlvIiYmZi5ub2RlTmFtZShhLCJpbnB1dCIpKXt2YXIgYz1hLnZhbHVlO2Euc2V0QXR0cmlidXRlKCJ0eXBlIixiKSxjJiYoYS52YWx1ZT1jKTtyZXR1cm4gYn19fSx0YWJJbmRleDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBjPWEuZ2V0QXR0cmlidXRlTm9kZSgidGFiSW5kZXgiKTtyZXR1cm4gYyYmYy5zcGVjaWZpZWQ/cGFyc2VJbnQoYy52YWx1ZSwxMCk6ci50ZXN0KGEubm9kZU5hbWUpfHxzLnRlc3QoYS5ub2RlTmFtZSkmJmEuaHJlZj8wOmJ9fSx2YWx1ZTp7Z2V0OmZ1bmN0aW9uKGEsYil7aWYodiYmZi5ub2RlTmFtZShhLCJidXR0b24iKSlyZXR1cm4gdi5nZXQoYSxiKTtyZXR1cm4gYiBpbiBhP2EudmFsdWU6bnVsbH0sc2V0OmZ1bmN0aW9uKGEsYixjKXtpZih2JiZmLm5vZGVOYW1lKGEsImJ1dHRvbiIpKXJldHVybiB2LnNldChhLGIsYyk7YS52YWx1ZT1ifX19LHByb3BGaXg6e3RhYmluZGV4OiJ0YWJJbmRleCIscmVhZG9ubHk6InJlYWRPbmx5IiwiZm9yIjoiaHRtbEZvciIsImNsYXNzIjoiY2xhc3NOYW1lIixtYXhsZW5ndGg6Im1heExlbmd0aCIsY2VsbHNwYWNpbmc6ImNlbGxTcGFjaW5nIixjZWxscGFkZGluZzoiY2VsbFBhZGRpbmciLHJvd3NwYW46InJvd1NwYW4iLGNvbHNwYW46ImNvbFNwYW4iLHVzZW1hcDoidXNlTWFwIixmcmFtZWJvcmRlcjoiZnJhbWVCb3JkZXIiLGNvbnRlbnRlZGl0YWJsZToiY29udGVudEVkaXRhYmxlIn0scHJvcDpmdW5jdGlvbihhLGMsZCl7dmFyIGU9YS5ub2RlVHlwZTtpZighYXx8ZT09PTN8fGU9PT04fHxlPT09MilyZXR1cm4gYjt2YXIgZyxoLGk9ZSE9PTF8fCFmLmlzWE1MRG9jKGEpO2kmJihjPWYucHJvcEZpeFtjXXx8YyxoPWYucHJvcEhvb2tzW2NdKTtyZXR1cm4gZCE9PWI/aCYmInNldCJpbiBoJiYoZz1oLnNldChhLGQsYykpIT09Yj9nOmFbY109ZDpoJiYiZ2V0ImluIGgmJihnPWguZ2V0KGEsYykpIT09Yj9nOmFbY119LHByb3BIb29rczp7fX0pLHc9e2dldDpmdW5jdGlvbihhLGMpe3JldHVybiBmLnByb3AoYSxjKT9jLnRvTG93ZXJDYXNlKCk6Yn0sc2V0OmZ1bmN0aW9uKGEsYixjKXt2YXIgZDtiPT09ITE/Zi5yZW1vdmVBdHRyKGEsYyk6KGQ9Zi5wcm9wRml4W2NdfHxjLGQgaW4gYSYmKGFbZF09ITApLGEuc2V0QXR0cmlidXRlKGMsYy50b0xvd2VyQ2FzZSgpKSk7cmV0dXJuIGN9fSxmLnN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlfHwoZi5hdHRyRml4PWYucHJvcEZpeCx2PWYuYXR0ckhvb2tzLm5hbWU9Zi5hdHRySG9va3MudGl0bGU9Zi52YWxIb29rcy5idXR0b249e2dldDpmdW5jdGlvbihhLGMpe3ZhciBkO2Q9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpO3JldHVybiBkJiZkLm5vZGVWYWx1ZSE9PSIiP2Qubm9kZVZhbHVlOmJ9LHNldDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpO2lmKGQpe2Qubm9kZVZhbHVlPWI7cmV0dXJuIGJ9fX0sZi5lYWNoKFsid2lkdGgiLCJoZWlnaHQiXSxmdW5jdGlvbihhLGIpe2YuYXR0ckhvb2tzW2JdPWYuZXh0ZW5kKGYuYXR0ckhvb2tzW2JdLHtzZXQ6ZnVuY3Rpb24oYSxjKXtpZihjPT09IiIpe2Euc2V0QXR0cmlidXRlKGIsImF1dG8iKTtyZXR1cm4gY319fSl9KSksZi5zdXBwb3J0LmhyZWZOb3JtYWxpemVkfHxmLmVhY2goWyJocmVmIiwic3JjIiwid2lkdGgiLCJoZWlnaHQiXSxmdW5jdGlvbihhLGMpe2YuYXR0ckhvb2tzW2NdPWYuZXh0ZW5kKGYuYXR0ckhvb2tzW2NdLHtnZXQ6ZnVuY3Rpb24oYSl7dmFyIGQ9YS5nZXRBdHRyaWJ1dGUoYywyKTtyZXR1cm4gZD09PW51bGw/YjpkfX0pfSksZi5zdXBwb3J0LnN0eWxlfHwoZi5hdHRySG9va3Muc3R5bGU9e2dldDpmdW5jdGlvbihhKXtyZXR1cm4gYS5zdHlsZS5jc3NUZXh0LnRvTG93ZXJDYXNlKCl8fGJ9LHNldDpmdW5jdGlvbihhLGIpe3JldHVybiBhLnN0eWxlLmNzc1RleHQ9IiIrYn19KSxmLnN1cHBvcnQub3B0U2VsZWN0ZWR8fChmLnByb3BIb29rcy5zZWxlY3RlZD1mLmV4dGVuZChmLnByb3BIb29rcy5zZWxlY3RlZCx7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiPWEucGFyZW50Tm9kZTtiJiYoYi5zZWxlY3RlZEluZGV4LGIucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgpfX0pKSxmLnN1cHBvcnQuY2hlY2tPbnx8Zi5lYWNoKFsicmFkaW8iLCJjaGVja2JveCJdLGZ1bmN0aW9uKCl7Zi52YWxIb29rc1t0aGlzXT17Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgidmFsdWUiKT09PW51bGw/Im9uIjphLnZhbHVlfX19KSxmLmVhY2goWyJyYWRpbyIsImNoZWNrYm94Il0sZnVuY3Rpb24oKXtmLnZhbEhvb2tzW3RoaXNdPWYuZXh0ZW5kKGYudmFsSG9va3NbdGhpc10se3NldDpmdW5jdGlvbihhLGIpe2lmKGYuaXNBcnJheShiKSlyZXR1cm4gYS5jaGVja2VkPWYuaW5BcnJheShmKGEpLnZhbCgpLGIpPj0wfX0pfSk7dmFyIHg9L1wuKC4qKSQvLHk9L14oPzp0ZXh0YXJlYXxpbnB1dHxzZWxlY3QpJC9pLHo9L1wuL2csQT0vIC9nLEI9L1teXHdccy58YF0vZyxDPWZ1bmN0aW9uKGEpe3JldHVybiBhLnJlcGxhY2UoQiwiXFwkJiIpfTtmLmV2ZW50PXthZGQ6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoYS5ub2RlVHlwZSE9PTMmJmEubm9kZVR5cGUhPT04KXtpZihkPT09ITEpZD1EO2Vsc2UgaWYoIWQpcmV0dXJuO3ZhciBnLGg7ZC5oYW5kbGVyJiYoZz1kLGQ9Zy5oYW5kbGVyKSxkLmd1aWR8fChkLmd1aWQ9Zi5ndWlkKyspO3ZhciBpPWYuX2RhdGEoYSk7aWYoIWkpcmV0dXJuO3ZhciBqPWkuZXZlbnRzLGs9aS5oYW5kbGU7anx8KGkuZXZlbnRzPWo9e30pLGt8fChpLmhhbmRsZT1rPWZ1bmN0aW9uKGEpe3JldHVybiB0eXBlb2YgZiE9InVuZGVmaW5lZCImJighYXx8Zi5ldmVudC50cmlnZ2VyZWQhPT1hLnR5cGUpP2YuZXZlbnQuaGFuZGxlLmFwcGx5KGsuZWxlbSxhcmd1bWVudHMpOmJ9KSxrLmVsZW09YSxjPWMuc3BsaXQoIiAiKTt2YXIgbCxtPTAsbjt3aGlsZShsPWNbbSsrXSl7aD1nP2YuZXh0ZW5kKHt9LGcpOntoYW5kbGVyOmQsZGF0YTplfSxsLmluZGV4T2YoIi4iKT4tMT8obj1sLnNwbGl0KCIuIiksbD1uLnNoaWZ0KCksaC5uYW1lc3BhY2U9bi5zbGljZSgwKS5zb3J0KCkuam9pbigiLiIpKToobj1bXSxoLm5hbWVzcGFjZT0iIiksaC50eXBlPWwsaC5ndWlkfHwoaC5ndWlkPWQuZ3VpZCk7dmFyIG89altsXSxwPWYuZXZlbnQuc3BlY2lhbFtsXXx8e307aWYoIW8pe289altsXT1bXTtpZighcC5zZXR1cHx8cC5zZXR1cC5jYWxsKGEsZSxuLGspPT09ITEpYS5hZGRFdmVudExpc3RlbmVyP2EuYWRkRXZlbnRMaXN0ZW5lcihsLGssITEpOmEuYXR0YWNoRXZlbnQmJmEuYXR0YWNoRXZlbnQoIm9uIitsLGspfXAuYWRkJiYocC5hZGQuY2FsbChhLGgpLGguaGFuZGxlci5ndWlkfHwoaC5oYW5kbGVyLmd1aWQ9ZC5ndWlkKSksby5wdXNoKGgpLGYuZXZlbnQuZ2xvYmFsW2xdPSEwfWE9bnVsbH19LGdsb2JhbDp7fSxyZW1vdmU6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoYS5ub2RlVHlwZSE9PTMmJmEubm9kZVR5cGUhPT04KXtkPT09ITEmJihkPUQpO3ZhciBnLGgsaSxqLGs9MCxsLG0sbixvLHAscSxyLHM9Zi5oYXNEYXRhKGEpJiZmLl9kYXRhKGEpLHQ9cyYmcy5ldmVudHM7aWYoIXN8fCF0KXJldHVybjtjJiZjLnR5cGUmJihkPWMuaGFuZGxlcixjPWMudHlwZSk7aWYoIWN8fHR5cGVvZiBjPT0ic3RyaW5nIiYmYy5jaGFyQXQoMCk9PT0iLiIpe2M9Y3x8IiI7Zm9yKGggaW4gdClmLmV2ZW50LnJlbW92ZShhLGgrYyk7cmV0dXJufWM9Yy5zcGxpdCgiICIpO3doaWxlKGg9Y1trKytdKXtyPWgscT1udWxsLGw9aC5pbmRleE9mKCIuIik8MCxtPVtdLGx8fChtPWguc3BsaXQoIi4iKSxoPW0uc2hpZnQoKSxuPW5ldyBSZWdFeHAoIihefFxcLikiK2YubWFwKG0uc2xpY2UoMCkuc29ydCgpLEMpLmpvaW4oIlxcLig/Oi4qXFwuKT8iKSsiKFxcLnwkKSIpKSxwPXRbaF07aWYoIXApY29udGludWU7aWYoIWQpe2ZvcihqPTA7ajxwLmxlbmd0aDtqKyspe3E9cFtqXTtpZihsfHxuLnRlc3QocS5uYW1lc3BhY2UpKWYuZXZlbnQucmVtb3ZlKGEscixxLmhhbmRsZXIsaikscC5zcGxpY2Uoai0tLDEpfWNvbnRpbnVlfW89Zi5ldmVudC5zcGVjaWFsW2hdfHx7fTtmb3Ioaj1lfHwwO2o8cC5sZW5ndGg7aisrKXtxPXBbal07aWYoZC5ndWlkPT09cS5ndWlkKXtpZihsfHxuLnRlc3QocS5uYW1lc3BhY2UpKWU9PW51bGwmJnAuc3BsaWNlKGotLSwxKSxvLnJlbW92ZSYmby5yZW1vdmUuY2FsbChhLHEpO2lmKGUhPW51bGwpYnJlYWt9fWlmKHAubGVuZ3RoPT09MHx8ZSE9bnVsbCYmcC5sZW5ndGg9PT0xKSghby50ZWFyZG93bnx8by50ZWFyZG93bi5jYWxsKGEsbSk9PT0hMSkmJmYucmVtb3ZlRXZlbnQoYSxoLHMuaGFuZGxlKSxnPW51bGwsZGVsZXRlIHRbaF19aWYoZi5pc0VtcHR5T2JqZWN0KHQpKXt2YXIgdT1zLmhhbmRsZTt1JiYodS5lbGVtPW51bGwpLGRlbGV0ZSBzLmV2ZW50cyxkZWxldGUgcy5oYW5kbGUsZi5pc0VtcHR5T2JqZWN0KHMpJiZmLnJlbW92ZURhdGEoYSxiLCEwKX19fSxjdXN0b21FdmVudDp7Z2V0RGF0YTohMCxzZXREYXRhOiEwLGNoYW5nZURhdGE6ITB9LHRyaWdnZXI6ZnVuY3Rpb24oYyxkLGUsZyl7dmFyIGg9Yy50eXBlfHxjLGk9W10sajtoLmluZGV4T2YoIiEiKT49MCYmKGg9aC5zbGljZSgwLC0xKSxqPSEwKSxoLmluZGV4T2YoIi4iKT49MCYmKGk9aC5zcGxpdCgiLiIpLGg9aS4Kc2hpZnQoKSxpLnNvcnQoKSk7aWYoISFlJiYhZi5ldmVudC5jdXN0b21FdmVudFtoXXx8ISFmLmV2ZW50Lmdsb2JhbFtoXSl7Yz10eXBlb2YgYz09Im9iamVjdCI/Y1tmLmV4cGFuZG9dP2M6bmV3IGYuRXZlbnQoaCxjKTpuZXcgZi5FdmVudChoKSxjLnR5cGU9aCxjLmV4Y2x1c2l2ZT1qLGMubmFtZXNwYWNlPWkuam9pbigiLiIpLGMubmFtZXNwYWNlX3JlPW5ldyBSZWdFeHAoIihefFxcLikiK2kuam9pbigiXFwuKD86LipcXC4pPyIpKyIoXFwufCQpIik7aWYoZ3x8IWUpYy5wcmV2ZW50RGVmYXVsdCgpLGMuc3RvcFByb3BhZ2F0aW9uKCk7aWYoIWUpe2YuZWFjaChmLmNhY2hlLGZ1bmN0aW9uKCl7dmFyIGE9Zi5leHBhbmRvLGI9dGhpc1thXTtiJiZiLmV2ZW50cyYmYi5ldmVudHNbaF0mJmYuZXZlbnQudHJpZ2dlcihjLGQsYi5oYW5kbGUuZWxlbSl9KTtyZXR1cm59aWYoZS5ub2RlVHlwZT09PTN8fGUubm9kZVR5cGU9PT04KXJldHVybjtjLnJlc3VsdD1iLGMudGFyZ2V0PWUsZD1kIT1udWxsP2YubWFrZUFycmF5KGQpOltdLGQudW5zaGlmdChjKTt2YXIgaz1lLGw9aC5pbmRleE9mKCI6Iik8MD8ib24iK2g6IiI7ZG97dmFyIG09Zi5fZGF0YShrLCJoYW5kbGUiKTtjLmN1cnJlbnRUYXJnZXQ9ayxtJiZtLmFwcGx5KGssZCksbCYmZi5hY2NlcHREYXRhKGspJiZrW2xdJiZrW2xdLmFwcGx5KGssZCk9PT0hMSYmKGMucmVzdWx0PSExLGMucHJldmVudERlZmF1bHQoKSksaz1rLnBhcmVudE5vZGV8fGsub3duZXJEb2N1bWVudHx8az09PWMudGFyZ2V0Lm93bmVyRG9jdW1lbnQmJmF9d2hpbGUoayYmIWMuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSk7aWYoIWMuaXNEZWZhdWx0UHJldmVudGVkKCkpe3ZhciBuLG89Zi5ldmVudC5zcGVjaWFsW2hdfHx7fTtpZigoIW8uX2RlZmF1bHR8fG8uX2RlZmF1bHQuY2FsbChlLm93bmVyRG9jdW1lbnQsYyk9PT0hMSkmJihoIT09ImNsaWNrInx8IWYubm9kZU5hbWUoZSwiYSIpKSYmZi5hY2NlcHREYXRhKGUpKXt0cnl7bCYmZVtoXSYmKG49ZVtsXSxuJiYoZVtsXT1udWxsKSxmLmV2ZW50LnRyaWdnZXJlZD1oLGVbaF0oKSl9Y2F0Y2gocCl7fW4mJihlW2xdPW4pLGYuZXZlbnQudHJpZ2dlcmVkPWJ9fXJldHVybiBjLnJlc3VsdH19LGhhbmRsZTpmdW5jdGlvbihjKXtjPWYuZXZlbnQuZml4KGN8fGEuZXZlbnQpO3ZhciBkPSgoZi5fZGF0YSh0aGlzLCJldmVudHMiKXx8e30pW2MudHlwZV18fFtdKS5zbGljZSgwKSxlPSFjLmV4Y2x1c2l2ZSYmIWMubmFtZXNwYWNlLGc9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApO2dbMF09YyxjLmN1cnJlbnRUYXJnZXQ9dGhpcztmb3IodmFyIGg9MCxpPWQubGVuZ3RoO2g8aTtoKyspe3ZhciBqPWRbaF07aWYoZXx8Yy5uYW1lc3BhY2VfcmUudGVzdChqLm5hbWVzcGFjZSkpe2MuaGFuZGxlcj1qLmhhbmRsZXIsYy5kYXRhPWouZGF0YSxjLmhhbmRsZU9iaj1qO3ZhciBrPWouaGFuZGxlci5hcHBseSh0aGlzLGcpO2shPT1iJiYoYy5yZXN1bHQ9ayxrPT09ITEmJihjLnByZXZlbnREZWZhdWx0KCksYy5zdG9wUHJvcGFnYXRpb24oKSkpO2lmKGMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSlicmVha319cmV0dXJuIGMucmVzdWx0fSxwcm9wczoiYWx0S2V5IGF0dHJDaGFuZ2UgYXR0ck5hbWUgYnViYmxlcyBidXR0b24gY2FuY2VsYWJsZSBjaGFyQ29kZSBjbGllbnRYIGNsaWVudFkgY3RybEtleSBjdXJyZW50VGFyZ2V0IGRhdGEgZGV0YWlsIGV2ZW50UGhhc2UgZnJvbUVsZW1lbnQgaGFuZGxlciBrZXlDb2RlIGxheWVyWCBsYXllclkgbWV0YUtleSBuZXdWYWx1ZSBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgcHJldlZhbHVlIHJlbGF0ZWROb2RlIHJlbGF0ZWRUYXJnZXQgc2NyZWVuWCBzY3JlZW5ZIHNoaWZ0S2V5IHNyY0VsZW1lbnQgdGFyZ2V0IHRvRWxlbWVudCB2aWV3IHdoZWVsRGVsdGEgd2hpY2giLnNwbGl0KCIgIiksZml4OmZ1bmN0aW9uKGEpe2lmKGFbZi5leHBhbmRvXSlyZXR1cm4gYTt2YXIgZD1hO2E9Zi5FdmVudChkKTtmb3IodmFyIGU9dGhpcy5wcm9wcy5sZW5ndGgsZztlOylnPXRoaXMucHJvcHNbLS1lXSxhW2ddPWRbZ107YS50YXJnZXR8fChhLnRhcmdldD1hLnNyY0VsZW1lbnR8fGMpLGEudGFyZ2V0Lm5vZGVUeXBlPT09MyYmKGEudGFyZ2V0PWEudGFyZ2V0LnBhcmVudE5vZGUpLCFhLnJlbGF0ZWRUYXJnZXQmJmEuZnJvbUVsZW1lbnQmJihhLnJlbGF0ZWRUYXJnZXQ9YS5mcm9tRWxlbWVudD09PWEudGFyZ2V0P2EudG9FbGVtZW50OmEuZnJvbUVsZW1lbnQpO2lmKGEucGFnZVg9PW51bGwmJmEuY2xpZW50WCE9bnVsbCl7dmFyIGg9YS50YXJnZXQub3duZXJEb2N1bWVudHx8YyxpPWguZG9jdW1lbnRFbGVtZW50LGo9aC5ib2R5O2EucGFnZVg9YS5jbGllbnRYKyhpJiZpLnNjcm9sbExlZnR8fGomJmouc2Nyb2xsTGVmdHx8MCktKGkmJmkuY2xpZW50TGVmdHx8aiYmai5jbGllbnRMZWZ0fHwwKSxhLnBhZ2VZPWEuY2xpZW50WSsoaSYmaS5zY3JvbGxUb3B8fGomJmouc2Nyb2xsVG9wfHwwKS0oaSYmaS5jbGllbnRUb3B8fGomJmouY2xpZW50VG9wfHwwKX1hLndoaWNoPT1udWxsJiYoYS5jaGFyQ29kZSE9bnVsbHx8YS5rZXlDb2RlIT1udWxsKSYmKGEud2hpY2g9YS5jaGFyQ29kZSE9bnVsbD9hLmNoYXJDb2RlOmEua2V5Q29kZSksIWEubWV0YUtleSYmYS5jdHJsS2V5JiYoYS5tZXRhS2V5PWEuY3RybEtleSksIWEud2hpY2gmJmEuYnV0dG9uIT09YiYmKGEud2hpY2g9YS5idXR0b24mMT8xOmEuYnV0dG9uJjI/MzphLmJ1dHRvbiY0PzI6MCk7cmV0dXJuIGF9LGd1aWQ6MWU4LHByb3h5OmYucHJveHksc3BlY2lhbDp7cmVhZHk6e3NldHVwOmYuYmluZFJlYWR5LHRlYXJkb3duOmYubm9vcH0sbGl2ZTp7YWRkOmZ1bmN0aW9uKGEpe2YuZXZlbnQuYWRkKHRoaXMsTihhLm9yaWdUeXBlLGEuc2VsZWN0b3IpLGYuZXh0ZW5kKHt9LGEse2hhbmRsZXI6TSxndWlkOmEuaGFuZGxlci5ndWlkfSkpfSxyZW1vdmU6ZnVuY3Rpb24oYSl7Zi5ldmVudC5yZW1vdmUodGhpcyxOKGEub3JpZ1R5cGUsYS5zZWxlY3RvciksYSl9fSxiZWZvcmV1bmxvYWQ6e3NldHVwOmZ1bmN0aW9uKGEsYixjKXtmLmlzV2luZG93KHRoaXMpJiYodGhpcy5vbmJlZm9yZXVubG9hZD1jKX0sdGVhcmRvd246ZnVuY3Rpb24oYSxiKXt0aGlzLm9uYmVmb3JldW5sb2FkPT09YiYmKHRoaXMub25iZWZvcmV1bmxvYWQ9bnVsbCl9fX19LGYucmVtb3ZlRXZlbnQ9Yy5yZW1vdmVFdmVudExpc3RlbmVyP2Z1bmN0aW9uKGEsYixjKXthLnJlbW92ZUV2ZW50TGlzdGVuZXImJmEucmVtb3ZlRXZlbnRMaXN0ZW5lcihiLGMsITEpfTpmdW5jdGlvbihhLGIsYyl7YS5kZXRhY2hFdmVudCYmYS5kZXRhY2hFdmVudCgib24iK2IsYyl9LGYuRXZlbnQ9ZnVuY3Rpb24oYSxiKXtpZighdGhpcy5wcmV2ZW50RGVmYXVsdClyZXR1cm4gbmV3IGYuRXZlbnQoYSxiKTthJiZhLnR5cGU/KHRoaXMub3JpZ2luYWxFdmVudD1hLHRoaXMudHlwZT1hLnR5cGUsdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9YS5kZWZhdWx0UHJldmVudGVkfHxhLnJldHVyblZhbHVlPT09ITF8fGEuZ2V0UHJldmVudERlZmF1bHQmJmEuZ2V0UHJldmVudERlZmF1bHQoKT9FOkQpOnRoaXMudHlwZT1hLGImJmYuZXh0ZW5kKHRoaXMsYiksdGhpcy50aW1lU3RhbXA9Zi5ub3coKSx0aGlzW2YuZXhwYW5kb109ITB9LGYuRXZlbnQucHJvdG90eXBlPXtwcmV2ZW50RGVmYXVsdDpmdW5jdGlvbigpe3RoaXMuaXNEZWZhdWx0UHJldmVudGVkPUU7dmFyIGE9dGhpcy5vcmlnaW5hbEV2ZW50OyFhfHwoYS5wcmV2ZW50RGVmYXVsdD9hLnByZXZlbnREZWZhdWx0KCk6YS5yZXR1cm5WYWx1ZT0hMSl9LHN0b3BQcm9wYWdhdGlvbjpmdW5jdGlvbigpe3RoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQ9RTt2YXIgYT10aGlzLm9yaWdpbmFsRXZlbnQ7IWF8fChhLnN0b3BQcm9wYWdhdGlvbiYmYS5zdG9wUHJvcGFnYXRpb24oKSxhLmNhbmNlbEJ1YmJsZT0hMCl9LHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjpmdW5jdGlvbigpe3RoaXMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ9RSx0aGlzLnN0b3BQcm9wYWdhdGlvbigpfSxpc0RlZmF1bHRQcmV2ZW50ZWQ6RCxpc1Byb3BhZ2F0aW9uU3RvcHBlZDpELGlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOkR9O3ZhciBGPWZ1bmN0aW9uKGEpe3ZhciBiPWEucmVsYXRlZFRhcmdldCxjPSExLGQ9YS50eXBlO2EudHlwZT1hLmRhdGEsYiE9PXRoaXMmJihiJiYoYz1mLmNvbnRhaW5zKHRoaXMsYikpLGN8fChmLmV2ZW50LmhhbmRsZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksYS50eXBlPWQpKX0sRz1mdW5jdGlvbihhKXthLnR5cGU9YS5kYXRhLGYuZXZlbnQuaGFuZGxlLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07Zi5lYWNoKHttb3VzZWVudGVyOiJtb3VzZW92ZXIiLG1vdXNlbGVhdmU6Im1vdXNlb3V0In0sZnVuY3Rpb24oYSxiKXtmLmV2ZW50LnNwZWNpYWxbYV09e3NldHVwOmZ1bmN0aW9uKGMpe2YuZXZlbnQuYWRkKHRoaXMsYixjJiZjLnNlbGVjdG9yP0c6RixhKX0sdGVhcmRvd246ZnVuY3Rpb24oYSl7Zi5ldmVudC5yZW1vdmUodGhpcyxiLGEmJmEuc2VsZWN0b3I/RzpGKX19fSksZi5zdXBwb3J0LnN1Ym1pdEJ1YmJsZXN8fChmLmV2ZW50LnNwZWNpYWwuc3VibWl0PXtzZXR1cDpmdW5jdGlvbihhLGIpe2lmKCFmLm5vZGVOYW1lKHRoaXMsImZvcm0iKSlmLmV2ZW50LmFkZCh0aGlzLCJjbGljay5zcGVjaWFsU3VibWl0IixmdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldCxjPWIudHlwZTsoYz09PSJzdWJtaXQifHxjPT09ImltYWdlIikmJmYoYikuY2xvc2VzdCgiZm9ybSIpLmxlbmd0aCYmSygic3VibWl0Iix0aGlzLGFyZ3VtZW50cyl9KSxmLmV2ZW50LmFkZCh0aGlzLCJrZXlwcmVzcy5zcGVjaWFsU3VibWl0IixmdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldCxjPWIudHlwZTsoYz09PSJ0ZXh0Inx8Yz09PSJwYXNzd29yZCIpJiZmKGIpLmNsb3Nlc3QoImZvcm0iKS5sZW5ndGgmJmEua2V5Q29kZT09PTEzJiZLKCJzdWJtaXQiLHRoaXMsYXJndW1lbnRzKX0pO2Vsc2UgcmV0dXJuITF9LHRlYXJkb3duOmZ1bmN0aW9uKGEpe2YuZXZlbnQucmVtb3ZlKHRoaXMsIi5zcGVjaWFsU3VibWl0Iil9fSk7aWYoIWYuc3VwcG9ydC5jaGFuZ2VCdWJibGVzKXt2YXIgSCxJPWZ1bmN0aW9uKGEpe3ZhciBiPWEudHlwZSxjPWEudmFsdWU7Yj09PSJyYWRpbyJ8fGI9PT0iY2hlY2tib3giP2M9YS5jaGVja2VkOmI9PT0ic2VsZWN0LW11bHRpcGxlIj9jPWEuc2VsZWN0ZWRJbmRleD4tMT9mLm1hcChhLm9wdGlvbnMsZnVuY3Rpb24oYSl7cmV0dXJuIGEuc2VsZWN0ZWR9KS5qb2luKCItIik6IiI6Zi5ub2RlTmFtZShhLCJzZWxlY3QiKSYmKGM9YS5zZWxlY3RlZEluZGV4KTtyZXR1cm4gY30sSj1mdW5jdGlvbihjKXt2YXIgZD1jLnRhcmdldCxlLGc7aWYoISF5LnRlc3QoZC5ub2RlTmFtZSkmJiFkLnJlYWRPbmx5KXtlPWYuX2RhdGEoZCwiX2NoYW5nZV9kYXRhIiksZz1JKGQpLChjLnR5cGUhPT0iZm9jdXNvdXQifHxkLnR5cGUhPT0icmFkaW8iKSYmZi5fZGF0YShkLCJfY2hhbmdlX2RhdGEiLGcpO2lmKGU9PT1ifHxnPT09ZSlyZXR1cm47aWYoZSE9bnVsbHx8ZyljLnR5cGU9ImNoYW5nZSIsYy5saXZlRmlyZWQ9YixmLmV2ZW50LnRyaWdnZXIoYyxhcmd1bWVudHNbMV0sZCl9fTtmLmV2ZW50LnNwZWNpYWwuY2hhbmdlPXtmaWx0ZXJzOntmb2N1c291dDpKLGJlZm9yZWRlYWN0aXZhdGU6SixjbGljazpmdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldCxjPWYubm9kZU5hbWUoYiwiaW5wdXQiKT9iLnR5cGU6IiI7KGM9PT0icmFkaW8ifHxjPT09ImNoZWNrYm94Inx8Zi5ub2RlTmFtZShiLCJzZWxlY3QiKSkmJkouY2FsbCh0aGlzLGEpfSxrZXlkb3duOmZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0LGM9Zi5ub2RlTmFtZShiLCJpbnB1dCIpP2IudHlwZToiIjsoYS5rZXlDb2RlPT09MTMmJiFmLm5vZGVOYW1lKGIsInRleHRhcmVhIil8fGEua2V5Q29kZT09PTMyJiYoYz09PSJjaGVja2JveCJ8fGM9PT0icmFkaW8iKXx8Yz09PSJzZWxlY3QtbXVsdGlwbGUiKSYmSi5jYWxsKHRoaXMsYSl9LGJlZm9yZWFjdGl2YXRlOmZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0O2YuX2RhdGEoYiwiX2NoYW5nZV9kYXRhIixJKGIpKX19LHNldHVwOmZ1bmN0aW9uKGEsYil7aWYodGhpcy50eXBlPT09ImZpbGUiKXJldHVybiExO2Zvcih2YXIgYyBpbiBIKWYuZXZlbnQuYWRkKHRoaXMsYysiLnNwZWNpYWxDaGFuZ2UiLEhbY10pO3JldHVybiB5LnRlc3QodGhpcy5ub2RlTmFtZSl9LHRlYXJkb3duOmZ1bmN0aW9uKGEpe2YuZXZlbnQucmVtb3ZlKHRoaXMsIi5zcGVjaWFsQ2hhbmdlIik7cmV0dXJuIHkudGVzdCh0aGlzLm5vZGVOYW1lKX19LEg9Zi5ldmVudC5zcGVjaWFsLmNoYW5nZS5maWx0ZXJzLEguZm9jdXM9SC5iZWZvcmVhY3RpdmF0ZX1mLnN1cHBvcnQuZm9jdXNpbkJ1YmJsZXN8fGYuZWFjaCh7Zm9jdXM6ImZvY3VzaW4iLGJsdXI6ImZvY3Vzb3V0In0sZnVuY3Rpb24oYSxiKXtmdW5jdGlvbiBlKGEpe3ZhciBjPWYuZXZlbnQuZml4KGEpO2MudHlwZT1iLGMub3JpZ2luYWxFdmVudD17fSxmLmV2ZW50LnRyaWdnZXIoYyxudWxsLGMudGFyZ2V0KSxjLmlzRGVmYXVsdFByZXZlbnRlZCgpJiZhLnByZXZlbnREZWZhdWx0KCl9dmFyIGQ9MDtmLmV2ZW50LnNwZWNpYWxbYl09e3NldHVwOmZ1bmN0aW9uKCl7ZCsrPT09MCYmYy5hZGRFdmVudExpc3RlbmVyKGEsZSwhMCl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7LS1kPT09MCYmYy5yZW1vdmVFdmVudExpc3RlbmVyKGEsZSwhMCl9fX0pLGYuZWFjaChbImJpbmQiLCJvbmUiXSxmdW5jdGlvbihhLGMpe2YuZm5bY109ZnVuY3Rpb24oYSxkLGUpe3ZhciBnO2lmKHR5cGVvZiBhPT0ib2JqZWN0Iil7Zm9yKHZhciBoIGluIGEpdGhpc1tjXShoLGQsYVtoXSxlKTtyZXR1cm4gdGhpc31pZihhcmd1bWVudHMubGVuZ3RoPT09Mnx8ZD09PSExKWU9ZCxkPWI7Yz09PSJvbmUiPyhnPWZ1bmN0aW9uKGEpe2YodGhpcykudW5iaW5kKGEsZyk7cmV0dXJuIGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxnLmd1aWQ9ZS5ndWlkfHxmLmd1aWQrKyk6Zz1lO2lmKGE9PT0idW5sb2FkIiYmYyE9PSJvbmUiKXRoaXMub25lKGEsZCxlKTtlbHNlIGZvcih2YXIgaT0wLGo9dGhpcy5sZW5ndGg7aTxqO2krKylmLmV2ZW50LmFkZCh0aGlzW2ldLGEsZyxkKTtyZXR1cm4gdGhpc319KSxmLmZuLmV4dGVuZCh7dW5iaW5kOmZ1bmN0aW9uKGEsYil7aWYodHlwZW9mIGE9PSJvYmplY3QiJiYhYS5wcmV2ZW50RGVmYXVsdClmb3IodmFyIGMgaW4gYSl0aGlzLnVuYmluZChjLGFbY10pO2Vsc2UgZm9yKHZhciBkPTAsZT10aGlzLmxlbmd0aDtkPGU7ZCsrKWYuZXZlbnQucmVtb3ZlKHRoaXNbZF0sYSxiKTtyZXR1cm4gdGhpc30sZGVsZWdhdGU6ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIHRoaXMubGl2ZShiLGMsZCxhKX0sdW5kZWxlZ2F0ZTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg9PT0wP3RoaXMudW5iaW5kKCJsaXZlIik6dGhpcy5kaWUoYixudWxsLGMsYSl9LHRyaWdnZXI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zi5ldmVudC50cmlnZ2VyKGEsYix0aGlzKX0pfSx0cmlnZ2VySGFuZGxlcjpmdW5jdGlvbihhLGIpe2lmKHRoaXNbMF0pcmV0dXJuIGYuZXZlbnQudHJpZ2dlcihhLGIsdGhpc1swXSwhMCl9LHRvZ2dsZTpmdW5jdGlvbihhKXt2YXIgYj1hcmd1bWVudHMsYz1hLmd1aWR8fGYuZ3VpZCsrLGQ9MCxlPWZ1bmN0aW9uKGMpe3ZhciBlPShmLmRhdGEodGhpcywibGFzdFRvZ2dsZSIrYS5ndWlkKXx8MCklZDtmLmRhdGEodGhpcywibGFzdFRvZ2dsZSIrYS5ndWlkLGUrMSksYy5wcmV2ZW50RGVmYXVsdCgpO3JldHVybiBiW2VdLmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8ITF9O2UuZ3VpZD1jO3doaWxlKGQ8Yi5sZW5ndGgpYltkKytdLmd1aWQ9YztyZXR1cm4gdGhpcy5jbGljayhlKX0saG92ZXI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5tb3VzZWVudGVyKGEpLm1vdXNlbGVhdmUoYnx8YSl9fSk7dmFyIEw9e2ZvY3VzOiJmb2N1c2luIixibHVyOiJmb2N1c291dCIsbW91c2VlbnRlcjoibW91c2VvdmVyIixtb3VzZWxlYXZlOiJtb3VzZW91dCJ9O2YuZWFjaChbImxpdmUiLCJkaWUiXSxmdW5jdGlvbihhLGMpe2YuZm5bY109ZnVuY3Rpb24oYSxkLGUsZyl7dmFyIGgsaT0wLGosayxsLG09Z3x8dGhpcy5zZWxlY3RvcixuPWc/dGhpczpmKHRoaXMuY29udGV4dCk7aWYodHlwZW9mIGE9PSJvYmplY3QiJiYhYS5wcmV2ZW50RGVmYXVsdCl7Zm9yKHZhciBvIGluIGEpbltjXShvLGQsYVtvXSxtKTtyZXR1cm4gdGhpc31pZihjPT09ImRpZSImJiFhJiZnJiZnLmNoYXJBdCgwKT09PSIuIil7bi51bmJpbmQoZyk7cmV0dXJuIHRoaXN9aWYoZD09PSExfHxmLmlzRnVuY3Rpb24oZCkpZT1kfHxELGQ9YjthPShhfHwiIikuc3BsaXQoIiAiKTt3aGlsZSgoaD1hW2krK10pIT1udWxsKXtqPXguZXhlYyhoKSxrPSIiLGomJihrPWpbMF0saD1oLnJlcGxhY2UoeCwiIikpO2lmKGg9PT0iaG92ZXIiKXthLnB1c2goIm1vdXNlZW50ZXIiK2ssIm1vdXNlbGVhdmUiK2spO2NvbnRpbnVlfWw9aCxMW2hdPyhhLnB1c2goTFtoXStrKSxoPWgrayk6aD0oTFtoXXx8aCkraztpZihjPT09ImxpdmUiKWZvcih2YXIgcD0wLHE9bi5sZW5ndGg7cDxxO3ArKylmLmV2ZW50LmFkZChuW3BdLCJsaXZlLiIrTihoLG0pLHtkYXRhOmQsc2VsZWN0b3I6bSxoYW5kbGVyOmUsb3JpZ1R5cGU6aCxvcmlnSGFuZGxlcjplLHByZVR5cGU6bH0pO2Vsc2Ugbi51bmJpbmQoImxpdmUuIitOKGgsbSksZSl9cmV0dXJuIHRoaXN9fSksZi5lYWNoKCJibHVyIGZvY3VzIGZvY3VzaW4gZm9jdXNvdXQgbG9hZCByZXNpemUgc2Nyb2xsIHVubG9hZCBjbGljayBkYmxjbGljayBtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0IG1vdXNlZW50ZXIgbW91c2VsZWF2ZSBjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGVycm9yIi5zcGxpdCgiICIpLGZ1bmN0aW9uKGEsYil7Zi5mbltiXT1mdW5jdGlvbihhLGMpe2M9PW51bGwmJihjPWEsYT1udWxsKTtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD4wP3RoaXMuYmluZChiLGEsYyk6dGhpcy50cmlnZ2VyKGIpfSxmLmF0dHJGbiYmKGYuYXR0ckZuW2JdPSEwKX0pLGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdShhLGIsYyxkLGUsZil7Zm9yKHZhciBnPTAsaD1kLmxlbmd0aDtnPGg7ZysrKXt2YXIgaT1kW2ddO2lmKGkpe3ZhciBqPSExO2k9aVthXTt3aGlsZShpKXtpZihpLnNpemNhY2hlPT09Yyl7aj1kW2kuc2l6c2V0XTticmVha31pZihpLm5vZGVUeXBlPT09MSl7Znx8KGkuc2l6Y2FjaGU9YyxpLnNpenNldD1nKTtpZih0eXBlb2YgYiE9InN0cmluZyIpe2lmKGk9PT1iKXtqPSEwO2JyZWFrfX1lbHNlIGlmKGsuZmlsdGVyKGIsW2ldKS5sZW5ndGg+MCl7aj1pO2JyZWFrfX1pPWlbYV19ZFtnXT1qfX19ZnVuY3Rpb24gdChhLGIsYyxkLGUsZil7Zm9yKHZhciBnPTAsaD1kLmxlbmd0aDtnPGg7ZysrKXt2YXIgaT1kW2ddO2lmKGkpe3ZhciBqPSExO2k9aVthXTt3aGlsZShpKXtpZihpLnNpemNhY2hlPT09Yyl7aj1kW2kuc2l6c2V0XTticmVha31pLm5vZGVUeXBlPT09MSYmIWYmJihpLnNpemNhY2hlPWMsaS5zaXpzZXQ9Zyk7aWYoaS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09Yil7aj1pO2JyZWFrfWk9aVthXX1kW2ddPWp9fX12YXIgYT0vKCg/OlwoKD86XChbXigpXStcKXxbXigpXSspK1wpfFxbKD86XFtbXlxbXF1dKlxdfFsnIl1bXiciXSpbJyJdfFteXFtcXSciXSspK1xdfFxcLnxbXiA+K34sKFxbXFxdKykrfFs+K35dKShccyosXHMqKT8oKD86LnxccnxcbikqKS9nLGQ9MCxlPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsZz0hMSxoPSEwLGk9L1xcL2csaj0vXFcvO1swLDBdLnNvcnQoZnVuY3Rpb24oKXtoPSExO3JldHVybiAwfSk7dmFyIGs9ZnVuY3Rpb24oYixkLGYsZyl7Zj1mfHxbXSxkPWR8fGM7dmFyIGg9ZDtpZihkLm5vZGVUeXBlIT09MSYmZC5ub2RlVHlwZSE9PTkpcmV0dXJuW107aWYoIWJ8fHR5cGVvZiBiIT0ic3RyaW5nIilyZXR1cm4gZjt2YXIgaSxqLG4sbyxxLHIscyx0LHU9ITAsdz1rLmlzWE1MKGQpLHg9W10seT1iO2Rve2EuZXhlYygiIiksaT1hLmV4ZWMoeSk7aWYoaSl7eT1pWzNdLHgucHVzaChpWzFdKTtpZihpWzJdKXtvPWlbM107YnJlYWt9fX13aGlsZShpKTtpZih4Lmxlbmd0aD4xJiZtLmV4ZWMoYikpaWYoeC5sZW5ndGg9PT0yJiZsLnJlbGF0aXZlW3hbMF1dKWo9dih4WzBdK3hbMV0sZCk7ZWxzZXtqPWwucmVsYXRpdmVbeFswXV0/W2RdOmsoeC5zaGlmdCgpLGQpO3doaWxlKHgubGVuZ3RoKWI9eC5zaGlmdCgpLGwucmVsYXRpdmVbYl0mJihiKz14LnNoaWZ0KCkpLGo9dihiLGopfWVsc2V7IWcmJngubGVuZ3RoPjEmJmQubm9kZVR5cGU9PT05JiYhdyYmbC5tYXRjaC5JRC50ZXN0KHhbMF0pJiYhbC5tYXRjaC5JRC50ZXN0KHhbeC5sZW5ndGgtMV0pJiYocT1rLmZpbmQoeC5zaGlmdCgpLGQsdyksZD1xLmV4cHI/ay5maWx0ZXIocS5leHByLHEuc2V0KVswXTpxLnNldFswXSk7aWYoZCl7cT1nP3tleHByOngucG9wKCksc2V0OnAoZyl9OmsuZmluZCh4LnBvcCgpLHgubGVuZ3RoPT09MSYmKHhbMF09PT0ifiJ8fHhbMF09PT0iKyIpJiZkLnBhcmVudE5vZGU/ZC5wYXJlbnROb2RlOmQsdyksaj1xLmV4cHI/ay5maWx0ZXIocS5leHByLHEuc2V0KTpxLnNldCx4Lmxlbmd0aD4wP249cChqKTp1PSExO3doaWxlKHgubGVuZ3RoKXI9eC5wb3AoKSxzPXIsbC5yZWxhdGl2ZVtyXT9zPXgucG9wKCk6cj0iIixzPT1udWxsJiYocz1kKSxsLnJlbGF0aXZlW3JdKG4scyx3KX1lbHNlIG49eD1bXX1ufHwobj1qKSxufHxrLmVycm9yKHJ8fGIpO2lmKGUuY2FsbChuKT09PSJbb2JqZWN0IEFycmF5XSIpaWYoIXUpZi5wdXNoLmFwcGx5KGYsbik7ZWxzZSBpZihkJiZkLm5vZGVUeXBlPT09MSlmb3IodD0wO25bdF0hPW51bGw7dCsrKW5bdF0mJihuW3RdPT09ITB8fG5bdF0ubm9kZVR5cGU9PT0xJiZrLmNvbnRhaW5zKGQsblt0XSkpJiZmLnB1c2goalt0XSk7ZWxzZSBmb3IodD0wO25bdF0hPW51bGw7dCsrKW5bdF0mJm5bdF0ubm9kZVR5cGU9PT0xJiZmLnB1c2goalt0XSk7ZWxzZSBwKG4sZik7byYmKGsobyxoLGYsZyksay51bmlxdWVTb3J0KGYpKTtyZXR1cm4gZn07ay51bmlxdWVTb3J0PWZ1bmN0aW9uKGEpe2lmKHIpe2c9aCxhLnNvcnQocik7aWYoZylmb3IodmFyIGI9MTtiPGEubGVuZ3RoO2IrKylhW2JdPT09YVtiLTFdJiZhLnNwbGljZShiLS0sMSl9cmV0dXJuIGF9LGsubWF0Y2hlcz1mdW5jdGlvbihhLGIpe3JldHVybiBrKGEsbnVsbCxudWxsLGIpfSxrLm1hdGNoZXNTZWxlY3Rvcj1mdW5jdGlvbihhLGIpe3JldHVybiBrKGIsbnVsbCxudWxsLFthXSkubGVuZ3RoPjB9LGsuZmluZD1mdW5jdGlvbihhLGIsYyl7dmFyIGQ7aWYoIWEpcmV0dXJuW107Zm9yKHZhciBlPTAsZj1sLm9yZGVyLmxlbmd0aDtlPGY7ZSsrKXt2YXIgZyxoPWwub3JkZXJbZV07aWYoZz1sLmxlZnRNYXRjaFtoXS5leGVjKGEpKXt2YXIgaj1nWzFdO2cuc3BsaWNlKDEsMSk7aWYoai5zdWJzdHIoai5sZW5ndGgtMSkhPT0iXFwiKXtnWzFdPShnWzFdfHwiIikucmVwbGFjZShpLCIiKSxkPWwuZmluZFtoXShnLGIsYyk7aWYoZCE9bnVsbCl7YT1hLnJlcGxhY2UobC5tYXRjaFtoXSwiIik7YnJlYWt9fX19ZHx8KGQ9dHlwZW9mIGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUhPSJ1bmRlZmluZWQiP2IuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKTpbXSk7cmV0dXJue3NldDpkLGV4cHI6YX19LGsuZmlsdGVyPWZ1bmN0aW9uKGEsYyxkLGUpe3ZhciBmLGcsaD1hLGk9W10saj1jLG09YyYmY1swXSYmay5pc1hNTChjWzBdKTt3aGlsZShhJiZjLmxlbmd0aCl7Zm9yKHZhciBuIGluIGwuZmlsdGVyKWlmKChmPWwubGVmdE1hdGNoW25dLmV4ZWMoYSkpIT1udWxsJiZmWzJdKXt2YXIgbyxwLHE9bC5maWx0ZXJbbl0scj1mWzFdO2c9ITEsZi5zcGxpY2UoMSwxKTtpZihyLnN1YnN0cihyLmxlbmd0aC0xKT09PSJcXCIpY29udGludWU7aj09PWkmJihpPVtdKTtpZihsLnByZUZpbHRlcltuXSl7Zj1sLnByZUZpbHRlcltuXShmLGosZCxpLGUsbSk7aWYoIWYpZz1vPSEwO2Vsc2UgaWYoZj09PSEwKWNvbnRpbnVlfWlmKGYpZm9yKHZhciBzPTA7KHA9altzXSkhPW51bGw7cysrKWlmKHApe289cShwLGYscyxqKTt2YXIgdD1lXiEhbztkJiZvIT1udWxsP3Q/Zz0hMDpqW3NdPSExOnQmJihpLnB1c2gocCksZz0hMCl9aWYobyE9PWIpe2R8fChqPWkpLGE9YS5yZXBsYWNlKGwubWF0Y2hbbl0sIiIpO2lmKCFnKXJldHVybltdO2JyZWFrfX1pZihhPT09aClpZihnPT1udWxsKWsuZXJyb3IoYSk7ZWxzZSBicmVhaztoPWF9cmV0dXJuIGp9LGsuZXJyb3I9ZnVuY3Rpb24oYSl7dGhyb3ciU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogIithfTt2YXIgbD1rLnNlbGVjdG9ycz17b3JkZXI6WyJJRCIsIk5BTUUiLCJUQUciXSxtYXRjaDp7SUQ6LyMoKD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKykvLENMQVNTOi9cLigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKS8sTkFNRTovXFtuYW1lPVsnIl0qKCg/Oltcd1x1MDBjMC1cdUZGRkZcLV18XFwuKSspWyciXSpcXS8sQVRUUjovXFtccyooKD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKylccyooPzooXFM/PSlccyooPzooWyciXSkoLio/KVwzfCgjPyg/Oltcd1x1MDBjMC1cdUZGRkZcLV18XFwuKSopfCl8KVxzKlxdLyxUQUc6L14oKD86W1x3XHUwMGMwLVx1RkZGRlwqXC1dfFxcLikrKS8sQ0hJTEQ6Lzoob25seXxudGh8bGFzdHxmaXJzdCktY2hpbGQoPzpcKFxzKihldmVufG9kZHwoPzpbK1wtXT9cZCt8KD86WytcLV0/XGQqKT9uXHMqKD86WytcLV1ccypcZCspPykpXHMqXCkpPy8sUE9TOi86KG50aHxlcXxndHxsdHxmaXJzdHxsYXN0fGV2ZW58b2RkKSg/OlwoKFxkKilcKSk/KD89W15cLV18JCkvLFBTRVVETzovOigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKSg/OlwoKFsnIl0/KSgoPzpcKFteXCldK1wpfFteXChcKV0qKSspXDJcKSk/L30sbGVmdE1hdGNoOnt9LGF0dHJNYXA6eyJjbGFzcyI6ImNsYXNzTmFtZSIsImZvciI6Imh0bWxGb3IifSxhdHRySGFuZGxlOntocmVmOmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgiaHJlZiIpfSx0eXBlOmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgidHlwZSIpfX0scmVsYXRpdmU6eyIrIjpmdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBiPT0ic3RyaW5nIixkPWMmJiFqLnRlc3QoYiksZT1jJiYhZDtkJiYoYj1iLnRvTG93ZXJDYXNlKCkpO2Zvcih2YXIgZj0wLGc9YS5sZW5ndGgsaDtmPGc7ZisrKWlmKGg9YVtmXSl7d2hpbGUoKGg9aC5wcmV2aW91c1NpYmxpbmcpJiZoLm5vZGVUeXBlIT09MSk7YVtmXT1lfHxoJiZoLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iP2h8fCExOmg9PT1ifWUmJmsuZmlsdGVyKGIsYSwhMCl9LCI+IjpmdW5jdGlvbihhLGIpe3ZhciBjLGQ9dHlwZW9mIGI9PSJzdHJpbmciLGU9MCxmPWEubGVuZ3RoO2lmKGQmJiFqLnRlc3QoYikpe2I9Yi50b0xvd2VyQ2FzZSgpO2Zvcig7ZTxmO2UrKyl7Yz1hW2VdO2lmKGMpe3ZhciBnPWMucGFyZW50Tm9kZTthW2VdPWcubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWI/ZzohMX19fWVsc2V7Zm9yKDtlPGY7ZSsrKWM9YVtlXSxjJiYoYVtlXT1kP2MucGFyZW50Tm9kZTpjLnBhcmVudE5vZGU9PT1iKTtkJiZrLmZpbHRlcihiLGEsITApfX0sIiI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBlLGY9ZCsrLGc9dTt0eXBlb2YgYj09InN0cmluZyImJiFqLnRlc3QoYikmJihiPWIudG9Mb3dlckNhc2UoKSxlPWIsZz10KSxnKCJwYXJlbnROb2RlIixiLGYsYSxlLGMpfSwifiI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBlLGY9ZCsrLGc9dTt0eXBlb2YgYj09InN0cmluZyImJiFqLnRlc3QoYikmJihiPWIudG9Mb3dlckNhc2UoKSxlPWIsZz10KSxnKCJwcmV2aW91c1NpYmxpbmciLGIsZixhLGUsYyl9fSxmaW5kOntJRDpmdW5jdGlvbihhLGIsYyl7aWYodHlwZW9mIGIuZ2V0RWxlbWVudEJ5SWQhPSJ1bmRlZmluZWQiJiYhYyl7dmFyIGQ9Yi5nZXRFbGVtZW50QnlJZChhWzFdKTtyZXR1cm4gZCYmZC5wYXJlbnROb2RlP1tkXTpbXX19LE5BTUU6ZnVuY3Rpb24oYSxiKXtpZih0eXBlb2YgYi5nZXRFbGVtZW50c0J5TmFtZSE9InVuZGVmaW5lZCIpe3ZhciBjPVtdLGQ9Yi5nZXRFbGVtZW50c0J5TmFtZShhWzFdKTtmb3IodmFyIGU9MCxmPWQubGVuZ3RoO2U8ZjtlKyspZFtlXS5nZXRBdHRyaWJ1dGUoIm5hbWUiKT09PWFbMV0mJmMucHVzaChkW2VdKTtyZXR1cm4gYy5sZW5ndGg9PT0wP251bGw6Y319LFRBRzpmdW5jdGlvbihhLGIpe2lmKHR5cGVvZiBiLmdldEVsZW1lbnRzQnlUYWdOYW1lIT0idW5kZWZpbmVkIilyZXR1cm4gYi5nZXRFbGVtZW50c0J5VGFnTmFtZShhWzFdKX19LHByZUZpbHRlcjp7Q0xBU1M6ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe2E9IiAiK2FbMV0ucmVwbGFjZShpLCIiKSsiICI7aWYoZilyZXR1cm4gYTtmb3IodmFyIGc9MCxoOyhoPWJbZ10pIT1udWxsO2crKyloJiYoZV4oaC5jbGFzc05hbWUmJigiICIraC5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKC9bXHRcblxyXS9nLCIgIikuaW5kZXhPZihhKT49MCk/Y3x8ZC5wdXNoKGgpOmMmJihiW2ddPSExKSk7cmV0dXJuITF9LElEOmZ1bmN0aW9uKGEpe3JldHVybiBhWzFdLnJlcGxhY2UoaSwiIil9LFRBRzpmdW5jdGlvbihhLGIpe3JldHVybiBhWzFdLnJlcGxhY2UoaSwiIikudG9Mb3dlckNhc2UoKX0sQ0hJTEQ6ZnVuY3Rpb24oYSl7aWYoYVsxXT09PSJudGgiKXthWzJdfHxrLmVycm9yKGFbMF0pLGFbMl09YVsyXS5yZXBsYWNlKC9eXCt8XHMqL2csIiIpO3ZhciBiPS8oLT8pKFxkKikoPzpuKFsrXC1dP1xkKikpPy8uZXhlYyhhWzJdPT09ImV2ZW4iJiYiMm4ifHxhWzJdPT09Im9kZCImJiIybisxInx8IS9cRC8udGVzdChhWzJdKSYmIjBuKyIrYVsyXXx8YVsyXSk7YVsyXT1iWzFdKyhiWzJdfHwxKS0wLGFbM109YlszXS0wfWVsc2UgYVsyXSYmay5lcnJvcihhWzBdKTthWzBdPWQrKztyZXR1cm4gYX0sQVRUUjpmdW5jdGlvbihhLGIsYyxkLGUsZil7dmFyIGc9YVsxXT1hWzFdLnJlcGxhY2UoaSwiIik7IWYmJmwuYXR0ck1hcFtnXSYmKGFbMV09bC5hdHRyTWFwW2ddKSxhWzRdPShhWzRdfHxhWzVdfHwiIikucmVwbGFjZShpLCIiKSxhWzJdPT09In49IiYmKGFbNF09IiAiK2FbNF0rIiAiKTtyZXR1cm4gYX0sUFNFVURPOmZ1bmN0aW9uKGIsYyxkLGUsZil7aWYoYlsxXT09PSJub3QiKWlmKChhLmV4ZWMoYlszXSl8fCIiKS5sZW5ndGg+MXx8L15cdy8udGVzdChiWzNdKSliWzNdPWsoYlszXSxudWxsLG51bGwsYyk7ZWxzZXt2YXIgZz1rLmZpbHRlcihiWzNdLGMsZCwhMF5mKTtkfHxlLnB1c2guYXBwbHkoZSxnKTtyZXR1cm4hMX1lbHNlIGlmKGwubWF0Y2guUE9TLnRlc3QoYlswXSl8fGwubWF0Y2guQ0hJTEQudGVzdChiWzBdKSlyZXR1cm4hMDtyZXR1cm4gYn0sUE9TOmZ1bmN0aW9uKGEpe2EudW5zaGlmdCghMCk7cmV0dXJuIGF9fSxmaWx0ZXJzOntlbmFibGVkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmRpc2FibGVkPT09ITEmJmEudHlwZSE9PSJoaWRkZW4ifSxkaXNhYmxlZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5kaXNhYmxlZD09PSEwfSxjaGVja2VkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmNoZWNrZWQ9PT0hMH0sc2VsZWN0ZWQ6ZnVuY3Rpb24oYSl7YS5wYXJlbnROb2RlJiZhLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDtyZXR1cm4gYS5zZWxlY3RlZD09PSEwfSxwYXJlbnQ6ZnVuY3Rpb24oYSl7cmV0dXJuISFhLmZpcnN0Q2hpbGR9LGVtcHR5OmZ1bmN0aW9uKGEpe3JldHVybiFhLmZpcnN0Q2hpbGR9LGhhczpmdW5jdGlvbihhLGIsYyl7cmV0dXJuISFrKGNbM10sYSkubGVuZ3RofSxoZWFkZXI6ZnVuY3Rpb24oYSl7cmV0dXJuL2hcZC9pLnRlc3QoYS5ub2RlTmFtZSl9LHRleHQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5nZXRBdHRyaWJ1dGUoInR5cGUiKSxjPWEudHlwZTtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmInRleHQiPT09YyYmKGI9PT1jfHxiPT09bnVsbCl9LHJhZGlvOmZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT0iaW5wdXQiJiYicmFkaW8iPT09YS50eXBlfSxjaGVja2JveDpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmImNoZWNrYm94Ij09PWEudHlwZX0sZmlsZTpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmImZpbGUiPT09YS50eXBlfSxwYXNzd29yZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmInBhc3N3b3JkIj09PWEudHlwZX0sc3VibWl0OmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4oYj09PSJpbnB1dCJ8fGI9PT0iYnV0dG9uIikmJiJzdWJtaXQiPT09YS50eXBlfSxpbWFnZTpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmImltYWdlIj09PWEudHlwZX0scmVzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybihiPT09ImlucHV0Inx8Yj09PSJidXR0b24iKSYmInJlc2V0Ij09PWEudHlwZX0sYnV0dG9uOmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4gYj09PSJpbnB1dCImJiJidXR0b24iPT09YS50eXBlfHxiPT09ImJ1dHRvbiJ9LGlucHV0OmZ1bmN0aW9uKGEpe3JldHVybi9pbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uL2kudGVzdChhLm5vZGVOYW1lKX0sZm9jdXM6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1hLm93bmVyRG9jdW1lbnQuYWN0aXZlRWxlbWVudH19LHNldEZpbHRlcnM6e2ZpcnN0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGI9PT0wfSxsYXN0OmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiBiPT09ZC5sZW5ndGgtMX0sZXZlbjpmdW5jdGlvbihhLGIpe3JldHVybiBiJTI9PT0wfSxvZGQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYiUyPT09MX0sbHQ6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBiPGNbM10tMH0sZ3Q6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBiPmNbM10tMH0sbnRoOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gY1szXS0wPT09Yn0sZXE6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBjWzNdLTA9PT1ifX0sZmlsdGVyOntQU0VVRE86ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9YlsxXSxmPWwuZmlsdGVyc1tlXTtpZihmKXJldHVybiBmKGEsYyxiLGQpO2lmKGU9PT0iY29udGFpbnMiKXJldHVybihhLnRleHRDb250ZW50fHxhLmlubmVyVGV4dHx8ay5nZXRUZXh0KFthXSl8fCIiKS5pbmRleE9mKGJbM10pPj0wO2lmKGU9PT0ibm90Iil7dmFyIGc9YlszXTtmb3IodmFyIGg9MCxpPWcubGVuZ3RoO2g8aTtoKyspaWYoZ1toXT09PWEpcmV0dXJuITE7cmV0dXJuITB9ay5lcnJvcihlKX0sQ0hJTEQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz1iWzFdLGQ9YTtzd2l0Y2goYyl7Y2FzZSJvbmx5IjpjYXNlImZpcnN0Ijp3aGlsZShkPWQucHJldmlvdXNTaWJsaW5nKWlmKGQubm9kZVR5cGU9PT0xKXJldHVybiExO2lmKGM9PT0iZmlyc3QiKXJldHVybiEwO2Q9YTtjYXNlImxhc3QiOndoaWxlKGQ9ZC5uZXh0U2libGluZylpZihkLm5vZGVUeXBlPT09MSlyZXR1cm4hMTtyZXR1cm4hMDtjYXNlIm50aCI6dmFyIGU9YlsyXSxmPWJbM107aWYoZT09PTEmJmY9PT0wKXJldHVybiEwO3ZhciBnPWJbMF0saD1hLnBhcmVudE5vZGU7aWYoaCYmKGguc2l6Y2FjaGUhPT1nfHwhYS5ub2RlSW5kZXgpKXt2YXIgaT0wO2ZvcihkPWguZmlyc3RDaGlsZDtkO2Q9ZC5uZXh0U2libGluZylkLm5vZGVUeXBlPT09MSYmKGQubm9kZUluZGV4PSsraSk7aC5zaXpjYWNoZT1nfXZhciBqPWEubm9kZUluZGV4LWY7cmV0dXJuIGU9PT0wP2o9PT0wOmolZT09PTAmJmovZT49MH19LElEOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEubm9kZVR5cGU9PT0xJiZhLmdldEF0dHJpYnV0ZSgiaWQiKT09PWJ9LFRBRzpmdW5jdGlvbihhLGIpe3JldHVybiBiPT09IioiJiZhLm5vZGVUeXBlPT09MXx8YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09Yn0sQ0xBU1M6ZnVuY3Rpb24oYSxiKXtyZXR1cm4oIiAiKyhhLmNsYXNzTmFtZXx8YS5nZXRBdHRyaWJ1dGUoImNsYXNzIikpKyIgIikuaW5kZXhPZihiKT4tMX0sQVRUUjpmdW5jdGlvbihhLGIpe3ZhciBjPWJbMV0sZD1sLmF0dHJIYW5kbGVbY10/bC5hdHRySGFuZGxlW2NdKGEpOmFbY10hPW51bGw/YVtjXTphLmdldEF0dHJpYnV0ZShjKSxlPWQrIiIsZj1iWzJdLGc9Yls0XTtyZXR1cm4gZD09bnVsbD9mPT09IiE9IjpmPT09Ij0iP2U9PT1nOmY9PT0iKj0iP2UuaW5kZXhPZihnKT49MDpmPT09In49Ij8oIiAiK2UrIiAiKS5pbmRleE9mKGcpPj0wOmc/Zj09PSIhPSI/ZSE9PWc6Zj09PSJePSI/ZS5pbmRleE9mKGcpPT09MDpmPT09IiQ9Ij9lLnN1YnN0cihlLmxlbmd0aC1nLmxlbmd0aCk9PT1nOmY9PT0ifD0iP2U9PT1nfHxlLnN1YnN0cigwLGcubGVuZ3RoKzEpPT09ZysiLSI6ITE6ZSYmZCE9PSExfSxQT1M6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9YlsyXSxmPWwuc2V0RmlsdGVyc1tlXTtpZihmKXJldHVybiBmKGEsYyxiLGQpfX19LG09bC5tYXRjaC5QT1Msbj1mdW5jdGlvbihhLGIpe3JldHVybiJcXCIrKGItMCsxKX07Zm9yKHZhciBvIGluIGwubWF0Y2gpbC5tYXRjaFtvXT1uZXcgUmVnRXhwKGwubWF0Y2hbb10uc291cmNlKy8oPyFbXlxbXSpcXSkoPyFbXlwoXSpcKSkvLnNvdXJjZSksbC5sZWZ0TWF0Y2hbb109bmV3IFJlZ0V4cCgvKF4oPzoufFxyfFxuKSo/KS8uc291cmNlK2wubWF0Y2hbb10uc291cmNlLnJlcGxhY2UoL1xcKFxkKykvZyxuKSk7dmFyIHA9ZnVuY3Rpb24oYSxiKXthPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGEsMCk7aWYoYil7Yi5wdXNoLmFwcGx5KGIsYSk7cmV0dXJuIGJ9cmV0dXJuIGF9O3RyeXtBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChjLmRvY3VtZW50RWxlbWVudC5jaGlsZE5vZGVzLDApWzBdLm5vZGVUeXBlfWNhdGNoKHEpe3A9ZnVuY3Rpb24oYSxiKXt2YXIgYz0wLGQ9Ynx8W107aWYoZS5jYWxsKGEpPT09IltvYmplY3QgQXJyYXldIilBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShkLGEpO2Vsc2UgaWYodHlwZW9mIGEubGVuZ3RoPT0ibnVtYmVyIilmb3IodmFyIGY9YS5sZW5ndGg7YzxmO2MrKylkLnB1c2goYVtjXSk7ZWxzZSBmb3IoO2FbY107YysrKWQucHVzaChhW2NdKTtyZXR1cm4gZH19dmFyIHIscztjLmRvY3VtZW50RWxlbWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj9yPWZ1bmN0aW9uKGEsYil7aWYoYT09PWIpe2c9ITA7cmV0dXJuIDB9aWYoIWEuY29tcGFyZURvY3VtZW50UG9zaXRpb258fCFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKXJldHVybiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uPy0xOjE7cmV0dXJuIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmND8tMToxfToocj1mdW5jdGlvbihhLGIpe2lmKGE9PT1iKXtnPSEwO3JldHVybiAwfWlmKGEuc291cmNlSW5kZXgmJmIuc291cmNlSW5kZXgpcmV0dXJuIGEuc291cmNlSW5kZXgtYi5zb3VyY2VJbmRleDt2YXIgYyxkLGU9W10sZj1bXSxoPWEucGFyZW50Tm9kZSxpPWIucGFyZW50Tm9kZSxqPWg7aWYoaD09PWkpcmV0dXJuIHMoYSxiKTtpZighaClyZXR1cm4tMTtpZighaSlyZXR1cm4gMTt3aGlsZShqKWUudW5zaGlmdChqKSxqPWoucGFyZW50Tm9kZTtqPWk7d2hpbGUoailmLnVuc2hpZnQoaiksaj1qLnBhcmVudE5vZGU7Yz1lLmxlbmd0aCxkPWYubGVuZ3RoO2Zvcih2YXIgaz0wO2s8YyYmazxkO2srKylpZihlW2tdIT09ZltrXSlyZXR1cm4gcyhlW2tdLGZba10pO3JldHVybiBrPT09Yz9zKGEsZltrXSwtMSk6cyhlW2tdLGIsMSl9LHM9ZnVuY3Rpb24oYSxiLGMpe2lmKGE9PT1iKXJldHVybiBjO3ZhciBkPWEubmV4dFNpYmxpbmc7d2hpbGUoZCl7aWYoZD09PWIpcmV0dXJuLTE7ZD1kLm5leHRTaWJsaW5nfXJldHVybiAxfSksay5nZXRUZXh0PWZ1bmN0aW9uKGEpe3ZhciBiPSIiLGM7Zm9yKHZhciBkPTA7YVtkXTtkKyspYz1hW2RdLGMubm9kZVR5cGU9PT0zfHxjLm5vZGVUeXBlPT09ND9iKz1jLm5vZGVWYWx1ZTpjLm5vZGVUeXBlIT09OCYmKGIrPWsuZ2V0VGV4dChjLmNoaWxkTm9kZXMpKTtyZXR1cm4gYn0sZnVuY3Rpb24oKXt2YXIgYT1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpLGQ9InNjcmlwdCIrKG5ldyBEYXRlKS5nZXRUaW1lKCksZT1jLmRvY3VtZW50RWxlbWVudDthLmlubmVySFRNTD0iPGEgbmFtZT0nIitkKyInLz4iLGUuaW5zZXJ0QmVmb3JlKGEsZS5maXJzdENoaWxkKSxjLmdldEVsZW1lbnRCeUlkKGQpJiYobC5maW5kLklEPWZ1bmN0aW9uKGEsYyxkKXtpZih0eXBlb2YgYy5nZXRFbGVtZW50QnlJZCE9InVuZGVmaW5lZCImJiFkKXt2YXIgZT1jLmdldEVsZW1lbnRCeUlkKGFbMV0pO3JldHVybiBlP2UuaWQ9PT1hWzFdfHx0eXBlb2YgZS5nZXRBdHRyaWJ1dGVOb2RlIT0idW5kZWZpbmVkIiYmZS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpLm5vZGVWYWx1ZT09PWFbMV0/W2VdOmI6W119fSxsLmZpbHRlci5JRD1mdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBhLmdldEF0dHJpYnV0ZU5vZGUhPSJ1bmRlZmluZWQiJiZhLmdldEF0dHJpYnV0ZU5vZGUoImlkIik7cmV0dXJuIGEubm9kZVR5cGU9PT0xJiZjJiZjLm5vZGVWYWx1ZT09PWJ9KSxlLnJlbW92ZUNoaWxkKGEpLGU9YT1udWxsfSgpLGZ1bmN0aW9uKCl7dmFyIGE9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKTthLmFwcGVuZENoaWxkKGMuY3JlYXRlQ29tbWVudCgiIikpLGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKS5sZW5ndGg+MCYmKGwuZmluZC5UQUc9ZnVuY3Rpb24oYSxiKXt2YXIgYz1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKGFbMV0pO2lmKGFbMV09PT0iKiIpe3ZhciBkPVtdO2Zvcih2YXIgZT0wO2NbZV07ZSsrKWNbZV0ubm9kZVR5cGU9PT0xJiZkLnB1c2goY1tlXSk7Yz1kfXJldHVybiBjfSksYS5pbm5lckhUTUw9IjxhIGhyZWY9JyMnPjwvYT4iLGEuZmlyc3RDaGlsZCYmdHlwZW9mIGEuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUhPSJ1bmRlZmluZWQiJiZhLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJocmVmIikhPT0iIyImJihsLmF0dHJIYW5kbGUuaHJlZj1mdW5jdGlvbihhKXtyZXR1cm4gYS5nZXRBdHRyaWJ1dGUoImhyZWYiLDIpfSksYT1udWxsfSgpLGMucXVlcnlTZWxlY3RvckFsbCYmZnVuY3Rpb24oKXt2YXIgYT1rLGI9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKSxkPSJfX3NpenpsZV9fIjtiLmlubmVySFRNTD0iPHAgY2xhc3M9J1RFU1QnPjwvcD4iO2lmKCFiLnF1ZXJ5U2VsZWN0b3JBbGx8fGIucXVlcnlTZWxlY3RvckFsbCgiLlRFU1QiKS5sZW5ndGghPT0wKXtrPWZ1bmN0aW9uKGIsZSxmLGcpe2U9ZXx8YztpZighZyYmIWsuaXNYTUwoZSkpe3ZhciBoPS9eKFx3KyQpfF5cLihbXHdcLV0rJCl8XiMoW1x3XC1dKyQpLy5leGVjKGIpO2lmKGgmJihlLm5vZGVUeXBlPT09MXx8ZS5ub2RlVHlwZT09PTkpKXtpZihoWzFdKXJldHVybiBwKGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYiksZik7aWYoaFsyXSYmbC5maW5kLkNMQVNTJiZlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpcmV0dXJuIHAoZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGhbMl0pLGYpfWlmKGUubm9kZVR5cGU9PT05KXtpZihiPT09ImJvZHkiJiZlLmJvZHkpcmV0dXJuIHAoW2UuYm9keV0sZik7aWYoaCYmaFszXSl7dmFyIGk9ZS5nZXRFbGVtZW50QnlJZChoWzNdKTtpZighaXx8IWkucGFyZW50Tm9kZSlyZXR1cm4gcChbXSxmKTtpZihpLmlkPT09aFszXSlyZXR1cm4gcChbaV0sZil9dHJ5e3JldHVybiBwKGUucXVlcnlTZWxlY3RvckFsbChiKSxmKX1jYXRjaChqKXt9fWVsc2UgaWYoZS5ub2RlVHlwZT09PTEmJmUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSE9PSJvYmplY3QiKXt2YXIgbT1lLG49ZS5nZXRBdHRyaWJ1dGUoImlkIiksbz1ufHxkLHE9ZS5wYXJlbnROb2RlLHI9L15ccypbK35dLy50ZXN0KGIpO24/bz1vLnJlcGxhY2UoLycvZywiXFwkJiIpOmUuc2V0QXR0cmlidXRlKCJpZCIsbyksciYmcSYmKGU9ZS5wYXJlbnROb2RlKTt0cnl7aWYoIXJ8fHEpcmV0dXJuIHAoZS5xdWVyeVNlbGVjdG9yQWxsKCJbaWQ9JyIrbysiJ10gIitiKSxmKX1jYXRjaChzKXt9ZmluYWxseXtufHxtLnJlbW92ZUF0dHJpYnV0ZSgiaWQiKX19fXJldHVybiBhKGIsZSxmLGcpfTtmb3IodmFyIGUgaW4gYSlrW2VdPWFbZV07Yj1udWxsfX0oKSxmdW5jdGlvbigpe3ZhciBhPWMuZG9jdW1lbnRFbGVtZW50LGI9YS5tYXRjaGVzU2VsZWN0b3J8fGEubW96TWF0Y2hlc1NlbGVjdG9yfHxhLndlYmtpdE1hdGNoZXNTZWxlY3Rvcnx8YS5tc01hdGNoZXNTZWxlY3RvcjtpZihiKXt2YXIgZD0hYi5jYWxsKGMuY3JlYXRlRWxlbWVudCgiZGl2IiksImRpdiIpLGU9ITE7dHJ5e2IuY2FsbChjLmRvY3VtZW50RWxlbWVudCwiW3Rlc3QhPScnXTpzaXp6bGUiKX1jYXRjaChmKXtlPSEwfWsubWF0Y2hlc1NlbGVjdG9yPWZ1bmN0aW9uKGEsYyl7Yz1jLnJlcGxhY2UoL1w9XHMqKFteJyJcXV0qKVxzKlxdL2csIj0nJDEnXSIpO2lmKCFrLmlzWE1MKGEpKXRyeXtpZihlfHwhbC5tYXRjaC5QU0VVRE8udGVzdChjKSYmIS8hPS8udGVzdChjKSl7dmFyIGY9Yi5jYWxsKGEsYyk7aWYoZnx8IWR8fGEuZG9jdW1lbnQmJmEuZG9jdW1lbnQubm9kZVR5cGUhPT0xMSlyZXR1cm4gZn19Y2F0Y2goZyl7fXJldHVybiBrKGMsbnVsbCxudWxsLFthXSkubGVuZ3RoPjB9fX0oKSxmdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudCgiZGl2Iik7YS5pbm5lckhUTUw9IjxkaXYgY2xhc3M9J3Rlc3QgZSc+PC9kaXY+PGRpdiBjbGFzcz0ndGVzdCc+PC9kaXY+IjtpZighIWEuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSYmYS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJlIikubGVuZ3RoIT09MCl7YS5sYXN0Q2hpbGQuY2xhc3NOYW1lPSJlIjtpZihhLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImUiKS5sZW5ndGg9PT0xKXJldHVybjtsLm9yZGVyLnNwbGljZSgxLDAsIkNMQVNTIiksbC5maW5kLkNMQVNTPWZ1bmN0aW9uKGEsYixjKXtpZih0eXBlb2YgYi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lIT0idW5kZWZpbmVkIiYmIWMpcmV0dXJuIGIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShhWzFdKX0sYT1udWxsfX0oKSxjLmRvY3VtZW50RWxlbWVudC5jb250YWlucz9rLmNvbnRhaW5zPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGEhPT1iJiYoYS5jb250YWlucz9hLmNvbnRhaW5zKGIpOiEwKX06Yy5kb2N1bWVudEVsZW1lbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24/ay5jb250YWlucz1mdW5jdGlvbihhLGIpe3JldHVybiEhKGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmMTYpfTprLmNvbnRhaW5zPWZ1bmN0aW9uKCl7cmV0dXJuITF9LGsuaXNYTUw9ZnVuY3Rpb24oYSl7dmFyIGI9KGE/YS5vd25lckRvY3VtZW50fHxhOjApLmRvY3VtZW50RWxlbWVudDtyZXR1cm4gYj9iLm5vZGVOYW1lIT09IkhUTUwiOiExfTt2YXIgdj1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9W10sZT0iIixmPWIubm9kZVR5cGU/W2JdOmI7d2hpbGUoYz1sLm1hdGNoLlBTRVVETy5leGVjKGEpKWUrPWNbMF0sYT1hLnJlcGxhY2UobC5tYXRjaC5QU0VVRE8sIiIpO2E9bC5yZWxhdGl2ZVthXT9hKyIqIjphO2Zvcih2YXIgZz0wLGg9Zi5sZW5ndGg7ZzxoO2crKylrKGEsZltnXSxkKTtyZXR1cm4gay5maWx0ZXIoZSxkKX07Zi5maW5kPWssZi5leHByPWsuc2VsZWN0b3JzLGYuZXhwclsiOiJdPWYuZXhwci5maWx0ZXJzLGYudW5pcXVlPWsudW5pcXVlU29ydCxmLnRleHQ9ay5nZXRUZXh0LGYuaXNYTUxEb2M9ay5pc1hNTCxmLmNvbnRhaW5zPWsuY29udGFpbnN9KCk7dmFyIE89L1VudGlsJC8sUD0vXig/OnBhcmVudHN8cHJldlVudGlsfHByZXZBbGwpLyxRPS8sLyxSPS9eLlteOiNcW1wuLF0qJC8sUz1BcnJheS5wcm90b3R5cGUuc2xpY2UsVD1mLmV4cHIubWF0Y2guUE9TLFU9e2NoaWxkcmVuOiEwLGNvbnRlbnRzOiEwLG5leHQ6ITAscHJldjohMH07Zi5mbi5leHRlbmQoe2ZpbmQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcyxjLGQ7aWYodHlwZW9mIGEhPSJzdHJpbmciKXJldHVybiBmKGEpLmZpbHRlcihmdW5jdGlvbigpe2ZvcihjPTAsZD1iLmxlbmd0aDtjPGQ7YysrKWlmKGYuY29udGFpbnMoYltjXSx0aGlzKSlyZXR1cm4hMH0pO3ZhciBlPXRoaXMucHVzaFN0YWNrKCIiLCJmaW5kIixhKSxnLGgsaTtmb3IoYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKyl7Zz1lLmxlbmd0aCxmLmZpbmQoYSx0aGlzW2NdLGUpO2lmKGM+MClmb3IoaD1nO2g8ZS5sZW5ndGg7aCsrKWZvcihpPTA7aTxnO2krKylpZihlW2ldPT09ZVtoXSl7ZS5zcGxpY2UoaC0tLDEpO2JyZWFrfX1yZXR1cm4gZX0saGFzOmZ1bmN0aW9uKGEpe3ZhciBiPWYoYSk7cmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKCl7Zm9yKHZhciBhPTAsYz1iLmxlbmd0aDthPGM7YSsrKWlmKGYuY29udGFpbnModGhpcyxiW2FdKSlyZXR1cm4hMH0pfSxub3Q6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKFcodGhpcyxhLCExKSwibm90IixhKX0sZmlsdGVyOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnB1c2hTdGFjayhXKHRoaXMsYSwhMCksImZpbHRlciIsYSl9LGlzOmZ1bmN0aW9uKGEpe3JldHVybiEhYSYmKHR5cGVvZiBhPT0ic3RyaW5nIj9mLmZpbHRlcihhLHRoaXMpLmxlbmd0aD4wOnRoaXMuZmlsdGVyKGEpLmxlbmd0aD4wKX0sY2xvc2VzdDpmdW5jdGlvbihhLGIpe3ZhciBjPVtdLGQsZSxnPXRoaXNbMF07aWYoZi5pc0FycmF5KGEpKXt2YXIgaCxpLGo9e30saz0xO2lmKGcmJmEubGVuZ3RoKXtmb3IoZD0wLGU9YS5sZW5ndGg7ZDxlO2QrKylpPWFbZF0saltpXXx8KGpbaV09VC50ZXN0KGkpP2YoaSxifHx0aGlzLmNvbnRleHQpOmkpO3doaWxlKGcmJmcub3duZXJEb2N1bWVudCYmZyE9PWIpe2ZvcihpIGluIGopaD1qW2ldLChoLmpxdWVyeT9oLmluZGV4KGcpPi0xOmYoZykuaXMoaCkpJiZjLnB1c2goe3NlbGVjdG9yOmksZWxlbTpnLGxldmVsOmt9KTtnPWcucGFyZW50Tm9kZSxrKyt9fXJldHVybiBjfXZhciBsPVQudGVzdChhKXx8dHlwZW9mIGEhPSJzdHJpbmciP2YoYSxifHx0aGlzLmNvbnRleHQpOjA7Zm9yKGQ9MCxlPXRoaXMubGVuZ3RoO2Q8ZTtkKyspe2c9dGhpc1tkXTt3aGlsZShnKXtpZihsP2wuaW5kZXgoZyk+LTE6Zi5maW5kLm1hdGNoZXNTZWxlY3RvcihnLGEpKXtjLnB1c2goZyk7YnJlYWt9Zz1nLnBhcmVudE5vZGU7aWYoIWd8fCFnLm93bmVyRG9jdW1lbnR8fGc9PT1ifHxnLm5vZGVUeXBlPT09MTEpYnJlYWt9fWM9Yy5sZW5ndGg+MT9mLnVuaXF1ZShjKTpjO3JldHVybiB0aGlzLnB1c2hTdGFjayhjLCJjbG9zZXN0IixhKX0saW5kZXg6ZnVuY3Rpb24oYSl7aWYoIWF8fHR5cGVvZiBhPT0ic3RyaW5nIilyZXR1cm4gZi5pbkFycmF5KHRoaXNbMF0sYT9mKGEpOnRoaXMucGFyZW50KCkuY2hpbGRyZW4oKSk7cmV0dXJuIGYuaW5BcnJheShhLmpxdWVyeT9hWzBdOmEsdGhpcyl9LGFkZDpmdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBhPT0ic3RyaW5nIj9mKGEsYik6Zi5tYWtlQXJyYXkoYSYmYS5ub2RlVHlwZT9bYV06YSksZD1mLm1lcmdlKHRoaXMuZ2V0KCksYyk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKFYoY1swXSl8fFYoZFswXSk/ZDpmLnVuaXF1ZShkKSl9LGFuZFNlbGY6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hZGQodGhpcy5wcmV2T2JqZWN0KX19KSxmLmVhY2goe3BhcmVudDpmdW5jdGlvbihhKXt2YXIgYj1hLnBhcmVudE5vZGU7cmV0dXJuIGImJmIubm9kZVR5cGUhPT0xMT9iOm51bGx9LHBhcmVudHM6ZnVuY3Rpb24oYSl7cmV0dXJuIGYuZGlyKGEsInBhcmVudE5vZGUiKX0scGFyZW50c1VudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZi5kaXIoYSwicGFyZW50Tm9kZSIsYyl9LG5leHQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGYubnRoKGEsMiwibmV4dFNpYmxpbmciKX0scHJldjpmdW5jdGlvbihhKXtyZXR1cm4gZi5udGgoYSwyLCJwcmV2aW91c1NpYmxpbmciKX0sbmV4dEFsbDpmdW5jdGlvbihhKXtyZXR1cm4gZi5kaXIoYSwibmV4dFNpYmxpbmciKX0scHJldkFsbDpmdW5jdGlvbihhKXtyZXR1cm4gZi5kaXIoYSwicHJldmlvdXNTaWJsaW5nIil9LG5leHRVbnRpbDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZGlyKGEsIm5leHRTaWJsaW5nIixjKX0scHJldlVudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZi5kaXIoYSwicHJldmlvdXNTaWJsaW5nIixjKX0sc2libGluZ3M6ZnVuY3Rpb24oYSl7cmV0dXJuIGYuc2libGluZyhhLnBhcmVudE5vZGUuZmlyc3RDaGlsZCxhKX0sY2hpbGRyZW46ZnVuY3Rpb24oYSl7cmV0dXJuIGYuc2libGluZyhhLmZpcnN0Q2hpbGQpfSxjb250ZW50czpmdW5jdGlvbihhKXtyZXR1cm4gZi5ub2RlTmFtZShhLCJpZnJhbWUiKT9hLmNvbnRlbnREb2N1bWVudHx8YS5jb250ZW50V2luZG93LmRvY3VtZW50OmYubWFrZUFycmF5KGEuY2hpbGROb2Rlcyl9fSxmdW5jdGlvbihhLGIpe2YuZm5bYV09ZnVuY3Rpb24oYyxkKXt2YXIgZT1mLm1hcCh0aGlzLGIsYyksZz1TLmNhbGwoYXJndW1lbnRzKTtPLnRlc3QoYSl8fChkPWMpLGQmJnR5cGVvZiBkPT0ic3RyaW5nIiYmKGU9Zi5maWx0ZXIoZCxlKSksZT10aGlzLmxlbmd0aD4xJiYhVVthXT9mLnVuaXF1ZShlKTplLCh0aGlzLmxlbmd0aD4xfHxRLnRlc3QoZCkpJiZQLnRlc3QoYSkmJihlPWUucmV2ZXJzZSgpKTtyZXR1cm4gdGhpcy5wdXNoU3RhY2soZSxhLGcuam9pbigiLCIpKX19KSxmLmV4dGVuZCh7ZmlsdGVyOmZ1bmN0aW9uKGEsYixjKXtjJiYoYT0iOm5vdCgiK2ErIikiKTtyZXR1cm4gYi5sZW5ndGg9PT0xP2YuZmluZC5tYXRjaGVzU2VsZWN0b3IoYlswXSxhKT9bYlswXV06W106Zi5maW5kLm1hdGNoZXMoYSxiKX0sZGlyOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZT1bXSxnPWFbY107d2hpbGUoZyYmZy5ub2RlVHlwZSE9PTkmJihkPT09Ynx8Zy5ub2RlVHlwZSE9PTF8fCFmKGcpLmlzKGQpKSlnLm5vZGVUeXBlPT09MSYmZS5wdXNoKGcpLGc9Z1tjXTtyZXR1cm4gZX0sbnRoOmZ1bmN0aW9uKGEsYixjLGQpe2I9Ynx8MTt2YXIgZT0wO2Zvcig7YTthPWFbY10paWYoYS5ub2RlVHlwZT09PTEmJisrZT09PWIpYnJlYWs7cmV0dXJuIGF9LHNpYmxpbmc6ZnVuY3Rpb24oYSxiKXt2YXIgYz1bXTtmb3IoO2E7YT1hLm5leHRTaWJsaW5nKWEubm9kZVR5cGU9PT0xJiZhIT09YiYmYy5wdXNoKGEpO3JldHVybiBjfX0pO3ZhciBYPS8galF1ZXJ5XGQrPSIoPzpcZCt8bnVsbCkiL2csWT0vXlxzKy8sWj0vPCg/IWFyZWF8YnJ8Y29sfGVtYmVkfGhyfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW0pKChbXHc6XSspW14+XSopXC8+L2lnLCQ9LzwoW1x3Ol0rKS8sXz0vPHRib2R5L2ksYmE9Lzx8JiM/XHcrOy8sYmI9LzwoPzpzY3JpcHR8b2JqZWN0fGVtYmVkfG9wdGlvbnxzdHlsZSkvaSxiYz0vY2hlY2tlZFxzKig/OltePV18PVxzKi5jaGVja2VkLikvaSxiZD0vXC8oamF2YXxlY21hKXNjcmlwdC9pLGJlPS9eXHMqPCEoPzpcW0NEQVRBXFt8XC1cLSkvLGJmPXtvcHRpb246WzEsIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCI8L3NlbGVjdD4iXSxsZWdlbmQ6WzEsIjxmaWVsZHNldD4iLCI8L2ZpZWxkc2V0PiJdLHRoZWFkOlsxLCI8dGFibGU+IiwiPC90YWJsZT4iXSx0cjpbMiwiPHRhYmxlPjx0Ym9keT4iLCI8L3Rib2R5PjwvdGFibGU+Il0sdGQ6WzMsIjx0YWJsZT48dGJvZHk+PHRyPiIsIjwvdHI+PC90Ym9keT48L3RhYmxlPiJdLGNvbDpbMiwiPHRhYmxlPjx0Ym9keT48L3Rib2R5Pjxjb2xncm91cD4iLCI8L2NvbGdyb3VwPjwvdGFibGU+Il0sYXJlYTpbMSwiPG1hcD4iLCI8L21hcD4iXSxfZGVmYXVsdDpbMCwiIiwiIl19O2JmLm9wdGdyb3VwPWJmLm9wdGlvbixiZi50Ym9keT1iZi50Zm9vdD1iZi5jb2xncm91cD1iZi5jYXB0aW9uPWJmLnRoZWFkLGJmLnRoPWJmLnRkLGYuc3VwcG9ydC5odG1sU2VyaWFsaXplfHwoYmYuX2RlZmF1bHQ9WzEsImRpdjxkaXY+IiwiPC9kaXY+Il0pLGYuZm4uZXh0ZW5kKHt0ZXh0OmZ1bmN0aW9uKGEpe2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWYodGhpcyk7Yy50ZXh0KGEuY2FsbCh0aGlzLGIsYy50ZXh0KCkpKX0pO2lmKHR5cGVvZiBhIT0ib2JqZWN0IiYmYSE9PWIpcmV0dXJuIHRoaXMuZW1wdHkoKS5hcHBlbmQoKHRoaXNbMF0mJnRoaXNbMF0ub3duZXJEb2N1bWVudHx8YykuY3JlYXRlVGV4dE5vZGUoYSkpO3JldHVybiBmLnRleHQodGhpcyl9LHdyYXBBbGw6ZnVuY3Rpb24oYSl7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zih0aGlzKS53cmFwQWxsKGEuY2FsbCh0aGlzLGIpKX0pO2lmKHRoaXNbMF0pe3ZhciBiPWYoYSx0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKCEwKTt0aGlzWzBdLnBhcmVudE5vZGUmJmIuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pLGIubWFwKGZ1bmN0aW9uKCl7dmFyIGE9dGhpczt3aGlsZShhLmZpcnN0Q2hpbGQmJmEuZmlyc3RDaGlsZC5ub2RlVHlwZT09PTEpYT1hLmZpcnN0Q2hpbGQ7cmV0dXJuIGF9KS5hcHBlbmQodGhpcyl9cmV0dXJuIHRoaXN9LHdyYXBJbm5lcjpmdW5jdGlvbihhKXtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmKHRoaXMpLndyYXBJbm5lcihhLmNhbGwodGhpcyxiKSl9KTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9Zih0aGlzKSxjPWIuY29udGVudHMoKTtjLmxlbmd0aD9jLndyYXBBbGwoYSk6Yi5hcHBlbmQoYSl9KX0sd3JhcDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zih0aGlzKS53cmFwQWxsKGEpfSl9LHVud3JhcDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnBhcmVudCgpLmVhY2goZnVuY3Rpb24oKXtmLm5vZGVOYW1lKHRoaXMsImJvZHkiKXx8Zih0aGlzKS5yZXBsYWNlV2l0aCh0aGlzLmNoaWxkTm9kZXMpfSkuZW5kKCl9LGFwcGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMCxmdW5jdGlvbihhKXt0aGlzLm5vZGVUeXBlPT09MSYmdGhpcy5hcHBlbmRDaGlsZChhKX0pfSxwcmVwZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCEwLGZ1bmN0aW9uKGEpe3RoaXMubm9kZVR5cGU9PT0xJiZ0aGlzLmluc2VydEJlZm9yZShhLHRoaXMuZmlyc3RDaGlsZCl9KX0sYmVmb3JlOmZ1bmN0aW9uKCl7aWYodGhpc1swXSYmdGhpc1swXS5wYXJlbnROb2RlKXJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMSxmdW5jdGlvbihhKXt0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsdGhpcyl9KTtpZihhcmd1bWVudHMubGVuZ3RoKXt2YXIgYT1mKGFyZ3VtZW50c1swXSk7YS5wdXNoLmFwcGx5KGEsdGhpcy50b0FycmF5KCkpO3JldHVybiB0aGlzLnB1c2hTdGFjayhhLCJiZWZvcmUiLGFyZ3VtZW50cyl9fSxhZnRlcjpmdW5jdGlvbigpe2lmKHRoaXNbMF0mJnRoaXNbMF0ucGFyZW50Tm9kZSlyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITEsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLHRoaXMubmV4dFNpYmxpbmcpfSk7aWYoYXJndW1lbnRzLmxlbmd0aCl7dmFyIGE9dGhpcy5wdXNoU3RhY2sodGhpcywiYWZ0ZXIiLGFyZ3VtZW50cyk7YS5wdXNoLmFwcGx5KGEsZihhcmd1bWVudHNbMF0pLnRvQXJyYXkoKSk7cmV0dXJuIGF9fSxyZW1vdmU6ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9MCxkOyhkPXRoaXNbY10pIT1udWxsO2MrKylpZighYXx8Zi5maWx0ZXIoYSxbZF0pLmxlbmd0aCkhYiYmZC5ub2RlVHlwZT09PTEmJihmLmNsZWFuRGF0YShkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikpLGYuY2xlYW5EYXRhKFtkXSkpLGQucGFyZW50Tm9kZSYmZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGQpO3JldHVybiB0aGlzfSxlbXB0eTpmdW5jdGlvbigpe2Zvcih2YXIgYT0wLGI7KGI9dGhpc1thXSkhPW51bGw7YSsrKXtiLm5vZGVUeXBlPT09MSYmZi5jbGVhbkRhdGEoYi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpKTt3aGlsZShiLmZpcnN0Q2hpbGQpYi5yZW1vdmVDaGlsZChiLmZpcnN0Q2hpbGQpfXJldHVybiB0aGlzfSxjbG9uZTpmdW5jdGlvbihhLGIpe2E9YT09bnVsbD8hMTphLGI9Yj09bnVsbD9hOmI7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIGYuY2xvbmUodGhpcyxhLGIpfSl9LGh0bWw6ZnVuY3Rpb24oYSl7aWYoYT09PWIpcmV0dXJuIHRoaXNbMF0mJnRoaXNbMF0ubm9kZVR5cGU9PT0xP3RoaXNbMF0uaW5uZXJIVE1MLnJlcGxhY2UoWCwiIik6bnVsbDtpZih0eXBlb2YgYT09InN0cmluZyImJiFiYi50ZXN0KGEpJiYoZi5zdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlfHwhWS50ZXN0KGEpKSYmIWJmWygkLmV4ZWMoYSl8fFsiIiwiIl0pWzFdLnRvTG93ZXJDYXNlKCldKXthPWEucmVwbGFjZShaLCI8JDE+PC8kMj4iKTt0cnl7Zm9yKHZhciBjPTAsZD10aGlzLmxlbmd0aDtjPGQ7YysrKXRoaXNbY10ubm9kZVR5cGU9PT0xJiYoZi5jbGVhbkRhdGEodGhpc1tjXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpKSx0aGlzW2NdLmlubmVySFRNTD1hKX1jYXRjaChlKXt0aGlzLmVtcHR5KCkuYXBwZW5kKGEpfX1lbHNlIGYuaXNGdW5jdGlvbihhKT90aGlzLmVhY2goZnVuY3Rpb24oYil7dmFyIGM9Zih0aGlzKTtjLmh0bWwoYS5jYWxsKHRoaXMsYixjLmh0bWwoKSkpfSk6dGhpcy5lbXB0eSgpLmFwcGVuZChhKTtyZXR1cm4gdGhpc30scmVwbGFjZVdpdGg6ZnVuY3Rpb24oYSl7aWYodGhpc1swXSYmdGhpc1swXS5wYXJlbnROb2RlKXtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXt2YXIgYz1mKHRoaXMpLGQ9Yy5odG1sKCk7Yy5yZXBsYWNlV2l0aChhLmNhbGwodGhpcyxiLGQpKX0pO3R5cGVvZiBhIT0ic3RyaW5nIiYmKGE9ZihhKS5kZXRhY2goKSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPXRoaXMubmV4dFNpYmxpbmcsYz10aGlzLnBhcmVudE5vZGU7Zih0aGlzKS5yZW1vdmUoKSxiP2YoYikuYmVmb3JlKGEpOmYoYykuYXBwZW5kKGEpfSl9cmV0dXJuIHRoaXMubGVuZ3RoP3RoaXMucHVzaFN0YWNrKGYoZi5pc0Z1bmN0aW9uKGEpP2EoKTphKSwicmVwbGFjZVdpdGgiLGEpOnRoaXN9LGRldGFjaDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5yZW1vdmUoYSwhMCl9LGRvbU1hbmlwOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZSxnLGgsaSxqPWFbMF0saz1bXTtpZighZi5zdXBwb3J0LmNoZWNrQ2xvbmUmJmFyZ3VtZW50cy5sZW5ndGg9PT0zJiZ0eXBlb2Ygaj09InN0cmluZyImJmJjLnRlc3QoaikpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YodGhpcykuZG9tTWFuaXAoYSxjLGQsITApfSk7aWYoZi5pc0Z1bmN0aW9uKGopKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZSl7dmFyIGc9Zih0aGlzKTthWzBdPWouY2FsbCh0aGlzLGUsYz9nLmh0bWwoKTpiKSxnLmRvbU1hbmlwKGEsYyxkKX0pO2lmKHRoaXNbMF0pe2k9aiYmai5wYXJlbnROb2RlLGYuc3VwcG9ydC5wYXJlbnROb2RlJiZpJiZpLm5vZGVUeXBlPT09MTEmJmkuY2hpbGROb2Rlcy5sZW5ndGg9PT10aGlzLmxlbmd0aD9lPXtmcmFnbWVudDppfTplPWYuYnVpbGRGcmFnbWVudChhLHRoaXMsayksaD1lLmZyYWdtZW50LGguY2hpbGROb2Rlcy5sZW5ndGg9PT0xP2c9aD1oLmZpcnN0Q2hpbGQ6Zz1oLmZpcnN0Q2hpbGQ7aWYoZyl7Yz1jJiZmLm5vZGVOYW1lKGcsInRyIik7Zm9yKHZhciBsPTAsbT10aGlzLmxlbmd0aCxuPW0tMTtsPG07bCsrKWQuY2FsbChjP2JnKHRoaXNbbF0sZyk6dGhpc1tsXSxlLmNhY2hlYWJsZXx8bT4xJiZsPG4/Zi5jbG9uZShoLCEwLCEwKTpoKX1rLmxlbmd0aCYmZi5lYWNoKGssYm0pfXJldHVybiB0aGlzfX0pLGYuYnVpbGRGcmFnbWVudD1mdW5jdGlvbihhLGIsZCl7dmFyIGUsZyxoLGk7YiYmYlswXSYmKGk9YlswXS5vd25lckRvY3VtZW50fHxiWzBdKSxpLmNyZWF0ZURvY3VtZW50RnJhZ21lbnR8fChpPWMpLGEubGVuZ3RoPT09MSYmdHlwZW9mIGFbMF09PSJzdHJpbmciJiZhWzBdLmxlbmd0aDw1MTImJmk9PT1jJiZhWzBdLmNoYXJBdCgwKT09PSI8IiYmIWJiLnRlc3QoYVswXSkmJihmLnN1cHBvcnQuY2hlY2tDbG9uZXx8IWJjLnRlc3QoYVswXSkpJiYoZz0hMCxoPWYuZnJhZ21lbnRzW2FbMF1dLGgmJmghPT0xJiYoZT1oKSksZXx8KGU9aS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksZi5jbGVhbihhLGksZSxkKSksZyYmKGYuZnJhZ21lbnRzW2FbMF1dPWg/ZToxKTtyZXR1cm57ZnJhZ21lbnQ6ZSxjYWNoZWFibGU6Z319LGYuZnJhZ21lbnRzPXt9LGYuZWFjaCh7YXBwZW5kVG86ImFwcGVuZCIscHJlcGVuZFRvOiJwcmVwZW5kIixpbnNlcnRCZWZvcmU6ImJlZm9yZSIsaW5zZXJ0QWZ0ZXI6ImFmdGVyIixyZXBsYWNlQWxsOiJyZXBsYWNlV2l0aCJ9LGZ1bmN0aW9uKGEsYil7Zi5mblthXT1mdW5jdGlvbihjKXt2YXIgZD1bXSxlPWYoYyksZz10aGlzLmxlbmd0aD09PTEmJnRoaXNbMF0ucGFyZW50Tm9kZTtpZihnJiZnLm5vZGVUeXBlPT09MTEmJmcuY2hpbGROb2Rlcy5sZW5ndGg9PT0xJiZlLmxlbmd0aD09PTEpe2VbYl0odGhpc1swXSk7cmV0dXJuIHRoaXN9Zm9yKHZhciBoPTAsaT1lLmxlbmd0aDtoPGk7aCsrKXt2YXIgaj0oaD4wP3RoaXMuY2xvbmUoITApOnRoaXMpLmdldCgpO2YoZVtoXSlbYl0oaiksZD1kLmNvbmNhdChqCil9cmV0dXJuIHRoaXMucHVzaFN0YWNrKGQsYSxlLnNlbGVjdG9yKX19KSxmLmV4dGVuZCh7Y2xvbmU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWEuY2xvbmVOb2RlKCEwKSxlLGcsaDtpZigoIWYuc3VwcG9ydC5ub0Nsb25lRXZlbnR8fCFmLnN1cHBvcnQubm9DbG9uZUNoZWNrZWQpJiYoYS5ub2RlVHlwZT09PTF8fGEubm9kZVR5cGU9PT0xMSkmJiFmLmlzWE1MRG9jKGEpKXtiaShhLGQpLGU9YmooYSksZz1iaihkKTtmb3IoaD0wO2VbaF07KytoKWJpKGVbaF0sZ1toXSl9aWYoYil7YmgoYSxkKTtpZihjKXtlPWJqKGEpLGc9YmooZCk7Zm9yKGg9MDtlW2hdOysraCliaChlW2hdLGdbaF0pfX1lPWc9bnVsbDtyZXR1cm4gZH0sY2xlYW46ZnVuY3Rpb24oYSxiLGQsZSl7dmFyIGc7Yj1ifHxjLHR5cGVvZiBiLmNyZWF0ZUVsZW1lbnQ9PSJ1bmRlZmluZWQiJiYoYj1iLm93bmVyRG9jdW1lbnR8fGJbMF0mJmJbMF0ub3duZXJEb2N1bWVudHx8Yyk7dmFyIGg9W10saTtmb3IodmFyIGo9MCxrOyhrPWFbal0pIT1udWxsO2orKyl7dHlwZW9mIGs9PSJudW1iZXIiJiYoays9IiIpO2lmKCFrKWNvbnRpbnVlO2lmKHR5cGVvZiBrPT0ic3RyaW5nIilpZighYmEudGVzdChrKSlrPWIuY3JlYXRlVGV4dE5vZGUoayk7ZWxzZXtrPWsucmVwbGFjZShaLCI8JDE+PC8kMj4iKTt2YXIgbD0oJC5leGVjKGspfHxbIiIsIiJdKVsxXS50b0xvd2VyQ2FzZSgpLG09YmZbbF18fGJmLl9kZWZhdWx0LG49bVswXSxvPWIuY3JlYXRlRWxlbWVudCgiZGl2Iik7by5pbm5lckhUTUw9bVsxXStrK21bMl07d2hpbGUobi0tKW89by5sYXN0Q2hpbGQ7aWYoIWYuc3VwcG9ydC50Ym9keSl7dmFyIHA9Xy50ZXN0KGspLHE9bD09PSJ0YWJsZSImJiFwP28uZmlyc3RDaGlsZCYmby5maXJzdENoaWxkLmNoaWxkTm9kZXM6bVsxXT09PSI8dGFibGU+IiYmIXA/by5jaGlsZE5vZGVzOltdO2ZvcihpPXEubGVuZ3RoLTE7aT49MDstLWkpZi5ub2RlTmFtZShxW2ldLCJ0Ym9keSIpJiYhcVtpXS5jaGlsZE5vZGVzLmxlbmd0aCYmcVtpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHFbaV0pfSFmLnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UmJlkudGVzdChrKSYmby5pbnNlcnRCZWZvcmUoYi5jcmVhdGVUZXh0Tm9kZShZLmV4ZWMoaylbMF0pLG8uZmlyc3RDaGlsZCksaz1vLmNoaWxkTm9kZXN9dmFyIHI7aWYoIWYuc3VwcG9ydC5hcHBlbmRDaGVja2VkKWlmKGtbMF0mJnR5cGVvZiAocj1rLmxlbmd0aCk9PSJudW1iZXIiKWZvcihpPTA7aTxyO2krKylibChrW2ldKTtlbHNlIGJsKGspO2subm9kZVR5cGU/aC5wdXNoKGspOmg9Zi5tZXJnZShoLGspfWlmKGQpe2c9ZnVuY3Rpb24oYSl7cmV0dXJuIWEudHlwZXx8YmQudGVzdChhLnR5cGUpfTtmb3Ioaj0wO2hbal07aisrKWlmKGUmJmYubm9kZU5hbWUoaFtqXSwic2NyaXB0IikmJighaFtqXS50eXBlfHxoW2pdLnR5cGUudG9Mb3dlckNhc2UoKT09PSJ0ZXh0L2phdmFzY3JpcHQiKSllLnB1c2goaFtqXS5wYXJlbnROb2RlP2hbal0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChoW2pdKTpoW2pdKTtlbHNle2lmKGhbal0ubm9kZVR5cGU9PT0xKXt2YXIgcz1mLmdyZXAoaFtqXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IiksZyk7aC5zcGxpY2UuYXBwbHkoaCxbaisxLDBdLmNvbmNhdChzKSl9ZC5hcHBlbmRDaGlsZChoW2pdKX19cmV0dXJuIGh9LGNsZWFuRGF0YTpmdW5jdGlvbihhKXt2YXIgYixjLGQ9Zi5jYWNoZSxlPWYuZXhwYW5kbyxnPWYuZXZlbnQuc3BlY2lhbCxoPWYuc3VwcG9ydC5kZWxldGVFeHBhbmRvO2Zvcih2YXIgaT0wLGo7KGo9YVtpXSkhPW51bGw7aSsrKXtpZihqLm5vZGVOYW1lJiZmLm5vRGF0YVtqLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKWNvbnRpbnVlO2M9altmLmV4cGFuZG9dO2lmKGMpe2I9ZFtjXSYmZFtjXVtlXTtpZihiJiZiLmV2ZW50cyl7Zm9yKHZhciBrIGluIGIuZXZlbnRzKWdba10/Zi5ldmVudC5yZW1vdmUoaixrKTpmLnJlbW92ZUV2ZW50KGosayxiLmhhbmRsZSk7Yi5oYW5kbGUmJihiLmhhbmRsZS5lbGVtPW51bGwpfWg/ZGVsZXRlIGpbZi5leHBhbmRvXTpqLnJlbW92ZUF0dHJpYnV0ZSYmai5yZW1vdmVBdHRyaWJ1dGUoZi5leHBhbmRvKSxkZWxldGUgZFtjXX19fX0pO3ZhciBibj0vYWxwaGFcKFteKV0qXCkvaSxibz0vb3BhY2l0eT0oW14pXSopLyxicD0vKFtBLVpdfF5tcykvZyxicT0vXi0/XGQrKD86cHgpPyQvaSxicj0vXi0/XGQvLGJzPS9eWytcLV09LyxidD0vW14rXC1cLlxkZV0rL2csYnU9e3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdmlzaWJpbGl0eToiaGlkZGVuIixkaXNwbGF5OiJibG9jayJ9LGJ2PVsiTGVmdCIsIlJpZ2h0Il0sYnc9WyJUb3AiLCJCb3R0b20iXSxieCxieSxiejtmLmZuLmNzcz1mdW5jdGlvbihhLGMpe2lmKGFyZ3VtZW50cy5sZW5ndGg9PT0yJiZjPT09YilyZXR1cm4gdGhpcztyZXR1cm4gZi5hY2Nlc3ModGhpcyxhLGMsITAsZnVuY3Rpb24oYSxjLGQpe3JldHVybiBkIT09Yj9mLnN0eWxlKGEsYyxkKTpmLmNzcyhhLGMpfSl9LGYuZXh0ZW5kKHtjc3NIb29rczp7b3BhY2l0eTp7Z2V0OmZ1bmN0aW9uKGEsYil7aWYoYil7dmFyIGM9YngoYSwib3BhY2l0eSIsIm9wYWNpdHkiKTtyZXR1cm4gYz09PSIiPyIxIjpjfXJldHVybiBhLnN0eWxlLm9wYWNpdHl9fX0sY3NzTnVtYmVyOntmaWxsT3BhY2l0eTohMCxmb250V2VpZ2h0OiEwLGxpbmVIZWlnaHQ6ITAsb3BhY2l0eTohMCxvcnBoYW5zOiEwLHdpZG93czohMCx6SW5kZXg6ITAsem9vbTohMH0sY3NzUHJvcHM6eyJmbG9hdCI6Zi5zdXBwb3J0LmNzc0Zsb2F0PyJjc3NGbG9hdCI6InN0eWxlRmxvYXQifSxzdHlsZTpmdW5jdGlvbihhLGMsZCxlKXtpZighIWEmJmEubm9kZVR5cGUhPT0zJiZhLm5vZGVUeXBlIT09OCYmISFhLnN0eWxlKXt2YXIgZyxoLGk9Zi5jYW1lbENhc2UoYyksaj1hLnN0eWxlLGs9Zi5jc3NIb29rc1tpXTtjPWYuY3NzUHJvcHNbaV18fGk7aWYoZD09PWIpe2lmKGsmJiJnZXQiaW4gayYmKGc9ay5nZXQoYSwhMSxlKSkhPT1iKXJldHVybiBnO3JldHVybiBqW2NdfWg9dHlwZW9mIGQ7aWYoaD09PSJudW1iZXIiJiZpc05hTihkKXx8ZD09bnVsbClyZXR1cm47aD09PSJzdHJpbmciJiZicy50ZXN0KGQpJiYoZD0rZC5yZXBsYWNlKGJ0LCIiKStwYXJzZUZsb2F0KGYuY3NzKGEsYykpLGg9Im51bWJlciIpLGg9PT0ibnVtYmVyIiYmIWYuY3NzTnVtYmVyW2ldJiYoZCs9InB4Iik7aWYoIWt8fCEoInNldCJpbiBrKXx8KGQ9ay5zZXQoYSxkKSkhPT1iKXRyeXtqW2NdPWR9Y2F0Y2gobCl7fX19LGNzczpmdW5jdGlvbihhLGMsZCl7dmFyIGUsZztjPWYuY2FtZWxDYXNlKGMpLGc9Zi5jc3NIb29rc1tjXSxjPWYuY3NzUHJvcHNbY118fGMsYz09PSJjc3NGbG9hdCImJihjPSJmbG9hdCIpO2lmKGcmJiJnZXQiaW4gZyYmKGU9Zy5nZXQoYSwhMCxkKSkhPT1iKXJldHVybiBlO2lmKGJ4KXJldHVybiBieChhLGMpfSxzd2FwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD17fTtmb3IodmFyIGUgaW4gYilkW2VdPWEuc3R5bGVbZV0sYS5zdHlsZVtlXT1iW2VdO2MuY2FsbChhKTtmb3IoZSBpbiBiKWEuc3R5bGVbZV09ZFtlXX19KSxmLmN1ckNTUz1mLmNzcyxmLmVhY2goWyJoZWlnaHQiLCJ3aWR0aCJdLGZ1bmN0aW9uKGEsYil7Zi5jc3NIb29rc1tiXT17Z2V0OmZ1bmN0aW9uKGEsYyxkKXt2YXIgZTtpZihjKXtpZihhLm9mZnNldFdpZHRoIT09MClyZXR1cm4gYkEoYSxiLGQpO2Yuc3dhcChhLGJ1LGZ1bmN0aW9uKCl7ZT1iQShhLGIsZCl9KTtyZXR1cm4gZX19LHNldDpmdW5jdGlvbihhLGIpe2lmKCFicS50ZXN0KGIpKXJldHVybiBiO2I9cGFyc2VGbG9hdChiKTtpZihiPj0wKXJldHVybiBiKyJweCJ9fX0pLGYuc3VwcG9ydC5vcGFjaXR5fHwoZi5jc3NIb29rcy5vcGFjaXR5PXtnZXQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYm8udGVzdCgoYiYmYS5jdXJyZW50U3R5bGU/YS5jdXJyZW50U3R5bGUuZmlsdGVyOmEuc3R5bGUuZmlsdGVyKXx8IiIpP3BhcnNlRmxvYXQoUmVnRXhwLiQxKS8xMDArIiI6Yj8iMSI6IiJ9LHNldDpmdW5jdGlvbihhLGIpe3ZhciBjPWEuc3R5bGUsZD1hLmN1cnJlbnRTdHlsZTtjLnpvb209MTt2YXIgZT1mLmlzTmFOKGIpPyIiOiJhbHBoYShvcGFjaXR5PSIrYioxMDArIikiLGc9ZCYmZC5maWx0ZXJ8fGMuZmlsdGVyfHwiIjtjLmZpbHRlcj1ibi50ZXN0KGcpP2cucmVwbGFjZShibixlKTpnKyIgIitlfX0pLGYoZnVuY3Rpb24oKXtmLnN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodHx8KGYuY3NzSG9va3MubWFyZ2luUmlnaHQ9e2dldDpmdW5jdGlvbihhLGIpe3ZhciBjO2Yuc3dhcChhLHtkaXNwbGF5OiJpbmxpbmUtYmxvY2sifSxmdW5jdGlvbigpe2I/Yz1ieChhLCJtYXJnaW4tcmlnaHQiLCJtYXJnaW5SaWdodCIpOmM9YS5zdHlsZS5tYXJnaW5SaWdodH0pO3JldHVybiBjfX0pfSksYy5kZWZhdWx0VmlldyYmYy5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlJiYoYnk9ZnVuY3Rpb24oYSxjKXt2YXIgZCxlLGc7Yz1jLnJlcGxhY2UoYnAsIi0kMSIpLnRvTG93ZXJDYXNlKCk7aWYoIShlPWEub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldykpcmV0dXJuIGI7aWYoZz1lLmdldENvbXB1dGVkU3R5bGUoYSxudWxsKSlkPWcuZ2V0UHJvcGVydHlWYWx1ZShjKSxkPT09IiImJiFmLmNvbnRhaW5zKGEub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsYSkmJihkPWYuc3R5bGUoYSxjKSk7cmV0dXJuIGR9KSxjLmRvY3VtZW50RWxlbWVudC5jdXJyZW50U3R5bGUmJihiej1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9YS5jdXJyZW50U3R5bGUmJmEuY3VycmVudFN0eWxlW2JdLGU9YS5ydW50aW1lU3R5bGUmJmEucnVudGltZVN0eWxlW2JdLGY9YS5zdHlsZTshYnEudGVzdChkKSYmYnIudGVzdChkKSYmKGM9Zi5sZWZ0LGUmJihhLnJ1bnRpbWVTdHlsZS5sZWZ0PWEuY3VycmVudFN0eWxlLmxlZnQpLGYubGVmdD1iPT09ImZvbnRTaXplIj8iMWVtIjpkfHwwLGQ9Zi5waXhlbExlZnQrInB4IixmLmxlZnQ9YyxlJiYoYS5ydW50aW1lU3R5bGUubGVmdD1lKSk7cmV0dXJuIGQ9PT0iIj8iYXV0byI6ZH0pLGJ4PWJ5fHxieixmLmV4cHImJmYuZXhwci5maWx0ZXJzJiYoZi5leHByLmZpbHRlcnMuaGlkZGVuPWZ1bmN0aW9uKGEpe3ZhciBiPWEub2Zmc2V0V2lkdGgsYz1hLm9mZnNldEhlaWdodDtyZXR1cm4gYj09PTAmJmM9PT0wfHwhZi5zdXBwb3J0LnJlbGlhYmxlSGlkZGVuT2Zmc2V0cyYmKGEuc3R5bGUuZGlzcGxheXx8Zi5jc3MoYSwiZGlzcGxheSIpKT09PSJub25lIn0sZi5leHByLmZpbHRlcnMudmlzaWJsZT1mdW5jdGlvbihhKXtyZXR1cm4hZi5leHByLmZpbHRlcnMuaGlkZGVuKGEpfSk7dmFyIGJCPS8lMjAvZyxiQz0vXFtcXSQvLGJEPS9ccj9cbi9nLGJFPS8jLiokLyxiRj0vXiguKj8pOlsgXHRdKihbXlxyXG5dKilccj8kL21nLGJHPS9eKD86Y29sb3J8ZGF0ZXxkYXRldGltZXxlbWFpbHxoaWRkZW58bW9udGh8bnVtYmVyfHBhc3N3b3JkfHJhbmdlfHNlYXJjaHx0ZWx8dGV4dHx0aW1lfHVybHx3ZWVrKSQvaSxiSD0vXig/OmFib3V0fGFwcHxhcHBcLXN0b3JhZ2V8LitcLWV4dGVuc2lvbnxmaWxlfHdpZGdldCk6JC8sYkk9L14oPzpHRVR8SEVBRCkkLyxiSj0vXlwvXC8vLGJLPS9cPy8sYkw9LzxzY3JpcHRcYltePF0qKD86KD8hPFwvc2NyaXB0Pik8W148XSopKjxcL3NjcmlwdD4vZ2ksYk09L14oPzpzZWxlY3R8dGV4dGFyZWEpL2ksYk49L1xzKy8sYk89LyhbPyZdKV89W14mXSovLGJQPS9eKFtcd1wrXC5cLV0rOikoPzpcL1wvKFteXC8/IzpdKikoPzo6KFxkKykpPyk/LyxiUT1mLmZuLmxvYWQsYlI9e30sYlM9e30sYlQsYlU7dHJ5e2JUPWUuaHJlZn1jYXRjaChiVil7YlQ9Yy5jcmVhdGVFbGVtZW50KCJhIiksYlQuaHJlZj0iIixiVD1iVC5ocmVmfWJVPWJQLmV4ZWMoYlQudG9Mb3dlckNhc2UoKSl8fFtdLGYuZm4uZXh0ZW5kKHtsb2FkOmZ1bmN0aW9uKGEsYyxkKXtpZih0eXBlb2YgYSE9InN0cmluZyImJmJRKXJldHVybiBiUS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7aWYoIXRoaXMubGVuZ3RoKXJldHVybiB0aGlzO3ZhciBlPWEuaW5kZXhPZigiICIpO2lmKGU+PTApe3ZhciBnPWEuc2xpY2UoZSxhLmxlbmd0aCk7YT1hLnNsaWNlKDAsZSl9dmFyIGg9IkdFVCI7YyYmKGYuaXNGdW5jdGlvbihjKT8oZD1jLGM9Yik6dHlwZW9mIGM9PSJvYmplY3QiJiYoYz1mLnBhcmFtKGMsZi5hamF4U2V0dGluZ3MudHJhZGl0aW9uYWwpLGg9IlBPU1QiKSk7dmFyIGk9dGhpcztmLmFqYXgoe3VybDphLHR5cGU6aCxkYXRhVHlwZToiaHRtbCIsZGF0YTpjLGNvbXBsZXRlOmZ1bmN0aW9uKGEsYixjKXtjPWEucmVzcG9uc2VUZXh0LGEuaXNSZXNvbHZlZCgpJiYoYS5kb25lKGZ1bmN0aW9uKGEpe2M9YX0pLGkuaHRtbChnP2YoIjxkaXY+IikuYXBwZW5kKGMucmVwbGFjZShiTCwiIikpLmZpbmQoZyk6YykpLGQmJmkuZWFjaChkLFtjLGIsYV0pfX0pO3JldHVybiB0aGlzfSxzZXJpYWxpemU6ZnVuY3Rpb24oKXtyZXR1cm4gZi5wYXJhbSh0aGlzLnNlcmlhbGl6ZUFycmF5KCkpfSxzZXJpYWxpemVBcnJheTpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnRzP2YubWFrZUFycmF5KHRoaXMuZWxlbWVudHMpOnRoaXN9KS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5uYW1lJiYhdGhpcy5kaXNhYmxlZCYmKHRoaXMuY2hlY2tlZHx8Yk0udGVzdCh0aGlzLm5vZGVOYW1lKXx8YkcudGVzdCh0aGlzLnR5cGUpKX0pLm1hcChmdW5jdGlvbihhLGIpe3ZhciBjPWYodGhpcykudmFsKCk7cmV0dXJuIGM9PW51bGw/bnVsbDpmLmlzQXJyYXkoYyk/Zi5tYXAoYyxmdW5jdGlvbihhLGMpe3JldHVybntuYW1lOmIubmFtZSx2YWx1ZTphLnJlcGxhY2UoYkQsIlxyXG4iKX19KTp7bmFtZTpiLm5hbWUsdmFsdWU6Yy5yZXBsYWNlKGJELCJcclxuIil9fSkuZ2V0KCl9fSksZi5lYWNoKCJhamF4U3RhcnQgYWpheFN0b3AgYWpheENvbXBsZXRlIGFqYXhFcnJvciBhamF4U3VjY2VzcyBhamF4U2VuZCIuc3BsaXQoIiAiKSxmdW5jdGlvbihhLGIpe2YuZm5bYl09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuYmluZChiLGEpfX0pLGYuZWFjaChbImdldCIsInBvc3QiXSxmdW5jdGlvbihhLGMpe2ZbY109ZnVuY3Rpb24oYSxkLGUsZyl7Zi5pc0Z1bmN0aW9uKGQpJiYoZz1nfHxlLGU9ZCxkPWIpO3JldHVybiBmLmFqYXgoe3R5cGU6Yyx1cmw6YSxkYXRhOmQsc3VjY2VzczplLGRhdGFUeXBlOmd9KX19KSxmLmV4dGVuZCh7Z2V0U2NyaXB0OmZ1bmN0aW9uKGEsYyl7cmV0dXJuIGYuZ2V0KGEsYixjLCJzY3JpcHQiKX0sZ2V0SlNPTjpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZ2V0KGEsYixjLCJqc29uIil9LGFqYXhTZXR1cDpmdW5jdGlvbihhLGIpe2I/Zi5leHRlbmQoITAsYSxmLmFqYXhTZXR0aW5ncyxiKTooYj1hLGE9Zi5leHRlbmQoITAsZi5hamF4U2V0dGluZ3MsYikpO2Zvcih2YXIgYyBpbntjb250ZXh0OjEsdXJsOjF9KWMgaW4gYj9hW2NdPWJbY106YyBpbiBmLmFqYXhTZXR0aW5ncyYmKGFbY109Zi5hamF4U2V0dGluZ3NbY10pO3JldHVybiBhfSxhamF4U2V0dGluZ3M6e3VybDpiVCxpc0xvY2FsOmJILnRlc3QoYlVbMV0pLGdsb2JhbDohMCx0eXBlOiJHRVQiLGNvbnRlbnRUeXBlOiJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLHByb2Nlc3NEYXRhOiEwLGFzeW5jOiEwLGFjY2VwdHM6e3htbDoiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsaHRtbDoidGV4dC9odG1sIix0ZXh0OiJ0ZXh0L3BsYWluIixqc29uOiJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L2phdmFzY3JpcHQiLCIqIjoiKi8qIn0sY29udGVudHM6e3htbDoveG1sLyxodG1sOi9odG1sLyxqc29uOi9qc29uL30scmVzcG9uc2VGaWVsZHM6e3htbDoicmVzcG9uc2VYTUwiLHRleHQ6InJlc3BvbnNlVGV4dCJ9LGNvbnZlcnRlcnM6eyIqIHRleHQiOmEuU3RyaW5nLCJ0ZXh0IGh0bWwiOiEwLCJ0ZXh0IGpzb24iOmYucGFyc2VKU09OLCJ0ZXh0IHhtbCI6Zi5wYXJzZVhNTH19LGFqYXhQcmVmaWx0ZXI6YlcoYlIpLGFqYXhUcmFuc3BvcnQ6YlcoYlMpLGFqYXg6ZnVuY3Rpb24oYSxjKXtmdW5jdGlvbiB3KGEsYyxsLG0pe2lmKHMhPT0yKXtzPTIscSYmY2xlYXJUaW1lb3V0KHEpLHA9YixuPW18fCIiLHYucmVhZHlTdGF0ZT1hPzQ6MDt2YXIgbyxyLHUsdz1sP2JaKGQsdixsKTpiLHgseTtpZihhPj0yMDAmJmE8MzAwfHxhPT09MzA0KXtpZihkLmlmTW9kaWZpZWQpe2lmKHg9di5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpKWYubGFzdE1vZGlmaWVkW2tdPXg7aWYoeT12LmdldFJlc3BvbnNlSGVhZGVyKCJFdGFnIikpZi5ldGFnW2tdPXl9aWYoYT09PTMwNCljPSJub3Rtb2RpZmllZCIsbz0hMDtlbHNlIHRyeXtyPWIkKGQsdyksYz0ic3VjY2VzcyIsbz0hMH1jYXRjaCh6KXtjPSJwYXJzZXJlcnJvciIsdT16fX1lbHNle3U9YztpZighY3x8YSljPSJlcnJvciIsYTwwJiYoYT0wKX12LnN0YXR1cz1hLHYuc3RhdHVzVGV4dD1jLG8/aC5yZXNvbHZlV2l0aChlLFtyLGMsdl0pOmgucmVqZWN0V2l0aChlLFt2LGMsdV0pLHYuc3RhdHVzQ29kZShqKSxqPWIsdCYmZy50cmlnZ2VyKCJhamF4Iisobz8iU3VjY2VzcyI6IkVycm9yIiksW3YsZCxvP3I6dV0pLGkucmVzb2x2ZVdpdGgoZSxbdixjXSksdCYmKGcudHJpZ2dlcigiYWpheENvbXBsZXRlIixbdixkXSksLS1mLmFjdGl2ZXx8Zi5ldmVudC50cmlnZ2VyKCJhamF4U3RvcCIpKX19dHlwZW9mIGE9PSJvYmplY3QiJiYoYz1hLGE9YiksYz1jfHx7fTt2YXIgZD1mLmFqYXhTZXR1cCh7fSxjKSxlPWQuY29udGV4dHx8ZCxnPWUhPT1kJiYoZS5ub2RlVHlwZXx8ZSBpbnN0YW5jZW9mIGYpP2YoZSk6Zi5ldmVudCxoPWYuRGVmZXJyZWQoKSxpPWYuX0RlZmVycmVkKCksaj1kLnN0YXR1c0NvZGV8fHt9LGssbD17fSxtPXt9LG4sbyxwLHEscixzPTAsdCx1LHY9e3JlYWR5U3RhdGU6MCxzZXRSZXF1ZXN0SGVhZGVyOmZ1bmN0aW9uKGEsYil7aWYoIXMpe3ZhciBjPWEudG9Mb3dlckNhc2UoKTthPW1bY109bVtjXXx8YSxsW2FdPWJ9cmV0dXJuIHRoaXN9LGdldEFsbFJlc3BvbnNlSGVhZGVyczpmdW5jdGlvbigpe3JldHVybiBzPT09Mj9uOm51bGx9LGdldFJlc3BvbnNlSGVhZGVyOmZ1bmN0aW9uKGEpe3ZhciBjO2lmKHM9PT0yKXtpZighbyl7bz17fTt3aGlsZShjPWJGLmV4ZWMobikpb1tjWzFdLnRvTG93ZXJDYXNlKCldPWNbMl19Yz1vW2EudG9Mb3dlckNhc2UoKV19cmV0dXJuIGM9PT1iP251bGw6Y30sb3ZlcnJpZGVNaW1lVHlwZTpmdW5jdGlvbihhKXtzfHwoZC5taW1lVHlwZT1hKTtyZXR1cm4gdGhpc30sYWJvcnQ6ZnVuY3Rpb24oYSl7YT1hfHwiYWJvcnQiLHAmJnAuYWJvcnQoYSksdygwLGEpO3JldHVybiB0aGlzfX07aC5wcm9taXNlKHYpLHYuc3VjY2Vzcz12LmRvbmUsdi5lcnJvcj12LmZhaWwsdi5jb21wbGV0ZT1pLmRvbmUsdi5zdGF0dXNDb2RlPWZ1bmN0aW9uKGEpe2lmKGEpe3ZhciBiO2lmKHM8Milmb3IoYiBpbiBhKWpbYl09W2pbYl0sYVtiXV07ZWxzZSBiPWFbdi5zdGF0dXNdLHYudGhlbihiLGIpfXJldHVybiB0aGlzfSxkLnVybD0oKGF8fGQudXJsKSsiIikucmVwbGFjZShiRSwiIikucmVwbGFjZShiSixiVVsxXSsiLy8iKSxkLmRhdGFUeXBlcz1mLnRyaW0oZC5kYXRhVHlwZXx8IioiKS50b0xvd2VyQ2FzZSgpLnNwbGl0KGJOKSxkLmNyb3NzRG9tYWluPT1udWxsJiYocj1iUC5leGVjKGQudXJsLnRvTG93ZXJDYXNlKCkpLGQuY3Jvc3NEb21haW49ISghcnx8clsxXT09YlVbMV0mJnJbMl09PWJVWzJdJiYoclszXXx8KHJbMV09PT0iaHR0cDoiPzgwOjQ0MykpPT0oYlVbM118fChiVVsxXT09PSJodHRwOiI/ODA6NDQzKSkpKSxkLmRhdGEmJmQucHJvY2Vzc0RhdGEmJnR5cGVvZiBkLmRhdGEhPSJzdHJpbmciJiYoZC5kYXRhPWYucGFyYW0oZC5kYXRhLGQudHJhZGl0aW9uYWwpKSxiWChiUixkLGMsdik7aWYocz09PTIpcmV0dXJuITE7dD1kLmdsb2JhbCxkLnR5cGU9ZC50eXBlLnRvVXBwZXJDYXNlKCksZC5oYXNDb250ZW50PSFiSS50ZXN0KGQudHlwZSksdCYmZi5hY3RpdmUrKz09PTAmJmYuZXZlbnQudHJpZ2dlcigiYWpheFN0YXJ0Iik7aWYoIWQuaGFzQ29udGVudCl7ZC5kYXRhJiYoZC51cmwrPShiSy50ZXN0KGQudXJsKT8iJiI6Ij8iKStkLmRhdGEpLGs9ZC51cmw7aWYoZC5jYWNoZT09PSExKXt2YXIgeD1mLm5vdygpLHk9ZC51cmwucmVwbGFjZShiTywiJDFfPSIreCk7ZC51cmw9eSsoeT09PWQudXJsPyhiSy50ZXN0KGQudXJsKT8iJiI6Ij8iKSsiXz0iK3g6IiIpfX0oZC5kYXRhJiZkLmhhc0NvbnRlbnQmJmQuY29udGVudFR5cGUhPT0hMXx8Yy5jb250ZW50VHlwZSkmJnYuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIixkLmNvbnRlbnRUeXBlKSxkLmlmTW9kaWZpZWQmJihrPWt8fGQudXJsLGYubGFzdE1vZGlmaWVkW2tdJiZ2LnNldFJlcXVlc3RIZWFkZXIoIklmLU1vZGlmaWVkLVNpbmNlIixmLmxhc3RNb2RpZmllZFtrXSksZi5ldGFnW2tdJiZ2LnNldFJlcXVlc3RIZWFkZXIoIklmLU5vbmUtTWF0Y2giLGYuZXRhZ1trXSkpLHYuc2V0UmVxdWVzdEhlYWRlcigiQWNjZXB0IixkLmRhdGFUeXBlc1swXSYmZC5hY2NlcHRzW2QuZGF0YVR5cGVzWzBdXT9kLmFjY2VwdHNbZC5kYXRhVHlwZXNbMF1dKyhkLmRhdGFUeXBlc1swXSE9PSIqIj8iLCAqLyo7IHE9MC4wMSI6IiIpOmQuYWNjZXB0c1siKiJdKTtmb3IodSBpbiBkLmhlYWRlcnMpdi5zZXRSZXF1ZXN0SGVhZGVyKHUsZC5oZWFkZXJzW3VdKTtpZihkLmJlZm9yZVNlbmQmJihkLmJlZm9yZVNlbmQuY2FsbChlLHYsZCk9PT0hMXx8cz09PTIpKXt2LmFib3J0KCk7cmV0dXJuITF9Zm9yKHUgaW57c3VjY2VzczoxLGVycm9yOjEsY29tcGxldGU6MX0pdlt1XShkW3VdKTtwPWJYKGJTLGQsYyx2KTtpZighcCl3KC0xLCJObyBUcmFuc3BvcnQiKTtlbHNle3YucmVhZHlTdGF0ZT0xLHQmJmcudHJpZ2dlcigiYWpheFNlbmQiLFt2LGRdKSxkLmFzeW5jJiZkLnRpbWVvdXQ+MCYmKHE9c2V0VGltZW91dChmdW5jdGlvbigpe3YuYWJvcnQoInRpbWVvdXQiKX0sZC50aW1lb3V0KSk7dHJ5e3M9MSxwLnNlbmQobCx3KX1jYXRjaCh6KXtzdGF0dXM8Mj93KC0xLHopOmYuZXJyb3Ioeil9fXJldHVybiB2fSxwYXJhbTpmdW5jdGlvbihhLGMpe3ZhciBkPVtdLGU9ZnVuY3Rpb24oYSxiKXtiPWYuaXNGdW5jdGlvbihiKT9iKCk6YixkW2QubGVuZ3RoXT1lbmNvZGVVUklDb21wb25lbnQoYSkrIj0iK2VuY29kZVVSSUNvbXBvbmVudChiKX07Yz09PWImJihjPWYuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsKTtpZihmLmlzQXJyYXkoYSl8fGEuanF1ZXJ5JiYhZi5pc1BsYWluT2JqZWN0KGEpKWYuZWFjaChhLGZ1bmN0aW9uKCl7ZSh0aGlzLm5hbWUsdGhpcy52YWx1ZSl9KTtlbHNlIGZvcih2YXIgZyBpbiBhKWJZKGcsYVtnXSxjLGUpO3JldHVybiBkLmpvaW4oIiYiKS5yZXBsYWNlKGJCLCIrIil9fSksZi5leHRlbmQoe2FjdGl2ZTowLGxhc3RNb2RpZmllZDp7fSxldGFnOnt9fSk7dmFyIGJfPWYubm93KCksY2E9LyhcPSlcPygmfCQpfFw/XD8vaTtmLmFqYXhTZXR1cCh7anNvbnA6ImNhbGxiYWNrIixqc29ucENhbGxiYWNrOmZ1bmN0aW9uKCl7cmV0dXJuIGYuZXhwYW5kbysiXyIrYl8rK319KSxmLmFqYXhQcmVmaWx0ZXIoImpzb24ganNvbnAiLGZ1bmN0aW9uKGIsYyxkKXt2YXIgZT1iLmNvbnRlbnRUeXBlPT09ImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCImJnR5cGVvZiBiLmRhdGE9PSJzdHJpbmciO2lmKGIuZGF0YVR5cGVzWzBdPT09Impzb25wInx8Yi5qc29ucCE9PSExJiYoY2EudGVzdChiLnVybCl8fGUmJmNhLnRlc3QoYi5kYXRhKSkpe3ZhciBnLGg9Yi5qc29ucENhbGxiYWNrPWYuaXNGdW5jdGlvbihiLmpzb25wQ2FsbGJhY2spP2IuanNvbnBDYWxsYmFjaygpOmIuanNvbnBDYWxsYmFjayxpPWFbaF0saj1iLnVybCxrPWIuZGF0YSxsPSIkMSIraCsiJDIiO2IuanNvbnAhPT0hMSYmKGo9ai5yZXBsYWNlKGNhLGwpLGIudXJsPT09aiYmKGUmJihrPWsucmVwbGFjZShjYSxsKSksYi5kYXRhPT09ayYmKGorPSgvXD8vLnRlc3Qoaik/IiYiOiI/IikrYi5qc29ucCsiPSIraCkpKSxiLnVybD1qLGIuZGF0YT1rLGFbaF09ZnVuY3Rpb24oYSl7Zz1bYV19LGQuYWx3YXlzKGZ1bmN0aW9uKCl7YVtoXT1pLGcmJmYuaXNGdW5jdGlvbihpKSYmYVtoXShnWzBdKX0pLGIuY29udmVydGVyc1sic2NyaXB0IGpzb24iXT1mdW5jdGlvbigpe2d8fGYuZXJyb3IoaCsiIHdhcyBub3QgY2FsbGVkIik7cmV0dXJuIGdbMF19LGIuZGF0YVR5cGVzWzBdPSJqc29uIjtyZXR1cm4ic2NyaXB0In19KSxmLmFqYXhTZXR1cCh7YWNjZXB0czp7c2NyaXB0OiJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCJ9LGNvbnRlbnRzOntzY3JpcHQ6L2phdmFzY3JpcHR8ZWNtYXNjcmlwdC99LGNvbnZlcnRlcnM6eyJ0ZXh0IHNjcmlwdCI6ZnVuY3Rpb24oYSl7Zi5nbG9iYWxFdmFsKGEpO3JldHVybiBhfX19KSxmLmFqYXhQcmVmaWx0ZXIoInNjcmlwdCIsZnVuY3Rpb24oYSl7YS5jYWNoZT09PWImJihhLmNhY2hlPSExKSxhLmNyb3NzRG9tYWluJiYoYS50eXBlPSJHRVQiLGEuZ2xvYmFsPSExKX0pLGYuYWpheFRyYW5zcG9ydCgic2NyaXB0IixmdW5jdGlvbihhKXtpZihhLmNyb3NzRG9tYWluKXt2YXIgZCxlPWMuaGVhZHx8Yy5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdfHxjLmRvY3VtZW50RWxlbWVudDtyZXR1cm57c2VuZDpmdW5jdGlvbihmLGcpe2Q9Yy5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKSxkLmFzeW5jPSJhc3luYyIsYS5zY3JpcHRDaGFyc2V0JiYoZC5jaGFyc2V0PWEuc2NyaXB0Q2hhcnNldCksZC5zcmM9YS51cmwsZC5vbmxvYWQ9ZC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oYSxjKXtpZihjfHwhZC5yZWFkeVN0YXRlfHwvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KGQucmVhZHlTdGF0ZSkpZC5vbmxvYWQ9ZC5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCxlJiZkLnBhcmVudE5vZGUmJmUucmVtb3ZlQ2hpbGQoZCksZD1iLGN8fGcoMjAwLCJzdWNjZXNzIil9LGUuaW5zZXJ0QmVmb3JlKGQsZS5maXJzdENoaWxkKX0sYWJvcnQ6ZnVuY3Rpb24oKXtkJiZkLm9ubG9hZCgwLDEpfX19fSk7dmFyIGNiPWEuQWN0aXZlWE9iamVjdD9mdW5jdGlvbigpe2Zvcih2YXIgYSBpbiBjZCljZFthXSgwLDEpfTohMSxjYz0wLGNkO2YuYWpheFNldHRpbmdzLnhocj1hLkFjdGl2ZVhPYmplY3Q/ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5pc0xvY2FsJiZjZSgpfHxjZigpfTpjZSxmdW5jdGlvbihhKXtmLmV4dGVuZChmLnN1cHBvcnQse2FqYXg6ISFhLGNvcnM6ISFhJiYid2l0aENyZWRlbnRpYWxzImluIGF9KX0oZi5hamF4U2V0dGluZ3MueGhyKCkpLGYuc3VwcG9ydC5hamF4JiZmLmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oYyl7aWYoIWMuY3Jvc3NEb21haW58fGYuc3VwcG9ydC5jb3JzKXt2YXIgZDtyZXR1cm57c2VuZDpmdW5jdGlvbihlLGcpe3ZhciBoPWMueGhyKCksaSxqO2MudXNlcm5hbWU/aC5vcGVuKGMudHlwZSxjLnVybCxjLmFzeW5jLGMudXNlcm5hbWUsYy5wYXNzd29yZCk6aC5vcGVuKGMudHlwZSxjLnVybCxjLmFzeW5jKTtpZihjLnhockZpZWxkcylmb3IoaiBpbiBjLnhockZpZWxkcyloW2pdPWMueGhyRmllbGRzW2pdO2MubWltZVR5cGUmJmgub3ZlcnJpZGVNaW1lVHlwZSYmaC5vdmVycmlkZU1pbWVUeXBlKGMubWltZVR5cGUpLCFjLmNyb3NzRG9tYWluJiYhZVsiWC1SZXF1ZXN0ZWQtV2l0aCJdJiYoZVsiWC1SZXF1ZXN0ZWQtV2l0aCJdPSJYTUxIdHRwUmVxdWVzdCIpO3RyeXtmb3IoaiBpbiBlKWguc2V0UmVxdWVzdEhlYWRlcihqLGVbal0pfWNhdGNoKGspe31oLnNlbmQoYy5oYXNDb250ZW50JiZjLmRhdGF8fG51bGwpLGQ9ZnVuY3Rpb24oYSxlKXt2YXIgaixrLGwsbSxuO3RyeXtpZihkJiYoZXx8aC5yZWFkeVN0YXRlPT09NCkpe2Q9YixpJiYoaC5vbnJlYWR5c3RhdGVjaGFuZ2U9Zi5ub29wLGNiJiZkZWxldGUgY2RbaV0pO2lmKGUpaC5yZWFkeVN0YXRlIT09NCYmaC5hYm9ydCgpO2Vsc2V7aj1oLnN0YXR1cyxsPWguZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCksbT17fSxuPWgucmVzcG9uc2VYTUwsbiYmbi5kb2N1bWVudEVsZW1lbnQmJihtLnhtbD1uKSxtLnRleHQ9aC5yZXNwb25zZVRleHQ7dHJ5e2s9aC5zdGF0dXNUZXh0fWNhdGNoKG8pe2s9IiJ9IWomJmMuaXNMb2NhbCYmIWMuY3Jvc3NEb21haW4/aj1tLnRleHQ/MjAwOjQwNDpqPT09MTIyMyYmKGo9MjA0KX19fWNhdGNoKHApe2V8fGcoLTEscCl9bSYmZyhqLGssbSxsKX0sIWMuYXN5bmN8fGgucmVhZHlTdGF0ZT09PTQ/ZCgpOihpPSsrY2MsY2ImJihjZHx8KGNkPXt9LGYoYSkudW5sb2FkKGNiKSksY2RbaV09ZCksaC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZCl9LGFib3J0OmZ1bmN0aW9uKCl7ZCYmZCgwLDEpfX19fSk7dmFyIGNnPXt9LGNoLGNpLGNqPS9eKD86dG9nZ2xlfHNob3d8aGlkZSkkLyxjaz0vXihbK1wtXT0pPyhbXGQrLlwtXSspKFthLXolXSopJC9pLGNsLGNtPVtbImhlaWdodCIsIm1hcmdpblRvcCIsIm1hcmdpbkJvdHRvbSIsInBhZGRpbmdUb3AiLCJwYWRkaW5nQm90dG9tIl0sWyJ3aWR0aCIsIm1hcmdpbkxlZnQiLCJtYXJnaW5SaWdodCIsInBhZGRpbmdMZWZ0IiwicGFkZGluZ1JpZ2h0Il0sWyJvcGFjaXR5Il1dLGNuLGNvPWEud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxhLm1velJlcXVlc3RBbmltYXRpb25GcmFtZXx8YS5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lO2YuZm4uZXh0ZW5kKHtzaG93OmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlO2lmKGF8fGE9PT0wKXJldHVybiB0aGlzLmFuaW1hdGUoY3IoInNob3ciLDMpLGEsYixjKTtmb3IodmFyIGc9MCxoPXRoaXMubGVuZ3RoO2c8aDtnKyspZD10aGlzW2ddLGQuc3R5bGUmJihlPWQuc3R5bGUuZGlzcGxheSwhZi5fZGF0YShkLCJvbGRkaXNwbGF5IikmJmU9PT0ibm9uZSImJihlPWQuc3R5bGUuZGlzcGxheT0iIiksZT09PSIiJiZmLmNzcyhkLCJkaXNwbGF5Iik9PT0ibm9uZSImJmYuX2RhdGEoZCwib2xkZGlzcGxheSIsY3MoZC5ub2RlTmFtZSkpKTtmb3IoZz0wO2c8aDtnKyspe2Q9dGhpc1tnXTtpZihkLnN0eWxlKXtlPWQuc3R5bGUuZGlzcGxheTtpZihlPT09IiJ8fGU9PT0ibm9uZSIpZC5zdHlsZS5kaXNwbGF5PWYuX2RhdGEoZCwib2xkZGlzcGxheSIpfHwiIn19cmV0dXJuIHRoaXN9LGhpZGU6ZnVuY3Rpb24oYSxiLGMpe2lmKGF8fGE9PT0wKXJldHVybiB0aGlzLmFuaW1hdGUoY3IoImhpZGUiLDMpLGEsYixjKTtmb3IodmFyIGQ9MCxlPXRoaXMubGVuZ3RoO2Q8ZTtkKyspaWYodGhpc1tkXS5zdHlsZSl7dmFyIGc9Zi5jc3ModGhpc1tkXSwiZGlzcGxheSIpO2chPT0ibm9uZSImJiFmLl9kYXRhKHRoaXNbZF0sIm9sZGRpc3BsYXkiKSYmZi5fZGF0YSh0aGlzW2RdLCJvbGRkaXNwbGF5IixnKX1mb3IoZD0wO2Q8ZTtkKyspdGhpc1tkXS5zdHlsZSYmKHRoaXNbZF0uc3R5bGUuZGlzcGxheT0ibm9uZSIpO3JldHVybiB0aGlzfSxfdG9nZ2xlOmYuZm4udG9nZ2xlLHRvZ2dsZTpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dHlwZW9mIGE9PSJib29sZWFuIjtmLmlzRnVuY3Rpb24oYSkmJmYuaXNGdW5jdGlvbihiKT90aGlzLl90b2dnbGUuYXBwbHkodGhpcyxhcmd1bWVudHMpOmE9PW51bGx8fGQ/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9ZD9hOmYodGhpcykuaXMoIjpoaWRkZW4iKTtmKHRoaXMpW2I/InNob3ciOiJoaWRlIl0oKX0pOnRoaXMuYW5pbWF0ZShjcigidG9nZ2xlIiwzKSxhLGIsYyk7cmV0dXJuIHRoaXN9LGZhZGVUbzpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5maWx0ZXIoIjpoaWRkZW4iKS5jc3MoIm9wYWNpdHkiLDApLnNob3coKS5lbmQoKS5hbmltYXRlKHtvcGFjaXR5OmJ9LGEsYyxkKX0sYW5pbWF0ZTpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1mLnNwZWVkKGIsYyxkKTtpZihmLmlzRW1wdHlPYmplY3QoYSkpcmV0dXJuIHRoaXMuZWFjaChlLmNvbXBsZXRlLFshMV0pO2E9Zi5leHRlbmQoe30sYSk7cmV0dXJuIHRoaXNbZS5xdWV1ZT09PSExPyJlYWNoIjoicXVldWUiXShmdW5jdGlvbigpe2UucXVldWU9PT0hMSYmZi5fbWFyayh0aGlzKTt2YXIgYj1mLmV4dGVuZCh7fSxlKSxjPXRoaXMubm9kZVR5cGU9PT0xLGQ9YyYmZih0aGlzKS5pcygiOmhpZGRlbiIpLGcsaCxpLGosayxsLG0sbixvO2IuYW5pbWF0ZWRQcm9wZXJ0aWVzPXt9O2ZvcihpIGluIGEpe2c9Zi5jYW1lbENhc2UoaSksaSE9PWcmJihhW2ddPWFbaV0sZGVsZXRlIGFbaV0pLGg9YVtnXSxmLmlzQXJyYXkoaCk/KGIuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddPWhbMV0saD1hW2ddPWhbMF0pOmIuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddPWIuc3BlY2lhbEVhc2luZyYmYi5zcGVjaWFsRWFzaW5nW2ddfHxiLmVhc2luZ3x8InN3aW5nIjtpZihoPT09ImhpZGUiJiZkfHxoPT09InNob3ciJiYhZClyZXR1cm4gYi5jb21wbGV0ZS5jYWxsKHRoaXMpO2MmJihnPT09ImhlaWdodCJ8fGc9PT0id2lkdGgiKSYmKGIub3ZlcmZsb3c9W3RoaXMuc3R5bGUub3ZlcmZsb3csdGhpcy5zdHlsZS5vdmVyZmxvd1gsdGhpcy5zdHlsZS5vdmVyZmxvd1ldLGYuY3NzKHRoaXMsImRpc3BsYXkiKT09PSJpbmxpbmUiJiZmLmNzcyh0aGlzLCJmbG9hdCIpPT09Im5vbmUiJiYoZi5zdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQ/KGo9Y3ModGhpcy5ub2RlTmFtZSksaj09PSJpbmxpbmUiP3RoaXMuc3R5bGUuZGlzcGxheT0iaW5saW5lLWJsb2NrIjoodGhpcy5zdHlsZS5kaXNwbGF5PSJpbmxpbmUiLHRoaXMuc3R5bGUuem9vbT0xKSk6dGhpcy5zdHlsZS5kaXNwbGF5PSJpbmxpbmUtYmxvY2siKSl9Yi5vdmVyZmxvdyE9bnVsbCYmKHRoaXMuc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIpO2ZvcihpIGluIGEpaz1uZXcgZi5meCh0aGlzLGIsaSksaD1hW2ldLGNqLnRlc3QoaCk/a1toPT09InRvZ2dsZSI/ZD8ic2hvdyI6ImhpZGUiOmhdKCk6KGw9Y2suZXhlYyhoKSxtPWsuY3VyKCksbD8obj1wYXJzZUZsb2F0KGxbMl0pLG89bFszXXx8KGYuY3NzTnVtYmVyW2ldPyIiOiJweCIpLG8hPT0icHgiJiYoZi5zdHlsZSh0aGlzLGksKG58fDEpK28pLG09KG58fDEpL2suY3VyKCkqbSxmLnN0eWxlKHRoaXMsaSxtK28pKSxsWzFdJiYobj0obFsxXT09PSItPSI/LTE6MSkqbittKSxrLmN1c3RvbShtLG4sbykpOmsuY3VzdG9tKG0saCwiIikpO3JldHVybiEwfSl9LHN0b3A6ZnVuY3Rpb24oYSxiKXthJiZ0aGlzLnF1ZXVlKFtdKSx0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYT1mLnRpbWVycyxjPWEubGVuZ3RoO2J8fGYuX3VubWFyayghMCx0aGlzKTt3aGlsZShjLS0pYVtjXS5lbGVtPT09dGhpcyYmKGImJmFbY10oITApLGEuc3BsaWNlKGMsMSkpfSksYnx8dGhpcy5kZXF1ZXVlKCk7cmV0dXJuIHRoaXN9fSksZi5lYWNoKHtzbGlkZURvd246Y3IoInNob3ciLDEpLHNsaWRlVXA6Y3IoImhpZGUiLDEpLHNsaWRlVG9nZ2xlOmNyKCJ0b2dnbGUiLDEpLGZhZGVJbjp7b3BhY2l0eToic2hvdyJ9LGZhZGVPdXQ6e29wYWNpdHk6ImhpZGUifSxmYWRlVG9nZ2xlOntvcGFjaXR5OiJ0b2dnbGUifX0sZnVuY3Rpb24oYSxiKXtmLmZuW2FdPWZ1bmN0aW9uKGEsYyxkKXtyZXR1cm4gdGhpcy5hbmltYXRlKGIsYSxjLGQpfX0pLGYuZXh0ZW5kKHtzcGVlZDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YSYmdHlwZW9mIGE9PSJvYmplY3QiP2YuZXh0ZW5kKHt9LGEpOntjb21wbGV0ZTpjfHwhYyYmYnx8Zi5pc0Z1bmN0aW9uKGEpJiZhLGR1cmF0aW9uOmEsZWFzaW5nOmMmJmJ8fGImJiFmLmlzRnVuY3Rpb24oYikmJmJ9O2QuZHVyYXRpb249Zi5meC5vZmY/MDp0eXBlb2YgZC5kdXJhdGlvbj09Im51bWJlciI/ZC5kdXJhdGlvbjpkLmR1cmF0aW9uIGluIGYuZnguc3BlZWRzP2YuZnguc3BlZWRzW2QuZHVyYXRpb25dOmYuZnguc3BlZWRzLl9kZWZhdWx0LGQub2xkPWQuY29tcGxldGUsZC5jb21wbGV0ZT1mdW5jdGlvbihhKXtmLmlzRnVuY3Rpb24oZC5vbGQpJiZkLm9sZC5jYWxsKHRoaXMpLGQucXVldWUhPT0hMT9mLmRlcXVldWUodGhpcyk6YSE9PSExJiZmLl91bm1hcmsodGhpcyl9O3JldHVybiBkfSxlYXNpbmc6e2xpbmVhcjpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gYytkKmF9LHN3aW5nOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybigtTWF0aC5jb3MoYSpNYXRoLlBJKS8yKy41KSpkK2N9fSx0aW1lcnM6W10sZng6ZnVuY3Rpb24oYSxiLGMpe3RoaXMub3B0aW9ucz1iLHRoaXMuZWxlbT1hLHRoaXMucHJvcD1jLGIub3JpZz1iLm9yaWd8fHt9fX0pLGYuZngucHJvdG90eXBlPXt1cGRhdGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuc3RlcCYmdGhpcy5vcHRpb25zLnN0ZXAuY2FsbCh0aGlzLmVsZW0sdGhpcy5ub3csdGhpcyksKGYuZnguc3RlcFt0aGlzLnByb3BdfHxmLmZ4LnN0ZXAuX2RlZmF1bHQpKHRoaXMpfSxjdXI6ZnVuY3Rpb24oKXtpZih0aGlzLmVsZW1bdGhpcy5wcm9wXSE9bnVsbCYmKCF0aGlzLmVsZW0uc3R5bGV8fHRoaXMuZWxlbS5zdHlsZVt0aGlzLnByb3BdPT1udWxsKSlyZXR1cm4gdGhpcy5lbGVtW3RoaXMucHJvcF07dmFyIGEsYj1mLmNzcyh0aGlzLmVsZW0sdGhpcy5wcm9wKTtyZXR1cm4gaXNOYU4oYT1wYXJzZUZsb2F0KGIpKT8hYnx8Yj09PSJhdXRvIj8wOmI6YX0sY3VzdG9tOmZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBoKGEpe3JldHVybiBkLnN0ZXAoYSl9dmFyIGQ9dGhpcyxlPWYuZngsZzt0aGlzLnN0YXJ0VGltZT1jbnx8Y3AoKSx0aGlzLnN0YXJ0PWEsdGhpcy5lbmQ9Yix0aGlzLnVuaXQ9Y3x8dGhpcy51bml0fHwoZi5jc3NOdW1iZXJbdGhpcy5wcm9wXT8iIjoicHgiKSx0aGlzLm5vdz10aGlzLnN0YXJ0LHRoaXMucG9zPXRoaXMuc3RhdGU9MCxoLmVsZW09dGhpcy5lbGVtLGgoKSYmZi50aW1lcnMucHVzaChoKSYmIWNsJiYoY28/KGNsPSEwLGc9ZnVuY3Rpb24oKXtjbCYmKGNvKGcpLGUudGljaygpKX0sY28oZykpOmNsPXNldEludGVydmFsKGUudGljayxlLmludGVydmFsKSl9LHNob3c6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMub3JpZ1t0aGlzLnByb3BdPWYuc3R5bGUodGhpcy5lbGVtLHRoaXMucHJvcCksdGhpcy5vcHRpb25zLnNob3c9ITAsdGhpcy5jdXN0b20odGhpcy5wcm9wPT09IndpZHRoInx8dGhpcy5wcm9wPT09ImhlaWdodCI/MTowLHRoaXMuY3VyKCkpLGYodGhpcy5lbGVtKS5zaG93KCl9LGhpZGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMub3JpZ1t0aGlzLnByb3BdPWYuc3R5bGUodGhpcy5lbGVtLHRoaXMucHJvcCksdGhpcy5vcHRpb25zLmhpZGU9ITAsdGhpcy5jdXN0b20odGhpcy5jdXIoKSwwKX0sc3RlcDpmdW5jdGlvbihhKXt2YXIgYj1jbnx8Y3AoKSxjPSEwLGQ9dGhpcy5lbGVtLGU9dGhpcy5vcHRpb25zLGcsaDtpZihhfHxiPj1lLmR1cmF0aW9uK3RoaXMuc3RhcnRUaW1lKXt0aGlzLm5vdz10aGlzLmVuZCx0aGlzLnBvcz10aGlzLnN0YXRlPTEsdGhpcy51cGRhdGUoKSxlLmFuaW1hdGVkUHJvcGVydGllc1t0aGlzLnByb3BdPSEwO2ZvcihnIGluIGUuYW5pbWF0ZWRQcm9wZXJ0aWVzKWUuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddIT09ITAmJihjPSExKTtpZihjKXtlLm92ZXJmbG93IT1udWxsJiYhZi5zdXBwb3J0LnNocmlua1dyYXBCbG9ja3MmJmYuZWFjaChbIiIsIlgiLCJZIl0sZnVuY3Rpb24oYSxiKXtkLnN0eWxlWyJvdmVyZmxvdyIrYl09ZS5vdmVyZmxvd1thXX0pLGUuaGlkZSYmZihkKS5oaWRlKCk7aWYoZS5oaWRlfHxlLnNob3cpZm9yKHZhciBpIGluIGUuYW5pbWF0ZWRQcm9wZXJ0aWVzKWYuc3R5bGUoZCxpLGUub3JpZ1tpXSk7ZS5jb21wbGV0ZS5jYWxsKGQpfXJldHVybiExfWUuZHVyYXRpb249PUluZmluaXR5P3RoaXMubm93PWI6KGg9Yi10aGlzLnN0YXJ0VGltZSx0aGlzLnN0YXRlPWgvZS5kdXJhdGlvbix0aGlzLnBvcz1mLmVhc2luZ1tlLmFuaW1hdGVkUHJvcGVydGllc1t0aGlzLnByb3BdXSh0aGlzLnN0YXRlLGgsMCwxLGUuZHVyYXRpb24pLHRoaXMubm93PXRoaXMuc3RhcnQrKHRoaXMuZW5kLXRoaXMuc3RhcnQpKnRoaXMucG9zKSx0aGlzLnVwZGF0ZSgpO3JldHVybiEwfX0sZi5leHRlbmQoZi5meCx7dGljazpmdW5jdGlvbigpe2Zvcih2YXIgYT1mLnRpbWVycyxiPTA7YjxhLmxlbmd0aDsrK2IpYVtiXSgpfHxhLnNwbGljZShiLS0sMSk7YS5sZW5ndGh8fGYuZnguc3RvcCgpfSxpbnRlcnZhbDoxMyxzdG9wOmZ1bmN0aW9uKCl7Y2xlYXJJbnRlcnZhbChjbCksY2w9bnVsbH0sc3BlZWRzOntzbG93OjYwMCxmYXN0OjIwMCxfZGVmYXVsdDo0MDB9LHN0ZXA6e29wYWNpdHk6ZnVuY3Rpb24oYSl7Zi5zdHlsZShhLmVsZW0sIm9wYWNpdHkiLGEubm93KX0sX2RlZmF1bHQ6ZnVuY3Rpb24oYSl7YS5lbGVtLnN0eWxlJiZhLmVsZW0uc3R5bGVbYS5wcm9wXSE9bnVsbD9hLmVsZW0uc3R5bGVbYS5wcm9wXT0oYS5wcm9wPT09IndpZHRoInx8YS5wcm9wPT09ImhlaWdodCI/TWF0aC5tYXgoMCxhLm5vdyk6YS5ub3cpK2EudW5pdDphLmVsZW1bYS5wcm9wXT1hLm5vd319fSksZi5leHByJiZmLmV4cHIuZmlsdGVycyYmKGYuZXhwci5maWx0ZXJzLmFuaW1hdGVkPWZ1bmN0aW9uKGEpe3JldHVybiBmLmdyZXAoZi50aW1lcnMsZnVuY3Rpb24oYil7cmV0dXJuIGE9PT1iLmVsZW19KS5sZW5ndGh9KTt2YXIgY3Q9L150KD86YWJsZXxkfGgpJC9pLGN1PS9eKD86Ym9keXxodG1sKSQvaTsiZ2V0Qm91bmRpbmdDbGllbnRSZWN0ImluIGMuZG9jdW1lbnRFbGVtZW50P2YuZm4ub2Zmc2V0PWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXNbMF0sYztpZihhKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zi5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO2lmKCFifHwhYi5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGI9PT1iLm93bmVyRG9jdW1lbnQuYm9keSlyZXR1cm4gZi5vZmZzZXQuYm9keU9mZnNldChiKTt0cnl7Yz1iLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpfWNhdGNoKGQpe312YXIgZT1iLm93bmVyRG9jdW1lbnQsZz1lLmRvY3VtZW50RWxlbWVudDtpZighY3x8IWYuY29udGFpbnMoZyxiKSlyZXR1cm4gYz97dG9wOmMudG9wLGxlZnQ6Yy5sZWZ0fTp7dG9wOjAsbGVmdDowfTt2YXIgaD1lLmJvZHksaT1jdihlKSxqPWcuY2xpZW50VG9wfHxoLmNsaWVudFRvcHx8MCxrPWcuY2xpZW50TGVmdHx8aC5jbGllbnRMZWZ0fHwwLGw9aS5wYWdlWU9mZnNldHx8Zi5zdXBwb3J0LmJveE1vZGVsJiZnLnNjcm9sbFRvcHx8aC5zY3JvbGxUb3AsbT1pLnBhZ2VYT2Zmc2V0fHxmLnN1cHBvcnQuYm94TW9kZWwmJmcuc2Nyb2xsTGVmdHx8aC5zY3JvbGxMZWZ0LG49Yy50b3ArbC1qLG89Yy5sZWZ0K20taztyZXR1cm57dG9wOm4sbGVmdDpvfX06Zi5mbi5vZmZzZXQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXTtpZihhKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zi5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO2lmKCFifHwhYi5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGI9PT1iLm93bmVyRG9jdW1lbnQuYm9keSlyZXR1cm4gZi5vZmZzZXQuYm9keU9mZnNldChiKTtmLm9mZnNldC5pbml0aWFsaXplKCk7dmFyIGMsZD1iLm9mZnNldFBhcmVudCxlPWIsZz1iLm93bmVyRG9jdW1lbnQsaD1nLmRvY3VtZW50RWxlbWVudCxpPWcuYm9keSxqPWcuZGVmYXVsdFZpZXcsaz1qP2ouZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpOmIuY3VycmVudFN0eWxlLGw9Yi5vZmZzZXRUb3AsbT1iLm9mZnNldExlZnQ7d2hpbGUoKGI9Yi5wYXJlbnROb2RlKSYmYiE9PWkmJmIhPT1oKXtpZihmLm9mZnNldC5zdXBwb3J0c0ZpeGVkUG9zaXRpb24mJmsucG9zaXRpb249PT0iZml4ZWQiKWJyZWFrO2M9aj9qLmdldENvbXB1dGVkU3R5bGUoYixudWxsKTpiLmN1cnJlbnRTdHlsZSxsLT1iLnNjcm9sbFRvcCxtLT1iLnNjcm9sbExlZnQsYj09PWQmJihsKz1iLm9mZnNldFRvcCxtKz1iLm9mZnNldExlZnQsZi5vZmZzZXQuZG9lc05vdEFkZEJvcmRlciYmKCFmLm9mZnNldC5kb2VzQWRkQm9yZGVyRm9yVGFibGVBbmRDZWxsc3x8IWN0LnRlc3QoYi5ub2RlTmFtZSkpJiYobCs9cGFyc2VGbG9hdChjLmJvcmRlclRvcFdpZHRoKXx8MCxtKz1wYXJzZUZsb2F0KGMuYm9yZGVyTGVmdFdpZHRoKXx8MCksZT1kLGQ9Yi5vZmZzZXRQYXJlbnQpLGYub2Zmc2V0LnN1YnRyYWN0c0JvcmRlckZvck92ZXJmbG93Tm90VmlzaWJsZSYmYy5vdmVyZmxvdyE9PSJ2aXNpYmxlIiYmKGwrPXBhcnNlRmxvYXQoYy5ib3JkZXJUb3BXaWR0aCl8fDAsbSs9cGFyc2VGbG9hdChjLmJvcmRlckxlZnRXaWR0aCl8fDApLGs9Y31pZihrLnBvc2l0aW9uPT09InJlbGF0aXZlInx8ay5wb3NpdGlvbj09PSJzdGF0aWMiKWwrPWkub2Zmc2V0VG9wLG0rPWkub2Zmc2V0TGVmdDtmLm9mZnNldC5zdXBwb3J0c0ZpeGVkUG9zaXRpb24mJmsucG9zaXRpb249PT0iZml4ZWQiJiYobCs9TWF0aC5tYXgoaC5zY3JvbGxUb3AsaS5zY3JvbGxUb3ApLG0rPU1hdGgubWF4KGguc2Nyb2xsTGVmdCxpLnNjcm9sbExlZnQpKTtyZXR1cm57dG9wOmwsbGVmdDptfX0sZi5vZmZzZXQ9e2luaXRpYWxpemU6ZnVuY3Rpb24oKXt2YXIgYT1jLmJvZHksYj1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpLGQsZSxnLGgsaT1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpblRvcCIpKXx8MCxqPSI8ZGl2IHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7bWFyZ2luOjA7Ym9yZGVyOjVweCBzb2xpZCAjMDAwO3BhZGRpbmc6MDt3aWR0aDoxcHg7aGVpZ2h0OjFweDsnPjxkaXY+PC9kaXY+PC9kaXY+PHRhYmxlIHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7bWFyZ2luOjA7Ym9yZGVyOjVweCBzb2xpZCAjMDAwO3BhZGRpbmc6MDt3aWR0aDoxcHg7aGVpZ2h0OjFweDsnIGNlbGxwYWRkaW5nPScwJyBjZWxsc3BhY2luZz0nMCc+PHRyPjx0ZD48L3RkPjwvdHI+PC90YWJsZT4iO2YuZXh0ZW5kKGIuc3R5bGUse3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdG9wOjAsbGVmdDowLG1hcmdpbjowLGJvcmRlcjowLHdpZHRoOiIxcHgiLGhlaWdodDoiMXB4Iix2aXNpYmlsaXR5OiJoaWRkZW4ifSksYi5pbm5lckhUTUw9aixhLmluc2VydEJlZm9yZShiLGEuZmlyc3RDaGlsZCksZD1iLmZpcnN0Q2hpbGQsZT1kLmZpcnN0Q2hpbGQsaD1kLm5leHRTaWJsaW5nLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZCx0aGlzLmRvZXNOb3RBZGRCb3JkZXI9ZS5vZmZzZXRUb3AhPT01LHRoaXMuZG9lc0FkZEJvcmRlckZvclRhYmxlQW5kQ2VsbHM9aC5vZmZzZXRUb3A9PT01LGUuc3R5bGUucG9zaXRpb249ImZpeGVkIixlLnN0eWxlLnRvcD0iMjBweCIsdGhpcy5zdXBwb3J0c0ZpeGVkUG9zaXRpb249ZS5vZmZzZXRUb3A9PT0yMHx8ZS5vZmZzZXRUb3A9PT0xNSxlLnN0eWxlLnBvc2l0aW9uPWUuc3R5bGUudG9wPSIiLGQuc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIsZC5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiLHRoaXMuc3VidHJhY3RzQm9yZGVyRm9yT3ZlcmZsb3dOb3RWaXNpYmxlPWUub2Zmc2V0VG9wPT09LTUsdGhpcy5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldD1hLm9mZnNldFRvcCE9PWksYS5yZW1vdmVDaGlsZChiKSxmLm9mZnNldC5pbml0aWFsaXplPWYubm9vcH0sYm9keU9mZnNldDpmdW5jdGlvbihhKXt2YXIgYj1hLm9mZnNldFRvcCxjPWEub2Zmc2V0TGVmdDtmLm9mZnNldC5pbml0aWFsaXplKCksZi5vZmZzZXQuZG9lc05vdEluY2x1ZGVNYXJnaW5JbkJvZHlPZmZzZXQmJihiKz1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpblRvcCIpKXx8MCxjKz1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpbkxlZnQiKSl8fDApO3JldHVybnt0b3A6YixsZWZ0OmN9fSxzZXRPZmZzZXQ6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWYuY3NzKGEsInBvc2l0aW9uIik7ZD09PSJzdGF0aWMiJiYoYS5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiKTt2YXIgZT1mKGEpLGc9ZS5vZmZzZXQoKSxoPWYuY3NzKGEsInRvcCIpLGk9Zi5jc3MoYSwibGVmdCIpLGo9KGQ9PT0iYWJzb2x1dGUifHxkPT09ImZpeGVkIikmJmYuaW5BcnJheSgiYXV0byIsW2gsaV0pPi0xLGs9e30sbD17fSxtLG47aj8obD1lLnBvc2l0aW9uKCksbT1sLnRvcCxuPWwubGVmdCk6KG09cGFyc2VGbG9hdChoKXx8MCxuPXBhcnNlRmxvYXQoaSl8fDApLGYuaXNGdW5jdGlvbihiKSYmKGI9Yi5jYWxsKGEsYyxnKSksYi50b3AhPW51bGwmJihrLnRvcD1iLnRvcC1nLnRvcCttKSxiLmxlZnQhPW51bGwmJihrLmxlZnQ9Yi5sZWZ0LWcubGVmdCtuKSwidXNpbmciaW4gYj9iLnVzaW5nLmNhbGwoYSxrKTplLmNzcyhrKX19LGYuZm4uZXh0ZW5kKHtwb3NpdGlvbjpmdW5jdGlvbigpe2lmKCF0aGlzWzBdKXJldHVybiBudWxsO3ZhciBhPXRoaXNbMF0sYj10aGlzLm9mZnNldFBhcmVudCgpLGM9dGhpcy5vZmZzZXQoKSxkPWN1LnRlc3QoYlswXS5ub2RlTmFtZSk/e3RvcDowLGxlZnQ6MH06Yi5vZmZzZXQoKTtjLnRvcC09cGFyc2VGbG9hdChmLmNzcyhhLCJtYXJnaW5Ub3AiKSl8fDAsYy5sZWZ0LT1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpbkxlZnQiKSl8fDAsZC50b3ArPXBhcnNlRmxvYXQoZi5jc3MoYlswXSwiYm9yZGVyVG9wV2lkdGgiKSl8fDAsZC5sZWZ0Kz1wYXJzZUZsb2F0KGYuY3NzKGJbMF0sImJvcmRlckxlZnRXaWR0aCIpKXx8MDtyZXR1cm57dG9wOmMudG9wLWQudG9wLGxlZnQ6Yy5sZWZ0LWQubGVmdH19LG9mZnNldFBhcmVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3ZhciBhPXRoaXMub2Zmc2V0UGFyZW50fHxjLmJvZHk7d2hpbGUoYSYmIWN1LnRlc3QoYS5ub2RlTmFtZSkmJmYuY3NzKGEsInBvc2l0aW9uIik9PT0ic3RhdGljIilhPWEub2Zmc2V0UGFyZW50O3JldHVybiBhfSl9fSksZi5lYWNoKFsiTGVmdCIsIlRvcCJdLGZ1bmN0aW9uKGEsYyl7dmFyIGQ9InNjcm9sbCIrYztmLmZuW2RdPWZ1bmN0aW9uKGMpe3ZhciBlLGc7aWYoYz09PWIpe2U9dGhpc1swXTtpZighZSlyZXR1cm4gbnVsbDtnPWN2KGUpO3JldHVybiBnPyJwYWdlWE9mZnNldCJpbiBnP2dbYT8icGFnZVlPZmZzZXQiOiJwYWdlWE9mZnNldCJdOmYuc3VwcG9ydC5ib3hNb2RlbCYmZy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbZF18fGcuZG9jdW1lbnQuYm9keVtkXTplW2RdfXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtnPWN2KHRoaXMpLGc/Zy5zY3JvbGxUbyhhP2YoZykuc2Nyb2xsTGVmdCgpOmMsYT9jOmYoZykuc2Nyb2xsVG9wKCkpOnRoaXNbZF09Y30pfX0pLGYuZWFjaChbIkhlaWdodCIsIldpZHRoIl0sZnVuY3Rpb24oYSxjKXt2YXIgZD1jLnRvTG93ZXJDYXNlKCk7Zi5mblsiaW5uZXIiK2NdPWZ1bmN0aW9uKCl7dmFyIGE9dGhpc1swXTtyZXR1cm4gYSYmYS5zdHlsZT9wYXJzZUZsb2F0KGYuY3NzKGEsZCwicGFkZGluZyIpKTpudWxsfSxmLmZuWyJvdXRlciIrY109ZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXTtyZXR1cm4gYiYmYi5zdHlsZT9wYXJzZUZsb2F0KGYuY3NzKGIsZCxhPyJtYXJnaW4iOiJib3JkZXIiKSk6bnVsbH0sZi5mbltkXT1mdW5jdGlvbihhKXt2YXIgZT10aGlzWzBdO2lmKCFlKXJldHVybiBhPT1udWxsP251bGw6dGhpcztpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXt2YXIgYz1mKHRoaXMpO2NbZF0oYS5jYWxsKHRoaXMsYixjW2RdKCkpKX0pO2lmKGYuaXNXaW5kb3coZSkpe3ZhciBnPWUuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50WyJjbGllbnQiK2NdO3JldHVybiBlLmRvY3VtZW50LmNvbXBhdE1vZGU9PT0iQ1NTMUNvbXBhdCImJmd8fGUuZG9jdW1lbnQuYm9keVsiY2xpZW50IitjXXx8Z31pZihlLm5vZGVUeXBlPT09OSlyZXR1cm4gTWF0aC5tYXgoZS5kb2N1bWVudEVsZW1lbnRbImNsaWVudCIrY10sZS5ib2R5WyJzY3JvbGwiK2NdLGUuZG9jdW1lbnRFbGVtZW50WyJzY3JvbGwiK2NdLGUuYm9keVsib2Zmc2V0IitjXSxlLmRvY3VtZW50RWxlbWVudFsib2Zmc2V0IitjXSk7aWYoYT09PWIpe3ZhciBoPWYuY3NzKGUsZCksaT1wYXJzZUZsb2F0KGgpO3JldHVybiBmLmlzTmFOKGkpP2g6aX1yZXR1cm4gdGhpcy5jc3MoZCx0eXBlb2YgYT09InN0cmluZyI/YTphKyJweCIpfX0pLGEualF1ZXJ5PWEuJD1mfSkod2luZG93KTs="
        },
        "static/js/jquery-1.5.2.min.js": {
            "content_type": "application/javascript",
            "data": "LyohCiAqIGpRdWVyeSBKYXZhU2NyaXB0IExpYnJhcnkgdjEuNS4yCiAqIGh0dHA6Ly9qcXVlcnkuY29tLwogKgogKiBDb3B5cmlnaHQgMjAxMSwgSm9obiBSZXNpZwogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBJbmNsdWRlcyBTaXp6bGUuanMKICogaHR0cDovL3NpenpsZWpzLmNvbS8KICogQ29weXJpZ2h0IDIwMTEsIFRoZSBEb2pvIEZvdW5kYXRpb24KICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCwgQlNELCBhbmQgR1BMIExpY2Vuc2VzLgogKgogKiBEYXRlOiBUaHUgTWFyIDMxIDE1OjI4OjIzIDIwMTEgLTA0MDAKICovCihmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGNpKGEpe3JldHVybiBkLmlzV2luZG93KGEpP2E6YS5ub2RlVHlwZT09PTk/YS5kZWZhdWx0Vmlld3x8YS5wYXJlbnRXaW5kb3c6ITF9ZnVuY3Rpb24gY2YoYSl7aWYoIWJfW2FdKXt2YXIgYj1kKCI8IithKyI+IikuYXBwZW5kVG8oImJvZHkiKSxjPWIuY3NzKCJkaXNwbGF5Iik7Yi5yZW1vdmUoKTtpZihjPT09Im5vbmUifHxjPT09IiIpYz0iYmxvY2siO2JfW2FdPWN9cmV0dXJuIGJfW2FdfWZ1bmN0aW9uIGNlKGEsYil7dmFyIGM9e307ZC5lYWNoKGNkLmNvbmNhdC5hcHBseShbXSxjZC5zbGljZSgwLGIpKSxmdW5jdGlvbigpe2NbdGhpc109YX0pO3JldHVybiBjfWZ1bmN0aW9uIGIkKCl7dHJ5e3JldHVybiBuZXcgYS5BY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpfWNhdGNoKGIpe319ZnVuY3Rpb24gYlooKXt0cnl7cmV0dXJuIG5ldyBhLlhNTEh0dHBSZXF1ZXN0fWNhdGNoKGIpe319ZnVuY3Rpb24gYlkoKXtkKGEpLnVubG9hZChmdW5jdGlvbigpe2Zvcih2YXIgYSBpbiBiVyliV1thXSgwLDEpfSl9ZnVuY3Rpb24gYlMoYSxjKXthLmRhdGFGaWx0ZXImJihjPWEuZGF0YUZpbHRlcihjLGEuZGF0YVR5cGUpKTt2YXIgZT1hLmRhdGFUeXBlcyxmPXt9LGcsaCxpPWUubGVuZ3RoLGosaz1lWzBdLGwsbSxuLG8scDtmb3IoZz0xO2c8aTtnKyspe2lmKGc9PT0xKWZvcihoIGluIGEuY29udmVydGVycyl0eXBlb2YgaD09PSJzdHJpbmciJiYoZltoLnRvTG93ZXJDYXNlKCldPWEuY29udmVydGVyc1toXSk7bD1rLGs9ZVtnXTtpZihrPT09IioiKWs9bDtlbHNlIGlmKGwhPT0iKiImJmwhPT1rKXttPWwrIiAiK2ssbj1mW21dfHxmWyIqICIra107aWYoIW4pe3A9Yjtmb3IobyBpbiBmKXtqPW8uc3BsaXQoIiAiKTtpZihqWzBdPT09bHx8alswXT09PSIqIil7cD1mW2pbMV0rIiAiK2tdO2lmKHApe289ZltvXSxvPT09ITA/bj1wOnA9PT0hMCYmKG49byk7YnJlYWt9fX19IW4mJiFwJiZkLmVycm9yKCJObyBjb252ZXJzaW9uIGZyb20gIittLnJlcGxhY2UoIiAiLCIgdG8gIikpLG4hPT0hMCYmKGM9bj9uKGMpOnAobyhjKSkpfX1yZXR1cm4gY31mdW5jdGlvbiBiUihhLGMsZCl7dmFyIGU9YS5jb250ZW50cyxmPWEuZGF0YVR5cGVzLGc9YS5yZXNwb25zZUZpZWxkcyxoLGksaixrO2ZvcihpIGluIGcpaSBpbiBkJiYoY1tnW2ldXT1kW2ldKTt3aGlsZShmWzBdPT09IioiKWYuc2hpZnQoKSxoPT09YiYmKGg9YS5taW1lVHlwZXx8Yy5nZXRSZXNwb25zZUhlYWRlcigiY29udGVudC10eXBlIikpO2lmKGgpZm9yKGkgaW4gZSlpZihlW2ldJiZlW2ldLnRlc3QoaCkpe2YudW5zaGlmdChpKTticmVha31pZihmWzBdaW4gZClqPWZbMF07ZWxzZXtmb3IoaSBpbiBkKXtpZighZlswXXx8YS5jb252ZXJ0ZXJzW2krIiAiK2ZbMF1dKXtqPWk7YnJlYWt9a3x8KGs9aSl9aj1qfHxrfWlmKGope2ohPT1mWzBdJiZmLnVuc2hpZnQoaik7cmV0dXJuIGRbal19fWZ1bmN0aW9uIGJRKGEsYixjLGUpe2lmKGQuaXNBcnJheShiKSYmYi5sZW5ndGgpZC5lYWNoKGIsZnVuY3Rpb24oYixmKXtjfHxicy50ZXN0KGEpP2UoYSxmKTpiUShhKyJbIisodHlwZW9mIGY9PT0ib2JqZWN0Inx8ZC5pc0FycmF5KGYpP2I6IiIpKyJdIixmLGMsZSl9KTtlbHNlIGlmKGN8fGI9PW51bGx8fHR5cGVvZiBiIT09Im9iamVjdCIpZShhLGIpO2Vsc2UgaWYoZC5pc0FycmF5KGIpfHxkLmlzRW1wdHlPYmplY3QoYikpZShhLCIiKTtlbHNlIGZvcih2YXIgZiBpbiBiKWJRKGErIlsiK2YrIl0iLGJbZl0sYyxlKX1mdW5jdGlvbiBiUChhLGMsZCxlLGYsZyl7Zj1mfHxjLmRhdGFUeXBlc1swXSxnPWd8fHt9LGdbZl09ITA7dmFyIGg9YVtmXSxpPTAsaj1oP2gubGVuZ3RoOjAsaz1hPT09YkosbDtmb3IoO2k8aiYmKGt8fCFsKTtpKyspbD1oW2ldKGMsZCxlKSx0eXBlb2YgbD09PSJzdHJpbmciJiYoIWt8fGdbbF0/bD1iOihjLmRhdGFUeXBlcy51bnNoaWZ0KGwpLGw9YlAoYSxjLGQsZSxsLGcpKSk7KGt8fCFsKSYmIWdbIioiXSYmKGw9YlAoYSxjLGQsZSwiKiIsZykpO3JldHVybiBsfWZ1bmN0aW9uIGJPKGEpe3JldHVybiBmdW5jdGlvbihiLGMpe3R5cGVvZiBiIT09InN0cmluZyImJihjPWIsYj0iKiIpO2lmKGQuaXNGdW5jdGlvbihjKSl7dmFyIGU9Yi50b0xvd2VyQ2FzZSgpLnNwbGl0KGJEKSxmPTAsZz1lLmxlbmd0aCxoLGksajtmb3IoO2Y8ZztmKyspaD1lW2ZdLGo9L15cKy8udGVzdChoKSxqJiYoaD1oLnN1YnN0cigxKXx8IioiKSxpPWFbaF09YVtoXXx8W10saVtqPyJ1bnNoaWZ0IjoicHVzaCJdKGMpfX19ZnVuY3Rpb24gYnEoYSxiLGMpe3ZhciBlPWI9PT0id2lkdGgiP2JrOmJsLGY9Yj09PSJ3aWR0aCI/YS5vZmZzZXRXaWR0aDphLm9mZnNldEhlaWdodDtpZihjPT09ImJvcmRlciIpcmV0dXJuIGY7ZC5lYWNoKGUsZnVuY3Rpb24oKXtjfHwoZi09cGFyc2VGbG9hdChkLmNzcyhhLCJwYWRkaW5nIit0aGlzKSl8fDApLGM9PT0ibWFyZ2luIj9mKz1wYXJzZUZsb2F0KGQuY3NzKGEsIm1hcmdpbiIrdGhpcykpfHwwOmYtPXBhcnNlRmxvYXQoZC5jc3MoYSwiYm9yZGVyIit0aGlzKyJXaWR0aCIpKXx8MH0pO3JldHVybiBmfWZ1bmN0aW9uIGJjKGEsYil7Yi5zcmM/ZC5hamF4KHt1cmw6Yi5zcmMsYXN5bmM6ITEsZGF0YVR5cGU6InNjcmlwdCJ9KTpkLmdsb2JhbEV2YWwoYi50ZXh0fHxiLnRleHRDb250ZW50fHxiLmlubmVySFRNTHx8IiIpLGIucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGIpfWZ1bmN0aW9uIGJiKGEpe3JldHVybiJnZXRFbGVtZW50c0J5VGFnTmFtZSJpbiBhP2EuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKToicXVlcnlTZWxlY3RvckFsbCJpbiBhP2EucXVlcnlTZWxlY3RvckFsbCgiKiIpOltdfWZ1bmN0aW9uIGJhKGEsYil7aWYoYi5ub2RlVHlwZT09PTEpe3ZhciBjPWIubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtiLmNsZWFyQXR0cmlidXRlcygpLGIubWVyZ2VBdHRyaWJ1dGVzKGEpO2lmKGM9PT0ib2JqZWN0IiliLm91dGVySFRNTD1hLm91dGVySFRNTDtlbHNlIGlmKGMhPT0iaW5wdXQifHxhLnR5cGUhPT0iY2hlY2tib3giJiZhLnR5cGUhPT0icmFkaW8iKXtpZihjPT09Im9wdGlvbiIpYi5zZWxlY3RlZD1hLmRlZmF1bHRTZWxlY3RlZDtlbHNlIGlmKGM9PT0iaW5wdXQifHxjPT09InRleHRhcmVhIiliLmRlZmF1bHRWYWx1ZT1hLmRlZmF1bHRWYWx1ZX1lbHNlIGEuY2hlY2tlZCYmKGIuZGVmYXVsdENoZWNrZWQ9Yi5jaGVja2VkPWEuY2hlY2tlZCksYi52YWx1ZSE9PWEudmFsdWUmJihiLnZhbHVlPWEudmFsdWUpO2IucmVtb3ZlQXR0cmlidXRlKGQuZXhwYW5kbyl9fWZ1bmN0aW9uIF8oYSxiKXtpZihiLm5vZGVUeXBlPT09MSYmZC5oYXNEYXRhKGEpKXt2YXIgYz1kLmV4cGFuZG8sZT1kLmRhdGEoYSksZj1kLmRhdGEoYixlKTtpZihlPWVbY10pe3ZhciBnPWUuZXZlbnRzO2Y9ZltjXT1kLmV4dGVuZCh7fSxlKTtpZihnKXtkZWxldGUgZi5oYW5kbGUsZi5ldmVudHM9e307Zm9yKHZhciBoIGluIGcpZm9yKHZhciBpPTAsaj1nW2hdLmxlbmd0aDtpPGo7aSsrKWQuZXZlbnQuYWRkKGIsaCsoZ1toXVtpXS5uYW1lc3BhY2U/Ii4iOiIiKStnW2hdW2ldLm5hbWVzcGFjZSxnW2hdW2ldLGdbaF1baV0uZGF0YSl9fX19ZnVuY3Rpb24gJChhLGIpe3JldHVybiBkLm5vZGVOYW1lKGEsInRhYmxlIik/YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGJvZHkiKVswXXx8YS5hcHBlbmRDaGlsZChhLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGJvZHkiKSk6YX1mdW5jdGlvbiBRKGEsYixjKXtpZihkLmlzRnVuY3Rpb24oYikpcmV0dXJuIGQuZ3JlcChhLGZ1bmN0aW9uKGEsZCl7dmFyIGU9ISFiLmNhbGwoYSxkLGEpO3JldHVybiBlPT09Y30pO2lmKGIubm9kZVR5cGUpcmV0dXJuIGQuZ3JlcChhLGZ1bmN0aW9uKGEsZCl7cmV0dXJuIGE9PT1iPT09Y30pO2lmKHR5cGVvZiBiPT09InN0cmluZyIpe3ZhciBlPWQuZ3JlcChhLGZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVUeXBlPT09MX0pO2lmKEwudGVzdChiKSlyZXR1cm4gZC5maWx0ZXIoYixlLCFjKTtiPWQuZmlsdGVyKGIsZSl9cmV0dXJuIGQuZ3JlcChhLGZ1bmN0aW9uKGEsZSl7cmV0dXJuIGQuaW5BcnJheShhLGIpPj0wPT09Y30pfWZ1bmN0aW9uIFAoYSl7cmV0dXJuIWF8fCFhLnBhcmVudE5vZGV8fGEucGFyZW50Tm9kZS5ub2RlVHlwZT09PTExfWZ1bmN0aW9uIEgoYSxiKXtyZXR1cm4oYSYmYSE9PSIqIj9hKyIuIjoiIikrYi5yZXBsYWNlKHQsImAiKS5yZXBsYWNlKHUsIiYiKX1mdW5jdGlvbiBHKGEpe3ZhciBiLGMsZSxmLGcsaCxpLGosayxsLG0sbixvLHA9W10scT1bXSxzPWQuX2RhdGEodGhpcywiZXZlbnRzIik7aWYoYS5saXZlRmlyZWQhPT10aGlzJiZzJiZzLmxpdmUmJiFhLnRhcmdldC5kaXNhYmxlZCYmKCFhLmJ1dHRvbnx8YS50eXBlIT09ImNsaWNrIikpe2EubmFtZXNwYWNlJiYobj1uZXcgUmVnRXhwKCIoXnxcXC4pIithLm5hbWVzcGFjZS5zcGxpdCgiLiIpLmpvaW4oIlxcLig/Oi4qXFwuKT8iKSsiKFxcLnwkKSIpKSxhLmxpdmVGaXJlZD10aGlzO3ZhciB0PXMubGl2ZS5zbGljZSgwKTtmb3IoaT0wO2k8dC5sZW5ndGg7aSsrKWc9dFtpXSxnLm9yaWdUeXBlLnJlcGxhY2UociwiIik9PT1hLnR5cGU/cS5wdXNoKGcuc2VsZWN0b3IpOnQuc3BsaWNlKGktLSwxKTtmPWQoYS50YXJnZXQpLmNsb3Nlc3QocSxhLmN1cnJlbnRUYXJnZXQpO2ZvcihqPTAsaz1mLmxlbmd0aDtqPGs7aisrKXttPWZbal07Zm9yKGk9MDtpPHQubGVuZ3RoO2krKyl7Zz10W2ldO2lmKG0uc2VsZWN0b3I9PT1nLnNlbGVjdG9yJiYoIW58fG4udGVzdChnLm5hbWVzcGFjZSkpJiYhbS5lbGVtLmRpc2FibGVkKXtoPW0uZWxlbSxlPW51bGw7aWYoZy5wcmVUeXBlPT09Im1vdXNlZW50ZXIifHxnLnByZVR5cGU9PT0ibW91c2VsZWF2ZSIpYS50eXBlPWcucHJlVHlwZSxlPWQoYS5yZWxhdGVkVGFyZ2V0KS5jbG9zZXN0KGcuc2VsZWN0b3IpWzBdOyghZXx8ZSE9PWgpJiZwLnB1c2goe2VsZW06aCxoYW5kbGVPYmo6ZyxsZXZlbDptLmxldmVsfSl9fX1mb3Ioaj0wLGs9cC5sZW5ndGg7ajxrO2orKyl7Zj1wW2pdO2lmKGMmJmYubGV2ZWw+YylicmVhazthLmN1cnJlbnRUYXJnZXQ9Zi5lbGVtLGEuZGF0YT1mLmhhbmRsZU9iai5kYXRhLGEuaGFuZGxlT2JqPWYuaGFuZGxlT2JqLG89Zi5oYW5kbGVPYmoub3JpZ0hhbmRsZXIuYXBwbHkoZi5lbGVtLGFyZ3VtZW50cyk7aWYobz09PSExfHxhLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpe2M9Zi5sZXZlbCxvPT09ITEmJihiPSExKTtpZihhLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkKCkpYnJlYWt9fXJldHVybiBifX1mdW5jdGlvbiBFKGEsYyxlKXt2YXIgZj1kLmV4dGVuZCh7fSxlWzBdKTtmLnR5cGU9YSxmLm9yaWdpbmFsRXZlbnQ9e30sZi5saXZlRmlyZWQ9YixkLmV2ZW50LmhhbmRsZS5jYWxsKGMsZiksZi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmZVswXS5wcmV2ZW50RGVmYXVsdCgpfWZ1bmN0aW9uIHkoKXtyZXR1cm4hMH1mdW5jdGlvbiB4KCl7cmV0dXJuITF9ZnVuY3Rpb24gaShhKXtmb3IodmFyIGIgaW4gYSlpZihiIT09InRvSlNPTiIpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gaChhLGMsZSl7aWYoZT09PWImJmEubm9kZVR5cGU9PT0xKXtlPWEuZ2V0QXR0cmlidXRlKCJkYXRhLSIrYyk7aWYodHlwZW9mIGU9PT0ic3RyaW5nIil7dHJ5e2U9ZT09PSJ0cnVlIj8hMDplPT09ImZhbHNlIj8hMTplPT09Im51bGwiP251bGw6ZC5pc05hTihlKT9nLnRlc3QoZSk/ZC5wYXJzZUpTT04oZSk6ZTpwYXJzZUZsb2F0KGUpfWNhdGNoKGYpe31kLmRhdGEoYSxjLGUpfWVsc2UgZT1ifXJldHVybiBlfXZhciBjPWEuZG9jdW1lbnQsZD1mdW5jdGlvbigpe2Z1bmN0aW9uIEcoKXtpZighZC5pc1JlYWR5KXt0cnl7Yy5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwoImxlZnQiKX1jYXRjaChhKXtzZXRUaW1lb3V0KEcsMSk7cmV0dXJufWQucmVhZHkoKX19dmFyIGQ9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IGQuZm4uaW5pdChhLGIsZyl9LGU9YS5qUXVlcnksZj1hLiQsZyxoPS9eKD86W148XSooPFtcd1xXXSs+KVtePl0qJHwjKFtcd1wtXSspJCkvLGk9L1xTLyxqPS9eXHMrLyxrPS9ccyskLyxsPS9cZC8sbT0vXjwoXHcrKVxzKlwvPz4oPzo8XC9cMT4pPyQvLG49L15bXF0sOnt9XHNdKiQvLG89L1xcKD86WyJcXFwvYmZucnRdfHVbMC05YS1mQS1GXXs0fSkvZyxwPS8iW14iXFxcblxyXSoifHRydWV8ZmFsc2V8bnVsbHwtP1xkKyg/OlwuXGQqKT8oPzpbZUVdWytcLV0/XGQrKT8vZyxxPS8oPzpefDp8LCkoPzpccypcWykrL2cscj0vKHdlYmtpdClbIFwvXShbXHcuXSspLyxzPS8ob3BlcmEpKD86Lip2ZXJzaW9uKT9bIFwvXShbXHcuXSspLyx0PS8obXNpZSkgKFtcdy5dKykvLHU9Lyhtb3ppbGxhKSg/Oi4qPyBydjooW1x3Ll0rKSk/Lyx2PW5hdmlnYXRvci51c2VyQWdlbnQsdyx4LHksej1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLEE9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxCPUFycmF5LnByb3RvdHlwZS5wdXNoLEM9QXJyYXkucHJvdG90eXBlLnNsaWNlLEQ9U3RyaW5nLnByb3RvdHlwZS50cmltLEU9QXJyYXkucHJvdG90eXBlLmluZGV4T2YsRj17fTtkLmZuPWQucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjpkLGluaXQ6ZnVuY3Rpb24oYSxlLGYpe3ZhciBnLGksaixrO2lmKCFhKXJldHVybiB0aGlzO2lmKGEubm9kZVR5cGUpe3RoaXMuY29udGV4dD10aGlzWzBdPWEsdGhpcy5sZW5ndGg9MTtyZXR1cm4gdGhpc31pZihhPT09ImJvZHkiJiYhZSYmYy5ib2R5KXt0aGlzLmNvbnRleHQ9Yyx0aGlzWzBdPWMuYm9keSx0aGlzLnNlbGVjdG9yPSJib2R5Iix0aGlzLmxlbmd0aD0xO3JldHVybiB0aGlzfWlmKHR5cGVvZiBhPT09InN0cmluZyIpe2c9aC5leGVjKGEpO2lmKCFnfHwhZ1sxXSYmZSlyZXR1cm4hZXx8ZS5qcXVlcnk/KGV8fGYpLmZpbmQoYSk6dGhpcy5jb25zdHJ1Y3RvcihlKS5maW5kKGEpO2lmKGdbMV0pe2U9ZSBpbnN0YW5jZW9mIGQ/ZVswXTplLGs9ZT9lLm93bmVyRG9jdW1lbnR8fGU6YyxqPW0uZXhlYyhhKSxqP2QuaXNQbGFpbk9iamVjdChlKT8oYT1bYy5jcmVhdGVFbGVtZW50KGpbMV0pXSxkLmZuLmF0dHIuY2FsbChhLGUsITApKTphPVtrLmNyZWF0ZUVsZW1lbnQoalsxXSldOihqPWQuYnVpbGRGcmFnbWVudChbZ1sxXV0sW2tdKSxhPShqLmNhY2hlYWJsZT9kLmNsb25lKGouZnJhZ21lbnQpOmouZnJhZ21lbnQpLmNoaWxkTm9kZXMpO3JldHVybiBkLm1lcmdlKHRoaXMsYSl9aT1jLmdldEVsZW1lbnRCeUlkKGdbMl0pO2lmKGkmJmkucGFyZW50Tm9kZSl7aWYoaS5pZCE9PWdbMl0pcmV0dXJuIGYuZmluZChhKTt0aGlzLmxlbmd0aD0xLHRoaXNbMF09aX10aGlzLmNvbnRleHQ9Yyx0aGlzLnNlbGVjdG9yPWE7cmV0dXJuIHRoaXN9aWYoZC5pc0Z1bmN0aW9uKGEpKXJldHVybiBmLnJlYWR5KGEpO2Euc2VsZWN0b3IhPT1iJiYodGhpcy5zZWxlY3Rvcj1hLnNlbGVjdG9yLHRoaXMuY29udGV4dD1hLmNvbnRleHQpO3JldHVybiBkLm1ha2VBcnJheShhLHRoaXMpfSxzZWxlY3RvcjoiIixqcXVlcnk6IjEuNS4yIixsZW5ndGg6MCxzaXplOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubGVuZ3RofSx0b0FycmF5OmZ1bmN0aW9uKCl7cmV0dXJuIEMuY2FsbCh0aGlzLDApfSxnZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/dGhpcy50b0FycmF5KCk6YTwwP3RoaXNbdGhpcy5sZW5ndGgrYV06dGhpc1thXX0scHVzaFN0YWNrOmZ1bmN0aW9uKGEsYixjKXt2YXIgZT10aGlzLmNvbnN0cnVjdG9yKCk7ZC5pc0FycmF5KGEpP0IuYXBwbHkoZSxhKTpkLm1lcmdlKGUsYSksZS5wcmV2T2JqZWN0PXRoaXMsZS5jb250ZXh0PXRoaXMuY29udGV4dCxiPT09ImZpbmQiP2Uuc2VsZWN0b3I9dGhpcy5zZWxlY3RvcisodGhpcy5zZWxlY3Rvcj8iICI6IiIpK2M6YiYmKGUuc2VsZWN0b3I9dGhpcy5zZWxlY3RvcisiLiIrYisiKCIrYysiKSIpO3JldHVybiBlfSxlYWNoOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGQuZWFjaCh0aGlzLGEsYil9LHJlYWR5OmZ1bmN0aW9uKGEpe2QuYmluZFJlYWR5KCkseC5kb25lKGEpO3JldHVybiB0aGlzfSxlcTpmdW5jdGlvbihhKXtyZXR1cm4gYT09PS0xP3RoaXMuc2xpY2UoYSk6dGhpcy5zbGljZShhLCthKzEpfSxmaXJzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKDApfSxsYXN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZXEoLTEpfSxzbGljZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLnB1c2hTdGFjayhDLmFwcGx5KHRoaXMsYXJndW1lbnRzKSwic2xpY2UiLEMuY2FsbChhcmd1bWVudHMpLmpvaW4oIiwiKSl9LG1hcDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2soZC5tYXAodGhpcyxmdW5jdGlvbihiLGMpe3JldHVybiBhLmNhbGwoYixjLGIpfSkpfSxlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wcmV2T2JqZWN0fHx0aGlzLmNvbnN0cnVjdG9yKG51bGwpfSxwdXNoOkIsc29ydDpbXS5zb3J0LHNwbGljZTpbXS5zcGxpY2V9LGQuZm4uaW5pdC5wcm90b3R5cGU9ZC5mbixkLmV4dGVuZD1kLmZuLmV4dGVuZD1mdW5jdGlvbigpe3ZhciBhLGMsZSxmLGcsaCxpPWFyZ3VtZW50c1swXXx8e30saj0xLGs9YXJndW1lbnRzLmxlbmd0aCxsPSExO3R5cGVvZiBpPT09ImJvb2xlYW4iJiYobD1pLGk9YXJndW1lbnRzWzFdfHx7fSxqPTIpLHR5cGVvZiBpIT09Im9iamVjdCImJiFkLmlzRnVuY3Rpb24oaSkmJihpPXt9KSxrPT09aiYmKGk9dGhpcywtLWopO2Zvcig7ajxrO2orKylpZigoYT1hcmd1bWVudHNbal0pIT1udWxsKWZvcihjIGluIGEpe2U9aVtjXSxmPWFbY107aWYoaT09PWYpY29udGludWU7bCYmZiYmKGQuaXNQbGFpbk9iamVjdChmKXx8KGc9ZC5pc0FycmF5KGYpKSk/KGc/KGc9ITEsaD1lJiZkLmlzQXJyYXkoZSk/ZTpbXSk6aD1lJiZkLmlzUGxhaW5PYmplY3QoZSk/ZTp7fSxpW2NdPWQuZXh0ZW5kKGwsaCxmKSk6ZiE9PWImJihpW2NdPWYpfXJldHVybiBpfSxkLmV4dGVuZCh7bm9Db25mbGljdDpmdW5jdGlvbihiKXthLiQ9ZixiJiYoYS5qUXVlcnk9ZSk7cmV0dXJuIGR9LGlzUmVhZHk6ITEscmVhZHlXYWl0OjEscmVhZHk6ZnVuY3Rpb24oYSl7YT09PSEwJiZkLnJlYWR5V2FpdC0tO2lmKCFkLnJlYWR5V2FpdHx8YSE9PSEwJiYhZC5pc1JlYWR5KXtpZighYy5ib2R5KXJldHVybiBzZXRUaW1lb3V0KGQucmVhZHksMSk7ZC5pc1JlYWR5PSEwO2lmKGEhPT0hMCYmLS1kLnJlYWR5V2FpdD4wKXJldHVybjt4LnJlc29sdmVXaXRoKGMsW2RdKSxkLmZuLnRyaWdnZXImJmQoYykudHJpZ2dlcigicmVhZHkiKS51bmJpbmQoInJlYWR5Iil9fSxiaW5kUmVhZHk6ZnVuY3Rpb24oKXtpZigheCl7eD1kLl9EZWZlcnJlZCgpO2lmKGMucmVhZHlTdGF0ZT09PSJjb21wbGV0ZSIpcmV0dXJuIHNldFRpbWVvdXQoZC5yZWFkeSwxKTtpZihjLmFkZEV2ZW50TGlzdGVuZXIpYy5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIix5LCExKSxhLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLGQucmVhZHksITEpO2Vsc2UgaWYoYy5hdHRhY2hFdmVudCl7Yy5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIix5KSxhLmF0dGFjaEV2ZW50KCJvbmxvYWQiLGQucmVhZHkpO3ZhciBiPSExO3RyeXtiPWEuZnJhbWVFbGVtZW50PT1udWxsfWNhdGNoKGUpe31jLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCYmYiYmRygpfX19LGlzRnVuY3Rpb246ZnVuY3Rpb24oYSl7cmV0dXJuIGQudHlwZShhKT09PSJmdW5jdGlvbiJ9LGlzQXJyYXk6QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oYSl7cmV0dXJuIGQudHlwZShhKT09PSJhcnJheSJ9LGlzV2luZG93OmZ1bmN0aW9uKGEpe3JldHVybiBhJiZ0eXBlb2YgYT09PSJvYmplY3QiJiYic2V0SW50ZXJ2YWwiaW4gYX0saXNOYU46ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGx8fCFsLnRlc3QoYSl8fGlzTmFOKGEpfSx0eXBlOmZ1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsP1N0cmluZyhhKTpGW3ouY2FsbChhKV18fCJvYmplY3QifSxpc1BsYWluT2JqZWN0OmZ1bmN0aW9uKGEpe2lmKCFhfHxkLnR5cGUoYSkhPT0ib2JqZWN0Inx8YS5ub2RlVHlwZXx8ZC5pc1dpbmRvdyhhKSlyZXR1cm4hMTtpZihhLmNvbnN0cnVjdG9yJiYhQS5jYWxsKGEsImNvbnN0cnVjdG9yIikmJiFBLmNhbGwoYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsImlzUHJvdG90eXBlT2YiKSlyZXR1cm4hMTt2YXIgYztmb3IoYyBpbiBhKXt9cmV0dXJuIGM9PT1ifHxBLmNhbGwoYSxjKX0saXNFbXB0eU9iamVjdDpmdW5jdGlvbihhKXtmb3IodmFyIGIgaW4gYSlyZXR1cm4hMTtyZXR1cm4hMH0sZXJyb3I6ZnVuY3Rpb24oYSl7dGhyb3cgYX0scGFyc2VKU09OOmZ1bmN0aW9uKGIpe2lmKHR5cGVvZiBiIT09InN0cmluZyJ8fCFiKXJldHVybiBudWxsO2I9ZC50cmltKGIpO2lmKG4udGVzdChiLnJlcGxhY2UobywiQCIpLnJlcGxhY2UocCwiXSIpLnJlcGxhY2UocSwiIikpKXJldHVybiBhLkpTT04mJmEuSlNPTi5wYXJzZT9hLkpTT04ucGFyc2UoYik6KG5ldyBGdW5jdGlvbigicmV0dXJuICIrYikpKCk7ZC5lcnJvcigiSW52YWxpZCBKU09OOiAiK2IpfSxwYXJzZVhNTDpmdW5jdGlvbihiLGMsZSl7YS5ET01QYXJzZXI/KGU9bmV3IERPTVBhcnNlcixjPWUucGFyc2VGcm9tU3RyaW5nKGIsInRleHQveG1sIikpOihjPW5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MRE9NIiksYy5hc3luYz0iZmFsc2UiLGMubG9hZFhNTChiKSksZT1jLmRvY3VtZW50RWxlbWVudCwoIWV8fCFlLm5vZGVOYW1lfHxlLm5vZGVOYW1lPT09InBhcnNlcmVycm9yIikmJmQuZXJyb3IoIkludmFsaWQgWE1MOiAiK2IpO3JldHVybiBjfSxub29wOmZ1bmN0aW9uKCl7fSxnbG9iYWxFdmFsOmZ1bmN0aW9uKGEpe2lmKGEmJmkudGVzdChhKSl7dmFyIGI9Yy5oZWFkfHxjLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF18fGMuZG9jdW1lbnRFbGVtZW50LGU9Yy5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTtkLnN1cHBvcnQuc2NyaXB0RXZhbCgpP2UuYXBwZW5kQ2hpbGQoYy5jcmVhdGVUZXh0Tm9kZShhKSk6ZS50ZXh0PWEsYi5pbnNlcnRCZWZvcmUoZSxiLmZpcnN0Q2hpbGQpLGIucmVtb3ZlQ2hpbGQoZSl9fSxub2RlTmFtZTpmdW5jdGlvbihhLGIpe3JldHVybiBhLm5vZGVOYW1lJiZhLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk9PT1iLnRvVXBwZXJDYXNlKCl9LGVhY2g6ZnVuY3Rpb24oYSxjLGUpe3ZhciBmLGc9MCxoPWEubGVuZ3RoLGk9aD09PWJ8fGQuaXNGdW5jdGlvbihhKTtpZihlKXtpZihpKXtmb3IoZiBpbiBhKWlmKGMuYXBwbHkoYVtmXSxlKT09PSExKWJyZWFrfWVsc2UgZm9yKDtnPGg7KWlmKGMuYXBwbHkoYVtnKytdLGUpPT09ITEpYnJlYWt9ZWxzZSBpZihpKXtmb3IoZiBpbiBhKWlmKGMuY2FsbChhW2ZdLGYsYVtmXSk9PT0hMSlicmVha31lbHNlIGZvcih2YXIgaj1hWzBdO2c8aCYmYy5jYWxsKGosZyxqKSE9PSExO2o9YVsrK2ddKXt9cmV0dXJuIGF9LHRyaW06RD9mdW5jdGlvbihhKXtyZXR1cm4gYT09bnVsbD8iIjpELmNhbGwoYSl9OmZ1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsPyIiOihhKyIiKS5yZXBsYWNlKGosIiIpLnJlcGxhY2UoaywiIil9LG1ha2VBcnJheTpmdW5jdGlvbihhLGIpe3ZhciBjPWJ8fFtdO2lmKGEhPW51bGwpe3ZhciBlPWQudHlwZShhKTthLmxlbmd0aD09bnVsbHx8ZT09PSJzdHJpbmcifHxlPT09ImZ1bmN0aW9uInx8ZT09PSJyZWdleHAifHxkLmlzV2luZG93KGEpP0IuY2FsbChjLGEpOmQubWVyZ2UoYyxhKX1yZXR1cm4gY30saW5BcnJheTpmdW5jdGlvbihhLGIpe2lmKGIuaW5kZXhPZilyZXR1cm4gYi5pbmRleE9mKGEpO2Zvcih2YXIgYz0wLGQ9Yi5sZW5ndGg7YzxkO2MrKylpZihiW2NdPT09YSlyZXR1cm4gYztyZXR1cm4tMX0sbWVyZ2U6ZnVuY3Rpb24oYSxjKXt2YXIgZD1hLmxlbmd0aCxlPTA7aWYodHlwZW9mIGMubGVuZ3RoPT09Im51bWJlciIpZm9yKHZhciBmPWMubGVuZ3RoO2U8ZjtlKyspYVtkKytdPWNbZV07ZWxzZSB3aGlsZShjW2VdIT09YilhW2QrK109Y1tlKytdO2EubGVuZ3RoPWQ7cmV0dXJuIGF9LGdyZXA6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPVtdLGU7Yz0hIWM7Zm9yKHZhciBmPTAsZz1hLmxlbmd0aDtmPGc7ZisrKWU9ISFiKGFbZl0sZiksYyE9PWUmJmQucHVzaChhW2ZdKTtyZXR1cm4gZH0sbWFwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD1bXSxlO2Zvcih2YXIgZj0wLGc9YS5sZW5ndGg7ZjxnO2YrKyllPWIoYVtmXSxmLGMpLGUhPW51bGwmJihkW2QubGVuZ3RoXT1lKTtyZXR1cm4gZC5jb25jYXQuYXBwbHkoW10sZCl9LGd1aWQ6MSxwcm94eTpmdW5jdGlvbihhLGMsZSl7YXJndW1lbnRzLmxlbmd0aD09PTImJih0eXBlb2YgYz09PSJzdHJpbmciPyhlPWEsYT1lW2NdLGM9Yik6YyYmIWQuaXNGdW5jdGlvbihjKSYmKGU9YyxjPWIpKSwhYyYmYSYmKGM9ZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShlfHx0aGlzLGFyZ3VtZW50cyl9KSxhJiYoYy5ndWlkPWEuZ3VpZD1hLmd1aWR8fGMuZ3VpZHx8ZC5ndWlkKyspO3JldHVybiBjfSxhY2Nlc3M6ZnVuY3Rpb24oYSxjLGUsZixnLGgpe3ZhciBpPWEubGVuZ3RoO2lmKHR5cGVvZiBjPT09Im9iamVjdCIpe2Zvcih2YXIgaiBpbiBjKWQuYWNjZXNzKGEsaixjW2pdLGYsZyxlKTtyZXR1cm4gYX1pZihlIT09Yil7Zj0haCYmZiYmZC5pc0Z1bmN0aW9uKGUpO2Zvcih2YXIgaz0wO2s8aTtrKyspZyhhW2tdLGMsZj9lLmNhbGwoYVtrXSxrLGcoYVtrXSxjKSk6ZSxoKTtyZXR1cm4gYX1yZXR1cm4gaT9nKGFbMF0sYyk6Yn0sbm93OmZ1bmN0aW9uKCl7cmV0dXJuKG5ldyBEYXRlKS5nZXRUaW1lKCl9LHVhTWF0Y2g6ZnVuY3Rpb24oYSl7YT1hLnRvTG93ZXJDYXNlKCk7dmFyIGI9ci5leGVjKGEpfHxzLmV4ZWMoYSl8fHQuZXhlYyhhKXx8YS5pbmRleE9mKCJjb21wYXRpYmxlIik8MCYmdS5leGVjKGEpfHxbXTtyZXR1cm57YnJvd3NlcjpiWzFdfHwiIix2ZXJzaW9uOmJbMl18fCIwIn19LHN1YjpmdW5jdGlvbigpe2Z1bmN0aW9uIGEoYixjKXtyZXR1cm4gbmV3IGEuZm4uaW5pdChiLGMpfWQuZXh0ZW5kKCEwLGEsdGhpcyksYS5zdXBlcmNsYXNzPXRoaXMsYS5mbj1hLnByb3RvdHlwZT10aGlzKCksYS5mbi5jb25zdHJ1Y3Rvcj1hLGEuc3ViY2xhc3M9dGhpcy5zdWJjbGFzcyxhLmZuLmluaXQ9ZnVuY3Rpb24gYihiLGMpe2MmJmMgaW5zdGFuY2VvZiBkJiYhKGMgaW5zdGFuY2VvZiBhKSYmKGM9YShjKSk7cmV0dXJuIGQuZm4uaW5pdC5jYWxsKHRoaXMsYixjLGUpfSxhLmZuLmluaXQucHJvdG90eXBlPWEuZm47dmFyIGU9YShjKTtyZXR1cm4gYX0sYnJvd3Nlcjp7fX0pLGQuZWFjaCgiQm9vbGVhbiBOdW1iZXIgU3RyaW5nIEZ1bmN0aW9uIEFycmF5IERhdGUgUmVnRXhwIE9iamVjdCIuc3BsaXQoIiAiKSxmdW5jdGlvbihhLGIpe0ZbIltvYmplY3QgIitiKyJdIl09Yi50b0xvd2VyQ2FzZSgpfSksdz1kLnVhTWF0Y2godiksdy5icm93c2VyJiYoZC5icm93c2VyW3cuYnJvd3Nlcl09ITAsZC5icm93c2VyLnZlcnNpb249dy52ZXJzaW9uKSxkLmJyb3dzZXIud2Via2l0JiYoZC5icm93c2VyLnNhZmFyaT0hMCksRSYmKGQuaW5BcnJheT1mdW5jdGlvbihhLGIpe3JldHVybiBFLmNhbGwoYixhKX0pLGkudGVzdCgiwqAiKSYmKGo9L15bXHNceEEwXSsvLGs9L1tcc1x4QTBdKyQvKSxnPWQoYyksYy5hZGRFdmVudExpc3RlbmVyP3k9ZnVuY3Rpb24oKXtjLnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLHksITEpLGQucmVhZHkoKX06Yy5hdHRhY2hFdmVudCYmKHk9ZnVuY3Rpb24oKXtjLnJlYWR5U3RhdGU9PT0iY29tcGxldGUiJiYoYy5kZXRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIix5KSxkLnJlYWR5KCkpfSk7cmV0dXJuIGR9KCksZT0idGhlbiBkb25lIGZhaWwgaXNSZXNvbHZlZCBpc1JlamVjdGVkIHByb21pc2UiLnNwbGl0KCIgIiksZj1bXS5zbGljZTtkLmV4dGVuZCh7X0RlZmVycmVkOmZ1bmN0aW9uKCl7dmFyIGE9W10sYixjLGUsZj17ZG9uZTpmdW5jdGlvbigpe2lmKCFlKXt2YXIgYz1hcmd1bWVudHMsZyxoLGksaixrO2ImJihrPWIsYj0wKTtmb3IoZz0wLGg9Yy5sZW5ndGg7ZzxoO2crKylpPWNbZ10saj1kLnR5cGUoaSksaj09PSJhcnJheSI/Zi5kb25lLmFwcGx5KGYsaSk6aj09PSJmdW5jdGlvbiImJmEucHVzaChpKTtrJiZmLnJlc29sdmVXaXRoKGtbMF0sa1sxXSl9cmV0dXJuIHRoaXN9LHJlc29sdmVXaXRoOmZ1bmN0aW9uKGQsZil7aWYoIWUmJiFiJiYhYyl7Zj1mfHxbXSxjPTE7dHJ5e3doaWxlKGFbMF0pYS5zaGlmdCgpLmFwcGx5KGQsZil9ZmluYWxseXtiPVtkLGZdLGM9MH19cmV0dXJuIHRoaXN9LHJlc29sdmU6ZnVuY3Rpb24oKXtmLnJlc29sdmVXaXRoKHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gdGhpc30saXNSZXNvbHZlZDpmdW5jdGlvbigpe3JldHVybiBjfHxifSxjYW5jZWw6ZnVuY3Rpb24oKXtlPTEsYT1bXTtyZXR1cm4gdGhpc319O3JldHVybiBmfSxEZWZlcnJlZDpmdW5jdGlvbihhKXt2YXIgYj1kLl9EZWZlcnJlZCgpLGM9ZC5fRGVmZXJyZWQoKSxmO2QuZXh0ZW5kKGIse3RoZW46ZnVuY3Rpb24oYSxjKXtiLmRvbmUoYSkuZmFpbChjKTtyZXR1cm4gdGhpc30sZmFpbDpjLmRvbmUscmVqZWN0V2l0aDpjLnJlc29sdmVXaXRoLHJlamVjdDpjLnJlc29sdmUsaXNSZWplY3RlZDpjLmlzUmVzb2x2ZWQscHJvbWlzZTpmdW5jdGlvbihhKXtpZihhPT1udWxsKXtpZihmKXJldHVybiBmO2Y9YT17fX12YXIgYz1lLmxlbmd0aDt3aGlsZShjLS0pYVtlW2NdXT1iW2VbY11dO3JldHVybiBhfX0pLGIuZG9uZShjLmNhbmNlbCkuZmFpbChiLmNhbmNlbCksZGVsZXRlIGIuY2FuY2VsLGEmJmEuY2FsbChiLGIpO3JldHVybiBifSx3aGVuOmZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGkoYSl7cmV0dXJuIGZ1bmN0aW9uKGMpe2JbYV09YXJndW1lbnRzLmxlbmd0aD4xP2YuY2FsbChhcmd1bWVudHMsMCk6YywtLWd8fGgucmVzb2x2ZVdpdGgoaCxmLmNhbGwoYiwwKSl9fXZhciBiPWFyZ3VtZW50cyxjPTAsZT1iLmxlbmd0aCxnPWUsaD1lPD0xJiZhJiZkLmlzRnVuY3Rpb24oYS5wcm9taXNlKT9hOmQuRGVmZXJyZWQoKTtpZihlPjEpe2Zvcig7YzxlO2MrKyliW2NdJiZkLmlzRnVuY3Rpb24oYltjXS5wcm9taXNlKT9iW2NdLnByb21pc2UoKS50aGVuKGkoYyksaC5yZWplY3QpOi0tZztnfHxoLnJlc29sdmVXaXRoKGgsYil9ZWxzZSBoIT09YSYmaC5yZXNvbHZlV2l0aChoLGU/W2FdOltdKTtyZXR1cm4gaC5wcm9taXNlKCl9fSksZnVuY3Rpb24oKXtkLnN1cHBvcnQ9e307dmFyIGI9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKTtiLnN0eWxlLmRpc3BsYXk9Im5vbmUiLGIuaW5uZXJIVE1MPSIgICA8bGluay8+PHRhYmxlPjwvdGFibGU+PGEgaHJlZj0nL2EnIHN0eWxlPSdjb2xvcjpyZWQ7ZmxvYXQ6bGVmdDtvcGFjaXR5Oi41NTsnPmE8L2E+PGlucHV0IHR5cGU9J2NoZWNrYm94Jy8+Ijt2YXIgZT1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIiksZj1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJhIilbMF0sZz1jLmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpLGg9Zy5hcHBlbmRDaGlsZChjLmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpKSxpPWIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlucHV0IilbMF07aWYoZSYmZS5sZW5ndGgmJmYpe2Quc3VwcG9ydD17bGVhZGluZ1doaXRlc3BhY2U6Yi5maXJzdENoaWxkLm5vZGVUeXBlPT09Myx0Ym9keTohYi5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGJvZHkiKS5sZW5ndGgsaHRtbFNlcmlhbGl6ZTohIWIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImxpbmsiKS5sZW5ndGgsc3R5bGU6L3JlZC8udGVzdChmLmdldEF0dHJpYnV0ZSgic3R5bGUiKSksaHJlZk5vcm1hbGl6ZWQ6Zi5nZXRBdHRyaWJ1dGUoImhyZWYiKT09PSIvYSIsb3BhY2l0eTovXjAuNTUkLy50ZXN0KGYuc3R5bGUub3BhY2l0eSksY3NzRmxvYXQ6ISFmLnN0eWxlLmNzc0Zsb2F0LGNoZWNrT246aS52YWx1ZT09PSJvbiIsb3B0U2VsZWN0ZWQ6aC5zZWxlY3RlZCxkZWxldGVFeHBhbmRvOiEwLG9wdERpc2FibGVkOiExLGNoZWNrQ2xvbmU6ITEsbm9DbG9uZUV2ZW50OiEwLG5vQ2xvbmVDaGVja2VkOiEwLGJveE1vZGVsOm51bGwsaW5saW5lQmxvY2tOZWVkc0xheW91dDohMSxzaHJpbmtXcmFwQmxvY2tzOiExLHJlbGlhYmxlSGlkZGVuT2Zmc2V0czohMCxyZWxpYWJsZU1hcmdpblJpZ2h0OiEwfSxpLmNoZWNrZWQ9ITAsZC5zdXBwb3J0Lm5vQ2xvbmVDaGVja2VkPWkuY2xvbmVOb2RlKCEwKS5jaGVja2VkLGcuZGlzYWJsZWQ9ITAsZC5zdXBwb3J0Lm9wdERpc2FibGVkPSFoLmRpc2FibGVkO3ZhciBqPW51bGw7ZC5zdXBwb3J0LnNjcmlwdEV2YWw9ZnVuY3Rpb24oKXtpZihqPT09bnVsbCl7dmFyIGI9Yy5kb2N1bWVudEVsZW1lbnQsZT1jLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpLGY9InNjcmlwdCIrZC5ub3coKTt0cnl7ZS5hcHBlbmRDaGlsZChjLmNyZWF0ZVRleHROb2RlKCJ3aW5kb3cuIitmKyI9MTsiKSl9Y2F0Y2goZyl7fWIuaW5zZXJ0QmVmb3JlKGUsYi5maXJzdENoaWxkKSxhW2ZdPyhqPSEwLGRlbGV0ZSBhW2ZdKTpqPSExLGIucmVtb3ZlQ2hpbGQoZSl9cmV0dXJuIGp9O3RyeXtkZWxldGUgYi50ZXN0fWNhdGNoKGspe2Quc3VwcG9ydC5kZWxldGVFeHBhbmRvPSExfSFiLmFkZEV2ZW50TGlzdGVuZXImJmIuYXR0YWNoRXZlbnQmJmIuZmlyZUV2ZW50JiYoYi5hdHRhY2hFdmVudCgib25jbGljayIsZnVuY3Rpb24gbCgpe2Quc3VwcG9ydC5ub0Nsb25lRXZlbnQ9ITEsYi5kZXRhY2hFdmVudCgib25jbGljayIsbCl9KSxiLmNsb25lTm9kZSghMCkuZmlyZUV2ZW50KCJvbmNsaWNrIikpLGI9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKSxiLmlubmVySFRNTD0iPGlucHV0IHR5cGU9J3JhZGlvJyBuYW1lPSdyYWRpb3Rlc3QnIGNoZWNrZWQ9J2NoZWNrZWQnLz4iO3ZhciBtPWMuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO20uYXBwZW5kQ2hpbGQoYi5maXJzdENoaWxkKSxkLnN1cHBvcnQuY2hlY2tDbG9uZT1tLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCxkKGZ1bmN0aW9uKCl7dmFyIGE9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKSxiPWMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTtpZihiKXthLnN0eWxlLndpZHRoPWEuc3R5bGUucGFkZGluZ0xlZnQ9IjFweCIsYi5hcHBlbmRDaGlsZChhKSxkLmJveE1vZGVsPWQuc3VwcG9ydC5ib3hNb2RlbD1hLm9mZnNldFdpZHRoPT09Miwiem9vbSJpbiBhLnN0eWxlJiYoYS5zdHlsZS5kaXNwbGF5PSJpbmxpbmUiLGEuc3R5bGUuem9vbT0xLGQuc3VwcG9ydC5pbmxpbmVCbG9ja05lZWRzTGF5b3V0PWEub2Zmc2V0V2lkdGg9PT0yLGEuc3R5bGUuZGlzcGxheT0iIixhLmlubmVySFRNTD0iPGRpdiBzdHlsZT0nd2lkdGg6NHB4Oyc+PC9kaXY+IixkLnN1cHBvcnQuc2hyaW5rV3JhcEJsb2Nrcz1hLm9mZnNldFdpZHRoIT09MiksYS5pbm5lckhUTUw9Ijx0YWJsZT48dHI+PHRkIHN0eWxlPSdwYWRkaW5nOjA7Ym9yZGVyOjA7ZGlzcGxheTpub25lJz48L3RkPjx0ZD50PC90ZD48L3RyPjwvdGFibGU+Ijt2YXIgZT1hLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ZCIpO2Quc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHM9ZVswXS5vZmZzZXRIZWlnaHQ9PT0wLGVbMF0uc3R5bGUuZGlzcGxheT0iIixlWzFdLnN0eWxlLmRpc3BsYXk9Im5vbmUiLGQuc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHM9ZC5zdXBwb3J0LnJlbGlhYmxlSGlkZGVuT2Zmc2V0cyYmZVswXS5vZmZzZXRIZWlnaHQ9PT0wLGEuaW5uZXJIVE1MPSIiLGMuZGVmYXVsdFZpZXcmJmMuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSYmKGEuc3R5bGUud2lkdGg9IjFweCIsYS5zdHlsZS5tYXJnaW5SaWdodD0iMCIsZC5zdXBwb3J0LnJlbGlhYmxlTWFyZ2luUmlnaHQ9KHBhcnNlSW50KGMuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShhLG51bGwpLm1hcmdpblJpZ2h0LDEwKXx8MCk9PT0wKSxiLnJlbW92ZUNoaWxkKGEpLnN0eWxlLmRpc3BsYXk9Im5vbmUiLGE9ZT1udWxsfX0pO3ZhciBuPWZ1bmN0aW9uKGEpe3ZhciBiPWMuY3JlYXRlRWxlbWVudCgiZGl2Iik7YT0ib24iK2E7aWYoIWIuYXR0YWNoRXZlbnQpcmV0dXJuITA7dmFyIGQ9YSBpbiBiO2R8fChiLnNldEF0dHJpYnV0ZShhLCJyZXR1cm47IiksZD10eXBlb2YgYlthXT09PSJmdW5jdGlvbiIpO3JldHVybiBkfTtkLnN1cHBvcnQuc3VibWl0QnViYmxlcz1uKCJzdWJtaXQiKSxkLnN1cHBvcnQuY2hhbmdlQnViYmxlcz1uKCJjaGFuZ2UiKSxiPWU9Zj1udWxsfX0oKTt2YXIgZz0vXig/Olx7LipcfXxcWy4qXF0pJC87ZC5leHRlbmQoe2NhY2hlOnt9LHV1aWQ6MCxleHBhbmRvOiJqUXVlcnkiKyhkLmZuLmpxdWVyeStNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKC9cRC9nLCIiKSxub0RhdGE6e2VtYmVkOiEwLG9iamVjdDoiY2xzaWQ6RDI3Q0RCNkUtQUU2RC0xMWNmLTk2QjgtNDQ0NTUzNTQwMDAwIixhcHBsZXQ6ITB9LGhhc0RhdGE6ZnVuY3Rpb24oYSl7YT1hLm5vZGVUeXBlP2QuY2FjaGVbYVtkLmV4cGFuZG9dXTphW2QuZXhwYW5kb107cmV0dXJuISFhJiYhaShhKX0sZGF0YTpmdW5jdGlvbihhLGMsZSxmKXtpZihkLmFjY2VwdERhdGEoYSkpe3ZhciBnPWQuZXhwYW5kbyxoPXR5cGVvZiBjPT09InN0cmluZyIsaSxqPWEubm9kZVR5cGUsaz1qP2QuY2FjaGU6YSxsPWo/YVtkLmV4cGFuZG9dOmFbZC5leHBhbmRvXSYmZC5leHBhbmRvO2lmKCghbHx8ZiYmbCYmIWtbbF1bZ10pJiZoJiZlPT09YilyZXR1cm47bHx8KGo/YVtkLmV4cGFuZG9dPWw9KytkLnV1aWQ6bD1kLmV4cGFuZG8pLGtbbF18fChrW2xdPXt9LGp8fChrW2xdLnRvSlNPTj1kLm5vb3ApKTtpZih0eXBlb2YgYz09PSJvYmplY3QifHx0eXBlb2YgYz09PSJmdW5jdGlvbiIpZj9rW2xdW2ddPWQuZXh0ZW5kKGtbbF1bZ10sYyk6a1tsXT1kLmV4dGVuZChrW2xdLGMpO2k9a1tsXSxmJiYoaVtnXXx8KGlbZ109e30pLGk9aVtnXSksZSE9PWImJihpW2NdPWUpO2lmKGM9PT0iZXZlbnRzIiYmIWlbY10pcmV0dXJuIGlbZ10mJmlbZ10uZXZlbnRzO3JldHVybiBoP2lbY106aX19LHJlbW92ZURhdGE6ZnVuY3Rpb24oYixjLGUpe2lmKGQuYWNjZXB0RGF0YShiKSl7dmFyIGY9ZC5leHBhbmRvLGc9Yi5ub2RlVHlwZSxoPWc/ZC5jYWNoZTpiLGo9Zz9iW2QuZXhwYW5kb106ZC5leHBhbmRvO2lmKCFoW2pdKXJldHVybjtpZihjKXt2YXIgaz1lP2hbal1bZl06aFtqXTtpZihrKXtkZWxldGUga1tjXTtpZighaShrKSlyZXR1cm59fWlmKGUpe2RlbGV0ZSBoW2pdW2ZdO2lmKCFpKGhbal0pKXJldHVybn12YXIgbD1oW2pdW2ZdO2Quc3VwcG9ydC5kZWxldGVFeHBhbmRvfHxoIT1hP2RlbGV0ZSBoW2pdOmhbal09bnVsbCxsPyhoW2pdPXt9LGd8fChoW2pdLnRvSlNPTj1kLm5vb3ApLGhbal1bZl09bCk6ZyYmKGQuc3VwcG9ydC5kZWxldGVFeHBhbmRvP2RlbGV0ZSBiW2QuZXhwYW5kb106Yi5yZW1vdmVBdHRyaWJ1dGU/Yi5yZW1vdmVBdHRyaWJ1dGUoZC5leHBhbmRvKTpiW2QuZXhwYW5kb109bnVsbCl9fSxfZGF0YTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGQuZGF0YShhLGIsYywhMCl9LGFjY2VwdERhdGE6ZnVuY3Rpb24oYSl7aWYoYS5ub2RlTmFtZSl7dmFyIGI9ZC5ub0RhdGFbYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXTtpZihiKXJldHVybiBiIT09ITAmJmEuZ2V0QXR0cmlidXRlKCJjbGFzc2lkIik9PT1ifXJldHVybiEwfX0pLGQuZm4uZXh0ZW5kKHtkYXRhOmZ1bmN0aW9uKGEsYyl7dmFyIGU9bnVsbDtpZih0eXBlb2YgYT09PSJ1bmRlZmluZWQiKXtpZih0aGlzLmxlbmd0aCl7ZT1kLmRhdGEodGhpc1swXSk7aWYodGhpc1swXS5ub2RlVHlwZT09PTEpe3ZhciBmPXRoaXNbMF0uYXR0cmlidXRlcyxnO2Zvcih2YXIgaT0wLGo9Zi5sZW5ndGg7aTxqO2krKylnPWZbaV0ubmFtZSxnLmluZGV4T2YoImRhdGEtIik9PT0wJiYoZz1nLnN1YnN0cig1KSxoKHRoaXNbMF0sZyxlW2ddKSl9fXJldHVybiBlfWlmKHR5cGVvZiBhPT09Im9iamVjdCIpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2QuZGF0YSh0aGlzLGEpfSk7dmFyIGs9YS5zcGxpdCgiLiIpO2tbMV09a1sxXT8iLiIra1sxXToiIjtpZihjPT09Yil7ZT10aGlzLnRyaWdnZXJIYW5kbGVyKCJnZXREYXRhIitrWzFdKyIhIixba1swXV0pLGU9PT1iJiZ0aGlzLmxlbmd0aCYmKGU9ZC5kYXRhKHRoaXNbMF0sYSksZT1oKHRoaXNbMF0sYSxlKSk7cmV0dXJuIGU9PT1iJiZrWzFdP3RoaXMuZGF0YShrWzBdKTplfXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1kKHRoaXMpLGU9W2tbMF0sY107Yi50cmlnZ2VySGFuZGxlcigic2V0RGF0YSIra1sxXSsiISIsZSksZC5kYXRhKHRoaXMsYSxjKSxiLnRyaWdnZXJIYW5kbGVyKCJjaGFuZ2VEYXRhIitrWzFdKyIhIixlKX0pfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtkLnJlbW92ZURhdGEodGhpcyxhKX0pfX0pLGQuZXh0ZW5kKHtxdWV1ZTpmdW5jdGlvbihhLGIsYyl7aWYoYSl7Yj0oYnx8ImZ4IikrInF1ZXVlIjt2YXIgZT1kLl9kYXRhKGEsYik7aWYoIWMpcmV0dXJuIGV8fFtdOyFlfHxkLmlzQXJyYXkoYyk/ZT1kLl9kYXRhKGEsYixkLm1ha2VBcnJheShjKSk6ZS5wdXNoKGMpO3JldHVybiBlfX0sZGVxdWV1ZTpmdW5jdGlvbihhLGIpe2I9Ynx8ImZ4Ijt2YXIgYz1kLnF1ZXVlKGEsYiksZT1jLnNoaWZ0KCk7ZT09PSJpbnByb2dyZXNzIiYmKGU9Yy5zaGlmdCgpKSxlJiYoYj09PSJmeCImJmMudW5zaGlmdCgiaW5wcm9ncmVzcyIpLGUuY2FsbChhLGZ1bmN0aW9uKCl7ZC5kZXF1ZXVlKGEsYil9KSksYy5sZW5ndGh8fGQucmVtb3ZlRGF0YShhLGIrInF1ZXVlIiwhMCl9fSksZC5mbi5leHRlbmQoe3F1ZXVlOmZ1bmN0aW9uKGEsYyl7dHlwZW9mIGEhPT0ic3RyaW5nIiYmKGM9YSxhPSJmeCIpO2lmKGM9PT1iKXJldHVybiBkLnF1ZXVlKHRoaXNbMF0sYSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXt2YXIgZT1kLnF1ZXVlKHRoaXMsYSxjKTthPT09ImZ4IiYmZVswXSE9PSJpbnByb2dyZXNzIiYmZC5kZXF1ZXVlKHRoaXMsYSl9KX0sZGVxdWV1ZTpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7ZC5kZXF1ZXVlKHRoaXMsYSl9KX0sZGVsYXk6ZnVuY3Rpb24oYSxiKXthPWQuZng/ZC5meC5zcGVlZHNbYV18fGE6YSxiPWJ8fCJmeCI7cmV0dXJuIHRoaXMucXVldWUoYixmdW5jdGlvbigpe3ZhciBjPXRoaXM7c2V0VGltZW91dChmdW5jdGlvbigpe2QuZGVxdWV1ZShjLGIpfSxhKX0pfSxjbGVhclF1ZXVlOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGF8fCJmeCIsW10pfX0pO3ZhciBqPS9bXG5cdFxyXS9nLGs9L1xzKy8sbD0vXHIvZyxtPS9eKD86aHJlZnxzcmN8c3R5bGUpJC8sbj0vXig/OmJ1dHRvbnxpbnB1dCkkL2ksbz0vXig/OmJ1dHRvbnxpbnB1dHxvYmplY3R8c2VsZWN0fHRleHRhcmVhKSQvaSxwPS9eYSg/OnJlYSk/JC9pLHE9L14oPzpyYWRpb3xjaGVja2JveCkkL2k7ZC5wcm9wcz17ImZvciI6Imh0bWxGb3IiLCJjbGFzcyI6ImNsYXNzTmFtZSIscmVhZG9ubHk6InJlYWRPbmx5IixtYXhsZW5ndGg6Im1heExlbmd0aCIsY2VsbHNwYWNpbmc6ImNlbGxTcGFjaW5nIixyb3dzcGFuOiJyb3dTcGFuIixjb2xzcGFuOiJjb2xTcGFuIix0YWJpbmRleDoidGFiSW5kZXgiLHVzZW1hcDoidXNlTWFwIixmcmFtZWJvcmRlcjoiZnJhbWVCb3JkZXIifSxkLmZuLmV4dGVuZCh7YXR0cjpmdW5jdGlvbihhLGIpe3JldHVybiBkLmFjY2Vzcyh0aGlzLGEsYiwhMCxkLmF0dHIpfSxyZW1vdmVBdHRyOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2QuYXR0cih0aGlzLGEsIiIpLHRoaXMubm9kZVR5cGU9PT0xJiZ0aGlzLnJlbW92ZUF0dHJpYnV0ZShhKX0pfSxhZGRDbGFzczpmdW5jdGlvbihhKXtpZihkLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXt2YXIgYz1kKHRoaXMpO2MuYWRkQ2xhc3MoYS5jYWxsKHRoaXMsYixjLmF0dHIoImNsYXNzIikpKX0pO2lmKGEmJnR5cGVvZiBhPT09InN0cmluZyIpe3ZhciBiPShhfHwiIikuc3BsaXQoayk7Zm9yKHZhciBjPTAsZT10aGlzLmxlbmd0aDtjPGU7YysrKXt2YXIgZj10aGlzW2NdO2lmKGYubm9kZVR5cGU9PT0xKWlmKGYuY2xhc3NOYW1lKXt2YXIgZz0iICIrZi5jbGFzc05hbWUrIiAiLGg9Zi5jbGFzc05hbWU7Zm9yKHZhciBpPTAsaj1iLmxlbmd0aDtpPGo7aSsrKWcuaW5kZXhPZigiICIrYltpXSsiICIpPDAmJihoKz0iICIrYltpXSk7Zi5jbGFzc05hbWU9ZC50cmltKGgpfWVsc2UgZi5jbGFzc05hbWU9YX19cmV0dXJuIHRoaXN9LHJlbW92ZUNsYXNzOmZ1bmN0aW9uKGEpe2lmKGQuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWQodGhpcyk7Yy5yZW1vdmVDbGFzcyhhLmNhbGwodGhpcyxiLGMuYXR0cigiY2xhc3MiKSkpfSk7aWYoYSYmdHlwZW9mIGE9PT0ic3RyaW5nInx8YT09PWIpe3ZhciBjPShhfHwiIikuc3BsaXQoayk7Zm9yKHZhciBlPTAsZj10aGlzLmxlbmd0aDtlPGY7ZSsrKXt2YXIgZz10aGlzW2VdO2lmKGcubm9kZVR5cGU9PT0xJiZnLmNsYXNzTmFtZSlpZihhKXt2YXIgaD0oIiAiK2cuY2xhc3NOYW1lKyIgIikucmVwbGFjZShqLCIgIik7Zm9yKHZhciBpPTAsbD1jLmxlbmd0aDtpPGw7aSsrKWg9aC5yZXBsYWNlKCIgIitjW2ldKyIgIiwiICIpO2cuY2xhc3NOYW1lPWQudHJpbShoKX1lbHNlIGcuY2xhc3NOYW1lPSIifX1yZXR1cm4gdGhpc30sdG9nZ2xlQ2xhc3M6ZnVuY3Rpb24oYSxiKXt2YXIgYz10eXBlb2YgYSxlPXR5cGVvZiBiPT09ImJvb2xlYW4iO2lmKGQuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGMpe3ZhciBlPWQodGhpcyk7ZS50b2dnbGVDbGFzcyhhLmNhbGwodGhpcyxjLGUuYXR0cigiY2xhc3MiKSxiKSxiKX0pO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZihjPT09InN0cmluZyIpe3ZhciBmLGc9MCxoPWQodGhpcyksaT1iLGo9YS5zcGxpdChrKTt3aGlsZShmPWpbZysrXSlpPWU/aTohaC5oYXNDbGFzcyhmKSxoW2k/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXShmKX1lbHNlIGlmKGM9PT0idW5kZWZpbmVkInx8Yz09PSJib29sZWFuIil0aGlzLmNsYXNzTmFtZSYmZC5fZGF0YSh0aGlzLCJfX2NsYXNzTmFtZV9fIix0aGlzLmNsYXNzTmFtZSksdGhpcy5jbGFzc05hbWU9dGhpcy5jbGFzc05hbWV8fGE9PT0hMT8iIjpkLl9kYXRhKHRoaXMsIl9fY2xhc3NOYW1lX18iKXx8IiJ9KX0saGFzQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGI9IiAiK2ErIiAiO2Zvcih2YXIgYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKylpZigoIiAiK3RoaXNbY10uY2xhc3NOYW1lKyIgIikucmVwbGFjZShqLCIgIikuaW5kZXhPZihiKT4tMSlyZXR1cm4hMDtyZXR1cm4hMX0sdmFsOmZ1bmN0aW9uKGEpe2lmKCFhcmd1bWVudHMubGVuZ3RoKXt2YXIgYz10aGlzWzBdO2lmKGMpe2lmKGQubm9kZU5hbWUoYywib3B0aW9uIikpe3ZhciBlPWMuYXR0cmlidXRlcy52YWx1ZTtyZXR1cm4hZXx8ZS5zcGVjaWZpZWQ/Yy52YWx1ZTpjLnRleHR9aWYoZC5ub2RlTmFtZShjLCJzZWxlY3QiKSl7dmFyIGY9Yy5zZWxlY3RlZEluZGV4LGc9W10saD1jLm9wdGlvbnMsaT1jLnR5cGU9PT0ic2VsZWN0LW9uZSI7aWYoZjwwKXJldHVybiBudWxsO2Zvcih2YXIgaj1pP2Y6MCxrPWk/ZisxOmgubGVuZ3RoO2o8aztqKyspe3ZhciBtPWhbal07aWYobS5zZWxlY3RlZCYmKGQuc3VwcG9ydC5vcHREaXNhYmxlZD8hbS5kaXNhYmxlZDptLmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKT09PW51bGwpJiYoIW0ucGFyZW50Tm9kZS5kaXNhYmxlZHx8IWQubm9kZU5hbWUobS5wYXJlbnROb2RlLCJvcHRncm91cCIpKSl7YT1kKG0pLnZhbCgpO2lmKGkpcmV0dXJuIGE7Zy5wdXNoKGEpfX1pZihpJiYhZy5sZW5ndGgmJmgubGVuZ3RoKXJldHVybiBkKGhbZl0pLnZhbCgpO3JldHVybiBnfWlmKHEudGVzdChjLnR5cGUpJiYhZC5zdXBwb3J0LmNoZWNrT24pcmV0dXJuIGMuZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpPT09bnVsbD8ib24iOmMudmFsdWU7cmV0dXJuKGMudmFsdWV8fCIiKS5yZXBsYWNlKGwsIiIpfXJldHVybiBifXZhciBuPWQuaXNGdW5jdGlvbihhKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWQodGhpcyksZT1hO2lmKHRoaXMubm9kZVR5cGU9PT0xKXtuJiYoZT1hLmNhbGwodGhpcyxiLGMudmFsKCkpKSxlPT1udWxsP2U9IiI6dHlwZW9mIGU9PT0ibnVtYmVyIj9lKz0iIjpkLmlzQXJyYXkoZSkmJihlPWQubWFwKGUsZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/IiI6YSsiIn0pKTtpZihkLmlzQXJyYXkoZSkmJnEudGVzdCh0aGlzLnR5cGUpKXRoaXMuY2hlY2tlZD1kLmluQXJyYXkoYy52YWwoKSxlKT49MDtlbHNlIGlmKGQubm9kZU5hbWUodGhpcywic2VsZWN0Iikpe3ZhciBmPWQubWFrZUFycmF5KGUpO2QoIm9wdGlvbiIsdGhpcykuZWFjaChmdW5jdGlvbigpe3RoaXMuc2VsZWN0ZWQ9ZC5pbkFycmF5KGQodGhpcykudmFsKCksZik+PTB9KSxmLmxlbmd0aHx8KHRoaXMuc2VsZWN0ZWRJbmRleD0tMSl9ZWxzZSB0aGlzLnZhbHVlPWV9fSl9fSksZC5leHRlbmQoe2F0dHJGbjp7dmFsOiEwLGNzczohMCxodG1sOiEwLHRleHQ6ITAsZGF0YTohMCx3aWR0aDohMCxoZWlnaHQ6ITAsb2Zmc2V0OiEwfSxhdHRyOmZ1bmN0aW9uKGEsYyxlLGYpe2lmKCFhfHxhLm5vZGVUeXBlPT09M3x8YS5ub2RlVHlwZT09PTh8fGEubm9kZVR5cGU9PT0yKXJldHVybiBiO2lmKGYmJmMgaW4gZC5hdHRyRm4pcmV0dXJuIGQoYSlbY10oZSk7dmFyIGc9YS5ub2RlVHlwZSE9PTF8fCFkLmlzWE1MRG9jKGEpLGg9ZSE9PWI7Yz1nJiZkLnByb3BzW2NdfHxjO2lmKGEubm9kZVR5cGU9PT0xKXt2YXIgaT1tLnRlc3QoYyk7aWYoYz09PSJzZWxlY3RlZCImJiFkLnN1cHBvcnQub3B0U2VsZWN0ZWQpe3ZhciBqPWEucGFyZW50Tm9kZTtqJiYoai5zZWxlY3RlZEluZGV4LGoucGFyZW50Tm9kZSYmai5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgpfWlmKChjIGluIGF8fGFbY10hPT1iKSYmZyYmIWkpe2gmJihjPT09InR5cGUiJiZuLnRlc3QoYS5ub2RlTmFtZSkmJmEucGFyZW50Tm9kZSYmZC5lcnJvcigidHlwZSBwcm9wZXJ0eSBjYW4ndCBiZSBjaGFuZ2VkIiksZT09PW51bGw/YS5ub2RlVHlwZT09PTEmJmEucmVtb3ZlQXR0cmlidXRlKGMpOmFbY109ZSk7aWYoZC5ub2RlTmFtZShhLCJmb3JtIikmJmEuZ2V0QXR0cmlidXRlTm9kZShjKSlyZXR1cm4gYS5nZXRBdHRyaWJ1dGVOb2RlKGMpLm5vZGVWYWx1ZTtpZihjPT09InRhYkluZGV4Iil7dmFyIGs9YS5nZXRBdHRyaWJ1dGVOb2RlKCJ0YWJJbmRleCIpO3JldHVybiBrJiZrLnNwZWNpZmllZD9rLnZhbHVlOm8udGVzdChhLm5vZGVOYW1lKXx8cC50ZXN0KGEubm9kZU5hbWUpJiZhLmhyZWY/MDpifXJldHVybiBhW2NdfWlmKCFkLnN1cHBvcnQuc3R5bGUmJmcmJmM9PT0ic3R5bGUiKXtoJiYoYS5zdHlsZS5jc3NUZXh0PSIiK2UpO3JldHVybiBhLnN0eWxlLmNzc1RleHR9aCYmYS5zZXRBdHRyaWJ1dGUoYywiIitlKTtpZighYS5hdHRyaWJ1dGVzW2NdJiYoYS5oYXNBdHRyaWJ1dGUmJiFhLmhhc0F0dHJpYnV0ZShjKSkpcmV0dXJuIGI7dmFyIGw9IWQuc3VwcG9ydC5ocmVmTm9ybWFsaXplZCYmZyYmaT9hLmdldEF0dHJpYnV0ZShjLDIpOmEuZ2V0QXR0cmlidXRlKGMpO3JldHVybiBsPT09bnVsbD9iOmx9aCYmKGFbY109ZSk7cmV0dXJuIGFbY119fSk7dmFyIHI9L1wuKC4qKSQvLHM9L14oPzp0ZXh0YXJlYXxpbnB1dHxzZWxlY3QpJC9pLHQ9L1wuL2csdT0vIC9nLHY9L1teXHdccy58YF0vZyx3PWZ1bmN0aW9uKGEpe3JldHVybiBhLnJlcGxhY2UodiwiXFwkJiIpfTtkLmV2ZW50PXthZGQ6ZnVuY3Rpb24oYyxlLGYsZyl7aWYoYy5ub2RlVHlwZSE9PTMmJmMubm9kZVR5cGUhPT04KXt0cnl7ZC5pc1dpbmRvdyhjKSYmKGMhPT1hJiYhYy5mcmFtZUVsZW1lbnQpJiYoYz1hKX1jYXRjaChoKXt9aWYoZj09PSExKWY9eDtlbHNlIGlmKCFmKXJldHVybjt2YXIgaSxqO2YuaGFuZGxlciYmKGk9ZixmPWkuaGFuZGxlciksZi5ndWlkfHwoZi5ndWlkPWQuZ3VpZCsrKTt2YXIgaz1kLl9kYXRhKGMpO2lmKCFrKXJldHVybjt2YXIgbD1rLmV2ZW50cyxtPWsuaGFuZGxlO2x8fChrLmV2ZW50cz1sPXt9KSxtfHwoay5oYW5kbGU9bT1mdW5jdGlvbihhKXtyZXR1cm4gdHlwZW9mIGQhPT0idW5kZWZpbmVkIiYmZC5ldmVudC50cmlnZ2VyZWQhPT1hLnR5cGU/ZC5ldmVudC5oYW5kbGUuYXBwbHkobS5lbGVtLGFyZ3VtZW50cyk6Yn0pLG0uZWxlbT1jLGU9ZS5zcGxpdCgiICIpO3ZhciBuLG89MCxwO3doaWxlKG49ZVtvKytdKXtqPWk/ZC5leHRlbmQoe30saSk6e2hhbmRsZXI6ZixkYXRhOmd9LG4uaW5kZXhPZigiLiIpPi0xPyhwPW4uc3BsaXQoIi4iKSxuPXAuc2hpZnQoKSxqLm5hbWVzcGFjZT1wLnNsaWNlKDApLnNvcnQoKS5qb2luKCIuIikpOihwPVtdLGoubmFtZXNwYWNlPSIiKSxqLnR5cGU9bixqLmd1aWR8fChqLmd1aWQ9Zi5ndWlkKTt2YXIgcT1sW25dLHI9ZC5ldmVudC5zcGVjaWFsW25dfHx7fTtpZighcSl7cT1sW25dPVtdO2lmKCFyLnNldHVwfHxyLnNldHVwLmNhbGwoYyxnLHAsbSk9PT0hMSljLmFkZEV2ZW50TGlzdGVuZXI/Yy5hZGRFdmVudExpc3RlbmVyKG4sbSwhMSk6Yy5hdHRhY2hFdmVudCYmYy5hdHRhY2hFdmVudCgib24iK24sbSl9ci5hZGQmJihyLmFkZC5jYWxsKGMsaiksai5oYW5kbGVyLmd1aWR8fChqLmhhbmRsZXIuZ3VpZD1mLmd1aWQpKSxxLnB1c2goaiksZC5ldmVudC5nbG9iYWxbbl09ITB9Yz1udWxsfX0sZ2xvYmFsOnt9LHJlbW92ZTpmdW5jdGlvbihhLGMsZSxmKXtpZihhLm5vZGVUeXBlIT09MyYmYS5ub2RlVHlwZSE9PTgpe2U9PT0hMSYmKGU9eCk7dmFyIGcsaCxpLGosaz0wLGwsbSxuLG8scCxxLHIscz1kLmhhc0RhdGEoYSkmJmQuX2RhdGEoYSksdD1zJiZzLmV2ZW50cztpZighc3x8IXQpcmV0dXJuO2MmJmMudHlwZSYmKGU9Yy5oYW5kbGVyLGM9Yy50eXBlKTtpZighY3x8dHlwZW9mIGM9PT0ic3RyaW5nIiYmYy5jaGFyQXQoMCk9PT0iLiIpe2M9Y3x8IiI7Zm9yKGggaW4gdClkLmV2ZW50LnJlbW92ZShhLGgrYyk7cmV0dXJufWM9Yy5zcGxpdCgiICIpO3doaWxlKGg9Y1trKytdKXtyPWgscT1udWxsLGw9aC5pbmRleE9mKCIuIik8MCxtPVtdLGx8fChtPWguc3BsaXQoIi4iKSxoPW0uc2hpZnQoKSxuPW5ldyBSZWdFeHAoIihefFxcLikiK2QubWFwKG0uc2xpY2UoMCkuc29ydCgpLHcpLmpvaW4oIlxcLig/Oi4qXFwuKT8iKSsiKFxcLnwkKSIpKSxwPXRbaF07aWYoIXApY29udGludWU7aWYoIWUpe2ZvcihqPTA7ajxwLmxlbmd0aDtqKyspe3E9cFtqXTtpZihsfHxuLnRlc3QocS5uYW1lc3BhY2UpKWQuZXZlbnQucmVtb3ZlKGEscixxLmhhbmRsZXIsaikscC5zcGxpY2Uoai0tLDEpfWNvbnRpbnVlfW89ZC5ldmVudC5zcGVjaWFsW2hdfHx7fTtmb3Ioaj1mfHwwO2o8cC5sZW5ndGg7aisrKXtxPXBbal07aWYoZS5ndWlkPT09cS5ndWlkKXtpZihsfHxuLnRlc3QocS5uYW1lc3BhY2UpKWY9PW51bGwmJnAuc3BsaWNlKGotLSwxKSxvLnJlbW92ZSYmby5yZW1vdmUuY2FsbChhLHEpO2lmKGYhPW51bGwpYnJlYWt9fWlmKHAubGVuZ3RoPT09MHx8ZiE9bnVsbCYmcC5sZW5ndGg9PT0xKSghby50ZWFyZG93bnx8by50ZWFyZG93bi5jYWxsKGEsbSk9PT0hMSkmJmQucmVtb3ZlRXZlbnQoYSxoLHMuaGFuZGxlKSxnPW51bGwsZGVsZXRlIHRbaF19aWYoZC5pc0VtcHR5T2JqZWN0KHQpKXt2YXIgdT1zLmhhbmRsZTt1JiYodS5lbGVtPW51bGwpLGRlbGV0ZSBzLmV2ZW50cyxkZWxldGUgcy5oYW5kbGUsZC5pc0VtcHR5T2JqZWN0KHMpJiZkLnJlbW92ZURhdGEoYSxiLCEwKX19fSx0cmlnZ2VyOmZ1bmN0aW9uKGEsYyxlKXt2YXIgZj1hLnR5cGV8fGEsZz1hcmd1bWVudHNbM107aWYoIWcpe2E9dHlwZW9mIGE9PT0ib2JqZWN0Ij9hW2QuZXhwYW5kb10/YTpkLmV4dGVuZChkLkV2ZW50KGYpLGEpOmQuRXZlbnQoZiksZi5pbmRleE9mKCIhIik+PTAmJihhLnR5cGU9Zj1mLnNsaWNlKDAsLTEpLGEuZXhjbHVzaXZlPSEwKSxlfHwoYS5zdG9wUHJvcGFnYXRpb24oKSxkLmV2ZW50Lmdsb2JhbFtmXSYmZC5lYWNoKGQuY2FjaGUsZnVuY3Rpb24oKXt2YXIgYj1kLmV4cGFuZG8sZT10aGlzW2JdO2UmJmUuZXZlbnRzJiZlLmV2ZW50c1tmXSYmZC5ldmVudC50cmlnZ2VyKGEsYyxlLmhhbmRsZS5lbGVtKX0pKTtpZighZXx8ZS5ub2RlVHlwZT09PTN8fGUubm9kZVR5cGU9PT04KXJldHVybiBiO2EucmVzdWx0PWIsYS50YXJnZXQ9ZSxjPWQubWFrZUFycmF5KGMpLGMudW5zaGlmdChhKX1hLmN1cnJlbnRUYXJnZXQ9ZTt2YXIgaD1kLl9kYXRhKGUsImhhbmRsZSIpO2gmJmguYXBwbHkoZSxjKTt2YXIgaT1lLnBhcmVudE5vZGV8fGUub3duZXJEb2N1bWVudDt0cnl7ZSYmZS5ub2RlTmFtZSYmZC5ub0RhdGFbZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXXx8ZVsib24iK2ZdJiZlWyJvbiIrZl0uYXBwbHkoZSxjKT09PSExJiYoYS5yZXN1bHQ9ITEsYS5wcmV2ZW50RGVmYXVsdCgpKX1jYXRjaChqKXt9aWYoIWEuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSYmaSlkLmV2ZW50LnRyaWdnZXIoYSxjLGksITApO2Vsc2UgaWYoIWEuaXNEZWZhdWx0UHJldmVudGVkKCkpe3ZhciBrLGw9YS50YXJnZXQsbT1mLnJlcGxhY2UociwiIiksbj1kLm5vZGVOYW1lKGwsImEiKSYmbT09PSJjbGljayIsbz1kLmV2ZW50LnNwZWNpYWxbbV18fHt9O2lmKCghby5fZGVmYXVsdHx8by5fZGVmYXVsdC5jYWxsKGUsYSk9PT0hMSkmJiFuJiYhKGwmJmwubm9kZU5hbWUmJmQubm9EYXRhW2wubm9kZU5hbWUudG9Mb3dlckNhc2UoKV0pKXt0cnl7bFttXSYmKGs9bFsib24iK21dLGsmJihsWyJvbiIrbV09bnVsbCksZC5ldmVudC50cmlnZ2VyZWQ9YS50eXBlLGxbbV0oKSl9Y2F0Y2gocCl7fWsmJihsWyJvbiIrbV09ayksZC5ldmVudC50cmlnZ2VyZWQ9Yn19fSxoYW5kbGU6ZnVuY3Rpb24oYyl7dmFyIGUsZixnLGgsaSxqPVtdLGs9ZC5tYWtlQXJyYXkoYXJndW1lbnRzKTtjPWtbMF09ZC5ldmVudC5maXgoY3x8YS5ldmVudCksYy5jdXJyZW50VGFyZ2V0PXRoaXMsZT1jLnR5cGUuaW5kZXhPZigiLiIpPDAmJiFjLmV4Y2x1c2l2ZSxlfHwoZz1jLnR5cGUuc3BsaXQoIi4iKSxjLnR5cGU9Zy5zaGlmdCgpLGo9Zy5zbGljZSgwKS5zb3J0KCksaD1uZXcgUmVnRXhwKCIoXnxcXC4pIitqLmpvaW4oIlxcLig/Oi4qXFwuKT8iKSsiKFxcLnwkKSIpKSxjLm5hbWVzcGFjZT1jLm5hbWVzcGFjZXx8ai5qb2luKCIuIiksaT1kLl9kYXRhKHRoaXMsImV2ZW50cyIpLGY9KGl8fHt9KVtjLnR5cGVdO2lmKGkmJmYpe2Y9Zi5zbGljZSgwKTtmb3IodmFyIGw9MCxtPWYubGVuZ3RoO2w8bTtsKyspe3ZhciBuPWZbbF07aWYoZXx8aC50ZXN0KG4ubmFtZXNwYWNlKSl7Yy5oYW5kbGVyPW4uaGFuZGxlcixjLmRhdGE9bi5kYXRhLGMuaGFuZGxlT2JqPW47dmFyIG89bi5oYW5kbGVyLmFwcGx5KHRoaXMsayk7byE9PWImJihjLnJlc3VsdD1vLG89PT0hMSYmKGMucHJldmVudERlZmF1bHQoKSxjLnN0b3BQcm9wYWdhdGlvbigpKSk7aWYoYy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpKWJyZWFrfX19cmV0dXJuIGMucmVzdWx0fSxwcm9wczoiYWx0S2V5IGF0dHJDaGFuZ2UgYXR0ck5hbWUgYnViYmxlcyBidXR0b24gY2FuY2VsYWJsZSBjaGFyQ29kZSBjbGllbnRYIGNsaWVudFkgY3RybEtleSBjdXJyZW50VGFyZ2V0IGRhdGEgZGV0YWlsIGV2ZW50UGhhc2UgZnJvbUVsZW1lbnQgaGFuZGxlciBrZXlDb2RlIGxheWVyWCBsYXllclkgbWV0YUtleSBuZXdWYWx1ZSBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgcHJldlZhbHVlIHJlbGF0ZWROb2RlIHJlbGF0ZWRUYXJnZXQgc2NyZWVuWCBzY3JlZW5ZIHNoaWZ0S2V5IHNyY0VsZW1lbnQgdGFyZ2V0IHRvRWxlbWVudCB2aWV3IHdoZWVsRGVsdGEgd2hpY2giLnNwbGl0KCIgIiksZml4OmZ1bmN0aW9uKGEpe2lmKGFbZC5leHBhbmRvXSlyZXR1cm4gYTt2YXIgZT1hO2E9ZC5FdmVudChlKTtmb3IodmFyIGY9dGhpcy5wcm9wcy5sZW5ndGgsZztmOylnPXRoaXMucHJvcHNbLS1mXSxhW2ddPWVbZ107YS50YXJnZXR8fChhLnRhcmdldD1hLnNyY0VsZW1lbnR8fGMpLGEudGFyZ2V0Lm5vZGVUeXBlPT09MyYmKGEudGFyZ2V0PWEudGFyZ2V0LnBhcmVudE5vZGUpLCFhLnJlbGF0ZWRUYXJnZXQmJmEuZnJvbUVsZW1lbnQmJihhLnJlbGF0ZWRUYXJnZXQ9YS5mcm9tRWxlbWVudD09PWEudGFyZ2V0P2EudG9FbGVtZW50OmEuZnJvbUVsZW1lbnQpO2lmKGEucGFnZVg9PW51bGwmJmEuY2xpZW50WCE9bnVsbCl7dmFyIGg9Yy5kb2N1bWVudEVsZW1lbnQsaT1jLmJvZHk7YS5wYWdlWD1hLmNsaWVudFgrKGgmJmguc2Nyb2xsTGVmdHx8aSYmaS5zY3JvbGxMZWZ0fHwwKS0oaCYmaC5jbGllbnRMZWZ0fHxpJiZpLmNsaWVudExlZnR8fDApLGEucGFnZVk9YS5jbGllbnRZKyhoJiZoLnNjcm9sbFRvcHx8aSYmaS5zY3JvbGxUb3B8fDApLShoJiZoLmNsaWVudFRvcHx8aSYmaS5jbGllbnRUb3B8fDApfWEud2hpY2g9PW51bGwmJihhLmNoYXJDb2RlIT1udWxsfHxhLmtleUNvZGUhPW51bGwpJiYoYS53aGljaD1hLmNoYXJDb2RlIT1udWxsP2EuY2hhckNvZGU6YS5rZXlDb2RlKSwhYS5tZXRhS2V5JiZhLmN0cmxLZXkmJihhLm1ldGFLZXk9YS5jdHJsS2V5KSwhYS53aGljaCYmYS5idXR0b24hPT1iJiYoYS53aGljaD1hLmJ1dHRvbiYxPzE6YS5idXR0b24mMj8zOmEuYnV0dG9uJjQ/MjowKTtyZXR1cm4gYX0sZ3VpZDoxZTgscHJveHk6ZC5wcm94eSxzcGVjaWFsOntyZWFkeTp7c2V0dXA6ZC5iaW5kUmVhZHksdGVhcmRvd246ZC5ub29wfSxsaXZlOnthZGQ6ZnVuY3Rpb24oYSl7ZC5ldmVudC5hZGQodGhpcyxIKGEub3JpZ1R5cGUsYS5zZWxlY3RvciksZC5leHRlbmQoe30sYSx7aGFuZGxlcjpHLGd1aWQ6YS5oYW5kbGVyLmd1aWR9KSl9LHJlbW92ZTpmdW5jdGlvbihhKXtkLmV2ZW50LnJlbW92ZSh0aGlzLEgoYS5vcmlnVHlwZSxhLnNlbGVjdG9yKSxhKX19LGJlZm9yZXVubG9hZDp7c2V0dXA6ZnVuY3Rpb24oYSxiLGMpe2QuaXNXaW5kb3codGhpcykmJih0aGlzLm9uYmVmb3JldW5sb2FkPWMpfSx0ZWFyZG93bjpmdW5jdGlvbihhLGIpe3RoaXMub25iZWZvcmV1bmxvYWQ9PT1iJiYodGhpcy5vbmJlZm9yZXVubG9hZD1udWxsKX19fX0sZC5yZW1vdmVFdmVudD1jLnJlbW92ZUV2ZW50TGlzdGVuZXI/ZnVuY3Rpb24oYSxiLGMpe2EucmVtb3ZlRXZlbnRMaXN0ZW5lciYmYS5yZW1vdmVFdmVudExpc3RlbmVyKGIsYywhMSl9OmZ1bmN0aW9uKGEsYixjKXthLmRldGFjaEV2ZW50JiZhLmRldGFjaEV2ZW50KCJvbiIrYixjKX0sZC5FdmVudD1mdW5jdGlvbihhKXtpZighdGhpcy5wcmV2ZW50RGVmYXVsdClyZXR1cm4gbmV3IGQuRXZlbnQoYSk7YSYmYS50eXBlPyh0aGlzLm9yaWdpbmFsRXZlbnQ9YSx0aGlzLnR5cGU9YS50eXBlLHRoaXMuaXNEZWZhdWx0UHJldmVudGVkPWEuZGVmYXVsdFByZXZlbnRlZHx8YS5yZXR1cm5WYWx1ZT09PSExfHxhLmdldFByZXZlbnREZWZhdWx0JiZhLmdldFByZXZlbnREZWZhdWx0KCk/eTp4KTp0aGlzLnR5cGU9YSx0aGlzLnRpbWVTdGFtcD1kLm5vdygpLHRoaXNbZC5leHBhbmRvXT0hMH0sZC5FdmVudC5wcm90b3R5cGU9e3ByZXZlbnREZWZhdWx0OmZ1bmN0aW9uKCl7dGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9eTt2YXIgYT10aGlzLm9yaWdpbmFsRXZlbnQ7YSYmKGEucHJldmVudERlZmF1bHQ/YS5wcmV2ZW50RGVmYXVsdCgpOmEucmV0dXJuVmFsdWU9ITEpfSxzdG9wUHJvcGFnYXRpb246ZnVuY3Rpb24oKXt0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkPXk7dmFyIGE9dGhpcy5vcmlnaW5hbEV2ZW50O2EmJihhLnN0b3BQcm9wYWdhdGlvbiYmYS5zdG9wUHJvcGFnYXRpb24oKSxhLmNhbmNlbEJ1YmJsZT0hMCl9LHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjpmdW5jdGlvbigpe3RoaXMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ9eSx0aGlzLnN0b3BQcm9wYWdhdGlvbigpfSxpc0RlZmF1bHRQcmV2ZW50ZWQ6eCxpc1Byb3BhZ2F0aW9uU3RvcHBlZDp4LGlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOnh9O3ZhciB6PWZ1bmN0aW9uKGEpe3ZhciBiPWEucmVsYXRlZFRhcmdldDt0cnl7aWYoYiYmYiE9PWMmJiFiLnBhcmVudE5vZGUpcmV0dXJuO3doaWxlKGImJmIhPT10aGlzKWI9Yi5wYXJlbnROb2RlO2IhPT10aGlzJiYoYS50eXBlPWEuZGF0YSxkLmV2ZW50LmhhbmRsZS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfWNhdGNoKGUpe319LEE9ZnVuY3Rpb24oYSl7YS50eXBlPWEuZGF0YSxkLmV2ZW50LmhhbmRsZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9O2QuZWFjaCh7bW91c2VlbnRlcjoibW91c2VvdmVyIixtb3VzZWxlYXZlOiJtb3VzZW91dCJ9LGZ1bmN0aW9uKGEsYil7ZC5ldmVudC5zcGVjaWFsW2FdPXtzZXR1cDpmdW5jdGlvbihjKXtkLmV2ZW50LmFkZCh0aGlzLGIsYyYmYy5zZWxlY3Rvcj9BOnosYSl9LHRlYXJkb3duOmZ1bmN0aW9uKGEpe2QuZXZlbnQucmVtb3ZlKHRoaXMsYixhJiZhLnNlbGVjdG9yP0E6eil9fX0pLGQuc3VwcG9ydC5zdWJtaXRCdWJibGVzfHwoZC5ldmVudC5zcGVjaWFsLnN1Ym1pdD17c2V0dXA6ZnVuY3Rpb24oYSxiKXtpZih0aGlzLm5vZGVOYW1lJiZ0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkhPT0iZm9ybSIpZC5ldmVudC5hZGQodGhpcywiY2xpY2suc3BlY2lhbFN1Ym1pdCIsZnVuY3Rpb24oYSl7dmFyIGI9YS50YXJnZXQsYz1iLnR5cGU7KGM9PT0ic3VibWl0Inx8Yz09PSJpbWFnZSIpJiZkKGIpLmNsb3Nlc3QoImZvcm0iKS5sZW5ndGgmJkUoInN1Ym1pdCIsdGhpcyxhcmd1bWVudHMpfSksZC5ldmVudC5hZGQodGhpcywia2V5cHJlc3Muc3BlY2lhbFN1Ym1pdCIsZnVuY3Rpb24oYSl7dmFyIGI9YS50YXJnZXQsYz1iLnR5cGU7KGM9PT0idGV4dCJ8fGM9PT0icGFzc3dvcmQiKSYmZChiKS5jbG9zZXN0KCJmb3JtIikubGVuZ3RoJiZhLmtleUNvZGU9PT0xMyYmRSgic3VibWl0Iix0aGlzLGFyZ3VtZW50cyl9KTtlbHNlIHJldHVybiExfSx0ZWFyZG93bjpmdW5jdGlvbihhKXtkLmV2ZW50LnJlbW92ZSh0aGlzLCIuc3BlY2lhbFN1Ym1pdCIpfX0pO2lmKCFkLnN1cHBvcnQuY2hhbmdlQnViYmxlcyl7dmFyIEIsQz1mdW5jdGlvbihhKXt2YXIgYj1hLnR5cGUsYz1hLnZhbHVlO2I9PT0icmFkaW8ifHxiPT09ImNoZWNrYm94Ij9jPWEuY2hlY2tlZDpiPT09InNlbGVjdC1tdWx0aXBsZSI/Yz1hLnNlbGVjdGVkSW5kZXg+LTE/ZC5tYXAoYS5vcHRpb25zLGZ1bmN0aW9uKGEpe3JldHVybiBhLnNlbGVjdGVkfSkuam9pbigiLSIpOiIiOmEubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PSJzZWxlY3QiJiYoYz1hLnNlbGVjdGVkSW5kZXgpO3JldHVybiBjfSxEPWZ1bmN0aW9uIEQoYSl7dmFyIGM9YS50YXJnZXQsZSxmO2lmKHMudGVzdChjLm5vZGVOYW1lKSYmIWMucmVhZE9ubHkpe2U9ZC5fZGF0YShjLCJfY2hhbmdlX2RhdGEiKSxmPUMoYyksKGEudHlwZSE9PSJmb2N1c291dCJ8fGMudHlwZSE9PSJyYWRpbyIpJiZkLl9kYXRhKGMsIl9jaGFuZ2VfZGF0YSIsZik7aWYoZT09PWJ8fGY9PT1lKXJldHVybjtpZihlIT1udWxsfHxmKWEudHlwZT0iY2hhbmdlIixhLmxpdmVGaXJlZD1iLGQuZXZlbnQudHJpZ2dlcihhLGFyZ3VtZW50c1sxXSxjKX19O2QuZXZlbnQuc3BlY2lhbC5jaGFuZ2U9e2ZpbHRlcnM6e2ZvY3Vzb3V0OkQsYmVmb3JlZGVhY3RpdmF0ZTpELGNsaWNrOmZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0LGM9Yi50eXBlOyhjPT09InJhZGlvInx8Yz09PSJjaGVja2JveCJ8fGIubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PSJzZWxlY3QiKSYmRC5jYWxsKHRoaXMsYSl9LGtleWRvd246ZnVuY3Rpb24oYSl7dmFyIGI9YS50YXJnZXQsYz1iLnR5cGU7KGEua2V5Q29kZT09PTEzJiZiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkhPT0idGV4dGFyZWEifHxhLmtleUNvZGU9PT0zMiYmKGM9PT0iY2hlY2tib3gifHxjPT09InJhZGlvIil8fGM9PT0ic2VsZWN0LW11bHRpcGxlIikmJkQuY2FsbCh0aGlzLGEpfSxiZWZvcmVhY3RpdmF0ZTpmdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldDtkLl9kYXRhKGIsIl9jaGFuZ2VfZGF0YSIsQyhiKSl9fSxzZXR1cDpmdW5jdGlvbihhLGIpe2lmKHRoaXMudHlwZT09PSJmaWxlIilyZXR1cm4hMTtmb3IodmFyIGMgaW4gQilkLmV2ZW50LmFkZCh0aGlzLGMrIi5zcGVjaWFsQ2hhbmdlIixCW2NdKTtyZXR1cm4gcy50ZXN0KHRoaXMubm9kZU5hbWUpfSx0ZWFyZG93bjpmdW5jdGlvbihhKXtkLmV2ZW50LnJlbW92ZSh0aGlzLCIuc3BlY2lhbENoYW5nZSIpO3JldHVybiBzLnRlc3QodGhpcy5ub2RlTmFtZSl9fSxCPWQuZXZlbnQuc3BlY2lhbC5jaGFuZ2UuZmlsdGVycyxCLmZvY3VzPUIuYmVmb3JlYWN0aXZhdGV9Yy5hZGRFdmVudExpc3RlbmVyJiZkLmVhY2goe2ZvY3VzOiJmb2N1c2luIixibHVyOiJmb2N1c291dCJ9LGZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gZihhKXt2YXIgYz1kLmV2ZW50LmZpeChhKTtjLnR5cGU9YixjLm9yaWdpbmFsRXZlbnQ9e30sZC5ldmVudC50cmlnZ2VyKGMsbnVsbCxjLnRhcmdldCksYy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmYS5wcmV2ZW50RGVmYXVsdCgpfXZhciBlPTA7ZC5ldmVudC5zcGVjaWFsW2JdPXtzZXR1cDpmdW5jdGlvbigpe2UrKz09PTAmJmMuYWRkRXZlbnRMaXN0ZW5lcihhLGYsITApfSx0ZWFyZG93bjpmdW5jdGlvbigpey0tZT09PTAmJmMucmVtb3ZlRXZlbnRMaXN0ZW5lcihhLGYsITApfX19KSxkLmVhY2goWyJiaW5kIiwib25lIl0sZnVuY3Rpb24oYSxjKXtkLmZuW2NdPWZ1bmN0aW9uKGEsZSxmKXtpZih0eXBlb2YgYT09PSJvYmplY3QiKXtmb3IodmFyIGcgaW4gYSl0aGlzW2NdKGcsZSxhW2ddLGYpO3JldHVybiB0aGlzfWlmKGQuaXNGdW5jdGlvbihlKXx8ZT09PSExKWY9ZSxlPWI7dmFyIGg9Yz09PSJvbmUiP2QucHJveHkoZixmdW5jdGlvbihhKXtkKHRoaXMpLnVuYmluZChhLGgpO3JldHVybiBmLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pOmY7aWYoYT09PSJ1bmxvYWQiJiZjIT09Im9uZSIpdGhpcy5vbmUoYSxlLGYpO2Vsc2UgZm9yKHZhciBpPTAsaj10aGlzLmxlbmd0aDtpPGo7aSsrKWQuZXZlbnQuYWRkKHRoaXNbaV0sYSxoLGUpO3JldHVybiB0aGlzfX0pLGQuZm4uZXh0ZW5kKHt1bmJpbmQ6ZnVuY3Rpb24oYSxiKXtpZih0eXBlb2YgYSE9PSJvYmplY3QifHxhLnByZXZlbnREZWZhdWx0KWZvcih2YXIgZT0wLGY9dGhpcy5sZW5ndGg7ZTxmO2UrKylkLmV2ZW50LnJlbW92ZSh0aGlzW2VdLGEsYik7ZWxzZSBmb3IodmFyIGMgaW4gYSl0aGlzLnVuYmluZChjLGFbY10pO3JldHVybiB0aGlzfSxkZWxlZ2F0ZTpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5saXZlKGIsYyxkLGEpfSx1bmRlbGVnYXRlOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD09PTA/dGhpcy51bmJpbmQoImxpdmUiKTp0aGlzLmRpZShiLG51bGwsYyxhKX0sdHJpZ2dlcjpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtkLmV2ZW50LnRyaWdnZXIoYSxiLHRoaXMpfSl9LHRyaWdnZXJIYW5kbGVyOmZ1bmN0aW9uKGEsYil7aWYodGhpc1swXSl7dmFyIGM9ZC5FdmVudChhKTtjLnByZXZlbnREZWZhdWx0KCksYy5zdG9wUHJvcGFnYXRpb24oKSxkLmV2ZW50LnRyaWdnZXIoYyxiLHRoaXNbMF0pO3JldHVybiBjLnJlc3VsdH19LHRvZ2dsZTpmdW5jdGlvbihhKXt2YXIgYj1hcmd1bWVudHMsYz0xO3doaWxlKGM8Yi5sZW5ndGgpZC5wcm94eShhLGJbYysrXSk7cmV0dXJuIHRoaXMuY2xpY2soZC5wcm94eShhLGZ1bmN0aW9uKGUpe3ZhciBmPShkLl9kYXRhKHRoaXMsImxhc3RUb2dnbGUiK2EuZ3VpZCl8fDApJWM7ZC5fZGF0YSh0aGlzLCJsYXN0VG9nZ2xlIithLmd1aWQsZisxKSxlLnByZXZlbnREZWZhdWx0KCk7cmV0dXJuIGJbZl0uYXBwbHkodGhpcyxhcmd1bWVudHMpfHwhMX0pKX0saG92ZXI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5tb3VzZWVudGVyKGEpLm1vdXNlbGVhdmUoYnx8YSl9fSk7dmFyIEY9e2ZvY3VzOiJmb2N1c2luIixibHVyOiJmb2N1c291dCIsbW91c2VlbnRlcjoibW91c2VvdmVyIixtb3VzZWxlYXZlOiJtb3VzZW91dCJ9O2QuZWFjaChbImxpdmUiLCJkaWUiXSxmdW5jdGlvbihhLGMpe2QuZm5bY109ZnVuY3Rpb24oYSxlLGYsZyl7dmFyIGgsaT0wLGosayxsLG09Z3x8dGhpcy5zZWxlY3RvcixuPWc/dGhpczpkKHRoaXMuY29udGV4dCk7aWYodHlwZW9mIGE9PT0ib2JqZWN0IiYmIWEucHJldmVudERlZmF1bHQpe2Zvcih2YXIgbyBpbiBhKW5bY10obyxlLGFbb10sbSk7cmV0dXJuIHRoaXN9ZC5pc0Z1bmN0aW9uKGUpJiYoZj1lLGU9YiksYT0oYXx8IiIpLnNwbGl0KCIgIik7d2hpbGUoKGg9YVtpKytdKSE9bnVsbCl7aj1yLmV4ZWMoaCksaz0iIixqJiYoaz1qWzBdLGg9aC5yZXBsYWNlKHIsIiIpKTtpZihoPT09ImhvdmVyIil7YS5wdXNoKCJtb3VzZWVudGVyIitrLCJtb3VzZWxlYXZlIitrKTtjb250aW51ZX1sPWgsaD09PSJmb2N1cyJ8fGg9PT0iYmx1ciI/KGEucHVzaChGW2hdK2spLGg9aCtrKTpoPShGW2hdfHxoKStrO2lmKGM9PT0ibGl2ZSIpZm9yKHZhciBwPTAscT1uLmxlbmd0aDtwPHE7cCsrKWQuZXZlbnQuYWRkKG5bcF0sImxpdmUuIitIKGgsbSkse2RhdGE6ZSxzZWxlY3RvcjptLGhhbmRsZXI6ZixvcmlnVHlwZTpoLG9yaWdIYW5kbGVyOmYscHJlVHlwZTpsfSk7ZWxzZSBuLnVuYmluZCgibGl2ZS4iK0goaCxtKSxmKX1yZXR1cm4gdGhpc319KSxkLmVhY2goImJsdXIgZm9jdXMgZm9jdXNpbiBmb2N1c291dCBsb2FkIHJlc2l6ZSBzY3JvbGwgdW5sb2FkIGNsaWNrIGRibGNsaWNrIG1vdXNlZG93biBtb3VzZXVwIG1vdXNlbW92ZSBtb3VzZW92ZXIgbW91c2VvdXQgbW91c2VlbnRlciBtb3VzZWxlYXZlIGNoYW5nZSBzZWxlY3Qgc3VibWl0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgZXJyb3IiLnNwbGl0KCIgIiksZnVuY3Rpb24oYSxiKXtkLmZuW2JdPWZ1bmN0aW9uKGEsYyl7Yz09bnVsbCYmKGM9YSxhPW51bGwpO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPjA/dGhpcy5iaW5kKGIsYSxjKTp0aGlzLnRyaWdnZXIoYil9LGQuYXR0ckZuJiYoZC5hdHRyRm5bYl09ITApfSksZnVuY3Rpb24oKXtmdW5jdGlvbiB1KGEsYixjLGQsZSxmKXtmb3IodmFyIGc9MCxoPWQubGVuZ3RoO2c8aDtnKyspe3ZhciBpPWRbZ107aWYoaSl7dmFyIGo9ITE7aT1pW2FdO3doaWxlKGkpe2lmKGkuc2l6Y2FjaGU9PT1jKXtqPWRbaS5zaXpzZXRdO2JyZWFrfWlmKGkubm9kZVR5cGU9PT0xKXtmfHwoaS5zaXpjYWNoZT1jLGkuc2l6c2V0PWcpO2lmKHR5cGVvZiBiIT09InN0cmluZyIpe2lmKGk9PT1iKXtqPSEwO2JyZWFrfX1lbHNlIGlmKGsuZmlsdGVyKGIsW2ldKS5sZW5ndGg+MCl7aj1pO2JyZWFrfX1pPWlbYV19ZFtnXT1qfX19ZnVuY3Rpb24gdChhLGIsYyxkLGUsZil7Zm9yKHZhciBnPTAsaD1kLmxlbmd0aDtnPGg7ZysrKXt2YXIgaT1kW2ddO2lmKGkpe3ZhciBqPSExO2k9aVthXTt3aGlsZShpKXtpZihpLnNpemNhY2hlPT09Yyl7aj1kW2kuc2l6c2V0XTticmVha31pLm5vZGVUeXBlPT09MSYmIWYmJihpLnNpemNhY2hlPWMsaS5zaXpzZXQ9Zyk7aWYoaS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09Yil7aj1pO2JyZWFrfWk9aVthXX1kW2ddPWp9fX12YXIgYT0vKCg/OlwoKD86XChbXigpXStcKXxbXigpXSspK1wpfFxbKD86XFtbXlxbXF1dKlxdfFsnIl1bXiciXSpbJyJdfFteXFtcXSciXSspK1xdfFxcLnxbXiA+K34sKFxbXFxdKykrfFs+K35dKShccyosXHMqKT8oKD86LnxccnxcbikqKS9nLGU9MCxmPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsZz0hMSxoPSEwLGk9L1xcL2csaj0vXFcvO1swLDBdLnNvcnQoZnVuY3Rpb24oKXtoPSExO3JldHVybiAwfSk7dmFyIGs9ZnVuY3Rpb24oYixkLGUsZyl7ZT1lfHxbXSxkPWR8fGM7dmFyIGg9ZDtpZihkLm5vZGVUeXBlIT09MSYmZC5ub2RlVHlwZSE9PTkpcmV0dXJuW107aWYoIWJ8fHR5cGVvZiBiIT09InN0cmluZyIpcmV0dXJuIGU7dmFyIGksaixuLG8scSxyLHMsdCx1PSEwLHc9ay5pc1hNTChkKSx4PVtdLHk9Yjtkb3thLmV4ZWMoIiIpLGk9YS5leGVjKHkpO2lmKGkpe3k9aVszXSx4LnB1c2goaVsxXSk7aWYoaVsyXSl7bz1pWzNdO2JyZWFrfX19d2hpbGUoaSk7aWYoeC5sZW5ndGg+MSYmbS5leGVjKGIpKWlmKHgubGVuZ3RoPT09MiYmbC5yZWxhdGl2ZVt4WzBdXSlqPXYoeFswXSt4WzFdLGQpO2Vsc2V7aj1sLnJlbGF0aXZlW3hbMF1dP1tkXTprKHguc2hpZnQoKSxkKTt3aGlsZSh4Lmxlbmd0aCliPXguc2hpZnQoKSxsLnJlbGF0aXZlW2JdJiYoYis9eC5zaGlmdCgpKSxqPXYoYixqKX1lbHNleyFnJiZ4Lmxlbmd0aD4xJiZkLm5vZGVUeXBlPT09OSYmIXcmJmwubWF0Y2guSUQudGVzdCh4WzBdKSYmIWwubWF0Y2guSUQudGVzdCh4W3gubGVuZ3RoLTFdKSYmKHE9ay5maW5kKHguc2hpZnQoKSxkLHcpLGQ9cS5leHByP2suZmlsdGVyKHEuZXhwcixxLnNldClbMF06cS5zZXRbMF0pO2lmKGQpe3E9Zz97ZXhwcjp4LnBvcCgpLHNldDpwKGcpfTprLmZpbmQoeC5wb3AoKSx4Lmxlbmd0aD09PTEmJih4WzBdPT09In4ifHx4WzBdPT09IisiKSYmZC5wYXJlbnROb2RlP2QucGFyZW50Tm9kZTpkLHcpLGo9cS5leHByP2suZmlsdGVyKHEuZXhwcixxLnNldCk6cS5zZXQseC5sZW5ndGg+MD9uPXAoaik6dT0hMTt3aGlsZSh4Lmxlbmd0aClyPXgucG9wKCkscz1yLGwucmVsYXRpdmVbcl0/cz14LnBvcCgpOnI9IiIscz09bnVsbCYmKHM9ZCksbC5yZWxhdGl2ZVtyXShuLHMsdyl9ZWxzZSBuPXg9W119bnx8KG49aiksbnx8ay5lcnJvcihyfHxiKTtpZihmLmNhbGwobik9PT0iW29iamVjdCBBcnJheV0iKWlmKHUpaWYoZCYmZC5ub2RlVHlwZT09PTEpZm9yKHQ9MDtuW3RdIT1udWxsO3QrKyluW3RdJiYoblt0XT09PSEwfHxuW3RdLm5vZGVUeXBlPT09MSYmay5jb250YWlucyhkLG5bdF0pKSYmZS5wdXNoKGpbdF0pO2Vsc2UgZm9yKHQ9MDtuW3RdIT1udWxsO3QrKyluW3RdJiZuW3RdLm5vZGVUeXBlPT09MSYmZS5wdXNoKGpbdF0pO2Vsc2UgZS5wdXNoLmFwcGx5KGUsbik7ZWxzZSBwKG4sZSk7byYmKGsobyxoLGUsZyksay51bmlxdWVTb3J0KGUpKTtyZXR1cm4gZX07ay51bmlxdWVTb3J0PWZ1bmN0aW9uKGEpe2lmKHIpe2c9aCxhLnNvcnQocik7aWYoZylmb3IodmFyIGI9MTtiPGEubGVuZ3RoO2IrKylhW2JdPT09YVtiLTFdJiZhLnNwbGljZShiLS0sMSl9cmV0dXJuIGF9LGsubWF0Y2hlcz1mdW5jdGlvbihhLGIpe3JldHVybiBrKGEsbnVsbCxudWxsLGIpfSxrLm1hdGNoZXNTZWxlY3Rvcj1mdW5jdGlvbihhLGIpe3JldHVybiBrKGIsbnVsbCxudWxsLFthXSkubGVuZ3RoPjB9LGsuZmluZD1mdW5jdGlvbihhLGIsYyl7dmFyIGQ7aWYoIWEpcmV0dXJuW107Zm9yKHZhciBlPTAsZj1sLm9yZGVyLmxlbmd0aDtlPGY7ZSsrKXt2YXIgZyxoPWwub3JkZXJbZV07aWYoZz1sLmxlZnRNYXRjaFtoXS5leGVjKGEpKXt2YXIgaj1nWzFdO2cuc3BsaWNlKDEsMSk7aWYoai5zdWJzdHIoai5sZW5ndGgtMSkhPT0iXFwiKXtnWzFdPShnWzFdfHwiIikucmVwbGFjZShpLCIiKSxkPWwuZmluZFtoXShnLGIsYyk7aWYoZCE9bnVsbCl7YT1hLnJlcGxhY2UobC5tYXRjaFtoXSwiIik7YnJlYWt9fX19ZHx8KGQ9dHlwZW9mIGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUhPT0idW5kZWZpbmVkIj9iLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIik6W10pO3JldHVybntzZXQ6ZCxleHByOmF9fSxrLmZpbHRlcj1mdW5jdGlvbihhLGMsZCxlKXt2YXIgZixnLGg9YSxpPVtdLGo9YyxtPWMmJmNbMF0mJmsuaXNYTUwoY1swXSk7d2hpbGUoYSYmYy5sZW5ndGgpe2Zvcih2YXIgbiBpbiBsLmZpbHRlcilpZigoZj1sLmxlZnRNYXRjaFtuXS5leGVjKGEpKSE9bnVsbCYmZlsyXSl7dmFyIG8scCxxPWwuZmlsdGVyW25dLHI9ZlsxXTtnPSExLGYuc3BsaWNlKDEsMSk7aWYoci5zdWJzdHIoci5sZW5ndGgtMSk9PT0iXFwiKWNvbnRpbnVlO2o9PT1pJiYoaT1bXSk7aWYobC5wcmVGaWx0ZXJbbl0pe2Y9bC5wcmVGaWx0ZXJbbl0oZixqLGQsaSxlLG0pO2lmKGYpe2lmKGY9PT0hMCljb250aW51ZX1lbHNlIGc9bz0hMH1pZihmKWZvcih2YXIgcz0wOyhwPWpbc10pIT1udWxsO3MrKylpZihwKXtvPXEocCxmLHMsaik7dmFyIHQ9ZV4hIW87ZCYmbyE9bnVsbD90P2c9ITA6altzXT0hMTp0JiYoaS5wdXNoKHApLGc9ITApfWlmKG8hPT1iKXtkfHwoaj1pKSxhPWEucmVwbGFjZShsLm1hdGNoW25dLCIiKTtpZighZylyZXR1cm5bXTticmVha319aWYoYT09PWgpaWYoZz09bnVsbClrLmVycm9yKGEpO2Vsc2UgYnJlYWs7aD1hfXJldHVybiBqfSxrLmVycm9yPWZ1bmN0aW9uKGEpe3Rocm93IlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246ICIrYX07dmFyIGw9ay5zZWxlY3RvcnM9e29yZGVyOlsiSUQiLCJOQU1FIiwiVEFHIl0sbWF0Y2g6e0lEOi8jKCg/Oltcd1x1MDBjMC1cdUZGRkZcLV18XFwuKSspLyxDTEFTUzovXC4oKD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKykvLE5BTUU6L1xbbmFtZT1bJyJdKigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKVsnIl0qXF0vLEFUVFI6L1xbXHMqKCg/Oltcd1x1MDBjMC1cdUZGRkZcLV18XFwuKSspXHMqKD86KFxTPz0pXHMqKD86KFsnIl0pKC4qPylcM3woIz8oPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikqKXwpfClccypcXS8sVEFHOi9eKCg/Oltcd1x1MDBjMC1cdUZGRkZcKlwtXXxcXC4pKykvLENISUxEOi86KG9ubHl8bnRofGxhc3R8Zmlyc3QpLWNoaWxkKD86XChccyooZXZlbnxvZGR8KD86WytcLV0/XGQrfCg/OlsrXC1dP1xkKik/blxzKig/OlsrXC1dXHMqXGQrKT8pKVxzKlwpKT8vLFBPUzovOihudGh8ZXF8Z3R8bHR8Zmlyc3R8bGFzdHxldmVufG9kZCkoPzpcKChcZCopXCkpPyg/PVteXC1dfCQpLyxQU0VVRE86LzooKD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKykoPzpcKChbJyJdPykoKD86XChbXlwpXStcKXxbXlwoXCldKikrKVwyXCkpPy99LGxlZnRNYXRjaDp7fSxhdHRyTWFwOnsiY2xhc3MiOiJjbGFzc05hbWUiLCJmb3IiOiJodG1sRm9yIn0sYXR0ckhhbmRsZTp7aHJlZjpmdW5jdGlvbihhKXtyZXR1cm4gYS5nZXRBdHRyaWJ1dGUoImhyZWYiKX0sdHlwZTpmdW5jdGlvbihhKXtyZXR1cm4gYS5nZXRBdHRyaWJ1dGUoInR5cGUiKX19LHJlbGF0aXZlOnsiKyI6ZnVuY3Rpb24oYSxiKXt2YXIgYz10eXBlb2YgYj09PSJzdHJpbmciLGQ9YyYmIWoudGVzdChiKSxlPWMmJiFkO2QmJihiPWIudG9Mb3dlckNhc2UoKSk7Zm9yKHZhciBmPTAsZz1hLmxlbmd0aCxoO2Y8ZztmKyspaWYoaD1hW2ZdKXt3aGlsZSgoaD1oLnByZXZpb3VzU2libGluZykmJmgubm9kZVR5cGUhPT0xKXt9YVtmXT1lfHxoJiZoLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iP2h8fCExOmg9PT1ifWUmJmsuZmlsdGVyKGIsYSwhMCl9LCI+IjpmdW5jdGlvbihhLGIpe3ZhciBjLGQ9dHlwZW9mIGI9PT0ic3RyaW5nIixlPTAsZj1hLmxlbmd0aDtpZihkJiYhai50ZXN0KGIpKXtiPWIudG9Mb3dlckNhc2UoKTtmb3IoO2U8ZjtlKyspe2M9YVtlXTtpZihjKXt2YXIgZz1jLnBhcmVudE5vZGU7YVtlXT1nLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iP2c6ITF9fX1lbHNle2Zvcig7ZTxmO2UrKyljPWFbZV0sYyYmKGFbZV09ZD9jLnBhcmVudE5vZGU6Yy5wYXJlbnROb2RlPT09Yik7ZCYmay5maWx0ZXIoYixhLCEwKX19LCIiOmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxmPWUrKyxnPXU7dHlwZW9mIGI9PT0ic3RyaW5nIiYmIWoudGVzdChiKSYmKGI9Yi50b0xvd2VyQ2FzZSgpLGQ9YixnPXQpLGcoInBhcmVudE5vZGUiLGIsZixhLGQsYyl9LCJ+IjpmdW5jdGlvbihhLGIsYyl7dmFyIGQsZj1lKyssZz11O3R5cGVvZiBiPT09InN0cmluZyImJiFqLnRlc3QoYikmJihiPWIudG9Mb3dlckNhc2UoKSxkPWIsZz10KSxnKCJwcmV2aW91c1NpYmxpbmciLGIsZixhLGQsYyl9fSxmaW5kOntJRDpmdW5jdGlvbihhLGIsYyl7aWYodHlwZW9mIGIuZ2V0RWxlbWVudEJ5SWQhPT0idW5kZWZpbmVkIiYmIWMpe3ZhciBkPWIuZ2V0RWxlbWVudEJ5SWQoYVsxXSk7cmV0dXJuIGQmJmQucGFyZW50Tm9kZT9bZF06W119fSxOQU1FOmZ1bmN0aW9uKGEsYil7aWYodHlwZW9mIGIuZ2V0RWxlbWVudHNCeU5hbWUhPT0idW5kZWZpbmVkIil7dmFyIGM9W10sZD1iLmdldEVsZW1lbnRzQnlOYW1lKGFbMV0pO2Zvcih2YXIgZT0wLGY9ZC5sZW5ndGg7ZTxmO2UrKylkW2VdLmdldEF0dHJpYnV0ZSgibmFtZSIpPT09YVsxXSYmYy5wdXNoKGRbZV0pO3JldHVybiBjLmxlbmd0aD09PTA/bnVsbDpjfX0sVEFHOmZ1bmN0aW9uKGEsYil7aWYodHlwZW9mIGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUhPT0idW5kZWZpbmVkIilyZXR1cm4gYi5nZXRFbGVtZW50c0J5VGFnTmFtZShhWzFdKX19LHByZUZpbHRlcjp7Q0xBU1M6ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe2E9IiAiK2FbMV0ucmVwbGFjZShpLCIiKSsiICI7aWYoZilyZXR1cm4gYTtmb3IodmFyIGc9MCxoOyhoPWJbZ10pIT1udWxsO2crKyloJiYoZV4oaC5jbGFzc05hbWUmJigiICIraC5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKC9bXHRcblxyXS9nLCIgIikuaW5kZXhPZihhKT49MCk/Y3x8ZC5wdXNoKGgpOmMmJihiW2ddPSExKSk7cmV0dXJuITF9LElEOmZ1bmN0aW9uKGEpe3JldHVybiBhWzFdLnJlcGxhY2UoaSwiIil9LFRBRzpmdW5jdGlvbihhLGIpe3JldHVybiBhWzFdLnJlcGxhY2UoaSwiIikudG9Mb3dlckNhc2UoKX0sQ0hJTEQ6ZnVuY3Rpb24oYSl7aWYoYVsxXT09PSJudGgiKXthWzJdfHxrLmVycm9yKGFbMF0pLGFbMl09YVsyXS5yZXBsYWNlKC9eXCt8XHMqL2csIiIpO3ZhciBiPS8oLT8pKFxkKikoPzpuKFsrXC1dP1xkKikpPy8uZXhlYyhhWzJdPT09ImV2ZW4iJiYiMm4ifHxhWzJdPT09Im9kZCImJiIybisxInx8IS9cRC8udGVzdChhWzJdKSYmIjBuKyIrYVsyXXx8YVsyXSk7YVsyXT1iWzFdKyhiWzJdfHwxKS0wLGFbM109YlszXS0wfWVsc2UgYVsyXSYmay5lcnJvcihhWzBdKTthWzBdPWUrKztyZXR1cm4gYX0sQVRUUjpmdW5jdGlvbihhLGIsYyxkLGUsZil7dmFyIGc9YVsxXT1hWzFdLnJlcGxhY2UoaSwiIik7IWYmJmwuYXR0ck1hcFtnXSYmKGFbMV09bC5hdHRyTWFwW2ddKSxhWzRdPShhWzRdfHxhWzVdfHwiIikucmVwbGFjZShpLCIiKSxhWzJdPT09In49IiYmKGFbNF09IiAiK2FbNF0rIiAiKTtyZXR1cm4gYX0sUFNFVURPOmZ1bmN0aW9uKGIsYyxkLGUsZil7aWYoYlsxXT09PSJub3QiKWlmKChhLmV4ZWMoYlszXSl8fCIiKS5sZW5ndGg+MXx8L15cdy8udGVzdChiWzNdKSliWzNdPWsoYlszXSxudWxsLG51bGwsYyk7ZWxzZXt2YXIgZz1rLmZpbHRlcihiWzNdLGMsZCwhMF5mKTtkfHxlLnB1c2guYXBwbHkoZSxnKTtyZXR1cm4hMX1lbHNlIGlmKGwubWF0Y2guUE9TLnRlc3QoYlswXSl8fGwubWF0Y2guQ0hJTEQudGVzdChiWzBdKSlyZXR1cm4hMDtyZXR1cm4gYn0sUE9TOmZ1bmN0aW9uKGEpe2EudW5zaGlmdCghMCk7cmV0dXJuIGF9fSxmaWx0ZXJzOntlbmFibGVkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmRpc2FibGVkPT09ITEmJmEudHlwZSE9PSJoaWRkZW4ifSxkaXNhYmxlZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5kaXNhYmxlZD09PSEwfSxjaGVja2VkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmNoZWNrZWQ9PT0hMH0sc2VsZWN0ZWQ6ZnVuY3Rpb24oYSl7YS5wYXJlbnROb2RlJiZhLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDtyZXR1cm4gYS5zZWxlY3RlZD09PSEwfSxwYXJlbnQ6ZnVuY3Rpb24oYSl7cmV0dXJuISFhLmZpcnN0Q2hpbGR9LGVtcHR5OmZ1bmN0aW9uKGEpe3JldHVybiFhLmZpcnN0Q2hpbGR9LGhhczpmdW5jdGlvbihhLGIsYyl7cmV0dXJuISFrKGNbM10sYSkubGVuZ3RofSxoZWFkZXI6ZnVuY3Rpb24oYSl7cmV0dXJuL2hcZC9pLnRlc3QoYS5ub2RlTmFtZSl9LHRleHQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5nZXRBdHRyaWJ1dGUoInR5cGUiKSxjPWEudHlwZTtyZXR1cm4idGV4dCI9PT1jJiYoYj09PWN8fGI9PT1udWxsKX0scmFkaW86ZnVuY3Rpb24oYSl7cmV0dXJuInJhZGlvIj09PWEudHlwZX0sY2hlY2tib3g6ZnVuY3Rpb24oYSl7cmV0dXJuImNoZWNrYm94Ij09PWEudHlwZX0sZmlsZTpmdW5jdGlvbihhKXtyZXR1cm4iZmlsZSI9PT1hLnR5cGV9LHBhc3N3b3JkOmZ1bmN0aW9uKGEpe3JldHVybiJwYXNzd29yZCI9PT1hLnR5cGV9LHN1Ym1pdDpmdW5jdGlvbihhKXtyZXR1cm4ic3VibWl0Ij09PWEudHlwZX0saW1hZ2U6ZnVuY3Rpb24oYSl7cmV0dXJuImltYWdlIj09PWEudHlwZX0scmVzZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuInJlc2V0Ij09PWEudHlwZX0sYnV0dG9uOmZ1bmN0aW9uKGEpe3JldHVybiJidXR0b24iPT09YS50eXBlfHxhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT0iYnV0dG9uIn0saW5wdXQ6ZnVuY3Rpb24oYSl7cmV0dXJuL2lucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24vaS50ZXN0KGEubm9kZU5hbWUpfX0sc2V0RmlsdGVyczp7Zmlyc3Q6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYj09PTB9LGxhc3Q6ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIGI9PT1kLmxlbmd0aC0xfSxldmVuOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGIlMj09PTB9LG9kZDpmdW5jdGlvbihhLGIpe3JldHVybiBiJTI9PT0xfSxsdDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGI8Y1szXS0wfSxndDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGI+Y1szXS0wfSxudGg6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBjWzNdLTA9PT1ifSxlcTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGNbM10tMD09PWJ9fSxmaWx0ZXI6e1BTRVVETzpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1iWzFdLGY9bC5maWx0ZXJzW2VdO2lmKGYpcmV0dXJuIGYoYSxjLGIsZCk7aWYoZT09PSJjb250YWlucyIpcmV0dXJuKGEudGV4dENvbnRlbnR8fGEuaW5uZXJUZXh0fHxrLmdldFRleHQoW2FdKXx8IiIpLmluZGV4T2YoYlszXSk+PTA7aWYoZT09PSJub3QiKXt2YXIgZz1iWzNdO2Zvcih2YXIgaD0wLGk9Zy5sZW5ndGg7aDxpO2grKylpZihnW2hdPT09YSlyZXR1cm4hMTtyZXR1cm4hMH1rLmVycm9yKGUpfSxDSElMRDpmdW5jdGlvbihhLGIpe3ZhciBjPWJbMV0sZD1hO3N3aXRjaChjKXtjYXNlIm9ubHkiOmNhc2UiZmlyc3QiOndoaWxlKGQ9ZC5wcmV2aW91c1NpYmxpbmcpaWYoZC5ub2RlVHlwZT09PTEpcmV0dXJuITE7aWYoYz09PSJmaXJzdCIpcmV0dXJuITA7ZD1hO2Nhc2UibGFzdCI6d2hpbGUoZD1kLm5leHRTaWJsaW5nKWlmKGQubm9kZVR5cGU9PT0xKXJldHVybiExO3JldHVybiEwO2Nhc2UibnRoIjp2YXIgZT1iWzJdLGY9YlszXTtpZihlPT09MSYmZj09PTApcmV0dXJuITA7dmFyIGc9YlswXSxoPWEucGFyZW50Tm9kZTtpZihoJiYoaC5zaXpjYWNoZSE9PWd8fCFhLm5vZGVJbmRleCkpe3ZhciBpPTA7Zm9yKGQ9aC5maXJzdENoaWxkO2Q7ZD1kLm5leHRTaWJsaW5nKWQubm9kZVR5cGU9PT0xJiYoZC5ub2RlSW5kZXg9KytpKTtoLnNpemNhY2hlPWd9dmFyIGo9YS5ub2RlSW5kZXgtZjtyZXR1cm4gZT09PTA/aj09PTA6aiVlPT09MCYmai9lPj0wfX0sSUQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5ub2RlVHlwZT09PTEmJmEuZ2V0QXR0cmlidXRlKCJpZCIpPT09Yn0sVEFHOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGI9PT0iKiImJmEubm9kZVR5cGU9PT0xfHxhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1ifSxDTEFTUzpmdW5jdGlvbihhLGIpe3JldHVybigiICIrKGEuY2xhc3NOYW1lfHxhLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSkrIiAiKS5pbmRleE9mKGIpPi0xfSxBVFRSOmZ1bmN0aW9uKGEsYil7dmFyIGM9YlsxXSxkPWwuYXR0ckhhbmRsZVtjXT9sLmF0dHJIYW5kbGVbY10oYSk6YVtjXSE9bnVsbD9hW2NdOmEuZ2V0QXR0cmlidXRlKGMpLGU9ZCsiIixmPWJbMl0sZz1iWzRdO3JldHVybiBkPT1udWxsP2Y9PT0iIT0iOmY9PT0iPSI/ZT09PWc6Zj09PSIqPSI/ZS5pbmRleE9mKGcpPj0wOmY9PT0ifj0iPygiICIrZSsiICIpLmluZGV4T2YoZyk+PTA6Zz9mPT09IiE9Ij9lIT09ZzpmPT09Il49Ij9lLmluZGV4T2YoZyk9PT0wOmY9PT0iJD0iP2Uuc3Vic3RyKGUubGVuZ3RoLWcubGVuZ3RoKT09PWc6Zj09PSJ8PSI/ZT09PWd8fGUuc3Vic3RyKDAsZy5sZW5ndGgrMSk9PT1nKyItIjohMTplJiZkIT09ITF9LFBPUzpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1iWzJdLGY9bC5zZXRGaWx0ZXJzW2VdO2lmKGYpcmV0dXJuIGYoYSxjLGIsZCl9fX0sbT1sLm1hdGNoLlBPUyxuPWZ1bmN0aW9uKGEsYil7cmV0dXJuIlxcIisoYi0wKzEpfTtmb3IodmFyIG8gaW4gbC5tYXRjaClsLm1hdGNoW29dPW5ldyBSZWdFeHAobC5tYXRjaFtvXS5zb3VyY2UrLyg/IVteXFtdKlxdKSg/IVteXChdKlwpKS8uc291cmNlKSxsLmxlZnRNYXRjaFtvXT1uZXcgUmVnRXhwKC8oXig/Oi58XHJ8XG4pKj8pLy5zb3VyY2UrbC5tYXRjaFtvXS5zb3VyY2UucmVwbGFjZSgvXFwoXGQrKS9nLG4pKTt2YXIgcD1mdW5jdGlvbihhLGIpe2E9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYSwwKTtpZihiKXtiLnB1c2guYXBwbHkoYixhKTtyZXR1cm4gYn1yZXR1cm4gYX07dHJ5e0FycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGMuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXMsMClbMF0ubm9kZVR5cGV9Y2F0Y2gocSl7cD1mdW5jdGlvbihhLGIpe3ZhciBjPTAsZD1ifHxbXTtpZihmLmNhbGwoYSk9PT0iW29iamVjdCBBcnJheV0iKUFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGQsYSk7ZWxzZSBpZih0eXBlb2YgYS5sZW5ndGg9PT0ibnVtYmVyIilmb3IodmFyIGU9YS5sZW5ndGg7YzxlO2MrKylkLnB1c2goYVtjXSk7ZWxzZSBmb3IoO2FbY107YysrKWQucHVzaChhW2NdKTtyZXR1cm4gZH19dmFyIHIscztjLmRvY3VtZW50RWxlbWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj9yPWZ1bmN0aW9uKGEsYil7aWYoYT09PWIpe2c9ITA7cmV0dXJuIDB9aWYoIWEuY29tcGFyZURvY3VtZW50UG9zaXRpb258fCFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKXJldHVybiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uPy0xOjE7cmV0dXJuIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmND8tMToxfToocj1mdW5jdGlvbihhLGIpe3ZhciBjLGQsZT1bXSxmPVtdLGg9YS5wYXJlbnROb2RlLGk9Yi5wYXJlbnROb2RlLGo9aDtpZihhPT09Yil7Zz0hMDtyZXR1cm4gMH1pZihoPT09aSlyZXR1cm4gcyhhLGIpO2lmKCFoKXJldHVybi0xO2lmKCFpKXJldHVybiAxO3doaWxlKGopZS51bnNoaWZ0KGopLGo9ai5wYXJlbnROb2RlO2o9aTt3aGlsZShqKWYudW5zaGlmdChqKSxqPWoucGFyZW50Tm9kZTtjPWUubGVuZ3RoLGQ9Zi5sZW5ndGg7Zm9yKHZhciBrPTA7azxjJiZrPGQ7aysrKWlmKGVba10hPT1mW2tdKXJldHVybiBzKGVba10sZltrXSk7cmV0dXJuIGs9PT1jP3MoYSxmW2tdLC0xKTpzKGVba10sYiwxKX0scz1mdW5jdGlvbihhLGIsYyl7aWYoYT09PWIpcmV0dXJuIGM7dmFyIGQ9YS5uZXh0U2libGluZzt3aGlsZShkKXtpZihkPT09YilyZXR1cm4tMTtkPWQubmV4dFNpYmxpbmd9cmV0dXJuIDF9KSxrLmdldFRleHQ9ZnVuY3Rpb24oYSl7dmFyIGI9IiIsYztmb3IodmFyIGQ9MDthW2RdO2QrKyljPWFbZF0sYy5ub2RlVHlwZT09PTN8fGMubm9kZVR5cGU9PT00P2IrPWMubm9kZVZhbHVlOmMubm9kZVR5cGUhPT04JiYoYis9ay5nZXRUZXh0KGMuY2hpbGROb2RlcykpO3JldHVybiBifSxmdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudCgiZGl2IiksZD0ic2NyaXB0IisobmV3IERhdGUpLmdldFRpbWUoKSxlPWMuZG9jdW1lbnRFbGVtZW50O2EuaW5uZXJIVE1MPSI8YSBuYW1lPSciK2QrIicvPiIsZS5pbnNlcnRCZWZvcmUoYSxlLmZpcnN0Q2hpbGQpLGMuZ2V0RWxlbWVudEJ5SWQoZCkmJihsLmZpbmQuSUQ9ZnVuY3Rpb24oYSxjLGQpe2lmKHR5cGVvZiBjLmdldEVsZW1lbnRCeUlkIT09InVuZGVmaW5lZCImJiFkKXt2YXIgZT1jLmdldEVsZW1lbnRCeUlkKGFbMV0pO3JldHVybiBlP2UuaWQ9PT1hWzFdfHx0eXBlb2YgZS5nZXRBdHRyaWJ1dGVOb2RlIT09InVuZGVmaW5lZCImJmUuZ2V0QXR0cmlidXRlTm9kZSgiaWQiKS5ub2RlVmFsdWU9PT1hWzFdP1tlXTpiOltdfX0sbC5maWx0ZXIuSUQ9ZnVuY3Rpb24oYSxiKXt2YXIgYz10eXBlb2YgYS5nZXRBdHRyaWJ1dGVOb2RlIT09InVuZGVmaW5lZCImJmEuZ2V0QXR0cmlidXRlTm9kZSgiaWQiKTtyZXR1cm4gYS5ub2RlVHlwZT09PTEmJmMmJmMubm9kZVZhbHVlPT09Yn0pLGUucmVtb3ZlQ2hpbGQoYSksZT1hPW51bGx9KCksZnVuY3Rpb24oKXt2YXIgYT1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpO2EuYXBwZW5kQ2hpbGQoYy5jcmVhdGVDb21tZW50KCIiKSksYS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aD4wJiYobC5maW5kLlRBRz1mdW5jdGlvbihhLGIpe3ZhciBjPWIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYVsxXSk7aWYoYVsxXT09PSIqIil7dmFyIGQ9W107Zm9yKHZhciBlPTA7Y1tlXTtlKyspY1tlXS5ub2RlVHlwZT09PTEmJmQucHVzaChjW2VdKTtjPWR9cmV0dXJuIGN9KSxhLmlubmVySFRNTD0iPGEgaHJlZj0nIyc+PC9hPiIsYS5maXJzdENoaWxkJiZ0eXBlb2YgYS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSE9PSJ1bmRlZmluZWQiJiZhLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJocmVmIikhPT0iIyImJihsLmF0dHJIYW5kbGUuaHJlZj1mdW5jdGlvbihhKXtyZXR1cm4gYS5nZXRBdHRyaWJ1dGUoImhyZWYiLDIpfSksYT1udWxsfSgpLGMucXVlcnlTZWxlY3RvckFsbCYmZnVuY3Rpb24oKXt2YXIgYT1rLGI9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKSxkPSJfX3NpenpsZV9fIjtiLmlubmVySFRNTD0iPHAgY2xhc3M9J1RFU1QnPjwvcD4iO2lmKCFiLnF1ZXJ5U2VsZWN0b3JBbGx8fGIucXVlcnlTZWxlY3RvckFsbCgiLlRFU1QiKS5sZW5ndGghPT0wKXtrPWZ1bmN0aW9uKGIsZSxmLGcpe2U9ZXx8YztpZighZyYmIWsuaXNYTUwoZSkpe3ZhciBoPS9eKFx3KyQpfF5cLihbXHdcLV0rJCl8XiMoW1x3XC1dKyQpLy5leGVjKGIpO2lmKGgmJihlLm5vZGVUeXBlPT09MXx8ZS5ub2RlVHlwZT09PTkpKXtpZihoWzFdKXJldHVybiBwKGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYiksZik7aWYoaFsyXSYmbC5maW5kLkNMQVNTJiZlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpcmV0dXJuIHAoZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGhbMl0pLGYpfWlmKGUubm9kZVR5cGU9PT05KXtpZihiPT09ImJvZHkiJiZlLmJvZHkpcmV0dXJuIHAoW2UuYm9keV0sZik7aWYoaCYmaFszXSl7dmFyIGk9ZS5nZXRFbGVtZW50QnlJZChoWzNdKTtpZighaXx8IWkucGFyZW50Tm9kZSlyZXR1cm4gcChbXSxmKTtpZihpLmlkPT09aFszXSlyZXR1cm4gcChbaV0sZil9dHJ5e3JldHVybiBwKGUucXVlcnlTZWxlY3RvckFsbChiKSxmKX1jYXRjaChqKXt9fWVsc2UgaWYoZS5ub2RlVHlwZT09PTEmJmUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSE9PSJvYmplY3QiKXt2YXIgbT1lLG49ZS5nZXRBdHRyaWJ1dGUoImlkIiksbz1ufHxkLHE9ZS5wYXJlbnROb2RlLHI9L15ccypbK35dLy50ZXN0KGIpO24/bz1vLnJlcGxhY2UoLycvZywiXFwkJiIpOmUuc2V0QXR0cmlidXRlKCJpZCIsbyksciYmcSYmKGU9ZS5wYXJlbnROb2RlKTt0cnl7aWYoIXJ8fHEpcmV0dXJuIHAoZS5xdWVyeVNlbGVjdG9yQWxsKCJbaWQ9JyIrbysiJ10gIitiKSxmKX1jYXRjaChzKXt9ZmluYWxseXtufHxtLnJlbW92ZUF0dHJpYnV0ZSgiaWQiKX19fXJldHVybiBhKGIsZSxmLGcpfTtmb3IodmFyIGUgaW4gYSlrW2VdPWFbZV07Yj1udWxsfX0oKSxmdW5jdGlvbigpe3ZhciBhPWMuZG9jdW1lbnRFbGVtZW50LGI9YS5tYXRjaGVzU2VsZWN0b3J8fGEubW96TWF0Y2hlc1NlbGVjdG9yfHxhLndlYmtpdE1hdGNoZXNTZWxlY3Rvcnx8YS5tc01hdGNoZXNTZWxlY3RvcjtpZihiKXt2YXIgZD0hYi5jYWxsKGMuY3JlYXRlRWxlbWVudCgiZGl2IiksImRpdiIpLGU9ITE7dHJ5e2IuY2FsbChjLmRvY3VtZW50RWxlbWVudCwiW3Rlc3QhPScnXTpzaXp6bGUiKX1jYXRjaChmKXtlPSEwfWsubWF0Y2hlc1NlbGVjdG9yPWZ1bmN0aW9uKGEsYyl7Yz1jLnJlcGxhY2UoL1w9XHMqKFteJyJcXV0qKVxzKlxdL2csIj0nJDEnXSIpO2lmKCFrLmlzWE1MKGEpKXRyeXtpZihlfHwhbC5tYXRjaC5QU0VVRE8udGVzdChjKSYmIS8hPS8udGVzdChjKSl7dmFyIGY9Yi5jYWxsKGEsYyk7aWYoZnx8IWR8fGEuZG9jdW1lbnQmJmEuZG9jdW1lbnQubm9kZVR5cGUhPT0xMSlyZXR1cm4gZn19Y2F0Y2goZyl7fXJldHVybiBrKGMsbnVsbCxudWxsLFthXSkubGVuZ3RoPjB9fX0oKSxmdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudCgiZGl2Iik7YS5pbm5lckhUTUw9IjxkaXYgY2xhc3M9J3Rlc3QgZSc+PC9kaXY+PGRpdiBjbGFzcz0ndGVzdCc+PC9kaXY+IjtpZihhLmdldEVsZW1lbnRzQnlDbGFzc05hbWUmJmEuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZSIpLmxlbmd0aCE9PTApe2EubGFzdENoaWxkLmNsYXNzTmFtZT0iZSI7aWYoYS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJlIikubGVuZ3RoPT09MSlyZXR1cm47bC5vcmRlci5zcGxpY2UoMSwwLCJDTEFTUyIpLGwuZmluZC5DTEFTUz1mdW5jdGlvbihhLGIsYyl7aWYodHlwZW9mIGIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSE9PSJ1bmRlZmluZWQiJiYhYylyZXR1cm4gYi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGFbMV0pfSxhPW51bGx9fSgpLGMuZG9jdW1lbnRFbGVtZW50LmNvbnRhaW5zP2suY29udGFpbnM9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYSE9PWImJihhLmNvbnRhaW5zP2EuY29udGFpbnMoYik6ITApfTpjLmRvY3VtZW50RWxlbWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj9rLmNvbnRhaW5zPWZ1bmN0aW9uKGEsYil7cmV0dXJuISEoYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSYxNil9OmsuY29udGFpbnM9ZnVuY3Rpb24oKXtyZXR1cm4hMX0say5pc1hNTD1mdW5jdGlvbihhKXt2YXIgYj0oYT9hLm93bmVyRG9jdW1lbnR8fGE6MCkuZG9jdW1lbnRFbGVtZW50O3JldHVybiBiP2Iubm9kZU5hbWUhPT0iSFRNTCI6ITF9O3ZhciB2PWZ1bmN0aW9uKGEsYil7dmFyIGMsZD1bXSxlPSIiLGY9Yi5ub2RlVHlwZT9bYl06Yjt3aGlsZShjPWwubWF0Y2guUFNFVURPLmV4ZWMoYSkpZSs9Y1swXSxhPWEucmVwbGFjZShsLm1hdGNoLlBTRVVETywiIik7YT1sLnJlbGF0aXZlW2FdP2ErIioiOmE7Zm9yKHZhciBnPTAsaD1mLmxlbmd0aDtnPGg7ZysrKWsoYSxmW2ddLGQpO3JldHVybiBrLmZpbHRlcihlLGQpfTtkLmZpbmQ9ayxkLmV4cHI9ay5zZWxlY3RvcnMsZC5leHByWyI6Il09ZC5leHByLmZpbHRlcnMsZC51bmlxdWU9ay51bmlxdWVTb3J0LGQudGV4dD1rLmdldFRleHQsZC5pc1hNTERvYz1rLmlzWE1MLGQuY29udGFpbnM9ay5jb250YWluc30oKTt2YXIgST0vVW50aWwkLyxKPS9eKD86cGFyZW50c3xwcmV2VW50aWx8cHJldkFsbCkvLEs9LywvLEw9L14uW146I1xbXC4sXSokLyxNPUFycmF5LnByb3RvdHlwZS5zbGljZSxOPWQuZXhwci5tYXRjaC5QT1MsTz17Y2hpbGRyZW46ITAsY29udGVudHM6ITAsbmV4dDohMCxwcmV2OiEwfTtkLmZuLmV4dGVuZCh7ZmluZDpmdW5jdGlvbihhKXt2YXIgYj10aGlzLnB1c2hTdGFjaygiIiwiZmluZCIsYSksYz0wO2Zvcih2YXIgZT0wLGY9dGhpcy5sZW5ndGg7ZTxmO2UrKyl7Yz1iLmxlbmd0aCxkLmZpbmQoYSx0aGlzW2VdLGIpO2lmKGU+MClmb3IodmFyIGc9YztnPGIubGVuZ3RoO2crKylmb3IodmFyIGg9MDtoPGM7aCsrKWlmKGJbaF09PT1iW2ddKXtiLnNwbGljZShnLS0sMSk7YnJlYWt9fXJldHVybiBifSxoYXM6ZnVuY3Rpb24oYSl7dmFyIGI9ZChhKTtyZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24oKXtmb3IodmFyIGE9MCxjPWIubGVuZ3RoO2E8YzthKyspaWYoZC5jb250YWlucyh0aGlzLGJbYV0pKXJldHVybiEwfSl9LG5vdDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2soUSh0aGlzLGEsITEpLCJub3QiLGEpfSxmaWx0ZXI6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKFEodGhpcyxhLCEwKSwiZmlsdGVyIixhKX0saXM6ZnVuY3Rpb24oYSl7cmV0dXJuISFhJiZkLmZpbHRlcihhLHRoaXMpLmxlbmd0aD4wfSxjbG9zZXN0OmZ1bmN0aW9uKGEsYil7dmFyIGM9W10sZSxmLGc9dGhpc1swXTtpZihkLmlzQXJyYXkoYSkpe3ZhciBoLGksaj17fSxrPTE7aWYoZyYmYS5sZW5ndGgpe2ZvcihlPTAsZj1hLmxlbmd0aDtlPGY7ZSsrKWk9YVtlXSxqW2ldfHwoaltpXT1kLmV4cHIubWF0Y2guUE9TLnRlc3QoaSk/ZChpLGJ8fHRoaXMuY29udGV4dCk6aSk7d2hpbGUoZyYmZy5vd25lckRvY3VtZW50JiZnIT09Yil7Zm9yKGkgaW4gailoPWpbaV0sKGguanF1ZXJ5P2guaW5kZXgoZyk+LTE6ZChnKS5pcyhoKSkmJmMucHVzaCh7c2VsZWN0b3I6aSxlbGVtOmcsbGV2ZWw6a30pO2c9Zy5wYXJlbnROb2RlLGsrK319cmV0dXJuIGN9dmFyIGw9Ti50ZXN0KGEpP2QoYSxifHx0aGlzLmNvbnRleHQpOm51bGw7Zm9yKGU9MCxmPXRoaXMubGVuZ3RoO2U8ZjtlKyspe2c9dGhpc1tlXTt3aGlsZShnKXtpZihsP2wuaW5kZXgoZyk+LTE6ZC5maW5kLm1hdGNoZXNTZWxlY3RvcihnLGEpKXtjLnB1c2goZyk7YnJlYWt9Zz1nLnBhcmVudE5vZGU7aWYoIWd8fCFnLm93bmVyRG9jdW1lbnR8fGc9PT1iKWJyZWFrfX1jPWMubGVuZ3RoPjE/ZC51bmlxdWUoYyk6YztyZXR1cm4gdGhpcy5wdXNoU3RhY2soYywiY2xvc2VzdCIsYSl9LGluZGV4OmZ1bmN0aW9uKGEpe2lmKCFhfHx0eXBlb2YgYT09PSJzdHJpbmciKXJldHVybiBkLmluQXJyYXkodGhpc1swXSxhP2QoYSk6dGhpcy5wYXJlbnQoKS5jaGlsZHJlbigpKTtyZXR1cm4gZC5pbkFycmF5KGEuanF1ZXJ5P2FbMF06YSx0aGlzKX0sYWRkOmZ1bmN0aW9uKGEsYil7dmFyIGM9dHlwZW9mIGE9PT0ic3RyaW5nIj9kKGEsYik6ZC5tYWtlQXJyYXkoYSksZT1kLm1lcmdlKHRoaXMuZ2V0KCksYyk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKFAoY1swXSl8fFAoZVswXSk/ZTpkLnVuaXF1ZShlKSl9LGFuZFNlbGY6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hZGQodGhpcy5wcmV2T2JqZWN0KX19KSxkLmVhY2goe3BhcmVudDpmdW5jdGlvbihhKXt2YXIgYj1hLnBhcmVudE5vZGU7cmV0dXJuIGImJmIubm9kZVR5cGUhPT0xMT9iOm51bGx9LHBhcmVudHM6ZnVuY3Rpb24oYSl7cmV0dXJuIGQuZGlyKGEsInBhcmVudE5vZGUiKX0scGFyZW50c1VudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZC5kaXIoYSwicGFyZW50Tm9kZSIsYyl9LG5leHQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGQubnRoKGEsMiwibmV4dFNpYmxpbmciKX0scHJldjpmdW5jdGlvbihhKXtyZXR1cm4gZC5udGgoYSwyLCJwcmV2aW91c1NpYmxpbmciKX0sbmV4dEFsbDpmdW5jdGlvbihhKXtyZXR1cm4gZC5kaXIoYSwibmV4dFNpYmxpbmciKX0scHJldkFsbDpmdW5jdGlvbihhKXtyZXR1cm4gZC5kaXIoYSwicHJldmlvdXNTaWJsaW5nIil9LG5leHRVbnRpbDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGQuZGlyKGEsIm5leHRTaWJsaW5nIixjKX0scHJldlVudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZC5kaXIoYSwicHJldmlvdXNTaWJsaW5nIixjKX0sc2libGluZ3M6ZnVuY3Rpb24oYSl7cmV0dXJuIGQuc2libGluZyhhLnBhcmVudE5vZGUuZmlyc3RDaGlsZCxhKX0sY2hpbGRyZW46ZnVuY3Rpb24oYSl7cmV0dXJuIGQuc2libGluZyhhLmZpcnN0Q2hpbGQpfSxjb250ZW50czpmdW5jdGlvbihhKXtyZXR1cm4gZC5ub2RlTmFtZShhLCJpZnJhbWUiKT9hLmNvbnRlbnREb2N1bWVudHx8YS5jb250ZW50V2luZG93LmRvY3VtZW50OmQubWFrZUFycmF5KGEuY2hpbGROb2Rlcyl9fSxmdW5jdGlvbihhLGIpe2QuZm5bYV09ZnVuY3Rpb24oYyxlKXt2YXIgZj1kLm1hcCh0aGlzLGIsYyksZz1NLmNhbGwoYXJndW1lbnRzKTtJLnRlc3QoYSl8fChlPWMpLGUmJnR5cGVvZiBlPT09InN0cmluZyImJihmPWQuZmlsdGVyKGUsZikpLGY9dGhpcy5sZW5ndGg+MSYmIU9bYV0/ZC51bmlxdWUoZik6ZiwodGhpcy5sZW5ndGg+MXx8Sy50ZXN0KGUpKSYmSi50ZXN0KGEpJiYoZj1mLnJldmVyc2UoKSk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGYsYSxnLmpvaW4oIiwiKSl9fSksZC5leHRlbmQoe2ZpbHRlcjpmdW5jdGlvbihhLGIsYyl7YyYmKGE9Ijpub3QoIithKyIpIik7cmV0dXJuIGIubGVuZ3RoPT09MT9kLmZpbmQubWF0Y2hlc1NlbGVjdG9yKGJbMF0sYSk/W2JbMF1dOltdOmQuZmluZC5tYXRjaGVzKGEsYil9LGRpcjpmdW5jdGlvbihhLGMsZSl7dmFyIGY9W10sZz1hW2NdO3doaWxlKGcmJmcubm9kZVR5cGUhPT05JiYoZT09PWJ8fGcubm9kZVR5cGUhPT0xfHwhZChnKS5pcyhlKSkpZy5ub2RlVHlwZT09PTEmJmYucHVzaChnKSxnPWdbY107cmV0dXJuIGZ9LG50aDpmdW5jdGlvbihhLGIsYyxkKXtiPWJ8fDE7dmFyIGU9MDtmb3IoO2E7YT1hW2NdKWlmKGEubm9kZVR5cGU9PT0xJiYrK2U9PT1iKWJyZWFrO3JldHVybiBhfSxzaWJsaW5nOmZ1bmN0aW9uKGEsYil7dmFyIGM9W107Zm9yKDthO2E9YS5uZXh0U2libGluZylhLm5vZGVUeXBlPT09MSYmYSE9PWImJmMucHVzaChhKTtyZXR1cm4gY319KTt2YXIgUj0vIGpRdWVyeVxkKz0iKD86XGQrfG51bGwpIi9nLFM9L15ccysvLFQ9LzwoPyFhcmVhfGJyfGNvbHxlbWJlZHxocnxpbWd8aW5wdXR8bGlua3xtZXRhfHBhcmFtKSgoW1x3Ol0rKVtePl0qKVwvPi9pZyxVPS88KFtcdzpdKykvLFY9Lzx0Ym9keS9pLFc9Lzx8JiM/XHcrOy8sWD0vPCg/OnNjcmlwdHxvYmplY3R8ZW1iZWR8b3B0aW9ufHN0eWxlKS9pLFk9L2NoZWNrZWRccyooPzpbXj1dfD1ccyouY2hlY2tlZC4pL2ksWj17b3B0aW9uOlsxLCI8c2VsZWN0IG11bHRpcGxlPSdtdWx0aXBsZSc+IiwiPC9zZWxlY3Q+Il0sbGVnZW5kOlsxLCI8ZmllbGRzZXQ+IiwiPC9maWVsZHNldD4iXSx0aGVhZDpbMSwiPHRhYmxlPiIsIjwvdGFibGU+Il0sdHI6WzIsIjx0YWJsZT48dGJvZHk+IiwiPC90Ym9keT48L3RhYmxlPiJdLHRkOlszLCI8dGFibGU+PHRib2R5Pjx0cj4iLCI8L3RyPjwvdGJvZHk+PC90YWJsZT4iXSxjb2w6WzIsIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+IiwiPC9jb2xncm91cD48L3RhYmxlPiJdLGFyZWE6WzEsIjxtYXA+IiwiPC9tYXA+Il0sX2RlZmF1bHQ6WzAsIiIsIiJdfTtaLm9wdGdyb3VwPVoub3B0aW9uLFoudGJvZHk9Wi50Zm9vdD1aLmNvbGdyb3VwPVouY2FwdGlvbj1aLnRoZWFkLFoudGg9Wi50ZCxkLnN1cHBvcnQuaHRtbFNlcmlhbGl6ZXx8KFouX2RlZmF1bHQ9WzEsImRpdjxkaXY+IiwiPC9kaXY+Il0pLGQuZm4uZXh0ZW5kKHt0ZXh0OmZ1bmN0aW9uKGEpe2lmKGQuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWQodGhpcyk7Yy50ZXh0KGEuY2FsbCh0aGlzLGIsYy50ZXh0KCkpKX0pO2lmKHR5cGVvZiBhIT09Im9iamVjdCImJmEhPT1iKXJldHVybiB0aGlzLmVtcHR5KCkuYXBwZW5kKCh0aGlzWzBdJiZ0aGlzWzBdLm93bmVyRG9jdW1lbnR8fGMpLmNyZWF0ZVRleHROb2RlKGEpKTtyZXR1cm4gZC50ZXh0KHRoaXMpfSx3cmFwQWxsOmZ1bmN0aW9uKGEpe2lmKGQuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe2QodGhpcykud3JhcEFsbChhLmNhbGwodGhpcyxiKSl9KTtpZih0aGlzWzBdKXt2YXIgYj1kKGEsdGhpc1swXS5vd25lckRvY3VtZW50KS5lcSgwKS5jbG9uZSghMCk7dGhpc1swXS5wYXJlbnROb2RlJiZiLmluc2VydEJlZm9yZSh0aGlzWzBdKSxiLm1hcChmdW5jdGlvbigpe3ZhciBhPXRoaXM7d2hpbGUoYS5maXJzdENoaWxkJiZhLmZpcnN0Q2hpbGQubm9kZVR5cGU9PT0xKWE9YS5maXJzdENoaWxkO3JldHVybiBhfSkuYXBwZW5kKHRoaXMpfXJldHVybiB0aGlzfSx3cmFwSW5uZXI6ZnVuY3Rpb24oYSl7aWYoZC5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7ZCh0aGlzKS53cmFwSW5uZXIoYS5jYWxsKHRoaXMsYikpfSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWQodGhpcyksYz1iLmNvbnRlbnRzKCk7Yy5sZW5ndGg/Yy53cmFwQWxsKGEpOmIuYXBwZW5kKGEpfSl9LHdyYXA6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2QodGhpcykud3JhcEFsbChhKX0pfSx1bndyYXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCl7ZC5ub2RlTmFtZSh0aGlzLCJib2R5Iil8fGQodGhpcykucmVwbGFjZVdpdGgodGhpcy5jaGlsZE5vZGVzKX0pLmVuZCgpfSxhcHBlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITAsZnVuY3Rpb24oYSl7dGhpcy5ub2RlVHlwZT09PTEmJnRoaXMuYXBwZW5kQ2hpbGQoYSl9KX0scHJlcGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMCxmdW5jdGlvbihhKXt0aGlzLm5vZGVUeXBlPT09MSYmdGhpcy5pbnNlcnRCZWZvcmUoYSx0aGlzLmZpcnN0Q2hpbGQpfSl9LGJlZm9yZTpmdW5jdGlvbigpe2lmKHRoaXNbMF0mJnRoaXNbMF0ucGFyZW50Tm9kZSlyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITEsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLHRoaXMpfSk7aWYoYXJndW1lbnRzLmxlbmd0aCl7dmFyIGE9ZChhcmd1bWVudHNbMF0pO2EucHVzaC5hcHBseShhLHRoaXMudG9BcnJheSgpKTtyZXR1cm4gdGhpcy5wdXNoU3RhY2soYSwiYmVmb3JlIixhcmd1bWVudHMpfX0sYWZ0ZXI6ZnVuY3Rpb24oKXtpZih0aGlzWzBdJiZ0aGlzWzBdLnBhcmVudE5vZGUpcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCExLGZ1bmN0aW9uKGEpe3RoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSx0aGlzLm5leHRTaWJsaW5nKX0pO2lmKGFyZ3VtZW50cy5sZW5ndGgpe3ZhciBhPXRoaXMucHVzaFN0YWNrKHRoaXMsImFmdGVyIixhcmd1bWVudHMpO2EucHVzaC5hcHBseShhLGQoYXJndW1lbnRzWzBdKS50b0FycmF5KCkpO3JldHVybiBhfX0scmVtb3ZlOmZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPTAsZTsoZT10aGlzW2NdKSE9bnVsbDtjKyspaWYoIWF8fGQuZmlsdGVyKGEsW2VdKS5sZW5ndGgpIWImJmUubm9kZVR5cGU9PT0xJiYoZC5jbGVhbkRhdGEoZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpKSxkLmNsZWFuRGF0YShbZV0pKSxlLnBhcmVudE5vZGUmJmUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlKTtyZXR1cm4gdGhpc30sZW1wdHk6ZnVuY3Rpb24oKXtmb3IodmFyIGE9MCxiOyhiPXRoaXNbYV0pIT1udWxsO2ErKyl7Yi5ub2RlVHlwZT09PTEmJmQuY2xlYW5EYXRhKGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSk7d2hpbGUoYi5maXJzdENoaWxkKWIucmVtb3ZlQ2hpbGQoYi5maXJzdENoaWxkKX1yZXR1cm4gdGhpc30sY2xvbmU6ZnVuY3Rpb24oYSxiKXthPWE9PW51bGw/ITE6YSxiPWI9PW51bGw/YTpiO3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3JldHVybiBkLmNsb25lKHRoaXMsYSxiKX0pfSxodG1sOmZ1bmN0aW9uKGEpe2lmKGE9PT1iKXJldHVybiB0aGlzWzBdJiZ0aGlzWzBdLm5vZGVUeXBlPT09MT90aGlzWzBdLmlubmVySFRNTC5yZXBsYWNlKFIsIiIpOm51bGw7aWYodHlwZW9mIGEhPT0ic3RyaW5nInx8WC50ZXN0KGEpfHwhZC5zdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlJiZTLnRlc3QoYSl8fFpbKFUuZXhlYyhhKXx8WyIiLCIiXSlbMV0udG9Mb3dlckNhc2UoKV0pZC5pc0Z1bmN0aW9uKGEpP3RoaXMuZWFjaChmdW5jdGlvbihiKXt2YXIgYz1kKHRoaXMpO2MuaHRtbChhLmNhbGwodGhpcyxiLGMuaHRtbCgpKSl9KTp0aGlzLmVtcHR5KCkuYXBwZW5kKGEpO2Vsc2V7YT1hLnJlcGxhY2UoVCwiPCQxPjwvJDI+Iik7dHJ5e2Zvcih2YXIgYz0wLGU9dGhpcy5sZW5ndGg7YzxlO2MrKyl0aGlzW2NdLm5vZGVUeXBlPT09MSYmKGQuY2xlYW5EYXRhKHRoaXNbY10uZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSksdGhpc1tjXS5pbm5lckhUTUw9YSl9Y2F0Y2goZil7dGhpcy5lbXB0eSgpLmFwcGVuZChhKX19cmV0dXJuIHRoaXN9LHJlcGxhY2VXaXRoOmZ1bmN0aW9uKGEpe2lmKHRoaXNbMF0mJnRoaXNbMF0ucGFyZW50Tm9kZSl7aWYoZC5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7dmFyIGM9ZCh0aGlzKSxlPWMuaHRtbCgpO2MucmVwbGFjZVdpdGgoYS5jYWxsKHRoaXMsYixlKSl9KTt0eXBlb2YgYSE9PSJzdHJpbmciJiYoYT1kKGEpLmRldGFjaCgpKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5uZXh0U2libGluZyxjPXRoaXMucGFyZW50Tm9kZTtkKHRoaXMpLnJlbW92ZSgpLGI/ZChiKS5iZWZvcmUoYSk6ZChjKS5hcHBlbmQoYSl9KX1yZXR1cm4gdGhpcy5sZW5ndGg/dGhpcy5wdXNoU3RhY2soZChkLmlzRnVuY3Rpb24oYSk/YSgpOmEpLCJyZXBsYWNlV2l0aCIsYSk6dGhpc30sZGV0YWNoOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnJlbW92ZShhLCEwKX0sZG9tTWFuaXA6ZnVuY3Rpb24oYSxjLGUpe3ZhciBmLGcsaCxpLGo9YVswXSxrPVtdO2lmKCFkLnN1cHBvcnQuY2hlY2tDbG9uZSYmYXJndW1lbnRzLmxlbmd0aD09PTMmJnR5cGVvZiBqPT09InN0cmluZyImJlkudGVzdChqKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7ZCh0aGlzKS5kb21NYW5pcChhLGMsZSwhMCl9KTtpZihkLmlzRnVuY3Rpb24oaikpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihmKXt2YXIgZz1kKHRoaXMpO2FbMF09ai5jYWxsKHRoaXMsZixjP2cuaHRtbCgpOmIpLGcuZG9tTWFuaXAoYSxjLGUpfSk7aWYodGhpc1swXSl7aT1qJiZqLnBhcmVudE5vZGUsZC5zdXBwb3J0LnBhcmVudE5vZGUmJmkmJmkubm9kZVR5cGU9PT0xMSYmaS5jaGlsZE5vZGVzLmxlbmd0aD09PXRoaXMubGVuZ3RoP2Y9e2ZyYWdtZW50Oml9OmY9ZC5idWlsZEZyYWdtZW50KGEsdGhpcyxrKSxoPWYuZnJhZ21lbnQsaC5jaGlsZE5vZGVzLmxlbmd0aD09PTE/Zz1oPWguZmlyc3RDaGlsZDpnPWguZmlyc3RDaGlsZDtpZihnKXtjPWMmJmQubm9kZU5hbWUoZywidHIiKTtmb3IodmFyIGw9MCxtPXRoaXMubGVuZ3RoLG49bS0xO2w8bTtsKyspZS5jYWxsKGM/JCh0aGlzW2xdLGcpOnRoaXNbbF0sZi5jYWNoZWFibGV8fG0+MSYmbDxuP2QuY2xvbmUoaCwhMCwhMCk6aCl9ay5sZW5ndGgmJmQuZWFjaChrLGJjKX1yZXR1cm4gdGhpc319KSxkLmJ1aWxkRnJhZ21lbnQ9ZnVuY3Rpb24oYSxiLGUpe3ZhciBmLGcsaCxpPWImJmJbMF0/YlswXS5vd25lckRvY3VtZW50fHxiWzBdOmM7YS5sZW5ndGg9PT0xJiZ0eXBlb2YgYVswXT09PSJzdHJpbmciJiZhWzBdLmxlbmd0aDw1MTImJmk9PT1jJiZhWzBdLmNoYXJBdCgwKT09PSI8IiYmIVgudGVzdChhWzBdKSYmKGQuc3VwcG9ydC5jaGVja0Nsb25lfHwhWS50ZXN0KGFbMF0pKSYmKGc9ITAsaD1kLmZyYWdtZW50c1thWzBdXSxoJiYoaCE9PTEmJihmPWgpKSksZnx8KGY9aS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksZC5jbGVhbihhLGksZixlKSksZyYmKGQuZnJhZ21lbnRzW2FbMF1dPWg/ZjoxKTtyZXR1cm57ZnJhZ21lbnQ6ZixjYWNoZWFibGU6Z319LGQuZnJhZ21lbnRzPXt9LGQuZWFjaCh7YXBwZW5kVG86ImFwcGVuZCIscHJlcGVuZFRvOiJwcmVwZW5kIixpbnNlcnRCZWZvcmU6ImJlZm9yZSIsaW5zZXJ0QWZ0ZXI6ImFmdGVyIixyZXBsYWNlQWxsOiJyZXBsYWNlV2l0aCJ9LGZ1bmN0aW9uKGEsYil7ZC5mblthXT1mdW5jdGlvbihjKXt2YXIgZT1bXSxmPWQoYyksZz10aGlzLmxlbmd0aD09PTEmJnRoaXNbMF0ucGFyZW50Tm9kZTtpZihnJiZnLm5vZGVUeXBlPT09MTEmJmcuY2hpbGROb2Rlcy5sZW5ndGg9PT0xJiZmLmxlbmd0aD09PTEpe2ZbYl0odGhpc1swXSk7cmV0dXJuIHRoaXN9Zm9yKHZhciBoPTAsaT1mLmxlbmd0aDtoPGk7aCsrKXt2YXIgaj0oaD4wP3RoaXMuY2xvbmUoITApOnRoaXMpLmdldCgpO2QoZltoXSlbYl0oaiksZT1lLmNvbmNhdChqKX1yZXR1cm4gdGhpcy5wdXNoU3RhY2soZSxhLGYuc2VsZWN0b3IpfX0pLGQuZXh0ZW5kKHtjbG9uZTpmdW5jdGlvbihhLGIsYyl7dmFyIGU9YS5jbG9uZU5vZGUoITApLGYsZyxoO2lmKCghZC5zdXBwb3J0Lm5vQ2xvbmVFdmVudHx8IWQuc3VwcG9ydC5ub0Nsb25lQ2hlY2tlZCkmJihhLm5vZGVUeXBlPT09MXx8YS5ub2RlVHlwZT09PTExKSYmIWQuaXNYTUxEb2MoYSkpe2JhKGEsZSksZj1iYihhKSxnPWJiKGUpO2ZvcihoPTA7ZltoXTsrK2gpYmEoZltoXSxnW2hdKX1pZihiKXtfKGEsZSk7aWYoYyl7Zj1iYihhKSxnPWJiKGUpO2ZvcihoPTA7ZltoXTsrK2gpXyhmW2hdLGdbaF0pfX1yZXR1cm4gZX0sY2xlYW46ZnVuY3Rpb24oYSxiLGUsZil7Yj1ifHxjLHR5cGVvZiBiLmNyZWF0ZUVsZW1lbnQ9PT0idW5kZWZpbmVkIiYmKGI9Yi5vd25lckRvY3VtZW50fHxiWzBdJiZiWzBdLm93bmVyRG9jdW1lbnR8fGMpO3ZhciBnPVtdO2Zvcih2YXIgaD0wLGk7KGk9YVtoXSkhPW51bGw7aCsrKXt0eXBlb2YgaT09PSJudW1iZXIiJiYoaSs9IiIpO2lmKCFpKWNvbnRpbnVlO2lmKHR5cGVvZiBpIT09InN0cmluZyJ8fFcudGVzdChpKSl7aWYodHlwZW9mIGk9PT0ic3RyaW5nIil7aT1pLnJlcGxhY2UoVCwiPCQxPjwvJDI+Iik7dmFyIGo9KFUuZXhlYyhpKXx8WyIiLCIiXSlbMV0udG9Mb3dlckNhc2UoKSxrPVpbal18fFouX2RlZmF1bHQsbD1rWzBdLG09Yi5jcmVhdGVFbGVtZW50KCJkaXYiKTttLmlubmVySFRNTD1rWzFdK2kra1syXTt3aGlsZShsLS0pbT1tLmxhc3RDaGlsZDtpZighZC5zdXBwb3J0LnRib2R5KXt2YXIgbj1WLnRlc3QoaSksbz1qPT09InRhYmxlIiYmIW4/bS5maXJzdENoaWxkJiZtLmZpcnN0Q2hpbGQuY2hpbGROb2RlczprWzFdPT09Ijx0YWJsZT4iJiYhbj9tLmNoaWxkTm9kZXM6W107Zm9yKHZhciBwPW8ubGVuZ3RoLTE7cD49MDstLXApZC5ub2RlTmFtZShvW3BdLCJ0Ym9keSIpJiYhb1twXS5jaGlsZE5vZGVzLmxlbmd0aCYmb1twXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG9bcF0pfSFkLnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UmJlMudGVzdChpKSYmbS5pbnNlcnRCZWZvcmUoYi5jcmVhdGVUZXh0Tm9kZShTLmV4ZWMoaSlbMF0pLG0uZmlyc3RDaGlsZCksaT1tLmNoaWxkTm9kZXN9fWVsc2UgaT1iLmNyZWF0ZVRleHROb2RlKGkpO2kubm9kZVR5cGU/Zy5wdXNoKGkpOmc9ZC5tZXJnZShnLGkpfWlmKGUpZm9yKGg9MDtnW2hdO2grKykhZnx8IWQubm9kZU5hbWUoZ1toXSwic2NyaXB0Iil8fGdbaF0udHlwZSYmZ1toXS50eXBlLnRvTG93ZXJDYXNlKCkhPT0idGV4dC9qYXZhc2NyaXB0Ij8oZ1toXS5ub2RlVHlwZT09PTEmJmcuc3BsaWNlLmFwcGx5KGcsW2grMSwwXS5jb25jYXQoZC5tYWtlQXJyYXkoZ1toXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IikpKSksZS5hcHBlbmRDaGlsZChnW2hdKSk6Zi5wdXNoKGdbaF0ucGFyZW50Tm9kZT9nW2hdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZ1toXSk6Z1toXSk7cmV0dXJuIGd9LGNsZWFuRGF0YTpmdW5jdGlvbihhKXt2YXIgYixjLGU9ZC5jYWNoZSxmPWQuZXhwYW5kbyxnPWQuZXZlbnQuc3BlY2lhbCxoPWQuc3VwcG9ydC5kZWxldGVFeHBhbmRvO2Zvcih2YXIgaT0wLGo7KGo9YVtpXSkhPW51bGw7aSsrKXtpZihqLm5vZGVOYW1lJiZkLm5vRGF0YVtqLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKWNvbnRpbnVlO2M9altkLmV4cGFuZG9dO2lmKGMpe2I9ZVtjXSYmZVtjXVtmXTtpZihiJiZiLmV2ZW50cyl7Zm9yKHZhciBrIGluIGIuZXZlbnRzKWdba10/ZC5ldmVudC5yZW1vdmUoaixrKTpkLnJlbW92ZUV2ZW50KGosayxiLmhhbmRsZSk7Yi5oYW5kbGUmJihiLmhhbmRsZS5lbGVtPW51bGwpfWg/ZGVsZXRlIGpbZC5leHBhbmRvXTpqLnJlbW92ZUF0dHJpYnV0ZSYmai5yZW1vdmVBdHRyaWJ1dGUoZC5leHBhbmRvKSxkZWxldGUgZVtjXX19fX0pO3ZhciBiZD0vYWxwaGFcKFteKV0qXCkvaSxiZT0vb3BhY2l0eT0oW14pXSopLyxiZj0vLShbYS16XSkvaWcsYmc9LyhbQS1aXXxebXMpL2csYmg9L14tP1xkKyg/OnB4KT8kL2ksYmk9L14tP1xkLyxiaj17cG9zaXRpb246ImFic29sdXRlIix2aXNpYmlsaXR5OiJoaWRkZW4iLGRpc3BsYXk6ImJsb2NrIn0sYms9WyJMZWZ0IiwiUmlnaHQiXSxibD1bIlRvcCIsIkJvdHRvbSJdLGJtLGJuLGJvLGJwPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGIudG9VcHBlckNhc2UoKX07ZC5mbi5jc3M9ZnVuY3Rpb24oYSxjKXtpZihhcmd1bWVudHMubGVuZ3RoPT09MiYmYz09PWIpcmV0dXJuIHRoaXM7cmV0dXJuIGQuYWNjZXNzKHRoaXMsYSxjLCEwLGZ1bmN0aW9uKGEsYyxlKXtyZXR1cm4gZSE9PWI/ZC5zdHlsZShhLGMsZSk6ZC5jc3MoYSxjKX0pfSxkLmV4dGVuZCh7Y3NzSG9va3M6e29wYWNpdHk6e2dldDpmdW5jdGlvbihhLGIpe2lmKGIpe3ZhciBjPWJtKGEsIm9wYWNpdHkiLCJvcGFjaXR5Iik7cmV0dXJuIGM9PT0iIj8iMSI6Y31yZXR1cm4gYS5zdHlsZS5vcGFjaXR5fX19LGNzc051bWJlcjp7ekluZGV4OiEwLGZvbnRXZWlnaHQ6ITAsb3BhY2l0eTohMCx6b29tOiEwLGxpbmVIZWlnaHQ6ITB9LGNzc1Byb3BzOnsiZmxvYXQiOmQuc3VwcG9ydC5jc3NGbG9hdD8iY3NzRmxvYXQiOiJzdHlsZUZsb2F0In0sc3R5bGU6ZnVuY3Rpb24oYSxjLGUsZil7aWYoYSYmYS5ub2RlVHlwZSE9PTMmJmEubm9kZVR5cGUhPT04JiZhLnN0eWxlKXt2YXIgZyxoPWQuY2FtZWxDYXNlKGMpLGk9YS5zdHlsZSxqPWQuY3NzSG9va3NbaF07Yz1kLmNzc1Byb3BzW2hdfHxoO2lmKGU9PT1iKXtpZihqJiYiZ2V0ImluIGomJihnPWouZ2V0KGEsITEsZikpIT09YilyZXR1cm4gZztyZXR1cm4gaVtjXX1pZih0eXBlb2YgZT09PSJudW1iZXIiJiZpc05hTihlKXx8ZT09bnVsbClyZXR1cm47dHlwZW9mIGU9PT0ibnVtYmVyIiYmIWQuY3NzTnVtYmVyW2hdJiYoZSs9InB4Iik7aWYoIWp8fCEoInNldCJpbiBqKXx8KGU9ai5zZXQoYSxlKSkhPT1iKXRyeXtpW2NdPWV9Y2F0Y2goayl7fX19LGNzczpmdW5jdGlvbihhLGMsZSl7dmFyIGYsZz1kLmNhbWVsQ2FzZShjKSxoPWQuY3NzSG9va3NbZ107Yz1kLmNzc1Byb3BzW2ddfHxnO2lmKGgmJiJnZXQiaW4gaCYmKGY9aC5nZXQoYSwhMCxlKSkhPT1iKXJldHVybiBmO2lmKGJtKXJldHVybiBibShhLGMsZyl9LHN3YXA6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXt9O2Zvcih2YXIgZSBpbiBiKWRbZV09YS5zdHlsZVtlXSxhLnN0eWxlW2VdPWJbZV07Yy5jYWxsKGEpO2ZvcihlIGluIGIpYS5zdHlsZVtlXT1kW2VdfSxjYW1lbENhc2U6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZShiZixicCl9fSksZC5jdXJDU1M9ZC5jc3MsZC5lYWNoKFsiaGVpZ2h0Iiwid2lkdGgiXSxmdW5jdGlvbihhLGIpe2QuY3NzSG9va3NbYl09e2dldDpmdW5jdGlvbihhLGMsZSl7dmFyIGY7aWYoYyl7YS5vZmZzZXRXaWR0aCE9PTA/Zj1icShhLGIsZSk6ZC5zd2FwKGEsYmosZnVuY3Rpb24oKXtmPWJxKGEsYixlKX0pO2lmKGY8PTApe2Y9Ym0oYSxiLGIpLGY9PT0iMHB4IiYmYm8mJihmPWJvKGEsYixiKSk7aWYoZiE9bnVsbClyZXR1cm4gZj09PSIifHxmPT09ImF1dG8iPyIwcHgiOmZ9aWYoZjwwfHxmPT1udWxsKXtmPWEuc3R5bGVbYl07cmV0dXJuIGY9PT0iInx8Zj09PSJhdXRvIj8iMHB4IjpmfXJldHVybiB0eXBlb2YgZj09PSJzdHJpbmciP2Y6ZisicHgifX0sc2V0OmZ1bmN0aW9uKGEsYil7aWYoIWJoLnRlc3QoYikpcmV0dXJuIGI7Yj1wYXJzZUZsb2F0KGIpO2lmKGI+PTApcmV0dXJuIGIrInB4In19fSksZC5zdXBwb3J0Lm9wYWNpdHl8fChkLmNzc0hvb2tzLm9wYWNpdHk9e2dldDpmdW5jdGlvbihhLGIpe3JldHVybiBiZS50ZXN0KChiJiZhLmN1cnJlbnRTdHlsZT9hLmN1cnJlbnRTdHlsZS5maWx0ZXI6YS5zdHlsZS5maWx0ZXIpfHwiIik/cGFyc2VGbG9hdChSZWdFeHAuJDEpLzEwMCsiIjpiPyIxIjoiIn0sc2V0OmZ1bmN0aW9uKGEsYil7dmFyIGM9YS5zdHlsZTtjLnpvb209MTt2YXIgZT1kLmlzTmFOKGIpPyIiOiJhbHBoYShvcGFjaXR5PSIrYioxMDArIikiLGY9Yy5maWx0ZXJ8fCIiO2MuZmlsdGVyPWJkLnRlc3QoZik/Zi5yZXBsYWNlKGJkLGUpOmMuZmlsdGVyKyIgIitlfX0pLGQoZnVuY3Rpb24oKXtkLnN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodHx8KGQuY3NzSG9va3MubWFyZ2luUmlnaHQ9e2dldDpmdW5jdGlvbihhLGIpe3ZhciBjO2Quc3dhcChhLHtkaXNwbGF5OiJpbmxpbmUtYmxvY2sifSxmdW5jdGlvbigpe2I/Yz1ibShhLCJtYXJnaW4tcmlnaHQiLCJtYXJnaW5SaWdodCIpOmM9YS5zdHlsZS5tYXJnaW5SaWdodH0pO3JldHVybiBjfX0pfSksYy5kZWZhdWx0VmlldyYmYy5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlJiYoYm49ZnVuY3Rpb24oYSxjLGUpe3ZhciBmLGcsaDtlPWUucmVwbGFjZShiZywiLSQxIikudG9Mb3dlckNhc2UoKTtpZighKGc9YS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3KSlyZXR1cm4gYjtpZihoPWcuZ2V0Q29tcHV0ZWRTdHlsZShhLG51bGwpKWY9aC5nZXRQcm9wZXJ0eVZhbHVlKGUpLGY9PT0iIiYmIWQuY29udGFpbnMoYS5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxhKSYmKGY9ZC5zdHlsZShhLGUpKTtyZXR1cm4gZn0pLGMuZG9jdW1lbnRFbGVtZW50LmN1cnJlbnRTdHlsZSYmKGJvPWZ1bmN0aW9uKGEsYil7dmFyIGMsZD1hLmN1cnJlbnRTdHlsZSYmYS5jdXJyZW50U3R5bGVbYl0sZT1hLnJ1bnRpbWVTdHlsZSYmYS5ydW50aW1lU3R5bGVbYl0sZj1hLnN0eWxlOyFiaC50ZXN0KGQpJiZiaS50ZXN0KGQpJiYoYz1mLmxlZnQsZSYmKGEucnVudGltZVN0eWxlLmxlZnQ9YS5jdXJyZW50U3R5bGUubGVmdCksZi5sZWZ0PWI9PT0iZm9udFNpemUiPyIxZW0iOmR8fDAsZD1mLnBpeGVsTGVmdCsicHgiLGYubGVmdD1jLGUmJihhLnJ1bnRpbWVTdHlsZS5sZWZ0PWUpKTtyZXR1cm4gZD09PSIiPyJhdXRvIjpkfSksYm09Ym58fGJvLGQuZXhwciYmZC5leHByLmZpbHRlcnMmJihkLmV4cHIuZmlsdGVycy5oaWRkZW49ZnVuY3Rpb24oYSl7dmFyIGI9YS5vZmZzZXRXaWR0aCxjPWEub2Zmc2V0SGVpZ2h0O3JldHVybiBiPT09MCYmYz09PTB8fCFkLnN1cHBvcnQucmVsaWFibGVIaWRkZW5PZmZzZXRzJiYoYS5zdHlsZS5kaXNwbGF5fHxkLmNzcyhhLCJkaXNwbGF5IikpPT09Im5vbmUifSxkLmV4cHIuZmlsdGVycy52aXNpYmxlPWZ1bmN0aW9uKGEpe3JldHVybiFkLmV4cHIuZmlsdGVycy5oaWRkZW4oYSl9KTt2YXIgYnI9LyUyMC9nLGJzPS9cW1xdJC8sYnQ9L1xyP1xuL2csYnU9LyMuKiQvLGJ2PS9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKVxyPyQvbWcsYnc9L14oPzpjb2xvcnxkYXRlfGRhdGV0aW1lfGVtYWlsfGhpZGRlbnxtb250aHxudW1iZXJ8cGFzc3dvcmR8cmFuZ2V8c2VhcmNofHRlbHx0ZXh0fHRpbWV8dXJsfHdlZWspJC9pLGJ4PS9eKD86YWJvdXR8YXBwfGFwcFwtc3RvcmFnZXwuK1wtZXh0ZW5zaW9ufGZpbGV8d2lkZ2V0KTokLyxieT0vXig/OkdFVHxIRUFEKSQvLGJ6PS9eXC9cLy8sYkE9L1w/LyxiQj0vPHNjcmlwdFxiW148XSooPzooPyE8XC9zY3JpcHQ+KTxbXjxdKikqPFwvc2NyaXB0Pi9naSxiQz0vXig/OnNlbGVjdHx0ZXh0YXJlYSkvaSxiRD0vXHMrLyxiRT0vKFs/Jl0pXz1bXiZdKi8sYkY9LyhefFwtKShbYS16XSkvZyxiRz1mdW5jdGlvbihhLGIsYyl7cmV0dXJuIGIrYy50b1VwcGVyQ2FzZSgpfSxiSD0vXihbXHdcK1wuXC1dKzopKD86XC9cLyhbXlwvPyM6XSopKD86OihcZCspKT8pPy8sYkk9ZC5mbi5sb2FkLGJKPXt9LGJLPXt9LGJMLGJNO3RyeXtiTD1jLmxvY2F0aW9uLmhyZWZ9Y2F0Y2goYk4pe2JMPWMuY3JlYXRlRWxlbWVudCgiYSIpLGJMLmhyZWY9IiIsYkw9YkwuaHJlZn1iTT1iSC5leGVjKGJMLnRvTG93ZXJDYXNlKCkpfHxbXSxkLmZuLmV4dGVuZCh7bG9hZDpmdW5jdGlvbihhLGMsZSl7aWYodHlwZW9mIGEhPT0ic3RyaW5nIiYmYkkpcmV0dXJuIGJJLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtpZighdGhpcy5sZW5ndGgpcmV0dXJuIHRoaXM7dmFyIGY9YS5pbmRleE9mKCIgIik7aWYoZj49MCl7dmFyIGc9YS5zbGljZShmLGEubGVuZ3RoKTthPWEuc2xpY2UoMCxmKX12YXIgaD0iR0VUIjtjJiYoZC5pc0Z1bmN0aW9uKGMpPyhlPWMsYz1iKTp0eXBlb2YgYz09PSJvYmplY3QiJiYoYz1kLnBhcmFtKGMsZC5hamF4U2V0dGluZ3MudHJhZGl0aW9uYWwpLGg9IlBPU1QiKSk7dmFyIGk9dGhpcztkLmFqYXgoe3VybDphLHR5cGU6aCxkYXRhVHlwZToiaHRtbCIsZGF0YTpjLGNvbXBsZXRlOmZ1bmN0aW9uKGEsYixjKXtjPWEucmVzcG9uc2VUZXh0LGEuaXNSZXNvbHZlZCgpJiYoYS5kb25lKGZ1bmN0aW9uKGEpe2M9YX0pLGkuaHRtbChnP2QoIjxkaXY+IikuYXBwZW5kKGMucmVwbGFjZShiQiwiIikpLmZpbmQoZyk6YykpLGUmJmkuZWFjaChlLFtjLGIsYV0pfX0pO3JldHVybiB0aGlzfSxzZXJpYWxpemU6ZnVuY3Rpb24oKXtyZXR1cm4gZC5wYXJhbSh0aGlzLnNlcmlhbGl6ZUFycmF5KCkpfSxzZXJpYWxpemVBcnJheTpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnRzP2QubWFrZUFycmF5KHRoaXMuZWxlbWVudHMpOnRoaXN9KS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5uYW1lJiYhdGhpcy5kaXNhYmxlZCYmKHRoaXMuY2hlY2tlZHx8YkMudGVzdCh0aGlzLm5vZGVOYW1lKXx8YncudGVzdCh0aGlzLnR5cGUpKX0pLm1hcChmdW5jdGlvbihhLGIpe3ZhciBjPWQodGhpcykudmFsKCk7cmV0dXJuIGM9PW51bGw/bnVsbDpkLmlzQXJyYXkoYyk/ZC5tYXAoYyxmdW5jdGlvbihhLGMpe3JldHVybntuYW1lOmIubmFtZSx2YWx1ZTphLnJlcGxhY2UoYnQsIlxyXG4iKX19KTp7bmFtZTpiLm5hbWUsdmFsdWU6Yy5yZXBsYWNlKGJ0LCJcclxuIil9fSkuZ2V0KCl9fSksZC5lYWNoKCJhamF4U3RhcnQgYWpheFN0b3AgYWpheENvbXBsZXRlIGFqYXhFcnJvciBhamF4U3VjY2VzcyBhamF4U2VuZCIuc3BsaXQoIiAiKSxmdW5jdGlvbihhLGIpe2QuZm5bYl09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuYmluZChiLGEpfX0pLGQuZWFjaChbImdldCIsInBvc3QiXSxmdW5jdGlvbihhLGMpe2RbY109ZnVuY3Rpb24oYSxlLGYsZyl7ZC5pc0Z1bmN0aW9uKGUpJiYoZz1nfHxmLGY9ZSxlPWIpO3JldHVybiBkLmFqYXgoe3R5cGU6Yyx1cmw6YSxkYXRhOmUsc3VjY2VzczpmLGRhdGFUeXBlOmd9KX19KSxkLmV4dGVuZCh7Z2V0U2NyaXB0OmZ1bmN0aW9uKGEsYyl7cmV0dXJuIGQuZ2V0KGEsYixjLCJzY3JpcHQiKX0sZ2V0SlNPTjpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGQuZ2V0KGEsYixjLCJqc29uIil9LGFqYXhTZXR1cDpmdW5jdGlvbihhLGIpe2I/ZC5leHRlbmQoITAsYSxkLmFqYXhTZXR0aW5ncyxiKTooYj1hLGE9ZC5leHRlbmQoITAsZC5hamF4U2V0dGluZ3MsYikpO2Zvcih2YXIgYyBpbiB7Y29udGV4dDoxLHVybDoxfSljIGluIGI/YVtjXT1iW2NdOmMgaW4gZC5hamF4U2V0dGluZ3MmJihhW2NdPWQuYWpheFNldHRpbmdzW2NdKTtyZXR1cm4gYX0sYWpheFNldHRpbmdzOnt1cmw6YkwsaXNMb2NhbDpieC50ZXN0KGJNWzFdKSxnbG9iYWw6ITAsdHlwZToiR0VUIixjb250ZW50VHlwZToiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIixwcm9jZXNzRGF0YTohMCxhc3luYzohMCxhY2NlcHRzOnt4bWw6ImFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWwiLGh0bWw6InRleHQvaHRtbCIsdGV4dDoidGV4dC9wbGFpbiIsanNvbjoiYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0IiwiKiI6IiovKiJ9LGNvbnRlbnRzOnt4bWw6L3htbC8saHRtbDovaHRtbC8sanNvbjovanNvbi99LHJlc3BvbnNlRmllbGRzOnt4bWw6InJlc3BvbnNlWE1MIix0ZXh0OiJyZXNwb25zZVRleHQifSxjb252ZXJ0ZXJzOnsiKiB0ZXh0IjphLlN0cmluZywidGV4dCBodG1sIjohMCwidGV4dCBqc29uIjpkLnBhcnNlSlNPTiwidGV4dCB4bWwiOmQucGFyc2VYTUx9fSxhamF4UHJlZmlsdGVyOmJPKGJKKSxhamF4VHJhbnNwb3J0OmJPKGJLKSxhamF4OmZ1bmN0aW9uKGEsYyl7ZnVuY3Rpb24gdihhLGMsbCxuKXtpZihyIT09Mil7cj0yLHAmJmNsZWFyVGltZW91dChwKSxvPWIsbT1ufHwiIix1LnJlYWR5U3RhdGU9YT80OjA7dmFyIHEsdCx2LHc9bD9iUihlLHUsbCk6Yix4LHk7aWYoYT49MjAwJiZhPDMwMHx8YT09PTMwNCl7aWYoZS5pZk1vZGlmaWVkKXtpZih4PXUuZ2V0UmVzcG9uc2VIZWFkZXIoIkxhc3QtTW9kaWZpZWQiKSlkLmxhc3RNb2RpZmllZFtrXT14O2lmKHk9dS5nZXRSZXNwb25zZUhlYWRlcigiRXRhZyIpKWQuZXRhZ1trXT15fWlmKGE9PT0zMDQpYz0ibm90bW9kaWZpZWQiLHE9ITA7ZWxzZSB0cnl7dD1iUyhlLHcpLGM9InN1Y2Nlc3MiLHE9ITB9Y2F0Y2goeil7Yz0icGFyc2VyZXJyb3IiLHY9en19ZWxzZXt2PWM7aWYoIWN8fGEpYz0iZXJyb3IiLGE8MCYmKGE9MCl9dS5zdGF0dXM9YSx1LnN0YXR1c1RleHQ9YyxxP2gucmVzb2x2ZVdpdGgoZixbdCxjLHVdKTpoLnJlamVjdFdpdGgoZixbdSxjLHZdKSx1LnN0YXR1c0NvZGUoaiksaj1iLHMmJmcudHJpZ2dlcigiYWpheCIrKHE/IlN1Y2Nlc3MiOiJFcnJvciIpLFt1LGUscT90OnZdKSxpLnJlc29sdmVXaXRoKGYsW3UsY10pLHMmJihnLnRyaWdnZXIoImFqYXhDb21wbGV0ZSIsW3UsZV0pLC0tZC5hY3RpdmV8fGQuZXZlbnQudHJpZ2dlcigiYWpheFN0b3AiKSl9fXR5cGVvZiBhPT09Im9iamVjdCImJihjPWEsYT1iKSxjPWN8fHt9O3ZhciBlPWQuYWpheFNldHVwKHt9LGMpLGY9ZS5jb250ZXh0fHxlLGc9ZiE9PWUmJihmLm5vZGVUeXBlfHxmIGluc3RhbmNlb2YgZCk/ZChmKTpkLmV2ZW50LGg9ZC5EZWZlcnJlZCgpLGk9ZC5fRGVmZXJyZWQoKSxqPWUuc3RhdHVzQ29kZXx8e30sayxsPXt9LG0sbixvLHAscSxyPTAscyx0LHU9e3JlYWR5U3RhdGU6MCxzZXRSZXF1ZXN0SGVhZGVyOmZ1bmN0aW9uKGEsYil7cnx8KGxbYS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoYkYsYkcpXT1iKTtyZXR1cm4gdGhpc30sZ2V0QWxsUmVzcG9uc2VIZWFkZXJzOmZ1bmN0aW9uKCl7cmV0dXJuIHI9PT0yP206bnVsbH0sZ2V0UmVzcG9uc2VIZWFkZXI6ZnVuY3Rpb24oYSl7dmFyIGM7aWYocj09PTIpe2lmKCFuKXtuPXt9O3doaWxlKGM9YnYuZXhlYyhtKSluW2NbMV0udG9Mb3dlckNhc2UoKV09Y1syXX1jPW5bYS50b0xvd2VyQ2FzZSgpXX1yZXR1cm4gYz09PWI/bnVsbDpjfSxvdmVycmlkZU1pbWVUeXBlOmZ1bmN0aW9uKGEpe3J8fChlLm1pbWVUeXBlPWEpO3JldHVybiB0aGlzfSxhYm9ydDpmdW5jdGlvbihhKXthPWF8fCJhYm9ydCIsbyYmby5hYm9ydChhKSx2KDAsYSk7cmV0dXJuIHRoaXN9fTtoLnByb21pc2UodSksdS5zdWNjZXNzPXUuZG9uZSx1LmVycm9yPXUuZmFpbCx1LmNvbXBsZXRlPWkuZG9uZSx1LnN0YXR1c0NvZGU9ZnVuY3Rpb24oYSl7aWYoYSl7dmFyIGI7aWYocjwyKWZvcihiIGluIGEpaltiXT1baltiXSxhW2JdXTtlbHNlIGI9YVt1LnN0YXR1c10sdS50aGVuKGIsYil9cmV0dXJuIHRoaXN9LGUudXJsPSgoYXx8ZS51cmwpKyIiKS5yZXBsYWNlKGJ1LCIiKS5yZXBsYWNlKGJ6LGJNWzFdKyIvLyIpLGUuZGF0YVR5cGVzPWQudHJpbShlLmRhdGFUeXBlfHwiKiIpLnRvTG93ZXJDYXNlKCkuc3BsaXQoYkQpLGUuY3Jvc3NEb21haW49PW51bGwmJihxPWJILmV4ZWMoZS51cmwudG9Mb3dlckNhc2UoKSksZS5jcm9zc0RvbWFpbj1xJiYocVsxXSE9Yk1bMV18fHFbMl0hPWJNWzJdfHwocVszXXx8KHFbMV09PT0iaHR0cDoiPzgwOjQ0MykpIT0oYk1bM118fChiTVsxXT09PSJodHRwOiI/ODA6NDQzKSkpKSxlLmRhdGEmJmUucHJvY2Vzc0RhdGEmJnR5cGVvZiBlLmRhdGEhPT0ic3RyaW5nIiYmKGUuZGF0YT1kLnBhcmFtKGUuZGF0YSxlLnRyYWRpdGlvbmFsKSksYlAoYkosZSxjLHUpO2lmKHI9PT0yKXJldHVybiExO3M9ZS5nbG9iYWwsZS50eXBlPWUudHlwZS50b1VwcGVyQ2FzZSgpLGUuaGFzQ29udGVudD0hYnkudGVzdChlLnR5cGUpLHMmJmQuYWN0aXZlKys9PT0wJiZkLmV2ZW50LnRyaWdnZXIoImFqYXhTdGFydCIpO2lmKCFlLmhhc0NvbnRlbnQpe2UuZGF0YSYmKGUudXJsKz0oYkEudGVzdChlLnVybCk/IiYiOiI/IikrZS5kYXRhKSxrPWUudXJsO2lmKGUuY2FjaGU9PT0hMSl7dmFyIHc9ZC5ub3coKSx4PWUudXJsLnJlcGxhY2UoYkUsIiQxXz0iK3cpO2UudXJsPXgrKHg9PT1lLnVybD8oYkEudGVzdChlLnVybCk/IiYiOiI/IikrIl89Iit3OiIiKX19aWYoZS5kYXRhJiZlLmhhc0NvbnRlbnQmJmUuY29udGVudFR5cGUhPT0hMXx8Yy5jb250ZW50VHlwZSlsWyJDb250ZW50LVR5cGUiXT1lLmNvbnRlbnRUeXBlO2UuaWZNb2RpZmllZCYmKGs9a3x8ZS51cmwsZC5sYXN0TW9kaWZpZWRba10mJihsWyJJZi1Nb2RpZmllZC1TaW5jZSJdPWQubGFzdE1vZGlmaWVkW2tdKSxkLmV0YWdba10mJihsWyJJZi1Ob25lLU1hdGNoIl09ZC5ldGFnW2tdKSksbC5BY2NlcHQ9ZS5kYXRhVHlwZXNbMF0mJmUuYWNjZXB0c1tlLmRhdGFUeXBlc1swXV0/ZS5hY2NlcHRzW2UuZGF0YVR5cGVzWzBdXSsoZS5kYXRhVHlwZXNbMF0hPT0iKiI/IiwgKi8qOyBxPTAuMDEiOiIiKTplLmFjY2VwdHNbIioiXTtmb3IodCBpbiBlLmhlYWRlcnMpdS5zZXRSZXF1ZXN0SGVhZGVyKHQsZS5oZWFkZXJzW3RdKTtpZihlLmJlZm9yZVNlbmQmJihlLmJlZm9yZVNlbmQuY2FsbChmLHUsZSk9PT0hMXx8cj09PTIpKXt1LmFib3J0KCk7cmV0dXJuITF9Zm9yKHQgaW4ge3N1Y2Nlc3M6MSxlcnJvcjoxLGNvbXBsZXRlOjF9KXVbdF0oZVt0XSk7bz1iUChiSyxlLGMsdSk7aWYobyl7dS5yZWFkeVN0YXRlPTEscyYmZy50cmlnZ2VyKCJhamF4U2VuZCIsW3UsZV0pLGUuYXN5bmMmJmUudGltZW91dD4wJiYocD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dS5hYm9ydCgidGltZW91dCIpfSxlLnRpbWVvdXQpKTt0cnl7cj0xLG8uc2VuZChsLHYpfWNhdGNoKHkpe3N0YXR1czwyP3YoLTEseSk6ZC5lcnJvcih5KX19ZWxzZSB2KC0xLCJObyBUcmFuc3BvcnQiKTtyZXR1cm4gdX0scGFyYW06ZnVuY3Rpb24oYSxjKXt2YXIgZT1bXSxmPWZ1bmN0aW9uKGEsYil7Yj1kLmlzRnVuY3Rpb24oYik/YigpOmIsZVtlLmxlbmd0aF09ZW5jb2RlVVJJQ29tcG9uZW50KGEpKyI9IitlbmNvZGVVUklDb21wb25lbnQoYil9O2M9PT1iJiYoYz1kLmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbCk7aWYoZC5pc0FycmF5KGEpfHxhLmpxdWVyeSYmIWQuaXNQbGFpbk9iamVjdChhKSlkLmVhY2goYSxmdW5jdGlvbigpe2YodGhpcy5uYW1lLHRoaXMudmFsdWUpfSk7ZWxzZSBmb3IodmFyIGcgaW4gYSliUShnLGFbZ10sYyxmKTtyZXR1cm4gZS5qb2luKCImIikucmVwbGFjZShiciwiKyIpfX0pLGQuZXh0ZW5kKHthY3RpdmU6MCxsYXN0TW9kaWZpZWQ6e30sZXRhZzp7fX0pO3ZhciBiVD1kLm5vdygpLGJVPS8oXD0pXD8oJnwkKXxcP1w/L2k7ZC5hamF4U2V0dXAoe2pzb25wOiJjYWxsYmFjayIsanNvbnBDYWxsYmFjazpmdW5jdGlvbigpe3JldHVybiBkLmV4cGFuZG8rIl8iK2JUKyt9fSksZC5hamF4UHJlZmlsdGVyKCJqc29uIGpzb25wIixmdW5jdGlvbihiLGMsZSl7dmFyIGY9dHlwZW9mIGIuZGF0YT09PSJzdHJpbmciO2lmKGIuZGF0YVR5cGVzWzBdPT09Impzb25wInx8Yy5qc29ucENhbGxiYWNrfHxjLmpzb25wIT1udWxsfHxiLmpzb25wIT09ITEmJihiVS50ZXN0KGIudXJsKXx8ZiYmYlUudGVzdChiLmRhdGEpKSl7dmFyIGcsaD1iLmpzb25wQ2FsbGJhY2s9ZC5pc0Z1bmN0aW9uKGIuanNvbnBDYWxsYmFjayk/Yi5qc29ucENhbGxiYWNrKCk6Yi5qc29ucENhbGxiYWNrLGk9YVtoXSxqPWIudXJsLGs9Yi5kYXRhLGw9IiQxIitoKyIkMiIsbT1mdW5jdGlvbigpe2FbaF09aSxnJiZkLmlzRnVuY3Rpb24oaSkmJmFbaF0oZ1swXSl9O2IuanNvbnAhPT0hMSYmKGo9ai5yZXBsYWNlKGJVLGwpLGIudXJsPT09aiYmKGYmJihrPWsucmVwbGFjZShiVSxsKSksYi5kYXRhPT09ayYmKGorPSgvXD8vLnRlc3Qoaik/IiYiOiI/IikrYi5qc29ucCsiPSIraCkpKSxiLnVybD1qLGIuZGF0YT1rLGFbaF09ZnVuY3Rpb24oYSl7Zz1bYV19LGUudGhlbihtLG0pLGIuY29udmVydGVyc1sic2NyaXB0IGpzb24iXT1mdW5jdGlvbigpe2d8fGQuZXJyb3IoaCsiIHdhcyBub3QgY2FsbGVkIik7cmV0dXJuIGdbMF19LGIuZGF0YVR5cGVzWzBdPSJqc29uIjtyZXR1cm4ic2NyaXB0In19KSxkLmFqYXhTZXR1cCh7YWNjZXB0czp7c2NyaXB0OiJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCJ9LGNvbnRlbnRzOntzY3JpcHQ6L2phdmFzY3JpcHR8ZWNtYXNjcmlwdC99LGNvbnZlcnRlcnM6eyJ0ZXh0IHNjcmlwdCI6ZnVuY3Rpb24oYSl7ZC5nbG9iYWxFdmFsKGEpO3JldHVybiBhfX19KSxkLmFqYXhQcmVmaWx0ZXIoInNjcmlwdCIsZnVuY3Rpb24oYSl7YS5jYWNoZT09PWImJihhLmNhY2hlPSExKSxhLmNyb3NzRG9tYWluJiYoYS50eXBlPSJHRVQiLGEuZ2xvYmFsPSExKX0pLGQuYWpheFRyYW5zcG9ydCgic2NyaXB0IixmdW5jdGlvbihhKXtpZihhLmNyb3NzRG9tYWluKXt2YXIgZCxlPWMuaGVhZHx8Yy5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdfHxjLmRvY3VtZW50RWxlbWVudDtyZXR1cm57c2VuZDpmdW5jdGlvbihmLGcpe2Q9Yy5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKSxkLmFzeW5jPSJhc3luYyIsYS5zY3JpcHRDaGFyc2V0JiYoZC5jaGFyc2V0PWEuc2NyaXB0Q2hhcnNldCksZC5zcmM9YS51cmwsZC5vbmxvYWQ9ZC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oYSxjKXtpZighZC5yZWFkeVN0YXRlfHwvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KGQucmVhZHlTdGF0ZSkpZC5vbmxvYWQ9ZC5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCxlJiZkLnBhcmVudE5vZGUmJmUucmVtb3ZlQ2hpbGQoZCksZD1iLGN8fGcoMjAwLCJzdWNjZXNzIil9LGUuaW5zZXJ0QmVmb3JlKGQsZS5maXJzdENoaWxkKX0sYWJvcnQ6ZnVuY3Rpb24oKXtkJiZkLm9ubG9hZCgwLDEpfX19fSk7dmFyIGJWPWQubm93KCksYlcsYlg7ZC5hamF4U2V0dGluZ3MueGhyPWEuQWN0aXZlWE9iamVjdD9mdW5jdGlvbigpe3JldHVybiF0aGlzLmlzTG9jYWwmJmJaKCl8fGIkKCl9OmJaLGJYPWQuYWpheFNldHRpbmdzLnhocigpLGQuc3VwcG9ydC5hamF4PSEhYlgsZC5zdXBwb3J0LmNvcnM9YlgmJiJ3aXRoQ3JlZGVudGlhbHMiaW4gYlgsYlg9YixkLnN1cHBvcnQuYWpheCYmZC5hamF4VHJhbnNwb3J0KGZ1bmN0aW9uKGEpe2lmKCFhLmNyb3NzRG9tYWlufHxkLnN1cHBvcnQuY29ycyl7dmFyIGM7cmV0dXJue3NlbmQ6ZnVuY3Rpb24oZSxmKXt2YXIgZz1hLnhocigpLGgsaTthLnVzZXJuYW1lP2cub3BlbihhLnR5cGUsYS51cmwsYS5hc3luYyxhLnVzZXJuYW1lLGEucGFzc3dvcmQpOmcub3BlbihhLnR5cGUsYS51cmwsYS5hc3luYyk7aWYoYS54aHJGaWVsZHMpZm9yKGkgaW4gYS54aHJGaWVsZHMpZ1tpXT1hLnhockZpZWxkc1tpXTthLm1pbWVUeXBlJiZnLm92ZXJyaWRlTWltZVR5cGUmJmcub3ZlcnJpZGVNaW1lVHlwZShhLm1pbWVUeXBlKSwhYS5jcm9zc0RvbWFpbiYmIWVbIlgtUmVxdWVzdGVkLVdpdGgiXSYmKGVbIlgtUmVxdWVzdGVkLVdpdGgiXT0iWE1MSHR0cFJlcXVlc3QiKTt0cnl7Zm9yKGkgaW4gZSlnLnNldFJlcXVlc3RIZWFkZXIoaSxlW2ldKX1jYXRjaChqKXt9Zy5zZW5kKGEuaGFzQ29udGVudCYmYS5kYXRhfHxudWxsKSxjPWZ1bmN0aW9uKGUsaSl7dmFyIGosayxsLG0sbjt0cnl7aWYoYyYmKGl8fGcucmVhZHlTdGF0ZT09PTQpKXtjPWIsaCYmKGcub25yZWFkeXN0YXRlY2hhbmdlPWQubm9vcCxkZWxldGUgYldbaF0pO2lmKGkpZy5yZWFkeVN0YXRlIT09NCYmZy5hYm9ydCgpO2Vsc2V7aj1nLnN0YXR1cyxsPWcuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCksbT17fSxuPWcucmVzcG9uc2VYTUwsbiYmbi5kb2N1bWVudEVsZW1lbnQmJihtLnhtbD1uKSxtLnRleHQ9Zy5yZXNwb25zZVRleHQ7dHJ5e2s9Zy5zdGF0dXNUZXh0fWNhdGNoKG8pe2s9IiJ9anx8IWEuaXNMb2NhbHx8YS5jcm9zc0RvbWFpbj9qPT09MTIyMyYmKGo9MjA0KTpqPW0udGV4dD8yMDA6NDA0fX19Y2F0Y2gocCl7aXx8ZigtMSxwKX1tJiZmKGosayxtLGwpfSxhLmFzeW5jJiZnLnJlYWR5U3RhdGUhPT00PyhiV3x8KGJXPXt9LGJZKCkpLGg9YlYrKyxnLm9ucmVhZHlzdGF0ZWNoYW5nZT1iV1toXT1jKTpjKCl9LGFib3J0OmZ1bmN0aW9uKCl7YyYmYygwLDEpfX19fSk7dmFyIGJfPXt9LGNhPS9eKD86dG9nZ2xlfHNob3d8aGlkZSkkLyxjYj0vXihbK1wtXT0pPyhbXGQrLlwtXSspKFthLXolXSopJC9pLGNjLGNkPVtbImhlaWdodCIsIm1hcmdpblRvcCIsIm1hcmdpbkJvdHRvbSIsInBhZGRpbmdUb3AiLCJwYWRkaW5nQm90dG9tIl0sWyJ3aWR0aCIsIm1hcmdpbkxlZnQiLCJtYXJnaW5SaWdodCIsInBhZGRpbmdMZWZ0IiwicGFkZGluZ1JpZ2h0Il0sWyJvcGFjaXR5Il1dO2QuZm4uZXh0ZW5kKHtzaG93OmZ1bmN0aW9uKGEsYixjKXt2YXIgZSxmO2lmKGF8fGE9PT0wKXJldHVybiB0aGlzLmFuaW1hdGUoY2UoInNob3ciLDMpLGEsYixjKTtmb3IodmFyIGc9MCxoPXRoaXMubGVuZ3RoO2c8aDtnKyspZT10aGlzW2ddLGY9ZS5zdHlsZS5kaXNwbGF5LCFkLl9kYXRhKGUsIm9sZGRpc3BsYXkiKSYmZj09PSJub25lIiYmKGY9ZS5zdHlsZS5kaXNwbGF5PSIiKSxmPT09IiImJmQuY3NzKGUsImRpc3BsYXkiKT09PSJub25lIiYmZC5fZGF0YShlLCJvbGRkaXNwbGF5IixjZihlLm5vZGVOYW1lKSk7Zm9yKGc9MDtnPGg7ZysrKXtlPXRoaXNbZ10sZj1lLnN0eWxlLmRpc3BsYXk7aWYoZj09PSIifHxmPT09Im5vbmUiKWUuc3R5bGUuZGlzcGxheT1kLl9kYXRhKGUsIm9sZGRpc3BsYXkiKXx8IiJ9cmV0dXJuIHRoaXN9LGhpZGU6ZnVuY3Rpb24oYSxiLGMpe2lmKGF8fGE9PT0wKXJldHVybiB0aGlzLmFuaW1hdGUoY2UoImhpZGUiLDMpLGEsYixjKTtmb3IodmFyIGU9MCxmPXRoaXMubGVuZ3RoO2U8ZjtlKyspe3ZhciBnPWQuY3NzKHRoaXNbZV0sImRpc3BsYXkiKTtnIT09Im5vbmUiJiYhZC5fZGF0YSh0aGlzW2VdLCJvbGRkaXNwbGF5IikmJmQuX2RhdGEodGhpc1tlXSwib2xkZGlzcGxheSIsZyl9Zm9yKGU9MDtlPGY7ZSsrKXRoaXNbZV0uc3R5bGUuZGlzcGxheT0ibm9uZSI7cmV0dXJuIHRoaXN9LF90b2dnbGU6ZC5mbi50b2dnbGUsdG9nZ2xlOmZ1bmN0aW9uKGEsYixjKXt2YXIgZT10eXBlb2YgYT09PSJib29sZWFuIjtkLmlzRnVuY3Rpb24oYSkmJmQuaXNGdW5jdGlvbihiKT90aGlzLl90b2dnbGUuYXBwbHkodGhpcyxhcmd1bWVudHMpOmE9PW51bGx8fGU/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9ZT9hOmQodGhpcykuaXMoIjpoaWRkZW4iKTtkKHRoaXMpW2I/InNob3ciOiJoaWRlIl0oKX0pOnRoaXMuYW5pbWF0ZShjZSgidG9nZ2xlIiwzKSxhLGIsYyk7cmV0dXJuIHRoaXN9LGZhZGVUbzpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5maWx0ZXIoIjpoaWRkZW4iKS5jc3MoIm9wYWNpdHkiLDApLnNob3coKS5lbmQoKS5hbmltYXRlKHtvcGFjaXR5OmJ9LGEsYyxkKX0sYW5pbWF0ZTpmdW5jdGlvbihhLGIsYyxlKXt2YXIgZj1kLnNwZWVkKGIsYyxlKTtpZihkLmlzRW1wdHlPYmplY3QoYSkpcmV0dXJuIHRoaXMuZWFjaChmLmNvbXBsZXRlKTtyZXR1cm4gdGhpc1tmLnF1ZXVlPT09ITE/ImVhY2giOiJxdWV1ZSJdKGZ1bmN0aW9uKCl7dmFyIGI9ZC5leHRlbmQoe30sZiksYyxlPXRoaXMubm9kZVR5cGU9PT0xLGc9ZSYmZCh0aGlzKS5pcygiOmhpZGRlbiIpLGg9dGhpcztmb3IoYyBpbiBhKXt2YXIgaT1kLmNhbWVsQ2FzZShjKTtjIT09aSYmKGFbaV09YVtjXSxkZWxldGUgYVtjXSxjPWkpO2lmKGFbY109PT0iaGlkZSImJmd8fGFbY109PT0ic2hvdyImJiFnKXJldHVybiBiLmNvbXBsZXRlLmNhbGwodGhpcyk7aWYoZSYmKGM9PT0iaGVpZ2h0Inx8Yz09PSJ3aWR0aCIpKXtiLm92ZXJmbG93PVt0aGlzLnN0eWxlLm92ZXJmbG93LHRoaXMuc3R5bGUub3ZlcmZsb3dYLHRoaXMuc3R5bGUub3ZlcmZsb3dZXTtpZihkLmNzcyh0aGlzLCJkaXNwbGF5Iik9PT0iaW5saW5lIiYmZC5jc3ModGhpcywiZmxvYXQiKT09PSJub25lIilpZihkLnN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCl7dmFyIGo9Y2YodGhpcy5ub2RlTmFtZSk7aj09PSJpbmxpbmUiP3RoaXMuc3R5bGUuZGlzcGxheT0iaW5saW5lLWJsb2NrIjoodGhpcy5zdHlsZS5kaXNwbGF5PSJpbmxpbmUiLHRoaXMuc3R5bGUuem9vbT0xKX1lbHNlIHRoaXMuc3R5bGUuZGlzcGxheT0iaW5saW5lLWJsb2NrIn1kLmlzQXJyYXkoYVtjXSkmJigoYi5zcGVjaWFsRWFzaW5nPWIuc3BlY2lhbEVhc2luZ3x8e30pW2NdPWFbY11bMV0sYVtjXT1hW2NdWzBdKX1iLm92ZXJmbG93IT1udWxsJiYodGhpcy5zdHlsZS5vdmVyZmxvdz0iaGlkZGVuIiksYi5jdXJBbmltPWQuZXh0ZW5kKHt9LGEpLGQuZWFjaChhLGZ1bmN0aW9uKGMsZSl7dmFyIGY9bmV3IGQuZngoaCxiLGMpO2lmKGNhLnRlc3QoZSkpZltlPT09InRvZ2dsZSI/Zz8ic2hvdyI6ImhpZGUiOmVdKGEpO2Vsc2V7dmFyIGk9Y2IuZXhlYyhlKSxqPWYuY3VyKCk7aWYoaSl7dmFyIGs9cGFyc2VGbG9hdChpWzJdKSxsPWlbM118fChkLmNzc051bWJlcltjXT8iIjoicHgiKTtsIT09InB4IiYmKGQuc3R5bGUoaCxjLChrfHwxKStsKSxqPShrfHwxKS9mLmN1cigpKmosZC5zdHlsZShoLGMsaitsKSksaVsxXSYmKGs9KGlbMV09PT0iLT0iPy0xOjEpKmsraiksZi5jdXN0b20oaixrLGwpfWVsc2UgZi5jdXN0b20oaixlLCIiKX19KTtyZXR1cm4hMH0pfSxzdG9wOmZ1bmN0aW9uKGEsYil7dmFyIGM9ZC50aW1lcnM7YSYmdGhpcy5xdWV1ZShbXSksdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zm9yKHZhciBhPWMubGVuZ3RoLTE7YT49MDthLS0pY1thXS5lbGVtPT09dGhpcyYmKGImJmNbYV0oITApLGMuc3BsaWNlKGEsMSkpfSksYnx8dGhpcy5kZXF1ZXVlKCk7cmV0dXJuIHRoaXN9fSksZC5lYWNoKHtzbGlkZURvd246Y2UoInNob3ciLDEpLHNsaWRlVXA6Y2UoImhpZGUiLDEpLHNsaWRlVG9nZ2xlOmNlKCJ0b2dnbGUiLDEpLGZhZGVJbjp7b3BhY2l0eToic2hvdyJ9LGZhZGVPdXQ6e29wYWNpdHk6ImhpZGUifSxmYWRlVG9nZ2xlOntvcGFjaXR5OiJ0b2dnbGUifX0sZnVuY3Rpb24oYSxiKXtkLmZuW2FdPWZ1bmN0aW9uKGEsYyxkKXtyZXR1cm4gdGhpcy5hbmltYXRlKGIsYSxjLGQpfX0pLGQuZXh0ZW5kKHtzcGVlZDpmdW5jdGlvbihhLGIsYyl7dmFyIGU9YSYmdHlwZW9mIGE9PT0ib2JqZWN0Ij9kLmV4dGVuZCh7fSxhKTp7Y29tcGxldGU6Y3x8IWMmJmJ8fGQuaXNGdW5jdGlvbihhKSYmYSxkdXJhdGlvbjphLGVhc2luZzpjJiZifHxiJiYhZC5pc0Z1bmN0aW9uKGIpJiZifTtlLmR1cmF0aW9uPWQuZngub2ZmPzA6dHlwZW9mIGUuZHVyYXRpb249PT0ibnVtYmVyIj9lLmR1cmF0aW9uOmUuZHVyYXRpb24gaW4gZC5meC5zcGVlZHM/ZC5meC5zcGVlZHNbZS5kdXJhdGlvbl06ZC5meC5zcGVlZHMuX2RlZmF1bHQsZS5vbGQ9ZS5jb21wbGV0ZSxlLmNvbXBsZXRlPWZ1bmN0aW9uKCl7ZS5xdWV1ZSE9PSExJiZkKHRoaXMpLmRlcXVldWUoKSxkLmlzRnVuY3Rpb24oZS5vbGQpJiZlLm9sZC5jYWxsKHRoaXMpfTtyZXR1cm4gZX0sZWFzaW5nOntsaW5lYXI6ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIGMrZCphfSxzd2luZzpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4oLU1hdGguY29zKGEqTWF0aC5QSSkvMisuNSkqZCtjfX0sdGltZXJzOltdLGZ4OmZ1bmN0aW9uKGEsYixjKXt0aGlzLm9wdGlvbnM9Yix0aGlzLmVsZW09YSx0aGlzLnByb3A9YyxiLm9yaWd8fChiLm9yaWc9e30pfX0pLGQuZngucHJvdG90eXBlPXt1cGRhdGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuc3RlcCYmdGhpcy5vcHRpb25zLnN0ZXAuY2FsbCh0aGlzLmVsZW0sdGhpcy5ub3csdGhpcyksKGQuZnguc3RlcFt0aGlzLnByb3BdfHxkLmZ4LnN0ZXAuX2RlZmF1bHQpKHRoaXMpfSxjdXI6ZnVuY3Rpb24oKXtpZih0aGlzLmVsZW1bdGhpcy5wcm9wXSE9bnVsbCYmKCF0aGlzLmVsZW0uc3R5bGV8fHRoaXMuZWxlbS5zdHlsZVt0aGlzLnByb3BdPT1udWxsKSlyZXR1cm4gdGhpcy5lbGVtW3RoaXMucHJvcF07dmFyIGEsYj1kLmNzcyh0aGlzLmVsZW0sdGhpcy5wcm9wKTtyZXR1cm4gaXNOYU4oYT1wYXJzZUZsb2F0KGIpKT8hYnx8Yj09PSJhdXRvIj8wOmI6YX0sY3VzdG9tOmZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBnKGEpe3JldHVybiBlLnN0ZXAoYSl9dmFyIGU9dGhpcyxmPWQuZng7dGhpcy5zdGFydFRpbWU9ZC5ub3coKSx0aGlzLnN0YXJ0PWEsdGhpcy5lbmQ9Yix0aGlzLnVuaXQ9Y3x8dGhpcy51bml0fHwoZC5jc3NOdW1iZXJbdGhpcy5wcm9wXT8iIjoicHgiKSx0aGlzLm5vdz10aGlzLnN0YXJ0LHRoaXMucG9zPXRoaXMuc3RhdGU9MCxnLmVsZW09dGhpcy5lbGVtLGcoKSYmZC50aW1lcnMucHVzaChnKSYmIWNjJiYoY2M9c2V0SW50ZXJ2YWwoZi50aWNrLGYuaW50ZXJ2YWwpKX0sc2hvdzpmdW5jdGlvbigpe3RoaXMub3B0aW9ucy5vcmlnW3RoaXMucHJvcF09ZC5zdHlsZSh0aGlzLmVsZW0sdGhpcy5wcm9wKSx0aGlzLm9wdGlvbnMuc2hvdz0hMCx0aGlzLmN1c3RvbSh0aGlzLnByb3A9PT0id2lkdGgifHx0aGlzLnByb3A9PT0iaGVpZ2h0Ij8xOjAsdGhpcy5jdXIoKSksZCh0aGlzLmVsZW0pLnNob3coKX0saGlkZTpmdW5jdGlvbigpe3RoaXMub3B0aW9ucy5vcmlnW3RoaXMucHJvcF09ZC5zdHlsZSh0aGlzLmVsZW0sdGhpcy5wcm9wKSx0aGlzLm9wdGlvbnMuaGlkZT0hMCx0aGlzLmN1c3RvbSh0aGlzLmN1cigpLDApfSxzdGVwOmZ1bmN0aW9uKGEpe3ZhciBiPWQubm93KCksYz0hMDtpZihhfHxiPj10aGlzLm9wdGlvbnMuZHVyYXRpb24rdGhpcy5zdGFydFRpbWUpe3RoaXMubm93PXRoaXMuZW5kLHRoaXMucG9zPXRoaXMuc3RhdGU9MSx0aGlzLnVwZGF0ZSgpLHRoaXMub3B0aW9ucy5jdXJBbmltW3RoaXMucHJvcF09ITA7Zm9yKHZhciBlIGluIHRoaXMub3B0aW9ucy5jdXJBbmltKXRoaXMub3B0aW9ucy5jdXJBbmltW2VdIT09ITAmJihjPSExKTtpZihjKXtpZih0aGlzLm9wdGlvbnMub3ZlcmZsb3chPW51bGwmJiFkLnN1cHBvcnQuc2hyaW5rV3JhcEJsb2Nrcyl7dmFyIGY9dGhpcy5lbGVtLGc9dGhpcy5vcHRpb25zO2QuZWFjaChbIiIsIlgiLCJZIl0sZnVuY3Rpb24oYSxiKXtmLnN0eWxlWyJvdmVyZmxvdyIrYl09Zy5vdmVyZmxvd1thXX0pfXRoaXMub3B0aW9ucy5oaWRlJiZkKHRoaXMuZWxlbSkuaGlkZSgpO2lmKHRoaXMub3B0aW9ucy5oaWRlfHx0aGlzLm9wdGlvbnMuc2hvdylmb3IodmFyIGggaW4gdGhpcy5vcHRpb25zLmN1ckFuaW0pZC5zdHlsZSh0aGlzLmVsZW0saCx0aGlzLm9wdGlvbnMub3JpZ1toXSk7dGhpcy5vcHRpb25zLmNvbXBsZXRlLmNhbGwodGhpcy5lbGVtKX1yZXR1cm4hMX12YXIgaT1iLXRoaXMuc3RhcnRUaW1lO3RoaXMuc3RhdGU9aS90aGlzLm9wdGlvbnMuZHVyYXRpb247dmFyIGo9dGhpcy5vcHRpb25zLnNwZWNpYWxFYXNpbmcmJnRoaXMub3B0aW9ucy5zcGVjaWFsRWFzaW5nW3RoaXMucHJvcF0saz10aGlzLm9wdGlvbnMuZWFzaW5nfHwoZC5lYXNpbmcuc3dpbmc/InN3aW5nIjoibGluZWFyIik7dGhpcy5wb3M9ZC5lYXNpbmdbanx8a10odGhpcy5zdGF0ZSxpLDAsMSx0aGlzLm9wdGlvbnMuZHVyYXRpb24pLHRoaXMubm93PXRoaXMuc3RhcnQrKHRoaXMuZW5kLXRoaXMuc3RhcnQpKnRoaXMucG9zLHRoaXMudXBkYXRlKCk7cmV0dXJuITB9fSxkLmV4dGVuZChkLmZ4LHt0aWNrOmZ1bmN0aW9uKCl7dmFyIGE9ZC50aW1lcnM7Zm9yKHZhciBiPTA7YjxhLmxlbmd0aDtiKyspYVtiXSgpfHxhLnNwbGljZShiLS0sMSk7YS5sZW5ndGh8fGQuZnguc3RvcCgpfSxpbnRlcnZhbDoxMyxzdG9wOmZ1bmN0aW9uKCl7Y2xlYXJJbnRlcnZhbChjYyksY2M9bnVsbH0sc3BlZWRzOntzbG93OjYwMCxmYXN0OjIwMCxfZGVmYXVsdDo0MDB9LHN0ZXA6e29wYWNpdHk6ZnVuY3Rpb24oYSl7ZC5zdHlsZShhLmVsZW0sIm9wYWNpdHkiLGEubm93KX0sX2RlZmF1bHQ6ZnVuY3Rpb24oYSl7YS5lbGVtLnN0eWxlJiZhLmVsZW0uc3R5bGVbYS5wcm9wXSE9bnVsbD9hLmVsZW0uc3R5bGVbYS5wcm9wXT0oYS5wcm9wPT09IndpZHRoInx8YS5wcm9wPT09ImhlaWdodCI/TWF0aC5tYXgoMCxhLm5vdyk6YS5ub3cpK2EudW5pdDphLmVsZW1bYS5wcm9wXT1hLm5vd319fSksZC5leHByJiZkLmV4cHIuZmlsdGVycyYmKGQuZXhwci5maWx0ZXJzLmFuaW1hdGVkPWZ1bmN0aW9uKGEpe3JldHVybiBkLmdyZXAoZC50aW1lcnMsZnVuY3Rpb24oYil7cmV0dXJuIGE9PT1iLmVsZW19KS5sZW5ndGh9KTt2YXIgY2c9L150KD86YWJsZXxkfGgpJC9pLGNoPS9eKD86Ym9keXxodG1sKSQvaTsiZ2V0Qm91bmRpbmdDbGllbnRSZWN0ImluIGMuZG9jdW1lbnRFbGVtZW50P2QuZm4ub2Zmc2V0PWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXNbMF0sYztpZihhKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7ZC5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO2lmKCFifHwhYi5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGI9PT1iLm93bmVyRG9jdW1lbnQuYm9keSlyZXR1cm4gZC5vZmZzZXQuYm9keU9mZnNldChiKTt0cnl7Yz1iLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpfWNhdGNoKGUpe312YXIgZj1iLm93bmVyRG9jdW1lbnQsZz1mLmRvY3VtZW50RWxlbWVudDtpZighY3x8IWQuY29udGFpbnMoZyxiKSlyZXR1cm4gYz97dG9wOmMudG9wLGxlZnQ6Yy5sZWZ0fTp7dG9wOjAsbGVmdDowfTt2YXIgaD1mLmJvZHksaT1jaShmKSxqPWcuY2xpZW50VG9wfHxoLmNsaWVudFRvcHx8MCxrPWcuY2xpZW50TGVmdHx8aC5jbGllbnRMZWZ0fHwwLGw9aS5wYWdlWU9mZnNldHx8ZC5zdXBwb3J0LmJveE1vZGVsJiZnLnNjcm9sbFRvcHx8aC5zY3JvbGxUb3AsbT1pLnBhZ2VYT2Zmc2V0fHxkLnN1cHBvcnQuYm94TW9kZWwmJmcuc2Nyb2xsTGVmdHx8aC5zY3JvbGxMZWZ0LG49Yy50b3ArbC1qLG89Yy5sZWZ0K20taztyZXR1cm57dG9wOm4sbGVmdDpvfX06ZC5mbi5vZmZzZXQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXTtpZihhKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7ZC5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO2lmKCFifHwhYi5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGI9PT1iLm93bmVyRG9jdW1lbnQuYm9keSlyZXR1cm4gZC5vZmZzZXQuYm9keU9mZnNldChiKTtkLm9mZnNldC5pbml0aWFsaXplKCk7dmFyIGMsZT1iLm9mZnNldFBhcmVudCxmPWIsZz1iLm93bmVyRG9jdW1lbnQsaD1nLmRvY3VtZW50RWxlbWVudCxpPWcuYm9keSxqPWcuZGVmYXVsdFZpZXcsaz1qP2ouZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpOmIuY3VycmVudFN0eWxlLGw9Yi5vZmZzZXRUb3AsbT1iLm9mZnNldExlZnQ7d2hpbGUoKGI9Yi5wYXJlbnROb2RlKSYmYiE9PWkmJmIhPT1oKXtpZihkLm9mZnNldC5zdXBwb3J0c0ZpeGVkUG9zaXRpb24mJmsucG9zaXRpb249PT0iZml4ZWQiKWJyZWFrO2M9aj9qLmdldENvbXB1dGVkU3R5bGUoYixudWxsKTpiLmN1cnJlbnRTdHlsZSxsLT1iLnNjcm9sbFRvcCxtLT1iLnNjcm9sbExlZnQsYj09PWUmJihsKz1iLm9mZnNldFRvcCxtKz1iLm9mZnNldExlZnQsZC5vZmZzZXQuZG9lc05vdEFkZEJvcmRlciYmKCFkLm9mZnNldC5kb2VzQWRkQm9yZGVyRm9yVGFibGVBbmRDZWxsc3x8IWNnLnRlc3QoYi5ub2RlTmFtZSkpJiYobCs9cGFyc2VGbG9hdChjLmJvcmRlclRvcFdpZHRoKXx8MCxtKz1wYXJzZUZsb2F0KGMuYm9yZGVyTGVmdFdpZHRoKXx8MCksZj1lLGU9Yi5vZmZzZXRQYXJlbnQpLGQub2Zmc2V0LnN1YnRyYWN0c0JvcmRlckZvck92ZXJmbG93Tm90VmlzaWJsZSYmYy5vdmVyZmxvdyE9PSJ2aXNpYmxlIiYmKGwrPXBhcnNlRmxvYXQoYy5ib3JkZXJUb3BXaWR0aCl8fDAsbSs9cGFyc2VGbG9hdChjLmJvcmRlckxlZnRXaWR0aCl8fDApLGs9Y31pZihrLnBvc2l0aW9uPT09InJlbGF0aXZlInx8ay5wb3NpdGlvbj09PSJzdGF0aWMiKWwrPWkub2Zmc2V0VG9wLG0rPWkub2Zmc2V0TGVmdDtkLm9mZnNldC5zdXBwb3J0c0ZpeGVkUG9zaXRpb24mJmsucG9zaXRpb249PT0iZml4ZWQiJiYobCs9TWF0aC5tYXgoaC5zY3JvbGxUb3AsaS5zY3JvbGxUb3ApLG0rPU1hdGgubWF4KGguc2Nyb2xsTGVmdCxpLnNjcm9sbExlZnQpKTtyZXR1cm57dG9wOmwsbGVmdDptfX0sZC5vZmZzZXQ9e2luaXRpYWxpemU6ZnVuY3Rpb24oKXt2YXIgYT1jLmJvZHksYj1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpLGUsZixnLGgsaT1wYXJzZUZsb2F0KGQuY3NzKGEsIm1hcmdpblRvcCIpKXx8MCxqPSI8ZGl2IHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7bWFyZ2luOjA7Ym9yZGVyOjVweCBzb2xpZCAjMDAwO3BhZGRpbmc6MDt3aWR0aDoxcHg7aGVpZ2h0OjFweDsnPjxkaXY+PC9kaXY+PC9kaXY+PHRhYmxlIHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7bWFyZ2luOjA7Ym9yZGVyOjVweCBzb2xpZCAjMDAwO3BhZGRpbmc6MDt3aWR0aDoxcHg7aGVpZ2h0OjFweDsnIGNlbGxwYWRkaW5nPScwJyBjZWxsc3BhY2luZz0nMCc+PHRyPjx0ZD48L3RkPjwvdHI+PC90YWJsZT4iO2QuZXh0ZW5kKGIuc3R5bGUse3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdG9wOjAsbGVmdDowLG1hcmdpbjowLGJvcmRlcjowLHdpZHRoOiIxcHgiLGhlaWdodDoiMXB4Iix2aXNpYmlsaXR5OiJoaWRkZW4ifSksYi5pbm5lckhUTUw9aixhLmluc2VydEJlZm9yZShiLGEuZmlyc3RDaGlsZCksZT1iLmZpcnN0Q2hpbGQsZj1lLmZpcnN0Q2hpbGQsaD1lLm5leHRTaWJsaW5nLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZCx0aGlzLmRvZXNOb3RBZGRCb3JkZXI9Zi5vZmZzZXRUb3AhPT01LHRoaXMuZG9lc0FkZEJvcmRlckZvclRhYmxlQW5kQ2VsbHM9aC5vZmZzZXRUb3A9PT01LGYuc3R5bGUucG9zaXRpb249ImZpeGVkIixmLnN0eWxlLnRvcD0iMjBweCIsdGhpcy5zdXBwb3J0c0ZpeGVkUG9zaXRpb249Zi5vZmZzZXRUb3A9PT0yMHx8Zi5vZmZzZXRUb3A9PT0xNSxmLnN0eWxlLnBvc2l0aW9uPWYuc3R5bGUudG9wPSIiLGUuc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIsZS5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiLHRoaXMuc3VidHJhY3RzQm9yZGVyRm9yT3ZlcmZsb3dOb3RWaXNpYmxlPWYub2Zmc2V0VG9wPT09LTUsdGhpcy5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldD1hLm9mZnNldFRvcCE9PWksYS5yZW1vdmVDaGlsZChiKSxkLm9mZnNldC5pbml0aWFsaXplPWQubm9vcH0sYm9keU9mZnNldDpmdW5jdGlvbihhKXt2YXIgYj1hLm9mZnNldFRvcCxjPWEub2Zmc2V0TGVmdDtkLm9mZnNldC5pbml0aWFsaXplKCksZC5vZmZzZXQuZG9lc05vdEluY2x1ZGVNYXJnaW5JbkJvZHlPZmZzZXQmJihiKz1wYXJzZUZsb2F0KGQuY3NzKGEsIm1hcmdpblRvcCIpKXx8MCxjKz1wYXJzZUZsb2F0KGQuY3NzKGEsIm1hcmdpbkxlZnQiKSl8fDApO3JldHVybnt0b3A6YixsZWZ0OmN9fSxzZXRPZmZzZXQ6ZnVuY3Rpb24oYSxiLGMpe3ZhciBlPWQuY3NzKGEsInBvc2l0aW9uIik7ZT09PSJzdGF0aWMiJiYoYS5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiKTt2YXIgZj1kKGEpLGc9Zi5vZmZzZXQoKSxoPWQuY3NzKGEsInRvcCIpLGk9ZC5jc3MoYSwibGVmdCIpLGo9KGU9PT0iYWJzb2x1dGUifHxlPT09ImZpeGVkIikmJmQuaW5BcnJheSgiYXV0byIsW2gsaV0pPi0xLGs9e30sbD17fSxtLG47aiYmKGw9Zi5wb3NpdGlvbigpKSxtPWo/bC50b3A6cGFyc2VJbnQoaCwxMCl8fDAsbj1qP2wubGVmdDpwYXJzZUludChpLDEwKXx8MCxkLmlzRnVuY3Rpb24oYikmJihiPWIuY2FsbChhLGMsZykpLGIudG9wIT1udWxsJiYoay50b3A9Yi50b3AtZy50b3ArbSksYi5sZWZ0IT1udWxsJiYoay5sZWZ0PWIubGVmdC1nLmxlZnQrbiksInVzaW5nImluIGI/Yi51c2luZy5jYWxsKGEsayk6Zi5jc3Moayl9fSxkLmZuLmV4dGVuZCh7cG9zaXRpb246ZnVuY3Rpb24oKXtpZighdGhpc1swXSlyZXR1cm4gbnVsbDt2YXIgYT10aGlzWzBdLGI9dGhpcy5vZmZzZXRQYXJlbnQoKSxjPXRoaXMub2Zmc2V0KCksZT1jaC50ZXN0KGJbMF0ubm9kZU5hbWUpP3t0b3A6MCxsZWZ0OjB9OmIub2Zmc2V0KCk7Yy50b3AtPXBhcnNlRmxvYXQoZC5jc3MoYSwibWFyZ2luVG9wIikpfHwwLGMubGVmdC09cGFyc2VGbG9hdChkLmNzcyhhLCJtYXJnaW5MZWZ0IikpfHwwLGUudG9wKz1wYXJzZUZsb2F0KGQuY3NzKGJbMF0sImJvcmRlclRvcFdpZHRoIikpfHwwLGUubGVmdCs9cGFyc2VGbG9hdChkLmNzcyhiWzBdLCJib3JkZXJMZWZ0V2lkdGgiKSl8fDA7cmV0dXJue3RvcDpjLnRvcC1lLnRvcCxsZWZ0OmMubGVmdC1lLmxlZnR9fSxvZmZzZXRQYXJlbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9mZnNldFBhcmVudHx8Yy5ib2R5O3doaWxlKGEmJighY2gudGVzdChhLm5vZGVOYW1lKSYmZC5jc3MoYSwicG9zaXRpb24iKT09PSJzdGF0aWMiKSlhPWEub2Zmc2V0UGFyZW50O3JldHVybiBhfSl9fSksZC5lYWNoKFsiTGVmdCIsIlRvcCJdLGZ1bmN0aW9uKGEsYyl7dmFyIGU9InNjcm9sbCIrYztkLmZuW2VdPWZ1bmN0aW9uKGMpe3ZhciBmPXRoaXNbMF0sZztpZighZilyZXR1cm4gbnVsbDtpZihjIT09YilyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zz1jaSh0aGlzKSxnP2cuc2Nyb2xsVG8oYT9kKGcpLnNjcm9sbExlZnQoKTpjLGE/YzpkKGcpLnNjcm9sbFRvcCgpKTp0aGlzW2VdPWN9KTtnPWNpKGYpO3JldHVybiBnPyJwYWdlWE9mZnNldCJpbiBnP2dbYT8icGFnZVlPZmZzZXQiOiJwYWdlWE9mZnNldCJdOmQuc3VwcG9ydC5ib3hNb2RlbCYmZy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbZV18fGcuZG9jdW1lbnQuYm9keVtlXTpmW2VdfX0pLGQuZWFjaChbIkhlaWdodCIsIldpZHRoIl0sZnVuY3Rpb24oYSxjKXt2YXIgZT1jLnRvTG93ZXJDYXNlKCk7ZC5mblsiaW5uZXIiK2NdPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXNbMF0/cGFyc2VGbG9hdChkLmNzcyh0aGlzWzBdLGUsInBhZGRpbmciKSk6bnVsbH0sZC5mblsib3V0ZXIiK2NdPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzWzBdP3BhcnNlRmxvYXQoZC5jc3ModGhpc1swXSxlLGE/Im1hcmdpbiI6ImJvcmRlciIpKTpudWxsfSxkLmZuW2VdPWZ1bmN0aW9uKGEpe3ZhciBmPXRoaXNbMF07aWYoIWYpcmV0dXJuIGE9PW51bGw/bnVsbDp0aGlzO2lmKGQuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWQodGhpcyk7Y1tlXShhLmNhbGwodGhpcyxiLGNbZV0oKSkpfSk7aWYoZC5pc1dpbmRvdyhmKSl7dmFyIGc9Zi5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbImNsaWVudCIrY107cmV0dXJuIGYuZG9jdW1lbnQuY29tcGF0TW9kZT09PSJDU1MxQ29tcGF0IiYmZ3x8Zi5kb2N1bWVudC5ib2R5WyJjbGllbnQiK2NdfHxnfWlmKGYubm9kZVR5cGU9PT05KXJldHVybiBNYXRoLm1heChmLmRvY3VtZW50RWxlbWVudFsiY2xpZW50IitjXSxmLmJvZHlbInNjcm9sbCIrY10sZi5kb2N1bWVudEVsZW1lbnRbInNjcm9sbCIrY10sZi5ib2R5WyJvZmZzZXQiK2NdLGYuZG9jdW1lbnRFbGVtZW50WyJvZmZzZXQiK2NdKTtpZihhPT09Yil7dmFyIGg9ZC5jc3MoZixlKSxpPXBhcnNlRmxvYXQoaCk7cmV0dXJuIGQuaXNOYU4oaSk/aDppfXJldHVybiB0aGlzLmNzcyhlLHR5cGVvZiBhPT09InN0cmluZyI/YTphKyJweCIpfX0pLGEualF1ZXJ5PWEuJD1kfSkod2luZG93KTs="
        },
        "xdm/xdm-all.js": {
            "content_type": "application/javascript",
            "data": "LyohCiAqIGpRdWVyeSBKYXZhU2NyaXB0IExpYnJhcnkgdjEuNi4yCiAqIGh0dHA6Ly9qcXVlcnkuY29tLwogKgogKiBDb3B5cmlnaHQgMjAxMSwgSm9obiBSZXNpZwogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBJbmNsdWRlcyBTaXp6bGUuanMKICogaHR0cDovL3NpenpsZWpzLmNvbS8KICogQ29weXJpZ2h0IDIwMTEsIFRoZSBEb2pvIEZvdW5kYXRpb24KICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCwgQlNELCBhbmQgR1BMIExpY2Vuc2VzLgogKgogKiBEYXRlOiBUaHUgSnVuIDMwIDE0OjE2OjU2IDIwMTEgLTA0MDAKICovCihmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGN2KGEpe3JldHVybiBmLmlzV2luZG93KGEpP2E6YS5ub2RlVHlwZT09PTk/YS5kZWZhdWx0Vmlld3x8YS5wYXJlbnRXaW5kb3c6ITF9ZnVuY3Rpb24gY3MoYSl7aWYoIWNnW2FdKXt2YXIgYj1jLmJvZHksZD1mKCI8IithKyI+IikuYXBwZW5kVG8oYiksZT1kLmNzcygiZGlzcGxheSIpO2QucmVtb3ZlKCk7aWYoZT09PSJub25lInx8ZT09PSIiKXtjaHx8KGNoPWMuY3JlYXRlRWxlbWVudCgiaWZyYW1lIiksY2guZnJhbWVCb3JkZXI9Y2gud2lkdGg9Y2guaGVpZ2h0PTApLGIuYXBwZW5kQ2hpbGQoY2gpO2lmKCFjaXx8IWNoLmNyZWF0ZUVsZW1lbnQpY2k9KGNoLmNvbnRlbnRXaW5kb3d8fGNoLmNvbnRlbnREb2N1bWVudCkuZG9jdW1lbnQsY2kud3JpdGUoKGMuY29tcGF0TW9kZT09PSJDU1MxQ29tcGF0Ij8iPCFkb2N0eXBlIGh0bWw+IjoiIikrIjxodG1sPjxib2R5PiIpLGNpLmNsb3NlKCk7ZD1jaS5jcmVhdGVFbGVtZW50KGEpLGNpLmJvZHkuYXBwZW5kQ2hpbGQoZCksZT1mLmNzcyhkLCJkaXNwbGF5IiksYi5yZW1vdmVDaGlsZChjaCl9Y2dbYV09ZX1yZXR1cm4gY2dbYV19ZnVuY3Rpb24gY3IoYSxiKXt2YXIgYz17fTtmLmVhY2goY20uY29uY2F0LmFwcGx5KFtdLGNtLnNsaWNlKDAsYikpLGZ1bmN0aW9uKCl7Y1t0aGlzXT1hfSk7cmV0dXJuIGN9ZnVuY3Rpb24gY3EoKXtjbj1ifWZ1bmN0aW9uIGNwKCl7c2V0VGltZW91dChjcSwwKTtyZXR1cm4gY249Zi5ub3coKX1mdW5jdGlvbiBjZigpe3RyeXtyZXR1cm4gbmV3IGEuQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKX1jYXRjaChiKXt9fWZ1bmN0aW9uIGNlKCl7dHJ5e3JldHVybiBuZXcgYS5YTUxIdHRwUmVxdWVzdH1jYXRjaChiKXt9fWZ1bmN0aW9uIGIkKGEsYyl7YS5kYXRhRmlsdGVyJiYoYz1hLmRhdGFGaWx0ZXIoYyxhLmRhdGFUeXBlKSk7dmFyIGQ9YS5kYXRhVHlwZXMsZT17fSxnLGgsaT1kLmxlbmd0aCxqLGs9ZFswXSxsLG0sbixvLHA7Zm9yKGc9MTtnPGk7ZysrKXtpZihnPT09MSlmb3IoaCBpbiBhLmNvbnZlcnRlcnMpdHlwZW9mIGg9PSJzdHJpbmciJiYoZVtoLnRvTG93ZXJDYXNlKCldPWEuY29udmVydGVyc1toXSk7bD1rLGs9ZFtnXTtpZihrPT09IioiKWs9bDtlbHNlIGlmKGwhPT0iKiImJmwhPT1rKXttPWwrIiAiK2ssbj1lW21dfHxlWyIqICIra107aWYoIW4pe3A9Yjtmb3IobyBpbiBlKXtqPW8uc3BsaXQoIiAiKTtpZihqWzBdPT09bHx8alswXT09PSIqIil7cD1lW2pbMV0rIiAiK2tdO2lmKHApe289ZVtvXSxvPT09ITA/bj1wOnA9PT0hMCYmKG49byk7YnJlYWt9fX19IW4mJiFwJiZmLmVycm9yKCJObyBjb252ZXJzaW9uIGZyb20gIittLnJlcGxhY2UoIiAiLCIgdG8gIikpLG4hPT0hMCYmKGM9bj9uKGMpOnAobyhjKSkpfX1yZXR1cm4gY31mdW5jdGlvbiBiWihhLGMsZCl7dmFyIGU9YS5jb250ZW50cyxmPWEuZGF0YVR5cGVzLGc9YS5yZXNwb25zZUZpZWxkcyxoLGksaixrO2ZvcihpIGluIGcpaSBpbiBkJiYoY1tnW2ldXT1kW2ldKTt3aGlsZShmWzBdPT09IioiKWYuc2hpZnQoKSxoPT09YiYmKGg9YS5taW1lVHlwZXx8Yy5nZXRSZXNwb25zZUhlYWRlcigiY29udGVudC10eXBlIikpO2lmKGgpZm9yKGkgaW4gZSlpZihlW2ldJiZlW2ldLnRlc3QoaCkpe2YudW5zaGlmdChpKTticmVha31pZihmWzBdaW4gZClqPWZbMF07ZWxzZXtmb3IoaSBpbiBkKXtpZighZlswXXx8YS5jb252ZXJ0ZXJzW2krIiAiK2ZbMF1dKXtqPWk7YnJlYWt9a3x8KGs9aSl9aj1qfHxrfWlmKGope2ohPT1mWzBdJiZmLnVuc2hpZnQoaik7cmV0dXJuIGRbal19fWZ1bmN0aW9uIGJZKGEsYixjLGQpe2lmKGYuaXNBcnJheShiKSlmLmVhY2goYixmdW5jdGlvbihiLGUpe2N8fGJDLnRlc3QoYSk/ZChhLGUpOmJZKGErIlsiKyh0eXBlb2YgZT09Im9iamVjdCJ8fGYuaXNBcnJheShlKT9iOiIiKSsiXSIsZSxjLGQpfSk7ZWxzZSBpZighYyYmYiE9bnVsbCYmdHlwZW9mIGI9PSJvYmplY3QiKWZvcih2YXIgZSBpbiBiKWJZKGErIlsiK2UrIl0iLGJbZV0sYyxkKTtlbHNlIGQoYSxiKX1mdW5jdGlvbiBiWChhLGMsZCxlLGYsZyl7Zj1mfHxjLmRhdGFUeXBlc1swXSxnPWd8fHt9LGdbZl09ITA7dmFyIGg9YVtmXSxpPTAsaj1oP2gubGVuZ3RoOjAsaz1hPT09YlIsbDtmb3IoO2k8aiYmKGt8fCFsKTtpKyspbD1oW2ldKGMsZCxlKSx0eXBlb2YgbD09InN0cmluZyImJigha3x8Z1tsXT9sPWI6KGMuZGF0YVR5cGVzLnVuc2hpZnQobCksbD1iWChhLGMsZCxlLGwsZykpKTsoa3x8IWwpJiYhZ1siKiJdJiYobD1iWChhLGMsZCxlLCIqIixnKSk7cmV0dXJuIGx9ZnVuY3Rpb24gYlcoYSl7cmV0dXJuIGZ1bmN0aW9uKGIsYyl7dHlwZW9mIGIhPSJzdHJpbmciJiYoYz1iLGI9IioiKTtpZihmLmlzRnVuY3Rpb24oYykpe3ZhciBkPWIudG9Mb3dlckNhc2UoKS5zcGxpdChiTiksZT0wLGc9ZC5sZW5ndGgsaCxpLGo7Zm9yKDtlPGc7ZSsrKWg9ZFtlXSxqPS9eXCsvLnRlc3QoaCksaiYmKGg9aC5zdWJzdHIoMSl8fCIqIiksaT1hW2hdPWFbaF18fFtdLGlbaj8idW5zaGlmdCI6InB1c2giXShjKX19fWZ1bmN0aW9uIGJBKGEsYixjKXt2YXIgZD1iPT09IndpZHRoIj9hLm9mZnNldFdpZHRoOmEub2Zmc2V0SGVpZ2h0LGU9Yj09PSJ3aWR0aCI/YnY6Ync7aWYoZD4wKXtjIT09ImJvcmRlciImJmYuZWFjaChlLGZ1bmN0aW9uKCl7Y3x8KGQtPXBhcnNlRmxvYXQoZi5jc3MoYSwicGFkZGluZyIrdGhpcykpfHwwKSxjPT09Im1hcmdpbiI/ZCs9cGFyc2VGbG9hdChmLmNzcyhhLGMrdGhpcykpfHwwOmQtPXBhcnNlRmxvYXQoZi5jc3MoYSwiYm9yZGVyIit0aGlzKyJXaWR0aCIpKXx8MH0pO3JldHVybiBkKyJweCJ9ZD1ieChhLGIsYik7aWYoZDwwfHxkPT1udWxsKWQ9YS5zdHlsZVtiXXx8MDtkPXBhcnNlRmxvYXQoZCl8fDAsYyYmZi5lYWNoKGUsZnVuY3Rpb24oKXtkKz1wYXJzZUZsb2F0KGYuY3NzKGEsInBhZGRpbmciK3RoaXMpKXx8MCxjIT09InBhZGRpbmciJiYoZCs9cGFyc2VGbG9hdChmLmNzcyhhLCJib3JkZXIiK3RoaXMrIldpZHRoIikpfHwwKSxjPT09Im1hcmdpbiImJihkKz1wYXJzZUZsb2F0KGYuY3NzKGEsYyt0aGlzKSl8fDApfSk7cmV0dXJuIGQrInB4In1mdW5jdGlvbiBibShhLGIpe2Iuc3JjP2YuYWpheCh7dXJsOmIuc3JjLGFzeW5jOiExLGRhdGFUeXBlOiJzY3JpcHQifSk6Zi5nbG9iYWxFdmFsKChiLnRleHR8fGIudGV4dENvbnRlbnR8fGIuaW5uZXJIVE1MfHwiIikucmVwbGFjZShiZSwiLyokMCovIikpLGIucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGIpfWZ1bmN0aW9uIGJsKGEpe2Yubm9kZU5hbWUoYSwiaW5wdXQiKT9iayhhKToiZ2V0RWxlbWVudHNCeVRhZ05hbWUiaW4gYSYmZi5ncmVwKGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlucHV0IiksYmspfWZ1bmN0aW9uIGJrKGEpe2lmKGEudHlwZT09PSJjaGVja2JveCJ8fGEudHlwZT09PSJyYWRpbyIpYS5kZWZhdWx0Q2hlY2tlZD1hLmNoZWNrZWR9ZnVuY3Rpb24gYmooYSl7cmV0dXJuImdldEVsZW1lbnRzQnlUYWdOYW1lImluIGE/YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpOiJxdWVyeVNlbGVjdG9yQWxsImluIGE/YS5xdWVyeVNlbGVjdG9yQWxsKCIqIik6W119ZnVuY3Rpb24gYmkoYSxiKXt2YXIgYztpZihiLm5vZGVUeXBlPT09MSl7Yi5jbGVhckF0dHJpYnV0ZXMmJmIuY2xlYXJBdHRyaWJ1dGVzKCksYi5tZXJnZUF0dHJpYnV0ZXMmJmIubWVyZ2VBdHRyaWJ1dGVzKGEpLGM9Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmKGM9PT0ib2JqZWN0IiliLm91dGVySFRNTD1hLm91dGVySFRNTDtlbHNlIGlmKGMhPT0iaW5wdXQifHxhLnR5cGUhPT0iY2hlY2tib3giJiZhLnR5cGUhPT0icmFkaW8iKXtpZihjPT09Im9wdGlvbiIpYi5zZWxlY3RlZD1hLmRlZmF1bHRTZWxlY3RlZDtlbHNlIGlmKGM9PT0iaW5wdXQifHxjPT09InRleHRhcmVhIiliLmRlZmF1bHRWYWx1ZT1hLmRlZmF1bHRWYWx1ZX1lbHNlIGEuY2hlY2tlZCYmKGIuZGVmYXVsdENoZWNrZWQ9Yi5jaGVja2VkPWEuY2hlY2tlZCksYi52YWx1ZSE9PWEudmFsdWUmJihiLnZhbHVlPWEudmFsdWUpO2IucmVtb3ZlQXR0cmlidXRlKGYuZXhwYW5kbyl9fWZ1bmN0aW9uIGJoKGEsYil7aWYoYi5ub2RlVHlwZT09PTEmJiEhZi5oYXNEYXRhKGEpKXt2YXIgYz1mLmV4cGFuZG8sZD1mLmRhdGEoYSksZT1mLmRhdGEoYixkKTtpZihkPWRbY10pe3ZhciBnPWQuZXZlbnRzO2U9ZVtjXT1mLmV4dGVuZCh7fSxkKTtpZihnKXtkZWxldGUgZS5oYW5kbGUsZS5ldmVudHM9e307Zm9yKHZhciBoIGluIGcpZm9yKHZhciBpPTAsaj1nW2hdLmxlbmd0aDtpPGo7aSsrKWYuZXZlbnQuYWRkKGIsaCsoZ1toXVtpXS5uYW1lc3BhY2U/Ii4iOiIiKStnW2hdW2ldLm5hbWVzcGFjZSxnW2hdW2ldLGdbaF1baV0uZGF0YSl9fX19ZnVuY3Rpb24gYmcoYSxiKXtyZXR1cm4gZi5ub2RlTmFtZShhLCJ0YWJsZSIpP2EuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRib2R5IilbMF18fGEuYXBwZW5kQ2hpbGQoYS5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRib2R5IikpOmF9ZnVuY3Rpb24gVyhhLGIsYyl7Yj1ifHwwO2lmKGYuaXNGdW5jdGlvbihiKSlyZXR1cm4gZi5ncmVwKGEsZnVuY3Rpb24oYSxkKXt2YXIgZT0hIWIuY2FsbChhLGQsYSk7cmV0dXJuIGU9PT1jfSk7aWYoYi5ub2RlVHlwZSlyZXR1cm4gZi5ncmVwKGEsZnVuY3Rpb24oYSxkKXtyZXR1cm4gYT09PWI9PT1jfSk7aWYodHlwZW9mIGI9PSJzdHJpbmciKXt2YXIgZD1mLmdyZXAoYSxmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlVHlwZT09PTF9KTtpZihSLnRlc3QoYikpcmV0dXJuIGYuZmlsdGVyKGIsZCwhYyk7Yj1mLmZpbHRlcihiLGQpfXJldHVybiBmLmdyZXAoYSxmdW5jdGlvbihhLGQpe3JldHVybiBmLmluQXJyYXkoYSxiKT49MD09PWN9KX1mdW5jdGlvbiBWKGEpe3JldHVybiFhfHwhYS5wYXJlbnROb2RlfHxhLnBhcmVudE5vZGUubm9kZVR5cGU9PT0xMX1mdW5jdGlvbiBOKGEsYil7cmV0dXJuKGEmJmEhPT0iKiI/YSsiLiI6IiIpK2IucmVwbGFjZSh6LCJgIikucmVwbGFjZShBLCImIil9ZnVuY3Rpb24gTShhKXt2YXIgYixjLGQsZSxnLGgsaSxqLGssbCxtLG4sbyxwPVtdLHE9W10scj1mLl9kYXRhKHRoaXMsImV2ZW50cyIpO2lmKCEoYS5saXZlRmlyZWQ9PT10aGlzfHwhcnx8IXIubGl2ZXx8YS50YXJnZXQuZGlzYWJsZWR8fGEuYnV0dG9uJiZhLnR5cGU9PT0iY2xpY2siKSl7YS5uYW1lc3BhY2UmJihuPW5ldyBSZWdFeHAoIihefFxcLikiK2EubmFtZXNwYWNlLnNwbGl0KCIuIikuam9pbigiXFwuKD86LipcXC4pPyIpKyIoXFwufCQpIikpLGEubGl2ZUZpcmVkPXRoaXM7dmFyIHM9ci5saXZlLnNsaWNlKDApO2ZvcihpPTA7aTxzLmxlbmd0aDtpKyspZz1zW2ldLGcub3JpZ1R5cGUucmVwbGFjZSh4LCIiKT09PWEudHlwZT9xLnB1c2goZy5zZWxlY3Rvcik6cy5zcGxpY2UoaS0tLDEpO2U9ZihhLnRhcmdldCkuY2xvc2VzdChxLGEuY3VycmVudFRhcmdldCk7Zm9yKGo9MCxrPWUubGVuZ3RoO2o8aztqKyspe209ZVtqXTtmb3IoaT0wO2k8cy5sZW5ndGg7aSsrKXtnPXNbaV07aWYobS5zZWxlY3Rvcj09PWcuc2VsZWN0b3ImJighbnx8bi50ZXN0KGcubmFtZXNwYWNlKSkmJiFtLmVsZW0uZGlzYWJsZWQpe2g9bS5lbGVtLGQ9bnVsbDtpZihnLnByZVR5cGU9PT0ibW91c2VlbnRlciJ8fGcucHJlVHlwZT09PSJtb3VzZWxlYXZlIilhLnR5cGU9Zy5wcmVUeXBlLGQ9ZihhLnJlbGF0ZWRUYXJnZXQpLmNsb3Nlc3QoZy5zZWxlY3RvcilbMF0sZCYmZi5jb250YWlucyhoLGQpJiYoZD1oKTsoIWR8fGQhPT1oKSYmcC5wdXNoKHtlbGVtOmgsaGFuZGxlT2JqOmcsbGV2ZWw6bS5sZXZlbH0pfX19Zm9yKGo9MCxrPXAubGVuZ3RoO2o8aztqKyspe2U9cFtqXTtpZihjJiZlLmxldmVsPmMpYnJlYWs7YS5jdXJyZW50VGFyZ2V0PWUuZWxlbSxhLmRhdGE9ZS5oYW5kbGVPYmouZGF0YSxhLmhhbmRsZU9iaj1lLmhhbmRsZU9iaixvPWUuaGFuZGxlT2JqLm9yaWdIYW5kbGVyLmFwcGx5KGUuZWxlbSxhcmd1bWVudHMpO2lmKG89PT0hMXx8YS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKXtjPWUubGV2ZWwsbz09PSExJiYoYj0hMSk7aWYoYS5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpKWJyZWFrfX1yZXR1cm4gYn19ZnVuY3Rpb24gSyhhLGMsZCl7dmFyIGU9Zi5leHRlbmQoe30sZFswXSk7ZS50eXBlPWEsZS5vcmlnaW5hbEV2ZW50PXt9LGUubGl2ZUZpcmVkPWIsZi5ldmVudC5oYW5kbGUuY2FsbChjLGUpLGUuaXNEZWZhdWx0UHJldmVudGVkKCkmJmRbMF0ucHJldmVudERlZmF1bHQoKX1mdW5jdGlvbiBFKCl7cmV0dXJuITB9ZnVuY3Rpb24gRCgpe3JldHVybiExfWZ1bmN0aW9uIG0oYSxjLGQpe3ZhciBlPWMrImRlZmVyIixnPWMrInF1ZXVlIixoPWMrIm1hcmsiLGk9Zi5kYXRhKGEsZSxiLCEwKTtpJiYoZD09PSJxdWV1ZSJ8fCFmLmRhdGEoYSxnLGIsITApKSYmKGQ9PT0ibWFyayJ8fCFmLmRhdGEoYSxoLGIsITApKSYmc2V0VGltZW91dChmdW5jdGlvbigpeyFmLmRhdGEoYSxnLGIsITApJiYhZi5kYXRhKGEsaCxiLCEwKSYmKGYucmVtb3ZlRGF0YShhLGUsITApLGkucmVzb2x2ZSgpKX0sMCl9ZnVuY3Rpb24gbChhKXtmb3IodmFyIGIgaW4gYSlpZihiIT09InRvSlNPTiIpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gayhhLGMsZCl7aWYoZD09PWImJmEubm9kZVR5cGU9PT0xKXt2YXIgZT0iZGF0YS0iK2MucmVwbGFjZShqLCIkMS0kMiIpLnRvTG93ZXJDYXNlKCk7ZD1hLmdldEF0dHJpYnV0ZShlKTtpZih0eXBlb2YgZD09InN0cmluZyIpe3RyeXtkPWQ9PT0idHJ1ZSI/ITA6ZD09PSJmYWxzZSI/ITE6ZD09PSJudWxsIj9udWxsOmYuaXNOYU4oZCk/aS50ZXN0KGQpP2YucGFyc2VKU09OKGQpOmQ6cGFyc2VGbG9hdChkKX1jYXRjaChnKXt9Zi5kYXRhKGEsYyxkKX1lbHNlIGQ9Yn1yZXR1cm4gZH12YXIgYz1hLmRvY3VtZW50LGQ9YS5uYXZpZ2F0b3IsZT1hLmxvY2F0aW9uLGY9ZnVuY3Rpb24oKXtmdW5jdGlvbiBKKCl7aWYoIWUuaXNSZWFkeSl7dHJ5e2MuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKCJsZWZ0Iil9Y2F0Y2goYSl7c2V0VGltZW91dChKLDEpO3JldHVybn1lLnJlYWR5KCl9fXZhciBlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBlLmZuLmluaXQoYSxiLGgpfSxmPWEualF1ZXJ5LGc9YS4kLGgsaT0vXig/OltePF0qKDxbXHdcV10rPilbXj5dKiR8IyhbXHdcLV0qKSQpLyxqPS9cUy8saz0vXlxzKy8sbD0vXHMrJC8sbT0vXGQvLG49L148KFx3KylccypcLz8+KD86PFwvXDE+KT8kLyxvPS9eW1xdLDp7fVxzXSokLyxwPS9cXCg/OlsiXFxcL2JmbnJ0XXx1WzAtOWEtZkEtRl17NH0pL2cscT0vIlteIlxcXG5ccl0qInx0cnVlfGZhbHNlfG51bGx8LT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/L2cscj0vKD86Xnw6fCwpKD86XHMqXFspKy9nLHM9Lyh3ZWJraXQpWyBcL10oW1x3Ll0rKS8sdD0vKG9wZXJhKSg/Oi4qdmVyc2lvbik/WyBcL10oW1x3Ll0rKS8sdT0vKG1zaWUpIChbXHcuXSspLyx2PS8obW96aWxsYSkoPzouKj8gcnY6KFtcdy5dKykpPy8sdz0vLShbYS16XSkvaWcseD1mdW5jdGlvbihhLGIpe3JldHVybiBiLnRvVXBwZXJDYXNlKCl9LHk9ZC51c2VyQWdlbnQseixBLEIsQz1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLEQ9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxFPUFycmF5LnByb3RvdHlwZS5wdXNoLEY9QXJyYXkucHJvdG90eXBlLnNsaWNlLEc9U3RyaW5nLnByb3RvdHlwZS50cmltLEg9QXJyYXkucHJvdG90eXBlLmluZGV4T2YsST17fTtlLmZuPWUucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjplLGluaXQ6ZnVuY3Rpb24oYSxkLGYpe3ZhciBnLGgsaixrO2lmKCFhKXJldHVybiB0aGlzO2lmKGEubm9kZVR5cGUpe3RoaXMuY29udGV4dD10aGlzWzBdPWEsdGhpcy5sZW5ndGg9MTtyZXR1cm4gdGhpc31pZihhPT09ImJvZHkiJiYhZCYmYy5ib2R5KXt0aGlzLmNvbnRleHQ9Yyx0aGlzWzBdPWMuYm9keSx0aGlzLnNlbGVjdG9yPWEsdGhpcy5sZW5ndGg9MTtyZXR1cm4gdGhpc31pZih0eXBlb2YgYT09InN0cmluZyIpe2EuY2hhckF0KDApIT09IjwifHxhLmNoYXJBdChhLmxlbmd0aC0xKSE9PSI+Inx8YS5sZW5ndGg8Mz9nPWkuZXhlYyhhKTpnPVtudWxsLGEsbnVsbF07aWYoZyYmKGdbMV18fCFkKSl7aWYoZ1sxXSl7ZD1kIGluc3RhbmNlb2YgZT9kWzBdOmQsaz1kP2Qub3duZXJEb2N1bWVudHx8ZDpjLGo9bi5leGVjKGEpLGo/ZS5pc1BsYWluT2JqZWN0KGQpPyhhPVtjLmNyZWF0ZUVsZW1lbnQoalsxXSldLGUuZm4uYXR0ci5jYWxsKGEsZCwhMCkpOmE9W2suY3JlYXRlRWxlbWVudChqWzFdKV06KGo9ZS5idWlsZEZyYWdtZW50KFtnWzFdXSxba10pLGE9KGouY2FjaGVhYmxlP2UuY2xvbmUoai5mcmFnbWVudCk6ai5mcmFnbWVudCkuY2hpbGROb2Rlcyk7cmV0dXJuIGUubWVyZ2UodGhpcyxhKX1oPWMuZ2V0RWxlbWVudEJ5SWQoZ1syXSk7aWYoaCYmaC5wYXJlbnROb2RlKXtpZihoLmlkIT09Z1syXSlyZXR1cm4gZi5maW5kKGEpO3RoaXMubGVuZ3RoPTEsdGhpc1swXT1ofXRoaXMuY29udGV4dD1jLHRoaXMuc2VsZWN0b3I9YTtyZXR1cm4gdGhpc31yZXR1cm4hZHx8ZC5qcXVlcnk/KGR8fGYpLmZpbmQoYSk6dGhpcy5jb25zdHJ1Y3RvcihkKS5maW5kKGEpfWlmKGUuaXNGdW5jdGlvbihhKSlyZXR1cm4gZi5yZWFkeShhKTthLnNlbGVjdG9yIT09YiYmKHRoaXMuc2VsZWN0b3I9YS5zZWxlY3Rvcix0aGlzLmNvbnRleHQ9YS5jb250ZXh0KTtyZXR1cm4gZS5tYWtlQXJyYXkoYSx0aGlzKX0sc2VsZWN0b3I6IiIsanF1ZXJ5OiIxLjYuMiIsbGVuZ3RoOjAsc2l6ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmxlbmd0aH0sdG9BcnJheTpmdW5jdGlvbigpe3JldHVybiBGLmNhbGwodGhpcywwKX0sZ2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsP3RoaXMudG9BcnJheSgpOmE8MD90aGlzW3RoaXMubGVuZ3RoK2FdOnRoaXNbYV19LHB1c2hTdGFjazpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5jb25zdHJ1Y3RvcigpO2UuaXNBcnJheShhKT9FLmFwcGx5KGQsYSk6ZS5tZXJnZShkLGEpLGQucHJldk9iamVjdD10aGlzLGQuY29udGV4dD10aGlzLmNvbnRleHQsYj09PSJmaW5kIj9kLnNlbGVjdG9yPXRoaXMuc2VsZWN0b3IrKHRoaXMuc2VsZWN0b3I/IiAiOiIiKStjOmImJihkLnNlbGVjdG9yPXRoaXMuc2VsZWN0b3IrIi4iK2IrIigiK2MrIikiKTtyZXR1cm4gZH0sZWFjaDpmdW5jdGlvbihhLGIpe3JldHVybiBlLmVhY2godGhpcyxhLGIpfSxyZWFkeTpmdW5jdGlvbihhKXtlLmJpbmRSZWFkeSgpLEEuZG9uZShhKTtyZXR1cm4gdGhpc30sZXE6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT0tMT90aGlzLnNsaWNlKGEpOnRoaXMuc2xpY2UoYSwrYSsxKX0sZmlyc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lcSgwKX0sbGFzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKC0xKX0sc2xpY2U6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2soRi5hcHBseSh0aGlzLGFyZ3VtZW50cyksInNsaWNlIixGLmNhbGwoYXJndW1lbnRzKS5qb2luKCIsIikpfSxtYXA6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGUubWFwKHRoaXMsZnVuY3Rpb24oYixjKXtyZXR1cm4gYS5jYWxsKGIsYyxiKX0pKX0sZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHJldk9iamVjdHx8dGhpcy5jb25zdHJ1Y3RvcihudWxsKX0scHVzaDpFLHNvcnQ6W10uc29ydCxzcGxpY2U6W10uc3BsaWNlfSxlLmZuLmluaXQucHJvdG90eXBlPWUuZm4sZS5leHRlbmQ9ZS5mbi5leHRlbmQ9ZnVuY3Rpb24oKXt2YXIgYSxjLGQsZixnLGgsaT1hcmd1bWVudHNbMF18fHt9LGo9MSxrPWFyZ3VtZW50cy5sZW5ndGgsbD0hMTt0eXBlb2YgaT09ImJvb2xlYW4iJiYobD1pLGk9YXJndW1lbnRzWzFdfHx7fSxqPTIpLHR5cGVvZiBpIT0ib2JqZWN0IiYmIWUuaXNGdW5jdGlvbihpKSYmKGk9e30pLGs9PT1qJiYoaT10aGlzLC0taik7Zm9yKDtqPGs7aisrKWlmKChhPWFyZ3VtZW50c1tqXSkhPW51bGwpZm9yKGMgaW4gYSl7ZD1pW2NdLGY9YVtjXTtpZihpPT09Ziljb250aW51ZTtsJiZmJiYoZS5pc1BsYWluT2JqZWN0KGYpfHwoZz1lLmlzQXJyYXkoZikpKT8oZz8oZz0hMSxoPWQmJmUuaXNBcnJheShkKT9kOltdKTpoPWQmJmUuaXNQbGFpbk9iamVjdChkKT9kOnt9LGlbY109ZS5leHRlbmQobCxoLGYpKTpmIT09YiYmKGlbY109Zil9cmV0dXJuIGl9LGUuZXh0ZW5kKHtub0NvbmZsaWN0OmZ1bmN0aW9uKGIpe2EuJD09PWUmJihhLiQ9ZyksYiYmYS5qUXVlcnk9PT1lJiYoYS5qUXVlcnk9Zik7cmV0dXJuIGV9LGlzUmVhZHk6ITEscmVhZHlXYWl0OjEsaG9sZFJlYWR5OmZ1bmN0aW9uKGEpe2E/ZS5yZWFkeVdhaXQrKzplLnJlYWR5KCEwKX0scmVhZHk6ZnVuY3Rpb24oYSl7aWYoYT09PSEwJiYhLS1lLnJlYWR5V2FpdHx8YSE9PSEwJiYhZS5pc1JlYWR5KXtpZighYy5ib2R5KXJldHVybiBzZXRUaW1lb3V0KGUucmVhZHksMSk7ZS5pc1JlYWR5PSEwO2lmKGEhPT0hMCYmLS1lLnJlYWR5V2FpdD4wKXJldHVybjtBLnJlc29sdmVXaXRoKGMsW2VdKSxlLmZuLnRyaWdnZXImJmUoYykudHJpZ2dlcigicmVhZHkiKS51bmJpbmQoInJlYWR5Iil9fSxiaW5kUmVhZHk6ZnVuY3Rpb24oKXtpZighQSl7QT1lLl9EZWZlcnJlZCgpO2lmKGMucmVhZHlTdGF0ZT09PSJjb21wbGV0ZSIpcmV0dXJuIHNldFRpbWVvdXQoZS5yZWFkeSwxKTtpZihjLmFkZEV2ZW50TGlzdGVuZXIpYy5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixCLCExKSxhLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLGUucmVhZHksITEpO2Vsc2UgaWYoYy5hdHRhY2hFdmVudCl7Yy5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIixCKSxhLmF0dGFjaEV2ZW50KCJvbmxvYWQiLGUucmVhZHkpO3ZhciBiPSExO3RyeXtiPWEuZnJhbWVFbGVtZW50PT1udWxsfWNhdGNoKGQpe31jLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCYmYiYmSigpfX19LGlzRnVuY3Rpb246ZnVuY3Rpb24oYSl7cmV0dXJuIGUudHlwZShhKT09PSJmdW5jdGlvbiJ9LGlzQXJyYXk6QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oYSl7cmV0dXJuIGUudHlwZShhKT09PSJhcnJheSJ9LGlzV2luZG93OmZ1bmN0aW9uKGEpe3JldHVybiBhJiZ0eXBlb2YgYT09Im9iamVjdCImJiJzZXRJbnRlcnZhbCJpbiBhfSxpc05hTjpmdW5jdGlvbihhKXtyZXR1cm4gYT09bnVsbHx8IW0udGVzdChhKXx8aXNOYU4oYSl9LHR5cGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/U3RyaW5nKGEpOklbQy5jYWxsKGEpXXx8Im9iamVjdCJ9LGlzUGxhaW5PYmplY3Q6ZnVuY3Rpb24oYSl7aWYoIWF8fGUudHlwZShhKSE9PSJvYmplY3QifHxhLm5vZGVUeXBlfHxlLmlzV2luZG93KGEpKXJldHVybiExO2lmKGEuY29uc3RydWN0b3ImJiFELmNhbGwoYSwiY29uc3RydWN0b3IiKSYmIUQuY2FsbChhLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwiaXNQcm90b3R5cGVPZiIpKXJldHVybiExO3ZhciBjO2ZvcihjIGluIGEpO3JldHVybiBjPT09Ynx8RC5jYWxsKGEsYyl9LGlzRW1wdHlPYmplY3Q6ZnVuY3Rpb24oYSl7Zm9yKHZhciBiIGluIGEpcmV0dXJuITE7cmV0dXJuITB9LGVycm9yOmZ1bmN0aW9uKGEpe3Rocm93IGF9LHBhcnNlSlNPTjpmdW5jdGlvbihiKXtpZih0eXBlb2YgYiE9InN0cmluZyJ8fCFiKXJldHVybiBudWxsO2I9ZS50cmltKGIpO2lmKGEuSlNPTiYmYS5KU09OLnBhcnNlKXJldHVybiBhLkpTT04ucGFyc2UoYik7aWYoby50ZXN0KGIucmVwbGFjZShwLCJAIikucmVwbGFjZShxLCJdIikucmVwbGFjZShyLCIiKSkpcmV0dXJuKG5ldyBGdW5jdGlvbigicmV0dXJuICIrYikpKCk7ZS5lcnJvcigiSW52YWxpZCBKU09OOiAiK2IpfSxwYXJzZVhNTDpmdW5jdGlvbihiLGMsZCl7YS5ET01QYXJzZXI/KGQ9bmV3IERPTVBhcnNlcixjPWQucGFyc2VGcm9tU3RyaW5nKGIsInRleHQveG1sIikpOihjPW5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MRE9NIiksYy5hc3luYz0iZmFsc2UiLGMubG9hZFhNTChiKSksZD1jLmRvY3VtZW50RWxlbWVudCwoIWR8fCFkLm5vZGVOYW1lfHxkLm5vZGVOYW1lPT09InBhcnNlcmVycm9yIikmJmUuZXJyb3IoIkludmFsaWQgWE1MOiAiK2IpO3JldHVybiBjfSxub29wOmZ1bmN0aW9uKCl7fSxnbG9iYWxFdmFsOmZ1bmN0aW9uKGIpe2ImJmoudGVzdChiKSYmKGEuZXhlY1NjcmlwdHx8ZnVuY3Rpb24oYil7YS5ldmFsLmNhbGwoYSxiKX0pKGIpfSxjYW1lbENhc2U6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSh3LHgpfSxub2RlTmFtZTpmdW5jdGlvbihhLGIpe3JldHVybiBhLm5vZGVOYW1lJiZhLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk9PT1iLnRvVXBwZXJDYXNlKCl9LGVhY2g6ZnVuY3Rpb24oYSxjLGQpe3ZhciBmLGc9MCxoPWEubGVuZ3RoLGk9aD09PWJ8fGUuaXNGdW5jdGlvbihhKTtpZihkKXtpZihpKXtmb3IoZiBpbiBhKWlmKGMuYXBwbHkoYVtmXSxkKT09PSExKWJyZWFrfWVsc2UgZm9yKDtnPGg7KWlmKGMuYXBwbHkoYVtnKytdLGQpPT09ITEpYnJlYWt9ZWxzZSBpZihpKXtmb3IoZiBpbiBhKWlmKGMuY2FsbChhW2ZdLGYsYVtmXSk9PT0hMSlicmVha31lbHNlIGZvcig7ZzxoOylpZihjLmNhbGwoYVtnXSxnLGFbZysrXSk9PT0hMSlicmVhaztyZXR1cm4gYX0sdHJpbTpHP2Z1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsPyIiOkcuY2FsbChhKX06ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/IiI6KGErIiIpLnJlcGxhY2UoaywiIikucmVwbGFjZShsLCIiKX0sbWFrZUFycmF5OmZ1bmN0aW9uKGEsYil7dmFyIGM9Ynx8W107aWYoYSE9bnVsbCl7dmFyIGQ9ZS50eXBlKGEpO2EubGVuZ3RoPT1udWxsfHxkPT09InN0cmluZyJ8fGQ9PT0iZnVuY3Rpb24ifHxkPT09InJlZ2V4cCJ8fGUuaXNXaW5kb3coYSk/RS5jYWxsKGMsYSk6ZS5tZXJnZShjLGEpfXJldHVybiBjfSxpbkFycmF5OmZ1bmN0aW9uKGEsYil7aWYoSClyZXR1cm4gSC5jYWxsKGIsYSk7Zm9yKHZhciBjPTAsZD1iLmxlbmd0aDtjPGQ7YysrKWlmKGJbY109PT1hKXJldHVybiBjO3JldHVybi0xfSxtZXJnZTpmdW5jdGlvbihhLGMpe3ZhciBkPWEubGVuZ3RoLGU9MDtpZih0eXBlb2YgYy5sZW5ndGg9PSJudW1iZXIiKWZvcih2YXIgZj1jLmxlbmd0aDtlPGY7ZSsrKWFbZCsrXT1jW2VdO2Vsc2Ugd2hpbGUoY1tlXSE9PWIpYVtkKytdPWNbZSsrXTthLmxlbmd0aD1kO3JldHVybiBhfSxncmVwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD1bXSxlO2M9ISFjO2Zvcih2YXIgZj0wLGc9YS5sZW5ndGg7ZjxnO2YrKyllPSEhYihhW2ZdLGYpLGMhPT1lJiZkLnB1c2goYVtmXSk7cmV0dXJuIGR9LG1hcDpmdW5jdGlvbihhLGMsZCl7dmFyIGYsZyxoPVtdLGk9MCxqPWEubGVuZ3RoLGs9YSBpbnN0YW5jZW9mIGV8fGohPT1iJiZ0eXBlb2Ygaj09Im51bWJlciImJihqPjAmJmFbMF0mJmFbai0xXXx8aj09PTB8fGUuaXNBcnJheShhKSk7aWYoaylmb3IoO2k8ajtpKyspZj1jKGFbaV0saSxkKSxmIT1udWxsJiYoaFtoLmxlbmd0aF09Zik7ZWxzZSBmb3IoZyBpbiBhKWY9YyhhW2ddLGcsZCksZiE9bnVsbCYmKGhbaC5sZW5ndGhdPWYpO3JldHVybiBoLmNvbmNhdC5hcHBseShbXSxoKX0sZ3VpZDoxLHByb3h5OmZ1bmN0aW9uKGEsYyl7aWYodHlwZW9mIGM9PSJzdHJpbmciKXt2YXIgZD1hW2NdO2M9YSxhPWR9aWYoIWUuaXNGdW5jdGlvbihhKSlyZXR1cm4gYjt2YXIgZj1GLmNhbGwoYXJndW1lbnRzLDIpLGc9ZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShjLGYuY29uY2F0KEYuY2FsbChhcmd1bWVudHMpKSl9O2cuZ3VpZD1hLmd1aWQ9YS5ndWlkfHxnLmd1aWR8fGUuZ3VpZCsrO3JldHVybiBnfSxhY2Nlc3M6ZnVuY3Rpb24oYSxjLGQsZixnLGgpe3ZhciBpPWEubGVuZ3RoO2lmKHR5cGVvZiBjPT0ib2JqZWN0Iil7Zm9yKHZhciBqIGluIGMpZS5hY2Nlc3MoYSxqLGNbal0sZixnLGQpO3JldHVybiBhfWlmKGQhPT1iKXtmPSFoJiZmJiZlLmlzRnVuY3Rpb24oZCk7Zm9yKHZhciBrPTA7azxpO2srKylnKGFba10sYyxmP2QuY2FsbChhW2tdLGssZyhhW2tdLGMpKTpkLGgpO3JldHVybiBhfXJldHVybiBpP2coYVswXSxjKTpifSxub3c6ZnVuY3Rpb24oKXtyZXR1cm4obmV3IERhdGUpLmdldFRpbWUoKX0sdWFNYXRjaDpmdW5jdGlvbihhKXthPWEudG9Mb3dlckNhc2UoKTt2YXIgYj1zLmV4ZWMoYSl8fHQuZXhlYyhhKXx8dS5leGVjKGEpfHxhLmluZGV4T2YoImNvbXBhdGlibGUiKTwwJiZ2LmV4ZWMoYSl8fFtdO3JldHVybnticm93c2VyOmJbMV18fCIiLHZlcnNpb246YlsyXXx8IjAifX0sc3ViOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gYShiLGMpe3JldHVybiBuZXcgYS5mbi5pbml0KGIsYyl9ZS5leHRlbmQoITAsYSx0aGlzKSxhLnN1cGVyY2xhc3M9dGhpcyxhLmZuPWEucHJvdG90eXBlPXRoaXMoKSxhLmZuLmNvbnN0cnVjdG9yPWEsYS5zdWI9dGhpcy5zdWIsYS5mbi5pbml0PWZ1bmN0aW9uKGQsZil7ZiYmZiBpbnN0YW5jZW9mIGUmJiEoZiBpbnN0YW5jZW9mIGEpJiYoZj1hKGYpKTtyZXR1cm4gZS5mbi5pbml0LmNhbGwodGhpcyxkLGYsYil9LGEuZm4uaW5pdC5wcm90b3R5cGU9YS5mbjt2YXIgYj1hKGMpO3JldHVybiBhfSxicm93c2VyOnt9fSksZS5lYWNoKCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0Ii5zcGxpdCgiICIpLGZ1bmN0aW9uKGEsYil7SVsiW29iamVjdCAiK2IrIl0iXT1iLnRvTG93ZXJDYXNlKCl9KSx6PWUudWFNYXRjaCh5KSx6LmJyb3dzZXImJihlLmJyb3dzZXJbei5icm93c2VyXT0hMCxlLmJyb3dzZXIudmVyc2lvbj16LnZlcnNpb24pLGUuYnJvd3Nlci53ZWJraXQmJihlLmJyb3dzZXIuc2FmYXJpPSEwKSxqLnRlc3QoIsKgIikmJihrPS9eW1xzXHhBMF0rLyxsPS9bXHNceEEwXSskLyksaD1lKGMpLGMuYWRkRXZlbnRMaXN0ZW5lcj9CPWZ1bmN0aW9uKCl7Yy5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixCLCExKSxlLnJlYWR5KCl9OmMuYXR0YWNoRXZlbnQmJihCPWZ1bmN0aW9uKCl7Yy5yZWFkeVN0YXRlPT09ImNvbXBsZXRlIiYmKGMuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsQiksZS5yZWFkeSgpKX0pO3JldHVybiBlfSgpLGc9ImRvbmUgZmFpbCBpc1Jlc29sdmVkIGlzUmVqZWN0ZWQgcHJvbWlzZSB0aGVuIGFsd2F5cyBwaXBlIi5zcGxpdCgiICIpLGg9W10uc2xpY2U7Zi5leHRlbmQoe19EZWZlcnJlZDpmdW5jdGlvbigpe3ZhciBhPVtdLGIsYyxkLGU9e2RvbmU6ZnVuY3Rpb24oKXtpZighZCl7dmFyIGM9YXJndW1lbnRzLGcsaCxpLGosaztiJiYoaz1iLGI9MCk7Zm9yKGc9MCxoPWMubGVuZ3RoO2c8aDtnKyspaT1jW2ddLGo9Zi50eXBlKGkpLGo9PT0iYXJyYXkiP2UuZG9uZS5hcHBseShlLGkpOmo9PT0iZnVuY3Rpb24iJiZhLnB1c2goaSk7ayYmZS5yZXNvbHZlV2l0aChrWzBdLGtbMV0pfXJldHVybiB0aGlzfSxyZXNvbHZlV2l0aDpmdW5jdGlvbihlLGYpe2lmKCFkJiYhYiYmIWMpe2Y9Znx8W10sYz0xO3RyeXt3aGlsZShhWzBdKWEuc2hpZnQoKS5hcHBseShlLGYpfWZpbmFsbHl7Yj1bZSxmXSxjPTB9fXJldHVybiB0aGlzfSxyZXNvbHZlOmZ1bmN0aW9uKCl7ZS5yZXNvbHZlV2l0aCh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIHRoaXN9LGlzUmVzb2x2ZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hIWN8fCEhYn0sY2FuY2VsOmZ1bmN0aW9uKCl7ZD0xLGE9W107cmV0dXJuIHRoaXN9fTtyZXR1cm4gZX0sRGVmZXJyZWQ6ZnVuY3Rpb24oYSl7dmFyIGI9Zi5fRGVmZXJyZWQoKSxjPWYuX0RlZmVycmVkKCksZDtmLmV4dGVuZChiLHt0aGVuOmZ1bmN0aW9uKGEsYyl7Yi5kb25lKGEpLmZhaWwoYyk7cmV0dXJuIHRoaXN9LGFsd2F5czpmdW5jdGlvbigpe3JldHVybiBiLmRvbmUuYXBwbHkoYixhcmd1bWVudHMpLmZhaWwuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxmYWlsOmMuZG9uZSxyZWplY3RXaXRoOmMucmVzb2x2ZVdpdGgscmVqZWN0OmMucmVzb2x2ZSxpc1JlamVjdGVkOmMuaXNSZXNvbHZlZCxwaXBlOmZ1bmN0aW9uKGEsYyl7cmV0dXJuIGYuRGVmZXJyZWQoZnVuY3Rpb24oZCl7Zi5lYWNoKHtkb25lOlthLCJyZXNvbHZlIl0sZmFpbDpbYywicmVqZWN0Il19LGZ1bmN0aW9uKGEsYyl7dmFyIGU9Y1swXSxnPWNbMV0saDtmLmlzRnVuY3Rpb24oZSk/YlthXShmdW5jdGlvbigpe2g9ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksaCYmZi5pc0Z1bmN0aW9uKGgucHJvbWlzZSk/aC5wcm9taXNlKCkudGhlbihkLnJlc29sdmUsZC5yZWplY3QpOmRbZ10oaCl9KTpiW2FdKGRbZ10pfSl9KS5wcm9taXNlKCl9LHByb21pc2U6ZnVuY3Rpb24oYSl7aWYoYT09bnVsbCl7aWYoZClyZXR1cm4gZDtkPWE9e319dmFyIGM9Zy5sZW5ndGg7d2hpbGUoYy0tKWFbZ1tjXV09YltnW2NdXTtyZXR1cm4gYX19KSxiLmRvbmUoYy5jYW5jZWwpLmZhaWwoYi5jYW5jZWwpLGRlbGV0ZSBiLmNhbmNlbCxhJiZhLmNhbGwoYixiKTtyZXR1cm4gYn0sd2hlbjpmdW5jdGlvbihhKXtmdW5jdGlvbiBpKGEpe3JldHVybiBmdW5jdGlvbihjKXtiW2FdPWFyZ3VtZW50cy5sZW5ndGg+MT9oLmNhbGwoYXJndW1lbnRzLDApOmMsLS1lfHxnLnJlc29sdmVXaXRoKGcsaC5jYWxsKGIsMCkpfX12YXIgYj1hcmd1bWVudHMsYz0wLGQ9Yi5sZW5ndGgsZT1kLGc9ZDw9MSYmYSYmZi5pc0Z1bmN0aW9uKGEucHJvbWlzZSk/YTpmLkRlZmVycmVkKCk7aWYoZD4xKXtmb3IoO2M8ZDtjKyspYltjXSYmZi5pc0Z1bmN0aW9uKGJbY10ucHJvbWlzZSk/YltjXS5wcm9taXNlKCkudGhlbihpKGMpLGcucmVqZWN0KTotLWU7ZXx8Zy5yZXNvbHZlV2l0aChnLGIpfWVsc2UgZyE9PWEmJmcucmVzb2x2ZVdpdGgoZyxkP1thXTpbXSk7cmV0dXJuIGcucHJvbWlzZSgpfX0pLGYuc3VwcG9ydD1mdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudCgiZGl2IiksYj1jLmRvY3VtZW50RWxlbWVudCxkLGUsZyxoLGksaixrLGwsbSxuLG8scCxxLHIscyx0LHU7YS5zZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIsInQiKSxhLmlubmVySFRNTD0iICAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJyBzdHlsZT0ndG9wOjFweDtmbG9hdDpsZWZ0O29wYWNpdHk6LjU1Oyc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz4iLGQ9YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLGU9YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYSIpWzBdO2lmKCFkfHwhZC5sZW5ndGh8fCFlKXJldHVybnt9O2c9Yy5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKSxoPWcuYXBwZW5kQ2hpbGQoYy5jcmVhdGVFbGVtZW50KCJvcHRpb24iKSksaT1hLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpbnB1dCIpWzBdLGs9e2xlYWRpbmdXaGl0ZXNwYWNlOmEuZmlyc3RDaGlsZC5ub2RlVHlwZT09PTMsdGJvZHk6IWEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRib2R5IikubGVuZ3RoLGh0bWxTZXJpYWxpemU6ISFhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJsaW5rIikubGVuZ3RoLHN0eWxlOi90b3AvLnRlc3QoZS5nZXRBdHRyaWJ1dGUoInN0eWxlIikpLGhyZWZOb3JtYWxpemVkOmUuZ2V0QXR0cmlidXRlKCJocmVmIik9PT0iL2EiLG9wYWNpdHk6L14wLjU1JC8udGVzdChlLnN0eWxlLm9wYWNpdHkpLGNzc0Zsb2F0OiEhZS5zdHlsZS5jc3NGbG9hdCxjaGVja09uOmkudmFsdWU9PT0ib24iLG9wdFNlbGVjdGVkOmguc2VsZWN0ZWQsZ2V0U2V0QXR0cmlidXRlOmEuY2xhc3NOYW1lIT09InQiLHN1Ym1pdEJ1YmJsZXM6ITAsY2hhbmdlQnViYmxlczohMCxmb2N1c2luQnViYmxlczohMSxkZWxldGVFeHBhbmRvOiEwLG5vQ2xvbmVFdmVudDohMCxpbmxpbmVCbG9ja05lZWRzTGF5b3V0OiExLHNocmlua1dyYXBCbG9ja3M6ITEscmVsaWFibGVNYXJnaW5SaWdodDohMH0saS5jaGVja2VkPSEwLGsubm9DbG9uZUNoZWNrZWQ9aS5jbG9uZU5vZGUoITApLmNoZWNrZWQsZy5kaXNhYmxlZD0hMCxrLm9wdERpc2FibGVkPSFoLmRpc2FibGVkO3RyeXtkZWxldGUgYS50ZXN0fWNhdGNoKHYpe2suZGVsZXRlRXhwYW5kbz0hMX0hYS5hZGRFdmVudExpc3RlbmVyJiZhLmF0dGFjaEV2ZW50JiZhLmZpcmVFdmVudCYmKGEuYXR0YWNoRXZlbnQoIm9uY2xpY2siLGZ1bmN0aW9uKCl7ay5ub0Nsb25lRXZlbnQ9ITF9KSxhLmNsb25lTm9kZSghMCkuZmlyZUV2ZW50KCJvbmNsaWNrIikpLGk9Yy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpLGkudmFsdWU9InQiLGkuc2V0QXR0cmlidXRlKCJ0eXBlIiwicmFkaW8iKSxrLnJhZGlvVmFsdWU9aS52YWx1ZT09PSJ0IixpLnNldEF0dHJpYnV0ZSgiY2hlY2tlZCIsImNoZWNrZWQiKSxhLmFwcGVuZENoaWxkKGkpLGw9Yy5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksbC5hcHBlbmRDaGlsZChhLmZpcnN0Q2hpbGQpLGsuY2hlY2tDbG9uZT1sLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCxhLmlubmVySFRNTD0iIixhLnN0eWxlLndpZHRoPWEuc3R5bGUucGFkZGluZ0xlZnQ9IjFweCIsbT1jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0sbz1jLmNyZWF0ZUVsZW1lbnQobT8iZGl2IjoiYm9keSIpLHA9e3Zpc2liaWxpdHk6ImhpZGRlbiIsd2lkdGg6MCxoZWlnaHQ6MCxib3JkZXI6MCxtYXJnaW46MH0sbSYmZi5leHRlbmQocCx7cG9zaXRpb246ImFic29sdXRlIixsZWZ0Oi0xZTMsdG9wOi0xZTN9KTtmb3IodCBpbiBwKW8uc3R5bGVbdF09cFt0XTtvLmFwcGVuZENoaWxkKGEpLG49bXx8YixuLmluc2VydEJlZm9yZShvLG4uZmlyc3RDaGlsZCksay5hcHBlbmRDaGVja2VkPWkuY2hlY2tlZCxrLmJveE1vZGVsPWEub2Zmc2V0V2lkdGg9PT0yLCJ6b29tImluIGEuc3R5bGUmJihhLnN0eWxlLmRpc3BsYXk9ImlubGluZSIsYS5zdHlsZS56b29tPTEsay5pbmxpbmVCbG9ja05lZWRzTGF5b3V0PWEub2Zmc2V0V2lkdGg9PT0yLGEuc3R5bGUuZGlzcGxheT0iIixhLmlubmVySFRNTD0iPGRpdiBzdHlsZT0nd2lkdGg6NHB4Oyc+PC9kaXY+IixrLnNocmlua1dyYXBCbG9ja3M9YS5vZmZzZXRXaWR0aCE9PTIpLGEuaW5uZXJIVE1MPSI8dGFibGU+PHRyPjx0ZCBzdHlsZT0ncGFkZGluZzowO2JvcmRlcjowO2Rpc3BsYXk6bm9uZSc+PC90ZD48dGQ+dDwvdGQ+PC90cj48L3RhYmxlPiIscT1hLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ZCIpLHU9cVswXS5vZmZzZXRIZWlnaHQ9PT0wLHFbMF0uc3R5bGUuZGlzcGxheT0iIixxWzFdLnN0eWxlLmRpc3BsYXk9Im5vbmUiLGsucmVsaWFibGVIaWRkZW5PZmZzZXRzPXUmJnFbMF0ub2Zmc2V0SGVpZ2h0PT09MCxhLmlubmVySFRNTD0iIixjLmRlZmF1bHRWaWV3JiZjLmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUmJihqPWMuY3JlYXRlRWxlbWVudCgiZGl2Iiksai5zdHlsZS53aWR0aD0iMCIsai5zdHlsZS5tYXJnaW5SaWdodD0iMCIsYS5hcHBlbmRDaGlsZChqKSxrLnJlbGlhYmxlTWFyZ2luUmlnaHQ9KHBhcnNlSW50KChjLmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoaixudWxsKXx8e21hcmdpblJpZ2h0OjB9KS5tYXJnaW5SaWdodCwxMCl8fDApPT09MCksby5pbm5lckhUTUw9IiIsbi5yZW1vdmVDaGlsZChvKTtpZihhLmF0dGFjaEV2ZW50KWZvcih0IGlue3N1Ym1pdDoxLGNoYW5nZToxLGZvY3VzaW46MX0pcz0ib24iK3QsdT1zIGluIGEsdXx8KGEuc2V0QXR0cmlidXRlKHMsInJldHVybjsiKSx1PXR5cGVvZiBhW3NdPT0iZnVuY3Rpb24iKSxrW3QrIkJ1YmJsZXMiXT11O289bD1nPWg9bT1qPWE9aT1udWxsO3JldHVybiBrfSgpLGYuYm94TW9kZWw9Zi5zdXBwb3J0LmJveE1vZGVsO3ZhciBpPS9eKD86XHsuKlx9fFxbLipcXSkkLyxqPS8oW2Etel0pKFtBLVpdKS9nO2YuZXh0ZW5kKHtjYWNoZTp7fSx1dWlkOjAsZXhwYW5kbzoialF1ZXJ5IisoZi5mbi5qcXVlcnkrTWF0aC5yYW5kb20oKSkucmVwbGFjZSgvXEQvZywiIiksbm9EYXRhOntlbWJlZDohMCxvYmplY3Q6ImNsc2lkOkQyN0NEQjZFLUFFNkQtMTFjZi05NkI4LTQ0NDU1MzU0MDAwMCIsYXBwbGV0OiEwfSxoYXNEYXRhOmZ1bmN0aW9uKGEpe2E9YS5ub2RlVHlwZT9mLmNhY2hlW2FbZi5leHBhbmRvXV06YVtmLmV4cGFuZG9dO3JldHVybiEhYSYmIWwoYSl9LGRhdGE6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoISFmLmFjY2VwdERhdGEoYSkpe3ZhciBnPWYuZXhwYW5kbyxoPXR5cGVvZiBjPT0ic3RyaW5nIixpLGo9YS5ub2RlVHlwZSxrPWo/Zi5jYWNoZTphLGw9aj9hW2YuZXhwYW5kb106YVtmLmV4cGFuZG9dJiZmLmV4cGFuZG87aWYoKCFsfHxlJiZsJiYha1tsXVtnXSkmJmgmJmQ9PT1iKXJldHVybjtsfHwoaj9hW2YuZXhwYW5kb109bD0rK2YudXVpZDpsPWYuZXhwYW5kbyksa1tsXXx8KGtbbF09e30sanx8KGtbbF0udG9KU09OPWYubm9vcCkpO2lmKHR5cGVvZiBjPT0ib2JqZWN0Inx8dHlwZW9mIGM9PSJmdW5jdGlvbiIpZT9rW2xdW2ddPWYuZXh0ZW5kKGtbbF1bZ10sYyk6a1tsXT1mLmV4dGVuZChrW2xdLGMpO2k9a1tsXSxlJiYoaVtnXXx8KGlbZ109e30pLGk9aVtnXSksZCE9PWImJihpW2YuY2FtZWxDYXNlKGMpXT1kKTtpZihjPT09ImV2ZW50cyImJiFpW2NdKXJldHVybiBpW2ddJiZpW2ddLmV2ZW50cztyZXR1cm4gaD9pW2YuY2FtZWxDYXNlKGMpXXx8aVtjXTppfX0scmVtb3ZlRGF0YTpmdW5jdGlvbihiLGMsZCl7aWYoISFmLmFjY2VwdERhdGEoYikpe3ZhciBlPWYuZXhwYW5kbyxnPWIubm9kZVR5cGUsaD1nP2YuY2FjaGU6YixpPWc/YltmLmV4cGFuZG9dOmYuZXhwYW5kbztpZighaFtpXSlyZXR1cm47aWYoYyl7dmFyIGo9ZD9oW2ldW2VdOmhbaV07aWYoail7ZGVsZXRlIGpbY107aWYoIWwoaikpcmV0dXJufX1pZihkKXtkZWxldGUgaFtpXVtlXTtpZighbChoW2ldKSlyZXR1cm59dmFyIGs9aFtpXVtlXTtmLnN1cHBvcnQuZGVsZXRlRXhwYW5kb3x8aCE9YT9kZWxldGUgaFtpXTpoW2ldPW51bGwsaz8oaFtpXT17fSxnfHwoaFtpXS50b0pTT049Zi5ub29wKSxoW2ldW2VdPWspOmcmJihmLnN1cHBvcnQuZGVsZXRlRXhwYW5kbz9kZWxldGUgYltmLmV4cGFuZG9dOmIucmVtb3ZlQXR0cmlidXRlP2IucmVtb3ZlQXR0cmlidXRlKGYuZXhwYW5kbyk6YltmLmV4cGFuZG9dPW51bGwpfX0sX2RhdGE6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmLmRhdGEoYSxiLGMsITApfSxhY2NlcHREYXRhOmZ1bmN0aW9uKGEpe2lmKGEubm9kZU5hbWUpe3ZhciBiPWYubm9EYXRhW2Eubm9kZU5hbWUudG9Mb3dlckNhc2UoKV07aWYoYilyZXR1cm4gYiE9PSEwJiZhLmdldEF0dHJpYnV0ZSgiY2xhc3NpZCIpPT09Yn1yZXR1cm4hMH19KSxmLmZuLmV4dGVuZCh7ZGF0YTpmdW5jdGlvbihhLGMpe3ZhciBkPW51bGw7aWYodHlwZW9mIGE9PSJ1bmRlZmluZWQiKXtpZih0aGlzLmxlbmd0aCl7ZD1mLmRhdGEodGhpc1swXSk7aWYodGhpc1swXS5ub2RlVHlwZT09PTEpe3ZhciBlPXRoaXNbMF0uYXR0cmlidXRlcyxnO2Zvcih2YXIgaD0wLGk9ZS5sZW5ndGg7aDxpO2grKylnPWVbaF0ubmFtZSxnLmluZGV4T2YoImRhdGEtIik9PT0wJiYoZz1mLmNhbWVsQ2FzZShnLnN1YnN0cmluZyg1KSksayh0aGlzWzBdLGcsZFtnXSkpfX1yZXR1cm4gZH1pZih0eXBlb2YgYT09Im9iamVjdCIpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YuZGF0YSh0aGlzLGEpfSk7dmFyIGo9YS5zcGxpdCgiLiIpO2pbMV09alsxXT8iLiIralsxXToiIjtpZihjPT09Yil7ZD10aGlzLnRyaWdnZXJIYW5kbGVyKCJnZXREYXRhIitqWzFdKyIhIixbalswXV0pLGQ9PT1iJiZ0aGlzLmxlbmd0aCYmKGQ9Zi5kYXRhKHRoaXNbMF0sYSksZD1rKHRoaXNbMF0sYSxkKSk7cmV0dXJuIGQ9PT1iJiZqWzFdP3RoaXMuZGF0YShqWzBdKTpkfXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1mKHRoaXMpLGQ9W2pbMF0sY107Yi50cmlnZ2VySGFuZGxlcigic2V0RGF0YSIralsxXSsiISIsZCksZi5kYXRhKHRoaXMsYSxjKSxiLnRyaWdnZXJIYW5kbGVyKCJjaGFuZ2VEYXRhIitqWzFdKyIhIixkKX0pfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLnJlbW92ZURhdGEodGhpcyxhKX0pfX0pLGYuZXh0ZW5kKHtfbWFyazpmdW5jdGlvbihhLGMpe2EmJihjPShjfHwiZngiKSsibWFyayIsZi5kYXRhKGEsYywoZi5kYXRhKGEsYyxiLCEwKXx8MCkrMSwhMCkpfSxfdW5tYXJrOmZ1bmN0aW9uKGEsYyxkKXthIT09ITAmJihkPWMsYz1hLGE9ITEpO2lmKGMpe2Q9ZHx8ImZ4Ijt2YXIgZT1kKyJtYXJrIixnPWE/MDooZi5kYXRhKGMsZSxiLCEwKXx8MSktMTtnP2YuZGF0YShjLGUsZywhMCk6KGYucmVtb3ZlRGF0YShjLGUsITApLG0oYyxkLCJtYXJrIikpfX0scXVldWU6ZnVuY3Rpb24oYSxjLGQpe2lmKGEpe2M9KGN8fCJmeCIpKyJxdWV1ZSI7dmFyIGU9Zi5kYXRhKGEsYyxiLCEwKTtkJiYoIWV8fGYuaXNBcnJheShkKT9lPWYuZGF0YShhLGMsZi5tYWtlQXJyYXkoZCksITApOmUucHVzaChkKSk7cmV0dXJuIGV8fFtdfX0sZGVxdWV1ZTpmdW5jdGlvbihhLGIpe2I9Ynx8ImZ4Ijt2YXIgYz1mLnF1ZXVlKGEsYiksZD1jLnNoaWZ0KCksZTtkPT09ImlucHJvZ3Jlc3MiJiYoZD1jLnNoaWZ0KCkpLGQmJihiPT09ImZ4IiYmYy51bnNoaWZ0KCJpbnByb2dyZXNzIiksZC5jYWxsKGEsZnVuY3Rpb24oKXtmLmRlcXVldWUoYSxiKX0pKSxjLmxlbmd0aHx8KGYucmVtb3ZlRGF0YShhLGIrInF1ZXVlIiwhMCksbShhLGIsInF1ZXVlIikpfX0pLGYuZm4uZXh0ZW5kKHtxdWV1ZTpmdW5jdGlvbihhLGMpe3R5cGVvZiBhIT0ic3RyaW5nIiYmKGM9YSxhPSJmeCIpO2lmKGM9PT1iKXJldHVybiBmLnF1ZXVlKHRoaXNbMF0sYSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWYucXVldWUodGhpcyxhLGMpO2E9PT0iZngiJiZiWzBdIT09ImlucHJvZ3Jlc3MiJiZmLmRlcXVldWUodGhpcyxhKX0pfSxkZXF1ZXVlOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLmRlcXVldWUodGhpcyxhKX0pfSxkZWxheTpmdW5jdGlvbihhLGIpe2E9Zi5meD9mLmZ4LnNwZWVkc1thXXx8YTphLGI9Ynx8ImZ4IjtyZXR1cm4gdGhpcy5xdWV1ZShiLGZ1bmN0aW9uKCl7dmFyIGM9dGhpcztzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Zi5kZXF1ZXVlKGMsYil9LGEpfSl9LGNsZWFyUXVldWU6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucXVldWUoYXx8ImZ4IixbXSl9LHByb21pc2U6ZnVuY3Rpb24oYSxjKXtmdW5jdGlvbiBtKCl7LS1ofHxkLnJlc29sdmVXaXRoKGUsW2VdKX10eXBlb2YgYSE9InN0cmluZyImJihjPWEsYT1iKSxhPWF8fCJmeCI7dmFyIGQ9Zi5EZWZlcnJlZCgpLGU9dGhpcyxnPWUubGVuZ3RoLGg9MSxpPWErImRlZmVyIixqPWErInF1ZXVlIixrPWErIm1hcmsiLGw7d2hpbGUoZy0tKWlmKGw9Zi5kYXRhKGVbZ10saSxiLCEwKXx8KGYuZGF0YShlW2ddLGosYiwhMCl8fGYuZGF0YShlW2ddLGssYiwhMCkpJiZmLmRhdGEoZVtnXSxpLGYuX0RlZmVycmVkKCksITApKWgrKyxsLmRvbmUobSk7bSgpO3JldHVybiBkLnByb21pc2UoKX19KTt2YXIgbj0vW1xuXHRccl0vZyxvPS9ccysvLHA9L1xyL2cscT0vXig/OmJ1dHRvbnxpbnB1dCkkL2kscj0vXig/OmJ1dHRvbnxpbnB1dHxvYmplY3R8c2VsZWN0fHRleHRhcmVhKSQvaSxzPS9eYSg/OnJlYSk/JC9pLHQ9L14oPzphdXRvZm9jdXN8YXV0b3BsYXl8YXN5bmN8Y2hlY2tlZHxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZHxzZWxlY3RlZCkkL2ksdT0vXDp8Xm9uLyx2LHc7Zi5mbi5leHRlbmQoe2F0dHI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZi5hY2Nlc3ModGhpcyxhLGIsITAsZi5hdHRyKX0scmVtb3ZlQXR0cjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zi5yZW1vdmVBdHRyKHRoaXMsYSl9KX0scHJvcDpmdW5jdGlvbihhLGIpe3JldHVybiBmLmFjY2Vzcyh0aGlzLGEsYiwhMCxmLnByb3ApfSxyZW1vdmVQcm9wOmZ1bmN0aW9uKGEpe2E9Zi5wcm9wRml4W2FdfHxhO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt0cnl7dGhpc1thXT1iLGRlbGV0ZSB0aGlzW2FdfWNhdGNoKGMpe319KX0sYWRkQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGUsZyxoLGk7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zih0aGlzKS5hZGRDbGFzcyhhLmNhbGwodGhpcyxiLHRoaXMuY2xhc3NOYW1lKSl9KTtpZihhJiZ0eXBlb2YgYT09InN0cmluZyIpe2I9YS5zcGxpdChvKTtmb3IoYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKyl7ZT10aGlzW2NdO2lmKGUubm9kZVR5cGU9PT0xKWlmKCFlLmNsYXNzTmFtZSYmYi5sZW5ndGg9PT0xKWUuY2xhc3NOYW1lPWE7ZWxzZXtnPSIgIitlLmNsYXNzTmFtZSsiICI7Zm9yKGg9MCxpPWIubGVuZ3RoO2g8aTtoKyspfmcuaW5kZXhPZigiICIrYltoXSsiICIpfHwoZys9YltoXSsiICIpO2UuY2xhc3NOYW1lPWYudHJpbShnKX19fXJldHVybiB0aGlzfSxyZW1vdmVDbGFzczpmdW5jdGlvbihhKXt2YXIgYyxkLGUsZyxoLGksajtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmKHRoaXMpLnJlbW92ZUNsYXNzKGEuY2FsbCh0aGlzLGIsdGhpcy5jbGFzc05hbWUpKX0pO2lmKGEmJnR5cGVvZiBhPT0ic3RyaW5nInx8YT09PWIpe2M9KGF8fCIiKS5zcGxpdChvKTtmb3IoZD0wLGU9dGhpcy5sZW5ndGg7ZDxlO2QrKyl7Zz10aGlzW2RdO2lmKGcubm9kZVR5cGU9PT0xJiZnLmNsYXNzTmFtZSlpZihhKXtoPSgiICIrZy5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKG4sIiAiKTtmb3IoaT0wLGo9Yy5sZW5ndGg7aTxqO2krKyloPWgucmVwbGFjZSgiICIrY1tpXSsiICIsIiAiKTtnLmNsYXNzTmFtZT1mLnRyaW0oaCl9ZWxzZSBnLmNsYXNzTmFtZT0iIn19cmV0dXJuIHRoaXN9LHRvZ2dsZUNsYXNzOmZ1bmN0aW9uKGEsYil7dmFyIGM9dHlwZW9mIGEsZD10eXBlb2YgYj09ImJvb2xlYW4iO2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGMpe2YodGhpcykudG9nZ2xlQ2xhc3MoYS5jYWxsKHRoaXMsYyx0aGlzLmNsYXNzTmFtZSxiKSxiKX0pO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZihjPT09InN0cmluZyIpe3ZhciBlLGc9MCxoPWYodGhpcyksaT1iLGo9YS5zcGxpdChvKTt3aGlsZShlPWpbZysrXSlpPWQ/aTohaC5oYXNDbGFzcyhlKSxoW2k/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXShlKX1lbHNlIGlmKGM9PT0idW5kZWZpbmVkInx8Yz09PSJib29sZWFuIil0aGlzLmNsYXNzTmFtZSYmZi5fZGF0YSh0aGlzLCJfX2NsYXNzTmFtZV9fIix0aGlzLmNsYXNzTmFtZSksdGhpcy5jbGFzc05hbWU9dGhpcy5jbGFzc05hbWV8fGE9PT0hMT8iIjpmLl9kYXRhKHRoaXMsIl9fY2xhc3NOYW1lX18iKXx8IiJ9KX0saGFzQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGI9IiAiK2ErIiAiO2Zvcih2YXIgYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKylpZigoIiAiK3RoaXNbY10uY2xhc3NOYW1lKyIgIikucmVwbGFjZShuLCIgIikuaW5kZXhPZihiKT4tMSlyZXR1cm4hMDtyZXR1cm4hMX0sdmFsOmZ1bmN0aW9uKGEpe3ZhciBjLGQsZT10aGlzWzBdO2lmKCFhcmd1bWVudHMubGVuZ3RoKXtpZihlKXtjPWYudmFsSG9va3NbZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXXx8Zi52YWxIb29rc1tlLnR5cGVdO2lmKGMmJiJnZXQiaW4gYyYmKGQ9Yy5nZXQoZSwidmFsdWUiKSkhPT1iKXJldHVybiBkO2Q9ZS52YWx1ZTtyZXR1cm4gdHlwZW9mIGQ9PSJzdHJpbmciP2QucmVwbGFjZShwLCIiKTpkPT1udWxsPyIiOmR9cmV0dXJuIGJ9dmFyIGc9Zi5pc0Z1bmN0aW9uKGEpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZCl7dmFyIGU9Zih0aGlzKSxoO2lmKHRoaXMubm9kZVR5cGU9PT0xKXtnP2g9YS5jYWxsKHRoaXMsZCxlLnZhbCgpKTpoPWEsaD09bnVsbD9oPSIiOnR5cGVvZiBoPT0ibnVtYmVyIj9oKz0iIjpmLmlzQXJyYXkoaCkmJihoPWYubWFwKGgsZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/IiI6YSsiIn0pKSxjPWYudmFsSG9va3NbdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXXx8Zi52YWxIb29rc1t0aGlzLnR5cGVdO2lmKCFjfHwhKCJzZXQiaW4gYyl8fGMuc2V0KHRoaXMsaCwidmFsdWUiKT09PWIpdGhpcy52YWx1ZT1ofX0pfX0pLGYuZXh0ZW5kKHt2YWxIb29rczp7b3B0aW9uOntnZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5hdHRyaWJ1dGVzLnZhbHVlO3JldHVybiFifHxiLnNwZWNpZmllZD9hLnZhbHVlOmEudGV4dH19LHNlbGVjdDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiLGM9YS5zZWxlY3RlZEluZGV4LGQ9W10sZT1hLm9wdGlvbnMsZz1hLnR5cGU9PT0ic2VsZWN0LW9uZSI7aWYoYzwwKXJldHVybiBudWxsO2Zvcih2YXIgaD1nP2M6MCxpPWc/YysxOmUubGVuZ3RoO2g8aTtoKyspe3ZhciBqPWVbaF07aWYoai5zZWxlY3RlZCYmKGYuc3VwcG9ydC5vcHREaXNhYmxlZD8hai5kaXNhYmxlZDpqLmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKT09PW51bGwpJiYoIWoucGFyZW50Tm9kZS5kaXNhYmxlZHx8IWYubm9kZU5hbWUoai5wYXJlbnROb2RlLCJvcHRncm91cCIpKSl7Yj1mKGopLnZhbCgpO2lmKGcpcmV0dXJuIGI7ZC5wdXNoKGIpfX1pZihnJiYhZC5sZW5ndGgmJmUubGVuZ3RoKXJldHVybiBmKGVbY10pLnZhbCgpO3JldHVybiBkfSxzZXQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz1mLm1ha2VBcnJheShiKTtmKGEpLmZpbmQoIm9wdGlvbiIpLmVhY2goZnVuY3Rpb24oKXt0aGlzLnNlbGVjdGVkPWYuaW5BcnJheShmKHRoaXMpLnZhbCgpLGMpPj0wfSksYy5sZW5ndGh8fChhLnNlbGVjdGVkSW5kZXg9LTEpO3JldHVybiBjfX19LGF0dHJGbjp7dmFsOiEwLGNzczohMCxodG1sOiEwLHRleHQ6ITAsZGF0YTohMCx3aWR0aDohMCxoZWlnaHQ6ITAsb2Zmc2V0OiEwfSxhdHRyRml4Ont0YWJpbmRleDoidGFiSW5kZXgifSxhdHRyOmZ1bmN0aW9uKGEsYyxkLGUpe3ZhciBnPWEubm9kZVR5cGU7aWYoIWF8fGc9PT0zfHxnPT09OHx8Zz09PTIpcmV0dXJuIGI7aWYoZSYmYyBpbiBmLmF0dHJGbilyZXR1cm4gZihhKVtjXShkKTtpZighKCJnZXRBdHRyaWJ1dGUiaW4gYSkpcmV0dXJuIGYucHJvcChhLGMsZCk7dmFyIGgsaSxqPWchPT0xfHwhZi5pc1hNTERvYyhhKTtqJiYoYz1mLmF0dHJGaXhbY118fGMsaT1mLmF0dHJIb29rc1tjXSxpfHwodC50ZXN0KGMpP2k9dzp2JiZjIT09ImNsYXNzTmFtZSImJihmLm5vZGVOYW1lKGEsImZvcm0iKXx8dS50ZXN0KGMpKSYmKGk9dikpKTtpZihkIT09Yil7aWYoZD09PW51bGwpe2YucmVtb3ZlQXR0cihhLGMpO3JldHVybiBifWlmKGkmJiJzZXQiaW4gaSYmaiYmKGg9aS5zZXQoYSxkLGMpKSE9PWIpcmV0dXJuIGg7YS5zZXRBdHRyaWJ1dGUoYywiIitkKTtyZXR1cm4gZH1pZihpJiYiZ2V0ImluIGkmJmomJihoPWkuZ2V0KGEsYykpIT09bnVsbClyZXR1cm4gaDtoPWEuZ2V0QXR0cmlidXRlKGMpO3JldHVybiBoPT09bnVsbD9iOmh9LHJlbW92ZUF0dHI6ZnVuY3Rpb24oYSxiKXt2YXIgYzthLm5vZGVUeXBlPT09MSYmKGI9Zi5hdHRyRml4W2JdfHxiLGYuc3VwcG9ydC5nZXRTZXRBdHRyaWJ1dGU/YS5yZW1vdmVBdHRyaWJ1dGUoYik6KGYuYXR0cihhLGIsIiIpLGEucmVtb3ZlQXR0cmlidXRlTm9kZShhLmdldEF0dHJpYnV0ZU5vZGUoYikpKSx0LnRlc3QoYikmJihjPWYucHJvcEZpeFtiXXx8YilpbiBhJiYoYVtjXT0hMSkpfSxhdHRySG9va3M6e3R5cGU6e3NldDpmdW5jdGlvbihhLGIpe2lmKHEudGVzdChhLm5vZGVOYW1lKSYmYS5wYXJlbnROb2RlKWYuZXJyb3IoInR5cGUgcHJvcGVydHkgY2FuJ3QgYmUgY2hhbmdlZCIpO2Vsc2UgaWYoIWYuc3VwcG9ydC5yYWRpb1ZhbHVlJiZiPT09InJhZGlvIiYmZi5ub2RlTmFtZShhLCJpbnB1dCIpKXt2YXIgYz1hLnZhbHVlO2Euc2V0QXR0cmlidXRlKCJ0eXBlIixiKSxjJiYoYS52YWx1ZT1jKTtyZXR1cm4gYn19fSx0YWJJbmRleDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBjPWEuZ2V0QXR0cmlidXRlTm9kZSgidGFiSW5kZXgiKTtyZXR1cm4gYyYmYy5zcGVjaWZpZWQ/cGFyc2VJbnQoYy52YWx1ZSwxMCk6ci50ZXN0KGEubm9kZU5hbWUpfHxzLnRlc3QoYS5ub2RlTmFtZSkmJmEuaHJlZj8wOmJ9fSx2YWx1ZTp7Z2V0OmZ1bmN0aW9uKGEsYil7aWYodiYmZi5ub2RlTmFtZShhLCJidXR0b24iKSlyZXR1cm4gdi5nZXQoYSxiKTtyZXR1cm4gYiBpbiBhP2EudmFsdWU6bnVsbH0sc2V0OmZ1bmN0aW9uKGEsYixjKXtpZih2JiZmLm5vZGVOYW1lKGEsImJ1dHRvbiIpKXJldHVybiB2LnNldChhLGIsYyk7YS52YWx1ZT1ifX19LHByb3BGaXg6e3RhYmluZGV4OiJ0YWJJbmRleCIscmVhZG9ubHk6InJlYWRPbmx5IiwiZm9yIjoiaHRtbEZvciIsImNsYXNzIjoiY2xhc3NOYW1lIixtYXhsZW5ndGg6Im1heExlbmd0aCIsY2VsbHNwYWNpbmc6ImNlbGxTcGFjaW5nIixjZWxscGFkZGluZzoiY2VsbFBhZGRpbmciLHJvd3NwYW46InJvd1NwYW4iLGNvbHNwYW46ImNvbFNwYW4iLHVzZW1hcDoidXNlTWFwIixmcmFtZWJvcmRlcjoiZnJhbWVCb3JkZXIiLGNvbnRlbnRlZGl0YWJsZToiY29udGVudEVkaXRhYmxlIn0scHJvcDpmdW5jdGlvbihhLGMsZCl7dmFyIGU9YS5ub2RlVHlwZTtpZighYXx8ZT09PTN8fGU9PT04fHxlPT09MilyZXR1cm4gYjt2YXIgZyxoLGk9ZSE9PTF8fCFmLmlzWE1MRG9jKGEpO2kmJihjPWYucHJvcEZpeFtjXXx8YyxoPWYucHJvcEhvb2tzW2NdKTtyZXR1cm4gZCE9PWI/aCYmInNldCJpbiBoJiYoZz1oLnNldChhLGQsYykpIT09Yj9nOmFbY109ZDpoJiYiZ2V0ImluIGgmJihnPWguZ2V0KGEsYykpIT09Yj9nOmFbY119LHByb3BIb29rczp7fX0pLHc9e2dldDpmdW5jdGlvbihhLGMpe3JldHVybiBmLnByb3AoYSxjKT9jLnRvTG93ZXJDYXNlKCk6Yn0sc2V0OmZ1bmN0aW9uKGEsYixjKXt2YXIgZDtiPT09ITE/Zi5yZW1vdmVBdHRyKGEsYyk6KGQ9Zi5wcm9wRml4W2NdfHxjLGQgaW4gYSYmKGFbZF09ITApLGEuc2V0QXR0cmlidXRlKGMsYy50b0xvd2VyQ2FzZSgpKSk7cmV0dXJuIGN9fSxmLnN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlfHwoZi5hdHRyRml4PWYucHJvcEZpeCx2PWYuYXR0ckhvb2tzLm5hbWU9Zi5hdHRySG9va3MudGl0bGU9Zi52YWxIb29rcy5idXR0b249e2dldDpmdW5jdGlvbihhLGMpe3ZhciBkO2Q9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpO3JldHVybiBkJiZkLm5vZGVWYWx1ZSE9PSIiP2Qubm9kZVZhbHVlOmJ9LHNldDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpO2lmKGQpe2Qubm9kZVZhbHVlPWI7cmV0dXJuIGJ9fX0sZi5lYWNoKFsid2lkdGgiLCJoZWlnaHQiXSxmdW5jdGlvbihhLGIpe2YuYXR0ckhvb2tzW2JdPWYuZXh0ZW5kKGYuYXR0ckhvb2tzW2JdLHtzZXQ6ZnVuY3Rpb24oYSxjKXtpZihjPT09IiIpe2Euc2V0QXR0cmlidXRlKGIsImF1dG8iKTtyZXR1cm4gY319fSl9KSksZi5zdXBwb3J0LmhyZWZOb3JtYWxpemVkfHxmLmVhY2goWyJocmVmIiwic3JjIiwid2lkdGgiLCJoZWlnaHQiXSxmdW5jdGlvbihhLGMpe2YuYXR0ckhvb2tzW2NdPWYuZXh0ZW5kKGYuYXR0ckhvb2tzW2NdLHtnZXQ6ZnVuY3Rpb24oYSl7dmFyIGQ9YS5nZXRBdHRyaWJ1dGUoYywyKTtyZXR1cm4gZD09PW51bGw/YjpkfX0pfSksZi5zdXBwb3J0LnN0eWxlfHwoZi5hdHRySG9va3Muc3R5bGU9e2dldDpmdW5jdGlvbihhKXtyZXR1cm4gYS5zdHlsZS5jc3NUZXh0LnRvTG93ZXJDYXNlKCl8fGJ9LHNldDpmdW5jdGlvbihhLGIpe3JldHVybiBhLnN0eWxlLmNzc1RleHQ9IiIrYn19KSxmLnN1cHBvcnQub3B0U2VsZWN0ZWR8fChmLnByb3BIb29rcy5zZWxlY3RlZD1mLmV4dGVuZChmLnByb3BIb29rcy5zZWxlY3RlZCx7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiPWEucGFyZW50Tm9kZTtiJiYoYi5zZWxlY3RlZEluZGV4LGIucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgpfX0pKSxmLnN1cHBvcnQuY2hlY2tPbnx8Zi5lYWNoKFsicmFkaW8iLCJjaGVja2JveCJdLGZ1bmN0aW9uKCl7Zi52YWxIb29rc1t0aGlzXT17Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgidmFsdWUiKT09PW51bGw/Im9uIjphLnZhbHVlfX19KSxmLmVhY2goWyJyYWRpbyIsImNoZWNrYm94Il0sZnVuY3Rpb24oKXtmLnZhbEhvb2tzW3RoaXNdPWYuZXh0ZW5kKGYudmFsSG9va3NbdGhpc10se3NldDpmdW5jdGlvbihhLGIpe2lmKGYuaXNBcnJheShiKSlyZXR1cm4gYS5jaGVja2VkPWYuaW5BcnJheShmKGEpLnZhbCgpLGIpPj0wfX0pfSk7dmFyIHg9L1wuKC4qKSQvLHk9L14oPzp0ZXh0YXJlYXxpbnB1dHxzZWxlY3QpJC9pLHo9L1wuL2csQT0vIC9nLEI9L1teXHdccy58YF0vZyxDPWZ1bmN0aW9uKGEpe3JldHVybiBhLnJlcGxhY2UoQiwiXFwkJiIpfTtmLmV2ZW50PXthZGQ6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoYS5ub2RlVHlwZSE9PTMmJmEubm9kZVR5cGUhPT04KXtpZihkPT09ITEpZD1EO2Vsc2UgaWYoIWQpcmV0dXJuO3ZhciBnLGg7ZC5oYW5kbGVyJiYoZz1kLGQ9Zy5oYW5kbGVyKSxkLmd1aWR8fChkLmd1aWQ9Zi5ndWlkKyspO3ZhciBpPWYuX2RhdGEoYSk7aWYoIWkpcmV0dXJuO3ZhciBqPWkuZXZlbnRzLGs9aS5oYW5kbGU7anx8KGkuZXZlbnRzPWo9e30pLGt8fChpLmhhbmRsZT1rPWZ1bmN0aW9uKGEpe3JldHVybiB0eXBlb2YgZiE9InVuZGVmaW5lZCImJighYXx8Zi5ldmVudC50cmlnZ2VyZWQhPT1hLnR5cGUpP2YuZXZlbnQuaGFuZGxlLmFwcGx5KGsuZWxlbSxhcmd1bWVudHMpOmJ9KSxrLmVsZW09YSxjPWMuc3BsaXQoIiAiKTt2YXIgbCxtPTAsbjt3aGlsZShsPWNbbSsrXSl7aD1nP2YuZXh0ZW5kKHt9LGcpOntoYW5kbGVyOmQsZGF0YTplfSxsLmluZGV4T2YoIi4iKT4tMT8obj1sLnNwbGl0KCIuIiksbD1uLnNoaWZ0KCksaC5uYW1lc3BhY2U9bi5zbGljZSgwKS5zb3J0KCkuam9pbigiLiIpKToobj1bXSxoLm5hbWVzcGFjZT0iIiksaC50eXBlPWwsaC5ndWlkfHwoaC5ndWlkPWQuZ3VpZCk7dmFyIG89altsXSxwPWYuZXZlbnQuc3BlY2lhbFtsXXx8e307aWYoIW8pe289altsXT1bXTtpZighcC5zZXR1cHx8cC5zZXR1cC5jYWxsKGEsZSxuLGspPT09ITEpYS5hZGRFdmVudExpc3RlbmVyP2EuYWRkRXZlbnRMaXN0ZW5lcihsLGssITEpOmEuYXR0YWNoRXZlbnQmJmEuYXR0YWNoRXZlbnQoIm9uIitsLGspfXAuYWRkJiYocC5hZGQuY2FsbChhLGgpLGguaGFuZGxlci5ndWlkfHwoaC5oYW5kbGVyLmd1aWQ9ZC5ndWlkKSksby5wdXNoKGgpLGYuZXZlbnQuZ2xvYmFsW2xdPSEwfWE9bnVsbH19LGdsb2JhbDp7fSxyZW1vdmU6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoYS5ub2RlVHlwZSE9PTMmJmEubm9kZVR5cGUhPT04KXtkPT09ITEmJihkPUQpO3ZhciBnLGgsaSxqLGs9MCxsLG0sbixvLHAscSxyLHM9Zi5oYXNEYXRhKGEpJiZmLl9kYXRhKGEpLHQ9cyYmcy5ldmVudHM7aWYoIXN8fCF0KXJldHVybjtjJiZjLnR5cGUmJihkPWMuaGFuZGxlcixjPWMudHlwZSk7aWYoIWN8fHR5cGVvZiBjPT0ic3RyaW5nIiYmYy5jaGFyQXQoMCk9PT0iLiIpe2M9Y3x8IiI7Zm9yKGggaW4gdClmLmV2ZW50LnJlbW92ZShhLGgrYyk7cmV0dXJufWM9Yy5zcGxpdCgiICIpO3doaWxlKGg9Y1trKytdKXtyPWgscT1udWxsLGw9aC5pbmRleE9mKCIuIik8MCxtPVtdLGx8fChtPWguc3BsaXQoIi4iKSxoPW0uc2hpZnQoKSxuPW5ldyBSZWdFeHAoIihefFxcLikiK2YubWFwKG0uc2xpY2UoMCkuc29ydCgpLEMpLmpvaW4oIlxcLig/Oi4qXFwuKT8iKSsiKFxcLnwkKSIpKSxwPXRbaF07aWYoIXApY29udGludWU7aWYoIWQpe2ZvcihqPTA7ajxwLmxlbmd0aDtqKyspe3E9cFtqXTtpZihsfHxuLnRlc3QocS5uYW1lc3BhY2UpKWYuZXZlbnQucmVtb3ZlKGEscixxLmhhbmRsZXIsaikscC5zcGxpY2Uoai0tLDEpfWNvbnRpbnVlfW89Zi5ldmVudC5zcGVjaWFsW2hdfHx7fTtmb3Ioaj1lfHwwO2o8cC5sZW5ndGg7aisrKXtxPXBbal07aWYoZC5ndWlkPT09cS5ndWlkKXtpZihsfHxuLnRlc3QocS5uYW1lc3BhY2UpKWU9PW51bGwmJnAuc3BsaWNlKGotLSwxKSxvLnJlbW92ZSYmby5yZW1vdmUuY2FsbChhLHEpO2lmKGUhPW51bGwpYnJlYWt9fWlmKHAubGVuZ3RoPT09MHx8ZSE9bnVsbCYmcC5sZW5ndGg9PT0xKSghby50ZWFyZG93bnx8by50ZWFyZG93bi5jYWxsKGEsbSk9PT0hMSkmJmYucmVtb3ZlRXZlbnQoYSxoLHMuaGFuZGxlKSxnPW51bGwsZGVsZXRlIHRbaF19aWYoZi5pc0VtcHR5T2JqZWN0KHQpKXt2YXIgdT1zLmhhbmRsZTt1JiYodS5lbGVtPW51bGwpLGRlbGV0ZSBzLmV2ZW50cyxkZWxldGUgcy5oYW5kbGUsZi5pc0VtcHR5T2JqZWN0KHMpJiZmLnJlbW92ZURhdGEoYSxiLCEwKX19fSxjdXN0b21FdmVudDp7Z2V0RGF0YTohMCxzZXREYXRhOiEwLGNoYW5nZURhdGE6ITB9LHRyaWdnZXI6ZnVuY3Rpb24oYyxkLGUsZyl7dmFyIGg9Yy50eXBlfHxjLGk9W10sajtoLmluZGV4T2YoIiEiKT49MCYmKGg9aC5zbGljZSgwLC0xKSxqPSEwKSxoLmluZGV4T2YoIi4iKT49MCYmKGk9aC5zcGxpdCgiLiIpLGg9aS4Kc2hpZnQoKSxpLnNvcnQoKSk7aWYoISFlJiYhZi5ldmVudC5jdXN0b21FdmVudFtoXXx8ISFmLmV2ZW50Lmdsb2JhbFtoXSl7Yz10eXBlb2YgYz09Im9iamVjdCI/Y1tmLmV4cGFuZG9dP2M6bmV3IGYuRXZlbnQoaCxjKTpuZXcgZi5FdmVudChoKSxjLnR5cGU9aCxjLmV4Y2x1c2l2ZT1qLGMubmFtZXNwYWNlPWkuam9pbigiLiIpLGMubmFtZXNwYWNlX3JlPW5ldyBSZWdFeHAoIihefFxcLikiK2kuam9pbigiXFwuKD86LipcXC4pPyIpKyIoXFwufCQpIik7aWYoZ3x8IWUpYy5wcmV2ZW50RGVmYXVsdCgpLGMuc3RvcFByb3BhZ2F0aW9uKCk7aWYoIWUpe2YuZWFjaChmLmNhY2hlLGZ1bmN0aW9uKCl7dmFyIGE9Zi5leHBhbmRvLGI9dGhpc1thXTtiJiZiLmV2ZW50cyYmYi5ldmVudHNbaF0mJmYuZXZlbnQudHJpZ2dlcihjLGQsYi5oYW5kbGUuZWxlbSl9KTtyZXR1cm59aWYoZS5ub2RlVHlwZT09PTN8fGUubm9kZVR5cGU9PT04KXJldHVybjtjLnJlc3VsdD1iLGMudGFyZ2V0PWUsZD1kIT1udWxsP2YubWFrZUFycmF5KGQpOltdLGQudW5zaGlmdChjKTt2YXIgaz1lLGw9aC5pbmRleE9mKCI6Iik8MD8ib24iK2g6IiI7ZG97dmFyIG09Zi5fZGF0YShrLCJoYW5kbGUiKTtjLmN1cnJlbnRUYXJnZXQ9ayxtJiZtLmFwcGx5KGssZCksbCYmZi5hY2NlcHREYXRhKGspJiZrW2xdJiZrW2xdLmFwcGx5KGssZCk9PT0hMSYmKGMucmVzdWx0PSExLGMucHJldmVudERlZmF1bHQoKSksaz1rLnBhcmVudE5vZGV8fGsub3duZXJEb2N1bWVudHx8az09PWMudGFyZ2V0Lm93bmVyRG9jdW1lbnQmJmF9d2hpbGUoayYmIWMuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSk7aWYoIWMuaXNEZWZhdWx0UHJldmVudGVkKCkpe3ZhciBuLG89Zi5ldmVudC5zcGVjaWFsW2hdfHx7fTtpZigoIW8uX2RlZmF1bHR8fG8uX2RlZmF1bHQuY2FsbChlLm93bmVyRG9jdW1lbnQsYyk9PT0hMSkmJihoIT09ImNsaWNrInx8IWYubm9kZU5hbWUoZSwiYSIpKSYmZi5hY2NlcHREYXRhKGUpKXt0cnl7bCYmZVtoXSYmKG49ZVtsXSxuJiYoZVtsXT1udWxsKSxmLmV2ZW50LnRyaWdnZXJlZD1oLGVbaF0oKSl9Y2F0Y2gocCl7fW4mJihlW2xdPW4pLGYuZXZlbnQudHJpZ2dlcmVkPWJ9fXJldHVybiBjLnJlc3VsdH19LGhhbmRsZTpmdW5jdGlvbihjKXtjPWYuZXZlbnQuZml4KGN8fGEuZXZlbnQpO3ZhciBkPSgoZi5fZGF0YSh0aGlzLCJldmVudHMiKXx8e30pW2MudHlwZV18fFtdKS5zbGljZSgwKSxlPSFjLmV4Y2x1c2l2ZSYmIWMubmFtZXNwYWNlLGc9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApO2dbMF09YyxjLmN1cnJlbnRUYXJnZXQ9dGhpcztmb3IodmFyIGg9MCxpPWQubGVuZ3RoO2g8aTtoKyspe3ZhciBqPWRbaF07aWYoZXx8Yy5uYW1lc3BhY2VfcmUudGVzdChqLm5hbWVzcGFjZSkpe2MuaGFuZGxlcj1qLmhhbmRsZXIsYy5kYXRhPWouZGF0YSxjLmhhbmRsZU9iaj1qO3ZhciBrPWouaGFuZGxlci5hcHBseSh0aGlzLGcpO2shPT1iJiYoYy5yZXN1bHQ9ayxrPT09ITEmJihjLnByZXZlbnREZWZhdWx0KCksYy5zdG9wUHJvcGFnYXRpb24oKSkpO2lmKGMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSlicmVha319cmV0dXJuIGMucmVzdWx0fSxwcm9wczoiYWx0S2V5IGF0dHJDaGFuZ2UgYXR0ck5hbWUgYnViYmxlcyBidXR0b24gY2FuY2VsYWJsZSBjaGFyQ29kZSBjbGllbnRYIGNsaWVudFkgY3RybEtleSBjdXJyZW50VGFyZ2V0IGRhdGEgZGV0YWlsIGV2ZW50UGhhc2UgZnJvbUVsZW1lbnQgaGFuZGxlciBrZXlDb2RlIGxheWVyWCBsYXllclkgbWV0YUtleSBuZXdWYWx1ZSBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgcHJldlZhbHVlIHJlbGF0ZWROb2RlIHJlbGF0ZWRUYXJnZXQgc2NyZWVuWCBzY3JlZW5ZIHNoaWZ0S2V5IHNyY0VsZW1lbnQgdGFyZ2V0IHRvRWxlbWVudCB2aWV3IHdoZWVsRGVsdGEgd2hpY2giLnNwbGl0KCIgIiksZml4OmZ1bmN0aW9uKGEpe2lmKGFbZi5leHBhbmRvXSlyZXR1cm4gYTt2YXIgZD1hO2E9Zi5FdmVudChkKTtmb3IodmFyIGU9dGhpcy5wcm9wcy5sZW5ndGgsZztlOylnPXRoaXMucHJvcHNbLS1lXSxhW2ddPWRbZ107YS50YXJnZXR8fChhLnRhcmdldD1hLnNyY0VsZW1lbnR8fGMpLGEudGFyZ2V0Lm5vZGVUeXBlPT09MyYmKGEudGFyZ2V0PWEudGFyZ2V0LnBhcmVudE5vZGUpLCFhLnJlbGF0ZWRUYXJnZXQmJmEuZnJvbUVsZW1lbnQmJihhLnJlbGF0ZWRUYXJnZXQ9YS5mcm9tRWxlbWVudD09PWEudGFyZ2V0P2EudG9FbGVtZW50OmEuZnJvbUVsZW1lbnQpO2lmKGEucGFnZVg9PW51bGwmJmEuY2xpZW50WCE9bnVsbCl7dmFyIGg9YS50YXJnZXQub3duZXJEb2N1bWVudHx8YyxpPWguZG9jdW1lbnRFbGVtZW50LGo9aC5ib2R5O2EucGFnZVg9YS5jbGllbnRYKyhpJiZpLnNjcm9sbExlZnR8fGomJmouc2Nyb2xsTGVmdHx8MCktKGkmJmkuY2xpZW50TGVmdHx8aiYmai5jbGllbnRMZWZ0fHwwKSxhLnBhZ2VZPWEuY2xpZW50WSsoaSYmaS5zY3JvbGxUb3B8fGomJmouc2Nyb2xsVG9wfHwwKS0oaSYmaS5jbGllbnRUb3B8fGomJmouY2xpZW50VG9wfHwwKX1hLndoaWNoPT1udWxsJiYoYS5jaGFyQ29kZSE9bnVsbHx8YS5rZXlDb2RlIT1udWxsKSYmKGEud2hpY2g9YS5jaGFyQ29kZSE9bnVsbD9hLmNoYXJDb2RlOmEua2V5Q29kZSksIWEubWV0YUtleSYmYS5jdHJsS2V5JiYoYS5tZXRhS2V5PWEuY3RybEtleSksIWEud2hpY2gmJmEuYnV0dG9uIT09YiYmKGEud2hpY2g9YS5idXR0b24mMT8xOmEuYnV0dG9uJjI/MzphLmJ1dHRvbiY0PzI6MCk7cmV0dXJuIGF9LGd1aWQ6MWU4LHByb3h5OmYucHJveHksc3BlY2lhbDp7cmVhZHk6e3NldHVwOmYuYmluZFJlYWR5LHRlYXJkb3duOmYubm9vcH0sbGl2ZTp7YWRkOmZ1bmN0aW9uKGEpe2YuZXZlbnQuYWRkKHRoaXMsTihhLm9yaWdUeXBlLGEuc2VsZWN0b3IpLGYuZXh0ZW5kKHt9LGEse2hhbmRsZXI6TSxndWlkOmEuaGFuZGxlci5ndWlkfSkpfSxyZW1vdmU6ZnVuY3Rpb24oYSl7Zi5ldmVudC5yZW1vdmUodGhpcyxOKGEub3JpZ1R5cGUsYS5zZWxlY3RvciksYSl9fSxiZWZvcmV1bmxvYWQ6e3NldHVwOmZ1bmN0aW9uKGEsYixjKXtmLmlzV2luZG93KHRoaXMpJiYodGhpcy5vbmJlZm9yZXVubG9hZD1jKX0sdGVhcmRvd246ZnVuY3Rpb24oYSxiKXt0aGlzLm9uYmVmb3JldW5sb2FkPT09YiYmKHRoaXMub25iZWZvcmV1bmxvYWQ9bnVsbCl9fX19LGYucmVtb3ZlRXZlbnQ9Yy5yZW1vdmVFdmVudExpc3RlbmVyP2Z1bmN0aW9uKGEsYixjKXthLnJlbW92ZUV2ZW50TGlzdGVuZXImJmEucmVtb3ZlRXZlbnRMaXN0ZW5lcihiLGMsITEpfTpmdW5jdGlvbihhLGIsYyl7YS5kZXRhY2hFdmVudCYmYS5kZXRhY2hFdmVudCgib24iK2IsYyl9LGYuRXZlbnQ9ZnVuY3Rpb24oYSxiKXtpZighdGhpcy5wcmV2ZW50RGVmYXVsdClyZXR1cm4gbmV3IGYuRXZlbnQoYSxiKTthJiZhLnR5cGU/KHRoaXMub3JpZ2luYWxFdmVudD1hLHRoaXMudHlwZT1hLnR5cGUsdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9YS5kZWZhdWx0UHJldmVudGVkfHxhLnJldHVyblZhbHVlPT09ITF8fGEuZ2V0UHJldmVudERlZmF1bHQmJmEuZ2V0UHJldmVudERlZmF1bHQoKT9FOkQpOnRoaXMudHlwZT1hLGImJmYuZXh0ZW5kKHRoaXMsYiksdGhpcy50aW1lU3RhbXA9Zi5ub3coKSx0aGlzW2YuZXhwYW5kb109ITB9LGYuRXZlbnQucHJvdG90eXBlPXtwcmV2ZW50RGVmYXVsdDpmdW5jdGlvbigpe3RoaXMuaXNEZWZhdWx0UHJldmVudGVkPUU7dmFyIGE9dGhpcy5vcmlnaW5hbEV2ZW50OyFhfHwoYS5wcmV2ZW50RGVmYXVsdD9hLnByZXZlbnREZWZhdWx0KCk6YS5yZXR1cm5WYWx1ZT0hMSl9LHN0b3BQcm9wYWdhdGlvbjpmdW5jdGlvbigpe3RoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQ9RTt2YXIgYT10aGlzLm9yaWdpbmFsRXZlbnQ7IWF8fChhLnN0b3BQcm9wYWdhdGlvbiYmYS5zdG9wUHJvcGFnYXRpb24oKSxhLmNhbmNlbEJ1YmJsZT0hMCl9LHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjpmdW5jdGlvbigpe3RoaXMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ9RSx0aGlzLnN0b3BQcm9wYWdhdGlvbigpfSxpc0RlZmF1bHRQcmV2ZW50ZWQ6RCxpc1Byb3BhZ2F0aW9uU3RvcHBlZDpELGlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOkR9O3ZhciBGPWZ1bmN0aW9uKGEpe3ZhciBiPWEucmVsYXRlZFRhcmdldCxjPSExLGQ9YS50eXBlO2EudHlwZT1hLmRhdGEsYiE9PXRoaXMmJihiJiYoYz1mLmNvbnRhaW5zKHRoaXMsYikpLGN8fChmLmV2ZW50LmhhbmRsZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksYS50eXBlPWQpKX0sRz1mdW5jdGlvbihhKXthLnR5cGU9YS5kYXRhLGYuZXZlbnQuaGFuZGxlLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07Zi5lYWNoKHttb3VzZWVudGVyOiJtb3VzZW92ZXIiLG1vdXNlbGVhdmU6Im1vdXNlb3V0In0sZnVuY3Rpb24oYSxiKXtmLmV2ZW50LnNwZWNpYWxbYV09e3NldHVwOmZ1bmN0aW9uKGMpe2YuZXZlbnQuYWRkKHRoaXMsYixjJiZjLnNlbGVjdG9yP0c6RixhKX0sdGVhcmRvd246ZnVuY3Rpb24oYSl7Zi5ldmVudC5yZW1vdmUodGhpcyxiLGEmJmEuc2VsZWN0b3I/RzpGKX19fSksZi5zdXBwb3J0LnN1Ym1pdEJ1YmJsZXN8fChmLmV2ZW50LnNwZWNpYWwuc3VibWl0PXtzZXR1cDpmdW5jdGlvbihhLGIpe2lmKCFmLm5vZGVOYW1lKHRoaXMsImZvcm0iKSlmLmV2ZW50LmFkZCh0aGlzLCJjbGljay5zcGVjaWFsU3VibWl0IixmdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldCxjPWIudHlwZTsoYz09PSJzdWJtaXQifHxjPT09ImltYWdlIikmJmYoYikuY2xvc2VzdCgiZm9ybSIpLmxlbmd0aCYmSygic3VibWl0Iix0aGlzLGFyZ3VtZW50cyl9KSxmLmV2ZW50LmFkZCh0aGlzLCJrZXlwcmVzcy5zcGVjaWFsU3VibWl0IixmdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldCxjPWIudHlwZTsoYz09PSJ0ZXh0Inx8Yz09PSJwYXNzd29yZCIpJiZmKGIpLmNsb3Nlc3QoImZvcm0iKS5sZW5ndGgmJmEua2V5Q29kZT09PTEzJiZLKCJzdWJtaXQiLHRoaXMsYXJndW1lbnRzKX0pO2Vsc2UgcmV0dXJuITF9LHRlYXJkb3duOmZ1bmN0aW9uKGEpe2YuZXZlbnQucmVtb3ZlKHRoaXMsIi5zcGVjaWFsU3VibWl0Iil9fSk7aWYoIWYuc3VwcG9ydC5jaGFuZ2VCdWJibGVzKXt2YXIgSCxJPWZ1bmN0aW9uKGEpe3ZhciBiPWEudHlwZSxjPWEudmFsdWU7Yj09PSJyYWRpbyJ8fGI9PT0iY2hlY2tib3giP2M9YS5jaGVja2VkOmI9PT0ic2VsZWN0LW11bHRpcGxlIj9jPWEuc2VsZWN0ZWRJbmRleD4tMT9mLm1hcChhLm9wdGlvbnMsZnVuY3Rpb24oYSl7cmV0dXJuIGEuc2VsZWN0ZWR9KS5qb2luKCItIik6IiI6Zi5ub2RlTmFtZShhLCJzZWxlY3QiKSYmKGM9YS5zZWxlY3RlZEluZGV4KTtyZXR1cm4gY30sSj1mdW5jdGlvbihjKXt2YXIgZD1jLnRhcmdldCxlLGc7aWYoISF5LnRlc3QoZC5ub2RlTmFtZSkmJiFkLnJlYWRPbmx5KXtlPWYuX2RhdGEoZCwiX2NoYW5nZV9kYXRhIiksZz1JKGQpLChjLnR5cGUhPT0iZm9jdXNvdXQifHxkLnR5cGUhPT0icmFkaW8iKSYmZi5fZGF0YShkLCJfY2hhbmdlX2RhdGEiLGcpO2lmKGU9PT1ifHxnPT09ZSlyZXR1cm47aWYoZSE9bnVsbHx8ZyljLnR5cGU9ImNoYW5nZSIsYy5saXZlRmlyZWQ9YixmLmV2ZW50LnRyaWdnZXIoYyxhcmd1bWVudHNbMV0sZCl9fTtmLmV2ZW50LnNwZWNpYWwuY2hhbmdlPXtmaWx0ZXJzOntmb2N1c291dDpKLGJlZm9yZWRlYWN0aXZhdGU6SixjbGljazpmdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldCxjPWYubm9kZU5hbWUoYiwiaW5wdXQiKT9iLnR5cGU6IiI7KGM9PT0icmFkaW8ifHxjPT09ImNoZWNrYm94Inx8Zi5ub2RlTmFtZShiLCJzZWxlY3QiKSkmJkouY2FsbCh0aGlzLGEpfSxrZXlkb3duOmZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0LGM9Zi5ub2RlTmFtZShiLCJpbnB1dCIpP2IudHlwZToiIjsoYS5rZXlDb2RlPT09MTMmJiFmLm5vZGVOYW1lKGIsInRleHRhcmVhIil8fGEua2V5Q29kZT09PTMyJiYoYz09PSJjaGVja2JveCJ8fGM9PT0icmFkaW8iKXx8Yz09PSJzZWxlY3QtbXVsdGlwbGUiKSYmSi5jYWxsKHRoaXMsYSl9LGJlZm9yZWFjdGl2YXRlOmZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0O2YuX2RhdGEoYiwiX2NoYW5nZV9kYXRhIixJKGIpKX19LHNldHVwOmZ1bmN0aW9uKGEsYil7aWYodGhpcy50eXBlPT09ImZpbGUiKXJldHVybiExO2Zvcih2YXIgYyBpbiBIKWYuZXZlbnQuYWRkKHRoaXMsYysiLnNwZWNpYWxDaGFuZ2UiLEhbY10pO3JldHVybiB5LnRlc3QodGhpcy5ub2RlTmFtZSl9LHRlYXJkb3duOmZ1bmN0aW9uKGEpe2YuZXZlbnQucmVtb3ZlKHRoaXMsIi5zcGVjaWFsQ2hhbmdlIik7cmV0dXJuIHkudGVzdCh0aGlzLm5vZGVOYW1lKX19LEg9Zi5ldmVudC5zcGVjaWFsLmNoYW5nZS5maWx0ZXJzLEguZm9jdXM9SC5iZWZvcmVhY3RpdmF0ZX1mLnN1cHBvcnQuZm9jdXNpbkJ1YmJsZXN8fGYuZWFjaCh7Zm9jdXM6ImZvY3VzaW4iLGJsdXI6ImZvY3Vzb3V0In0sZnVuY3Rpb24oYSxiKXtmdW5jdGlvbiBlKGEpe3ZhciBjPWYuZXZlbnQuZml4KGEpO2MudHlwZT1iLGMub3JpZ2luYWxFdmVudD17fSxmLmV2ZW50LnRyaWdnZXIoYyxudWxsLGMudGFyZ2V0KSxjLmlzRGVmYXVsdFByZXZlbnRlZCgpJiZhLnByZXZlbnREZWZhdWx0KCl9dmFyIGQ9MDtmLmV2ZW50LnNwZWNpYWxbYl09e3NldHVwOmZ1bmN0aW9uKCl7ZCsrPT09MCYmYy5hZGRFdmVudExpc3RlbmVyKGEsZSwhMCl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7LS1kPT09MCYmYy5yZW1vdmVFdmVudExpc3RlbmVyKGEsZSwhMCl9fX0pLGYuZWFjaChbImJpbmQiLCJvbmUiXSxmdW5jdGlvbihhLGMpe2YuZm5bY109ZnVuY3Rpb24oYSxkLGUpe3ZhciBnO2lmKHR5cGVvZiBhPT0ib2JqZWN0Iil7Zm9yKHZhciBoIGluIGEpdGhpc1tjXShoLGQsYVtoXSxlKTtyZXR1cm4gdGhpc31pZihhcmd1bWVudHMubGVuZ3RoPT09Mnx8ZD09PSExKWU9ZCxkPWI7Yz09PSJvbmUiPyhnPWZ1bmN0aW9uKGEpe2YodGhpcykudW5iaW5kKGEsZyk7cmV0dXJuIGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxnLmd1aWQ9ZS5ndWlkfHxmLmd1aWQrKyk6Zz1lO2lmKGE9PT0idW5sb2FkIiYmYyE9PSJvbmUiKXRoaXMub25lKGEsZCxlKTtlbHNlIGZvcih2YXIgaT0wLGo9dGhpcy5sZW5ndGg7aTxqO2krKylmLmV2ZW50LmFkZCh0aGlzW2ldLGEsZyxkKTtyZXR1cm4gdGhpc319KSxmLmZuLmV4dGVuZCh7dW5iaW5kOmZ1bmN0aW9uKGEsYil7aWYodHlwZW9mIGE9PSJvYmplY3QiJiYhYS5wcmV2ZW50RGVmYXVsdClmb3IodmFyIGMgaW4gYSl0aGlzLnVuYmluZChjLGFbY10pO2Vsc2UgZm9yKHZhciBkPTAsZT10aGlzLmxlbmd0aDtkPGU7ZCsrKWYuZXZlbnQucmVtb3ZlKHRoaXNbZF0sYSxiKTtyZXR1cm4gdGhpc30sZGVsZWdhdGU6ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIHRoaXMubGl2ZShiLGMsZCxhKX0sdW5kZWxlZ2F0ZTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg9PT0wP3RoaXMudW5iaW5kKCJsaXZlIik6dGhpcy5kaWUoYixudWxsLGMsYSl9LHRyaWdnZXI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zi5ldmVudC50cmlnZ2VyKGEsYix0aGlzKX0pfSx0cmlnZ2VySGFuZGxlcjpmdW5jdGlvbihhLGIpe2lmKHRoaXNbMF0pcmV0dXJuIGYuZXZlbnQudHJpZ2dlcihhLGIsdGhpc1swXSwhMCl9LHRvZ2dsZTpmdW5jdGlvbihhKXt2YXIgYj1hcmd1bWVudHMsYz1hLmd1aWR8fGYuZ3VpZCsrLGQ9MCxlPWZ1bmN0aW9uKGMpe3ZhciBlPShmLmRhdGEodGhpcywibGFzdFRvZ2dsZSIrYS5ndWlkKXx8MCklZDtmLmRhdGEodGhpcywibGFzdFRvZ2dsZSIrYS5ndWlkLGUrMSksYy5wcmV2ZW50RGVmYXVsdCgpO3JldHVybiBiW2VdLmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8ITF9O2UuZ3VpZD1jO3doaWxlKGQ8Yi5sZW5ndGgpYltkKytdLmd1aWQ9YztyZXR1cm4gdGhpcy5jbGljayhlKX0saG92ZXI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5tb3VzZWVudGVyKGEpLm1vdXNlbGVhdmUoYnx8YSl9fSk7dmFyIEw9e2ZvY3VzOiJmb2N1c2luIixibHVyOiJmb2N1c291dCIsbW91c2VlbnRlcjoibW91c2VvdmVyIixtb3VzZWxlYXZlOiJtb3VzZW91dCJ9O2YuZWFjaChbImxpdmUiLCJkaWUiXSxmdW5jdGlvbihhLGMpe2YuZm5bY109ZnVuY3Rpb24oYSxkLGUsZyl7dmFyIGgsaT0wLGosayxsLG09Z3x8dGhpcy5zZWxlY3RvcixuPWc/dGhpczpmKHRoaXMuY29udGV4dCk7aWYodHlwZW9mIGE9PSJvYmplY3QiJiYhYS5wcmV2ZW50RGVmYXVsdCl7Zm9yKHZhciBvIGluIGEpbltjXShvLGQsYVtvXSxtKTtyZXR1cm4gdGhpc31pZihjPT09ImRpZSImJiFhJiZnJiZnLmNoYXJBdCgwKT09PSIuIil7bi51bmJpbmQoZyk7cmV0dXJuIHRoaXN9aWYoZD09PSExfHxmLmlzRnVuY3Rpb24oZCkpZT1kfHxELGQ9YjthPShhfHwiIikuc3BsaXQoIiAiKTt3aGlsZSgoaD1hW2krK10pIT1udWxsKXtqPXguZXhlYyhoKSxrPSIiLGomJihrPWpbMF0saD1oLnJlcGxhY2UoeCwiIikpO2lmKGg9PT0iaG92ZXIiKXthLnB1c2goIm1vdXNlZW50ZXIiK2ssIm1vdXNlbGVhdmUiK2spO2NvbnRpbnVlfWw9aCxMW2hdPyhhLnB1c2goTFtoXStrKSxoPWgrayk6aD0oTFtoXXx8aCkraztpZihjPT09ImxpdmUiKWZvcih2YXIgcD0wLHE9bi5sZW5ndGg7cDxxO3ArKylmLmV2ZW50LmFkZChuW3BdLCJsaXZlLiIrTihoLG0pLHtkYXRhOmQsc2VsZWN0b3I6bSxoYW5kbGVyOmUsb3JpZ1R5cGU6aCxvcmlnSGFuZGxlcjplLHByZVR5cGU6bH0pO2Vsc2Ugbi51bmJpbmQoImxpdmUuIitOKGgsbSksZSl9cmV0dXJuIHRoaXN9fSksZi5lYWNoKCJibHVyIGZvY3VzIGZvY3VzaW4gZm9jdXNvdXQgbG9hZCByZXNpemUgc2Nyb2xsIHVubG9hZCBjbGljayBkYmxjbGljayBtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0IG1vdXNlZW50ZXIgbW91c2VsZWF2ZSBjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGVycm9yIi5zcGxpdCgiICIpLGZ1bmN0aW9uKGEsYil7Zi5mbltiXT1mdW5jdGlvbihhLGMpe2M9PW51bGwmJihjPWEsYT1udWxsKTtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD4wP3RoaXMuYmluZChiLGEsYyk6dGhpcy50cmlnZ2VyKGIpfSxmLmF0dHJGbiYmKGYuYXR0ckZuW2JdPSEwKX0pLGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdShhLGIsYyxkLGUsZil7Zm9yKHZhciBnPTAsaD1kLmxlbmd0aDtnPGg7ZysrKXt2YXIgaT1kW2ddO2lmKGkpe3ZhciBqPSExO2k9aVthXTt3aGlsZShpKXtpZihpLnNpemNhY2hlPT09Yyl7aj1kW2kuc2l6c2V0XTticmVha31pZihpLm5vZGVUeXBlPT09MSl7Znx8KGkuc2l6Y2FjaGU9YyxpLnNpenNldD1nKTtpZih0eXBlb2YgYiE9InN0cmluZyIpe2lmKGk9PT1iKXtqPSEwO2JyZWFrfX1lbHNlIGlmKGsuZmlsdGVyKGIsW2ldKS5sZW5ndGg+MCl7aj1pO2JyZWFrfX1pPWlbYV19ZFtnXT1qfX19ZnVuY3Rpb24gdChhLGIsYyxkLGUsZil7Zm9yKHZhciBnPTAsaD1kLmxlbmd0aDtnPGg7ZysrKXt2YXIgaT1kW2ddO2lmKGkpe3ZhciBqPSExO2k9aVthXTt3aGlsZShpKXtpZihpLnNpemNhY2hlPT09Yyl7aj1kW2kuc2l6c2V0XTticmVha31pLm5vZGVUeXBlPT09MSYmIWYmJihpLnNpemNhY2hlPWMsaS5zaXpzZXQ9Zyk7aWYoaS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09Yil7aj1pO2JyZWFrfWk9aVthXX1kW2ddPWp9fX12YXIgYT0vKCg/OlwoKD86XChbXigpXStcKXxbXigpXSspK1wpfFxbKD86XFtbXlxbXF1dKlxdfFsnIl1bXiciXSpbJyJdfFteXFtcXSciXSspK1xdfFxcLnxbXiA+K34sKFxbXFxdKykrfFs+K35dKShccyosXHMqKT8oKD86LnxccnxcbikqKS9nLGQ9MCxlPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsZz0hMSxoPSEwLGk9L1xcL2csaj0vXFcvO1swLDBdLnNvcnQoZnVuY3Rpb24oKXtoPSExO3JldHVybiAwfSk7dmFyIGs9ZnVuY3Rpb24oYixkLGYsZyl7Zj1mfHxbXSxkPWR8fGM7dmFyIGg9ZDtpZihkLm5vZGVUeXBlIT09MSYmZC5ub2RlVHlwZSE9PTkpcmV0dXJuW107aWYoIWJ8fHR5cGVvZiBiIT0ic3RyaW5nIilyZXR1cm4gZjt2YXIgaSxqLG4sbyxxLHIscyx0LHU9ITAsdz1rLmlzWE1MKGQpLHg9W10seT1iO2Rve2EuZXhlYygiIiksaT1hLmV4ZWMoeSk7aWYoaSl7eT1pWzNdLHgucHVzaChpWzFdKTtpZihpWzJdKXtvPWlbM107YnJlYWt9fX13aGlsZShpKTtpZih4Lmxlbmd0aD4xJiZtLmV4ZWMoYikpaWYoeC5sZW5ndGg9PT0yJiZsLnJlbGF0aXZlW3hbMF1dKWo9dih4WzBdK3hbMV0sZCk7ZWxzZXtqPWwucmVsYXRpdmVbeFswXV0/W2RdOmsoeC5zaGlmdCgpLGQpO3doaWxlKHgubGVuZ3RoKWI9eC5zaGlmdCgpLGwucmVsYXRpdmVbYl0mJihiKz14LnNoaWZ0KCkpLGo9dihiLGopfWVsc2V7IWcmJngubGVuZ3RoPjEmJmQubm9kZVR5cGU9PT05JiYhdyYmbC5tYXRjaC5JRC50ZXN0KHhbMF0pJiYhbC5tYXRjaC5JRC50ZXN0KHhbeC5sZW5ndGgtMV0pJiYocT1rLmZpbmQoeC5zaGlmdCgpLGQsdyksZD1xLmV4cHI/ay5maWx0ZXIocS5leHByLHEuc2V0KVswXTpxLnNldFswXSk7aWYoZCl7cT1nP3tleHByOngucG9wKCksc2V0OnAoZyl9OmsuZmluZCh4LnBvcCgpLHgubGVuZ3RoPT09MSYmKHhbMF09PT0ifiJ8fHhbMF09PT0iKyIpJiZkLnBhcmVudE5vZGU/ZC5wYXJlbnROb2RlOmQsdyksaj1xLmV4cHI/ay5maWx0ZXIocS5leHByLHEuc2V0KTpxLnNldCx4Lmxlbmd0aD4wP249cChqKTp1PSExO3doaWxlKHgubGVuZ3RoKXI9eC5wb3AoKSxzPXIsbC5yZWxhdGl2ZVtyXT9zPXgucG9wKCk6cj0iIixzPT1udWxsJiYocz1kKSxsLnJlbGF0aXZlW3JdKG4scyx3KX1lbHNlIG49eD1bXX1ufHwobj1qKSxufHxrLmVycm9yKHJ8fGIpO2lmKGUuY2FsbChuKT09PSJbb2JqZWN0IEFycmF5XSIpaWYoIXUpZi5wdXNoLmFwcGx5KGYsbik7ZWxzZSBpZihkJiZkLm5vZGVUeXBlPT09MSlmb3IodD0wO25bdF0hPW51bGw7dCsrKW5bdF0mJihuW3RdPT09ITB8fG5bdF0ubm9kZVR5cGU9PT0xJiZrLmNvbnRhaW5zKGQsblt0XSkpJiZmLnB1c2goalt0XSk7ZWxzZSBmb3IodD0wO25bdF0hPW51bGw7dCsrKW5bdF0mJm5bdF0ubm9kZVR5cGU9PT0xJiZmLnB1c2goalt0XSk7ZWxzZSBwKG4sZik7byYmKGsobyxoLGYsZyksay51bmlxdWVTb3J0KGYpKTtyZXR1cm4gZn07ay51bmlxdWVTb3J0PWZ1bmN0aW9uKGEpe2lmKHIpe2c9aCxhLnNvcnQocik7aWYoZylmb3IodmFyIGI9MTtiPGEubGVuZ3RoO2IrKylhW2JdPT09YVtiLTFdJiZhLnNwbGljZShiLS0sMSl9cmV0dXJuIGF9LGsubWF0Y2hlcz1mdW5jdGlvbihhLGIpe3JldHVybiBrKGEsbnVsbCxudWxsLGIpfSxrLm1hdGNoZXNTZWxlY3Rvcj1mdW5jdGlvbihhLGIpe3JldHVybiBrKGIsbnVsbCxudWxsLFthXSkubGVuZ3RoPjB9LGsuZmluZD1mdW5jdGlvbihhLGIsYyl7dmFyIGQ7aWYoIWEpcmV0dXJuW107Zm9yKHZhciBlPTAsZj1sLm9yZGVyLmxlbmd0aDtlPGY7ZSsrKXt2YXIgZyxoPWwub3JkZXJbZV07aWYoZz1sLmxlZnRNYXRjaFtoXS5leGVjKGEpKXt2YXIgaj1nWzFdO2cuc3BsaWNlKDEsMSk7aWYoai5zdWJzdHIoai5sZW5ndGgtMSkhPT0iXFwiKXtnWzFdPShnWzFdfHwiIikucmVwbGFjZShpLCIiKSxkPWwuZmluZFtoXShnLGIsYyk7aWYoZCE9bnVsbCl7YT1hLnJlcGxhY2UobC5tYXRjaFtoXSwiIik7YnJlYWt9fX19ZHx8KGQ9dHlwZW9mIGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUhPSJ1bmRlZmluZWQiP2IuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKTpbXSk7cmV0dXJue3NldDpkLGV4cHI6YX19LGsuZmlsdGVyPWZ1bmN0aW9uKGEsYyxkLGUpe3ZhciBmLGcsaD1hLGk9W10saj1jLG09YyYmY1swXSYmay5pc1hNTChjWzBdKTt3aGlsZShhJiZjLmxlbmd0aCl7Zm9yKHZhciBuIGluIGwuZmlsdGVyKWlmKChmPWwubGVmdE1hdGNoW25dLmV4ZWMoYSkpIT1udWxsJiZmWzJdKXt2YXIgbyxwLHE9bC5maWx0ZXJbbl0scj1mWzFdO2c9ITEsZi5zcGxpY2UoMSwxKTtpZihyLnN1YnN0cihyLmxlbmd0aC0xKT09PSJcXCIpY29udGludWU7aj09PWkmJihpPVtdKTtpZihsLnByZUZpbHRlcltuXSl7Zj1sLnByZUZpbHRlcltuXShmLGosZCxpLGUsbSk7aWYoIWYpZz1vPSEwO2Vsc2UgaWYoZj09PSEwKWNvbnRpbnVlfWlmKGYpZm9yKHZhciBzPTA7KHA9altzXSkhPW51bGw7cysrKWlmKHApe289cShwLGYscyxqKTt2YXIgdD1lXiEhbztkJiZvIT1udWxsP3Q/Zz0hMDpqW3NdPSExOnQmJihpLnB1c2gocCksZz0hMCl9aWYobyE9PWIpe2R8fChqPWkpLGE9YS5yZXBsYWNlKGwubWF0Y2hbbl0sIiIpO2lmKCFnKXJldHVybltdO2JyZWFrfX1pZihhPT09aClpZihnPT1udWxsKWsuZXJyb3IoYSk7ZWxzZSBicmVhaztoPWF9cmV0dXJuIGp9LGsuZXJyb3I9ZnVuY3Rpb24oYSl7dGhyb3ciU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogIithfTt2YXIgbD1rLnNlbGVjdG9ycz17b3JkZXI6WyJJRCIsIk5BTUUiLCJUQUciXSxtYXRjaDp7SUQ6LyMoKD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKykvLENMQVNTOi9cLigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKS8sTkFNRTovXFtuYW1lPVsnIl0qKCg/Oltcd1x1MDBjMC1cdUZGRkZcLV18XFwuKSspWyciXSpcXS8sQVRUUjovXFtccyooKD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKylccyooPzooXFM/PSlccyooPzooWyciXSkoLio/KVwzfCgjPyg/Oltcd1x1MDBjMC1cdUZGRkZcLV18XFwuKSopfCl8KVxzKlxdLyxUQUc6L14oKD86W1x3XHUwMGMwLVx1RkZGRlwqXC1dfFxcLikrKS8sQ0hJTEQ6Lzoob25seXxudGh8bGFzdHxmaXJzdCktY2hpbGQoPzpcKFxzKihldmVufG9kZHwoPzpbK1wtXT9cZCt8KD86WytcLV0/XGQqKT9uXHMqKD86WytcLV1ccypcZCspPykpXHMqXCkpPy8sUE9TOi86KG50aHxlcXxndHxsdHxmaXJzdHxsYXN0fGV2ZW58b2RkKSg/OlwoKFxkKilcKSk/KD89W15cLV18JCkvLFBTRVVETzovOigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKSg/OlwoKFsnIl0/KSgoPzpcKFteXCldK1wpfFteXChcKV0qKSspXDJcKSk/L30sbGVmdE1hdGNoOnt9LGF0dHJNYXA6eyJjbGFzcyI6ImNsYXNzTmFtZSIsImZvciI6Imh0bWxGb3IifSxhdHRySGFuZGxlOntocmVmOmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgiaHJlZiIpfSx0eXBlOmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgidHlwZSIpfX0scmVsYXRpdmU6eyIrIjpmdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBiPT0ic3RyaW5nIixkPWMmJiFqLnRlc3QoYiksZT1jJiYhZDtkJiYoYj1iLnRvTG93ZXJDYXNlKCkpO2Zvcih2YXIgZj0wLGc9YS5sZW5ndGgsaDtmPGc7ZisrKWlmKGg9YVtmXSl7d2hpbGUoKGg9aC5wcmV2aW91c1NpYmxpbmcpJiZoLm5vZGVUeXBlIT09MSk7YVtmXT1lfHxoJiZoLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iP2h8fCExOmg9PT1ifWUmJmsuZmlsdGVyKGIsYSwhMCl9LCI+IjpmdW5jdGlvbihhLGIpe3ZhciBjLGQ9dHlwZW9mIGI9PSJzdHJpbmciLGU9MCxmPWEubGVuZ3RoO2lmKGQmJiFqLnRlc3QoYikpe2I9Yi50b0xvd2VyQ2FzZSgpO2Zvcig7ZTxmO2UrKyl7Yz1hW2VdO2lmKGMpe3ZhciBnPWMucGFyZW50Tm9kZTthW2VdPWcubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWI/ZzohMX19fWVsc2V7Zm9yKDtlPGY7ZSsrKWM9YVtlXSxjJiYoYVtlXT1kP2MucGFyZW50Tm9kZTpjLnBhcmVudE5vZGU9PT1iKTtkJiZrLmZpbHRlcihiLGEsITApfX0sIiI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBlLGY9ZCsrLGc9dTt0eXBlb2YgYj09InN0cmluZyImJiFqLnRlc3QoYikmJihiPWIudG9Mb3dlckNhc2UoKSxlPWIsZz10KSxnKCJwYXJlbnROb2RlIixiLGYsYSxlLGMpfSwifiI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBlLGY9ZCsrLGc9dTt0eXBlb2YgYj09InN0cmluZyImJiFqLnRlc3QoYikmJihiPWIudG9Mb3dlckNhc2UoKSxlPWIsZz10KSxnKCJwcmV2aW91c1NpYmxpbmciLGIsZixhLGUsYyl9fSxmaW5kOntJRDpmdW5jdGlvbihhLGIsYyl7aWYodHlwZW9mIGIuZ2V0RWxlbWVudEJ5SWQhPSJ1bmRlZmluZWQiJiYhYyl7dmFyIGQ9Yi5nZXRFbGVtZW50QnlJZChhWzFdKTtyZXR1cm4gZCYmZC5wYXJlbnROb2RlP1tkXTpbXX19LE5BTUU6ZnVuY3Rpb24oYSxiKXtpZih0eXBlb2YgYi5nZXRFbGVtZW50c0J5TmFtZSE9InVuZGVmaW5lZCIpe3ZhciBjPVtdLGQ9Yi5nZXRFbGVtZW50c0J5TmFtZShhWzFdKTtmb3IodmFyIGU9MCxmPWQubGVuZ3RoO2U8ZjtlKyspZFtlXS5nZXRBdHRyaWJ1dGUoIm5hbWUiKT09PWFbMV0mJmMucHVzaChkW2VdKTtyZXR1cm4gYy5sZW5ndGg9PT0wP251bGw6Y319LFRBRzpmdW5jdGlvbihhLGIpe2lmKHR5cGVvZiBiLmdldEVsZW1lbnRzQnlUYWdOYW1lIT0idW5kZWZpbmVkIilyZXR1cm4gYi5nZXRFbGVtZW50c0J5VGFnTmFtZShhWzFdKX19LHByZUZpbHRlcjp7Q0xBU1M6ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe2E9IiAiK2FbMV0ucmVwbGFjZShpLCIiKSsiICI7aWYoZilyZXR1cm4gYTtmb3IodmFyIGc9MCxoOyhoPWJbZ10pIT1udWxsO2crKyloJiYoZV4oaC5jbGFzc05hbWUmJigiICIraC5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKC9bXHRcblxyXS9nLCIgIikuaW5kZXhPZihhKT49MCk/Y3x8ZC5wdXNoKGgpOmMmJihiW2ddPSExKSk7cmV0dXJuITF9LElEOmZ1bmN0aW9uKGEpe3JldHVybiBhWzFdLnJlcGxhY2UoaSwiIil9LFRBRzpmdW5jdGlvbihhLGIpe3JldHVybiBhWzFdLnJlcGxhY2UoaSwiIikudG9Mb3dlckNhc2UoKX0sQ0hJTEQ6ZnVuY3Rpb24oYSl7aWYoYVsxXT09PSJudGgiKXthWzJdfHxrLmVycm9yKGFbMF0pLGFbMl09YVsyXS5yZXBsYWNlKC9eXCt8XHMqL2csIiIpO3ZhciBiPS8oLT8pKFxkKikoPzpuKFsrXC1dP1xkKikpPy8uZXhlYyhhWzJdPT09ImV2ZW4iJiYiMm4ifHxhWzJdPT09Im9kZCImJiIybisxInx8IS9cRC8udGVzdChhWzJdKSYmIjBuKyIrYVsyXXx8YVsyXSk7YVsyXT1iWzFdKyhiWzJdfHwxKS0wLGFbM109YlszXS0wfWVsc2UgYVsyXSYmay5lcnJvcihhWzBdKTthWzBdPWQrKztyZXR1cm4gYX0sQVRUUjpmdW5jdGlvbihhLGIsYyxkLGUsZil7dmFyIGc9YVsxXT1hWzFdLnJlcGxhY2UoaSwiIik7IWYmJmwuYXR0ck1hcFtnXSYmKGFbMV09bC5hdHRyTWFwW2ddKSxhWzRdPShhWzRdfHxhWzVdfHwiIikucmVwbGFjZShpLCIiKSxhWzJdPT09In49IiYmKGFbNF09IiAiK2FbNF0rIiAiKTtyZXR1cm4gYX0sUFNFVURPOmZ1bmN0aW9uKGIsYyxkLGUsZil7aWYoYlsxXT09PSJub3QiKWlmKChhLmV4ZWMoYlszXSl8fCIiKS5sZW5ndGg+MXx8L15cdy8udGVzdChiWzNdKSliWzNdPWsoYlszXSxudWxsLG51bGwsYyk7ZWxzZXt2YXIgZz1rLmZpbHRlcihiWzNdLGMsZCwhMF5mKTtkfHxlLnB1c2guYXBwbHkoZSxnKTtyZXR1cm4hMX1lbHNlIGlmKGwubWF0Y2guUE9TLnRlc3QoYlswXSl8fGwubWF0Y2guQ0hJTEQudGVzdChiWzBdKSlyZXR1cm4hMDtyZXR1cm4gYn0sUE9TOmZ1bmN0aW9uKGEpe2EudW5zaGlmdCghMCk7cmV0dXJuIGF9fSxmaWx0ZXJzOntlbmFibGVkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmRpc2FibGVkPT09ITEmJmEudHlwZSE9PSJoaWRkZW4ifSxkaXNhYmxlZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5kaXNhYmxlZD09PSEwfSxjaGVja2VkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmNoZWNrZWQ9PT0hMH0sc2VsZWN0ZWQ6ZnVuY3Rpb24oYSl7YS5wYXJlbnROb2RlJiZhLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDtyZXR1cm4gYS5zZWxlY3RlZD09PSEwfSxwYXJlbnQ6ZnVuY3Rpb24oYSl7cmV0dXJuISFhLmZpcnN0Q2hpbGR9LGVtcHR5OmZ1bmN0aW9uKGEpe3JldHVybiFhLmZpcnN0Q2hpbGR9LGhhczpmdW5jdGlvbihhLGIsYyl7cmV0dXJuISFrKGNbM10sYSkubGVuZ3RofSxoZWFkZXI6ZnVuY3Rpb24oYSl7cmV0dXJuL2hcZC9pLnRlc3QoYS5ub2RlTmFtZSl9LHRleHQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5nZXRBdHRyaWJ1dGUoInR5cGUiKSxjPWEudHlwZTtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmInRleHQiPT09YyYmKGI9PT1jfHxiPT09bnVsbCl9LHJhZGlvOmZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT0iaW5wdXQiJiYicmFkaW8iPT09YS50eXBlfSxjaGVja2JveDpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmImNoZWNrYm94Ij09PWEudHlwZX0sZmlsZTpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmImZpbGUiPT09YS50eXBlfSxwYXNzd29yZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmInBhc3N3b3JkIj09PWEudHlwZX0sc3VibWl0OmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4oYj09PSJpbnB1dCJ8fGI9PT0iYnV0dG9uIikmJiJzdWJtaXQiPT09YS50eXBlfSxpbWFnZTpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmImltYWdlIj09PWEudHlwZX0scmVzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybihiPT09ImlucHV0Inx8Yj09PSJidXR0b24iKSYmInJlc2V0Ij09PWEudHlwZX0sYnV0dG9uOmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4gYj09PSJpbnB1dCImJiJidXR0b24iPT09YS50eXBlfHxiPT09ImJ1dHRvbiJ9LGlucHV0OmZ1bmN0aW9uKGEpe3JldHVybi9pbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uL2kudGVzdChhLm5vZGVOYW1lKX0sZm9jdXM6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1hLm93bmVyRG9jdW1lbnQuYWN0aXZlRWxlbWVudH19LHNldEZpbHRlcnM6e2ZpcnN0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGI9PT0wfSxsYXN0OmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiBiPT09ZC5sZW5ndGgtMX0sZXZlbjpmdW5jdGlvbihhLGIpe3JldHVybiBiJTI9PT0wfSxvZGQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYiUyPT09MX0sbHQ6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBiPGNbM10tMH0sZ3Q6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBiPmNbM10tMH0sbnRoOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gY1szXS0wPT09Yn0sZXE6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBjWzNdLTA9PT1ifX0sZmlsdGVyOntQU0VVRE86ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9YlsxXSxmPWwuZmlsdGVyc1tlXTtpZihmKXJldHVybiBmKGEsYyxiLGQpO2lmKGU9PT0iY29udGFpbnMiKXJldHVybihhLnRleHRDb250ZW50fHxhLmlubmVyVGV4dHx8ay5nZXRUZXh0KFthXSl8fCIiKS5pbmRleE9mKGJbM10pPj0wO2lmKGU9PT0ibm90Iil7dmFyIGc9YlszXTtmb3IodmFyIGg9MCxpPWcubGVuZ3RoO2g8aTtoKyspaWYoZ1toXT09PWEpcmV0dXJuITE7cmV0dXJuITB9ay5lcnJvcihlKX0sQ0hJTEQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz1iWzFdLGQ9YTtzd2l0Y2goYyl7Y2FzZSJvbmx5IjpjYXNlImZpcnN0Ijp3aGlsZShkPWQucHJldmlvdXNTaWJsaW5nKWlmKGQubm9kZVR5cGU9PT0xKXJldHVybiExO2lmKGM9PT0iZmlyc3QiKXJldHVybiEwO2Q9YTtjYXNlImxhc3QiOndoaWxlKGQ9ZC5uZXh0U2libGluZylpZihkLm5vZGVUeXBlPT09MSlyZXR1cm4hMTtyZXR1cm4hMDtjYXNlIm50aCI6dmFyIGU9YlsyXSxmPWJbM107aWYoZT09PTEmJmY9PT0wKXJldHVybiEwO3ZhciBnPWJbMF0saD1hLnBhcmVudE5vZGU7aWYoaCYmKGguc2l6Y2FjaGUhPT1nfHwhYS5ub2RlSW5kZXgpKXt2YXIgaT0wO2ZvcihkPWguZmlyc3RDaGlsZDtkO2Q9ZC5uZXh0U2libGluZylkLm5vZGVUeXBlPT09MSYmKGQubm9kZUluZGV4PSsraSk7aC5zaXpjYWNoZT1nfXZhciBqPWEubm9kZUluZGV4LWY7cmV0dXJuIGU9PT0wP2o9PT0wOmolZT09PTAmJmovZT49MH19LElEOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEubm9kZVR5cGU9PT0xJiZhLmdldEF0dHJpYnV0ZSgiaWQiKT09PWJ9LFRBRzpmdW5jdGlvbihhLGIpe3JldHVybiBiPT09IioiJiZhLm5vZGVUeXBlPT09MXx8YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09Yn0sQ0xBU1M6ZnVuY3Rpb24oYSxiKXtyZXR1cm4oIiAiKyhhLmNsYXNzTmFtZXx8YS5nZXRBdHRyaWJ1dGUoImNsYXNzIikpKyIgIikuaW5kZXhPZihiKT4tMX0sQVRUUjpmdW5jdGlvbihhLGIpe3ZhciBjPWJbMV0sZD1sLmF0dHJIYW5kbGVbY10/bC5hdHRySGFuZGxlW2NdKGEpOmFbY10hPW51bGw/YVtjXTphLmdldEF0dHJpYnV0ZShjKSxlPWQrIiIsZj1iWzJdLGc9Yls0XTtyZXR1cm4gZD09bnVsbD9mPT09IiE9IjpmPT09Ij0iP2U9PT1nOmY9PT0iKj0iP2UuaW5kZXhPZihnKT49MDpmPT09In49Ij8oIiAiK2UrIiAiKS5pbmRleE9mKGcpPj0wOmc/Zj09PSIhPSI/ZSE9PWc6Zj09PSJePSI/ZS5pbmRleE9mKGcpPT09MDpmPT09IiQ9Ij9lLnN1YnN0cihlLmxlbmd0aC1nLmxlbmd0aCk9PT1nOmY9PT0ifD0iP2U9PT1nfHxlLnN1YnN0cigwLGcubGVuZ3RoKzEpPT09ZysiLSI6ITE6ZSYmZCE9PSExfSxQT1M6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9YlsyXSxmPWwuc2V0RmlsdGVyc1tlXTtpZihmKXJldHVybiBmKGEsYyxiLGQpfX19LG09bC5tYXRjaC5QT1Msbj1mdW5jdGlvbihhLGIpe3JldHVybiJcXCIrKGItMCsxKX07Zm9yKHZhciBvIGluIGwubWF0Y2gpbC5tYXRjaFtvXT1uZXcgUmVnRXhwKGwubWF0Y2hbb10uc291cmNlKy8oPyFbXlxbXSpcXSkoPyFbXlwoXSpcKSkvLnNvdXJjZSksbC5sZWZ0TWF0Y2hbb109bmV3IFJlZ0V4cCgvKF4oPzoufFxyfFxuKSo/KS8uc291cmNlK2wubWF0Y2hbb10uc291cmNlLnJlcGxhY2UoL1xcKFxkKykvZyxuKSk7dmFyIHA9ZnVuY3Rpb24oYSxiKXthPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGEsMCk7aWYoYil7Yi5wdXNoLmFwcGx5KGIsYSk7cmV0dXJuIGJ9cmV0dXJuIGF9O3RyeXtBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChjLmRvY3VtZW50RWxlbWVudC5jaGlsZE5vZGVzLDApWzBdLm5vZGVUeXBlfWNhdGNoKHEpe3A9ZnVuY3Rpb24oYSxiKXt2YXIgYz0wLGQ9Ynx8W107aWYoZS5jYWxsKGEpPT09IltvYmplY3QgQXJyYXldIilBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShkLGEpO2Vsc2UgaWYodHlwZW9mIGEubGVuZ3RoPT0ibnVtYmVyIilmb3IodmFyIGY9YS5sZW5ndGg7YzxmO2MrKylkLnB1c2goYVtjXSk7ZWxzZSBmb3IoO2FbY107YysrKWQucHVzaChhW2NdKTtyZXR1cm4gZH19dmFyIHIscztjLmRvY3VtZW50RWxlbWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj9yPWZ1bmN0aW9uKGEsYil7aWYoYT09PWIpe2c9ITA7cmV0dXJuIDB9aWYoIWEuY29tcGFyZURvY3VtZW50UG9zaXRpb258fCFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKXJldHVybiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uPy0xOjE7cmV0dXJuIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmND8tMToxfToocj1mdW5jdGlvbihhLGIpe2lmKGE9PT1iKXtnPSEwO3JldHVybiAwfWlmKGEuc291cmNlSW5kZXgmJmIuc291cmNlSW5kZXgpcmV0dXJuIGEuc291cmNlSW5kZXgtYi5zb3VyY2VJbmRleDt2YXIgYyxkLGU9W10sZj1bXSxoPWEucGFyZW50Tm9kZSxpPWIucGFyZW50Tm9kZSxqPWg7aWYoaD09PWkpcmV0dXJuIHMoYSxiKTtpZighaClyZXR1cm4tMTtpZighaSlyZXR1cm4gMTt3aGlsZShqKWUudW5zaGlmdChqKSxqPWoucGFyZW50Tm9kZTtqPWk7d2hpbGUoailmLnVuc2hpZnQoaiksaj1qLnBhcmVudE5vZGU7Yz1lLmxlbmd0aCxkPWYubGVuZ3RoO2Zvcih2YXIgaz0wO2s8YyYmazxkO2srKylpZihlW2tdIT09ZltrXSlyZXR1cm4gcyhlW2tdLGZba10pO3JldHVybiBrPT09Yz9zKGEsZltrXSwtMSk6cyhlW2tdLGIsMSl9LHM9ZnVuY3Rpb24oYSxiLGMpe2lmKGE9PT1iKXJldHVybiBjO3ZhciBkPWEubmV4dFNpYmxpbmc7d2hpbGUoZCl7aWYoZD09PWIpcmV0dXJuLTE7ZD1kLm5leHRTaWJsaW5nfXJldHVybiAxfSksay5nZXRUZXh0PWZ1bmN0aW9uKGEpe3ZhciBiPSIiLGM7Zm9yKHZhciBkPTA7YVtkXTtkKyspYz1hW2RdLGMubm9kZVR5cGU9PT0zfHxjLm5vZGVUeXBlPT09ND9iKz1jLm5vZGVWYWx1ZTpjLm5vZGVUeXBlIT09OCYmKGIrPWsuZ2V0VGV4dChjLmNoaWxkTm9kZXMpKTtyZXR1cm4gYn0sZnVuY3Rpb24oKXt2YXIgYT1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpLGQ9InNjcmlwdCIrKG5ldyBEYXRlKS5nZXRUaW1lKCksZT1jLmRvY3VtZW50RWxlbWVudDthLmlubmVySFRNTD0iPGEgbmFtZT0nIitkKyInLz4iLGUuaW5zZXJ0QmVmb3JlKGEsZS5maXJzdENoaWxkKSxjLmdldEVsZW1lbnRCeUlkKGQpJiYobC5maW5kLklEPWZ1bmN0aW9uKGEsYyxkKXtpZih0eXBlb2YgYy5nZXRFbGVtZW50QnlJZCE9InVuZGVmaW5lZCImJiFkKXt2YXIgZT1jLmdldEVsZW1lbnRCeUlkKGFbMV0pO3JldHVybiBlP2UuaWQ9PT1hWzFdfHx0eXBlb2YgZS5nZXRBdHRyaWJ1dGVOb2RlIT0idW5kZWZpbmVkIiYmZS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpLm5vZGVWYWx1ZT09PWFbMV0/W2VdOmI6W119fSxsLmZpbHRlci5JRD1mdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBhLmdldEF0dHJpYnV0ZU5vZGUhPSJ1bmRlZmluZWQiJiZhLmdldEF0dHJpYnV0ZU5vZGUoImlkIik7cmV0dXJuIGEubm9kZVR5cGU9PT0xJiZjJiZjLm5vZGVWYWx1ZT09PWJ9KSxlLnJlbW92ZUNoaWxkKGEpLGU9YT1udWxsfSgpLGZ1bmN0aW9uKCl7dmFyIGE9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKTthLmFwcGVuZENoaWxkKGMuY3JlYXRlQ29tbWVudCgiIikpLGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKS5sZW5ndGg+MCYmKGwuZmluZC5UQUc9ZnVuY3Rpb24oYSxiKXt2YXIgYz1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKGFbMV0pO2lmKGFbMV09PT0iKiIpe3ZhciBkPVtdO2Zvcih2YXIgZT0wO2NbZV07ZSsrKWNbZV0ubm9kZVR5cGU9PT0xJiZkLnB1c2goY1tlXSk7Yz1kfXJldHVybiBjfSksYS5pbm5lckhUTUw9IjxhIGhyZWY9JyMnPjwvYT4iLGEuZmlyc3RDaGlsZCYmdHlwZW9mIGEuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUhPSJ1bmRlZmluZWQiJiZhLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJocmVmIikhPT0iIyImJihsLmF0dHJIYW5kbGUuaHJlZj1mdW5jdGlvbihhKXtyZXR1cm4gYS5nZXRBdHRyaWJ1dGUoImhyZWYiLDIpfSksYT1udWxsfSgpLGMucXVlcnlTZWxlY3RvckFsbCYmZnVuY3Rpb24oKXt2YXIgYT1rLGI9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKSxkPSJfX3NpenpsZV9fIjtiLmlubmVySFRNTD0iPHAgY2xhc3M9J1RFU1QnPjwvcD4iO2lmKCFiLnF1ZXJ5U2VsZWN0b3JBbGx8fGIucXVlcnlTZWxlY3RvckFsbCgiLlRFU1QiKS5sZW5ndGghPT0wKXtrPWZ1bmN0aW9uKGIsZSxmLGcpe2U9ZXx8YztpZighZyYmIWsuaXNYTUwoZSkpe3ZhciBoPS9eKFx3KyQpfF5cLihbXHdcLV0rJCl8XiMoW1x3XC1dKyQpLy5leGVjKGIpO2lmKGgmJihlLm5vZGVUeXBlPT09MXx8ZS5ub2RlVHlwZT09PTkpKXtpZihoWzFdKXJldHVybiBwKGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYiksZik7aWYoaFsyXSYmbC5maW5kLkNMQVNTJiZlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpcmV0dXJuIHAoZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGhbMl0pLGYpfWlmKGUubm9kZVR5cGU9PT05KXtpZihiPT09ImJvZHkiJiZlLmJvZHkpcmV0dXJuIHAoW2UuYm9keV0sZik7aWYoaCYmaFszXSl7dmFyIGk9ZS5nZXRFbGVtZW50QnlJZChoWzNdKTtpZighaXx8IWkucGFyZW50Tm9kZSlyZXR1cm4gcChbXSxmKTtpZihpLmlkPT09aFszXSlyZXR1cm4gcChbaV0sZil9dHJ5e3JldHVybiBwKGUucXVlcnlTZWxlY3RvckFsbChiKSxmKX1jYXRjaChqKXt9fWVsc2UgaWYoZS5ub2RlVHlwZT09PTEmJmUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSE9PSJvYmplY3QiKXt2YXIgbT1lLG49ZS5nZXRBdHRyaWJ1dGUoImlkIiksbz1ufHxkLHE9ZS5wYXJlbnROb2RlLHI9L15ccypbK35dLy50ZXN0KGIpO24/bz1vLnJlcGxhY2UoLycvZywiXFwkJiIpOmUuc2V0QXR0cmlidXRlKCJpZCIsbyksciYmcSYmKGU9ZS5wYXJlbnROb2RlKTt0cnl7aWYoIXJ8fHEpcmV0dXJuIHAoZS5xdWVyeVNlbGVjdG9yQWxsKCJbaWQ9JyIrbysiJ10gIitiKSxmKX1jYXRjaChzKXt9ZmluYWxseXtufHxtLnJlbW92ZUF0dHJpYnV0ZSgiaWQiKX19fXJldHVybiBhKGIsZSxmLGcpfTtmb3IodmFyIGUgaW4gYSlrW2VdPWFbZV07Yj1udWxsfX0oKSxmdW5jdGlvbigpe3ZhciBhPWMuZG9jdW1lbnRFbGVtZW50LGI9YS5tYXRjaGVzU2VsZWN0b3J8fGEubW96TWF0Y2hlc1NlbGVjdG9yfHxhLndlYmtpdE1hdGNoZXNTZWxlY3Rvcnx8YS5tc01hdGNoZXNTZWxlY3RvcjtpZihiKXt2YXIgZD0hYi5jYWxsKGMuY3JlYXRlRWxlbWVudCgiZGl2IiksImRpdiIpLGU9ITE7dHJ5e2IuY2FsbChjLmRvY3VtZW50RWxlbWVudCwiW3Rlc3QhPScnXTpzaXp6bGUiKX1jYXRjaChmKXtlPSEwfWsubWF0Y2hlc1NlbGVjdG9yPWZ1bmN0aW9uKGEsYyl7Yz1jLnJlcGxhY2UoL1w9XHMqKFteJyJcXV0qKVxzKlxdL2csIj0nJDEnXSIpO2lmKCFrLmlzWE1MKGEpKXRyeXtpZihlfHwhbC5tYXRjaC5QU0VVRE8udGVzdChjKSYmIS8hPS8udGVzdChjKSl7dmFyIGY9Yi5jYWxsKGEsYyk7aWYoZnx8IWR8fGEuZG9jdW1lbnQmJmEuZG9jdW1lbnQubm9kZVR5cGUhPT0xMSlyZXR1cm4gZn19Y2F0Y2goZyl7fXJldHVybiBrKGMsbnVsbCxudWxsLFthXSkubGVuZ3RoPjB9fX0oKSxmdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudCgiZGl2Iik7YS5pbm5lckhUTUw9IjxkaXYgY2xhc3M9J3Rlc3QgZSc+PC9kaXY+PGRpdiBjbGFzcz0ndGVzdCc+PC9kaXY+IjtpZighIWEuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSYmYS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJlIikubGVuZ3RoIT09MCl7YS5sYXN0Q2hpbGQuY2xhc3NOYW1lPSJlIjtpZihhLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImUiKS5sZW5ndGg9PT0xKXJldHVybjtsLm9yZGVyLnNwbGljZSgxLDAsIkNMQVNTIiksbC5maW5kLkNMQVNTPWZ1bmN0aW9uKGEsYixjKXtpZih0eXBlb2YgYi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lIT0idW5kZWZpbmVkIiYmIWMpcmV0dXJuIGIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShhWzFdKX0sYT1udWxsfX0oKSxjLmRvY3VtZW50RWxlbWVudC5jb250YWlucz9rLmNvbnRhaW5zPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGEhPT1iJiYoYS5jb250YWlucz9hLmNvbnRhaW5zKGIpOiEwKX06Yy5kb2N1bWVudEVsZW1lbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24/ay5jb250YWlucz1mdW5jdGlvbihhLGIpe3JldHVybiEhKGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmMTYpfTprLmNvbnRhaW5zPWZ1bmN0aW9uKCl7cmV0dXJuITF9LGsuaXNYTUw9ZnVuY3Rpb24oYSl7dmFyIGI9KGE/YS5vd25lckRvY3VtZW50fHxhOjApLmRvY3VtZW50RWxlbWVudDtyZXR1cm4gYj9iLm5vZGVOYW1lIT09IkhUTUwiOiExfTt2YXIgdj1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9W10sZT0iIixmPWIubm9kZVR5cGU/W2JdOmI7d2hpbGUoYz1sLm1hdGNoLlBTRVVETy5leGVjKGEpKWUrPWNbMF0sYT1hLnJlcGxhY2UobC5tYXRjaC5QU0VVRE8sIiIpO2E9bC5yZWxhdGl2ZVthXT9hKyIqIjphO2Zvcih2YXIgZz0wLGg9Zi5sZW5ndGg7ZzxoO2crKylrKGEsZltnXSxkKTtyZXR1cm4gay5maWx0ZXIoZSxkKX07Zi5maW5kPWssZi5leHByPWsuc2VsZWN0b3JzLGYuZXhwclsiOiJdPWYuZXhwci5maWx0ZXJzLGYudW5pcXVlPWsudW5pcXVlU29ydCxmLnRleHQ9ay5nZXRUZXh0LGYuaXNYTUxEb2M9ay5pc1hNTCxmLmNvbnRhaW5zPWsuY29udGFpbnN9KCk7dmFyIE89L1VudGlsJC8sUD0vXig/OnBhcmVudHN8cHJldlVudGlsfHByZXZBbGwpLyxRPS8sLyxSPS9eLlteOiNcW1wuLF0qJC8sUz1BcnJheS5wcm90b3R5cGUuc2xpY2UsVD1mLmV4cHIubWF0Y2guUE9TLFU9e2NoaWxkcmVuOiEwLGNvbnRlbnRzOiEwLG5leHQ6ITAscHJldjohMH07Zi5mbi5leHRlbmQoe2ZpbmQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcyxjLGQ7aWYodHlwZW9mIGEhPSJzdHJpbmciKXJldHVybiBmKGEpLmZpbHRlcihmdW5jdGlvbigpe2ZvcihjPTAsZD1iLmxlbmd0aDtjPGQ7YysrKWlmKGYuY29udGFpbnMoYltjXSx0aGlzKSlyZXR1cm4hMH0pO3ZhciBlPXRoaXMucHVzaFN0YWNrKCIiLCJmaW5kIixhKSxnLGgsaTtmb3IoYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKyl7Zz1lLmxlbmd0aCxmLmZpbmQoYSx0aGlzW2NdLGUpO2lmKGM+MClmb3IoaD1nO2g8ZS5sZW5ndGg7aCsrKWZvcihpPTA7aTxnO2krKylpZihlW2ldPT09ZVtoXSl7ZS5zcGxpY2UoaC0tLDEpO2JyZWFrfX1yZXR1cm4gZX0saGFzOmZ1bmN0aW9uKGEpe3ZhciBiPWYoYSk7cmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKCl7Zm9yKHZhciBhPTAsYz1iLmxlbmd0aDthPGM7YSsrKWlmKGYuY29udGFpbnModGhpcyxiW2FdKSlyZXR1cm4hMH0pfSxub3Q6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKFcodGhpcyxhLCExKSwibm90IixhKX0sZmlsdGVyOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnB1c2hTdGFjayhXKHRoaXMsYSwhMCksImZpbHRlciIsYSl9LGlzOmZ1bmN0aW9uKGEpe3JldHVybiEhYSYmKHR5cGVvZiBhPT0ic3RyaW5nIj9mLmZpbHRlcihhLHRoaXMpLmxlbmd0aD4wOnRoaXMuZmlsdGVyKGEpLmxlbmd0aD4wKX0sY2xvc2VzdDpmdW5jdGlvbihhLGIpe3ZhciBjPVtdLGQsZSxnPXRoaXNbMF07aWYoZi5pc0FycmF5KGEpKXt2YXIgaCxpLGo9e30saz0xO2lmKGcmJmEubGVuZ3RoKXtmb3IoZD0wLGU9YS5sZW5ndGg7ZDxlO2QrKylpPWFbZF0saltpXXx8KGpbaV09VC50ZXN0KGkpP2YoaSxifHx0aGlzLmNvbnRleHQpOmkpO3doaWxlKGcmJmcub3duZXJEb2N1bWVudCYmZyE9PWIpe2ZvcihpIGluIGopaD1qW2ldLChoLmpxdWVyeT9oLmluZGV4KGcpPi0xOmYoZykuaXMoaCkpJiZjLnB1c2goe3NlbGVjdG9yOmksZWxlbTpnLGxldmVsOmt9KTtnPWcucGFyZW50Tm9kZSxrKyt9fXJldHVybiBjfXZhciBsPVQudGVzdChhKXx8dHlwZW9mIGEhPSJzdHJpbmciP2YoYSxifHx0aGlzLmNvbnRleHQpOjA7Zm9yKGQ9MCxlPXRoaXMubGVuZ3RoO2Q8ZTtkKyspe2c9dGhpc1tkXTt3aGlsZShnKXtpZihsP2wuaW5kZXgoZyk+LTE6Zi5maW5kLm1hdGNoZXNTZWxlY3RvcihnLGEpKXtjLnB1c2goZyk7YnJlYWt9Zz1nLnBhcmVudE5vZGU7aWYoIWd8fCFnLm93bmVyRG9jdW1lbnR8fGc9PT1ifHxnLm5vZGVUeXBlPT09MTEpYnJlYWt9fWM9Yy5sZW5ndGg+MT9mLnVuaXF1ZShjKTpjO3JldHVybiB0aGlzLnB1c2hTdGFjayhjLCJjbG9zZXN0IixhKX0saW5kZXg6ZnVuY3Rpb24oYSl7aWYoIWF8fHR5cGVvZiBhPT0ic3RyaW5nIilyZXR1cm4gZi5pbkFycmF5KHRoaXNbMF0sYT9mKGEpOnRoaXMucGFyZW50KCkuY2hpbGRyZW4oKSk7cmV0dXJuIGYuaW5BcnJheShhLmpxdWVyeT9hWzBdOmEsdGhpcyl9LGFkZDpmdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBhPT0ic3RyaW5nIj9mKGEsYik6Zi5tYWtlQXJyYXkoYSYmYS5ub2RlVHlwZT9bYV06YSksZD1mLm1lcmdlKHRoaXMuZ2V0KCksYyk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKFYoY1swXSl8fFYoZFswXSk/ZDpmLnVuaXF1ZShkKSl9LGFuZFNlbGY6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hZGQodGhpcy5wcmV2T2JqZWN0KX19KSxmLmVhY2goe3BhcmVudDpmdW5jdGlvbihhKXt2YXIgYj1hLnBhcmVudE5vZGU7cmV0dXJuIGImJmIubm9kZVR5cGUhPT0xMT9iOm51bGx9LHBhcmVudHM6ZnVuY3Rpb24oYSl7cmV0dXJuIGYuZGlyKGEsInBhcmVudE5vZGUiKX0scGFyZW50c1VudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZi5kaXIoYSwicGFyZW50Tm9kZSIsYyl9LG5leHQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGYubnRoKGEsMiwibmV4dFNpYmxpbmciKX0scHJldjpmdW5jdGlvbihhKXtyZXR1cm4gZi5udGgoYSwyLCJwcmV2aW91c1NpYmxpbmciKX0sbmV4dEFsbDpmdW5jdGlvbihhKXtyZXR1cm4gZi5kaXIoYSwibmV4dFNpYmxpbmciKX0scHJldkFsbDpmdW5jdGlvbihhKXtyZXR1cm4gZi5kaXIoYSwicHJldmlvdXNTaWJsaW5nIil9LG5leHRVbnRpbDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZGlyKGEsIm5leHRTaWJsaW5nIixjKX0scHJldlVudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZi5kaXIoYSwicHJldmlvdXNTaWJsaW5nIixjKX0sc2libGluZ3M6ZnVuY3Rpb24oYSl7cmV0dXJuIGYuc2libGluZyhhLnBhcmVudE5vZGUuZmlyc3RDaGlsZCxhKX0sY2hpbGRyZW46ZnVuY3Rpb24oYSl7cmV0dXJuIGYuc2libGluZyhhLmZpcnN0Q2hpbGQpfSxjb250ZW50czpmdW5jdGlvbihhKXtyZXR1cm4gZi5ub2RlTmFtZShhLCJpZnJhbWUiKT9hLmNvbnRlbnREb2N1bWVudHx8YS5jb250ZW50V2luZG93LmRvY3VtZW50OmYubWFrZUFycmF5KGEuY2hpbGROb2Rlcyl9fSxmdW5jdGlvbihhLGIpe2YuZm5bYV09ZnVuY3Rpb24oYyxkKXt2YXIgZT1mLm1hcCh0aGlzLGIsYyksZz1TLmNhbGwoYXJndW1lbnRzKTtPLnRlc3QoYSl8fChkPWMpLGQmJnR5cGVvZiBkPT0ic3RyaW5nIiYmKGU9Zi5maWx0ZXIoZCxlKSksZT10aGlzLmxlbmd0aD4xJiYhVVthXT9mLnVuaXF1ZShlKTplLCh0aGlzLmxlbmd0aD4xfHxRLnRlc3QoZCkpJiZQLnRlc3QoYSkmJihlPWUucmV2ZXJzZSgpKTtyZXR1cm4gdGhpcy5wdXNoU3RhY2soZSxhLGcuam9pbigiLCIpKX19KSxmLmV4dGVuZCh7ZmlsdGVyOmZ1bmN0aW9uKGEsYixjKXtjJiYoYT0iOm5vdCgiK2ErIikiKTtyZXR1cm4gYi5sZW5ndGg9PT0xP2YuZmluZC5tYXRjaGVzU2VsZWN0b3IoYlswXSxhKT9bYlswXV06W106Zi5maW5kLm1hdGNoZXMoYSxiKX0sZGlyOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZT1bXSxnPWFbY107d2hpbGUoZyYmZy5ub2RlVHlwZSE9PTkmJihkPT09Ynx8Zy5ub2RlVHlwZSE9PTF8fCFmKGcpLmlzKGQpKSlnLm5vZGVUeXBlPT09MSYmZS5wdXNoKGcpLGc9Z1tjXTtyZXR1cm4gZX0sbnRoOmZ1bmN0aW9uKGEsYixjLGQpe2I9Ynx8MTt2YXIgZT0wO2Zvcig7YTthPWFbY10paWYoYS5ub2RlVHlwZT09PTEmJisrZT09PWIpYnJlYWs7cmV0dXJuIGF9LHNpYmxpbmc6ZnVuY3Rpb24oYSxiKXt2YXIgYz1bXTtmb3IoO2E7YT1hLm5leHRTaWJsaW5nKWEubm9kZVR5cGU9PT0xJiZhIT09YiYmYy5wdXNoKGEpO3JldHVybiBjfX0pO3ZhciBYPS8galF1ZXJ5XGQrPSIoPzpcZCt8bnVsbCkiL2csWT0vXlxzKy8sWj0vPCg/IWFyZWF8YnJ8Y29sfGVtYmVkfGhyfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW0pKChbXHc6XSspW14+XSopXC8+L2lnLCQ9LzwoW1x3Ol0rKS8sXz0vPHRib2R5L2ksYmE9Lzx8JiM/XHcrOy8sYmI9LzwoPzpzY3JpcHR8b2JqZWN0fGVtYmVkfG9wdGlvbnxzdHlsZSkvaSxiYz0vY2hlY2tlZFxzKig/OltePV18PVxzKi5jaGVja2VkLikvaSxiZD0vXC8oamF2YXxlY21hKXNjcmlwdC9pLGJlPS9eXHMqPCEoPzpcW0NEQVRBXFt8XC1cLSkvLGJmPXtvcHRpb246WzEsIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCI8L3NlbGVjdD4iXSxsZWdlbmQ6WzEsIjxmaWVsZHNldD4iLCI8L2ZpZWxkc2V0PiJdLHRoZWFkOlsxLCI8dGFibGU+IiwiPC90YWJsZT4iXSx0cjpbMiwiPHRhYmxlPjx0Ym9keT4iLCI8L3Rib2R5PjwvdGFibGU+Il0sdGQ6WzMsIjx0YWJsZT48dGJvZHk+PHRyPiIsIjwvdHI+PC90Ym9keT48L3RhYmxlPiJdLGNvbDpbMiwiPHRhYmxlPjx0Ym9keT48L3Rib2R5Pjxjb2xncm91cD4iLCI8L2NvbGdyb3VwPjwvdGFibGU+Il0sYXJlYTpbMSwiPG1hcD4iLCI8L21hcD4iXSxfZGVmYXVsdDpbMCwiIiwiIl19O2JmLm9wdGdyb3VwPWJmLm9wdGlvbixiZi50Ym9keT1iZi50Zm9vdD1iZi5jb2xncm91cD1iZi5jYXB0aW9uPWJmLnRoZWFkLGJmLnRoPWJmLnRkLGYuc3VwcG9ydC5odG1sU2VyaWFsaXplfHwoYmYuX2RlZmF1bHQ9WzEsImRpdjxkaXY+IiwiPC9kaXY+Il0pLGYuZm4uZXh0ZW5kKHt0ZXh0OmZ1bmN0aW9uKGEpe2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWYodGhpcyk7Yy50ZXh0KGEuY2FsbCh0aGlzLGIsYy50ZXh0KCkpKX0pO2lmKHR5cGVvZiBhIT0ib2JqZWN0IiYmYSE9PWIpcmV0dXJuIHRoaXMuZW1wdHkoKS5hcHBlbmQoKHRoaXNbMF0mJnRoaXNbMF0ub3duZXJEb2N1bWVudHx8YykuY3JlYXRlVGV4dE5vZGUoYSkpO3JldHVybiBmLnRleHQodGhpcyl9LHdyYXBBbGw6ZnVuY3Rpb24oYSl7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zih0aGlzKS53cmFwQWxsKGEuY2FsbCh0aGlzLGIpKX0pO2lmKHRoaXNbMF0pe3ZhciBiPWYoYSx0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKCEwKTt0aGlzWzBdLnBhcmVudE5vZGUmJmIuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pLGIubWFwKGZ1bmN0aW9uKCl7dmFyIGE9dGhpczt3aGlsZShhLmZpcnN0Q2hpbGQmJmEuZmlyc3RDaGlsZC5ub2RlVHlwZT09PTEpYT1hLmZpcnN0Q2hpbGQ7cmV0dXJuIGF9KS5hcHBlbmQodGhpcyl9cmV0dXJuIHRoaXN9LHdyYXBJbm5lcjpmdW5jdGlvbihhKXtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmKHRoaXMpLndyYXBJbm5lcihhLmNhbGwodGhpcyxiKSl9KTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9Zih0aGlzKSxjPWIuY29udGVudHMoKTtjLmxlbmd0aD9jLndyYXBBbGwoYSk6Yi5hcHBlbmQoYSl9KX0sd3JhcDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zih0aGlzKS53cmFwQWxsKGEpfSl9LHVud3JhcDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnBhcmVudCgpLmVhY2goZnVuY3Rpb24oKXtmLm5vZGVOYW1lKHRoaXMsImJvZHkiKXx8Zih0aGlzKS5yZXBsYWNlV2l0aCh0aGlzLmNoaWxkTm9kZXMpfSkuZW5kKCl9LGFwcGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMCxmdW5jdGlvbihhKXt0aGlzLm5vZGVUeXBlPT09MSYmdGhpcy5hcHBlbmRDaGlsZChhKX0pfSxwcmVwZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCEwLGZ1bmN0aW9uKGEpe3RoaXMubm9kZVR5cGU9PT0xJiZ0aGlzLmluc2VydEJlZm9yZShhLHRoaXMuZmlyc3RDaGlsZCl9KX0sYmVmb3JlOmZ1bmN0aW9uKCl7aWYodGhpc1swXSYmdGhpc1swXS5wYXJlbnROb2RlKXJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMSxmdW5jdGlvbihhKXt0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsdGhpcyl9KTtpZihhcmd1bWVudHMubGVuZ3RoKXt2YXIgYT1mKGFyZ3VtZW50c1swXSk7YS5wdXNoLmFwcGx5KGEsdGhpcy50b0FycmF5KCkpO3JldHVybiB0aGlzLnB1c2hTdGFjayhhLCJiZWZvcmUiLGFyZ3VtZW50cyl9fSxhZnRlcjpmdW5jdGlvbigpe2lmKHRoaXNbMF0mJnRoaXNbMF0ucGFyZW50Tm9kZSlyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITEsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLHRoaXMubmV4dFNpYmxpbmcpfSk7aWYoYXJndW1lbnRzLmxlbmd0aCl7dmFyIGE9dGhpcy5wdXNoU3RhY2sodGhpcywiYWZ0ZXIiLGFyZ3VtZW50cyk7YS5wdXNoLmFwcGx5KGEsZihhcmd1bWVudHNbMF0pLnRvQXJyYXkoKSk7cmV0dXJuIGF9fSxyZW1vdmU6ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9MCxkOyhkPXRoaXNbY10pIT1udWxsO2MrKylpZighYXx8Zi5maWx0ZXIoYSxbZF0pLmxlbmd0aCkhYiYmZC5ub2RlVHlwZT09PTEmJihmLmNsZWFuRGF0YShkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikpLGYuY2xlYW5EYXRhKFtkXSkpLGQucGFyZW50Tm9kZSYmZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGQpO3JldHVybiB0aGlzfSxlbXB0eTpmdW5jdGlvbigpe2Zvcih2YXIgYT0wLGI7KGI9dGhpc1thXSkhPW51bGw7YSsrKXtiLm5vZGVUeXBlPT09MSYmZi5jbGVhbkRhdGEoYi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpKTt3aGlsZShiLmZpcnN0Q2hpbGQpYi5yZW1vdmVDaGlsZChiLmZpcnN0Q2hpbGQpfXJldHVybiB0aGlzfSxjbG9uZTpmdW5jdGlvbihhLGIpe2E9YT09bnVsbD8hMTphLGI9Yj09bnVsbD9hOmI7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIGYuY2xvbmUodGhpcyxhLGIpfSl9LGh0bWw6ZnVuY3Rpb24oYSl7aWYoYT09PWIpcmV0dXJuIHRoaXNbMF0mJnRoaXNbMF0ubm9kZVR5cGU9PT0xP3RoaXNbMF0uaW5uZXJIVE1MLnJlcGxhY2UoWCwiIik6bnVsbDtpZih0eXBlb2YgYT09InN0cmluZyImJiFiYi50ZXN0KGEpJiYoZi5zdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlfHwhWS50ZXN0KGEpKSYmIWJmWygkLmV4ZWMoYSl8fFsiIiwiIl0pWzFdLnRvTG93ZXJDYXNlKCldKXthPWEucmVwbGFjZShaLCI8JDE+PC8kMj4iKTt0cnl7Zm9yKHZhciBjPTAsZD10aGlzLmxlbmd0aDtjPGQ7YysrKXRoaXNbY10ubm9kZVR5cGU9PT0xJiYoZi5jbGVhbkRhdGEodGhpc1tjXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpKSx0aGlzW2NdLmlubmVySFRNTD1hKX1jYXRjaChlKXt0aGlzLmVtcHR5KCkuYXBwZW5kKGEpfX1lbHNlIGYuaXNGdW5jdGlvbihhKT90aGlzLmVhY2goZnVuY3Rpb24oYil7dmFyIGM9Zih0aGlzKTtjLmh0bWwoYS5jYWxsKHRoaXMsYixjLmh0bWwoKSkpfSk6dGhpcy5lbXB0eSgpLmFwcGVuZChhKTtyZXR1cm4gdGhpc30scmVwbGFjZVdpdGg6ZnVuY3Rpb24oYSl7aWYodGhpc1swXSYmdGhpc1swXS5wYXJlbnROb2RlKXtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXt2YXIgYz1mKHRoaXMpLGQ9Yy5odG1sKCk7Yy5yZXBsYWNlV2l0aChhLmNhbGwodGhpcyxiLGQpKX0pO3R5cGVvZiBhIT0ic3RyaW5nIiYmKGE9ZihhKS5kZXRhY2goKSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPXRoaXMubmV4dFNpYmxpbmcsYz10aGlzLnBhcmVudE5vZGU7Zih0aGlzKS5yZW1vdmUoKSxiP2YoYikuYmVmb3JlKGEpOmYoYykuYXBwZW5kKGEpfSl9cmV0dXJuIHRoaXMubGVuZ3RoP3RoaXMucHVzaFN0YWNrKGYoZi5pc0Z1bmN0aW9uKGEpP2EoKTphKSwicmVwbGFjZVdpdGgiLGEpOnRoaXN9LGRldGFjaDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5yZW1vdmUoYSwhMCl9LGRvbU1hbmlwOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZSxnLGgsaSxqPWFbMF0saz1bXTtpZighZi5zdXBwb3J0LmNoZWNrQ2xvbmUmJmFyZ3VtZW50cy5sZW5ndGg9PT0zJiZ0eXBlb2Ygaj09InN0cmluZyImJmJjLnRlc3QoaikpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YodGhpcykuZG9tTWFuaXAoYSxjLGQsITApfSk7aWYoZi5pc0Z1bmN0aW9uKGopKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZSl7dmFyIGc9Zih0aGlzKTthWzBdPWouY2FsbCh0aGlzLGUsYz9nLmh0bWwoKTpiKSxnLmRvbU1hbmlwKGEsYyxkKX0pO2lmKHRoaXNbMF0pe2k9aiYmai5wYXJlbnROb2RlLGYuc3VwcG9ydC5wYXJlbnROb2RlJiZpJiZpLm5vZGVUeXBlPT09MTEmJmkuY2hpbGROb2Rlcy5sZW5ndGg9PT10aGlzLmxlbmd0aD9lPXtmcmFnbWVudDppfTplPWYuYnVpbGRGcmFnbWVudChhLHRoaXMsayksaD1lLmZyYWdtZW50LGguY2hpbGROb2Rlcy5sZW5ndGg9PT0xP2c9aD1oLmZpcnN0Q2hpbGQ6Zz1oLmZpcnN0Q2hpbGQ7aWYoZyl7Yz1jJiZmLm5vZGVOYW1lKGcsInRyIik7Zm9yKHZhciBsPTAsbT10aGlzLmxlbmd0aCxuPW0tMTtsPG07bCsrKWQuY2FsbChjP2JnKHRoaXNbbF0sZyk6dGhpc1tsXSxlLmNhY2hlYWJsZXx8bT4xJiZsPG4/Zi5jbG9uZShoLCEwLCEwKTpoKX1rLmxlbmd0aCYmZi5lYWNoKGssYm0pfXJldHVybiB0aGlzfX0pLGYuYnVpbGRGcmFnbWVudD1mdW5jdGlvbihhLGIsZCl7dmFyIGUsZyxoLGk7YiYmYlswXSYmKGk9YlswXS5vd25lckRvY3VtZW50fHxiWzBdKSxpLmNyZWF0ZURvY3VtZW50RnJhZ21lbnR8fChpPWMpLGEubGVuZ3RoPT09MSYmdHlwZW9mIGFbMF09PSJzdHJpbmciJiZhWzBdLmxlbmd0aDw1MTImJmk9PT1jJiZhWzBdLmNoYXJBdCgwKT09PSI8IiYmIWJiLnRlc3QoYVswXSkmJihmLnN1cHBvcnQuY2hlY2tDbG9uZXx8IWJjLnRlc3QoYVswXSkpJiYoZz0hMCxoPWYuZnJhZ21lbnRzW2FbMF1dLGgmJmghPT0xJiYoZT1oKSksZXx8KGU9aS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksZi5jbGVhbihhLGksZSxkKSksZyYmKGYuZnJhZ21lbnRzW2FbMF1dPWg/ZToxKTtyZXR1cm57ZnJhZ21lbnQ6ZSxjYWNoZWFibGU6Z319LGYuZnJhZ21lbnRzPXt9LGYuZWFjaCh7YXBwZW5kVG86ImFwcGVuZCIscHJlcGVuZFRvOiJwcmVwZW5kIixpbnNlcnRCZWZvcmU6ImJlZm9yZSIsaW5zZXJ0QWZ0ZXI6ImFmdGVyIixyZXBsYWNlQWxsOiJyZXBsYWNlV2l0aCJ9LGZ1bmN0aW9uKGEsYil7Zi5mblthXT1mdW5jdGlvbihjKXt2YXIgZD1bXSxlPWYoYyksZz10aGlzLmxlbmd0aD09PTEmJnRoaXNbMF0ucGFyZW50Tm9kZTtpZihnJiZnLm5vZGVUeXBlPT09MTEmJmcuY2hpbGROb2Rlcy5sZW5ndGg9PT0xJiZlLmxlbmd0aD09PTEpe2VbYl0odGhpc1swXSk7cmV0dXJuIHRoaXN9Zm9yKHZhciBoPTAsaT1lLmxlbmd0aDtoPGk7aCsrKXt2YXIgaj0oaD4wP3RoaXMuY2xvbmUoITApOnRoaXMpLmdldCgpO2YoZVtoXSlbYl0oaiksZD1kLmNvbmNhdChqCil9cmV0dXJuIHRoaXMucHVzaFN0YWNrKGQsYSxlLnNlbGVjdG9yKX19KSxmLmV4dGVuZCh7Y2xvbmU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWEuY2xvbmVOb2RlKCEwKSxlLGcsaDtpZigoIWYuc3VwcG9ydC5ub0Nsb25lRXZlbnR8fCFmLnN1cHBvcnQubm9DbG9uZUNoZWNrZWQpJiYoYS5ub2RlVHlwZT09PTF8fGEubm9kZVR5cGU9PT0xMSkmJiFmLmlzWE1MRG9jKGEpKXtiaShhLGQpLGU9YmooYSksZz1iaihkKTtmb3IoaD0wO2VbaF07KytoKWJpKGVbaF0sZ1toXSl9aWYoYil7YmgoYSxkKTtpZihjKXtlPWJqKGEpLGc9YmooZCk7Zm9yKGg9MDtlW2hdOysraCliaChlW2hdLGdbaF0pfX1lPWc9bnVsbDtyZXR1cm4gZH0sY2xlYW46ZnVuY3Rpb24oYSxiLGQsZSl7dmFyIGc7Yj1ifHxjLHR5cGVvZiBiLmNyZWF0ZUVsZW1lbnQ9PSJ1bmRlZmluZWQiJiYoYj1iLm93bmVyRG9jdW1lbnR8fGJbMF0mJmJbMF0ub3duZXJEb2N1bWVudHx8Yyk7dmFyIGg9W10saTtmb3IodmFyIGo9MCxrOyhrPWFbal0pIT1udWxsO2orKyl7dHlwZW9mIGs9PSJudW1iZXIiJiYoays9IiIpO2lmKCFrKWNvbnRpbnVlO2lmKHR5cGVvZiBrPT0ic3RyaW5nIilpZighYmEudGVzdChrKSlrPWIuY3JlYXRlVGV4dE5vZGUoayk7ZWxzZXtrPWsucmVwbGFjZShaLCI8JDE+PC8kMj4iKTt2YXIgbD0oJC5leGVjKGspfHxbIiIsIiJdKVsxXS50b0xvd2VyQ2FzZSgpLG09YmZbbF18fGJmLl9kZWZhdWx0LG49bVswXSxvPWIuY3JlYXRlRWxlbWVudCgiZGl2Iik7by5pbm5lckhUTUw9bVsxXStrK21bMl07d2hpbGUobi0tKW89by5sYXN0Q2hpbGQ7aWYoIWYuc3VwcG9ydC50Ym9keSl7dmFyIHA9Xy50ZXN0KGspLHE9bD09PSJ0YWJsZSImJiFwP28uZmlyc3RDaGlsZCYmby5maXJzdENoaWxkLmNoaWxkTm9kZXM6bVsxXT09PSI8dGFibGU+IiYmIXA/by5jaGlsZE5vZGVzOltdO2ZvcihpPXEubGVuZ3RoLTE7aT49MDstLWkpZi5ub2RlTmFtZShxW2ldLCJ0Ym9keSIpJiYhcVtpXS5jaGlsZE5vZGVzLmxlbmd0aCYmcVtpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHFbaV0pfSFmLnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UmJlkudGVzdChrKSYmby5pbnNlcnRCZWZvcmUoYi5jcmVhdGVUZXh0Tm9kZShZLmV4ZWMoaylbMF0pLG8uZmlyc3RDaGlsZCksaz1vLmNoaWxkTm9kZXN9dmFyIHI7aWYoIWYuc3VwcG9ydC5hcHBlbmRDaGVja2VkKWlmKGtbMF0mJnR5cGVvZiAocj1rLmxlbmd0aCk9PSJudW1iZXIiKWZvcihpPTA7aTxyO2krKylibChrW2ldKTtlbHNlIGJsKGspO2subm9kZVR5cGU/aC5wdXNoKGspOmg9Zi5tZXJnZShoLGspfWlmKGQpe2c9ZnVuY3Rpb24oYSl7cmV0dXJuIWEudHlwZXx8YmQudGVzdChhLnR5cGUpfTtmb3Ioaj0wO2hbal07aisrKWlmKGUmJmYubm9kZU5hbWUoaFtqXSwic2NyaXB0IikmJighaFtqXS50eXBlfHxoW2pdLnR5cGUudG9Mb3dlckNhc2UoKT09PSJ0ZXh0L2phdmFzY3JpcHQiKSllLnB1c2goaFtqXS5wYXJlbnROb2RlP2hbal0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChoW2pdKTpoW2pdKTtlbHNle2lmKGhbal0ubm9kZVR5cGU9PT0xKXt2YXIgcz1mLmdyZXAoaFtqXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IiksZyk7aC5zcGxpY2UuYXBwbHkoaCxbaisxLDBdLmNvbmNhdChzKSl9ZC5hcHBlbmRDaGlsZChoW2pdKX19cmV0dXJuIGh9LGNsZWFuRGF0YTpmdW5jdGlvbihhKXt2YXIgYixjLGQ9Zi5jYWNoZSxlPWYuZXhwYW5kbyxnPWYuZXZlbnQuc3BlY2lhbCxoPWYuc3VwcG9ydC5kZWxldGVFeHBhbmRvO2Zvcih2YXIgaT0wLGo7KGo9YVtpXSkhPW51bGw7aSsrKXtpZihqLm5vZGVOYW1lJiZmLm5vRGF0YVtqLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKWNvbnRpbnVlO2M9altmLmV4cGFuZG9dO2lmKGMpe2I9ZFtjXSYmZFtjXVtlXTtpZihiJiZiLmV2ZW50cyl7Zm9yKHZhciBrIGluIGIuZXZlbnRzKWdba10/Zi5ldmVudC5yZW1vdmUoaixrKTpmLnJlbW92ZUV2ZW50KGosayxiLmhhbmRsZSk7Yi5oYW5kbGUmJihiLmhhbmRsZS5lbGVtPW51bGwpfWg/ZGVsZXRlIGpbZi5leHBhbmRvXTpqLnJlbW92ZUF0dHJpYnV0ZSYmai5yZW1vdmVBdHRyaWJ1dGUoZi5leHBhbmRvKSxkZWxldGUgZFtjXX19fX0pO3ZhciBibj0vYWxwaGFcKFteKV0qXCkvaSxibz0vb3BhY2l0eT0oW14pXSopLyxicD0vKFtBLVpdfF5tcykvZyxicT0vXi0/XGQrKD86cHgpPyQvaSxicj0vXi0/XGQvLGJzPS9eWytcLV09LyxidD0vW14rXC1cLlxkZV0rL2csYnU9e3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdmlzaWJpbGl0eToiaGlkZGVuIixkaXNwbGF5OiJibG9jayJ9LGJ2PVsiTGVmdCIsIlJpZ2h0Il0sYnc9WyJUb3AiLCJCb3R0b20iXSxieCxieSxiejtmLmZuLmNzcz1mdW5jdGlvbihhLGMpe2lmKGFyZ3VtZW50cy5sZW5ndGg9PT0yJiZjPT09YilyZXR1cm4gdGhpcztyZXR1cm4gZi5hY2Nlc3ModGhpcyxhLGMsITAsZnVuY3Rpb24oYSxjLGQpe3JldHVybiBkIT09Yj9mLnN0eWxlKGEsYyxkKTpmLmNzcyhhLGMpfSl9LGYuZXh0ZW5kKHtjc3NIb29rczp7b3BhY2l0eTp7Z2V0OmZ1bmN0aW9uKGEsYil7aWYoYil7dmFyIGM9YngoYSwib3BhY2l0eSIsIm9wYWNpdHkiKTtyZXR1cm4gYz09PSIiPyIxIjpjfXJldHVybiBhLnN0eWxlLm9wYWNpdHl9fX0sY3NzTnVtYmVyOntmaWxsT3BhY2l0eTohMCxmb250V2VpZ2h0OiEwLGxpbmVIZWlnaHQ6ITAsb3BhY2l0eTohMCxvcnBoYW5zOiEwLHdpZG93czohMCx6SW5kZXg6ITAsem9vbTohMH0sY3NzUHJvcHM6eyJmbG9hdCI6Zi5zdXBwb3J0LmNzc0Zsb2F0PyJjc3NGbG9hdCI6InN0eWxlRmxvYXQifSxzdHlsZTpmdW5jdGlvbihhLGMsZCxlKXtpZighIWEmJmEubm9kZVR5cGUhPT0zJiZhLm5vZGVUeXBlIT09OCYmISFhLnN0eWxlKXt2YXIgZyxoLGk9Zi5jYW1lbENhc2UoYyksaj1hLnN0eWxlLGs9Zi5jc3NIb29rc1tpXTtjPWYuY3NzUHJvcHNbaV18fGk7aWYoZD09PWIpe2lmKGsmJiJnZXQiaW4gayYmKGc9ay5nZXQoYSwhMSxlKSkhPT1iKXJldHVybiBnO3JldHVybiBqW2NdfWg9dHlwZW9mIGQ7aWYoaD09PSJudW1iZXIiJiZpc05hTihkKXx8ZD09bnVsbClyZXR1cm47aD09PSJzdHJpbmciJiZicy50ZXN0KGQpJiYoZD0rZC5yZXBsYWNlKGJ0LCIiKStwYXJzZUZsb2F0KGYuY3NzKGEsYykpLGg9Im51bWJlciIpLGg9PT0ibnVtYmVyIiYmIWYuY3NzTnVtYmVyW2ldJiYoZCs9InB4Iik7aWYoIWt8fCEoInNldCJpbiBrKXx8KGQ9ay5zZXQoYSxkKSkhPT1iKXRyeXtqW2NdPWR9Y2F0Y2gobCl7fX19LGNzczpmdW5jdGlvbihhLGMsZCl7dmFyIGUsZztjPWYuY2FtZWxDYXNlKGMpLGc9Zi5jc3NIb29rc1tjXSxjPWYuY3NzUHJvcHNbY118fGMsYz09PSJjc3NGbG9hdCImJihjPSJmbG9hdCIpO2lmKGcmJiJnZXQiaW4gZyYmKGU9Zy5nZXQoYSwhMCxkKSkhPT1iKXJldHVybiBlO2lmKGJ4KXJldHVybiBieChhLGMpfSxzd2FwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD17fTtmb3IodmFyIGUgaW4gYilkW2VdPWEuc3R5bGVbZV0sYS5zdHlsZVtlXT1iW2VdO2MuY2FsbChhKTtmb3IoZSBpbiBiKWEuc3R5bGVbZV09ZFtlXX19KSxmLmN1ckNTUz1mLmNzcyxmLmVhY2goWyJoZWlnaHQiLCJ3aWR0aCJdLGZ1bmN0aW9uKGEsYil7Zi5jc3NIb29rc1tiXT17Z2V0OmZ1bmN0aW9uKGEsYyxkKXt2YXIgZTtpZihjKXtpZihhLm9mZnNldFdpZHRoIT09MClyZXR1cm4gYkEoYSxiLGQpO2Yuc3dhcChhLGJ1LGZ1bmN0aW9uKCl7ZT1iQShhLGIsZCl9KTtyZXR1cm4gZX19LHNldDpmdW5jdGlvbihhLGIpe2lmKCFicS50ZXN0KGIpKXJldHVybiBiO2I9cGFyc2VGbG9hdChiKTtpZihiPj0wKXJldHVybiBiKyJweCJ9fX0pLGYuc3VwcG9ydC5vcGFjaXR5fHwoZi5jc3NIb29rcy5vcGFjaXR5PXtnZXQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYm8udGVzdCgoYiYmYS5jdXJyZW50U3R5bGU/YS5jdXJyZW50U3R5bGUuZmlsdGVyOmEuc3R5bGUuZmlsdGVyKXx8IiIpP3BhcnNlRmxvYXQoUmVnRXhwLiQxKS8xMDArIiI6Yj8iMSI6IiJ9LHNldDpmdW5jdGlvbihhLGIpe3ZhciBjPWEuc3R5bGUsZD1hLmN1cnJlbnRTdHlsZTtjLnpvb209MTt2YXIgZT1mLmlzTmFOKGIpPyIiOiJhbHBoYShvcGFjaXR5PSIrYioxMDArIikiLGc9ZCYmZC5maWx0ZXJ8fGMuZmlsdGVyfHwiIjtjLmZpbHRlcj1ibi50ZXN0KGcpP2cucmVwbGFjZShibixlKTpnKyIgIitlfX0pLGYoZnVuY3Rpb24oKXtmLnN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodHx8KGYuY3NzSG9va3MubWFyZ2luUmlnaHQ9e2dldDpmdW5jdGlvbihhLGIpe3ZhciBjO2Yuc3dhcChhLHtkaXNwbGF5OiJpbmxpbmUtYmxvY2sifSxmdW5jdGlvbigpe2I/Yz1ieChhLCJtYXJnaW4tcmlnaHQiLCJtYXJnaW5SaWdodCIpOmM9YS5zdHlsZS5tYXJnaW5SaWdodH0pO3JldHVybiBjfX0pfSksYy5kZWZhdWx0VmlldyYmYy5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlJiYoYnk9ZnVuY3Rpb24oYSxjKXt2YXIgZCxlLGc7Yz1jLnJlcGxhY2UoYnAsIi0kMSIpLnRvTG93ZXJDYXNlKCk7aWYoIShlPWEub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldykpcmV0dXJuIGI7aWYoZz1lLmdldENvbXB1dGVkU3R5bGUoYSxudWxsKSlkPWcuZ2V0UHJvcGVydHlWYWx1ZShjKSxkPT09IiImJiFmLmNvbnRhaW5zKGEub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsYSkmJihkPWYuc3R5bGUoYSxjKSk7cmV0dXJuIGR9KSxjLmRvY3VtZW50RWxlbWVudC5jdXJyZW50U3R5bGUmJihiej1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9YS5jdXJyZW50U3R5bGUmJmEuY3VycmVudFN0eWxlW2JdLGU9YS5ydW50aW1lU3R5bGUmJmEucnVudGltZVN0eWxlW2JdLGY9YS5zdHlsZTshYnEudGVzdChkKSYmYnIudGVzdChkKSYmKGM9Zi5sZWZ0LGUmJihhLnJ1bnRpbWVTdHlsZS5sZWZ0PWEuY3VycmVudFN0eWxlLmxlZnQpLGYubGVmdD1iPT09ImZvbnRTaXplIj8iMWVtIjpkfHwwLGQ9Zi5waXhlbExlZnQrInB4IixmLmxlZnQ9YyxlJiYoYS5ydW50aW1lU3R5bGUubGVmdD1lKSk7cmV0dXJuIGQ9PT0iIj8iYXV0byI6ZH0pLGJ4PWJ5fHxieixmLmV4cHImJmYuZXhwci5maWx0ZXJzJiYoZi5leHByLmZpbHRlcnMuaGlkZGVuPWZ1bmN0aW9uKGEpe3ZhciBiPWEub2Zmc2V0V2lkdGgsYz1hLm9mZnNldEhlaWdodDtyZXR1cm4gYj09PTAmJmM9PT0wfHwhZi5zdXBwb3J0LnJlbGlhYmxlSGlkZGVuT2Zmc2V0cyYmKGEuc3R5bGUuZGlzcGxheXx8Zi5jc3MoYSwiZGlzcGxheSIpKT09PSJub25lIn0sZi5leHByLmZpbHRlcnMudmlzaWJsZT1mdW5jdGlvbihhKXtyZXR1cm4hZi5leHByLmZpbHRlcnMuaGlkZGVuKGEpfSk7dmFyIGJCPS8lMjAvZyxiQz0vXFtcXSQvLGJEPS9ccj9cbi9nLGJFPS8jLiokLyxiRj0vXiguKj8pOlsgXHRdKihbXlxyXG5dKilccj8kL21nLGJHPS9eKD86Y29sb3J8ZGF0ZXxkYXRldGltZXxlbWFpbHxoaWRkZW58bW9udGh8bnVtYmVyfHBhc3N3b3JkfHJhbmdlfHNlYXJjaHx0ZWx8dGV4dHx0aW1lfHVybHx3ZWVrKSQvaSxiSD0vXig/OmFib3V0fGFwcHxhcHBcLXN0b3JhZ2V8LitcLWV4dGVuc2lvbnxmaWxlfHdpZGdldCk6JC8sYkk9L14oPzpHRVR8SEVBRCkkLyxiSj0vXlwvXC8vLGJLPS9cPy8sYkw9LzxzY3JpcHRcYltePF0qKD86KD8hPFwvc2NyaXB0Pik8W148XSopKjxcL3NjcmlwdD4vZ2ksYk09L14oPzpzZWxlY3R8dGV4dGFyZWEpL2ksYk49L1xzKy8sYk89LyhbPyZdKV89W14mXSovLGJQPS9eKFtcd1wrXC5cLV0rOikoPzpcL1wvKFteXC8/IzpdKikoPzo6KFxkKykpPyk/LyxiUT1mLmZuLmxvYWQsYlI9e30sYlM9e30sYlQsYlU7dHJ5e2JUPWUuaHJlZn1jYXRjaChiVil7YlQ9Yy5jcmVhdGVFbGVtZW50KCJhIiksYlQuaHJlZj0iIixiVD1iVC5ocmVmfWJVPWJQLmV4ZWMoYlQudG9Mb3dlckNhc2UoKSl8fFtdLGYuZm4uZXh0ZW5kKHtsb2FkOmZ1bmN0aW9uKGEsYyxkKXtpZih0eXBlb2YgYSE9InN0cmluZyImJmJRKXJldHVybiBiUS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7aWYoIXRoaXMubGVuZ3RoKXJldHVybiB0aGlzO3ZhciBlPWEuaW5kZXhPZigiICIpO2lmKGU+PTApe3ZhciBnPWEuc2xpY2UoZSxhLmxlbmd0aCk7YT1hLnNsaWNlKDAsZSl9dmFyIGg9IkdFVCI7YyYmKGYuaXNGdW5jdGlvbihjKT8oZD1jLGM9Yik6dHlwZW9mIGM9PSJvYmplY3QiJiYoYz1mLnBhcmFtKGMsZi5hamF4U2V0dGluZ3MudHJhZGl0aW9uYWwpLGg9IlBPU1QiKSk7dmFyIGk9dGhpcztmLmFqYXgoe3VybDphLHR5cGU6aCxkYXRhVHlwZToiaHRtbCIsZGF0YTpjLGNvbXBsZXRlOmZ1bmN0aW9uKGEsYixjKXtjPWEucmVzcG9uc2VUZXh0LGEuaXNSZXNvbHZlZCgpJiYoYS5kb25lKGZ1bmN0aW9uKGEpe2M9YX0pLGkuaHRtbChnP2YoIjxkaXY+IikuYXBwZW5kKGMucmVwbGFjZShiTCwiIikpLmZpbmQoZyk6YykpLGQmJmkuZWFjaChkLFtjLGIsYV0pfX0pO3JldHVybiB0aGlzfSxzZXJpYWxpemU6ZnVuY3Rpb24oKXtyZXR1cm4gZi5wYXJhbSh0aGlzLnNlcmlhbGl6ZUFycmF5KCkpfSxzZXJpYWxpemVBcnJheTpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnRzP2YubWFrZUFycmF5KHRoaXMuZWxlbWVudHMpOnRoaXN9KS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5uYW1lJiYhdGhpcy5kaXNhYmxlZCYmKHRoaXMuY2hlY2tlZHx8Yk0udGVzdCh0aGlzLm5vZGVOYW1lKXx8YkcudGVzdCh0aGlzLnR5cGUpKX0pLm1hcChmdW5jdGlvbihhLGIpe3ZhciBjPWYodGhpcykudmFsKCk7cmV0dXJuIGM9PW51bGw/bnVsbDpmLmlzQXJyYXkoYyk/Zi5tYXAoYyxmdW5jdGlvbihhLGMpe3JldHVybntuYW1lOmIubmFtZSx2YWx1ZTphLnJlcGxhY2UoYkQsIlxyXG4iKX19KTp7bmFtZTpiLm5hbWUsdmFsdWU6Yy5yZXBsYWNlKGJELCJcclxuIil9fSkuZ2V0KCl9fSksZi5lYWNoKCJhamF4U3RhcnQgYWpheFN0b3AgYWpheENvbXBsZXRlIGFqYXhFcnJvciBhamF4U3VjY2VzcyBhamF4U2VuZCIuc3BsaXQoIiAiKSxmdW5jdGlvbihhLGIpe2YuZm5bYl09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuYmluZChiLGEpfX0pLGYuZWFjaChbImdldCIsInBvc3QiXSxmdW5jdGlvbihhLGMpe2ZbY109ZnVuY3Rpb24oYSxkLGUsZyl7Zi5pc0Z1bmN0aW9uKGQpJiYoZz1nfHxlLGU9ZCxkPWIpO3JldHVybiBmLmFqYXgoe3R5cGU6Yyx1cmw6YSxkYXRhOmQsc3VjY2VzczplLGRhdGFUeXBlOmd9KX19KSxmLmV4dGVuZCh7Z2V0U2NyaXB0OmZ1bmN0aW9uKGEsYyl7cmV0dXJuIGYuZ2V0KGEsYixjLCJzY3JpcHQiKX0sZ2V0SlNPTjpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZ2V0KGEsYixjLCJqc29uIil9LGFqYXhTZXR1cDpmdW5jdGlvbihhLGIpe2I/Zi5leHRlbmQoITAsYSxmLmFqYXhTZXR0aW5ncyxiKTooYj1hLGE9Zi5leHRlbmQoITAsZi5hamF4U2V0dGluZ3MsYikpO2Zvcih2YXIgYyBpbntjb250ZXh0OjEsdXJsOjF9KWMgaW4gYj9hW2NdPWJbY106YyBpbiBmLmFqYXhTZXR0aW5ncyYmKGFbY109Zi5hamF4U2V0dGluZ3NbY10pO3JldHVybiBhfSxhamF4U2V0dGluZ3M6e3VybDpiVCxpc0xvY2FsOmJILnRlc3QoYlVbMV0pLGdsb2JhbDohMCx0eXBlOiJHRVQiLGNvbnRlbnRUeXBlOiJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLHByb2Nlc3NEYXRhOiEwLGFzeW5jOiEwLGFjY2VwdHM6e3htbDoiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsaHRtbDoidGV4dC9odG1sIix0ZXh0OiJ0ZXh0L3BsYWluIixqc29uOiJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L2phdmFzY3JpcHQiLCIqIjoiKi8qIn0sY29udGVudHM6e3htbDoveG1sLyxodG1sOi9odG1sLyxqc29uOi9qc29uL30scmVzcG9uc2VGaWVsZHM6e3htbDoicmVzcG9uc2VYTUwiLHRleHQ6InJlc3BvbnNlVGV4dCJ9LGNvbnZlcnRlcnM6eyIqIHRleHQiOmEuU3RyaW5nLCJ0ZXh0IGh0bWwiOiEwLCJ0ZXh0IGpzb24iOmYucGFyc2VKU09OLCJ0ZXh0IHhtbCI6Zi5wYXJzZVhNTH19LGFqYXhQcmVmaWx0ZXI6YlcoYlIpLGFqYXhUcmFuc3BvcnQ6YlcoYlMpLGFqYXg6ZnVuY3Rpb24oYSxjKXtmdW5jdGlvbiB3KGEsYyxsLG0pe2lmKHMhPT0yKXtzPTIscSYmY2xlYXJUaW1lb3V0KHEpLHA9YixuPW18fCIiLHYucmVhZHlTdGF0ZT1hPzQ6MDt2YXIgbyxyLHUsdz1sP2JaKGQsdixsKTpiLHgseTtpZihhPj0yMDAmJmE8MzAwfHxhPT09MzA0KXtpZihkLmlmTW9kaWZpZWQpe2lmKHg9di5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpKWYubGFzdE1vZGlmaWVkW2tdPXg7aWYoeT12LmdldFJlc3BvbnNlSGVhZGVyKCJFdGFnIikpZi5ldGFnW2tdPXl9aWYoYT09PTMwNCljPSJub3Rtb2RpZmllZCIsbz0hMDtlbHNlIHRyeXtyPWIkKGQsdyksYz0ic3VjY2VzcyIsbz0hMH1jYXRjaCh6KXtjPSJwYXJzZXJlcnJvciIsdT16fX1lbHNle3U9YztpZighY3x8YSljPSJlcnJvciIsYTwwJiYoYT0wKX12LnN0YXR1cz1hLHYuc3RhdHVzVGV4dD1jLG8/aC5yZXNvbHZlV2l0aChlLFtyLGMsdl0pOmgucmVqZWN0V2l0aChlLFt2LGMsdV0pLHYuc3RhdHVzQ29kZShqKSxqPWIsdCYmZy50cmlnZ2VyKCJhamF4Iisobz8iU3VjY2VzcyI6IkVycm9yIiksW3YsZCxvP3I6dV0pLGkucmVzb2x2ZVdpdGgoZSxbdixjXSksdCYmKGcudHJpZ2dlcigiYWpheENvbXBsZXRlIixbdixkXSksLS1mLmFjdGl2ZXx8Zi5ldmVudC50cmlnZ2VyKCJhamF4U3RvcCIpKX19dHlwZW9mIGE9PSJvYmplY3QiJiYoYz1hLGE9YiksYz1jfHx7fTt2YXIgZD1mLmFqYXhTZXR1cCh7fSxjKSxlPWQuY29udGV4dHx8ZCxnPWUhPT1kJiYoZS5ub2RlVHlwZXx8ZSBpbnN0YW5jZW9mIGYpP2YoZSk6Zi5ldmVudCxoPWYuRGVmZXJyZWQoKSxpPWYuX0RlZmVycmVkKCksaj1kLnN0YXR1c0NvZGV8fHt9LGssbD17fSxtPXt9LG4sbyxwLHEscixzPTAsdCx1LHY9e3JlYWR5U3RhdGU6MCxzZXRSZXF1ZXN0SGVhZGVyOmZ1bmN0aW9uKGEsYil7aWYoIXMpe3ZhciBjPWEudG9Mb3dlckNhc2UoKTthPW1bY109bVtjXXx8YSxsW2FdPWJ9cmV0dXJuIHRoaXN9LGdldEFsbFJlc3BvbnNlSGVhZGVyczpmdW5jdGlvbigpe3JldHVybiBzPT09Mj9uOm51bGx9LGdldFJlc3BvbnNlSGVhZGVyOmZ1bmN0aW9uKGEpe3ZhciBjO2lmKHM9PT0yKXtpZighbyl7bz17fTt3aGlsZShjPWJGLmV4ZWMobikpb1tjWzFdLnRvTG93ZXJDYXNlKCldPWNbMl19Yz1vW2EudG9Mb3dlckNhc2UoKV19cmV0dXJuIGM9PT1iP251bGw6Y30sb3ZlcnJpZGVNaW1lVHlwZTpmdW5jdGlvbihhKXtzfHwoZC5taW1lVHlwZT1hKTtyZXR1cm4gdGhpc30sYWJvcnQ6ZnVuY3Rpb24oYSl7YT1hfHwiYWJvcnQiLHAmJnAuYWJvcnQoYSksdygwLGEpO3JldHVybiB0aGlzfX07aC5wcm9taXNlKHYpLHYuc3VjY2Vzcz12LmRvbmUsdi5lcnJvcj12LmZhaWwsdi5jb21wbGV0ZT1pLmRvbmUsdi5zdGF0dXNDb2RlPWZ1bmN0aW9uKGEpe2lmKGEpe3ZhciBiO2lmKHM8Milmb3IoYiBpbiBhKWpbYl09W2pbYl0sYVtiXV07ZWxzZSBiPWFbdi5zdGF0dXNdLHYudGhlbihiLGIpfXJldHVybiB0aGlzfSxkLnVybD0oKGF8fGQudXJsKSsiIikucmVwbGFjZShiRSwiIikucmVwbGFjZShiSixiVVsxXSsiLy8iKSxkLmRhdGFUeXBlcz1mLnRyaW0oZC5kYXRhVHlwZXx8IioiKS50b0xvd2VyQ2FzZSgpLnNwbGl0KGJOKSxkLmNyb3NzRG9tYWluPT1udWxsJiYocj1iUC5leGVjKGQudXJsLnRvTG93ZXJDYXNlKCkpLGQuY3Jvc3NEb21haW49ISghcnx8clsxXT09YlVbMV0mJnJbMl09PWJVWzJdJiYoclszXXx8KHJbMV09PT0iaHR0cDoiPzgwOjQ0MykpPT0oYlVbM118fChiVVsxXT09PSJodHRwOiI/ODA6NDQzKSkpKSxkLmRhdGEmJmQucHJvY2Vzc0RhdGEmJnR5cGVvZiBkLmRhdGEhPSJzdHJpbmciJiYoZC5kYXRhPWYucGFyYW0oZC5kYXRhLGQudHJhZGl0aW9uYWwpKSxiWChiUixkLGMsdik7aWYocz09PTIpcmV0dXJuITE7dD1kLmdsb2JhbCxkLnR5cGU9ZC50eXBlLnRvVXBwZXJDYXNlKCksZC5oYXNDb250ZW50PSFiSS50ZXN0KGQudHlwZSksdCYmZi5hY3RpdmUrKz09PTAmJmYuZXZlbnQudHJpZ2dlcigiYWpheFN0YXJ0Iik7aWYoIWQuaGFzQ29udGVudCl7ZC5kYXRhJiYoZC51cmwrPShiSy50ZXN0KGQudXJsKT8iJiI6Ij8iKStkLmRhdGEpLGs9ZC51cmw7aWYoZC5jYWNoZT09PSExKXt2YXIgeD1mLm5vdygpLHk9ZC51cmwucmVwbGFjZShiTywiJDFfPSIreCk7ZC51cmw9eSsoeT09PWQudXJsPyhiSy50ZXN0KGQudXJsKT8iJiI6Ij8iKSsiXz0iK3g6IiIpfX0oZC5kYXRhJiZkLmhhc0NvbnRlbnQmJmQuY29udGVudFR5cGUhPT0hMXx8Yy5jb250ZW50VHlwZSkmJnYuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIixkLmNvbnRlbnRUeXBlKSxkLmlmTW9kaWZpZWQmJihrPWt8fGQudXJsLGYubGFzdE1vZGlmaWVkW2tdJiZ2LnNldFJlcXVlc3RIZWFkZXIoIklmLU1vZGlmaWVkLVNpbmNlIixmLmxhc3RNb2RpZmllZFtrXSksZi5ldGFnW2tdJiZ2LnNldFJlcXVlc3RIZWFkZXIoIklmLU5vbmUtTWF0Y2giLGYuZXRhZ1trXSkpLHYuc2V0UmVxdWVzdEhlYWRlcigiQWNjZXB0IixkLmRhdGFUeXBlc1swXSYmZC5hY2NlcHRzW2QuZGF0YVR5cGVzWzBdXT9kLmFjY2VwdHNbZC5kYXRhVHlwZXNbMF1dKyhkLmRhdGFUeXBlc1swXSE9PSIqIj8iLCAqLyo7IHE9MC4wMSI6IiIpOmQuYWNjZXB0c1siKiJdKTtmb3IodSBpbiBkLmhlYWRlcnMpdi5zZXRSZXF1ZXN0SGVhZGVyKHUsZC5oZWFkZXJzW3VdKTtpZihkLmJlZm9yZVNlbmQmJihkLmJlZm9yZVNlbmQuY2FsbChlLHYsZCk9PT0hMXx8cz09PTIpKXt2LmFib3J0KCk7cmV0dXJuITF9Zm9yKHUgaW57c3VjY2VzczoxLGVycm9yOjEsY29tcGxldGU6MX0pdlt1XShkW3VdKTtwPWJYKGJTLGQsYyx2KTtpZighcCl3KC0xLCJObyBUcmFuc3BvcnQiKTtlbHNle3YucmVhZHlTdGF0ZT0xLHQmJmcudHJpZ2dlcigiYWpheFNlbmQiLFt2LGRdKSxkLmFzeW5jJiZkLnRpbWVvdXQ+MCYmKHE9c2V0VGltZW91dChmdW5jdGlvbigpe3YuYWJvcnQoInRpbWVvdXQiKX0sZC50aW1lb3V0KSk7dHJ5e3M9MSxwLnNlbmQobCx3KX1jYXRjaCh6KXtzdGF0dXM8Mj93KC0xLHopOmYuZXJyb3Ioeil9fXJldHVybiB2fSxwYXJhbTpmdW5jdGlvbihhLGMpe3ZhciBkPVtdLGU9ZnVuY3Rpb24oYSxiKXtiPWYuaXNGdW5jdGlvbihiKT9iKCk6YixkW2QubGVuZ3RoXT1lbmNvZGVVUklDb21wb25lbnQoYSkrIj0iK2VuY29kZVVSSUNvbXBvbmVudChiKX07Yz09PWImJihjPWYuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsKTtpZihmLmlzQXJyYXkoYSl8fGEuanF1ZXJ5JiYhZi5pc1BsYWluT2JqZWN0KGEpKWYuZWFjaChhLGZ1bmN0aW9uKCl7ZSh0aGlzLm5hbWUsdGhpcy52YWx1ZSl9KTtlbHNlIGZvcih2YXIgZyBpbiBhKWJZKGcsYVtnXSxjLGUpO3JldHVybiBkLmpvaW4oIiYiKS5yZXBsYWNlKGJCLCIrIil9fSksZi5leHRlbmQoe2FjdGl2ZTowLGxhc3RNb2RpZmllZDp7fSxldGFnOnt9fSk7dmFyIGJfPWYubm93KCksY2E9LyhcPSlcPygmfCQpfFw/XD8vaTtmLmFqYXhTZXR1cCh7anNvbnA6ImNhbGxiYWNrIixqc29ucENhbGxiYWNrOmZ1bmN0aW9uKCl7cmV0dXJuIGYuZXhwYW5kbysiXyIrYl8rK319KSxmLmFqYXhQcmVmaWx0ZXIoImpzb24ganNvbnAiLGZ1bmN0aW9uKGIsYyxkKXt2YXIgZT1iLmNvbnRlbnRUeXBlPT09ImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCImJnR5cGVvZiBiLmRhdGE9PSJzdHJpbmciO2lmKGIuZGF0YVR5cGVzWzBdPT09Impzb25wInx8Yi5qc29ucCE9PSExJiYoY2EudGVzdChiLnVybCl8fGUmJmNhLnRlc3QoYi5kYXRhKSkpe3ZhciBnLGg9Yi5qc29ucENhbGxiYWNrPWYuaXNGdW5jdGlvbihiLmpzb25wQ2FsbGJhY2spP2IuanNvbnBDYWxsYmFjaygpOmIuanNvbnBDYWxsYmFjayxpPWFbaF0saj1iLnVybCxrPWIuZGF0YSxsPSIkMSIraCsiJDIiO2IuanNvbnAhPT0hMSYmKGo9ai5yZXBsYWNlKGNhLGwpLGIudXJsPT09aiYmKGUmJihrPWsucmVwbGFjZShjYSxsKSksYi5kYXRhPT09ayYmKGorPSgvXD8vLnRlc3Qoaik/IiYiOiI/IikrYi5qc29ucCsiPSIraCkpKSxiLnVybD1qLGIuZGF0YT1rLGFbaF09ZnVuY3Rpb24oYSl7Zz1bYV19LGQuYWx3YXlzKGZ1bmN0aW9uKCl7YVtoXT1pLGcmJmYuaXNGdW5jdGlvbihpKSYmYVtoXShnWzBdKX0pLGIuY29udmVydGVyc1sic2NyaXB0IGpzb24iXT1mdW5jdGlvbigpe2d8fGYuZXJyb3IoaCsiIHdhcyBub3QgY2FsbGVkIik7cmV0dXJuIGdbMF19LGIuZGF0YVR5cGVzWzBdPSJqc29uIjtyZXR1cm4ic2NyaXB0In19KSxmLmFqYXhTZXR1cCh7YWNjZXB0czp7c2NyaXB0OiJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCJ9LGNvbnRlbnRzOntzY3JpcHQ6L2phdmFzY3JpcHR8ZWNtYXNjcmlwdC99LGNvbnZlcnRlcnM6eyJ0ZXh0IHNjcmlwdCI6ZnVuY3Rpb24oYSl7Zi5nbG9iYWxFdmFsKGEpO3JldHVybiBhfX19KSxmLmFqYXhQcmVmaWx0ZXIoInNjcmlwdCIsZnVuY3Rpb24oYSl7YS5jYWNoZT09PWImJihhLmNhY2hlPSExKSxhLmNyb3NzRG9tYWluJiYoYS50eXBlPSJHRVQiLGEuZ2xvYmFsPSExKX0pLGYuYWpheFRyYW5zcG9ydCgic2NyaXB0IixmdW5jdGlvbihhKXtpZihhLmNyb3NzRG9tYWluKXt2YXIgZCxlPWMuaGVhZHx8Yy5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdfHxjLmRvY3VtZW50RWxlbWVudDtyZXR1cm57c2VuZDpmdW5jdGlvbihmLGcpe2Q9Yy5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKSxkLmFzeW5jPSJhc3luYyIsYS5zY3JpcHRDaGFyc2V0JiYoZC5jaGFyc2V0PWEuc2NyaXB0Q2hhcnNldCksZC5zcmM9YS51cmwsZC5vbmxvYWQ9ZC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oYSxjKXtpZihjfHwhZC5yZWFkeVN0YXRlfHwvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KGQucmVhZHlTdGF0ZSkpZC5vbmxvYWQ9ZC5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCxlJiZkLnBhcmVudE5vZGUmJmUucmVtb3ZlQ2hpbGQoZCksZD1iLGN8fGcoMjAwLCJzdWNjZXNzIil9LGUuaW5zZXJ0QmVmb3JlKGQsZS5maXJzdENoaWxkKX0sYWJvcnQ6ZnVuY3Rpb24oKXtkJiZkLm9ubG9hZCgwLDEpfX19fSk7dmFyIGNiPWEuQWN0aXZlWE9iamVjdD9mdW5jdGlvbigpe2Zvcih2YXIgYSBpbiBjZCljZFthXSgwLDEpfTohMSxjYz0wLGNkO2YuYWpheFNldHRpbmdzLnhocj1hLkFjdGl2ZVhPYmplY3Q/ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5pc0xvY2FsJiZjZSgpfHxjZigpfTpjZSxmdW5jdGlvbihhKXtmLmV4dGVuZChmLnN1cHBvcnQse2FqYXg6ISFhLGNvcnM6ISFhJiYid2l0aENyZWRlbnRpYWxzImluIGF9KX0oZi5hamF4U2V0dGluZ3MueGhyKCkpLGYuc3VwcG9ydC5hamF4JiZmLmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oYyl7aWYoIWMuY3Jvc3NEb21haW58fGYuc3VwcG9ydC5jb3JzKXt2YXIgZDtyZXR1cm57c2VuZDpmdW5jdGlvbihlLGcpe3ZhciBoPWMueGhyKCksaSxqO2MudXNlcm5hbWU/aC5vcGVuKGMudHlwZSxjLnVybCxjLmFzeW5jLGMudXNlcm5hbWUsYy5wYXNzd29yZCk6aC5vcGVuKGMudHlwZSxjLnVybCxjLmFzeW5jKTtpZihjLnhockZpZWxkcylmb3IoaiBpbiBjLnhockZpZWxkcyloW2pdPWMueGhyRmllbGRzW2pdO2MubWltZVR5cGUmJmgub3ZlcnJpZGVNaW1lVHlwZSYmaC5vdmVycmlkZU1pbWVUeXBlKGMubWltZVR5cGUpLCFjLmNyb3NzRG9tYWluJiYhZVsiWC1SZXF1ZXN0ZWQtV2l0aCJdJiYoZVsiWC1SZXF1ZXN0ZWQtV2l0aCJdPSJYTUxIdHRwUmVxdWVzdCIpO3RyeXtmb3IoaiBpbiBlKWguc2V0UmVxdWVzdEhlYWRlcihqLGVbal0pfWNhdGNoKGspe31oLnNlbmQoYy5oYXNDb250ZW50JiZjLmRhdGF8fG51bGwpLGQ9ZnVuY3Rpb24oYSxlKXt2YXIgaixrLGwsbSxuO3RyeXtpZihkJiYoZXx8aC5yZWFkeVN0YXRlPT09NCkpe2Q9YixpJiYoaC5vbnJlYWR5c3RhdGVjaGFuZ2U9Zi5ub29wLGNiJiZkZWxldGUgY2RbaV0pO2lmKGUpaC5yZWFkeVN0YXRlIT09NCYmaC5hYm9ydCgpO2Vsc2V7aj1oLnN0YXR1cyxsPWguZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCksbT17fSxuPWgucmVzcG9uc2VYTUwsbiYmbi5kb2N1bWVudEVsZW1lbnQmJihtLnhtbD1uKSxtLnRleHQ9aC5yZXNwb25zZVRleHQ7dHJ5e2s9aC5zdGF0dXNUZXh0fWNhdGNoKG8pe2s9IiJ9IWomJmMuaXNMb2NhbCYmIWMuY3Jvc3NEb21haW4/aj1tLnRleHQ/MjAwOjQwNDpqPT09MTIyMyYmKGo9MjA0KX19fWNhdGNoKHApe2V8fGcoLTEscCl9bSYmZyhqLGssbSxsKX0sIWMuYXN5bmN8fGgucmVhZHlTdGF0ZT09PTQ/ZCgpOihpPSsrY2MsY2ImJihjZHx8KGNkPXt9LGYoYSkudW5sb2FkKGNiKSksY2RbaV09ZCksaC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZCl9LGFib3J0OmZ1bmN0aW9uKCl7ZCYmZCgwLDEpfX19fSk7dmFyIGNnPXt9LGNoLGNpLGNqPS9eKD86dG9nZ2xlfHNob3d8aGlkZSkkLyxjaz0vXihbK1wtXT0pPyhbXGQrLlwtXSspKFthLXolXSopJC9pLGNsLGNtPVtbImhlaWdodCIsIm1hcmdpblRvcCIsIm1hcmdpbkJvdHRvbSIsInBhZGRpbmdUb3AiLCJwYWRkaW5nQm90dG9tIl0sWyJ3aWR0aCIsIm1hcmdpbkxlZnQiLCJtYXJnaW5SaWdodCIsInBhZGRpbmdMZWZ0IiwicGFkZGluZ1JpZ2h0Il0sWyJvcGFjaXR5Il1dLGNuLGNvPWEud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxhLm1velJlcXVlc3RBbmltYXRpb25GcmFtZXx8YS5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lO2YuZm4uZXh0ZW5kKHtzaG93OmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlO2lmKGF8fGE9PT0wKXJldHVybiB0aGlzLmFuaW1hdGUoY3IoInNob3ciLDMpLGEsYixjKTtmb3IodmFyIGc9MCxoPXRoaXMubGVuZ3RoO2c8aDtnKyspZD10aGlzW2ddLGQuc3R5bGUmJihlPWQuc3R5bGUuZGlzcGxheSwhZi5fZGF0YShkLCJvbGRkaXNwbGF5IikmJmU9PT0ibm9uZSImJihlPWQuc3R5bGUuZGlzcGxheT0iIiksZT09PSIiJiZmLmNzcyhkLCJkaXNwbGF5Iik9PT0ibm9uZSImJmYuX2RhdGEoZCwib2xkZGlzcGxheSIsY3MoZC5ub2RlTmFtZSkpKTtmb3IoZz0wO2c8aDtnKyspe2Q9dGhpc1tnXTtpZihkLnN0eWxlKXtlPWQuc3R5bGUuZGlzcGxheTtpZihlPT09IiJ8fGU9PT0ibm9uZSIpZC5zdHlsZS5kaXNwbGF5PWYuX2RhdGEoZCwib2xkZGlzcGxheSIpfHwiIn19cmV0dXJuIHRoaXN9LGhpZGU6ZnVuY3Rpb24oYSxiLGMpe2lmKGF8fGE9PT0wKXJldHVybiB0aGlzLmFuaW1hdGUoY3IoImhpZGUiLDMpLGEsYixjKTtmb3IodmFyIGQ9MCxlPXRoaXMubGVuZ3RoO2Q8ZTtkKyspaWYodGhpc1tkXS5zdHlsZSl7dmFyIGc9Zi5jc3ModGhpc1tkXSwiZGlzcGxheSIpO2chPT0ibm9uZSImJiFmLl9kYXRhKHRoaXNbZF0sIm9sZGRpc3BsYXkiKSYmZi5fZGF0YSh0aGlzW2RdLCJvbGRkaXNwbGF5IixnKX1mb3IoZD0wO2Q8ZTtkKyspdGhpc1tkXS5zdHlsZSYmKHRoaXNbZF0uc3R5bGUuZGlzcGxheT0ibm9uZSIpO3JldHVybiB0aGlzfSxfdG9nZ2xlOmYuZm4udG9nZ2xlLHRvZ2dsZTpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dHlwZW9mIGE9PSJib29sZWFuIjtmLmlzRnVuY3Rpb24oYSkmJmYuaXNGdW5jdGlvbihiKT90aGlzLl90b2dnbGUuYXBwbHkodGhpcyxhcmd1bWVudHMpOmE9PW51bGx8fGQ/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9ZD9hOmYodGhpcykuaXMoIjpoaWRkZW4iKTtmKHRoaXMpW2I/InNob3ciOiJoaWRlIl0oKX0pOnRoaXMuYW5pbWF0ZShjcigidG9nZ2xlIiwzKSxhLGIsYyk7cmV0dXJuIHRoaXN9LGZhZGVUbzpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5maWx0ZXIoIjpoaWRkZW4iKS5jc3MoIm9wYWNpdHkiLDApLnNob3coKS5lbmQoKS5hbmltYXRlKHtvcGFjaXR5OmJ9LGEsYyxkKX0sYW5pbWF0ZTpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1mLnNwZWVkKGIsYyxkKTtpZihmLmlzRW1wdHlPYmplY3QoYSkpcmV0dXJuIHRoaXMuZWFjaChlLmNvbXBsZXRlLFshMV0pO2E9Zi5leHRlbmQoe30sYSk7cmV0dXJuIHRoaXNbZS5xdWV1ZT09PSExPyJlYWNoIjoicXVldWUiXShmdW5jdGlvbigpe2UucXVldWU9PT0hMSYmZi5fbWFyayh0aGlzKTt2YXIgYj1mLmV4dGVuZCh7fSxlKSxjPXRoaXMubm9kZVR5cGU9PT0xLGQ9YyYmZih0aGlzKS5pcygiOmhpZGRlbiIpLGcsaCxpLGosayxsLG0sbixvO2IuYW5pbWF0ZWRQcm9wZXJ0aWVzPXt9O2ZvcihpIGluIGEpe2c9Zi5jYW1lbENhc2UoaSksaSE9PWcmJihhW2ddPWFbaV0sZGVsZXRlIGFbaV0pLGg9YVtnXSxmLmlzQXJyYXkoaCk/KGIuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddPWhbMV0saD1hW2ddPWhbMF0pOmIuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddPWIuc3BlY2lhbEVhc2luZyYmYi5zcGVjaWFsRWFzaW5nW2ddfHxiLmVhc2luZ3x8InN3aW5nIjtpZihoPT09ImhpZGUiJiZkfHxoPT09InNob3ciJiYhZClyZXR1cm4gYi5jb21wbGV0ZS5jYWxsKHRoaXMpO2MmJihnPT09ImhlaWdodCJ8fGc9PT0id2lkdGgiKSYmKGIub3ZlcmZsb3c9W3RoaXMuc3R5bGUub3ZlcmZsb3csdGhpcy5zdHlsZS5vdmVyZmxvd1gsdGhpcy5zdHlsZS5vdmVyZmxvd1ldLGYuY3NzKHRoaXMsImRpc3BsYXkiKT09PSJpbmxpbmUiJiZmLmNzcyh0aGlzLCJmbG9hdCIpPT09Im5vbmUiJiYoZi5zdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQ/KGo9Y3ModGhpcy5ub2RlTmFtZSksaj09PSJpbmxpbmUiP3RoaXMuc3R5bGUuZGlzcGxheT0iaW5saW5lLWJsb2NrIjoodGhpcy5zdHlsZS5kaXNwbGF5PSJpbmxpbmUiLHRoaXMuc3R5bGUuem9vbT0xKSk6dGhpcy5zdHlsZS5kaXNwbGF5PSJpbmxpbmUtYmxvY2siKSl9Yi5vdmVyZmxvdyE9bnVsbCYmKHRoaXMuc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIpO2ZvcihpIGluIGEpaz1uZXcgZi5meCh0aGlzLGIsaSksaD1hW2ldLGNqLnRlc3QoaCk/a1toPT09InRvZ2dsZSI/ZD8ic2hvdyI6ImhpZGUiOmhdKCk6KGw9Y2suZXhlYyhoKSxtPWsuY3VyKCksbD8obj1wYXJzZUZsb2F0KGxbMl0pLG89bFszXXx8KGYuY3NzTnVtYmVyW2ldPyIiOiJweCIpLG8hPT0icHgiJiYoZi5zdHlsZSh0aGlzLGksKG58fDEpK28pLG09KG58fDEpL2suY3VyKCkqbSxmLnN0eWxlKHRoaXMsaSxtK28pKSxsWzFdJiYobj0obFsxXT09PSItPSI/LTE6MSkqbittKSxrLmN1c3RvbShtLG4sbykpOmsuY3VzdG9tKG0saCwiIikpO3JldHVybiEwfSl9LHN0b3A6ZnVuY3Rpb24oYSxiKXthJiZ0aGlzLnF1ZXVlKFtdKSx0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYT1mLnRpbWVycyxjPWEubGVuZ3RoO2J8fGYuX3VubWFyayghMCx0aGlzKTt3aGlsZShjLS0pYVtjXS5lbGVtPT09dGhpcyYmKGImJmFbY10oITApLGEuc3BsaWNlKGMsMSkpfSksYnx8dGhpcy5kZXF1ZXVlKCk7cmV0dXJuIHRoaXN9fSksZi5lYWNoKHtzbGlkZURvd246Y3IoInNob3ciLDEpLHNsaWRlVXA6Y3IoImhpZGUiLDEpLHNsaWRlVG9nZ2xlOmNyKCJ0b2dnbGUiLDEpLGZhZGVJbjp7b3BhY2l0eToic2hvdyJ9LGZhZGVPdXQ6e29wYWNpdHk6ImhpZGUifSxmYWRlVG9nZ2xlOntvcGFjaXR5OiJ0b2dnbGUifX0sZnVuY3Rpb24oYSxiKXtmLmZuW2FdPWZ1bmN0aW9uKGEsYyxkKXtyZXR1cm4gdGhpcy5hbmltYXRlKGIsYSxjLGQpfX0pLGYuZXh0ZW5kKHtzcGVlZDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YSYmdHlwZW9mIGE9PSJvYmplY3QiP2YuZXh0ZW5kKHt9LGEpOntjb21wbGV0ZTpjfHwhYyYmYnx8Zi5pc0Z1bmN0aW9uKGEpJiZhLGR1cmF0aW9uOmEsZWFzaW5nOmMmJmJ8fGImJiFmLmlzRnVuY3Rpb24oYikmJmJ9O2QuZHVyYXRpb249Zi5meC5vZmY/MDp0eXBlb2YgZC5kdXJhdGlvbj09Im51bWJlciI/ZC5kdXJhdGlvbjpkLmR1cmF0aW9uIGluIGYuZnguc3BlZWRzP2YuZnguc3BlZWRzW2QuZHVyYXRpb25dOmYuZnguc3BlZWRzLl9kZWZhdWx0LGQub2xkPWQuY29tcGxldGUsZC5jb21wbGV0ZT1mdW5jdGlvbihhKXtmLmlzRnVuY3Rpb24oZC5vbGQpJiZkLm9sZC5jYWxsKHRoaXMpLGQucXVldWUhPT0hMT9mLmRlcXVldWUodGhpcyk6YSE9PSExJiZmLl91bm1hcmsodGhpcyl9O3JldHVybiBkfSxlYXNpbmc6e2xpbmVhcjpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gYytkKmF9LHN3aW5nOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybigtTWF0aC5jb3MoYSpNYXRoLlBJKS8yKy41KSpkK2N9fSx0aW1lcnM6W10sZng6ZnVuY3Rpb24oYSxiLGMpe3RoaXMub3B0aW9ucz1iLHRoaXMuZWxlbT1hLHRoaXMucHJvcD1jLGIub3JpZz1iLm9yaWd8fHt9fX0pLGYuZngucHJvdG90eXBlPXt1cGRhdGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuc3RlcCYmdGhpcy5vcHRpb25zLnN0ZXAuY2FsbCh0aGlzLmVsZW0sdGhpcy5ub3csdGhpcyksKGYuZnguc3RlcFt0aGlzLnByb3BdfHxmLmZ4LnN0ZXAuX2RlZmF1bHQpKHRoaXMpfSxjdXI6ZnVuY3Rpb24oKXtpZih0aGlzLmVsZW1bdGhpcy5wcm9wXSE9bnVsbCYmKCF0aGlzLmVsZW0uc3R5bGV8fHRoaXMuZWxlbS5zdHlsZVt0aGlzLnByb3BdPT1udWxsKSlyZXR1cm4gdGhpcy5lbGVtW3RoaXMucHJvcF07dmFyIGEsYj1mLmNzcyh0aGlzLmVsZW0sdGhpcy5wcm9wKTtyZXR1cm4gaXNOYU4oYT1wYXJzZUZsb2F0KGIpKT8hYnx8Yj09PSJhdXRvIj8wOmI6YX0sY3VzdG9tOmZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBoKGEpe3JldHVybiBkLnN0ZXAoYSl9dmFyIGQ9dGhpcyxlPWYuZngsZzt0aGlzLnN0YXJ0VGltZT1jbnx8Y3AoKSx0aGlzLnN0YXJ0PWEsdGhpcy5lbmQ9Yix0aGlzLnVuaXQ9Y3x8dGhpcy51bml0fHwoZi5jc3NOdW1iZXJbdGhpcy5wcm9wXT8iIjoicHgiKSx0aGlzLm5vdz10aGlzLnN0YXJ0LHRoaXMucG9zPXRoaXMuc3RhdGU9MCxoLmVsZW09dGhpcy5lbGVtLGgoKSYmZi50aW1lcnMucHVzaChoKSYmIWNsJiYoY28/KGNsPSEwLGc9ZnVuY3Rpb24oKXtjbCYmKGNvKGcpLGUudGljaygpKX0sY28oZykpOmNsPXNldEludGVydmFsKGUudGljayxlLmludGVydmFsKSl9LHNob3c6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMub3JpZ1t0aGlzLnByb3BdPWYuc3R5bGUodGhpcy5lbGVtLHRoaXMucHJvcCksdGhpcy5vcHRpb25zLnNob3c9ITAsdGhpcy5jdXN0b20odGhpcy5wcm9wPT09IndpZHRoInx8dGhpcy5wcm9wPT09ImhlaWdodCI/MTowLHRoaXMuY3VyKCkpLGYodGhpcy5lbGVtKS5zaG93KCl9LGhpZGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMub3JpZ1t0aGlzLnByb3BdPWYuc3R5bGUodGhpcy5lbGVtLHRoaXMucHJvcCksdGhpcy5vcHRpb25zLmhpZGU9ITAsdGhpcy5jdXN0b20odGhpcy5jdXIoKSwwKX0sc3RlcDpmdW5jdGlvbihhKXt2YXIgYj1jbnx8Y3AoKSxjPSEwLGQ9dGhpcy5lbGVtLGU9dGhpcy5vcHRpb25zLGcsaDtpZihhfHxiPj1lLmR1cmF0aW9uK3RoaXMuc3RhcnRUaW1lKXt0aGlzLm5vdz10aGlzLmVuZCx0aGlzLnBvcz10aGlzLnN0YXRlPTEsdGhpcy51cGRhdGUoKSxlLmFuaW1hdGVkUHJvcGVydGllc1t0aGlzLnByb3BdPSEwO2ZvcihnIGluIGUuYW5pbWF0ZWRQcm9wZXJ0aWVzKWUuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddIT09ITAmJihjPSExKTtpZihjKXtlLm92ZXJmbG93IT1udWxsJiYhZi5zdXBwb3J0LnNocmlua1dyYXBCbG9ja3MmJmYuZWFjaChbIiIsIlgiLCJZIl0sZnVuY3Rpb24oYSxiKXtkLnN0eWxlWyJvdmVyZmxvdyIrYl09ZS5vdmVyZmxvd1thXX0pLGUuaGlkZSYmZihkKS5oaWRlKCk7aWYoZS5oaWRlfHxlLnNob3cpZm9yKHZhciBpIGluIGUuYW5pbWF0ZWRQcm9wZXJ0aWVzKWYuc3R5bGUoZCxpLGUub3JpZ1tpXSk7ZS5jb21wbGV0ZS5jYWxsKGQpfXJldHVybiExfWUuZHVyYXRpb249PUluZmluaXR5P3RoaXMubm93PWI6KGg9Yi10aGlzLnN0YXJ0VGltZSx0aGlzLnN0YXRlPWgvZS5kdXJhdGlvbix0aGlzLnBvcz1mLmVhc2luZ1tlLmFuaW1hdGVkUHJvcGVydGllc1t0aGlzLnByb3BdXSh0aGlzLnN0YXRlLGgsMCwxLGUuZHVyYXRpb24pLHRoaXMubm93PXRoaXMuc3RhcnQrKHRoaXMuZW5kLXRoaXMuc3RhcnQpKnRoaXMucG9zKSx0aGlzLnVwZGF0ZSgpO3JldHVybiEwfX0sZi5leHRlbmQoZi5meCx7dGljazpmdW5jdGlvbigpe2Zvcih2YXIgYT1mLnRpbWVycyxiPTA7YjxhLmxlbmd0aDsrK2IpYVtiXSgpfHxhLnNwbGljZShiLS0sMSk7YS5sZW5ndGh8fGYuZnguc3RvcCgpfSxpbnRlcnZhbDoxMyxzdG9wOmZ1bmN0aW9uKCl7Y2xlYXJJbnRlcnZhbChjbCksY2w9bnVsbH0sc3BlZWRzOntzbG93OjYwMCxmYXN0OjIwMCxfZGVmYXVsdDo0MDB9LHN0ZXA6e29wYWNpdHk6ZnVuY3Rpb24oYSl7Zi5zdHlsZShhLmVsZW0sIm9wYWNpdHkiLGEubm93KX0sX2RlZmF1bHQ6ZnVuY3Rpb24oYSl7YS5lbGVtLnN0eWxlJiZhLmVsZW0uc3R5bGVbYS5wcm9wXSE9bnVsbD9hLmVsZW0uc3R5bGVbYS5wcm9wXT0oYS5wcm9wPT09IndpZHRoInx8YS5wcm9wPT09ImhlaWdodCI/TWF0aC5tYXgoMCxhLm5vdyk6YS5ub3cpK2EudW5pdDphLmVsZW1bYS5wcm9wXT1hLm5vd319fSksZi5leHByJiZmLmV4cHIuZmlsdGVycyYmKGYuZXhwci5maWx0ZXJzLmFuaW1hdGVkPWZ1bmN0aW9uKGEpe3JldHVybiBmLmdyZXAoZi50aW1lcnMsZnVuY3Rpb24oYil7cmV0dXJuIGE9PT1iLmVsZW19KS5sZW5ndGh9KTt2YXIgY3Q9L150KD86YWJsZXxkfGgpJC9pLGN1PS9eKD86Ym9keXxodG1sKSQvaTsiZ2V0Qm91bmRpbmdDbGllbnRSZWN0ImluIGMuZG9jdW1lbnRFbGVtZW50P2YuZm4ub2Zmc2V0PWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXNbMF0sYztpZihhKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zi5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO2lmKCFifHwhYi5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGI9PT1iLm93bmVyRG9jdW1lbnQuYm9keSlyZXR1cm4gZi5vZmZzZXQuYm9keU9mZnNldChiKTt0cnl7Yz1iLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpfWNhdGNoKGQpe312YXIgZT1iLm93bmVyRG9jdW1lbnQsZz1lLmRvY3VtZW50RWxlbWVudDtpZighY3x8IWYuY29udGFpbnMoZyxiKSlyZXR1cm4gYz97dG9wOmMudG9wLGxlZnQ6Yy5sZWZ0fTp7dG9wOjAsbGVmdDowfTt2YXIgaD1lLmJvZHksaT1jdihlKSxqPWcuY2xpZW50VG9wfHxoLmNsaWVudFRvcHx8MCxrPWcuY2xpZW50TGVmdHx8aC5jbGllbnRMZWZ0fHwwLGw9aS5wYWdlWU9mZnNldHx8Zi5zdXBwb3J0LmJveE1vZGVsJiZnLnNjcm9sbFRvcHx8aC5zY3JvbGxUb3AsbT1pLnBhZ2VYT2Zmc2V0fHxmLnN1cHBvcnQuYm94TW9kZWwmJmcuc2Nyb2xsTGVmdHx8aC5zY3JvbGxMZWZ0LG49Yy50b3ArbC1qLG89Yy5sZWZ0K20taztyZXR1cm57dG9wOm4sbGVmdDpvfX06Zi5mbi5vZmZzZXQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXTtpZihhKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zi5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO2lmKCFifHwhYi5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGI9PT1iLm93bmVyRG9jdW1lbnQuYm9keSlyZXR1cm4gZi5vZmZzZXQuYm9keU9mZnNldChiKTtmLm9mZnNldC5pbml0aWFsaXplKCk7dmFyIGMsZD1iLm9mZnNldFBhcmVudCxlPWIsZz1iLm93bmVyRG9jdW1lbnQsaD1nLmRvY3VtZW50RWxlbWVudCxpPWcuYm9keSxqPWcuZGVmYXVsdFZpZXcsaz1qP2ouZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpOmIuY3VycmVudFN0eWxlLGw9Yi5vZmZzZXRUb3AsbT1iLm9mZnNldExlZnQ7d2hpbGUoKGI9Yi5wYXJlbnROb2RlKSYmYiE9PWkmJmIhPT1oKXtpZihmLm9mZnNldC5zdXBwb3J0c0ZpeGVkUG9zaXRpb24mJmsucG9zaXRpb249PT0iZml4ZWQiKWJyZWFrO2M9aj9qLmdldENvbXB1dGVkU3R5bGUoYixudWxsKTpiLmN1cnJlbnRTdHlsZSxsLT1iLnNjcm9sbFRvcCxtLT1iLnNjcm9sbExlZnQsYj09PWQmJihsKz1iLm9mZnNldFRvcCxtKz1iLm9mZnNldExlZnQsZi5vZmZzZXQuZG9lc05vdEFkZEJvcmRlciYmKCFmLm9mZnNldC5kb2VzQWRkQm9yZGVyRm9yVGFibGVBbmRDZWxsc3x8IWN0LnRlc3QoYi5ub2RlTmFtZSkpJiYobCs9cGFyc2VGbG9hdChjLmJvcmRlclRvcFdpZHRoKXx8MCxtKz1wYXJzZUZsb2F0KGMuYm9yZGVyTGVmdFdpZHRoKXx8MCksZT1kLGQ9Yi5vZmZzZXRQYXJlbnQpLGYub2Zmc2V0LnN1YnRyYWN0c0JvcmRlckZvck92ZXJmbG93Tm90VmlzaWJsZSYmYy5vdmVyZmxvdyE9PSJ2aXNpYmxlIiYmKGwrPXBhcnNlRmxvYXQoYy5ib3JkZXJUb3BXaWR0aCl8fDAsbSs9cGFyc2VGbG9hdChjLmJvcmRlckxlZnRXaWR0aCl8fDApLGs9Y31pZihrLnBvc2l0aW9uPT09InJlbGF0aXZlInx8ay5wb3NpdGlvbj09PSJzdGF0aWMiKWwrPWkub2Zmc2V0VG9wLG0rPWkub2Zmc2V0TGVmdDtmLm9mZnNldC5zdXBwb3J0c0ZpeGVkUG9zaXRpb24mJmsucG9zaXRpb249PT0iZml4ZWQiJiYobCs9TWF0aC5tYXgoaC5zY3JvbGxUb3AsaS5zY3JvbGxUb3ApLG0rPU1hdGgubWF4KGguc2Nyb2xsTGVmdCxpLnNjcm9sbExlZnQpKTtyZXR1cm57dG9wOmwsbGVmdDptfX0sZi5vZmZzZXQ9e2luaXRpYWxpemU6ZnVuY3Rpb24oKXt2YXIgYT1jLmJvZHksYj1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpLGQsZSxnLGgsaT1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpblRvcCIpKXx8MCxqPSI8ZGl2IHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7bWFyZ2luOjA7Ym9yZGVyOjVweCBzb2xpZCAjMDAwO3BhZGRpbmc6MDt3aWR0aDoxcHg7aGVpZ2h0OjFweDsnPjxkaXY+PC9kaXY+PC9kaXY+PHRhYmxlIHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7bWFyZ2luOjA7Ym9yZGVyOjVweCBzb2xpZCAjMDAwO3BhZGRpbmc6MDt3aWR0aDoxcHg7aGVpZ2h0OjFweDsnIGNlbGxwYWRkaW5nPScwJyBjZWxsc3BhY2luZz0nMCc+PHRyPjx0ZD48L3RkPjwvdHI+PC90YWJsZT4iO2YuZXh0ZW5kKGIuc3R5bGUse3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdG9wOjAsbGVmdDowLG1hcmdpbjowLGJvcmRlcjowLHdpZHRoOiIxcHgiLGhlaWdodDoiMXB4Iix2aXNpYmlsaXR5OiJoaWRkZW4ifSksYi5pbm5lckhUTUw9aixhLmluc2VydEJlZm9yZShiLGEuZmlyc3RDaGlsZCksZD1iLmZpcnN0Q2hpbGQsZT1kLmZpcnN0Q2hpbGQsaD1kLm5leHRTaWJsaW5nLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZCx0aGlzLmRvZXNOb3RBZGRCb3JkZXI9ZS5vZmZzZXRUb3AhPT01LHRoaXMuZG9lc0FkZEJvcmRlckZvclRhYmxlQW5kQ2VsbHM9aC5vZmZzZXRUb3A9PT01LGUuc3R5bGUucG9zaXRpb249ImZpeGVkIixlLnN0eWxlLnRvcD0iMjBweCIsdGhpcy5zdXBwb3J0c0ZpeGVkUG9zaXRpb249ZS5vZmZzZXRUb3A9PT0yMHx8ZS5vZmZzZXRUb3A9PT0xNSxlLnN0eWxlLnBvc2l0aW9uPWUuc3R5bGUudG9wPSIiLGQuc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIsZC5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiLHRoaXMuc3VidHJhY3RzQm9yZGVyRm9yT3ZlcmZsb3dOb3RWaXNpYmxlPWUub2Zmc2V0VG9wPT09LTUsdGhpcy5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldD1hLm9mZnNldFRvcCE9PWksYS5yZW1vdmVDaGlsZChiKSxmLm9mZnNldC5pbml0aWFsaXplPWYubm9vcH0sYm9keU9mZnNldDpmdW5jdGlvbihhKXt2YXIgYj1hLm9mZnNldFRvcCxjPWEub2Zmc2V0TGVmdDtmLm9mZnNldC5pbml0aWFsaXplKCksZi5vZmZzZXQuZG9lc05vdEluY2x1ZGVNYXJnaW5JbkJvZHlPZmZzZXQmJihiKz1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpblRvcCIpKXx8MCxjKz1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpbkxlZnQiKSl8fDApO3JldHVybnt0b3A6YixsZWZ0OmN9fSxzZXRPZmZzZXQ6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWYuY3NzKGEsInBvc2l0aW9uIik7ZD09PSJzdGF0aWMiJiYoYS5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiKTt2YXIgZT1mKGEpLGc9ZS5vZmZzZXQoKSxoPWYuY3NzKGEsInRvcCIpLGk9Zi5jc3MoYSwibGVmdCIpLGo9KGQ9PT0iYWJzb2x1dGUifHxkPT09ImZpeGVkIikmJmYuaW5BcnJheSgiYXV0byIsW2gsaV0pPi0xLGs9e30sbD17fSxtLG47aj8obD1lLnBvc2l0aW9uKCksbT1sLnRvcCxuPWwubGVmdCk6KG09cGFyc2VGbG9hdChoKXx8MCxuPXBhcnNlRmxvYXQoaSl8fDApLGYuaXNGdW5jdGlvbihiKSYmKGI9Yi5jYWxsKGEsYyxnKSksYi50b3AhPW51bGwmJihrLnRvcD1iLnRvcC1nLnRvcCttKSxiLmxlZnQhPW51bGwmJihrLmxlZnQ9Yi5sZWZ0LWcubGVmdCtuKSwidXNpbmciaW4gYj9iLnVzaW5nLmNhbGwoYSxrKTplLmNzcyhrKX19LGYuZm4uZXh0ZW5kKHtwb3NpdGlvbjpmdW5jdGlvbigpe2lmKCF0aGlzWzBdKXJldHVybiBudWxsO3ZhciBhPXRoaXNbMF0sYj10aGlzLm9mZnNldFBhcmVudCgpLGM9dGhpcy5vZmZzZXQoKSxkPWN1LnRlc3QoYlswXS5ub2RlTmFtZSk/e3RvcDowLGxlZnQ6MH06Yi5vZmZzZXQoKTtjLnRvcC09cGFyc2VGbG9hdChmLmNzcyhhLCJtYXJnaW5Ub3AiKSl8fDAsYy5sZWZ0LT1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpbkxlZnQiKSl8fDAsZC50b3ArPXBhcnNlRmxvYXQoZi5jc3MoYlswXSwiYm9yZGVyVG9wV2lkdGgiKSl8fDAsZC5sZWZ0Kz1wYXJzZUZsb2F0KGYuY3NzKGJbMF0sImJvcmRlckxlZnRXaWR0aCIpKXx8MDtyZXR1cm57dG9wOmMudG9wLWQudG9wLGxlZnQ6Yy5sZWZ0LWQubGVmdH19LG9mZnNldFBhcmVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3ZhciBhPXRoaXMub2Zmc2V0UGFyZW50fHxjLmJvZHk7d2hpbGUoYSYmIWN1LnRlc3QoYS5ub2RlTmFtZSkmJmYuY3NzKGEsInBvc2l0aW9uIik9PT0ic3RhdGljIilhPWEub2Zmc2V0UGFyZW50O3JldHVybiBhfSl9fSksZi5lYWNoKFsiTGVmdCIsIlRvcCJdLGZ1bmN0aW9uKGEsYyl7dmFyIGQ9InNjcm9sbCIrYztmLmZuW2RdPWZ1bmN0aW9uKGMpe3ZhciBlLGc7aWYoYz09PWIpe2U9dGhpc1swXTtpZighZSlyZXR1cm4gbnVsbDtnPWN2KGUpO3JldHVybiBnPyJwYWdlWE9mZnNldCJpbiBnP2dbYT8icGFnZVlPZmZzZXQiOiJwYWdlWE9mZnNldCJdOmYuc3VwcG9ydC5ib3hNb2RlbCYmZy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbZF18fGcuZG9jdW1lbnQuYm9keVtkXTplW2RdfXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtnPWN2KHRoaXMpLGc/Zy5zY3JvbGxUbyhhP2YoZykuc2Nyb2xsTGVmdCgpOmMsYT9jOmYoZykuc2Nyb2xsVG9wKCkpOnRoaXNbZF09Y30pfX0pLGYuZWFjaChbIkhlaWdodCIsIldpZHRoIl0sZnVuY3Rpb24oYSxjKXt2YXIgZD1jLnRvTG93ZXJDYXNlKCk7Zi5mblsiaW5uZXIiK2NdPWZ1bmN0aW9uKCl7dmFyIGE9dGhpc1swXTtyZXR1cm4gYSYmYS5zdHlsZT9wYXJzZUZsb2F0KGYuY3NzKGEsZCwicGFkZGluZyIpKTpudWxsfSxmLmZuWyJvdXRlciIrY109ZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXTtyZXR1cm4gYiYmYi5zdHlsZT9wYXJzZUZsb2F0KGYuY3NzKGIsZCxhPyJtYXJnaW4iOiJib3JkZXIiKSk6bnVsbH0sZi5mbltkXT1mdW5jdGlvbihhKXt2YXIgZT10aGlzWzBdO2lmKCFlKXJldHVybiBhPT1udWxsP251bGw6dGhpcztpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXt2YXIgYz1mKHRoaXMpO2NbZF0oYS5jYWxsKHRoaXMsYixjW2RdKCkpKX0pO2lmKGYuaXNXaW5kb3coZSkpe3ZhciBnPWUuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50WyJjbGllbnQiK2NdO3JldHVybiBlLmRvY3VtZW50LmNvbXBhdE1vZGU9PT0iQ1NTMUNvbXBhdCImJmd8fGUuZG9jdW1lbnQuYm9keVsiY2xpZW50IitjXXx8Z31pZihlLm5vZGVUeXBlPT09OSlyZXR1cm4gTWF0aC5tYXgoZS5kb2N1bWVudEVsZW1lbnRbImNsaWVudCIrY10sZS5ib2R5WyJzY3JvbGwiK2NdLGUuZG9jdW1lbnRFbGVtZW50WyJzY3JvbGwiK2NdLGUuYm9keVsib2Zmc2V0IitjXSxlLmRvY3VtZW50RWxlbWVudFsib2Zmc2V0IitjXSk7aWYoYT09PWIpe3ZhciBoPWYuY3NzKGUsZCksaT1wYXJzZUZsb2F0KGgpO3JldHVybiBmLmlzTmFOKGkpP2g6aX1yZXR1cm4gdGhpcy5jc3MoZCx0eXBlb2YgYT09InN0cmluZyI/YTphKyJweCIpfX0pLGEualF1ZXJ5PWEuJD1mfSkod2luZG93KTsKCmRiPXt9OyhmdW5jdGlvbihleHBvcnRzKXt1dGlscz17aXNCcm93c2VyOmZ1bmN0aW9uKCl7cmV0dXJuIHRydWU7fSxnZXRCYXNlVVJMOmZ1bmN0aW9uKCl7cmV0dXJuIHNldHRpbmdzLmJhc2VVUkw7fX07dmFyIGxhc3Rfc2Vzc2lvbl9jaGVjaz0wO2V4cG9ydHMuZGVzaWduX2RvY3M9e307dmFyIGh0dHBEYXRhPWZ1bmN0aW9uKHhocix0eXBlLHMpe3ZhciBjdD14aHIuZ2V0UmVzcG9uc2VIZWFkZXIoImNvbnRlbnQtdHlwZSIpfHwiIix4bWw9dHlwZT09PSJ4bWwifHwhdHlwZSYmY3QuaW5kZXhPZigieG1sIik+PTAsZGF0YT14bWw/eGhyLnJlc3BvbnNlWE1MOnhoci5yZXNwb25zZVRleHQ7aWYoeG1sJiZkYXRhLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZT09PSJwYXJzZXJlcnJvciIpeyQuZXJyb3IoInBhcnNlcmVycm9yIik7fQppZihzJiZzLmRhdGFGaWx0ZXIpe2RhdGE9cy5kYXRhRmlsdGVyKGRhdGEsdHlwZSk7fQppZih0eXBlb2YgZGF0YT09PSJzdHJpbmciKXtpZih0eXBlPT09Impzb24ifHwhdHlwZSYmY3QuaW5kZXhPZigianNvbiIpPj0wKXtkYXRhPSQucGFyc2VKU09OKGRhdGEpO30KZWxzZSBpZih0eXBlPT09InNjcmlwdCJ8fCF0eXBlJiZjdC5pbmRleE9mKCJqYXZhc2NyaXB0Iik+PTApeyQuZ2xvYmFsRXZhbChkYXRhKTt9fQpyZXR1cm4gZGF0YTt9O2Z1bmN0aW9uIG9uQ29tcGxldGUob3B0aW9ucyxjYWxsYmFjayl7cmV0dXJuIGZ1bmN0aW9uKHJlcSl7dmFyIHJlc3A7dmFyIGN0eXBlPXJlcS5nZXRSZXNwb25zZUhlYWRlcignQ29udGVudC1UeXBlJyk7aWYoY3R5cGU9PT0nYXBwbGljYXRpb24vanNvbid8fGN0eXBlPT09J3RleHQvanNvbicpe3RyeXtyZXNwPWh0dHBEYXRhKHJlcSwianNvbiIpO30KY2F0Y2goZSl7cmV0dXJuIGNhbGxiYWNrKGUpO319CmVsc2V7aWYob3B0aW9ucy5leHBlY3RfanNvbil7cmV0dXJuIGNhbGxiYWNrKG5ldyBFcnJvcignRXhwZWN0ZWQgSlNPTiByZXNwb25zZSwgZ290ICcrY3R5cGUpKTt9CnJlc3A9cmVxLnJlc3BvbnNlVGV4dDt9CmlmKHJlcS5zdGF0dXM9PT00MDEpe2lmKHNlc3Npb24mJmxhc3Rfc2Vzc2lvbl9jaGVjazxuZXcgRGF0ZSgpLmdldFRpbWUoKS0xMDAwKXtzZXNzaW9uLmluZm8oKTt9fQppZihyZXEuc3RhdHVzPT09MjAwfHxyZXEuc3RhdHVzPT09MjAxfHxyZXEuc3RhdHVzPT09MjAyKXtjYWxsYmFjayhudWxsLHJlc3ApO30KZWxzZSBpZihyZXNwLmVycm9yKXt2YXIgZXJyPW5ldyBFcnJvcihyZXNwLnJlYXNvbnx8cmVzcC5lcnJvcik7ZXJyLmVycm9yPXJlc3AuZXJyb3I7ZXJyLnJlYXNvbj1yZXNwLnJlYXNvbjtlcnIuc3RhdHVzPXJlcS5zdGF0dXM7Y2FsbGJhY2soZXJyKTt9CmVsc2V7Y2FsbGJhY2sobmV3IEVycm9yKCdSZXR1cm5lZCBzdGF0dXMgY29kZTogJytyZXEuc3RhdHVzKSk7fX07fQpleHBvcnRzLmVuY29kZT1mdW5jdGlvbihzdHIpe3JldHVybiBlbmNvZGVVUklDb21wb25lbnQoc3RyKS5yZXBsYWNlKC9eX2Rlc2lnbiUyRi8sJ19kZXNpZ24vJyk7fTtleHBvcnRzLnJlcXVlc3Q9ZnVuY3Rpb24ob3B0aW9ucyxjYWxsYmFjayl7b3B0aW9ucy5jb21wbGV0ZT1vbkNvbXBsZXRlKG9wdGlvbnMsY2FsbGJhY2spO29wdGlvbnMuZGF0YVR5cGU9J2pzb24nOyQuYWpheChvcHRpb25zKTt9O2V4cG9ydHMuZ2V0UmV3cml0ZT1mdW5jdGlvbihwYXRoLHEsY2FsbGJhY2spe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl7dGhyb3cgbmV3IEVycm9yKCdnZXRSZXdyaXRlIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTt9CmlmKCFjYWxsYmFjayl7Y2FsbGJhY2s9cTtxPXt9O30KcGF0aD0ocGF0aFswXT09PScvJyk/cGF0aDonLycrcGF0aDt2YXIgYmFzZT11dGlscy5nZXRCYXNlVVJMKCk7dmFyIG5hbWU9ZXhwb3J0cy5lbmNvZGUoc2V0dGluZ3MubmFtZSk7dmFyIHJlcT17dXJsOmJhc2UrJy9fZGIvX2Rlc2lnbi8nK25hbWUrJy9fcmV3cml0ZScrcGF0aCxkYXRhOmV4cG9ydHMuc3RyaW5naWZ5UXVlcnkocSl9O2V4cG9ydHMucmVxdWVzdChyZXEsY2FsbGJhY2spO307ZXhwb3J0cy5nZXREb2M9ZnVuY3Rpb24oaWQscSxvcHRpb25zLGNhbGxiYWNrKXtpZighdXRpbHMuaXNCcm93c2VyKCkpe3Rocm93IG5ldyBFcnJvcignZ2V0RG9jIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTt9CmlmKCFpZCl7dGhyb3cgbmV3IEVycm9yKCdnZXREb2MgcmVxdWlyZXMgYW4gaWQgcGFyYW1ldGVyIHRvIHdvcmsgcHJvcGVybHknKTt9CmlmKCFjYWxsYmFjayl7aWYoIW9wdGlvbnMpe2NhbGxiYWNrPXE7b3B0aW9ucz17fTtxPXt9O31lbHNle2NhbGxiYWNrPW9wdGlvbnM7b3B0aW9ucz17fTt9fQp2YXIgdXJsO2lmKG9wdGlvbnMuZGIpe3VybD0ob3B0aW9ucy5kYi5zdWJzdHIoMCwxKSE9PScvJz8nLyc6JycpK29wdGlvbnMuZGI7fWVsc2V7dXJsPXV0aWxzLmdldEJhc2VVUkwoKSsnL19kYic7fQp2YXIgcmVxPXt1cmw6dXJsKycvJytleHBvcnRzLmVuY29kZShpZCksZGF0YTpleHBvcnRzLnN0cmluZ2lmeVF1ZXJ5KHEpLGV4cGVjdF9qc29uOnRydWV9O2V4cG9ydHMucmVxdWVzdChyZXEsY2FsbGJhY2spO307ZXhwb3J0cy5zYXZlRG9jPWZ1bmN0aW9uKGRvYyxvcHRpb25zLGNhbGxiYWNrKXtpZighdXRpbHMuaXNCcm93c2VyKCkpe3Rocm93IG5ldyBFcnJvcignc2F2ZURvYyBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7fQp2YXIgbWV0aG9kLHVybDtpZihvcHRpb25zLmRiKXt1cmw9KG9wdGlvbnMuZGIuc3Vic3RyKDAsMSkhPT0nLyc/Jy8nOicnKStvcHRpb25zLmRiO31lbHNle3VybD11dGlscy5nZXRCYXNlVVJMKCkrJy9fZGInO30KaWYoIWNhbGxiYWNrKXtjYWxsYmFjaz1vcHRpb25zO29wdGlvbnM9e307fQppZihkb2MuX2lkPT09dW5kZWZpbmVkKXttZXRob2Q9IlBPU1QiO30KZWxzZXttZXRob2Q9IlBVVCI7dXJsKz0nLycrZXhwb3J0cy5lbmNvZGUoZG9jLl9pZCk7fQp2YXIgcmVxPXt0eXBlOm1ldGhvZCx1cmw6dXJsLGRhdGE6SlNPTi5zdHJpbmdpZnkoZG9jKSxwcm9jZXNzRGF0YTpmYWxzZSxjb250ZW50VHlwZTonYXBwbGljYXRpb24vanNvbicsZXhwZWN0X2pzb246dHJ1ZX07ZXhwb3J0cy5yZXF1ZXN0KHJlcSxjYWxsYmFjayk7fTtleHBvcnRzLmRvVXBkYXRlPWZ1bmN0aW9uKGRvYyx1cGRhdGVfbmFtZSxjYWxsYmFjayl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXt0aHJvdyBuZXcgRXJyb3IoJ2RvVXBkYXRlIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTt9CnZhciB1cmw9dXRpbHMuZ2V0QmFzZVVSTCgpKycvdXBkYXRlLycrdXBkYXRlX25hbWUrJy8nK2V4cG9ydHMuZW5jb2RlKGRvYy5faWQpO3ZhciByZXE9e3R5cGU6J1BVVCcsdXJsOnVybCxkYXRhOkpTT04uc3RyaW5naWZ5KGRvYykscHJvY2Vzc0RhdGE6ZmFsc2UsY29udGVudFR5cGU6J2FwcGxpY2F0aW9uL2pzb24nLGV4cGVjdF9qc29uOmZhbHNlfTtleHBvcnRzLnJlcXVlc3QocmVxLGNhbGxiYWNrKTt9O2V4cG9ydHMucmVtb3ZlRG9jPWZ1bmN0aW9uKGRvYyxvcHRpb25zLGNhbGxiYWNrKXtpZighdXRpbHMuaXNCcm93c2VyKCkpe3Rocm93IG5ldyBFcnJvcigncmVtb3ZlRG9jIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTt9CmlmKCFkb2MuX2lkKXt0aHJvdyBuZXcgRXJyb3IoJ3JlbW92ZURvYyByZXF1aXJlcyBhbiBfaWQgZmllbGQgaW4geW91ciBkb2N1bWVudCcpO30KaWYoIWRvYy5fcmV2KXt0aHJvdyBuZXcgRXJyb3IoJ3JlbW92ZURvYyByZXF1aXJlcyBhIF9yZXYgZmllbGQgaW4geW91ciBkb2N1bWVudCcpO30KaWYoIWNhbGxiYWNrKXtjYWxsYmFjaz1vcHRpb25zO29wdGlvbnM9e307fQp2YXIgdXJsO2lmKG9wdGlvbnMuZGIpe3VybD0ob3B0aW9ucy5kYi5zdWJzdHIoMCwxKSE9PScvJz8nLyc6JycpK29wdGlvbnMuZGIrJy8nO31lbHNle3VybD11dGlscy5nZXRCYXNlVVJMKCkrJy9fZGIvJzt9CnVybCs9ZXhwb3J0cy5lbmNvZGUoZG9jLl9pZCkrJz9yZXY9JytleHBvcnRzLmVuY29kZShkb2MuX3Jldik7dmFyIHJlcT17dHlwZTonREVMRVRFJyx1cmw6dXJsfTtleHBvcnRzLnJlcXVlc3QocmVxLGNhbGxiYWNrKTt9O2V4cG9ydHMuZ2V0Vmlldz1mdW5jdGlvbih2aWV3LHEsb3B0aW9ucyxjYWxsYmFjayl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXt0aHJvdyBuZXcgRXJyb3IoJ2dldFZpZXcgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpO30KaWYoIWNhbGxiYWNrKXtpZighb3B0aW9ucyl7Y2FsbGJhY2s9cTtvcHRpb25zPXt9O3E9e307fWVsc2V7Y2FsbGJhY2s9b3B0aW9ucztvcHRpb25zPXt9O319CnZhciBiYXNlO2lmKG9wdGlvbnMuZGIpe2Jhc2U9KG9wdGlvbnMuZGIuc3Vic3RyKDAsMSkhPT0nLyc/Jy8nOicnKStvcHRpb25zLmRiO31lbHNle2Jhc2U9dXRpbHMuZ2V0QmFzZVVSTCgpO30KdmFyIG5hbWU9ZXhwb3J0cy5lbmNvZGUoc2V0dGluZ3MubmFtZSk7dmFyIHZpZXduYW1lPWV4cG9ydHMuZW5jb2RlKHZpZXcpO3ZhciByZXE9e3VybDooYmFzZSsob3B0aW9ucy5kYj8nJzonL19kYicpKycvX2Rlc2lnbi8nKwoob3B0aW9ucy5kYnx8bmFtZSkrJy9fdmlldy8nK3ZpZXduYW1lKSxkYXRhOmV4cG9ydHMuc3RyaW5naWZ5UXVlcnkocSksZXhwZWN0X2pzb246dHJ1ZX07ZXhwb3J0cy5yZXF1ZXN0KHJlcSxjYWxsYmFjayk7fTtleHBvcnRzLmdldExpc3Q9ZnVuY3Rpb24obGlzdCx2aWV3LHEsY2FsbGJhY2spe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl7dGhyb3cgbmV3IEVycm9yKCdnZXRMaXN0IGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTt9CmlmKCFjYWxsYmFjayl7Y2FsbGJhY2s9cTtxPXt9O30KdmFyIGJhc2U9dXRpbHMuZ2V0QmFzZVVSTCgpO3ZhciBuYW1lPWV4cG9ydHMuZW5jb2RlKHNldHRpbmdzLm5hbWUpO3ZhciBsaXN0bmFtZT1leHBvcnRzLmVuY29kZShsaXN0KTt2YXIgdmlld25hbWU9ZXhwb3J0cy5lbmNvZGUodmlldyk7dmFyIHJlcT17dXJsOmJhc2UrJy9fZGIvX2Rlc2lnbi8nK25hbWUrJy9fbGlzdC8nK2xpc3RuYW1lKycvJyt2aWV3bmFtZSxkYXRhOmV4cG9ydHMuc3RyaW5naWZ5UXVlcnkocSl9O2V4cG9ydHMucmVxdWVzdChyZXEsY2FsbGJhY2spO307ZXhwb3J0cy5nZXRTaG93PWZ1bmN0aW9uKHNob3csZG9jaWQscSxjYWxsYmFjayl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXt0aHJvdyBuZXcgRXJyb3IoJ2dldFNob3cgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpO30KaWYoIWNhbGxiYWNrKXtjYWxsYmFjaz1xO3E9e307fQp2YXIgYmFzZT11dGlscy5nZXRCYXNlVVJMKCk7dmFyIG5hbWU9ZXhwb3J0cy5lbmNvZGUoc2V0dGluZ3MubmFtZSk7dmFyIHNob3duYW1lPWV4cG9ydHMuZW5jb2RlKHNob3cpO3ZhciBzaG93X3VybD1iYXNlKycvX2RiL19kZXNpZ24vJytuYW1lKycvX3Nob3cvJytzaG93bmFtZTt2YXIgcmVxPXt1cmw6c2hvd191cmwrKGRvY2lkPycvJytleHBvcnRzLmVuY29kZShkb2NpZCk6JycpLGRhdGE6ZXhwb3J0cy5zdHJpbmdpZnlRdWVyeShxKX07ZXhwb3J0cy5yZXF1ZXN0KHJlcSxjYWxsYmFjayk7fTtleHBvcnRzLmFsbD1mdW5jdGlvbihxLGNhbGxiYWNrKXtpZighdXRpbHMuaXNCcm93c2VyKCkpe3Rocm93IG5ldyBFcnJvcignYWxsIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTt9CmlmKCFjYWxsYmFjayl7Y2FsbGJhY2s9cTtxPXt9O30KdmFyIGJhc2U9dXRpbHMuZ2V0QmFzZVVSTCgpO3ZhciByZXE9e3VybDpiYXNlKycvX2RiL19hbGxfZG9jcycsZGF0YTpleHBvcnRzLnN0cmluZ2lmeVF1ZXJ5KHEpLGV4cGVjdF9qc29uOnRydWV9O2V4cG9ydHMucmVxdWVzdChyZXEsY2FsbGJhY2spO307ZXhwb3J0cy5zdHJpbmdpZnlRdWVyeT1mdW5jdGlvbihxdWVyeSl7dmFyIHE9e307Zm9yKHZhciBrIGluIHF1ZXJ5KXtpZih0eXBlb2YgcXVlcnlba10hPT0nc3RyaW5nJyl7cVtrXT1KU09OLnN0cmluZ2lmeShxdWVyeVtrXSk7fQplbHNle3Fba109cXVlcnlba107fX0KcmV0dXJuIHE7fTt2YXIgdXVpZENhY2hlPVtdO2V4cG9ydHMubmV3VVVJRD1mdW5jdGlvbihjYWNoZU51bSxjYWxsYmFjayl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXt0aHJvdyBuZXcgRXJyb3IoJ25ld1VVSUQgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpO30KaWYoIWNhbGxiYWNrKXtjYWxsYmFjaz1jYWNoZU51bTtjYWNoZU51bT0xO30KaWYodXVpZENhY2hlLmxlbmd0aCl7cmV0dXJuIGNhbGxiYWNrKG51bGwsdXVpZENhY2hlLnNoaWZ0KCkpO30KdmFyIGJhc2U9dXRpbHMuZ2V0QmFzZVVSTCgpO3ZhciByZXE9e3VybDonL191dWlkcycsZGF0YTp7Y291bnQ6Y2FjaGVOdW19LGV4cGVjdF9qc29uOnRydWV9O2V4cG9ydHMucmVxdWVzdChyZXEsZnVuY3Rpb24oZXJyLHJlc3Ape2lmKGVycil7cmV0dXJuIGNhbGxiYWNrKGVycik7fQp1dWlkQ2FjaGU9cmVzcC51dWlkcztjYWxsYmFjayhudWxsLHV1aWRDYWNoZS5zaGlmdCgpKTt9KTt9O2V4cG9ydHMuY3JlYXRlRGF0YWJhc2U9ZnVuY3Rpb24obmFtZSxjYWxsYmFjayl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXt0aHJvdyBuZXcgRXJyb3IoJ2NyZWF0ZURhdGFiYXNlIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTt9CnZhciByZXE9e3R5cGU6J1BVVCcsdXJsOicvJytleHBvcnRzLmVuY29kZShuYW1lLnJlcGxhY2UoL15cLysvLCcnKSl9O2V4cG9ydHMucmVxdWVzdChyZXEsY2FsbGJhY2spO307ZXhwb3J0cy5kZWxldGVEYXRhYmFzZT1mdW5jdGlvbihuYW1lLGNhbGxiYWNrKXtpZighdXRpbHMuaXNCcm93c2VyKCkpe3Rocm93IG5ldyBFcnJvcignZGVsZXRlRGF0YWJhc2UgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpO30KdmFyIHJlcT17dHlwZTonREVMRVRFJyx1cmw6Jy8nK2V4cG9ydHMuZW5jb2RlKG5hbWUucmVwbGFjZSgvXlwvKy8sJycpKX07ZXhwb3J0cy5yZXF1ZXN0KHJlcSxjYWxsYmFjayk7fTtleHBvcnRzLmdldFJlcGxpY2F0aW9uPWZ1bmN0aW9uKGlkLGNhbGxiYWNrKXtpZighdXRpbHMuaXNCcm93c2VyKCkpe3Rocm93IG5ldyBFcnJvcignZ2V0UmVwbGljYXRpb24gY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpO30KdmFyIHJlcT17dXJsOicvX3JlcGxpY2F0b3IvJytleHBvcnRzLmVuY29kZShpZCksY2FjaGU6ZmFsc2V9O2V4cG9ydHMucmVxdWVzdChyZXEsY2FsbGJhY2spO307ZXhwb3J0cy5zdGFydFJlcGxpY2F0aW9uPWZ1bmN0aW9uKG9wdGlvbnMsY2FsbGJhY2spe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl7dGhyb3cgbmV3IEVycm9yKCdzdGFydFJlcGxpY2F0aW9uIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTt9CmlmKCFvcHRpb25zLnNvdXJjZSl7dGhyb3cgbmV3IEVycm9yKCdzb3VyY2UgcGFyYW1ldGVyIG11c3QgYmUgcHJvdmlkZWQnKTt9CmlmKCFvcHRpb25zLnRhcmdldCl7dGhyb3cgbmV3IEVycm9yKCd0YXJnZXQgcGFyYW1ldGVyIG11c3QgYmUgcHJvdmlkZWQnKTt9CnZhciByZXE9e3R5cGU6J1BPU1QnLHVybDonL19yZXBsaWNhdG9yJyxkYXRhOkpTT04uc3RyaW5naWZ5KG9wdGlvbnMpLGNvbnRlbnRUeXBlOidhcHBsaWNhdGlvbi9qc29uJ307ZXhwb3J0cy5yZXF1ZXN0KHJlcSxjYWxsYmFjayk7fTtleHBvcnRzLndhaXRSZXBsaWNhdGlvbj1mdW5jdGlvbihkb2Msb3B0aW9ucyxzdGF0ZV9mdW5jdGlvbixjYWxsYmFjayl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXt0aHJvdyBuZXcgRXJyb3IoJ3dhaXRSZXBsaWNhdGlvbiBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7fQp2YXIgZGVmYXVsdF9zdGF0ZV9mdW5jdGlvbj1mdW5jdGlvbihyZWNlbnRfZG9jLGluaXRpYWxfZG9jKXtyZXR1cm4ocmVjZW50X2RvYy5fcmVwbGljYXRpb25fc3RhdGU9PT0nY29tcGxldGVkJ3x8cmVjZW50X2RvYy5fcmVwbGljYXRpb25fc3RhdGU9PT0nZXJyb3InKTt9O2lmKCFjYWxsYmFjayl7aWYoIXN0YXRlX2Z1bmN0aW9uKXtjYWxsYmFjaz1vcHRpb25zO29wdGlvbnM9e307c3RhdGVfZnVuY3Rpb249ZGVmYXVsdF9zdGF0ZV9mdW5jdGlvbjt9ZWxzZXtjYWxsYmFjaz1zdGF0ZV9mdW5jdGlvbjtzdGF0ZV9mdW5jdGlvbj1kZWZhdWx0X3N0YXRlX2Z1bmN0aW9uO319CmlmKG9wdGlvbnM9PT11bmRlZmluZWQpe29wdGlvbnM9e307fQppZihvcHRpb25zLmxpbWl0PT09dW5kZWZpbmVkKXtvcHRpb25zLmxpbWl0PTEwMDt9CmlmKG9wdGlvbnMuZGVsYXk9PT11bmRlZmluZWQpe29wdGlvbnMuZGVsYXk9MjAwMDt9CmV4cG9ydHMuZ2V0UmVwbGljYXRpb24oZG9jLmlkLGZ1bmN0aW9uKGVycixydil7aWYoZXJyfHxzdGF0ZV9mdW5jdGlvbihydixkb2MpKXtyZXR1cm4gY2FsbGJhY2soZXJyLHJ2LGRvYyk7fQppZihvcHRpb25zLmxpbWl0PjApe29wdGlvbnMubGltaXQtPTE7cmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtyZXR1cm4gZXhwb3J0cy53YWl0UmVwbGljYXRpb24oZG9jLG9wdGlvbnMsc3RhdGVfZnVuY3Rpb24sY2FsbGJhY2spO30sb3B0aW9ucy5kZWxheSk7fX0pO307ZXhwb3J0cy5zdG9wUmVwbGljYXRpb249ZnVuY3Rpb24oZG9jLGNhbGxiYWNrLG9wdGlvbnMpe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl7dGhyb3cgbmV3IEVycm9yKCdzdG9wUmVwbGljYXRpb24gY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpO30KaWYob3B0aW9ucz09PXVuZGVmaW5lZCl7b3B0aW9ucz17fTt9CmlmKG9wdGlvbnMubGltaXQ9PT11bmRlZmluZWR8fG9wdGlvbnMubGltaXQ9PT1udWxsKXtvcHRpb25zLmxpbWl0PTM7fQppZihvcHRpb25zLmRlbGF5PT09dW5kZWZpbmVkfHxvcHRpb25zLmRlbGF5PT09bnVsbCl7b3B0aW9ucy5kZWxheT01MDA7fQp2YXIgcmVxPXt0eXBlOidERUxFVEUnLHVybDonL19yZXBsaWNhdG9yLycrCmV4cG9ydHMuZW5jb2RlKGRvYy5faWQpKyc/cmV2PScrZXhwb3J0cy5lbmNvZGUoZG9jLl9yZXYpfTtleHBvcnRzLnJlcXVlc3QocmVxLGZ1bmN0aW9uKGVycixydil7aWYoZXJyJiZlcnIuc3RhdHVzPT09NDA5KXtpZihvcHRpb25zLmxpbWl0PjApe29wdGlvbnMubGltaXQtPTE7cmV0dXJuIGV4cG9ydHMuZ2V0UmVwbGljYXRpb24oZG9jLl9pZCxmdW5jdGlvbihlLGQpe2lmKGUpe3Rocm93IG5ldyBFcnJvcignVGhlIHNwZWNpZmllZCByZXBsaWNhdGlvbiBkb2N1bWVudCBjaGFuZ2VkICcrJ3NpbmNlIGxhc3QgcmVhZCwgYW5kIHdlIGZhaWxlZCB0byByZS1yZXF1ZXN0IGl0Jyk7fQpzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7cmV0dXJuIGV4cG9ydHMuc3RvcFJlcGxpY2F0aW9uKGQsY2FsbGJhY2ssb3B0aW9ucyk7fSxvcHRpb25zLmRlbGF5KTt9KTt9fWVsc2V7cmV0dXJuIGNhbGxiYWNrKGVycixydik7fQpyZXR1cm4gZmFsc2U7fSk7fTtleHBvcnRzLmRlbGV0ZVVzZXI9ZnVuY3Rpb24odXNlcm5hbWUsY2FsbGJhY2spe3ZhciBpZD0nb3JnLmNvdWNoZGIudXNlcjonK3VzZXJuYW1lO2V4cG9ydHMudXNlckRiKGZ1bmN0aW9uKGVycix1c2VyZGIpe2lmKGVycil7cmV0dXJuIGNhbGxiYWNrKGVycik7fQp2YXIgcmVxPXt0eXBlOidERUxFVEUnLHVybDonLycrZXhwb3J0cy5lbmNvZGUodXNlcmRiKSsnLycrZXhwb3J0cy5lbmNvZGUoaWQpLGNvbnRlbnRUeXBlOidhcHBsaWNhdGlvbi9qc29uJ307ZXhwb3J0cy5yZXF1ZXN0KHJlcSxjYWxsYmFjayk7fSk7fTtleHBvcnRzLmdldERlc2lnbkRvYz1mdW5jdGlvbihuYW1lLGNhbGxiYWNrLG5vX2NhY2hlKXtpZighbm9fY2FjaGUmJmV4cG9ydHMuZGVzaWduX2RvY3NbbmFtZV0pe3JldHVybiBjYWxsYmFjayhudWxsLGV4cG9ydHMuZGVzaWduX2RvY3NbbmFtZV0pO30KZXhwb3J0cy5nZXREb2MoJ19kZXNpZ24vJytuYW1lLHt9LGZ1bmN0aW9uKGVycixkZG9jKXtpZihlcnIpe3JldHVybiBjYWxsYmFjayhlcnIpO30KZXhwb3J0cy5kZXNpZ25fZG9jc1tuYW1lXT1kZG9jO3JldHVybiBjYWxsYmFjayhudWxsLGV4cG9ydHMuZGVzaWduX2RvY3NbbmFtZV0pO30pO307fSkoZGIpOwoKc2Vzc2lvbj17fTsoZnVuY3Rpb24oZXhwb3J0cyl7dXRpbHM9e2lzQnJvd3NlcjpmdW5jdGlvbigpe3JldHVybiB0cnVlO30sZ2V0QmFzZVVSTDpmdW5jdGlvbigpe3JldHVybiBzZXR0aW5ncy5iYXNlVVJMO319O2V4cG9ydHMuc2Vzc2lvbkNoYW5nZT1mdW5jdGlvbih1c2VyQ3R4LGNhbGxiYWNrKXtpZihjYWxsYmFjayl7Y2FsbGJhY2soKTt9fTtleHBvcnRzLmxvZ291dD1mdW5jdGlvbihjYWxsYmFjayl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXt0aHJvdyBuZXcgRXJyb3IoJ2xvZ291dCBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7fQpkYi5yZXF1ZXN0KHt0eXBlOiJERUxFVEUiLHVybDoiL19zZXNzaW9uIix1c2VybmFtZToiXyIscGFzc3dvcmQ6Il8ifSxmdW5jdGlvbihlcnIscmVzcCl7aWYocmVzcCYmcmVzcC5vayl7dXRpbHMudXNlckN0eD17bmFtZTpudWxsLHJvbGVzOltdfTt1dGlscy5zZXNzaW9uPXt1c2VyQ3R4OnV0aWxzLnVzZXJDdHh9O2V4cG9ydHMuc2Vzc2lvbkNoYW5nZSh1dGlscy51c2VyQ3R4KTt9CmlmKGNhbGxiYWNrKXtjYWxsYmFjayhlcnIscmVzcCk7fX0pO307ZXhwb3J0cy5sb2dpbj1mdW5jdGlvbih1c2VybmFtZSxwYXNzd29yZCxjYWxsYmFjayl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXt0aHJvdyBuZXcgRXJyb3IoJ2xvZ2luIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTt9CmRiLnJlcXVlc3Qoe3R5cGU6IlBPU1QiLHVybDoiL19zZXNzaW9uIixkYXRhOntuYW1lOnVzZXJuYW1lLHBhc3N3b3JkOnBhc3N3b3JkfX0sZnVuY3Rpb24oZXJyLHJlc3Ape2lmKHJlc3AmJnJlc3Aub2spe3V0aWxzLnVzZXJDdHg9e25hbWU6dXNlcm5hbWUscm9sZXM6cmVzcC5yb2xlc307dXRpbHMuc2Vzc2lvbj17dXNlckN0eDp1dGlscy51c2VyQ3R4fTtleHBvcnRzLnNlc3Npb25DaGFuZ2UodXRpbHMudXNlckN0eCk7fQppZihjYWxsYmFjayl7Y2FsbGJhY2soZXJyLHJlc3ApO319KTt9O2V4cG9ydHMuaW5mbz1mdW5jdGlvbihjYWxsYmFjayl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXt0aHJvdyBuZXcgRXJyb3IoJ2luZm8gY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpO30KZGIucmVxdWVzdCh7dHlwZToiR0VUIix1cmw6Ii9fc2Vzc2lvbiJ9LGZ1bmN0aW9uKGVycixyZXNwKXt2YXIgb2xkVXNlckN0eD11dGlscy51c2VyQ3R4O3V0aWxzLnNlc3Npb249cmVzcDt1dGlscy51c2VyQ3R4PShyZXNwJiZyZXNwLnVzZXJDdHgpfHx7bmFtZTpudWxsLHJvbGVzOltdfTtpZighb2xkVXNlckN0eHx8b2xkVXNlckN0eC5uYW1lIT09dXRpbHMudXNlckN0eC5uYW1lKXtleHBvcnRzLnNlc3Npb25DaGFuZ2UodXRpbHMudXNlckN0eCk7fQppZihjYWxsYmFjayl7Y2FsbGJhY2soZXJyLHJlc3ApO319KTt9O30pKHNlc3Npb24pOwovKioKICogZWFzeVhETQogKiBodHRwOi8vZWFzeXhkbS5uZXQvCiAqIENvcHlyaWdodChjKSAyMDA5LTIwMTEsIMOYeXZpbmQgU2VhbiBLaW5zZXksIG95dmluZEBraW5zZXkubm8uCiAqCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKICogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwogKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgogKgogKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgogKiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KICoKICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQogKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KICogVEhFIFNPRlRXQVJFLgogKi8KKGZ1bmN0aW9uKE4sZCxwLEssayxIKXt2YXIgYj10aGlzO3ZhciBuPU1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoxMDAwMCk7dmFyIHE9RnVuY3Rpb24ucHJvdG90eXBlO3ZhciBRPS9eKChodHRwLj86KVwvXC8oW146XC9cc10rKSg6XGQrKSopLzt2YXIgUj0vW1wtXHddK1wvXC5cLlwvLzt2YXIgRj0vKFteOl0pXC9cLy9nO3ZhciBJPSIiO3ZhciBvPXt9O3ZhciBNPU4uZWFzeVhETTt2YXIgVT0iZWFzeVhETV8iO3ZhciBFO3ZhciB5PWZhbHNlO3ZhciBpO3ZhciBoO2Z1bmN0aW9uIEMoWCxaKXt2YXIgWT10eXBlb2YgWFtaXTtyZXR1cm4gWT09ImZ1bmN0aW9uInx8KCEhKFk9PSJvYmplY3QiJiZYW1pdKSl8fFk9PSJ1bmtub3duIn1mdW5jdGlvbiB1KFgsWSl7cmV0dXJuICEhKHR5cGVvZihYW1ldKT09Im9iamVjdCImJlhbWV0pfWZ1bmN0aW9uIHIoWCl7cmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChYKT09PSJbb2JqZWN0IEFycmF5XSJ9ZnVuY3Rpb24gYygpe3RyeXt2YXIgWD1uZXcgQWN0aXZlWE9iamVjdCgiU2hvY2t3YXZlRmxhc2guU2hvY2t3YXZlRmxhc2giKTtpPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKFguR2V0VmFyaWFibGUoIiR2ZXJzaW9uIikubWF0Y2goLyhcZCspLChcZCspLChcZCspLChcZCspLyksMSk7aD1wYXJzZUludChpWzBdLDEwKT45JiZwYXJzZUludChpWzFdLDEwKT4wO1g9bnVsbDtyZXR1cm4gdHJ1ZX1jYXRjaChZKXtyZXR1cm4gZmFsc2V9fXZhciB2LHg7aWYoQyhOLCJhZGRFdmVudExpc3RlbmVyIikpe3Y9ZnVuY3Rpb24oWixYLFkpe1ouYWRkRXZlbnRMaXN0ZW5lcihYLFksZmFsc2UpfTt4PWZ1bmN0aW9uKFosWCxZKXtaLnJlbW92ZUV2ZW50TGlzdGVuZXIoWCxZLGZhbHNlKX19ZWxzZXtpZihDKE4sImF0dGFjaEV2ZW50Iikpe3Y9ZnVuY3Rpb24oWCxaLFkpe1guYXR0YWNoRXZlbnQoIm9uIitaLFkpfTt4PWZ1bmN0aW9uKFgsWixZKXtYLmRldGFjaEV2ZW50KCJvbiIrWixZKX19ZWxzZXt0aHJvdyBuZXcgRXJyb3IoIkJyb3dzZXIgbm90IHN1cHBvcnRlZCIpfX12YXIgVz1mYWxzZSxKPVtdLEw7aWYoInJlYWR5U3RhdGUiIGluIGQpe0w9ZC5yZWFkeVN0YXRlO1c9TD09ImNvbXBsZXRlInx8KH5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkFwcGxlV2ViS2l0LyIpJiYoTD09ImxvYWRlZCJ8fEw9PSJpbnRlcmFjdGl2ZSIpKX1lbHNle1c9ISFkLmJvZHl9ZnVuY3Rpb24gcygpe2lmKFcpe3JldHVybn1XPXRydWU7Zm9yKHZhciBYPTA7WDxKLmxlbmd0aDtYKyspe0pbWF0oKX1KLmxlbmd0aD0wfWlmKCFXKXtpZihDKE4sImFkZEV2ZW50TGlzdGVuZXIiKSl7dihkLCJET01Db250ZW50TG9hZGVkIixzKX1lbHNle3YoZCwicmVhZHlzdGF0ZWNoYW5nZSIsZnVuY3Rpb24oKXtpZihkLnJlYWR5U3RhdGU9PSJjb21wbGV0ZSIpe3MoKX19KTtpZihkLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCYmTj09PXRvcCl7dmFyIGc9ZnVuY3Rpb24oKXtpZihXKXtyZXR1cm59dHJ5e2QuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKCJsZWZ0Iil9Y2F0Y2goWCl7SyhnLDEpO3JldHVybn1zKCl9O2coKX19dihOLCJsb2FkIixzKX1mdW5jdGlvbiBHKFksWCl7aWYoVyl7WS5jYWxsKFgpO3JldHVybn1KLnB1c2goZnVuY3Rpb24oKXtZLmNhbGwoWCl9KX1mdW5jdGlvbiBtKCl7dmFyIFo9cGFyZW50O2lmKEkhPT0iIil7Zm9yKHZhciBYPTAsWT1JLnNwbGl0KCIuIik7WDxZLmxlbmd0aDtYKyspe1o9WltZW1hdXX19cmV0dXJuIFouZWFzeVhETX1mdW5jdGlvbiBlKFgpe04uZWFzeVhETT1NO0k9WDtpZihJKXtVPSJlYXN5WERNXyIrSS5yZXBsYWNlKCIuIiwiXyIpKyJfIn1yZXR1cm4gb31mdW5jdGlvbiB6KFgpe3JldHVybiBYLm1hdGNoKFEpWzNdfWZ1bmN0aW9uIGYoWCl7cmV0dXJuIFgubWF0Y2goUSlbNF18fCIifWZ1bmN0aW9uIGooWil7dmFyIFg9Wi50b0xvd2VyQ2FzZSgpLm1hdGNoKFEpO3ZhciBhYT1YWzJdLGFiPVhbM10sWT1YWzRdfHwiIjtpZigoYWE9PSJodHRwOiImJlk9PSI6ODAiKXx8KGFhPT0iaHR0cHM6IiYmWT09Ijo0NDMiKSl7WT0iIn1yZXR1cm4gYWErIi8vIithYitZfWZ1bmN0aW9uIEIoWCl7WD1YLnJlcGxhY2UoRiwiJDEvIik7aWYoIVgubWF0Y2goL14oaHR0cHx8aHR0cHMpOlwvXC8vKSl7dmFyIFk9KFguc3Vic3RyaW5nKDAsMSk9PT0iLyIpPyIiOnAucGF0aG5hbWU7aWYoWS5zdWJzdHJpbmcoWS5sZW5ndGgtMSkhPT0iLyIpe1k9WS5zdWJzdHJpbmcoMCxZLmxhc3RJbmRleE9mKCIvIikrMSl9WD1wLnByb3RvY29sKyIvLyIrcC5ob3N0K1krWH13aGlsZShSLnRlc3QoWCkpe1g9WC5yZXBsYWNlKFIsIiIpfXJldHVybiBYfWZ1bmN0aW9uIFAoWCxhYSl7dmFyIGFjPSIiLFo9WC5pbmRleE9mKCIjIik7aWYoWiE9PS0xKXthYz1YLnN1YnN0cmluZyhaKTtYPVguc3Vic3RyaW5nKDAsWil9dmFyIGFiPVtdO2Zvcih2YXIgWSBpbiBhYSl7aWYoYWEuaGFzT3duUHJvcGVydHkoWSkpe2FiLnB1c2goWSsiPSIrSChhYVtZXSkpfX1yZXR1cm4gWCsoeT8iIyI6KFguaW5kZXhPZigiPyIpPT0tMT8iPyI6IiYiKSkrYWIuam9pbigiJiIpK2FjfXZhciBTPShmdW5jdGlvbihYKXtYPVguc3Vic3RyaW5nKDEpLnNwbGl0KCImIik7dmFyIFo9e30sYWEsWT1YLmxlbmd0aDt3aGlsZShZLS0pe2FhPVhbWV0uc3BsaXQoIj0iKTtaW2FhWzBdXT1rKGFhWzFdKX1yZXR1cm4gWn0oL3hkbV9lPS8udGVzdChwLnNlYXJjaCk/cC5zZWFyY2g6cC5oYXNoKSk7ZnVuY3Rpb24gdChYKXtyZXR1cm4gdHlwZW9mIFg9PT0idW5kZWZpbmVkIn12YXIgTz1mdW5jdGlvbigpe3ZhciBZPXt9O3ZhciBaPXthOlsxLDIsM119LFg9J3siYSI6WzEsMiwzXX0nO2lmKHR5cGVvZiBKU09OIT0idW5kZWZpbmVkIiYmdHlwZW9mIEpTT04uc3RyaW5naWZ5PT09ImZ1bmN0aW9uIiYmSlNPTi5zdHJpbmdpZnkoWikucmVwbGFjZSgoL1xzL2cpLCIiKT09PVgpe3JldHVybiBKU09OfWlmKE9iamVjdC50b0pTT04pe2lmKE9iamVjdC50b0pTT04oWikucmVwbGFjZSgoL1xzL2cpLCIiKT09PVgpe1kuc3RyaW5naWZ5PU9iamVjdC50b0pTT059fWlmKHR5cGVvZiBTdHJpbmcucHJvdG90eXBlLmV2YWxKU09OPT09ImZ1bmN0aW9uIil7Wj1YLmV2YWxKU09OKCk7aWYoWi5hJiZaLmEubGVuZ3RoPT09MyYmWi5hWzJdPT09Myl7WS5wYXJzZT1mdW5jdGlvbihhYSl7cmV0dXJuIGFhLmV2YWxKU09OKCl9fX1pZihZLnN0cmluZ2lmeSYmWS5wYXJzZSl7Tz1mdW5jdGlvbigpe3JldHVybiBZfTtyZXR1cm4gWX1yZXR1cm4gbnVsbH07ZnVuY3Rpb24gVChYLFksWil7dmFyIGFiO2Zvcih2YXIgYWEgaW4gWSl7aWYoWS5oYXNPd25Qcm9wZXJ0eShhYSkpe2lmKGFhIGluIFgpe2FiPVlbYWFdO2lmKHR5cGVvZiBhYj09PSJvYmplY3QiKXtUKFhbYWFdLGFiLFopfWVsc2V7aWYoIVope1hbYWFdPVlbYWFdfX19ZWxzZXtYW2FhXT1ZW2FhXX19fXJldHVybiBYfWZ1bmN0aW9uIGEoKXt2YXIgWT1kLmJvZHkuYXBwZW5kQ2hpbGQoZC5jcmVhdGVFbGVtZW50KCJmb3JtIikpLFg9WS5hcHBlbmRDaGlsZChkLmNyZWF0ZUVsZW1lbnQoImlucHV0IikpO1gubmFtZT1VKyJURVNUIituO0U9WCE9PVkuZWxlbWVudHNbWC5uYW1lXTtkLmJvZHkucmVtb3ZlQ2hpbGQoWSl9ZnVuY3Rpb24gQShYKXtpZih0KEUpKXthKCl9dmFyIFo7aWYoRSl7Wj1kLmNyZWF0ZUVsZW1lbnQoJzxpZnJhbWUgbmFtZT0iJytYLnByb3BzLm5hbWUrJyIvPicpfWVsc2V7Wj1kLmNyZWF0ZUVsZW1lbnQoIklGUkFNRSIpO1oubmFtZT1YLnByb3BzLm5hbWV9Wi5pZD1aLm5hbWU9WC5wcm9wcy5uYW1lO2RlbGV0ZSBYLnByb3BzLm5hbWU7aWYoWC5vbkxvYWQpe3YoWiwibG9hZCIsWC5vbkxvYWQpfWlmKHR5cGVvZiBYLmNvbnRhaW5lcj09InN0cmluZyIpe1guY29udGFpbmVyPWQuZ2V0RWxlbWVudEJ5SWQoWC5jb250YWluZXIpfWlmKCFYLmNvbnRhaW5lcil7VChaLnN0eWxlLHtwb3NpdGlvbjoiYWJzb2x1dGUiLHRvcDoiLTIwMDBweCJ9KTtYLmNvbnRhaW5lcj1kLmJvZHl9dmFyIFk9WC5wcm9wcy5zcmM7ZGVsZXRlIFgucHJvcHMuc3JjO1QoWixYLnByb3BzKTtaLmJvcmRlcj1aLmZyYW1lQm9yZGVyPTA7Wi5hbGxvd1RyYW5zcGFyZW5jeT10cnVlO1guY29udGFpbmVyLmFwcGVuZENoaWxkKFopO1ouc3JjPVk7WC5wcm9wcy5zcmM9WTtyZXR1cm4gWn1mdW5jdGlvbiBWKGFhLFope2lmKHR5cGVvZiBhYT09InN0cmluZyIpe2FhPVthYV19dmFyIFksWD1hYS5sZW5ndGg7d2hpbGUoWC0tKXtZPWFhW1hdO1k9bmV3IFJlZ0V4cChZLnN1YnN0cigwLDEpPT0iXiI/WTooIl4iK1kucmVwbGFjZSgvKFwqKS9nLCIuJDEiKS5yZXBsYWNlKC9cPy9nLCIuIikrIiQiKSk7aWYoWS50ZXN0KFopKXtyZXR1cm4gdHJ1ZX19cmV0dXJuIGZhbHNlfWZ1bmN0aW9uIGwoWil7dmFyIGFlPVoucHJvdG9jb2wsWTtaLmlzSG9zdD1aLmlzSG9zdHx8dChTLnhkbV9wKTt5PVouaGFzaHx8ZmFsc2U7aWYoIVoucHJvcHMpe1oucHJvcHM9e319aWYoIVouaXNIb3N0KXtaLmNoYW5uZWw9Uy54ZG1fYztaLnNlY3JldD1TLnhkbV9zO1oucmVtb3RlPVMueGRtX2U7YWU9Uy54ZG1fcDtpZihaLmFjbCYmIVYoWi5hY2wsWi5yZW1vdGUpKXt0aHJvdyBuZXcgRXJyb3IoIkFjY2VzcyBkZW5pZWQgZm9yICIrWi5yZW1vdGUpfX1lbHNle1oucmVtb3RlPUIoWi5yZW1vdGUpO1ouY2hhbm5lbD1aLmNoYW5uZWx8fCJkZWZhdWx0IituKys7Wi5zZWNyZXQ9TWF0aC5yYW5kb20oKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDIpO2lmKHQoYWUpKXtpZihqKHAuaHJlZik9PWooWi5yZW1vdGUpKXthZT0iNCJ9ZWxzZXtpZihDKE4sInBvc3RNZXNzYWdlIil8fEMoZCwicG9zdE1lc3NhZ2UiKSl7YWU9IjEifWVsc2V7aWYoWi5zd2YmJkMoTiwiQWN0aXZlWE9iamVjdCIpJiZjKCkpe2FlPSI2In1lbHNle2lmKG5hdmlnYXRvci5wcm9kdWN0PT09IkdlY2tvIiYmImZyYW1lRWxlbWVudCIgaW4gTiYmbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJXZWJLaXQiKT09LTEpe2FlPSI1In1lbHNle2lmKFoucmVtb3RlSGVscGVyKXtaLnJlbW90ZUhlbHBlcj1CKFoucmVtb3RlSGVscGVyKTthZT0iMiJ9ZWxzZXthZT0iMCJ9fX19fX19Wi5wcm90b2NvbD1hZTtzd2l0Y2goYWUpe2Nhc2UiMCI6VChaLHtpbnRlcnZhbDoxMDAsZGVsYXk6MjAwMCx1c2VSZXNpemU6dHJ1ZSx1c2VQYXJlbnQ6ZmFsc2UsdXNlUG9sbGluZzpmYWxzZX0sdHJ1ZSk7aWYoWi5pc0hvc3Qpe2lmKCFaLmxvY2FsKXt2YXIgYWM9cC5wcm90b2NvbCsiLy8iK3AuaG9zdCxYPWQuYm9keS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW1nIiksYWQ7dmFyIGFhPVgubGVuZ3RoO3doaWxlKGFhLS0pe2FkPVhbYWFdO2lmKGFkLnNyYy5zdWJzdHJpbmcoMCxhYy5sZW5ndGgpPT09YWMpe1oubG9jYWw9YWQuc3JjO2JyZWFrfX1pZighWi5sb2NhbCl7Wi5sb2NhbD1OfX12YXIgYWI9e3hkbV9jOlouY2hhbm5lbCx4ZG1fcDowfTtpZihaLmxvY2FsPT09Til7Wi51c2VQb2xsaW5nPXRydWU7Wi51c2VQYXJlbnQ9dHJ1ZTtaLmxvY2FsPXAucHJvdG9jb2wrIi8vIitwLmhvc3QrcC5wYXRobmFtZStwLnNlYXJjaDthYi54ZG1fZT1aLmxvY2FsO2FiLnhkbV9wYT0xfWVsc2V7YWIueGRtX2U9QihaLmxvY2FsKX1pZihaLmNvbnRhaW5lcil7Wi51c2VSZXNpemU9ZmFsc2U7YWIueGRtX3BvPTF9Wi5yZW1vdGU9UChaLnJlbW90ZSxhYil9ZWxzZXtUKFose2NoYW5uZWw6Uy54ZG1fYyxyZW1vdGU6Uy54ZG1fZSx1c2VQYXJlbnQ6IXQoUy54ZG1fcGEpLHVzZVBvbGxpbmc6IXQoUy54ZG1fcG8pLHVzZVJlc2l6ZTpaLnVzZVBhcmVudD9mYWxzZTpaLnVzZVJlc2l6ZX0pfVk9W25ldyBvLnN0YWNrLkhhc2hUcmFuc3BvcnQoWiksbmV3IG8uc3RhY2suUmVsaWFibGVCZWhhdmlvcih7fSksbmV3IG8uc3RhY2suUXVldWVCZWhhdmlvcih7ZW5jb2RlOnRydWUsbWF4TGVuZ3RoOjQwMDAtWi5yZW1vdGUubGVuZ3RofSksbmV3IG8uc3RhY2suVmVyaWZ5QmVoYXZpb3Ioe2luaXRpYXRlOlouaXNIb3N0fSldO2JyZWFrO2Nhc2UiMSI6WT1bbmV3IG8uc3RhY2suUG9zdE1lc3NhZ2VUcmFuc3BvcnQoWildO2JyZWFrO2Nhc2UiMiI6WT1bbmV3IG8uc3RhY2suTmFtZVRyYW5zcG9ydChaKSxuZXcgby5zdGFjay5RdWV1ZUJlaGF2aW9yKCksbmV3IG8uc3RhY2suVmVyaWZ5QmVoYXZpb3Ioe2luaXRpYXRlOlouaXNIb3N0fSldO2JyZWFrO2Nhc2UiMyI6WT1bbmV3IG8uc3RhY2suTml4VHJhbnNwb3J0KFopXTticmVhaztjYXNlIjQiOlk9W25ldyBvLnN0YWNrLlNhbWVPcmlnaW5UcmFuc3BvcnQoWildO2JyZWFrO2Nhc2UiNSI6WT1bbmV3IG8uc3RhY2suRnJhbWVFbGVtZW50VHJhbnNwb3J0KFopXTticmVhaztjYXNlIjYiOmlmKCFpKXtjKCl9WT1bbmV3IG8uc3RhY2suRmxhc2hUcmFuc3BvcnQoWildO2JyZWFrfVkucHVzaChuZXcgby5zdGFjay5RdWV1ZUJlaGF2aW9yKHtsYXp5OloubGF6eSxyZW1vdmU6dHJ1ZX0pKTtyZXR1cm4gWX1mdW5jdGlvbiBEKGFhKXt2YXIgYWIsWj17aW5jb21pbmc6ZnVuY3Rpb24oYWQsYWMpe3RoaXMudXAuaW5jb21pbmcoYWQsYWMpfSxvdXRnb2luZzpmdW5jdGlvbihhYyxhZCl7dGhpcy5kb3duLm91dGdvaW5nKGFjLGFkKX0sY2FsbGJhY2s6ZnVuY3Rpb24oYWMpe3RoaXMudXAuY2FsbGJhY2soYWMpfSxpbml0OmZ1bmN0aW9uKCl7dGhpcy5kb3duLmluaXQoKX0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZG93bi5kZXN0cm95KCl9fTtmb3IodmFyIFk9MCxYPWFhLmxlbmd0aDtZPFg7WSsrKXthYj1hYVtZXTtUKGFiLFosdHJ1ZSk7aWYoWSE9PTApe2FiLmRvd249YWFbWS0xXX1pZihZIT09WC0xKXthYi51cD1hYVtZKzFdfX1yZXR1cm4gYWJ9ZnVuY3Rpb24gdyhYKXtYLnVwLmRvd249WC5kb3duO1guZG93bi51cD1YLnVwO1gudXA9WC5kb3duPW51bGx9VChvLHt2ZXJzaW9uOiIyLjQuMTUuMTE4IixxdWVyeTpTLHN0YWNrOnt9LGFwcGx5OlQsZ2V0SlNPTk9iamVjdDpPLHdoZW5SZWFkeTpHLG5vQ29uZmxpY3Q6ZX0pO28uRG9tSGVscGVyPXtvbjp2LHVuOngscmVxdWlyZXNKU09OOmZ1bmN0aW9uKFgpe2lmKCF1KE4sIkpTT04iKSl7ZC53cml0ZSgnPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iJytYKyciPjxcL3NjcmlwdD4nKX19fTsoZnVuY3Rpb24oKXt2YXIgWD17fTtvLkZuPXtzZXQ6ZnVuY3Rpb24oWSxaKXtYW1ldPVp9LGdldDpmdW5jdGlvbihaLFkpe3ZhciBhYT1YW1pdO2lmKFkpe2RlbGV0ZSBYW1pdfXJldHVybiBhYX19fSgpKTtvLlNvY2tldD1mdW5jdGlvbihZKXt2YXIgWD1EKGwoWSkuY29uY2F0KFt7aW5jb21pbmc6ZnVuY3Rpb24oYWIsYWEpe1kub25NZXNzYWdlKGFiLGFhKX0sY2FsbGJhY2s6ZnVuY3Rpb24oYWEpe2lmKFkub25SZWFkeSl7WS5vblJlYWR5KGFhKX19fV0pKSxaPWooWS5yZW1vdGUpO3RoaXMub3JpZ2luPWooWS5yZW1vdGUpO3RoaXMuZGVzdHJveT1mdW5jdGlvbigpe1guZGVzdHJveSgpfTt0aGlzLnBvc3RNZXNzYWdlPWZ1bmN0aW9uKGFhKXtYLm91dGdvaW5nKGFhLFopfTtYLmluaXQoKX07by5ScGM9ZnVuY3Rpb24oWixZKXtpZihZLmxvY2FsKXtmb3IodmFyIGFiIGluIFkubG9jYWwpe2lmKFkubG9jYWwuaGFzT3duUHJvcGVydHkoYWIpKXt2YXIgYWE9WS5sb2NhbFthYl07aWYodHlwZW9mIGFhPT09ImZ1bmN0aW9uIil7WS5sb2NhbFthYl09e21ldGhvZDphYX19fX19dmFyIFg9RChsKFopLmNvbmNhdChbbmV3IG8uc3RhY2suUnBjQmVoYXZpb3IodGhpcyxZKSx7Y2FsbGJhY2s6ZnVuY3Rpb24oYWMpe2lmKFoub25SZWFkeSl7Wi5vblJlYWR5KGFjKX19fV0pKTt0aGlzLm9yaWdpbj1qKFoucmVtb3RlKTt0aGlzLmRlc3Ryb3k9ZnVuY3Rpb24oKXtYLmRlc3Ryb3koKX07WC5pbml0KCl9O28uc3RhY2suU2FtZU9yaWdpblRyYW5zcG9ydD1mdW5jdGlvbihZKXt2YXIgWixhYixhYSxYO3JldHVybihaPXtvdXRnb2luZzpmdW5jdGlvbihhZCxhZSxhYyl7YWEoYWQpO2lmKGFjKXthYygpfX0sZGVzdHJveTpmdW5jdGlvbigpe2lmKGFiKXthYi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFiKTthYj1udWxsfX0sb25ET01SZWFkeTpmdW5jdGlvbigpe1g9aihZLnJlbW90ZSk7aWYoWS5pc0hvc3Qpe1QoWS5wcm9wcyx7c3JjOlAoWS5yZW1vdGUse3hkbV9lOnAucHJvdG9jb2wrIi8vIitwLmhvc3QrcC5wYXRobmFtZSx4ZG1fYzpZLmNoYW5uZWwseGRtX3A6NH0pLG5hbWU6VStZLmNoYW5uZWwrIl9wcm92aWRlciJ9KTthYj1BKFkpO28uRm4uc2V0KFkuY2hhbm5lbCxmdW5jdGlvbihhYyl7YWE9YWM7SyhmdW5jdGlvbigpe1oudXAuY2FsbGJhY2sodHJ1ZSl9LDApO3JldHVybiBmdW5jdGlvbihhZCl7Wi51cC5pbmNvbWluZyhhZCxYKX19KX1lbHNle2FhPW0oKS5Gbi5nZXQoWS5jaGFubmVsLHRydWUpKGZ1bmN0aW9uKGFjKXtaLnVwLmluY29taW5nKGFjLFgpfSk7SyhmdW5jdGlvbigpe1oudXAuY2FsbGJhY2sodHJ1ZSl9LDApfX0saW5pdDpmdW5jdGlvbigpe0coWi5vbkRPTVJlYWR5LFopfX0pfTtvLnN0YWNrLkZsYXNoVHJhbnNwb3J0PWZ1bmN0aW9uKGFhKXt2YXIgYWMsWCxhYixhZCxZLGFlO2Z1bmN0aW9uIGFmKGFoLGFnKXtLKGZ1bmN0aW9uKCl7YWMudXAuaW5jb21pbmcoYWgsYWQpfSwwKX1mdW5jdGlvbiBaKGFoKXt2YXIgYWc9YWEuc3dmKyI/aG9zdD0iK2FhLmlzSG9zdDt2YXIgYWo9ImVhc3lYRE1fc3dmXyIrTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKjEwMDAwKTtvLkZuLnNldCgiZmxhc2hfbG9hZGVkIithaC5yZXBsYWNlKC9bXC0uXS9nLCJfIiksZnVuY3Rpb24oKXtvLnN0YWNrLkZsYXNoVHJhbnNwb3J0W2FoXS5zd2Y9WT1hZS5maXJzdENoaWxkO3ZhciBhaz1vLnN0YWNrLkZsYXNoVHJhbnNwb3J0W2FoXS5xdWV1ZTtmb3IodmFyIGFsPTA7YWw8YWsubGVuZ3RoO2FsKyspe2FrW2FsXSgpfWFrLmxlbmd0aD0wfSk7aWYoYWEuc3dmQ29udGFpbmVyKXthZT0odHlwZW9mIGFhLnN3ZkNvbnRhaW5lcj09InN0cmluZyIpP2QuZ2V0RWxlbWVudEJ5SWQoYWEuc3dmQ29udGFpbmVyKTphYS5zd2ZDb250YWluZXJ9ZWxzZXthZT1kLmNyZWF0ZUVsZW1lbnQoImRpdiIpO1QoYWUuc3R5bGUsaCYmYWEuc3dmTm9UaHJvdHRsZT97aGVpZ2h0OiIyMHB4Iix3aWR0aDoiMjBweCIscG9zaXRpb246ImZpeGVkIixyaWdodDowLHRvcDowfTp7aGVpZ2h0OiIxcHgiLHdpZHRoOiIxcHgiLHBvc2l0aW9uOiJhYnNvbHV0ZSIsb3ZlcmZsb3c6ImhpZGRlbiIscmlnaHQ6MCx0b3A6MH0pO2QuYm9keS5hcHBlbmRDaGlsZChhZSl9dmFyIGFpPSJjYWxsYmFjaz1mbGFzaF9sb2FkZWQiK2FoLnJlcGxhY2UoL1tcLS5dL2csIl8iKSsiJnByb3RvPSIrYi5sb2NhdGlvbi5wcm90b2NvbCsiJmRvbWFpbj0iK3ooYi5sb2NhdGlvbi5ocmVmKSsiJnBvcnQ9IitmKGIubG9jYXRpb24uaHJlZikrIiZucz0iK0k7YWUuaW5uZXJIVE1MPSI8b2JqZWN0IGhlaWdodD0nMjAnIHdpZHRoPScyMCcgdHlwZT0nYXBwbGljYXRpb24veC1zaG9ja3dhdmUtZmxhc2gnIGlkPSciK2FqKyInIGRhdGE9JyIrYWcrIic+PHBhcmFtIG5hbWU9J2FsbG93U2NyaXB0QWNjZXNzJyB2YWx1ZT0nYWx3YXlzJz48L3BhcmFtPjxwYXJhbSBuYW1lPSd3bW9kZScgdmFsdWU9J3RyYW5zcGFyZW50Jz48cGFyYW0gbmFtZT0nbW92aWUnIHZhbHVlPSciK2FnKyInPjwvcGFyYW0+PHBhcmFtIG5hbWU9J2ZsYXNodmFycycgdmFsdWU9JyIrYWkrIic+PC9wYXJhbT48ZW1iZWQgdHlwZT0nYXBwbGljYXRpb24veC1zaG9ja3dhdmUtZmxhc2gnIEZsYXNoVmFycz0nIithaSsiJyBhbGxvd1NjcmlwdEFjY2Vzcz0nYWx3YXlzJyB3bW9kZT0ndHJhbnNwYXJlbnQnIHNyYz0nIithZysiJyBoZWlnaHQ9JzEnIHdpZHRoPScxJz48L2VtYmVkPjwvb2JqZWN0PiJ9cmV0dXJuKGFjPXtvdXRnb2luZzpmdW5jdGlvbihhaCxhaSxhZyl7WS5wb3N0TWVzc2FnZShhYS5jaGFubmVsLGFoLnRvU3RyaW5nKCkpO2lmKGFnKXthZygpfX0sZGVzdHJveTpmdW5jdGlvbigpe3RyeXtZLmRlc3Ryb3lDaGFubmVsKGFhLmNoYW5uZWwpfWNhdGNoKGFnKXt9WT1udWxsO2lmKFgpe1gucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChYKTtYPW51bGx9fSxvbkRPTVJlYWR5OmZ1bmN0aW9uKCl7YWQ9YWEucmVtb3RlO28uRm4uc2V0KCJmbGFzaF8iK2FhLmNoYW5uZWwrIl9pbml0IixmdW5jdGlvbigpe0soZnVuY3Rpb24oKXthYy51cC5jYWxsYmFjayh0cnVlKX0pfSk7by5Gbi5zZXQoImZsYXNoXyIrYWEuY2hhbm5lbCsiX29uTWVzc2FnZSIsYWYpO2FhLnN3Zj1CKGFhLnN3Zik7dmFyIGFoPXooYWEuc3dmKTt2YXIgYWc9ZnVuY3Rpb24oKXtvLnN0YWNrLkZsYXNoVHJhbnNwb3J0W2FoXS5pbml0PXRydWU7WT1vLnN0YWNrLkZsYXNoVHJhbnNwb3J0W2FoXS5zd2Y7WS5jcmVhdGVDaGFubmVsKGFhLmNoYW5uZWwsYWEuc2VjcmV0LGooYWEucmVtb3RlKSxhYS5pc0hvc3QpO2lmKGFhLmlzSG9zdCl7aWYoaCYmYWEuc3dmTm9UaHJvdHRsZSl7VChhYS5wcm9wcyx7cG9zaXRpb246ImZpeGVkIixyaWdodDowLHRvcDowLGhlaWdodDoiMjBweCIsd2lkdGg6IjIwcHgifSl9VChhYS5wcm9wcyx7c3JjOlAoYWEucmVtb3RlLHt4ZG1fZTpqKHAuaHJlZikseGRtX2M6YWEuY2hhbm5lbCx4ZG1fcDo2LHhkbV9zOmFhLnNlY3JldH0pLG5hbWU6VSthYS5jaGFubmVsKyJfcHJvdmlkZXIifSk7WD1BKGFhKX19O2lmKG8uc3RhY2suRmxhc2hUcmFuc3BvcnRbYWhdJiZvLnN0YWNrLkZsYXNoVHJhbnNwb3J0W2FoXS5pbml0KXthZygpfWVsc2V7aWYoIW8uc3RhY2suRmxhc2hUcmFuc3BvcnRbYWhdKXtvLnN0YWNrLkZsYXNoVHJhbnNwb3J0W2FoXT17cXVldWU6W2FnXX07WihhaCl9ZWxzZXtvLnN0YWNrLkZsYXNoVHJhbnNwb3J0W2FoXS5xdWV1ZS5wdXNoKGFnKX19fSxpbml0OmZ1bmN0aW9uKCl7RyhhYy5vbkRPTVJlYWR5LGFjKX19KX07by5zdGFjay5Qb3N0TWVzc2FnZVRyYW5zcG9ydD1mdW5jdGlvbihhYSl7dmFyIGFjLGFkLFksWjtmdW5jdGlvbiBYKGFlKXtpZihhZS5vcmlnaW4pe3JldHVybiBqKGFlLm9yaWdpbil9aWYoYWUudXJpKXtyZXR1cm4gaihhZS51cmkpfWlmKGFlLmRvbWFpbil7cmV0dXJuIHAucHJvdG9jb2wrIi8vIithZS5kb21haW59dGhyb3ciVW5hYmxlIHRvIHJldHJpZXZlIHRoZSBvcmlnaW4gb2YgdGhlIGV2ZW50In1mdW5jdGlvbiBhYihhZil7dmFyIGFlPVgoYWYpO2lmKGFlPT1aJiZhZi5kYXRhLnN1YnN0cmluZygwLGFhLmNoYW5uZWwubGVuZ3RoKzEpPT1hYS5jaGFubmVsKyIgIil7YWMudXAuaW5jb21pbmcoYWYuZGF0YS5zdWJzdHJpbmcoYWEuY2hhbm5lbC5sZW5ndGgrMSksYWUpfX1yZXR1cm4oYWM9e291dGdvaW5nOmZ1bmN0aW9uKGFmLGFnLGFlKXtZLnBvc3RNZXNzYWdlKGFhLmNoYW5uZWwrIiAiK2FmLGFnfHxaKTtpZihhZSl7YWUoKX19LGRlc3Ryb3k6ZnVuY3Rpb24oKXt4KE4sIm1lc3NhZ2UiLGFiKTtpZihhZCl7WT1udWxsO2FkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYWQpO2FkPW51bGx9fSxvbkRPTVJlYWR5OmZ1bmN0aW9uKCl7Wj1qKGFhLnJlbW90ZSk7aWYoYWEuaXNIb3N0KXt2YXIgYWU9ZnVuY3Rpb24oYWYpe2lmKGFmLmRhdGE9PWFhLmNoYW5uZWwrIi1yZWFkeSIpe1k9KCJwb3N0TWVzc2FnZSIgaW4gYWQuY29udGVudFdpbmRvdyk/YWQuY29udGVudFdpbmRvdzphZC5jb250ZW50V2luZG93LmRvY3VtZW50O3goTiwibWVzc2FnZSIsYWUpO3YoTiwibWVzc2FnZSIsYWIpO0soZnVuY3Rpb24oKXthYy51cC5jYWxsYmFjayh0cnVlKX0sMCl9fTt2KE4sIm1lc3NhZ2UiLGFlKTtUKGFhLnByb3BzLHtzcmM6UChhYS5yZW1vdGUse3hkbV9lOmoocC5ocmVmKSx4ZG1fYzphYS5jaGFubmVsLHhkbV9wOjF9KSxuYW1lOlUrYWEuY2hhbm5lbCsiX3Byb3ZpZGVyIn0pO2FkPUEoYWEpfWVsc2V7dihOLCJtZXNzYWdlIixhYik7WT0oInBvc3RNZXNzYWdlIiBpbiBOLnBhcmVudCk/Ti5wYXJlbnQ6Ti5wYXJlbnQuZG9jdW1lbnQ7WS5wb3N0TWVzc2FnZShhYS5jaGFubmVsKyItcmVhZHkiLFopO0soZnVuY3Rpb24oKXthYy51cC5jYWxsYmFjayh0cnVlKX0sMCl9fSxpbml0OmZ1bmN0aW9uKCl7RyhhYy5vbkRPTVJlYWR5LGFjKX19KX07by5zdGFjay5GcmFtZUVsZW1lbnRUcmFuc3BvcnQ9ZnVuY3Rpb24oWSl7dmFyIFosYWIsYWEsWDtyZXR1cm4oWj17b3V0Z29pbmc6ZnVuY3Rpb24oYWQsYWUsYWMpe2FhLmNhbGwodGhpcyxhZCk7aWYoYWMpe2FjKCl9fSxkZXN0cm95OmZ1bmN0aW9uKCl7aWYoYWIpe2FiLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYWIpO2FiPW51bGx9fSxvbkRPTVJlYWR5OmZ1bmN0aW9uKCl7WD1qKFkucmVtb3RlKTtpZihZLmlzSG9zdCl7VChZLnByb3BzLHtzcmM6UChZLnJlbW90ZSx7eGRtX2U6aihwLmhyZWYpLHhkbV9jOlkuY2hhbm5lbCx4ZG1fcDo1fSksbmFtZTpVK1kuY2hhbm5lbCsiX3Byb3ZpZGVyIn0pO2FiPUEoWSk7YWIuZm49ZnVuY3Rpb24oYWMpe2RlbGV0ZSBhYi5mbjthYT1hYztLKGZ1bmN0aW9uKCl7Wi51cC5jYWxsYmFjayh0cnVlKX0sMCk7cmV0dXJuIGZ1bmN0aW9uKGFkKXtaLnVwLmluY29taW5nKGFkLFgpfX19ZWxzZXtpZihkLnJlZmVycmVyJiZqKGQucmVmZXJyZXIpIT1TLnhkbV9lKXtOLnRvcC5sb2NhdGlvbj1TLnhkbV9lfWFhPU4uZnJhbWVFbGVtZW50LmZuKGZ1bmN0aW9uKGFjKXtaLnVwLmluY29taW5nKGFjLFgpfSk7Wi51cC5jYWxsYmFjayh0cnVlKX19LGluaXQ6ZnVuY3Rpb24oKXtHKFoub25ET01SZWFkeSxaKX19KX07by5zdGFjay5OYW1lVHJhbnNwb3J0PWZ1bmN0aW9uKGFiKXt2YXIgYWM7dmFyIGFlLGFpLGFhLGFnLGFoLFksWDtmdW5jdGlvbiBhZihhbCl7dmFyIGFrPWFiLnJlbW90ZUhlbHBlcisoYWU/IiNfMyI6IiNfMiIpK2FiLmNoYW5uZWw7YWkuY29udGVudFdpbmRvdy5zZW5kTWVzc2FnZShhbCxhayl9ZnVuY3Rpb24gYWQoKXtpZihhZSl7aWYoKythZz09PTJ8fCFhZSl7YWMudXAuY2FsbGJhY2sodHJ1ZSl9fWVsc2V7YWYoInJlYWR5Iik7YWMudXAuY2FsbGJhY2sodHJ1ZSl9fWZ1bmN0aW9uIGFqKGFrKXthYy51cC5pbmNvbWluZyhhayxZKX1mdW5jdGlvbiBaKCl7aWYoYWgpe0soZnVuY3Rpb24oKXthaCh0cnVlKX0sMCl9fXJldHVybihhYz17b3V0Z29pbmc6ZnVuY3Rpb24oYWwsYW0sYWspe2FoPWFrO2FmKGFsKX0sZGVzdHJveTpmdW5jdGlvbigpe2FpLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYWkpO2FpPW51bGw7aWYoYWUpe2FhLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYWEpO2FhPW51bGx9fSxvbkRPTVJlYWR5OmZ1bmN0aW9uKCl7YWU9YWIuaXNIb3N0O2FnPTA7WT1qKGFiLnJlbW90ZSk7YWIubG9jYWw9QihhYi5sb2NhbCk7aWYoYWUpe28uRm4uc2V0KGFiLmNoYW5uZWwsZnVuY3Rpb24oYWwpe2lmKGFlJiZhbD09PSJyZWFkeSIpe28uRm4uc2V0KGFiLmNoYW5uZWwsYWopO2FkKCl9fSk7WD1QKGFiLnJlbW90ZSx7eGRtX2U6YWIubG9jYWwseGRtX2M6YWIuY2hhbm5lbCx4ZG1fcDoyfSk7VChhYi5wcm9wcyx7c3JjOlgrIiMiK2FiLmNoYW5uZWwsbmFtZTpVK2FiLmNoYW5uZWwrIl9wcm92aWRlciJ9KTthYT1BKGFiKX1lbHNle2FiLnJlbW90ZUhlbHBlcj1hYi5yZW1vdGU7by5Gbi5zZXQoYWIuY2hhbm5lbCxhail9YWk9QSh7cHJvcHM6e3NyYzphYi5sb2NhbCsiI180IithYi5jaGFubmVsfSxvbkxvYWQ6ZnVuY3Rpb24gYWsoKXt2YXIgYWw9YWl8fHRoaXM7eChhbCwibG9hZCIsYWspO28uRm4uc2V0KGFiLmNoYW5uZWwrIl9sb2FkIixaKTsoZnVuY3Rpb24gYW0oKXtpZih0eXBlb2YgYWwuY29udGVudFdpbmRvdy5zZW5kTWVzc2FnZT09ImZ1bmN0aW9uIil7YWQoKX1lbHNle0soYW0sNTApfX0oKSl9fSl9LGluaXQ6ZnVuY3Rpb24oKXtHKGFjLm9uRE9NUmVhZHksYWMpfX0pfTtvLnN0YWNrLkhhc2hUcmFuc3BvcnQ9ZnVuY3Rpb24oWil7dmFyIGFjO3ZhciBhaD10aGlzLGFmLGFhLFgsYWQsYW0sYWIsYWw7dmFyIGFnLFk7ZnVuY3Rpb24gYWsoYW8pe2lmKCFhbCl7cmV0dXJufXZhciBhbj1aLnJlbW90ZSsiIyIrKGFtKyspKyJfIithbzsoKGFmfHwhYWcpP2FsLmNvbnRlbnRXaW5kb3c6YWwpLmxvY2F0aW9uPWFufWZ1bmN0aW9uIGFlKGFuKXthZD1hbjthYy51cC5pbmNvbWluZyhhZC5zdWJzdHJpbmcoYWQuaW5kZXhPZigiXyIpKzEpLFkpfWZ1bmN0aW9uIGFqKCl7aWYoIWFiKXtyZXR1cm59dmFyIGFuPWFiLmxvY2F0aW9uLmhyZWYsYXA9IiIsYW89YW4uaW5kZXhPZigiIyIpO2lmKGFvIT0tMSl7YXA9YW4uc3Vic3RyaW5nKGFvKX1pZihhcCYmYXAhPWFkKXthZShhcCl9fWZ1bmN0aW9uIGFpKCl7YWE9c2V0SW50ZXJ2YWwoYWosWCl9cmV0dXJuKGFjPXtvdXRnb2luZzpmdW5jdGlvbihhbixhbyl7YWsoYW4pfSxkZXN0cm95OmZ1bmN0aW9uKCl7Ti5jbGVhckludGVydmFsKGFhKTtpZihhZnx8IWFnKXthbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFsKX1hbD1udWxsfSxvbkRPTVJlYWR5OmZ1bmN0aW9uKCl7YWY9Wi5pc0hvc3Q7WD1aLmludGVydmFsO2FkPSIjIitaLmNoYW5uZWw7YW09MDthZz1aLnVzZVBhcmVudDtZPWooWi5yZW1vdGUpO2lmKGFmKXtaLnByb3BzPXtzcmM6Wi5yZW1vdGUsbmFtZTpVK1ouY2hhbm5lbCsiX3Byb3ZpZGVyIn07aWYoYWcpe1oub25Mb2FkPWZ1bmN0aW9uKCl7YWI9TjthaSgpO2FjLnVwLmNhbGxiYWNrKHRydWUpfX1lbHNle3ZhciBhcD0wLGFuPVouZGVsYXkvNTA7KGZ1bmN0aW9uIGFvKCl7aWYoKythcD5hbil7dGhyb3cgbmV3IEVycm9yKCJVbmFibGUgdG8gcmVmZXJlbmNlIGxpc3RlbmVyd2luZG93Iil9dHJ5e2FiPWFsLmNvbnRlbnRXaW5kb3cuZnJhbWVzW1UrWi5jaGFubmVsKyJfY29uc3VtZXIiXX1jYXRjaChhcSl7fWlmKGFiKXthaSgpO2FjLnVwLmNhbGxiYWNrKHRydWUpfWVsc2V7Syhhbyw1MCl9fSgpKX1hbD1BKFopfWVsc2V7YWI9TjthaSgpO2lmKGFnKXthbD1wYXJlbnQ7YWMudXAuY2FsbGJhY2sodHJ1ZSl9ZWxzZXtUKFose3Byb3BzOntzcmM6Wi5yZW1vdGUrIiMiK1ouY2hhbm5lbCtuZXcgRGF0ZSgpLG5hbWU6VStaLmNoYW5uZWwrIl9jb25zdW1lciJ9LG9uTG9hZDpmdW5jdGlvbigpe2FjLnVwLmNhbGxiYWNrKHRydWUpfX0pO2FsPUEoWil9fX0saW5pdDpmdW5jdGlvbigpe0coYWMub25ET01SZWFkeSxhYyl9fSl9O28uc3RhY2suUmVsaWFibGVCZWhhdmlvcj1mdW5jdGlvbihZKXt2YXIgYWEsYWM7dmFyIGFiPTAsWD0wLFo9IiI7cmV0dXJuKGFhPXtpbmNvbWluZzpmdW5jdGlvbihhZixhZCl7dmFyIGFlPWFmLmluZGV4T2YoIl8iKSxhZz1hZi5zdWJzdHJpbmcoMCxhZSkuc3BsaXQoIiwiKTthZj1hZi5zdWJzdHJpbmcoYWUrMSk7aWYoYWdbMF09PWFiKXtaPSIiO2lmKGFjKXthYyh0cnVlKX19aWYoYWYubGVuZ3RoPjApe2FhLmRvd24ub3V0Z29pbmcoYWdbMV0rIiwiK2FiKyJfIitaLGFkKTtpZihYIT1hZ1sxXSl7WD1hZ1sxXTthYS51cC5pbmNvbWluZyhhZixhZCl9fX0sb3V0Z29pbmc6ZnVuY3Rpb24oYWYsYWQsYWUpe1o9YWY7YWM9YWU7YWEuZG93bi5vdXRnb2luZyhYKyIsIisoKythYikrIl8iK2FmLGFkKX19KX07by5zdGFjay5RdWV1ZUJlaGF2aW9yPWZ1bmN0aW9uKFope3ZhciBhYyxhZD1bXSxhZz10cnVlLGFhPSIiLGFmLFg9MCxZPWZhbHNlLGFiPWZhbHNlO2Z1bmN0aW9uIGFlKCl7aWYoWi5yZW1vdmUmJmFkLmxlbmd0aD09PTApe3coYWMpO3JldHVybn1pZihhZ3x8YWQubGVuZ3RoPT09MHx8YWYpe3JldHVybn1hZz10cnVlO3ZhciBhaD1hZC5zaGlmdCgpO2FjLmRvd24ub3V0Z29pbmcoYWguZGF0YSxhaC5vcmlnaW4sZnVuY3Rpb24oYWkpe2FnPWZhbHNlO2lmKGFoLmNhbGxiYWNrKXtLKGZ1bmN0aW9uKCl7YWguY2FsbGJhY2soYWkpfSwwKX1hZSgpfSl9cmV0dXJuKGFjPXtpbml0OmZ1bmN0aW9uKCl7aWYodChaKSl7Wj17fX1pZihaLm1heExlbmd0aCl7WD1aLm1heExlbmd0aDthYj10cnVlfWlmKFoubGF6eSl7WT10cnVlfWVsc2V7YWMuZG93bi5pbml0KCl9fSxjYWxsYmFjazpmdW5jdGlvbihhaSl7YWc9ZmFsc2U7dmFyIGFoPWFjLnVwO2FlKCk7YWguY2FsbGJhY2soYWkpfSxpbmNvbWluZzpmdW5jdGlvbihhayxhaSl7aWYoYWIpe3ZhciBhaj1hay5pbmRleE9mKCJfIiksYWg9cGFyc2VJbnQoYWsuc3Vic3RyaW5nKDAsYWopLDEwKTthYSs9YWsuc3Vic3RyaW5nKGFqKzEpO2lmKGFoPT09MCl7aWYoWi5lbmNvZGUpe2FhPWsoYWEpfWFjLnVwLmluY29taW5nKGFhLGFpKTthYT0iIn19ZWxzZXthYy51cC5pbmNvbWluZyhhayxhaSl9fSxvdXRnb2luZzpmdW5jdGlvbihhbCxhaSxhayl7aWYoWi5lbmNvZGUpe2FsPUgoYWwpfXZhciBhaD1bXSxhajtpZihhYil7d2hpbGUoYWwubGVuZ3RoIT09MCl7YWo9YWwuc3Vic3RyaW5nKDAsWCk7YWw9YWwuc3Vic3RyaW5nKGFqLmxlbmd0aCk7YWgucHVzaChhail9d2hpbGUoKGFqPWFoLnNoaWZ0KCkpKXthZC5wdXNoKHtkYXRhOmFoLmxlbmd0aCsiXyIrYWosb3JpZ2luOmFpLGNhbGxiYWNrOmFoLmxlbmd0aD09PTA/YWs6bnVsbH0pfX1lbHNle2FkLnB1c2goe2RhdGE6YWwsb3JpZ2luOmFpLGNhbGxiYWNrOmFrfSl9aWYoWSl7YWMuZG93bi5pbml0KCl9ZWxzZXthZSgpfX0sZGVzdHJveTpmdW5jdGlvbigpe2FmPXRydWU7YWMuZG93bi5kZXN0cm95KCl9fSl9O28uc3RhY2suVmVyaWZ5QmVoYXZpb3I9ZnVuY3Rpb24oYWIpe3ZhciBhYyxhYSxZLFo9ZmFsc2U7ZnVuY3Rpb24gWCgpe2FhPU1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygyKTthYy5kb3duLm91dGdvaW5nKGFhKX1yZXR1cm4oYWM9e2luY29taW5nOmZ1bmN0aW9uKGFmLGFkKXt2YXIgYWU9YWYuaW5kZXhPZigiXyIpO2lmKGFlPT09LTEpe2lmKGFmPT09YWEpe2FjLnVwLmNhbGxiYWNrKHRydWUpfWVsc2V7aWYoIVkpe1k9YWY7aWYoIWFiLmluaXRpYXRlKXtYKCl9YWMuZG93bi5vdXRnb2luZyhhZil9fX1lbHNle2lmKGFmLnN1YnN0cmluZygwLGFlKT09PVkpe2FjLnVwLmluY29taW5nKGFmLnN1YnN0cmluZyhhZSsxKSxhZCl9fX0sb3V0Z29pbmc6ZnVuY3Rpb24oYWYsYWQsYWUpe2FjLmRvd24ub3V0Z29pbmcoYWErIl8iK2FmLGFkLGFlKX0sY2FsbGJhY2s6ZnVuY3Rpb24oYWQpe2lmKGFiLmluaXRpYXRlKXtYKCl9fX0pfTtvLnN0YWNrLlJwY0JlaGF2aW9yPWZ1bmN0aW9uKGFkLFkpe3ZhciBhYSxhZj1ZLnNlcmlhbGl6ZXJ8fE8oKTt2YXIgYWU9MCxhYz17fTtmdW5jdGlvbiBYKGFnKXthZy5qc29ucnBjPSIyLjAiO2FhLmRvd24ub3V0Z29pbmcoYWYuc3RyaW5naWZ5KGFnKSl9ZnVuY3Rpb24gYWIoYWcsYWkpe3ZhciBhaD1BcnJheS5wcm90b3R5cGUuc2xpY2U7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGFqPWFyZ3VtZW50cy5sZW5ndGgsYWwsYWs9e21ldGhvZDphaX07aWYoYWo+MCYmdHlwZW9mIGFyZ3VtZW50c1thai0xXT09PSJmdW5jdGlvbiIpe2lmKGFqPjEmJnR5cGVvZiBhcmd1bWVudHNbYWotMl09PT0iZnVuY3Rpb24iKXthbD17c3VjY2Vzczphcmd1bWVudHNbYWotMl0sZXJyb3I6YXJndW1lbnRzW2FqLTFdfTthay5wYXJhbXM9YWguY2FsbChhcmd1bWVudHMsMCxhai0yKX1lbHNle2FsPXtzdWNjZXNzOmFyZ3VtZW50c1thai0xXX07YWsucGFyYW1zPWFoLmNhbGwoYXJndW1lbnRzLDAsYWotMSl9YWNbIiIrKCsrYWUpXT1hbDthay5pZD1hZX1lbHNle2FrLnBhcmFtcz1haC5jYWxsKGFyZ3VtZW50cywwKX1pZihhZy5uYW1lZFBhcmFtcyYmYWsucGFyYW1zLmxlbmd0aD09PTEpe2FrLnBhcmFtcz1hay5wYXJhbXNbMF19WChhayl9fWZ1bmN0aW9uIFooYW4sYW0sYWksYWwpe2lmKCFhaSl7aWYoYW0pe1goe2lkOmFtLGVycm9yOntjb2RlOi0zMjYwMSxtZXNzYWdlOiJQcm9jZWR1cmUgbm90IGZvdW5kLiJ9fSl9cmV0dXJufXZhciBhayxhaDtpZihhbSl7YWs9ZnVuY3Rpb24oYW8pe2FrPXE7WCh7aWQ6YW0scmVzdWx0OmFvfSl9O2FoPWZ1bmN0aW9uKGFvLGFwKXthaD1xO3ZhciBhcT17aWQ6YW0sZXJyb3I6e2NvZGU6LTMyMDk5LG1lc3NhZ2U6YW99fTtpZihhcCl7YXEuZXJyb3IuZGF0YT1hcH1YKGFxKX19ZWxzZXthaz1haD1xfWlmKCFyKGFsKSl7YWw9W2FsXX10cnl7dmFyIGFnPWFpLm1ldGhvZC5hcHBseShhaS5zY29wZSxhbC5jb25jYXQoW2FrLGFoXSkpO2lmKCF0KGFnKSl7YWsoYWcpfX1jYXRjaChhail7YWgoYWoubWVzc2FnZSl9fXJldHVybihhYT17aW5jb21pbmc6ZnVuY3Rpb24oYWgsYWcpe3ZhciBhaT1hZi5wYXJzZShhaCk7aWYoYWkubWV0aG9kKXtpZihZLmhhbmRsZSl7WS5oYW5kbGUoYWksWCl9ZWxzZXtaKGFpLm1ldGhvZCxhaS5pZCxZLmxvY2FsW2FpLm1ldGhvZF0sYWkucGFyYW1zKX19ZWxzZXt2YXIgYWo9YWNbYWkuaWRdO2lmKGFpLmVycm9yKXtpZihhai5lcnJvcil7YWouZXJyb3IoYWkuZXJyb3IpfX1lbHNle2lmKGFqLnN1Y2Nlc3Mpe2FqLnN1Y2Nlc3MoYWkucmVzdWx0KX19ZGVsZXRlIGFjW2FpLmlkXX19LGluaXQ6ZnVuY3Rpb24oKXtpZihZLnJlbW90ZSl7Zm9yKHZhciBhZyBpbiBZLnJlbW90ZSl7aWYoWS5yZW1vdGUuaGFzT3duUHJvcGVydHkoYWcpKXthZFthZ109YWIoWS5yZW1vdGVbYWddLGFnKX19fWFhLmRvd24uaW5pdCgpfSxkZXN0cm95OmZ1bmN0aW9uKCl7Zm9yKHZhciBhZyBpbiBZLnJlbW90ZSl7aWYoWS5yZW1vdGUuaGFzT3duUHJvcGVydHkoYWcpJiZhZC5oYXNPd25Qcm9wZXJ0eShhZykpe2RlbGV0ZSBhZFthZ119fWFhLmRvd24uZGVzdHJveSgpfX0pfTtiLmVhc3lYRE09b30pKHdpbmRvdyxkb2N1bWVudCxsb2NhdGlvbix3aW5kb3cuc2V0VGltZW91dCxkZWNvZGVVUklDb21wb25lbnQsZW5jb2RlVVJJQ29tcG9uZW50KTsKLyoqCiAqIEhvdyB0byBtYWtlIGNvdWNoZGIgd29yayB3aXRoIGVhc3lYRE0ncyBycGMuCiAqIAogKiB3ZSdsbCBoYXZlIHRvIGRvIHNvbWUgd3JhcHBpbmcgdG8gbWFrZSBlYXN5WERNIHBsYXkgbmljZWx5OgogKiAKICogIDEuIHdoZW4gZWFzeVhETSBleGVjdXRlcyB0aGUgcmVtb3RlIGNhbGxzIGl0IGNhbGxzIHRoZSBtZXRob2RzIGRlZmluZWQgaGVyZQogKiAgd2l0aCBUV08gY2FsbGJhY2tzLCBzdWNjZXNzIGFuZCBlcnJvci4gIFRoaXMgbWVzc2VzIHVwIGhvdyBkYi5ucmFtYS5qcyAmCiAqICBzZXNzaW9uLm5yYW1hLmpzIGhhbmRsZSB0aGUgb3B0aW9uYWwgcGFyYW1ldGVycyAod2hpY2ggaXMgYSB3ZWFrbmVzcykuIFNlZQogKiAgbGluZSAyNzU4IGluIGVhc3lYRE0uZGVidWcuanMKICoKICogIDIuIGVhc3lYRE0gd3JhcHMgY2FsbGJhY2tzIGluIHN1Y2ggYSB3YXkgdGhhdCBvbmx5IHRoZSBmaXJzdCBwYXJhbWV0ZXIKICogIGlzIHBhc3NlZCB1cCB0byB0aGUgb3JpZ2luYWwgY2FsbGJhY2sgKGxpbmUgMjcyOCBpbiBlYXN5WERNLmRlYnVnLmpzKS4KICoKICogIFRvIGFyb3VuZCB0aGVzZSBwb2ludHMsIHdlIHdyYXAgdGhlIG1ldGhvZHMgc28gYXMgdG8gKGkpIGRlbGV0ZSB0aGUgZmluYWwKICogIGFyZ3VtZW50IHdpdGggd2hpY2ggdGhleSBhcmUgY2FsbGVkLCBhbmQgKGlpKSBpbnZva2UgdGhlIGNhbGxiYWNrIHdpdGgKICogIHBhcmFtZXRlcnMgYXMgYW4gYXJyYXkuICBUaGlzIChpaSkgcmVxdWlyZXMgY29tcGxlbWVudGFyeSB3cmFwcGluZyBhdCB0aGUKICogIG90aGVyIGVuZCAodGhlIGNvbnN1bWVyKS4KICovLyoKICAgIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIE5vdGUtby1yYW1hLgoKICAgIE5vdGUtby1yYW1hIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBOb3RlLW8tcmFtYSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICAgIGFsb25nIHdpdGggTm90ZS1vLXJhbWEuICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovdmFyIF9hcnJheV93cmFwPWZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbigpe3ZhciBiPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7YShiKX19LF93cmFwPWZ1bmN0aW9uKGEpe3JldHVybnttZXRob2Q6ZnVuY3Rpb24oKXt2YXIgYj1bXTskLmVhY2goYXJndW1lbnRzLGZ1bmN0aW9uKGEsYyl7dHlwZW9mIGM9PSJmdW5jdGlvbiI/Yi5wdXNoKF9hcnJheV93cmFwKGMpKTpiLnB1c2goYyl9KTt2YXIgYz1iLmxlbmd0aDtiLnNwbGljZShjLTEsMSksYS5hcHBseSh0aGlzLGIpfX19LGxvY2FsPXt0ZXN0OnttZXRob2Q6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBiKGEpfX0sZGJfc2F2ZURvYzpfd3JhcChkYi5zYXZlRG9jKSxkYl9yZW1vdmVEb2M6X3dyYXAoZGIucmVtb3ZlRG9jKSxkYl9nZXRWaWV3Ol93cmFwKGRiLmdldFZpZXcpLGRiX2RvVXBkYXRlOl93cmFwKGRiLmRvVXBkYXRlKSxzZXNzaW9uX2xvZ2luOl93cmFwKHNlc3Npb24ubG9naW4pLHNlc3Npb25fbG9nb3V0Ol93cmFwKHNlc3Npb24ubG9nb3V0KSxzZXNzaW9uX2luZm86X3dyYXAoc2Vzc2lvbi5pbmZvKX0scmVtb3RlPXtnZXRfdmVyc2lvbjp7fSxtc2c6e30sbW9kYWw6e319LG9uUmVhZHk9ZnVuY3Rpb24oKXt9LF9ycGM9bmV3IGVhc3lYRE0uUnBjKHtvblJlYWR5Om9uUmVhZHl9LHtsb2NhbDpsb2NhbCxyZW1vdGU6cmVtb3RlfSk7Zm49ZnVuY3Rpb24oKXskLmVhY2goYXJndW1lbnRzLGZ1bmN0aW9uKGEsYil7Y29uc29sZS5sb2coYil9KX0="
        },
        "xdm/xdm-all.js.old": {
            "content_type": "application/octet-stream",
            "data": "LyohCiAqIGpRdWVyeSBKYXZhU2NyaXB0IExpYnJhcnkgdjEuNi4yCiAqIGh0dHA6Ly9qcXVlcnkuY29tLwogKgogKiBDb3B5cmlnaHQgMjAxMSwgSm9obiBSZXNpZwogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBJbmNsdWRlcyBTaXp6bGUuanMKICogaHR0cDovL3NpenpsZWpzLmNvbS8KICogQ29weXJpZ2h0IDIwMTEsIFRoZSBEb2pvIEZvdW5kYXRpb24KICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCwgQlNELCBhbmQgR1BMIExpY2Vuc2VzLgogKgogKiBEYXRlOiBUaHUgSnVuIDMwIDE0OjE2OjU2IDIwMTEgLTA0MDAKICovCihmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGN2KGEpe3JldHVybiBmLmlzV2luZG93KGEpP2E6YS5ub2RlVHlwZT09PTk/YS5kZWZhdWx0Vmlld3x8YS5wYXJlbnRXaW5kb3c6ITF9ZnVuY3Rpb24gY3MoYSl7aWYoIWNnW2FdKXt2YXIgYj1jLmJvZHksZD1mKCI8IithKyI+IikuYXBwZW5kVG8oYiksZT1kLmNzcygiZGlzcGxheSIpO2QucmVtb3ZlKCk7aWYoZT09PSJub25lInx8ZT09PSIiKXtjaHx8KGNoPWMuY3JlYXRlRWxlbWVudCgiaWZyYW1lIiksY2guZnJhbWVCb3JkZXI9Y2gud2lkdGg9Y2guaGVpZ2h0PTApLGIuYXBwZW5kQ2hpbGQoY2gpO2lmKCFjaXx8IWNoLmNyZWF0ZUVsZW1lbnQpY2k9KGNoLmNvbnRlbnRXaW5kb3d8fGNoLmNvbnRlbnREb2N1bWVudCkuZG9jdW1lbnQsY2kud3JpdGUoKGMuY29tcGF0TW9kZT09PSJDU1MxQ29tcGF0Ij8iPCFkb2N0eXBlIGh0bWw+IjoiIikrIjxodG1sPjxib2R5PiIpLGNpLmNsb3NlKCk7ZD1jaS5jcmVhdGVFbGVtZW50KGEpLGNpLmJvZHkuYXBwZW5kQ2hpbGQoZCksZT1mLmNzcyhkLCJkaXNwbGF5IiksYi5yZW1vdmVDaGlsZChjaCl9Y2dbYV09ZX1yZXR1cm4gY2dbYV19ZnVuY3Rpb24gY3IoYSxiKXt2YXIgYz17fTtmLmVhY2goY20uY29uY2F0LmFwcGx5KFtdLGNtLnNsaWNlKDAsYikpLGZ1bmN0aW9uKCl7Y1t0aGlzXT1hfSk7cmV0dXJuIGN9ZnVuY3Rpb24gY3EoKXtjbj1ifWZ1bmN0aW9uIGNwKCl7c2V0VGltZW91dChjcSwwKTtyZXR1cm4gY249Zi5ub3coKX1mdW5jdGlvbiBjZigpe3RyeXtyZXR1cm4gbmV3IGEuQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKX1jYXRjaChiKXt9fWZ1bmN0aW9uIGNlKCl7dHJ5e3JldHVybiBuZXcgYS5YTUxIdHRwUmVxdWVzdH1jYXRjaChiKXt9fWZ1bmN0aW9uIGIkKGEsYyl7YS5kYXRhRmlsdGVyJiYoYz1hLmRhdGFGaWx0ZXIoYyxhLmRhdGFUeXBlKSk7dmFyIGQ9YS5kYXRhVHlwZXMsZT17fSxnLGgsaT1kLmxlbmd0aCxqLGs9ZFswXSxsLG0sbixvLHA7Zm9yKGc9MTtnPGk7ZysrKXtpZihnPT09MSlmb3IoaCBpbiBhLmNvbnZlcnRlcnMpdHlwZW9mIGg9PSJzdHJpbmciJiYoZVtoLnRvTG93ZXJDYXNlKCldPWEuY29udmVydGVyc1toXSk7bD1rLGs9ZFtnXTtpZihrPT09IioiKWs9bDtlbHNlIGlmKGwhPT0iKiImJmwhPT1rKXttPWwrIiAiK2ssbj1lW21dfHxlWyIqICIra107aWYoIW4pe3A9Yjtmb3IobyBpbiBlKXtqPW8uc3BsaXQoIiAiKTtpZihqWzBdPT09bHx8alswXT09PSIqIil7cD1lW2pbMV0rIiAiK2tdO2lmKHApe289ZVtvXSxvPT09ITA/bj1wOnA9PT0hMCYmKG49byk7YnJlYWt9fX19IW4mJiFwJiZmLmVycm9yKCJObyBjb252ZXJzaW9uIGZyb20gIittLnJlcGxhY2UoIiAiLCIgdG8gIikpLG4hPT0hMCYmKGM9bj9uKGMpOnAobyhjKSkpfX1yZXR1cm4gY31mdW5jdGlvbiBiWihhLGMsZCl7dmFyIGU9YS5jb250ZW50cyxmPWEuZGF0YVR5cGVzLGc9YS5yZXNwb25zZUZpZWxkcyxoLGksaixrO2ZvcihpIGluIGcpaSBpbiBkJiYoY1tnW2ldXT1kW2ldKTt3aGlsZShmWzBdPT09IioiKWYuc2hpZnQoKSxoPT09YiYmKGg9YS5taW1lVHlwZXx8Yy5nZXRSZXNwb25zZUhlYWRlcigiY29udGVudC10eXBlIikpO2lmKGgpZm9yKGkgaW4gZSlpZihlW2ldJiZlW2ldLnRlc3QoaCkpe2YudW5zaGlmdChpKTticmVha31pZihmWzBdaW4gZClqPWZbMF07ZWxzZXtmb3IoaSBpbiBkKXtpZighZlswXXx8YS5jb252ZXJ0ZXJzW2krIiAiK2ZbMF1dKXtqPWk7YnJlYWt9a3x8KGs9aSl9aj1qfHxrfWlmKGope2ohPT1mWzBdJiZmLnVuc2hpZnQoaik7cmV0dXJuIGRbal19fWZ1bmN0aW9uIGJZKGEsYixjLGQpe2lmKGYuaXNBcnJheShiKSlmLmVhY2goYixmdW5jdGlvbihiLGUpe2N8fGJDLnRlc3QoYSk/ZChhLGUpOmJZKGErIlsiKyh0eXBlb2YgZT09Im9iamVjdCJ8fGYuaXNBcnJheShlKT9iOiIiKSsiXSIsZSxjLGQpfSk7ZWxzZSBpZighYyYmYiE9bnVsbCYmdHlwZW9mIGI9PSJvYmplY3QiKWZvcih2YXIgZSBpbiBiKWJZKGErIlsiK2UrIl0iLGJbZV0sYyxkKTtlbHNlIGQoYSxiKX1mdW5jdGlvbiBiWChhLGMsZCxlLGYsZyl7Zj1mfHxjLmRhdGFUeXBlc1swXSxnPWd8fHt9LGdbZl09ITA7dmFyIGg9YVtmXSxpPTAsaj1oP2gubGVuZ3RoOjAsaz1hPT09YlIsbDtmb3IoO2k8aiYmKGt8fCFsKTtpKyspbD1oW2ldKGMsZCxlKSx0eXBlb2YgbD09InN0cmluZyImJigha3x8Z1tsXT9sPWI6KGMuZGF0YVR5cGVzLnVuc2hpZnQobCksbD1iWChhLGMsZCxlLGwsZykpKTsoa3x8IWwpJiYhZ1siKiJdJiYobD1iWChhLGMsZCxlLCIqIixnKSk7cmV0dXJuIGx9ZnVuY3Rpb24gYlcoYSl7cmV0dXJuIGZ1bmN0aW9uKGIsYyl7dHlwZW9mIGIhPSJzdHJpbmciJiYoYz1iLGI9IioiKTtpZihmLmlzRnVuY3Rpb24oYykpe3ZhciBkPWIudG9Mb3dlckNhc2UoKS5zcGxpdChiTiksZT0wLGc9ZC5sZW5ndGgsaCxpLGo7Zm9yKDtlPGc7ZSsrKWg9ZFtlXSxqPS9eXCsvLnRlc3QoaCksaiYmKGg9aC5zdWJzdHIoMSl8fCIqIiksaT1hW2hdPWFbaF18fFtdLGlbaj8idW5zaGlmdCI6InB1c2giXShjKX19fWZ1bmN0aW9uIGJBKGEsYixjKXt2YXIgZD1iPT09IndpZHRoIj9hLm9mZnNldFdpZHRoOmEub2Zmc2V0SGVpZ2h0LGU9Yj09PSJ3aWR0aCI/YnY6Ync7aWYoZD4wKXtjIT09ImJvcmRlciImJmYuZWFjaChlLGZ1bmN0aW9uKCl7Y3x8KGQtPXBhcnNlRmxvYXQoZi5jc3MoYSwicGFkZGluZyIrdGhpcykpfHwwKSxjPT09Im1hcmdpbiI/ZCs9cGFyc2VGbG9hdChmLmNzcyhhLGMrdGhpcykpfHwwOmQtPXBhcnNlRmxvYXQoZi5jc3MoYSwiYm9yZGVyIit0aGlzKyJXaWR0aCIpKXx8MH0pO3JldHVybiBkKyJweCJ9ZD1ieChhLGIsYik7aWYoZDwwfHxkPT1udWxsKWQ9YS5zdHlsZVtiXXx8MDtkPXBhcnNlRmxvYXQoZCl8fDAsYyYmZi5lYWNoKGUsZnVuY3Rpb24oKXtkKz1wYXJzZUZsb2F0KGYuY3NzKGEsInBhZGRpbmciK3RoaXMpKXx8MCxjIT09InBhZGRpbmciJiYoZCs9cGFyc2VGbG9hdChmLmNzcyhhLCJib3JkZXIiK3RoaXMrIldpZHRoIikpfHwwKSxjPT09Im1hcmdpbiImJihkKz1wYXJzZUZsb2F0KGYuY3NzKGEsYyt0aGlzKSl8fDApfSk7cmV0dXJuIGQrInB4In1mdW5jdGlvbiBibShhLGIpe2Iuc3JjP2YuYWpheCh7dXJsOmIuc3JjLGFzeW5jOiExLGRhdGFUeXBlOiJzY3JpcHQifSk6Zi5nbG9iYWxFdmFsKChiLnRleHR8fGIudGV4dENvbnRlbnR8fGIuaW5uZXJIVE1MfHwiIikucmVwbGFjZShiZSwiLyokMCovIikpLGIucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGIpfWZ1bmN0aW9uIGJsKGEpe2Yubm9kZU5hbWUoYSwiaW5wdXQiKT9iayhhKToiZ2V0RWxlbWVudHNCeVRhZ05hbWUiaW4gYSYmZi5ncmVwKGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlucHV0IiksYmspfWZ1bmN0aW9uIGJrKGEpe2lmKGEudHlwZT09PSJjaGVja2JveCJ8fGEudHlwZT09PSJyYWRpbyIpYS5kZWZhdWx0Q2hlY2tlZD1hLmNoZWNrZWR9ZnVuY3Rpb24gYmooYSl7cmV0dXJuImdldEVsZW1lbnRzQnlUYWdOYW1lImluIGE/YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpOiJxdWVyeVNlbGVjdG9yQWxsImluIGE/YS5xdWVyeVNlbGVjdG9yQWxsKCIqIik6W119ZnVuY3Rpb24gYmkoYSxiKXt2YXIgYztpZihiLm5vZGVUeXBlPT09MSl7Yi5jbGVhckF0dHJpYnV0ZXMmJmIuY2xlYXJBdHRyaWJ1dGVzKCksYi5tZXJnZUF0dHJpYnV0ZXMmJmIubWVyZ2VBdHRyaWJ1dGVzKGEpLGM9Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmKGM9PT0ib2JqZWN0IiliLm91dGVySFRNTD1hLm91dGVySFRNTDtlbHNlIGlmKGMhPT0iaW5wdXQifHxhLnR5cGUhPT0iY2hlY2tib3giJiZhLnR5cGUhPT0icmFkaW8iKXtpZihjPT09Im9wdGlvbiIpYi5zZWxlY3RlZD1hLmRlZmF1bHRTZWxlY3RlZDtlbHNlIGlmKGM9PT0iaW5wdXQifHxjPT09InRleHRhcmVhIiliLmRlZmF1bHRWYWx1ZT1hLmRlZmF1bHRWYWx1ZX1lbHNlIGEuY2hlY2tlZCYmKGIuZGVmYXVsdENoZWNrZWQ9Yi5jaGVja2VkPWEuY2hlY2tlZCksYi52YWx1ZSE9PWEudmFsdWUmJihiLnZhbHVlPWEudmFsdWUpO2IucmVtb3ZlQXR0cmlidXRlKGYuZXhwYW5kbyl9fWZ1bmN0aW9uIGJoKGEsYil7aWYoYi5ub2RlVHlwZT09PTEmJiEhZi5oYXNEYXRhKGEpKXt2YXIgYz1mLmV4cGFuZG8sZD1mLmRhdGEoYSksZT1mLmRhdGEoYixkKTtpZihkPWRbY10pe3ZhciBnPWQuZXZlbnRzO2U9ZVtjXT1mLmV4dGVuZCh7fSxkKTtpZihnKXtkZWxldGUgZS5oYW5kbGUsZS5ldmVudHM9e307Zm9yKHZhciBoIGluIGcpZm9yKHZhciBpPTAsaj1nW2hdLmxlbmd0aDtpPGo7aSsrKWYuZXZlbnQuYWRkKGIsaCsoZ1toXVtpXS5uYW1lc3BhY2U/Ii4iOiIiKStnW2hdW2ldLm5hbWVzcGFjZSxnW2hdW2ldLGdbaF1baV0uZGF0YSl9fX19ZnVuY3Rpb24gYmcoYSxiKXtyZXR1cm4gZi5ub2RlTmFtZShhLCJ0YWJsZSIpP2EuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRib2R5IilbMF18fGEuYXBwZW5kQ2hpbGQoYS5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRib2R5IikpOmF9ZnVuY3Rpb24gVyhhLGIsYyl7Yj1ifHwwO2lmKGYuaXNGdW5jdGlvbihiKSlyZXR1cm4gZi5ncmVwKGEsZnVuY3Rpb24oYSxkKXt2YXIgZT0hIWIuY2FsbChhLGQsYSk7cmV0dXJuIGU9PT1jfSk7aWYoYi5ub2RlVHlwZSlyZXR1cm4gZi5ncmVwKGEsZnVuY3Rpb24oYSxkKXtyZXR1cm4gYT09PWI9PT1jfSk7aWYodHlwZW9mIGI9PSJzdHJpbmciKXt2YXIgZD1mLmdyZXAoYSxmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlVHlwZT09PTF9KTtpZihSLnRlc3QoYikpcmV0dXJuIGYuZmlsdGVyKGIsZCwhYyk7Yj1mLmZpbHRlcihiLGQpfXJldHVybiBmLmdyZXAoYSxmdW5jdGlvbihhLGQpe3JldHVybiBmLmluQXJyYXkoYSxiKT49MD09PWN9KX1mdW5jdGlvbiBWKGEpe3JldHVybiFhfHwhYS5wYXJlbnROb2RlfHxhLnBhcmVudE5vZGUubm9kZVR5cGU9PT0xMX1mdW5jdGlvbiBOKGEsYil7cmV0dXJuKGEmJmEhPT0iKiI/YSsiLiI6IiIpK2IucmVwbGFjZSh6LCJgIikucmVwbGFjZShBLCImIil9ZnVuY3Rpb24gTShhKXt2YXIgYixjLGQsZSxnLGgsaSxqLGssbCxtLG4sbyxwPVtdLHE9W10scj1mLl9kYXRhKHRoaXMsImV2ZW50cyIpO2lmKCEoYS5saXZlRmlyZWQ9PT10aGlzfHwhcnx8IXIubGl2ZXx8YS50YXJnZXQuZGlzYWJsZWR8fGEuYnV0dG9uJiZhLnR5cGU9PT0iY2xpY2siKSl7YS5uYW1lc3BhY2UmJihuPW5ldyBSZWdFeHAoIihefFxcLikiK2EubmFtZXNwYWNlLnNwbGl0KCIuIikuam9pbigiXFwuKD86LipcXC4pPyIpKyIoXFwufCQpIikpLGEubGl2ZUZpcmVkPXRoaXM7dmFyIHM9ci5saXZlLnNsaWNlKDApO2ZvcihpPTA7aTxzLmxlbmd0aDtpKyspZz1zW2ldLGcub3JpZ1R5cGUucmVwbGFjZSh4LCIiKT09PWEudHlwZT9xLnB1c2goZy5zZWxlY3Rvcik6cy5zcGxpY2UoaS0tLDEpO2U9ZihhLnRhcmdldCkuY2xvc2VzdChxLGEuY3VycmVudFRhcmdldCk7Zm9yKGo9MCxrPWUubGVuZ3RoO2o8aztqKyspe209ZVtqXTtmb3IoaT0wO2k8cy5sZW5ndGg7aSsrKXtnPXNbaV07aWYobS5zZWxlY3Rvcj09PWcuc2VsZWN0b3ImJighbnx8bi50ZXN0KGcubmFtZXNwYWNlKSkmJiFtLmVsZW0uZGlzYWJsZWQpe2g9bS5lbGVtLGQ9bnVsbDtpZihnLnByZVR5cGU9PT0ibW91c2VlbnRlciJ8fGcucHJlVHlwZT09PSJtb3VzZWxlYXZlIilhLnR5cGU9Zy5wcmVUeXBlLGQ9ZihhLnJlbGF0ZWRUYXJnZXQpLmNsb3Nlc3QoZy5zZWxlY3RvcilbMF0sZCYmZi5jb250YWlucyhoLGQpJiYoZD1oKTsoIWR8fGQhPT1oKSYmcC5wdXNoKHtlbGVtOmgsaGFuZGxlT2JqOmcsbGV2ZWw6bS5sZXZlbH0pfX19Zm9yKGo9MCxrPXAubGVuZ3RoO2o8aztqKyspe2U9cFtqXTtpZihjJiZlLmxldmVsPmMpYnJlYWs7YS5jdXJyZW50VGFyZ2V0PWUuZWxlbSxhLmRhdGE9ZS5oYW5kbGVPYmouZGF0YSxhLmhhbmRsZU9iaj1lLmhhbmRsZU9iaixvPWUuaGFuZGxlT2JqLm9yaWdIYW5kbGVyLmFwcGx5KGUuZWxlbSxhcmd1bWVudHMpO2lmKG89PT0hMXx8YS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKXtjPWUubGV2ZWwsbz09PSExJiYoYj0hMSk7aWYoYS5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpKWJyZWFrfX1yZXR1cm4gYn19ZnVuY3Rpb24gSyhhLGMsZCl7dmFyIGU9Zi5leHRlbmQoe30sZFswXSk7ZS50eXBlPWEsZS5vcmlnaW5hbEV2ZW50PXt9LGUubGl2ZUZpcmVkPWIsZi5ldmVudC5oYW5kbGUuY2FsbChjLGUpLGUuaXNEZWZhdWx0UHJldmVudGVkKCkmJmRbMF0ucHJldmVudERlZmF1bHQoKX1mdW5jdGlvbiBFKCl7cmV0dXJuITB9ZnVuY3Rpb24gRCgpe3JldHVybiExfWZ1bmN0aW9uIG0oYSxjLGQpe3ZhciBlPWMrImRlZmVyIixnPWMrInF1ZXVlIixoPWMrIm1hcmsiLGk9Zi5kYXRhKGEsZSxiLCEwKTtpJiYoZD09PSJxdWV1ZSJ8fCFmLmRhdGEoYSxnLGIsITApKSYmKGQ9PT0ibWFyayJ8fCFmLmRhdGEoYSxoLGIsITApKSYmc2V0VGltZW91dChmdW5jdGlvbigpeyFmLmRhdGEoYSxnLGIsITApJiYhZi5kYXRhKGEsaCxiLCEwKSYmKGYucmVtb3ZlRGF0YShhLGUsITApLGkucmVzb2x2ZSgpKX0sMCl9ZnVuY3Rpb24gbChhKXtmb3IodmFyIGIgaW4gYSlpZihiIT09InRvSlNPTiIpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gayhhLGMsZCl7aWYoZD09PWImJmEubm9kZVR5cGU9PT0xKXt2YXIgZT0iZGF0YS0iK2MucmVwbGFjZShqLCIkMS0kMiIpLnRvTG93ZXJDYXNlKCk7ZD1hLmdldEF0dHJpYnV0ZShlKTtpZih0eXBlb2YgZD09InN0cmluZyIpe3RyeXtkPWQ9PT0idHJ1ZSI/ITA6ZD09PSJmYWxzZSI/ITE6ZD09PSJudWxsIj9udWxsOmYuaXNOYU4oZCk/aS50ZXN0KGQpP2YucGFyc2VKU09OKGQpOmQ6cGFyc2VGbG9hdChkKX1jYXRjaChnKXt9Zi5kYXRhKGEsYyxkKX1lbHNlIGQ9Yn1yZXR1cm4gZH12YXIgYz1hLmRvY3VtZW50LGQ9YS5uYXZpZ2F0b3IsZT1hLmxvY2F0aW9uLGY9ZnVuY3Rpb24oKXtmdW5jdGlvbiBKKCl7aWYoIWUuaXNSZWFkeSl7dHJ5e2MuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKCJsZWZ0Iil9Y2F0Y2goYSl7c2V0VGltZW91dChKLDEpO3JldHVybn1lLnJlYWR5KCl9fXZhciBlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBlLmZuLmluaXQoYSxiLGgpfSxmPWEualF1ZXJ5LGc9YS4kLGgsaT0vXig/OltePF0qKDxbXHdcV10rPilbXj5dKiR8IyhbXHdcLV0qKSQpLyxqPS9cUy8saz0vXlxzKy8sbD0vXHMrJC8sbT0vXGQvLG49L148KFx3KylccypcLz8+KD86PFwvXDE+KT8kLyxvPS9eW1xdLDp7fVxzXSokLyxwPS9cXCg/OlsiXFxcL2JmbnJ0XXx1WzAtOWEtZkEtRl17NH0pL2cscT0vIlteIlxcXG5ccl0qInx0cnVlfGZhbHNlfG51bGx8LT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/L2cscj0vKD86Xnw6fCwpKD86XHMqXFspKy9nLHM9Lyh3ZWJraXQpWyBcL10oW1x3Ll0rKS8sdD0vKG9wZXJhKSg/Oi4qdmVyc2lvbik/WyBcL10oW1x3Ll0rKS8sdT0vKG1zaWUpIChbXHcuXSspLyx2PS8obW96aWxsYSkoPzouKj8gcnY6KFtcdy5dKykpPy8sdz0vLShbYS16XSkvaWcseD1mdW5jdGlvbihhLGIpe3JldHVybiBiLnRvVXBwZXJDYXNlKCl9LHk9ZC51c2VyQWdlbnQseixBLEIsQz1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLEQ9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxFPUFycmF5LnByb3RvdHlwZS5wdXNoLEY9QXJyYXkucHJvdG90eXBlLnNsaWNlLEc9U3RyaW5nLnByb3RvdHlwZS50cmltLEg9QXJyYXkucHJvdG90eXBlLmluZGV4T2YsST17fTtlLmZuPWUucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjplLGluaXQ6ZnVuY3Rpb24oYSxkLGYpe3ZhciBnLGgsaixrO2lmKCFhKXJldHVybiB0aGlzO2lmKGEubm9kZVR5cGUpe3RoaXMuY29udGV4dD10aGlzWzBdPWEsdGhpcy5sZW5ndGg9MTtyZXR1cm4gdGhpc31pZihhPT09ImJvZHkiJiYhZCYmYy5ib2R5KXt0aGlzLmNvbnRleHQ9Yyx0aGlzWzBdPWMuYm9keSx0aGlzLnNlbGVjdG9yPWEsdGhpcy5sZW5ndGg9MTtyZXR1cm4gdGhpc31pZih0eXBlb2YgYT09InN0cmluZyIpe2EuY2hhckF0KDApIT09IjwifHxhLmNoYXJBdChhLmxlbmd0aC0xKSE9PSI+Inx8YS5sZW5ndGg8Mz9nPWkuZXhlYyhhKTpnPVtudWxsLGEsbnVsbF07aWYoZyYmKGdbMV18fCFkKSl7aWYoZ1sxXSl7ZD1kIGluc3RhbmNlb2YgZT9kWzBdOmQsaz1kP2Qub3duZXJEb2N1bWVudHx8ZDpjLGo9bi5leGVjKGEpLGo/ZS5pc1BsYWluT2JqZWN0KGQpPyhhPVtjLmNyZWF0ZUVsZW1lbnQoalsxXSldLGUuZm4uYXR0ci5jYWxsKGEsZCwhMCkpOmE9W2suY3JlYXRlRWxlbWVudChqWzFdKV06KGo9ZS5idWlsZEZyYWdtZW50KFtnWzFdXSxba10pLGE9KGouY2FjaGVhYmxlP2UuY2xvbmUoai5mcmFnbWVudCk6ai5mcmFnbWVudCkuY2hpbGROb2Rlcyk7cmV0dXJuIGUubWVyZ2UodGhpcyxhKX1oPWMuZ2V0RWxlbWVudEJ5SWQoZ1syXSk7aWYoaCYmaC5wYXJlbnROb2RlKXtpZihoLmlkIT09Z1syXSlyZXR1cm4gZi5maW5kKGEpO3RoaXMubGVuZ3RoPTEsdGhpc1swXT1ofXRoaXMuY29udGV4dD1jLHRoaXMuc2VsZWN0b3I9YTtyZXR1cm4gdGhpc31yZXR1cm4hZHx8ZC5qcXVlcnk/KGR8fGYpLmZpbmQoYSk6dGhpcy5jb25zdHJ1Y3RvcihkKS5maW5kKGEpfWlmKGUuaXNGdW5jdGlvbihhKSlyZXR1cm4gZi5yZWFkeShhKTthLnNlbGVjdG9yIT09YiYmKHRoaXMuc2VsZWN0b3I9YS5zZWxlY3Rvcix0aGlzLmNvbnRleHQ9YS5jb250ZXh0KTtyZXR1cm4gZS5tYWtlQXJyYXkoYSx0aGlzKX0sc2VsZWN0b3I6IiIsanF1ZXJ5OiIxLjYuMiIsbGVuZ3RoOjAsc2l6ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmxlbmd0aH0sdG9BcnJheTpmdW5jdGlvbigpe3JldHVybiBGLmNhbGwodGhpcywwKX0sZ2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsP3RoaXMudG9BcnJheSgpOmE8MD90aGlzW3RoaXMubGVuZ3RoK2FdOnRoaXNbYV19LHB1c2hTdGFjazpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5jb25zdHJ1Y3RvcigpO2UuaXNBcnJheShhKT9FLmFwcGx5KGQsYSk6ZS5tZXJnZShkLGEpLGQucHJldk9iamVjdD10aGlzLGQuY29udGV4dD10aGlzLmNvbnRleHQsYj09PSJmaW5kIj9kLnNlbGVjdG9yPXRoaXMuc2VsZWN0b3IrKHRoaXMuc2VsZWN0b3I/IiAiOiIiKStjOmImJihkLnNlbGVjdG9yPXRoaXMuc2VsZWN0b3IrIi4iK2IrIigiK2MrIikiKTtyZXR1cm4gZH0sZWFjaDpmdW5jdGlvbihhLGIpe3JldHVybiBlLmVhY2godGhpcyxhLGIpfSxyZWFkeTpmdW5jdGlvbihhKXtlLmJpbmRSZWFkeSgpLEEuZG9uZShhKTtyZXR1cm4gdGhpc30sZXE6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT0tMT90aGlzLnNsaWNlKGEpOnRoaXMuc2xpY2UoYSwrYSsxKX0sZmlyc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lcSgwKX0sbGFzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKC0xKX0sc2xpY2U6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2soRi5hcHBseSh0aGlzLGFyZ3VtZW50cyksInNsaWNlIixGLmNhbGwoYXJndW1lbnRzKS5qb2luKCIsIikpfSxtYXA6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGUubWFwKHRoaXMsZnVuY3Rpb24oYixjKXtyZXR1cm4gYS5jYWxsKGIsYyxiKX0pKX0sZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHJldk9iamVjdHx8dGhpcy5jb25zdHJ1Y3RvcihudWxsKX0scHVzaDpFLHNvcnQ6W10uc29ydCxzcGxpY2U6W10uc3BsaWNlfSxlLmZuLmluaXQucHJvdG90eXBlPWUuZm4sZS5leHRlbmQ9ZS5mbi5leHRlbmQ9ZnVuY3Rpb24oKXt2YXIgYSxjLGQsZixnLGgsaT1hcmd1bWVudHNbMF18fHt9LGo9MSxrPWFyZ3VtZW50cy5sZW5ndGgsbD0hMTt0eXBlb2YgaT09ImJvb2xlYW4iJiYobD1pLGk9YXJndW1lbnRzWzFdfHx7fSxqPTIpLHR5cGVvZiBpIT0ib2JqZWN0IiYmIWUuaXNGdW5jdGlvbihpKSYmKGk9e30pLGs9PT1qJiYoaT10aGlzLC0taik7Zm9yKDtqPGs7aisrKWlmKChhPWFyZ3VtZW50c1tqXSkhPW51bGwpZm9yKGMgaW4gYSl7ZD1pW2NdLGY9YVtjXTtpZihpPT09Ziljb250aW51ZTtsJiZmJiYoZS5pc1BsYWluT2JqZWN0KGYpfHwoZz1lLmlzQXJyYXkoZikpKT8oZz8oZz0hMSxoPWQmJmUuaXNBcnJheShkKT9kOltdKTpoPWQmJmUuaXNQbGFpbk9iamVjdChkKT9kOnt9LGlbY109ZS5leHRlbmQobCxoLGYpKTpmIT09YiYmKGlbY109Zil9cmV0dXJuIGl9LGUuZXh0ZW5kKHtub0NvbmZsaWN0OmZ1bmN0aW9uKGIpe2EuJD09PWUmJihhLiQ9ZyksYiYmYS5qUXVlcnk9PT1lJiYoYS5qUXVlcnk9Zik7cmV0dXJuIGV9LGlzUmVhZHk6ITEscmVhZHlXYWl0OjEsaG9sZFJlYWR5OmZ1bmN0aW9uKGEpe2E/ZS5yZWFkeVdhaXQrKzplLnJlYWR5KCEwKX0scmVhZHk6ZnVuY3Rpb24oYSl7aWYoYT09PSEwJiYhLS1lLnJlYWR5V2FpdHx8YSE9PSEwJiYhZS5pc1JlYWR5KXtpZighYy5ib2R5KXJldHVybiBzZXRUaW1lb3V0KGUucmVhZHksMSk7ZS5pc1JlYWR5PSEwO2lmKGEhPT0hMCYmLS1lLnJlYWR5V2FpdD4wKXJldHVybjtBLnJlc29sdmVXaXRoKGMsW2VdKSxlLmZuLnRyaWdnZXImJmUoYykudHJpZ2dlcigicmVhZHkiKS51bmJpbmQoInJlYWR5Iil9fSxiaW5kUmVhZHk6ZnVuY3Rpb24oKXtpZighQSl7QT1lLl9EZWZlcnJlZCgpO2lmKGMucmVhZHlTdGF0ZT09PSJjb21wbGV0ZSIpcmV0dXJuIHNldFRpbWVvdXQoZS5yZWFkeSwxKTtpZihjLmFkZEV2ZW50TGlzdGVuZXIpYy5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixCLCExKSxhLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLGUucmVhZHksITEpO2Vsc2UgaWYoYy5hdHRhY2hFdmVudCl7Yy5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIixCKSxhLmF0dGFjaEV2ZW50KCJvbmxvYWQiLGUucmVhZHkpO3ZhciBiPSExO3RyeXtiPWEuZnJhbWVFbGVtZW50PT1udWxsfWNhdGNoKGQpe31jLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCYmYiYmSigpfX19LGlzRnVuY3Rpb246ZnVuY3Rpb24oYSl7cmV0dXJuIGUudHlwZShhKT09PSJmdW5jdGlvbiJ9LGlzQXJyYXk6QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oYSl7cmV0dXJuIGUudHlwZShhKT09PSJhcnJheSJ9LGlzV2luZG93OmZ1bmN0aW9uKGEpe3JldHVybiBhJiZ0eXBlb2YgYT09Im9iamVjdCImJiJzZXRJbnRlcnZhbCJpbiBhfSxpc05hTjpmdW5jdGlvbihhKXtyZXR1cm4gYT09bnVsbHx8IW0udGVzdChhKXx8aXNOYU4oYSl9LHR5cGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/U3RyaW5nKGEpOklbQy5jYWxsKGEpXXx8Im9iamVjdCJ9LGlzUGxhaW5PYmplY3Q6ZnVuY3Rpb24oYSl7aWYoIWF8fGUudHlwZShhKSE9PSJvYmplY3QifHxhLm5vZGVUeXBlfHxlLmlzV2luZG93KGEpKXJldHVybiExO2lmKGEuY29uc3RydWN0b3ImJiFELmNhbGwoYSwiY29uc3RydWN0b3IiKSYmIUQuY2FsbChhLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwiaXNQcm90b3R5cGVPZiIpKXJldHVybiExO3ZhciBjO2ZvcihjIGluIGEpO3JldHVybiBjPT09Ynx8RC5jYWxsKGEsYyl9LGlzRW1wdHlPYmplY3Q6ZnVuY3Rpb24oYSl7Zm9yKHZhciBiIGluIGEpcmV0dXJuITE7cmV0dXJuITB9LGVycm9yOmZ1bmN0aW9uKGEpe3Rocm93IGF9LHBhcnNlSlNPTjpmdW5jdGlvbihiKXtpZih0eXBlb2YgYiE9InN0cmluZyJ8fCFiKXJldHVybiBudWxsO2I9ZS50cmltKGIpO2lmKGEuSlNPTiYmYS5KU09OLnBhcnNlKXJldHVybiBhLkpTT04ucGFyc2UoYik7aWYoby50ZXN0KGIucmVwbGFjZShwLCJAIikucmVwbGFjZShxLCJdIikucmVwbGFjZShyLCIiKSkpcmV0dXJuKG5ldyBGdW5jdGlvbigicmV0dXJuICIrYikpKCk7ZS5lcnJvcigiSW52YWxpZCBKU09OOiAiK2IpfSxwYXJzZVhNTDpmdW5jdGlvbihiLGMsZCl7YS5ET01QYXJzZXI/KGQ9bmV3IERPTVBhcnNlcixjPWQucGFyc2VGcm9tU3RyaW5nKGIsInRleHQveG1sIikpOihjPW5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MRE9NIiksYy5hc3luYz0iZmFsc2UiLGMubG9hZFhNTChiKSksZD1jLmRvY3VtZW50RWxlbWVudCwoIWR8fCFkLm5vZGVOYW1lfHxkLm5vZGVOYW1lPT09InBhcnNlcmVycm9yIikmJmUuZXJyb3IoIkludmFsaWQgWE1MOiAiK2IpO3JldHVybiBjfSxub29wOmZ1bmN0aW9uKCl7fSxnbG9iYWxFdmFsOmZ1bmN0aW9uKGIpe2ImJmoudGVzdChiKSYmKGEuZXhlY1NjcmlwdHx8ZnVuY3Rpb24oYil7YS5ldmFsLmNhbGwoYSxiKX0pKGIpfSxjYW1lbENhc2U6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSh3LHgpfSxub2RlTmFtZTpmdW5jdGlvbihhLGIpe3JldHVybiBhLm5vZGVOYW1lJiZhLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk9PT1iLnRvVXBwZXJDYXNlKCl9LGVhY2g6ZnVuY3Rpb24oYSxjLGQpe3ZhciBmLGc9MCxoPWEubGVuZ3RoLGk9aD09PWJ8fGUuaXNGdW5jdGlvbihhKTtpZihkKXtpZihpKXtmb3IoZiBpbiBhKWlmKGMuYXBwbHkoYVtmXSxkKT09PSExKWJyZWFrfWVsc2UgZm9yKDtnPGg7KWlmKGMuYXBwbHkoYVtnKytdLGQpPT09ITEpYnJlYWt9ZWxzZSBpZihpKXtmb3IoZiBpbiBhKWlmKGMuY2FsbChhW2ZdLGYsYVtmXSk9PT0hMSlicmVha31lbHNlIGZvcig7ZzxoOylpZihjLmNhbGwoYVtnXSxnLGFbZysrXSk9PT0hMSlicmVhaztyZXR1cm4gYX0sdHJpbTpHP2Z1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsPyIiOkcuY2FsbChhKX06ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/IiI6KGErIiIpLnJlcGxhY2UoaywiIikucmVwbGFjZShsLCIiKX0sbWFrZUFycmF5OmZ1bmN0aW9uKGEsYil7dmFyIGM9Ynx8W107aWYoYSE9bnVsbCl7dmFyIGQ9ZS50eXBlKGEpO2EubGVuZ3RoPT1udWxsfHxkPT09InN0cmluZyJ8fGQ9PT0iZnVuY3Rpb24ifHxkPT09InJlZ2V4cCJ8fGUuaXNXaW5kb3coYSk/RS5jYWxsKGMsYSk6ZS5tZXJnZShjLGEpfXJldHVybiBjfSxpbkFycmF5OmZ1bmN0aW9uKGEsYil7aWYoSClyZXR1cm4gSC5jYWxsKGIsYSk7Zm9yKHZhciBjPTAsZD1iLmxlbmd0aDtjPGQ7YysrKWlmKGJbY109PT1hKXJldHVybiBjO3JldHVybi0xfSxtZXJnZTpmdW5jdGlvbihhLGMpe3ZhciBkPWEubGVuZ3RoLGU9MDtpZih0eXBlb2YgYy5sZW5ndGg9PSJudW1iZXIiKWZvcih2YXIgZj1jLmxlbmd0aDtlPGY7ZSsrKWFbZCsrXT1jW2VdO2Vsc2Ugd2hpbGUoY1tlXSE9PWIpYVtkKytdPWNbZSsrXTthLmxlbmd0aD1kO3JldHVybiBhfSxncmVwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD1bXSxlO2M9ISFjO2Zvcih2YXIgZj0wLGc9YS5sZW5ndGg7ZjxnO2YrKyllPSEhYihhW2ZdLGYpLGMhPT1lJiZkLnB1c2goYVtmXSk7cmV0dXJuIGR9LG1hcDpmdW5jdGlvbihhLGMsZCl7dmFyIGYsZyxoPVtdLGk9MCxqPWEubGVuZ3RoLGs9YSBpbnN0YW5jZW9mIGV8fGohPT1iJiZ0eXBlb2Ygaj09Im51bWJlciImJihqPjAmJmFbMF0mJmFbai0xXXx8aj09PTB8fGUuaXNBcnJheShhKSk7aWYoaylmb3IoO2k8ajtpKyspZj1jKGFbaV0saSxkKSxmIT1udWxsJiYoaFtoLmxlbmd0aF09Zik7ZWxzZSBmb3IoZyBpbiBhKWY9YyhhW2ddLGcsZCksZiE9bnVsbCYmKGhbaC5sZW5ndGhdPWYpO3JldHVybiBoLmNvbmNhdC5hcHBseShbXSxoKX0sZ3VpZDoxLHByb3h5OmZ1bmN0aW9uKGEsYyl7aWYodHlwZW9mIGM9PSJzdHJpbmciKXt2YXIgZD1hW2NdO2M9YSxhPWR9aWYoIWUuaXNGdW5jdGlvbihhKSlyZXR1cm4gYjt2YXIgZj1GLmNhbGwoYXJndW1lbnRzLDIpLGc9ZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShjLGYuY29uY2F0KEYuY2FsbChhcmd1bWVudHMpKSl9O2cuZ3VpZD1hLmd1aWQ9YS5ndWlkfHxnLmd1aWR8fGUuZ3VpZCsrO3JldHVybiBnfSxhY2Nlc3M6ZnVuY3Rpb24oYSxjLGQsZixnLGgpe3ZhciBpPWEubGVuZ3RoO2lmKHR5cGVvZiBjPT0ib2JqZWN0Iil7Zm9yKHZhciBqIGluIGMpZS5hY2Nlc3MoYSxqLGNbal0sZixnLGQpO3JldHVybiBhfWlmKGQhPT1iKXtmPSFoJiZmJiZlLmlzRnVuY3Rpb24oZCk7Zm9yKHZhciBrPTA7azxpO2srKylnKGFba10sYyxmP2QuY2FsbChhW2tdLGssZyhhW2tdLGMpKTpkLGgpO3JldHVybiBhfXJldHVybiBpP2coYVswXSxjKTpifSxub3c6ZnVuY3Rpb24oKXtyZXR1cm4obmV3IERhdGUpLmdldFRpbWUoKX0sdWFNYXRjaDpmdW5jdGlvbihhKXthPWEudG9Mb3dlckNhc2UoKTt2YXIgYj1zLmV4ZWMoYSl8fHQuZXhlYyhhKXx8dS5leGVjKGEpfHxhLmluZGV4T2YoImNvbXBhdGlibGUiKTwwJiZ2LmV4ZWMoYSl8fFtdO3JldHVybnticm93c2VyOmJbMV18fCIiLHZlcnNpb246YlsyXXx8IjAifX0sc3ViOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gYShiLGMpe3JldHVybiBuZXcgYS5mbi5pbml0KGIsYyl9ZS5leHRlbmQoITAsYSx0aGlzKSxhLnN1cGVyY2xhc3M9dGhpcyxhLmZuPWEucHJvdG90eXBlPXRoaXMoKSxhLmZuLmNvbnN0cnVjdG9yPWEsYS5zdWI9dGhpcy5zdWIsYS5mbi5pbml0PWZ1bmN0aW9uKGQsZil7ZiYmZiBpbnN0YW5jZW9mIGUmJiEoZiBpbnN0YW5jZW9mIGEpJiYoZj1hKGYpKTtyZXR1cm4gZS5mbi5pbml0LmNhbGwodGhpcyxkLGYsYil9LGEuZm4uaW5pdC5wcm90b3R5cGU9YS5mbjt2YXIgYj1hKGMpO3JldHVybiBhfSxicm93c2VyOnt9fSksZS5lYWNoKCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0Ii5zcGxpdCgiICIpLGZ1bmN0aW9uKGEsYil7SVsiW29iamVjdCAiK2IrIl0iXT1iLnRvTG93ZXJDYXNlKCl9KSx6PWUudWFNYXRjaCh5KSx6LmJyb3dzZXImJihlLmJyb3dzZXJbei5icm93c2VyXT0hMCxlLmJyb3dzZXIudmVyc2lvbj16LnZlcnNpb24pLGUuYnJvd3Nlci53ZWJraXQmJihlLmJyb3dzZXIuc2FmYXJpPSEwKSxqLnRlc3QoIsKgIikmJihrPS9eW1xzXHhBMF0rLyxsPS9bXHNceEEwXSskLyksaD1lKGMpLGMuYWRkRXZlbnRMaXN0ZW5lcj9CPWZ1bmN0aW9uKCl7Yy5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixCLCExKSxlLnJlYWR5KCl9OmMuYXR0YWNoRXZlbnQmJihCPWZ1bmN0aW9uKCl7Yy5yZWFkeVN0YXRlPT09ImNvbXBsZXRlIiYmKGMuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsQiksZS5yZWFkeSgpKX0pO3JldHVybiBlfSgpLGc9ImRvbmUgZmFpbCBpc1Jlc29sdmVkIGlzUmVqZWN0ZWQgcHJvbWlzZSB0aGVuIGFsd2F5cyBwaXBlIi5zcGxpdCgiICIpLGg9W10uc2xpY2U7Zi5leHRlbmQoe19EZWZlcnJlZDpmdW5jdGlvbigpe3ZhciBhPVtdLGIsYyxkLGU9e2RvbmU6ZnVuY3Rpb24oKXtpZighZCl7dmFyIGM9YXJndW1lbnRzLGcsaCxpLGosaztiJiYoaz1iLGI9MCk7Zm9yKGc9MCxoPWMubGVuZ3RoO2c8aDtnKyspaT1jW2ddLGo9Zi50eXBlKGkpLGo9PT0iYXJyYXkiP2UuZG9uZS5hcHBseShlLGkpOmo9PT0iZnVuY3Rpb24iJiZhLnB1c2goaSk7ayYmZS5yZXNvbHZlV2l0aChrWzBdLGtbMV0pfXJldHVybiB0aGlzfSxyZXNvbHZlV2l0aDpmdW5jdGlvbihlLGYpe2lmKCFkJiYhYiYmIWMpe2Y9Znx8W10sYz0xO3RyeXt3aGlsZShhWzBdKWEuc2hpZnQoKS5hcHBseShlLGYpfWZpbmFsbHl7Yj1bZSxmXSxjPTB9fXJldHVybiB0aGlzfSxyZXNvbHZlOmZ1bmN0aW9uKCl7ZS5yZXNvbHZlV2l0aCh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIHRoaXN9LGlzUmVzb2x2ZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hIWN8fCEhYn0sY2FuY2VsOmZ1bmN0aW9uKCl7ZD0xLGE9W107cmV0dXJuIHRoaXN9fTtyZXR1cm4gZX0sRGVmZXJyZWQ6ZnVuY3Rpb24oYSl7dmFyIGI9Zi5fRGVmZXJyZWQoKSxjPWYuX0RlZmVycmVkKCksZDtmLmV4dGVuZChiLHt0aGVuOmZ1bmN0aW9uKGEsYyl7Yi5kb25lKGEpLmZhaWwoYyk7cmV0dXJuIHRoaXN9LGFsd2F5czpmdW5jdGlvbigpe3JldHVybiBiLmRvbmUuYXBwbHkoYixhcmd1bWVudHMpLmZhaWwuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxmYWlsOmMuZG9uZSxyZWplY3RXaXRoOmMucmVzb2x2ZVdpdGgscmVqZWN0OmMucmVzb2x2ZSxpc1JlamVjdGVkOmMuaXNSZXNvbHZlZCxwaXBlOmZ1bmN0aW9uKGEsYyl7cmV0dXJuIGYuRGVmZXJyZWQoZnVuY3Rpb24oZCl7Zi5lYWNoKHtkb25lOlthLCJyZXNvbHZlIl0sZmFpbDpbYywicmVqZWN0Il19LGZ1bmN0aW9uKGEsYyl7dmFyIGU9Y1swXSxnPWNbMV0saDtmLmlzRnVuY3Rpb24oZSk/YlthXShmdW5jdGlvbigpe2g9ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksaCYmZi5pc0Z1bmN0aW9uKGgucHJvbWlzZSk/aC5wcm9taXNlKCkudGhlbihkLnJlc29sdmUsZC5yZWplY3QpOmRbZ10oaCl9KTpiW2FdKGRbZ10pfSl9KS5wcm9taXNlKCl9LHByb21pc2U6ZnVuY3Rpb24oYSl7aWYoYT09bnVsbCl7aWYoZClyZXR1cm4gZDtkPWE9e319dmFyIGM9Zy5sZW5ndGg7d2hpbGUoYy0tKWFbZ1tjXV09YltnW2NdXTtyZXR1cm4gYX19KSxiLmRvbmUoYy5jYW5jZWwpLmZhaWwoYi5jYW5jZWwpLGRlbGV0ZSBiLmNhbmNlbCxhJiZhLmNhbGwoYixiKTtyZXR1cm4gYn0sd2hlbjpmdW5jdGlvbihhKXtmdW5jdGlvbiBpKGEpe3JldHVybiBmdW5jdGlvbihjKXtiW2FdPWFyZ3VtZW50cy5sZW5ndGg+MT9oLmNhbGwoYXJndW1lbnRzLDApOmMsLS1lfHxnLnJlc29sdmVXaXRoKGcsaC5jYWxsKGIsMCkpfX12YXIgYj1hcmd1bWVudHMsYz0wLGQ9Yi5sZW5ndGgsZT1kLGc9ZDw9MSYmYSYmZi5pc0Z1bmN0aW9uKGEucHJvbWlzZSk/YTpmLkRlZmVycmVkKCk7aWYoZD4xKXtmb3IoO2M8ZDtjKyspYltjXSYmZi5pc0Z1bmN0aW9uKGJbY10ucHJvbWlzZSk/YltjXS5wcm9taXNlKCkudGhlbihpKGMpLGcucmVqZWN0KTotLWU7ZXx8Zy5yZXNvbHZlV2l0aChnLGIpfWVsc2UgZyE9PWEmJmcucmVzb2x2ZVdpdGgoZyxkP1thXTpbXSk7cmV0dXJuIGcucHJvbWlzZSgpfX0pLGYuc3VwcG9ydD1mdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudCgiZGl2IiksYj1jLmRvY3VtZW50RWxlbWVudCxkLGUsZyxoLGksaixrLGwsbSxuLG8scCxxLHIscyx0LHU7YS5zZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIsInQiKSxhLmlubmVySFRNTD0iICAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJyBzdHlsZT0ndG9wOjFweDtmbG9hdDpsZWZ0O29wYWNpdHk6LjU1Oyc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz4iLGQ9YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLGU9YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYSIpWzBdO2lmKCFkfHwhZC5sZW5ndGh8fCFlKXJldHVybnt9O2c9Yy5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKSxoPWcuYXBwZW5kQ2hpbGQoYy5jcmVhdGVFbGVtZW50KCJvcHRpb24iKSksaT1hLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpbnB1dCIpWzBdLGs9e2xlYWRpbmdXaGl0ZXNwYWNlOmEuZmlyc3RDaGlsZC5ub2RlVHlwZT09PTMsdGJvZHk6IWEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRib2R5IikubGVuZ3RoLGh0bWxTZXJpYWxpemU6ISFhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJsaW5rIikubGVuZ3RoLHN0eWxlOi90b3AvLnRlc3QoZS5nZXRBdHRyaWJ1dGUoInN0eWxlIikpLGhyZWZOb3JtYWxpemVkOmUuZ2V0QXR0cmlidXRlKCJocmVmIik9PT0iL2EiLG9wYWNpdHk6L14wLjU1JC8udGVzdChlLnN0eWxlLm9wYWNpdHkpLGNzc0Zsb2F0OiEhZS5zdHlsZS5jc3NGbG9hdCxjaGVja09uOmkudmFsdWU9PT0ib24iLG9wdFNlbGVjdGVkOmguc2VsZWN0ZWQsZ2V0U2V0QXR0cmlidXRlOmEuY2xhc3NOYW1lIT09InQiLHN1Ym1pdEJ1YmJsZXM6ITAsY2hhbmdlQnViYmxlczohMCxmb2N1c2luQnViYmxlczohMSxkZWxldGVFeHBhbmRvOiEwLG5vQ2xvbmVFdmVudDohMCxpbmxpbmVCbG9ja05lZWRzTGF5b3V0OiExLHNocmlua1dyYXBCbG9ja3M6ITEscmVsaWFibGVNYXJnaW5SaWdodDohMH0saS5jaGVja2VkPSEwLGsubm9DbG9uZUNoZWNrZWQ9aS5jbG9uZU5vZGUoITApLmNoZWNrZWQsZy5kaXNhYmxlZD0hMCxrLm9wdERpc2FibGVkPSFoLmRpc2FibGVkO3RyeXtkZWxldGUgYS50ZXN0fWNhdGNoKHYpe2suZGVsZXRlRXhwYW5kbz0hMX0hYS5hZGRFdmVudExpc3RlbmVyJiZhLmF0dGFjaEV2ZW50JiZhLmZpcmVFdmVudCYmKGEuYXR0YWNoRXZlbnQoIm9uY2xpY2siLGZ1bmN0aW9uKCl7ay5ub0Nsb25lRXZlbnQ9ITF9KSxhLmNsb25lTm9kZSghMCkuZmlyZUV2ZW50KCJvbmNsaWNrIikpLGk9Yy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpLGkudmFsdWU9InQiLGkuc2V0QXR0cmlidXRlKCJ0eXBlIiwicmFkaW8iKSxrLnJhZGlvVmFsdWU9aS52YWx1ZT09PSJ0IixpLnNldEF0dHJpYnV0ZSgiY2hlY2tlZCIsImNoZWNrZWQiKSxhLmFwcGVuZENoaWxkKGkpLGw9Yy5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksbC5hcHBlbmRDaGlsZChhLmZpcnN0Q2hpbGQpLGsuY2hlY2tDbG9uZT1sLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCxhLmlubmVySFRNTD0iIixhLnN0eWxlLndpZHRoPWEuc3R5bGUucGFkZGluZ0xlZnQ9IjFweCIsbT1jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0sbz1jLmNyZWF0ZUVsZW1lbnQobT8iZGl2IjoiYm9keSIpLHA9e3Zpc2liaWxpdHk6ImhpZGRlbiIsd2lkdGg6MCxoZWlnaHQ6MCxib3JkZXI6MCxtYXJnaW46MH0sbSYmZi5leHRlbmQocCx7cG9zaXRpb246ImFic29sdXRlIixsZWZ0Oi0xZTMsdG9wOi0xZTN9KTtmb3IodCBpbiBwKW8uc3R5bGVbdF09cFt0XTtvLmFwcGVuZENoaWxkKGEpLG49bXx8YixuLmluc2VydEJlZm9yZShvLG4uZmlyc3RDaGlsZCksay5hcHBlbmRDaGVja2VkPWkuY2hlY2tlZCxrLmJveE1vZGVsPWEub2Zmc2V0V2lkdGg9PT0yLCJ6b29tImluIGEuc3R5bGUmJihhLnN0eWxlLmRpc3BsYXk9ImlubGluZSIsYS5zdHlsZS56b29tPTEsay5pbmxpbmVCbG9ja05lZWRzTGF5b3V0PWEub2Zmc2V0V2lkdGg9PT0yLGEuc3R5bGUuZGlzcGxheT0iIixhLmlubmVySFRNTD0iPGRpdiBzdHlsZT0nd2lkdGg6NHB4Oyc+PC9kaXY+IixrLnNocmlua1dyYXBCbG9ja3M9YS5vZmZzZXRXaWR0aCE9PTIpLGEuaW5uZXJIVE1MPSI8dGFibGU+PHRyPjx0ZCBzdHlsZT0ncGFkZGluZzowO2JvcmRlcjowO2Rpc3BsYXk6bm9uZSc+PC90ZD48dGQ+dDwvdGQ+PC90cj48L3RhYmxlPiIscT1hLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ZCIpLHU9cVswXS5vZmZzZXRIZWlnaHQ9PT0wLHFbMF0uc3R5bGUuZGlzcGxheT0iIixxWzFdLnN0eWxlLmRpc3BsYXk9Im5vbmUiLGsucmVsaWFibGVIaWRkZW5PZmZzZXRzPXUmJnFbMF0ub2Zmc2V0SGVpZ2h0PT09MCxhLmlubmVySFRNTD0iIixjLmRlZmF1bHRWaWV3JiZjLmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUmJihqPWMuY3JlYXRlRWxlbWVudCgiZGl2Iiksai5zdHlsZS53aWR0aD0iMCIsai5zdHlsZS5tYXJnaW5SaWdodD0iMCIsYS5hcHBlbmRDaGlsZChqKSxrLnJlbGlhYmxlTWFyZ2luUmlnaHQ9KHBhcnNlSW50KChjLmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoaixudWxsKXx8e21hcmdpblJpZ2h0OjB9KS5tYXJnaW5SaWdodCwxMCl8fDApPT09MCksby5pbm5lckhUTUw9IiIsbi5yZW1vdmVDaGlsZChvKTtpZihhLmF0dGFjaEV2ZW50KWZvcih0IGlue3N1Ym1pdDoxLGNoYW5nZToxLGZvY3VzaW46MX0pcz0ib24iK3QsdT1zIGluIGEsdXx8KGEuc2V0QXR0cmlidXRlKHMsInJldHVybjsiKSx1PXR5cGVvZiBhW3NdPT0iZnVuY3Rpb24iKSxrW3QrIkJ1YmJsZXMiXT11O289bD1nPWg9bT1qPWE9aT1udWxsO3JldHVybiBrfSgpLGYuYm94TW9kZWw9Zi5zdXBwb3J0LmJveE1vZGVsO3ZhciBpPS9eKD86XHsuKlx9fFxbLipcXSkkLyxqPS8oW2Etel0pKFtBLVpdKS9nO2YuZXh0ZW5kKHtjYWNoZTp7fSx1dWlkOjAsZXhwYW5kbzoialF1ZXJ5IisoZi5mbi5qcXVlcnkrTWF0aC5yYW5kb20oKSkucmVwbGFjZSgvXEQvZywiIiksbm9EYXRhOntlbWJlZDohMCxvYmplY3Q6ImNsc2lkOkQyN0NEQjZFLUFFNkQtMTFjZi05NkI4LTQ0NDU1MzU0MDAwMCIsYXBwbGV0OiEwfSxoYXNEYXRhOmZ1bmN0aW9uKGEpe2E9YS5ub2RlVHlwZT9mLmNhY2hlW2FbZi5leHBhbmRvXV06YVtmLmV4cGFuZG9dO3JldHVybiEhYSYmIWwoYSl9LGRhdGE6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoISFmLmFjY2VwdERhdGEoYSkpe3ZhciBnPWYuZXhwYW5kbyxoPXR5cGVvZiBjPT0ic3RyaW5nIixpLGo9YS5ub2RlVHlwZSxrPWo/Zi5jYWNoZTphLGw9aj9hW2YuZXhwYW5kb106YVtmLmV4cGFuZG9dJiZmLmV4cGFuZG87aWYoKCFsfHxlJiZsJiYha1tsXVtnXSkmJmgmJmQ9PT1iKXJldHVybjtsfHwoaj9hW2YuZXhwYW5kb109bD0rK2YudXVpZDpsPWYuZXhwYW5kbyksa1tsXXx8KGtbbF09e30sanx8KGtbbF0udG9KU09OPWYubm9vcCkpO2lmKHR5cGVvZiBjPT0ib2JqZWN0Inx8dHlwZW9mIGM9PSJmdW5jdGlvbiIpZT9rW2xdW2ddPWYuZXh0ZW5kKGtbbF1bZ10sYyk6a1tsXT1mLmV4dGVuZChrW2xdLGMpO2k9a1tsXSxlJiYoaVtnXXx8KGlbZ109e30pLGk9aVtnXSksZCE9PWImJihpW2YuY2FtZWxDYXNlKGMpXT1kKTtpZihjPT09ImV2ZW50cyImJiFpW2NdKXJldHVybiBpW2ddJiZpW2ddLmV2ZW50cztyZXR1cm4gaD9pW2YuY2FtZWxDYXNlKGMpXXx8aVtjXTppfX0scmVtb3ZlRGF0YTpmdW5jdGlvbihiLGMsZCl7aWYoISFmLmFjY2VwdERhdGEoYikpe3ZhciBlPWYuZXhwYW5kbyxnPWIubm9kZVR5cGUsaD1nP2YuY2FjaGU6YixpPWc/YltmLmV4cGFuZG9dOmYuZXhwYW5kbztpZighaFtpXSlyZXR1cm47aWYoYyl7dmFyIGo9ZD9oW2ldW2VdOmhbaV07aWYoail7ZGVsZXRlIGpbY107aWYoIWwoaikpcmV0dXJufX1pZihkKXtkZWxldGUgaFtpXVtlXTtpZighbChoW2ldKSlyZXR1cm59dmFyIGs9aFtpXVtlXTtmLnN1cHBvcnQuZGVsZXRlRXhwYW5kb3x8aCE9YT9kZWxldGUgaFtpXTpoW2ldPW51bGwsaz8oaFtpXT17fSxnfHwoaFtpXS50b0pTT049Zi5ub29wKSxoW2ldW2VdPWspOmcmJihmLnN1cHBvcnQuZGVsZXRlRXhwYW5kbz9kZWxldGUgYltmLmV4cGFuZG9dOmIucmVtb3ZlQXR0cmlidXRlP2IucmVtb3ZlQXR0cmlidXRlKGYuZXhwYW5kbyk6YltmLmV4cGFuZG9dPW51bGwpfX0sX2RhdGE6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmLmRhdGEoYSxiLGMsITApfSxhY2NlcHREYXRhOmZ1bmN0aW9uKGEpe2lmKGEubm9kZU5hbWUpe3ZhciBiPWYubm9EYXRhW2Eubm9kZU5hbWUudG9Mb3dlckNhc2UoKV07aWYoYilyZXR1cm4gYiE9PSEwJiZhLmdldEF0dHJpYnV0ZSgiY2xhc3NpZCIpPT09Yn1yZXR1cm4hMH19KSxmLmZuLmV4dGVuZCh7ZGF0YTpmdW5jdGlvbihhLGMpe3ZhciBkPW51bGw7aWYodHlwZW9mIGE9PSJ1bmRlZmluZWQiKXtpZih0aGlzLmxlbmd0aCl7ZD1mLmRhdGEodGhpc1swXSk7aWYodGhpc1swXS5ub2RlVHlwZT09PTEpe3ZhciBlPXRoaXNbMF0uYXR0cmlidXRlcyxnO2Zvcih2YXIgaD0wLGk9ZS5sZW5ndGg7aDxpO2grKylnPWVbaF0ubmFtZSxnLmluZGV4T2YoImRhdGEtIik9PT0wJiYoZz1mLmNhbWVsQ2FzZShnLnN1YnN0cmluZyg1KSksayh0aGlzWzBdLGcsZFtnXSkpfX1yZXR1cm4gZH1pZih0eXBlb2YgYT09Im9iamVjdCIpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YuZGF0YSh0aGlzLGEpfSk7dmFyIGo9YS5zcGxpdCgiLiIpO2pbMV09alsxXT8iLiIralsxXToiIjtpZihjPT09Yil7ZD10aGlzLnRyaWdnZXJIYW5kbGVyKCJnZXREYXRhIitqWzFdKyIhIixbalswXV0pLGQ9PT1iJiZ0aGlzLmxlbmd0aCYmKGQ9Zi5kYXRhKHRoaXNbMF0sYSksZD1rKHRoaXNbMF0sYSxkKSk7cmV0dXJuIGQ9PT1iJiZqWzFdP3RoaXMuZGF0YShqWzBdKTpkfXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1mKHRoaXMpLGQ9W2pbMF0sY107Yi50cmlnZ2VySGFuZGxlcigic2V0RGF0YSIralsxXSsiISIsZCksZi5kYXRhKHRoaXMsYSxjKSxiLnRyaWdnZXJIYW5kbGVyKCJjaGFuZ2VEYXRhIitqWzFdKyIhIixkKX0pfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLnJlbW92ZURhdGEodGhpcyxhKX0pfX0pLGYuZXh0ZW5kKHtfbWFyazpmdW5jdGlvbihhLGMpe2EmJihjPShjfHwiZngiKSsibWFyayIsZi5kYXRhKGEsYywoZi5kYXRhKGEsYyxiLCEwKXx8MCkrMSwhMCkpfSxfdW5tYXJrOmZ1bmN0aW9uKGEsYyxkKXthIT09ITAmJihkPWMsYz1hLGE9ITEpO2lmKGMpe2Q9ZHx8ImZ4Ijt2YXIgZT1kKyJtYXJrIixnPWE/MDooZi5kYXRhKGMsZSxiLCEwKXx8MSktMTtnP2YuZGF0YShjLGUsZywhMCk6KGYucmVtb3ZlRGF0YShjLGUsITApLG0oYyxkLCJtYXJrIikpfX0scXVldWU6ZnVuY3Rpb24oYSxjLGQpe2lmKGEpe2M9KGN8fCJmeCIpKyJxdWV1ZSI7dmFyIGU9Zi5kYXRhKGEsYyxiLCEwKTtkJiYoIWV8fGYuaXNBcnJheShkKT9lPWYuZGF0YShhLGMsZi5tYWtlQXJyYXkoZCksITApOmUucHVzaChkKSk7cmV0dXJuIGV8fFtdfX0sZGVxdWV1ZTpmdW5jdGlvbihhLGIpe2I9Ynx8ImZ4Ijt2YXIgYz1mLnF1ZXVlKGEsYiksZD1jLnNoaWZ0KCksZTtkPT09ImlucHJvZ3Jlc3MiJiYoZD1jLnNoaWZ0KCkpLGQmJihiPT09ImZ4IiYmYy51bnNoaWZ0KCJpbnByb2dyZXNzIiksZC5jYWxsKGEsZnVuY3Rpb24oKXtmLmRlcXVldWUoYSxiKX0pKSxjLmxlbmd0aHx8KGYucmVtb3ZlRGF0YShhLGIrInF1ZXVlIiwhMCksbShhLGIsInF1ZXVlIikpfX0pLGYuZm4uZXh0ZW5kKHtxdWV1ZTpmdW5jdGlvbihhLGMpe3R5cGVvZiBhIT0ic3RyaW5nIiYmKGM9YSxhPSJmeCIpO2lmKGM9PT1iKXJldHVybiBmLnF1ZXVlKHRoaXNbMF0sYSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWYucXVldWUodGhpcyxhLGMpO2E9PT0iZngiJiZiWzBdIT09ImlucHJvZ3Jlc3MiJiZmLmRlcXVldWUodGhpcyxhKX0pfSxkZXF1ZXVlOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLmRlcXVldWUodGhpcyxhKX0pfSxkZWxheTpmdW5jdGlvbihhLGIpe2E9Zi5meD9mLmZ4LnNwZWVkc1thXXx8YTphLGI9Ynx8ImZ4IjtyZXR1cm4gdGhpcy5xdWV1ZShiLGZ1bmN0aW9uKCl7dmFyIGM9dGhpcztzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Zi5kZXF1ZXVlKGMsYil9LGEpfSl9LGNsZWFyUXVldWU6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucXVldWUoYXx8ImZ4IixbXSl9LHByb21pc2U6ZnVuY3Rpb24oYSxjKXtmdW5jdGlvbiBtKCl7LS1ofHxkLnJlc29sdmVXaXRoKGUsW2VdKX10eXBlb2YgYSE9InN0cmluZyImJihjPWEsYT1iKSxhPWF8fCJmeCI7dmFyIGQ9Zi5EZWZlcnJlZCgpLGU9dGhpcyxnPWUubGVuZ3RoLGg9MSxpPWErImRlZmVyIixqPWErInF1ZXVlIixrPWErIm1hcmsiLGw7d2hpbGUoZy0tKWlmKGw9Zi5kYXRhKGVbZ10saSxiLCEwKXx8KGYuZGF0YShlW2ddLGosYiwhMCl8fGYuZGF0YShlW2ddLGssYiwhMCkpJiZmLmRhdGEoZVtnXSxpLGYuX0RlZmVycmVkKCksITApKWgrKyxsLmRvbmUobSk7bSgpO3JldHVybiBkLnByb21pc2UoKX19KTt2YXIgbj0vW1xuXHRccl0vZyxvPS9ccysvLHA9L1xyL2cscT0vXig/OmJ1dHRvbnxpbnB1dCkkL2kscj0vXig/OmJ1dHRvbnxpbnB1dHxvYmplY3R8c2VsZWN0fHRleHRhcmVhKSQvaSxzPS9eYSg/OnJlYSk/JC9pLHQ9L14oPzphdXRvZm9jdXN8YXV0b3BsYXl8YXN5bmN8Y2hlY2tlZHxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZHxzZWxlY3RlZCkkL2ksdT0vXDp8Xm9uLyx2LHc7Zi5mbi5leHRlbmQoe2F0dHI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZi5hY2Nlc3ModGhpcyxhLGIsITAsZi5hdHRyKX0scmVtb3ZlQXR0cjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zi5yZW1vdmVBdHRyKHRoaXMsYSl9KX0scHJvcDpmdW5jdGlvbihhLGIpe3JldHVybiBmLmFjY2Vzcyh0aGlzLGEsYiwhMCxmLnByb3ApfSxyZW1vdmVQcm9wOmZ1bmN0aW9uKGEpe2E9Zi5wcm9wRml4W2FdfHxhO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt0cnl7dGhpc1thXT1iLGRlbGV0ZSB0aGlzW2FdfWNhdGNoKGMpe319KX0sYWRkQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGUsZyxoLGk7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zih0aGlzKS5hZGRDbGFzcyhhLmNhbGwodGhpcyxiLHRoaXMuY2xhc3NOYW1lKSl9KTtpZihhJiZ0eXBlb2YgYT09InN0cmluZyIpe2I9YS5zcGxpdChvKTtmb3IoYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKyl7ZT10aGlzW2NdO2lmKGUubm9kZVR5cGU9PT0xKWlmKCFlLmNsYXNzTmFtZSYmYi5sZW5ndGg9PT0xKWUuY2xhc3NOYW1lPWE7ZWxzZXtnPSIgIitlLmNsYXNzTmFtZSsiICI7Zm9yKGg9MCxpPWIubGVuZ3RoO2g8aTtoKyspfmcuaW5kZXhPZigiICIrYltoXSsiICIpfHwoZys9YltoXSsiICIpO2UuY2xhc3NOYW1lPWYudHJpbShnKX19fXJldHVybiB0aGlzfSxyZW1vdmVDbGFzczpmdW5jdGlvbihhKXt2YXIgYyxkLGUsZyxoLGksajtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmKHRoaXMpLnJlbW92ZUNsYXNzKGEuY2FsbCh0aGlzLGIsdGhpcy5jbGFzc05hbWUpKX0pO2lmKGEmJnR5cGVvZiBhPT0ic3RyaW5nInx8YT09PWIpe2M9KGF8fCIiKS5zcGxpdChvKTtmb3IoZD0wLGU9dGhpcy5sZW5ndGg7ZDxlO2QrKyl7Zz10aGlzW2RdO2lmKGcubm9kZVR5cGU9PT0xJiZnLmNsYXNzTmFtZSlpZihhKXtoPSgiICIrZy5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKG4sIiAiKTtmb3IoaT0wLGo9Yy5sZW5ndGg7aTxqO2krKyloPWgucmVwbGFjZSgiICIrY1tpXSsiICIsIiAiKTtnLmNsYXNzTmFtZT1mLnRyaW0oaCl9ZWxzZSBnLmNsYXNzTmFtZT0iIn19cmV0dXJuIHRoaXN9LHRvZ2dsZUNsYXNzOmZ1bmN0aW9uKGEsYil7dmFyIGM9dHlwZW9mIGEsZD10eXBlb2YgYj09ImJvb2xlYW4iO2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGMpe2YodGhpcykudG9nZ2xlQ2xhc3MoYS5jYWxsKHRoaXMsYyx0aGlzLmNsYXNzTmFtZSxiKSxiKX0pO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZihjPT09InN0cmluZyIpe3ZhciBlLGc9MCxoPWYodGhpcyksaT1iLGo9YS5zcGxpdChvKTt3aGlsZShlPWpbZysrXSlpPWQ/aTohaC5oYXNDbGFzcyhlKSxoW2k/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXShlKX1lbHNlIGlmKGM9PT0idW5kZWZpbmVkInx8Yz09PSJib29sZWFuIil0aGlzLmNsYXNzTmFtZSYmZi5fZGF0YSh0aGlzLCJfX2NsYXNzTmFtZV9fIix0aGlzLmNsYXNzTmFtZSksdGhpcy5jbGFzc05hbWU9dGhpcy5jbGFzc05hbWV8fGE9PT0hMT8iIjpmLl9kYXRhKHRoaXMsIl9fY2xhc3NOYW1lX18iKXx8IiJ9KX0saGFzQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGI9IiAiK2ErIiAiO2Zvcih2YXIgYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKylpZigoIiAiK3RoaXNbY10uY2xhc3NOYW1lKyIgIikucmVwbGFjZShuLCIgIikuaW5kZXhPZihiKT4tMSlyZXR1cm4hMDtyZXR1cm4hMX0sdmFsOmZ1bmN0aW9uKGEpe3ZhciBjLGQsZT10aGlzWzBdO2lmKCFhcmd1bWVudHMubGVuZ3RoKXtpZihlKXtjPWYudmFsSG9va3NbZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXXx8Zi52YWxIb29rc1tlLnR5cGVdO2lmKGMmJiJnZXQiaW4gYyYmKGQ9Yy5nZXQoZSwidmFsdWUiKSkhPT1iKXJldHVybiBkO2Q9ZS52YWx1ZTtyZXR1cm4gdHlwZW9mIGQ9PSJzdHJpbmciP2QucmVwbGFjZShwLCIiKTpkPT1udWxsPyIiOmR9cmV0dXJuIGJ9dmFyIGc9Zi5pc0Z1bmN0aW9uKGEpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZCl7dmFyIGU9Zih0aGlzKSxoO2lmKHRoaXMubm9kZVR5cGU9PT0xKXtnP2g9YS5jYWxsKHRoaXMsZCxlLnZhbCgpKTpoPWEsaD09bnVsbD9oPSIiOnR5cGVvZiBoPT0ibnVtYmVyIj9oKz0iIjpmLmlzQXJyYXkoaCkmJihoPWYubWFwKGgsZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/IiI6YSsiIn0pKSxjPWYudmFsSG9va3NbdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXXx8Zi52YWxIb29rc1t0aGlzLnR5cGVdO2lmKCFjfHwhKCJzZXQiaW4gYyl8fGMuc2V0KHRoaXMsaCwidmFsdWUiKT09PWIpdGhpcy52YWx1ZT1ofX0pfX0pLGYuZXh0ZW5kKHt2YWxIb29rczp7b3B0aW9uOntnZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5hdHRyaWJ1dGVzLnZhbHVlO3JldHVybiFifHxiLnNwZWNpZmllZD9hLnZhbHVlOmEudGV4dH19LHNlbGVjdDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiLGM9YS5zZWxlY3RlZEluZGV4LGQ9W10sZT1hLm9wdGlvbnMsZz1hLnR5cGU9PT0ic2VsZWN0LW9uZSI7aWYoYzwwKXJldHVybiBudWxsO2Zvcih2YXIgaD1nP2M6MCxpPWc/YysxOmUubGVuZ3RoO2g8aTtoKyspe3ZhciBqPWVbaF07aWYoai5zZWxlY3RlZCYmKGYuc3VwcG9ydC5vcHREaXNhYmxlZD8hai5kaXNhYmxlZDpqLmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKT09PW51bGwpJiYoIWoucGFyZW50Tm9kZS5kaXNhYmxlZHx8IWYubm9kZU5hbWUoai5wYXJlbnROb2RlLCJvcHRncm91cCIpKSl7Yj1mKGopLnZhbCgpO2lmKGcpcmV0dXJuIGI7ZC5wdXNoKGIpfX1pZihnJiYhZC5sZW5ndGgmJmUubGVuZ3RoKXJldHVybiBmKGVbY10pLnZhbCgpO3JldHVybiBkfSxzZXQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz1mLm1ha2VBcnJheShiKTtmKGEpLmZpbmQoIm9wdGlvbiIpLmVhY2goZnVuY3Rpb24oKXt0aGlzLnNlbGVjdGVkPWYuaW5BcnJheShmKHRoaXMpLnZhbCgpLGMpPj0wfSksYy5sZW5ndGh8fChhLnNlbGVjdGVkSW5kZXg9LTEpO3JldHVybiBjfX19LGF0dHJGbjp7dmFsOiEwLGNzczohMCxodG1sOiEwLHRleHQ6ITAsZGF0YTohMCx3aWR0aDohMCxoZWlnaHQ6ITAsb2Zmc2V0OiEwfSxhdHRyRml4Ont0YWJpbmRleDoidGFiSW5kZXgifSxhdHRyOmZ1bmN0aW9uKGEsYyxkLGUpe3ZhciBnPWEubm9kZVR5cGU7aWYoIWF8fGc9PT0zfHxnPT09OHx8Zz09PTIpcmV0dXJuIGI7aWYoZSYmYyBpbiBmLmF0dHJGbilyZXR1cm4gZihhKVtjXShkKTtpZighKCJnZXRBdHRyaWJ1dGUiaW4gYSkpcmV0dXJuIGYucHJvcChhLGMsZCk7dmFyIGgsaSxqPWchPT0xfHwhZi5pc1hNTERvYyhhKTtqJiYoYz1mLmF0dHJGaXhbY118fGMsaT1mLmF0dHJIb29rc1tjXSxpfHwodC50ZXN0KGMpP2k9dzp2JiZjIT09ImNsYXNzTmFtZSImJihmLm5vZGVOYW1lKGEsImZvcm0iKXx8dS50ZXN0KGMpKSYmKGk9dikpKTtpZihkIT09Yil7aWYoZD09PW51bGwpe2YucmVtb3ZlQXR0cihhLGMpO3JldHVybiBifWlmKGkmJiJzZXQiaW4gaSYmaiYmKGg9aS5zZXQoYSxkLGMpKSE9PWIpcmV0dXJuIGg7YS5zZXRBdHRyaWJ1dGUoYywiIitkKTtyZXR1cm4gZH1pZihpJiYiZ2V0ImluIGkmJmomJihoPWkuZ2V0KGEsYykpIT09bnVsbClyZXR1cm4gaDtoPWEuZ2V0QXR0cmlidXRlKGMpO3JldHVybiBoPT09bnVsbD9iOmh9LHJlbW92ZUF0dHI6ZnVuY3Rpb24oYSxiKXt2YXIgYzthLm5vZGVUeXBlPT09MSYmKGI9Zi5hdHRyRml4W2JdfHxiLGYuc3VwcG9ydC5nZXRTZXRBdHRyaWJ1dGU/YS5yZW1vdmVBdHRyaWJ1dGUoYik6KGYuYXR0cihhLGIsIiIpLGEucmVtb3ZlQXR0cmlidXRlTm9kZShhLmdldEF0dHJpYnV0ZU5vZGUoYikpKSx0LnRlc3QoYikmJihjPWYucHJvcEZpeFtiXXx8YilpbiBhJiYoYVtjXT0hMSkpfSxhdHRySG9va3M6e3R5cGU6e3NldDpmdW5jdGlvbihhLGIpe2lmKHEudGVzdChhLm5vZGVOYW1lKSYmYS5wYXJlbnROb2RlKWYuZXJyb3IoInR5cGUgcHJvcGVydHkgY2FuJ3QgYmUgY2hhbmdlZCIpO2Vsc2UgaWYoIWYuc3VwcG9ydC5yYWRpb1ZhbHVlJiZiPT09InJhZGlvIiYmZi5ub2RlTmFtZShhLCJpbnB1dCIpKXt2YXIgYz1hLnZhbHVlO2Euc2V0QXR0cmlidXRlKCJ0eXBlIixiKSxjJiYoYS52YWx1ZT1jKTtyZXR1cm4gYn19fSx0YWJJbmRleDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBjPWEuZ2V0QXR0cmlidXRlTm9kZSgidGFiSW5kZXgiKTtyZXR1cm4gYyYmYy5zcGVjaWZpZWQ/cGFyc2VJbnQoYy52YWx1ZSwxMCk6ci50ZXN0KGEubm9kZU5hbWUpfHxzLnRlc3QoYS5ub2RlTmFtZSkmJmEuaHJlZj8wOmJ9fSx2YWx1ZTp7Z2V0OmZ1bmN0aW9uKGEsYil7aWYodiYmZi5ub2RlTmFtZShhLCJidXR0b24iKSlyZXR1cm4gdi5nZXQoYSxiKTtyZXR1cm4gYiBpbiBhP2EudmFsdWU6bnVsbH0sc2V0OmZ1bmN0aW9uKGEsYixjKXtpZih2JiZmLm5vZGVOYW1lKGEsImJ1dHRvbiIpKXJldHVybiB2LnNldChhLGIsYyk7YS52YWx1ZT1ifX19LHByb3BGaXg6e3RhYmluZGV4OiJ0YWJJbmRleCIscmVhZG9ubHk6InJlYWRPbmx5IiwiZm9yIjoiaHRtbEZvciIsImNsYXNzIjoiY2xhc3NOYW1lIixtYXhsZW5ndGg6Im1heExlbmd0aCIsY2VsbHNwYWNpbmc6ImNlbGxTcGFjaW5nIixjZWxscGFkZGluZzoiY2VsbFBhZGRpbmciLHJvd3NwYW46InJvd1NwYW4iLGNvbHNwYW46ImNvbFNwYW4iLHVzZW1hcDoidXNlTWFwIixmcmFtZWJvcmRlcjoiZnJhbWVCb3JkZXIiLGNvbnRlbnRlZGl0YWJsZToiY29udGVudEVkaXRhYmxlIn0scHJvcDpmdW5jdGlvbihhLGMsZCl7dmFyIGU9YS5ub2RlVHlwZTtpZighYXx8ZT09PTN8fGU9PT04fHxlPT09MilyZXR1cm4gYjt2YXIgZyxoLGk9ZSE9PTF8fCFmLmlzWE1MRG9jKGEpO2kmJihjPWYucHJvcEZpeFtjXXx8YyxoPWYucHJvcEhvb2tzW2NdKTtyZXR1cm4gZCE9PWI/aCYmInNldCJpbiBoJiYoZz1oLnNldChhLGQsYykpIT09Yj9nOmFbY109ZDpoJiYiZ2V0ImluIGgmJihnPWguZ2V0KGEsYykpIT09Yj9nOmFbY119LHByb3BIb29rczp7fX0pLHc9e2dldDpmdW5jdGlvbihhLGMpe3JldHVybiBmLnByb3AoYSxjKT9jLnRvTG93ZXJDYXNlKCk6Yn0sc2V0OmZ1bmN0aW9uKGEsYixjKXt2YXIgZDtiPT09ITE/Zi5yZW1vdmVBdHRyKGEsYyk6KGQ9Zi5wcm9wRml4W2NdfHxjLGQgaW4gYSYmKGFbZF09ITApLGEuc2V0QXR0cmlidXRlKGMsYy50b0xvd2VyQ2FzZSgpKSk7cmV0dXJuIGN9fSxmLnN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlfHwoZi5hdHRyRml4PWYucHJvcEZpeCx2PWYuYXR0ckhvb2tzLm5hbWU9Zi5hdHRySG9va3MudGl0bGU9Zi52YWxIb29rcy5idXR0b249e2dldDpmdW5jdGlvbihhLGMpe3ZhciBkO2Q9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpO3JldHVybiBkJiZkLm5vZGVWYWx1ZSE9PSIiP2Qubm9kZVZhbHVlOmJ9LHNldDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpO2lmKGQpe2Qubm9kZVZhbHVlPWI7cmV0dXJuIGJ9fX0sZi5lYWNoKFsid2lkdGgiLCJoZWlnaHQiXSxmdW5jdGlvbihhLGIpe2YuYXR0ckhvb2tzW2JdPWYuZXh0ZW5kKGYuYXR0ckhvb2tzW2JdLHtzZXQ6ZnVuY3Rpb24oYSxjKXtpZihjPT09IiIpe2Euc2V0QXR0cmlidXRlKGIsImF1dG8iKTtyZXR1cm4gY319fSl9KSksZi5zdXBwb3J0LmhyZWZOb3JtYWxpemVkfHxmLmVhY2goWyJocmVmIiwic3JjIiwid2lkdGgiLCJoZWlnaHQiXSxmdW5jdGlvbihhLGMpe2YuYXR0ckhvb2tzW2NdPWYuZXh0ZW5kKGYuYXR0ckhvb2tzW2NdLHtnZXQ6ZnVuY3Rpb24oYSl7dmFyIGQ9YS5nZXRBdHRyaWJ1dGUoYywyKTtyZXR1cm4gZD09PW51bGw/YjpkfX0pfSksZi5zdXBwb3J0LnN0eWxlfHwoZi5hdHRySG9va3Muc3R5bGU9e2dldDpmdW5jdGlvbihhKXtyZXR1cm4gYS5zdHlsZS5jc3NUZXh0LnRvTG93ZXJDYXNlKCl8fGJ9LHNldDpmdW5jdGlvbihhLGIpe3JldHVybiBhLnN0eWxlLmNzc1RleHQ9IiIrYn19KSxmLnN1cHBvcnQub3B0U2VsZWN0ZWR8fChmLnByb3BIb29rcy5zZWxlY3RlZD1mLmV4dGVuZChmLnByb3BIb29rcy5zZWxlY3RlZCx7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiPWEucGFyZW50Tm9kZTtiJiYoYi5zZWxlY3RlZEluZGV4LGIucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgpfX0pKSxmLnN1cHBvcnQuY2hlY2tPbnx8Zi5lYWNoKFsicmFkaW8iLCJjaGVja2JveCJdLGZ1bmN0aW9uKCl7Zi52YWxIb29rc1t0aGlzXT17Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgidmFsdWUiKT09PW51bGw/Im9uIjphLnZhbHVlfX19KSxmLmVhY2goWyJyYWRpbyIsImNoZWNrYm94Il0sZnVuY3Rpb24oKXtmLnZhbEhvb2tzW3RoaXNdPWYuZXh0ZW5kKGYudmFsSG9va3NbdGhpc10se3NldDpmdW5jdGlvbihhLGIpe2lmKGYuaXNBcnJheShiKSlyZXR1cm4gYS5jaGVja2VkPWYuaW5BcnJheShmKGEpLnZhbCgpLGIpPj0wfX0pfSk7dmFyIHg9L1wuKC4qKSQvLHk9L14oPzp0ZXh0YXJlYXxpbnB1dHxzZWxlY3QpJC9pLHo9L1wuL2csQT0vIC9nLEI9L1teXHdccy58YF0vZyxDPWZ1bmN0aW9uKGEpe3JldHVybiBhLnJlcGxhY2UoQiwiXFwkJiIpfTtmLmV2ZW50PXthZGQ6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoYS5ub2RlVHlwZSE9PTMmJmEubm9kZVR5cGUhPT04KXtpZihkPT09ITEpZD1EO2Vsc2UgaWYoIWQpcmV0dXJuO3ZhciBnLGg7ZC5oYW5kbGVyJiYoZz1kLGQ9Zy5oYW5kbGVyKSxkLmd1aWR8fChkLmd1aWQ9Zi5ndWlkKyspO3ZhciBpPWYuX2RhdGEoYSk7aWYoIWkpcmV0dXJuO3ZhciBqPWkuZXZlbnRzLGs9aS5oYW5kbGU7anx8KGkuZXZlbnRzPWo9e30pLGt8fChpLmhhbmRsZT1rPWZ1bmN0aW9uKGEpe3JldHVybiB0eXBlb2YgZiE9InVuZGVmaW5lZCImJighYXx8Zi5ldmVudC50cmlnZ2VyZWQhPT1hLnR5cGUpP2YuZXZlbnQuaGFuZGxlLmFwcGx5KGsuZWxlbSxhcmd1bWVudHMpOmJ9KSxrLmVsZW09YSxjPWMuc3BsaXQoIiAiKTt2YXIgbCxtPTAsbjt3aGlsZShsPWNbbSsrXSl7aD1nP2YuZXh0ZW5kKHt9LGcpOntoYW5kbGVyOmQsZGF0YTplfSxsLmluZGV4T2YoIi4iKT4tMT8obj1sLnNwbGl0KCIuIiksbD1uLnNoaWZ0KCksaC5uYW1lc3BhY2U9bi5zbGljZSgwKS5zb3J0KCkuam9pbigiLiIpKToobj1bXSxoLm5hbWVzcGFjZT0iIiksaC50eXBlPWwsaC5ndWlkfHwoaC5ndWlkPWQuZ3VpZCk7dmFyIG89altsXSxwPWYuZXZlbnQuc3BlY2lhbFtsXXx8e307aWYoIW8pe289altsXT1bXTtpZighcC5zZXR1cHx8cC5zZXR1cC5jYWxsKGEsZSxuLGspPT09ITEpYS5hZGRFdmVudExpc3RlbmVyP2EuYWRkRXZlbnRMaXN0ZW5lcihsLGssITEpOmEuYXR0YWNoRXZlbnQmJmEuYXR0YWNoRXZlbnQoIm9uIitsLGspfXAuYWRkJiYocC5hZGQuY2FsbChhLGgpLGguaGFuZGxlci5ndWlkfHwoaC5oYW5kbGVyLmd1aWQ9ZC5ndWlkKSksby5wdXNoKGgpLGYuZXZlbnQuZ2xvYmFsW2xdPSEwfWE9bnVsbH19LGdsb2JhbDp7fSxyZW1vdmU6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoYS5ub2RlVHlwZSE9PTMmJmEubm9kZVR5cGUhPT04KXtkPT09ITEmJihkPUQpO3ZhciBnLGgsaSxqLGs9MCxsLG0sbixvLHAscSxyLHM9Zi5oYXNEYXRhKGEpJiZmLl9kYXRhKGEpLHQ9cyYmcy5ldmVudHM7aWYoIXN8fCF0KXJldHVybjtjJiZjLnR5cGUmJihkPWMuaGFuZGxlcixjPWMudHlwZSk7aWYoIWN8fHR5cGVvZiBjPT0ic3RyaW5nIiYmYy5jaGFyQXQoMCk9PT0iLiIpe2M9Y3x8IiI7Zm9yKGggaW4gdClmLmV2ZW50LnJlbW92ZShhLGgrYyk7cmV0dXJufWM9Yy5zcGxpdCgiICIpO3doaWxlKGg9Y1trKytdKXtyPWgscT1udWxsLGw9aC5pbmRleE9mKCIuIik8MCxtPVtdLGx8fChtPWguc3BsaXQoIi4iKSxoPW0uc2hpZnQoKSxuPW5ldyBSZWdFeHAoIihefFxcLikiK2YubWFwKG0uc2xpY2UoMCkuc29ydCgpLEMpLmpvaW4oIlxcLig/Oi4qXFwuKT8iKSsiKFxcLnwkKSIpKSxwPXRbaF07aWYoIXApY29udGludWU7aWYoIWQpe2ZvcihqPTA7ajxwLmxlbmd0aDtqKyspe3E9cFtqXTtpZihsfHxuLnRlc3QocS5uYW1lc3BhY2UpKWYuZXZlbnQucmVtb3ZlKGEscixxLmhhbmRsZXIsaikscC5zcGxpY2Uoai0tLDEpfWNvbnRpbnVlfW89Zi5ldmVudC5zcGVjaWFsW2hdfHx7fTtmb3Ioaj1lfHwwO2o8cC5sZW5ndGg7aisrKXtxPXBbal07aWYoZC5ndWlkPT09cS5ndWlkKXtpZihsfHxuLnRlc3QocS5uYW1lc3BhY2UpKWU9PW51bGwmJnAuc3BsaWNlKGotLSwxKSxvLnJlbW92ZSYmby5yZW1vdmUuY2FsbChhLHEpO2lmKGUhPW51bGwpYnJlYWt9fWlmKHAubGVuZ3RoPT09MHx8ZSE9bnVsbCYmcC5sZW5ndGg9PT0xKSghby50ZWFyZG93bnx8by50ZWFyZG93bi5jYWxsKGEsbSk9PT0hMSkmJmYucmVtb3ZlRXZlbnQoYSxoLHMuaGFuZGxlKSxnPW51bGwsZGVsZXRlIHRbaF19aWYoZi5pc0VtcHR5T2JqZWN0KHQpKXt2YXIgdT1zLmhhbmRsZTt1JiYodS5lbGVtPW51bGwpLGRlbGV0ZSBzLmV2ZW50cyxkZWxldGUgcy5oYW5kbGUsZi5pc0VtcHR5T2JqZWN0KHMpJiZmLnJlbW92ZURhdGEoYSxiLCEwKX19fSxjdXN0b21FdmVudDp7Z2V0RGF0YTohMCxzZXREYXRhOiEwLGNoYW5nZURhdGE6ITB9LHRyaWdnZXI6ZnVuY3Rpb24oYyxkLGUsZyl7dmFyIGg9Yy50eXBlfHxjLGk9W10sajtoLmluZGV4T2YoIiEiKT49MCYmKGg9aC5zbGljZSgwLC0xKSxqPSEwKSxoLmluZGV4T2YoIi4iKT49MCYmKGk9aC5zcGxpdCgiLiIpLGg9aS4Kc2hpZnQoKSxpLnNvcnQoKSk7aWYoISFlJiYhZi5ldmVudC5jdXN0b21FdmVudFtoXXx8ISFmLmV2ZW50Lmdsb2JhbFtoXSl7Yz10eXBlb2YgYz09Im9iamVjdCI/Y1tmLmV4cGFuZG9dP2M6bmV3IGYuRXZlbnQoaCxjKTpuZXcgZi5FdmVudChoKSxjLnR5cGU9aCxjLmV4Y2x1c2l2ZT1qLGMubmFtZXNwYWNlPWkuam9pbigiLiIpLGMubmFtZXNwYWNlX3JlPW5ldyBSZWdFeHAoIihefFxcLikiK2kuam9pbigiXFwuKD86LipcXC4pPyIpKyIoXFwufCQpIik7aWYoZ3x8IWUpYy5wcmV2ZW50RGVmYXVsdCgpLGMuc3RvcFByb3BhZ2F0aW9uKCk7aWYoIWUpe2YuZWFjaChmLmNhY2hlLGZ1bmN0aW9uKCl7dmFyIGE9Zi5leHBhbmRvLGI9dGhpc1thXTtiJiZiLmV2ZW50cyYmYi5ldmVudHNbaF0mJmYuZXZlbnQudHJpZ2dlcihjLGQsYi5oYW5kbGUuZWxlbSl9KTtyZXR1cm59aWYoZS5ub2RlVHlwZT09PTN8fGUubm9kZVR5cGU9PT04KXJldHVybjtjLnJlc3VsdD1iLGMudGFyZ2V0PWUsZD1kIT1udWxsP2YubWFrZUFycmF5KGQpOltdLGQudW5zaGlmdChjKTt2YXIgaz1lLGw9aC5pbmRleE9mKCI6Iik8MD8ib24iK2g6IiI7ZG97dmFyIG09Zi5fZGF0YShrLCJoYW5kbGUiKTtjLmN1cnJlbnRUYXJnZXQ9ayxtJiZtLmFwcGx5KGssZCksbCYmZi5hY2NlcHREYXRhKGspJiZrW2xdJiZrW2xdLmFwcGx5KGssZCk9PT0hMSYmKGMucmVzdWx0PSExLGMucHJldmVudERlZmF1bHQoKSksaz1rLnBhcmVudE5vZGV8fGsub3duZXJEb2N1bWVudHx8az09PWMudGFyZ2V0Lm93bmVyRG9jdW1lbnQmJmF9d2hpbGUoayYmIWMuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSk7aWYoIWMuaXNEZWZhdWx0UHJldmVudGVkKCkpe3ZhciBuLG89Zi5ldmVudC5zcGVjaWFsW2hdfHx7fTtpZigoIW8uX2RlZmF1bHR8fG8uX2RlZmF1bHQuY2FsbChlLm93bmVyRG9jdW1lbnQsYyk9PT0hMSkmJihoIT09ImNsaWNrInx8IWYubm9kZU5hbWUoZSwiYSIpKSYmZi5hY2NlcHREYXRhKGUpKXt0cnl7bCYmZVtoXSYmKG49ZVtsXSxuJiYoZVtsXT1udWxsKSxmLmV2ZW50LnRyaWdnZXJlZD1oLGVbaF0oKSl9Y2F0Y2gocCl7fW4mJihlW2xdPW4pLGYuZXZlbnQudHJpZ2dlcmVkPWJ9fXJldHVybiBjLnJlc3VsdH19LGhhbmRsZTpmdW5jdGlvbihjKXtjPWYuZXZlbnQuZml4KGN8fGEuZXZlbnQpO3ZhciBkPSgoZi5fZGF0YSh0aGlzLCJldmVudHMiKXx8e30pW2MudHlwZV18fFtdKS5zbGljZSgwKSxlPSFjLmV4Y2x1c2l2ZSYmIWMubmFtZXNwYWNlLGc9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApO2dbMF09YyxjLmN1cnJlbnRUYXJnZXQ9dGhpcztmb3IodmFyIGg9MCxpPWQubGVuZ3RoO2g8aTtoKyspe3ZhciBqPWRbaF07aWYoZXx8Yy5uYW1lc3BhY2VfcmUudGVzdChqLm5hbWVzcGFjZSkpe2MuaGFuZGxlcj1qLmhhbmRsZXIsYy5kYXRhPWouZGF0YSxjLmhhbmRsZU9iaj1qO3ZhciBrPWouaGFuZGxlci5hcHBseSh0aGlzLGcpO2shPT1iJiYoYy5yZXN1bHQ9ayxrPT09ITEmJihjLnByZXZlbnREZWZhdWx0KCksYy5zdG9wUHJvcGFnYXRpb24oKSkpO2lmKGMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSlicmVha319cmV0dXJuIGMucmVzdWx0fSxwcm9wczoiYWx0S2V5IGF0dHJDaGFuZ2UgYXR0ck5hbWUgYnViYmxlcyBidXR0b24gY2FuY2VsYWJsZSBjaGFyQ29kZSBjbGllbnRYIGNsaWVudFkgY3RybEtleSBjdXJyZW50VGFyZ2V0IGRhdGEgZGV0YWlsIGV2ZW50UGhhc2UgZnJvbUVsZW1lbnQgaGFuZGxlciBrZXlDb2RlIGxheWVyWCBsYXllclkgbWV0YUtleSBuZXdWYWx1ZSBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgcHJldlZhbHVlIHJlbGF0ZWROb2RlIHJlbGF0ZWRUYXJnZXQgc2NyZWVuWCBzY3JlZW5ZIHNoaWZ0S2V5IHNyY0VsZW1lbnQgdGFyZ2V0IHRvRWxlbWVudCB2aWV3IHdoZWVsRGVsdGEgd2hpY2giLnNwbGl0KCIgIiksZml4OmZ1bmN0aW9uKGEpe2lmKGFbZi5leHBhbmRvXSlyZXR1cm4gYTt2YXIgZD1hO2E9Zi5FdmVudChkKTtmb3IodmFyIGU9dGhpcy5wcm9wcy5sZW5ndGgsZztlOylnPXRoaXMucHJvcHNbLS1lXSxhW2ddPWRbZ107YS50YXJnZXR8fChhLnRhcmdldD1hLnNyY0VsZW1lbnR8fGMpLGEudGFyZ2V0Lm5vZGVUeXBlPT09MyYmKGEudGFyZ2V0PWEudGFyZ2V0LnBhcmVudE5vZGUpLCFhLnJlbGF0ZWRUYXJnZXQmJmEuZnJvbUVsZW1lbnQmJihhLnJlbGF0ZWRUYXJnZXQ9YS5mcm9tRWxlbWVudD09PWEudGFyZ2V0P2EudG9FbGVtZW50OmEuZnJvbUVsZW1lbnQpO2lmKGEucGFnZVg9PW51bGwmJmEuY2xpZW50WCE9bnVsbCl7dmFyIGg9YS50YXJnZXQub3duZXJEb2N1bWVudHx8YyxpPWguZG9jdW1lbnRFbGVtZW50LGo9aC5ib2R5O2EucGFnZVg9YS5jbGllbnRYKyhpJiZpLnNjcm9sbExlZnR8fGomJmouc2Nyb2xsTGVmdHx8MCktKGkmJmkuY2xpZW50TGVmdHx8aiYmai5jbGllbnRMZWZ0fHwwKSxhLnBhZ2VZPWEuY2xpZW50WSsoaSYmaS5zY3JvbGxUb3B8fGomJmouc2Nyb2xsVG9wfHwwKS0oaSYmaS5jbGllbnRUb3B8fGomJmouY2xpZW50VG9wfHwwKX1hLndoaWNoPT1udWxsJiYoYS5jaGFyQ29kZSE9bnVsbHx8YS5rZXlDb2RlIT1udWxsKSYmKGEud2hpY2g9YS5jaGFyQ29kZSE9bnVsbD9hLmNoYXJDb2RlOmEua2V5Q29kZSksIWEubWV0YUtleSYmYS5jdHJsS2V5JiYoYS5tZXRhS2V5PWEuY3RybEtleSksIWEud2hpY2gmJmEuYnV0dG9uIT09YiYmKGEud2hpY2g9YS5idXR0b24mMT8xOmEuYnV0dG9uJjI/MzphLmJ1dHRvbiY0PzI6MCk7cmV0dXJuIGF9LGd1aWQ6MWU4LHByb3h5OmYucHJveHksc3BlY2lhbDp7cmVhZHk6e3NldHVwOmYuYmluZFJlYWR5LHRlYXJkb3duOmYubm9vcH0sbGl2ZTp7YWRkOmZ1bmN0aW9uKGEpe2YuZXZlbnQuYWRkKHRoaXMsTihhLm9yaWdUeXBlLGEuc2VsZWN0b3IpLGYuZXh0ZW5kKHt9LGEse2hhbmRsZXI6TSxndWlkOmEuaGFuZGxlci5ndWlkfSkpfSxyZW1vdmU6ZnVuY3Rpb24oYSl7Zi5ldmVudC5yZW1vdmUodGhpcyxOKGEub3JpZ1R5cGUsYS5zZWxlY3RvciksYSl9fSxiZWZvcmV1bmxvYWQ6e3NldHVwOmZ1bmN0aW9uKGEsYixjKXtmLmlzV2luZG93KHRoaXMpJiYodGhpcy5vbmJlZm9yZXVubG9hZD1jKX0sdGVhcmRvd246ZnVuY3Rpb24oYSxiKXt0aGlzLm9uYmVmb3JldW5sb2FkPT09YiYmKHRoaXMub25iZWZvcmV1bmxvYWQ9bnVsbCl9fX19LGYucmVtb3ZlRXZlbnQ9Yy5yZW1vdmVFdmVudExpc3RlbmVyP2Z1bmN0aW9uKGEsYixjKXthLnJlbW92ZUV2ZW50TGlzdGVuZXImJmEucmVtb3ZlRXZlbnRMaXN0ZW5lcihiLGMsITEpfTpmdW5jdGlvbihhLGIsYyl7YS5kZXRhY2hFdmVudCYmYS5kZXRhY2hFdmVudCgib24iK2IsYyl9LGYuRXZlbnQ9ZnVuY3Rpb24oYSxiKXtpZighdGhpcy5wcmV2ZW50RGVmYXVsdClyZXR1cm4gbmV3IGYuRXZlbnQoYSxiKTthJiZhLnR5cGU/KHRoaXMub3JpZ2luYWxFdmVudD1hLHRoaXMudHlwZT1hLnR5cGUsdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9YS5kZWZhdWx0UHJldmVudGVkfHxhLnJldHVyblZhbHVlPT09ITF8fGEuZ2V0UHJldmVudERlZmF1bHQmJmEuZ2V0UHJldmVudERlZmF1bHQoKT9FOkQpOnRoaXMudHlwZT1hLGImJmYuZXh0ZW5kKHRoaXMsYiksdGhpcy50aW1lU3RhbXA9Zi5ub3coKSx0aGlzW2YuZXhwYW5kb109ITB9LGYuRXZlbnQucHJvdG90eXBlPXtwcmV2ZW50RGVmYXVsdDpmdW5jdGlvbigpe3RoaXMuaXNEZWZhdWx0UHJldmVudGVkPUU7dmFyIGE9dGhpcy5vcmlnaW5hbEV2ZW50OyFhfHwoYS5wcmV2ZW50RGVmYXVsdD9hLnByZXZlbnREZWZhdWx0KCk6YS5yZXR1cm5WYWx1ZT0hMSl9LHN0b3BQcm9wYWdhdGlvbjpmdW5jdGlvbigpe3RoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQ9RTt2YXIgYT10aGlzLm9yaWdpbmFsRXZlbnQ7IWF8fChhLnN0b3BQcm9wYWdhdGlvbiYmYS5zdG9wUHJvcGFnYXRpb24oKSxhLmNhbmNlbEJ1YmJsZT0hMCl9LHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjpmdW5jdGlvbigpe3RoaXMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ9RSx0aGlzLnN0b3BQcm9wYWdhdGlvbigpfSxpc0RlZmF1bHRQcmV2ZW50ZWQ6RCxpc1Byb3BhZ2F0aW9uU3RvcHBlZDpELGlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOkR9O3ZhciBGPWZ1bmN0aW9uKGEpe3ZhciBiPWEucmVsYXRlZFRhcmdldCxjPSExLGQ9YS50eXBlO2EudHlwZT1hLmRhdGEsYiE9PXRoaXMmJihiJiYoYz1mLmNvbnRhaW5zKHRoaXMsYikpLGN8fChmLmV2ZW50LmhhbmRsZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksYS50eXBlPWQpKX0sRz1mdW5jdGlvbihhKXthLnR5cGU9YS5kYXRhLGYuZXZlbnQuaGFuZGxlLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07Zi5lYWNoKHttb3VzZWVudGVyOiJtb3VzZW92ZXIiLG1vdXNlbGVhdmU6Im1vdXNlb3V0In0sZnVuY3Rpb24oYSxiKXtmLmV2ZW50LnNwZWNpYWxbYV09e3NldHVwOmZ1bmN0aW9uKGMpe2YuZXZlbnQuYWRkKHRoaXMsYixjJiZjLnNlbGVjdG9yP0c6RixhKX0sdGVhcmRvd246ZnVuY3Rpb24oYSl7Zi5ldmVudC5yZW1vdmUodGhpcyxiLGEmJmEuc2VsZWN0b3I/RzpGKX19fSksZi5zdXBwb3J0LnN1Ym1pdEJ1YmJsZXN8fChmLmV2ZW50LnNwZWNpYWwuc3VibWl0PXtzZXR1cDpmdW5jdGlvbihhLGIpe2lmKCFmLm5vZGVOYW1lKHRoaXMsImZvcm0iKSlmLmV2ZW50LmFkZCh0aGlzLCJjbGljay5zcGVjaWFsU3VibWl0IixmdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldCxjPWIudHlwZTsoYz09PSJzdWJtaXQifHxjPT09ImltYWdlIikmJmYoYikuY2xvc2VzdCgiZm9ybSIpLmxlbmd0aCYmSygic3VibWl0Iix0aGlzLGFyZ3VtZW50cyl9KSxmLmV2ZW50LmFkZCh0aGlzLCJrZXlwcmVzcy5zcGVjaWFsU3VibWl0IixmdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldCxjPWIudHlwZTsoYz09PSJ0ZXh0Inx8Yz09PSJwYXNzd29yZCIpJiZmKGIpLmNsb3Nlc3QoImZvcm0iKS5sZW5ndGgmJmEua2V5Q29kZT09PTEzJiZLKCJzdWJtaXQiLHRoaXMsYXJndW1lbnRzKX0pO2Vsc2UgcmV0dXJuITF9LHRlYXJkb3duOmZ1bmN0aW9uKGEpe2YuZXZlbnQucmVtb3ZlKHRoaXMsIi5zcGVjaWFsU3VibWl0Iil9fSk7aWYoIWYuc3VwcG9ydC5jaGFuZ2VCdWJibGVzKXt2YXIgSCxJPWZ1bmN0aW9uKGEpe3ZhciBiPWEudHlwZSxjPWEudmFsdWU7Yj09PSJyYWRpbyJ8fGI9PT0iY2hlY2tib3giP2M9YS5jaGVja2VkOmI9PT0ic2VsZWN0LW11bHRpcGxlIj9jPWEuc2VsZWN0ZWRJbmRleD4tMT9mLm1hcChhLm9wdGlvbnMsZnVuY3Rpb24oYSl7cmV0dXJuIGEuc2VsZWN0ZWR9KS5qb2luKCItIik6IiI6Zi5ub2RlTmFtZShhLCJzZWxlY3QiKSYmKGM9YS5zZWxlY3RlZEluZGV4KTtyZXR1cm4gY30sSj1mdW5jdGlvbihjKXt2YXIgZD1jLnRhcmdldCxlLGc7aWYoISF5LnRlc3QoZC5ub2RlTmFtZSkmJiFkLnJlYWRPbmx5KXtlPWYuX2RhdGEoZCwiX2NoYW5nZV9kYXRhIiksZz1JKGQpLChjLnR5cGUhPT0iZm9jdXNvdXQifHxkLnR5cGUhPT0icmFkaW8iKSYmZi5fZGF0YShkLCJfY2hhbmdlX2RhdGEiLGcpO2lmKGU9PT1ifHxnPT09ZSlyZXR1cm47aWYoZSE9bnVsbHx8ZyljLnR5cGU9ImNoYW5nZSIsYy5saXZlRmlyZWQ9YixmLmV2ZW50LnRyaWdnZXIoYyxhcmd1bWVudHNbMV0sZCl9fTtmLmV2ZW50LnNwZWNpYWwuY2hhbmdlPXtmaWx0ZXJzOntmb2N1c291dDpKLGJlZm9yZWRlYWN0aXZhdGU6SixjbGljazpmdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldCxjPWYubm9kZU5hbWUoYiwiaW5wdXQiKT9iLnR5cGU6IiI7KGM9PT0icmFkaW8ifHxjPT09ImNoZWNrYm94Inx8Zi5ub2RlTmFtZShiLCJzZWxlY3QiKSkmJkouY2FsbCh0aGlzLGEpfSxrZXlkb3duOmZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0LGM9Zi5ub2RlTmFtZShiLCJpbnB1dCIpP2IudHlwZToiIjsoYS5rZXlDb2RlPT09MTMmJiFmLm5vZGVOYW1lKGIsInRleHRhcmVhIil8fGEua2V5Q29kZT09PTMyJiYoYz09PSJjaGVja2JveCJ8fGM9PT0icmFkaW8iKXx8Yz09PSJzZWxlY3QtbXVsdGlwbGUiKSYmSi5jYWxsKHRoaXMsYSl9LGJlZm9yZWFjdGl2YXRlOmZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0O2YuX2RhdGEoYiwiX2NoYW5nZV9kYXRhIixJKGIpKX19LHNldHVwOmZ1bmN0aW9uKGEsYil7aWYodGhpcy50eXBlPT09ImZpbGUiKXJldHVybiExO2Zvcih2YXIgYyBpbiBIKWYuZXZlbnQuYWRkKHRoaXMsYysiLnNwZWNpYWxDaGFuZ2UiLEhbY10pO3JldHVybiB5LnRlc3QodGhpcy5ub2RlTmFtZSl9LHRlYXJkb3duOmZ1bmN0aW9uKGEpe2YuZXZlbnQucmVtb3ZlKHRoaXMsIi5zcGVjaWFsQ2hhbmdlIik7cmV0dXJuIHkudGVzdCh0aGlzLm5vZGVOYW1lKX19LEg9Zi5ldmVudC5zcGVjaWFsLmNoYW5nZS5maWx0ZXJzLEguZm9jdXM9SC5iZWZvcmVhY3RpdmF0ZX1mLnN1cHBvcnQuZm9jdXNpbkJ1YmJsZXN8fGYuZWFjaCh7Zm9jdXM6ImZvY3VzaW4iLGJsdXI6ImZvY3Vzb3V0In0sZnVuY3Rpb24oYSxiKXtmdW5jdGlvbiBlKGEpe3ZhciBjPWYuZXZlbnQuZml4KGEpO2MudHlwZT1iLGMub3JpZ2luYWxFdmVudD17fSxmLmV2ZW50LnRyaWdnZXIoYyxudWxsLGMudGFyZ2V0KSxjLmlzRGVmYXVsdFByZXZlbnRlZCgpJiZhLnByZXZlbnREZWZhdWx0KCl9dmFyIGQ9MDtmLmV2ZW50LnNwZWNpYWxbYl09e3NldHVwOmZ1bmN0aW9uKCl7ZCsrPT09MCYmYy5hZGRFdmVudExpc3RlbmVyKGEsZSwhMCl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7LS1kPT09MCYmYy5yZW1vdmVFdmVudExpc3RlbmVyKGEsZSwhMCl9fX0pLGYuZWFjaChbImJpbmQiLCJvbmUiXSxmdW5jdGlvbihhLGMpe2YuZm5bY109ZnVuY3Rpb24oYSxkLGUpe3ZhciBnO2lmKHR5cGVvZiBhPT0ib2JqZWN0Iil7Zm9yKHZhciBoIGluIGEpdGhpc1tjXShoLGQsYVtoXSxlKTtyZXR1cm4gdGhpc31pZihhcmd1bWVudHMubGVuZ3RoPT09Mnx8ZD09PSExKWU9ZCxkPWI7Yz09PSJvbmUiPyhnPWZ1bmN0aW9uKGEpe2YodGhpcykudW5iaW5kKGEsZyk7cmV0dXJuIGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxnLmd1aWQ9ZS5ndWlkfHxmLmd1aWQrKyk6Zz1lO2lmKGE9PT0idW5sb2FkIiYmYyE9PSJvbmUiKXRoaXMub25lKGEsZCxlKTtlbHNlIGZvcih2YXIgaT0wLGo9dGhpcy5sZW5ndGg7aTxqO2krKylmLmV2ZW50LmFkZCh0aGlzW2ldLGEsZyxkKTtyZXR1cm4gdGhpc319KSxmLmZuLmV4dGVuZCh7dW5iaW5kOmZ1bmN0aW9uKGEsYil7aWYodHlwZW9mIGE9PSJvYmplY3QiJiYhYS5wcmV2ZW50RGVmYXVsdClmb3IodmFyIGMgaW4gYSl0aGlzLnVuYmluZChjLGFbY10pO2Vsc2UgZm9yKHZhciBkPTAsZT10aGlzLmxlbmd0aDtkPGU7ZCsrKWYuZXZlbnQucmVtb3ZlKHRoaXNbZF0sYSxiKTtyZXR1cm4gdGhpc30sZGVsZWdhdGU6ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIHRoaXMubGl2ZShiLGMsZCxhKX0sdW5kZWxlZ2F0ZTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg9PT0wP3RoaXMudW5iaW5kKCJsaXZlIik6dGhpcy5kaWUoYixudWxsLGMsYSl9LHRyaWdnZXI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zi5ldmVudC50cmlnZ2VyKGEsYix0aGlzKX0pfSx0cmlnZ2VySGFuZGxlcjpmdW5jdGlvbihhLGIpe2lmKHRoaXNbMF0pcmV0dXJuIGYuZXZlbnQudHJpZ2dlcihhLGIsdGhpc1swXSwhMCl9LHRvZ2dsZTpmdW5jdGlvbihhKXt2YXIgYj1hcmd1bWVudHMsYz1hLmd1aWR8fGYuZ3VpZCsrLGQ9MCxlPWZ1bmN0aW9uKGMpe3ZhciBlPShmLmRhdGEodGhpcywibGFzdFRvZ2dsZSIrYS5ndWlkKXx8MCklZDtmLmRhdGEodGhpcywibGFzdFRvZ2dsZSIrYS5ndWlkLGUrMSksYy5wcmV2ZW50RGVmYXVsdCgpO3JldHVybiBiW2VdLmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8ITF9O2UuZ3VpZD1jO3doaWxlKGQ8Yi5sZW5ndGgpYltkKytdLmd1aWQ9YztyZXR1cm4gdGhpcy5jbGljayhlKX0saG92ZXI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5tb3VzZWVudGVyKGEpLm1vdXNlbGVhdmUoYnx8YSl9fSk7dmFyIEw9e2ZvY3VzOiJmb2N1c2luIixibHVyOiJmb2N1c291dCIsbW91c2VlbnRlcjoibW91c2VvdmVyIixtb3VzZWxlYXZlOiJtb3VzZW91dCJ9O2YuZWFjaChbImxpdmUiLCJkaWUiXSxmdW5jdGlvbihhLGMpe2YuZm5bY109ZnVuY3Rpb24oYSxkLGUsZyl7dmFyIGgsaT0wLGosayxsLG09Z3x8dGhpcy5zZWxlY3RvcixuPWc/dGhpczpmKHRoaXMuY29udGV4dCk7aWYodHlwZW9mIGE9PSJvYmplY3QiJiYhYS5wcmV2ZW50RGVmYXVsdCl7Zm9yKHZhciBvIGluIGEpbltjXShvLGQsYVtvXSxtKTtyZXR1cm4gdGhpc31pZihjPT09ImRpZSImJiFhJiZnJiZnLmNoYXJBdCgwKT09PSIuIil7bi51bmJpbmQoZyk7cmV0dXJuIHRoaXN9aWYoZD09PSExfHxmLmlzRnVuY3Rpb24oZCkpZT1kfHxELGQ9YjthPShhfHwiIikuc3BsaXQoIiAiKTt3aGlsZSgoaD1hW2krK10pIT1udWxsKXtqPXguZXhlYyhoKSxrPSIiLGomJihrPWpbMF0saD1oLnJlcGxhY2UoeCwiIikpO2lmKGg9PT0iaG92ZXIiKXthLnB1c2goIm1vdXNlZW50ZXIiK2ssIm1vdXNlbGVhdmUiK2spO2NvbnRpbnVlfWw9aCxMW2hdPyhhLnB1c2goTFtoXStrKSxoPWgrayk6aD0oTFtoXXx8aCkraztpZihjPT09ImxpdmUiKWZvcih2YXIgcD0wLHE9bi5sZW5ndGg7cDxxO3ArKylmLmV2ZW50LmFkZChuW3BdLCJsaXZlLiIrTihoLG0pLHtkYXRhOmQsc2VsZWN0b3I6bSxoYW5kbGVyOmUsb3JpZ1R5cGU6aCxvcmlnSGFuZGxlcjplLHByZVR5cGU6bH0pO2Vsc2Ugbi51bmJpbmQoImxpdmUuIitOKGgsbSksZSl9cmV0dXJuIHRoaXN9fSksZi5lYWNoKCJibHVyIGZvY3VzIGZvY3VzaW4gZm9jdXNvdXQgbG9hZCByZXNpemUgc2Nyb2xsIHVubG9hZCBjbGljayBkYmxjbGljayBtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0IG1vdXNlZW50ZXIgbW91c2VsZWF2ZSBjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGVycm9yIi5zcGxpdCgiICIpLGZ1bmN0aW9uKGEsYil7Zi5mbltiXT1mdW5jdGlvbihhLGMpe2M9PW51bGwmJihjPWEsYT1udWxsKTtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD4wP3RoaXMuYmluZChiLGEsYyk6dGhpcy50cmlnZ2VyKGIpfSxmLmF0dHJGbiYmKGYuYXR0ckZuW2JdPSEwKX0pLGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdShhLGIsYyxkLGUsZil7Zm9yKHZhciBnPTAsaD1kLmxlbmd0aDtnPGg7ZysrKXt2YXIgaT1kW2ddO2lmKGkpe3ZhciBqPSExO2k9aVthXTt3aGlsZShpKXtpZihpLnNpemNhY2hlPT09Yyl7aj1kW2kuc2l6c2V0XTticmVha31pZihpLm5vZGVUeXBlPT09MSl7Znx8KGkuc2l6Y2FjaGU9YyxpLnNpenNldD1nKTtpZih0eXBlb2YgYiE9InN0cmluZyIpe2lmKGk9PT1iKXtqPSEwO2JyZWFrfX1lbHNlIGlmKGsuZmlsdGVyKGIsW2ldKS5sZW5ndGg+MCl7aj1pO2JyZWFrfX1pPWlbYV19ZFtnXT1qfX19ZnVuY3Rpb24gdChhLGIsYyxkLGUsZil7Zm9yKHZhciBnPTAsaD1kLmxlbmd0aDtnPGg7ZysrKXt2YXIgaT1kW2ddO2lmKGkpe3ZhciBqPSExO2k9aVthXTt3aGlsZShpKXtpZihpLnNpemNhY2hlPT09Yyl7aj1kW2kuc2l6c2V0XTticmVha31pLm5vZGVUeXBlPT09MSYmIWYmJihpLnNpemNhY2hlPWMsaS5zaXpzZXQ9Zyk7aWYoaS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09Yil7aj1pO2JyZWFrfWk9aVthXX1kW2ddPWp9fX12YXIgYT0vKCg/OlwoKD86XChbXigpXStcKXxbXigpXSspK1wpfFxbKD86XFtbXlxbXF1dKlxdfFsnIl1bXiciXSpbJyJdfFteXFtcXSciXSspK1xdfFxcLnxbXiA+K34sKFxbXFxdKykrfFs+K35dKShccyosXHMqKT8oKD86LnxccnxcbikqKS9nLGQ9MCxlPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsZz0hMSxoPSEwLGk9L1xcL2csaj0vXFcvO1swLDBdLnNvcnQoZnVuY3Rpb24oKXtoPSExO3JldHVybiAwfSk7dmFyIGs9ZnVuY3Rpb24oYixkLGYsZyl7Zj1mfHxbXSxkPWR8fGM7dmFyIGg9ZDtpZihkLm5vZGVUeXBlIT09MSYmZC5ub2RlVHlwZSE9PTkpcmV0dXJuW107aWYoIWJ8fHR5cGVvZiBiIT0ic3RyaW5nIilyZXR1cm4gZjt2YXIgaSxqLG4sbyxxLHIscyx0LHU9ITAsdz1rLmlzWE1MKGQpLHg9W10seT1iO2Rve2EuZXhlYygiIiksaT1hLmV4ZWMoeSk7aWYoaSl7eT1pWzNdLHgucHVzaChpWzFdKTtpZihpWzJdKXtvPWlbM107YnJlYWt9fX13aGlsZShpKTtpZih4Lmxlbmd0aD4xJiZtLmV4ZWMoYikpaWYoeC5sZW5ndGg9PT0yJiZsLnJlbGF0aXZlW3hbMF1dKWo9dih4WzBdK3hbMV0sZCk7ZWxzZXtqPWwucmVsYXRpdmVbeFswXV0/W2RdOmsoeC5zaGlmdCgpLGQpO3doaWxlKHgubGVuZ3RoKWI9eC5zaGlmdCgpLGwucmVsYXRpdmVbYl0mJihiKz14LnNoaWZ0KCkpLGo9dihiLGopfWVsc2V7IWcmJngubGVuZ3RoPjEmJmQubm9kZVR5cGU9PT05JiYhdyYmbC5tYXRjaC5JRC50ZXN0KHhbMF0pJiYhbC5tYXRjaC5JRC50ZXN0KHhbeC5sZW5ndGgtMV0pJiYocT1rLmZpbmQoeC5zaGlmdCgpLGQsdyksZD1xLmV4cHI/ay5maWx0ZXIocS5leHByLHEuc2V0KVswXTpxLnNldFswXSk7aWYoZCl7cT1nP3tleHByOngucG9wKCksc2V0OnAoZyl9OmsuZmluZCh4LnBvcCgpLHgubGVuZ3RoPT09MSYmKHhbMF09PT0ifiJ8fHhbMF09PT0iKyIpJiZkLnBhcmVudE5vZGU/ZC5wYXJlbnROb2RlOmQsdyksaj1xLmV4cHI/ay5maWx0ZXIocS5leHByLHEuc2V0KTpxLnNldCx4Lmxlbmd0aD4wP249cChqKTp1PSExO3doaWxlKHgubGVuZ3RoKXI9eC5wb3AoKSxzPXIsbC5yZWxhdGl2ZVtyXT9zPXgucG9wKCk6cj0iIixzPT1udWxsJiYocz1kKSxsLnJlbGF0aXZlW3JdKG4scyx3KX1lbHNlIG49eD1bXX1ufHwobj1qKSxufHxrLmVycm9yKHJ8fGIpO2lmKGUuY2FsbChuKT09PSJbb2JqZWN0IEFycmF5XSIpaWYoIXUpZi5wdXNoLmFwcGx5KGYsbik7ZWxzZSBpZihkJiZkLm5vZGVUeXBlPT09MSlmb3IodD0wO25bdF0hPW51bGw7dCsrKW5bdF0mJihuW3RdPT09ITB8fG5bdF0ubm9kZVR5cGU9PT0xJiZrLmNvbnRhaW5zKGQsblt0XSkpJiZmLnB1c2goalt0XSk7ZWxzZSBmb3IodD0wO25bdF0hPW51bGw7dCsrKW5bdF0mJm5bdF0ubm9kZVR5cGU9PT0xJiZmLnB1c2goalt0XSk7ZWxzZSBwKG4sZik7byYmKGsobyxoLGYsZyksay51bmlxdWVTb3J0KGYpKTtyZXR1cm4gZn07ay51bmlxdWVTb3J0PWZ1bmN0aW9uKGEpe2lmKHIpe2c9aCxhLnNvcnQocik7aWYoZylmb3IodmFyIGI9MTtiPGEubGVuZ3RoO2IrKylhW2JdPT09YVtiLTFdJiZhLnNwbGljZShiLS0sMSl9cmV0dXJuIGF9LGsubWF0Y2hlcz1mdW5jdGlvbihhLGIpe3JldHVybiBrKGEsbnVsbCxudWxsLGIpfSxrLm1hdGNoZXNTZWxlY3Rvcj1mdW5jdGlvbihhLGIpe3JldHVybiBrKGIsbnVsbCxudWxsLFthXSkubGVuZ3RoPjB9LGsuZmluZD1mdW5jdGlvbihhLGIsYyl7dmFyIGQ7aWYoIWEpcmV0dXJuW107Zm9yKHZhciBlPTAsZj1sLm9yZGVyLmxlbmd0aDtlPGY7ZSsrKXt2YXIgZyxoPWwub3JkZXJbZV07aWYoZz1sLmxlZnRNYXRjaFtoXS5leGVjKGEpKXt2YXIgaj1nWzFdO2cuc3BsaWNlKDEsMSk7aWYoai5zdWJzdHIoai5sZW5ndGgtMSkhPT0iXFwiKXtnWzFdPShnWzFdfHwiIikucmVwbGFjZShpLCIiKSxkPWwuZmluZFtoXShnLGIsYyk7aWYoZCE9bnVsbCl7YT1hLnJlcGxhY2UobC5tYXRjaFtoXSwiIik7YnJlYWt9fX19ZHx8KGQ9dHlwZW9mIGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUhPSJ1bmRlZmluZWQiP2IuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKTpbXSk7cmV0dXJue3NldDpkLGV4cHI6YX19LGsuZmlsdGVyPWZ1bmN0aW9uKGEsYyxkLGUpe3ZhciBmLGcsaD1hLGk9W10saj1jLG09YyYmY1swXSYmay5pc1hNTChjWzBdKTt3aGlsZShhJiZjLmxlbmd0aCl7Zm9yKHZhciBuIGluIGwuZmlsdGVyKWlmKChmPWwubGVmdE1hdGNoW25dLmV4ZWMoYSkpIT1udWxsJiZmWzJdKXt2YXIgbyxwLHE9bC5maWx0ZXJbbl0scj1mWzFdO2c9ITEsZi5zcGxpY2UoMSwxKTtpZihyLnN1YnN0cihyLmxlbmd0aC0xKT09PSJcXCIpY29udGludWU7aj09PWkmJihpPVtdKTtpZihsLnByZUZpbHRlcltuXSl7Zj1sLnByZUZpbHRlcltuXShmLGosZCxpLGUsbSk7aWYoIWYpZz1vPSEwO2Vsc2UgaWYoZj09PSEwKWNvbnRpbnVlfWlmKGYpZm9yKHZhciBzPTA7KHA9altzXSkhPW51bGw7cysrKWlmKHApe289cShwLGYscyxqKTt2YXIgdD1lXiEhbztkJiZvIT1udWxsP3Q/Zz0hMDpqW3NdPSExOnQmJihpLnB1c2gocCksZz0hMCl9aWYobyE9PWIpe2R8fChqPWkpLGE9YS5yZXBsYWNlKGwubWF0Y2hbbl0sIiIpO2lmKCFnKXJldHVybltdO2JyZWFrfX1pZihhPT09aClpZihnPT1udWxsKWsuZXJyb3IoYSk7ZWxzZSBicmVhaztoPWF9cmV0dXJuIGp9LGsuZXJyb3I9ZnVuY3Rpb24oYSl7dGhyb3ciU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogIithfTt2YXIgbD1rLnNlbGVjdG9ycz17b3JkZXI6WyJJRCIsIk5BTUUiLCJUQUciXSxtYXRjaDp7SUQ6LyMoKD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKykvLENMQVNTOi9cLigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKS8sTkFNRTovXFtuYW1lPVsnIl0qKCg/Oltcd1x1MDBjMC1cdUZGRkZcLV18XFwuKSspWyciXSpcXS8sQVRUUjovXFtccyooKD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKylccyooPzooXFM/PSlccyooPzooWyciXSkoLio/KVwzfCgjPyg/Oltcd1x1MDBjMC1cdUZGRkZcLV18XFwuKSopfCl8KVxzKlxdLyxUQUc6L14oKD86W1x3XHUwMGMwLVx1RkZGRlwqXC1dfFxcLikrKS8sQ0hJTEQ6Lzoob25seXxudGh8bGFzdHxmaXJzdCktY2hpbGQoPzpcKFxzKihldmVufG9kZHwoPzpbK1wtXT9cZCt8KD86WytcLV0/XGQqKT9uXHMqKD86WytcLV1ccypcZCspPykpXHMqXCkpPy8sUE9TOi86KG50aHxlcXxndHxsdHxmaXJzdHxsYXN0fGV2ZW58b2RkKSg/OlwoKFxkKilcKSk/KD89W15cLV18JCkvLFBTRVVETzovOigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKSg/OlwoKFsnIl0/KSgoPzpcKFteXCldK1wpfFteXChcKV0qKSspXDJcKSk/L30sbGVmdE1hdGNoOnt9LGF0dHJNYXA6eyJjbGFzcyI6ImNsYXNzTmFtZSIsImZvciI6Imh0bWxGb3IifSxhdHRySGFuZGxlOntocmVmOmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgiaHJlZiIpfSx0eXBlOmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgidHlwZSIpfX0scmVsYXRpdmU6eyIrIjpmdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBiPT0ic3RyaW5nIixkPWMmJiFqLnRlc3QoYiksZT1jJiYhZDtkJiYoYj1iLnRvTG93ZXJDYXNlKCkpO2Zvcih2YXIgZj0wLGc9YS5sZW5ndGgsaDtmPGc7ZisrKWlmKGg9YVtmXSl7d2hpbGUoKGg9aC5wcmV2aW91c1NpYmxpbmcpJiZoLm5vZGVUeXBlIT09MSk7YVtmXT1lfHxoJiZoLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iP2h8fCExOmg9PT1ifWUmJmsuZmlsdGVyKGIsYSwhMCl9LCI+IjpmdW5jdGlvbihhLGIpe3ZhciBjLGQ9dHlwZW9mIGI9PSJzdHJpbmciLGU9MCxmPWEubGVuZ3RoO2lmKGQmJiFqLnRlc3QoYikpe2I9Yi50b0xvd2VyQ2FzZSgpO2Zvcig7ZTxmO2UrKyl7Yz1hW2VdO2lmKGMpe3ZhciBnPWMucGFyZW50Tm9kZTthW2VdPWcubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWI/ZzohMX19fWVsc2V7Zm9yKDtlPGY7ZSsrKWM9YVtlXSxjJiYoYVtlXT1kP2MucGFyZW50Tm9kZTpjLnBhcmVudE5vZGU9PT1iKTtkJiZrLmZpbHRlcihiLGEsITApfX0sIiI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBlLGY9ZCsrLGc9dTt0eXBlb2YgYj09InN0cmluZyImJiFqLnRlc3QoYikmJihiPWIudG9Mb3dlckNhc2UoKSxlPWIsZz10KSxnKCJwYXJlbnROb2RlIixiLGYsYSxlLGMpfSwifiI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBlLGY9ZCsrLGc9dTt0eXBlb2YgYj09InN0cmluZyImJiFqLnRlc3QoYikmJihiPWIudG9Mb3dlckNhc2UoKSxlPWIsZz10KSxnKCJwcmV2aW91c1NpYmxpbmciLGIsZixhLGUsYyl9fSxmaW5kOntJRDpmdW5jdGlvbihhLGIsYyl7aWYodHlwZW9mIGIuZ2V0RWxlbWVudEJ5SWQhPSJ1bmRlZmluZWQiJiYhYyl7dmFyIGQ9Yi5nZXRFbGVtZW50QnlJZChhWzFdKTtyZXR1cm4gZCYmZC5wYXJlbnROb2RlP1tkXTpbXX19LE5BTUU6ZnVuY3Rpb24oYSxiKXtpZih0eXBlb2YgYi5nZXRFbGVtZW50c0J5TmFtZSE9InVuZGVmaW5lZCIpe3ZhciBjPVtdLGQ9Yi5nZXRFbGVtZW50c0J5TmFtZShhWzFdKTtmb3IodmFyIGU9MCxmPWQubGVuZ3RoO2U8ZjtlKyspZFtlXS5nZXRBdHRyaWJ1dGUoIm5hbWUiKT09PWFbMV0mJmMucHVzaChkW2VdKTtyZXR1cm4gYy5sZW5ndGg9PT0wP251bGw6Y319LFRBRzpmdW5jdGlvbihhLGIpe2lmKHR5cGVvZiBiLmdldEVsZW1lbnRzQnlUYWdOYW1lIT0idW5kZWZpbmVkIilyZXR1cm4gYi5nZXRFbGVtZW50c0J5VGFnTmFtZShhWzFdKX19LHByZUZpbHRlcjp7Q0xBU1M6ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe2E9IiAiK2FbMV0ucmVwbGFjZShpLCIiKSsiICI7aWYoZilyZXR1cm4gYTtmb3IodmFyIGc9MCxoOyhoPWJbZ10pIT1udWxsO2crKyloJiYoZV4oaC5jbGFzc05hbWUmJigiICIraC5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKC9bXHRcblxyXS9nLCIgIikuaW5kZXhPZihhKT49MCk/Y3x8ZC5wdXNoKGgpOmMmJihiW2ddPSExKSk7cmV0dXJuITF9LElEOmZ1bmN0aW9uKGEpe3JldHVybiBhWzFdLnJlcGxhY2UoaSwiIil9LFRBRzpmdW5jdGlvbihhLGIpe3JldHVybiBhWzFdLnJlcGxhY2UoaSwiIikudG9Mb3dlckNhc2UoKX0sQ0hJTEQ6ZnVuY3Rpb24oYSl7aWYoYVsxXT09PSJudGgiKXthWzJdfHxrLmVycm9yKGFbMF0pLGFbMl09YVsyXS5yZXBsYWNlKC9eXCt8XHMqL2csIiIpO3ZhciBiPS8oLT8pKFxkKikoPzpuKFsrXC1dP1xkKikpPy8uZXhlYyhhWzJdPT09ImV2ZW4iJiYiMm4ifHxhWzJdPT09Im9kZCImJiIybisxInx8IS9cRC8udGVzdChhWzJdKSYmIjBuKyIrYVsyXXx8YVsyXSk7YVsyXT1iWzFdKyhiWzJdfHwxKS0wLGFbM109YlszXS0wfWVsc2UgYVsyXSYmay5lcnJvcihhWzBdKTthWzBdPWQrKztyZXR1cm4gYX0sQVRUUjpmdW5jdGlvbihhLGIsYyxkLGUsZil7dmFyIGc9YVsxXT1hWzFdLnJlcGxhY2UoaSwiIik7IWYmJmwuYXR0ck1hcFtnXSYmKGFbMV09bC5hdHRyTWFwW2ddKSxhWzRdPShhWzRdfHxhWzVdfHwiIikucmVwbGFjZShpLCIiKSxhWzJdPT09In49IiYmKGFbNF09IiAiK2FbNF0rIiAiKTtyZXR1cm4gYX0sUFNFVURPOmZ1bmN0aW9uKGIsYyxkLGUsZil7aWYoYlsxXT09PSJub3QiKWlmKChhLmV4ZWMoYlszXSl8fCIiKS5sZW5ndGg+MXx8L15cdy8udGVzdChiWzNdKSliWzNdPWsoYlszXSxudWxsLG51bGwsYyk7ZWxzZXt2YXIgZz1rLmZpbHRlcihiWzNdLGMsZCwhMF5mKTtkfHxlLnB1c2guYXBwbHkoZSxnKTtyZXR1cm4hMX1lbHNlIGlmKGwubWF0Y2guUE9TLnRlc3QoYlswXSl8fGwubWF0Y2guQ0hJTEQudGVzdChiWzBdKSlyZXR1cm4hMDtyZXR1cm4gYn0sUE9TOmZ1bmN0aW9uKGEpe2EudW5zaGlmdCghMCk7cmV0dXJuIGF9fSxmaWx0ZXJzOntlbmFibGVkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmRpc2FibGVkPT09ITEmJmEudHlwZSE9PSJoaWRkZW4ifSxkaXNhYmxlZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5kaXNhYmxlZD09PSEwfSxjaGVja2VkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmNoZWNrZWQ9PT0hMH0sc2VsZWN0ZWQ6ZnVuY3Rpb24oYSl7YS5wYXJlbnROb2RlJiZhLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDtyZXR1cm4gYS5zZWxlY3RlZD09PSEwfSxwYXJlbnQ6ZnVuY3Rpb24oYSl7cmV0dXJuISFhLmZpcnN0Q2hpbGR9LGVtcHR5OmZ1bmN0aW9uKGEpe3JldHVybiFhLmZpcnN0Q2hpbGR9LGhhczpmdW5jdGlvbihhLGIsYyl7cmV0dXJuISFrKGNbM10sYSkubGVuZ3RofSxoZWFkZXI6ZnVuY3Rpb24oYSl7cmV0dXJuL2hcZC9pLnRlc3QoYS5ub2RlTmFtZSl9LHRleHQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5nZXRBdHRyaWJ1dGUoInR5cGUiKSxjPWEudHlwZTtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmInRleHQiPT09YyYmKGI9PT1jfHxiPT09bnVsbCl9LHJhZGlvOmZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT0iaW5wdXQiJiYicmFkaW8iPT09YS50eXBlfSxjaGVja2JveDpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmImNoZWNrYm94Ij09PWEudHlwZX0sZmlsZTpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmImZpbGUiPT09YS50eXBlfSxwYXNzd29yZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmInBhc3N3b3JkIj09PWEudHlwZX0sc3VibWl0OmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4oYj09PSJpbnB1dCJ8fGI9PT0iYnV0dG9uIikmJiJzdWJtaXQiPT09YS50eXBlfSxpbWFnZTpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmImltYWdlIj09PWEudHlwZX0scmVzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybihiPT09ImlucHV0Inx8Yj09PSJidXR0b24iKSYmInJlc2V0Ij09PWEudHlwZX0sYnV0dG9uOmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4gYj09PSJpbnB1dCImJiJidXR0b24iPT09YS50eXBlfHxiPT09ImJ1dHRvbiJ9LGlucHV0OmZ1bmN0aW9uKGEpe3JldHVybi9pbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uL2kudGVzdChhLm5vZGVOYW1lKX0sZm9jdXM6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1hLm93bmVyRG9jdW1lbnQuYWN0aXZlRWxlbWVudH19LHNldEZpbHRlcnM6e2ZpcnN0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGI9PT0wfSxsYXN0OmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiBiPT09ZC5sZW5ndGgtMX0sZXZlbjpmdW5jdGlvbihhLGIpe3JldHVybiBiJTI9PT0wfSxvZGQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYiUyPT09MX0sbHQ6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBiPGNbM10tMH0sZ3Q6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBiPmNbM10tMH0sbnRoOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gY1szXS0wPT09Yn0sZXE6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBjWzNdLTA9PT1ifX0sZmlsdGVyOntQU0VVRE86ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9YlsxXSxmPWwuZmlsdGVyc1tlXTtpZihmKXJldHVybiBmKGEsYyxiLGQpO2lmKGU9PT0iY29udGFpbnMiKXJldHVybihhLnRleHRDb250ZW50fHxhLmlubmVyVGV4dHx8ay5nZXRUZXh0KFthXSl8fCIiKS5pbmRleE9mKGJbM10pPj0wO2lmKGU9PT0ibm90Iil7dmFyIGc9YlszXTtmb3IodmFyIGg9MCxpPWcubGVuZ3RoO2g8aTtoKyspaWYoZ1toXT09PWEpcmV0dXJuITE7cmV0dXJuITB9ay5lcnJvcihlKX0sQ0hJTEQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz1iWzFdLGQ9YTtzd2l0Y2goYyl7Y2FzZSJvbmx5IjpjYXNlImZpcnN0Ijp3aGlsZShkPWQucHJldmlvdXNTaWJsaW5nKWlmKGQubm9kZVR5cGU9PT0xKXJldHVybiExO2lmKGM9PT0iZmlyc3QiKXJldHVybiEwO2Q9YTtjYXNlImxhc3QiOndoaWxlKGQ9ZC5uZXh0U2libGluZylpZihkLm5vZGVUeXBlPT09MSlyZXR1cm4hMTtyZXR1cm4hMDtjYXNlIm50aCI6dmFyIGU9YlsyXSxmPWJbM107aWYoZT09PTEmJmY9PT0wKXJldHVybiEwO3ZhciBnPWJbMF0saD1hLnBhcmVudE5vZGU7aWYoaCYmKGguc2l6Y2FjaGUhPT1nfHwhYS5ub2RlSW5kZXgpKXt2YXIgaT0wO2ZvcihkPWguZmlyc3RDaGlsZDtkO2Q9ZC5uZXh0U2libGluZylkLm5vZGVUeXBlPT09MSYmKGQubm9kZUluZGV4PSsraSk7aC5zaXpjYWNoZT1nfXZhciBqPWEubm9kZUluZGV4LWY7cmV0dXJuIGU9PT0wP2o9PT0wOmolZT09PTAmJmovZT49MH19LElEOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEubm9kZVR5cGU9PT0xJiZhLmdldEF0dHJpYnV0ZSgiaWQiKT09PWJ9LFRBRzpmdW5jdGlvbihhLGIpe3JldHVybiBiPT09IioiJiZhLm5vZGVUeXBlPT09MXx8YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09Yn0sQ0xBU1M6ZnVuY3Rpb24oYSxiKXtyZXR1cm4oIiAiKyhhLmNsYXNzTmFtZXx8YS5nZXRBdHRyaWJ1dGUoImNsYXNzIikpKyIgIikuaW5kZXhPZihiKT4tMX0sQVRUUjpmdW5jdGlvbihhLGIpe3ZhciBjPWJbMV0sZD1sLmF0dHJIYW5kbGVbY10/bC5hdHRySGFuZGxlW2NdKGEpOmFbY10hPW51bGw/YVtjXTphLmdldEF0dHJpYnV0ZShjKSxlPWQrIiIsZj1iWzJdLGc9Yls0XTtyZXR1cm4gZD09bnVsbD9mPT09IiE9IjpmPT09Ij0iP2U9PT1nOmY9PT0iKj0iP2UuaW5kZXhPZihnKT49MDpmPT09In49Ij8oIiAiK2UrIiAiKS5pbmRleE9mKGcpPj0wOmc/Zj09PSIhPSI/ZSE9PWc6Zj09PSJePSI/ZS5pbmRleE9mKGcpPT09MDpmPT09IiQ9Ij9lLnN1YnN0cihlLmxlbmd0aC1nLmxlbmd0aCk9PT1nOmY9PT0ifD0iP2U9PT1nfHxlLnN1YnN0cigwLGcubGVuZ3RoKzEpPT09ZysiLSI6ITE6ZSYmZCE9PSExfSxQT1M6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9YlsyXSxmPWwuc2V0RmlsdGVyc1tlXTtpZihmKXJldHVybiBmKGEsYyxiLGQpfX19LG09bC5tYXRjaC5QT1Msbj1mdW5jdGlvbihhLGIpe3JldHVybiJcXCIrKGItMCsxKX07Zm9yKHZhciBvIGluIGwubWF0Y2gpbC5tYXRjaFtvXT1uZXcgUmVnRXhwKGwubWF0Y2hbb10uc291cmNlKy8oPyFbXlxbXSpcXSkoPyFbXlwoXSpcKSkvLnNvdXJjZSksbC5sZWZ0TWF0Y2hbb109bmV3IFJlZ0V4cCgvKF4oPzoufFxyfFxuKSo/KS8uc291cmNlK2wubWF0Y2hbb10uc291cmNlLnJlcGxhY2UoL1xcKFxkKykvZyxuKSk7dmFyIHA9ZnVuY3Rpb24oYSxiKXthPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGEsMCk7aWYoYil7Yi5wdXNoLmFwcGx5KGIsYSk7cmV0dXJuIGJ9cmV0dXJuIGF9O3RyeXtBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChjLmRvY3VtZW50RWxlbWVudC5jaGlsZE5vZGVzLDApWzBdLm5vZGVUeXBlfWNhdGNoKHEpe3A9ZnVuY3Rpb24oYSxiKXt2YXIgYz0wLGQ9Ynx8W107aWYoZS5jYWxsKGEpPT09IltvYmplY3QgQXJyYXldIilBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShkLGEpO2Vsc2UgaWYodHlwZW9mIGEubGVuZ3RoPT0ibnVtYmVyIilmb3IodmFyIGY9YS5sZW5ndGg7YzxmO2MrKylkLnB1c2goYVtjXSk7ZWxzZSBmb3IoO2FbY107YysrKWQucHVzaChhW2NdKTtyZXR1cm4gZH19dmFyIHIscztjLmRvY3VtZW50RWxlbWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj9yPWZ1bmN0aW9uKGEsYil7aWYoYT09PWIpe2c9ITA7cmV0dXJuIDB9aWYoIWEuY29tcGFyZURvY3VtZW50UG9zaXRpb258fCFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKXJldHVybiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uPy0xOjE7cmV0dXJuIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmND8tMToxfToocj1mdW5jdGlvbihhLGIpe2lmKGE9PT1iKXtnPSEwO3JldHVybiAwfWlmKGEuc291cmNlSW5kZXgmJmIuc291cmNlSW5kZXgpcmV0dXJuIGEuc291cmNlSW5kZXgtYi5zb3VyY2VJbmRleDt2YXIgYyxkLGU9W10sZj1bXSxoPWEucGFyZW50Tm9kZSxpPWIucGFyZW50Tm9kZSxqPWg7aWYoaD09PWkpcmV0dXJuIHMoYSxiKTtpZighaClyZXR1cm4tMTtpZighaSlyZXR1cm4gMTt3aGlsZShqKWUudW5zaGlmdChqKSxqPWoucGFyZW50Tm9kZTtqPWk7d2hpbGUoailmLnVuc2hpZnQoaiksaj1qLnBhcmVudE5vZGU7Yz1lLmxlbmd0aCxkPWYubGVuZ3RoO2Zvcih2YXIgaz0wO2s8YyYmazxkO2srKylpZihlW2tdIT09ZltrXSlyZXR1cm4gcyhlW2tdLGZba10pO3JldHVybiBrPT09Yz9zKGEsZltrXSwtMSk6cyhlW2tdLGIsMSl9LHM9ZnVuY3Rpb24oYSxiLGMpe2lmKGE9PT1iKXJldHVybiBjO3ZhciBkPWEubmV4dFNpYmxpbmc7d2hpbGUoZCl7aWYoZD09PWIpcmV0dXJuLTE7ZD1kLm5leHRTaWJsaW5nfXJldHVybiAxfSksay5nZXRUZXh0PWZ1bmN0aW9uKGEpe3ZhciBiPSIiLGM7Zm9yKHZhciBkPTA7YVtkXTtkKyspYz1hW2RdLGMubm9kZVR5cGU9PT0zfHxjLm5vZGVUeXBlPT09ND9iKz1jLm5vZGVWYWx1ZTpjLm5vZGVUeXBlIT09OCYmKGIrPWsuZ2V0VGV4dChjLmNoaWxkTm9kZXMpKTtyZXR1cm4gYn0sZnVuY3Rpb24oKXt2YXIgYT1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpLGQ9InNjcmlwdCIrKG5ldyBEYXRlKS5nZXRUaW1lKCksZT1jLmRvY3VtZW50RWxlbWVudDthLmlubmVySFRNTD0iPGEgbmFtZT0nIitkKyInLz4iLGUuaW5zZXJ0QmVmb3JlKGEsZS5maXJzdENoaWxkKSxjLmdldEVsZW1lbnRCeUlkKGQpJiYobC5maW5kLklEPWZ1bmN0aW9uKGEsYyxkKXtpZih0eXBlb2YgYy5nZXRFbGVtZW50QnlJZCE9InVuZGVmaW5lZCImJiFkKXt2YXIgZT1jLmdldEVsZW1lbnRCeUlkKGFbMV0pO3JldHVybiBlP2UuaWQ9PT1hWzFdfHx0eXBlb2YgZS5nZXRBdHRyaWJ1dGVOb2RlIT0idW5kZWZpbmVkIiYmZS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpLm5vZGVWYWx1ZT09PWFbMV0/W2VdOmI6W119fSxsLmZpbHRlci5JRD1mdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBhLmdldEF0dHJpYnV0ZU5vZGUhPSJ1bmRlZmluZWQiJiZhLmdldEF0dHJpYnV0ZU5vZGUoImlkIik7cmV0dXJuIGEubm9kZVR5cGU9PT0xJiZjJiZjLm5vZGVWYWx1ZT09PWJ9KSxlLnJlbW92ZUNoaWxkKGEpLGU9YT1udWxsfSgpLGZ1bmN0aW9uKCl7dmFyIGE9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKTthLmFwcGVuZENoaWxkKGMuY3JlYXRlQ29tbWVudCgiIikpLGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKS5sZW5ndGg+MCYmKGwuZmluZC5UQUc9ZnVuY3Rpb24oYSxiKXt2YXIgYz1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKGFbMV0pO2lmKGFbMV09PT0iKiIpe3ZhciBkPVtdO2Zvcih2YXIgZT0wO2NbZV07ZSsrKWNbZV0ubm9kZVR5cGU9PT0xJiZkLnB1c2goY1tlXSk7Yz1kfXJldHVybiBjfSksYS5pbm5lckhUTUw9IjxhIGhyZWY9JyMnPjwvYT4iLGEuZmlyc3RDaGlsZCYmdHlwZW9mIGEuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUhPSJ1bmRlZmluZWQiJiZhLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJocmVmIikhPT0iIyImJihsLmF0dHJIYW5kbGUuaHJlZj1mdW5jdGlvbihhKXtyZXR1cm4gYS5nZXRBdHRyaWJ1dGUoImhyZWYiLDIpfSksYT1udWxsfSgpLGMucXVlcnlTZWxlY3RvckFsbCYmZnVuY3Rpb24oKXt2YXIgYT1rLGI9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKSxkPSJfX3NpenpsZV9fIjtiLmlubmVySFRNTD0iPHAgY2xhc3M9J1RFU1QnPjwvcD4iO2lmKCFiLnF1ZXJ5U2VsZWN0b3JBbGx8fGIucXVlcnlTZWxlY3RvckFsbCgiLlRFU1QiKS5sZW5ndGghPT0wKXtrPWZ1bmN0aW9uKGIsZSxmLGcpe2U9ZXx8YztpZighZyYmIWsuaXNYTUwoZSkpe3ZhciBoPS9eKFx3KyQpfF5cLihbXHdcLV0rJCl8XiMoW1x3XC1dKyQpLy5leGVjKGIpO2lmKGgmJihlLm5vZGVUeXBlPT09MXx8ZS5ub2RlVHlwZT09PTkpKXtpZihoWzFdKXJldHVybiBwKGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYiksZik7aWYoaFsyXSYmbC5maW5kLkNMQVNTJiZlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpcmV0dXJuIHAoZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGhbMl0pLGYpfWlmKGUubm9kZVR5cGU9PT05KXtpZihiPT09ImJvZHkiJiZlLmJvZHkpcmV0dXJuIHAoW2UuYm9keV0sZik7aWYoaCYmaFszXSl7dmFyIGk9ZS5nZXRFbGVtZW50QnlJZChoWzNdKTtpZighaXx8IWkucGFyZW50Tm9kZSlyZXR1cm4gcChbXSxmKTtpZihpLmlkPT09aFszXSlyZXR1cm4gcChbaV0sZil9dHJ5e3JldHVybiBwKGUucXVlcnlTZWxlY3RvckFsbChiKSxmKX1jYXRjaChqKXt9fWVsc2UgaWYoZS5ub2RlVHlwZT09PTEmJmUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSE9PSJvYmplY3QiKXt2YXIgbT1lLG49ZS5nZXRBdHRyaWJ1dGUoImlkIiksbz1ufHxkLHE9ZS5wYXJlbnROb2RlLHI9L15ccypbK35dLy50ZXN0KGIpO24/bz1vLnJlcGxhY2UoLycvZywiXFwkJiIpOmUuc2V0QXR0cmlidXRlKCJpZCIsbyksciYmcSYmKGU9ZS5wYXJlbnROb2RlKTt0cnl7aWYoIXJ8fHEpcmV0dXJuIHAoZS5xdWVyeVNlbGVjdG9yQWxsKCJbaWQ9JyIrbysiJ10gIitiKSxmKX1jYXRjaChzKXt9ZmluYWxseXtufHxtLnJlbW92ZUF0dHJpYnV0ZSgiaWQiKX19fXJldHVybiBhKGIsZSxmLGcpfTtmb3IodmFyIGUgaW4gYSlrW2VdPWFbZV07Yj1udWxsfX0oKSxmdW5jdGlvbigpe3ZhciBhPWMuZG9jdW1lbnRFbGVtZW50LGI9YS5tYXRjaGVzU2VsZWN0b3J8fGEubW96TWF0Y2hlc1NlbGVjdG9yfHxhLndlYmtpdE1hdGNoZXNTZWxlY3Rvcnx8YS5tc01hdGNoZXNTZWxlY3RvcjtpZihiKXt2YXIgZD0hYi5jYWxsKGMuY3JlYXRlRWxlbWVudCgiZGl2IiksImRpdiIpLGU9ITE7dHJ5e2IuY2FsbChjLmRvY3VtZW50RWxlbWVudCwiW3Rlc3QhPScnXTpzaXp6bGUiKX1jYXRjaChmKXtlPSEwfWsubWF0Y2hlc1NlbGVjdG9yPWZ1bmN0aW9uKGEsYyl7Yz1jLnJlcGxhY2UoL1w9XHMqKFteJyJcXV0qKVxzKlxdL2csIj0nJDEnXSIpO2lmKCFrLmlzWE1MKGEpKXRyeXtpZihlfHwhbC5tYXRjaC5QU0VVRE8udGVzdChjKSYmIS8hPS8udGVzdChjKSl7dmFyIGY9Yi5jYWxsKGEsYyk7aWYoZnx8IWR8fGEuZG9jdW1lbnQmJmEuZG9jdW1lbnQubm9kZVR5cGUhPT0xMSlyZXR1cm4gZn19Y2F0Y2goZyl7fXJldHVybiBrKGMsbnVsbCxudWxsLFthXSkubGVuZ3RoPjB9fX0oKSxmdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudCgiZGl2Iik7YS5pbm5lckhUTUw9IjxkaXYgY2xhc3M9J3Rlc3QgZSc+PC9kaXY+PGRpdiBjbGFzcz0ndGVzdCc+PC9kaXY+IjtpZighIWEuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSYmYS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJlIikubGVuZ3RoIT09MCl7YS5sYXN0Q2hpbGQuY2xhc3NOYW1lPSJlIjtpZihhLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImUiKS5sZW5ndGg9PT0xKXJldHVybjtsLm9yZGVyLnNwbGljZSgxLDAsIkNMQVNTIiksbC5maW5kLkNMQVNTPWZ1bmN0aW9uKGEsYixjKXtpZih0eXBlb2YgYi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lIT0idW5kZWZpbmVkIiYmIWMpcmV0dXJuIGIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShhWzFdKX0sYT1udWxsfX0oKSxjLmRvY3VtZW50RWxlbWVudC5jb250YWlucz9rLmNvbnRhaW5zPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGEhPT1iJiYoYS5jb250YWlucz9hLmNvbnRhaW5zKGIpOiEwKX06Yy5kb2N1bWVudEVsZW1lbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24/ay5jb250YWlucz1mdW5jdGlvbihhLGIpe3JldHVybiEhKGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmMTYpfTprLmNvbnRhaW5zPWZ1bmN0aW9uKCl7cmV0dXJuITF9LGsuaXNYTUw9ZnVuY3Rpb24oYSl7dmFyIGI9KGE/YS5vd25lckRvY3VtZW50fHxhOjApLmRvY3VtZW50RWxlbWVudDtyZXR1cm4gYj9iLm5vZGVOYW1lIT09IkhUTUwiOiExfTt2YXIgdj1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9W10sZT0iIixmPWIubm9kZVR5cGU/W2JdOmI7d2hpbGUoYz1sLm1hdGNoLlBTRVVETy5leGVjKGEpKWUrPWNbMF0sYT1hLnJlcGxhY2UobC5tYXRjaC5QU0VVRE8sIiIpO2E9bC5yZWxhdGl2ZVthXT9hKyIqIjphO2Zvcih2YXIgZz0wLGg9Zi5sZW5ndGg7ZzxoO2crKylrKGEsZltnXSxkKTtyZXR1cm4gay5maWx0ZXIoZSxkKX07Zi5maW5kPWssZi5leHByPWsuc2VsZWN0b3JzLGYuZXhwclsiOiJdPWYuZXhwci5maWx0ZXJzLGYudW5pcXVlPWsudW5pcXVlU29ydCxmLnRleHQ9ay5nZXRUZXh0LGYuaXNYTUxEb2M9ay5pc1hNTCxmLmNvbnRhaW5zPWsuY29udGFpbnN9KCk7dmFyIE89L1VudGlsJC8sUD0vXig/OnBhcmVudHN8cHJldlVudGlsfHByZXZBbGwpLyxRPS8sLyxSPS9eLlteOiNcW1wuLF0qJC8sUz1BcnJheS5wcm90b3R5cGUuc2xpY2UsVD1mLmV4cHIubWF0Y2guUE9TLFU9e2NoaWxkcmVuOiEwLGNvbnRlbnRzOiEwLG5leHQ6ITAscHJldjohMH07Zi5mbi5leHRlbmQoe2ZpbmQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcyxjLGQ7aWYodHlwZW9mIGEhPSJzdHJpbmciKXJldHVybiBmKGEpLmZpbHRlcihmdW5jdGlvbigpe2ZvcihjPTAsZD1iLmxlbmd0aDtjPGQ7YysrKWlmKGYuY29udGFpbnMoYltjXSx0aGlzKSlyZXR1cm4hMH0pO3ZhciBlPXRoaXMucHVzaFN0YWNrKCIiLCJmaW5kIixhKSxnLGgsaTtmb3IoYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKyl7Zz1lLmxlbmd0aCxmLmZpbmQoYSx0aGlzW2NdLGUpO2lmKGM+MClmb3IoaD1nO2g8ZS5sZW5ndGg7aCsrKWZvcihpPTA7aTxnO2krKylpZihlW2ldPT09ZVtoXSl7ZS5zcGxpY2UoaC0tLDEpO2JyZWFrfX1yZXR1cm4gZX0saGFzOmZ1bmN0aW9uKGEpe3ZhciBiPWYoYSk7cmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKCl7Zm9yKHZhciBhPTAsYz1iLmxlbmd0aDthPGM7YSsrKWlmKGYuY29udGFpbnModGhpcyxiW2FdKSlyZXR1cm4hMH0pfSxub3Q6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKFcodGhpcyxhLCExKSwibm90IixhKX0sZmlsdGVyOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnB1c2hTdGFjayhXKHRoaXMsYSwhMCksImZpbHRlciIsYSl9LGlzOmZ1bmN0aW9uKGEpe3JldHVybiEhYSYmKHR5cGVvZiBhPT0ic3RyaW5nIj9mLmZpbHRlcihhLHRoaXMpLmxlbmd0aD4wOnRoaXMuZmlsdGVyKGEpLmxlbmd0aD4wKX0sY2xvc2VzdDpmdW5jdGlvbihhLGIpe3ZhciBjPVtdLGQsZSxnPXRoaXNbMF07aWYoZi5pc0FycmF5KGEpKXt2YXIgaCxpLGo9e30saz0xO2lmKGcmJmEubGVuZ3RoKXtmb3IoZD0wLGU9YS5sZW5ndGg7ZDxlO2QrKylpPWFbZF0saltpXXx8KGpbaV09VC50ZXN0KGkpP2YoaSxifHx0aGlzLmNvbnRleHQpOmkpO3doaWxlKGcmJmcub3duZXJEb2N1bWVudCYmZyE9PWIpe2ZvcihpIGluIGopaD1qW2ldLChoLmpxdWVyeT9oLmluZGV4KGcpPi0xOmYoZykuaXMoaCkpJiZjLnB1c2goe3NlbGVjdG9yOmksZWxlbTpnLGxldmVsOmt9KTtnPWcucGFyZW50Tm9kZSxrKyt9fXJldHVybiBjfXZhciBsPVQudGVzdChhKXx8dHlwZW9mIGEhPSJzdHJpbmciP2YoYSxifHx0aGlzLmNvbnRleHQpOjA7Zm9yKGQ9MCxlPXRoaXMubGVuZ3RoO2Q8ZTtkKyspe2c9dGhpc1tkXTt3aGlsZShnKXtpZihsP2wuaW5kZXgoZyk+LTE6Zi5maW5kLm1hdGNoZXNTZWxlY3RvcihnLGEpKXtjLnB1c2goZyk7YnJlYWt9Zz1nLnBhcmVudE5vZGU7aWYoIWd8fCFnLm93bmVyRG9jdW1lbnR8fGc9PT1ifHxnLm5vZGVUeXBlPT09MTEpYnJlYWt9fWM9Yy5sZW5ndGg+MT9mLnVuaXF1ZShjKTpjO3JldHVybiB0aGlzLnB1c2hTdGFjayhjLCJjbG9zZXN0IixhKX0saW5kZXg6ZnVuY3Rpb24oYSl7aWYoIWF8fHR5cGVvZiBhPT0ic3RyaW5nIilyZXR1cm4gZi5pbkFycmF5KHRoaXNbMF0sYT9mKGEpOnRoaXMucGFyZW50KCkuY2hpbGRyZW4oKSk7cmV0dXJuIGYuaW5BcnJheShhLmpxdWVyeT9hWzBdOmEsdGhpcyl9LGFkZDpmdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBhPT0ic3RyaW5nIj9mKGEsYik6Zi5tYWtlQXJyYXkoYSYmYS5ub2RlVHlwZT9bYV06YSksZD1mLm1lcmdlKHRoaXMuZ2V0KCksYyk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKFYoY1swXSl8fFYoZFswXSk/ZDpmLnVuaXF1ZShkKSl9LGFuZFNlbGY6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hZGQodGhpcy5wcmV2T2JqZWN0KX19KSxmLmVhY2goe3BhcmVudDpmdW5jdGlvbihhKXt2YXIgYj1hLnBhcmVudE5vZGU7cmV0dXJuIGImJmIubm9kZVR5cGUhPT0xMT9iOm51bGx9LHBhcmVudHM6ZnVuY3Rpb24oYSl7cmV0dXJuIGYuZGlyKGEsInBhcmVudE5vZGUiKX0scGFyZW50c1VudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZi5kaXIoYSwicGFyZW50Tm9kZSIsYyl9LG5leHQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGYubnRoKGEsMiwibmV4dFNpYmxpbmciKX0scHJldjpmdW5jdGlvbihhKXtyZXR1cm4gZi5udGgoYSwyLCJwcmV2aW91c1NpYmxpbmciKX0sbmV4dEFsbDpmdW5jdGlvbihhKXtyZXR1cm4gZi5kaXIoYSwibmV4dFNpYmxpbmciKX0scHJldkFsbDpmdW5jdGlvbihhKXtyZXR1cm4gZi5kaXIoYSwicHJldmlvdXNTaWJsaW5nIil9LG5leHRVbnRpbDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZGlyKGEsIm5leHRTaWJsaW5nIixjKX0scHJldlVudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZi5kaXIoYSwicHJldmlvdXNTaWJsaW5nIixjKX0sc2libGluZ3M6ZnVuY3Rpb24oYSl7cmV0dXJuIGYuc2libGluZyhhLnBhcmVudE5vZGUuZmlyc3RDaGlsZCxhKX0sY2hpbGRyZW46ZnVuY3Rpb24oYSl7cmV0dXJuIGYuc2libGluZyhhLmZpcnN0Q2hpbGQpfSxjb250ZW50czpmdW5jdGlvbihhKXtyZXR1cm4gZi5ub2RlTmFtZShhLCJpZnJhbWUiKT9hLmNvbnRlbnREb2N1bWVudHx8YS5jb250ZW50V2luZG93LmRvY3VtZW50OmYubWFrZUFycmF5KGEuY2hpbGROb2Rlcyl9fSxmdW5jdGlvbihhLGIpe2YuZm5bYV09ZnVuY3Rpb24oYyxkKXt2YXIgZT1mLm1hcCh0aGlzLGIsYyksZz1TLmNhbGwoYXJndW1lbnRzKTtPLnRlc3QoYSl8fChkPWMpLGQmJnR5cGVvZiBkPT0ic3RyaW5nIiYmKGU9Zi5maWx0ZXIoZCxlKSksZT10aGlzLmxlbmd0aD4xJiYhVVthXT9mLnVuaXF1ZShlKTplLCh0aGlzLmxlbmd0aD4xfHxRLnRlc3QoZCkpJiZQLnRlc3QoYSkmJihlPWUucmV2ZXJzZSgpKTtyZXR1cm4gdGhpcy5wdXNoU3RhY2soZSxhLGcuam9pbigiLCIpKX19KSxmLmV4dGVuZCh7ZmlsdGVyOmZ1bmN0aW9uKGEsYixjKXtjJiYoYT0iOm5vdCgiK2ErIikiKTtyZXR1cm4gYi5sZW5ndGg9PT0xP2YuZmluZC5tYXRjaGVzU2VsZWN0b3IoYlswXSxhKT9bYlswXV06W106Zi5maW5kLm1hdGNoZXMoYSxiKX0sZGlyOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZT1bXSxnPWFbY107d2hpbGUoZyYmZy5ub2RlVHlwZSE9PTkmJihkPT09Ynx8Zy5ub2RlVHlwZSE9PTF8fCFmKGcpLmlzKGQpKSlnLm5vZGVUeXBlPT09MSYmZS5wdXNoKGcpLGc9Z1tjXTtyZXR1cm4gZX0sbnRoOmZ1bmN0aW9uKGEsYixjLGQpe2I9Ynx8MTt2YXIgZT0wO2Zvcig7YTthPWFbY10paWYoYS5ub2RlVHlwZT09PTEmJisrZT09PWIpYnJlYWs7cmV0dXJuIGF9LHNpYmxpbmc6ZnVuY3Rpb24oYSxiKXt2YXIgYz1bXTtmb3IoO2E7YT1hLm5leHRTaWJsaW5nKWEubm9kZVR5cGU9PT0xJiZhIT09YiYmYy5wdXNoKGEpO3JldHVybiBjfX0pO3ZhciBYPS8galF1ZXJ5XGQrPSIoPzpcZCt8bnVsbCkiL2csWT0vXlxzKy8sWj0vPCg/IWFyZWF8YnJ8Y29sfGVtYmVkfGhyfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW0pKChbXHc6XSspW14+XSopXC8+L2lnLCQ9LzwoW1x3Ol0rKS8sXz0vPHRib2R5L2ksYmE9Lzx8JiM/XHcrOy8sYmI9LzwoPzpzY3JpcHR8b2JqZWN0fGVtYmVkfG9wdGlvbnxzdHlsZSkvaSxiYz0vY2hlY2tlZFxzKig/OltePV18PVxzKi5jaGVja2VkLikvaSxiZD0vXC8oamF2YXxlY21hKXNjcmlwdC9pLGJlPS9eXHMqPCEoPzpcW0NEQVRBXFt8XC1cLSkvLGJmPXtvcHRpb246WzEsIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCI8L3NlbGVjdD4iXSxsZWdlbmQ6WzEsIjxmaWVsZHNldD4iLCI8L2ZpZWxkc2V0PiJdLHRoZWFkOlsxLCI8dGFibGU+IiwiPC90YWJsZT4iXSx0cjpbMiwiPHRhYmxlPjx0Ym9keT4iLCI8L3Rib2R5PjwvdGFibGU+Il0sdGQ6WzMsIjx0YWJsZT48dGJvZHk+PHRyPiIsIjwvdHI+PC90Ym9keT48L3RhYmxlPiJdLGNvbDpbMiwiPHRhYmxlPjx0Ym9keT48L3Rib2R5Pjxjb2xncm91cD4iLCI8L2NvbGdyb3VwPjwvdGFibGU+Il0sYXJlYTpbMSwiPG1hcD4iLCI8L21hcD4iXSxfZGVmYXVsdDpbMCwiIiwiIl19O2JmLm9wdGdyb3VwPWJmLm9wdGlvbixiZi50Ym9keT1iZi50Zm9vdD1iZi5jb2xncm91cD1iZi5jYXB0aW9uPWJmLnRoZWFkLGJmLnRoPWJmLnRkLGYuc3VwcG9ydC5odG1sU2VyaWFsaXplfHwoYmYuX2RlZmF1bHQ9WzEsImRpdjxkaXY+IiwiPC9kaXY+Il0pLGYuZm4uZXh0ZW5kKHt0ZXh0OmZ1bmN0aW9uKGEpe2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWYodGhpcyk7Yy50ZXh0KGEuY2FsbCh0aGlzLGIsYy50ZXh0KCkpKX0pO2lmKHR5cGVvZiBhIT0ib2JqZWN0IiYmYSE9PWIpcmV0dXJuIHRoaXMuZW1wdHkoKS5hcHBlbmQoKHRoaXNbMF0mJnRoaXNbMF0ub3duZXJEb2N1bWVudHx8YykuY3JlYXRlVGV4dE5vZGUoYSkpO3JldHVybiBmLnRleHQodGhpcyl9LHdyYXBBbGw6ZnVuY3Rpb24oYSl7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zih0aGlzKS53cmFwQWxsKGEuY2FsbCh0aGlzLGIpKX0pO2lmKHRoaXNbMF0pe3ZhciBiPWYoYSx0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKCEwKTt0aGlzWzBdLnBhcmVudE5vZGUmJmIuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pLGIubWFwKGZ1bmN0aW9uKCl7dmFyIGE9dGhpczt3aGlsZShhLmZpcnN0Q2hpbGQmJmEuZmlyc3RDaGlsZC5ub2RlVHlwZT09PTEpYT1hLmZpcnN0Q2hpbGQ7cmV0dXJuIGF9KS5hcHBlbmQodGhpcyl9cmV0dXJuIHRoaXN9LHdyYXBJbm5lcjpmdW5jdGlvbihhKXtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmKHRoaXMpLndyYXBJbm5lcihhLmNhbGwodGhpcyxiKSl9KTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9Zih0aGlzKSxjPWIuY29udGVudHMoKTtjLmxlbmd0aD9jLndyYXBBbGwoYSk6Yi5hcHBlbmQoYSl9KX0sd3JhcDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zih0aGlzKS53cmFwQWxsKGEpfSl9LHVud3JhcDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnBhcmVudCgpLmVhY2goZnVuY3Rpb24oKXtmLm5vZGVOYW1lKHRoaXMsImJvZHkiKXx8Zih0aGlzKS5yZXBsYWNlV2l0aCh0aGlzLmNoaWxkTm9kZXMpfSkuZW5kKCl9LGFwcGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMCxmdW5jdGlvbihhKXt0aGlzLm5vZGVUeXBlPT09MSYmdGhpcy5hcHBlbmRDaGlsZChhKX0pfSxwcmVwZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCEwLGZ1bmN0aW9uKGEpe3RoaXMubm9kZVR5cGU9PT0xJiZ0aGlzLmluc2VydEJlZm9yZShhLHRoaXMuZmlyc3RDaGlsZCl9KX0sYmVmb3JlOmZ1bmN0aW9uKCl7aWYodGhpc1swXSYmdGhpc1swXS5wYXJlbnROb2RlKXJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMSxmdW5jdGlvbihhKXt0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsdGhpcyl9KTtpZihhcmd1bWVudHMubGVuZ3RoKXt2YXIgYT1mKGFyZ3VtZW50c1swXSk7YS5wdXNoLmFwcGx5KGEsdGhpcy50b0FycmF5KCkpO3JldHVybiB0aGlzLnB1c2hTdGFjayhhLCJiZWZvcmUiLGFyZ3VtZW50cyl9fSxhZnRlcjpmdW5jdGlvbigpe2lmKHRoaXNbMF0mJnRoaXNbMF0ucGFyZW50Tm9kZSlyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITEsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLHRoaXMubmV4dFNpYmxpbmcpfSk7aWYoYXJndW1lbnRzLmxlbmd0aCl7dmFyIGE9dGhpcy5wdXNoU3RhY2sodGhpcywiYWZ0ZXIiLGFyZ3VtZW50cyk7YS5wdXNoLmFwcGx5KGEsZihhcmd1bWVudHNbMF0pLnRvQXJyYXkoKSk7cmV0dXJuIGF9fSxyZW1vdmU6ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9MCxkOyhkPXRoaXNbY10pIT1udWxsO2MrKylpZighYXx8Zi5maWx0ZXIoYSxbZF0pLmxlbmd0aCkhYiYmZC5ub2RlVHlwZT09PTEmJihmLmNsZWFuRGF0YShkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikpLGYuY2xlYW5EYXRhKFtkXSkpLGQucGFyZW50Tm9kZSYmZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGQpO3JldHVybiB0aGlzfSxlbXB0eTpmdW5jdGlvbigpe2Zvcih2YXIgYT0wLGI7KGI9dGhpc1thXSkhPW51bGw7YSsrKXtiLm5vZGVUeXBlPT09MSYmZi5jbGVhbkRhdGEoYi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpKTt3aGlsZShiLmZpcnN0Q2hpbGQpYi5yZW1vdmVDaGlsZChiLmZpcnN0Q2hpbGQpfXJldHVybiB0aGlzfSxjbG9uZTpmdW5jdGlvbihhLGIpe2E9YT09bnVsbD8hMTphLGI9Yj09bnVsbD9hOmI7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIGYuY2xvbmUodGhpcyxhLGIpfSl9LGh0bWw6ZnVuY3Rpb24oYSl7aWYoYT09PWIpcmV0dXJuIHRoaXNbMF0mJnRoaXNbMF0ubm9kZVR5cGU9PT0xP3RoaXNbMF0uaW5uZXJIVE1MLnJlcGxhY2UoWCwiIik6bnVsbDtpZih0eXBlb2YgYT09InN0cmluZyImJiFiYi50ZXN0KGEpJiYoZi5zdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlfHwhWS50ZXN0KGEpKSYmIWJmWygkLmV4ZWMoYSl8fFsiIiwiIl0pWzFdLnRvTG93ZXJDYXNlKCldKXthPWEucmVwbGFjZShaLCI8JDE+PC8kMj4iKTt0cnl7Zm9yKHZhciBjPTAsZD10aGlzLmxlbmd0aDtjPGQ7YysrKXRoaXNbY10ubm9kZVR5cGU9PT0xJiYoZi5jbGVhbkRhdGEodGhpc1tjXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpKSx0aGlzW2NdLmlubmVySFRNTD1hKX1jYXRjaChlKXt0aGlzLmVtcHR5KCkuYXBwZW5kKGEpfX1lbHNlIGYuaXNGdW5jdGlvbihhKT90aGlzLmVhY2goZnVuY3Rpb24oYil7dmFyIGM9Zih0aGlzKTtjLmh0bWwoYS5jYWxsKHRoaXMsYixjLmh0bWwoKSkpfSk6dGhpcy5lbXB0eSgpLmFwcGVuZChhKTtyZXR1cm4gdGhpc30scmVwbGFjZVdpdGg6ZnVuY3Rpb24oYSl7aWYodGhpc1swXSYmdGhpc1swXS5wYXJlbnROb2RlKXtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXt2YXIgYz1mKHRoaXMpLGQ9Yy5odG1sKCk7Yy5yZXBsYWNlV2l0aChhLmNhbGwodGhpcyxiLGQpKX0pO3R5cGVvZiBhIT0ic3RyaW5nIiYmKGE9ZihhKS5kZXRhY2goKSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPXRoaXMubmV4dFNpYmxpbmcsYz10aGlzLnBhcmVudE5vZGU7Zih0aGlzKS5yZW1vdmUoKSxiP2YoYikuYmVmb3JlKGEpOmYoYykuYXBwZW5kKGEpfSl9cmV0dXJuIHRoaXMubGVuZ3RoP3RoaXMucHVzaFN0YWNrKGYoZi5pc0Z1bmN0aW9uKGEpP2EoKTphKSwicmVwbGFjZVdpdGgiLGEpOnRoaXN9LGRldGFjaDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5yZW1vdmUoYSwhMCl9LGRvbU1hbmlwOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZSxnLGgsaSxqPWFbMF0saz1bXTtpZighZi5zdXBwb3J0LmNoZWNrQ2xvbmUmJmFyZ3VtZW50cy5sZW5ndGg9PT0zJiZ0eXBlb2Ygaj09InN0cmluZyImJmJjLnRlc3QoaikpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YodGhpcykuZG9tTWFuaXAoYSxjLGQsITApfSk7aWYoZi5pc0Z1bmN0aW9uKGopKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZSl7dmFyIGc9Zih0aGlzKTthWzBdPWouY2FsbCh0aGlzLGUsYz9nLmh0bWwoKTpiKSxnLmRvbU1hbmlwKGEsYyxkKX0pO2lmKHRoaXNbMF0pe2k9aiYmai5wYXJlbnROb2RlLGYuc3VwcG9ydC5wYXJlbnROb2RlJiZpJiZpLm5vZGVUeXBlPT09MTEmJmkuY2hpbGROb2Rlcy5sZW5ndGg9PT10aGlzLmxlbmd0aD9lPXtmcmFnbWVudDppfTplPWYuYnVpbGRGcmFnbWVudChhLHRoaXMsayksaD1lLmZyYWdtZW50LGguY2hpbGROb2Rlcy5sZW5ndGg9PT0xP2c9aD1oLmZpcnN0Q2hpbGQ6Zz1oLmZpcnN0Q2hpbGQ7aWYoZyl7Yz1jJiZmLm5vZGVOYW1lKGcsInRyIik7Zm9yKHZhciBsPTAsbT10aGlzLmxlbmd0aCxuPW0tMTtsPG07bCsrKWQuY2FsbChjP2JnKHRoaXNbbF0sZyk6dGhpc1tsXSxlLmNhY2hlYWJsZXx8bT4xJiZsPG4/Zi5jbG9uZShoLCEwLCEwKTpoKX1rLmxlbmd0aCYmZi5lYWNoKGssYm0pfXJldHVybiB0aGlzfX0pLGYuYnVpbGRGcmFnbWVudD1mdW5jdGlvbihhLGIsZCl7dmFyIGUsZyxoLGk7YiYmYlswXSYmKGk9YlswXS5vd25lckRvY3VtZW50fHxiWzBdKSxpLmNyZWF0ZURvY3VtZW50RnJhZ21lbnR8fChpPWMpLGEubGVuZ3RoPT09MSYmdHlwZW9mIGFbMF09PSJzdHJpbmciJiZhWzBdLmxlbmd0aDw1MTImJmk9PT1jJiZhWzBdLmNoYXJBdCgwKT09PSI8IiYmIWJiLnRlc3QoYVswXSkmJihmLnN1cHBvcnQuY2hlY2tDbG9uZXx8IWJjLnRlc3QoYVswXSkpJiYoZz0hMCxoPWYuZnJhZ21lbnRzW2FbMF1dLGgmJmghPT0xJiYoZT1oKSksZXx8KGU9aS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksZi5jbGVhbihhLGksZSxkKSksZyYmKGYuZnJhZ21lbnRzW2FbMF1dPWg/ZToxKTtyZXR1cm57ZnJhZ21lbnQ6ZSxjYWNoZWFibGU6Z319LGYuZnJhZ21lbnRzPXt9LGYuZWFjaCh7YXBwZW5kVG86ImFwcGVuZCIscHJlcGVuZFRvOiJwcmVwZW5kIixpbnNlcnRCZWZvcmU6ImJlZm9yZSIsaW5zZXJ0QWZ0ZXI6ImFmdGVyIixyZXBsYWNlQWxsOiJyZXBsYWNlV2l0aCJ9LGZ1bmN0aW9uKGEsYil7Zi5mblthXT1mdW5jdGlvbihjKXt2YXIgZD1bXSxlPWYoYyksZz10aGlzLmxlbmd0aD09PTEmJnRoaXNbMF0ucGFyZW50Tm9kZTtpZihnJiZnLm5vZGVUeXBlPT09MTEmJmcuY2hpbGROb2Rlcy5sZW5ndGg9PT0xJiZlLmxlbmd0aD09PTEpe2VbYl0odGhpc1swXSk7cmV0dXJuIHRoaXN9Zm9yKHZhciBoPTAsaT1lLmxlbmd0aDtoPGk7aCsrKXt2YXIgaj0oaD4wP3RoaXMuY2xvbmUoITApOnRoaXMpLmdldCgpO2YoZVtoXSlbYl0oaiksZD1kLmNvbmNhdChqCil9cmV0dXJuIHRoaXMucHVzaFN0YWNrKGQsYSxlLnNlbGVjdG9yKX19KSxmLmV4dGVuZCh7Y2xvbmU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWEuY2xvbmVOb2RlKCEwKSxlLGcsaDtpZigoIWYuc3VwcG9ydC5ub0Nsb25lRXZlbnR8fCFmLnN1cHBvcnQubm9DbG9uZUNoZWNrZWQpJiYoYS5ub2RlVHlwZT09PTF8fGEubm9kZVR5cGU9PT0xMSkmJiFmLmlzWE1MRG9jKGEpKXtiaShhLGQpLGU9YmooYSksZz1iaihkKTtmb3IoaD0wO2VbaF07KytoKWJpKGVbaF0sZ1toXSl9aWYoYil7YmgoYSxkKTtpZihjKXtlPWJqKGEpLGc9YmooZCk7Zm9yKGg9MDtlW2hdOysraCliaChlW2hdLGdbaF0pfX1lPWc9bnVsbDtyZXR1cm4gZH0sY2xlYW46ZnVuY3Rpb24oYSxiLGQsZSl7dmFyIGc7Yj1ifHxjLHR5cGVvZiBiLmNyZWF0ZUVsZW1lbnQ9PSJ1bmRlZmluZWQiJiYoYj1iLm93bmVyRG9jdW1lbnR8fGJbMF0mJmJbMF0ub3duZXJEb2N1bWVudHx8Yyk7dmFyIGg9W10saTtmb3IodmFyIGo9MCxrOyhrPWFbal0pIT1udWxsO2orKyl7dHlwZW9mIGs9PSJudW1iZXIiJiYoays9IiIpO2lmKCFrKWNvbnRpbnVlO2lmKHR5cGVvZiBrPT0ic3RyaW5nIilpZighYmEudGVzdChrKSlrPWIuY3JlYXRlVGV4dE5vZGUoayk7ZWxzZXtrPWsucmVwbGFjZShaLCI8JDE+PC8kMj4iKTt2YXIgbD0oJC5leGVjKGspfHxbIiIsIiJdKVsxXS50b0xvd2VyQ2FzZSgpLG09YmZbbF18fGJmLl9kZWZhdWx0LG49bVswXSxvPWIuY3JlYXRlRWxlbWVudCgiZGl2Iik7by5pbm5lckhUTUw9bVsxXStrK21bMl07d2hpbGUobi0tKW89by5sYXN0Q2hpbGQ7aWYoIWYuc3VwcG9ydC50Ym9keSl7dmFyIHA9Xy50ZXN0KGspLHE9bD09PSJ0YWJsZSImJiFwP28uZmlyc3RDaGlsZCYmby5maXJzdENoaWxkLmNoaWxkTm9kZXM6bVsxXT09PSI8dGFibGU+IiYmIXA/by5jaGlsZE5vZGVzOltdO2ZvcihpPXEubGVuZ3RoLTE7aT49MDstLWkpZi5ub2RlTmFtZShxW2ldLCJ0Ym9keSIpJiYhcVtpXS5jaGlsZE5vZGVzLmxlbmd0aCYmcVtpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHFbaV0pfSFmLnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UmJlkudGVzdChrKSYmby5pbnNlcnRCZWZvcmUoYi5jcmVhdGVUZXh0Tm9kZShZLmV4ZWMoaylbMF0pLG8uZmlyc3RDaGlsZCksaz1vLmNoaWxkTm9kZXN9dmFyIHI7aWYoIWYuc3VwcG9ydC5hcHBlbmRDaGVja2VkKWlmKGtbMF0mJnR5cGVvZiAocj1rLmxlbmd0aCk9PSJudW1iZXIiKWZvcihpPTA7aTxyO2krKylibChrW2ldKTtlbHNlIGJsKGspO2subm9kZVR5cGU/aC5wdXNoKGspOmg9Zi5tZXJnZShoLGspfWlmKGQpe2c9ZnVuY3Rpb24oYSl7cmV0dXJuIWEudHlwZXx8YmQudGVzdChhLnR5cGUpfTtmb3Ioaj0wO2hbal07aisrKWlmKGUmJmYubm9kZU5hbWUoaFtqXSwic2NyaXB0IikmJighaFtqXS50eXBlfHxoW2pdLnR5cGUudG9Mb3dlckNhc2UoKT09PSJ0ZXh0L2phdmFzY3JpcHQiKSllLnB1c2goaFtqXS5wYXJlbnROb2RlP2hbal0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChoW2pdKTpoW2pdKTtlbHNle2lmKGhbal0ubm9kZVR5cGU9PT0xKXt2YXIgcz1mLmdyZXAoaFtqXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IiksZyk7aC5zcGxpY2UuYXBwbHkoaCxbaisxLDBdLmNvbmNhdChzKSl9ZC5hcHBlbmRDaGlsZChoW2pdKX19cmV0dXJuIGh9LGNsZWFuRGF0YTpmdW5jdGlvbihhKXt2YXIgYixjLGQ9Zi5jYWNoZSxlPWYuZXhwYW5kbyxnPWYuZXZlbnQuc3BlY2lhbCxoPWYuc3VwcG9ydC5kZWxldGVFeHBhbmRvO2Zvcih2YXIgaT0wLGo7KGo9YVtpXSkhPW51bGw7aSsrKXtpZihqLm5vZGVOYW1lJiZmLm5vRGF0YVtqLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKWNvbnRpbnVlO2M9altmLmV4cGFuZG9dO2lmKGMpe2I9ZFtjXSYmZFtjXVtlXTtpZihiJiZiLmV2ZW50cyl7Zm9yKHZhciBrIGluIGIuZXZlbnRzKWdba10/Zi5ldmVudC5yZW1vdmUoaixrKTpmLnJlbW92ZUV2ZW50KGosayxiLmhhbmRsZSk7Yi5oYW5kbGUmJihiLmhhbmRsZS5lbGVtPW51bGwpfWg/ZGVsZXRlIGpbZi5leHBhbmRvXTpqLnJlbW92ZUF0dHJpYnV0ZSYmai5yZW1vdmVBdHRyaWJ1dGUoZi5leHBhbmRvKSxkZWxldGUgZFtjXX19fX0pO3ZhciBibj0vYWxwaGFcKFteKV0qXCkvaSxibz0vb3BhY2l0eT0oW14pXSopLyxicD0vKFtBLVpdfF5tcykvZyxicT0vXi0/XGQrKD86cHgpPyQvaSxicj0vXi0/XGQvLGJzPS9eWytcLV09LyxidD0vW14rXC1cLlxkZV0rL2csYnU9e3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdmlzaWJpbGl0eToiaGlkZGVuIixkaXNwbGF5OiJibG9jayJ9LGJ2PVsiTGVmdCIsIlJpZ2h0Il0sYnc9WyJUb3AiLCJCb3R0b20iXSxieCxieSxiejtmLmZuLmNzcz1mdW5jdGlvbihhLGMpe2lmKGFyZ3VtZW50cy5sZW5ndGg9PT0yJiZjPT09YilyZXR1cm4gdGhpcztyZXR1cm4gZi5hY2Nlc3ModGhpcyxhLGMsITAsZnVuY3Rpb24oYSxjLGQpe3JldHVybiBkIT09Yj9mLnN0eWxlKGEsYyxkKTpmLmNzcyhhLGMpfSl9LGYuZXh0ZW5kKHtjc3NIb29rczp7b3BhY2l0eTp7Z2V0OmZ1bmN0aW9uKGEsYil7aWYoYil7dmFyIGM9YngoYSwib3BhY2l0eSIsIm9wYWNpdHkiKTtyZXR1cm4gYz09PSIiPyIxIjpjfXJldHVybiBhLnN0eWxlLm9wYWNpdHl9fX0sY3NzTnVtYmVyOntmaWxsT3BhY2l0eTohMCxmb250V2VpZ2h0OiEwLGxpbmVIZWlnaHQ6ITAsb3BhY2l0eTohMCxvcnBoYW5zOiEwLHdpZG93czohMCx6SW5kZXg6ITAsem9vbTohMH0sY3NzUHJvcHM6eyJmbG9hdCI6Zi5zdXBwb3J0LmNzc0Zsb2F0PyJjc3NGbG9hdCI6InN0eWxlRmxvYXQifSxzdHlsZTpmdW5jdGlvbihhLGMsZCxlKXtpZighIWEmJmEubm9kZVR5cGUhPT0zJiZhLm5vZGVUeXBlIT09OCYmISFhLnN0eWxlKXt2YXIgZyxoLGk9Zi5jYW1lbENhc2UoYyksaj1hLnN0eWxlLGs9Zi5jc3NIb29rc1tpXTtjPWYuY3NzUHJvcHNbaV18fGk7aWYoZD09PWIpe2lmKGsmJiJnZXQiaW4gayYmKGc9ay5nZXQoYSwhMSxlKSkhPT1iKXJldHVybiBnO3JldHVybiBqW2NdfWg9dHlwZW9mIGQ7aWYoaD09PSJudW1iZXIiJiZpc05hTihkKXx8ZD09bnVsbClyZXR1cm47aD09PSJzdHJpbmciJiZicy50ZXN0KGQpJiYoZD0rZC5yZXBsYWNlKGJ0LCIiKStwYXJzZUZsb2F0KGYuY3NzKGEsYykpLGg9Im51bWJlciIpLGg9PT0ibnVtYmVyIiYmIWYuY3NzTnVtYmVyW2ldJiYoZCs9InB4Iik7aWYoIWt8fCEoInNldCJpbiBrKXx8KGQ9ay5zZXQoYSxkKSkhPT1iKXRyeXtqW2NdPWR9Y2F0Y2gobCl7fX19LGNzczpmdW5jdGlvbihhLGMsZCl7dmFyIGUsZztjPWYuY2FtZWxDYXNlKGMpLGc9Zi5jc3NIb29rc1tjXSxjPWYuY3NzUHJvcHNbY118fGMsYz09PSJjc3NGbG9hdCImJihjPSJmbG9hdCIpO2lmKGcmJiJnZXQiaW4gZyYmKGU9Zy5nZXQoYSwhMCxkKSkhPT1iKXJldHVybiBlO2lmKGJ4KXJldHVybiBieChhLGMpfSxzd2FwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD17fTtmb3IodmFyIGUgaW4gYilkW2VdPWEuc3R5bGVbZV0sYS5zdHlsZVtlXT1iW2VdO2MuY2FsbChhKTtmb3IoZSBpbiBiKWEuc3R5bGVbZV09ZFtlXX19KSxmLmN1ckNTUz1mLmNzcyxmLmVhY2goWyJoZWlnaHQiLCJ3aWR0aCJdLGZ1bmN0aW9uKGEsYil7Zi5jc3NIb29rc1tiXT17Z2V0OmZ1bmN0aW9uKGEsYyxkKXt2YXIgZTtpZihjKXtpZihhLm9mZnNldFdpZHRoIT09MClyZXR1cm4gYkEoYSxiLGQpO2Yuc3dhcChhLGJ1LGZ1bmN0aW9uKCl7ZT1iQShhLGIsZCl9KTtyZXR1cm4gZX19LHNldDpmdW5jdGlvbihhLGIpe2lmKCFicS50ZXN0KGIpKXJldHVybiBiO2I9cGFyc2VGbG9hdChiKTtpZihiPj0wKXJldHVybiBiKyJweCJ9fX0pLGYuc3VwcG9ydC5vcGFjaXR5fHwoZi5jc3NIb29rcy5vcGFjaXR5PXtnZXQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYm8udGVzdCgoYiYmYS5jdXJyZW50U3R5bGU/YS5jdXJyZW50U3R5bGUuZmlsdGVyOmEuc3R5bGUuZmlsdGVyKXx8IiIpP3BhcnNlRmxvYXQoUmVnRXhwLiQxKS8xMDArIiI6Yj8iMSI6IiJ9LHNldDpmdW5jdGlvbihhLGIpe3ZhciBjPWEuc3R5bGUsZD1hLmN1cnJlbnRTdHlsZTtjLnpvb209MTt2YXIgZT1mLmlzTmFOKGIpPyIiOiJhbHBoYShvcGFjaXR5PSIrYioxMDArIikiLGc9ZCYmZC5maWx0ZXJ8fGMuZmlsdGVyfHwiIjtjLmZpbHRlcj1ibi50ZXN0KGcpP2cucmVwbGFjZShibixlKTpnKyIgIitlfX0pLGYoZnVuY3Rpb24oKXtmLnN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodHx8KGYuY3NzSG9va3MubWFyZ2luUmlnaHQ9e2dldDpmdW5jdGlvbihhLGIpe3ZhciBjO2Yuc3dhcChhLHtkaXNwbGF5OiJpbmxpbmUtYmxvY2sifSxmdW5jdGlvbigpe2I/Yz1ieChhLCJtYXJnaW4tcmlnaHQiLCJtYXJnaW5SaWdodCIpOmM9YS5zdHlsZS5tYXJnaW5SaWdodH0pO3JldHVybiBjfX0pfSksYy5kZWZhdWx0VmlldyYmYy5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlJiYoYnk9ZnVuY3Rpb24oYSxjKXt2YXIgZCxlLGc7Yz1jLnJlcGxhY2UoYnAsIi0kMSIpLnRvTG93ZXJDYXNlKCk7aWYoIShlPWEub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldykpcmV0dXJuIGI7aWYoZz1lLmdldENvbXB1dGVkU3R5bGUoYSxudWxsKSlkPWcuZ2V0UHJvcGVydHlWYWx1ZShjKSxkPT09IiImJiFmLmNvbnRhaW5zKGEub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsYSkmJihkPWYuc3R5bGUoYSxjKSk7cmV0dXJuIGR9KSxjLmRvY3VtZW50RWxlbWVudC5jdXJyZW50U3R5bGUmJihiej1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9YS5jdXJyZW50U3R5bGUmJmEuY3VycmVudFN0eWxlW2JdLGU9YS5ydW50aW1lU3R5bGUmJmEucnVudGltZVN0eWxlW2JdLGY9YS5zdHlsZTshYnEudGVzdChkKSYmYnIudGVzdChkKSYmKGM9Zi5sZWZ0LGUmJihhLnJ1bnRpbWVTdHlsZS5sZWZ0PWEuY3VycmVudFN0eWxlLmxlZnQpLGYubGVmdD1iPT09ImZvbnRTaXplIj8iMWVtIjpkfHwwLGQ9Zi5waXhlbExlZnQrInB4IixmLmxlZnQ9YyxlJiYoYS5ydW50aW1lU3R5bGUubGVmdD1lKSk7cmV0dXJuIGQ9PT0iIj8iYXV0byI6ZH0pLGJ4PWJ5fHxieixmLmV4cHImJmYuZXhwci5maWx0ZXJzJiYoZi5leHByLmZpbHRlcnMuaGlkZGVuPWZ1bmN0aW9uKGEpe3ZhciBiPWEub2Zmc2V0V2lkdGgsYz1hLm9mZnNldEhlaWdodDtyZXR1cm4gYj09PTAmJmM9PT0wfHwhZi5zdXBwb3J0LnJlbGlhYmxlSGlkZGVuT2Zmc2V0cyYmKGEuc3R5bGUuZGlzcGxheXx8Zi5jc3MoYSwiZGlzcGxheSIpKT09PSJub25lIn0sZi5leHByLmZpbHRlcnMudmlzaWJsZT1mdW5jdGlvbihhKXtyZXR1cm4hZi5leHByLmZpbHRlcnMuaGlkZGVuKGEpfSk7dmFyIGJCPS8lMjAvZyxiQz0vXFtcXSQvLGJEPS9ccj9cbi9nLGJFPS8jLiokLyxiRj0vXiguKj8pOlsgXHRdKihbXlxyXG5dKilccj8kL21nLGJHPS9eKD86Y29sb3J8ZGF0ZXxkYXRldGltZXxlbWFpbHxoaWRkZW58bW9udGh8bnVtYmVyfHBhc3N3b3JkfHJhbmdlfHNlYXJjaHx0ZWx8dGV4dHx0aW1lfHVybHx3ZWVrKSQvaSxiSD0vXig/OmFib3V0fGFwcHxhcHBcLXN0b3JhZ2V8LitcLWV4dGVuc2lvbnxmaWxlfHdpZGdldCk6JC8sYkk9L14oPzpHRVR8SEVBRCkkLyxiSj0vXlwvXC8vLGJLPS9cPy8sYkw9LzxzY3JpcHRcYltePF0qKD86KD8hPFwvc2NyaXB0Pik8W148XSopKjxcL3NjcmlwdD4vZ2ksYk09L14oPzpzZWxlY3R8dGV4dGFyZWEpL2ksYk49L1xzKy8sYk89LyhbPyZdKV89W14mXSovLGJQPS9eKFtcd1wrXC5cLV0rOikoPzpcL1wvKFteXC8/IzpdKikoPzo6KFxkKykpPyk/LyxiUT1mLmZuLmxvYWQsYlI9e30sYlM9e30sYlQsYlU7dHJ5e2JUPWUuaHJlZn1jYXRjaChiVil7YlQ9Yy5jcmVhdGVFbGVtZW50KCJhIiksYlQuaHJlZj0iIixiVD1iVC5ocmVmfWJVPWJQLmV4ZWMoYlQudG9Mb3dlckNhc2UoKSl8fFtdLGYuZm4uZXh0ZW5kKHtsb2FkOmZ1bmN0aW9uKGEsYyxkKXtpZih0eXBlb2YgYSE9InN0cmluZyImJmJRKXJldHVybiBiUS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7aWYoIXRoaXMubGVuZ3RoKXJldHVybiB0aGlzO3ZhciBlPWEuaW5kZXhPZigiICIpO2lmKGU+PTApe3ZhciBnPWEuc2xpY2UoZSxhLmxlbmd0aCk7YT1hLnNsaWNlKDAsZSl9dmFyIGg9IkdFVCI7YyYmKGYuaXNGdW5jdGlvbihjKT8oZD1jLGM9Yik6dHlwZW9mIGM9PSJvYmplY3QiJiYoYz1mLnBhcmFtKGMsZi5hamF4U2V0dGluZ3MudHJhZGl0aW9uYWwpLGg9IlBPU1QiKSk7dmFyIGk9dGhpcztmLmFqYXgoe3VybDphLHR5cGU6aCxkYXRhVHlwZToiaHRtbCIsZGF0YTpjLGNvbXBsZXRlOmZ1bmN0aW9uKGEsYixjKXtjPWEucmVzcG9uc2VUZXh0LGEuaXNSZXNvbHZlZCgpJiYoYS5kb25lKGZ1bmN0aW9uKGEpe2M9YX0pLGkuaHRtbChnP2YoIjxkaXY+IikuYXBwZW5kKGMucmVwbGFjZShiTCwiIikpLmZpbmQoZyk6YykpLGQmJmkuZWFjaChkLFtjLGIsYV0pfX0pO3JldHVybiB0aGlzfSxzZXJpYWxpemU6ZnVuY3Rpb24oKXtyZXR1cm4gZi5wYXJhbSh0aGlzLnNlcmlhbGl6ZUFycmF5KCkpfSxzZXJpYWxpemVBcnJheTpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnRzP2YubWFrZUFycmF5KHRoaXMuZWxlbWVudHMpOnRoaXN9KS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5uYW1lJiYhdGhpcy5kaXNhYmxlZCYmKHRoaXMuY2hlY2tlZHx8Yk0udGVzdCh0aGlzLm5vZGVOYW1lKXx8YkcudGVzdCh0aGlzLnR5cGUpKX0pLm1hcChmdW5jdGlvbihhLGIpe3ZhciBjPWYodGhpcykudmFsKCk7cmV0dXJuIGM9PW51bGw/bnVsbDpmLmlzQXJyYXkoYyk/Zi5tYXAoYyxmdW5jdGlvbihhLGMpe3JldHVybntuYW1lOmIubmFtZSx2YWx1ZTphLnJlcGxhY2UoYkQsIlxyXG4iKX19KTp7bmFtZTpiLm5hbWUsdmFsdWU6Yy5yZXBsYWNlKGJELCJcclxuIil9fSkuZ2V0KCl9fSksZi5lYWNoKCJhamF4U3RhcnQgYWpheFN0b3AgYWpheENvbXBsZXRlIGFqYXhFcnJvciBhamF4U3VjY2VzcyBhamF4U2VuZCIuc3BsaXQoIiAiKSxmdW5jdGlvbihhLGIpe2YuZm5bYl09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuYmluZChiLGEpfX0pLGYuZWFjaChbImdldCIsInBvc3QiXSxmdW5jdGlvbihhLGMpe2ZbY109ZnVuY3Rpb24oYSxkLGUsZyl7Zi5pc0Z1bmN0aW9uKGQpJiYoZz1nfHxlLGU9ZCxkPWIpO3JldHVybiBmLmFqYXgoe3R5cGU6Yyx1cmw6YSxkYXRhOmQsc3VjY2VzczplLGRhdGFUeXBlOmd9KX19KSxmLmV4dGVuZCh7Z2V0U2NyaXB0OmZ1bmN0aW9uKGEsYyl7cmV0dXJuIGYuZ2V0KGEsYixjLCJzY3JpcHQiKX0sZ2V0SlNPTjpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZ2V0KGEsYixjLCJqc29uIil9LGFqYXhTZXR1cDpmdW5jdGlvbihhLGIpe2I/Zi5leHRlbmQoITAsYSxmLmFqYXhTZXR0aW5ncyxiKTooYj1hLGE9Zi5leHRlbmQoITAsZi5hamF4U2V0dGluZ3MsYikpO2Zvcih2YXIgYyBpbntjb250ZXh0OjEsdXJsOjF9KWMgaW4gYj9hW2NdPWJbY106YyBpbiBmLmFqYXhTZXR0aW5ncyYmKGFbY109Zi5hamF4U2V0dGluZ3NbY10pO3JldHVybiBhfSxhamF4U2V0dGluZ3M6e3VybDpiVCxpc0xvY2FsOmJILnRlc3QoYlVbMV0pLGdsb2JhbDohMCx0eXBlOiJHRVQiLGNvbnRlbnRUeXBlOiJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLHByb2Nlc3NEYXRhOiEwLGFzeW5jOiEwLGFjY2VwdHM6e3htbDoiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsaHRtbDoidGV4dC9odG1sIix0ZXh0OiJ0ZXh0L3BsYWluIixqc29uOiJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L2phdmFzY3JpcHQiLCIqIjoiKi8qIn0sY29udGVudHM6e3htbDoveG1sLyxodG1sOi9odG1sLyxqc29uOi9qc29uL30scmVzcG9uc2VGaWVsZHM6e3htbDoicmVzcG9uc2VYTUwiLHRleHQ6InJlc3BvbnNlVGV4dCJ9LGNvbnZlcnRlcnM6eyIqIHRleHQiOmEuU3RyaW5nLCJ0ZXh0IGh0bWwiOiEwLCJ0ZXh0IGpzb24iOmYucGFyc2VKU09OLCJ0ZXh0IHhtbCI6Zi5wYXJzZVhNTH19LGFqYXhQcmVmaWx0ZXI6YlcoYlIpLGFqYXhUcmFuc3BvcnQ6YlcoYlMpLGFqYXg6ZnVuY3Rpb24oYSxjKXtmdW5jdGlvbiB3KGEsYyxsLG0pe2lmKHMhPT0yKXtzPTIscSYmY2xlYXJUaW1lb3V0KHEpLHA9YixuPW18fCIiLHYucmVhZHlTdGF0ZT1hPzQ6MDt2YXIgbyxyLHUsdz1sP2JaKGQsdixsKTpiLHgseTtpZihhPj0yMDAmJmE8MzAwfHxhPT09MzA0KXtpZihkLmlmTW9kaWZpZWQpe2lmKHg9di5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpKWYubGFzdE1vZGlmaWVkW2tdPXg7aWYoeT12LmdldFJlc3BvbnNlSGVhZGVyKCJFdGFnIikpZi5ldGFnW2tdPXl9aWYoYT09PTMwNCljPSJub3Rtb2RpZmllZCIsbz0hMDtlbHNlIHRyeXtyPWIkKGQsdyksYz0ic3VjY2VzcyIsbz0hMH1jYXRjaCh6KXtjPSJwYXJzZXJlcnJvciIsdT16fX1lbHNle3U9YztpZighY3x8YSljPSJlcnJvciIsYTwwJiYoYT0wKX12LnN0YXR1cz1hLHYuc3RhdHVzVGV4dD1jLG8/aC5yZXNvbHZlV2l0aChlLFtyLGMsdl0pOmgucmVqZWN0V2l0aChlLFt2LGMsdV0pLHYuc3RhdHVzQ29kZShqKSxqPWIsdCYmZy50cmlnZ2VyKCJhamF4Iisobz8iU3VjY2VzcyI6IkVycm9yIiksW3YsZCxvP3I6dV0pLGkucmVzb2x2ZVdpdGgoZSxbdixjXSksdCYmKGcudHJpZ2dlcigiYWpheENvbXBsZXRlIixbdixkXSksLS1mLmFjdGl2ZXx8Zi5ldmVudC50cmlnZ2VyKCJhamF4U3RvcCIpKX19dHlwZW9mIGE9PSJvYmplY3QiJiYoYz1hLGE9YiksYz1jfHx7fTt2YXIgZD1mLmFqYXhTZXR1cCh7fSxjKSxlPWQuY29udGV4dHx8ZCxnPWUhPT1kJiYoZS5ub2RlVHlwZXx8ZSBpbnN0YW5jZW9mIGYpP2YoZSk6Zi5ldmVudCxoPWYuRGVmZXJyZWQoKSxpPWYuX0RlZmVycmVkKCksaj1kLnN0YXR1c0NvZGV8fHt9LGssbD17fSxtPXt9LG4sbyxwLHEscixzPTAsdCx1LHY9e3JlYWR5U3RhdGU6MCxzZXRSZXF1ZXN0SGVhZGVyOmZ1bmN0aW9uKGEsYil7aWYoIXMpe3ZhciBjPWEudG9Mb3dlckNhc2UoKTthPW1bY109bVtjXXx8YSxsW2FdPWJ9cmV0dXJuIHRoaXN9LGdldEFsbFJlc3BvbnNlSGVhZGVyczpmdW5jdGlvbigpe3JldHVybiBzPT09Mj9uOm51bGx9LGdldFJlc3BvbnNlSGVhZGVyOmZ1bmN0aW9uKGEpe3ZhciBjO2lmKHM9PT0yKXtpZighbyl7bz17fTt3aGlsZShjPWJGLmV4ZWMobikpb1tjWzFdLnRvTG93ZXJDYXNlKCldPWNbMl19Yz1vW2EudG9Mb3dlckNhc2UoKV19cmV0dXJuIGM9PT1iP251bGw6Y30sb3ZlcnJpZGVNaW1lVHlwZTpmdW5jdGlvbihhKXtzfHwoZC5taW1lVHlwZT1hKTtyZXR1cm4gdGhpc30sYWJvcnQ6ZnVuY3Rpb24oYSl7YT1hfHwiYWJvcnQiLHAmJnAuYWJvcnQoYSksdygwLGEpO3JldHVybiB0aGlzfX07aC5wcm9taXNlKHYpLHYuc3VjY2Vzcz12LmRvbmUsdi5lcnJvcj12LmZhaWwsdi5jb21wbGV0ZT1pLmRvbmUsdi5zdGF0dXNDb2RlPWZ1bmN0aW9uKGEpe2lmKGEpe3ZhciBiO2lmKHM8Milmb3IoYiBpbiBhKWpbYl09W2pbYl0sYVtiXV07ZWxzZSBiPWFbdi5zdGF0dXNdLHYudGhlbihiLGIpfXJldHVybiB0aGlzfSxkLnVybD0oKGF8fGQudXJsKSsiIikucmVwbGFjZShiRSwiIikucmVwbGFjZShiSixiVVsxXSsiLy8iKSxkLmRhdGFUeXBlcz1mLnRyaW0oZC5kYXRhVHlwZXx8IioiKS50b0xvd2VyQ2FzZSgpLnNwbGl0KGJOKSxkLmNyb3NzRG9tYWluPT1udWxsJiYocj1iUC5leGVjKGQudXJsLnRvTG93ZXJDYXNlKCkpLGQuY3Jvc3NEb21haW49ISghcnx8clsxXT09YlVbMV0mJnJbMl09PWJVWzJdJiYoclszXXx8KHJbMV09PT0iaHR0cDoiPzgwOjQ0MykpPT0oYlVbM118fChiVVsxXT09PSJodHRwOiI/ODA6NDQzKSkpKSxkLmRhdGEmJmQucHJvY2Vzc0RhdGEmJnR5cGVvZiBkLmRhdGEhPSJzdHJpbmciJiYoZC5kYXRhPWYucGFyYW0oZC5kYXRhLGQudHJhZGl0aW9uYWwpKSxiWChiUixkLGMsdik7aWYocz09PTIpcmV0dXJuITE7dD1kLmdsb2JhbCxkLnR5cGU9ZC50eXBlLnRvVXBwZXJDYXNlKCksZC5oYXNDb250ZW50PSFiSS50ZXN0KGQudHlwZSksdCYmZi5hY3RpdmUrKz09PTAmJmYuZXZlbnQudHJpZ2dlcigiYWpheFN0YXJ0Iik7aWYoIWQuaGFzQ29udGVudCl7ZC5kYXRhJiYoZC51cmwrPShiSy50ZXN0KGQudXJsKT8iJiI6Ij8iKStkLmRhdGEpLGs9ZC51cmw7aWYoZC5jYWNoZT09PSExKXt2YXIgeD1mLm5vdygpLHk9ZC51cmwucmVwbGFjZShiTywiJDFfPSIreCk7ZC51cmw9eSsoeT09PWQudXJsPyhiSy50ZXN0KGQudXJsKT8iJiI6Ij8iKSsiXz0iK3g6IiIpfX0oZC5kYXRhJiZkLmhhc0NvbnRlbnQmJmQuY29udGVudFR5cGUhPT0hMXx8Yy5jb250ZW50VHlwZSkmJnYuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIixkLmNvbnRlbnRUeXBlKSxkLmlmTW9kaWZpZWQmJihrPWt8fGQudXJsLGYubGFzdE1vZGlmaWVkW2tdJiZ2LnNldFJlcXVlc3RIZWFkZXIoIklmLU1vZGlmaWVkLVNpbmNlIixmLmxhc3RNb2RpZmllZFtrXSksZi5ldGFnW2tdJiZ2LnNldFJlcXVlc3RIZWFkZXIoIklmLU5vbmUtTWF0Y2giLGYuZXRhZ1trXSkpLHYuc2V0UmVxdWVzdEhlYWRlcigiQWNjZXB0IixkLmRhdGFUeXBlc1swXSYmZC5hY2NlcHRzW2QuZGF0YVR5cGVzWzBdXT9kLmFjY2VwdHNbZC5kYXRhVHlwZXNbMF1dKyhkLmRhdGFUeXBlc1swXSE9PSIqIj8iLCAqLyo7IHE9MC4wMSI6IiIpOmQuYWNjZXB0c1siKiJdKTtmb3IodSBpbiBkLmhlYWRlcnMpdi5zZXRSZXF1ZXN0SGVhZGVyKHUsZC5oZWFkZXJzW3VdKTtpZihkLmJlZm9yZVNlbmQmJihkLmJlZm9yZVNlbmQuY2FsbChlLHYsZCk9PT0hMXx8cz09PTIpKXt2LmFib3J0KCk7cmV0dXJuITF9Zm9yKHUgaW57c3VjY2VzczoxLGVycm9yOjEsY29tcGxldGU6MX0pdlt1XShkW3VdKTtwPWJYKGJTLGQsYyx2KTtpZighcCl3KC0xLCJObyBUcmFuc3BvcnQiKTtlbHNle3YucmVhZHlTdGF0ZT0xLHQmJmcudHJpZ2dlcigiYWpheFNlbmQiLFt2LGRdKSxkLmFzeW5jJiZkLnRpbWVvdXQ+MCYmKHE9c2V0VGltZW91dChmdW5jdGlvbigpe3YuYWJvcnQoInRpbWVvdXQiKX0sZC50aW1lb3V0KSk7dHJ5e3M9MSxwLnNlbmQobCx3KX1jYXRjaCh6KXtzdGF0dXM8Mj93KC0xLHopOmYuZXJyb3Ioeil9fXJldHVybiB2fSxwYXJhbTpmdW5jdGlvbihhLGMpe3ZhciBkPVtdLGU9ZnVuY3Rpb24oYSxiKXtiPWYuaXNGdW5jdGlvbihiKT9iKCk6YixkW2QubGVuZ3RoXT1lbmNvZGVVUklDb21wb25lbnQoYSkrIj0iK2VuY29kZVVSSUNvbXBvbmVudChiKX07Yz09PWImJihjPWYuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsKTtpZihmLmlzQXJyYXkoYSl8fGEuanF1ZXJ5JiYhZi5pc1BsYWluT2JqZWN0KGEpKWYuZWFjaChhLGZ1bmN0aW9uKCl7ZSh0aGlzLm5hbWUsdGhpcy52YWx1ZSl9KTtlbHNlIGZvcih2YXIgZyBpbiBhKWJZKGcsYVtnXSxjLGUpO3JldHVybiBkLmpvaW4oIiYiKS5yZXBsYWNlKGJCLCIrIil9fSksZi5leHRlbmQoe2FjdGl2ZTowLGxhc3RNb2RpZmllZDp7fSxldGFnOnt9fSk7dmFyIGJfPWYubm93KCksY2E9LyhcPSlcPygmfCQpfFw/XD8vaTtmLmFqYXhTZXR1cCh7anNvbnA6ImNhbGxiYWNrIixqc29ucENhbGxiYWNrOmZ1bmN0aW9uKCl7cmV0dXJuIGYuZXhwYW5kbysiXyIrYl8rK319KSxmLmFqYXhQcmVmaWx0ZXIoImpzb24ganNvbnAiLGZ1bmN0aW9uKGIsYyxkKXt2YXIgZT1iLmNvbnRlbnRUeXBlPT09ImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCImJnR5cGVvZiBiLmRhdGE9PSJzdHJpbmciO2lmKGIuZGF0YVR5cGVzWzBdPT09Impzb25wInx8Yi5qc29ucCE9PSExJiYoY2EudGVzdChiLnVybCl8fGUmJmNhLnRlc3QoYi5kYXRhKSkpe3ZhciBnLGg9Yi5qc29ucENhbGxiYWNrPWYuaXNGdW5jdGlvbihiLmpzb25wQ2FsbGJhY2spP2IuanNvbnBDYWxsYmFjaygpOmIuanNvbnBDYWxsYmFjayxpPWFbaF0saj1iLnVybCxrPWIuZGF0YSxsPSIkMSIraCsiJDIiO2IuanNvbnAhPT0hMSYmKGo9ai5yZXBsYWNlKGNhLGwpLGIudXJsPT09aiYmKGUmJihrPWsucmVwbGFjZShjYSxsKSksYi5kYXRhPT09ayYmKGorPSgvXD8vLnRlc3Qoaik/IiYiOiI/IikrYi5qc29ucCsiPSIraCkpKSxiLnVybD1qLGIuZGF0YT1rLGFbaF09ZnVuY3Rpb24oYSl7Zz1bYV19LGQuYWx3YXlzKGZ1bmN0aW9uKCl7YVtoXT1pLGcmJmYuaXNGdW5jdGlvbihpKSYmYVtoXShnWzBdKX0pLGIuY29udmVydGVyc1sic2NyaXB0IGpzb24iXT1mdW5jdGlvbigpe2d8fGYuZXJyb3IoaCsiIHdhcyBub3QgY2FsbGVkIik7cmV0dXJuIGdbMF19LGIuZGF0YVR5cGVzWzBdPSJqc29uIjtyZXR1cm4ic2NyaXB0In19KSxmLmFqYXhTZXR1cCh7YWNjZXB0czp7c2NyaXB0OiJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCJ9LGNvbnRlbnRzOntzY3JpcHQ6L2phdmFzY3JpcHR8ZWNtYXNjcmlwdC99LGNvbnZlcnRlcnM6eyJ0ZXh0IHNjcmlwdCI6ZnVuY3Rpb24oYSl7Zi5nbG9iYWxFdmFsKGEpO3JldHVybiBhfX19KSxmLmFqYXhQcmVmaWx0ZXIoInNjcmlwdCIsZnVuY3Rpb24oYSl7YS5jYWNoZT09PWImJihhLmNhY2hlPSExKSxhLmNyb3NzRG9tYWluJiYoYS50eXBlPSJHRVQiLGEuZ2xvYmFsPSExKX0pLGYuYWpheFRyYW5zcG9ydCgic2NyaXB0IixmdW5jdGlvbihhKXtpZihhLmNyb3NzRG9tYWluKXt2YXIgZCxlPWMuaGVhZHx8Yy5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdfHxjLmRvY3VtZW50RWxlbWVudDtyZXR1cm57c2VuZDpmdW5jdGlvbihmLGcpe2Q9Yy5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKSxkLmFzeW5jPSJhc3luYyIsYS5zY3JpcHRDaGFyc2V0JiYoZC5jaGFyc2V0PWEuc2NyaXB0Q2hhcnNldCksZC5zcmM9YS51cmwsZC5vbmxvYWQ9ZC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oYSxjKXtpZihjfHwhZC5yZWFkeVN0YXRlfHwvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KGQucmVhZHlTdGF0ZSkpZC5vbmxvYWQ9ZC5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCxlJiZkLnBhcmVudE5vZGUmJmUucmVtb3ZlQ2hpbGQoZCksZD1iLGN8fGcoMjAwLCJzdWNjZXNzIil9LGUuaW5zZXJ0QmVmb3JlKGQsZS5maXJzdENoaWxkKX0sYWJvcnQ6ZnVuY3Rpb24oKXtkJiZkLm9ubG9hZCgwLDEpfX19fSk7dmFyIGNiPWEuQWN0aXZlWE9iamVjdD9mdW5jdGlvbigpe2Zvcih2YXIgYSBpbiBjZCljZFthXSgwLDEpfTohMSxjYz0wLGNkO2YuYWpheFNldHRpbmdzLnhocj1hLkFjdGl2ZVhPYmplY3Q/ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5pc0xvY2FsJiZjZSgpfHxjZigpfTpjZSxmdW5jdGlvbihhKXtmLmV4dGVuZChmLnN1cHBvcnQse2FqYXg6ISFhLGNvcnM6ISFhJiYid2l0aENyZWRlbnRpYWxzImluIGF9KX0oZi5hamF4U2V0dGluZ3MueGhyKCkpLGYuc3VwcG9ydC5hamF4JiZmLmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oYyl7aWYoIWMuY3Jvc3NEb21haW58fGYuc3VwcG9ydC5jb3JzKXt2YXIgZDtyZXR1cm57c2VuZDpmdW5jdGlvbihlLGcpe3ZhciBoPWMueGhyKCksaSxqO2MudXNlcm5hbWU/aC5vcGVuKGMudHlwZSxjLnVybCxjLmFzeW5jLGMudXNlcm5hbWUsYy5wYXNzd29yZCk6aC5vcGVuKGMudHlwZSxjLnVybCxjLmFzeW5jKTtpZihjLnhockZpZWxkcylmb3IoaiBpbiBjLnhockZpZWxkcyloW2pdPWMueGhyRmllbGRzW2pdO2MubWltZVR5cGUmJmgub3ZlcnJpZGVNaW1lVHlwZSYmaC5vdmVycmlkZU1pbWVUeXBlKGMubWltZVR5cGUpLCFjLmNyb3NzRG9tYWluJiYhZVsiWC1SZXF1ZXN0ZWQtV2l0aCJdJiYoZVsiWC1SZXF1ZXN0ZWQtV2l0aCJdPSJYTUxIdHRwUmVxdWVzdCIpO3RyeXtmb3IoaiBpbiBlKWguc2V0UmVxdWVzdEhlYWRlcihqLGVbal0pfWNhdGNoKGspe31oLnNlbmQoYy5oYXNDb250ZW50JiZjLmRhdGF8fG51bGwpLGQ9ZnVuY3Rpb24oYSxlKXt2YXIgaixrLGwsbSxuO3RyeXtpZihkJiYoZXx8aC5yZWFkeVN0YXRlPT09NCkpe2Q9YixpJiYoaC5vbnJlYWR5c3RhdGVjaGFuZ2U9Zi5ub29wLGNiJiZkZWxldGUgY2RbaV0pO2lmKGUpaC5yZWFkeVN0YXRlIT09NCYmaC5hYm9ydCgpO2Vsc2V7aj1oLnN0YXR1cyxsPWguZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCksbT17fSxuPWgucmVzcG9uc2VYTUwsbiYmbi5kb2N1bWVudEVsZW1lbnQmJihtLnhtbD1uKSxtLnRleHQ9aC5yZXNwb25zZVRleHQ7dHJ5e2s9aC5zdGF0dXNUZXh0fWNhdGNoKG8pe2s9IiJ9IWomJmMuaXNMb2NhbCYmIWMuY3Jvc3NEb21haW4/aj1tLnRleHQ/MjAwOjQwNDpqPT09MTIyMyYmKGo9MjA0KX19fWNhdGNoKHApe2V8fGcoLTEscCl9bSYmZyhqLGssbSxsKX0sIWMuYXN5bmN8fGgucmVhZHlTdGF0ZT09PTQ/ZCgpOihpPSsrY2MsY2ImJihjZHx8KGNkPXt9LGYoYSkudW5sb2FkKGNiKSksY2RbaV09ZCksaC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZCl9LGFib3J0OmZ1bmN0aW9uKCl7ZCYmZCgwLDEpfX19fSk7dmFyIGNnPXt9LGNoLGNpLGNqPS9eKD86dG9nZ2xlfHNob3d8aGlkZSkkLyxjaz0vXihbK1wtXT0pPyhbXGQrLlwtXSspKFthLXolXSopJC9pLGNsLGNtPVtbImhlaWdodCIsIm1hcmdpblRvcCIsIm1hcmdpbkJvdHRvbSIsInBhZGRpbmdUb3AiLCJwYWRkaW5nQm90dG9tIl0sWyJ3aWR0aCIsIm1hcmdpbkxlZnQiLCJtYXJnaW5SaWdodCIsInBhZGRpbmdMZWZ0IiwicGFkZGluZ1JpZ2h0Il0sWyJvcGFjaXR5Il1dLGNuLGNvPWEud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxhLm1velJlcXVlc3RBbmltYXRpb25GcmFtZXx8YS5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lO2YuZm4uZXh0ZW5kKHtzaG93OmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlO2lmKGF8fGE9PT0wKXJldHVybiB0aGlzLmFuaW1hdGUoY3IoInNob3ciLDMpLGEsYixjKTtmb3IodmFyIGc9MCxoPXRoaXMubGVuZ3RoO2c8aDtnKyspZD10aGlzW2ddLGQuc3R5bGUmJihlPWQuc3R5bGUuZGlzcGxheSwhZi5fZGF0YShkLCJvbGRkaXNwbGF5IikmJmU9PT0ibm9uZSImJihlPWQuc3R5bGUuZGlzcGxheT0iIiksZT09PSIiJiZmLmNzcyhkLCJkaXNwbGF5Iik9PT0ibm9uZSImJmYuX2RhdGEoZCwib2xkZGlzcGxheSIsY3MoZC5ub2RlTmFtZSkpKTtmb3IoZz0wO2c8aDtnKyspe2Q9dGhpc1tnXTtpZihkLnN0eWxlKXtlPWQuc3R5bGUuZGlzcGxheTtpZihlPT09IiJ8fGU9PT0ibm9uZSIpZC5zdHlsZS5kaXNwbGF5PWYuX2RhdGEoZCwib2xkZGlzcGxheSIpfHwiIn19cmV0dXJuIHRoaXN9LGhpZGU6ZnVuY3Rpb24oYSxiLGMpe2lmKGF8fGE9PT0wKXJldHVybiB0aGlzLmFuaW1hdGUoY3IoImhpZGUiLDMpLGEsYixjKTtmb3IodmFyIGQ9MCxlPXRoaXMubGVuZ3RoO2Q8ZTtkKyspaWYodGhpc1tkXS5zdHlsZSl7dmFyIGc9Zi5jc3ModGhpc1tkXSwiZGlzcGxheSIpO2chPT0ibm9uZSImJiFmLl9kYXRhKHRoaXNbZF0sIm9sZGRpc3BsYXkiKSYmZi5fZGF0YSh0aGlzW2RdLCJvbGRkaXNwbGF5IixnKX1mb3IoZD0wO2Q8ZTtkKyspdGhpc1tkXS5zdHlsZSYmKHRoaXNbZF0uc3R5bGUuZGlzcGxheT0ibm9uZSIpO3JldHVybiB0aGlzfSxfdG9nZ2xlOmYuZm4udG9nZ2xlLHRvZ2dsZTpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dHlwZW9mIGE9PSJib29sZWFuIjtmLmlzRnVuY3Rpb24oYSkmJmYuaXNGdW5jdGlvbihiKT90aGlzLl90b2dnbGUuYXBwbHkodGhpcyxhcmd1bWVudHMpOmE9PW51bGx8fGQ/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9ZD9hOmYodGhpcykuaXMoIjpoaWRkZW4iKTtmKHRoaXMpW2I/InNob3ciOiJoaWRlIl0oKX0pOnRoaXMuYW5pbWF0ZShjcigidG9nZ2xlIiwzKSxhLGIsYyk7cmV0dXJuIHRoaXN9LGZhZGVUbzpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5maWx0ZXIoIjpoaWRkZW4iKS5jc3MoIm9wYWNpdHkiLDApLnNob3coKS5lbmQoKS5hbmltYXRlKHtvcGFjaXR5OmJ9LGEsYyxkKX0sYW5pbWF0ZTpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1mLnNwZWVkKGIsYyxkKTtpZihmLmlzRW1wdHlPYmplY3QoYSkpcmV0dXJuIHRoaXMuZWFjaChlLmNvbXBsZXRlLFshMV0pO2E9Zi5leHRlbmQoe30sYSk7cmV0dXJuIHRoaXNbZS5xdWV1ZT09PSExPyJlYWNoIjoicXVldWUiXShmdW5jdGlvbigpe2UucXVldWU9PT0hMSYmZi5fbWFyayh0aGlzKTt2YXIgYj1mLmV4dGVuZCh7fSxlKSxjPXRoaXMubm9kZVR5cGU9PT0xLGQ9YyYmZih0aGlzKS5pcygiOmhpZGRlbiIpLGcsaCxpLGosayxsLG0sbixvO2IuYW5pbWF0ZWRQcm9wZXJ0aWVzPXt9O2ZvcihpIGluIGEpe2c9Zi5jYW1lbENhc2UoaSksaSE9PWcmJihhW2ddPWFbaV0sZGVsZXRlIGFbaV0pLGg9YVtnXSxmLmlzQXJyYXkoaCk/KGIuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddPWhbMV0saD1hW2ddPWhbMF0pOmIuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddPWIuc3BlY2lhbEVhc2luZyYmYi5zcGVjaWFsRWFzaW5nW2ddfHxiLmVhc2luZ3x8InN3aW5nIjtpZihoPT09ImhpZGUiJiZkfHxoPT09InNob3ciJiYhZClyZXR1cm4gYi5jb21wbGV0ZS5jYWxsKHRoaXMpO2MmJihnPT09ImhlaWdodCJ8fGc9PT0id2lkdGgiKSYmKGIub3ZlcmZsb3c9W3RoaXMuc3R5bGUub3ZlcmZsb3csdGhpcy5zdHlsZS5vdmVyZmxvd1gsdGhpcy5zdHlsZS5vdmVyZmxvd1ldLGYuY3NzKHRoaXMsImRpc3BsYXkiKT09PSJpbmxpbmUiJiZmLmNzcyh0aGlzLCJmbG9hdCIpPT09Im5vbmUiJiYoZi5zdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQ/KGo9Y3ModGhpcy5ub2RlTmFtZSksaj09PSJpbmxpbmUiP3RoaXMuc3R5bGUuZGlzcGxheT0iaW5saW5lLWJsb2NrIjoodGhpcy5zdHlsZS5kaXNwbGF5PSJpbmxpbmUiLHRoaXMuc3R5bGUuem9vbT0xKSk6dGhpcy5zdHlsZS5kaXNwbGF5PSJpbmxpbmUtYmxvY2siKSl9Yi5vdmVyZmxvdyE9bnVsbCYmKHRoaXMuc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIpO2ZvcihpIGluIGEpaz1uZXcgZi5meCh0aGlzLGIsaSksaD1hW2ldLGNqLnRlc3QoaCk/a1toPT09InRvZ2dsZSI/ZD8ic2hvdyI6ImhpZGUiOmhdKCk6KGw9Y2suZXhlYyhoKSxtPWsuY3VyKCksbD8obj1wYXJzZUZsb2F0KGxbMl0pLG89bFszXXx8KGYuY3NzTnVtYmVyW2ldPyIiOiJweCIpLG8hPT0icHgiJiYoZi5zdHlsZSh0aGlzLGksKG58fDEpK28pLG09KG58fDEpL2suY3VyKCkqbSxmLnN0eWxlKHRoaXMsaSxtK28pKSxsWzFdJiYobj0obFsxXT09PSItPSI/LTE6MSkqbittKSxrLmN1c3RvbShtLG4sbykpOmsuY3VzdG9tKG0saCwiIikpO3JldHVybiEwfSl9LHN0b3A6ZnVuY3Rpb24oYSxiKXthJiZ0aGlzLnF1ZXVlKFtdKSx0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYT1mLnRpbWVycyxjPWEubGVuZ3RoO2J8fGYuX3VubWFyayghMCx0aGlzKTt3aGlsZShjLS0pYVtjXS5lbGVtPT09dGhpcyYmKGImJmFbY10oITApLGEuc3BsaWNlKGMsMSkpfSksYnx8dGhpcy5kZXF1ZXVlKCk7cmV0dXJuIHRoaXN9fSksZi5lYWNoKHtzbGlkZURvd246Y3IoInNob3ciLDEpLHNsaWRlVXA6Y3IoImhpZGUiLDEpLHNsaWRlVG9nZ2xlOmNyKCJ0b2dnbGUiLDEpLGZhZGVJbjp7b3BhY2l0eToic2hvdyJ9LGZhZGVPdXQ6e29wYWNpdHk6ImhpZGUifSxmYWRlVG9nZ2xlOntvcGFjaXR5OiJ0b2dnbGUifX0sZnVuY3Rpb24oYSxiKXtmLmZuW2FdPWZ1bmN0aW9uKGEsYyxkKXtyZXR1cm4gdGhpcy5hbmltYXRlKGIsYSxjLGQpfX0pLGYuZXh0ZW5kKHtzcGVlZDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YSYmdHlwZW9mIGE9PSJvYmplY3QiP2YuZXh0ZW5kKHt9LGEpOntjb21wbGV0ZTpjfHwhYyYmYnx8Zi5pc0Z1bmN0aW9uKGEpJiZhLGR1cmF0aW9uOmEsZWFzaW5nOmMmJmJ8fGImJiFmLmlzRnVuY3Rpb24oYikmJmJ9O2QuZHVyYXRpb249Zi5meC5vZmY/MDp0eXBlb2YgZC5kdXJhdGlvbj09Im51bWJlciI/ZC5kdXJhdGlvbjpkLmR1cmF0aW9uIGluIGYuZnguc3BlZWRzP2YuZnguc3BlZWRzW2QuZHVyYXRpb25dOmYuZnguc3BlZWRzLl9kZWZhdWx0LGQub2xkPWQuY29tcGxldGUsZC5jb21wbGV0ZT1mdW5jdGlvbihhKXtmLmlzRnVuY3Rpb24oZC5vbGQpJiZkLm9sZC5jYWxsKHRoaXMpLGQucXVldWUhPT0hMT9mLmRlcXVldWUodGhpcyk6YSE9PSExJiZmLl91bm1hcmsodGhpcyl9O3JldHVybiBkfSxlYXNpbmc6e2xpbmVhcjpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gYytkKmF9LHN3aW5nOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybigtTWF0aC5jb3MoYSpNYXRoLlBJKS8yKy41KSpkK2N9fSx0aW1lcnM6W10sZng6ZnVuY3Rpb24oYSxiLGMpe3RoaXMub3B0aW9ucz1iLHRoaXMuZWxlbT1hLHRoaXMucHJvcD1jLGIub3JpZz1iLm9yaWd8fHt9fX0pLGYuZngucHJvdG90eXBlPXt1cGRhdGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuc3RlcCYmdGhpcy5vcHRpb25zLnN0ZXAuY2FsbCh0aGlzLmVsZW0sdGhpcy5ub3csdGhpcyksKGYuZnguc3RlcFt0aGlzLnByb3BdfHxmLmZ4LnN0ZXAuX2RlZmF1bHQpKHRoaXMpfSxjdXI6ZnVuY3Rpb24oKXtpZih0aGlzLmVsZW1bdGhpcy5wcm9wXSE9bnVsbCYmKCF0aGlzLmVsZW0uc3R5bGV8fHRoaXMuZWxlbS5zdHlsZVt0aGlzLnByb3BdPT1udWxsKSlyZXR1cm4gdGhpcy5lbGVtW3RoaXMucHJvcF07dmFyIGEsYj1mLmNzcyh0aGlzLmVsZW0sdGhpcy5wcm9wKTtyZXR1cm4gaXNOYU4oYT1wYXJzZUZsb2F0KGIpKT8hYnx8Yj09PSJhdXRvIj8wOmI6YX0sY3VzdG9tOmZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBoKGEpe3JldHVybiBkLnN0ZXAoYSl9dmFyIGQ9dGhpcyxlPWYuZngsZzt0aGlzLnN0YXJ0VGltZT1jbnx8Y3AoKSx0aGlzLnN0YXJ0PWEsdGhpcy5lbmQ9Yix0aGlzLnVuaXQ9Y3x8dGhpcy51bml0fHwoZi5jc3NOdW1iZXJbdGhpcy5wcm9wXT8iIjoicHgiKSx0aGlzLm5vdz10aGlzLnN0YXJ0LHRoaXMucG9zPXRoaXMuc3RhdGU9MCxoLmVsZW09dGhpcy5lbGVtLGgoKSYmZi50aW1lcnMucHVzaChoKSYmIWNsJiYoY28/KGNsPSEwLGc9ZnVuY3Rpb24oKXtjbCYmKGNvKGcpLGUudGljaygpKX0sY28oZykpOmNsPXNldEludGVydmFsKGUudGljayxlLmludGVydmFsKSl9LHNob3c6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMub3JpZ1t0aGlzLnByb3BdPWYuc3R5bGUodGhpcy5lbGVtLHRoaXMucHJvcCksdGhpcy5vcHRpb25zLnNob3c9ITAsdGhpcy5jdXN0b20odGhpcy5wcm9wPT09IndpZHRoInx8dGhpcy5wcm9wPT09ImhlaWdodCI/MTowLHRoaXMuY3VyKCkpLGYodGhpcy5lbGVtKS5zaG93KCl9LGhpZGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMub3JpZ1t0aGlzLnByb3BdPWYuc3R5bGUodGhpcy5lbGVtLHRoaXMucHJvcCksdGhpcy5vcHRpb25zLmhpZGU9ITAsdGhpcy5jdXN0b20odGhpcy5jdXIoKSwwKX0sc3RlcDpmdW5jdGlvbihhKXt2YXIgYj1jbnx8Y3AoKSxjPSEwLGQ9dGhpcy5lbGVtLGU9dGhpcy5vcHRpb25zLGcsaDtpZihhfHxiPj1lLmR1cmF0aW9uK3RoaXMuc3RhcnRUaW1lKXt0aGlzLm5vdz10aGlzLmVuZCx0aGlzLnBvcz10aGlzLnN0YXRlPTEsdGhpcy51cGRhdGUoKSxlLmFuaW1hdGVkUHJvcGVydGllc1t0aGlzLnByb3BdPSEwO2ZvcihnIGluIGUuYW5pbWF0ZWRQcm9wZXJ0aWVzKWUuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddIT09ITAmJihjPSExKTtpZihjKXtlLm92ZXJmbG93IT1udWxsJiYhZi5zdXBwb3J0LnNocmlua1dyYXBCbG9ja3MmJmYuZWFjaChbIiIsIlgiLCJZIl0sZnVuY3Rpb24oYSxiKXtkLnN0eWxlWyJvdmVyZmxvdyIrYl09ZS5vdmVyZmxvd1thXX0pLGUuaGlkZSYmZihkKS5oaWRlKCk7aWYoZS5oaWRlfHxlLnNob3cpZm9yKHZhciBpIGluIGUuYW5pbWF0ZWRQcm9wZXJ0aWVzKWYuc3R5bGUoZCxpLGUub3JpZ1tpXSk7ZS5jb21wbGV0ZS5jYWxsKGQpfXJldHVybiExfWUuZHVyYXRpb249PUluZmluaXR5P3RoaXMubm93PWI6KGg9Yi10aGlzLnN0YXJ0VGltZSx0aGlzLnN0YXRlPWgvZS5kdXJhdGlvbix0aGlzLnBvcz1mLmVhc2luZ1tlLmFuaW1hdGVkUHJvcGVydGllc1t0aGlzLnByb3BdXSh0aGlzLnN0YXRlLGgsMCwxLGUuZHVyYXRpb24pLHRoaXMubm93PXRoaXMuc3RhcnQrKHRoaXMuZW5kLXRoaXMuc3RhcnQpKnRoaXMucG9zKSx0aGlzLnVwZGF0ZSgpO3JldHVybiEwfX0sZi5leHRlbmQoZi5meCx7dGljazpmdW5jdGlvbigpe2Zvcih2YXIgYT1mLnRpbWVycyxiPTA7YjxhLmxlbmd0aDsrK2IpYVtiXSgpfHxhLnNwbGljZShiLS0sMSk7YS5sZW5ndGh8fGYuZnguc3RvcCgpfSxpbnRlcnZhbDoxMyxzdG9wOmZ1bmN0aW9uKCl7Y2xlYXJJbnRlcnZhbChjbCksY2w9bnVsbH0sc3BlZWRzOntzbG93OjYwMCxmYXN0OjIwMCxfZGVmYXVsdDo0MDB9LHN0ZXA6e29wYWNpdHk6ZnVuY3Rpb24oYSl7Zi5zdHlsZShhLmVsZW0sIm9wYWNpdHkiLGEubm93KX0sX2RlZmF1bHQ6ZnVuY3Rpb24oYSl7YS5lbGVtLnN0eWxlJiZhLmVsZW0uc3R5bGVbYS5wcm9wXSE9bnVsbD9hLmVsZW0uc3R5bGVbYS5wcm9wXT0oYS5wcm9wPT09IndpZHRoInx8YS5wcm9wPT09ImhlaWdodCI/TWF0aC5tYXgoMCxhLm5vdyk6YS5ub3cpK2EudW5pdDphLmVsZW1bYS5wcm9wXT1hLm5vd319fSksZi5leHByJiZmLmV4cHIuZmlsdGVycyYmKGYuZXhwci5maWx0ZXJzLmFuaW1hdGVkPWZ1bmN0aW9uKGEpe3JldHVybiBmLmdyZXAoZi50aW1lcnMsZnVuY3Rpb24oYil7cmV0dXJuIGE9PT1iLmVsZW19KS5sZW5ndGh9KTt2YXIgY3Q9L150KD86YWJsZXxkfGgpJC9pLGN1PS9eKD86Ym9keXxodG1sKSQvaTsiZ2V0Qm91bmRpbmdDbGllbnRSZWN0ImluIGMuZG9jdW1lbnRFbGVtZW50P2YuZm4ub2Zmc2V0PWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXNbMF0sYztpZihhKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zi5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO2lmKCFifHwhYi5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGI9PT1iLm93bmVyRG9jdW1lbnQuYm9keSlyZXR1cm4gZi5vZmZzZXQuYm9keU9mZnNldChiKTt0cnl7Yz1iLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpfWNhdGNoKGQpe312YXIgZT1iLm93bmVyRG9jdW1lbnQsZz1lLmRvY3VtZW50RWxlbWVudDtpZighY3x8IWYuY29udGFpbnMoZyxiKSlyZXR1cm4gYz97dG9wOmMudG9wLGxlZnQ6Yy5sZWZ0fTp7dG9wOjAsbGVmdDowfTt2YXIgaD1lLmJvZHksaT1jdihlKSxqPWcuY2xpZW50VG9wfHxoLmNsaWVudFRvcHx8MCxrPWcuY2xpZW50TGVmdHx8aC5jbGllbnRMZWZ0fHwwLGw9aS5wYWdlWU9mZnNldHx8Zi5zdXBwb3J0LmJveE1vZGVsJiZnLnNjcm9sbFRvcHx8aC5zY3JvbGxUb3AsbT1pLnBhZ2VYT2Zmc2V0fHxmLnN1cHBvcnQuYm94TW9kZWwmJmcuc2Nyb2xsTGVmdHx8aC5zY3JvbGxMZWZ0LG49Yy50b3ArbC1qLG89Yy5sZWZ0K20taztyZXR1cm57dG9wOm4sbGVmdDpvfX06Zi5mbi5vZmZzZXQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXTtpZihhKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zi5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO2lmKCFifHwhYi5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGI9PT1iLm93bmVyRG9jdW1lbnQuYm9keSlyZXR1cm4gZi5vZmZzZXQuYm9keU9mZnNldChiKTtmLm9mZnNldC5pbml0aWFsaXplKCk7dmFyIGMsZD1iLm9mZnNldFBhcmVudCxlPWIsZz1iLm93bmVyRG9jdW1lbnQsaD1nLmRvY3VtZW50RWxlbWVudCxpPWcuYm9keSxqPWcuZGVmYXVsdFZpZXcsaz1qP2ouZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpOmIuY3VycmVudFN0eWxlLGw9Yi5vZmZzZXRUb3AsbT1iLm9mZnNldExlZnQ7d2hpbGUoKGI9Yi5wYXJlbnROb2RlKSYmYiE9PWkmJmIhPT1oKXtpZihmLm9mZnNldC5zdXBwb3J0c0ZpeGVkUG9zaXRpb24mJmsucG9zaXRpb249PT0iZml4ZWQiKWJyZWFrO2M9aj9qLmdldENvbXB1dGVkU3R5bGUoYixudWxsKTpiLmN1cnJlbnRTdHlsZSxsLT1iLnNjcm9sbFRvcCxtLT1iLnNjcm9sbExlZnQsYj09PWQmJihsKz1iLm9mZnNldFRvcCxtKz1iLm9mZnNldExlZnQsZi5vZmZzZXQuZG9lc05vdEFkZEJvcmRlciYmKCFmLm9mZnNldC5kb2VzQWRkQm9yZGVyRm9yVGFibGVBbmRDZWxsc3x8IWN0LnRlc3QoYi5ub2RlTmFtZSkpJiYobCs9cGFyc2VGbG9hdChjLmJvcmRlclRvcFdpZHRoKXx8MCxtKz1wYXJzZUZsb2F0KGMuYm9yZGVyTGVmdFdpZHRoKXx8MCksZT1kLGQ9Yi5vZmZzZXRQYXJlbnQpLGYub2Zmc2V0LnN1YnRyYWN0c0JvcmRlckZvck92ZXJmbG93Tm90VmlzaWJsZSYmYy5vdmVyZmxvdyE9PSJ2aXNpYmxlIiYmKGwrPXBhcnNlRmxvYXQoYy5ib3JkZXJUb3BXaWR0aCl8fDAsbSs9cGFyc2VGbG9hdChjLmJvcmRlckxlZnRXaWR0aCl8fDApLGs9Y31pZihrLnBvc2l0aW9uPT09InJlbGF0aXZlInx8ay5wb3NpdGlvbj09PSJzdGF0aWMiKWwrPWkub2Zmc2V0VG9wLG0rPWkub2Zmc2V0TGVmdDtmLm9mZnNldC5zdXBwb3J0c0ZpeGVkUG9zaXRpb24mJmsucG9zaXRpb249PT0iZml4ZWQiJiYobCs9TWF0aC5tYXgoaC5zY3JvbGxUb3AsaS5zY3JvbGxUb3ApLG0rPU1hdGgubWF4KGguc2Nyb2xsTGVmdCxpLnNjcm9sbExlZnQpKTtyZXR1cm57dG9wOmwsbGVmdDptfX0sZi5vZmZzZXQ9e2luaXRpYWxpemU6ZnVuY3Rpb24oKXt2YXIgYT1jLmJvZHksYj1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpLGQsZSxnLGgsaT1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpblRvcCIpKXx8MCxqPSI8ZGl2IHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7bWFyZ2luOjA7Ym9yZGVyOjVweCBzb2xpZCAjMDAwO3BhZGRpbmc6MDt3aWR0aDoxcHg7aGVpZ2h0OjFweDsnPjxkaXY+PC9kaXY+PC9kaXY+PHRhYmxlIHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7bWFyZ2luOjA7Ym9yZGVyOjVweCBzb2xpZCAjMDAwO3BhZGRpbmc6MDt3aWR0aDoxcHg7aGVpZ2h0OjFweDsnIGNlbGxwYWRkaW5nPScwJyBjZWxsc3BhY2luZz0nMCc+PHRyPjx0ZD48L3RkPjwvdHI+PC90YWJsZT4iO2YuZXh0ZW5kKGIuc3R5bGUse3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdG9wOjAsbGVmdDowLG1hcmdpbjowLGJvcmRlcjowLHdpZHRoOiIxcHgiLGhlaWdodDoiMXB4Iix2aXNpYmlsaXR5OiJoaWRkZW4ifSksYi5pbm5lckhUTUw9aixhLmluc2VydEJlZm9yZShiLGEuZmlyc3RDaGlsZCksZD1iLmZpcnN0Q2hpbGQsZT1kLmZpcnN0Q2hpbGQsaD1kLm5leHRTaWJsaW5nLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZCx0aGlzLmRvZXNOb3RBZGRCb3JkZXI9ZS5vZmZzZXRUb3AhPT01LHRoaXMuZG9lc0FkZEJvcmRlckZvclRhYmxlQW5kQ2VsbHM9aC5vZmZzZXRUb3A9PT01LGUuc3R5bGUucG9zaXRpb249ImZpeGVkIixlLnN0eWxlLnRvcD0iMjBweCIsdGhpcy5zdXBwb3J0c0ZpeGVkUG9zaXRpb249ZS5vZmZzZXRUb3A9PT0yMHx8ZS5vZmZzZXRUb3A9PT0xNSxlLnN0eWxlLnBvc2l0aW9uPWUuc3R5bGUudG9wPSIiLGQuc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIsZC5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiLHRoaXMuc3VidHJhY3RzQm9yZGVyRm9yT3ZlcmZsb3dOb3RWaXNpYmxlPWUub2Zmc2V0VG9wPT09LTUsdGhpcy5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldD1hLm9mZnNldFRvcCE9PWksYS5yZW1vdmVDaGlsZChiKSxmLm9mZnNldC5pbml0aWFsaXplPWYubm9vcH0sYm9keU9mZnNldDpmdW5jdGlvbihhKXt2YXIgYj1hLm9mZnNldFRvcCxjPWEub2Zmc2V0TGVmdDtmLm9mZnNldC5pbml0aWFsaXplKCksZi5vZmZzZXQuZG9lc05vdEluY2x1ZGVNYXJnaW5JbkJvZHlPZmZzZXQmJihiKz1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpblRvcCIpKXx8MCxjKz1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpbkxlZnQiKSl8fDApO3JldHVybnt0b3A6YixsZWZ0OmN9fSxzZXRPZmZzZXQ6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWYuY3NzKGEsInBvc2l0aW9uIik7ZD09PSJzdGF0aWMiJiYoYS5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiKTt2YXIgZT1mKGEpLGc9ZS5vZmZzZXQoKSxoPWYuY3NzKGEsInRvcCIpLGk9Zi5jc3MoYSwibGVmdCIpLGo9KGQ9PT0iYWJzb2x1dGUifHxkPT09ImZpeGVkIikmJmYuaW5BcnJheSgiYXV0byIsW2gsaV0pPi0xLGs9e30sbD17fSxtLG47aj8obD1lLnBvc2l0aW9uKCksbT1sLnRvcCxuPWwubGVmdCk6KG09cGFyc2VGbG9hdChoKXx8MCxuPXBhcnNlRmxvYXQoaSl8fDApLGYuaXNGdW5jdGlvbihiKSYmKGI9Yi5jYWxsKGEsYyxnKSksYi50b3AhPW51bGwmJihrLnRvcD1iLnRvcC1nLnRvcCttKSxiLmxlZnQhPW51bGwmJihrLmxlZnQ9Yi5sZWZ0LWcubGVmdCtuKSwidXNpbmciaW4gYj9iLnVzaW5nLmNhbGwoYSxrKTplLmNzcyhrKX19LGYuZm4uZXh0ZW5kKHtwb3NpdGlvbjpmdW5jdGlvbigpe2lmKCF0aGlzWzBdKXJldHVybiBudWxsO3ZhciBhPXRoaXNbMF0sYj10aGlzLm9mZnNldFBhcmVudCgpLGM9dGhpcy5vZmZzZXQoKSxkPWN1LnRlc3QoYlswXS5ub2RlTmFtZSk/e3RvcDowLGxlZnQ6MH06Yi5vZmZzZXQoKTtjLnRvcC09cGFyc2VGbG9hdChmLmNzcyhhLCJtYXJnaW5Ub3AiKSl8fDAsYy5sZWZ0LT1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpbkxlZnQiKSl8fDAsZC50b3ArPXBhcnNlRmxvYXQoZi5jc3MoYlswXSwiYm9yZGVyVG9wV2lkdGgiKSl8fDAsZC5sZWZ0Kz1wYXJzZUZsb2F0KGYuY3NzKGJbMF0sImJvcmRlckxlZnRXaWR0aCIpKXx8MDtyZXR1cm57dG9wOmMudG9wLWQudG9wLGxlZnQ6Yy5sZWZ0LWQubGVmdH19LG9mZnNldFBhcmVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3ZhciBhPXRoaXMub2Zmc2V0UGFyZW50fHxjLmJvZHk7d2hpbGUoYSYmIWN1LnRlc3QoYS5ub2RlTmFtZSkmJmYuY3NzKGEsInBvc2l0aW9uIik9PT0ic3RhdGljIilhPWEub2Zmc2V0UGFyZW50O3JldHVybiBhfSl9fSksZi5lYWNoKFsiTGVmdCIsIlRvcCJdLGZ1bmN0aW9uKGEsYyl7dmFyIGQ9InNjcm9sbCIrYztmLmZuW2RdPWZ1bmN0aW9uKGMpe3ZhciBlLGc7aWYoYz09PWIpe2U9dGhpc1swXTtpZighZSlyZXR1cm4gbnVsbDtnPWN2KGUpO3JldHVybiBnPyJwYWdlWE9mZnNldCJpbiBnP2dbYT8icGFnZVlPZmZzZXQiOiJwYWdlWE9mZnNldCJdOmYuc3VwcG9ydC5ib3hNb2RlbCYmZy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbZF18fGcuZG9jdW1lbnQuYm9keVtkXTplW2RdfXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtnPWN2KHRoaXMpLGc/Zy5zY3JvbGxUbyhhP2YoZykuc2Nyb2xsTGVmdCgpOmMsYT9jOmYoZykuc2Nyb2xsVG9wKCkpOnRoaXNbZF09Y30pfX0pLGYuZWFjaChbIkhlaWdodCIsIldpZHRoIl0sZnVuY3Rpb24oYSxjKXt2YXIgZD1jLnRvTG93ZXJDYXNlKCk7Zi5mblsiaW5uZXIiK2NdPWZ1bmN0aW9uKCl7dmFyIGE9dGhpc1swXTtyZXR1cm4gYSYmYS5zdHlsZT9wYXJzZUZsb2F0KGYuY3NzKGEsZCwicGFkZGluZyIpKTpudWxsfSxmLmZuWyJvdXRlciIrY109ZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXTtyZXR1cm4gYiYmYi5zdHlsZT9wYXJzZUZsb2F0KGYuY3NzKGIsZCxhPyJtYXJnaW4iOiJib3JkZXIiKSk6bnVsbH0sZi5mbltkXT1mdW5jdGlvbihhKXt2YXIgZT10aGlzWzBdO2lmKCFlKXJldHVybiBhPT1udWxsP251bGw6dGhpcztpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXt2YXIgYz1mKHRoaXMpO2NbZF0oYS5jYWxsKHRoaXMsYixjW2RdKCkpKX0pO2lmKGYuaXNXaW5kb3coZSkpe3ZhciBnPWUuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50WyJjbGllbnQiK2NdO3JldHVybiBlLmRvY3VtZW50LmNvbXBhdE1vZGU9PT0iQ1NTMUNvbXBhdCImJmd8fGUuZG9jdW1lbnQuYm9keVsiY2xpZW50IitjXXx8Z31pZihlLm5vZGVUeXBlPT09OSlyZXR1cm4gTWF0aC5tYXgoZS5kb2N1bWVudEVsZW1lbnRbImNsaWVudCIrY10sZS5ib2R5WyJzY3JvbGwiK2NdLGUuZG9jdW1lbnRFbGVtZW50WyJzY3JvbGwiK2NdLGUuYm9keVsib2Zmc2V0IitjXSxlLmRvY3VtZW50RWxlbWVudFsib2Zmc2V0IitjXSk7aWYoYT09PWIpe3ZhciBoPWYuY3NzKGUsZCksaT1wYXJzZUZsb2F0KGgpO3JldHVybiBmLmlzTmFOKGkpP2g6aX1yZXR1cm4gdGhpcy5jc3MoZCx0eXBlb2YgYT09InN0cmluZyI/YTphKyJweCIpfX0pLGEualF1ZXJ5PWEuJD1mfSkod2luZG93KTsKCi8vISBzZXR0aW5ncyByZXF1aXJlZCBmb3IgZGIuZXgta2Fuc28uanMgJiBzZXNzaW9uLmV4LWthbnNvLmpzCnNldHRpbmdzID0gewogICAgbmFtZSA6ICducmFtYScsICAgICAgICAgLy9zaG91bGQgYmUgc2FtZSBhcyAnbmFtZScgaW4ga2Fuc28uanNvbiBpbiB0aGUgcm9vdCBvZiB5b3VyIHByb2plY3QKICAgIGJhc2VVUkwgOiAnL25yYW1hL19kZXNpZ24vbnJhbWEvX3Jld3JpdGUnICAgIC8vdXNlZCB0byBidWlsZCB1cmwgZm9yIHJlcXVlc3RzCn07Ci8qKiEKICogKGMpIENhb2xhbiBNY01haG9uLCBBcGFjaGUgMi4wIGxpY2Vuc2UKICovCmRiPXt9LGZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGQoYSxkKXtyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIGYsZz1lLmdldFJlc3BvbnNlSGVhZGVyKCJDb250ZW50LVR5cGUiKTtpZihnPT09ImFwcGxpY2F0aW9uL2pzb24ifHxnPT09InRleHQvanNvbiIpdHJ5e2Y9YyhlLCJqc29uIil9Y2F0Y2goaCl7cmV0dXJuIGQoaCl9ZWxzZXtpZihhLmV4cGVjdF9qc29uKXJldHVybiBkKG5ldyBFcnJvcigiRXhwZWN0ZWQgSlNPTiByZXNwb25zZSwgZ290ICIrZykpO2Y9ZS5yZXNwb25zZVRleHR9ZS5zdGF0dXM9PT00MDEmJnNlc3Npb24mJmI8KG5ldyBEYXRlKS5nZXRUaW1lKCktMWUzJiZzZXNzaW9uLmluZm8oKTtpZihlLnN0YXR1cz09PTIwMHx8ZS5zdGF0dXM9PT0yMDF8fGUuc3RhdHVzPT09MjAyKWQobnVsbCxmKTtlbHNlIGlmKGYuZXJyb3Ipe3ZhciBpPW5ldyBFcnJvcihmLnJlYXNvbnx8Zi5lcnJvcik7aS5lcnJvcj1mLmVycm9yLGkucmVhc29uPWYucmVhc29uLGkuc3RhdHVzPWUuc3RhdHVzLGQoaSl9ZWxzZSBkKG5ldyBFcnJvcigiUmV0dXJuZWQgc3RhdHVzIGNvZGU6ICIrZS5zdGF0dXMpKX19dXRpbHM9e2lzQnJvd3NlcjpmdW5jdGlvbigpe3JldHVybiEwfSxnZXRCYXNlVVJMOmZ1bmN0aW9uKCl7cmV0dXJuIHNldHRpbmdzLmJhc2VVUkx9fTt2YXIgYj0wO2EuZGVzaWduX2RvY3M9e307dmFyIGM9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWEuZ2V0UmVzcG9uc2VIZWFkZXIoImNvbnRlbnQtdHlwZSIpfHwiIixlPWI9PT0ieG1sInx8IWImJmQuaW5kZXhPZigieG1sIik+PTAsZj1lP2EucmVzcG9uc2VYTUw6YS5yZXNwb25zZVRleHQ7cmV0dXJuIGUmJmYuZG9jdW1lbnRFbGVtZW50Lm5vZGVOYW1lPT09InBhcnNlcmVycm9yIiYmJC5lcnJvcigicGFyc2VyZXJyb3IiKSxjJiZjLmRhdGFGaWx0ZXImJihmPWMuZGF0YUZpbHRlcihmLGIpKSx0eXBlb2YgZj09InN0cmluZyImJihiPT09Impzb24ifHwhYiYmZC5pbmRleE9mKCJqc29uIik+PTA/Zj0kLnBhcnNlSlNPTihmKTooYj09PSJzY3JpcHQifHwhYiYmZC5pbmRleE9mKCJqYXZhc2NyaXB0Iik+PTApJiYkLmdsb2JhbEV2YWwoZikpLGZ9O2EuZW5jb2RlPWZ1bmN0aW9uKGEpe3JldHVybiBlbmNvZGVVUklDb21wb25lbnQoYSkucmVwbGFjZSgvXl9kZXNpZ24lMkYvLCJfZGVzaWduLyIpfSxhLnJlcXVlc3Q9ZnVuY3Rpb24oYSxiKXthLmNvbXBsZXRlPWQoYSxiKSxhLmRhdGFUeXBlPSJqc29uIiwkLmFqYXgoYSl9LGEuZ2V0UmV3cml0ZT1mdW5jdGlvbihiLGMsZCl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXRocm93IG5ldyBFcnJvcigiZ2V0UmV3cml0ZSBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlIik7ZHx8KGQ9YyxjPXt9KSxiPWJbMF09PT0iLyI/YjoiLyIrYjt2YXIgZT11dGlscy5nZXRCYXNlVVJMKCksZj1hLmVuY29kZShzZXR0aW5ncy5uYW1lKSxnPXt1cmw6ZSsiL19kYi9fZGVzaWduLyIrZisiL19yZXdyaXRlIitiLGRhdGE6YS5zdHJpbmdpZnlRdWVyeShjKX07YS5yZXF1ZXN0KGcsZCl9LGEuZ2V0RG9jPWZ1bmN0aW9uKGIsYyxkLGUpe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl0aHJvdyBuZXcgRXJyb3IoImdldERvYyBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlIik7aWYoIWIpdGhyb3cgbmV3IEVycm9yKCJnZXREb2MgcmVxdWlyZXMgYW4gaWQgcGFyYW1ldGVyIHRvIHdvcmsgcHJvcGVybHkiKTtlfHwoZD8oZT1kLGQ9e30pOihlPWMsZD17fSxjPXt9KSk7dmFyIGY7ZC5kYj9mPShkLmRiLnN1YnN0cigwLDEpIT09Ii8iPyIvIjoiIikrZC5kYjpmPXV0aWxzLmdldEJhc2VVUkwoKSsiL19kYiI7dmFyIGc9e3VybDpmKyIvIithLmVuY29kZShiKSxkYXRhOmEuc3RyaW5naWZ5UXVlcnkoYyksZXhwZWN0X2pzb246ITB9O2EucmVxdWVzdChnLGUpfSxhLnNhdmVEb2M9ZnVuY3Rpb24oYixjLGQpe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl0aHJvdyBuZXcgRXJyb3IoInNhdmVEb2MgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZSIpO3ZhciBlLGY7Yy5kYj9mPShjLmRiLnN1YnN0cigwLDEpIT09Ii8iPyIvIjoiIikrYy5kYjpmPXV0aWxzLmdldEJhc2VVUkwoKSsiL19kYiIsZHx8KGQ9YyxjPXt9KSxiLl9pZD09PXVuZGVmaW5lZD9lPSJQT1NUIjooZT0iUFVUIixmKz0iLyIrYS5lbmNvZGUoYi5faWQpKTt2YXIgZz17dHlwZTplLHVybDpmLGRhdGE6SlNPTi5zdHJpbmdpZnkoYikscHJvY2Vzc0RhdGE6ITEsY29udGVudFR5cGU6ImFwcGxpY2F0aW9uL2pzb24iLGV4cGVjdF9qc29uOiEwfTthLnJlcXVlc3QoZyxkKX0sYS5kb1VwZGF0ZT1mdW5jdGlvbihiLGMsZCl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXRocm93IG5ldyBFcnJvcigiZG9VcGRhdGUgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZSIpO3ZhciBlPXV0aWxzLmdldEJhc2VVUkwoKSsiL3VwZGF0ZS8iK2MrIi8iK2EuZW5jb2RlKGIuX2lkKSxmPXt0eXBlOiJQVVQiLHVybDplLGRhdGE6SlNPTi5zdHJpbmdpZnkoYikscHJvY2Vzc0RhdGE6ITEsY29udGVudFR5cGU6ImFwcGxpY2F0aW9uL2pzb24iLGV4cGVjdF9qc29uOiExfTthLnJlcXVlc3QoZixkKX0sYS5yZW1vdmVEb2M9ZnVuY3Rpb24oYixjLGQpe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl0aHJvdyBuZXcgRXJyb3IoInJlbW92ZURvYyBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlIik7aWYoIWIuX2lkKXRocm93IG5ldyBFcnJvcigicmVtb3ZlRG9jIHJlcXVpcmVzIGFuIF9pZCBmaWVsZCBpbiB5b3VyIGRvY3VtZW50Iik7aWYoIWIuX3Jldil0aHJvdyBuZXcgRXJyb3IoInJlbW92ZURvYyByZXF1aXJlcyBhIF9yZXYgZmllbGQgaW4geW91ciBkb2N1bWVudCIpO2R8fChkPWMsYz17fSk7dmFyIGU7Yy5kYj9lPShjLmRiLnN1YnN0cigwLDEpIT09Ii8iPyIvIjoiIikrYy5kYisiLyI6ZT11dGlscy5nZXRCYXNlVVJMKCkrIi9fZGIvIixlKz1hLmVuY29kZShiLl9pZCkrIj9yZXY9IithLmVuY29kZShiLl9yZXYpO3ZhciBmPXt0eXBlOiJERUxFVEUiLHVybDplfTthLnJlcXVlc3QoZixkKX0sYS5nZXRWaWV3PWZ1bmN0aW9uKGIsYyxkLGUpe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl0aHJvdyBuZXcgRXJyb3IoImdldFZpZXcgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZSIpO2V8fChkPyhlPWQsZD17fSk6KGU9YyxkPXt9LGM9e30pKTt2YXIgZjtkLmRiP2Y9KGQuZGIuc3Vic3RyKDAsMSkhPT0iLyI/Ii8iOiIiKStkLmRiOmY9dXRpbHMuZ2V0QmFzZVVSTCgpO3ZhciBnPWEuZW5jb2RlKHNldHRpbmdzLm5hbWUpLGg9YS5lbmNvZGUoYiksaT17dXJsOmYrKGQuZGI/IiI6Ii9fZGIiKSsiL19kZXNpZ24vIisoZC5kYnx8ZykrIi9fdmlldy8iK2gsZGF0YTphLnN0cmluZ2lmeVF1ZXJ5KGMpLGV4cGVjdF9qc29uOiEwfTthLnJlcXVlc3QoaSxlKX0sYS5nZXRMaXN0PWZ1bmN0aW9uKGIsYyxkLGUpe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl0aHJvdyBuZXcgRXJyb3IoImdldExpc3QgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZSIpO2V8fChlPWQsZD17fSk7dmFyIGY9dXRpbHMuZ2V0QmFzZVVSTCgpLGc9YS5lbmNvZGUoc2V0dGluZ3MubmFtZSksaD1hLmVuY29kZShiKSxpPWEuZW5jb2RlKGMpLGo9e3VybDpmKyIvX2RiL19kZXNpZ24vIitnKyIvX2xpc3QvIitoKyIvIitpLGRhdGE6YS5zdHJpbmdpZnlRdWVyeShkKX07YS5yZXF1ZXN0KGosZSl9LGEuZ2V0U2hvdz1mdW5jdGlvbihiLGMsZCxlKXtpZighdXRpbHMuaXNCcm93c2VyKCkpdGhyb3cgbmV3IEVycm9yKCJnZXRTaG93IGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUiKTtlfHwoZT1kLGQ9e30pO3ZhciBmPXV0aWxzLmdldEJhc2VVUkwoKSxnPWEuZW5jb2RlKHNldHRpbmdzLm5hbWUpLGg9YS5lbmNvZGUoYiksaT1mKyIvX2RiL19kZXNpZ24vIitnKyIvX3Nob3cvIitoLGo9e3VybDppKyhjPyIvIithLmVuY29kZShjKToiIiksZGF0YTphLnN0cmluZ2lmeVF1ZXJ5KGQpfTthLnJlcXVlc3QoaixlKX0sYS5hbGw9ZnVuY3Rpb24oYixjKXtpZighdXRpbHMuaXNCcm93c2VyKCkpdGhyb3cgbmV3IEVycm9yKCJhbGwgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZSIpO2N8fChjPWIsYj17fSk7dmFyIGQ9dXRpbHMuZ2V0QmFzZVVSTCgpLGU9e3VybDpkKyIvX2RiL19hbGxfZG9jcyIsZGF0YTphLnN0cmluZ2lmeVF1ZXJ5KGIpLGV4cGVjdF9qc29uOiEwfTthLnJlcXVlc3QoZSxjKX0sYS5zdHJpbmdpZnlRdWVyeT1mdW5jdGlvbihhKXt2YXIgYj17fTtmb3IodmFyIGMgaW4gYSl0eXBlb2YgYVtjXSE9InN0cmluZyI/YltjXT1KU09OLnN0cmluZ2lmeShhW2NdKTpiW2NdPWFbY107cmV0dXJuIGJ9O3ZhciBlPVtdO2EubmV3VVVJRD1mdW5jdGlvbihiLGMpe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl0aHJvdyBuZXcgRXJyb3IoIm5ld1VVSUQgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZSIpO2N8fChjPWIsYj0xKTtpZihlLmxlbmd0aClyZXR1cm4gYyhudWxsLGUuc2hpZnQoKSk7dmFyIGQ9dXRpbHMuZ2V0QmFzZVVSTCgpLGY9e3VybDoiL191dWlkcyIsZGF0YTp7Y291bnQ6Yn0sZXhwZWN0X2pzb246ITB9O2EucmVxdWVzdChmLGZ1bmN0aW9uKGEsYil7aWYoYSlyZXR1cm4gYyhhKTtlPWIudXVpZHMsYyhudWxsLGUuc2hpZnQoKSl9KX0sYS5jcmVhdGVEYXRhYmFzZT1mdW5jdGlvbihiLGMpe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl0aHJvdyBuZXcgRXJyb3IoImNyZWF0ZURhdGFiYXNlIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUiKTt2YXIgZD17dHlwZToiUFVUIix1cmw6Ii8iK2EuZW5jb2RlKGIucmVwbGFjZSgvXlwvKy8sIiIpKX07YS5yZXF1ZXN0KGQsYyl9LGEuZGVsZXRlRGF0YWJhc2U9ZnVuY3Rpb24oYixjKXtpZighdXRpbHMuaXNCcm93c2VyKCkpdGhyb3cgbmV3IEVycm9yKCJkZWxldGVEYXRhYmFzZSBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlIik7dmFyIGQ9e3R5cGU6IkRFTEVURSIsdXJsOiIvIithLmVuY29kZShiLnJlcGxhY2UoL15cLysvLCIiKSl9O2EucmVxdWVzdChkLGMpfSxhLmdldFJlcGxpY2F0aW9uPWZ1bmN0aW9uKGIsYyl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXRocm93IG5ldyBFcnJvcigiZ2V0UmVwbGljYXRpb24gY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZSIpO3ZhciBkPXt1cmw6Ii9fcmVwbGljYXRvci8iK2EuZW5jb2RlKGIpLGNhY2hlOiExfTthLnJlcXVlc3QoZCxjKX0sYS5zdGFydFJlcGxpY2F0aW9uPWZ1bmN0aW9uKGIsYyl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXRocm93IG5ldyBFcnJvcigic3RhcnRSZXBsaWNhdGlvbiBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlIik7aWYoIWIuc291cmNlKXRocm93IG5ldyBFcnJvcigic291cmNlIHBhcmFtZXRlciBtdXN0IGJlIHByb3ZpZGVkIik7aWYoIWIudGFyZ2V0KXRocm93IG5ldyBFcnJvcigidGFyZ2V0IHBhcmFtZXRlciBtdXN0IGJlIHByb3ZpZGVkIik7dmFyIGQ9e3R5cGU6IlBPU1QiLHVybDoiL19yZXBsaWNhdG9yIixkYXRhOkpTT04uc3RyaW5naWZ5KGIpLGNvbnRlbnRUeXBlOiJhcHBsaWNhdGlvbi9qc29uIn07YS5yZXF1ZXN0KGQsYyl9LGEud2FpdFJlcGxpY2F0aW9uPWZ1bmN0aW9uKGIsYyxkLGUpe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl0aHJvdyBuZXcgRXJyb3IoIndhaXRSZXBsaWNhdGlvbiBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlIik7dmFyIGY9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5fcmVwbGljYXRpb25fc3RhdGU9PT0iY29tcGxldGVkInx8YS5fcmVwbGljYXRpb25fc3RhdGU9PT0iZXJyb3IifTtlfHwoZD8oZT1kLGQ9Zik6KGU9YyxjPXt9LGQ9ZikpLGM9PT11bmRlZmluZWQmJihjPXt9KSxjLmxpbWl0PT09dW5kZWZpbmVkJiYoYy5saW1pdD0xMDApLGMuZGVsYXk9PT11bmRlZmluZWQmJihjLmRlbGF5PTJlMyksYS5nZXRSZXBsaWNhdGlvbihiLmlkLGZ1bmN0aW9uKGYsZyl7aWYoZnx8ZChnLGIpKXJldHVybiBlKGYsZyxiKTtpZihjLmxpbWl0PjApcmV0dXJuIGMubGltaXQtPTEsc2V0VGltZW91dChmdW5jdGlvbigpe3JldHVybiBhLndhaXRSZXBsaWNhdGlvbihiLGMsZCxlKX0sYy5kZWxheSl9KX0sYS5zdG9wUmVwbGljYXRpb249ZnVuY3Rpb24oYixjLGQpe2lmKCF1dGlscy5pc0Jyb3dzZXIoKSl0aHJvdyBuZXcgRXJyb3IoInN0b3BSZXBsaWNhdGlvbiBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlIik7ZD09PXVuZGVmaW5lZCYmKGQ9e30pO2lmKGQubGltaXQ9PT11bmRlZmluZWR8fGQubGltaXQ9PT1udWxsKWQubGltaXQ9MztpZihkLmRlbGF5PT09dW5kZWZpbmVkfHxkLmRlbGF5PT09bnVsbClkLmRlbGF5PTUwMDt2YXIgZT17dHlwZToiREVMRVRFIix1cmw6Ii9fcmVwbGljYXRvci8iK2EuZW5jb2RlKGIuX2lkKSsiP3Jldj0iK2EuZW5jb2RlKGIuX3Jldil9O2EucmVxdWVzdChlLGZ1bmN0aW9uKGUsZil7cmV0dXJuIWV8fGUuc3RhdHVzIT09NDA5P2MoZSxmKTpkLmxpbWl0PjA/KGQubGltaXQtPTEsYS5nZXRSZXBsaWNhdGlvbihiLl9pZCxmdW5jdGlvbihiLGUpe2lmKGIpdGhyb3cgbmV3IEVycm9yKCJUaGUgc3BlY2lmaWVkIHJlcGxpY2F0aW9uIGRvY3VtZW50IGNoYW5nZWQgc2luY2UgbGFzdCByZWFkLCBhbmQgd2UgZmFpbGVkIHRvIHJlLXJlcXVlc3QgaXQiKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7cmV0dXJuIGEuc3RvcFJlcGxpY2F0aW9uKGUsYyxkKX0sZC5kZWxheSl9KSk6ITF9KX0sYS5kZWxldGVVc2VyPWZ1bmN0aW9uKGIsYyl7dmFyIGQ9Im9yZy5jb3VjaGRiLnVzZXI6IitiO2EudXNlckRiKGZ1bmN0aW9uKGIsZSl7aWYoYilyZXR1cm4gYyhiKTt2YXIgZj17dHlwZToiREVMRVRFIix1cmw6Ii8iK2EuZW5jb2RlKGUpKyIvIithLmVuY29kZShkKSxjb250ZW50VHlwZToiYXBwbGljYXRpb24vanNvbiJ9O2EucmVxdWVzdChmLGMpfSl9LGEuZ2V0RGVzaWduRG9jPWZ1bmN0aW9uKGIsYyxkKXtpZighZCYmYS5kZXNpZ25fZG9jc1tiXSlyZXR1cm4gYyhudWxsLGEuZGVzaWduX2RvY3NbYl0pO2EuZ2V0RG9jKCJfZGVzaWduLyIrYix7fSxmdW5jdGlvbihkLGUpe3JldHVybiBkP2MoZCk6KGEuZGVzaWduX2RvY3NbYl09ZSxjKG51bGwsYS5kZXNpZ25fZG9jc1tiXSkpfSl9fShkYikKLyoqIQogKiAoYykgQ2FvbGFuIE1jTWFob24sIEFwYWNoZSAyLjAgbGljZW5zZQogKi8Kc2Vzc2lvbj17fSxmdW5jdGlvbihhKXt1dGlscz17aXNCcm93c2VyOmZ1bmN0aW9uKCl7cmV0dXJuITB9LGdldEJhc2VVUkw6ZnVuY3Rpb24oKXtyZXR1cm4gc2V0dGluZ3MuYmFzZVVSTH19LGEuc2Vzc2lvbkNoYW5nZT1mdW5jdGlvbihhLGIpe2ImJmIoKX0sYS5sb2dvdXQ9ZnVuY3Rpb24oYil7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXRocm93IG5ldyBFcnJvcigibG9nb3V0IGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUiKTtkYi5yZXF1ZXN0KHt0eXBlOiJERUxFVEUiLHVybDoiL19zZXNzaW9uIix1c2VybmFtZToiXyIscGFzc3dvcmQ6Il8ifSxmdW5jdGlvbihjLGQpe2QmJmQub2smJih1dGlscy51c2VyQ3R4PXtuYW1lOm51bGwscm9sZXM6W119LHV0aWxzLnNlc3Npb249e3VzZXJDdHg6dXRpbHMudXNlckN0eH0sYS5zZXNzaW9uQ2hhbmdlKHV0aWxzLnVzZXJDdHgpKSxiJiZiKGMsZCl9KX0sYS5sb2dpbj1mdW5jdGlvbihiLGMsZCl7aWYoIXV0aWxzLmlzQnJvd3NlcigpKXRocm93IG5ldyBFcnJvcigibG9naW4gY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZSIpO2RiLnJlcXVlc3Qoe3R5cGU6IlBPU1QiLHVybDoiL19zZXNzaW9uIixkYXRhOntuYW1lOmIscGFzc3dvcmQ6Y319LGZ1bmN0aW9uKGMsZSl7ZSYmZS5vayYmKHV0aWxzLnVzZXJDdHg9e25hbWU6Yixyb2xlczplLnJvbGVzfSx1dGlscy5zZXNzaW9uPXt1c2VyQ3R4OnV0aWxzLnVzZXJDdHh9LGEuc2Vzc2lvbkNoYW5nZSh1dGlscy51c2VyQ3R4KSksZCYmZChjLGUpfSl9LGEuaW5mbz1mdW5jdGlvbihiKXtpZighdXRpbHMuaXNCcm93c2VyKCkpdGhyb3cgbmV3IEVycm9yKCJpbmZvIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUiKTtkYi5yZXF1ZXN0KHt0eXBlOiJHRVQiLHVybDoiL19zZXNzaW9uIn0sZnVuY3Rpb24oYyxkKXt2YXIgZT11dGlscy51c2VyQ3R4O3V0aWxzLnNlc3Npb249ZCx1dGlscy51c2VyQ3R4PWQmJmQudXNlckN0eHx8e25hbWU6bnVsbCxyb2xlczpbXX0sKCFlfHxlLm5hbWUhPT11dGlscy51c2VyQ3R4Lm5hbWUpJiZhLnNlc3Npb25DaGFuZ2UodXRpbHMudXNlckN0eCksYiYmYihjLGQpfSl9fShzZXNzaW9uKQoKLyoqCiAqIGVhc3lYRE0KICogaHR0cDovL2Vhc3l4ZG0ubmV0LwogKiBDb3B5cmlnaHQoYykgMjAwOS0yMDExLCDDmHl2aW5kIFNlYW4gS2luc2V5LCBveXZpbmRAa2luc2V5Lm5vLgogKgogKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5CiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKICogdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKICoKICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KICogYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAogKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgogKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLAogKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOCiAqIFRIRSBTT0ZUV0FSRS4KICovCihmdW5jdGlvbihOLGQscCxLLGssSCl7dmFyIGI9dGhpczt2YXIgbj1NYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMTAwMDApO3ZhciBxPUZ1bmN0aW9uLnByb3RvdHlwZTt2YXIgUT0vXigoaHR0cC4/OilcL1wvKFteOlwvXHNdKykoOlxkKykqKS87dmFyIFI9L1tcLVx3XStcL1wuXC5cLy87dmFyIEY9LyhbXjpdKVwvXC8vZzt2YXIgST0iIjt2YXIgbz17fTt2YXIgTT1OLmVhc3lYRE07dmFyIFU9ImVhc3lYRE1fIjt2YXIgRTt2YXIgeT1mYWxzZTt2YXIgaTt2YXIgaDtmdW5jdGlvbiBDKFgsWil7dmFyIFk9dHlwZW9mIFhbWl07cmV0dXJuIFk9PSJmdW5jdGlvbiJ8fCghIShZPT0ib2JqZWN0IiYmWFtaXSkpfHxZPT0idW5rbm93biJ9ZnVuY3Rpb24gdShYLFkpe3JldHVybiAhISh0eXBlb2YoWFtZXSk9PSJvYmplY3QiJiZYW1ldKX1mdW5jdGlvbiByKFgpe3JldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoWCk9PT0iW29iamVjdCBBcnJheV0ifWZ1bmN0aW9uIGMoKXt0cnl7dmFyIFg9bmV3IEFjdGl2ZVhPYmplY3QoIlNob2Nrd2F2ZUZsYXNoLlNob2Nrd2F2ZUZsYXNoIik7aT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChYLkdldFZhcmlhYmxlKCIkdmVyc2lvbiIpLm1hdGNoKC8oXGQrKSwoXGQrKSwoXGQrKSwoXGQrKS8pLDEpO2g9cGFyc2VJbnQoaVswXSwxMCk+OSYmcGFyc2VJbnQoaVsxXSwxMCk+MDtYPW51bGw7cmV0dXJuIHRydWV9Y2F0Y2goWSl7cmV0dXJuIGZhbHNlfX12YXIgdix4O2lmKEMoTiwiYWRkRXZlbnRMaXN0ZW5lciIpKXt2PWZ1bmN0aW9uKFosWCxZKXtaLmFkZEV2ZW50TGlzdGVuZXIoWCxZLGZhbHNlKX07eD1mdW5jdGlvbihaLFgsWSl7Wi5yZW1vdmVFdmVudExpc3RlbmVyKFgsWSxmYWxzZSl9fWVsc2V7aWYoQyhOLCJhdHRhY2hFdmVudCIpKXt2PWZ1bmN0aW9uKFgsWixZKXtYLmF0dGFjaEV2ZW50KCJvbiIrWixZKX07eD1mdW5jdGlvbihYLFosWSl7WC5kZXRhY2hFdmVudCgib24iK1osWSl9fWVsc2V7dGhyb3cgbmV3IEVycm9yKCJCcm93c2VyIG5vdCBzdXBwb3J0ZWQiKX19dmFyIFc9ZmFsc2UsSj1bXSxMO2lmKCJyZWFkeVN0YXRlIiBpbiBkKXtMPWQucmVhZHlTdGF0ZTtXPUw9PSJjb21wbGV0ZSJ8fCh+bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJBcHBsZVdlYktpdC8iKSYmKEw9PSJsb2FkZWQifHxMPT0iaW50ZXJhY3RpdmUiKSl9ZWxzZXtXPSEhZC5ib2R5fWZ1bmN0aW9uIHMoKXtpZihXKXtyZXR1cm59Vz10cnVlO2Zvcih2YXIgWD0wO1g8Si5sZW5ndGg7WCsrKXtKW1hdKCl9Si5sZW5ndGg9MH1pZighVyl7aWYoQyhOLCJhZGRFdmVudExpc3RlbmVyIikpe3YoZCwiRE9NQ29udGVudExvYWRlZCIscyl9ZWxzZXt2KGQsInJlYWR5c3RhdGVjaGFuZ2UiLGZ1bmN0aW9uKCl7aWYoZC5yZWFkeVN0YXRlPT0iY29tcGxldGUiKXtzKCl9fSk7aWYoZC5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwmJk49PT10b3Ape3ZhciBnPWZ1bmN0aW9uKCl7aWYoVyl7cmV0dXJufXRyeXtkLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCgibGVmdCIpfWNhdGNoKFgpe0soZywxKTtyZXR1cm59cygpfTtnKCl9fXYoTiwibG9hZCIscyl9ZnVuY3Rpb24gRyhZLFgpe2lmKFcpe1kuY2FsbChYKTtyZXR1cm59Si5wdXNoKGZ1bmN0aW9uKCl7WS5jYWxsKFgpfSl9ZnVuY3Rpb24gbSgpe3ZhciBaPXBhcmVudDtpZihJIT09IiIpe2Zvcih2YXIgWD0wLFk9SS5zcGxpdCgiLiIpO1g8WS5sZW5ndGg7WCsrKXtaPVpbWVtYXV19fXJldHVybiBaLmVhc3lYRE19ZnVuY3Rpb24gZShYKXtOLmVhc3lYRE09TTtJPVg7aWYoSSl7VT0iZWFzeVhETV8iK0kucmVwbGFjZSgiLiIsIl8iKSsiXyJ9cmV0dXJuIG99ZnVuY3Rpb24geihYKXtyZXR1cm4gWC5tYXRjaChRKVszXX1mdW5jdGlvbiBmKFgpe3JldHVybiBYLm1hdGNoKFEpWzRdfHwiIn1mdW5jdGlvbiBqKFope3ZhciBYPVoudG9Mb3dlckNhc2UoKS5tYXRjaChRKTt2YXIgYWE9WFsyXSxhYj1YWzNdLFk9WFs0XXx8IiI7aWYoKGFhPT0iaHR0cDoiJiZZPT0iOjgwIil8fChhYT09Imh0dHBzOiImJlk9PSI6NDQzIikpe1k9IiJ9cmV0dXJuIGFhKyIvLyIrYWIrWX1mdW5jdGlvbiBCKFgpe1g9WC5yZXBsYWNlKEYsIiQxLyIpO2lmKCFYLm1hdGNoKC9eKGh0dHB8fGh0dHBzKTpcL1wvLykpe3ZhciBZPShYLnN1YnN0cmluZygwLDEpPT09Ii8iKT8iIjpwLnBhdGhuYW1lO2lmKFkuc3Vic3RyaW5nKFkubGVuZ3RoLTEpIT09Ii8iKXtZPVkuc3Vic3RyaW5nKDAsWS5sYXN0SW5kZXhPZigiLyIpKzEpfVg9cC5wcm90b2NvbCsiLy8iK3AuaG9zdCtZK1h9d2hpbGUoUi50ZXN0KFgpKXtYPVgucmVwbGFjZShSLCIiKX1yZXR1cm4gWH1mdW5jdGlvbiBQKFgsYWEpe3ZhciBhYz0iIixaPVguaW5kZXhPZigiIyIpO2lmKFohPT0tMSl7YWM9WC5zdWJzdHJpbmcoWik7WD1YLnN1YnN0cmluZygwLFopfXZhciBhYj1bXTtmb3IodmFyIFkgaW4gYWEpe2lmKGFhLmhhc093blByb3BlcnR5KFkpKXthYi5wdXNoKFkrIj0iK0goYWFbWV0pKX19cmV0dXJuIFgrKHk/IiMiOihYLmluZGV4T2YoIj8iKT09LTE/Ij8iOiImIikpK2FiLmpvaW4oIiYiKSthY312YXIgUz0oZnVuY3Rpb24oWCl7WD1YLnN1YnN0cmluZygxKS5zcGxpdCgiJiIpO3ZhciBaPXt9LGFhLFk9WC5sZW5ndGg7d2hpbGUoWS0tKXthYT1YW1ldLnNwbGl0KCI9Iik7WlthYVswXV09ayhhYVsxXSl9cmV0dXJuIFp9KC94ZG1fZT0vLnRlc3QocC5zZWFyY2gpP3Auc2VhcmNoOnAuaGFzaCkpO2Z1bmN0aW9uIHQoWCl7cmV0dXJuIHR5cGVvZiBYPT09InVuZGVmaW5lZCJ9dmFyIE89ZnVuY3Rpb24oKXt2YXIgWT17fTt2YXIgWj17YTpbMSwyLDNdfSxYPSd7ImEiOlsxLDIsM119JztpZih0eXBlb2YgSlNPTiE9InVuZGVmaW5lZCImJnR5cGVvZiBKU09OLnN0cmluZ2lmeT09PSJmdW5jdGlvbiImJkpTT04uc3RyaW5naWZ5KFopLnJlcGxhY2UoKC9ccy9nKSwiIik9PT1YKXtyZXR1cm4gSlNPTn1pZihPYmplY3QudG9KU09OKXtpZihPYmplY3QudG9KU09OKFopLnJlcGxhY2UoKC9ccy9nKSwiIik9PT1YKXtZLnN0cmluZ2lmeT1PYmplY3QudG9KU09OfX1pZih0eXBlb2YgU3RyaW5nLnByb3RvdHlwZS5ldmFsSlNPTj09PSJmdW5jdGlvbiIpe1o9WC5ldmFsSlNPTigpO2lmKFouYSYmWi5hLmxlbmd0aD09PTMmJlouYVsyXT09PTMpe1kucGFyc2U9ZnVuY3Rpb24oYWEpe3JldHVybiBhYS5ldmFsSlNPTigpfX19aWYoWS5zdHJpbmdpZnkmJlkucGFyc2Upe089ZnVuY3Rpb24oKXtyZXR1cm4gWX07cmV0dXJuIFl9cmV0dXJuIG51bGx9O2Z1bmN0aW9uIFQoWCxZLFope3ZhciBhYjtmb3IodmFyIGFhIGluIFkpe2lmKFkuaGFzT3duUHJvcGVydHkoYWEpKXtpZihhYSBpbiBYKXthYj1ZW2FhXTtpZih0eXBlb2YgYWI9PT0ib2JqZWN0Iil7VChYW2FhXSxhYixaKX1lbHNle2lmKCFaKXtYW2FhXT1ZW2FhXX19fWVsc2V7WFthYV09WVthYV19fX1yZXR1cm4gWH1mdW5jdGlvbiBhKCl7dmFyIFk9ZC5ib2R5LmFwcGVuZENoaWxkKGQuY3JlYXRlRWxlbWVudCgiZm9ybSIpKSxYPVkuYXBwZW5kQ2hpbGQoZC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpKTtYLm5hbWU9VSsiVEVTVCIrbjtFPVghPT1ZLmVsZW1lbnRzW1gubmFtZV07ZC5ib2R5LnJlbW92ZUNoaWxkKFkpfWZ1bmN0aW9uIEEoWCl7aWYodChFKSl7YSgpfXZhciBaO2lmKEUpe1o9ZC5jcmVhdGVFbGVtZW50KCc8aWZyYW1lIG5hbWU9IicrWC5wcm9wcy5uYW1lKyciLz4nKX1lbHNle1o9ZC5jcmVhdGVFbGVtZW50KCJJRlJBTUUiKTtaLm5hbWU9WC5wcm9wcy5uYW1lfVouaWQ9Wi5uYW1lPVgucHJvcHMubmFtZTtkZWxldGUgWC5wcm9wcy5uYW1lO2lmKFgub25Mb2FkKXt2KFosImxvYWQiLFgub25Mb2FkKX1pZih0eXBlb2YgWC5jb250YWluZXI9PSJzdHJpbmciKXtYLmNvbnRhaW5lcj1kLmdldEVsZW1lbnRCeUlkKFguY29udGFpbmVyKX1pZighWC5jb250YWluZXIpe1QoWi5zdHlsZSx7cG9zaXRpb246ImFic29sdXRlIix0b3A6Ii0yMDAwcHgifSk7WC5jb250YWluZXI9ZC5ib2R5fXZhciBZPVgucHJvcHMuc3JjO2RlbGV0ZSBYLnByb3BzLnNyYztUKFosWC5wcm9wcyk7Wi5ib3JkZXI9Wi5mcmFtZUJvcmRlcj0wO1ouYWxsb3dUcmFuc3BhcmVuY3k9dHJ1ZTtYLmNvbnRhaW5lci5hcHBlbmRDaGlsZChaKTtaLnNyYz1ZO1gucHJvcHMuc3JjPVk7cmV0dXJuIFp9ZnVuY3Rpb24gVihhYSxaKXtpZih0eXBlb2YgYWE9PSJzdHJpbmciKXthYT1bYWFdfXZhciBZLFg9YWEubGVuZ3RoO3doaWxlKFgtLSl7WT1hYVtYXTtZPW5ldyBSZWdFeHAoWS5zdWJzdHIoMCwxKT09Il4iP1k6KCJeIitZLnJlcGxhY2UoLyhcKikvZywiLiQxIikucmVwbGFjZSgvXD8vZywiLiIpKyIkIikpO2lmKFkudGVzdChaKSl7cmV0dXJuIHRydWV9fXJldHVybiBmYWxzZX1mdW5jdGlvbiBsKFope3ZhciBhZT1aLnByb3RvY29sLFk7Wi5pc0hvc3Q9Wi5pc0hvc3R8fHQoUy54ZG1fcCk7eT1aLmhhc2h8fGZhbHNlO2lmKCFaLnByb3BzKXtaLnByb3BzPXt9fWlmKCFaLmlzSG9zdCl7Wi5jaGFubmVsPVMueGRtX2M7Wi5zZWNyZXQ9Uy54ZG1fcztaLnJlbW90ZT1TLnhkbV9lO2FlPVMueGRtX3A7aWYoWi5hY2wmJiFWKFouYWNsLFoucmVtb3RlKSl7dGhyb3cgbmV3IEVycm9yKCJBY2Nlc3MgZGVuaWVkIGZvciAiK1oucmVtb3RlKX19ZWxzZXtaLnJlbW90ZT1CKFoucmVtb3RlKTtaLmNoYW5uZWw9Wi5jaGFubmVsfHwiZGVmYXVsdCIrbisrO1ouc2VjcmV0PU1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygyKTtpZih0KGFlKSl7aWYoaihwLmhyZWYpPT1qKFoucmVtb3RlKSl7YWU9IjQifWVsc2V7aWYoQyhOLCJwb3N0TWVzc2FnZSIpfHxDKGQsInBvc3RNZXNzYWdlIikpe2FlPSIxIn1lbHNle2lmKFouc3dmJiZDKE4sIkFjdGl2ZVhPYmplY3QiKSYmYygpKXthZT0iNiJ9ZWxzZXtpZihuYXZpZ2F0b3IucHJvZHVjdD09PSJHZWNrbyImJiJmcmFtZUVsZW1lbnQiIGluIE4mJm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiV2ViS2l0Iik9PS0xKXthZT0iNSJ9ZWxzZXtpZihaLnJlbW90ZUhlbHBlcil7Wi5yZW1vdGVIZWxwZXI9QihaLnJlbW90ZUhlbHBlcik7YWU9IjIifWVsc2V7YWU9IjAifX19fX19fVoucHJvdG9jb2w9YWU7c3dpdGNoKGFlKXtjYXNlIjAiOlQoWix7aW50ZXJ2YWw6MTAwLGRlbGF5OjIwMDAsdXNlUmVzaXplOnRydWUsdXNlUGFyZW50OmZhbHNlLHVzZVBvbGxpbmc6ZmFsc2V9LHRydWUpO2lmKFouaXNIb3N0KXtpZighWi5sb2NhbCl7dmFyIGFjPXAucHJvdG9jb2wrIi8vIitwLmhvc3QsWD1kLmJvZHkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImltZyIpLGFkO3ZhciBhYT1YLmxlbmd0aDt3aGlsZShhYS0tKXthZD1YW2FhXTtpZihhZC5zcmMuc3Vic3RyaW5nKDAsYWMubGVuZ3RoKT09PWFjKXtaLmxvY2FsPWFkLnNyYzticmVha319aWYoIVoubG9jYWwpe1oubG9jYWw9Tn19dmFyIGFiPXt4ZG1fYzpaLmNoYW5uZWwseGRtX3A6MH07aWYoWi5sb2NhbD09PU4pe1oudXNlUG9sbGluZz10cnVlO1oudXNlUGFyZW50PXRydWU7Wi5sb2NhbD1wLnByb3RvY29sKyIvLyIrcC5ob3N0K3AucGF0aG5hbWUrcC5zZWFyY2g7YWIueGRtX2U9Wi5sb2NhbDthYi54ZG1fcGE9MX1lbHNle2FiLnhkbV9lPUIoWi5sb2NhbCl9aWYoWi5jb250YWluZXIpe1oudXNlUmVzaXplPWZhbHNlO2FiLnhkbV9wbz0xfVoucmVtb3RlPVAoWi5yZW1vdGUsYWIpfWVsc2V7VChaLHtjaGFubmVsOlMueGRtX2MscmVtb3RlOlMueGRtX2UsdXNlUGFyZW50OiF0KFMueGRtX3BhKSx1c2VQb2xsaW5nOiF0KFMueGRtX3BvKSx1c2VSZXNpemU6Wi51c2VQYXJlbnQ/ZmFsc2U6Wi51c2VSZXNpemV9KX1ZPVtuZXcgby5zdGFjay5IYXNoVHJhbnNwb3J0KFopLG5ldyBvLnN0YWNrLlJlbGlhYmxlQmVoYXZpb3Ioe30pLG5ldyBvLnN0YWNrLlF1ZXVlQmVoYXZpb3Ioe2VuY29kZTp0cnVlLG1heExlbmd0aDo0MDAwLVoucmVtb3RlLmxlbmd0aH0pLG5ldyBvLnN0YWNrLlZlcmlmeUJlaGF2aW9yKHtpbml0aWF0ZTpaLmlzSG9zdH0pXTticmVhaztjYXNlIjEiOlk9W25ldyBvLnN0YWNrLlBvc3RNZXNzYWdlVHJhbnNwb3J0KFopXTticmVhaztjYXNlIjIiOlk9W25ldyBvLnN0YWNrLk5hbWVUcmFuc3BvcnQoWiksbmV3IG8uc3RhY2suUXVldWVCZWhhdmlvcigpLG5ldyBvLnN0YWNrLlZlcmlmeUJlaGF2aW9yKHtpbml0aWF0ZTpaLmlzSG9zdH0pXTticmVhaztjYXNlIjMiOlk9W25ldyBvLnN0YWNrLk5peFRyYW5zcG9ydChaKV07YnJlYWs7Y2FzZSI0IjpZPVtuZXcgby5zdGFjay5TYW1lT3JpZ2luVHJhbnNwb3J0KFopXTticmVhaztjYXNlIjUiOlk9W25ldyBvLnN0YWNrLkZyYW1lRWxlbWVudFRyYW5zcG9ydChaKV07YnJlYWs7Y2FzZSI2IjppZighaSl7YygpfVk9W25ldyBvLnN0YWNrLkZsYXNoVHJhbnNwb3J0KFopXTticmVha31ZLnB1c2gobmV3IG8uc3RhY2suUXVldWVCZWhhdmlvcih7bGF6eTpaLmxhenkscmVtb3ZlOnRydWV9KSk7cmV0dXJuIFl9ZnVuY3Rpb24gRChhYSl7dmFyIGFiLFo9e2luY29taW5nOmZ1bmN0aW9uKGFkLGFjKXt0aGlzLnVwLmluY29taW5nKGFkLGFjKX0sb3V0Z29pbmc6ZnVuY3Rpb24oYWMsYWQpe3RoaXMuZG93bi5vdXRnb2luZyhhYyxhZCl9LGNhbGxiYWNrOmZ1bmN0aW9uKGFjKXt0aGlzLnVwLmNhbGxiYWNrKGFjKX0saW5pdDpmdW5jdGlvbigpe3RoaXMuZG93bi5pbml0KCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmRvd24uZGVzdHJveSgpfX07Zm9yKHZhciBZPTAsWD1hYS5sZW5ndGg7WTxYO1krKyl7YWI9YWFbWV07VChhYixaLHRydWUpO2lmKFkhPT0wKXthYi5kb3duPWFhW1ktMV19aWYoWSE9PVgtMSl7YWIudXA9YWFbWSsxXX19cmV0dXJuIGFifWZ1bmN0aW9uIHcoWCl7WC51cC5kb3duPVguZG93bjtYLmRvd24udXA9WC51cDtYLnVwPVguZG93bj1udWxsfVQobyx7dmVyc2lvbjoiMi40LjE1LjExOCIscXVlcnk6UyxzdGFjazp7fSxhcHBseTpULGdldEpTT05PYmplY3Q6Tyx3aGVuUmVhZHk6Ryxub0NvbmZsaWN0OmV9KTtvLkRvbUhlbHBlcj17b246dix1bjp4LHJlcXVpcmVzSlNPTjpmdW5jdGlvbihYKXtpZighdShOLCJKU09OIikpe2Qud3JpdGUoJzxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9IicrWCsnIj48XC9zY3JpcHQ+Jyl9fX07KGZ1bmN0aW9uKCl7dmFyIFg9e307by5Gbj17c2V0OmZ1bmN0aW9uKFksWil7WFtZXT1afSxnZXQ6ZnVuY3Rpb24oWixZKXt2YXIgYWE9WFtaXTtpZihZKXtkZWxldGUgWFtaXX1yZXR1cm4gYWF9fX0oKSk7by5Tb2NrZXQ9ZnVuY3Rpb24oWSl7dmFyIFg9RChsKFkpLmNvbmNhdChbe2luY29taW5nOmZ1bmN0aW9uKGFiLGFhKXtZLm9uTWVzc2FnZShhYixhYSl9LGNhbGxiYWNrOmZ1bmN0aW9uKGFhKXtpZihZLm9uUmVhZHkpe1kub25SZWFkeShhYSl9fX1dKSksWj1qKFkucmVtb3RlKTt0aGlzLm9yaWdpbj1qKFkucmVtb3RlKTt0aGlzLmRlc3Ryb3k9ZnVuY3Rpb24oKXtYLmRlc3Ryb3koKX07dGhpcy5wb3N0TWVzc2FnZT1mdW5jdGlvbihhYSl7WC5vdXRnb2luZyhhYSxaKX07WC5pbml0KCl9O28uUnBjPWZ1bmN0aW9uKFosWSl7aWYoWS5sb2NhbCl7Zm9yKHZhciBhYiBpbiBZLmxvY2FsKXtpZihZLmxvY2FsLmhhc093blByb3BlcnR5KGFiKSl7dmFyIGFhPVkubG9jYWxbYWJdO2lmKHR5cGVvZiBhYT09PSJmdW5jdGlvbiIpe1kubG9jYWxbYWJdPXttZXRob2Q6YWF9fX19fXZhciBYPUQobChaKS5jb25jYXQoW25ldyBvLnN0YWNrLlJwY0JlaGF2aW9yKHRoaXMsWSkse2NhbGxiYWNrOmZ1bmN0aW9uKGFjKXtpZihaLm9uUmVhZHkpe1oub25SZWFkeShhYyl9fX1dKSk7dGhpcy5vcmlnaW49aihaLnJlbW90ZSk7dGhpcy5kZXN0cm95PWZ1bmN0aW9uKCl7WC5kZXN0cm95KCl9O1guaW5pdCgpfTtvLnN0YWNrLlNhbWVPcmlnaW5UcmFuc3BvcnQ9ZnVuY3Rpb24oWSl7dmFyIFosYWIsYWEsWDtyZXR1cm4oWj17b3V0Z29pbmc6ZnVuY3Rpb24oYWQsYWUsYWMpe2FhKGFkKTtpZihhYyl7YWMoKX19LGRlc3Ryb3k6ZnVuY3Rpb24oKXtpZihhYil7YWIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhYik7YWI9bnVsbH19LG9uRE9NUmVhZHk6ZnVuY3Rpb24oKXtYPWooWS5yZW1vdGUpO2lmKFkuaXNIb3N0KXtUKFkucHJvcHMse3NyYzpQKFkucmVtb3RlLHt4ZG1fZTpwLnByb3RvY29sKyIvLyIrcC5ob3N0K3AucGF0aG5hbWUseGRtX2M6WS5jaGFubmVsLHhkbV9wOjR9KSxuYW1lOlUrWS5jaGFubmVsKyJfcHJvdmlkZXIifSk7YWI9QShZKTtvLkZuLnNldChZLmNoYW5uZWwsZnVuY3Rpb24oYWMpe2FhPWFjO0soZnVuY3Rpb24oKXtaLnVwLmNhbGxiYWNrKHRydWUpfSwwKTtyZXR1cm4gZnVuY3Rpb24oYWQpe1oudXAuaW5jb21pbmcoYWQsWCl9fSl9ZWxzZXthYT1tKCkuRm4uZ2V0KFkuY2hhbm5lbCx0cnVlKShmdW5jdGlvbihhYyl7Wi51cC5pbmNvbWluZyhhYyxYKX0pO0soZnVuY3Rpb24oKXtaLnVwLmNhbGxiYWNrKHRydWUpfSwwKX19LGluaXQ6ZnVuY3Rpb24oKXtHKFoub25ET01SZWFkeSxaKX19KX07by5zdGFjay5GbGFzaFRyYW5zcG9ydD1mdW5jdGlvbihhYSl7dmFyIGFjLFgsYWIsYWQsWSxhZTtmdW5jdGlvbiBhZihhaCxhZyl7SyhmdW5jdGlvbigpe2FjLnVwLmluY29taW5nKGFoLGFkKX0sMCl9ZnVuY3Rpb24gWihhaCl7dmFyIGFnPWFhLnN3ZisiP2hvc3Q9IithYS5pc0hvc3Q7dmFyIGFqPSJlYXN5WERNX3N3Zl8iK01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoxMDAwMCk7by5Gbi5zZXQoImZsYXNoX2xvYWRlZCIrYWgucmVwbGFjZSgvW1wtLl0vZywiXyIpLGZ1bmN0aW9uKCl7by5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF0uc3dmPVk9YWUuZmlyc3RDaGlsZDt2YXIgYWs9by5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF0ucXVldWU7Zm9yKHZhciBhbD0wO2FsPGFrLmxlbmd0aDthbCsrKXtha1thbF0oKX1hay5sZW5ndGg9MH0pO2lmKGFhLnN3ZkNvbnRhaW5lcil7YWU9KHR5cGVvZiBhYS5zd2ZDb250YWluZXI9PSJzdHJpbmciKT9kLmdldEVsZW1lbnRCeUlkKGFhLnN3ZkNvbnRhaW5lcik6YWEuc3dmQ29udGFpbmVyfWVsc2V7YWU9ZC5jcmVhdGVFbGVtZW50KCJkaXYiKTtUKGFlLnN0eWxlLGgmJmFhLnN3Zk5vVGhyb3R0bGU/e2hlaWdodDoiMjBweCIsd2lkdGg6IjIwcHgiLHBvc2l0aW9uOiJmaXhlZCIscmlnaHQ6MCx0b3A6MH06e2hlaWdodDoiMXB4Iix3aWR0aDoiMXB4Iixwb3NpdGlvbjoiYWJzb2x1dGUiLG92ZXJmbG93OiJoaWRkZW4iLHJpZ2h0OjAsdG9wOjB9KTtkLmJvZHkuYXBwZW5kQ2hpbGQoYWUpfXZhciBhaT0iY2FsbGJhY2s9Zmxhc2hfbG9hZGVkIithaC5yZXBsYWNlKC9bXC0uXS9nLCJfIikrIiZwcm90bz0iK2IubG9jYXRpb24ucHJvdG9jb2wrIiZkb21haW49Iit6KGIubG9jYXRpb24uaHJlZikrIiZwb3J0PSIrZihiLmxvY2F0aW9uLmhyZWYpKyImbnM9IitJO2FlLmlubmVySFRNTD0iPG9iamVjdCBoZWlnaHQ9JzIwJyB3aWR0aD0nMjAnIHR5cGU9J2FwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoJyBpZD0nIithaisiJyBkYXRhPSciK2FnKyInPjxwYXJhbSBuYW1lPSdhbGxvd1NjcmlwdEFjY2VzcycgdmFsdWU9J2Fsd2F5cyc+PC9wYXJhbT48cGFyYW0gbmFtZT0nd21vZGUnIHZhbHVlPSd0cmFuc3BhcmVudCc+PHBhcmFtIG5hbWU9J21vdmllJyB2YWx1ZT0nIithZysiJz48L3BhcmFtPjxwYXJhbSBuYW1lPSdmbGFzaHZhcnMnIHZhbHVlPSciK2FpKyInPjwvcGFyYW0+PGVtYmVkIHR5cGU9J2FwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoJyBGbGFzaFZhcnM9JyIrYWkrIicgYWxsb3dTY3JpcHRBY2Nlc3M9J2Fsd2F5cycgd21vZGU9J3RyYW5zcGFyZW50JyBzcmM9JyIrYWcrIicgaGVpZ2h0PScxJyB3aWR0aD0nMSc+PC9lbWJlZD48L29iamVjdD4ifXJldHVybihhYz17b3V0Z29pbmc6ZnVuY3Rpb24oYWgsYWksYWcpe1kucG9zdE1lc3NhZ2UoYWEuY2hhbm5lbCxhaC50b1N0cmluZygpKTtpZihhZyl7YWcoKX19LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0cnl7WS5kZXN0cm95Q2hhbm5lbChhYS5jaGFubmVsKX1jYXRjaChhZyl7fVk9bnVsbDtpZihYKXtYLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoWCk7WD1udWxsfX0sb25ET01SZWFkeTpmdW5jdGlvbigpe2FkPWFhLnJlbW90ZTtvLkZuLnNldCgiZmxhc2hfIithYS5jaGFubmVsKyJfaW5pdCIsZnVuY3Rpb24oKXtLKGZ1bmN0aW9uKCl7YWMudXAuY2FsbGJhY2sodHJ1ZSl9KX0pO28uRm4uc2V0KCJmbGFzaF8iK2FhLmNoYW5uZWwrIl9vbk1lc3NhZ2UiLGFmKTthYS5zd2Y9QihhYS5zd2YpO3ZhciBhaD16KGFhLnN3Zik7dmFyIGFnPWZ1bmN0aW9uKCl7by5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF0uaW5pdD10cnVlO1k9by5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF0uc3dmO1kuY3JlYXRlQ2hhbm5lbChhYS5jaGFubmVsLGFhLnNlY3JldCxqKGFhLnJlbW90ZSksYWEuaXNIb3N0KTtpZihhYS5pc0hvc3Qpe2lmKGgmJmFhLnN3Zk5vVGhyb3R0bGUpe1QoYWEucHJvcHMse3Bvc2l0aW9uOiJmaXhlZCIscmlnaHQ6MCx0b3A6MCxoZWlnaHQ6IjIwcHgiLHdpZHRoOiIyMHB4In0pfVQoYWEucHJvcHMse3NyYzpQKGFhLnJlbW90ZSx7eGRtX2U6aihwLmhyZWYpLHhkbV9jOmFhLmNoYW5uZWwseGRtX3A6Nix4ZG1fczphYS5zZWNyZXR9KSxuYW1lOlUrYWEuY2hhbm5lbCsiX3Byb3ZpZGVyIn0pO1g9QShhYSl9fTtpZihvLnN0YWNrLkZsYXNoVHJhbnNwb3J0W2FoXSYmby5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF0uaW5pdCl7YWcoKX1lbHNle2lmKCFvLnN0YWNrLkZsYXNoVHJhbnNwb3J0W2FoXSl7by5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF09e3F1ZXVlOlthZ119O1ooYWgpfWVsc2V7by5zdGFjay5GbGFzaFRyYW5zcG9ydFthaF0ucXVldWUucHVzaChhZyl9fX0saW5pdDpmdW5jdGlvbigpe0coYWMub25ET01SZWFkeSxhYyl9fSl9O28uc3RhY2suUG9zdE1lc3NhZ2VUcmFuc3BvcnQ9ZnVuY3Rpb24oYWEpe3ZhciBhYyxhZCxZLFo7ZnVuY3Rpb24gWChhZSl7aWYoYWUub3JpZ2luKXtyZXR1cm4gaihhZS5vcmlnaW4pfWlmKGFlLnVyaSl7cmV0dXJuIGooYWUudXJpKX1pZihhZS5kb21haW4pe3JldHVybiBwLnByb3RvY29sKyIvLyIrYWUuZG9tYWlufXRocm93IlVuYWJsZSB0byByZXRyaWV2ZSB0aGUgb3JpZ2luIG9mIHRoZSBldmVudCJ9ZnVuY3Rpb24gYWIoYWYpe3ZhciBhZT1YKGFmKTtpZihhZT09WiYmYWYuZGF0YS5zdWJzdHJpbmcoMCxhYS5jaGFubmVsLmxlbmd0aCsxKT09YWEuY2hhbm5lbCsiICIpe2FjLnVwLmluY29taW5nKGFmLmRhdGEuc3Vic3RyaW5nKGFhLmNoYW5uZWwubGVuZ3RoKzEpLGFlKX19cmV0dXJuKGFjPXtvdXRnb2luZzpmdW5jdGlvbihhZixhZyxhZSl7WS5wb3N0TWVzc2FnZShhYS5jaGFubmVsKyIgIithZixhZ3x8Wik7aWYoYWUpe2FlKCl9fSxkZXN0cm95OmZ1bmN0aW9uKCl7eChOLCJtZXNzYWdlIixhYik7aWYoYWQpe1k9bnVsbDthZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFkKTthZD1udWxsfX0sb25ET01SZWFkeTpmdW5jdGlvbigpe1o9aihhYS5yZW1vdGUpO2lmKGFhLmlzSG9zdCl7dmFyIGFlPWZ1bmN0aW9uKGFmKXtpZihhZi5kYXRhPT1hYS5jaGFubmVsKyItcmVhZHkiKXtZPSgicG9zdE1lc3NhZ2UiIGluIGFkLmNvbnRlbnRXaW5kb3cpP2FkLmNvbnRlbnRXaW5kb3c6YWQuY29udGVudFdpbmRvdy5kb2N1bWVudDt4KE4sIm1lc3NhZ2UiLGFlKTt2KE4sIm1lc3NhZ2UiLGFiKTtLKGZ1bmN0aW9uKCl7YWMudXAuY2FsbGJhY2sodHJ1ZSl9LDApfX07dihOLCJtZXNzYWdlIixhZSk7VChhYS5wcm9wcyx7c3JjOlAoYWEucmVtb3RlLHt4ZG1fZTpqKHAuaHJlZikseGRtX2M6YWEuY2hhbm5lbCx4ZG1fcDoxfSksbmFtZTpVK2FhLmNoYW5uZWwrIl9wcm92aWRlciJ9KTthZD1BKGFhKX1lbHNle3YoTiwibWVzc2FnZSIsYWIpO1k9KCJwb3N0TWVzc2FnZSIgaW4gTi5wYXJlbnQpP04ucGFyZW50Ok4ucGFyZW50LmRvY3VtZW50O1kucG9zdE1lc3NhZ2UoYWEuY2hhbm5lbCsiLXJlYWR5IixaKTtLKGZ1bmN0aW9uKCl7YWMudXAuY2FsbGJhY2sodHJ1ZSl9LDApfX0saW5pdDpmdW5jdGlvbigpe0coYWMub25ET01SZWFkeSxhYyl9fSl9O28uc3RhY2suRnJhbWVFbGVtZW50VHJhbnNwb3J0PWZ1bmN0aW9uKFkpe3ZhciBaLGFiLGFhLFg7cmV0dXJuKFo9e291dGdvaW5nOmZ1bmN0aW9uKGFkLGFlLGFjKXthYS5jYWxsKHRoaXMsYWQpO2lmKGFjKXthYygpfX0sZGVzdHJveTpmdW5jdGlvbigpe2lmKGFiKXthYi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFiKTthYj1udWxsfX0sb25ET01SZWFkeTpmdW5jdGlvbigpe1g9aihZLnJlbW90ZSk7aWYoWS5pc0hvc3Qpe1QoWS5wcm9wcyx7c3JjOlAoWS5yZW1vdGUse3hkbV9lOmoocC5ocmVmKSx4ZG1fYzpZLmNoYW5uZWwseGRtX3A6NX0pLG5hbWU6VStZLmNoYW5uZWwrIl9wcm92aWRlciJ9KTthYj1BKFkpO2FiLmZuPWZ1bmN0aW9uKGFjKXtkZWxldGUgYWIuZm47YWE9YWM7SyhmdW5jdGlvbigpe1oudXAuY2FsbGJhY2sodHJ1ZSl9LDApO3JldHVybiBmdW5jdGlvbihhZCl7Wi51cC5pbmNvbWluZyhhZCxYKX19fWVsc2V7aWYoZC5yZWZlcnJlciYmaihkLnJlZmVycmVyKSE9Uy54ZG1fZSl7Ti50b3AubG9jYXRpb249Uy54ZG1fZX1hYT1OLmZyYW1lRWxlbWVudC5mbihmdW5jdGlvbihhYyl7Wi51cC5pbmNvbWluZyhhYyxYKX0pO1oudXAuY2FsbGJhY2sodHJ1ZSl9fSxpbml0OmZ1bmN0aW9uKCl7RyhaLm9uRE9NUmVhZHksWil9fSl9O28uc3RhY2suTmFtZVRyYW5zcG9ydD1mdW5jdGlvbihhYil7dmFyIGFjO3ZhciBhZSxhaSxhYSxhZyxhaCxZLFg7ZnVuY3Rpb24gYWYoYWwpe3ZhciBhaz1hYi5yZW1vdGVIZWxwZXIrKGFlPyIjXzMiOiIjXzIiKSthYi5jaGFubmVsO2FpLmNvbnRlbnRXaW5kb3cuc2VuZE1lc3NhZ2UoYWwsYWspfWZ1bmN0aW9uIGFkKCl7aWYoYWUpe2lmKCsrYWc9PT0yfHwhYWUpe2FjLnVwLmNhbGxiYWNrKHRydWUpfX1lbHNle2FmKCJyZWFkeSIpO2FjLnVwLmNhbGxiYWNrKHRydWUpfX1mdW5jdGlvbiBhaihhayl7YWMudXAuaW5jb21pbmcoYWssWSl9ZnVuY3Rpb24gWigpe2lmKGFoKXtLKGZ1bmN0aW9uKCl7YWgodHJ1ZSl9LDApfX1yZXR1cm4oYWM9e291dGdvaW5nOmZ1bmN0aW9uKGFsLGFtLGFrKXthaD1hazthZihhbCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXthaS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFpKTthaT1udWxsO2lmKGFlKXthYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFhKTthYT1udWxsfX0sb25ET01SZWFkeTpmdW5jdGlvbigpe2FlPWFiLmlzSG9zdDthZz0wO1k9aihhYi5yZW1vdGUpO2FiLmxvY2FsPUIoYWIubG9jYWwpO2lmKGFlKXtvLkZuLnNldChhYi5jaGFubmVsLGZ1bmN0aW9uKGFsKXtpZihhZSYmYWw9PT0icmVhZHkiKXtvLkZuLnNldChhYi5jaGFubmVsLGFqKTthZCgpfX0pO1g9UChhYi5yZW1vdGUse3hkbV9lOmFiLmxvY2FsLHhkbV9jOmFiLmNoYW5uZWwseGRtX3A6Mn0pO1QoYWIucHJvcHMse3NyYzpYKyIjIithYi5jaGFubmVsLG5hbWU6VSthYi5jaGFubmVsKyJfcHJvdmlkZXIifSk7YWE9QShhYil9ZWxzZXthYi5yZW1vdGVIZWxwZXI9YWIucmVtb3RlO28uRm4uc2V0KGFiLmNoYW5uZWwsYWopfWFpPUEoe3Byb3BzOntzcmM6YWIubG9jYWwrIiNfNCIrYWIuY2hhbm5lbH0sb25Mb2FkOmZ1bmN0aW9uIGFrKCl7dmFyIGFsPWFpfHx0aGlzO3goYWwsImxvYWQiLGFrKTtvLkZuLnNldChhYi5jaGFubmVsKyJfbG9hZCIsWik7KGZ1bmN0aW9uIGFtKCl7aWYodHlwZW9mIGFsLmNvbnRlbnRXaW5kb3cuc2VuZE1lc3NhZ2U9PSJmdW5jdGlvbiIpe2FkKCl9ZWxzZXtLKGFtLDUwKX19KCkpfX0pfSxpbml0OmZ1bmN0aW9uKCl7RyhhYy5vbkRPTVJlYWR5LGFjKX19KX07by5zdGFjay5IYXNoVHJhbnNwb3J0PWZ1bmN0aW9uKFope3ZhciBhYzt2YXIgYWg9dGhpcyxhZixhYSxYLGFkLGFtLGFiLGFsO3ZhciBhZyxZO2Z1bmN0aW9uIGFrKGFvKXtpZighYWwpe3JldHVybn12YXIgYW49Wi5yZW1vdGUrIiMiKyhhbSsrKSsiXyIrYW87KChhZnx8IWFnKT9hbC5jb250ZW50V2luZG93OmFsKS5sb2NhdGlvbj1hbn1mdW5jdGlvbiBhZShhbil7YWQ9YW47YWMudXAuaW5jb21pbmcoYWQuc3Vic3RyaW5nKGFkLmluZGV4T2YoIl8iKSsxKSxZKX1mdW5jdGlvbiBhaigpe2lmKCFhYil7cmV0dXJufXZhciBhbj1hYi5sb2NhdGlvbi5ocmVmLGFwPSIiLGFvPWFuLmluZGV4T2YoIiMiKTtpZihhbyE9LTEpe2FwPWFuLnN1YnN0cmluZyhhbyl9aWYoYXAmJmFwIT1hZCl7YWUoYXApfX1mdW5jdGlvbiBhaSgpe2FhPXNldEludGVydmFsKGFqLFgpfXJldHVybihhYz17b3V0Z29pbmc6ZnVuY3Rpb24oYW4sYW8pe2FrKGFuKX0sZGVzdHJveTpmdW5jdGlvbigpe04uY2xlYXJJbnRlcnZhbChhYSk7aWYoYWZ8fCFhZyl7YWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhbCl9YWw9bnVsbH0sb25ET01SZWFkeTpmdW5jdGlvbigpe2FmPVouaXNIb3N0O1g9Wi5pbnRlcnZhbDthZD0iIyIrWi5jaGFubmVsO2FtPTA7YWc9Wi51c2VQYXJlbnQ7WT1qKFoucmVtb3RlKTtpZihhZil7Wi5wcm9wcz17c3JjOloucmVtb3RlLG5hbWU6VStaLmNoYW5uZWwrIl9wcm92aWRlciJ9O2lmKGFnKXtaLm9uTG9hZD1mdW5jdGlvbigpe2FiPU47YWkoKTthYy51cC5jYWxsYmFjayh0cnVlKX19ZWxzZXt2YXIgYXA9MCxhbj1aLmRlbGF5LzUwOyhmdW5jdGlvbiBhbygpe2lmKCsrYXA+YW4pe3Rocm93IG5ldyBFcnJvcigiVW5hYmxlIHRvIHJlZmVyZW5jZSBsaXN0ZW5lcndpbmRvdyIpfXRyeXthYj1hbC5jb250ZW50V2luZG93LmZyYW1lc1tVK1ouY2hhbm5lbCsiX2NvbnN1bWVyIl19Y2F0Y2goYXEpe31pZihhYil7YWkoKTthYy51cC5jYWxsYmFjayh0cnVlKX1lbHNle0soYW8sNTApfX0oKSl9YWw9QShaKX1lbHNle2FiPU47YWkoKTtpZihhZyl7YWw9cGFyZW50O2FjLnVwLmNhbGxiYWNrKHRydWUpfWVsc2V7VChaLHtwcm9wczp7c3JjOloucmVtb3RlKyIjIitaLmNoYW5uZWwrbmV3IERhdGUoKSxuYW1lOlUrWi5jaGFubmVsKyJfY29uc3VtZXIifSxvbkxvYWQ6ZnVuY3Rpb24oKXthYy51cC5jYWxsYmFjayh0cnVlKX19KTthbD1BKFopfX19LGluaXQ6ZnVuY3Rpb24oKXtHKGFjLm9uRE9NUmVhZHksYWMpfX0pfTtvLnN0YWNrLlJlbGlhYmxlQmVoYXZpb3I9ZnVuY3Rpb24oWSl7dmFyIGFhLGFjO3ZhciBhYj0wLFg9MCxaPSIiO3JldHVybihhYT17aW5jb21pbmc6ZnVuY3Rpb24oYWYsYWQpe3ZhciBhZT1hZi5pbmRleE9mKCJfIiksYWc9YWYuc3Vic3RyaW5nKDAsYWUpLnNwbGl0KCIsIik7YWY9YWYuc3Vic3RyaW5nKGFlKzEpO2lmKGFnWzBdPT1hYil7Wj0iIjtpZihhYyl7YWModHJ1ZSl9fWlmKGFmLmxlbmd0aD4wKXthYS5kb3duLm91dGdvaW5nKGFnWzFdKyIsIithYisiXyIrWixhZCk7aWYoWCE9YWdbMV0pe1g9YWdbMV07YWEudXAuaW5jb21pbmcoYWYsYWQpfX19LG91dGdvaW5nOmZ1bmN0aW9uKGFmLGFkLGFlKXtaPWFmO2FjPWFlO2FhLmRvd24ub3V0Z29pbmcoWCsiLCIrKCsrYWIpKyJfIithZixhZCl9fSl9O28uc3RhY2suUXVldWVCZWhhdmlvcj1mdW5jdGlvbihaKXt2YXIgYWMsYWQ9W10sYWc9dHJ1ZSxhYT0iIixhZixYPTAsWT1mYWxzZSxhYj1mYWxzZTtmdW5jdGlvbiBhZSgpe2lmKFoucmVtb3ZlJiZhZC5sZW5ndGg9PT0wKXt3KGFjKTtyZXR1cm59aWYoYWd8fGFkLmxlbmd0aD09PTB8fGFmKXtyZXR1cm59YWc9dHJ1ZTt2YXIgYWg9YWQuc2hpZnQoKTthYy5kb3duLm91dGdvaW5nKGFoLmRhdGEsYWgub3JpZ2luLGZ1bmN0aW9uKGFpKXthZz1mYWxzZTtpZihhaC5jYWxsYmFjayl7SyhmdW5jdGlvbigpe2FoLmNhbGxiYWNrKGFpKX0sMCl9YWUoKX0pfXJldHVybihhYz17aW5pdDpmdW5jdGlvbigpe2lmKHQoWikpe1o9e319aWYoWi5tYXhMZW5ndGgpe1g9Wi5tYXhMZW5ndGg7YWI9dHJ1ZX1pZihaLmxhenkpe1k9dHJ1ZX1lbHNle2FjLmRvd24uaW5pdCgpfX0sY2FsbGJhY2s6ZnVuY3Rpb24oYWkpe2FnPWZhbHNlO3ZhciBhaD1hYy51cDthZSgpO2FoLmNhbGxiYWNrKGFpKX0saW5jb21pbmc6ZnVuY3Rpb24oYWssYWkpe2lmKGFiKXt2YXIgYWo9YWsuaW5kZXhPZigiXyIpLGFoPXBhcnNlSW50KGFrLnN1YnN0cmluZygwLGFqKSwxMCk7YWErPWFrLnN1YnN0cmluZyhhaisxKTtpZihhaD09PTApe2lmKFouZW5jb2RlKXthYT1rKGFhKX1hYy51cC5pbmNvbWluZyhhYSxhaSk7YWE9IiJ9fWVsc2V7YWMudXAuaW5jb21pbmcoYWssYWkpfX0sb3V0Z29pbmc6ZnVuY3Rpb24oYWwsYWksYWspe2lmKFouZW5jb2RlKXthbD1IKGFsKX12YXIgYWg9W10sYWo7aWYoYWIpe3doaWxlKGFsLmxlbmd0aCE9PTApe2FqPWFsLnN1YnN0cmluZygwLFgpO2FsPWFsLnN1YnN0cmluZyhhai5sZW5ndGgpO2FoLnB1c2goYWopfXdoaWxlKChhaj1haC5zaGlmdCgpKSl7YWQucHVzaCh7ZGF0YTphaC5sZW5ndGgrIl8iK2FqLG9yaWdpbjphaSxjYWxsYmFjazphaC5sZW5ndGg9PT0wP2FrOm51bGx9KX19ZWxzZXthZC5wdXNoKHtkYXRhOmFsLG9yaWdpbjphaSxjYWxsYmFjazpha30pfWlmKFkpe2FjLmRvd24uaW5pdCgpfWVsc2V7YWUoKX19LGRlc3Ryb3k6ZnVuY3Rpb24oKXthZj10cnVlO2FjLmRvd24uZGVzdHJveSgpfX0pfTtvLnN0YWNrLlZlcmlmeUJlaGF2aW9yPWZ1bmN0aW9uKGFiKXt2YXIgYWMsYWEsWSxaPWZhbHNlO2Z1bmN0aW9uIFgoKXthYT1NYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMik7YWMuZG93bi5vdXRnb2luZyhhYSl9cmV0dXJuKGFjPXtpbmNvbWluZzpmdW5jdGlvbihhZixhZCl7dmFyIGFlPWFmLmluZGV4T2YoIl8iKTtpZihhZT09PS0xKXtpZihhZj09PWFhKXthYy51cC5jYWxsYmFjayh0cnVlKX1lbHNle2lmKCFZKXtZPWFmO2lmKCFhYi5pbml0aWF0ZSl7WCgpfWFjLmRvd24ub3V0Z29pbmcoYWYpfX19ZWxzZXtpZihhZi5zdWJzdHJpbmcoMCxhZSk9PT1ZKXthYy51cC5pbmNvbWluZyhhZi5zdWJzdHJpbmcoYWUrMSksYWQpfX19LG91dGdvaW5nOmZ1bmN0aW9uKGFmLGFkLGFlKXthYy5kb3duLm91dGdvaW5nKGFhKyJfIithZixhZCxhZSl9LGNhbGxiYWNrOmZ1bmN0aW9uKGFkKXtpZihhYi5pbml0aWF0ZSl7WCgpfX19KX07by5zdGFjay5ScGNCZWhhdmlvcj1mdW5jdGlvbihhZCxZKXt2YXIgYWEsYWY9WS5zZXJpYWxpemVyfHxPKCk7dmFyIGFlPTAsYWM9e307ZnVuY3Rpb24gWChhZyl7YWcuanNvbnJwYz0iMi4wIjthYS5kb3duLm91dGdvaW5nKGFmLnN0cmluZ2lmeShhZykpfWZ1bmN0aW9uIGFiKGFnLGFpKXt2YXIgYWg9QXJyYXkucHJvdG90eXBlLnNsaWNlO3JldHVybiBmdW5jdGlvbigpe3ZhciBhaj1hcmd1bWVudHMubGVuZ3RoLGFsLGFrPXttZXRob2Q6YWl9O2lmKGFqPjAmJnR5cGVvZiBhcmd1bWVudHNbYWotMV09PT0iZnVuY3Rpb24iKXtpZihhaj4xJiZ0eXBlb2YgYXJndW1lbnRzW2FqLTJdPT09ImZ1bmN0aW9uIil7YWw9e3N1Y2Nlc3M6YXJndW1lbnRzW2FqLTJdLGVycm9yOmFyZ3VtZW50c1thai0xXX07YWsucGFyYW1zPWFoLmNhbGwoYXJndW1lbnRzLDAsYWotMil9ZWxzZXthbD17c3VjY2Vzczphcmd1bWVudHNbYWotMV19O2FrLnBhcmFtcz1haC5jYWxsKGFyZ3VtZW50cywwLGFqLTEpfWFjWyIiKygrK2FlKV09YWw7YWsuaWQ9YWV9ZWxzZXthay5wYXJhbXM9YWguY2FsbChhcmd1bWVudHMsMCl9aWYoYWcubmFtZWRQYXJhbXMmJmFrLnBhcmFtcy5sZW5ndGg9PT0xKXthay5wYXJhbXM9YWsucGFyYW1zWzBdfVgoYWspfX1mdW5jdGlvbiBaKGFuLGFtLGFpLGFsKXtpZighYWkpe2lmKGFtKXtYKHtpZDphbSxlcnJvcjp7Y29kZTotMzI2MDEsbWVzc2FnZToiUHJvY2VkdXJlIG5vdCBmb3VuZC4ifX0pfXJldHVybn12YXIgYWssYWg7aWYoYW0pe2FrPWZ1bmN0aW9uKGFvKXthaz1xO1goe2lkOmFtLHJlc3VsdDphb30pfTthaD1mdW5jdGlvbihhbyxhcCl7YWg9cTt2YXIgYXE9e2lkOmFtLGVycm9yOntjb2RlOi0zMjA5OSxtZXNzYWdlOmFvfX07aWYoYXApe2FxLmVycm9yLmRhdGE9YXB9WChhcSl9fWVsc2V7YWs9YWg9cX1pZighcihhbCkpe2FsPVthbF19dHJ5e3ZhciBhZz1haS5tZXRob2QuYXBwbHkoYWkuc2NvcGUsYWwuY29uY2F0KFthayxhaF0pKTtpZighdChhZykpe2FrKGFnKX19Y2F0Y2goYWope2FoKGFqLm1lc3NhZ2UpfX1yZXR1cm4oYWE9e2luY29taW5nOmZ1bmN0aW9uKGFoLGFnKXt2YXIgYWk9YWYucGFyc2UoYWgpO2lmKGFpLm1ldGhvZCl7aWYoWS5oYW5kbGUpe1kuaGFuZGxlKGFpLFgpfWVsc2V7WihhaS5tZXRob2QsYWkuaWQsWS5sb2NhbFthaS5tZXRob2RdLGFpLnBhcmFtcyl9fWVsc2V7dmFyIGFqPWFjW2FpLmlkXTtpZihhaS5lcnJvcil7aWYoYWouZXJyb3Ipe2FqLmVycm9yKGFpLmVycm9yKX19ZWxzZXtpZihhai5zdWNjZXNzKXthai5zdWNjZXNzKGFpLnJlc3VsdCl9fWRlbGV0ZSBhY1thaS5pZF19fSxpbml0OmZ1bmN0aW9uKCl7aWYoWS5yZW1vdGUpe2Zvcih2YXIgYWcgaW4gWS5yZW1vdGUpe2lmKFkucmVtb3RlLmhhc093blByb3BlcnR5KGFnKSl7YWRbYWddPWFiKFkucmVtb3RlW2FnXSxhZyl9fX1hYS5kb3duLmluaXQoKX0sZGVzdHJveTpmdW5jdGlvbigpe2Zvcih2YXIgYWcgaW4gWS5yZW1vdGUpe2lmKFkucmVtb3RlLmhhc093blByb3BlcnR5KGFnKSYmYWQuaGFzT3duUHJvcGVydHkoYWcpKXtkZWxldGUgYWRbYWddfX1hYS5kb3duLmRlc3Ryb3koKX19KX07Yi5lYXN5WERNPW99KSh3aW5kb3csZG9jdW1lbnQsbG9jYXRpb24sd2luZG93LnNldFRpbWVvdXQsZGVjb2RlVVJJQ29tcG9uZW50LGVuY29kZVVSSUNvbXBvbmVudCk7CgogCi8vSlNPTjIsIHB1YmxpYyBkb21haW4KdGhpcy5KU09OfHwodGhpcy5KU09OPXt9KSxmdW5jdGlvbigpe2Z1bmN0aW9uIGYoYSl7cmV0dXJuIGE8MTA/IjAiK2E6YX1mdW5jdGlvbiBxdW90ZShhKXtyZXR1cm4gZXNjYXBhYmxlLmxhc3RJbmRleD0wLGVzY2FwYWJsZS50ZXN0KGEpPyciJythLnJlcGxhY2UoZXNjYXBhYmxlLGZ1bmN0aW9uKGEpe3ZhciBiPW1ldGFbYV07cmV0dXJuIHR5cGVvZiBiPT0ic3RyaW5nIj9iOiJcXHUiKygiMDAwMCIrYS5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTQpfSkrJyInOiciJythKyciJ31mdW5jdGlvbiBzdHIoYSxiKXt2YXIgYyxkLGUsZixnPWdhcCxoLGk9YlthXTtpJiZ0eXBlb2YgaT09Im9iamVjdCImJnR5cGVvZiBpLnRvSlNPTj09ImZ1bmN0aW9uIiYmKGk9aS50b0pTT04oYSkpLHR5cGVvZiByZXA9PSJmdW5jdGlvbiImJihpPXJlcC5jYWxsKGIsYSxpKSk7c3dpdGNoKHR5cGVvZiBpKXtjYXNlInN0cmluZyI6cmV0dXJuIHF1b3RlKGkpO2Nhc2UibnVtYmVyIjpyZXR1cm4gaXNGaW5pdGUoaSk/U3RyaW5nKGkpOiJudWxsIjtjYXNlImJvb2xlYW4iOmNhc2UibnVsbCI6cmV0dXJuIFN0cmluZyhpKTtjYXNlIm9iamVjdCI6aWYoIWkpcmV0dXJuIm51bGwiO2dhcCs9aW5kZW50LGg9W107aWYoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5hcHBseShpKT09PSJbb2JqZWN0IEFycmF5XSIpe2Y9aS5sZW5ndGg7Zm9yKGM9MDtjPGY7Yys9MSloW2NdPXN0cihjLGkpfHwibnVsbCI7cmV0dXJuIGU9aC5sZW5ndGg9PT0wPyJbXSI6Z2FwPyJbXG4iK2dhcCtoLmpvaW4oIixcbiIrZ2FwKSsiXG4iK2crIl0iOiJbIitoLmpvaW4oIiwiKSsiXSIsZ2FwPWcsZX1pZihyZXAmJnR5cGVvZiByZXA9PSJvYmplY3QiKXtmPXJlcC5sZW5ndGg7Zm9yKGM9MDtjPGY7Yys9MSlkPXJlcFtjXSx0eXBlb2YgZD09InN0cmluZyImJihlPXN0cihkLGkpLGUmJmgucHVzaChxdW90ZShkKSsoZ2FwPyI6ICI6IjoiKStlKSl9ZWxzZSBmb3IoZCBpbiBpKU9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGksZCkmJihlPXN0cihkLGkpLGUmJmgucHVzaChxdW90ZShkKSsoZ2FwPyI6ICI6IjoiKStlKSk7cmV0dXJuIGU9aC5sZW5ndGg9PT0wPyJ7fSI6Z2FwPyJ7XG4iK2dhcCtoLmpvaW4oIixcbiIrZ2FwKSsiXG4iK2crIn0iOiJ7IitoLmpvaW4oIiwiKSsifSIsZ2FwPWcsZX19dHlwZW9mIERhdGUucHJvdG90eXBlLnRvSlNPTiE9ImZ1bmN0aW9uIiYmKERhdGUucHJvdG90eXBlLnRvSlNPTj1mdW5jdGlvbihhKXtyZXR1cm4gaXNGaW5pdGUodGhpcy52YWx1ZU9mKCkpP3RoaXMuZ2V0VVRDRnVsbFllYXIoKSsiLSIrZih0aGlzLmdldFVUQ01vbnRoKCkrMSkrIi0iK2YodGhpcy5nZXRVVENEYXRlKCkpKyJUIitmKHRoaXMuZ2V0VVRDSG91cnMoKSkrIjoiK2YodGhpcy5nZXRVVENNaW51dGVzKCkpKyI6IitmKHRoaXMuZ2V0VVRDU2Vjb25kcygpKSsiWiI6bnVsbH0sU3RyaW5nLnByb3RvdHlwZS50b0pTT049TnVtYmVyLnByb3RvdHlwZS50b0pTT049Qm9vbGVhbi5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnZhbHVlT2YoKX0pO3ZhciBjeD0vW1x1MDAwMFx1MDBhZFx1MDYwMC1cdTA2MDRcdTA3MGZcdTE3YjRcdTE3YjVcdTIwMGMtXHUyMDBmXHUyMDI4LVx1MjAyZlx1MjA2MC1cdTIwNmZcdWZlZmZcdWZmZjAtXHVmZmZmXS9nLGVzY2FwYWJsZT0vW1xcXCJceDAwLVx4MWZceDdmLVx4OWZcdTAwYWRcdTA2MDAtXHUwNjA0XHUwNzBmXHUxN2I0XHUxN2I1XHUyMDBjLVx1MjAwZlx1MjAyOC1cdTIwMmZcdTIwNjAtXHUyMDZmXHVmZWZmXHVmZmYwLVx1ZmZmZl0vZyxnYXAsaW5kZW50LG1ldGE9eyJcYiI6IlxcYiIsIlx0IjoiXFx0IiwiXG4iOiJcXG4iLCJcZiI6IlxcZiIsIlxyIjoiXFxyIiwnIic6J1xcIicsIlxcIjoiXFxcXCJ9LHJlcDt0eXBlb2YgSlNPTi5zdHJpbmdpZnkhPSJmdW5jdGlvbiImJihKU09OLnN0cmluZ2lmeT1mdW5jdGlvbihhLGIsYyl7dmFyIGQ7Z2FwPSIiLGluZGVudD0iIjtpZih0eXBlb2YgYz09Im51bWJlciIpZm9yKGQ9MDtkPGM7ZCs9MSlpbmRlbnQrPSIgIjtlbHNlIHR5cGVvZiBjPT0ic3RyaW5nIiYmKGluZGVudD1jKTtyZXA9YjtpZighYnx8dHlwZW9mIGI9PSJmdW5jdGlvbiJ8fHR5cGVvZiBiPT0ib2JqZWN0IiYmdHlwZW9mIGIubGVuZ3RoPT0ibnVtYmVyIilyZXR1cm4gc3RyKCIiLHsiIjphfSk7dGhyb3cgbmV3IEVycm9yKCJKU09OLnN0cmluZ2lmeSIpfSksdHlwZW9mIEpTT04ucGFyc2UhPSJmdW5jdGlvbiImJihKU09OLnBhcnNlPWZ1bmN0aW9uKHRleHQscmV2aXZlcil7ZnVuY3Rpb24gd2FsayhhLGIpe3ZhciBjLGQsZT1hW2JdO2lmKGUmJnR5cGVvZiBlPT0ib2JqZWN0Iilmb3IoYyBpbiBlKU9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsYykmJihkPXdhbGsoZSxjKSxkIT09dW5kZWZpbmVkP2VbY109ZDpkZWxldGUgZVtjXSk7cmV0dXJuIHJldml2ZXIuY2FsbChhLGIsZSl9dmFyIGo7dGV4dD1TdHJpbmcodGV4dCksY3gubGFzdEluZGV4PTAsY3gudGVzdCh0ZXh0KSYmKHRleHQ9dGV4dC5yZXBsYWNlKGN4LGZ1bmN0aW9uKGEpe3JldHVybiJcXHUiKygiMDAwMCIrYS5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTQpfSkpO2lmKC9eW1xdLDp7fVxzXSokLy50ZXN0KHRleHQucmVwbGFjZSgvXFwoPzpbIlxcXC9iZm5ydF18dVswLTlhLWZBLUZdezR9KS9nLCJAIikucmVwbGFjZSgvIlteIlxcXG5ccl0qInx0cnVlfGZhbHNlfG51bGx8LT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/L2csIl0iKS5yZXBsYWNlKC8oPzpefDp8LCkoPzpccypcWykrL2csIiIpKSlyZXR1cm4gaj1ldmFsKCIoIit0ZXh0KyIpIiksdHlwZW9mIHJldml2ZXI9PSJmdW5jdGlvbiI/d2Fsayh7IiI6an0sIiIpOmo7dGhyb3cgbmV3IFN5bnRheEVycm9yKCJKU09OLnBhcnNlIil9KX0oKQoKLyoKICAgIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIE5vdGUtby1yYW1hLgoKICAgIE5vdGUtby1yYW1hIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBOb3RlLW8tcmFtYSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICAgIGFsb25nIHdpdGggTm90ZS1vLXJhbWEuICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovCnZhciBfYXJyYXlfd3JhcD1mdW5jdGlvbihhKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgYj1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO2EoYil9fSxfd3JhcD1mdW5jdGlvbihhKXtyZXR1cm57bWV0aG9kOmZ1bmN0aW9uKCl7dmFyIGI9W107JC5lYWNoKGFyZ3VtZW50cyxmdW5jdGlvbihhLGMpe3R5cGVvZiBjPT0iZnVuY3Rpb24iP2IucHVzaChfYXJyYXlfd3JhcChjKSk6Yi5wdXNoKGMpfSk7dmFyIGM9Yi5sZW5ndGg7Yi5zcGxpY2UoYy0xLDEpLGEuYXBwbHkodGhpcyxiKX19fSxsb2NhbD17dGVzdDp7bWV0aG9kOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gYihhKX19LGRiX3NhdmVEb2M6X3dyYXAoZGIuc2F2ZURvYyksZGJfcmVtb3ZlRG9jOl93cmFwKGRiLnJlbW92ZURvYyksZGJfZ2V0Vmlldzpfd3JhcChkYi5nZXRWaWV3KSxkYl9kb1VwZGF0ZTpfd3JhcChkYi5kb1VwZGF0ZSksc2Vzc2lvbl9sb2dpbjpfd3JhcChzZXNzaW9uLmxvZ2luKSxzZXNzaW9uX2xvZ291dDpfd3JhcChzZXNzaW9uLmxvZ291dCksc2Vzc2lvbl9pbmZvOl93cmFwKHNlc3Npb24uaW5mbyl9LHJlbW90ZT17Z2V0X3ZlcnNpb246e30sbXNnOnt9LG1vZGFsOnt9fSxvblJlYWR5PWZ1bmN0aW9uKCl7fSxfcnBjPW5ldyBlYXN5WERNLlJwYyh7b25SZWFkeTpvblJlYWR5fSx7bG9jYWw6bG9jYWwscmVtb3RlOnJlbW90ZX0pO2ZuPWZ1bmN0aW9uKCl7JC5lYWNoKGFyZ3VtZW50cyxmdW5jdGlvbihhLGIpe2NvbnNvbGUubG9nKGIpfSl9"
        },
        "static/js/jquery-ui.min.js": {
            "content_type": "application/javascript",
            "data": "LyohCiAqIGpRdWVyeSBVSSAxLjguNQogKgogKiBDb3B5cmlnaHQgMjAxMCwgQVVUSE9SUy50eHQgKGh0dHA6Ly9qcXVlcnl1aS5jb20vYWJvdXQpCiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkKICovCihmdW5jdGlvbihjLGope2Z1bmN0aW9uIGsoYSl7cmV0dXJuIWMoYSkucGFyZW50cygpLmFuZFNlbGYoKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gYy5jdXJDU1ModGhpcywidmlzaWJpbGl0eSIpPT09ImhpZGRlbiJ8fGMuZXhwci5maWx0ZXJzLmhpZGRlbih0aGlzKX0pLmxlbmd0aH1jLnVpPWMudWl8fHt9O2lmKCFjLnVpLnZlcnNpb24pe2MuZXh0ZW5kKGMudWkse3ZlcnNpb246IjEuOC41IixrZXlDb2RlOntBTFQ6MTgsQkFDS1NQQUNFOjgsQ0FQU19MT0NLOjIwLENPTU1BOjE4OCxDT01NQU5EOjkxLENPTU1BTkRfTEVGVDo5MSxDT01NQU5EX1JJR0hUOjkzLENPTlRST0w6MTcsREVMRVRFOjQ2LERPV046NDAsRU5EOjM1LEVOVEVSOjEzLEVTQ0FQRToyNyxIT01FOjM2LElOU0VSVDo0NSxMRUZUOjM3LE1FTlU6OTMsTlVNUEFEX0FERDoxMDcsTlVNUEFEX0RFQ0lNQUw6MTEwLE5VTVBBRF9ESVZJREU6MTExLE5VTVBBRF9FTlRFUjoxMDgsTlVNUEFEX01VTFRJUExZOjEwNiwKTlVNUEFEX1NVQlRSQUNUOjEwOSxQQUdFX0RPV046MzQsUEFHRV9VUDozMyxQRVJJT0Q6MTkwLFJJR0hUOjM5LFNISUZUOjE2LFNQQUNFOjMyLFRBQjo5LFVQOjM4LFdJTkRPV1M6OTF9fSk7Yy5mbi5leHRlbmQoe19mb2N1czpjLmZuLmZvY3VzLGZvY3VzOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHR5cGVvZiBhPT09Im51bWJlciI/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9dGhpcztzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YyhkKS5mb2N1cygpO2ImJmIuY2FsbChkKX0sYSl9KTp0aGlzLl9mb2N1cy5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHNjcm9sbFBhcmVudDpmdW5jdGlvbigpe3ZhciBhO2E9Yy5icm93c2VyLm1zaWUmJi8oc3RhdGljfHJlbGF0aXZlKS8udGVzdCh0aGlzLmNzcygicG9zaXRpb24iKSl8fC9hYnNvbHV0ZS8udGVzdCh0aGlzLmNzcygicG9zaXRpb24iKSk/dGhpcy5wYXJlbnRzKCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuLyhyZWxhdGl2ZXxhYnNvbHV0ZXxmaXhlZCkvLnRlc3QoYy5jdXJDU1ModGhpcywKInBvc2l0aW9uIiwxKSkmJi8oYXV0b3xzY3JvbGwpLy50ZXN0KGMuY3VyQ1NTKHRoaXMsIm92ZXJmbG93IiwxKStjLmN1ckNTUyh0aGlzLCJvdmVyZmxvdy15IiwxKStjLmN1ckNTUyh0aGlzLCJvdmVyZmxvdy14IiwxKSl9KS5lcSgwKTp0aGlzLnBhcmVudHMoKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4vKGF1dG98c2Nyb2xsKS8udGVzdChjLmN1ckNTUyh0aGlzLCJvdmVyZmxvdyIsMSkrYy5jdXJDU1ModGhpcywib3ZlcmZsb3cteSIsMSkrYy5jdXJDU1ModGhpcywib3ZlcmZsb3cteCIsMSkpfSkuZXEoMCk7cmV0dXJuL2ZpeGVkLy50ZXN0KHRoaXMuY3NzKCJwb3NpdGlvbiIpKXx8IWEubGVuZ3RoP2MoZG9jdW1lbnQpOmF9LHpJbmRleDpmdW5jdGlvbihhKXtpZihhIT09ailyZXR1cm4gdGhpcy5jc3MoInpJbmRleCIsYSk7aWYodGhpcy5sZW5ndGgpe2E9Yyh0aGlzWzBdKTtmb3IodmFyIGI7YS5sZW5ndGgmJmFbMF0hPT1kb2N1bWVudDspe2I9YS5jc3MoInBvc2l0aW9uIik7CmlmKGI9PT0iYWJzb2x1dGUifHxiPT09InJlbGF0aXZlInx8Yj09PSJmaXhlZCIpe2I9cGFyc2VJbnQoYS5jc3MoInpJbmRleCIpKTtpZighaXNOYU4oYikmJmIhPTApcmV0dXJuIGJ9YT1hLnBhcmVudCgpfX1yZXR1cm4gMH0sZGlzYWJsZVNlbGVjdGlvbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmJpbmQoIm1vdXNlZG93bi51aS1kaXNhYmxlU2VsZWN0aW9uIHNlbGVjdHN0YXJ0LnVpLWRpc2FibGVTZWxlY3Rpb24iLGZ1bmN0aW9uKGEpe2EucHJldmVudERlZmF1bHQoKX0pfSxlbmFibGVTZWxlY3Rpb246ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy51bmJpbmQoIi51aS1kaXNhYmxlU2VsZWN0aW9uIil9fSk7Yy5lYWNoKFsiV2lkdGgiLCJIZWlnaHQiXSxmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGQoZixnLGwsbSl7Yy5lYWNoKGUsZnVuY3Rpb24oKXtnLT1wYXJzZUZsb2F0KGMuY3VyQ1NTKGYsInBhZGRpbmciK3RoaXMsdHJ1ZSkpfHwwO2lmKGwpZy09cGFyc2VGbG9hdChjLmN1ckNTUyhmLAoiYm9yZGVyIit0aGlzKyJXaWR0aCIsdHJ1ZSkpfHwwO2lmKG0pZy09cGFyc2VGbG9hdChjLmN1ckNTUyhmLCJtYXJnaW4iK3RoaXMsdHJ1ZSkpfHwwfSk7cmV0dXJuIGd9dmFyIGU9Yj09PSJXaWR0aCI/WyJMZWZ0IiwiUmlnaHQiXTpbIlRvcCIsIkJvdHRvbSJdLGg9Yi50b0xvd2VyQ2FzZSgpLGk9e2lubmVyV2lkdGg6Yy5mbi5pbm5lcldpZHRoLGlubmVySGVpZ2h0OmMuZm4uaW5uZXJIZWlnaHQsb3V0ZXJXaWR0aDpjLmZuLm91dGVyV2lkdGgsb3V0ZXJIZWlnaHQ6Yy5mbi5vdXRlckhlaWdodH07Yy5mblsiaW5uZXIiK2JdPWZ1bmN0aW9uKGYpe2lmKGY9PT1qKXJldHVybiBpWyJpbm5lciIrYl0uY2FsbCh0aGlzKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Yy5zdHlsZSh0aGlzLGgsZCh0aGlzLGYpKyJweCIpfSl9O2MuZm5bIm91dGVyIitiXT1mdW5jdGlvbihmLGcpe2lmKHR5cGVvZiBmIT09Im51bWJlciIpcmV0dXJuIGlbIm91dGVyIitiXS5jYWxsKHRoaXMsZik7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2Muc3R5bGUodGhpcywKaCxkKHRoaXMsZix0cnVlLGcpKyJweCIpfSl9fSk7Yy5leHRlbmQoYy5leHByWyI6Il0se2RhdGE6ZnVuY3Rpb24oYSxiLGQpe3JldHVybiEhYy5kYXRhKGEsZFszXSl9LGZvY3VzYWJsZTpmdW5jdGlvbihhKXt2YXIgYj1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksZD1jLmF0dHIoYSwidGFiaW5kZXgiKTtpZigiYXJlYSI9PT1iKXtiPWEucGFyZW50Tm9kZTtkPWIubmFtZTtpZighYS5ocmVmfHwhZHx8Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIT09Im1hcCIpcmV0dXJuIGZhbHNlO2E9YygiaW1nW3VzZW1hcD0jIitkKyJdIilbMF07cmV0dXJuISFhJiZrKGEpfXJldHVybigvaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbnxvYmplY3QvLnRlc3QoYik/IWEuZGlzYWJsZWQ6ImEiPT1iP2EuaHJlZnx8IWlzTmFOKGQpOiFpc05hTihkKSkmJmsoYSl9LHRhYmJhYmxlOmZ1bmN0aW9uKGEpe3ZhciBiPWMuYXR0cihhLCJ0YWJpbmRleCIpO3JldHVybihpc05hTihiKXx8Yj49MCkmJmMoYSkuaXMoIjpmb2N1c2FibGUiKX19KTsKYyhmdW5jdGlvbigpe3ZhciBhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLGI9ZG9jdW1lbnQuYm9keTtjLmV4dGVuZChhLnN0eWxlLHttaW5IZWlnaHQ6IjEwMHB4IixoZWlnaHQ6ImF1dG8iLHBhZGRpbmc6MCxib3JkZXJXaWR0aDowfSk7Yy5zdXBwb3J0Lm1pbkhlaWdodD1iLmFwcGVuZENoaWxkKGEpLm9mZnNldEhlaWdodD09PTEwMDtiLnJlbW92ZUNoaWxkKGEpLnN0eWxlLmRpc3BsYXk9Im5vbmUifSk7Yy5leHRlbmQoYy51aSx7cGx1Z2luOnthZGQ6ZnVuY3Rpb24oYSxiLGQpe2E9Yy51aVthXS5wcm90b3R5cGU7Zm9yKHZhciBlIGluIGQpe2EucGx1Z2luc1tlXT1hLnBsdWdpbnNbZV18fFtdO2EucGx1Z2luc1tlXS5wdXNoKFtiLGRbZV1dKX19LGNhbGw6ZnVuY3Rpb24oYSxiLGQpe2lmKChiPWEucGx1Z2luc1tiXSkmJmEuZWxlbWVudFswXS5wYXJlbnROb2RlKWZvcih2YXIgZT0wO2U8Yi5sZW5ndGg7ZSsrKWEub3B0aW9uc1tiW2VdWzBdXSYmYltlXVsxXS5hcHBseShhLmVsZW1lbnQsCmQpfX0sY29udGFpbnM6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZG9jdW1lbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24/YS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSYxNjphIT09YiYmYS5jb250YWlucyhiKX0saGFzU2Nyb2xsOmZ1bmN0aW9uKGEsYil7aWYoYyhhKS5jc3MoIm92ZXJmbG93Iik9PT0iaGlkZGVuIilyZXR1cm4gZmFsc2U7Yj1iJiZiPT09ImxlZnQiPyJzY3JvbGxMZWZ0Ijoic2Nyb2xsVG9wIjt2YXIgZD1mYWxzZTtpZihhW2JdPjApcmV0dXJuIHRydWU7YVtiXT0xO2Q9YVtiXT4wO2FbYl09MDtyZXR1cm4gZH0saXNPdmVyQXhpczpmdW5jdGlvbihhLGIsZCl7cmV0dXJuIGE+YiYmYTxiK2R9LGlzT3ZlcjpmdW5jdGlvbihhLGIsZCxlLGgsaSl7cmV0dXJuIGMudWkuaXNPdmVyQXhpcyhhLGQsaCkmJmMudWkuaXNPdmVyQXhpcyhiLGUsaSl9fSl9fSkoalF1ZXJ5KTsKKGZ1bmN0aW9uKGIsail7aWYoYi5jbGVhbkRhdGEpe3ZhciBrPWIuY2xlYW5EYXRhO2IuY2xlYW5EYXRhPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYz0wLGQ7KGQ9YVtjXSkhPW51bGw7YysrKWIoZCkudHJpZ2dlckhhbmRsZXIoInJlbW92ZSIpO2soYSl9fWVsc2V7dmFyIGw9Yi5mbi5yZW1vdmU7Yi5mbi5yZW1vdmU9ZnVuY3Rpb24oYSxjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7aWYoIWMpaWYoIWF8fGIuZmlsdGVyKGEsW3RoaXNdKS5sZW5ndGgpYigiKiIsdGhpcykuYWRkKFt0aGlzXSkuZWFjaChmdW5jdGlvbigpe2IodGhpcykudHJpZ2dlckhhbmRsZXIoInJlbW92ZSIpfSk7cmV0dXJuIGwuY2FsbChiKHRoaXMpLGEsYyl9KX19Yi53aWRnZXQ9ZnVuY3Rpb24oYSxjLGQpe3ZhciBlPWEuc3BsaXQoIi4iKVswXSxmO2E9YS5zcGxpdCgiLiIpWzFdO2Y9ZSsiLSIrYTtpZighZCl7ZD1jO2M9Yi5XaWRnZXR9Yi5leHByWyI6Il1bZl09ZnVuY3Rpb24oaCl7cmV0dXJuISFiLmRhdGEoaCwKYSl9O2JbZV09YltlXXx8e307YltlXVthXT1mdW5jdGlvbihoLGcpe2FyZ3VtZW50cy5sZW5ndGgmJnRoaXMuX2NyZWF0ZVdpZGdldChoLGcpfTtjPW5ldyBjO2Mub3B0aW9ucz1iLmV4dGVuZCh0cnVlLHt9LGMub3B0aW9ucyk7YltlXVthXS5wcm90b3R5cGU9Yi5leHRlbmQodHJ1ZSxjLHtuYW1lc3BhY2U6ZSx3aWRnZXROYW1lOmEsd2lkZ2V0RXZlbnRQcmVmaXg6YltlXVthXS5wcm90b3R5cGUud2lkZ2V0RXZlbnRQcmVmaXh8fGEsd2lkZ2V0QmFzZUNsYXNzOmZ9LGQpO2Iud2lkZ2V0LmJyaWRnZShhLGJbZV1bYV0pfTtiLndpZGdldC5icmlkZ2U9ZnVuY3Rpb24oYSxjKXtiLmZuW2FdPWZ1bmN0aW9uKGQpe3ZhciBlPXR5cGVvZiBkPT09InN0cmluZyIsZj1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSksaD10aGlzO2Q9IWUmJmYubGVuZ3RoP2IuZXh0ZW5kLmFwcGx5KG51bGwsW3RydWUsZF0uY29uY2F0KGYpKTpkO2lmKGUmJmQuc3Vic3RyaW5nKDAsMSk9PT0KIl8iKXJldHVybiBoO2U/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGc9Yi5kYXRhKHRoaXMsYSk7aWYoIWcpdGhyb3ciY2Fubm90IGNhbGwgbWV0aG9kcyBvbiAiK2ErIiBwcmlvciB0byBpbml0aWFsaXphdGlvbjsgYXR0ZW1wdGVkIHRvIGNhbGwgbWV0aG9kICciK2QrIiciO2lmKCFiLmlzRnVuY3Rpb24oZ1tkXSkpdGhyb3cibm8gc3VjaCBtZXRob2QgJyIrZCsiJyBmb3IgIithKyIgd2lkZ2V0IGluc3RhbmNlIjt2YXIgaT1nW2RdLmFwcGx5KGcsZik7aWYoaSE9PWcmJmkhPT1qKXtoPWk7cmV0dXJuIGZhbHNlfX0pOnRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBnPWIuZGF0YSh0aGlzLGEpO2c/Zy5vcHRpb24oZHx8e30pLl9pbml0KCk6Yi5kYXRhKHRoaXMsYSxuZXcgYyhkLHRoaXMpKX0pO3JldHVybiBofX07Yi5XaWRnZXQ9ZnVuY3Rpb24oYSxjKXthcmd1bWVudHMubGVuZ3RoJiZ0aGlzLl9jcmVhdGVXaWRnZXQoYSxjKX07Yi5XaWRnZXQucHJvdG90eXBlPXt3aWRnZXROYW1lOiJ3aWRnZXQiLAp3aWRnZXRFdmVudFByZWZpeDoiIixvcHRpb25zOntkaXNhYmxlZDpmYWxzZX0sX2NyZWF0ZVdpZGdldDpmdW5jdGlvbihhLGMpe2IuZGF0YShjLHRoaXMud2lkZ2V0TmFtZSx0aGlzKTt0aGlzLmVsZW1lbnQ9YihjKTt0aGlzLm9wdGlvbnM9Yi5leHRlbmQodHJ1ZSx7fSx0aGlzLm9wdGlvbnMsYi5tZXRhZGF0YSYmYi5tZXRhZGF0YS5nZXQoYylbdGhpcy53aWRnZXROYW1lXSxhKTt2YXIgZD10aGlzO3RoaXMuZWxlbWVudC5iaW5kKCJyZW1vdmUuIit0aGlzLndpZGdldE5hbWUsZnVuY3Rpb24oKXtkLmRlc3Ryb3koKX0pO3RoaXMuX2NyZWF0ZSgpO3RoaXMuX2luaXQoKX0sX2NyZWF0ZTpmdW5jdGlvbigpe30sX2luaXQ6ZnVuY3Rpb24oKXt9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQudW5iaW5kKCIuIit0aGlzLndpZGdldE5hbWUpLnJlbW92ZURhdGEodGhpcy53aWRnZXROYW1lKTt0aGlzLndpZGdldCgpLnVuYmluZCgiLiIrdGhpcy53aWRnZXROYW1lKS5yZW1vdmVBdHRyKCJhcmlhLWRpc2FibGVkIikucmVtb3ZlQ2xhc3ModGhpcy53aWRnZXRCYXNlQ2xhc3MrCiItZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWQiKX0sd2lkZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWxlbWVudH0sb3B0aW9uOmZ1bmN0aW9uKGEsYyl7dmFyIGQ9YSxlPXRoaXM7aWYoYXJndW1lbnRzLmxlbmd0aD09PTApcmV0dXJuIGIuZXh0ZW5kKHt9LGUub3B0aW9ucyk7aWYodHlwZW9mIGE9PT0ic3RyaW5nIil7aWYoYz09PWopcmV0dXJuIHRoaXMub3B0aW9uc1thXTtkPXt9O2RbYV09Y31iLmVhY2goZCxmdW5jdGlvbihmLGgpe2UuX3NldE9wdGlvbihmLGgpfSk7cmV0dXJuIGV9LF9zZXRPcHRpb246ZnVuY3Rpb24oYSxjKXt0aGlzLm9wdGlvbnNbYV09YztpZihhPT09ImRpc2FibGVkIil0aGlzLndpZGdldCgpW2M/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXSh0aGlzLndpZGdldEJhc2VDbGFzcysiLWRpc2FibGVkIHVpLXN0YXRlLWRpc2FibGVkIikuYXR0cigiYXJpYS1kaXNhYmxlZCIsYyk7cmV0dXJuIHRoaXN9LGVuYWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zZXRPcHRpb24oImRpc2FibGVkIiwKZmFsc2UpfSxkaXNhYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3NldE9wdGlvbigiZGlzYWJsZWQiLHRydWUpfSxfdHJpZ2dlcjpmdW5jdGlvbihhLGMsZCl7dmFyIGU9dGhpcy5vcHRpb25zW2FdO2M9Yi5FdmVudChjKTtjLnR5cGU9KGE9PT10aGlzLndpZGdldEV2ZW50UHJlZml4P2E6dGhpcy53aWRnZXRFdmVudFByZWZpeCthKS50b0xvd2VyQ2FzZSgpO2Q9ZHx8e307aWYoYy5vcmlnaW5hbEV2ZW50KXthPWIuZXZlbnQucHJvcHMubGVuZ3RoO2Zvcih2YXIgZjthOyl7Zj1iLmV2ZW50LnByb3BzWy0tYV07Y1tmXT1jLm9yaWdpbmFsRXZlbnRbZl19fXRoaXMuZWxlbWVudC50cmlnZ2VyKGMsZCk7cmV0dXJuIShiLmlzRnVuY3Rpb24oZSkmJmUuY2FsbCh0aGlzLmVsZW1lbnRbMF0sYyxkKT09PWZhbHNlfHxjLmlzRGVmYXVsdFByZXZlbnRlZCgpKX19fSkoalF1ZXJ5KTsKKGZ1bmN0aW9uKGMpe2Mud2lkZ2V0KCJ1aS5tb3VzZSIse29wdGlvbnM6e2NhbmNlbDoiOmlucHV0LG9wdGlvbiIsZGlzdGFuY2U6MSxkZWxheTowfSxfbW91c2VJbml0OmZ1bmN0aW9uKCl7dmFyIGE9dGhpczt0aGlzLmVsZW1lbnQuYmluZCgibW91c2Vkb3duLiIrdGhpcy53aWRnZXROYW1lLGZ1bmN0aW9uKGIpe3JldHVybiBhLl9tb3VzZURvd24oYil9KS5iaW5kKCJjbGljay4iK3RoaXMud2lkZ2V0TmFtZSxmdW5jdGlvbihiKXtpZihhLl9wcmV2ZW50Q2xpY2tFdmVudCl7YS5fcHJldmVudENsaWNrRXZlbnQ9ZmFsc2U7Yi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtyZXR1cm4gZmFsc2V9fSk7dGhpcy5zdGFydGVkPWZhbHNlfSxfbW91c2VEZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnVuYmluZCgiLiIrdGhpcy53aWRnZXROYW1lKX0sX21vdXNlRG93bjpmdW5jdGlvbihhKXthLm9yaWdpbmFsRXZlbnQ9YS5vcmlnaW5hbEV2ZW50fHx7fTtpZighYS5vcmlnaW5hbEV2ZW50Lm1vdXNlSGFuZGxlZCl7dGhpcy5fbW91c2VTdGFydGVkJiYKdGhpcy5fbW91c2VVcChhKTt0aGlzLl9tb3VzZURvd25FdmVudD1hO3ZhciBiPXRoaXMsZT1hLndoaWNoPT0xLGY9dHlwZW9mIHRoaXMub3B0aW9ucy5jYW5jZWw9PSJzdHJpbmciP2MoYS50YXJnZXQpLnBhcmVudHMoKS5hZGQoYS50YXJnZXQpLmZpbHRlcih0aGlzLm9wdGlvbnMuY2FuY2VsKS5sZW5ndGg6ZmFsc2U7aWYoIWV8fGZ8fCF0aGlzLl9tb3VzZUNhcHR1cmUoYSkpcmV0dXJuIHRydWU7dGhpcy5tb3VzZURlbGF5TWV0PSF0aGlzLm9wdGlvbnMuZGVsYXk7aWYoIXRoaXMubW91c2VEZWxheU1ldCl0aGlzLl9tb3VzZURlbGF5VGltZXI9c2V0VGltZW91dChmdW5jdGlvbigpe2IubW91c2VEZWxheU1ldD10cnVlfSx0aGlzLm9wdGlvbnMuZGVsYXkpO2lmKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoYSkmJnRoaXMuX21vdXNlRGVsYXlNZXQoYSkpe3RoaXMuX21vdXNlU3RhcnRlZD10aGlzLl9tb3VzZVN0YXJ0KGEpIT09ZmFsc2U7aWYoIXRoaXMuX21vdXNlU3RhcnRlZCl7YS5wcmV2ZW50RGVmYXVsdCgpOwpyZXR1cm4gdHJ1ZX19dGhpcy5fbW91c2VNb3ZlRGVsZWdhdGU9ZnVuY3Rpb24oZCl7cmV0dXJuIGIuX21vdXNlTW92ZShkKX07dGhpcy5fbW91c2VVcERlbGVnYXRlPWZ1bmN0aW9uKGQpe3JldHVybiBiLl9tb3VzZVVwKGQpfTtjKGRvY3VtZW50KS5iaW5kKCJtb3VzZW1vdmUuIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLmJpbmQoIm1vdXNldXAuIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VVcERlbGVnYXRlKTtjLmJyb3dzZXIuc2FmYXJpfHxhLnByZXZlbnREZWZhdWx0KCk7cmV0dXJuIGEub3JpZ2luYWxFdmVudC5tb3VzZUhhbmRsZWQ9dHJ1ZX19LF9tb3VzZU1vdmU6ZnVuY3Rpb24oYSl7aWYoYy5icm93c2VyLm1zaWUmJiFhLmJ1dHRvbilyZXR1cm4gdGhpcy5fbW91c2VVcChhKTtpZih0aGlzLl9tb3VzZVN0YXJ0ZWQpe3RoaXMuX21vdXNlRHJhZyhhKTtyZXR1cm4gYS5wcmV2ZW50RGVmYXVsdCgpfWlmKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoYSkmJgp0aGlzLl9tb3VzZURlbGF5TWV0KGEpKSh0aGlzLl9tb3VzZVN0YXJ0ZWQ9dGhpcy5fbW91c2VTdGFydCh0aGlzLl9tb3VzZURvd25FdmVudCxhKSE9PWZhbHNlKT90aGlzLl9tb3VzZURyYWcoYSk6dGhpcy5fbW91c2VVcChhKTtyZXR1cm4hdGhpcy5fbW91c2VTdGFydGVkfSxfbW91c2VVcDpmdW5jdGlvbihhKXtjKGRvY3VtZW50KS51bmJpbmQoIm1vdXNlbW92ZS4iK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSkudW5iaW5kKCJtb3VzZXVwLiIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSk7aWYodGhpcy5fbW91c2VTdGFydGVkKXt0aGlzLl9tb3VzZVN0YXJ0ZWQ9ZmFsc2U7dGhpcy5fcHJldmVudENsaWNrRXZlbnQ9YS50YXJnZXQ9PXRoaXMuX21vdXNlRG93bkV2ZW50LnRhcmdldDt0aGlzLl9tb3VzZVN0b3AoYSl9cmV0dXJuIGZhbHNlfSxfbW91c2VEaXN0YW5jZU1ldDpmdW5jdGlvbihhKXtyZXR1cm4gTWF0aC5tYXgoTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVgtCmEucGFnZVgpLE1hdGguYWJzKHRoaXMuX21vdXNlRG93bkV2ZW50LnBhZ2VZLWEucGFnZVkpKT49dGhpcy5vcHRpb25zLmRpc3RhbmNlfSxfbW91c2VEZWxheU1ldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1vdXNlRGVsYXlNZXR9LF9tb3VzZVN0YXJ0OmZ1bmN0aW9uKCl7fSxfbW91c2VEcmFnOmZ1bmN0aW9uKCl7fSxfbW91c2VTdG9wOmZ1bmN0aW9uKCl7fSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKCl7cmV0dXJuIHRydWV9fSl9KShqUXVlcnkpOwooZnVuY3Rpb24oZCl7ZC53aWRnZXQoInVpLmRyYWdnYWJsZSIsZC51aS5tb3VzZSx7d2lkZ2V0RXZlbnRQcmVmaXg6ImRyYWciLG9wdGlvbnM6e2FkZENsYXNzZXM6dHJ1ZSxhcHBlbmRUbzoicGFyZW50IixheGlzOmZhbHNlLGNvbm5lY3RUb1NvcnRhYmxlOmZhbHNlLGNvbnRhaW5tZW50OmZhbHNlLGN1cnNvcjoiYXV0byIsY3Vyc29yQXQ6ZmFsc2UsZ3JpZDpmYWxzZSxoYW5kbGU6ZmFsc2UsaGVscGVyOiJvcmlnaW5hbCIsaWZyYW1lRml4OmZhbHNlLG9wYWNpdHk6ZmFsc2UscmVmcmVzaFBvc2l0aW9uczpmYWxzZSxyZXZlcnQ6ZmFsc2UscmV2ZXJ0RHVyYXRpb246NTAwLHNjb3BlOiJkZWZhdWx0IixzY3JvbGw6dHJ1ZSxzY3JvbGxTZW5zaXRpdml0eToyMCxzY3JvbGxTcGVlZDoyMCxzbmFwOmZhbHNlLHNuYXBNb2RlOiJib3RoIixzbmFwVG9sZXJhbmNlOjIwLHN0YWNrOmZhbHNlLHpJbmRleDpmYWxzZX0sX2NyZWF0ZTpmdW5jdGlvbigpe2lmKHRoaXMub3B0aW9ucy5oZWxwZXI9PQoib3JpZ2luYWwiJiYhL14oPzpyfGF8ZikvLnRlc3QodGhpcy5lbGVtZW50LmNzcygicG9zaXRpb24iKSkpdGhpcy5lbGVtZW50WzBdLnN0eWxlLnBvc2l0aW9uPSJyZWxhdGl2ZSI7dGhpcy5vcHRpb25zLmFkZENsYXNzZXMmJnRoaXMuZWxlbWVudC5hZGRDbGFzcygidWktZHJhZ2dhYmxlIik7dGhpcy5vcHRpb25zLmRpc2FibGVkJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLWRyYWdnYWJsZS1kaXNhYmxlZCIpO3RoaXMuX21vdXNlSW5pdCgpfSxkZXN0cm95OmZ1bmN0aW9uKCl7aWYodGhpcy5lbGVtZW50LmRhdGEoImRyYWdnYWJsZSIpKXt0aGlzLmVsZW1lbnQucmVtb3ZlRGF0YSgiZHJhZ2dhYmxlIikudW5iaW5kKCIuZHJhZ2dhYmxlIikucmVtb3ZlQ2xhc3MoInVpLWRyYWdnYWJsZSB1aS1kcmFnZ2FibGUtZHJhZ2dpbmcgdWktZHJhZ2dhYmxlLWRpc2FibGVkIik7dGhpcy5fbW91c2VEZXN0cm95KCk7cmV0dXJuIHRoaXN9fSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKGEpe3ZhciBiPQp0aGlzLm9wdGlvbnM7aWYodGhpcy5oZWxwZXJ8fGIuZGlzYWJsZWR8fGQoYS50YXJnZXQpLmlzKCIudWktcmVzaXphYmxlLWhhbmRsZSIpKXJldHVybiBmYWxzZTt0aGlzLmhhbmRsZT10aGlzLl9nZXRIYW5kbGUoYSk7aWYoIXRoaXMuaGFuZGxlKXJldHVybiBmYWxzZTtyZXR1cm4gdHJ1ZX0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5vcHRpb25zO3RoaXMuaGVscGVyPXRoaXMuX2NyZWF0ZUhlbHBlcihhKTt0aGlzLl9jYWNoZUhlbHBlclByb3BvcnRpb25zKCk7aWYoZC51aS5kZG1hbmFnZXIpZC51aS5kZG1hbmFnZXIuY3VycmVudD10aGlzO3RoaXMuX2NhY2hlTWFyZ2lucygpO3RoaXMuY3NzUG9zaXRpb249dGhpcy5oZWxwZXIuY3NzKCJwb3NpdGlvbiIpO3RoaXMuc2Nyb2xsUGFyZW50PXRoaXMuaGVscGVyLnNjcm9sbFBhcmVudCgpO3RoaXMub2Zmc2V0PXRoaXMucG9zaXRpb25BYnM9dGhpcy5lbGVtZW50Lm9mZnNldCgpO3RoaXMub2Zmc2V0PXt0b3A6dGhpcy5vZmZzZXQudG9wLQp0aGlzLm1hcmdpbnMudG9wLGxlZnQ6dGhpcy5vZmZzZXQubGVmdC10aGlzLm1hcmdpbnMubGVmdH07ZC5leHRlbmQodGhpcy5vZmZzZXQse2NsaWNrOntsZWZ0OmEucGFnZVgtdGhpcy5vZmZzZXQubGVmdCx0b3A6YS5wYWdlWS10aGlzLm9mZnNldC50b3B9LHBhcmVudDp0aGlzLl9nZXRQYXJlbnRPZmZzZXQoKSxyZWxhdGl2ZTp0aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpfSk7dGhpcy5vcmlnaW5hbFBvc2l0aW9uPXRoaXMucG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbihhKTt0aGlzLm9yaWdpbmFsUGFnZVg9YS5wYWdlWDt0aGlzLm9yaWdpbmFsUGFnZVk9YS5wYWdlWTtiLmN1cnNvckF0JiZ0aGlzLl9hZGp1c3RPZmZzZXRGcm9tSGVscGVyKGIuY3Vyc29yQXQpO2IuY29udGFpbm1lbnQmJnRoaXMuX3NldENvbnRhaW5tZW50KCk7aWYodGhpcy5fdHJpZ2dlcigic3RhcnQiLGEpPT09ZmFsc2Upe3RoaXMuX2NsZWFyKCk7cmV0dXJuIGZhbHNlfXRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKTsKZC51aS5kZG1hbmFnZXImJiFiLmRyb3BCZWhhdmlvdXImJmQudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsYSk7dGhpcy5oZWxwZXIuYWRkQ2xhc3MoInVpLWRyYWdnYWJsZS1kcmFnZ2luZyIpO3RoaXMuX21vdXNlRHJhZyhhLHRydWUpO3JldHVybiB0cnVlfSxfbW91c2VEcmFnOmZ1bmN0aW9uKGEsYil7dGhpcy5wb3NpdGlvbj10aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKGEpO3RoaXMucG9zaXRpb25BYnM9dGhpcy5fY29udmVydFBvc2l0aW9uVG8oImFic29sdXRlIik7aWYoIWIpe2I9dGhpcy5fdWlIYXNoKCk7aWYodGhpcy5fdHJpZ2dlcigiZHJhZyIsYSxiKT09PWZhbHNlKXt0aGlzLl9tb3VzZVVwKHt9KTtyZXR1cm4gZmFsc2V9dGhpcy5wb3NpdGlvbj1iLnBvc2l0aW9ufWlmKCF0aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5vcHRpb25zLmF4aXMhPSJ5Iil0aGlzLmhlbHBlclswXS5zdHlsZS5sZWZ0PXRoaXMucG9zaXRpb24ubGVmdCsicHgiO2lmKCF0aGlzLm9wdGlvbnMuYXhpc3x8CnRoaXMub3B0aW9ucy5heGlzIT0ieCIpdGhpcy5oZWxwZXJbMF0uc3R5bGUudG9wPXRoaXMucG9zaXRpb24udG9wKyJweCI7ZC51aS5kZG1hbmFnZXImJmQudWkuZGRtYW5hZ2VyLmRyYWcodGhpcyxhKTtyZXR1cm4gZmFsc2V9LF9tb3VzZVN0b3A6ZnVuY3Rpb24oYSl7dmFyIGI9ZmFsc2U7aWYoZC51aS5kZG1hbmFnZXImJiF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91ciliPWQudWkuZGRtYW5hZ2VyLmRyb3AodGhpcyxhKTtpZih0aGlzLmRyb3BwZWQpe2I9dGhpcy5kcm9wcGVkO3RoaXMuZHJvcHBlZD1mYWxzZX1pZighdGhpcy5lbGVtZW50WzBdfHwhdGhpcy5lbGVtZW50WzBdLnBhcmVudE5vZGUpcmV0dXJuIGZhbHNlO2lmKHRoaXMub3B0aW9ucy5yZXZlcnQ9PSJpbnZhbGlkIiYmIWJ8fHRoaXMub3B0aW9ucy5yZXZlcnQ9PSJ2YWxpZCImJmJ8fHRoaXMub3B0aW9ucy5yZXZlcnQ9PT10cnVlfHxkLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLnJldmVydCkmJnRoaXMub3B0aW9ucy5yZXZlcnQuY2FsbCh0aGlzLmVsZW1lbnQsCmIpKXt2YXIgYz10aGlzO2QodGhpcy5oZWxwZXIpLmFuaW1hdGUodGhpcy5vcmlnaW5hbFBvc2l0aW9uLHBhcnNlSW50KHRoaXMub3B0aW9ucy5yZXZlcnREdXJhdGlvbiwxMCksZnVuY3Rpb24oKXtjLl90cmlnZ2VyKCJzdG9wIixhKSE9PWZhbHNlJiZjLl9jbGVhcigpfSl9ZWxzZSB0aGlzLl90cmlnZ2VyKCJzdG9wIixhKSE9PWZhbHNlJiZ0aGlzLl9jbGVhcigpO3JldHVybiBmYWxzZX0sY2FuY2VsOmZ1bmN0aW9uKCl7dGhpcy5oZWxwZXIuaXMoIi51aS1kcmFnZ2FibGUtZHJhZ2dpbmciKT90aGlzLl9tb3VzZVVwKHt9KTp0aGlzLl9jbGVhcigpO3JldHVybiB0aGlzfSxfZ2V0SGFuZGxlOmZ1bmN0aW9uKGEpe3ZhciBiPSF0aGlzLm9wdGlvbnMuaGFuZGxlfHwhZCh0aGlzLm9wdGlvbnMuaGFuZGxlLHRoaXMuZWxlbWVudCkubGVuZ3RoP3RydWU6ZmFsc2U7ZCh0aGlzLm9wdGlvbnMuaGFuZGxlLHRoaXMuZWxlbWVudCkuZmluZCgiKiIpLmFuZFNlbGYoKS5lYWNoKGZ1bmN0aW9uKCl7aWYodGhpcz09CmEudGFyZ2V0KWI9dHJ1ZX0pO3JldHVybiBifSxfY3JlYXRlSGVscGVyOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMub3B0aW9uczthPWQuaXNGdW5jdGlvbihiLmhlbHBlcik/ZChiLmhlbHBlci5hcHBseSh0aGlzLmVsZW1lbnRbMF0sW2FdKSk6Yi5oZWxwZXI9PSJjbG9uZSI/dGhpcy5lbGVtZW50LmNsb25lKCk6dGhpcy5lbGVtZW50O2EucGFyZW50cygiYm9keSIpLmxlbmd0aHx8YS5hcHBlbmRUbyhiLmFwcGVuZFRvPT0icGFyZW50Ij90aGlzLmVsZW1lbnRbMF0ucGFyZW50Tm9kZTpiLmFwcGVuZFRvKTthWzBdIT10aGlzLmVsZW1lbnRbMF0mJiEvKGZpeGVkfGFic29sdXRlKS8udGVzdChhLmNzcygicG9zaXRpb24iKSkmJmEuY3NzKCJwb3NpdGlvbiIsImFic29sdXRlIik7cmV0dXJuIGF9LF9hZGp1c3RPZmZzZXRGcm9tSGVscGVyOmZ1bmN0aW9uKGEpe2lmKHR5cGVvZiBhPT0ic3RyaW5nIilhPWEuc3BsaXQoIiAiKTtpZihkLmlzQXJyYXkoYSkpYT17bGVmdDorYVswXSx0b3A6K2FbMV18fAowfTtpZigibGVmdCJpbiBhKXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ9YS5sZWZ0K3RoaXMubWFyZ2lucy5sZWZ0O2lmKCJyaWdodCJpbiBhKXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC1hLnJpZ2h0K3RoaXMubWFyZ2lucy5sZWZ0O2lmKCJ0b3AiaW4gYSl0aGlzLm9mZnNldC5jbGljay50b3A9YS50b3ArdGhpcy5tYXJnaW5zLnRvcDtpZigiYm90dG9tImluIGEpdGhpcy5vZmZzZXQuY2xpY2sudG9wPXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LWEuYm90dG9tK3RoaXMubWFyZ2lucy50b3B9LF9nZXRQYXJlbnRPZmZzZXQ6ZnVuY3Rpb24oKXt0aGlzLm9mZnNldFBhcmVudD10aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKTt2YXIgYT10aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKTtpZih0aGlzLmNzc1Bvc2l0aW9uPT0iYWJzb2x1dGUiJiZ0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmQudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sCnRoaXMub2Zmc2V0UGFyZW50WzBdKSl7YS5sZWZ0Kz10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk7YS50b3ArPXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpfWlmKHRoaXMub2Zmc2V0UGFyZW50WzBdPT1kb2N1bWVudC5ib2R5fHx0aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lJiZ0aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCk9PSJodG1sIiYmZC5icm93c2VyLm1zaWUpYT17dG9wOjAsbGVmdDowfTtyZXR1cm57dG9wOmEudG9wKyhwYXJzZUludCh0aGlzLm9mZnNldFBhcmVudC5jc3MoImJvcmRlclRvcFdpZHRoIiksMTApfHwwKSxsZWZ0OmEubGVmdCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwxMCl8fDApfX0sX2dldFJlbGF0aXZlT2Zmc2V0OmZ1bmN0aW9uKCl7aWYodGhpcy5jc3NQb3NpdGlvbj09InJlbGF0aXZlIil7dmFyIGE9dGhpcy5lbGVtZW50LnBvc2l0aW9uKCk7cmV0dXJue3RvcDphLnRvcC0KKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcygidG9wIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSxsZWZ0OmEubGVmdC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKCJsZWZ0IiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCl9fWVsc2UgcmV0dXJue3RvcDowLGxlZnQ6MH19LF9jYWNoZU1hcmdpbnM6ZnVuY3Rpb24oKXt0aGlzLm1hcmdpbnM9e2xlZnQ6cGFyc2VJbnQodGhpcy5lbGVtZW50LmNzcygibWFyZ2luTGVmdCIpLDEwKXx8MCx0b3A6cGFyc2VJbnQodGhpcy5lbGVtZW50LmNzcygibWFyZ2luVG9wIiksMTApfHwwfX0sX2NhY2hlSGVscGVyUHJvcG9ydGlvbnM6ZnVuY3Rpb24oKXt0aGlzLmhlbHBlclByb3BvcnRpb25zPXt3aWR0aDp0aGlzLmhlbHBlci5vdXRlcldpZHRoKCksaGVpZ2h0OnRoaXMuaGVscGVyLm91dGVySGVpZ2h0KCl9fSxfc2V0Q29udGFpbm1lbnQ6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnM7aWYoYS5jb250YWlubWVudD09CiJwYXJlbnQiKWEuY29udGFpbm1lbnQ9dGhpcy5oZWxwZXJbMF0ucGFyZW50Tm9kZTtpZihhLmNvbnRhaW5tZW50PT0iZG9jdW1lbnQifHxhLmNvbnRhaW5tZW50PT0id2luZG93Iil0aGlzLmNvbnRhaW5tZW50PVswLXRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQtdGhpcy5vZmZzZXQucGFyZW50LmxlZnQsMC10aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcCxkKGEuY29udGFpbm1lbnQ9PSJkb2N1bWVudCI/ZG9jdW1lbnQ6d2luZG93KS53aWR0aCgpLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtdGhpcy5tYXJnaW5zLmxlZnQsKGQoYS5jb250YWlubWVudD09ImRvY3VtZW50Ij9kb2N1bWVudDp3aW5kb3cpLmhlaWdodCgpfHxkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wXTtpZighL14oZG9jdW1lbnR8d2luZG93fHBhcmVudCkkLy50ZXN0KGEuY29udGFpbm1lbnQpJiYKYS5jb250YWlubWVudC5jb25zdHJ1Y3RvciE9QXJyYXkpe3ZhciBiPWQoYS5jb250YWlubWVudClbMF07aWYoYil7YT1kKGEuY29udGFpbm1lbnQpLm9mZnNldCgpO3ZhciBjPWQoYikuY3NzKCJvdmVyZmxvdyIpIT0iaGlkZGVuIjt0aGlzLmNvbnRhaW5tZW50PVthLmxlZnQrKHBhcnNlSW50KGQoYikuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwxMCl8fDApKyhwYXJzZUludChkKGIpLmNzcygicGFkZGluZ0xlZnQiKSwxMCl8fDApLXRoaXMubWFyZ2lucy5sZWZ0LGEudG9wKyhwYXJzZUludChkKGIpLmNzcygiYm9yZGVyVG9wV2lkdGgiKSwxMCl8fDApKyhwYXJzZUludChkKGIpLmNzcygicGFkZGluZ1RvcCIpLDEwKXx8MCktdGhpcy5tYXJnaW5zLnRvcCxhLmxlZnQrKGM/TWF0aC5tYXgoYi5zY3JvbGxXaWR0aCxiLm9mZnNldFdpZHRoKTpiLm9mZnNldFdpZHRoKS0ocGFyc2VJbnQoZChiKS5jc3MoImJvcmRlckxlZnRXaWR0aCIpLDEwKXx8MCktKHBhcnNlSW50KGQoYikuY3NzKCJwYWRkaW5nUmlnaHQiKSwKMTApfHwwKS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLXRoaXMubWFyZ2lucy5sZWZ0LGEudG9wKyhjP01hdGgubWF4KGIuc2Nyb2xsSGVpZ2h0LGIub2Zmc2V0SGVpZ2h0KTpiLm9mZnNldEhlaWdodCktKHBhcnNlSW50KGQoYikuY3NzKCJib3JkZXJUb3BXaWR0aCIpLDEwKXx8MCktKHBhcnNlSW50KGQoYikuY3NzKCJwYWRkaW5nQm90dG9tIiksMTApfHwwKS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wXX19ZWxzZSBpZihhLmNvbnRhaW5tZW50LmNvbnN0cnVjdG9yPT1BcnJheSl0aGlzLmNvbnRhaW5tZW50PWEuY29udGFpbm1lbnR9LF9jb252ZXJ0UG9zaXRpb25UbzpmdW5jdGlvbihhLGIpe2lmKCFiKWI9dGhpcy5wb3NpdGlvbjthPWE9PSJhYnNvbHV0ZSI/MTotMTt2YXIgYz10aGlzLmNzc1Bvc2l0aW9uPT0iYWJzb2x1dGUiJiYhKHRoaXMuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmZC51aS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSwKdGhpcy5vZmZzZXRQYXJlbnRbMF0pKT90aGlzLm9mZnNldFBhcmVudDp0aGlzLnNjcm9sbFBhcmVudCxmPS8oaHRtbHxib2R5KS9pLnRlc3QoY1swXS50YWdOYW1lKTtyZXR1cm57dG9wOmIudG9wK3RoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcCphK3RoaXMub2Zmc2V0LnBhcmVudC50b3AqYS0oZC5icm93c2VyLnNhZmFyaSYmZC5icm93c2VyLnZlcnNpb248NTI2JiZ0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPzA6KHRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpOmY/MDpjLnNjcm9sbFRvcCgpKSphKSxsZWZ0OmIubGVmdCt0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0KmErdGhpcy5vZmZzZXQucGFyZW50LmxlZnQqYS0oZC5icm93c2VyLnNhZmFyaSYmZC5icm93c2VyLnZlcnNpb248NTI2JiZ0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPzA6KHRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKToKZj8wOmMuc2Nyb2xsTGVmdCgpKSphKX19LF9nZW5lcmF0ZVBvc2l0aW9uOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMub3B0aW9ucyxjPXRoaXMuY3NzUG9zaXRpb249PSJhYnNvbHV0ZSImJiEodGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZkLnVpLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSk/dGhpcy5vZmZzZXRQYXJlbnQ6dGhpcy5zY3JvbGxQYXJlbnQsZj0vKGh0bWx8Ym9keSkvaS50ZXN0KGNbMF0udGFnTmFtZSksZT1hLnBhZ2VYLGc9YS5wYWdlWTtpZih0aGlzLm9yaWdpbmFsUG9zaXRpb24pe2lmKHRoaXMuY29udGFpbm1lbnQpe2lmKGEucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdDx0aGlzLmNvbnRhaW5tZW50WzBdKWU9dGhpcy5jb250YWlubWVudFswXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0O2lmKGEucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPHRoaXMuY29udGFpbm1lbnRbMV0pZz10aGlzLmNvbnRhaW5tZW50WzFdKwp0aGlzLm9mZnNldC5jbGljay50b3A7aWYoYS5wYWdlWC10aGlzLm9mZnNldC5jbGljay5sZWZ0PnRoaXMuY29udGFpbm1lbnRbMl0pZT10aGlzLmNvbnRhaW5tZW50WzJdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQ7aWYoYS5wYWdlWS10aGlzLm9mZnNldC5jbGljay50b3A+dGhpcy5jb250YWlubWVudFszXSlnPXRoaXMuY29udGFpbm1lbnRbM10rdGhpcy5vZmZzZXQuY2xpY2sudG9wfWlmKGIuZ3JpZCl7Zz10aGlzLm9yaWdpbmFsUGFnZVkrTWF0aC5yb3VuZCgoZy10aGlzLm9yaWdpbmFsUGFnZVkpL2IuZ3JpZFsxXSkqYi5ncmlkWzFdO2c9dGhpcy5jb250YWlubWVudD8hKGctdGhpcy5vZmZzZXQuY2xpY2sudG9wPHRoaXMuY29udGFpbm1lbnRbMV18fGctdGhpcy5vZmZzZXQuY2xpY2sudG9wPnRoaXMuY29udGFpbm1lbnRbM10pP2c6IShnLXRoaXMub2Zmc2V0LmNsaWNrLnRvcDx0aGlzLmNvbnRhaW5tZW50WzFdKT9nLWIuZ3JpZFsxXTpnK2IuZ3JpZFsxXTpnO2U9dGhpcy5vcmlnaW5hbFBhZ2VYKwpNYXRoLnJvdW5kKChlLXRoaXMub3JpZ2luYWxQYWdlWCkvYi5ncmlkWzBdKSpiLmdyaWRbMF07ZT10aGlzLmNvbnRhaW5tZW50PyEoZS10aGlzLm9mZnNldC5jbGljay5sZWZ0PHRoaXMuY29udGFpbm1lbnRbMF18fGUtdGhpcy5vZmZzZXQuY2xpY2subGVmdD50aGlzLmNvbnRhaW5tZW50WzJdKT9lOiEoZS10aGlzLm9mZnNldC5jbGljay5sZWZ0PHRoaXMuY29udGFpbm1lbnRbMF0pP2UtYi5ncmlkWzBdOmUrYi5ncmlkWzBdOmV9fXJldHVybnt0b3A6Zy10aGlzLm9mZnNldC5jbGljay50b3AtdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3ArKGQuYnJvd3Nlci5zYWZhcmkmJmQuYnJvd3Nlci52ZXJzaW9uPDUyNiYmdGhpcy5jc3NQb3NpdGlvbj09ImZpeGVkIj8wOnRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpOmY/MDpjLnNjcm9sbFRvcCgpKSxsZWZ0OmUtdGhpcy5vZmZzZXQuY2xpY2subGVmdC0KdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCsoZC5icm93c2VyLnNhZmFyaSYmZC5icm93c2VyLnZlcnNpb248NTI2JiZ0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPzA6dGhpcy5jc3NQb3NpdGlvbj09ImZpeGVkIj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOmY/MDpjLnNjcm9sbExlZnQoKSl9fSxfY2xlYXI6ZnVuY3Rpb24oKXt0aGlzLmhlbHBlci5yZW1vdmVDbGFzcygidWktZHJhZ2dhYmxlLWRyYWdnaW5nIik7dGhpcy5oZWxwZXJbMF0hPXRoaXMuZWxlbWVudFswXSYmIXRoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbCYmdGhpcy5oZWxwZXIucmVtb3ZlKCk7dGhpcy5oZWxwZXI9bnVsbDt0aGlzLmNhbmNlbEhlbHBlclJlbW92YWw9ZmFsc2V9LF90cmlnZ2VyOmZ1bmN0aW9uKGEsYixjKXtjPWN8fHRoaXMuX3VpSGFzaCgpO2QudWkucGx1Z2luLmNhbGwodGhpcyxhLFtiLGNdKTtpZihhPT0iZHJhZyIpdGhpcy5wb3NpdGlvbkFicz0KdGhpcy5fY29udmVydFBvc2l0aW9uVG8oImFic29sdXRlIik7cmV0dXJuIGQuV2lkZ2V0LnByb3RvdHlwZS5fdHJpZ2dlci5jYWxsKHRoaXMsYSxiLGMpfSxwbHVnaW5zOnt9LF91aUhhc2g6ZnVuY3Rpb24oKXtyZXR1cm57aGVscGVyOnRoaXMuaGVscGVyLHBvc2l0aW9uOnRoaXMucG9zaXRpb24sb3JpZ2luYWxQb3NpdGlvbjp0aGlzLm9yaWdpbmFsUG9zaXRpb24sb2Zmc2V0OnRoaXMucG9zaXRpb25BYnN9fX0pO2QuZXh0ZW5kKGQudWkuZHJhZ2dhYmxlLHt2ZXJzaW9uOiIxLjguNSJ9KTtkLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsImNvbm5lY3RUb1NvcnRhYmxlIix7c3RhcnQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz1kKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpLGY9Yy5vcHRpb25zLGU9ZC5leHRlbmQoe30sYix7aXRlbTpjLmVsZW1lbnR9KTtjLnNvcnRhYmxlcz1bXTtkKGYuY29ubmVjdFRvU29ydGFibGUpLmVhY2goZnVuY3Rpb24oKXt2YXIgZz1kLmRhdGEodGhpcywic29ydGFibGUiKTsKaWYoZyYmIWcub3B0aW9ucy5kaXNhYmxlZCl7Yy5zb3J0YWJsZXMucHVzaCh7aW5zdGFuY2U6ZyxzaG91bGRSZXZlcnQ6Zy5vcHRpb25zLnJldmVydH0pO2cuX3JlZnJlc2hJdGVtcygpO2cuX3RyaWdnZXIoImFjdGl2YXRlIixhLGUpfX0pfSxzdG9wOmZ1bmN0aW9uKGEsYil7dmFyIGM9ZCh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKSxmPWQuZXh0ZW5kKHt9LGIse2l0ZW06Yy5lbGVtZW50fSk7ZC5lYWNoKGMuc29ydGFibGVzLGZ1bmN0aW9uKCl7aWYodGhpcy5pbnN0YW5jZS5pc092ZXIpe3RoaXMuaW5zdGFuY2UuaXNPdmVyPTA7Yy5jYW5jZWxIZWxwZXJSZW1vdmFsPXRydWU7dGhpcy5pbnN0YW5jZS5jYW5jZWxIZWxwZXJSZW1vdmFsPWZhbHNlO2lmKHRoaXMuc2hvdWxkUmV2ZXJ0KXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5yZXZlcnQ9dHJ1ZTt0aGlzLmluc3RhbmNlLl9tb3VzZVN0b3AoYSk7dGhpcy5pbnN0YW5jZS5vcHRpb25zLmhlbHBlcj10aGlzLmluc3RhbmNlLm9wdGlvbnMuX2hlbHBlcjsKYy5vcHRpb25zLmhlbHBlcj09Im9yaWdpbmFsIiYmdGhpcy5pbnN0YW5jZS5jdXJyZW50SXRlbS5jc3Moe3RvcDoiYXV0byIsbGVmdDoiYXV0byJ9KX1lbHNle3RoaXMuaW5zdGFuY2UuY2FuY2VsSGVscGVyUmVtb3ZhbD1mYWxzZTt0aGlzLmluc3RhbmNlLl90cmlnZ2VyKCJkZWFjdGl2YXRlIixhLGYpfX0pfSxkcmFnOmZ1bmN0aW9uKGEsYil7dmFyIGM9ZCh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKSxmPXRoaXM7ZC5lYWNoKGMuc29ydGFibGVzLGZ1bmN0aW9uKCl7dGhpcy5pbnN0YW5jZS5wb3NpdGlvbkFicz1jLnBvc2l0aW9uQWJzO3RoaXMuaW5zdGFuY2UuaGVscGVyUHJvcG9ydGlvbnM9Yy5oZWxwZXJQcm9wb3J0aW9uczt0aGlzLmluc3RhbmNlLm9mZnNldC5jbGljaz1jLm9mZnNldC5jbGljaztpZih0aGlzLmluc3RhbmNlLl9pbnRlcnNlY3RzV2l0aCh0aGlzLmluc3RhbmNlLmNvbnRhaW5lckNhY2hlKSl7aWYoIXRoaXMuaW5zdGFuY2UuaXNPdmVyKXt0aGlzLmluc3RhbmNlLmlzT3Zlcj0KMTt0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtPWQoZikuY2xvbmUoKS5hcHBlbmRUbyh0aGlzLmluc3RhbmNlLmVsZW1lbnQpLmRhdGEoInNvcnRhYmxlLWl0ZW0iLHRydWUpO3RoaXMuaW5zdGFuY2Uub3B0aW9ucy5faGVscGVyPXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5oZWxwZXI7dGhpcy5pbnN0YW5jZS5vcHRpb25zLmhlbHBlcj1mdW5jdGlvbigpe3JldHVybiBiLmhlbHBlclswXX07YS50YXJnZXQ9dGhpcy5pbnN0YW5jZS5jdXJyZW50SXRlbVswXTt0aGlzLmluc3RhbmNlLl9tb3VzZUNhcHR1cmUoYSx0cnVlKTt0aGlzLmluc3RhbmNlLl9tb3VzZVN0YXJ0KGEsdHJ1ZSx0cnVlKTt0aGlzLmluc3RhbmNlLm9mZnNldC5jbGljay50b3A9Yy5vZmZzZXQuY2xpY2sudG9wO3RoaXMuaW5zdGFuY2Uub2Zmc2V0LmNsaWNrLmxlZnQ9Yy5vZmZzZXQuY2xpY2subGVmdDt0aGlzLmluc3RhbmNlLm9mZnNldC5wYXJlbnQubGVmdC09Yy5vZmZzZXQucGFyZW50LmxlZnQtdGhpcy5pbnN0YW5jZS5vZmZzZXQucGFyZW50LmxlZnQ7CnRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC50b3AtPWMub2Zmc2V0LnBhcmVudC50b3AtdGhpcy5pbnN0YW5jZS5vZmZzZXQucGFyZW50LnRvcDtjLl90cmlnZ2VyKCJ0b1NvcnRhYmxlIixhKTtjLmRyb3BwZWQ9dGhpcy5pbnN0YW5jZS5lbGVtZW50O2MuY3VycmVudEl0ZW09Yy5lbGVtZW50O3RoaXMuaW5zdGFuY2UuZnJvbU91dHNpZGU9Y310aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtJiZ0aGlzLmluc3RhbmNlLl9tb3VzZURyYWcoYSl9ZWxzZSBpZih0aGlzLmluc3RhbmNlLmlzT3Zlcil7dGhpcy5pbnN0YW5jZS5pc092ZXI9MDt0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWw9dHJ1ZTt0aGlzLmluc3RhbmNlLm9wdGlvbnMucmV2ZXJ0PWZhbHNlO3RoaXMuaW5zdGFuY2UuX3RyaWdnZXIoIm91dCIsYSx0aGlzLmluc3RhbmNlLl91aUhhc2godGhpcy5pbnN0YW5jZSkpO3RoaXMuaW5zdGFuY2UuX21vdXNlU3RvcChhLHRydWUpO3RoaXMuaW5zdGFuY2Uub3B0aW9ucy5oZWxwZXI9CnRoaXMuaW5zdGFuY2Uub3B0aW9ucy5faGVscGVyO3RoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW0ucmVtb3ZlKCk7dGhpcy5pbnN0YW5jZS5wbGFjZWhvbGRlciYmdGhpcy5pbnN0YW5jZS5wbGFjZWhvbGRlci5yZW1vdmUoKTtjLl90cmlnZ2VyKCJmcm9tU29ydGFibGUiLGEpO2MuZHJvcHBlZD1mYWxzZX19KX19KTtkLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsImN1cnNvciIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGE9ZCgiYm9keSIpLGI9ZCh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKS5vcHRpb25zO2lmKGEuY3NzKCJjdXJzb3IiKSliLl9jdXJzb3I9YS5jc3MoImN1cnNvciIpO2EuY3NzKCJjdXJzb3IiLGIuY3Vyc29yKX0sc3RvcDpmdW5jdGlvbigpe3ZhciBhPWQodGhpcykuZGF0YSgiZHJhZ2dhYmxlIikub3B0aW9uczthLl9jdXJzb3ImJmQoImJvZHkiKS5jc3MoImN1cnNvciIsYS5fY3Vyc29yKX19KTtkLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsImlmcmFtZUZpeCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGE9CmQodGhpcykuZGF0YSgiZHJhZ2dhYmxlIikub3B0aW9ucztkKGEuaWZyYW1lRml4PT09dHJ1ZT8iaWZyYW1lIjphLmlmcmFtZUZpeCkuZWFjaChmdW5jdGlvbigpe2QoJzxkaXYgY2xhc3M9InVpLWRyYWdnYWJsZS1pZnJhbWVGaXgiIHN0eWxlPSJiYWNrZ3JvdW5kOiAjZmZmOyI+PC9kaXY+JykuY3NzKHt3aWR0aDp0aGlzLm9mZnNldFdpZHRoKyJweCIsaGVpZ2h0OnRoaXMub2Zmc2V0SGVpZ2h0KyJweCIscG9zaXRpb246ImFic29sdXRlIixvcGFjaXR5OiIwLjAwMSIsekluZGV4OjFFM30pLmNzcyhkKHRoaXMpLm9mZnNldCgpKS5hcHBlbmRUbygiYm9keSIpfSl9LHN0b3A6ZnVuY3Rpb24oKXtkKCJkaXYudWktZHJhZ2dhYmxlLWlmcmFtZUZpeCIpLmVhY2goZnVuY3Rpb24oKXt0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcyl9KX19KTtkLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsIm9wYWNpdHkiLHtzdGFydDpmdW5jdGlvbihhLGIpe2E9ZChiLmhlbHBlcik7Yj1kKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpLm9wdGlvbnM7CmlmKGEuY3NzKCJvcGFjaXR5IikpYi5fb3BhY2l0eT1hLmNzcygib3BhY2l0eSIpO2EuY3NzKCJvcGFjaXR5IixiLm9wYWNpdHkpfSxzdG9wOmZ1bmN0aW9uKGEsYil7YT1kKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpLm9wdGlvbnM7YS5fb3BhY2l0eSYmZChiLmhlbHBlcikuY3NzKCJvcGFjaXR5IixhLl9vcGFjaXR5KX19KTtkLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsInNjcm9sbCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGE9ZCh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKTtpZihhLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmEuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUhPSJIVE1MIilhLm92ZXJmbG93T2Zmc2V0PWEuc2Nyb2xsUGFyZW50Lm9mZnNldCgpfSxkcmFnOmZ1bmN0aW9uKGEpe3ZhciBiPWQodGhpcykuZGF0YSgiZHJhZ2dhYmxlIiksYz1iLm9wdGlvbnMsZj1mYWxzZTtpZihiLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmIuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUhPQoiSFRNTCIpe2lmKCFjLmF4aXN8fGMuYXhpcyE9IngiKWlmKGIub3ZlcmZsb3dPZmZzZXQudG9wK2Iuc2Nyb2xsUGFyZW50WzBdLm9mZnNldEhlaWdodC1hLnBhZ2VZPGMuc2Nyb2xsU2Vuc2l0aXZpdHkpYi5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wPWY9Yi5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wK2Muc2Nyb2xsU3BlZWQ7ZWxzZSBpZihhLnBhZ2VZLWIub3ZlcmZsb3dPZmZzZXQudG9wPGMuc2Nyb2xsU2Vuc2l0aXZpdHkpYi5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wPWY9Yi5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wLWMuc2Nyb2xsU3BlZWQ7aWYoIWMuYXhpc3x8Yy5heGlzIT0ieSIpaWYoYi5vdmVyZmxvd09mZnNldC5sZWZ0K2Iuc2Nyb2xsUGFyZW50WzBdLm9mZnNldFdpZHRoLWEucGFnZVg8Yy5zY3JvbGxTZW5zaXRpdml0eSliLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0PWY9Yi5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdCtjLnNjcm9sbFNwZWVkO2Vsc2UgaWYoYS5wYWdlWC0KYi5vdmVyZmxvd09mZnNldC5sZWZ0PGMuc2Nyb2xsU2Vuc2l0aXZpdHkpYi5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1mPWIuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQtYy5zY3JvbGxTcGVlZH1lbHNle2lmKCFjLmF4aXN8fGMuYXhpcyE9IngiKWlmKGEucGFnZVktZChkb2N1bWVudCkuc2Nyb2xsVG9wKCk8Yy5zY3JvbGxTZW5zaXRpdml0eSlmPWQoZG9jdW1lbnQpLnNjcm9sbFRvcChkKGRvY3VtZW50KS5zY3JvbGxUb3AoKS1jLnNjcm9sbFNwZWVkKTtlbHNlIGlmKGQod2luZG93KS5oZWlnaHQoKS0oYS5wYWdlWS1kKGRvY3VtZW50KS5zY3JvbGxUb3AoKSk8Yy5zY3JvbGxTZW5zaXRpdml0eSlmPWQoZG9jdW1lbnQpLnNjcm9sbFRvcChkKGRvY3VtZW50KS5zY3JvbGxUb3AoKStjLnNjcm9sbFNwZWVkKTtpZighYy5heGlzfHxjLmF4aXMhPSJ5IilpZihhLnBhZ2VYLWQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKTxjLnNjcm9sbFNlbnNpdGl2aXR5KWY9ZChkb2N1bWVudCkuc2Nyb2xsTGVmdChkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCktCmMuc2Nyb2xsU3BlZWQpO2Vsc2UgaWYoZCh3aW5kb3cpLndpZHRoKCktKGEucGFnZVgtZChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpKTxjLnNjcm9sbFNlbnNpdGl2aXR5KWY9ZChkb2N1bWVudCkuc2Nyb2xsTGVmdChkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkrYy5zY3JvbGxTcGVlZCl9ZiE9PWZhbHNlJiZkLnVpLmRkbWFuYWdlciYmIWMuZHJvcEJlaGF2aW91ciYmZC51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoYixhKX19KTtkLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsInNuYXAiLHtzdGFydDpmdW5jdGlvbigpe3ZhciBhPWQodGhpcykuZGF0YSgiZHJhZ2dhYmxlIiksYj1hLm9wdGlvbnM7YS5zbmFwRWxlbWVudHM9W107ZChiLnNuYXAuY29uc3RydWN0b3IhPVN0cmluZz9iLnNuYXAuaXRlbXN8fCI6ZGF0YShkcmFnZ2FibGUpIjpiLnNuYXApLmVhY2goZnVuY3Rpb24oKXt2YXIgYz1kKHRoaXMpLGY9Yy5vZmZzZXQoKTt0aGlzIT1hLmVsZW1lbnRbMF0mJmEuc25hcEVsZW1lbnRzLnB1c2goe2l0ZW06dGhpcywKd2lkdGg6Yy5vdXRlcldpZHRoKCksaGVpZ2h0OmMub3V0ZXJIZWlnaHQoKSx0b3A6Zi50b3AsbGVmdDpmLmxlZnR9KX0pfSxkcmFnOmZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPWQodGhpcykuZGF0YSgiZHJhZ2dhYmxlIiksZj1jLm9wdGlvbnMsZT1mLnNuYXBUb2xlcmFuY2UsZz1iLm9mZnNldC5sZWZ0LG49ZytjLmhlbHBlclByb3BvcnRpb25zLndpZHRoLG09Yi5vZmZzZXQudG9wLG89bStjLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxoPWMuc25hcEVsZW1lbnRzLmxlbmd0aC0xO2g+PTA7aC0tKXt2YXIgaT1jLnNuYXBFbGVtZW50c1toXS5sZWZ0LGs9aStjLnNuYXBFbGVtZW50c1toXS53aWR0aCxqPWMuc25hcEVsZW1lbnRzW2hdLnRvcCxsPWorYy5zbmFwRWxlbWVudHNbaF0uaGVpZ2h0O2lmKGktZTxnJiZnPGsrZSYmai1lPG0mJm08bCtlfHxpLWU8ZyYmZzxrK2UmJmotZTxvJiZvPGwrZXx8aS1lPG4mJm48aytlJiZqLWU8bSYmbTxsK2V8fGktZTxuJiZuPGsrZSYmai1lPG8mJgpvPGwrZSl7aWYoZi5zbmFwTW9kZSE9ImlubmVyIil7dmFyIHA9TWF0aC5hYnMoai1vKTw9ZSxxPU1hdGguYWJzKGwtbSk8PWUscj1NYXRoLmFicyhpLW4pPD1lLHM9TWF0aC5hYnMoay1nKTw9ZTtpZihwKWIucG9zaXRpb24udG9wPWMuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIse3RvcDpqLWMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LGxlZnQ6MH0pLnRvcC1jLm1hcmdpbnMudG9wO2lmKHEpYi5wb3NpdGlvbi50b3A9Yy5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIix7dG9wOmwsbGVmdDowfSkudG9wLWMubWFyZ2lucy50b3A7aWYociliLnBvc2l0aW9uLmxlZnQ9Yy5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIix7dG9wOjAsbGVmdDppLWMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGh9KS5sZWZ0LWMubWFyZ2lucy5sZWZ0O2lmKHMpYi5wb3NpdGlvbi5sZWZ0PWMuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIse3RvcDowLGxlZnQ6a30pLmxlZnQtYy5tYXJnaW5zLmxlZnR9dmFyIHQ9CnB8fHF8fHJ8fHM7aWYoZi5zbmFwTW9kZSE9Im91dGVyIil7cD1NYXRoLmFicyhqLW0pPD1lO3E9TWF0aC5hYnMobC1vKTw9ZTtyPU1hdGguYWJzKGktZyk8PWU7cz1NYXRoLmFicyhrLW4pPD1lO2lmKHApYi5wb3NpdGlvbi50b3A9Yy5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIix7dG9wOmosbGVmdDowfSkudG9wLWMubWFyZ2lucy50b3A7aWYocSliLnBvc2l0aW9uLnRvcD1jLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLHt0b3A6bC1jLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxsZWZ0OjB9KS50b3AtYy5tYXJnaW5zLnRvcDtpZihyKWIucG9zaXRpb24ubGVmdD1jLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLHt0b3A6MCxsZWZ0Oml9KS5sZWZ0LWMubWFyZ2lucy5sZWZ0O2lmKHMpYi5wb3NpdGlvbi5sZWZ0PWMuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIse3RvcDowLGxlZnQ6ay1jLmhlbHBlclByb3BvcnRpb25zLndpZHRofSkubGVmdC1jLm1hcmdpbnMubGVmdH1pZighYy5zbmFwRWxlbWVudHNbaF0uc25hcHBpbmcmJgoocHx8cXx8cnx8c3x8dCkpYy5vcHRpb25zLnNuYXAuc25hcCYmYy5vcHRpb25zLnNuYXAuc25hcC5jYWxsKGMuZWxlbWVudCxhLGQuZXh0ZW5kKGMuX3VpSGFzaCgpLHtzbmFwSXRlbTpjLnNuYXBFbGVtZW50c1toXS5pdGVtfSkpO2Muc25hcEVsZW1lbnRzW2hdLnNuYXBwaW5nPXB8fHF8fHJ8fHN8fHR9ZWxzZXtjLnNuYXBFbGVtZW50c1toXS5zbmFwcGluZyYmYy5vcHRpb25zLnNuYXAucmVsZWFzZSYmYy5vcHRpb25zLnNuYXAucmVsZWFzZS5jYWxsKGMuZWxlbWVudCxhLGQuZXh0ZW5kKGMuX3VpSGFzaCgpLHtzbmFwSXRlbTpjLnNuYXBFbGVtZW50c1toXS5pdGVtfSkpO2Muc25hcEVsZW1lbnRzW2hdLnNuYXBwaW5nPWZhbHNlfX19fSk7ZC51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCJzdGFjayIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGE9ZCh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKS5vcHRpb25zO2E9ZC5tYWtlQXJyYXkoZChhLnN0YWNrKSkuc29ydChmdW5jdGlvbihjLGYpe3JldHVybihwYXJzZUludChkKGMpLmNzcygiekluZGV4IiksCjEwKXx8MCktKHBhcnNlSW50KGQoZikuY3NzKCJ6SW5kZXgiKSwxMCl8fDApfSk7aWYoYS5sZW5ndGgpe3ZhciBiPXBhcnNlSW50KGFbMF0uc3R5bGUuekluZGV4KXx8MDtkKGEpLmVhY2goZnVuY3Rpb24oYyl7dGhpcy5zdHlsZS56SW5kZXg9YitjfSk7dGhpc1swXS5zdHlsZS56SW5kZXg9YithLmxlbmd0aH19fSk7ZC51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCJ6SW5kZXgiLHtzdGFydDpmdW5jdGlvbihhLGIpe2E9ZChiLmhlbHBlcik7Yj1kKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpLm9wdGlvbnM7aWYoYS5jc3MoInpJbmRleCIpKWIuX3pJbmRleD1hLmNzcygiekluZGV4Iik7YS5jc3MoInpJbmRleCIsYi56SW5kZXgpfSxzdG9wOmZ1bmN0aW9uKGEsYil7YT1kKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpLm9wdGlvbnM7YS5fekluZGV4JiZkKGIuaGVscGVyKS5jc3MoInpJbmRleCIsYS5fekluZGV4KX19KX0pKGpRdWVyeSk7CihmdW5jdGlvbihkKXtkLndpZGdldCgidWkuZHJvcHBhYmxlIix7d2lkZ2V0RXZlbnRQcmVmaXg6ImRyb3AiLG9wdGlvbnM6e2FjY2VwdDoiKiIsYWN0aXZlQ2xhc3M6ZmFsc2UsYWRkQ2xhc3Nlczp0cnVlLGdyZWVkeTpmYWxzZSxob3ZlckNsYXNzOmZhbHNlLHNjb3BlOiJkZWZhdWx0Iix0b2xlcmFuY2U6ImludGVyc2VjdCJ9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnMsYj1hLmFjY2VwdDt0aGlzLmlzb3Zlcj0wO3RoaXMuaXNvdXQ9MTt0aGlzLmFjY2VwdD1kLmlzRnVuY3Rpb24oYik/YjpmdW5jdGlvbihjKXtyZXR1cm4gYy5pcyhiKX07dGhpcy5wcm9wb3J0aW9ucz17d2lkdGg6dGhpcy5lbGVtZW50WzBdLm9mZnNldFdpZHRoLGhlaWdodDp0aGlzLmVsZW1lbnRbMF0ub2Zmc2V0SGVpZ2h0fTtkLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Euc2NvcGVdPWQudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbYS5zY29wZV18fFtdO2QudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbYS5zY29wZV0ucHVzaCh0aGlzKTsKYS5hZGRDbGFzc2VzJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLWRyb3BwYWJsZSIpfSxkZXN0cm95OmZ1bmN0aW9uKCl7Zm9yKHZhciBhPWQudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbdGhpcy5vcHRpb25zLnNjb3BlXSxiPTA7YjxhLmxlbmd0aDtiKyspYVtiXT09dGhpcyYmYS5zcGxpY2UoYiwxKTt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLWRyb3BwYWJsZSB1aS1kcm9wcGFibGUtZGlzYWJsZWQiKS5yZW1vdmVEYXRhKCJkcm9wcGFibGUiKS51bmJpbmQoIi5kcm9wcGFibGUiKTtyZXR1cm4gdGhpc30sX3NldE9wdGlvbjpmdW5jdGlvbihhLGIpe2lmKGE9PSJhY2NlcHQiKXRoaXMuYWNjZXB0PWQuaXNGdW5jdGlvbihiKT9iOmZ1bmN0aW9uKGMpe3JldHVybiBjLmlzKGIpfTtkLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LF9hY3RpdmF0ZTpmdW5jdGlvbihhKXt2YXIgYj1kLnVpLmRkbWFuYWdlci5jdXJyZW50O3RoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyYmCnRoaXMuZWxlbWVudC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MpO2ImJnRoaXMuX3RyaWdnZXIoImFjdGl2YXRlIixhLHRoaXMudWkoYikpfSxfZGVhY3RpdmF0ZTpmdW5jdGlvbihhKXt2YXIgYj1kLnVpLmRkbWFuYWdlci5jdXJyZW50O3RoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyk7YiYmdGhpcy5fdHJpZ2dlcigiZGVhY3RpdmF0ZSIsYSx0aGlzLnVpKGIpKX0sX292ZXI6ZnVuY3Rpb24oYSl7dmFyIGI9ZC51aS5kZG1hbmFnZXIuY3VycmVudDtpZighKCFifHwoYi5jdXJyZW50SXRlbXx8Yi5lbGVtZW50KVswXT09dGhpcy5lbGVtZW50WzBdKSlpZih0aGlzLmFjY2VwdC5jYWxsKHRoaXMuZWxlbWVudFswXSxiLmN1cnJlbnRJdGVtfHxiLmVsZW1lbnQpKXt0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyYmdGhpcy5lbGVtZW50LmFkZENsYXNzKHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzKTsKdGhpcy5fdHJpZ2dlcigib3ZlciIsYSx0aGlzLnVpKGIpKX19LF9vdXQ6ZnVuY3Rpb24oYSl7dmFyIGI9ZC51aS5kZG1hbmFnZXIuY3VycmVudDtpZighKCFifHwoYi5jdXJyZW50SXRlbXx8Yi5lbGVtZW50KVswXT09dGhpcy5lbGVtZW50WzBdKSlpZih0aGlzLmFjY2VwdC5jYWxsKHRoaXMuZWxlbWVudFswXSxiLmN1cnJlbnRJdGVtfHxiLmVsZW1lbnQpKXt0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzKTt0aGlzLl90cmlnZ2VyKCJvdXQiLGEsdGhpcy51aShiKSl9fSxfZHJvcDpmdW5jdGlvbihhLGIpe3ZhciBjPWJ8fGQudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7aWYoIWN8fChjLmN1cnJlbnRJdGVtfHxjLmVsZW1lbnQpWzBdPT10aGlzLmVsZW1lbnRbMF0pcmV0dXJuIGZhbHNlO3ZhciBlPWZhbHNlO3RoaXMuZWxlbWVudC5maW5kKCI6ZGF0YShkcm9wcGFibGUpIikubm90KCIudWktZHJhZ2dhYmxlLWRyYWdnaW5nIikuZWFjaChmdW5jdGlvbigpe3ZhciBnPQpkLmRhdGEodGhpcywiZHJvcHBhYmxlIik7aWYoZy5vcHRpb25zLmdyZWVkeSYmIWcub3B0aW9ucy5kaXNhYmxlZCYmZy5vcHRpb25zLnNjb3BlPT1jLm9wdGlvbnMuc2NvcGUmJmcuYWNjZXB0LmNhbGwoZy5lbGVtZW50WzBdLGMuY3VycmVudEl0ZW18fGMuZWxlbWVudCkmJmQudWkuaW50ZXJzZWN0KGMsZC5leHRlbmQoZyx7b2Zmc2V0OmcuZWxlbWVudC5vZmZzZXQoKX0pLGcub3B0aW9ucy50b2xlcmFuY2UpKXtlPXRydWU7cmV0dXJuIGZhbHNlfX0pO2lmKGUpcmV0dXJuIGZhbHNlO2lmKHRoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLGMuY3VycmVudEl0ZW18fGMuZWxlbWVudCkpe3RoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyk7dGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MmJnRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyk7dGhpcy5fdHJpZ2dlcigiZHJvcCIsCmEsdGhpcy51aShjKSk7cmV0dXJuIHRoaXMuZWxlbWVudH1yZXR1cm4gZmFsc2V9LHVpOmZ1bmN0aW9uKGEpe3JldHVybntkcmFnZ2FibGU6YS5jdXJyZW50SXRlbXx8YS5lbGVtZW50LGhlbHBlcjphLmhlbHBlcixwb3NpdGlvbjphLnBvc2l0aW9uLG9mZnNldDphLnBvc2l0aW9uQWJzfX19KTtkLmV4dGVuZChkLnVpLmRyb3BwYWJsZSx7dmVyc2lvbjoiMS44LjUifSk7ZC51aS5pbnRlcnNlY3Q9ZnVuY3Rpb24oYSxiLGMpe2lmKCFiLm9mZnNldClyZXR1cm4gZmFsc2U7dmFyIGU9KGEucG9zaXRpb25BYnN8fGEucG9zaXRpb24uYWJzb2x1dGUpLmxlZnQsZz1lK2EuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgsZj0oYS5wb3NpdGlvbkFic3x8YS5wb3NpdGlvbi5hYnNvbHV0ZSkudG9wLGg9ZithLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxpPWIub2Zmc2V0LmxlZnQsaz1pK2IucHJvcG9ydGlvbnMud2lkdGgsaj1iLm9mZnNldC50b3AsbD1qK2IucHJvcG9ydGlvbnMuaGVpZ2h0Owpzd2l0Y2goYyl7Y2FzZSAiZml0IjpyZXR1cm4gaTw9ZSYmZzw9ayYmajw9ZiYmaDw9bDtjYXNlICJpbnRlcnNlY3QiOnJldHVybiBpPGUrYS5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC8yJiZnLWEuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgvMjxrJiZqPGYrYS5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQvMiYmaC1hLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC8yPGw7Y2FzZSAicG9pbnRlciI6cmV0dXJuIGQudWkuaXNPdmVyKChhLnBvc2l0aW9uQWJzfHxhLnBvc2l0aW9uLmFic29sdXRlKS50b3ArKGEuY2xpY2tPZmZzZXR8fGEub2Zmc2V0LmNsaWNrKS50b3AsKGEucG9zaXRpb25BYnN8fGEucG9zaXRpb24uYWJzb2x1dGUpLmxlZnQrKGEuY2xpY2tPZmZzZXR8fGEub2Zmc2V0LmNsaWNrKS5sZWZ0LGosaSxiLnByb3BvcnRpb25zLmhlaWdodCxiLnByb3BvcnRpb25zLndpZHRoKTtjYXNlICJ0b3VjaCI6cmV0dXJuKGY+PWomJmY8PWx8fGg+PWomJmg8PWx8fGY8aiYmaD5sKSYmKGU+PQppJiZlPD1rfHxnPj1pJiZnPD1rfHxlPGkmJmc+ayk7ZGVmYXVsdDpyZXR1cm4gZmFsc2V9fTtkLnVpLmRkbWFuYWdlcj17Y3VycmVudDpudWxsLGRyb3BwYWJsZXM6eyJkZWZhdWx0IjpbXX0scHJlcGFyZU9mZnNldHM6ZnVuY3Rpb24oYSxiKXt2YXIgYz1kLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Eub3B0aW9ucy5zY29wZV18fFtdLGU9Yj9iLnR5cGU6bnVsbCxnPShhLmN1cnJlbnRJdGVtfHxhLmVsZW1lbnQpLmZpbmQoIjpkYXRhKGRyb3BwYWJsZSkiKS5hbmRTZWxmKCksZj0wO2E6Zm9yKDtmPGMubGVuZ3RoO2YrKylpZighKGNbZl0ub3B0aW9ucy5kaXNhYmxlZHx8YSYmIWNbZl0uYWNjZXB0LmNhbGwoY1tmXS5lbGVtZW50WzBdLGEuY3VycmVudEl0ZW18fGEuZWxlbWVudCkpKXtmb3IodmFyIGg9MDtoPGcubGVuZ3RoO2grKylpZihnW2hdPT1jW2ZdLmVsZW1lbnRbMF0pe2NbZl0ucHJvcG9ydGlvbnMuaGVpZ2h0PTA7Y29udGludWUgYX1jW2ZdLnZpc2libGU9Y1tmXS5lbGVtZW50LmNzcygiZGlzcGxheSIpIT0KIm5vbmUiO2lmKGNbZl0udmlzaWJsZSl7Y1tmXS5vZmZzZXQ9Y1tmXS5lbGVtZW50Lm9mZnNldCgpO2NbZl0ucHJvcG9ydGlvbnM9e3dpZHRoOmNbZl0uZWxlbWVudFswXS5vZmZzZXRXaWR0aCxoZWlnaHQ6Y1tmXS5lbGVtZW50WzBdLm9mZnNldEhlaWdodH07ZT09Im1vdXNlZG93biImJmNbZl0uX2FjdGl2YXRlLmNhbGwoY1tmXSxiKX19fSxkcm9wOmZ1bmN0aW9uKGEsYil7dmFyIGM9ZmFsc2U7ZC5lYWNoKGQudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbYS5vcHRpb25zLnNjb3BlXXx8W10sZnVuY3Rpb24oKXtpZih0aGlzLm9wdGlvbnMpe2lmKCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQmJnRoaXMudmlzaWJsZSYmZC51aS5pbnRlcnNlY3QoYSx0aGlzLHRoaXMub3B0aW9ucy50b2xlcmFuY2UpKWM9Y3x8dGhpcy5fZHJvcC5jYWxsKHRoaXMsYik7aWYoIXRoaXMub3B0aW9ucy5kaXNhYmxlZCYmdGhpcy52aXNpYmxlJiZ0aGlzLmFjY2VwdC5jYWxsKHRoaXMuZWxlbWVudFswXSxhLmN1cnJlbnRJdGVtfHwKYS5lbGVtZW50KSl7dGhpcy5pc291dD0xO3RoaXMuaXNvdmVyPTA7dGhpcy5fZGVhY3RpdmF0ZS5jYWxsKHRoaXMsYil9fX0pO3JldHVybiBjfSxkcmFnOmZ1bmN0aW9uKGEsYil7YS5vcHRpb25zLnJlZnJlc2hQb3NpdGlvbnMmJmQudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKGEsYik7ZC5lYWNoKGQudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbYS5vcHRpb25zLnNjb3BlXXx8W10sZnVuY3Rpb24oKXtpZighKHRoaXMub3B0aW9ucy5kaXNhYmxlZHx8dGhpcy5ncmVlZHlDaGlsZHx8IXRoaXMudmlzaWJsZSkpe3ZhciBjPWQudWkuaW50ZXJzZWN0KGEsdGhpcyx0aGlzLm9wdGlvbnMudG9sZXJhbmNlKTtpZihjPSFjJiZ0aGlzLmlzb3Zlcj09MT8iaXNvdXQiOmMmJnRoaXMuaXNvdmVyPT0wPyJpc292ZXIiOm51bGwpe3ZhciBlO2lmKHRoaXMub3B0aW9ucy5ncmVlZHkpe3ZhciBnPXRoaXMuZWxlbWVudC5wYXJlbnRzKCI6ZGF0YShkcm9wcGFibGUpOmVxKDApIik7aWYoZy5sZW5ndGgpe2U9CmQuZGF0YShnWzBdLCJkcm9wcGFibGUiKTtlLmdyZWVkeUNoaWxkPWM9PSJpc292ZXIiPzE6MH19aWYoZSYmYz09Imlzb3ZlciIpe2UuaXNvdmVyPTA7ZS5pc291dD0xO2UuX291dC5jYWxsKGUsYil9dGhpc1tjXT0xO3RoaXNbYz09Imlzb3V0Ij8iaXNvdmVyIjoiaXNvdXQiXT0wO3RoaXNbYz09Imlzb3ZlciI/Il9vdmVyIjoiX291dCJdLmNhbGwodGhpcyxiKTtpZihlJiZjPT0iaXNvdXQiKXtlLmlzb3V0PTA7ZS5pc292ZXI9MTtlLl9vdmVyLmNhbGwoZSxiKX19fX0pfX19KShqUXVlcnkpOwooZnVuY3Rpb24oZSl7ZS53aWRnZXQoInVpLnJlc2l6YWJsZSIsZS51aS5tb3VzZSx7d2lkZ2V0RXZlbnRQcmVmaXg6InJlc2l6ZSIsb3B0aW9uczp7YWxzb1Jlc2l6ZTpmYWxzZSxhbmltYXRlOmZhbHNlLGFuaW1hdGVEdXJhdGlvbjoic2xvdyIsYW5pbWF0ZUVhc2luZzoic3dpbmciLGFzcGVjdFJhdGlvOmZhbHNlLGF1dG9IaWRlOmZhbHNlLGNvbnRhaW5tZW50OmZhbHNlLGdob3N0OmZhbHNlLGdyaWQ6ZmFsc2UsaGFuZGxlczoiZSxzLHNlIixoZWxwZXI6ZmFsc2UsbWF4SGVpZ2h0Om51bGwsbWF4V2lkdGg6bnVsbCxtaW5IZWlnaHQ6MTAsbWluV2lkdGg6MTAsekluZGV4OjFFM30sX2NyZWF0ZTpmdW5jdGlvbigpe3ZhciBiPXRoaXMsYT10aGlzLm9wdGlvbnM7dGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1yZXNpemFibGUiKTtlLmV4dGVuZCh0aGlzLHtfYXNwZWN0UmF0aW86ISFhLmFzcGVjdFJhdGlvLGFzcGVjdFJhdGlvOmEuYXNwZWN0UmF0aW8sb3JpZ2luYWxFbGVtZW50OnRoaXMuZWxlbWVudCwKX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHM6W10sX2hlbHBlcjphLmhlbHBlcnx8YS5naG9zdHx8YS5hbmltYXRlP2EuaGVscGVyfHwidWktcmVzaXphYmxlLWhlbHBlciI6bnVsbH0pO2lmKHRoaXMuZWxlbWVudFswXS5ub2RlTmFtZS5tYXRjaCgvY2FudmFzfHRleHRhcmVhfGlucHV0fHNlbGVjdHxidXR0b258aW1nL2kpKXsvcmVsYXRpdmUvLnRlc3QodGhpcy5lbGVtZW50LmNzcygicG9zaXRpb24iKSkmJmUuYnJvd3Nlci5vcGVyYSYmdGhpcy5lbGVtZW50LmNzcyh7cG9zaXRpb246InJlbGF0aXZlIix0b3A6ImF1dG8iLGxlZnQ6ImF1dG8ifSk7dGhpcy5lbGVtZW50LndyYXAoZSgnPGRpdiBjbGFzcz0idWktd3JhcHBlciIgc3R5bGU9Im92ZXJmbG93OiBoaWRkZW47Ij48L2Rpdj4nKS5jc3Moe3Bvc2l0aW9uOnRoaXMuZWxlbWVudC5jc3MoInBvc2l0aW9uIiksd2lkdGg6dGhpcy5lbGVtZW50Lm91dGVyV2lkdGgoKSxoZWlnaHQ6dGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCksCnRvcDp0aGlzLmVsZW1lbnQuY3NzKCJ0b3AiKSxsZWZ0OnRoaXMuZWxlbWVudC5jc3MoImxlZnQiKX0pKTt0aGlzLmVsZW1lbnQ9dGhpcy5lbGVtZW50LnBhcmVudCgpLmRhdGEoInJlc2l6YWJsZSIsdGhpcy5lbGVtZW50LmRhdGEoInJlc2l6YWJsZSIpKTt0aGlzLmVsZW1lbnRJc1dyYXBwZXI9dHJ1ZTt0aGlzLmVsZW1lbnQuY3NzKHttYXJnaW5MZWZ0OnRoaXMub3JpZ2luYWxFbGVtZW50LmNzcygibWFyZ2luTGVmdCIpLG1hcmdpblRvcDp0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoIm1hcmdpblRvcCIpLG1hcmdpblJpZ2h0OnRoaXMub3JpZ2luYWxFbGVtZW50LmNzcygibWFyZ2luUmlnaHQiKSxtYXJnaW5Cb3R0b206dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJtYXJnaW5Cb3R0b20iKX0pO3RoaXMub3JpZ2luYWxFbGVtZW50LmNzcyh7bWFyZ2luTGVmdDowLG1hcmdpblRvcDowLG1hcmdpblJpZ2h0OjAsbWFyZ2luQm90dG9tOjB9KTt0aGlzLm9yaWdpbmFsUmVzaXplU3R5bGU9CnRoaXMub3JpZ2luYWxFbGVtZW50LmNzcygicmVzaXplIik7dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJyZXNpemUiLCJub25lIik7dGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cy5wdXNoKHRoaXMub3JpZ2luYWxFbGVtZW50LmNzcyh7cG9zaXRpb246InN0YXRpYyIsem9vbToxLGRpc3BsYXk6ImJsb2NrIn0pKTt0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3Moe21hcmdpbjp0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoIm1hcmdpbiIpfSk7dGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemUoKX10aGlzLmhhbmRsZXM9YS5oYW5kbGVzfHwoIWUoIi51aS1yZXNpemFibGUtaGFuZGxlIix0aGlzLmVsZW1lbnQpLmxlbmd0aD8iZSxzLHNlIjp7bjoiLnVpLXJlc2l6YWJsZS1uIixlOiIudWktcmVzaXphYmxlLWUiLHM6Ii51aS1yZXNpemFibGUtcyIsdzoiLnVpLXJlc2l6YWJsZS13IixzZToiLnVpLXJlc2l6YWJsZS1zZSIsc3c6Ii51aS1yZXNpemFibGUtc3ciLG5lOiIudWktcmVzaXphYmxlLW5lIiwKbnc6Ii51aS1yZXNpemFibGUtbncifSk7aWYodGhpcy5oYW5kbGVzLmNvbnN0cnVjdG9yPT1TdHJpbmcpe2lmKHRoaXMuaGFuZGxlcz09ImFsbCIpdGhpcy5oYW5kbGVzPSJuLGUscyx3LHNlLHN3LG5lLG53Ijt2YXIgYz10aGlzLmhhbmRsZXMuc3BsaXQoIiwiKTt0aGlzLmhhbmRsZXM9e307Zm9yKHZhciBkPTA7ZDxjLmxlbmd0aDtkKyspe3ZhciBmPWUudHJpbShjW2RdKSxnPWUoJzxkaXYgY2xhc3M9InVpLXJlc2l6YWJsZS1oYW5kbGUgJysoInVpLXJlc2l6YWJsZS0iK2YpKyciPjwvZGl2PicpOy9zd3xzZXxuZXxudy8udGVzdChmKSYmZy5jc3Moe3pJbmRleDorK2EuekluZGV4fSk7InNlIj09ZiYmZy5hZGRDbGFzcygidWktaWNvbiB1aS1pY29uLWdyaXBzbWFsbC1kaWFnb25hbC1zZSIpO3RoaXMuaGFuZGxlc1tmXT0iLnVpLXJlc2l6YWJsZS0iK2Y7dGhpcy5lbGVtZW50LmFwcGVuZChnKX19dGhpcy5fcmVuZGVyQXhpcz1mdW5jdGlvbihoKXtoPWh8fHRoaXMuZWxlbWVudDtmb3IodmFyIGkgaW4gdGhpcy5oYW5kbGVzKXtpZih0aGlzLmhhbmRsZXNbaV0uY29uc3RydWN0b3I9PQpTdHJpbmcpdGhpcy5oYW5kbGVzW2ldPWUodGhpcy5oYW5kbGVzW2ldLHRoaXMuZWxlbWVudCkuc2hvdygpO2lmKHRoaXMuZWxlbWVudElzV3JhcHBlciYmdGhpcy5vcmlnaW5hbEVsZW1lbnRbMF0ubm9kZU5hbWUubWF0Y2goL3RleHRhcmVhfGlucHV0fHNlbGVjdHxidXR0b24vaSkpe3ZhciBqPWUodGhpcy5oYW5kbGVzW2ldLHRoaXMuZWxlbWVudCksaz0wO2s9L3N3fG5lfG53fHNlfG58cy8udGVzdChpKT9qLm91dGVySGVpZ2h0KCk6ai5vdXRlcldpZHRoKCk7aj1bInBhZGRpbmciLC9uZXxud3xuLy50ZXN0KGkpPyJUb3AiOi9zZXxzd3xzLy50ZXN0KGkpPyJCb3R0b20iOi9eZSQvLnRlc3QoaSk/IlJpZ2h0IjoiTGVmdCJdLmpvaW4oIiIpO2guY3NzKGosayk7dGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemUoKX1lKHRoaXMuaGFuZGxlc1tpXSl9fTt0aGlzLl9yZW5kZXJBeGlzKHRoaXMuZWxlbWVudCk7dGhpcy5faGFuZGxlcz1lKCIudWktcmVzaXphYmxlLWhhbmRsZSIsdGhpcy5lbGVtZW50KS5kaXNhYmxlU2VsZWN0aW9uKCk7CnRoaXMuX2hhbmRsZXMubW91c2VvdmVyKGZ1bmN0aW9uKCl7aWYoIWIucmVzaXppbmcpe2lmKHRoaXMuY2xhc3NOYW1lKXZhciBoPXRoaXMuY2xhc3NOYW1lLm1hdGNoKC91aS1yZXNpemFibGUtKHNlfHN3fG5lfG53fG58ZXxzfHcpL2kpO2IuYXhpcz1oJiZoWzFdP2hbMV06InNlIn19KTtpZihhLmF1dG9IaWRlKXt0aGlzLl9oYW5kbGVzLmhpZGUoKTtlKHRoaXMuZWxlbWVudCkuYWRkQ2xhc3MoInVpLXJlc2l6YWJsZS1hdXRvaGlkZSIpLmhvdmVyKGZ1bmN0aW9uKCl7ZSh0aGlzKS5yZW1vdmVDbGFzcygidWktcmVzaXphYmxlLWF1dG9oaWRlIik7Yi5faGFuZGxlcy5zaG93KCl9LGZ1bmN0aW9uKCl7aWYoIWIucmVzaXppbmcpe2UodGhpcykuYWRkQ2xhc3MoInVpLXJlc2l6YWJsZS1hdXRvaGlkZSIpO2IuX2hhbmRsZXMuaGlkZSgpfX0pfXRoaXMuX21vdXNlSW5pdCgpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5fbW91c2VEZXN0cm95KCk7dmFyIGI9ZnVuY3Rpb24oYyl7ZShjKS5yZW1vdmVDbGFzcygidWktcmVzaXphYmxlIHVpLXJlc2l6YWJsZS1kaXNhYmxlZCB1aS1yZXNpemFibGUtcmVzaXppbmciKS5yZW1vdmVEYXRhKCJyZXNpemFibGUiKS51bmJpbmQoIi5yZXNpemFibGUiKS5maW5kKCIudWktcmVzaXphYmxlLWhhbmRsZSIpLnJlbW92ZSgpfTsKaWYodGhpcy5lbGVtZW50SXNXcmFwcGVyKXtiKHRoaXMuZWxlbWVudCk7dmFyIGE9dGhpcy5lbGVtZW50O2EuYWZ0ZXIodGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKHtwb3NpdGlvbjphLmNzcygicG9zaXRpb24iKSx3aWR0aDphLm91dGVyV2lkdGgoKSxoZWlnaHQ6YS5vdXRlckhlaWdodCgpLHRvcDphLmNzcygidG9wIiksbGVmdDphLmNzcygibGVmdCIpfSkpLnJlbW92ZSgpfXRoaXMub3JpZ2luYWxFbGVtZW50LmNzcygicmVzaXplIix0aGlzLm9yaWdpbmFsUmVzaXplU3R5bGUpO2IodGhpcy5vcmlnaW5hbEVsZW1lbnQpO3JldHVybiB0aGlzfSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKGIpe3ZhciBhPWZhbHNlO2Zvcih2YXIgYyBpbiB0aGlzLmhhbmRsZXMpaWYoZSh0aGlzLmhhbmRsZXNbY10pWzBdPT1iLnRhcmdldClhPXRydWU7cmV0dXJuIXRoaXMub3B0aW9ucy5kaXNhYmxlZCYmYX0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oYil7dmFyIGE9dGhpcy5vcHRpb25zLGM9dGhpcy5lbGVtZW50LnBvc2l0aW9uKCksCmQ9dGhpcy5lbGVtZW50O3RoaXMucmVzaXppbmc9dHJ1ZTt0aGlzLmRvY3VtZW50U2Nyb2xsPXt0b3A6ZShkb2N1bWVudCkuc2Nyb2xsVG9wKCksbGVmdDplKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCl9O2lmKGQuaXMoIi51aS1kcmFnZ2FibGUiKXx8L2Fic29sdXRlLy50ZXN0KGQuY3NzKCJwb3NpdGlvbiIpKSlkLmNzcyh7cG9zaXRpb246ImFic29sdXRlIix0b3A6Yy50b3AsbGVmdDpjLmxlZnR9KTtlLmJyb3dzZXIub3BlcmEmJi9yZWxhdGl2ZS8udGVzdChkLmNzcygicG9zaXRpb24iKSkmJmQuY3NzKHtwb3NpdGlvbjoicmVsYXRpdmUiLHRvcDoiYXV0byIsbGVmdDoiYXV0byJ9KTt0aGlzLl9yZW5kZXJQcm94eSgpO2M9bSh0aGlzLmhlbHBlci5jc3MoImxlZnQiKSk7dmFyIGY9bSh0aGlzLmhlbHBlci5jc3MoInRvcCIpKTtpZihhLmNvbnRhaW5tZW50KXtjKz1lKGEuY29udGFpbm1lbnQpLnNjcm9sbExlZnQoKXx8MDtmKz1lKGEuY29udGFpbm1lbnQpLnNjcm9sbFRvcCgpfHwwfXRoaXMub2Zmc2V0PQp0aGlzLmhlbHBlci5vZmZzZXQoKTt0aGlzLnBvc2l0aW9uPXtsZWZ0OmMsdG9wOmZ9O3RoaXMuc2l6ZT10aGlzLl9oZWxwZXI/e3dpZHRoOmQub3V0ZXJXaWR0aCgpLGhlaWdodDpkLm91dGVySGVpZ2h0KCl9Ont3aWR0aDpkLndpZHRoKCksaGVpZ2h0OmQuaGVpZ2h0KCl9O3RoaXMub3JpZ2luYWxTaXplPXRoaXMuX2hlbHBlcj97d2lkdGg6ZC5vdXRlcldpZHRoKCksaGVpZ2h0OmQub3V0ZXJIZWlnaHQoKX06e3dpZHRoOmQud2lkdGgoKSxoZWlnaHQ6ZC5oZWlnaHQoKX07dGhpcy5vcmlnaW5hbFBvc2l0aW9uPXtsZWZ0OmMsdG9wOmZ9O3RoaXMuc2l6ZURpZmY9e3dpZHRoOmQub3V0ZXJXaWR0aCgpLWQud2lkdGgoKSxoZWlnaHQ6ZC5vdXRlckhlaWdodCgpLWQuaGVpZ2h0KCl9O3RoaXMub3JpZ2luYWxNb3VzZVBvc2l0aW9uPXtsZWZ0OmIucGFnZVgsdG9wOmIucGFnZVl9O3RoaXMuYXNwZWN0UmF0aW89dHlwZW9mIGEuYXNwZWN0UmF0aW89PSJudW1iZXIiP2EuYXNwZWN0UmF0aW86CnRoaXMub3JpZ2luYWxTaXplLndpZHRoL3RoaXMub3JpZ2luYWxTaXplLmhlaWdodHx8MTthPWUoIi51aS1yZXNpemFibGUtIit0aGlzLmF4aXMpLmNzcygiY3Vyc29yIik7ZSgiYm9keSIpLmNzcygiY3Vyc29yIixhPT0iYXV0byI/dGhpcy5heGlzKyItcmVzaXplIjphKTtkLmFkZENsYXNzKCJ1aS1yZXNpemFibGUtcmVzaXppbmciKTt0aGlzLl9wcm9wYWdhdGUoInN0YXJ0IixiKTtyZXR1cm4gdHJ1ZX0sX21vdXNlRHJhZzpmdW5jdGlvbihiKXt2YXIgYT10aGlzLmhlbHBlcixjPXRoaXMub3JpZ2luYWxNb3VzZVBvc2l0aW9uLGQ9dGhpcy5fY2hhbmdlW3RoaXMuYXhpc107aWYoIWQpcmV0dXJuIGZhbHNlO2M9ZC5hcHBseSh0aGlzLFtiLGIucGFnZVgtYy5sZWZ0fHwwLGIucGFnZVktYy50b3B8fDBdKTtpZih0aGlzLl9hc3BlY3RSYXRpb3x8Yi5zaGlmdEtleSljPXRoaXMuX3VwZGF0ZVJhdGlvKGMsYik7Yz10aGlzLl9yZXNwZWN0U2l6ZShjLGIpO3RoaXMuX3Byb3BhZ2F0ZSgicmVzaXplIiwKYik7YS5jc3Moe3RvcDp0aGlzLnBvc2l0aW9uLnRvcCsicHgiLGxlZnQ6dGhpcy5wb3NpdGlvbi5sZWZ0KyJweCIsd2lkdGg6dGhpcy5zaXplLndpZHRoKyJweCIsaGVpZ2h0OnRoaXMuc2l6ZS5oZWlnaHQrInB4In0pOyF0aGlzLl9oZWxwZXImJnRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoJiZ0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpO3RoaXMuX3VwZGF0ZUNhY2hlKGMpO3RoaXMuX3RyaWdnZXIoInJlc2l6ZSIsYix0aGlzLnVpKCkpO3JldHVybiBmYWxzZX0sX21vdXNlU3RvcDpmdW5jdGlvbihiKXt0aGlzLnJlc2l6aW5nPWZhbHNlO3ZhciBhPXRoaXMub3B0aW9ucyxjPXRoaXM7aWYodGhpcy5faGVscGVyKXt2YXIgZD10aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLGY9ZC5sZW5ndGgmJi90ZXh0YXJlYS9pLnRlc3QoZFswXS5ub2RlTmFtZSk7ZD1mJiZlLnVpLmhhc1Njcm9sbChkWzBdLCJsZWZ0Iik/MDpjLnNpemVEaWZmLmhlaWdodDsKZj17d2lkdGg6Yy5zaXplLndpZHRoLShmPzA6Yy5zaXplRGlmZi53aWR0aCksaGVpZ2h0OmMuc2l6ZS5oZWlnaHQtZH07ZD1wYXJzZUludChjLmVsZW1lbnQuY3NzKCJsZWZ0IiksMTApKyhjLnBvc2l0aW9uLmxlZnQtYy5vcmlnaW5hbFBvc2l0aW9uLmxlZnQpfHxudWxsO3ZhciBnPXBhcnNlSW50KGMuZWxlbWVudC5jc3MoInRvcCIpLDEwKSsoYy5wb3NpdGlvbi50b3AtYy5vcmlnaW5hbFBvc2l0aW9uLnRvcCl8fG51bGw7YS5hbmltYXRlfHx0aGlzLmVsZW1lbnQuY3NzKGUuZXh0ZW5kKGYse3RvcDpnLGxlZnQ6ZH0pKTtjLmhlbHBlci5oZWlnaHQoYy5zaXplLmhlaWdodCk7Yy5oZWxwZXIud2lkdGgoYy5zaXplLndpZHRoKTt0aGlzLl9oZWxwZXImJiFhLmFuaW1hdGUmJnRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCl9ZSgiYm9keSIpLmNzcygiY3Vyc29yIiwiYXV0byIpO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktcmVzaXphYmxlLXJlc2l6aW5nIik7dGhpcy5fcHJvcGFnYXRlKCJzdG9wIiwKYik7dGhpcy5faGVscGVyJiZ0aGlzLmhlbHBlci5yZW1vdmUoKTtyZXR1cm4gZmFsc2V9LF91cGRhdGVDYWNoZTpmdW5jdGlvbihiKXt0aGlzLm9mZnNldD10aGlzLmhlbHBlci5vZmZzZXQoKTtpZihsKGIubGVmdCkpdGhpcy5wb3NpdGlvbi5sZWZ0PWIubGVmdDtpZihsKGIudG9wKSl0aGlzLnBvc2l0aW9uLnRvcD1iLnRvcDtpZihsKGIuaGVpZ2h0KSl0aGlzLnNpemUuaGVpZ2h0PWIuaGVpZ2h0O2lmKGwoYi53aWR0aCkpdGhpcy5zaXplLndpZHRoPWIud2lkdGh9LF91cGRhdGVSYXRpbzpmdW5jdGlvbihiKXt2YXIgYT10aGlzLnBvc2l0aW9uLGM9dGhpcy5zaXplLGQ9dGhpcy5heGlzO2lmKGIuaGVpZ2h0KWIud2lkdGg9Yy5oZWlnaHQqdGhpcy5hc3BlY3RSYXRpbztlbHNlIGlmKGIud2lkdGgpYi5oZWlnaHQ9Yy53aWR0aC90aGlzLmFzcGVjdFJhdGlvO2lmKGQ9PSJzdyIpe2IubGVmdD1hLmxlZnQrKGMud2lkdGgtYi53aWR0aCk7Yi50b3A9bnVsbH1pZihkPT0ibnciKXtiLnRvcD0KYS50b3ArKGMuaGVpZ2h0LWIuaGVpZ2h0KTtiLmxlZnQ9YS5sZWZ0KyhjLndpZHRoLWIud2lkdGgpfXJldHVybiBifSxfcmVzcGVjdFNpemU6ZnVuY3Rpb24oYil7dmFyIGE9dGhpcy5vcHRpb25zLGM9dGhpcy5heGlzLGQ9bChiLndpZHRoKSYmYS5tYXhXaWR0aCYmYS5tYXhXaWR0aDxiLndpZHRoLGY9bChiLmhlaWdodCkmJmEubWF4SGVpZ2h0JiZhLm1heEhlaWdodDxiLmhlaWdodCxnPWwoYi53aWR0aCkmJmEubWluV2lkdGgmJmEubWluV2lkdGg+Yi53aWR0aCxoPWwoYi5oZWlnaHQpJiZhLm1pbkhlaWdodCYmYS5taW5IZWlnaHQ+Yi5oZWlnaHQ7aWYoZyliLndpZHRoPWEubWluV2lkdGg7aWYoaCliLmhlaWdodD1hLm1pbkhlaWdodDtpZihkKWIud2lkdGg9YS5tYXhXaWR0aDtpZihmKWIuaGVpZ2h0PWEubWF4SGVpZ2h0O3ZhciBpPXRoaXMub3JpZ2luYWxQb3NpdGlvbi5sZWZ0K3RoaXMub3JpZ2luYWxTaXplLndpZHRoLGo9dGhpcy5wb3NpdGlvbi50b3ArdGhpcy5zaXplLmhlaWdodCwKaz0vc3d8bnd8dy8udGVzdChjKTtjPS9ud3xuZXxuLy50ZXN0KGMpO2lmKGcmJmspYi5sZWZ0PWktYS5taW5XaWR0aDtpZihkJiZrKWIubGVmdD1pLWEubWF4V2lkdGg7aWYoaCYmYyliLnRvcD1qLWEubWluSGVpZ2h0O2lmKGYmJmMpYi50b3A9ai1hLm1heEhlaWdodDtpZigoYT0hYi53aWR0aCYmIWIuaGVpZ2h0KSYmIWIubGVmdCYmYi50b3ApYi50b3A9bnVsbDtlbHNlIGlmKGEmJiFiLnRvcCYmYi5sZWZ0KWIubGVmdD1udWxsO3JldHVybiBifSxfcHJvcG9ydGlvbmFsbHlSZXNpemU6ZnVuY3Rpb24oKXtpZih0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLmxlbmd0aClmb3IodmFyIGI9dGhpcy5oZWxwZXJ8fHRoaXMuZWxlbWVudCxhPTA7YTx0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLmxlbmd0aDthKyspe3ZhciBjPXRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHNbYV07aWYoIXRoaXMuYm9yZGVyRGlmKXt2YXIgZD1bYy5jc3MoImJvcmRlclRvcFdpZHRoIiksCmMuY3NzKCJib3JkZXJSaWdodFdpZHRoIiksYy5jc3MoImJvcmRlckJvdHRvbVdpZHRoIiksYy5jc3MoImJvcmRlckxlZnRXaWR0aCIpXSxmPVtjLmNzcygicGFkZGluZ1RvcCIpLGMuY3NzKCJwYWRkaW5nUmlnaHQiKSxjLmNzcygicGFkZGluZ0JvdHRvbSIpLGMuY3NzKCJwYWRkaW5nTGVmdCIpXTt0aGlzLmJvcmRlckRpZj1lLm1hcChkLGZ1bmN0aW9uKGcsaCl7Zz1wYXJzZUludChnLDEwKXx8MDtoPXBhcnNlSW50KGZbaF0sMTApfHwwO3JldHVybiBnK2h9KX1lLmJyb3dzZXIubXNpZSYmKGUoYikuaXMoIjpoaWRkZW4iKXx8ZShiKS5wYXJlbnRzKCI6aGlkZGVuIikubGVuZ3RoKXx8Yy5jc3Moe2hlaWdodDpiLmhlaWdodCgpLXRoaXMuYm9yZGVyRGlmWzBdLXRoaXMuYm9yZGVyRGlmWzJdfHwwLHdpZHRoOmIud2lkdGgoKS10aGlzLmJvcmRlckRpZlsxXS10aGlzLmJvcmRlckRpZlszXXx8MH0pfX0sX3JlbmRlclByb3h5OmZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5vcHRpb25zO3RoaXMuZWxlbWVudE9mZnNldD0KdGhpcy5lbGVtZW50Lm9mZnNldCgpO2lmKHRoaXMuX2hlbHBlcil7dGhpcy5oZWxwZXI9dGhpcy5oZWxwZXJ8fGUoJzxkaXYgc3R5bGU9Im92ZXJmbG93OmhpZGRlbjsiPjwvZGl2PicpO3ZhciBhPWUuYnJvd3Nlci5tc2llJiZlLmJyb3dzZXIudmVyc2lvbjw3LGM9YT8xOjA7YT1hPzI6LTE7dGhpcy5oZWxwZXIuYWRkQ2xhc3ModGhpcy5faGVscGVyKS5jc3Moe3dpZHRoOnRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCkrYSxoZWlnaHQ6dGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCkrYSxwb3NpdGlvbjoiYWJzb2x1dGUiLGxlZnQ6dGhpcy5lbGVtZW50T2Zmc2V0LmxlZnQtYysicHgiLHRvcDp0aGlzLmVsZW1lbnRPZmZzZXQudG9wLWMrInB4Iix6SW5kZXg6KytiLnpJbmRleH0pO3RoaXMuaGVscGVyLmFwcGVuZFRvKCJib2R5IikuZGlzYWJsZVNlbGVjdGlvbigpfWVsc2UgdGhpcy5oZWxwZXI9dGhpcy5lbGVtZW50fSxfY2hhbmdlOntlOmZ1bmN0aW9uKGIsYSl7cmV0dXJue3dpZHRoOnRoaXMub3JpZ2luYWxTaXplLndpZHRoKwphfX0sdzpmdW5jdGlvbihiLGEpe3JldHVybntsZWZ0OnRoaXMub3JpZ2luYWxQb3NpdGlvbi5sZWZ0K2Esd2lkdGg6dGhpcy5vcmlnaW5hbFNpemUud2lkdGgtYX19LG46ZnVuY3Rpb24oYixhLGMpe3JldHVybnt0b3A6dGhpcy5vcmlnaW5hbFBvc2l0aW9uLnRvcCtjLGhlaWdodDp0aGlzLm9yaWdpbmFsU2l6ZS5oZWlnaHQtY319LHM6ZnVuY3Rpb24oYixhLGMpe3JldHVybntoZWlnaHQ6dGhpcy5vcmlnaW5hbFNpemUuaGVpZ2h0K2N9fSxzZTpmdW5jdGlvbihiLGEsYyl7cmV0dXJuIGUuZXh0ZW5kKHRoaXMuX2NoYW5nZS5zLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0aGlzLl9jaGFuZ2UuZS5hcHBseSh0aGlzLFtiLGEsY10pKX0sc3c6ZnVuY3Rpb24oYixhLGMpe3JldHVybiBlLmV4dGVuZCh0aGlzLl9jaGFuZ2Uucy5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy5fY2hhbmdlLncuYXBwbHkodGhpcyxbYixhLGNdKSl9LG5lOmZ1bmN0aW9uKGIsYSxjKXtyZXR1cm4gZS5leHRlbmQodGhpcy5fY2hhbmdlLm4uYXBwbHkodGhpcywKYXJndW1lbnRzKSx0aGlzLl9jaGFuZ2UuZS5hcHBseSh0aGlzLFtiLGEsY10pKX0sbnc6ZnVuY3Rpb24oYixhLGMpe3JldHVybiBlLmV4dGVuZCh0aGlzLl9jaGFuZ2Uubi5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy5fY2hhbmdlLncuYXBwbHkodGhpcyxbYixhLGNdKSl9fSxfcHJvcGFnYXRlOmZ1bmN0aW9uKGIsYSl7ZS51aS5wbHVnaW4uY2FsbCh0aGlzLGIsW2EsdGhpcy51aSgpXSk7YiE9InJlc2l6ZSImJnRoaXMuX3RyaWdnZXIoYixhLHRoaXMudWkoKSl9LHBsdWdpbnM6e30sdWk6ZnVuY3Rpb24oKXtyZXR1cm57b3JpZ2luYWxFbGVtZW50OnRoaXMub3JpZ2luYWxFbGVtZW50LGVsZW1lbnQ6dGhpcy5lbGVtZW50LGhlbHBlcjp0aGlzLmhlbHBlcixwb3NpdGlvbjp0aGlzLnBvc2l0aW9uLHNpemU6dGhpcy5zaXplLG9yaWdpbmFsU2l6ZTp0aGlzLm9yaWdpbmFsU2l6ZSxvcmlnaW5hbFBvc2l0aW9uOnRoaXMub3JpZ2luYWxQb3NpdGlvbn19fSk7ZS5leHRlbmQoZS51aS5yZXNpemFibGUsCnt2ZXJzaW9uOiIxLjguNSJ9KTtlLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsImFsc29SZXNpemUiLHtzdGFydDpmdW5jdGlvbigpe3ZhciBiPWUodGhpcykuZGF0YSgicmVzaXphYmxlIikub3B0aW9ucyxhPWZ1bmN0aW9uKGMpe2UoYykuZWFjaChmdW5jdGlvbigpe3ZhciBkPWUodGhpcyk7ZC5kYXRhKCJyZXNpemFibGUtYWxzb3Jlc2l6ZSIse3dpZHRoOnBhcnNlSW50KGQud2lkdGgoKSwxMCksaGVpZ2h0OnBhcnNlSW50KGQuaGVpZ2h0KCksMTApLGxlZnQ6cGFyc2VJbnQoZC5jc3MoImxlZnQiKSwxMCksdG9wOnBhcnNlSW50KGQuY3NzKCJ0b3AiKSwxMCkscG9zaXRpb246ZC5jc3MoInBvc2l0aW9uIil9KX0pfTtpZih0eXBlb2YgYi5hbHNvUmVzaXplPT0ib2JqZWN0IiYmIWIuYWxzb1Jlc2l6ZS5wYXJlbnROb2RlKWlmKGIuYWxzb1Jlc2l6ZS5sZW5ndGgpe2IuYWxzb1Jlc2l6ZT1iLmFsc29SZXNpemVbMF07YShiLmFsc29SZXNpemUpfWVsc2UgZS5lYWNoKGIuYWxzb1Jlc2l6ZSwKZnVuY3Rpb24oYyl7YShjKX0pO2Vsc2UgYShiLmFsc29SZXNpemUpfSxyZXNpemU6ZnVuY3Rpb24oYixhKXt2YXIgYz1lKHRoaXMpLmRhdGEoInJlc2l6YWJsZSIpO2I9Yy5vcHRpb25zO3ZhciBkPWMub3JpZ2luYWxTaXplLGY9Yy5vcmlnaW5hbFBvc2l0aW9uLGc9e2hlaWdodDpjLnNpemUuaGVpZ2h0LWQuaGVpZ2h0fHwwLHdpZHRoOmMuc2l6ZS53aWR0aC1kLndpZHRofHwwLHRvcDpjLnBvc2l0aW9uLnRvcC1mLnRvcHx8MCxsZWZ0OmMucG9zaXRpb24ubGVmdC1mLmxlZnR8fDB9LGg9ZnVuY3Rpb24oaSxqKXtlKGkpLmVhY2goZnVuY3Rpb24oKXt2YXIgaz1lKHRoaXMpLHE9ZSh0aGlzKS5kYXRhKCJyZXNpemFibGUtYWxzb3Jlc2l6ZSIpLHA9e30scj1qJiZqLmxlbmd0aD9qOmsucGFyZW50cyhhLm9yaWdpbmFsRWxlbWVudFswXSkubGVuZ3RoP1sid2lkdGgiLCJoZWlnaHQiXTpbIndpZHRoIiwiaGVpZ2h0IiwidG9wIiwibGVmdCJdO2UuZWFjaChyLGZ1bmN0aW9uKG4sbyl7aWYoKG49CihxW29dfHwwKSsoZ1tvXXx8MCkpJiZuPj0wKXBbb109bnx8bnVsbH0pO2lmKGUuYnJvd3Nlci5vcGVyYSYmL3JlbGF0aXZlLy50ZXN0KGsuY3NzKCJwb3NpdGlvbiIpKSl7Yy5fcmV2ZXJ0VG9SZWxhdGl2ZVBvc2l0aW9uPXRydWU7ay5jc3Moe3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdG9wOiJhdXRvIixsZWZ0OiJhdXRvIn0pfWsuY3NzKHApfSl9O3R5cGVvZiBiLmFsc29SZXNpemU9PSJvYmplY3QiJiYhYi5hbHNvUmVzaXplLm5vZGVUeXBlP2UuZWFjaChiLmFsc29SZXNpemUsZnVuY3Rpb24oaSxqKXtoKGksail9KTpoKGIuYWxzb1Jlc2l6ZSl9LHN0b3A6ZnVuY3Rpb24oKXt2YXIgYj1lKHRoaXMpLmRhdGEoInJlc2l6YWJsZSIpLGE9Yi5vcHRpb25zLGM9ZnVuY3Rpb24oZCl7ZShkKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGY9ZSh0aGlzKTtmLmNzcyh7cG9zaXRpb246Zi5kYXRhKCJyZXNpemFibGUtYWxzb3Jlc2l6ZSIpLnBvc2l0aW9ufSl9KX07aWYoYi5fcmV2ZXJ0VG9SZWxhdGl2ZVBvc2l0aW9uKXtiLl9yZXZlcnRUb1JlbGF0aXZlUG9zaXRpb249CmZhbHNlO3R5cGVvZiBhLmFsc29SZXNpemU9PSJvYmplY3QiJiYhYS5hbHNvUmVzaXplLm5vZGVUeXBlP2UuZWFjaChhLmFsc29SZXNpemUsZnVuY3Rpb24oZCl7YyhkKX0pOmMoYS5hbHNvUmVzaXplKX1lKHRoaXMpLnJlbW92ZURhdGEoInJlc2l6YWJsZS1hbHNvcmVzaXplIil9fSk7ZS51aS5wbHVnaW4uYWRkKCJyZXNpemFibGUiLCJhbmltYXRlIix7c3RvcDpmdW5jdGlvbihiKXt2YXIgYT1lKHRoaXMpLmRhdGEoInJlc2l6YWJsZSIpLGM9YS5vcHRpb25zLGQ9YS5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cyxmPWQubGVuZ3RoJiYvdGV4dGFyZWEvaS50ZXN0KGRbMF0ubm9kZU5hbWUpLGc9ZiYmZS51aS5oYXNTY3JvbGwoZFswXSwibGVmdCIpPzA6YS5zaXplRGlmZi5oZWlnaHQ7Zj17d2lkdGg6YS5zaXplLndpZHRoLShmPzA6YS5zaXplRGlmZi53aWR0aCksaGVpZ2h0OmEuc2l6ZS5oZWlnaHQtZ307Zz1wYXJzZUludChhLmVsZW1lbnQuY3NzKCJsZWZ0IiksMTApKyhhLnBvc2l0aW9uLmxlZnQtCmEub3JpZ2luYWxQb3NpdGlvbi5sZWZ0KXx8bnVsbDt2YXIgaD1wYXJzZUludChhLmVsZW1lbnQuY3NzKCJ0b3AiKSwxMCkrKGEucG9zaXRpb24udG9wLWEub3JpZ2luYWxQb3NpdGlvbi50b3ApfHxudWxsO2EuZWxlbWVudC5hbmltYXRlKGUuZXh0ZW5kKGYsaCYmZz97dG9wOmgsbGVmdDpnfTp7fSkse2R1cmF0aW9uOmMuYW5pbWF0ZUR1cmF0aW9uLGVhc2luZzpjLmFuaW1hdGVFYXNpbmcsc3RlcDpmdW5jdGlvbigpe3ZhciBpPXt3aWR0aDpwYXJzZUludChhLmVsZW1lbnQuY3NzKCJ3aWR0aCIpLDEwKSxoZWlnaHQ6cGFyc2VJbnQoYS5lbGVtZW50LmNzcygiaGVpZ2h0IiksMTApLHRvcDpwYXJzZUludChhLmVsZW1lbnQuY3NzKCJ0b3AiKSwxMCksbGVmdDpwYXJzZUludChhLmVsZW1lbnQuY3NzKCJsZWZ0IiksMTApfTtkJiZkLmxlbmd0aCYmZShkWzBdKS5jc3Moe3dpZHRoOmkud2lkdGgsaGVpZ2h0OmkuaGVpZ2h0fSk7YS5fdXBkYXRlQ2FjaGUoaSk7YS5fcHJvcGFnYXRlKCJyZXNpemUiLApiKX19KX19KTtlLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsImNvbnRhaW5tZW50Iix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgYj1lKHRoaXMpLmRhdGEoInJlc2l6YWJsZSIpLGE9Yi5lbGVtZW50LGM9Yi5vcHRpb25zLmNvbnRhaW5tZW50O2lmKGE9YyBpbnN0YW5jZW9mIGU/Yy5nZXQoMCk6L3BhcmVudC8udGVzdChjKT9hLnBhcmVudCgpLmdldCgwKTpjKXtiLmNvbnRhaW5lckVsZW1lbnQ9ZShhKTtpZigvZG9jdW1lbnQvLnRlc3QoYyl8fGM9PWRvY3VtZW50KXtiLmNvbnRhaW5lck9mZnNldD17bGVmdDowLHRvcDowfTtiLmNvbnRhaW5lclBvc2l0aW9uPXtsZWZ0OjAsdG9wOjB9O2IucGFyZW50RGF0YT17ZWxlbWVudDplKGRvY3VtZW50KSxsZWZ0OjAsdG9wOjAsd2lkdGg6ZShkb2N1bWVudCkud2lkdGgoKSxoZWlnaHQ6ZShkb2N1bWVudCkuaGVpZ2h0KCl8fGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZS5zY3JvbGxIZWlnaHR9fWVsc2V7dmFyIGQ9ZShhKSxmPVtdO2UoWyJUb3AiLAoiUmlnaHQiLCJMZWZ0IiwiQm90dG9tIl0pLmVhY2goZnVuY3Rpb24oaSxqKXtmW2ldPW0oZC5jc3MoInBhZGRpbmciK2opKX0pO2IuY29udGFpbmVyT2Zmc2V0PWQub2Zmc2V0KCk7Yi5jb250YWluZXJQb3NpdGlvbj1kLnBvc2l0aW9uKCk7Yi5jb250YWluZXJTaXplPXtoZWlnaHQ6ZC5pbm5lckhlaWdodCgpLWZbM10sd2lkdGg6ZC5pbm5lcldpZHRoKCktZlsxXX07Yz1iLmNvbnRhaW5lck9mZnNldDt2YXIgZz1iLmNvbnRhaW5lclNpemUuaGVpZ2h0LGg9Yi5jb250YWluZXJTaXplLndpZHRoO2g9ZS51aS5oYXNTY3JvbGwoYSwibGVmdCIpP2Euc2Nyb2xsV2lkdGg6aDtnPWUudWkuaGFzU2Nyb2xsKGEpP2Euc2Nyb2xsSGVpZ2h0Omc7Yi5wYXJlbnREYXRhPXtlbGVtZW50OmEsbGVmdDpjLmxlZnQsdG9wOmMudG9wLHdpZHRoOmgsaGVpZ2h0Omd9fX19LHJlc2l6ZTpmdW5jdGlvbihiKXt2YXIgYT1lKHRoaXMpLmRhdGEoInJlc2l6YWJsZSIpLGM9YS5vcHRpb25zLGQ9YS5jb250YWluZXJPZmZzZXQsCmY9YS5wb3NpdGlvbjtiPWEuX2FzcGVjdFJhdGlvfHxiLnNoaWZ0S2V5O3ZhciBnPXt0b3A6MCxsZWZ0OjB9LGg9YS5jb250YWluZXJFbGVtZW50O2lmKGhbMF0hPWRvY3VtZW50JiYvc3RhdGljLy50ZXN0KGguY3NzKCJwb3NpdGlvbiIpKSlnPWQ7aWYoZi5sZWZ0PChhLl9oZWxwZXI/ZC5sZWZ0OjApKXthLnNpemUud2lkdGgrPWEuX2hlbHBlcj9hLnBvc2l0aW9uLmxlZnQtZC5sZWZ0OmEucG9zaXRpb24ubGVmdC1nLmxlZnQ7aWYoYilhLnNpemUuaGVpZ2h0PWEuc2l6ZS53aWR0aC9jLmFzcGVjdFJhdGlvO2EucG9zaXRpb24ubGVmdD1jLmhlbHBlcj9kLmxlZnQ6MH1pZihmLnRvcDwoYS5faGVscGVyP2QudG9wOjApKXthLnNpemUuaGVpZ2h0Kz1hLl9oZWxwZXI/YS5wb3NpdGlvbi50b3AtZC50b3A6YS5wb3NpdGlvbi50b3A7aWYoYilhLnNpemUud2lkdGg9YS5zaXplLmhlaWdodCpjLmFzcGVjdFJhdGlvO2EucG9zaXRpb24udG9wPWEuX2hlbHBlcj9kLnRvcDowfWEub2Zmc2V0LmxlZnQ9CmEucGFyZW50RGF0YS5sZWZ0K2EucG9zaXRpb24ubGVmdDthLm9mZnNldC50b3A9YS5wYXJlbnREYXRhLnRvcCthLnBvc2l0aW9uLnRvcDtjPU1hdGguYWJzKChhLl9oZWxwZXI/YS5vZmZzZXQubGVmdC1nLmxlZnQ6YS5vZmZzZXQubGVmdC1nLmxlZnQpK2Euc2l6ZURpZmYud2lkdGgpO2Q9TWF0aC5hYnMoKGEuX2hlbHBlcj9hLm9mZnNldC50b3AtZy50b3A6YS5vZmZzZXQudG9wLWQudG9wKSthLnNpemVEaWZmLmhlaWdodCk7Zj1hLmNvbnRhaW5lckVsZW1lbnQuZ2V0KDApPT1hLmVsZW1lbnQucGFyZW50KCkuZ2V0KDApO2c9L3JlbGF0aXZlfGFic29sdXRlLy50ZXN0KGEuY29udGFpbmVyRWxlbWVudC5jc3MoInBvc2l0aW9uIikpO2lmKGYmJmcpYy09YS5wYXJlbnREYXRhLmxlZnQ7aWYoYythLnNpemUud2lkdGg+PWEucGFyZW50RGF0YS53aWR0aCl7YS5zaXplLndpZHRoPWEucGFyZW50RGF0YS53aWR0aC1jO2lmKGIpYS5zaXplLmhlaWdodD1hLnNpemUud2lkdGgvYS5hc3BlY3RSYXRpb31pZihkKwphLnNpemUuaGVpZ2h0Pj1hLnBhcmVudERhdGEuaGVpZ2h0KXthLnNpemUuaGVpZ2h0PWEucGFyZW50RGF0YS5oZWlnaHQtZDtpZihiKWEuc2l6ZS53aWR0aD1hLnNpemUuaGVpZ2h0KmEuYXNwZWN0UmF0aW99fSxzdG9wOmZ1bmN0aW9uKCl7dmFyIGI9ZSh0aGlzKS5kYXRhKCJyZXNpemFibGUiKSxhPWIub3B0aW9ucyxjPWIuY29udGFpbmVyT2Zmc2V0LGQ9Yi5jb250YWluZXJQb3NpdGlvbixmPWIuY29udGFpbmVyRWxlbWVudCxnPWUoYi5oZWxwZXIpLGg9Zy5vZmZzZXQoKSxpPWcub3V0ZXJXaWR0aCgpLWIuc2l6ZURpZmYud2lkdGg7Zz1nLm91dGVySGVpZ2h0KCktYi5zaXplRGlmZi5oZWlnaHQ7Yi5faGVscGVyJiYhYS5hbmltYXRlJiYvcmVsYXRpdmUvLnRlc3QoZi5jc3MoInBvc2l0aW9uIikpJiZlKHRoaXMpLmNzcyh7bGVmdDpoLmxlZnQtZC5sZWZ0LWMubGVmdCx3aWR0aDppLGhlaWdodDpnfSk7Yi5faGVscGVyJiYhYS5hbmltYXRlJiYvc3RhdGljLy50ZXN0KGYuY3NzKCJwb3NpdGlvbiIpKSYmCmUodGhpcykuY3NzKHtsZWZ0OmgubGVmdC1kLmxlZnQtYy5sZWZ0LHdpZHRoOmksaGVpZ2h0Omd9KX19KTtlLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsImdob3N0Iix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgYj1lKHRoaXMpLmRhdGEoInJlc2l6YWJsZSIpLGE9Yi5vcHRpb25zLGM9Yi5zaXplO2IuZ2hvc3Q9Yi5vcmlnaW5hbEVsZW1lbnQuY2xvbmUoKTtiLmdob3N0LmNzcyh7b3BhY2l0eTowLjI1LGRpc3BsYXk6ImJsb2NrIixwb3NpdGlvbjoicmVsYXRpdmUiLGhlaWdodDpjLmhlaWdodCx3aWR0aDpjLndpZHRoLG1hcmdpbjowLGxlZnQ6MCx0b3A6MH0pLmFkZENsYXNzKCJ1aS1yZXNpemFibGUtZ2hvc3QiKS5hZGRDbGFzcyh0eXBlb2YgYS5naG9zdD09InN0cmluZyI/YS5naG9zdDoiIik7Yi5naG9zdC5hcHBlbmRUbyhiLmhlbHBlcil9LHJlc2l6ZTpmdW5jdGlvbigpe3ZhciBiPWUodGhpcykuZGF0YSgicmVzaXphYmxlIik7Yi5naG9zdCYmYi5naG9zdC5jc3Moe3Bvc2l0aW9uOiJyZWxhdGl2ZSIsCmhlaWdodDpiLnNpemUuaGVpZ2h0LHdpZHRoOmIuc2l6ZS53aWR0aH0pfSxzdG9wOmZ1bmN0aW9uKCl7dmFyIGI9ZSh0aGlzKS5kYXRhKCJyZXNpemFibGUiKTtiLmdob3N0JiZiLmhlbHBlciYmYi5oZWxwZXIuZ2V0KDApLnJlbW92ZUNoaWxkKGIuZ2hvc3QuZ2V0KDApKX19KTtlLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsImdyaWQiLHtyZXNpemU6ZnVuY3Rpb24oKXt2YXIgYj1lKHRoaXMpLmRhdGEoInJlc2l6YWJsZSIpLGE9Yi5vcHRpb25zLGM9Yi5zaXplLGQ9Yi5vcmlnaW5hbFNpemUsZj1iLm9yaWdpbmFsUG9zaXRpb24sZz1iLmF4aXM7YS5ncmlkPXR5cGVvZiBhLmdyaWQ9PSJudW1iZXIiP1thLmdyaWQsYS5ncmlkXTphLmdyaWQ7dmFyIGg9TWF0aC5yb3VuZCgoYy53aWR0aC1kLndpZHRoKS8oYS5ncmlkWzBdfHwxKSkqKGEuZ3JpZFswXXx8MSk7YT1NYXRoLnJvdW5kKChjLmhlaWdodC1kLmhlaWdodCkvKGEuZ3JpZFsxXXx8MSkpKihhLmdyaWRbMV18fDEpO2lmKC9eKHNlfHN8ZSkkLy50ZXN0KGcpKXtiLnNpemUud2lkdGg9CmQud2lkdGgraDtiLnNpemUuaGVpZ2h0PWQuaGVpZ2h0K2F9ZWxzZSBpZigvXihuZSkkLy50ZXN0KGcpKXtiLnNpemUud2lkdGg9ZC53aWR0aCtoO2Iuc2l6ZS5oZWlnaHQ9ZC5oZWlnaHQrYTtiLnBvc2l0aW9uLnRvcD1mLnRvcC1hfWVsc2V7aWYoL14oc3cpJC8udGVzdChnKSl7Yi5zaXplLndpZHRoPWQud2lkdGgraDtiLnNpemUuaGVpZ2h0PWQuaGVpZ2h0K2F9ZWxzZXtiLnNpemUud2lkdGg9ZC53aWR0aCtoO2Iuc2l6ZS5oZWlnaHQ9ZC5oZWlnaHQrYTtiLnBvc2l0aW9uLnRvcD1mLnRvcC1hfWIucG9zaXRpb24ubGVmdD1mLmxlZnQtaH19fSk7dmFyIG09ZnVuY3Rpb24oYil7cmV0dXJuIHBhcnNlSW50KGIsMTApfHwwfSxsPWZ1bmN0aW9uKGIpe3JldHVybiFpc05hTihwYXJzZUludChiLDEwKSl9fSkoalF1ZXJ5KTsKKGZ1bmN0aW9uKGUpe2Uud2lkZ2V0KCJ1aS5zZWxlY3RhYmxlIixlLnVpLm1vdXNlLHtvcHRpb25zOnthcHBlbmRUbzoiYm9keSIsYXV0b1JlZnJlc2g6dHJ1ZSxkaXN0YW5jZTowLGZpbHRlcjoiKiIsdG9sZXJhbmNlOiJ0b3VjaCJ9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgYz10aGlzO3RoaXMuZWxlbWVudC5hZGRDbGFzcygidWktc2VsZWN0YWJsZSIpO3RoaXMuZHJhZ2dlZD1mYWxzZTt2YXIgZjt0aGlzLnJlZnJlc2g9ZnVuY3Rpb24oKXtmPWUoYy5vcHRpb25zLmZpbHRlcixjLmVsZW1lbnRbMF0pO2YuZWFjaChmdW5jdGlvbigpe3ZhciBkPWUodGhpcyksYj1kLm9mZnNldCgpO2UuZGF0YSh0aGlzLCJzZWxlY3RhYmxlLWl0ZW0iLHtlbGVtZW50OnRoaXMsJGVsZW1lbnQ6ZCxsZWZ0OmIubGVmdCx0b3A6Yi50b3AscmlnaHQ6Yi5sZWZ0K2Qub3V0ZXJXaWR0aCgpLGJvdHRvbTpiLnRvcCtkLm91dGVySGVpZ2h0KCksc3RhcnRzZWxlY3RlZDpmYWxzZSxzZWxlY3RlZDpkLmhhc0NsYXNzKCJ1aS1zZWxlY3RlZCIpLApzZWxlY3Rpbmc6ZC5oYXNDbGFzcygidWktc2VsZWN0aW5nIiksdW5zZWxlY3Rpbmc6ZC5oYXNDbGFzcygidWktdW5zZWxlY3RpbmciKX0pfSl9O3RoaXMucmVmcmVzaCgpO3RoaXMuc2VsZWN0ZWVzPWYuYWRkQ2xhc3MoInVpLXNlbGVjdGVlIik7dGhpcy5fbW91c2VJbml0KCk7dGhpcy5oZWxwZXI9ZSgiPGRpdiBjbGFzcz0ndWktc2VsZWN0YWJsZS1oZWxwZXInPjwvZGl2PiIpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5zZWxlY3RlZXMucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGVlIikucmVtb3ZlRGF0YSgic2VsZWN0YWJsZS1pdGVtIik7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RhYmxlIHVpLXNlbGVjdGFibGUtZGlzYWJsZWQiKS5yZW1vdmVEYXRhKCJzZWxlY3RhYmxlIikudW5iaW5kKCIuc2VsZWN0YWJsZSIpO3RoaXMuX21vdXNlRGVzdHJveSgpO3JldHVybiB0aGlzfSxfbW91c2VTdGFydDpmdW5jdGlvbihjKXt2YXIgZj10aGlzO3RoaXMub3Bvcz1bYy5wYWdlWCwKYy5wYWdlWV07aWYoIXRoaXMub3B0aW9ucy5kaXNhYmxlZCl7dmFyIGQ9dGhpcy5vcHRpb25zO3RoaXMuc2VsZWN0ZWVzPWUoZC5maWx0ZXIsdGhpcy5lbGVtZW50WzBdKTt0aGlzLl90cmlnZ2VyKCJzdGFydCIsYyk7ZShkLmFwcGVuZFRvKS5hcHBlbmQodGhpcy5oZWxwZXIpO3RoaXMuaGVscGVyLmNzcyh7bGVmdDpjLmNsaWVudFgsdG9wOmMuY2xpZW50WSx3aWR0aDowLGhlaWdodDowfSk7ZC5hdXRvUmVmcmVzaCYmdGhpcy5yZWZyZXNoKCk7dGhpcy5zZWxlY3RlZXMuZmlsdGVyKCIudWktc2VsZWN0ZWQiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9ZS5kYXRhKHRoaXMsInNlbGVjdGFibGUtaXRlbSIpO2Iuc3RhcnRzZWxlY3RlZD10cnVlO2lmKCFjLm1ldGFLZXkpe2IuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGVkIik7Yi5zZWxlY3RlZD1mYWxzZTtiLiRlbGVtZW50LmFkZENsYXNzKCJ1aS11bnNlbGVjdGluZyIpO2IudW5zZWxlY3Rpbmc9dHJ1ZTtmLl90cmlnZ2VyKCJ1bnNlbGVjdGluZyIsCmMse3Vuc2VsZWN0aW5nOmIuZWxlbWVudH0pfX0pO2UoYy50YXJnZXQpLnBhcmVudHMoKS5hbmRTZWxmKCkuZWFjaChmdW5jdGlvbigpe3ZhciBiPWUuZGF0YSh0aGlzLCJzZWxlY3RhYmxlLWl0ZW0iKTtpZihiKXt2YXIgZz0hYy5tZXRhS2V5fHwhYi4kZWxlbWVudC5oYXNDbGFzcygidWktc2VsZWN0ZWQiKTtiLiRlbGVtZW50LnJlbW92ZUNsYXNzKGc/InVpLXVuc2VsZWN0aW5nIjoidWktc2VsZWN0ZWQiKS5hZGRDbGFzcyhnPyJ1aS1zZWxlY3RpbmciOiJ1aS11bnNlbGVjdGluZyIpO2IudW5zZWxlY3Rpbmc9IWc7Yi5zZWxlY3Rpbmc9ZzsoYi5zZWxlY3RlZD1nKT9mLl90cmlnZ2VyKCJzZWxlY3RpbmciLGMse3NlbGVjdGluZzpiLmVsZW1lbnR9KTpmLl90cmlnZ2VyKCJ1bnNlbGVjdGluZyIsYyx7dW5zZWxlY3Rpbmc6Yi5lbGVtZW50fSk7cmV0dXJuIGZhbHNlfX0pfX0sX21vdXNlRHJhZzpmdW5jdGlvbihjKXt2YXIgZj10aGlzO3RoaXMuZHJhZ2dlZD10cnVlO2lmKCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQpe3ZhciBkPQp0aGlzLm9wdGlvbnMsYj10aGlzLm9wb3NbMF0sZz10aGlzLm9wb3NbMV0saD1jLnBhZ2VYLGk9Yy5wYWdlWTtpZihiPmgpe3ZhciBqPWg7aD1iO2I9an1pZihnPmkpe2o9aTtpPWc7Zz1qfXRoaXMuaGVscGVyLmNzcyh7bGVmdDpiLHRvcDpnLHdpZHRoOmgtYixoZWlnaHQ6aS1nfSk7dGhpcy5zZWxlY3RlZXMuZWFjaChmdW5jdGlvbigpe3ZhciBhPWUuZGF0YSh0aGlzLCJzZWxlY3RhYmxlLWl0ZW0iKTtpZighKCFhfHxhLmVsZW1lbnQ9PWYuZWxlbWVudFswXSkpe3ZhciBrPWZhbHNlO2lmKGQudG9sZXJhbmNlPT0idG91Y2giKWs9IShhLmxlZnQ+aHx8YS5yaWdodDxifHxhLnRvcD5pfHxhLmJvdHRvbTxnKTtlbHNlIGlmKGQudG9sZXJhbmNlPT0iZml0IilrPWEubGVmdD5iJiZhLnJpZ2h0PGgmJmEudG9wPmcmJmEuYm90dG9tPGk7aWYoayl7aWYoYS5zZWxlY3RlZCl7YS4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0ZWQiKTthLnNlbGVjdGVkPWZhbHNlfWlmKGEudW5zZWxlY3Rpbmcpe2EuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXVuc2VsZWN0aW5nIik7CmEudW5zZWxlY3Rpbmc9ZmFsc2V9aWYoIWEuc2VsZWN0aW5nKXthLiRlbGVtZW50LmFkZENsYXNzKCJ1aS1zZWxlY3RpbmciKTthLnNlbGVjdGluZz10cnVlO2YuX3RyaWdnZXIoInNlbGVjdGluZyIsYyx7c2VsZWN0aW5nOmEuZWxlbWVudH0pfX1lbHNle2lmKGEuc2VsZWN0aW5nKWlmKGMubWV0YUtleSYmYS5zdGFydHNlbGVjdGVkKXthLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RpbmciKTthLnNlbGVjdGluZz1mYWxzZTthLiRlbGVtZW50LmFkZENsYXNzKCJ1aS1zZWxlY3RlZCIpO2Euc2VsZWN0ZWQ9dHJ1ZX1lbHNle2EuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGluZyIpO2Euc2VsZWN0aW5nPWZhbHNlO2lmKGEuc3RhcnRzZWxlY3RlZCl7YS4kZWxlbWVudC5hZGRDbGFzcygidWktdW5zZWxlY3RpbmciKTthLnVuc2VsZWN0aW5nPXRydWV9Zi5fdHJpZ2dlcigidW5zZWxlY3RpbmciLGMse3Vuc2VsZWN0aW5nOmEuZWxlbWVudH0pfWlmKGEuc2VsZWN0ZWQpaWYoIWMubWV0YUtleSYmCiFhLnN0YXJ0c2VsZWN0ZWQpe2EuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGVkIik7YS5zZWxlY3RlZD1mYWxzZTthLiRlbGVtZW50LmFkZENsYXNzKCJ1aS11bnNlbGVjdGluZyIpO2EudW5zZWxlY3Rpbmc9dHJ1ZTtmLl90cmlnZ2VyKCJ1bnNlbGVjdGluZyIsYyx7dW5zZWxlY3Rpbmc6YS5lbGVtZW50fSl9fX19KTtyZXR1cm4gZmFsc2V9fSxfbW91c2VTdG9wOmZ1bmN0aW9uKGMpe3ZhciBmPXRoaXM7dGhpcy5kcmFnZ2VkPWZhbHNlO2UoIi51aS11bnNlbGVjdGluZyIsdGhpcy5lbGVtZW50WzBdKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9ZS5kYXRhKHRoaXMsInNlbGVjdGFibGUtaXRlbSIpO2QuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXVuc2VsZWN0aW5nIik7ZC51bnNlbGVjdGluZz1mYWxzZTtkLnN0YXJ0c2VsZWN0ZWQ9ZmFsc2U7Zi5fdHJpZ2dlcigidW5zZWxlY3RlZCIsYyx7dW5zZWxlY3RlZDpkLmVsZW1lbnR9KX0pO2UoIi51aS1zZWxlY3RpbmciLHRoaXMuZWxlbWVudFswXSkuZWFjaChmdW5jdGlvbigpe3ZhciBkPQplLmRhdGEodGhpcywic2VsZWN0YWJsZS1pdGVtIik7ZC4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0aW5nIikuYWRkQ2xhc3MoInVpLXNlbGVjdGVkIik7ZC5zZWxlY3Rpbmc9ZmFsc2U7ZC5zZWxlY3RlZD10cnVlO2Quc3RhcnRzZWxlY3RlZD10cnVlO2YuX3RyaWdnZXIoInNlbGVjdGVkIixjLHtzZWxlY3RlZDpkLmVsZW1lbnR9KX0pO3RoaXMuX3RyaWdnZXIoInN0b3AiLGMpO3RoaXMuaGVscGVyLnJlbW92ZSgpO3JldHVybiBmYWxzZX19KTtlLmV4dGVuZChlLnVpLnNlbGVjdGFibGUse3ZlcnNpb246IjEuOC41In0pfSkoalF1ZXJ5KTsKKGZ1bmN0aW9uKGQpe2Qud2lkZ2V0KCJ1aS5zb3J0YWJsZSIsZC51aS5tb3VzZSx7d2lkZ2V0RXZlbnRQcmVmaXg6InNvcnQiLG9wdGlvbnM6e2FwcGVuZFRvOiJwYXJlbnQiLGF4aXM6ZmFsc2UsY29ubmVjdFdpdGg6ZmFsc2UsY29udGFpbm1lbnQ6ZmFsc2UsY3Vyc29yOiJhdXRvIixjdXJzb3JBdDpmYWxzZSxkcm9wT25FbXB0eTp0cnVlLGZvcmNlUGxhY2Vob2xkZXJTaXplOmZhbHNlLGZvcmNlSGVscGVyU2l6ZTpmYWxzZSxncmlkOmZhbHNlLGhhbmRsZTpmYWxzZSxoZWxwZXI6Im9yaWdpbmFsIixpdGVtczoiPiAqIixvcGFjaXR5OmZhbHNlLHBsYWNlaG9sZGVyOmZhbHNlLHJldmVydDpmYWxzZSxzY3JvbGw6dHJ1ZSxzY3JvbGxTZW5zaXRpdml0eToyMCxzY3JvbGxTcGVlZDoyMCxzY29wZToiZGVmYXVsdCIsdG9sZXJhbmNlOiJpbnRlcnNlY3QiLHpJbmRleDoxRTN9LF9jcmVhdGU6ZnVuY3Rpb24oKXt0aGlzLmNvbnRhaW5lckNhY2hlPXt9O3RoaXMuZWxlbWVudC5hZGRDbGFzcygidWktc29ydGFibGUiKTsKdGhpcy5yZWZyZXNoKCk7dGhpcy5mbG9hdGluZz10aGlzLml0ZW1zLmxlbmd0aD8vbGVmdHxyaWdodC8udGVzdCh0aGlzLml0ZW1zWzBdLml0ZW0uY3NzKCJmbG9hdCIpKTpmYWxzZTt0aGlzLm9mZnNldD10aGlzLmVsZW1lbnQub2Zmc2V0KCk7dGhpcy5fbW91c2VJbml0KCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNvcnRhYmxlIHVpLXNvcnRhYmxlLWRpc2FibGVkIikucmVtb3ZlRGF0YSgic29ydGFibGUiKS51bmJpbmQoIi5zb3J0YWJsZSIpO3RoaXMuX21vdXNlRGVzdHJveSgpO2Zvcih2YXIgYT10aGlzLml0ZW1zLmxlbmd0aC0xO2E+PTA7YS0tKXRoaXMuaXRlbXNbYV0uaXRlbS5yZW1vdmVEYXRhKCJzb3J0YWJsZS1pdGVtIik7cmV0dXJuIHRoaXN9LF9zZXRPcHRpb246ZnVuY3Rpb24oYSxiKXtpZihhPT09ImRpc2FibGVkIil7dGhpcy5vcHRpb25zW2FdPWI7dGhpcy53aWRnZXQoKVtiPyJhZGRDbGFzcyI6InJlbW92ZUNsYXNzIl0oInVpLXNvcnRhYmxlLWRpc2FibGVkIil9ZWxzZSBkLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLAphcmd1bWVudHMpfSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKGEsYil7aWYodGhpcy5yZXZlcnRpbmcpcmV0dXJuIGZhbHNlO2lmKHRoaXMub3B0aW9ucy5kaXNhYmxlZHx8dGhpcy5vcHRpb25zLnR5cGU9PSJzdGF0aWMiKXJldHVybiBmYWxzZTt0aGlzLl9yZWZyZXNoSXRlbXMoYSk7dmFyIGM9bnVsbCxlPXRoaXM7ZChhLnRhcmdldCkucGFyZW50cygpLmVhY2goZnVuY3Rpb24oKXtpZihkLmRhdGEodGhpcywic29ydGFibGUtaXRlbSIpPT1lKXtjPWQodGhpcyk7cmV0dXJuIGZhbHNlfX0pO2lmKGQuZGF0YShhLnRhcmdldCwic29ydGFibGUtaXRlbSIpPT1lKWM9ZChhLnRhcmdldCk7aWYoIWMpcmV0dXJuIGZhbHNlO2lmKHRoaXMub3B0aW9ucy5oYW5kbGUmJiFiKXt2YXIgZj1mYWxzZTtkKHRoaXMub3B0aW9ucy5oYW5kbGUsYykuZmluZCgiKiIpLmFuZFNlbGYoKS5lYWNoKGZ1bmN0aW9uKCl7aWYodGhpcz09YS50YXJnZXQpZj10cnVlfSk7aWYoIWYpcmV0dXJuIGZhbHNlfXRoaXMuY3VycmVudEl0ZW09CmM7dGhpcy5fcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXMoKTtyZXR1cm4gdHJ1ZX0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oYSxiLGMpe2I9dGhpcy5vcHRpb25zO3ZhciBlPXRoaXM7dGhpcy5jdXJyZW50Q29udGFpbmVyPXRoaXM7dGhpcy5yZWZyZXNoUG9zaXRpb25zKCk7dGhpcy5oZWxwZXI9dGhpcy5fY3JlYXRlSGVscGVyKGEpO3RoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKTt0aGlzLl9jYWNoZU1hcmdpbnMoKTt0aGlzLnNjcm9sbFBhcmVudD10aGlzLmhlbHBlci5zY3JvbGxQYXJlbnQoKTt0aGlzLm9mZnNldD10aGlzLmN1cnJlbnRJdGVtLm9mZnNldCgpO3RoaXMub2Zmc2V0PXt0b3A6dGhpcy5vZmZzZXQudG9wLXRoaXMubWFyZ2lucy50b3AsbGVmdDp0aGlzLm9mZnNldC5sZWZ0LXRoaXMubWFyZ2lucy5sZWZ0fTt0aGlzLmhlbHBlci5jc3MoInBvc2l0aW9uIiwiYWJzb2x1dGUiKTt0aGlzLmNzc1Bvc2l0aW9uPXRoaXMuaGVscGVyLmNzcygicG9zaXRpb24iKTtkLmV4dGVuZCh0aGlzLm9mZnNldCwKe2NsaWNrOntsZWZ0OmEucGFnZVgtdGhpcy5vZmZzZXQubGVmdCx0b3A6YS5wYWdlWS10aGlzLm9mZnNldC50b3B9LHBhcmVudDp0aGlzLl9nZXRQYXJlbnRPZmZzZXQoKSxyZWxhdGl2ZTp0aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpfSk7dGhpcy5vcmlnaW5hbFBvc2l0aW9uPXRoaXMuX2dlbmVyYXRlUG9zaXRpb24oYSk7dGhpcy5vcmlnaW5hbFBhZ2VYPWEucGFnZVg7dGhpcy5vcmlnaW5hbFBhZ2VZPWEucGFnZVk7Yi5jdXJzb3JBdCYmdGhpcy5fYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcihiLmN1cnNvckF0KTt0aGlzLmRvbVBvc2l0aW9uPXtwcmV2OnRoaXMuY3VycmVudEl0ZW0ucHJldigpWzBdLHBhcmVudDp0aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpWzBdfTt0aGlzLmhlbHBlclswXSE9dGhpcy5jdXJyZW50SXRlbVswXSYmdGhpcy5jdXJyZW50SXRlbS5oaWRlKCk7dGhpcy5fY3JlYXRlUGxhY2Vob2xkZXIoKTtiLmNvbnRhaW5tZW50JiZ0aGlzLl9zZXRDb250YWlubWVudCgpOwppZihiLmN1cnNvcil7aWYoZCgiYm9keSIpLmNzcygiY3Vyc29yIikpdGhpcy5fc3RvcmVkQ3Vyc29yPWQoImJvZHkiKS5jc3MoImN1cnNvciIpO2QoImJvZHkiKS5jc3MoImN1cnNvciIsYi5jdXJzb3IpfWlmKGIub3BhY2l0eSl7aWYodGhpcy5oZWxwZXIuY3NzKCJvcGFjaXR5IikpdGhpcy5fc3RvcmVkT3BhY2l0eT10aGlzLmhlbHBlci5jc3MoIm9wYWNpdHkiKTt0aGlzLmhlbHBlci5jc3MoIm9wYWNpdHkiLGIub3BhY2l0eSl9aWYoYi56SW5kZXgpe2lmKHRoaXMuaGVscGVyLmNzcygiekluZGV4IikpdGhpcy5fc3RvcmVkWkluZGV4PXRoaXMuaGVscGVyLmNzcygiekluZGV4Iik7dGhpcy5oZWxwZXIuY3NzKCJ6SW5kZXgiLGIuekluZGV4KX1pZih0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJnRoaXMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUhPSJIVE1MIil0aGlzLm92ZXJmbG93T2Zmc2V0PXRoaXMuc2Nyb2xsUGFyZW50Lm9mZnNldCgpO3RoaXMuX3RyaWdnZXIoInN0YXJ0IiwKYSx0aGlzLl91aUhhc2goKSk7dGhpcy5fcHJlc2VydmVIZWxwZXJQcm9wb3J0aW9uc3x8dGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpO2lmKCFjKWZvcihjPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtjPj0wO2MtLSl0aGlzLmNvbnRhaW5lcnNbY10uX3RyaWdnZXIoImFjdGl2YXRlIixhLGUuX3VpSGFzaCh0aGlzKSk7aWYoZC51aS5kZG1hbmFnZXIpZC51aS5kZG1hbmFnZXIuY3VycmVudD10aGlzO2QudWkuZGRtYW5hZ2VyJiYhYi5kcm9wQmVoYXZpb3VyJiZkLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLGEpO3RoaXMuZHJhZ2dpbmc9dHJ1ZTt0aGlzLmhlbHBlci5hZGRDbGFzcygidWktc29ydGFibGUtaGVscGVyIik7dGhpcy5fbW91c2VEcmFnKGEpO3JldHVybiB0cnVlfSxfbW91c2VEcmFnOmZ1bmN0aW9uKGEpe3RoaXMucG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbihhKTt0aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKCJhYnNvbHV0ZSIpOwppZighdGhpcy5sYXN0UG9zaXRpb25BYnMpdGhpcy5sYXN0UG9zaXRpb25BYnM9dGhpcy5wb3NpdGlvbkFicztpZih0aGlzLm9wdGlvbnMuc2Nyb2xsKXt2YXIgYj10aGlzLm9wdGlvbnMsYz1mYWxzZTtpZih0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJnRoaXMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUhPSJIVE1MIil7aWYodGhpcy5vdmVyZmxvd09mZnNldC50b3ArdGhpcy5zY3JvbGxQYXJlbnRbMF0ub2Zmc2V0SGVpZ2h0LWEucGFnZVk8Yi5zY3JvbGxTZW5zaXRpdml0eSl0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3A9Yz10aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3ArYi5zY3JvbGxTcGVlZDtlbHNlIGlmKGEucGFnZVktdGhpcy5vdmVyZmxvd09mZnNldC50b3A8Yi5zY3JvbGxTZW5zaXRpdml0eSl0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3A9Yz10aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AtYi5zY3JvbGxTcGVlZDtpZih0aGlzLm92ZXJmbG93T2Zmc2V0LmxlZnQrCnRoaXMuc2Nyb2xsUGFyZW50WzBdLm9mZnNldFdpZHRoLWEucGFnZVg8Yi5zY3JvbGxTZW5zaXRpdml0eSl0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0PWM9dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdCtiLnNjcm9sbFNwZWVkO2Vsc2UgaWYoYS5wYWdlWC10aGlzLm92ZXJmbG93T2Zmc2V0LmxlZnQ8Yi5zY3JvbGxTZW5zaXRpdml0eSl0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0PWM9dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdC1iLnNjcm9sbFNwZWVkfWVsc2V7aWYoYS5wYWdlWS1kKGRvY3VtZW50KS5zY3JvbGxUb3AoKTxiLnNjcm9sbFNlbnNpdGl2aXR5KWM9ZChkb2N1bWVudCkuc2Nyb2xsVG9wKGQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpLWIuc2Nyb2xsU3BlZWQpO2Vsc2UgaWYoZCh3aW5kb3cpLmhlaWdodCgpLShhLnBhZ2VZLWQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpKTxiLnNjcm9sbFNlbnNpdGl2aXR5KWM9ZChkb2N1bWVudCkuc2Nyb2xsVG9wKGQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpKwpiLnNjcm9sbFNwZWVkKTtpZihhLnBhZ2VYLWQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKTxiLnNjcm9sbFNlbnNpdGl2aXR5KWM9ZChkb2N1bWVudCkuc2Nyb2xsTGVmdChkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCktYi5zY3JvbGxTcGVlZCk7ZWxzZSBpZihkKHdpbmRvdykud2lkdGgoKS0oYS5wYWdlWC1kKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkpPGIuc2Nyb2xsU2Vuc2l0aXZpdHkpYz1kKGRvY3VtZW50KS5zY3JvbGxMZWZ0KGQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKStiLnNjcm9sbFNwZWVkKX1jIT09ZmFsc2UmJmQudWkuZGRtYW5hZ2VyJiYhYi5kcm9wQmVoYXZpb3VyJiZkLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLGEpfXRoaXMucG9zaXRpb25BYnM9dGhpcy5fY29udmVydFBvc2l0aW9uVG8oImFic29sdXRlIik7aWYoIXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLm9wdGlvbnMuYXhpcyE9InkiKXRoaXMuaGVscGVyWzBdLnN0eWxlLmxlZnQ9dGhpcy5wb3NpdGlvbi5sZWZ0KwoicHgiO2lmKCF0aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5vcHRpb25zLmF4aXMhPSJ4Iil0aGlzLmhlbHBlclswXS5zdHlsZS50b3A9dGhpcy5wb3NpdGlvbi50b3ArInB4Ijtmb3IoYj10aGlzLml0ZW1zLmxlbmd0aC0xO2I+PTA7Yi0tKXtjPXRoaXMuaXRlbXNbYl07dmFyIGU9Yy5pdGVtWzBdLGY9dGhpcy5faW50ZXJzZWN0c1dpdGhQb2ludGVyKGMpO2lmKGYpaWYoZSE9dGhpcy5jdXJyZW50SXRlbVswXSYmdGhpcy5wbGFjZWhvbGRlcltmPT0xPyJuZXh0IjoicHJldiJdKClbMF0hPWUmJiFkLnVpLmNvbnRhaW5zKHRoaXMucGxhY2Vob2xkZXJbMF0sZSkmJih0aGlzLm9wdGlvbnMudHlwZT09InNlbWktZHluYW1pYyI/IWQudWkuY29udGFpbnModGhpcy5lbGVtZW50WzBdLGUpOnRydWUpKXt0aGlzLmRpcmVjdGlvbj1mPT0xPyJkb3duIjoidXAiO2lmKHRoaXMub3B0aW9ucy50b2xlcmFuY2U9PSJwb2ludGVyInx8dGhpcy5faW50ZXJzZWN0c1dpdGhTaWRlcyhjKSl0aGlzLl9yZWFycmFuZ2UoYSwKYyk7ZWxzZSBicmVhazt0aGlzLl90cmlnZ2VyKCJjaGFuZ2UiLGEsdGhpcy5fdWlIYXNoKCkpO2JyZWFrfX10aGlzLl9jb250YWN0Q29udGFpbmVycyhhKTtkLnVpLmRkbWFuYWdlciYmZC51aS5kZG1hbmFnZXIuZHJhZyh0aGlzLGEpO3RoaXMuX3RyaWdnZXIoInNvcnQiLGEsdGhpcy5fdWlIYXNoKCkpO3RoaXMubGFzdFBvc2l0aW9uQWJzPXRoaXMucG9zaXRpb25BYnM7cmV0dXJuIGZhbHNlfSxfbW91c2VTdG9wOmZ1bmN0aW9uKGEsYil7aWYoYSl7ZC51aS5kZG1hbmFnZXImJiF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91ciYmZC51aS5kZG1hbmFnZXIuZHJvcCh0aGlzLGEpO2lmKHRoaXMub3B0aW9ucy5yZXZlcnQpe3ZhciBjPXRoaXM7Yj1jLnBsYWNlaG9sZGVyLm9mZnNldCgpO2MucmV2ZXJ0aW5nPXRydWU7ZCh0aGlzLmhlbHBlcikuYW5pbWF0ZSh7bGVmdDpiLmxlZnQtdGhpcy5vZmZzZXQucGFyZW50LmxlZnQtYy5tYXJnaW5zLmxlZnQrKHRoaXMub2Zmc2V0UGFyZW50WzBdPT0KZG9jdW1lbnQuYm9keT8wOnRoaXMub2Zmc2V0UGFyZW50WzBdLnNjcm9sbExlZnQpLHRvcDpiLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wLWMubWFyZ2lucy50b3ArKHRoaXMub2Zmc2V0UGFyZW50WzBdPT1kb2N1bWVudC5ib2R5PzA6dGhpcy5vZmZzZXRQYXJlbnRbMF0uc2Nyb2xsVG9wKX0scGFyc2VJbnQodGhpcy5vcHRpb25zLnJldmVydCwxMCl8fDUwMCxmdW5jdGlvbigpe2MuX2NsZWFyKGEpfSl9ZWxzZSB0aGlzLl9jbGVhcihhLGIpO3JldHVybiBmYWxzZX19LGNhbmNlbDpmdW5jdGlvbigpe3ZhciBhPXRoaXM7aWYodGhpcy5kcmFnZ2luZyl7dGhpcy5fbW91c2VVcCgpO3RoaXMub3B0aW9ucy5oZWxwZXI9PSJvcmlnaW5hbCI/dGhpcy5jdXJyZW50SXRlbS5jc3ModGhpcy5fc3RvcmVkQ1NTKS5yZW1vdmVDbGFzcygidWktc29ydGFibGUtaGVscGVyIik6dGhpcy5jdXJyZW50SXRlbS5zaG93KCk7Zm9yKHZhciBiPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtiPj0wO2ItLSl7dGhpcy5jb250YWluZXJzW2JdLl90cmlnZ2VyKCJkZWFjdGl2YXRlIiwKbnVsbCxhLl91aUhhc2godGhpcykpO2lmKHRoaXMuY29udGFpbmVyc1tiXS5jb250YWluZXJDYWNoZS5vdmVyKXt0aGlzLmNvbnRhaW5lcnNbYl0uX3RyaWdnZXIoIm91dCIsbnVsbCxhLl91aUhhc2godGhpcykpO3RoaXMuY29udGFpbmVyc1tiXS5jb250YWluZXJDYWNoZS5vdmVyPTB9fX10aGlzLnBsYWNlaG9sZGVyWzBdLnBhcmVudE5vZGUmJnRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnBsYWNlaG9sZGVyWzBdKTt0aGlzLm9wdGlvbnMuaGVscGVyIT0ib3JpZ2luYWwiJiZ0aGlzLmhlbHBlciYmdGhpcy5oZWxwZXJbMF0ucGFyZW50Tm9kZSYmdGhpcy5oZWxwZXIucmVtb3ZlKCk7ZC5leHRlbmQodGhpcyx7aGVscGVyOm51bGwsZHJhZ2dpbmc6ZmFsc2UscmV2ZXJ0aW5nOmZhbHNlLF9ub0ZpbmFsU29ydDpudWxsfSk7dGhpcy5kb21Qb3NpdGlvbi5wcmV2P2QodGhpcy5kb21Qb3NpdGlvbi5wcmV2KS5hZnRlcih0aGlzLmN1cnJlbnRJdGVtKToKZCh0aGlzLmRvbVBvc2l0aW9uLnBhcmVudCkucHJlcGVuZCh0aGlzLmN1cnJlbnRJdGVtKTtyZXR1cm4gdGhpc30sc2VyaWFsaXplOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuX2dldEl0ZW1zQXNqUXVlcnkoYSYmYS5jb25uZWN0ZWQpLGM9W107YT1hfHx7fTtkKGIpLmVhY2goZnVuY3Rpb24oKXt2YXIgZT0oZChhLml0ZW18fHRoaXMpLmF0dHIoYS5hdHRyaWJ1dGV8fCJpZCIpfHwiIikubWF0Y2goYS5leHByZXNzaW9ufHwvKC4rKVstPV9dKC4rKS8pO2lmKGUpYy5wdXNoKChhLmtleXx8ZVsxXSsiW10iKSsiPSIrKGEua2V5JiZhLmV4cHJlc3Npb24/ZVsxXTplWzJdKSl9KTshYy5sZW5ndGgmJmEua2V5JiZjLnB1c2goYS5rZXkrIj0iKTtyZXR1cm4gYy5qb2luKCImIil9LHRvQXJyYXk6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fZ2V0SXRlbXNBc2pRdWVyeShhJiZhLmNvbm5lY3RlZCksYz1bXTthPWF8fHt9O2IuZWFjaChmdW5jdGlvbigpe2MucHVzaChkKGEuaXRlbXx8dGhpcykuYXR0cihhLmF0dHJpYnV0ZXx8CiJpZCIpfHwiIil9KTtyZXR1cm4gY30sX2ludGVyc2VjdHNXaXRoOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMucG9zaXRpb25BYnMubGVmdCxjPWIrdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCxlPXRoaXMucG9zaXRpb25BYnMudG9wLGY9ZSt0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxnPWEubGVmdCxoPWcrYS53aWR0aCxpPWEudG9wLGs9aSthLmhlaWdodCxqPXRoaXMub2Zmc2V0LmNsaWNrLnRvcCxsPXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ7aj1lK2o+aSYmZStqPGsmJmIrbD5nJiZiK2w8aDtyZXR1cm4gdGhpcy5vcHRpb25zLnRvbGVyYW5jZT09InBvaW50ZXIifHx0aGlzLm9wdGlvbnMuZm9yY2VQb2ludGVyRm9yQ29udGFpbmVyc3x8dGhpcy5vcHRpb25zLnRvbGVyYW5jZSE9InBvaW50ZXIiJiZ0aGlzLmhlbHBlclByb3BvcnRpb25zW3RoaXMuZmxvYXRpbmc/IndpZHRoIjoiaGVpZ2h0Il0+YVt0aGlzLmZsb2F0aW5nPyJ3aWR0aCI6ImhlaWdodCJdP2o6ZzxiKwp0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLzImJmMtdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC8yPGgmJmk8ZSt0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC8yJiZmLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LzI8a30sX2ludGVyc2VjdHNXaXRoUG9pbnRlcjpmdW5jdGlvbihhKXt2YXIgYj1kLnVpLmlzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy50b3ArdGhpcy5vZmZzZXQuY2xpY2sudG9wLGEudG9wLGEuaGVpZ2h0KTthPWQudWkuaXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLmxlZnQrdGhpcy5vZmZzZXQuY2xpY2subGVmdCxhLmxlZnQsYS53aWR0aCk7Yj1iJiZhO2E9dGhpcy5fZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uKCk7dmFyIGM9dGhpcy5fZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb24oKTtpZighYilyZXR1cm4gZmFsc2U7cmV0dXJuIHRoaXMuZmxvYXRpbmc/YyYmYz09InJpZ2h0Inx8YT09ImRvd24iPzI6MTphJiYoYT09ImRvd24iPwoyOjEpfSxfaW50ZXJzZWN0c1dpdGhTaWRlczpmdW5jdGlvbihhKXt2YXIgYj1kLnVpLmlzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy50b3ArdGhpcy5vZmZzZXQuY2xpY2sudG9wLGEudG9wK2EuaGVpZ2h0LzIsYS5oZWlnaHQpO2E9ZC51aS5pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCt0aGlzLm9mZnNldC5jbGljay5sZWZ0LGEubGVmdCthLndpZHRoLzIsYS53aWR0aCk7dmFyIGM9dGhpcy5fZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uKCksZT10aGlzLl9nZXREcmFnSG9yaXpvbnRhbERpcmVjdGlvbigpO3JldHVybiB0aGlzLmZsb2F0aW5nJiZlP2U9PSJyaWdodCImJmF8fGU9PSJsZWZ0IiYmIWE6YyYmKGM9PSJkb3duIiYmYnx8Yz09InVwIiYmIWIpfSxfZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5wb3NpdGlvbkFicy50b3AtdGhpcy5sYXN0UG9zaXRpb25BYnMudG9wO3JldHVybiBhIT0wJiYoYT4wPyJkb3duIjoidXAiKX0sCl9nZXREcmFnSG9yaXpvbnRhbERpcmVjdGlvbjpmdW5jdGlvbigpe3ZhciBhPXRoaXMucG9zaXRpb25BYnMubGVmdC10aGlzLmxhc3RQb3NpdGlvbkFicy5sZWZ0O3JldHVybiBhIT0wJiYoYT4wPyJyaWdodCI6ImxlZnQiKX0scmVmcmVzaDpmdW5jdGlvbihhKXt0aGlzLl9yZWZyZXNoSXRlbXMoYSk7dGhpcy5yZWZyZXNoUG9zaXRpb25zKCk7cmV0dXJuIHRoaXN9LF9jb25uZWN0V2l0aDpmdW5jdGlvbigpe3ZhciBhPXRoaXMub3B0aW9ucztyZXR1cm4gYS5jb25uZWN0V2l0aC5jb25zdHJ1Y3Rvcj09U3RyaW5nP1thLmNvbm5lY3RXaXRoXTphLmNvbm5lY3RXaXRofSxfZ2V0SXRlbXNBc2pRdWVyeTpmdW5jdGlvbihhKXt2YXIgYj1bXSxjPVtdLGU9dGhpcy5fY29ubmVjdFdpdGgoKTtpZihlJiZhKWZvcihhPWUubGVuZ3RoLTE7YT49MDthLS0pZm9yKHZhciBmPWQoZVthXSksZz1mLmxlbmd0aC0xO2c+PTA7Zy0tKXt2YXIgaD1kLmRhdGEoZltnXSwic29ydGFibGUiKTtpZihoJiZoIT0KdGhpcyYmIWgub3B0aW9ucy5kaXNhYmxlZCljLnB1c2goW2QuaXNGdW5jdGlvbihoLm9wdGlvbnMuaXRlbXMpP2gub3B0aW9ucy5pdGVtcy5jYWxsKGguZWxlbWVudCk6ZChoLm9wdGlvbnMuaXRlbXMsaC5lbGVtZW50KS5ub3QoIi51aS1zb3J0YWJsZS1oZWxwZXIiKS5ub3QoIi51aS1zb3J0YWJsZS1wbGFjZWhvbGRlciIpLGhdKX1jLnB1c2goW2QuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMuaXRlbXMpP3RoaXMub3B0aW9ucy5pdGVtcy5jYWxsKHRoaXMuZWxlbWVudCxudWxsLHtvcHRpb25zOnRoaXMub3B0aW9ucyxpdGVtOnRoaXMuY3VycmVudEl0ZW19KTpkKHRoaXMub3B0aW9ucy5pdGVtcyx0aGlzLmVsZW1lbnQpLm5vdCgiLnVpLXNvcnRhYmxlLWhlbHBlciIpLm5vdCgiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyIiksdGhpc10pO2ZvcihhPWMubGVuZ3RoLTE7YT49MDthLS0pY1thXVswXS5lYWNoKGZ1bmN0aW9uKCl7Yi5wdXNoKHRoaXMpfSk7cmV0dXJuIGQoYil9LF9yZW1vdmVDdXJyZW50c0Zyb21JdGVtczpmdW5jdGlvbigpe2Zvcih2YXIgYT0KdGhpcy5jdXJyZW50SXRlbS5maW5kKCI6ZGF0YShzb3J0YWJsZS1pdGVtKSIpLGI9MDtiPHRoaXMuaXRlbXMubGVuZ3RoO2IrKylmb3IodmFyIGM9MDtjPGEubGVuZ3RoO2MrKylhW2NdPT10aGlzLml0ZW1zW2JdLml0ZW1bMF0mJnRoaXMuaXRlbXMuc3BsaWNlKGIsMSl9LF9yZWZyZXNoSXRlbXM6ZnVuY3Rpb24oYSl7dGhpcy5pdGVtcz1bXTt0aGlzLmNvbnRhaW5lcnM9W3RoaXNdO3ZhciBiPXRoaXMuaXRlbXMsYz1bW2QuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMuaXRlbXMpP3RoaXMub3B0aW9ucy5pdGVtcy5jYWxsKHRoaXMuZWxlbWVudFswXSxhLHtpdGVtOnRoaXMuY3VycmVudEl0ZW19KTpkKHRoaXMub3B0aW9ucy5pdGVtcyx0aGlzLmVsZW1lbnQpLHRoaXNdXSxlPXRoaXMuX2Nvbm5lY3RXaXRoKCk7aWYoZSlmb3IodmFyIGY9ZS5sZW5ndGgtMTtmPj0wO2YtLSlmb3IodmFyIGc9ZChlW2ZdKSxoPWcubGVuZ3RoLTE7aD49MDtoLS0pe3ZhciBpPWQuZGF0YShnW2hdLCJzb3J0YWJsZSIpOwppZihpJiZpIT10aGlzJiYhaS5vcHRpb25zLmRpc2FibGVkKXtjLnB1c2goW2QuaXNGdW5jdGlvbihpLm9wdGlvbnMuaXRlbXMpP2kub3B0aW9ucy5pdGVtcy5jYWxsKGkuZWxlbWVudFswXSxhLHtpdGVtOnRoaXMuY3VycmVudEl0ZW19KTpkKGkub3B0aW9ucy5pdGVtcyxpLmVsZW1lbnQpLGldKTt0aGlzLmNvbnRhaW5lcnMucHVzaChpKX19Zm9yKGY9Yy5sZW5ndGgtMTtmPj0wO2YtLSl7YT1jW2ZdWzFdO2U9Y1tmXVswXTtoPTA7Zm9yKGc9ZS5sZW5ndGg7aDxnO2grKyl7aT1kKGVbaF0pO2kuZGF0YSgic29ydGFibGUtaXRlbSIsYSk7Yi5wdXNoKHtpdGVtOmksaW5zdGFuY2U6YSx3aWR0aDowLGhlaWdodDowLGxlZnQ6MCx0b3A6MH0pfX19LHJlZnJlc2hQb3NpdGlvbnM6ZnVuY3Rpb24oYSl7aWYodGhpcy5vZmZzZXRQYXJlbnQmJnRoaXMuaGVscGVyKXRoaXMub2Zmc2V0LnBhcmVudD10aGlzLl9nZXRQYXJlbnRPZmZzZXQoKTtmb3IodmFyIGI9dGhpcy5pdGVtcy5sZW5ndGgtMTtiPj0KMDtiLS0pe3ZhciBjPXRoaXMuaXRlbXNbYl0sZT10aGlzLm9wdGlvbnMudG9sZXJhbmNlRWxlbWVudD9kKHRoaXMub3B0aW9ucy50b2xlcmFuY2VFbGVtZW50LGMuaXRlbSk6Yy5pdGVtO2lmKCFhKXtjLndpZHRoPWUub3V0ZXJXaWR0aCgpO2MuaGVpZ2h0PWUub3V0ZXJIZWlnaHQoKX1lPWUub2Zmc2V0KCk7Yy5sZWZ0PWUubGVmdDtjLnRvcD1lLnRvcH1pZih0aGlzLm9wdGlvbnMuY3VzdG9tJiZ0aGlzLm9wdGlvbnMuY3VzdG9tLnJlZnJlc2hDb250YWluZXJzKXRoaXMub3B0aW9ucy5jdXN0b20ucmVmcmVzaENvbnRhaW5lcnMuY2FsbCh0aGlzKTtlbHNlIGZvcihiPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtiPj0wO2ItLSl7ZT10aGlzLmNvbnRhaW5lcnNbYl0uZWxlbWVudC5vZmZzZXQoKTt0aGlzLmNvbnRhaW5lcnNbYl0uY29udGFpbmVyQ2FjaGUubGVmdD1lLmxlZnQ7dGhpcy5jb250YWluZXJzW2JdLmNvbnRhaW5lckNhY2hlLnRvcD1lLnRvcDt0aGlzLmNvbnRhaW5lcnNbYl0uY29udGFpbmVyQ2FjaGUud2lkdGg9CnRoaXMuY29udGFpbmVyc1tiXS5lbGVtZW50Lm91dGVyV2lkdGgoKTt0aGlzLmNvbnRhaW5lcnNbYl0uY29udGFpbmVyQ2FjaGUuaGVpZ2h0PXRoaXMuY29udGFpbmVyc1tiXS5lbGVtZW50Lm91dGVySGVpZ2h0KCl9cmV0dXJuIHRoaXN9LF9jcmVhdGVQbGFjZWhvbGRlcjpmdW5jdGlvbihhKXt2YXIgYj1hfHx0aGlzLGM9Yi5vcHRpb25zO2lmKCFjLnBsYWNlaG9sZGVyfHxjLnBsYWNlaG9sZGVyLmNvbnN0cnVjdG9yPT1TdHJpbmcpe3ZhciBlPWMucGxhY2Vob2xkZXI7Yy5wbGFjZWhvbGRlcj17ZWxlbWVudDpmdW5jdGlvbigpe3ZhciBmPWQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChiLmN1cnJlbnRJdGVtWzBdLm5vZGVOYW1lKSkuYWRkQ2xhc3MoZXx8Yi5jdXJyZW50SXRlbVswXS5jbGFzc05hbWUrIiB1aS1zb3J0YWJsZS1wbGFjZWhvbGRlciIpLnJlbW92ZUNsYXNzKCJ1aS1zb3J0YWJsZS1oZWxwZXIiKVswXTtpZighZSlmLnN0eWxlLnZpc2liaWxpdHk9ImhpZGRlbiI7cmV0dXJuIGZ9LAp1cGRhdGU6ZnVuY3Rpb24oZixnKXtpZighKGUmJiFjLmZvcmNlUGxhY2Vob2xkZXJTaXplKSl7Zy5oZWlnaHQoKXx8Zy5oZWlnaHQoYi5jdXJyZW50SXRlbS5pbm5lckhlaWdodCgpLXBhcnNlSW50KGIuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nVG9wIil8fDAsMTApLXBhcnNlSW50KGIuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nQm90dG9tIil8fDAsMTApKTtnLndpZHRoKCl8fGcud2lkdGgoYi5jdXJyZW50SXRlbS5pbm5lcldpZHRoKCktcGFyc2VJbnQoYi5jdXJyZW50SXRlbS5jc3MoInBhZGRpbmdMZWZ0Iil8fDAsMTApLXBhcnNlSW50KGIuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nUmlnaHQiKXx8MCwxMCkpfX19fWIucGxhY2Vob2xkZXI9ZChjLnBsYWNlaG9sZGVyLmVsZW1lbnQuY2FsbChiLmVsZW1lbnQsYi5jdXJyZW50SXRlbSkpO2IuY3VycmVudEl0ZW0uYWZ0ZXIoYi5wbGFjZWhvbGRlcik7Yy5wbGFjZWhvbGRlci51cGRhdGUoYixiLnBsYWNlaG9sZGVyKX0sX2NvbnRhY3RDb250YWluZXJzOmZ1bmN0aW9uKGEpe2Zvcih2YXIgYj0KbnVsbCxjPW51bGwsZT10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7ZT49MDtlLS0paWYoIWQudWkuY29udGFpbnModGhpcy5jdXJyZW50SXRlbVswXSx0aGlzLmNvbnRhaW5lcnNbZV0uZWxlbWVudFswXSkpaWYodGhpcy5faW50ZXJzZWN0c1dpdGgodGhpcy5jb250YWluZXJzW2VdLmNvbnRhaW5lckNhY2hlKSl7aWYoIShiJiZkLnVpLmNvbnRhaW5zKHRoaXMuY29udGFpbmVyc1tlXS5lbGVtZW50WzBdLGIuZWxlbWVudFswXSkpKXtiPXRoaXMuY29udGFpbmVyc1tlXTtjPWV9fWVsc2UgaWYodGhpcy5jb250YWluZXJzW2VdLmNvbnRhaW5lckNhY2hlLm92ZXIpe3RoaXMuY29udGFpbmVyc1tlXS5fdHJpZ2dlcigib3V0IixhLHRoaXMuX3VpSGFzaCh0aGlzKSk7dGhpcy5jb250YWluZXJzW2VdLmNvbnRhaW5lckNhY2hlLm92ZXI9MH1pZihiKWlmKHRoaXMuY29udGFpbmVycy5sZW5ndGg9PT0xKXt0aGlzLmNvbnRhaW5lcnNbY10uX3RyaWdnZXIoIm92ZXIiLGEsdGhpcy5fdWlIYXNoKHRoaXMpKTsKdGhpcy5jb250YWluZXJzW2NdLmNvbnRhaW5lckNhY2hlLm92ZXI9MX1lbHNlIGlmKHRoaXMuY3VycmVudENvbnRhaW5lciE9dGhpcy5jb250YWluZXJzW2NdKXtiPTFFNDtlPW51bGw7Zm9yKHZhciBmPXRoaXMucG9zaXRpb25BYnNbdGhpcy5jb250YWluZXJzW2NdLmZsb2F0aW5nPyJsZWZ0IjoidG9wIl0sZz10aGlzLml0ZW1zLmxlbmd0aC0xO2c+PTA7Zy0tKWlmKGQudWkuY29udGFpbnModGhpcy5jb250YWluZXJzW2NdLmVsZW1lbnRbMF0sdGhpcy5pdGVtc1tnXS5pdGVtWzBdKSl7dmFyIGg9dGhpcy5pdGVtc1tnXVt0aGlzLmNvbnRhaW5lcnNbY10uZmxvYXRpbmc/ImxlZnQiOiJ0b3AiXTtpZihNYXRoLmFicyhoLWYpPGIpe2I9TWF0aC5hYnMoaC1mKTtlPXRoaXMuaXRlbXNbZ119fWlmKGV8fHRoaXMub3B0aW9ucy5kcm9wT25FbXB0eSl7dGhpcy5jdXJyZW50Q29udGFpbmVyPXRoaXMuY29udGFpbmVyc1tjXTtlP3RoaXMuX3JlYXJyYW5nZShhLGUsbnVsbCx0cnVlKTp0aGlzLl9yZWFycmFuZ2UoYSwKbnVsbCx0aGlzLmNvbnRhaW5lcnNbY10uZWxlbWVudCx0cnVlKTt0aGlzLl90cmlnZ2VyKCJjaGFuZ2UiLGEsdGhpcy5fdWlIYXNoKCkpO3RoaXMuY29udGFpbmVyc1tjXS5fdHJpZ2dlcigiY2hhbmdlIixhLHRoaXMuX3VpSGFzaCh0aGlzKSk7dGhpcy5vcHRpb25zLnBsYWNlaG9sZGVyLnVwZGF0ZSh0aGlzLmN1cnJlbnRDb250YWluZXIsdGhpcy5wbGFjZWhvbGRlcik7dGhpcy5jb250YWluZXJzW2NdLl90cmlnZ2VyKCJvdmVyIixhLHRoaXMuX3VpSGFzaCh0aGlzKSk7dGhpcy5jb250YWluZXJzW2NdLmNvbnRhaW5lckNhY2hlLm92ZXI9MX19fSxfY3JlYXRlSGVscGVyOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMub3B0aW9uczthPWQuaXNGdW5jdGlvbihiLmhlbHBlcik/ZChiLmhlbHBlci5hcHBseSh0aGlzLmVsZW1lbnRbMF0sW2EsdGhpcy5jdXJyZW50SXRlbV0pKTpiLmhlbHBlcj09ImNsb25lIj90aGlzLmN1cnJlbnRJdGVtLmNsb25lKCk6dGhpcy5jdXJyZW50SXRlbTthLnBhcmVudHMoImJvZHkiKS5sZW5ndGh8fApkKGIuYXBwZW5kVG8hPSJwYXJlbnQiP2IuYXBwZW5kVG86dGhpcy5jdXJyZW50SXRlbVswXS5wYXJlbnROb2RlKVswXS5hcHBlbmRDaGlsZChhWzBdKTtpZihhWzBdPT10aGlzLmN1cnJlbnRJdGVtWzBdKXRoaXMuX3N0b3JlZENTUz17d2lkdGg6dGhpcy5jdXJyZW50SXRlbVswXS5zdHlsZS53aWR0aCxoZWlnaHQ6dGhpcy5jdXJyZW50SXRlbVswXS5zdHlsZS5oZWlnaHQscG9zaXRpb246dGhpcy5jdXJyZW50SXRlbS5jc3MoInBvc2l0aW9uIiksdG9wOnRoaXMuY3VycmVudEl0ZW0uY3NzKCJ0b3AiKSxsZWZ0OnRoaXMuY3VycmVudEl0ZW0uY3NzKCJsZWZ0Iil9O2lmKGFbMF0uc3R5bGUud2lkdGg9PSIifHxiLmZvcmNlSGVscGVyU2l6ZSlhLndpZHRoKHRoaXMuY3VycmVudEl0ZW0ud2lkdGgoKSk7aWYoYVswXS5zdHlsZS5oZWlnaHQ9PSIifHxiLmZvcmNlSGVscGVyU2l6ZSlhLmhlaWdodCh0aGlzLmN1cnJlbnRJdGVtLmhlaWdodCgpKTtyZXR1cm4gYX0sX2FkanVzdE9mZnNldEZyb21IZWxwZXI6ZnVuY3Rpb24oYSl7aWYodHlwZW9mIGE9PQoic3RyaW5nIilhPWEuc3BsaXQoIiAiKTtpZihkLmlzQXJyYXkoYSkpYT17bGVmdDorYVswXSx0b3A6K2FbMV18fDB9O2lmKCJsZWZ0ImluIGEpdGhpcy5vZmZzZXQuY2xpY2subGVmdD1hLmxlZnQrdGhpcy5tYXJnaW5zLmxlZnQ7aWYoInJpZ2h0ImluIGEpdGhpcy5vZmZzZXQuY2xpY2subGVmdD10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLWEucmlnaHQrdGhpcy5tYXJnaW5zLmxlZnQ7aWYoInRvcCJpbiBhKXRoaXMub2Zmc2V0LmNsaWNrLnRvcD1hLnRvcCt0aGlzLm1hcmdpbnMudG9wO2lmKCJib3R0b20iaW4gYSl0aGlzLm9mZnNldC5jbGljay50b3A9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtYS5ib3R0b20rdGhpcy5tYXJnaW5zLnRvcH0sX2dldFBhcmVudE9mZnNldDpmdW5jdGlvbigpe3RoaXMub2Zmc2V0UGFyZW50PXRoaXMuaGVscGVyLm9mZnNldFBhcmVudCgpO3ZhciBhPXRoaXMub2Zmc2V0UGFyZW50Lm9mZnNldCgpO2lmKHRoaXMuY3NzUG9zaXRpb249PQoiYWJzb2x1dGUiJiZ0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmQudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pKXthLmxlZnQrPXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTthLnRvcCs9dGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCl9aWYodGhpcy5vZmZzZXRQYXJlbnRbMF09PWRvY3VtZW50LmJvZHl8fHRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUmJnRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUudG9Mb3dlckNhc2UoKT09Imh0bWwiJiZkLmJyb3dzZXIubXNpZSlhPXt0b3A6MCxsZWZ0OjB9O3JldHVybnt0b3A6YS50b3ArKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcygiYm9yZGVyVG9wV2lkdGgiKSwxMCl8fDApLGxlZnQ6YS5sZWZ0KyhwYXJzZUludCh0aGlzLm9mZnNldFBhcmVudC5jc3MoImJvcmRlckxlZnRXaWR0aCIpLDEwKXx8MCl9fSxfZ2V0UmVsYXRpdmVPZmZzZXQ6ZnVuY3Rpb24oKXtpZih0aGlzLmNzc1Bvc2l0aW9uPT0KInJlbGF0aXZlIil7dmFyIGE9dGhpcy5jdXJyZW50SXRlbS5wb3NpdGlvbigpO3JldHVybnt0b3A6YS50b3AtKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcygidG9wIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSxsZWZ0OmEubGVmdC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKCJsZWZ0IiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCl9fWVsc2UgcmV0dXJue3RvcDowLGxlZnQ6MH19LF9jYWNoZU1hcmdpbnM6ZnVuY3Rpb24oKXt0aGlzLm1hcmdpbnM9e2xlZnQ6cGFyc2VJbnQodGhpcy5jdXJyZW50SXRlbS5jc3MoIm1hcmdpbkxlZnQiKSwxMCl8fDAsdG9wOnBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKCJtYXJnaW5Ub3AiKSwxMCl8fDB9fSxfY2FjaGVIZWxwZXJQcm9wb3J0aW9uczpmdW5jdGlvbigpe3RoaXMuaGVscGVyUHJvcG9ydGlvbnM9e3dpZHRoOnRoaXMuaGVscGVyLm91dGVyV2lkdGgoKSxoZWlnaHQ6dGhpcy5oZWxwZXIub3V0ZXJIZWlnaHQoKX19LApfc2V0Q29udGFpbm1lbnQ6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnM7aWYoYS5jb250YWlubWVudD09InBhcmVudCIpYS5jb250YWlubWVudD10aGlzLmhlbHBlclswXS5wYXJlbnROb2RlO2lmKGEuY29udGFpbm1lbnQ9PSJkb2N1bWVudCJ8fGEuY29udGFpbm1lbnQ9PSJ3aW5kb3ciKXRoaXMuY29udGFpbm1lbnQ9WzAtdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCwwLXRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wLGQoYS5jb250YWlubWVudD09ImRvY3VtZW50Ij9kb2N1bWVudDp3aW5kb3cpLndpZHRoKCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdCwoZChhLmNvbnRhaW5tZW50PT0iZG9jdW1lbnQiP2RvY3VtZW50OndpbmRvdykuaGVpZ2h0KCl8fGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZS5zY3JvbGxIZWlnaHQpLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LQp0aGlzLm1hcmdpbnMudG9wXTtpZighL14oZG9jdW1lbnR8d2luZG93fHBhcmVudCkkLy50ZXN0KGEuY29udGFpbm1lbnQpKXt2YXIgYj1kKGEuY29udGFpbm1lbnQpWzBdO2E9ZChhLmNvbnRhaW5tZW50KS5vZmZzZXQoKTt2YXIgYz1kKGIpLmNzcygib3ZlcmZsb3ciKSE9ImhpZGRlbiI7dGhpcy5jb250YWlubWVudD1bYS5sZWZ0KyhwYXJzZUludChkKGIpLmNzcygiYm9yZGVyTGVmdFdpZHRoIiksMTApfHwwKSsocGFyc2VJbnQoZChiKS5jc3MoInBhZGRpbmdMZWZ0IiksMTApfHwwKS10aGlzLm1hcmdpbnMubGVmdCxhLnRvcCsocGFyc2VJbnQoZChiKS5jc3MoImJvcmRlclRvcFdpZHRoIiksMTApfHwwKSsocGFyc2VJbnQoZChiKS5jc3MoInBhZGRpbmdUb3AiKSwxMCl8fDApLXRoaXMubWFyZ2lucy50b3AsYS5sZWZ0KyhjP01hdGgubWF4KGIuc2Nyb2xsV2lkdGgsYi5vZmZzZXRXaWR0aCk6Yi5vZmZzZXRXaWR0aCktKHBhcnNlSW50KGQoYikuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwKMTApfHwwKS0ocGFyc2VJbnQoZChiKS5jc3MoInBhZGRpbmdSaWdodCIpLDEwKXx8MCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdCxhLnRvcCsoYz9NYXRoLm1heChiLnNjcm9sbEhlaWdodCxiLm9mZnNldEhlaWdodCk6Yi5vZmZzZXRIZWlnaHQpLShwYXJzZUludChkKGIpLmNzcygiYm9yZGVyVG9wV2lkdGgiKSwxMCl8fDApLShwYXJzZUludChkKGIpLmNzcygicGFkZGluZ0JvdHRvbSIpLDEwKXx8MCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdGhpcy5tYXJnaW5zLnRvcF19fSxfY29udmVydFBvc2l0aW9uVG86ZnVuY3Rpb24oYSxiKXtpZighYiliPXRoaXMucG9zaXRpb247YT1hPT0iYWJzb2x1dGUiPzE6LTE7dmFyIGM9dGhpcy5jc3NQb3NpdGlvbj09ImFic29sdXRlIiYmISh0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmQudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pKT8KdGhpcy5vZmZzZXRQYXJlbnQ6dGhpcy5zY3JvbGxQYXJlbnQsZT0vKGh0bWx8Ym9keSkvaS50ZXN0KGNbMF0udGFnTmFtZSk7cmV0dXJue3RvcDpiLnRvcCt0aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AqYSt0aGlzLm9mZnNldC5wYXJlbnQudG9wKmEtKGQuYnJvd3Nlci5zYWZhcmkmJnRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/MDoodGhpcy5jc3NQb3NpdGlvbj09ImZpeGVkIj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCk6ZT8wOmMuc2Nyb2xsVG9wKCkpKmEpLGxlZnQ6Yi5sZWZ0K3RoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQqYSt0aGlzLm9mZnNldC5wYXJlbnQubGVmdCphLShkLmJyb3dzZXIuc2FmYXJpJiZ0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPzA6KHRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTplPzA6Yy5zY3JvbGxMZWZ0KCkpKmEpfX0sX2dlbmVyYXRlUG9zaXRpb246ZnVuY3Rpb24oYSl7dmFyIGI9CnRoaXMub3B0aW9ucyxjPXRoaXMuY3NzUG9zaXRpb249PSJhYnNvbHV0ZSImJiEodGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZkLnVpLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSk/dGhpcy5vZmZzZXRQYXJlbnQ6dGhpcy5zY3JvbGxQYXJlbnQsZT0vKGh0bWx8Ym9keSkvaS50ZXN0KGNbMF0udGFnTmFtZSk7aWYodGhpcy5jc3NQb3NpdGlvbj09InJlbGF0aXZlIiYmISh0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJnRoaXMuc2Nyb2xsUGFyZW50WzBdIT10aGlzLm9mZnNldFBhcmVudFswXSkpdGhpcy5vZmZzZXQucmVsYXRpdmU9dGhpcy5fZ2V0UmVsYXRpdmVPZmZzZXQoKTt2YXIgZj1hLnBhZ2VYLGc9YS5wYWdlWTtpZih0aGlzLm9yaWdpbmFsUG9zaXRpb24pe2lmKHRoaXMuY29udGFpbm1lbnQpe2lmKGEucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdDx0aGlzLmNvbnRhaW5tZW50WzBdKWY9dGhpcy5jb250YWlubWVudFswXSsKdGhpcy5vZmZzZXQuY2xpY2subGVmdDtpZihhLnBhZ2VZLXRoaXMub2Zmc2V0LmNsaWNrLnRvcDx0aGlzLmNvbnRhaW5tZW50WzFdKWc9dGhpcy5jb250YWlubWVudFsxXSt0aGlzLm9mZnNldC5jbGljay50b3A7aWYoYS5wYWdlWC10aGlzLm9mZnNldC5jbGljay5sZWZ0PnRoaXMuY29udGFpbm1lbnRbMl0pZj10aGlzLmNvbnRhaW5tZW50WzJdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQ7aWYoYS5wYWdlWS10aGlzLm9mZnNldC5jbGljay50b3A+dGhpcy5jb250YWlubWVudFszXSlnPXRoaXMuY29udGFpbm1lbnRbM10rdGhpcy5vZmZzZXQuY2xpY2sudG9wfWlmKGIuZ3JpZCl7Zz10aGlzLm9yaWdpbmFsUGFnZVkrTWF0aC5yb3VuZCgoZy10aGlzLm9yaWdpbmFsUGFnZVkpL2IuZ3JpZFsxXSkqYi5ncmlkWzFdO2c9dGhpcy5jb250YWlubWVudD8hKGctdGhpcy5vZmZzZXQuY2xpY2sudG9wPHRoaXMuY29udGFpbm1lbnRbMV18fGctdGhpcy5vZmZzZXQuY2xpY2sudG9wPnRoaXMuY29udGFpbm1lbnRbM10pPwpnOiEoZy10aGlzLm9mZnNldC5jbGljay50b3A8dGhpcy5jb250YWlubWVudFsxXSk/Zy1iLmdyaWRbMV06ZytiLmdyaWRbMV06ZztmPXRoaXMub3JpZ2luYWxQYWdlWCtNYXRoLnJvdW5kKChmLXRoaXMub3JpZ2luYWxQYWdlWCkvYi5ncmlkWzBdKSpiLmdyaWRbMF07Zj10aGlzLmNvbnRhaW5tZW50PyEoZi10aGlzLm9mZnNldC5jbGljay5sZWZ0PHRoaXMuY29udGFpbm1lbnRbMF18fGYtdGhpcy5vZmZzZXQuY2xpY2subGVmdD50aGlzLmNvbnRhaW5tZW50WzJdKT9mOiEoZi10aGlzLm9mZnNldC5jbGljay5sZWZ0PHRoaXMuY29udGFpbm1lbnRbMF0pP2YtYi5ncmlkWzBdOmYrYi5ncmlkWzBdOmZ9fXJldHVybnt0b3A6Zy10aGlzLm9mZnNldC5jbGljay50b3AtdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3ArKGQuYnJvd3Nlci5zYWZhcmkmJnRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/MDp0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKToKZT8wOmMuc2Nyb2xsVG9wKCkpLGxlZnQ6Zi10aGlzLm9mZnNldC5jbGljay5sZWZ0LXRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQtdGhpcy5vZmZzZXQucGFyZW50LmxlZnQrKGQuYnJvd3Nlci5zYWZhcmkmJnRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/MDp0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk6ZT8wOmMuc2Nyb2xsTGVmdCgpKX19LF9yZWFycmFuZ2U6ZnVuY3Rpb24oYSxiLGMsZSl7Yz9jWzBdLmFwcGVuZENoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pOmIuaXRlbVswXS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLnBsYWNlaG9sZGVyWzBdLHRoaXMuZGlyZWN0aW9uPT0iZG93biI/Yi5pdGVtWzBdOmIuaXRlbVswXS5uZXh0U2libGluZyk7dGhpcy5jb3VudGVyPXRoaXMuY291bnRlcj8rK3RoaXMuY291bnRlcjoxO3ZhciBmPXRoaXMsZz10aGlzLmNvdW50ZXI7d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXtnPT0KZi5jb3VudGVyJiZmLnJlZnJlc2hQb3NpdGlvbnMoIWUpfSwwKX0sX2NsZWFyOmZ1bmN0aW9uKGEsYil7dGhpcy5yZXZlcnRpbmc9ZmFsc2U7dmFyIGM9W107IXRoaXMuX25vRmluYWxTb3J0JiZ0aGlzLmN1cnJlbnRJdGVtWzBdLnBhcmVudE5vZGUmJnRoaXMucGxhY2Vob2xkZXIuYmVmb3JlKHRoaXMuY3VycmVudEl0ZW0pO3RoaXMuX25vRmluYWxTb3J0PW51bGw7aWYodGhpcy5oZWxwZXJbMF09PXRoaXMuY3VycmVudEl0ZW1bMF0pe2Zvcih2YXIgZSBpbiB0aGlzLl9zdG9yZWRDU1MpaWYodGhpcy5fc3RvcmVkQ1NTW2VdPT0iYXV0byJ8fHRoaXMuX3N0b3JlZENTU1tlXT09InN0YXRpYyIpdGhpcy5fc3RvcmVkQ1NTW2VdPSIiO3RoaXMuY3VycmVudEl0ZW0uY3NzKHRoaXMuX3N0b3JlZENTUykucmVtb3ZlQ2xhc3MoInVpLXNvcnRhYmxlLWhlbHBlciIpfWVsc2UgdGhpcy5jdXJyZW50SXRlbS5zaG93KCk7dGhpcy5mcm9tT3V0c2lkZSYmIWImJmMucHVzaChmdW5jdGlvbihmKXt0aGlzLl90cmlnZ2VyKCJyZWNlaXZlIiwKZix0aGlzLl91aUhhc2godGhpcy5mcm9tT3V0c2lkZSkpfSk7aWYoKHRoaXMuZnJvbU91dHNpZGV8fHRoaXMuZG9tUG9zaXRpb24ucHJldiE9dGhpcy5jdXJyZW50SXRlbS5wcmV2KCkubm90KCIudWktc29ydGFibGUtaGVscGVyIilbMF18fHRoaXMuZG9tUG9zaXRpb24ucGFyZW50IT10aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpWzBdKSYmIWIpYy5wdXNoKGZ1bmN0aW9uKGYpe3RoaXMuX3RyaWdnZXIoInVwZGF0ZSIsZix0aGlzLl91aUhhc2goKSl9KTtpZighZC51aS5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0sdGhpcy5jdXJyZW50SXRlbVswXSkpe2J8fGMucHVzaChmdW5jdGlvbihmKXt0aGlzLl90cmlnZ2VyKCJyZW1vdmUiLGYsdGhpcy5fdWlIYXNoKCkpfSk7Zm9yKGU9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2U+PTA7ZS0tKWlmKGQudWkuY29udGFpbnModGhpcy5jb250YWluZXJzW2VdLmVsZW1lbnRbMF0sdGhpcy5jdXJyZW50SXRlbVswXSkmJiFiKXtjLnB1c2goZnVuY3Rpb24oZil7cmV0dXJuIGZ1bmN0aW9uKGcpe2YuX3RyaWdnZXIoInJlY2VpdmUiLApnLHRoaXMuX3VpSGFzaCh0aGlzKSl9fS5jYWxsKHRoaXMsdGhpcy5jb250YWluZXJzW2VdKSk7Yy5wdXNoKGZ1bmN0aW9uKGYpe3JldHVybiBmdW5jdGlvbihnKXtmLl90cmlnZ2VyKCJ1cGRhdGUiLGcsdGhpcy5fdWlIYXNoKHRoaXMpKX19LmNhbGwodGhpcyx0aGlzLmNvbnRhaW5lcnNbZV0pKX19Zm9yKGU9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2U+PTA7ZS0tKXtifHxjLnB1c2goZnVuY3Rpb24oZil7cmV0dXJuIGZ1bmN0aW9uKGcpe2YuX3RyaWdnZXIoImRlYWN0aXZhdGUiLGcsdGhpcy5fdWlIYXNoKHRoaXMpKX19LmNhbGwodGhpcyx0aGlzLmNvbnRhaW5lcnNbZV0pKTtpZih0aGlzLmNvbnRhaW5lcnNbZV0uY29udGFpbmVyQ2FjaGUub3Zlcil7Yy5wdXNoKGZ1bmN0aW9uKGYpe3JldHVybiBmdW5jdGlvbihnKXtmLl90cmlnZ2VyKCJvdXQiLGcsdGhpcy5fdWlIYXNoKHRoaXMpKX19LmNhbGwodGhpcyx0aGlzLmNvbnRhaW5lcnNbZV0pKTt0aGlzLmNvbnRhaW5lcnNbZV0uY29udGFpbmVyQ2FjaGUub3Zlcj0KMH19dGhpcy5fc3RvcmVkQ3Vyc29yJiZkKCJib2R5IikuY3NzKCJjdXJzb3IiLHRoaXMuX3N0b3JlZEN1cnNvcik7dGhpcy5fc3RvcmVkT3BhY2l0eSYmdGhpcy5oZWxwZXIuY3NzKCJvcGFjaXR5Iix0aGlzLl9zdG9yZWRPcGFjaXR5KTtpZih0aGlzLl9zdG9yZWRaSW5kZXgpdGhpcy5oZWxwZXIuY3NzKCJ6SW5kZXgiLHRoaXMuX3N0b3JlZFpJbmRleD09ImF1dG8iPyIiOnRoaXMuX3N0b3JlZFpJbmRleCk7dGhpcy5kcmFnZ2luZz1mYWxzZTtpZih0aGlzLmNhbmNlbEhlbHBlclJlbW92YWwpe2lmKCFiKXt0aGlzLl90cmlnZ2VyKCJiZWZvcmVTdG9wIixhLHRoaXMuX3VpSGFzaCgpKTtmb3IoZT0wO2U8Yy5sZW5ndGg7ZSsrKWNbZV0uY2FsbCh0aGlzLGEpO3RoaXMuX3RyaWdnZXIoInN0b3AiLGEsdGhpcy5fdWlIYXNoKCkpfXJldHVybiBmYWxzZX1ifHx0aGlzLl90cmlnZ2VyKCJiZWZvcmVTdG9wIixhLHRoaXMuX3VpSGFzaCgpKTt0aGlzLnBsYWNlaG9sZGVyWzBdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSk7CnRoaXMuaGVscGVyWzBdIT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLmhlbHBlci5yZW1vdmUoKTt0aGlzLmhlbHBlcj1udWxsO2lmKCFiKXtmb3IoZT0wO2U8Yy5sZW5ndGg7ZSsrKWNbZV0uY2FsbCh0aGlzLGEpO3RoaXMuX3RyaWdnZXIoInN0b3AiLGEsdGhpcy5fdWlIYXNoKCkpfXRoaXMuZnJvbU91dHNpZGU9ZmFsc2U7cmV0dXJuIHRydWV9LF90cmlnZ2VyOmZ1bmN0aW9uKCl7ZC5XaWRnZXQucHJvdG90eXBlLl90cmlnZ2VyLmFwcGx5KHRoaXMsYXJndW1lbnRzKT09PWZhbHNlJiZ0aGlzLmNhbmNlbCgpfSxfdWlIYXNoOmZ1bmN0aW9uKGEpe3ZhciBiPWF8fHRoaXM7cmV0dXJue2hlbHBlcjpiLmhlbHBlcixwbGFjZWhvbGRlcjpiLnBsYWNlaG9sZGVyfHxkKFtdKSxwb3NpdGlvbjpiLnBvc2l0aW9uLG9yaWdpbmFsUG9zaXRpb246Yi5vcmlnaW5hbFBvc2l0aW9uLG9mZnNldDpiLnBvc2l0aW9uQWJzLGl0ZW06Yi5jdXJyZW50SXRlbSxzZW5kZXI6YT9hLmVsZW1lbnQ6bnVsbH19fSk7CmQuZXh0ZW5kKGQudWkuc29ydGFibGUse3ZlcnNpb246IjEuOC41In0pfSkoalF1ZXJ5KTsKalF1ZXJ5LmVmZmVjdHN8fGZ1bmN0aW9uKGYsail7ZnVuY3Rpb24gbChjKXt2YXIgYTtpZihjJiZjLmNvbnN0cnVjdG9yPT1BcnJheSYmYy5sZW5ndGg9PTMpcmV0dXJuIGM7aWYoYT0vcmdiXChccyooWzAtOV17MSwzfSlccyosXHMqKFswLTldezEsM30pXHMqLFxzKihbMC05XXsxLDN9KVxzKlwpLy5leGVjKGMpKXJldHVybltwYXJzZUludChhWzFdLDEwKSxwYXJzZUludChhWzJdLDEwKSxwYXJzZUludChhWzNdLDEwKV07aWYoYT0vcmdiXChccyooWzAtOV0rKD86XC5bMC05XSspPylcJVxzKixccyooWzAtOV0rKD86XC5bMC05XSspPylcJVxzKixccyooWzAtOV0rKD86XC5bMC05XSspPylcJVxzKlwpLy5leGVjKGMpKXJldHVybltwYXJzZUZsb2F0KGFbMV0pKjIuNTUscGFyc2VGbG9hdChhWzJdKSoyLjU1LHBhcnNlRmxvYXQoYVszXSkqMi41NV07aWYoYT0vIyhbYS1mQS1GMC05XXsyfSkoW2EtZkEtRjAtOV17Mn0pKFthLWZBLUYwLTldezJ9KS8uZXhlYyhjKSlyZXR1cm5bcGFyc2VJbnQoYVsxXSwKMTYpLHBhcnNlSW50KGFbMl0sMTYpLHBhcnNlSW50KGFbM10sMTYpXTtpZihhPS8jKFthLWZBLUYwLTldKShbYS1mQS1GMC05XSkoW2EtZkEtRjAtOV0pLy5leGVjKGMpKXJldHVybltwYXJzZUludChhWzFdK2FbMV0sMTYpLHBhcnNlSW50KGFbMl0rYVsyXSwxNikscGFyc2VJbnQoYVszXSthWzNdLDE2KV07aWYoL3JnYmFcKDAsIDAsIDAsIDBcKS8uZXhlYyhjKSlyZXR1cm4gbS50cmFuc3BhcmVudDtyZXR1cm4gbVtmLnRyaW0oYykudG9Mb3dlckNhc2UoKV19ZnVuY3Rpb24gcihjLGEpe3ZhciBiO2Rve2I9Zi5jdXJDU1MoYyxhKTtpZihiIT0iIiYmYiE9InRyYW5zcGFyZW50Inx8Zi5ub2RlTmFtZShjLCJib2R5IikpYnJlYWs7YT0iYmFja2dyb3VuZENvbG9yIn13aGlsZShjPWMucGFyZW50Tm9kZSk7cmV0dXJuIGwoYil9ZnVuY3Rpb24gbigpe3ZhciBjPWRvY3VtZW50LmRlZmF1bHRWaWV3P2RvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUodGhpcyxudWxsKTp0aGlzLmN1cnJlbnRTdHlsZSwKYT17fSxiLGQ7aWYoYyYmYy5sZW5ndGgmJmNbMF0mJmNbY1swXV0pZm9yKHZhciBlPWMubGVuZ3RoO2UtLTspe2I9Y1tlXTtpZih0eXBlb2YgY1tiXT09InN0cmluZyIpe2Q9Yi5yZXBsYWNlKC9cLShcdykvZyxmdW5jdGlvbihnLGgpe3JldHVybiBoLnRvVXBwZXJDYXNlKCl9KTthW2RdPWNbYl19fWVsc2UgZm9yKGIgaW4gYylpZih0eXBlb2YgY1tiXT09PSJzdHJpbmciKWFbYl09Y1tiXTtyZXR1cm4gYX1mdW5jdGlvbiBvKGMpe3ZhciBhLGI7Zm9yKGEgaW4gYyl7Yj1jW2FdO2lmKGI9PW51bGx8fGYuaXNGdW5jdGlvbihiKXx8YSBpbiBzfHwvc2Nyb2xsYmFyLy50ZXN0KGEpfHwhL2NvbG9yL2kudGVzdChhKSYmaXNOYU4ocGFyc2VGbG9hdChiKSkpZGVsZXRlIGNbYV19cmV0dXJuIGN9ZnVuY3Rpb24gdChjLGEpe3ZhciBiPXtfOjB9LGQ7Zm9yKGQgaW4gYSlpZihjW2RdIT1hW2RdKWJbZF09YVtkXTtyZXR1cm4gYn1mdW5jdGlvbiBrKGMsYSxiLGQpe2lmKHR5cGVvZiBjPT0ib2JqZWN0Iil7ZD0KYTtiPW51bGw7YT1jO2M9YS5lZmZlY3R9aWYoZi5pc0Z1bmN0aW9uKGEpKXtkPWE7Yj1udWxsO2E9e319aWYodHlwZW9mIGE9PSJudW1iZXIifHxmLmZ4LnNwZWVkc1thXSl7ZD1iO2I9YTthPXt9fWlmKGYuaXNGdW5jdGlvbihiKSl7ZD1iO2I9bnVsbH1hPWF8fHt9O2I9Ynx8YS5kdXJhdGlvbjtiPWYuZngub2ZmPzA6dHlwZW9mIGI9PSJudW1iZXIiP2I6Zi5meC5zcGVlZHNbYl18fGYuZnguc3BlZWRzLl9kZWZhdWx0O2Q9ZHx8YS5jb21wbGV0ZTtyZXR1cm5bYyxhLGIsZF19Zi5lZmZlY3RzPXt9O2YuZWFjaChbImJhY2tncm91bmRDb2xvciIsImJvcmRlckJvdHRvbUNvbG9yIiwiYm9yZGVyTGVmdENvbG9yIiwiYm9yZGVyUmlnaHRDb2xvciIsImJvcmRlclRvcENvbG9yIiwiY29sb3IiLCJvdXRsaW5lQ29sb3IiXSxmdW5jdGlvbihjLGEpe2YuZnguc3RlcFthXT1mdW5jdGlvbihiKXtpZighYi5jb2xvckluaXQpe2Iuc3RhcnQ9cihiLmVsZW0sYSk7Yi5lbmQ9bChiLmVuZCk7Yi5jb2xvckluaXQ9CnRydWV9Yi5lbGVtLnN0eWxlW2FdPSJyZ2IoIitNYXRoLm1heChNYXRoLm1pbihwYXJzZUludChiLnBvcyooYi5lbmRbMF0tYi5zdGFydFswXSkrYi5zdGFydFswXSwxMCksMjU1KSwwKSsiLCIrTWF0aC5tYXgoTWF0aC5taW4ocGFyc2VJbnQoYi5wb3MqKGIuZW5kWzFdLWIuc3RhcnRbMV0pK2Iuc3RhcnRbMV0sMTApLDI1NSksMCkrIiwiK01hdGgubWF4KE1hdGgubWluKHBhcnNlSW50KGIucG9zKihiLmVuZFsyXS1iLnN0YXJ0WzJdKStiLnN0YXJ0WzJdLDEwKSwyNTUpLDApKyIpIn19KTt2YXIgbT17YXF1YTpbMCwyNTUsMjU1XSxhenVyZTpbMjQwLDI1NSwyNTVdLGJlaWdlOlsyNDUsMjQ1LDIyMF0sYmxhY2s6WzAsMCwwXSxibHVlOlswLDAsMjU1XSxicm93bjpbMTY1LDQyLDQyXSxjeWFuOlswLDI1NSwyNTVdLGRhcmtibHVlOlswLDAsMTM5XSxkYXJrY3lhbjpbMCwxMzksMTM5XSxkYXJrZ3JleTpbMTY5LDE2OSwxNjldLGRhcmtncmVlbjpbMCwxMDAsMF0sZGFya2toYWtpOlsxODksCjE4MywxMDddLGRhcmttYWdlbnRhOlsxMzksMCwxMzldLGRhcmtvbGl2ZWdyZWVuOls4NSwxMDcsNDddLGRhcmtvcmFuZ2U6WzI1NSwxNDAsMF0sZGFya29yY2hpZDpbMTUzLDUwLDIwNF0sZGFya3JlZDpbMTM5LDAsMF0sZGFya3NhbG1vbjpbMjMzLDE1MCwxMjJdLGRhcmt2aW9sZXQ6WzE0OCwwLDIxMV0sZnVjaHNpYTpbMjU1LDAsMjU1XSxnb2xkOlsyNTUsMjE1LDBdLGdyZWVuOlswLDEyOCwwXSxpbmRpZ286Wzc1LDAsMTMwXSxraGFraTpbMjQwLDIzMCwxNDBdLGxpZ2h0Ymx1ZTpbMTczLDIxNiwyMzBdLGxpZ2h0Y3lhbjpbMjI0LDI1NSwyNTVdLGxpZ2h0Z3JlZW46WzE0NCwyMzgsMTQ0XSxsaWdodGdyZXk6WzIxMSwyMTEsMjExXSxsaWdodHBpbms6WzI1NSwxODIsMTkzXSxsaWdodHllbGxvdzpbMjU1LDI1NSwyMjRdLGxpbWU6WzAsMjU1LDBdLG1hZ2VudGE6WzI1NSwwLDI1NV0sbWFyb29uOlsxMjgsMCwwXSxuYXZ5OlswLDAsMTI4XSxvbGl2ZTpbMTI4LDEyOCwwXSxvcmFuZ2U6WzI1NSwKMTY1LDBdLHBpbms6WzI1NSwxOTIsMjAzXSxwdXJwbGU6WzEyOCwwLDEyOF0sdmlvbGV0OlsxMjgsMCwxMjhdLHJlZDpbMjU1LDAsMF0sc2lsdmVyOlsxOTIsMTkyLDE5Ml0sd2hpdGU6WzI1NSwyNTUsMjU1XSx5ZWxsb3c6WzI1NSwyNTUsMF0sdHJhbnNwYXJlbnQ6WzI1NSwyNTUsMjU1XX0scD1bImFkZCIsInJlbW92ZSIsInRvZ2dsZSJdLHM9e2JvcmRlcjoxLGJvcmRlckJvdHRvbToxLGJvcmRlckNvbG9yOjEsYm9yZGVyTGVmdDoxLGJvcmRlclJpZ2h0OjEsYm9yZGVyVG9wOjEsYm9yZGVyV2lkdGg6MSxtYXJnaW46MSxwYWRkaW5nOjF9O2YuZWZmZWN0cy5hbmltYXRlQ2xhc3M9ZnVuY3Rpb24oYyxhLGIsZCl7aWYoZi5pc0Z1bmN0aW9uKGIpKXtkPWI7Yj1udWxsfXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZT1mKHRoaXMpLGc9ZS5hdHRyKCJzdHlsZSIpfHwiICIsaD1vKG4uY2FsbCh0aGlzKSkscSx1PWUuYXR0cigiY2xhc3NOYW1lIik7Zi5lYWNoKHAsZnVuY3Rpb24odiwKaSl7Y1tpXSYmZVtpKyJDbGFzcyJdKGNbaV0pfSk7cT1vKG4uY2FsbCh0aGlzKSk7ZS5hdHRyKCJjbGFzc05hbWUiLHUpO2UuYW5pbWF0ZSh0KGgscSksYSxiLGZ1bmN0aW9uKCl7Zi5lYWNoKHAsZnVuY3Rpb24odixpKXtjW2ldJiZlW2krIkNsYXNzIl0oY1tpXSl9KTtpZih0eXBlb2YgZS5hdHRyKCJzdHlsZSIpPT0ib2JqZWN0Iil7ZS5hdHRyKCJzdHlsZSIpLmNzc1RleHQ9IiI7ZS5hdHRyKCJzdHlsZSIpLmNzc1RleHQ9Z31lbHNlIGUuYXR0cigic3R5bGUiLGcpO2QmJmQuYXBwbHkodGhpcyxhcmd1bWVudHMpfSl9KX07Zi5mbi5leHRlbmQoe19hZGRDbGFzczpmLmZuLmFkZENsYXNzLGFkZENsYXNzOmZ1bmN0aW9uKGMsYSxiLGQpe3JldHVybiBhP2YuZWZmZWN0cy5hbmltYXRlQ2xhc3MuYXBwbHkodGhpcyxbe2FkZDpjfSxhLGIsZF0pOnRoaXMuX2FkZENsYXNzKGMpfSxfcmVtb3ZlQ2xhc3M6Zi5mbi5yZW1vdmVDbGFzcyxyZW1vdmVDbGFzczpmdW5jdGlvbihjLGEsYixkKXtyZXR1cm4gYT8KZi5lZmZlY3RzLmFuaW1hdGVDbGFzcy5hcHBseSh0aGlzLFt7cmVtb3ZlOmN9LGEsYixkXSk6dGhpcy5fcmVtb3ZlQ2xhc3MoYyl9LF90b2dnbGVDbGFzczpmLmZuLnRvZ2dsZUNsYXNzLHRvZ2dsZUNsYXNzOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIHR5cGVvZiBhPT0iYm9vbGVhbiJ8fGE9PT1qP2I/Zi5lZmZlY3RzLmFuaW1hdGVDbGFzcy5hcHBseSh0aGlzLFthP3thZGQ6Y306e3JlbW92ZTpjfSxiLGQsZV0pOnRoaXMuX3RvZ2dsZUNsYXNzKGMsYSk6Zi5lZmZlY3RzLmFuaW1hdGVDbGFzcy5hcHBseSh0aGlzLFt7dG9nZ2xlOmN9LGEsYixkXSl9LHN3aXRjaENsYXNzOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIGYuZWZmZWN0cy5hbmltYXRlQ2xhc3MuYXBwbHkodGhpcyxbe2FkZDphLHJlbW92ZTpjfSxiLGQsZV0pfX0pO2YuZXh0ZW5kKGYuZWZmZWN0cyx7dmVyc2lvbjoiMS44LjUiLHNhdmU6ZnVuY3Rpb24oYyxhKXtmb3IodmFyIGI9MDtiPGEubGVuZ3RoO2IrKylhW2JdIT09Cm51bGwmJmMuZGF0YSgiZWMuc3RvcmFnZS4iK2FbYl0sY1swXS5zdHlsZVthW2JdXSl9LHJlc3RvcmU6ZnVuY3Rpb24oYyxhKXtmb3IodmFyIGI9MDtiPGEubGVuZ3RoO2IrKylhW2JdIT09bnVsbCYmYy5jc3MoYVtiXSxjLmRhdGEoImVjLnN0b3JhZ2UuIithW2JdKSl9LHNldE1vZGU6ZnVuY3Rpb24oYyxhKXtpZihhPT0idG9nZ2xlIilhPWMuaXMoIjpoaWRkZW4iKT8ic2hvdyI6ImhpZGUiO3JldHVybiBhfSxnZXRCYXNlbGluZTpmdW5jdGlvbihjLGEpe3ZhciBiO3N3aXRjaChjWzBdKXtjYXNlICJ0b3AiOmI9MDticmVhaztjYXNlICJtaWRkbGUiOmI9MC41O2JyZWFrO2Nhc2UgImJvdHRvbSI6Yj0xO2JyZWFrO2RlZmF1bHQ6Yj1jWzBdL2EuaGVpZ2h0fXN3aXRjaChjWzFdKXtjYXNlICJsZWZ0IjpjPTA7YnJlYWs7Y2FzZSAiY2VudGVyIjpjPTAuNTticmVhaztjYXNlICJyaWdodCI6Yz0xO2JyZWFrO2RlZmF1bHQ6Yz1jWzFdL2Eud2lkdGh9cmV0dXJue3g6Yyx5OmJ9fSxjcmVhdGVXcmFwcGVyOmZ1bmN0aW9uKGMpe2lmKGMucGFyZW50KCkuaXMoIi51aS1lZmZlY3RzLXdyYXBwZXIiKSlyZXR1cm4gYy5wYXJlbnQoKTsKdmFyIGE9e3dpZHRoOmMub3V0ZXJXaWR0aCh0cnVlKSxoZWlnaHQ6Yy5vdXRlckhlaWdodCh0cnVlKSwiZmxvYXQiOmMuY3NzKCJmbG9hdCIpfSxiPWYoIjxkaXY+PC9kaXY+IikuYWRkQ2xhc3MoInVpLWVmZmVjdHMtd3JhcHBlciIpLmNzcyh7Zm9udFNpemU6IjEwMCUiLGJhY2tncm91bmQ6InRyYW5zcGFyZW50Iixib3JkZXI6Im5vbmUiLG1hcmdpbjowLHBhZGRpbmc6MH0pO2Mud3JhcChiKTtiPWMucGFyZW50KCk7aWYoYy5jc3MoInBvc2l0aW9uIik9PSJzdGF0aWMiKXtiLmNzcyh7cG9zaXRpb246InJlbGF0aXZlIn0pO2MuY3NzKHtwb3NpdGlvbjoicmVsYXRpdmUifSl9ZWxzZXtmLmV4dGVuZChhLHtwb3NpdGlvbjpjLmNzcygicG9zaXRpb24iKSx6SW5kZXg6Yy5jc3MoInotaW5kZXgiKX0pO2YuZWFjaChbInRvcCIsImxlZnQiLCJib3R0b20iLCJyaWdodCJdLGZ1bmN0aW9uKGQsZSl7YVtlXT1jLmNzcyhlKTtpZihpc05hTihwYXJzZUludChhW2VdLDEwKSkpYVtlXT0iYXV0byJ9KTsKYy5jc3Moe3Bvc2l0aW9uOiJyZWxhdGl2ZSIsdG9wOjAsbGVmdDowfSl9cmV0dXJuIGIuY3NzKGEpLnNob3coKX0scmVtb3ZlV3JhcHBlcjpmdW5jdGlvbihjKXtpZihjLnBhcmVudCgpLmlzKCIudWktZWZmZWN0cy13cmFwcGVyIikpcmV0dXJuIGMucGFyZW50KCkucmVwbGFjZVdpdGgoYyk7cmV0dXJuIGN9LHNldFRyYW5zaXRpb246ZnVuY3Rpb24oYyxhLGIsZCl7ZD1kfHx7fTtmLmVhY2goYSxmdW5jdGlvbihlLGcpe3VuaXQ9Yy5jc3NVbml0KGcpO2lmKHVuaXRbMF0+MClkW2ddPXVuaXRbMF0qYit1bml0WzFdfSk7cmV0dXJuIGR9fSk7Zi5mbi5leHRlbmQoe2VmZmVjdDpmdW5jdGlvbihjKXt2YXIgYT1rLmFwcGx5KHRoaXMsYXJndW1lbnRzKTthPXtvcHRpb25zOmFbMV0sZHVyYXRpb246YVsyXSxjYWxsYmFjazphWzNdfTt2YXIgYj1mLmVmZmVjdHNbY107cmV0dXJuIGImJiFmLmZ4Lm9mZj9iLmNhbGwodGhpcyxhKTp0aGlzfSxfc2hvdzpmLmZuLnNob3csc2hvdzpmdW5jdGlvbihjKXtpZighY3x8CnR5cGVvZiBjPT0ibnVtYmVyInx8Zi5meC5zcGVlZHNbY118fCFmLmVmZmVjdHNbY10pcmV0dXJuIHRoaXMuX3Nob3cuYXBwbHkodGhpcyxhcmd1bWVudHMpO2Vsc2V7dmFyIGE9ay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7YVsxXS5tb2RlPSJzaG93IjtyZXR1cm4gdGhpcy5lZmZlY3QuYXBwbHkodGhpcyxhKX19LF9oaWRlOmYuZm4uaGlkZSxoaWRlOmZ1bmN0aW9uKGMpe2lmKCFjfHx0eXBlb2YgYz09Im51bWJlciJ8fGYuZnguc3BlZWRzW2NdfHwhZi5lZmZlY3RzW2NdKXJldHVybiB0aGlzLl9oaWRlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtlbHNle3ZhciBhPWsuYXBwbHkodGhpcyxhcmd1bWVudHMpO2FbMV0ubW9kZT0iaGlkZSI7cmV0dXJuIHRoaXMuZWZmZWN0LmFwcGx5KHRoaXMsYSl9fSxfX3RvZ2dsZTpmLmZuLnRvZ2dsZSx0b2dnbGU6ZnVuY3Rpb24oYyl7aWYoIWN8fHR5cGVvZiBjPT0ibnVtYmVyInx8Zi5meC5zcGVlZHNbY118fCFmLmVmZmVjdHNbY118fHR5cGVvZiBjPT0KImJvb2xlYW4ifHxmLmlzRnVuY3Rpb24oYykpcmV0dXJuIHRoaXMuX190b2dnbGUuYXBwbHkodGhpcyxhcmd1bWVudHMpO2Vsc2V7dmFyIGE9ay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7YVsxXS5tb2RlPSJ0b2dnbGUiO3JldHVybiB0aGlzLmVmZmVjdC5hcHBseSh0aGlzLGEpfX0sY3NzVW5pdDpmdW5jdGlvbihjKXt2YXIgYT10aGlzLmNzcyhjKSxiPVtdO2YuZWFjaChbImVtIiwicHgiLCIlIiwicHQiXSxmdW5jdGlvbihkLGUpe2lmKGEuaW5kZXhPZihlKT4wKWI9W3BhcnNlRmxvYXQoYSksZV19KTtyZXR1cm4gYn19KTtmLmVhc2luZy5qc3dpbmc9Zi5lYXNpbmcuc3dpbmc7Zi5leHRlbmQoZi5lYXNpbmcse2RlZjoiZWFzZU91dFF1YWQiLHN3aW5nOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIGYuZWFzaW5nW2YuZWFzaW5nLmRlZl0oYyxhLGIsZCxlKX0sZWFzZUluUXVhZDpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkKihhLz1lKSphK2J9LGVhc2VPdXRRdWFkOmZ1bmN0aW9uKGMsCmEsYixkLGUpe3JldHVybi1kKihhLz1lKSooYS0yKStifSxlYXNlSW5PdXRRdWFkOmZ1bmN0aW9uKGMsYSxiLGQsZSl7aWYoKGEvPWUvMik8MSlyZXR1cm4gZC8yKmEqYStiO3JldHVybi1kLzIqKC0tYSooYS0yKS0xKStifSxlYXNlSW5DdWJpYzpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkKihhLz1lKSphKmErYn0sZWFzZU91dEN1YmljOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIGQqKChhPWEvZS0xKSphKmErMSkrYn0sZWFzZUluT3V0Q3ViaWM6ZnVuY3Rpb24oYyxhLGIsZCxlKXtpZigoYS89ZS8yKTwxKXJldHVybiBkLzIqYSphKmErYjtyZXR1cm4gZC8yKigoYS09MikqYSphKzIpK2J9LGVhc2VJblF1YXJ0OmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIGQqKGEvPWUpKmEqYSphK2J9LGVhc2VPdXRRdWFydDpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybi1kKigoYT1hL2UtMSkqYSphKmEtMSkrYn0sZWFzZUluT3V0UXVhcnQ6ZnVuY3Rpb24oYyxhLGIsZCxlKXtpZigoYS89CmUvMik8MSlyZXR1cm4gZC8yKmEqYSphKmErYjtyZXR1cm4tZC8yKigoYS09MikqYSphKmEtMikrYn0sZWFzZUluUXVpbnQ6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4gZCooYS89ZSkqYSphKmEqYStifSxlYXNlT3V0UXVpbnQ6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4gZCooKGE9YS9lLTEpKmEqYSphKmErMSkrYn0sZWFzZUluT3V0UXVpbnQ6ZnVuY3Rpb24oYyxhLGIsZCxlKXtpZigoYS89ZS8yKTwxKXJldHVybiBkLzIqYSphKmEqYSphK2I7cmV0dXJuIGQvMiooKGEtPTIpKmEqYSphKmErMikrYn0sZWFzZUluU2luZTpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybi1kKk1hdGguY29zKGEvZSooTWF0aC5QSS8yKSkrZCtifSxlYXNlT3V0U2luZTpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkKk1hdGguc2luKGEvZSooTWF0aC5QSS8yKSkrYn0sZWFzZUluT3V0U2luZTpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybi1kLzIqKE1hdGguY29zKE1hdGguUEkqYS9lKS0xKSsKYn0sZWFzZUluRXhwbzpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBhPT0wP2I6ZCpNYXRoLnBvdygyLDEwKihhL2UtMSkpK2J9LGVhc2VPdXRFeHBvOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIGE9PWU/YitkOmQqKC1NYXRoLnBvdygyLC0xMCphL2UpKzEpK2J9LGVhc2VJbk91dEV4cG86ZnVuY3Rpb24oYyxhLGIsZCxlKXtpZihhPT0wKXJldHVybiBiO2lmKGE9PWUpcmV0dXJuIGIrZDtpZigoYS89ZS8yKTwxKXJldHVybiBkLzIqTWF0aC5wb3coMiwxMCooYS0xKSkrYjtyZXR1cm4gZC8yKigtTWF0aC5wb3coMiwtMTAqLS1hKSsyKStifSxlYXNlSW5DaXJjOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuLWQqKE1hdGguc3FydCgxLShhLz1lKSphKS0xKStifSxlYXNlT3V0Q2lyYzpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkKk1hdGguc3FydCgxLShhPWEvZS0xKSphKStifSxlYXNlSW5PdXRDaXJjOmZ1bmN0aW9uKGMsYSxiLGQsZSl7aWYoKGEvPWUvMik8MSlyZXR1cm4tZC8KMiooTWF0aC5zcXJ0KDEtYSphKS0xKStiO3JldHVybiBkLzIqKE1hdGguc3FydCgxLShhLT0yKSphKSsxKStifSxlYXNlSW5FbGFzdGljOmZ1bmN0aW9uKGMsYSxiLGQsZSl7Yz0xLjcwMTU4O3ZhciBnPTAsaD1kO2lmKGE9PTApcmV0dXJuIGI7aWYoKGEvPWUpPT0xKXJldHVybiBiK2Q7Z3x8KGc9ZSowLjMpO2lmKGg8TWF0aC5hYnMoZCkpe2g9ZDtjPWcvNH1lbHNlIGM9Zy8oMipNYXRoLlBJKSpNYXRoLmFzaW4oZC9oKTtyZXR1cm4tKGgqTWF0aC5wb3coMiwxMCooYS09MSkpKk1hdGguc2luKChhKmUtYykqMipNYXRoLlBJL2cpKStifSxlYXNlT3V0RWxhc3RpYzpmdW5jdGlvbihjLGEsYixkLGUpe2M9MS43MDE1ODt2YXIgZz0wLGg9ZDtpZihhPT0wKXJldHVybiBiO2lmKChhLz1lKT09MSlyZXR1cm4gYitkO2d8fChnPWUqMC4zKTtpZihoPE1hdGguYWJzKGQpKXtoPWQ7Yz1nLzR9ZWxzZSBjPWcvKDIqTWF0aC5QSSkqTWF0aC5hc2luKGQvaCk7cmV0dXJuIGgqTWF0aC5wb3coMiwtMTAqCmEpKk1hdGguc2luKChhKmUtYykqMipNYXRoLlBJL2cpK2QrYn0sZWFzZUluT3V0RWxhc3RpYzpmdW5jdGlvbihjLGEsYixkLGUpe2M9MS43MDE1ODt2YXIgZz0wLGg9ZDtpZihhPT0wKXJldHVybiBiO2lmKChhLz1lLzIpPT0yKXJldHVybiBiK2Q7Z3x8KGc9ZSowLjMqMS41KTtpZihoPE1hdGguYWJzKGQpKXtoPWQ7Yz1nLzR9ZWxzZSBjPWcvKDIqTWF0aC5QSSkqTWF0aC5hc2luKGQvaCk7aWYoYTwxKXJldHVybi0wLjUqaCpNYXRoLnBvdygyLDEwKihhLT0xKSkqTWF0aC5zaW4oKGEqZS1jKSoyKk1hdGguUEkvZykrYjtyZXR1cm4gaCpNYXRoLnBvdygyLC0xMCooYS09MSkpKk1hdGguc2luKChhKmUtYykqMipNYXRoLlBJL2cpKjAuNStkK2J9LGVhc2VJbkJhY2s6ZnVuY3Rpb24oYyxhLGIsZCxlLGcpe2lmKGc9PWopZz0xLjcwMTU4O3JldHVybiBkKihhLz1lKSphKigoZysxKSphLWcpK2J9LGVhc2VPdXRCYWNrOmZ1bmN0aW9uKGMsYSxiLGQsZSxnKXtpZihnPT1qKWc9MS43MDE1ODsKcmV0dXJuIGQqKChhPWEvZS0xKSphKigoZysxKSphK2cpKzEpK2J9LGVhc2VJbk91dEJhY2s6ZnVuY3Rpb24oYyxhLGIsZCxlLGcpe2lmKGc9PWopZz0xLjcwMTU4O2lmKChhLz1lLzIpPDEpcmV0dXJuIGQvMiphKmEqKCgoZyo9MS41MjUpKzEpKmEtZykrYjtyZXR1cm4gZC8yKigoYS09MikqYSooKChnKj0xLjUyNSkrMSkqYStnKSsyKStifSxlYXNlSW5Cb3VuY2U6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4gZC1mLmVhc2luZy5lYXNlT3V0Qm91bmNlKGMsZS1hLDAsZCxlKStifSxlYXNlT3V0Qm91bmNlOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuKGEvPWUpPDEvMi43NT9kKjcuNTYyNSphKmErYjphPDIvMi43NT9kKig3LjU2MjUqKGEtPTEuNS8yLjc1KSphKzAuNzUpK2I6YTwyLjUvMi43NT9kKig3LjU2MjUqKGEtPTIuMjUvMi43NSkqYSswLjkzNzUpK2I6ZCooNy41NjI1KihhLT0yLjYyNS8yLjc1KSphKzAuOTg0Mzc1KStifSxlYXNlSW5PdXRCb3VuY2U6ZnVuY3Rpb24oYywKYSxiLGQsZSl7aWYoYTxlLzIpcmV0dXJuIGYuZWFzaW5nLmVhc2VJbkJvdW5jZShjLGEqMiwwLGQsZSkqMC41K2I7cmV0dXJuIGYuZWFzaW5nLmVhc2VPdXRCb3VuY2UoYyxhKjItZSwwLGQsZSkqMC41K2QqMC41K2J9fSl9KGpRdWVyeSk7CihmdW5jdGlvbihiKXtiLmVmZmVjdHMuYmxpbmQ9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYT1iKHRoaXMpLGc9WyJwb3NpdGlvbiIsInRvcCIsImxlZnQiXSxmPWIuZWZmZWN0cy5zZXRNb2RlKGEsYy5vcHRpb25zLm1vZGV8fCJoaWRlIiksZD1jLm9wdGlvbnMuZGlyZWN0aW9ufHwidmVydGljYWwiO2IuZWZmZWN0cy5zYXZlKGEsZyk7YS5zaG93KCk7dmFyIGU9Yi5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoYSkuY3NzKHtvdmVyZmxvdzoiaGlkZGVuIn0pLGg9ZD09InZlcnRpY2FsIj8iaGVpZ2h0Ijoid2lkdGgiO2Q9ZD09InZlcnRpY2FsIj9lLmhlaWdodCgpOmUud2lkdGgoKTtmPT0ic2hvdyImJmUuY3NzKGgsMCk7dmFyIGk9e307aVtoXT1mPT0ic2hvdyI/ZDowO2UuYW5pbWF0ZShpLGMuZHVyYXRpb24sYy5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2Y9PSJoaWRlIiYmYS5oaWRlKCk7Yi5lZmZlY3RzLnJlc3RvcmUoYSxnKTtiLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihhKTsKYy5jYWxsYmFjayYmYy5jYWxsYmFjay5hcHBseShhWzBdLGFyZ3VtZW50cyk7YS5kZXF1ZXVlKCl9KX0pfX0pKGpRdWVyeSk7CihmdW5jdGlvbihlKXtlLmVmZmVjdHMuYm91bmNlPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGE9ZSh0aGlzKSxsPVsicG9zaXRpb24iLCJ0b3AiLCJsZWZ0Il0saD1lLmVmZmVjdHMuc2V0TW9kZShhLGIub3B0aW9ucy5tb2RlfHwiZWZmZWN0IiksZD1iLm9wdGlvbnMuZGlyZWN0aW9ufHwidXAiLGM9Yi5vcHRpb25zLmRpc3RhbmNlfHwyMCxtPWIub3B0aW9ucy50aW1lc3x8NSxpPWIuZHVyYXRpb258fDI1MDsvc2hvd3xoaWRlLy50ZXN0KGgpJiZsLnB1c2goIm9wYWNpdHkiKTtlLmVmZmVjdHMuc2F2ZShhLGwpO2Euc2hvdygpO2UuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGEpO3ZhciBmPWQ9PSJ1cCJ8fGQ9PSJkb3duIj8idG9wIjoibGVmdCI7ZD1kPT0idXAifHxkPT0ibGVmdCI/InBvcyI6Im5lZyI7Yz1iLm9wdGlvbnMuZGlzdGFuY2V8fChmPT0idG9wIj9hLm91dGVySGVpZ2h0KHttYXJnaW46dHJ1ZX0pLzM6YS5vdXRlcldpZHRoKHttYXJnaW46dHJ1ZX0pLwozKTtpZihoPT0ic2hvdyIpYS5jc3MoIm9wYWNpdHkiLDApLmNzcyhmLGQ9PSJwb3MiPy1jOmMpO2lmKGg9PSJoaWRlIiljLz1tKjI7aCE9ImhpZGUiJiZtLS07aWYoaD09InNob3ciKXt2YXIgZz17b3BhY2l0eToxfTtnW2ZdPShkPT0icG9zIj8iKz0iOiItPSIpK2M7YS5hbmltYXRlKGcsaS8yLGIub3B0aW9ucy5lYXNpbmcpO2MvPTI7bS0tfWZvcihnPTA7ZzxtO2crKyl7dmFyIGo9e30saz17fTtqW2ZdPShkPT0icG9zIj8iLT0iOiIrPSIpK2M7a1tmXT0oZD09InBvcyI/Iis9IjoiLT0iKStjO2EuYW5pbWF0ZShqLGkvMixiLm9wdGlvbnMuZWFzaW5nKS5hbmltYXRlKGssaS8yLGIub3B0aW9ucy5lYXNpbmcpO2M9aD09ImhpZGUiP2MqMjpjLzJ9aWYoaD09ImhpZGUiKXtnPXtvcGFjaXR5OjB9O2dbZl09KGQ9PSJwb3MiPyItPSI6Iis9IikrYzthLmFuaW1hdGUoZyxpLzIsYi5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2EuaGlkZSgpO2UuZWZmZWN0cy5yZXN0b3JlKGEsbCk7ZS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYSk7CmIuY2FsbGJhY2smJmIuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpfSl9ZWxzZXtqPXt9O2s9e307altmXT0oZD09InBvcyI/Ii09IjoiKz0iKStjO2tbZl09KGQ9PSJwb3MiPyIrPSI6Ii09IikrYzthLmFuaW1hdGUoaixpLzIsYi5vcHRpb25zLmVhc2luZykuYW5pbWF0ZShrLGkvMixiLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7ZS5lZmZlY3RzLnJlc3RvcmUoYSxsKTtlLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihhKTtiLmNhbGxiYWNrJiZiLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pfWEucXVldWUoImZ4IixmdW5jdGlvbigpe2EuZGVxdWV1ZSgpfSk7YS5kZXF1ZXVlKCl9KX19KShqUXVlcnkpOwooZnVuY3Rpb24oYil7Yi5lZmZlY3RzLmNsaXA9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYT1iKHRoaXMpLGk9WyJwb3NpdGlvbiIsInRvcCIsImxlZnQiLCJoZWlnaHQiLCJ3aWR0aCJdLGY9Yi5lZmZlY3RzLnNldE1vZGUoYSxlLm9wdGlvbnMubW9kZXx8ImhpZGUiKSxjPWUub3B0aW9ucy5kaXJlY3Rpb258fCJ2ZXJ0aWNhbCI7Yi5lZmZlY3RzLnNhdmUoYSxpKTthLnNob3coKTt2YXIgZD1iLmVmZmVjdHMuY3JlYXRlV3JhcHBlcihhKS5jc3Moe292ZXJmbG93OiJoaWRkZW4ifSk7ZD1hWzBdLnRhZ05hbWU9PSJJTUciP2Q6YTt2YXIgZz17c2l6ZTpjPT0idmVydGljYWwiPyJoZWlnaHQiOiJ3aWR0aCIscG9zaXRpb246Yz09InZlcnRpY2FsIj8idG9wIjoibGVmdCJ9O2M9Yz09InZlcnRpY2FsIj9kLmhlaWdodCgpOmQud2lkdGgoKTtpZihmPT0ic2hvdyIpe2QuY3NzKGcuc2l6ZSwwKTtkLmNzcyhnLnBvc2l0aW9uLGMvMil9dmFyIGg9e307aFtnLnNpemVdPQpmPT0ic2hvdyI/YzowO2hbZy5wb3NpdGlvbl09Zj09InNob3ciPzA6Yy8yO2QuYW5pbWF0ZShoLHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjplLmR1cmF0aW9uLGVhc2luZzplLm9wdGlvbnMuZWFzaW5nLGNvbXBsZXRlOmZ1bmN0aW9uKCl7Zj09ImhpZGUiJiZhLmhpZGUoKTtiLmVmZmVjdHMucmVzdG9yZShhLGkpO2IuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGEpO2UuY2FsbGJhY2smJmUuY2FsbGJhY2suYXBwbHkoYVswXSxhcmd1bWVudHMpO2EuZGVxdWV1ZSgpfX0pfSl9fSkoalF1ZXJ5KTsKKGZ1bmN0aW9uKGMpe2MuZWZmZWN0cy5kcm9wPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGE9Yyh0aGlzKSxoPVsicG9zaXRpb24iLCJ0b3AiLCJsZWZ0Iiwib3BhY2l0eSJdLGU9Yy5lZmZlY3RzLnNldE1vZGUoYSxkLm9wdGlvbnMubW9kZXx8ImhpZGUiKSxiPWQub3B0aW9ucy5kaXJlY3Rpb258fCJsZWZ0IjtjLmVmZmVjdHMuc2F2ZShhLGgpO2Euc2hvdygpO2MuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGEpO3ZhciBmPWI9PSJ1cCJ8fGI9PSJkb3duIj8idG9wIjoibGVmdCI7Yj1iPT0idXAifHxiPT0ibGVmdCI/InBvcyI6Im5lZyI7dmFyIGc9ZC5vcHRpb25zLmRpc3RhbmNlfHwoZj09InRvcCI/YS5vdXRlckhlaWdodCh7bWFyZ2luOnRydWV9KS8yOmEub3V0ZXJXaWR0aCh7bWFyZ2luOnRydWV9KS8yKTtpZihlPT0ic2hvdyIpYS5jc3MoIm9wYWNpdHkiLDApLmNzcyhmLGI9PSJwb3MiPy1nOmcpO3ZhciBpPXtvcGFjaXR5OmU9PSJzaG93Ij8xOgowfTtpW2ZdPShlPT0ic2hvdyI/Yj09InBvcyI/Iis9IjoiLT0iOmI9PSJwb3MiPyItPSI6Iis9IikrZzthLmFuaW1hdGUoaSx7cXVldWU6ZmFsc2UsZHVyYXRpb246ZC5kdXJhdGlvbixlYXNpbmc6ZC5vcHRpb25zLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2U9PSJoaWRlIiYmYS5oaWRlKCk7Yy5lZmZlY3RzLnJlc3RvcmUoYSxoKTtjLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihhKTtkLmNhbGxiYWNrJiZkLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKTthLmRlcXVldWUoKX19KX0pfX0pKGpRdWVyeSk7CihmdW5jdGlvbihqKXtqLmVmZmVjdHMuZXhwbG9kZT1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWEub3B0aW9ucy5waWVjZXM/TWF0aC5yb3VuZChNYXRoLnNxcnQoYS5vcHRpb25zLnBpZWNlcykpOjMsZD1hLm9wdGlvbnMucGllY2VzP01hdGgucm91bmQoTWF0aC5zcXJ0KGEub3B0aW9ucy5waWVjZXMpKTozO2Eub3B0aW9ucy5tb2RlPWEub3B0aW9ucy5tb2RlPT0idG9nZ2xlIj9qKHRoaXMpLmlzKCI6dmlzaWJsZSIpPyJoaWRlIjoic2hvdyI6YS5vcHRpb25zLm1vZGU7dmFyIGI9aih0aGlzKS5zaG93KCkuY3NzKCJ2aXNpYmlsaXR5IiwiaGlkZGVuIiksZz1iLm9mZnNldCgpO2cudG9wLT1wYXJzZUludChiLmNzcygibWFyZ2luVG9wIiksMTApfHwwO2cubGVmdC09cGFyc2VJbnQoYi5jc3MoIm1hcmdpbkxlZnQiKSwxMCl8fDA7Zm9yKHZhciBoPWIub3V0ZXJXaWR0aCh0cnVlKSxpPWIub3V0ZXJIZWlnaHQodHJ1ZSksZT0wO2U8YztlKyspZm9yKHZhciBmPQowO2Y8ZDtmKyspYi5jbG9uZSgpLmFwcGVuZFRvKCJib2R5Iikud3JhcCgiPGRpdj48L2Rpdj4iKS5jc3Moe3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdmlzaWJpbGl0eToidmlzaWJsZSIsbGVmdDotZiooaC9kKSx0b3A6LWUqKGkvYyl9KS5wYXJlbnQoKS5hZGRDbGFzcygidWktZWZmZWN0cy1leHBsb2RlIikuY3NzKHtwb3NpdGlvbjoiYWJzb2x1dGUiLG92ZXJmbG93OiJoaWRkZW4iLHdpZHRoOmgvZCxoZWlnaHQ6aS9jLGxlZnQ6Zy5sZWZ0K2YqKGgvZCkrKGEub3B0aW9ucy5tb2RlPT0ic2hvdyI/KGYtTWF0aC5mbG9vcihkLzIpKSooaC9kKTowKSx0b3A6Zy50b3ArZSooaS9jKSsoYS5vcHRpb25zLm1vZGU9PSJzaG93Ij8oZS1NYXRoLmZsb29yKGMvMikpKihpL2MpOjApLG9wYWNpdHk6YS5vcHRpb25zLm1vZGU9PSJzaG93Ij8wOjF9KS5hbmltYXRlKHtsZWZ0OmcubGVmdCtmKihoL2QpKyhhLm9wdGlvbnMubW9kZT09InNob3ciPzA6KGYtTWF0aC5mbG9vcihkLzIpKSooaC9kKSksdG9wOmcudG9wKwplKihpL2MpKyhhLm9wdGlvbnMubW9kZT09InNob3ciPzA6KGUtTWF0aC5mbG9vcihjLzIpKSooaS9jKSksb3BhY2l0eTphLm9wdGlvbnMubW9kZT09InNob3ciPzE6MH0sYS5kdXJhdGlvbnx8NTAwKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YS5vcHRpb25zLm1vZGU9PSJzaG93Ij9iLmNzcyh7dmlzaWJpbGl0eToidmlzaWJsZSJ9KTpiLmNzcyh7dmlzaWJpbGl0eToidmlzaWJsZSJ9KS5oaWRlKCk7YS5jYWxsYmFjayYmYS5jYWxsYmFjay5hcHBseShiWzBdKTtiLmRlcXVldWUoKTtqKCJkaXYudWktZWZmZWN0cy1leHBsb2RlIikucmVtb3ZlKCl9LGEuZHVyYXRpb258fDUwMCl9KX19KShqUXVlcnkpOwooZnVuY3Rpb24oYil7Yi5lZmZlY3RzLmZhZGU9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1iKHRoaXMpLGQ9Yi5lZmZlY3RzLnNldE1vZGUoYyxhLm9wdGlvbnMubW9kZXx8ImhpZGUiKTtjLmFuaW1hdGUoe29wYWNpdHk6ZH0se3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmEuZHVyYXRpb24sZWFzaW5nOmEub3B0aW9ucy5lYXNpbmcsY29tcGxldGU6ZnVuY3Rpb24oKXthLmNhbGxiYWNrJiZhLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtjLmRlcXVldWUoKX19KX0pfX0pKGpRdWVyeSk7CihmdW5jdGlvbihjKXtjLmVmZmVjdHMuZm9sZD1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBiPWModGhpcyksaj1bInBvc2l0aW9uIiwidG9wIiwibGVmdCJdLGQ9Yy5lZmZlY3RzLnNldE1vZGUoYixhLm9wdGlvbnMubW9kZXx8ImhpZGUiKSxnPWEub3B0aW9ucy5zaXplfHwxNSxoPSEhYS5vcHRpb25zLmhvcml6Rmlyc3Qsaz1hLmR1cmF0aW9uP2EuZHVyYXRpb24vMjpjLmZ4LnNwZWVkcy5fZGVmYXVsdC8yO2MuZWZmZWN0cy5zYXZlKGIsaik7Yi5zaG93KCk7dmFyIGU9Yy5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoYikuY3NzKHtvdmVyZmxvdzoiaGlkZGVuIn0pLGY9ZD09InNob3ciIT1oLGw9Zj9bIndpZHRoIiwiaGVpZ2h0Il06WyJoZWlnaHQiLCJ3aWR0aCJdO2Y9Zj9bZS53aWR0aCgpLGUuaGVpZ2h0KCldOltlLmhlaWdodCgpLGUud2lkdGgoKV07dmFyIGk9LyhbMC05XSspJS8uZXhlYyhnKTtpZihpKWc9cGFyc2VJbnQoaVsxXSwxMCkvMTAwKgpmW2Q9PSJoaWRlIj8wOjFdO2lmKGQ9PSJzaG93IillLmNzcyhoP3toZWlnaHQ6MCx3aWR0aDpnfTp7aGVpZ2h0Omcsd2lkdGg6MH0pO2g9e307aT17fTtoW2xbMF1dPWQ9PSJzaG93Ij9mWzBdOmc7aVtsWzFdXT1kPT0ic2hvdyI/ZlsxXTowO2UuYW5pbWF0ZShoLGssYS5vcHRpb25zLmVhc2luZykuYW5pbWF0ZShpLGssYS5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2Q9PSJoaWRlIiYmYi5oaWRlKCk7Yy5lZmZlY3RzLnJlc3RvcmUoYixqKTtjLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihiKTthLmNhbGxiYWNrJiZhLmNhbGxiYWNrLmFwcGx5KGJbMF0sYXJndW1lbnRzKTtiLmRlcXVldWUoKX0pfSl9fSkoalF1ZXJ5KTsKKGZ1bmN0aW9uKGIpe2IuZWZmZWN0cy5oaWdobGlnaHQ9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYT1iKHRoaXMpLGU9WyJiYWNrZ3JvdW5kSW1hZ2UiLCJiYWNrZ3JvdW5kQ29sb3IiLCJvcGFjaXR5Il0sZD1iLmVmZmVjdHMuc2V0TW9kZShhLGMub3B0aW9ucy5tb2RlfHwic2hvdyIpLGY9e2JhY2tncm91bmRDb2xvcjphLmNzcygiYmFja2dyb3VuZENvbG9yIil9O2lmKGQ9PSJoaWRlIilmLm9wYWNpdHk9MDtiLmVmZmVjdHMuc2F2ZShhLGUpO2Euc2hvdygpLmNzcyh7YmFja2dyb3VuZEltYWdlOiJub25lIixiYWNrZ3JvdW5kQ29sb3I6Yy5vcHRpb25zLmNvbG9yfHwiI2ZmZmY5OSJ9KS5hbmltYXRlKGYse3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmMuZHVyYXRpb24sZWFzaW5nOmMub3B0aW9ucy5lYXNpbmcsY29tcGxldGU6ZnVuY3Rpb24oKXtkPT0iaGlkZSImJmEuaGlkZSgpO2IuZWZmZWN0cy5yZXN0b3JlKGEsZSk7ZD09InNob3ciJiYhYi5zdXBwb3J0Lm9wYWNpdHkmJgp0aGlzLnN0eWxlLnJlbW92ZUF0dHJpYnV0ZSgiZmlsdGVyIik7Yy5jYWxsYmFjayYmYy5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7YS5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpOwooZnVuY3Rpb24oZCl7ZC5lZmZlY3RzLnB1bHNhdGU9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYj1kKHRoaXMpLGM9ZC5lZmZlY3RzLnNldE1vZGUoYixhLm9wdGlvbnMubW9kZXx8InNob3ciKTt0aW1lcz0oYS5vcHRpb25zLnRpbWVzfHw1KSoyLTE7ZHVyYXRpb249YS5kdXJhdGlvbj9hLmR1cmF0aW9uLzI6ZC5meC5zcGVlZHMuX2RlZmF1bHQvMjtpc1Zpc2libGU9Yi5pcygiOnZpc2libGUiKTthbmltYXRlVG89MDtpZighaXNWaXNpYmxlKXtiLmNzcygib3BhY2l0eSIsMCkuc2hvdygpO2FuaW1hdGVUbz0xfWlmKGM9PSJoaWRlIiYmaXNWaXNpYmxlfHxjPT0ic2hvdyImJiFpc1Zpc2libGUpdGltZXMtLTtmb3IoYz0wO2M8dGltZXM7YysrKXtiLmFuaW1hdGUoe29wYWNpdHk6YW5pbWF0ZVRvfSxkdXJhdGlvbixhLm9wdGlvbnMuZWFzaW5nKTthbmltYXRlVG89KGFuaW1hdGVUbysxKSUyfWIuYW5pbWF0ZSh7b3BhY2l0eTphbmltYXRlVG99LGR1cmF0aW9uLAphLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7YW5pbWF0ZVRvPT0wJiZiLmhpZGUoKTthLmNhbGxiYWNrJiZhLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pO2IucXVldWUoImZ4IixmdW5jdGlvbigpe2IuZGVxdWV1ZSgpfSkuZGVxdWV1ZSgpfSl9fSkoalF1ZXJ5KTsKKGZ1bmN0aW9uKGMpe2MuZWZmZWN0cy5wdWZmPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGE9Yyh0aGlzKSxlPWMuZWZmZWN0cy5zZXRNb2RlKGEsYi5vcHRpb25zLm1vZGV8fCJoaWRlIiksZz1wYXJzZUludChiLm9wdGlvbnMucGVyY2VudCwxMCl8fDE1MCxoPWcvMTAwLGk9e2hlaWdodDphLmhlaWdodCgpLHdpZHRoOmEud2lkdGgoKX07Yy5leHRlbmQoYi5vcHRpb25zLHtmYWRlOnRydWUsbW9kZTplLHBlcmNlbnQ6ZT09ImhpZGUiP2c6MTAwLGZyb206ZT09ImhpZGUiP2k6e2hlaWdodDppLmhlaWdodCpoLHdpZHRoOmkud2lkdGgqaH19KTthLmVmZmVjdCgic2NhbGUiLGIub3B0aW9ucyxiLmR1cmF0aW9uLGIuY2FsbGJhY2spO2EuZGVxdWV1ZSgpfSl9O2MuZWZmZWN0cy5zY2FsZT1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBhPWModGhpcyksZT1jLmV4dGVuZCh0cnVlLHt9LGIub3B0aW9ucyksZz1jLmVmZmVjdHMuc2V0TW9kZShhLApiLm9wdGlvbnMubW9kZXx8ImVmZmVjdCIpLGg9cGFyc2VJbnQoYi5vcHRpb25zLnBlcmNlbnQsMTApfHwocGFyc2VJbnQoYi5vcHRpb25zLnBlcmNlbnQsMTApPT0wPzA6Zz09ImhpZGUiPzA6MTAwKSxpPWIub3B0aW9ucy5kaXJlY3Rpb258fCJib3RoIixmPWIub3B0aW9ucy5vcmlnaW47aWYoZyE9ImVmZmVjdCIpe2Uub3JpZ2luPWZ8fFsibWlkZGxlIiwiY2VudGVyIl07ZS5yZXN0b3JlPXRydWV9Zj17aGVpZ2h0OmEuaGVpZ2h0KCksd2lkdGg6YS53aWR0aCgpfTthLmZyb209Yi5vcHRpb25zLmZyb218fChnPT0ic2hvdyI/e2hlaWdodDowLHdpZHRoOjB9OmYpO2g9e3k6aSE9Imhvcml6b250YWwiP2gvMTAwOjEseDppIT0idmVydGljYWwiP2gvMTAwOjF9O2EudG89e2hlaWdodDpmLmhlaWdodCpoLnksd2lkdGg6Zi53aWR0aCpoLnh9O2lmKGIub3B0aW9ucy5mYWRlKXtpZihnPT0ic2hvdyIpe2EuZnJvbS5vcGFjaXR5PTA7YS50by5vcGFjaXR5PTF9aWYoZz09ImhpZGUiKXthLmZyb20ub3BhY2l0eT0KMTthLnRvLm9wYWNpdHk9MH19ZS5mcm9tPWEuZnJvbTtlLnRvPWEudG87ZS5tb2RlPWc7YS5lZmZlY3QoInNpemUiLGUsYi5kdXJhdGlvbixiLmNhbGxiYWNrKTthLmRlcXVldWUoKX0pfTtjLmVmZmVjdHMuc2l6ZT1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBhPWModGhpcyksZT1bInBvc2l0aW9uIiwidG9wIiwibGVmdCIsIndpZHRoIiwiaGVpZ2h0Iiwib3ZlcmZsb3ciLCJvcGFjaXR5Il0sZz1bInBvc2l0aW9uIiwidG9wIiwibGVmdCIsIm92ZXJmbG93Iiwib3BhY2l0eSJdLGg9WyJ3aWR0aCIsImhlaWdodCIsIm92ZXJmbG93Il0saT1bImZvbnRTaXplIl0sZj1bImJvcmRlclRvcFdpZHRoIiwiYm9yZGVyQm90dG9tV2lkdGgiLCJwYWRkaW5nVG9wIiwicGFkZGluZ0JvdHRvbSJdLGs9WyJib3JkZXJMZWZ0V2lkdGgiLCJib3JkZXJSaWdodFdpZHRoIiwicGFkZGluZ0xlZnQiLCJwYWRkaW5nUmlnaHQiXSxwPWMuZWZmZWN0cy5zZXRNb2RlKGEsCmIub3B0aW9ucy5tb2RlfHwiZWZmZWN0Iiksbj1iLm9wdGlvbnMucmVzdG9yZXx8ZmFsc2UsbT1iLm9wdGlvbnMuc2NhbGV8fCJib3RoIixsPWIub3B0aW9ucy5vcmlnaW4saj17aGVpZ2h0OmEuaGVpZ2h0KCksd2lkdGg6YS53aWR0aCgpfTthLmZyb209Yi5vcHRpb25zLmZyb218fGo7YS50bz1iLm9wdGlvbnMudG98fGo7aWYobCl7bD1jLmVmZmVjdHMuZ2V0QmFzZWxpbmUobCxqKTthLmZyb20udG9wPShqLmhlaWdodC1hLmZyb20uaGVpZ2h0KSpsLnk7YS5mcm9tLmxlZnQ9KGoud2lkdGgtYS5mcm9tLndpZHRoKSpsLng7YS50by50b3A9KGouaGVpZ2h0LWEudG8uaGVpZ2h0KSpsLnk7YS50by5sZWZ0PShqLndpZHRoLWEudG8ud2lkdGgpKmwueH12YXIgZD17ZnJvbTp7eTphLmZyb20uaGVpZ2h0L2ouaGVpZ2h0LHg6YS5mcm9tLndpZHRoL2oud2lkdGh9LHRvOnt5OmEudG8uaGVpZ2h0L2ouaGVpZ2h0LHg6YS50by53aWR0aC9qLndpZHRofX07aWYobT09ImJveCJ8fG09PSJib3RoIil7aWYoZC5mcm9tLnkhPQpkLnRvLnkpe2U9ZS5jb25jYXQoZik7YS5mcm9tPWMuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGEsZixkLmZyb20ueSxhLmZyb20pO2EudG89Yy5lZmZlY3RzLnNldFRyYW5zaXRpb24oYSxmLGQudG8ueSxhLnRvKX1pZihkLmZyb20ueCE9ZC50by54KXtlPWUuY29uY2F0KGspO2EuZnJvbT1jLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihhLGssZC5mcm9tLngsYS5mcm9tKTthLnRvPWMuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGEsayxkLnRvLngsYS50byl9fWlmKG09PSJjb250ZW50Inx8bT09ImJvdGgiKWlmKGQuZnJvbS55IT1kLnRvLnkpe2U9ZS5jb25jYXQoaSk7YS5mcm9tPWMuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGEsaSxkLmZyb20ueSxhLmZyb20pO2EudG89Yy5lZmZlY3RzLnNldFRyYW5zaXRpb24oYSxpLGQudG8ueSxhLnRvKX1jLmVmZmVjdHMuc2F2ZShhLG4/ZTpnKTthLnNob3coKTtjLmVmZmVjdHMuY3JlYXRlV3JhcHBlcihhKTthLmNzcygib3ZlcmZsb3ciLCJoaWRkZW4iKS5jc3MoYS5mcm9tKTsKaWYobT09ImNvbnRlbnQifHxtPT0iYm90aCIpe2Y9Zi5jb25jYXQoWyJtYXJnaW5Ub3AiLCJtYXJnaW5Cb3R0b20iXSkuY29uY2F0KGkpO2s9ay5jb25jYXQoWyJtYXJnaW5MZWZ0IiwibWFyZ2luUmlnaHQiXSk7aD1lLmNvbmNhdChmKS5jb25jYXQoayk7YS5maW5kKCIqW3dpZHRoXSIpLmVhY2goZnVuY3Rpb24oKXtjaGlsZD1jKHRoaXMpO24mJmMuZWZmZWN0cy5zYXZlKGNoaWxkLGgpO3ZhciBvPXtoZWlnaHQ6Y2hpbGQuaGVpZ2h0KCksd2lkdGg6Y2hpbGQud2lkdGgoKX07Y2hpbGQuZnJvbT17aGVpZ2h0Om8uaGVpZ2h0KmQuZnJvbS55LHdpZHRoOm8ud2lkdGgqZC5mcm9tLnh9O2NoaWxkLnRvPXtoZWlnaHQ6by5oZWlnaHQqZC50by55LHdpZHRoOm8ud2lkdGgqZC50by54fTtpZihkLmZyb20ueSE9ZC50by55KXtjaGlsZC5mcm9tPWMuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGNoaWxkLGYsZC5mcm9tLnksY2hpbGQuZnJvbSk7Y2hpbGQudG89Yy5lZmZlY3RzLnNldFRyYW5zaXRpb24oY2hpbGQsCmYsZC50by55LGNoaWxkLnRvKX1pZihkLmZyb20ueCE9ZC50by54KXtjaGlsZC5mcm9tPWMuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGNoaWxkLGssZC5mcm9tLngsY2hpbGQuZnJvbSk7Y2hpbGQudG89Yy5lZmZlY3RzLnNldFRyYW5zaXRpb24oY2hpbGQsayxkLnRvLngsY2hpbGQudG8pfWNoaWxkLmNzcyhjaGlsZC5mcm9tKTtjaGlsZC5hbmltYXRlKGNoaWxkLnRvLGIuZHVyYXRpb24sYi5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe24mJmMuZWZmZWN0cy5yZXN0b3JlKGNoaWxkLGgpfSl9KX1hLmFuaW1hdGUoYS50byx7cXVldWU6ZmFsc2UsZHVyYXRpb246Yi5kdXJhdGlvbixlYXNpbmc6Yi5vcHRpb25zLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2EudG8ub3BhY2l0eT09PTAmJmEuY3NzKCJvcGFjaXR5IixhLmZyb20ub3BhY2l0eSk7cD09ImhpZGUiJiZhLmhpZGUoKTtjLmVmZmVjdHMucmVzdG9yZShhLG4/ZTpnKTtjLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihhKTtiLmNhbGxiYWNrJiYKYi5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7YS5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpOwooZnVuY3Rpb24oZCl7ZC5lZmZlY3RzLnNoYWtlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGI9ZCh0aGlzKSxqPVsicG9zaXRpb24iLCJ0b3AiLCJsZWZ0Il07ZC5lZmZlY3RzLnNldE1vZGUoYixhLm9wdGlvbnMubW9kZXx8ImVmZmVjdCIpO3ZhciBjPWEub3B0aW9ucy5kaXJlY3Rpb258fCJsZWZ0IixlPWEub3B0aW9ucy5kaXN0YW5jZXx8MjAsbD1hLm9wdGlvbnMudGltZXN8fDMsZj1hLmR1cmF0aW9ufHxhLm9wdGlvbnMuZHVyYXRpb258fDE0MDtkLmVmZmVjdHMuc2F2ZShiLGopO2Iuc2hvdygpO2QuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGIpO3ZhciBnPWM9PSJ1cCJ8fGM9PSJkb3duIj8idG9wIjoibGVmdCIsaD1jPT0idXAifHxjPT0ibGVmdCI/InBvcyI6Im5lZyI7Yz17fTt2YXIgaT17fSxrPXt9O2NbZ109KGg9PSJwb3MiPyItPSI6Iis9IikrZTtpW2ddPShoPT0icG9zIj8iKz0iOiItPSIpK2UqMjtrW2ddPShoPT0icG9zIj8iLT0iOiIrPSIpKwplKjI7Yi5hbmltYXRlKGMsZixhLm9wdGlvbnMuZWFzaW5nKTtmb3IoZT0xO2U8bDtlKyspYi5hbmltYXRlKGksZixhLm9wdGlvbnMuZWFzaW5nKS5hbmltYXRlKGssZixhLm9wdGlvbnMuZWFzaW5nKTtiLmFuaW1hdGUoaSxmLGEub3B0aW9ucy5lYXNpbmcpLmFuaW1hdGUoYyxmLzIsYS5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2QuZWZmZWN0cy5yZXN0b3JlKGIsaik7ZC5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYik7YS5jYWxsYmFjayYmYS5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KTtiLnF1ZXVlKCJmeCIsZnVuY3Rpb24oKXtiLmRlcXVldWUoKX0pO2IuZGVxdWV1ZSgpfSl9fSkoalF1ZXJ5KTsKKGZ1bmN0aW9uKGMpe2MuZWZmZWN0cy5zbGlkZT1mdW5jdGlvbihkKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBhPWModGhpcyksaD1bInBvc2l0aW9uIiwidG9wIiwibGVmdCJdLGU9Yy5lZmZlY3RzLnNldE1vZGUoYSxkLm9wdGlvbnMubW9kZXx8InNob3ciKSxiPWQub3B0aW9ucy5kaXJlY3Rpb258fCJsZWZ0IjtjLmVmZmVjdHMuc2F2ZShhLGgpO2Euc2hvdygpO2MuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGEpLmNzcyh7b3ZlcmZsb3c6ImhpZGRlbiJ9KTt2YXIgZj1iPT0idXAifHxiPT0iZG93biI/InRvcCI6ImxlZnQiO2I9Yj09InVwInx8Yj09ImxlZnQiPyJwb3MiOiJuZWciO3ZhciBnPWQub3B0aW9ucy5kaXN0YW5jZXx8KGY9PSJ0b3AiP2Eub3V0ZXJIZWlnaHQoe21hcmdpbjp0cnVlfSk6YS5vdXRlcldpZHRoKHttYXJnaW46dHJ1ZX0pKTtpZihlPT0ic2hvdyIpYS5jc3MoZixiPT0icG9zIj8tZzpnKTt2YXIgaT17fTtpW2ZdPShlPT0ic2hvdyI/Yj09InBvcyI/CiIrPSI6Ii09IjpiPT0icG9zIj8iLT0iOiIrPSIpK2c7YS5hbmltYXRlKGkse3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmQuZHVyYXRpb24sZWFzaW5nOmQub3B0aW9ucy5lYXNpbmcsY29tcGxldGU6ZnVuY3Rpb24oKXtlPT0iaGlkZSImJmEuaGlkZSgpO2MuZWZmZWN0cy5yZXN0b3JlKGEsaCk7Yy5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYSk7ZC5jYWxsYmFjayYmZC5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7YS5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpOwooZnVuY3Rpb24oZSl7ZS5lZmZlY3RzLnRyYW5zZmVyPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGI9ZSh0aGlzKSxjPWUoYS5vcHRpb25zLnRvKSxkPWMub2Zmc2V0KCk7Yz17dG9wOmQudG9wLGxlZnQ6ZC5sZWZ0LGhlaWdodDpjLmlubmVySGVpZ2h0KCksd2lkdGg6Yy5pbm5lcldpZHRoKCl9O2Q9Yi5vZmZzZXQoKTt2YXIgZj1lKCc8ZGl2IGNsYXNzPSJ1aS1lZmZlY3RzLXRyYW5zZmVyIj48L2Rpdj4nKS5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KS5hZGRDbGFzcyhhLm9wdGlvbnMuY2xhc3NOYW1lKS5jc3Moe3RvcDpkLnRvcCxsZWZ0OmQubGVmdCxoZWlnaHQ6Yi5pbm5lckhlaWdodCgpLHdpZHRoOmIuaW5uZXJXaWR0aCgpLHBvc2l0aW9uOiJhYnNvbHV0ZSJ9KS5hbmltYXRlKGMsYS5kdXJhdGlvbixhLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7Zi5yZW1vdmUoKTthLmNhbGxiYWNrJiZhLmNhbGxiYWNrLmFwcGx5KGJbMF0sYXJndW1lbnRzKTsKYi5kZXF1ZXVlKCl9KX0pfX0pKGpRdWVyeSk7CihmdW5jdGlvbihjKXtjLndpZGdldCgidWkuYWNjb3JkaW9uIix7b3B0aW9uczp7YWN0aXZlOjAsYW5pbWF0ZWQ6InNsaWRlIixhdXRvSGVpZ2h0OnRydWUsY2xlYXJTdHlsZTpmYWxzZSxjb2xsYXBzaWJsZTpmYWxzZSxldmVudDoiY2xpY2siLGZpbGxTcGFjZTpmYWxzZSxoZWFkZXI6Ij4gbGkgPiA6Zmlyc3QtY2hpbGQsPiA6bm90KGxpKTpldmVuIixpY29uczp7aGVhZGVyOiJ1aS1pY29uLXRyaWFuZ2xlLTEtZSIsaGVhZGVyU2VsZWN0ZWQ6InVpLWljb24tdHJpYW5nbGUtMS1zIn0sbmF2aWdhdGlvbjpmYWxzZSxuYXZpZ2F0aW9uRmlsdGVyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaHJlZi50b0xvd2VyQ2FzZSgpPT09bG9jYXRpb24uaHJlZi50b0xvd2VyQ2FzZSgpfX0sX2NyZWF0ZTpmdW5jdGlvbigpe3ZhciBhPXRoaXMsYj1hLm9wdGlvbnM7YS5ydW5uaW5nPTA7YS5lbGVtZW50LmFkZENsYXNzKCJ1aS1hY2NvcmRpb24gdWktd2lkZ2V0IHVpLWhlbHBlci1yZXNldCIpLmNoaWxkcmVuKCJsaSIpLmFkZENsYXNzKCJ1aS1hY2NvcmRpb24tbGktZml4Iik7CmEuaGVhZGVycz1hLmVsZW1lbnQuZmluZChiLmhlYWRlcikuYWRkQ2xhc3MoInVpLWFjY29yZGlvbi1oZWFkZXIgdWktaGVscGVyLXJlc2V0IHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbCIpLmJpbmQoIm1vdXNlZW50ZXIuYWNjb3JkaW9uIixmdW5jdGlvbigpe2IuZGlzYWJsZWR8fGModGhpcykuYWRkQ2xhc3MoInVpLXN0YXRlLWhvdmVyIil9KS5iaW5kKCJtb3VzZWxlYXZlLmFjY29yZGlvbiIsZnVuY3Rpb24oKXtiLmRpc2FibGVkfHxjKHRoaXMpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpfSkuYmluZCgiZm9jdXMuYWNjb3JkaW9uIixmdW5jdGlvbigpe2IuZGlzYWJsZWR8fGModGhpcykuYWRkQ2xhc3MoInVpLXN0YXRlLWZvY3VzIil9KS5iaW5kKCJibHVyLmFjY29yZGlvbiIsZnVuY3Rpb24oKXtiLmRpc2FibGVkfHxjKHRoaXMpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1mb2N1cyIpfSk7YS5oZWFkZXJzLm5leHQoKS5hZGRDbGFzcygidWktYWNjb3JkaW9uLWNvbnRlbnQgdWktaGVscGVyLXJlc2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20iKTsKaWYoYi5uYXZpZ2F0aW9uKXt2YXIgZD1hLmVsZW1lbnQuZmluZCgiYSIpLmZpbHRlcihiLm5hdmlnYXRpb25GaWx0ZXIpLmVxKDApO2lmKGQubGVuZ3RoKXt2YXIgZj1kLmNsb3Nlc3QoIi51aS1hY2NvcmRpb24taGVhZGVyIik7YS5hY3RpdmU9Zi5sZW5ndGg/ZjpkLmNsb3Nlc3QoIi51aS1hY2NvcmRpb24tY29udGVudCIpLnByZXYoKX19YS5hY3RpdmU9YS5fZmluZEFjdGl2ZShhLmFjdGl2ZXx8Yi5hY3RpdmUpLmFkZENsYXNzKCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLXN0YXRlLWFjdGl2ZSIpLnRvZ2dsZUNsYXNzKCJ1aS1jb3JuZXItYWxsIHVpLWNvcm5lci10b3AiKTthLmFjdGl2ZS5uZXh0KCkuYWRkQ2xhc3MoInVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZSIpO2EuX2NyZWF0ZUljb25zKCk7YS5yZXNpemUoKTthLmVsZW1lbnQuYXR0cigicm9sZSIsInRhYmxpc3QiKTthLmhlYWRlcnMuYXR0cigicm9sZSIsInRhYiIpLmJpbmQoImtleWRvd24uYWNjb3JkaW9uIixmdW5jdGlvbihnKXtyZXR1cm4gYS5fa2V5ZG93bihnKX0pLm5leHQoKS5hdHRyKCJyb2xlIiwKInRhYnBhbmVsIik7YS5oZWFkZXJzLm5vdChhLmFjdGl2ZXx8IiIpLmF0dHIoeyJhcmlhLWV4cGFuZGVkIjoiZmFsc2UiLHRhYkluZGV4Oi0xfSkubmV4dCgpLmhpZGUoKTthLmFjdGl2ZS5sZW5ndGg/YS5hY3RpdmUuYXR0cih7ImFyaWEtZXhwYW5kZWQiOiJ0cnVlIix0YWJJbmRleDowfSk6YS5oZWFkZXJzLmVxKDApLmF0dHIoInRhYkluZGV4IiwwKTtjLmJyb3dzZXIuc2FmYXJpfHxhLmhlYWRlcnMuZmluZCgiYSIpLmF0dHIoInRhYkluZGV4IiwtMSk7Yi5ldmVudCYmYS5oZWFkZXJzLmJpbmQoYi5ldmVudC5zcGxpdCgiICIpLmpvaW4oIi5hY2NvcmRpb24gIikrIi5hY2NvcmRpb24iLGZ1bmN0aW9uKGcpe2EuX2NsaWNrSGFuZGxlci5jYWxsKGEsZyx0aGlzKTtnLnByZXZlbnREZWZhdWx0KCl9KX0sX2NyZWF0ZUljb25zOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vcHRpb25zO2lmKGEuaWNvbnMpe2MoIjxzcGFuPjwvc3Bhbj4iKS5hZGRDbGFzcygidWktaWNvbiAiK2EuaWNvbnMuaGVhZGVyKS5wcmVwZW5kVG8odGhpcy5oZWFkZXJzKTsKdGhpcy5hY3RpdmUuY2hpbGRyZW4oIi51aS1pY29uIikudG9nZ2xlQ2xhc3MoYS5pY29ucy5oZWFkZXIpLnRvZ2dsZUNsYXNzKGEuaWNvbnMuaGVhZGVyU2VsZWN0ZWQpO3RoaXMuZWxlbWVudC5hZGRDbGFzcygidWktYWNjb3JkaW9uLWljb25zIil9fSxfZGVzdHJveUljb25zOmZ1bmN0aW9uKCl7dGhpcy5oZWFkZXJzLmNoaWxkcmVuKCIudWktaWNvbiIpLnJlbW92ZSgpO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktYWNjb3JkaW9uLWljb25zIil9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnM7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1hY2NvcmRpb24gdWktd2lkZ2V0IHVpLWhlbHBlci1yZXNldCIpLnJlbW92ZUF0dHIoInJvbGUiKTt0aGlzLmhlYWRlcnMudW5iaW5kKCIuYWNjb3JkaW9uIikucmVtb3ZlQ2xhc3MoInVpLWFjY29yZGlvbi1oZWFkZXIgdWktYWNjb3JkaW9uLWRpc2FibGVkIHVpLWhlbHBlci1yZXNldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwgdWktc3RhdGUtYWN0aXZlIHVpLXN0YXRlLWRpc2FibGVkIHVpLWNvcm5lci10b3AiKS5yZW1vdmVBdHRyKCJyb2xlIikucmVtb3ZlQXR0cigiYXJpYS1leHBhbmRlZCIpLnJlbW92ZUF0dHIoInRhYkluZGV4Iik7CnRoaXMuaGVhZGVycy5maW5kKCJhIikucmVtb3ZlQXR0cigidGFiSW5kZXgiKTt0aGlzLl9kZXN0cm95SWNvbnMoKTt2YXIgYj10aGlzLmhlYWRlcnMubmV4dCgpLmNzcygiZGlzcGxheSIsIiIpLnJlbW92ZUF0dHIoInJvbGUiKS5yZW1vdmVDbGFzcygidWktaGVscGVyLXJlc2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20gdWktYWNjb3JkaW9uLWNvbnRlbnQgdWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlIHVpLWFjY29yZGlvbi1kaXNhYmxlZCB1aS1zdGF0ZS1kaXNhYmxlZCIpO2lmKGEuYXV0b0hlaWdodHx8YS5maWxsSGVpZ2h0KWIuY3NzKCJoZWlnaHQiLCIiKTtyZXR1cm4gYy5XaWRnZXQucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKX0sX3NldE9wdGlvbjpmdW5jdGlvbihhLGIpe2MuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTthPT0iYWN0aXZlIiYmdGhpcy5hY3RpdmF0ZShiKTtpZihhPT0iaWNvbnMiKXt0aGlzLl9kZXN0cm95SWNvbnMoKTsKYiYmdGhpcy5fY3JlYXRlSWNvbnMoKX1pZihhPT0iZGlzYWJsZWQiKXRoaXMuaGVhZGVycy5hZGQodGhpcy5oZWFkZXJzLm5leHQoKSlbYj8iYWRkQ2xhc3MiOiJyZW1vdmVDbGFzcyJdKCJ1aS1hY2NvcmRpb24tZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWQiKX0sX2tleWRvd246ZnVuY3Rpb24oYSl7aWYoISh0aGlzLm9wdGlvbnMuZGlzYWJsZWR8fGEuYWx0S2V5fHxhLmN0cmxLZXkpKXt2YXIgYj1jLnVpLmtleUNvZGUsZD10aGlzLmhlYWRlcnMubGVuZ3RoLGY9dGhpcy5oZWFkZXJzLmluZGV4KGEudGFyZ2V0KSxnPWZhbHNlO3N3aXRjaChhLmtleUNvZGUpe2Nhc2UgYi5SSUdIVDpjYXNlIGIuRE9XTjpnPXRoaXMuaGVhZGVyc1soZisxKSVkXTticmVhaztjYXNlIGIuTEVGVDpjYXNlIGIuVVA6Zz10aGlzLmhlYWRlcnNbKGYtMStkKSVkXTticmVhaztjYXNlIGIuU1BBQ0U6Y2FzZSBiLkVOVEVSOnRoaXMuX2NsaWNrSGFuZGxlcih7dGFyZ2V0OmEudGFyZ2V0fSxhLnRhcmdldCk7CmEucHJldmVudERlZmF1bHQoKX1pZihnKXtjKGEudGFyZ2V0KS5hdHRyKCJ0YWJJbmRleCIsLTEpO2MoZykuYXR0cigidGFiSW5kZXgiLDApO2cuZm9jdXMoKTtyZXR1cm4gZmFsc2V9cmV0dXJuIHRydWV9fSxyZXNpemU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnMsYjtpZihhLmZpbGxTcGFjZSl7aWYoYy5icm93c2VyLm1zaWUpe3ZhciBkPXRoaXMuZWxlbWVudC5wYXJlbnQoKS5jc3MoIm92ZXJmbG93Iik7dGhpcy5lbGVtZW50LnBhcmVudCgpLmNzcygib3ZlcmZsb3ciLCJoaWRkZW4iKX1iPXRoaXMuZWxlbWVudC5wYXJlbnQoKS5oZWlnaHQoKTtjLmJyb3dzZXIubXNpZSYmdGhpcy5lbGVtZW50LnBhcmVudCgpLmNzcygib3ZlcmZsb3ciLGQpO3RoaXMuaGVhZGVycy5lYWNoKGZ1bmN0aW9uKCl7Yi09Yyh0aGlzKS5vdXRlckhlaWdodCh0cnVlKX0pO3RoaXMuaGVhZGVycy5uZXh0KCkuZWFjaChmdW5jdGlvbigpe2ModGhpcykuaGVpZ2h0KE1hdGgubWF4KDAsYi1jKHRoaXMpLmlubmVySGVpZ2h0KCkrCmModGhpcykuaGVpZ2h0KCkpKX0pLmNzcygib3ZlcmZsb3ciLCJhdXRvIil9ZWxzZSBpZihhLmF1dG9IZWlnaHQpe2I9MDt0aGlzLmhlYWRlcnMubmV4dCgpLmVhY2goZnVuY3Rpb24oKXtiPU1hdGgubWF4KGIsYyh0aGlzKS5oZWlnaHQoIiIpLmhlaWdodCgpKX0pLmhlaWdodChiKX1yZXR1cm4gdGhpc30sYWN0aXZhdGU6ZnVuY3Rpb24oYSl7dGhpcy5vcHRpb25zLmFjdGl2ZT1hO2E9dGhpcy5fZmluZEFjdGl2ZShhKVswXTt0aGlzLl9jbGlja0hhbmRsZXIoe3RhcmdldDphfSxhKTtyZXR1cm4gdGhpc30sX2ZpbmRBY3RpdmU6ZnVuY3Rpb24oYSl7cmV0dXJuIGE/dHlwZW9mIGE9PT0ibnVtYmVyIj90aGlzLmhlYWRlcnMuZmlsdGVyKCI6ZXEoIithKyIpIik6dGhpcy5oZWFkZXJzLm5vdCh0aGlzLmhlYWRlcnMubm90KGEpKTphPT09ZmFsc2U/YyhbXSk6dGhpcy5oZWFkZXJzLmZpbHRlcigiOmVxKDApIil9LF9jbGlja0hhbmRsZXI6ZnVuY3Rpb24oYSxiKXt2YXIgZD10aGlzLm9wdGlvbnM7CmlmKCFkLmRpc2FibGVkKWlmKGEudGFyZ2V0KXthPWMoYS5jdXJyZW50VGFyZ2V0fHxiKTtiPWFbMF09PT10aGlzLmFjdGl2ZVswXTtkLmFjdGl2ZT1kLmNvbGxhcHNpYmxlJiZiP2ZhbHNlOnRoaXMuaGVhZGVycy5pbmRleChhKTtpZighKHRoaXMucnVubmluZ3x8IWQuY29sbGFwc2libGUmJmIpKXt0aGlzLmFjdGl2ZS5yZW1vdmVDbGFzcygidWktc3RhdGUtYWN0aXZlIHVpLWNvcm5lci10b3AiKS5hZGRDbGFzcygidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsIikuY2hpbGRyZW4oIi51aS1pY29uIikucmVtb3ZlQ2xhc3MoZC5pY29ucy5oZWFkZXJTZWxlY3RlZCkuYWRkQ2xhc3MoZC5pY29ucy5oZWFkZXIpO2lmKCFiKXthLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwiKS5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIHVpLWNvcm5lci10b3AiKS5jaGlsZHJlbigiLnVpLWljb24iKS5yZW1vdmVDbGFzcyhkLmljb25zLmhlYWRlcikuYWRkQ2xhc3MoZC5pY29ucy5oZWFkZXJTZWxlY3RlZCk7CmEubmV4dCgpLmFkZENsYXNzKCJ1aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmUiKX1oPWEubmV4dCgpO2Y9dGhpcy5hY3RpdmUubmV4dCgpO2c9e29wdGlvbnM6ZCxuZXdIZWFkZXI6YiYmZC5jb2xsYXBzaWJsZT9jKFtdKTphLG9sZEhlYWRlcjp0aGlzLmFjdGl2ZSxuZXdDb250ZW50OmImJmQuY29sbGFwc2libGU/YyhbXSk6aCxvbGRDb250ZW50OmZ9O2Q9dGhpcy5oZWFkZXJzLmluZGV4KHRoaXMuYWN0aXZlWzBdKT50aGlzLmhlYWRlcnMuaW5kZXgoYVswXSk7dGhpcy5hY3RpdmU9Yj9jKFtdKTphO3RoaXMuX3RvZ2dsZShoLGYsZyxiLGQpfX1lbHNlIGlmKGQuY29sbGFwc2libGUpe3RoaXMuYWN0aXZlLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUgdWktY29ybmVyLXRvcCIpLmFkZENsYXNzKCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwiKS5jaGlsZHJlbigiLnVpLWljb24iKS5yZW1vdmVDbGFzcyhkLmljb25zLmhlYWRlclNlbGVjdGVkKS5hZGRDbGFzcyhkLmljb25zLmhlYWRlcik7CnRoaXMuYWN0aXZlLm5leHQoKS5hZGRDbGFzcygidWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlIik7dmFyIGY9dGhpcy5hY3RpdmUubmV4dCgpLGc9e29wdGlvbnM6ZCxuZXdIZWFkZXI6YyhbXSksb2xkSGVhZGVyOmQuYWN0aXZlLG5ld0NvbnRlbnQ6YyhbXSksb2xkQ29udGVudDpmfSxoPXRoaXMuYWN0aXZlPWMoW10pO3RoaXMuX3RvZ2dsZShoLGYsZyl9fSxfdG9nZ2xlOmZ1bmN0aW9uKGEsYixkLGYsZyl7dmFyIGg9dGhpcyxlPWgub3B0aW9ucztoLnRvU2hvdz1hO2gudG9IaWRlPWI7aC5kYXRhPWQ7dmFyIGo9ZnVuY3Rpb24oKXtpZihoKXJldHVybiBoLl9jb21wbGV0ZWQuYXBwbHkoaCxhcmd1bWVudHMpfTtoLl90cmlnZ2VyKCJjaGFuZ2VzdGFydCIsbnVsbCxoLmRhdGEpO2gucnVubmluZz1iLnNpemUoKT09PTA/YS5zaXplKCk6Yi5zaXplKCk7aWYoZS5hbmltYXRlZCl7ZD17fTtkPWUuY29sbGFwc2libGUmJmY/e3RvU2hvdzpjKFtdKSx0b0hpZGU6Yixjb21wbGV0ZTpqLApkb3duOmcsYXV0b0hlaWdodDplLmF1dG9IZWlnaHR8fGUuZmlsbFNwYWNlfTp7dG9TaG93OmEsdG9IaWRlOmIsY29tcGxldGU6aixkb3duOmcsYXV0b0hlaWdodDplLmF1dG9IZWlnaHR8fGUuZmlsbFNwYWNlfTtpZighZS5wcm94aWVkKWUucHJveGllZD1lLmFuaW1hdGVkO2lmKCFlLnByb3hpZWREdXJhdGlvbillLnByb3hpZWREdXJhdGlvbj1lLmR1cmF0aW9uO2UuYW5pbWF0ZWQ9Yy5pc0Z1bmN0aW9uKGUucHJveGllZCk/ZS5wcm94aWVkKGQpOmUucHJveGllZDtlLmR1cmF0aW9uPWMuaXNGdW5jdGlvbihlLnByb3hpZWREdXJhdGlvbik/ZS5wcm94aWVkRHVyYXRpb24oZCk6ZS5wcm94aWVkRHVyYXRpb247Zj1jLnVpLmFjY29yZGlvbi5hbmltYXRpb25zO3ZhciBpPWUuZHVyYXRpb24saz1lLmFuaW1hdGVkO2lmKGsmJiFmW2tdJiYhYy5lYXNpbmdba10paz0ic2xpZGUiO2Zba118fChmW2tdPWZ1bmN0aW9uKGwpe3RoaXMuc2xpZGUobCx7ZWFzaW5nOmssZHVyYXRpb246aXx8NzAwfSl9KTsKZltrXShkKX1lbHNle2lmKGUuY29sbGFwc2libGUmJmYpYS50b2dnbGUoKTtlbHNle2IuaGlkZSgpO2Euc2hvdygpfWoodHJ1ZSl9Yi5wcmV2KCkuYXR0cih7ImFyaWEtZXhwYW5kZWQiOiJmYWxzZSIsdGFiSW5kZXg6LTF9KS5ibHVyKCk7YS5wcmV2KCkuYXR0cih7ImFyaWEtZXhwYW5kZWQiOiJ0cnVlIix0YWJJbmRleDowfSkuZm9jdXMoKX0sX2NvbXBsZXRlZDpmdW5jdGlvbihhKXt0aGlzLnJ1bm5pbmc9YT8wOi0tdGhpcy5ydW5uaW5nO2lmKCF0aGlzLnJ1bm5pbmcpe3RoaXMub3B0aW9ucy5jbGVhclN0eWxlJiZ0aGlzLnRvU2hvdy5hZGQodGhpcy50b0hpZGUpLmNzcyh7aGVpZ2h0OiIiLG92ZXJmbG93OiIifSk7dGhpcy50b0hpZGUucmVtb3ZlQ2xhc3MoInVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZSIpO3RoaXMuX3RyaWdnZXIoImNoYW5nZSIsbnVsbCx0aGlzLmRhdGEpfX19KTtjLmV4dGVuZChjLnVpLmFjY29yZGlvbix7dmVyc2lvbjoiMS44LjUiLGFuaW1hdGlvbnM6e3NsaWRlOmZ1bmN0aW9uKGEsCmIpe2E9Yy5leHRlbmQoe2Vhc2luZzoic3dpbmciLGR1cmF0aW9uOjMwMH0sYSxiKTtpZihhLnRvSGlkZS5zaXplKCkpaWYoYS50b1Nob3cuc2l6ZSgpKXt2YXIgZD1hLnRvU2hvdy5jc3MoIm92ZXJmbG93IiksZj0wLGc9e30saD17fSxlO2I9YS50b1Nob3c7ZT1iWzBdLnN0eWxlLndpZHRoO2Iud2lkdGgocGFyc2VJbnQoYi5wYXJlbnQoKS53aWR0aCgpLDEwKS1wYXJzZUludChiLmNzcygicGFkZGluZ0xlZnQiKSwxMCktcGFyc2VJbnQoYi5jc3MoInBhZGRpbmdSaWdodCIpLDEwKS0ocGFyc2VJbnQoYi5jc3MoImJvcmRlckxlZnRXaWR0aCIpLDEwKXx8MCktKHBhcnNlSW50KGIuY3NzKCJib3JkZXJSaWdodFdpZHRoIiksMTApfHwwKSk7Yy5lYWNoKFsiaGVpZ2h0IiwicGFkZGluZ1RvcCIsInBhZGRpbmdCb3R0b20iXSxmdW5jdGlvbihqLGkpe2hbaV09ImhpZGUiO2o9KCIiK2MuY3NzKGEudG9TaG93WzBdLGkpKS5tYXRjaCgvXihbXGQrLS5dKykoLiopJC8pO2dbaV09e3ZhbHVlOmpbMV0sCnVuaXQ6alsyXXx8InB4In19KTthLnRvU2hvdy5jc3Moe2hlaWdodDowLG92ZXJmbG93OiJoaWRkZW4ifSkuc2hvdygpO2EudG9IaWRlLmZpbHRlcigiOmhpZGRlbiIpLmVhY2goYS5jb21wbGV0ZSkuZW5kKCkuZmlsdGVyKCI6dmlzaWJsZSIpLmFuaW1hdGUoaCx7c3RlcDpmdW5jdGlvbihqLGkpe2lmKGkucHJvcD09ImhlaWdodCIpZj1pLmVuZC1pLnN0YXJ0PT09MD8wOihpLm5vdy1pLnN0YXJ0KS8oaS5lbmQtaS5zdGFydCk7YS50b1Nob3dbMF0uc3R5bGVbaS5wcm9wXT1mKmdbaS5wcm9wXS52YWx1ZStnW2kucHJvcF0udW5pdH0sZHVyYXRpb246YS5kdXJhdGlvbixlYXNpbmc6YS5lYXNpbmcsY29tcGxldGU6ZnVuY3Rpb24oKXthLmF1dG9IZWlnaHR8fGEudG9TaG93LmNzcygiaGVpZ2h0IiwiIik7YS50b1Nob3cuY3NzKHt3aWR0aDplLG92ZXJmbG93OmR9KTthLmNvbXBsZXRlKCl9fSl9ZWxzZSBhLnRvSGlkZS5hbmltYXRlKHtoZWlnaHQ6ImhpZGUiLHBhZGRpbmdUb3A6ImhpZGUiLApwYWRkaW5nQm90dG9tOiJoaWRlIn0sYSk7ZWxzZSBhLnRvU2hvdy5hbmltYXRlKHtoZWlnaHQ6InNob3ciLHBhZGRpbmdUb3A6InNob3ciLHBhZGRpbmdCb3R0b206InNob3cifSxhKX0sYm91bmNlc2xpZGU6ZnVuY3Rpb24oYSl7dGhpcy5zbGlkZShhLHtlYXNpbmc6YS5kb3duPyJlYXNlT3V0Qm91bmNlIjoic3dpbmciLGR1cmF0aW9uOmEuZG93bj8xRTM6MjAwfSl9fX0pfSkoalF1ZXJ5KTsKKGZ1bmN0aW9uKGUpe2Uud2lkZ2V0KCJ1aS5hdXRvY29tcGxldGUiLHtvcHRpb25zOnthcHBlbmRUbzoiYm9keSIsZGVsYXk6MzAwLG1pbkxlbmd0aDoxLHBvc2l0aW9uOntteToibGVmdCB0b3AiLGF0OiJsZWZ0IGJvdHRvbSIsY29sbGlzaW9uOiJub25lIn0sc291cmNlOm51bGx9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLGI9dGhpcy5lbGVtZW50WzBdLm93bmVyRG9jdW1lbnQ7dGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1hdXRvY29tcGxldGUtaW5wdXQiKS5hdHRyKCJhdXRvY29tcGxldGUiLCJvZmYiKS5hdHRyKHtyb2xlOiJ0ZXh0Ym94IiwiYXJpYS1hdXRvY29tcGxldGUiOiJsaXN0IiwiYXJpYS1oYXNwb3B1cCI6InRydWUifSkuYmluZCgia2V5ZG93bi5hdXRvY29tcGxldGUiLGZ1bmN0aW9uKGMpe2lmKCFhLm9wdGlvbnMuZGlzYWJsZWQpe3ZhciBkPWUudWkua2V5Q29kZTtzd2l0Y2goYy5rZXlDb2RlKXtjYXNlIGQuUEFHRV9VUDphLl9tb3ZlKCJwcmV2aW91c1BhZ2UiLApjKTticmVhaztjYXNlIGQuUEFHRV9ET1dOOmEuX21vdmUoIm5leHRQYWdlIixjKTticmVhaztjYXNlIGQuVVA6YS5fbW92ZSgicHJldmlvdXMiLGMpO2MucHJldmVudERlZmF1bHQoKTticmVhaztjYXNlIGQuRE9XTjphLl9tb3ZlKCJuZXh0IixjKTtjLnByZXZlbnREZWZhdWx0KCk7YnJlYWs7Y2FzZSBkLkVOVEVSOmNhc2UgZC5OVU1QQURfRU5URVI6YS5tZW51LmVsZW1lbnQuaXMoIjp2aXNpYmxlIikmJmMucHJldmVudERlZmF1bHQoKTtjYXNlIGQuVEFCOmlmKCFhLm1lbnUuYWN0aXZlKXJldHVybjthLm1lbnUuc2VsZWN0KGMpO2JyZWFrO2Nhc2UgZC5FU0NBUEU6YS5lbGVtZW50LnZhbChhLnRlcm0pO2EuY2xvc2UoYyk7YnJlYWs7ZGVmYXVsdDpjbGVhclRpbWVvdXQoYS5zZWFyY2hpbmcpO2Euc2VhcmNoaW5nPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtpZihhLnRlcm0hPWEuZWxlbWVudC52YWwoKSl7YS5zZWxlY3RlZEl0ZW09bnVsbDthLnNlYXJjaChudWxsLGMpfX0sYS5vcHRpb25zLmRlbGF5KTsKYnJlYWt9fX0pLmJpbmQoImZvY3VzLmF1dG9jb21wbGV0ZSIsZnVuY3Rpb24oKXtpZighYS5vcHRpb25zLmRpc2FibGVkKXthLnNlbGVjdGVkSXRlbT1udWxsO2EucHJldmlvdXM9YS5lbGVtZW50LnZhbCgpfX0pLmJpbmQoImJsdXIuYXV0b2NvbXBsZXRlIixmdW5jdGlvbihjKXtpZighYS5vcHRpb25zLmRpc2FibGVkKXtjbGVhclRpbWVvdXQoYS5zZWFyY2hpbmcpO2EuY2xvc2luZz1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YS5jbG9zZShjKTthLl9jaGFuZ2UoYyl9LDE1MCl9fSk7dGhpcy5faW5pdFNvdXJjZSgpO3RoaXMucmVzcG9uc2U9ZnVuY3Rpb24oKXtyZXR1cm4gYS5fcmVzcG9uc2UuYXBwbHkoYSxhcmd1bWVudHMpfTt0aGlzLm1lbnU9ZSgiPHVsPjwvdWw+IikuYWRkQ2xhc3MoInVpLWF1dG9jb21wbGV0ZSIpLmFwcGVuZFRvKGUodGhpcy5vcHRpb25zLmFwcGVuZFRvfHwiYm9keSIsYilbMF0pLm1vdXNlZG93bihmdW5jdGlvbihjKXt2YXIgZD1hLm1lbnUuZWxlbWVudFswXTsKYy50YXJnZXQ9PT1kJiZzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZShkb2N1bWVudCkub25lKCJtb3VzZWRvd24iLGZ1bmN0aW9uKGYpe2YudGFyZ2V0IT09YS5lbGVtZW50WzBdJiZmLnRhcmdldCE9PWQmJiFlLnVpLmNvbnRhaW5zKGQsZi50YXJnZXQpJiZhLmNsb3NlKCl9KX0sMSk7c2V0VGltZW91dChmdW5jdGlvbigpe2NsZWFyVGltZW91dChhLmNsb3NpbmcpfSwxMyl9KS5tZW51KHtmb2N1czpmdW5jdGlvbihjLGQpe2Q9ZC5pdGVtLmRhdGEoIml0ZW0uYXV0b2NvbXBsZXRlIik7ZmFsc2UhPT1hLl90cmlnZ2VyKCJmb2N1cyIsbnVsbCx7aXRlbTpkfSkmJi9ea2V5Ly50ZXN0KGMub3JpZ2luYWxFdmVudC50eXBlKSYmYS5lbGVtZW50LnZhbChkLnZhbHVlKX0sc2VsZWN0ZWQ6ZnVuY3Rpb24oYyxkKXtkPWQuaXRlbS5kYXRhKCJpdGVtLmF1dG9jb21wbGV0ZSIpO3ZhciBmPWEucHJldmlvdXM7aWYoYS5lbGVtZW50WzBdIT09Yi5hY3RpdmVFbGVtZW50KXthLmVsZW1lbnQuZm9jdXMoKTsKYS5wcmV2aW91cz1mfWlmKGZhbHNlIT09YS5fdHJpZ2dlcigic2VsZWN0IixjLHtpdGVtOmR9KSl7YS50ZXJtPWQudmFsdWU7YS5lbGVtZW50LnZhbChkLnZhbHVlKX1hLmNsb3NlKGMpO2Euc2VsZWN0ZWRJdGVtPWR9LGJsdXI6ZnVuY3Rpb24oKXthLm1lbnUuZWxlbWVudC5pcygiOnZpc2libGUiKSYmYS5lbGVtZW50LnZhbCgpIT09YS50ZXJtJiZhLmVsZW1lbnQudmFsKGEudGVybSl9fSkuekluZGV4KHRoaXMuZWxlbWVudC56SW5kZXgoKSsxKS5jc3Moe3RvcDowLGxlZnQ6MH0pLmhpZGUoKS5kYXRhKCJtZW51Iik7ZS5mbi5iZ2lmcmFtZSYmdGhpcy5tZW51LmVsZW1lbnQuYmdpZnJhbWUoKX0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktYXV0b2NvbXBsZXRlLWlucHV0IikucmVtb3ZlQXR0cigiYXV0b2NvbXBsZXRlIikucmVtb3ZlQXR0cigicm9sZSIpLnJlbW92ZUF0dHIoImFyaWEtYXV0b2NvbXBsZXRlIikucmVtb3ZlQXR0cigiYXJpYS1oYXNwb3B1cCIpOwp0aGlzLm1lbnUuZWxlbWVudC5yZW1vdmUoKTtlLldpZGdldC5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGEsYil7ZS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpO2E9PT0ic291cmNlIiYmdGhpcy5faW5pdFNvdXJjZSgpO2lmKGE9PT0iYXBwZW5kVG8iKXRoaXMubWVudS5lbGVtZW50LmFwcGVuZFRvKGUoYnx8ImJvZHkiLHRoaXMuZWxlbWVudFswXS5vd25lckRvY3VtZW50KVswXSl9LF9pbml0U291cmNlOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcyxiLGM7aWYoZS5pc0FycmF5KHRoaXMub3B0aW9ucy5zb3VyY2UpKXtiPXRoaXMub3B0aW9ucy5zb3VyY2U7dGhpcy5zb3VyY2U9ZnVuY3Rpb24oZCxmKXtmKGUudWkuYXV0b2NvbXBsZXRlLmZpbHRlcihiLGQudGVybSkpfX1lbHNlIGlmKHR5cGVvZiB0aGlzLm9wdGlvbnMuc291cmNlPT09InN0cmluZyIpe2M9dGhpcy5vcHRpb25zLnNvdXJjZTt0aGlzLnNvdXJjZT0KZnVuY3Rpb24oZCxmKXthLnhociYmYS54aHIuYWJvcnQoKTthLnhocj1lLmdldEpTT04oYyxkLGZ1bmN0aW9uKGcsaSxoKXtoPT09YS54aHImJmYoZyk7YS54aHI9bnVsbH0pfX1lbHNlIHRoaXMuc291cmNlPXRoaXMub3B0aW9ucy5zb3VyY2V9LHNlYXJjaDpmdW5jdGlvbihhLGIpe2E9YSE9bnVsbD9hOnRoaXMuZWxlbWVudC52YWwoKTt0aGlzLnRlcm09dGhpcy5lbGVtZW50LnZhbCgpO2lmKGEubGVuZ3RoPHRoaXMub3B0aW9ucy5taW5MZW5ndGgpcmV0dXJuIHRoaXMuY2xvc2UoYik7Y2xlYXJUaW1lb3V0KHRoaXMuY2xvc2luZyk7aWYodGhpcy5fdHJpZ2dlcigic2VhcmNoIikhPT1mYWxzZSlyZXR1cm4gdGhpcy5fc2VhcmNoKGEpfSxfc2VhcmNoOmZ1bmN0aW9uKGEpe3RoaXMuZWxlbWVudC5hZGRDbGFzcygidWktYXV0b2NvbXBsZXRlLWxvYWRpbmciKTt0aGlzLnNvdXJjZSh7dGVybTphfSx0aGlzLnJlc3BvbnNlKX0sX3Jlc3BvbnNlOmZ1bmN0aW9uKGEpe2lmKGEubGVuZ3RoKXthPQp0aGlzLl9ub3JtYWxpemUoYSk7dGhpcy5fc3VnZ2VzdChhKTt0aGlzLl90cmlnZ2VyKCJvcGVuIil9ZWxzZSB0aGlzLmNsb3NlKCk7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1hdXRvY29tcGxldGUtbG9hZGluZyIpfSxjbG9zZTpmdW5jdGlvbihhKXtjbGVhclRpbWVvdXQodGhpcy5jbG9zaW5nKTtpZih0aGlzLm1lbnUuZWxlbWVudC5pcygiOnZpc2libGUiKSl7dGhpcy5fdHJpZ2dlcigiY2xvc2UiLGEpO3RoaXMubWVudS5lbGVtZW50LmhpZGUoKTt0aGlzLm1lbnUuZGVhY3RpdmF0ZSgpfX0sX2NoYW5nZTpmdW5jdGlvbihhKXt0aGlzLnByZXZpb3VzIT09dGhpcy5lbGVtZW50LnZhbCgpJiZ0aGlzLl90cmlnZ2VyKCJjaGFuZ2UiLGEse2l0ZW06dGhpcy5zZWxlY3RlZEl0ZW19KX0sX25vcm1hbGl6ZTpmdW5jdGlvbihhKXtpZihhLmxlbmd0aCYmYVswXS5sYWJlbCYmYVswXS52YWx1ZSlyZXR1cm4gYTtyZXR1cm4gZS5tYXAoYSxmdW5jdGlvbihiKXtpZih0eXBlb2YgYj09PQoic3RyaW5nIilyZXR1cm57bGFiZWw6Yix2YWx1ZTpifTtyZXR1cm4gZS5leHRlbmQoe2xhYmVsOmIubGFiZWx8fGIudmFsdWUsdmFsdWU6Yi52YWx1ZXx8Yi5sYWJlbH0sYil9KX0sX3N1Z2dlc3Q6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5tZW51LmVsZW1lbnQuZW1wdHkoKS56SW5kZXgodGhpcy5lbGVtZW50LnpJbmRleCgpKzEpLGM7dGhpcy5fcmVuZGVyTWVudShiLGEpO3RoaXMubWVudS5kZWFjdGl2YXRlKCk7dGhpcy5tZW51LnJlZnJlc2goKTt0aGlzLm1lbnUuZWxlbWVudC5zaG93KCkucG9zaXRpb24oZS5leHRlbmQoe29mOnRoaXMuZWxlbWVudH0sdGhpcy5vcHRpb25zLnBvc2l0aW9uKSk7YT1iLndpZHRoKCIiKS5vdXRlcldpZHRoKCk7Yz10aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpO2Iub3V0ZXJXaWR0aChNYXRoLm1heChhLGMpKX0sX3JlbmRlck1lbnU6ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzO2UuZWFjaChiLGZ1bmN0aW9uKGQsZil7Yy5fcmVuZGVySXRlbShhLGYpfSl9LApfcmVuZGVySXRlbTpmdW5jdGlvbihhLGIpe3JldHVybiBlKCI8bGk+PC9saT4iKS5kYXRhKCJpdGVtLmF1dG9jb21wbGV0ZSIsYikuYXBwZW5kKGUoIjxhPjwvYT4iKS50ZXh0KGIubGFiZWwpKS5hcHBlbmRUbyhhKX0sX21vdmU6ZnVuY3Rpb24oYSxiKXtpZih0aGlzLm1lbnUuZWxlbWVudC5pcygiOnZpc2libGUiKSlpZih0aGlzLm1lbnUuZmlyc3QoKSYmL15wcmV2aW91cy8udGVzdChhKXx8dGhpcy5tZW51Lmxhc3QoKSYmL15uZXh0Ly50ZXN0KGEpKXt0aGlzLmVsZW1lbnQudmFsKHRoaXMudGVybSk7dGhpcy5tZW51LmRlYWN0aXZhdGUoKX1lbHNlIHRoaXMubWVudVthXShiKTtlbHNlIHRoaXMuc2VhcmNoKG51bGwsYil9LHdpZGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1lbnUuZWxlbWVudH19KTtlLmV4dGVuZChlLnVpLmF1dG9jb21wbGV0ZSx7ZXNjYXBlUmVnZXg6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSgvWy1bXF17fSgpKis/LixcXF4kfCNcc10vZywiXFwkJiIpfSwKZmlsdGVyOmZ1bmN0aW9uKGEsYil7dmFyIGM9bmV3IFJlZ0V4cChlLnVpLmF1dG9jb21wbGV0ZS5lc2NhcGVSZWdleChiKSwiaSIpO3JldHVybiBlLmdyZXAoYSxmdW5jdGlvbihkKXtyZXR1cm4gYy50ZXN0KGQubGFiZWx8fGQudmFsdWV8fGQpfSl9fSl9KShqUXVlcnkpOwooZnVuY3Rpb24oZSl7ZS53aWRnZXQoInVpLm1lbnUiLHtfY3JlYXRlOmZ1bmN0aW9uKCl7dmFyIGE9dGhpczt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLW1lbnUgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiKS5hdHRyKHtyb2xlOiJsaXN0Ym94IiwiYXJpYS1hY3RpdmVkZXNjZW5kYW50IjoidWktYWN0aXZlLW1lbnVpdGVtIn0pLmNsaWNrKGZ1bmN0aW9uKGIpe2lmKGUoYi50YXJnZXQpLmNsb3Nlc3QoIi51aS1tZW51LWl0ZW0gYSIpLmxlbmd0aCl7Yi5wcmV2ZW50RGVmYXVsdCgpO2Euc2VsZWN0KGIpfX0pO3RoaXMucmVmcmVzaCgpfSxyZWZyZXNoOmZ1bmN0aW9uKCl7dmFyIGE9dGhpczt0aGlzLmVsZW1lbnQuY2hpbGRyZW4oImxpOm5vdCgudWktbWVudS1pdGVtKTpoYXMoYSkiKS5hZGRDbGFzcygidWktbWVudS1pdGVtIikuYXR0cigicm9sZSIsIm1lbnVpdGVtIikuY2hpbGRyZW4oImEiKS5hZGRDbGFzcygidWktY29ybmVyLWFsbCIpLmF0dHIoInRhYmluZGV4IiwKLTEpLm1vdXNlZW50ZXIoZnVuY3Rpb24oYil7YS5hY3RpdmF0ZShiLGUodGhpcykucGFyZW50KCkpfSkubW91c2VsZWF2ZShmdW5jdGlvbigpe2EuZGVhY3RpdmF0ZSgpfSl9LGFjdGl2YXRlOmZ1bmN0aW9uKGEsYil7dGhpcy5kZWFjdGl2YXRlKCk7aWYodGhpcy5oYXNTY3JvbGwoKSl7dmFyIGM9Yi5vZmZzZXQoKS50b3AtdGhpcy5lbGVtZW50Lm9mZnNldCgpLnRvcCxkPXRoaXMuZWxlbWVudC5hdHRyKCJzY3JvbGxUb3AiKSxmPXRoaXMuZWxlbWVudC5oZWlnaHQoKTtpZihjPDApdGhpcy5lbGVtZW50LmF0dHIoInNjcm9sbFRvcCIsZCtjKTtlbHNlIGM+PWYmJnRoaXMuZWxlbWVudC5hdHRyKCJzY3JvbGxUb3AiLGQrYy1mK2IuaGVpZ2h0KCkpfXRoaXMuYWN0aXZlPWIuZXEoMCkuY2hpbGRyZW4oImEiKS5hZGRDbGFzcygidWktc3RhdGUtaG92ZXIiKS5hdHRyKCJpZCIsInVpLWFjdGl2ZS1tZW51aXRlbSIpLmVuZCgpO3RoaXMuX3RyaWdnZXIoImZvY3VzIixhLHtpdGVtOmJ9KX0sCmRlYWN0aXZhdGU6ZnVuY3Rpb24oKXtpZih0aGlzLmFjdGl2ZSl7dGhpcy5hY3RpdmUuY2hpbGRyZW4oImEiKS5yZW1vdmVDbGFzcygidWktc3RhdGUtaG92ZXIiKS5yZW1vdmVBdHRyKCJpZCIpO3RoaXMuX3RyaWdnZXIoImJsdXIiKTt0aGlzLmFjdGl2ZT1udWxsfX0sbmV4dDpmdW5jdGlvbihhKXt0aGlzLm1vdmUoIm5leHQiLCIudWktbWVudS1pdGVtOmZpcnN0IixhKX0scHJldmlvdXM6ZnVuY3Rpb24oYSl7dGhpcy5tb3ZlKCJwcmV2IiwiLnVpLW1lbnUtaXRlbTpsYXN0IixhKX0sZmlyc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hY3RpdmUmJiF0aGlzLmFjdGl2ZS5wcmV2QWxsKCIudWktbWVudS1pdGVtIikubGVuZ3RofSxsYXN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYWN0aXZlJiYhdGhpcy5hY3RpdmUubmV4dEFsbCgiLnVpLW1lbnUtaXRlbSIpLmxlbmd0aH0sbW92ZTpmdW5jdGlvbihhLGIsYyl7aWYodGhpcy5hY3RpdmUpe2E9dGhpcy5hY3RpdmVbYSsiQWxsIl0oIi51aS1tZW51LWl0ZW0iKS5lcSgwKTsKYS5sZW5ndGg/dGhpcy5hY3RpdmF0ZShjLGEpOnRoaXMuYWN0aXZhdGUoYyx0aGlzLmVsZW1lbnQuY2hpbGRyZW4oYikpfWVsc2UgdGhpcy5hY3RpdmF0ZShjLHRoaXMuZWxlbWVudC5jaGlsZHJlbihiKSl9LG5leHRQYWdlOmZ1bmN0aW9uKGEpe2lmKHRoaXMuaGFzU2Nyb2xsKCkpaWYoIXRoaXMuYWN0aXZlfHx0aGlzLmxhc3QoKSl0aGlzLmFjdGl2YXRlKGEsdGhpcy5lbGVtZW50LmNoaWxkcmVuKCI6Zmlyc3QiKSk7ZWxzZXt2YXIgYj10aGlzLmFjdGl2ZS5vZmZzZXQoKS50b3AsYz10aGlzLmVsZW1lbnQuaGVpZ2h0KCksZD10aGlzLmVsZW1lbnQuY2hpbGRyZW4oImxpIikuZmlsdGVyKGZ1bmN0aW9uKCl7dmFyIGY9ZSh0aGlzKS5vZmZzZXQoKS50b3AtYi1jK2UodGhpcykuaGVpZ2h0KCk7cmV0dXJuIGY8MTAmJmY+LTEwfSk7ZC5sZW5ndGh8fChkPXRoaXMuZWxlbWVudC5jaGlsZHJlbigiOmxhc3QiKSk7dGhpcy5hY3RpdmF0ZShhLGQpfWVsc2UgdGhpcy5hY3RpdmF0ZShhLHRoaXMuZWxlbWVudC5jaGlsZHJlbighdGhpcy5hY3RpdmV8fAp0aGlzLmxhc3QoKT8iOmZpcnN0IjoiOmxhc3QiKSl9LHByZXZpb3VzUGFnZTpmdW5jdGlvbihhKXtpZih0aGlzLmhhc1Njcm9sbCgpKWlmKCF0aGlzLmFjdGl2ZXx8dGhpcy5maXJzdCgpKXRoaXMuYWN0aXZhdGUoYSx0aGlzLmVsZW1lbnQuY2hpbGRyZW4oIjpsYXN0IikpO2Vsc2V7dmFyIGI9dGhpcy5hY3RpdmUub2Zmc2V0KCkudG9wLGM9dGhpcy5lbGVtZW50LmhlaWdodCgpO3Jlc3VsdD10aGlzLmVsZW1lbnQuY2hpbGRyZW4oImxpIikuZmlsdGVyKGZ1bmN0aW9uKCl7dmFyIGQ9ZSh0aGlzKS5vZmZzZXQoKS50b3AtYitjLWUodGhpcykuaGVpZ2h0KCk7cmV0dXJuIGQ8MTAmJmQ+LTEwfSk7cmVzdWx0Lmxlbmd0aHx8KHJlc3VsdD10aGlzLmVsZW1lbnQuY2hpbGRyZW4oIjpmaXJzdCIpKTt0aGlzLmFjdGl2YXRlKGEscmVzdWx0KX1lbHNlIHRoaXMuYWN0aXZhdGUoYSx0aGlzLmVsZW1lbnQuY2hpbGRyZW4oIXRoaXMuYWN0aXZlfHx0aGlzLmZpcnN0KCk/IjpsYXN0IjoiOmZpcnN0IikpfSwKaGFzU2Nyb2xsOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWxlbWVudC5oZWlnaHQoKTx0aGlzLmVsZW1lbnQuYXR0cigic2Nyb2xsSGVpZ2h0Iil9LHNlbGVjdDpmdW5jdGlvbihhKXt0aGlzLl90cmlnZ2VyKCJzZWxlY3RlZCIsYSx7aXRlbTp0aGlzLmFjdGl2ZX0pfX0pfSkoalF1ZXJ5KTsKKGZ1bmN0aW9uKGEpe3ZhciBnLGk9ZnVuY3Rpb24oYil7YSgiOnVpLWJ1dHRvbiIsYi50YXJnZXQuZm9ybSkuZWFjaChmdW5jdGlvbigpe3ZhciBjPWEodGhpcykuZGF0YSgiYnV0dG9uIik7c2V0VGltZW91dChmdW5jdGlvbigpe2MucmVmcmVzaCgpfSwxKX0pfSxoPWZ1bmN0aW9uKGIpe3ZhciBjPWIubmFtZSxkPWIuZm9ybSxlPWEoW10pO2lmKGMpZT1kP2EoZCkuZmluZCgiW25hbWU9JyIrYysiJ10iKTphKCJbbmFtZT0nIitjKyInXSIsYi5vd25lckRvY3VtZW50KS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5mb3JtfSk7cmV0dXJuIGV9O2Eud2lkZ2V0KCJ1aS5idXR0b24iLHtvcHRpb25zOntkaXNhYmxlZDpudWxsLHRleHQ6dHJ1ZSxsYWJlbDpudWxsLGljb25zOntwcmltYXJ5Om51bGwsc2Vjb25kYXJ5Om51bGx9fSxfY3JlYXRlOmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LmNsb3Nlc3QoImZvcm0iKS51bmJpbmQoInJlc2V0LmJ1dHRvbiIpLmJpbmQoInJlc2V0LmJ1dHRvbiIsCmkpO2lmKHR5cGVvZiB0aGlzLm9wdGlvbnMuZGlzYWJsZWQhPT0iYm9vbGVhbiIpdGhpcy5vcHRpb25zLmRpc2FibGVkPXRoaXMuZWxlbWVudC5hdHRyKCJkaXNhYmxlZCIpO3RoaXMuX2RldGVybWluZUJ1dHRvblR5cGUoKTt0aGlzLmhhc1RpdGxlPSEhdGhpcy5idXR0b25FbGVtZW50LmF0dHIoInRpdGxlIik7dmFyIGI9dGhpcyxjPXRoaXMub3B0aW9ucyxkPXRoaXMudHlwZT09PSJjaGVja2JveCJ8fHRoaXMudHlwZT09PSJyYWRpbyIsZT0idWktc3RhdGUtaG92ZXIiKyghZD8iIHVpLXN0YXRlLWFjdGl2ZSI6IiIpO2lmKGMubGFiZWw9PT1udWxsKWMubGFiZWw9dGhpcy5idXR0b25FbGVtZW50Lmh0bWwoKTtpZih0aGlzLmVsZW1lbnQuaXMoIjpkaXNhYmxlZCIpKWMuZGlzYWJsZWQ9dHJ1ZTt0aGlzLmJ1dHRvbkVsZW1lbnQuYWRkQ2xhc3MoInVpLWJ1dHRvbiB1aS13aWRnZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsIikuYXR0cigicm9sZSIsImJ1dHRvbiIpLmJpbmQoIm1vdXNlZW50ZXIuYnV0dG9uIiwKZnVuY3Rpb24oKXtpZighYy5kaXNhYmxlZCl7YSh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtaG92ZXIiKTt0aGlzPT09ZyYmYSh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIil9fSkuYmluZCgibW91c2VsZWF2ZS5idXR0b24iLGZ1bmN0aW9uKCl7Yy5kaXNhYmxlZHx8YSh0aGlzKS5yZW1vdmVDbGFzcyhlKX0pLmJpbmQoImZvY3VzLmJ1dHRvbiIsZnVuY3Rpb24oKXthKHRoaXMpLmFkZENsYXNzKCJ1aS1zdGF0ZS1mb2N1cyIpfSkuYmluZCgiYmx1ci5idXR0b24iLGZ1bmN0aW9uKCl7YSh0aGlzKS5yZW1vdmVDbGFzcygidWktc3RhdGUtZm9jdXMiKX0pO2QmJnRoaXMuZWxlbWVudC5iaW5kKCJjaGFuZ2UuYnV0dG9uIixmdW5jdGlvbigpe2IucmVmcmVzaCgpfSk7aWYodGhpcy50eXBlPT09ImNoZWNrYm94Iil0aGlzLmJ1dHRvbkVsZW1lbnQuYmluZCgiY2xpY2suYnV0dG9uIixmdW5jdGlvbigpe2lmKGMuZGlzYWJsZWQpcmV0dXJuIGZhbHNlO2EodGhpcykudG9nZ2xlQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpOwpiLmJ1dHRvbkVsZW1lbnQuYXR0cigiYXJpYS1wcmVzc2VkIixiLmVsZW1lbnRbMF0uY2hlY2tlZCl9KTtlbHNlIGlmKHRoaXMudHlwZT09PSJyYWRpbyIpdGhpcy5idXR0b25FbGVtZW50LmJpbmQoImNsaWNrLmJ1dHRvbiIsZnVuY3Rpb24oKXtpZihjLmRpc2FibGVkKXJldHVybiBmYWxzZTthKHRoaXMpLmFkZENsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKTtiLmJ1dHRvbkVsZW1lbnQuYXR0cigiYXJpYS1wcmVzc2VkIix0cnVlKTt2YXIgZj1iLmVsZW1lbnRbMF07aChmKS5ub3QoZikubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIGEodGhpcykuYnV0dG9uKCJ3aWRnZXQiKVswXX0pLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKS5hdHRyKCJhcmlhLXByZXNzZWQiLGZhbHNlKX0pO2Vsc2V7dGhpcy5idXR0b25FbGVtZW50LmJpbmQoIm1vdXNlZG93bi5idXR0b24iLGZ1bmN0aW9uKCl7aWYoYy5kaXNhYmxlZClyZXR1cm4gZmFsc2U7YSh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIik7Cmc9dGhpczthKGRvY3VtZW50KS5vbmUoIm1vdXNldXAiLGZ1bmN0aW9uKCl7Zz1udWxsfSl9KS5iaW5kKCJtb3VzZXVwLmJ1dHRvbiIsZnVuY3Rpb24oKXtpZihjLmRpc2FibGVkKXJldHVybiBmYWxzZTthKHRoaXMpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKX0pLmJpbmQoImtleWRvd24uYnV0dG9uIixmdW5jdGlvbihmKXtpZihjLmRpc2FibGVkKXJldHVybiBmYWxzZTtpZihmLmtleUNvZGU9PWEudWkua2V5Q29kZS5TUEFDRXx8Zi5rZXlDb2RlPT1hLnVpLmtleUNvZGUuRU5URVIpYSh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIil9KS5iaW5kKCJrZXl1cC5idXR0b24iLGZ1bmN0aW9uKCl7YSh0aGlzKS5yZW1vdmVDbGFzcygidWktc3RhdGUtYWN0aXZlIil9KTt0aGlzLmJ1dHRvbkVsZW1lbnQuaXMoImEiKSYmdGhpcy5idXR0b25FbGVtZW50LmtleXVwKGZ1bmN0aW9uKGYpe2Yua2V5Q29kZT09PWEudWkua2V5Q29kZS5TUEFDRSYmYSh0aGlzKS5jbGljaygpfSl9dGhpcy5fc2V0T3B0aW9uKCJkaXNhYmxlZCIsCmMuZGlzYWJsZWQpfSxfZGV0ZXJtaW5lQnV0dG9uVHlwZTpmdW5jdGlvbigpe3RoaXMudHlwZT10aGlzLmVsZW1lbnQuaXMoIjpjaGVja2JveCIpPyJjaGVja2JveCI6dGhpcy5lbGVtZW50LmlzKCI6cmFkaW8iKT8icmFkaW8iOnRoaXMuZWxlbWVudC5pcygiaW5wdXQiKT8iaW5wdXQiOiJidXR0b24iO2lmKHRoaXMudHlwZT09PSJjaGVja2JveCJ8fHRoaXMudHlwZT09PSJyYWRpbyIpe3RoaXMuYnV0dG9uRWxlbWVudD10aGlzLmVsZW1lbnQucGFyZW50cygpLmxhc3QoKS5maW5kKCJsYWJlbFtmb3I9Iit0aGlzLmVsZW1lbnQuYXR0cigiaWQiKSsiXSIpO3RoaXMuZWxlbWVudC5hZGRDbGFzcygidWktaGVscGVyLWhpZGRlbi1hY2Nlc3NpYmxlIik7dmFyIGI9dGhpcy5lbGVtZW50LmlzKCI6Y2hlY2tlZCIpO2ImJnRoaXMuYnV0dG9uRWxlbWVudC5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIik7dGhpcy5idXR0b25FbGVtZW50LmF0dHIoImFyaWEtcHJlc3NlZCIsYil9ZWxzZSB0aGlzLmJ1dHRvbkVsZW1lbnQ9CnRoaXMuZWxlbWVudH0sd2lkZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYnV0dG9uRWxlbWVudH0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktaGVscGVyLWhpZGRlbi1hY2Nlc3NpYmxlIik7dGhpcy5idXR0b25FbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1idXR0b24gdWktd2lkZ2V0IHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1ob3ZlciB1aS1zdGF0ZS1hY3RpdmUgIHVpLWJ1dHRvbi1pY29ucy1vbmx5IHVpLWJ1dHRvbi1pY29uLW9ubHkgdWktYnV0dG9uLXRleHQtaWNvbnMgdWktYnV0dG9uLXRleHQtaWNvbi1wcmltYXJ5IHVpLWJ1dHRvbi10ZXh0LWljb24tc2Vjb25kYXJ5IHVpLWJ1dHRvbi10ZXh0LW9ubHkiKS5yZW1vdmVBdHRyKCJyb2xlIikucmVtb3ZlQXR0cigiYXJpYS1wcmVzc2VkIikuaHRtbCh0aGlzLmJ1dHRvbkVsZW1lbnQuZmluZCgiLnVpLWJ1dHRvbi10ZXh0IikuaHRtbCgpKTt0aGlzLmhhc1RpdGxlfHwKdGhpcy5idXR0b25FbGVtZW50LnJlbW92ZUF0dHIoInRpdGxlIik7YS5XaWRnZXQucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKX0sX3NldE9wdGlvbjpmdW5jdGlvbihiLGMpe2EuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtpZihiPT09ImRpc2FibGVkIiljP3RoaXMuZWxlbWVudC5hdHRyKCJkaXNhYmxlZCIsdHJ1ZSk6dGhpcy5lbGVtZW50LnJlbW92ZUF0dHIoImRpc2FibGVkIik7dGhpcy5fcmVzZXRCdXR0b24oKX0scmVmcmVzaDpmdW5jdGlvbigpe3ZhciBiPXRoaXMuZWxlbWVudC5pcygiOmRpc2FibGVkIik7YiE9PXRoaXMub3B0aW9ucy5kaXNhYmxlZCYmdGhpcy5fc2V0T3B0aW9uKCJkaXNhYmxlZCIsYik7aWYodGhpcy50eXBlPT09InJhZGlvIiloKHRoaXMuZWxlbWVudFswXSkuZWFjaChmdW5jdGlvbigpe2EodGhpcykuaXMoIjpjaGVja2VkIik/YSh0aGlzKS5idXR0b24oIndpZGdldCIpLmFkZENsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKS5hdHRyKCJhcmlhLXByZXNzZWQiLAp0cnVlKTphKHRoaXMpLmJ1dHRvbigid2lkZ2V0IikucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpLmF0dHIoImFyaWEtcHJlc3NlZCIsZmFsc2UpfSk7ZWxzZSBpZih0aGlzLnR5cGU9PT0iY2hlY2tib3giKXRoaXMuZWxlbWVudC5pcygiOmNoZWNrZWQiKT90aGlzLmJ1dHRvbkVsZW1lbnQuYWRkQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpLmF0dHIoImFyaWEtcHJlc3NlZCIsdHJ1ZSk6dGhpcy5idXR0b25FbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKS5hdHRyKCJhcmlhLXByZXNzZWQiLGZhbHNlKX0sX3Jlc2V0QnV0dG9uOmZ1bmN0aW9uKCl7aWYodGhpcy50eXBlPT09ImlucHV0Iil0aGlzLm9wdGlvbnMubGFiZWwmJnRoaXMuZWxlbWVudC52YWwodGhpcy5vcHRpb25zLmxhYmVsKTtlbHNle3ZhciBiPXRoaXMuYnV0dG9uRWxlbWVudC5yZW1vdmVDbGFzcygidWktYnV0dG9uLWljb25zLW9ubHkgdWktYnV0dG9uLWljb24tb25seSB1aS1idXR0b24tdGV4dC1pY29ucyB1aS1idXR0b24tdGV4dC1pY29uLXByaW1hcnkgdWktYnV0dG9uLXRleHQtaWNvbi1zZWNvbmRhcnkgdWktYnV0dG9uLXRleHQtb25seSIpLApjPWEoIjxzcGFuPjwvc3Bhbj4iKS5hZGRDbGFzcygidWktYnV0dG9uLXRleHQiKS5odG1sKHRoaXMub3B0aW9ucy5sYWJlbCkuYXBwZW5kVG8oYi5lbXB0eSgpKS50ZXh0KCksZD10aGlzLm9wdGlvbnMuaWNvbnMsZT1kLnByaW1hcnkmJmQuc2Vjb25kYXJ5O2lmKGQucHJpbWFyeXx8ZC5zZWNvbmRhcnkpe2IuYWRkQ2xhc3MoInVpLWJ1dHRvbi10ZXh0LWljb24iKyhlPyJzIjpkLnByaW1hcnk/Ii1wcmltYXJ5IjoiLXNlY29uZGFyeSIpKTtkLnByaW1hcnkmJmIucHJlcGVuZCgiPHNwYW4gY2xhc3M9J3VpLWJ1dHRvbi1pY29uLXByaW1hcnkgdWktaWNvbiAiK2QucHJpbWFyeSsiJz48L3NwYW4+Iik7ZC5zZWNvbmRhcnkmJmIuYXBwZW5kKCI8c3BhbiBjbGFzcz0ndWktYnV0dG9uLWljb24tc2Vjb25kYXJ5IHVpLWljb24gIitkLnNlY29uZGFyeSsiJz48L3NwYW4+Iik7aWYoIXRoaXMub3B0aW9ucy50ZXh0KXtiLmFkZENsYXNzKGU/InVpLWJ1dHRvbi1pY29ucy1vbmx5IjoidWktYnV0dG9uLWljb24tb25seSIpLnJlbW92ZUNsYXNzKCJ1aS1idXR0b24tdGV4dC1pY29ucyB1aS1idXR0b24tdGV4dC1pY29uLXByaW1hcnkgdWktYnV0dG9uLXRleHQtaWNvbi1zZWNvbmRhcnkiKTsKdGhpcy5oYXNUaXRsZXx8Yi5hdHRyKCJ0aXRsZSIsYyl9fWVsc2UgYi5hZGRDbGFzcygidWktYnV0dG9uLXRleHQtb25seSIpfX19KTthLndpZGdldCgidWkuYnV0dG9uc2V0Iix7X2NyZWF0ZTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5hZGRDbGFzcygidWktYnV0dG9uc2V0Iik7dGhpcy5faW5pdCgpfSxfaW5pdDpmdW5jdGlvbigpe3RoaXMucmVmcmVzaCgpfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGIsYyl7Yj09PSJkaXNhYmxlZCImJnRoaXMuYnV0dG9ucy5idXR0b24oIm9wdGlvbiIsYixjKTthLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHJlZnJlc2g6ZnVuY3Rpb24oKXt0aGlzLmJ1dHRvbnM9dGhpcy5lbGVtZW50LmZpbmQoIjpidXR0b24sIDpzdWJtaXQsIDpyZXNldCwgOmNoZWNrYm94LCA6cmFkaW8sIGEsIDpkYXRhKGJ1dHRvbikiKS5maWx0ZXIoIjp1aS1idXR0b24iKS5idXR0b24oInJlZnJlc2giKS5lbmQoKS5ub3QoIjp1aS1idXR0b24iKS5idXR0b24oKS5lbmQoKS5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gYSh0aGlzKS5idXR0b24oIndpZGdldCIpWzBdfSkucmVtb3ZlQ2xhc3MoInVpLWNvcm5lci1hbGwgdWktY29ybmVyLWxlZnQgdWktY29ybmVyLXJpZ2h0IikuZmlsdGVyKCI6dmlzaWJsZSIpLmZpbHRlcigiOmZpcnN0IikuYWRkQ2xhc3MoInVpLWNvcm5lci1sZWZ0IikuZW5kKCkuZmlsdGVyKCI6bGFzdCIpLmFkZENsYXNzKCJ1aS1jb3JuZXItcmlnaHQiKS5lbmQoKS5lbmQoKS5lbmQoKX0sCmRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLWJ1dHRvbnNldCIpO3RoaXMuYnV0dG9ucy5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gYSh0aGlzKS5idXR0b24oIndpZGdldCIpWzBdfSkucmVtb3ZlQ2xhc3MoInVpLWNvcm5lci1sZWZ0IHVpLWNvcm5lci1yaWdodCIpLmVuZCgpLmJ1dHRvbigiZGVzdHJveSIpO2EuV2lkZ2V0LnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyl9fSl9KShqUXVlcnkpOwooZnVuY3Rpb24oZCxHKXtmdW5jdGlvbiBMKCl7dGhpcy5kZWJ1Zz1mYWxzZTt0aGlzLl9jdXJJbnN0PW51bGw7dGhpcy5fa2V5RXZlbnQ9ZmFsc2U7dGhpcy5fZGlzYWJsZWRJbnB1dHM9W107dGhpcy5faW5EaWFsb2c9dGhpcy5fZGF0ZXBpY2tlclNob3dpbmc9ZmFsc2U7dGhpcy5fbWFpbkRpdklkPSJ1aS1kYXRlcGlja2VyLWRpdiI7dGhpcy5faW5saW5lQ2xhc3M9InVpLWRhdGVwaWNrZXItaW5saW5lIjt0aGlzLl9hcHBlbmRDbGFzcz0idWktZGF0ZXBpY2tlci1hcHBlbmQiO3RoaXMuX3RyaWdnZXJDbGFzcz0idWktZGF0ZXBpY2tlci10cmlnZ2VyIjt0aGlzLl9kaWFsb2dDbGFzcz0idWktZGF0ZXBpY2tlci1kaWFsb2ciO3RoaXMuX2Rpc2FibGVDbGFzcz0idWktZGF0ZXBpY2tlci1kaXNhYmxlZCI7dGhpcy5fdW5zZWxlY3RhYmxlQ2xhc3M9InVpLWRhdGVwaWNrZXItdW5zZWxlY3RhYmxlIjt0aGlzLl9jdXJyZW50Q2xhc3M9InVpLWRhdGVwaWNrZXItY3VycmVudC1kYXkiO3RoaXMuX2RheU92ZXJDbGFzcz0KInVpLWRhdGVwaWNrZXItZGF5cy1jZWxsLW92ZXIiO3RoaXMucmVnaW9uYWw9W107dGhpcy5yZWdpb25hbFsiIl09e2Nsb3NlVGV4dDoiRG9uZSIscHJldlRleHQ6IlByZXYiLG5leHRUZXh0OiJOZXh0IixjdXJyZW50VGV4dDoiVG9kYXkiLG1vbnRoTmFtZXM6WyJKYW51YXJ5IiwiRmVicnVhcnkiLCJNYXJjaCIsIkFwcmlsIiwiTWF5IiwiSnVuZSIsIkp1bHkiLCJBdWd1c3QiLCJTZXB0ZW1iZXIiLCJPY3RvYmVyIiwiTm92ZW1iZXIiLCJEZWNlbWJlciJdLG1vbnRoTmFtZXNTaG9ydDpbIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdLGRheU5hbWVzOlsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXSxkYXlOYW1lc1Nob3J0OlsiU3VuIiwiTW9uIiwiVHVlIiwiV2VkIiwiVGh1IiwiRnJpIiwiU2F0Il0sZGF5TmFtZXNNaW46WyJTdSIsCiJNbyIsIlR1IiwiV2UiLCJUaCIsIkZyIiwiU2EiXSx3ZWVrSGVhZGVyOiJXayIsZGF0ZUZvcm1hdDoibW0vZGQveXkiLGZpcnN0RGF5OjAsaXNSVEw6ZmFsc2Usc2hvd01vbnRoQWZ0ZXJZZWFyOmZhbHNlLHllYXJTdWZmaXg6IiJ9O3RoaXMuX2RlZmF1bHRzPXtzaG93T246ImZvY3VzIixzaG93QW5pbToiZmFkZUluIixzaG93T3B0aW9uczp7fSxkZWZhdWx0RGF0ZTpudWxsLGFwcGVuZFRleHQ6IiIsYnV0dG9uVGV4dDoiLi4uIixidXR0b25JbWFnZToiIixidXR0b25JbWFnZU9ubHk6ZmFsc2UsaGlkZUlmTm9QcmV2TmV4dDpmYWxzZSxuYXZpZ2F0aW9uQXNEYXRlRm9ybWF0OmZhbHNlLGdvdG9DdXJyZW50OmZhbHNlLGNoYW5nZU1vbnRoOmZhbHNlLGNoYW5nZVllYXI6ZmFsc2UseWVhclJhbmdlOiJjLTEwOmMrMTAiLHNob3dPdGhlck1vbnRoczpmYWxzZSxzZWxlY3RPdGhlck1vbnRoczpmYWxzZSxzaG93V2VlazpmYWxzZSxjYWxjdWxhdGVXZWVrOnRoaXMuaXNvODYwMVdlZWssc2hvcnRZZWFyQ3V0b2ZmOiIrMTAiLAptaW5EYXRlOm51bGwsbWF4RGF0ZTpudWxsLGR1cmF0aW9uOiJmYXN0IixiZWZvcmVTaG93RGF5Om51bGwsYmVmb3JlU2hvdzpudWxsLG9uU2VsZWN0Om51bGwsb25DaGFuZ2VNb250aFllYXI6bnVsbCxvbkNsb3NlOm51bGwsbnVtYmVyT2ZNb250aHM6MSxzaG93Q3VycmVudEF0UG9zOjAsc3RlcE1vbnRoczoxLHN0ZXBCaWdNb250aHM6MTIsYWx0RmllbGQ6IiIsYWx0Rm9ybWF0OiIiLGNvbnN0cmFpbklucHV0OnRydWUsc2hvd0J1dHRvblBhbmVsOmZhbHNlLGF1dG9TaXplOmZhbHNlfTtkLmV4dGVuZCh0aGlzLl9kZWZhdWx0cyx0aGlzLnJlZ2lvbmFsWyIiXSk7dGhpcy5kcERpdj1kKCc8ZGl2IGlkPSInK3RoaXMuX21haW5EaXZJZCsnIiBjbGFzcz0idWktZGF0ZXBpY2tlciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktaGVscGVyLWNsZWFyZml4IHVpLWNvcm5lci1hbGwgdWktaGVscGVyLWhpZGRlbi1hY2Nlc3NpYmxlIj48L2Rpdj4nKX1mdW5jdGlvbiBFKGEsYil7ZC5leHRlbmQoYSwKYik7Zm9yKHZhciBjIGluIGIpaWYoYltjXT09bnVsbHx8YltjXT09RylhW2NdPWJbY107cmV0dXJuIGF9ZC5leHRlbmQoZC51aSx7ZGF0ZXBpY2tlcjp7dmVyc2lvbjoiMS44LjUifX0pO3ZhciB5PShuZXcgRGF0ZSkuZ2V0VGltZSgpO2QuZXh0ZW5kKEwucHJvdG90eXBlLHttYXJrZXJDbGFzc05hbWU6Imhhc0RhdGVwaWNrZXIiLGxvZzpmdW5jdGlvbigpe3RoaXMuZGVidWcmJmNvbnNvbGUubG9nLmFwcGx5KCIiLGFyZ3VtZW50cyl9LF93aWRnZXREYXRlcGlja2VyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZHBEaXZ9LHNldERlZmF1bHRzOmZ1bmN0aW9uKGEpe0UodGhpcy5fZGVmYXVsdHMsYXx8e30pO3JldHVybiB0aGlzfSxfYXR0YWNoRGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIpe3ZhciBjPW51bGw7Zm9yKHZhciBlIGluIHRoaXMuX2RlZmF1bHRzKXt2YXIgZj1hLmdldEF0dHJpYnV0ZSgiZGF0ZToiK2UpO2lmKGYpe2M9Y3x8e307dHJ5e2NbZV09ZXZhbChmKX1jYXRjaChoKXtjW2VdPQpmfX19ZT1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7Zj1lPT0iZGl2Inx8ZT09InNwYW4iO2lmKCFhLmlkKXt0aGlzLnV1aWQrPTE7YS5pZD0iZHAiK3RoaXMudXVpZH12YXIgaT10aGlzLl9uZXdJbnN0KGQoYSksZik7aS5zZXR0aW5ncz1kLmV4dGVuZCh7fSxifHx7fSxjfHx7fSk7aWYoZT09ImlucHV0Iil0aGlzLl9jb25uZWN0RGF0ZXBpY2tlcihhLGkpO2Vsc2UgZiYmdGhpcy5faW5saW5lRGF0ZXBpY2tlcihhLGkpfSxfbmV3SW5zdDpmdW5jdGlvbihhLGIpe3JldHVybntpZDphWzBdLmlkLnJlcGxhY2UoLyhbXkEtWmEtejAtOV9dKS9nLCJcXFxcJDEiKSxpbnB1dDphLHNlbGVjdGVkRGF5OjAsc2VsZWN0ZWRNb250aDowLHNlbGVjdGVkWWVhcjowLGRyYXdNb250aDowLGRyYXdZZWFyOjAsaW5saW5lOmIsZHBEaXY6IWI/dGhpcy5kcERpdjpkKCc8ZGl2IGNsYXNzPSInK3RoaXMuX2lubGluZUNsYXNzKycgdWktZGF0ZXBpY2tlciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktaGVscGVyLWNsZWFyZml4IHVpLWNvcm5lci1hbGwiPjwvZGl2PicpfX0sCl9jb25uZWN0RGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIpe3ZhciBjPWQoYSk7Yi5hcHBlbmQ9ZChbXSk7Yi50cmlnZ2VyPWQoW10pO2lmKCFjLmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSl7dGhpcy5fYXR0YWNobWVudHMoYyxiKTtjLmFkZENsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS5rZXlkb3duKHRoaXMuX2RvS2V5RG93bikua2V5cHJlc3ModGhpcy5fZG9LZXlQcmVzcykua2V5dXAodGhpcy5fZG9LZXlVcCkuYmluZCgic2V0RGF0YS5kYXRlcGlja2VyIixmdW5jdGlvbihlLGYsaCl7Yi5zZXR0aW5nc1tmXT1ofSkuYmluZCgiZ2V0RGF0YS5kYXRlcGlja2VyIixmdW5jdGlvbihlLGYpe3JldHVybiB0aGlzLl9nZXQoYixmKX0pO3RoaXMuX2F1dG9TaXplKGIpO2QuZGF0YShhLCJkYXRlcGlja2VyIixiKX19LF9hdHRhY2htZW50czpmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuX2dldChiLCJhcHBlbmRUZXh0IiksZT10aGlzLl9nZXQoYiwiaXNSVEwiKTtiLmFwcGVuZCYmCmIuYXBwZW5kLnJlbW92ZSgpO2lmKGMpe2IuYXBwZW5kPWQoJzxzcGFuIGNsYXNzPSInK3RoaXMuX2FwcGVuZENsYXNzKyciPicrYysiPC9zcGFuPiIpO2FbZT8iYmVmb3JlIjoiYWZ0ZXIiXShiLmFwcGVuZCl9YS51bmJpbmQoImZvY3VzIix0aGlzLl9zaG93RGF0ZXBpY2tlcik7Yi50cmlnZ2VyJiZiLnRyaWdnZXIucmVtb3ZlKCk7Yz10aGlzLl9nZXQoYiwic2hvd09uIik7aWYoYz09ImZvY3VzInx8Yz09ImJvdGgiKWEuZm9jdXModGhpcy5fc2hvd0RhdGVwaWNrZXIpO2lmKGM9PSJidXR0b24ifHxjPT0iYm90aCIpe2M9dGhpcy5fZ2V0KGIsImJ1dHRvblRleHQiKTt2YXIgZj10aGlzLl9nZXQoYiwiYnV0dG9uSW1hZ2UiKTtiLnRyaWdnZXI9ZCh0aGlzLl9nZXQoYiwiYnV0dG9uSW1hZ2VPbmx5Iik/ZCgiPGltZy8+IikuYWRkQ2xhc3ModGhpcy5fdHJpZ2dlckNsYXNzKS5hdHRyKHtzcmM6ZixhbHQ6Yyx0aXRsZTpjfSk6ZCgnPGJ1dHRvbiB0eXBlPSJidXR0b24iPjwvYnV0dG9uPicpLmFkZENsYXNzKHRoaXMuX3RyaWdnZXJDbGFzcykuaHRtbChmPT0KIiI/YzpkKCI8aW1nLz4iKS5hdHRyKHtzcmM6ZixhbHQ6Yyx0aXRsZTpjfSkpKTthW2U/ImJlZm9yZSI6ImFmdGVyIl0oYi50cmlnZ2VyKTtiLnRyaWdnZXIuY2xpY2soZnVuY3Rpb24oKXtkLmRhdGVwaWNrZXIuX2RhdGVwaWNrZXJTaG93aW5nJiZkLmRhdGVwaWNrZXIuX2xhc3RJbnB1dD09YVswXT9kLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk6ZC5kYXRlcGlja2VyLl9zaG93RGF0ZXBpY2tlcihhWzBdKTtyZXR1cm4gZmFsc2V9KX19LF9hdXRvU2l6ZTpmdW5jdGlvbihhKXtpZih0aGlzLl9nZXQoYSwiYXV0b1NpemUiKSYmIWEuaW5saW5lKXt2YXIgYj1uZXcgRGF0ZSgyMDA5LDExLDIwKSxjPXRoaXMuX2dldChhLCJkYXRlRm9ybWF0Iik7aWYoYy5tYXRjaCgvW0RNXS8pKXt2YXIgZT1mdW5jdGlvbihmKXtmb3IodmFyIGg9MCxpPTAsZz0wO2c8Zi5sZW5ndGg7ZysrKWlmKGZbZ10ubGVuZ3RoPmgpe2g9ZltnXS5sZW5ndGg7aT1nfXJldHVybiBpfTtiLnNldE1vbnRoKGUodGhpcy5fZ2V0KGEsCmMubWF0Y2goL01NLyk/Im1vbnRoTmFtZXMiOiJtb250aE5hbWVzU2hvcnQiKSkpO2Iuc2V0RGF0ZShlKHRoaXMuX2dldChhLGMubWF0Y2goL0RELyk/ImRheU5hbWVzIjoiZGF5TmFtZXNTaG9ydCIpKSsyMC1iLmdldERheSgpKX1hLmlucHV0LmF0dHIoInNpemUiLHRoaXMuX2Zvcm1hdERhdGUoYSxiKS5sZW5ndGgpfX0sX2lubGluZURhdGVwaWNrZXI6ZnVuY3Rpb24oYSxiKXt2YXIgYz1kKGEpO2lmKCFjLmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSl7Yy5hZGRDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkuYXBwZW5kKGIuZHBEaXYpLmJpbmQoInNldERhdGEuZGF0ZXBpY2tlciIsZnVuY3Rpb24oZSxmLGgpe2Iuc2V0dGluZ3NbZl09aH0pLmJpbmQoImdldERhdGEuZGF0ZXBpY2tlciIsZnVuY3Rpb24oZSxmKXtyZXR1cm4gdGhpcy5fZ2V0KGIsZil9KTtkLmRhdGEoYSwiZGF0ZXBpY2tlciIsYik7dGhpcy5fc2V0RGF0ZShiLHRoaXMuX2dldERlZmF1bHREYXRlKGIpLAp0cnVlKTt0aGlzLl91cGRhdGVEYXRlcGlja2VyKGIpO3RoaXMuX3VwZGF0ZUFsdGVybmF0ZShiKX19LF9kaWFsb2dEYXRlcGlja2VyOmZ1bmN0aW9uKGEsYixjLGUsZil7YT10aGlzLl9kaWFsb2dJbnN0O2lmKCFhKXt0aGlzLnV1aWQrPTE7dGhpcy5fZGlhbG9nSW5wdXQ9ZCgnPGlucHV0IHR5cGU9InRleHQiIGlkPSInKygiZHAiK3RoaXMudXVpZCkrJyIgc3R5bGU9InBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAtMTAwcHg7IHdpZHRoOiAwcHg7IHotaW5kZXg6IC0xMDsiLz4nKTt0aGlzLl9kaWFsb2dJbnB1dC5rZXlkb3duKHRoaXMuX2RvS2V5RG93bik7ZCgiYm9keSIpLmFwcGVuZCh0aGlzLl9kaWFsb2dJbnB1dCk7YT10aGlzLl9kaWFsb2dJbnN0PXRoaXMuX25ld0luc3QodGhpcy5fZGlhbG9nSW5wdXQsZmFsc2UpO2Euc2V0dGluZ3M9e307ZC5kYXRhKHRoaXMuX2RpYWxvZ0lucHV0WzBdLCJkYXRlcGlja2VyIixhKX1FKGEuc2V0dGluZ3MsZXx8e30pO2I9YiYmYi5jb25zdHJ1Y3Rvcj09CkRhdGU/dGhpcy5fZm9ybWF0RGF0ZShhLGIpOmI7dGhpcy5fZGlhbG9nSW5wdXQudmFsKGIpO3RoaXMuX3Bvcz1mP2YubGVuZ3RoP2Y6W2YucGFnZVgsZi5wYWdlWV06bnVsbDtpZighdGhpcy5fcG9zKXRoaXMuX3Bvcz1bZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoLzItMTAwKyhkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdHx8ZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0KSxkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LzItMTUwKyhkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wfHxkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCldO3RoaXMuX2RpYWxvZ0lucHV0LmNzcygibGVmdCIsdGhpcy5fcG9zWzBdKzIwKyJweCIpLmNzcygidG9wIix0aGlzLl9wb3NbMV0rInB4Iik7YS5zZXR0aW5ncy5vblNlbGVjdD1jO3RoaXMuX2luRGlhbG9nPXRydWU7dGhpcy5kcERpdi5hZGRDbGFzcyh0aGlzLl9kaWFsb2dDbGFzcyk7dGhpcy5fc2hvd0RhdGVwaWNrZXIodGhpcy5fZGlhbG9nSW5wdXRbMF0pOwpkLmJsb2NrVUkmJmQuYmxvY2tVSSh0aGlzLmRwRGl2KTtkLmRhdGEodGhpcy5fZGlhbG9nSW5wdXRbMF0sImRhdGVwaWNrZXIiLGEpO3JldHVybiB0aGlzfSxfZGVzdHJveURhdGVwaWNrZXI6ZnVuY3Rpb24oYSl7dmFyIGI9ZChhKSxjPWQuZGF0YShhLCJkYXRlcGlja2VyIik7aWYoYi5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpe3ZhciBlPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtkLnJlbW92ZURhdGEoYSwiZGF0ZXBpY2tlciIpO2lmKGU9PSJpbnB1dCIpe2MuYXBwZW5kLnJlbW92ZSgpO2MudHJpZ2dlci5yZW1vdmUoKTtiLnJlbW92ZUNsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS51bmJpbmQoImZvY3VzIix0aGlzLl9zaG93RGF0ZXBpY2tlcikudW5iaW5kKCJrZXlkb3duIix0aGlzLl9kb0tleURvd24pLnVuYmluZCgia2V5cHJlc3MiLHRoaXMuX2RvS2V5UHJlc3MpLnVuYmluZCgia2V5dXAiLHRoaXMuX2RvS2V5VXApfWVsc2UgaWYoZT09ImRpdiJ8fGU9PSJzcGFuIiliLnJlbW92ZUNsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS5lbXB0eSgpfX0sCl9lbmFibGVEYXRlcGlja2VyOmZ1bmN0aW9uKGEpe3ZhciBiPWQoYSksYz1kLmRhdGEoYSwiZGF0ZXBpY2tlciIpO2lmKGIuaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpKXt2YXIgZT1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7aWYoZT09ImlucHV0Iil7YS5kaXNhYmxlZD1mYWxzZTtjLnRyaWdnZXIuZmlsdGVyKCJidXR0b24iKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5kaXNhYmxlZD1mYWxzZX0pLmVuZCgpLmZpbHRlcigiaW1nIikuY3NzKHtvcGFjaXR5OiIxLjAiLGN1cnNvcjoiIn0pfWVsc2UgaWYoZT09ImRpdiJ8fGU9PSJzcGFuIiliLmNoaWxkcmVuKCIuIit0aGlzLl9pbmxpbmVDbGFzcykuY2hpbGRyZW4oKS5yZW1vdmVDbGFzcygidWktc3RhdGUtZGlzYWJsZWQiKTt0aGlzLl9kaXNhYmxlZElucHV0cz1kLm1hcCh0aGlzLl9kaXNhYmxlZElucHV0cyxmdW5jdGlvbihmKXtyZXR1cm4gZj09YT9udWxsOmZ9KX19LF9kaXNhYmxlRGF0ZXBpY2tlcjpmdW5jdGlvbihhKXt2YXIgYj0KZChhKSxjPWQuZGF0YShhLCJkYXRlcGlja2VyIik7aWYoYi5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpe3ZhciBlPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtpZihlPT0iaW5wdXQiKXthLmRpc2FibGVkPXRydWU7Yy50cmlnZ2VyLmZpbHRlcigiYnV0dG9uIikuZWFjaChmdW5jdGlvbigpe3RoaXMuZGlzYWJsZWQ9dHJ1ZX0pLmVuZCgpLmZpbHRlcigiaW1nIikuY3NzKHtvcGFjaXR5OiIwLjUiLGN1cnNvcjoiZGVmYXVsdCJ9KX1lbHNlIGlmKGU9PSJkaXYifHxlPT0ic3BhbiIpYi5jaGlsZHJlbigiLiIrdGhpcy5faW5saW5lQ2xhc3MpLmNoaWxkcmVuKCkuYWRkQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIik7dGhpcy5fZGlzYWJsZWRJbnB1dHM9ZC5tYXAodGhpcy5fZGlzYWJsZWRJbnB1dHMsZnVuY3Rpb24oZil7cmV0dXJuIGY9PWE/bnVsbDpmfSk7dGhpcy5fZGlzYWJsZWRJbnB1dHNbdGhpcy5fZGlzYWJsZWRJbnB1dHMubGVuZ3RoXT1hfX0sX2lzRGlzYWJsZWREYXRlcGlja2VyOmZ1bmN0aW9uKGEpe2lmKCFhKXJldHVybiBmYWxzZTsKZm9yKHZhciBiPTA7Yjx0aGlzLl9kaXNhYmxlZElucHV0cy5sZW5ndGg7YisrKWlmKHRoaXMuX2Rpc2FibGVkSW5wdXRzW2JdPT1hKXJldHVybiB0cnVlO3JldHVybiBmYWxzZX0sX2dldEluc3Q6ZnVuY3Rpb24oYSl7dHJ5e3JldHVybiBkLmRhdGEoYSwiZGF0ZXBpY2tlciIpfWNhdGNoKGIpe3Rocm93Ik1pc3NpbmcgaW5zdGFuY2UgZGF0YSBmb3IgdGhpcyBkYXRlcGlja2VyIjt9fSxfb3B0aW9uRGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIsYyl7dmFyIGU9dGhpcy5fZ2V0SW5zdChhKTtpZihhcmd1bWVudHMubGVuZ3RoPT0yJiZ0eXBlb2YgYj09InN0cmluZyIpcmV0dXJuIGI9PSJkZWZhdWx0cyI/ZC5leHRlbmQoe30sZC5kYXRlcGlja2VyLl9kZWZhdWx0cyk6ZT9iPT0iYWxsIj9kLmV4dGVuZCh7fSxlLnNldHRpbmdzKTp0aGlzLl9nZXQoZSxiKTpudWxsO3ZhciBmPWJ8fHt9O2lmKHR5cGVvZiBiPT0ic3RyaW5nIil7Zj17fTtmW2JdPWN9aWYoZSl7dGhpcy5fY3VySW5zdD09ZSYmCnRoaXMuX2hpZGVEYXRlcGlja2VyKCk7dmFyIGg9dGhpcy5fZ2V0RGF0ZURhdGVwaWNrZXIoYSx0cnVlKTtFKGUuc2V0dGluZ3MsZik7dGhpcy5fYXR0YWNobWVudHMoZChhKSxlKTt0aGlzLl9hdXRvU2l6ZShlKTt0aGlzLl9zZXREYXRlRGF0ZXBpY2tlcihhLGgpO3RoaXMuX3VwZGF0ZURhdGVwaWNrZXIoZSl9fSxfY2hhbmdlRGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIsYyl7dGhpcy5fb3B0aW9uRGF0ZXBpY2tlcihhLGIsYyl9LF9yZWZyZXNoRGF0ZXBpY2tlcjpmdW5jdGlvbihhKXsoYT10aGlzLl9nZXRJbnN0KGEpKSYmdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihhKX0sX3NldERhdGVEYXRlcGlja2VyOmZ1bmN0aW9uKGEsYil7aWYoYT10aGlzLl9nZXRJbnN0KGEpKXt0aGlzLl9zZXREYXRlKGEsYik7dGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihhKTt0aGlzLl91cGRhdGVBbHRlcm5hdGUoYSl9fSxfZ2V0RGF0ZURhdGVwaWNrZXI6ZnVuY3Rpb24oYSxiKXsoYT10aGlzLl9nZXRJbnN0KGEpKSYmCiFhLmlubGluZSYmdGhpcy5fc2V0RGF0ZUZyb21GaWVsZChhLGIpO3JldHVybiBhP3RoaXMuX2dldERhdGUoYSk6bnVsbH0sX2RvS2V5RG93bjpmdW5jdGlvbihhKXt2YXIgYj1kLmRhdGVwaWNrZXIuX2dldEluc3QoYS50YXJnZXQpLGM9dHJ1ZSxlPWIuZHBEaXYuaXMoIi51aS1kYXRlcGlja2VyLXJ0bCIpO2IuX2tleUV2ZW50PXRydWU7aWYoZC5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZylzd2l0Y2goYS5rZXlDb2RlKXtjYXNlIDk6ZC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpO2M9ZmFsc2U7YnJlYWs7Y2FzZSAxMzpjPWQoInRkLiIrZC5kYXRlcGlja2VyLl9kYXlPdmVyQ2xhc3MsYi5kcERpdikuYWRkKGQoInRkLiIrZC5kYXRlcGlja2VyLl9jdXJyZW50Q2xhc3MsYi5kcERpdikpO2NbMF0/ZC5kYXRlcGlja2VyLl9zZWxlY3REYXkoYS50YXJnZXQsYi5zZWxlY3RlZE1vbnRoLGIuc2VsZWN0ZWRZZWFyLGNbMF0pOmQuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKTsKcmV0dXJuIGZhbHNlO2Nhc2UgMjc6ZC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpO2JyZWFrO2Nhc2UgMzM6ZC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGEudGFyZ2V0LGEuY3RybEtleT8tZC5kYXRlcGlja2VyLl9nZXQoYiwic3RlcEJpZ01vbnRocyIpOi1kLmRhdGVwaWNrZXIuX2dldChiLCJzdGVwTW9udGhzIiksIk0iKTticmVhaztjYXNlIDM0OmQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShhLnRhcmdldCxhLmN0cmxLZXk/K2QuZGF0ZXBpY2tlci5fZ2V0KGIsInN0ZXBCaWdNb250aHMiKTorZC5kYXRlcGlja2VyLl9nZXQoYiwic3RlcE1vbnRocyIpLCJNIik7YnJlYWs7Y2FzZSAzNTppZihhLmN0cmxLZXl8fGEubWV0YUtleSlkLmRhdGVwaWNrZXIuX2NsZWFyRGF0ZShhLnRhcmdldCk7Yz1hLmN0cmxLZXl8fGEubWV0YUtleTticmVhaztjYXNlIDM2OmlmKGEuY3RybEtleXx8YS5tZXRhS2V5KWQuZGF0ZXBpY2tlci5fZ290b1RvZGF5KGEudGFyZ2V0KTtjPWEuY3RybEtleXx8CmEubWV0YUtleTticmVhaztjYXNlIDM3OmlmKGEuY3RybEtleXx8YS5tZXRhS2V5KWQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShhLnRhcmdldCxlPysxOi0xLCJEIik7Yz1hLmN0cmxLZXl8fGEubWV0YUtleTtpZihhLm9yaWdpbmFsRXZlbnQuYWx0S2V5KWQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShhLnRhcmdldCxhLmN0cmxLZXk/LWQuZGF0ZXBpY2tlci5fZ2V0KGIsInN0ZXBCaWdNb250aHMiKTotZC5kYXRlcGlja2VyLl9nZXQoYiwic3RlcE1vbnRocyIpLCJNIik7YnJlYWs7Y2FzZSAzODppZihhLmN0cmxLZXl8fGEubWV0YUtleSlkLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYS50YXJnZXQsLTcsIkQiKTtjPWEuY3RybEtleXx8YS5tZXRhS2V5O2JyZWFrO2Nhc2UgMzk6aWYoYS5jdHJsS2V5fHxhLm1ldGFLZXkpZC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGEudGFyZ2V0LGU/LTE6KzEsIkQiKTtjPWEuY3RybEtleXx8YS5tZXRhS2V5O2lmKGEub3JpZ2luYWxFdmVudC5hbHRLZXkpZC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGEudGFyZ2V0LAphLmN0cmxLZXk/K2QuZGF0ZXBpY2tlci5fZ2V0KGIsInN0ZXBCaWdNb250aHMiKTorZC5kYXRlcGlja2VyLl9nZXQoYiwic3RlcE1vbnRocyIpLCJNIik7YnJlYWs7Y2FzZSA0MDppZihhLmN0cmxLZXl8fGEubWV0YUtleSlkLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYS50YXJnZXQsKzcsIkQiKTtjPWEuY3RybEtleXx8YS5tZXRhS2V5O2JyZWFrO2RlZmF1bHQ6Yz1mYWxzZX1lbHNlIGlmKGEua2V5Q29kZT09MzYmJmEuY3RybEtleSlkLmRhdGVwaWNrZXIuX3Nob3dEYXRlcGlja2VyKHRoaXMpO2Vsc2UgYz1mYWxzZTtpZihjKXthLnByZXZlbnREZWZhdWx0KCk7YS5zdG9wUHJvcGFnYXRpb24oKX19LF9kb0tleVByZXNzOmZ1bmN0aW9uKGEpe3ZhciBiPWQuZGF0ZXBpY2tlci5fZ2V0SW5zdChhLnRhcmdldCk7aWYoZC5kYXRlcGlja2VyLl9nZXQoYiwiY29uc3RyYWluSW5wdXQiKSl7Yj1kLmRhdGVwaWNrZXIuX3Bvc3NpYmxlQ2hhcnMoZC5kYXRlcGlja2VyLl9nZXQoYiwiZGF0ZUZvcm1hdCIpKTsKdmFyIGM9U3RyaW5nLmZyb21DaGFyQ29kZShhLmNoYXJDb2RlPT1HP2Eua2V5Q29kZTphLmNoYXJDb2RlKTtyZXR1cm4gYS5jdHJsS2V5fHxjPCIgInx8IWJ8fGIuaW5kZXhPZihjKT4tMX19LF9kb0tleVVwOmZ1bmN0aW9uKGEpe2E9ZC5kYXRlcGlja2VyLl9nZXRJbnN0KGEudGFyZ2V0KTtpZihhLmlucHV0LnZhbCgpIT1hLmxhc3RWYWwpdHJ5e2lmKGQuZGF0ZXBpY2tlci5wYXJzZURhdGUoZC5kYXRlcGlja2VyLl9nZXQoYSwiZGF0ZUZvcm1hdCIpLGEuaW5wdXQ/YS5pbnB1dC52YWwoKTpudWxsLGQuZGF0ZXBpY2tlci5fZ2V0Rm9ybWF0Q29uZmlnKGEpKSl7ZC5kYXRlcGlja2VyLl9zZXREYXRlRnJvbUZpZWxkKGEpO2QuZGF0ZXBpY2tlci5fdXBkYXRlQWx0ZXJuYXRlKGEpO2QuZGF0ZXBpY2tlci5fdXBkYXRlRGF0ZXBpY2tlcihhKX19Y2F0Y2goYil7ZC5kYXRlcGlja2VyLmxvZyhiKX1yZXR1cm4gdHJ1ZX0sX3Nob3dEYXRlcGlja2VyOmZ1bmN0aW9uKGEpe2E9YS50YXJnZXR8fAphO2lmKGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKSE9ImlucHV0IilhPWQoImlucHV0IixhLnBhcmVudE5vZGUpWzBdO2lmKCEoZC5kYXRlcGlja2VyLl9pc0Rpc2FibGVkRGF0ZXBpY2tlcihhKXx8ZC5kYXRlcGlja2VyLl9sYXN0SW5wdXQ9PWEpKXt2YXIgYj1kLmRhdGVwaWNrZXIuX2dldEluc3QoYSk7ZC5kYXRlcGlja2VyLl9jdXJJbnN0JiZkLmRhdGVwaWNrZXIuX2N1ckluc3QhPWImJmQuZGF0ZXBpY2tlci5fY3VySW5zdC5kcERpdi5zdG9wKHRydWUsdHJ1ZSk7dmFyIGM9ZC5kYXRlcGlja2VyLl9nZXQoYiwiYmVmb3JlU2hvdyIpO0UoYi5zZXR0aW5ncyxjP2MuYXBwbHkoYSxbYSxiXSk6e30pO2IubGFzdFZhbD1udWxsO2QuZGF0ZXBpY2tlci5fbGFzdElucHV0PWE7ZC5kYXRlcGlja2VyLl9zZXREYXRlRnJvbUZpZWxkKGIpO2lmKGQuZGF0ZXBpY2tlci5faW5EaWFsb2cpYS52YWx1ZT0iIjtpZighZC5kYXRlcGlja2VyLl9wb3Mpe2QuZGF0ZXBpY2tlci5fcG9zPWQuZGF0ZXBpY2tlci5fZmluZFBvcyhhKTsKZC5kYXRlcGlja2VyLl9wb3NbMV0rPWEub2Zmc2V0SGVpZ2h0fXZhciBlPWZhbHNlO2QoYSkucGFyZW50cygpLmVhY2goZnVuY3Rpb24oKXtlfD1kKHRoaXMpLmNzcygicG9zaXRpb24iKT09ImZpeGVkIjtyZXR1cm4hZX0pO2lmKGUmJmQuYnJvd3Nlci5vcGVyYSl7ZC5kYXRlcGlja2VyLl9wb3NbMF0tPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0O2QuZGF0ZXBpY2tlci5fcG9zWzFdLT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wfWM9e2xlZnQ6ZC5kYXRlcGlja2VyLl9wb3NbMF0sdG9wOmQuZGF0ZXBpY2tlci5fcG9zWzFdfTtkLmRhdGVwaWNrZXIuX3Bvcz1udWxsO2IuZHBEaXYuY3NzKHtwb3NpdGlvbjoiYWJzb2x1dGUiLGRpc3BsYXk6ImJsb2NrIix0b3A6Ii0xMDAwcHgifSk7ZC5kYXRlcGlja2VyLl91cGRhdGVEYXRlcGlja2VyKGIpO2M9ZC5kYXRlcGlja2VyLl9jaGVja09mZnNldChiLGMsZSk7Yi5kcERpdi5jc3Moe3Bvc2l0aW9uOmQuZGF0ZXBpY2tlci5faW5EaWFsb2cmJgpkLmJsb2NrVUk/InN0YXRpYyI6ZT8iZml4ZWQiOiJhYnNvbHV0ZSIsZGlzcGxheToibm9uZSIsbGVmdDpjLmxlZnQrInB4Iix0b3A6Yy50b3ArInB4In0pO2lmKCFiLmlubGluZSl7Yz1kLmRhdGVwaWNrZXIuX2dldChiLCJzaG93QW5pbSIpO3ZhciBmPWQuZGF0ZXBpY2tlci5fZ2V0KGIsImR1cmF0aW9uIiksaD1mdW5jdGlvbigpe2QuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmc9dHJ1ZTt2YXIgaT1kLmRhdGVwaWNrZXIuX2dldEJvcmRlcnMoYi5kcERpdik7Yi5kcERpdi5maW5kKCJpZnJhbWUudWktZGF0ZXBpY2tlci1jb3ZlciIpLmNzcyh7bGVmdDotaVswXSx0b3A6LWlbMV0sd2lkdGg6Yi5kcERpdi5vdXRlcldpZHRoKCksaGVpZ2h0OmIuZHBEaXYub3V0ZXJIZWlnaHQoKX0pfTtiLmRwRGl2LnpJbmRleChkKGEpLnpJbmRleCgpKzEpO2QuZWZmZWN0cyYmZC5lZmZlY3RzW2NdP2IuZHBEaXYuc2hvdyhjLGQuZGF0ZXBpY2tlci5fZ2V0KGIsInNob3dPcHRpb25zIiksZiwKaCk6Yi5kcERpdltjfHwic2hvdyJdKGM/ZjpudWxsLGgpO2lmKCFjfHwhZiloKCk7Yi5pbnB1dC5pcygiOnZpc2libGUiKSYmIWIuaW5wdXQuaXMoIjpkaXNhYmxlZCIpJiZiLmlucHV0LmZvY3VzKCk7ZC5kYXRlcGlja2VyLl9jdXJJbnN0PWJ9fX0sX3VwZGF0ZURhdGVwaWNrZXI6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcyxjPWQuZGF0ZXBpY2tlci5fZ2V0Qm9yZGVycyhhLmRwRGl2KTthLmRwRGl2LmVtcHR5KCkuYXBwZW5kKHRoaXMuX2dlbmVyYXRlSFRNTChhKSkuZmluZCgiaWZyYW1lLnVpLWRhdGVwaWNrZXItY292ZXIiKS5jc3Moe2xlZnQ6LWNbMF0sdG9wOi1jWzFdLHdpZHRoOmEuZHBEaXYub3V0ZXJXaWR0aCgpLGhlaWdodDphLmRwRGl2Lm91dGVySGVpZ2h0KCl9KS5lbmQoKS5maW5kKCJidXR0b24sIC51aS1kYXRlcGlja2VyLXByZXYsIC51aS1kYXRlcGlja2VyLW5leHQsIC51aS1kYXRlcGlja2VyLWNhbGVuZGFyIHRkIGEiKS5iaW5kKCJtb3VzZW91dCIsZnVuY3Rpb24oKXtkKHRoaXMpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpOwp0aGlzLmNsYXNzTmFtZS5pbmRleE9mKCJ1aS1kYXRlcGlja2VyLXByZXYiKSE9LTEmJmQodGhpcykucmVtb3ZlQ2xhc3MoInVpLWRhdGVwaWNrZXItcHJldi1ob3ZlciIpO3RoaXMuY2xhc3NOYW1lLmluZGV4T2YoInVpLWRhdGVwaWNrZXItbmV4dCIpIT0tMSYmZCh0aGlzKS5yZW1vdmVDbGFzcygidWktZGF0ZXBpY2tlci1uZXh0LWhvdmVyIil9KS5iaW5kKCJtb3VzZW92ZXIiLGZ1bmN0aW9uKCl7aWYoIWIuX2lzRGlzYWJsZWREYXRlcGlja2VyKGEuaW5saW5lP2EuZHBEaXYucGFyZW50KClbMF06YS5pbnB1dFswXSkpe2QodGhpcykucGFyZW50cygiLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIiKS5maW5kKCJhIikucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWhvdmVyIik7ZCh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtaG92ZXIiKTt0aGlzLmNsYXNzTmFtZS5pbmRleE9mKCJ1aS1kYXRlcGlja2VyLXByZXYiKSE9LTEmJmQodGhpcykuYWRkQ2xhc3MoInVpLWRhdGVwaWNrZXItcHJldi1ob3ZlciIpOwp0aGlzLmNsYXNzTmFtZS5pbmRleE9mKCJ1aS1kYXRlcGlja2VyLW5leHQiKSE9LTEmJmQodGhpcykuYWRkQ2xhc3MoInVpLWRhdGVwaWNrZXItbmV4dC1ob3ZlciIpfX0pLmVuZCgpLmZpbmQoIi4iK3RoaXMuX2RheU92ZXJDbGFzcysiIGEiKS50cmlnZ2VyKCJtb3VzZW92ZXIiKS5lbmQoKTtjPXRoaXMuX2dldE51bWJlck9mTW9udGhzKGEpO3ZhciBlPWNbMV07ZT4xP2EuZHBEaXYuYWRkQ2xhc3MoInVpLWRhdGVwaWNrZXItbXVsdGktIitlKS5jc3MoIndpZHRoIiwxNyplKyJlbSIpOmEuZHBEaXYucmVtb3ZlQ2xhc3MoInVpLWRhdGVwaWNrZXItbXVsdGktMiB1aS1kYXRlcGlja2VyLW11bHRpLTMgdWktZGF0ZXBpY2tlci1tdWx0aS00Iikud2lkdGgoIiIpO2EuZHBEaXZbKGNbMF0hPTF8fGNbMV0hPTE/ImFkZCI6InJlbW92ZSIpKyJDbGFzcyJdKCJ1aS1kYXRlcGlja2VyLW11bHRpIik7YS5kcERpdlsodGhpcy5fZ2V0KGEsImlzUlRMIik/ImFkZCI6InJlbW92ZSIpKyJDbGFzcyJdKCJ1aS1kYXRlcGlja2VyLXJ0bCIpOwphPT1kLmRhdGVwaWNrZXIuX2N1ckluc3QmJmQuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcmJmEuaW5wdXQmJmEuaW5wdXQuaXMoIjp2aXNpYmxlIikmJiFhLmlucHV0LmlzKCI6ZGlzYWJsZWQiKSYmYS5pbnB1dC5mb2N1cygpfSxfZ2V0Qm9yZGVyczpmdW5jdGlvbihhKXt2YXIgYj1mdW5jdGlvbihjKXtyZXR1cm57dGhpbjoxLG1lZGl1bToyLHRoaWNrOjN9W2NdfHxjfTtyZXR1cm5bcGFyc2VGbG9hdChiKGEuY3NzKCJib3JkZXItbGVmdC13aWR0aCIpKSkscGFyc2VGbG9hdChiKGEuY3NzKCJib3JkZXItdG9wLXdpZHRoIikpKV19LF9jaGVja09mZnNldDpmdW5jdGlvbihhLGIsYyl7dmFyIGU9YS5kcERpdi5vdXRlcldpZHRoKCksZj1hLmRwRGl2Lm91dGVySGVpZ2h0KCksaD1hLmlucHV0P2EuaW5wdXQub3V0ZXJXaWR0aCgpOjAsaT1hLmlucHV0P2EuaW5wdXQub3V0ZXJIZWlnaHQoKTowLGc9ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoK2QoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSwKaz1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0K2QoZG9jdW1lbnQpLnNjcm9sbFRvcCgpO2IubGVmdC09dGhpcy5fZ2V0KGEsImlzUlRMIik/ZS1oOjA7Yi5sZWZ0LT1jJiZiLmxlZnQ9PWEuaW5wdXQub2Zmc2V0KCkubGVmdD9kKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCk6MDtiLnRvcC09YyYmYi50b3A9PWEuaW5wdXQub2Zmc2V0KCkudG9wK2k/ZChkb2N1bWVudCkuc2Nyb2xsVG9wKCk6MDtiLmxlZnQtPU1hdGgubWluKGIubGVmdCxiLmxlZnQrZT5nJiZnPmU/TWF0aC5hYnMoYi5sZWZ0K2UtZyk6MCk7Yi50b3AtPU1hdGgubWluKGIudG9wLGIudG9wK2Y+ayYmaz5mP01hdGguYWJzKGYraSk6MCk7cmV0dXJuIGJ9LF9maW5kUG9zOmZ1bmN0aW9uKGEpe2Zvcih2YXIgYj10aGlzLl9nZXQodGhpcy5fZ2V0SW5zdChhKSwiaXNSVEwiKTthJiYoYS50eXBlPT0iaGlkZGVuInx8YS5ub2RlVHlwZSE9MSk7KWE9YVtiPyJwcmV2aW91c1NpYmxpbmciOiJuZXh0U2libGluZyJdOwphPWQoYSkub2Zmc2V0KCk7cmV0dXJuW2EubGVmdCxhLnRvcF19LF9oaWRlRGF0ZXBpY2tlcjpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9jdXJJbnN0O2lmKCEoIWJ8fGEmJmIhPWQuZGF0YShhLCJkYXRlcGlja2VyIikpKWlmKHRoaXMuX2RhdGVwaWNrZXJTaG93aW5nKXthPXRoaXMuX2dldChiLCJzaG93QW5pbSIpO3ZhciBjPXRoaXMuX2dldChiLCJkdXJhdGlvbiIpLGU9ZnVuY3Rpb24oKXtkLmRhdGVwaWNrZXIuX3RpZHlEaWFsb2coYik7dGhpcy5fY3VySW5zdD1udWxsfTtkLmVmZmVjdHMmJmQuZWZmZWN0c1thXT9iLmRwRGl2LmhpZGUoYSxkLmRhdGVwaWNrZXIuX2dldChiLCJzaG93T3B0aW9ucyIpLGMsZSk6Yi5kcERpdlthPT0ic2xpZGVEb3duIj8ic2xpZGVVcCI6YT09ImZhZGVJbiI/ImZhZGVPdXQiOiJoaWRlIl0oYT9jOm51bGwsZSk7YXx8ZSgpO2lmKGE9dGhpcy5fZ2V0KGIsIm9uQ2xvc2UiKSlhLmFwcGx5KGIuaW5wdXQ/Yi5pbnB1dFswXTpudWxsLFtiLmlucHV0P2IuaW5wdXQudmFsKCk6CiIiLGJdKTt0aGlzLl9kYXRlcGlja2VyU2hvd2luZz1mYWxzZTt0aGlzLl9sYXN0SW5wdXQ9bnVsbDtpZih0aGlzLl9pbkRpYWxvZyl7dGhpcy5fZGlhbG9nSW5wdXQuY3NzKHtwb3NpdGlvbjoiYWJzb2x1dGUiLGxlZnQ6IjAiLHRvcDoiLTEwMHB4In0pO2lmKGQuYmxvY2tVSSl7ZC51bmJsb2NrVUkoKTtkKCJib2R5IikuYXBwZW5kKHRoaXMuZHBEaXYpfX10aGlzLl9pbkRpYWxvZz1mYWxzZX19LF90aWR5RGlhbG9nOmZ1bmN0aW9uKGEpe2EuZHBEaXYucmVtb3ZlQ2xhc3ModGhpcy5fZGlhbG9nQ2xhc3MpLnVuYmluZCgiLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIiKX0sX2NoZWNrRXh0ZXJuYWxDbGljazpmdW5jdGlvbihhKXtpZihkLmRhdGVwaWNrZXIuX2N1ckluc3Qpe2E9ZChhLnRhcmdldCk7YVswXS5pZCE9ZC5kYXRlcGlja2VyLl9tYWluRGl2SWQmJmEucGFyZW50cygiIyIrZC5kYXRlcGlja2VyLl9tYWluRGl2SWQpLmxlbmd0aD09MCYmIWEuaGFzQ2xhc3MoZC5kYXRlcGlja2VyLm1hcmtlckNsYXNzTmFtZSkmJgohYS5oYXNDbGFzcyhkLmRhdGVwaWNrZXIuX3RyaWdnZXJDbGFzcykmJmQuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcmJiEoZC5kYXRlcGlja2VyLl9pbkRpYWxvZyYmZC5ibG9ja1VJKSYmZC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpfX0sX2FkanVzdERhdGU6ZnVuY3Rpb24oYSxiLGMpe2E9ZChhKTt2YXIgZT10aGlzLl9nZXRJbnN0KGFbMF0pO2lmKCF0aGlzLl9pc0Rpc2FibGVkRGF0ZXBpY2tlcihhWzBdKSl7dGhpcy5fYWRqdXN0SW5zdERhdGUoZSxiKyhjPT0iTSI/dGhpcy5fZ2V0KGUsInNob3dDdXJyZW50QXRQb3MiKTowKSxjKTt0aGlzLl91cGRhdGVEYXRlcGlja2VyKGUpfX0sX2dvdG9Ub2RheTpmdW5jdGlvbihhKXthPWQoYSk7dmFyIGI9dGhpcy5fZ2V0SW5zdChhWzBdKTtpZih0aGlzLl9nZXQoYiwiZ290b0N1cnJlbnQiKSYmYi5jdXJyZW50RGF5KXtiLnNlbGVjdGVkRGF5PWIuY3VycmVudERheTtiLmRyYXdNb250aD1iLnNlbGVjdGVkTW9udGg9Yi5jdXJyZW50TW9udGg7CmIuZHJhd1llYXI9Yi5zZWxlY3RlZFllYXI9Yi5jdXJyZW50WWVhcn1lbHNle3ZhciBjPW5ldyBEYXRlO2Iuc2VsZWN0ZWREYXk9Yy5nZXREYXRlKCk7Yi5kcmF3TW9udGg9Yi5zZWxlY3RlZE1vbnRoPWMuZ2V0TW9udGgoKTtiLmRyYXdZZWFyPWIuc2VsZWN0ZWRZZWFyPWMuZ2V0RnVsbFllYXIoKX10aGlzLl9ub3RpZnlDaGFuZ2UoYik7dGhpcy5fYWRqdXN0RGF0ZShhKX0sX3NlbGVjdE1vbnRoWWVhcjpmdW5jdGlvbihhLGIsYyl7YT1kKGEpO3ZhciBlPXRoaXMuX2dldEluc3QoYVswXSk7ZS5fc2VsZWN0aW5nTW9udGhZZWFyPWZhbHNlO2VbInNlbGVjdGVkIisoYz09Ik0iPyJNb250aCI6IlllYXIiKV09ZVsiZHJhdyIrKGM9PSJNIj8iTW9udGgiOiJZZWFyIildPXBhcnNlSW50KGIub3B0aW9uc1tiLnNlbGVjdGVkSW5kZXhdLnZhbHVlLDEwKTt0aGlzLl9ub3RpZnlDaGFuZ2UoZSk7dGhpcy5fYWRqdXN0RGF0ZShhKX0sX2NsaWNrTW9udGhZZWFyOmZ1bmN0aW9uKGEpe3ZhciBiPQp0aGlzLl9nZXRJbnN0KGQoYSlbMF0pO2IuaW5wdXQmJmIuX3NlbGVjdGluZ01vbnRoWWVhciYmc2V0VGltZW91dChmdW5jdGlvbigpe2IuaW5wdXQuZm9jdXMoKX0sMCk7Yi5fc2VsZWN0aW5nTW9udGhZZWFyPSFiLl9zZWxlY3RpbmdNb250aFllYXJ9LF9zZWxlY3REYXk6ZnVuY3Rpb24oYSxiLGMsZSl7dmFyIGY9ZChhKTtpZighKGQoZSkuaGFzQ2xhc3ModGhpcy5fdW5zZWxlY3RhYmxlQ2xhc3MpfHx0aGlzLl9pc0Rpc2FibGVkRGF0ZXBpY2tlcihmWzBdKSkpe2Y9dGhpcy5fZ2V0SW5zdChmWzBdKTtmLnNlbGVjdGVkRGF5PWYuY3VycmVudERheT1kKCJhIixlKS5odG1sKCk7Zi5zZWxlY3RlZE1vbnRoPWYuY3VycmVudE1vbnRoPWI7Zi5zZWxlY3RlZFllYXI9Zi5jdXJyZW50WWVhcj1jO3RoaXMuX3NlbGVjdERhdGUoYSx0aGlzLl9mb3JtYXREYXRlKGYsZi5jdXJyZW50RGF5LGYuY3VycmVudE1vbnRoLGYuY3VycmVudFllYXIpKX19LF9jbGVhckRhdGU6ZnVuY3Rpb24oYSl7YT0KZChhKTt0aGlzLl9nZXRJbnN0KGFbMF0pO3RoaXMuX3NlbGVjdERhdGUoYSwiIil9LF9zZWxlY3REYXRlOmZ1bmN0aW9uKGEsYil7YT10aGlzLl9nZXRJbnN0KGQoYSlbMF0pO2I9YiE9bnVsbD9iOnRoaXMuX2Zvcm1hdERhdGUoYSk7YS5pbnB1dCYmYS5pbnB1dC52YWwoYik7dGhpcy5fdXBkYXRlQWx0ZXJuYXRlKGEpO3ZhciBjPXRoaXMuX2dldChhLCJvblNlbGVjdCIpO2lmKGMpYy5hcHBseShhLmlucHV0P2EuaW5wdXRbMF06bnVsbCxbYixhXSk7ZWxzZSBhLmlucHV0JiZhLmlucHV0LnRyaWdnZXIoImNoYW5nZSIpO2lmKGEuaW5saW5lKXRoaXMuX3VwZGF0ZURhdGVwaWNrZXIoYSk7ZWxzZXt0aGlzLl9oaWRlRGF0ZXBpY2tlcigpO3RoaXMuX2xhc3RJbnB1dD1hLmlucHV0WzBdO3R5cGVvZiBhLmlucHV0WzBdIT0ib2JqZWN0IiYmYS5pbnB1dC5mb2N1cygpO3RoaXMuX2xhc3RJbnB1dD1udWxsfX0sX3VwZGF0ZUFsdGVybmF0ZTpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9nZXQoYSwKImFsdEZpZWxkIik7aWYoYil7dmFyIGM9dGhpcy5fZ2V0KGEsImFsdEZvcm1hdCIpfHx0aGlzLl9nZXQoYSwiZGF0ZUZvcm1hdCIpLGU9dGhpcy5fZ2V0RGF0ZShhKSxmPXRoaXMuZm9ybWF0RGF0ZShjLGUsdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGEpKTtkKGIpLmVhY2goZnVuY3Rpb24oKXtkKHRoaXMpLnZhbChmKX0pfX0sbm9XZWVrZW5kczpmdW5jdGlvbihhKXthPWEuZ2V0RGF5KCk7cmV0dXJuW2E+MCYmYTw2LCIiXX0saXNvODYwMVdlZWs6ZnVuY3Rpb24oYSl7YT1uZXcgRGF0ZShhLmdldFRpbWUoKSk7YS5zZXREYXRlKGEuZ2V0RGF0ZSgpKzQtKGEuZ2V0RGF5KCl8fDcpKTt2YXIgYj1hLmdldFRpbWUoKTthLnNldE1vbnRoKDApO2Euc2V0RGF0ZSgxKTtyZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJvdW5kKChiLWEpLzg2NEU1KS83KSsxfSxwYXJzZURhdGU6ZnVuY3Rpb24oYSxiLGMpe2lmKGE9PW51bGx8fGI9PW51bGwpdGhyb3ciSW52YWxpZCBhcmd1bWVudHMiO2I9dHlwZW9mIGI9PQoib2JqZWN0Ij9iLnRvU3RyaW5nKCk6YisiIjtpZihiPT0iIilyZXR1cm4gbnVsbDtmb3IodmFyIGU9KGM/Yy5zaG9ydFllYXJDdXRvZmY6bnVsbCl8fHRoaXMuX2RlZmF1bHRzLnNob3J0WWVhckN1dG9mZixmPShjP2MuZGF5TmFtZXNTaG9ydDpudWxsKXx8dGhpcy5fZGVmYXVsdHMuZGF5TmFtZXNTaG9ydCxoPShjP2MuZGF5TmFtZXM6bnVsbCl8fHRoaXMuX2RlZmF1bHRzLmRheU5hbWVzLGk9KGM/Yy5tb250aE5hbWVzU2hvcnQ6bnVsbCl8fHRoaXMuX2RlZmF1bHRzLm1vbnRoTmFtZXNTaG9ydCxnPShjP2MubW9udGhOYW1lczpudWxsKXx8dGhpcy5fZGVmYXVsdHMubW9udGhOYW1lcyxrPWM9LTEsbD0tMSx1PS0xLGo9ZmFsc2Usbz1mdW5jdGlvbihwKXsocD16KzE8YS5sZW5ndGgmJmEuY2hhckF0KHorMSk9PXApJiZ6Kys7cmV0dXJuIHB9LG09ZnVuY3Rpb24ocCl7byhwKTtwPW5ldyBSZWdFeHAoIl5cXGR7MSwiKyhwPT0iQCI/MTQ6cD09IiEiPzIwOnA9PSJ5Ij80OnA9PSJvIj8KMzoyKSsifSIpO3A9Yi5zdWJzdHJpbmcocykubWF0Y2gocCk7aWYoIXApdGhyb3ciTWlzc2luZyBudW1iZXIgYXQgcG9zaXRpb24gIitzO3MrPXBbMF0ubGVuZ3RoO3JldHVybiBwYXJzZUludChwWzBdLDEwKX0sbj1mdW5jdGlvbihwLHcsSCl7cD1vKHApP0g6dztmb3Iodz0wO3c8cC5sZW5ndGg7dysrKWlmKGIuc3Vic3RyKHMscFt3XS5sZW5ndGgpLnRvTG93ZXJDYXNlKCk9PXBbd10udG9Mb3dlckNhc2UoKSl7cys9cFt3XS5sZW5ndGg7cmV0dXJuIHcrMX10aHJvdyJVbmtub3duIG5hbWUgYXQgcG9zaXRpb24gIitzO30scj1mdW5jdGlvbigpe2lmKGIuY2hhckF0KHMpIT1hLmNoYXJBdCh6KSl0aHJvdyJVbmV4cGVjdGVkIGxpdGVyYWwgYXQgcG9zaXRpb24gIitzO3MrK30scz0wLHo9MDt6PGEubGVuZ3RoO3orKylpZihqKWlmKGEuY2hhckF0KHopPT0iJyImJiFvKCInIikpaj1mYWxzZTtlbHNlIHIoKTtlbHNlIHN3aXRjaChhLmNoYXJBdCh6KSl7Y2FzZSAiZCI6bD1tKCJkIik7CmJyZWFrO2Nhc2UgIkQiOm4oIkQiLGYsaCk7YnJlYWs7Y2FzZSAibyI6dT1tKCJvIik7YnJlYWs7Y2FzZSAibSI6az1tKCJtIik7YnJlYWs7Y2FzZSAiTSI6az1uKCJNIixpLGcpO2JyZWFrO2Nhc2UgInkiOmM9bSgieSIpO2JyZWFrO2Nhc2UgIkAiOnZhciB2PW5ldyBEYXRlKG0oIkAiKSk7Yz12LmdldEZ1bGxZZWFyKCk7az12LmdldE1vbnRoKCkrMTtsPXYuZ2V0RGF0ZSgpO2JyZWFrO2Nhc2UgIiEiOnY9bmV3IERhdGUoKG0oIiEiKS10aGlzLl90aWNrc1RvMTk3MCkvMUU0KTtjPXYuZ2V0RnVsbFllYXIoKTtrPXYuZ2V0TW9udGgoKSsxO2w9di5nZXREYXRlKCk7YnJlYWs7Y2FzZSAiJyI6aWYobygiJyIpKXIoKTtlbHNlIGo9dHJ1ZTticmVhaztkZWZhdWx0OnIoKX1pZihjPT0tMSljPShuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKTtlbHNlIGlmKGM8MTAwKWMrPShuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKS0obmV3IERhdGUpLmdldEZ1bGxZZWFyKCklMTAwKyhjPD1lPzA6LTEwMCk7aWYodT4KLTEpe2s9MTtsPXU7ZG97ZT10aGlzLl9nZXREYXlzSW5Nb250aChjLGstMSk7aWYobDw9ZSlicmVhaztrKys7bC09ZX13aGlsZSgxKX12PXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGMsay0xLGwpKTtpZih2LmdldEZ1bGxZZWFyKCkhPWN8fHYuZ2V0TW9udGgoKSsxIT1rfHx2LmdldERhdGUoKSE9bCl0aHJvdyJJbnZhbGlkIGRhdGUiO3JldHVybiB2fSxBVE9NOiJ5eS1tbS1kZCIsQ09PS0lFOiJELCBkZCBNIHl5IixJU09fODYwMToieXktbW0tZGQiLFJGQ184MjI6IkQsIGQgTSB5IixSRkNfODUwOiJERCwgZGQtTS15IixSRkNfMTAzNjoiRCwgZCBNIHkiLFJGQ18xMTIzOiJELCBkIE0geXkiLFJGQ18yODIyOiJELCBkIE0geXkiLFJTUzoiRCwgZCBNIHkiLFRJQ0tTOiIhIixUSU1FU1RBTVA6IkAiLFczQzoieXktbW0tZGQiLF90aWNrc1RvMTk3MDooNzE4Njg1K01hdGguZmxvb3IoNDkyLjUpLU1hdGguZmxvb3IoMTkuNykrTWF0aC5mbG9vcig0LjkyNSkpKjI0Kgo2MCo2MCoxRTcsZm9ybWF0RGF0ZTpmdW5jdGlvbihhLGIsYyl7aWYoIWIpcmV0dXJuIiI7dmFyIGU9KGM/Yy5kYXlOYW1lc1Nob3J0Om51bGwpfHx0aGlzLl9kZWZhdWx0cy5kYXlOYW1lc1Nob3J0LGY9KGM/Yy5kYXlOYW1lczpudWxsKXx8dGhpcy5fZGVmYXVsdHMuZGF5TmFtZXMsaD0oYz9jLm1vbnRoTmFtZXNTaG9ydDpudWxsKXx8dGhpcy5fZGVmYXVsdHMubW9udGhOYW1lc1Nob3J0O2M9KGM/Yy5tb250aE5hbWVzOm51bGwpfHx0aGlzLl9kZWZhdWx0cy5tb250aE5hbWVzO3ZhciBpPWZ1bmN0aW9uKG8peyhvPWorMTxhLmxlbmd0aCYmYS5jaGFyQXQoaisxKT09bykmJmorKztyZXR1cm4gb30sZz1mdW5jdGlvbihvLG0sbil7bT0iIittO2lmKGkobykpZm9yKDttLmxlbmd0aDxuOyltPSIwIittO3JldHVybiBtfSxrPWZ1bmN0aW9uKG8sbSxuLHIpe3JldHVybiBpKG8pP3JbbV06blttXX0sbD0iIix1PWZhbHNlO2lmKGIpZm9yKHZhciBqPTA7ajxhLmxlbmd0aDtqKyspaWYodSlpZihhLmNoYXJBdChqKT09CiInIiYmIWkoIiciKSl1PWZhbHNlO2Vsc2UgbCs9YS5jaGFyQXQoaik7ZWxzZSBzd2l0Y2goYS5jaGFyQXQoaikpe2Nhc2UgImQiOmwrPWcoImQiLGIuZ2V0RGF0ZSgpLDIpO2JyZWFrO2Nhc2UgIkQiOmwrPWsoIkQiLGIuZ2V0RGF5KCksZSxmKTticmVhaztjYXNlICJvIjpsKz1nKCJvIiwoYi5nZXRUaW1lKCktKG5ldyBEYXRlKGIuZ2V0RnVsbFllYXIoKSwwLDApKS5nZXRUaW1lKCkpLzg2NEU1LDMpO2JyZWFrO2Nhc2UgIm0iOmwrPWcoIm0iLGIuZ2V0TW9udGgoKSsxLDIpO2JyZWFrO2Nhc2UgIk0iOmwrPWsoIk0iLGIuZ2V0TW9udGgoKSxoLGMpO2JyZWFrO2Nhc2UgInkiOmwrPWkoInkiKT9iLmdldEZ1bGxZZWFyKCk6KGIuZ2V0WWVhcigpJTEwMDwxMD8iMCI6IiIpK2IuZ2V0WWVhcigpJTEwMDticmVhaztjYXNlICJAIjpsKz1iLmdldFRpbWUoKTticmVhaztjYXNlICIhIjpsKz1iLmdldFRpbWUoKSoxRTQrdGhpcy5fdGlja3NUbzE5NzA7YnJlYWs7Y2FzZSAiJyI6aWYoaSgiJyIpKWwrPQoiJyI7ZWxzZSB1PXRydWU7YnJlYWs7ZGVmYXVsdDpsKz1hLmNoYXJBdChqKX1yZXR1cm4gbH0sX3Bvc3NpYmxlQ2hhcnM6ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPSIiLGM9ZmFsc2UsZT1mdW5jdGlvbihoKXsoaD1mKzE8YS5sZW5ndGgmJmEuY2hhckF0KGYrMSk9PWgpJiZmKys7cmV0dXJuIGh9LGY9MDtmPGEubGVuZ3RoO2YrKylpZihjKWlmKGEuY2hhckF0KGYpPT0iJyImJiFlKCInIikpYz1mYWxzZTtlbHNlIGIrPWEuY2hhckF0KGYpO2Vsc2Ugc3dpdGNoKGEuY2hhckF0KGYpKXtjYXNlICJkIjpjYXNlICJtIjpjYXNlICJ5IjpjYXNlICJAIjpiKz0iMDEyMzQ1Njc4OSI7YnJlYWs7Y2FzZSAiRCI6Y2FzZSAiTSI6cmV0dXJuIG51bGw7Y2FzZSAiJyI6aWYoZSgiJyIpKWIrPSInIjtlbHNlIGM9dHJ1ZTticmVhaztkZWZhdWx0OmIrPWEuY2hhckF0KGYpfXJldHVybiBifSxfZ2V0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuc2V0dGluZ3NbYl0hPT1HP2Euc2V0dGluZ3NbYl06dGhpcy5fZGVmYXVsdHNbYl19LApfc2V0RGF0ZUZyb21GaWVsZDpmdW5jdGlvbihhLGIpe2lmKGEuaW5wdXQudmFsKCkhPWEubGFzdFZhbCl7dmFyIGM9dGhpcy5fZ2V0KGEsImRhdGVGb3JtYXQiKSxlPWEubGFzdFZhbD1hLmlucHV0P2EuaW5wdXQudmFsKCk6bnVsbCxmLGg7Zj1oPXRoaXMuX2dldERlZmF1bHREYXRlKGEpO3ZhciBpPXRoaXMuX2dldEZvcm1hdENvbmZpZyhhKTt0cnl7Zj10aGlzLnBhcnNlRGF0ZShjLGUsaSl8fGh9Y2F0Y2goZyl7dGhpcy5sb2coZyk7ZT1iPyIiOmV9YS5zZWxlY3RlZERheT1mLmdldERhdGUoKTthLmRyYXdNb250aD1hLnNlbGVjdGVkTW9udGg9Zi5nZXRNb250aCgpO2EuZHJhd1llYXI9YS5zZWxlY3RlZFllYXI9Zi5nZXRGdWxsWWVhcigpO2EuY3VycmVudERheT1lP2YuZ2V0RGF0ZSgpOjA7YS5jdXJyZW50TW9udGg9ZT9mLmdldE1vbnRoKCk6MDthLmN1cnJlbnRZZWFyPWU/Zi5nZXRGdWxsWWVhcigpOjA7dGhpcy5fYWRqdXN0SW5zdERhdGUoYSl9fSxfZ2V0RGVmYXVsdERhdGU6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX3Jlc3RyaWN0TWluTWF4KGEsCnRoaXMuX2RldGVybWluZURhdGUoYSx0aGlzLl9nZXQoYSwiZGVmYXVsdERhdGUiKSxuZXcgRGF0ZSkpfSxfZGV0ZXJtaW5lRGF0ZTpmdW5jdGlvbihhLGIsYyl7dmFyIGU9ZnVuY3Rpb24oaCl7dmFyIGk9bmV3IERhdGU7aS5zZXREYXRlKGkuZ2V0RGF0ZSgpK2gpO3JldHVybiBpfSxmPWZ1bmN0aW9uKGgpe3RyeXtyZXR1cm4gZC5kYXRlcGlja2VyLnBhcnNlRGF0ZShkLmRhdGVwaWNrZXIuX2dldChhLCJkYXRlRm9ybWF0IiksaCxkLmRhdGVwaWNrZXIuX2dldEZvcm1hdENvbmZpZyhhKSl9Y2F0Y2goaSl7fXZhciBnPShoLnRvTG93ZXJDYXNlKCkubWF0Y2goL15jLyk/ZC5kYXRlcGlja2VyLl9nZXREYXRlKGEpOm51bGwpfHxuZXcgRGF0ZSxrPWcuZ2V0RnVsbFllYXIoKSxsPWcuZ2V0TW9udGgoKTtnPWcuZ2V0RGF0ZSgpO2Zvcih2YXIgdT0vKFsrLV0/WzAtOV0rKVxzKihkfER8d3xXfG18TXx5fFkpPy9nLGo9dS5leGVjKGgpO2o7KXtzd2l0Y2goalsyXXx8ImQiKXtjYXNlICJkIjpjYXNlICJEIjpnKz0KcGFyc2VJbnQoalsxXSwxMCk7YnJlYWs7Y2FzZSAidyI6Y2FzZSAiVyI6Zys9cGFyc2VJbnQoalsxXSwxMCkqNzticmVhaztjYXNlICJtIjpjYXNlICJNIjpsKz1wYXJzZUludChqWzFdLDEwKTtnPU1hdGgubWluKGcsZC5kYXRlcGlja2VyLl9nZXREYXlzSW5Nb250aChrLGwpKTticmVhaztjYXNlICJ5IjpjYXNlICJZIjprKz1wYXJzZUludChqWzFdLDEwKTtnPU1hdGgubWluKGcsZC5kYXRlcGlja2VyLl9nZXREYXlzSW5Nb250aChrLGwpKTticmVha31qPXUuZXhlYyhoKX1yZXR1cm4gbmV3IERhdGUoayxsLGcpfTtpZihiPShiPWI9PW51bGw/Yzp0eXBlb2YgYj09InN0cmluZyI/ZihiKTp0eXBlb2YgYj09Im51bWJlciI/aXNOYU4oYik/YzplKGIpOmIpJiZiLnRvU3RyaW5nKCk9PSJJbnZhbGlkIERhdGUiP2M6Yil7Yi5zZXRIb3VycygwKTtiLnNldE1pbnV0ZXMoMCk7Yi5zZXRTZWNvbmRzKDApO2Iuc2V0TWlsbGlzZWNvbmRzKDApfXJldHVybiB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChiKX0sCl9kYXlsaWdodFNhdmluZ0FkanVzdDpmdW5jdGlvbihhKXtpZighYSlyZXR1cm4gbnVsbDthLnNldEhvdXJzKGEuZ2V0SG91cnMoKT4xMj9hLmdldEhvdXJzKCkrMjowKTtyZXR1cm4gYX0sX3NldERhdGU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBlPSFiLGY9YS5zZWxlY3RlZE1vbnRoLGg9YS5zZWxlY3RlZFllYXI7Yj10aGlzLl9yZXN0cmljdE1pbk1heChhLHRoaXMuX2RldGVybWluZURhdGUoYSxiLG5ldyBEYXRlKSk7YS5zZWxlY3RlZERheT1hLmN1cnJlbnREYXk9Yi5nZXREYXRlKCk7YS5kcmF3TW9udGg9YS5zZWxlY3RlZE1vbnRoPWEuY3VycmVudE1vbnRoPWIuZ2V0TW9udGgoKTthLmRyYXdZZWFyPWEuc2VsZWN0ZWRZZWFyPWEuY3VycmVudFllYXI9Yi5nZXRGdWxsWWVhcigpO2lmKChmIT1hLnNlbGVjdGVkTW9udGh8fGghPWEuc2VsZWN0ZWRZZWFyKSYmIWMpdGhpcy5fbm90aWZ5Q2hhbmdlKGEpO3RoaXMuX2FkanVzdEluc3REYXRlKGEpO2lmKGEuaW5wdXQpYS5pbnB1dC52YWwoZT8KIiI6dGhpcy5fZm9ybWF0RGF0ZShhKSl9LF9nZXREYXRlOmZ1bmN0aW9uKGEpe3JldHVybiFhLmN1cnJlbnRZZWFyfHxhLmlucHV0JiZhLmlucHV0LnZhbCgpPT0iIj9udWxsOnRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGEuY3VycmVudFllYXIsYS5jdXJyZW50TW9udGgsYS5jdXJyZW50RGF5KSl9LF9nZW5lcmF0ZUhUTUw6ZnVuY3Rpb24oYSl7dmFyIGI9bmV3IERhdGU7Yj10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShiLmdldEZ1bGxZZWFyKCksYi5nZXRNb250aCgpLGIuZ2V0RGF0ZSgpKSk7dmFyIGM9dGhpcy5fZ2V0KGEsImlzUlRMIiksZT10aGlzLl9nZXQoYSwic2hvd0J1dHRvblBhbmVsIiksZj10aGlzLl9nZXQoYSwiaGlkZUlmTm9QcmV2TmV4dCIpLGg9dGhpcy5fZ2V0KGEsIm5hdmlnYXRpb25Bc0RhdGVGb3JtYXQiKSxpPXRoaXMuX2dldE51bWJlck9mTW9udGhzKGEpLGc9dGhpcy5fZ2V0KGEsInNob3dDdXJyZW50QXRQb3MiKSxrPQp0aGlzLl9nZXQoYSwic3RlcE1vbnRocyIpLGw9aVswXSE9MXx8aVsxXSE9MSx1PXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KCFhLmN1cnJlbnREYXk/bmV3IERhdGUoOTk5OSw5LDkpOm5ldyBEYXRlKGEuY3VycmVudFllYXIsYS5jdXJyZW50TW9udGgsYS5jdXJyZW50RGF5KSksaj10aGlzLl9nZXRNaW5NYXhEYXRlKGEsIm1pbiIpLG89dGhpcy5fZ2V0TWluTWF4RGF0ZShhLCJtYXgiKTtnPWEuZHJhd01vbnRoLWc7dmFyIG09YS5kcmF3WWVhcjtpZihnPDApe2crPTEyO20tLX1pZihvKXt2YXIgbj10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShvLmdldEZ1bGxZZWFyKCksby5nZXRNb250aCgpLWlbMF0qaVsxXSsxLG8uZ2V0RGF0ZSgpKSk7Zm9yKG49aiYmbjxqP2o6bjt0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShtLGcsMSkpPm47KXtnLS07aWYoZzwwKXtnPTExO20tLX19fWEuZHJhd01vbnRoPWc7YS5kcmF3WWVhcj1tO249dGhpcy5fZ2V0KGEsCiJwcmV2VGV4dCIpO249IWg/bjp0aGlzLmZvcm1hdERhdGUobix0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShtLGctaywxKSksdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGEpKTtuPXRoaXMuX2NhbkFkanVzdE1vbnRoKGEsLTEsbSxnKT8nPGEgY2xhc3M9InVpLWRhdGVwaWNrZXItcHJldiB1aS1jb3JuZXItYWxsIiBvbmNsaWNrPSJEUF9qUXVlcnlfJyt5KyIuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZSgnIyIrYS5pZCsiJywgLSIraysiLCAnTScpO1wiIHRpdGxlPVwiIituKyciPjxzcGFuIGNsYXNzPSJ1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLScrKGM/ImUiOiJ3IikrJyI+JytuKyI8L3NwYW4+PC9hPiI6Zj8iIjonPGEgY2xhc3M9InVpLWRhdGVwaWNrZXItcHJldiB1aS1jb3JuZXItYWxsIHVpLXN0YXRlLWRpc2FibGVkIiB0aXRsZT0iJytuKyciPjxzcGFuIGNsYXNzPSJ1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLScrKGM/ImUiOiJ3IikrJyI+JysKbisiPC9zcGFuPjwvYT4iO3ZhciByPXRoaXMuX2dldChhLCJuZXh0VGV4dCIpO3I9IWg/cjp0aGlzLmZvcm1hdERhdGUocix0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShtLGcraywxKSksdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGEpKTtmPXRoaXMuX2NhbkFkanVzdE1vbnRoKGEsKzEsbSxnKT8nPGEgY2xhc3M9InVpLWRhdGVwaWNrZXItbmV4dCB1aS1jb3JuZXItYWxsIiBvbmNsaWNrPSJEUF9qUXVlcnlfJyt5KyIuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZSgnIyIrYS5pZCsiJywgKyIraysiLCAnTScpO1wiIHRpdGxlPVwiIityKyciPjxzcGFuIGNsYXNzPSJ1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLScrKGM/InciOiJlIikrJyI+JytyKyI8L3NwYW4+PC9hPiI6Zj8iIjonPGEgY2xhc3M9InVpLWRhdGVwaWNrZXItbmV4dCB1aS1jb3JuZXItYWxsIHVpLXN0YXRlLWRpc2FibGVkIiB0aXRsZT0iJytyKyciPjxzcGFuIGNsYXNzPSJ1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLScrCihjPyJ3IjoiZSIpKyciPicrcisiPC9zcGFuPjwvYT4iO2s9dGhpcy5fZ2V0KGEsImN1cnJlbnRUZXh0Iik7cj10aGlzLl9nZXQoYSwiZ290b0N1cnJlbnQiKSYmYS5jdXJyZW50RGF5P3U6YjtrPSFoP2s6dGhpcy5mb3JtYXREYXRlKGsscix0aGlzLl9nZXRGb3JtYXRDb25maWcoYSkpO2g9IWEuaW5saW5lPyc8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InVpLWRhdGVwaWNrZXItY2xvc2UgdWktc3RhdGUtZGVmYXVsdCB1aS1wcmlvcml0eS1wcmltYXJ5IHVpLWNvcm5lci1hbGwiIG9uY2xpY2s9IkRQX2pRdWVyeV8nK3krJy5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpOyI+Jyt0aGlzLl9nZXQoYSwiY2xvc2VUZXh0IikrIjwvYnV0dG9uPiI6IiI7ZT1lPyc8ZGl2IGNsYXNzPSJ1aS1kYXRlcGlja2VyLWJ1dHRvbnBhbmUgdWktd2lkZ2V0LWNvbnRlbnQiPicrKGM/aDoiIikrKHRoaXMuX2lzSW5SYW5nZShhLHIpPyc8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InVpLWRhdGVwaWNrZXItY3VycmVudCB1aS1zdGF0ZS1kZWZhdWx0IHVpLXByaW9yaXR5LXNlY29uZGFyeSB1aS1jb3JuZXItYWxsIiBvbmNsaWNrPSJEUF9qUXVlcnlfJysKeSsiLmRhdGVwaWNrZXIuX2dvdG9Ub2RheSgnIyIrYS5pZCsiJyk7XCI+IitrKyI8L2J1dHRvbj4iOiIiKSsoYz8iIjpoKSsiPC9kaXY+IjoiIjtoPXBhcnNlSW50KHRoaXMuX2dldChhLCJmaXJzdERheSIpLDEwKTtoPWlzTmFOKGgpPzA6aDtrPXRoaXMuX2dldChhLCJzaG93V2VlayIpO3I9dGhpcy5fZ2V0KGEsImRheU5hbWVzIik7dGhpcy5fZ2V0KGEsImRheU5hbWVzU2hvcnQiKTt2YXIgcz10aGlzLl9nZXQoYSwiZGF5TmFtZXNNaW4iKSx6PXRoaXMuX2dldChhLCJtb250aE5hbWVzIiksdj10aGlzLl9nZXQoYSwibW9udGhOYW1lc1Nob3J0IikscD10aGlzLl9nZXQoYSwiYmVmb3JlU2hvd0RheSIpLHc9dGhpcy5fZ2V0KGEsInNob3dPdGhlck1vbnRocyIpLEg9dGhpcy5fZ2V0KGEsInNlbGVjdE90aGVyTW9udGhzIik7dGhpcy5fZ2V0KGEsImNhbGN1bGF0ZVdlZWsiKTtmb3IodmFyIE09dGhpcy5fZ2V0RGVmYXVsdERhdGUoYSksST0iIixDPTA7QzxpWzBdO0MrKyl7Zm9yKHZhciBOPQoiIixEPTA7RDxpWzFdO0QrKyl7dmFyIEo9dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUobSxnLGEuc2VsZWN0ZWREYXkpKSx0PSIgdWktY29ybmVyLWFsbCIseD0iIjtpZihsKXt4Kz0nPGRpdiBjbGFzcz0idWktZGF0ZXBpY2tlci1ncm91cCc7aWYoaVsxXT4xKXN3aXRjaChEKXtjYXNlIDA6eCs9IiB1aS1kYXRlcGlja2VyLWdyb3VwLWZpcnN0Ijt0PSIgdWktY29ybmVyLSIrKGM/InJpZ2h0IjoibGVmdCIpO2JyZWFrO2Nhc2UgaVsxXS0xOngrPSIgdWktZGF0ZXBpY2tlci1ncm91cC1sYXN0Ijt0PSIgdWktY29ybmVyLSIrKGM/ImxlZnQiOiJyaWdodCIpO2JyZWFrO2RlZmF1bHQ6eCs9IiB1aS1kYXRlcGlja2VyLWdyb3VwLW1pZGRsZSI7dD0iIjticmVha314Kz0nIj4nfXgrPSc8ZGl2IGNsYXNzPSJ1aS1kYXRlcGlja2VyLWhlYWRlciB1aS13aWRnZXQtaGVhZGVyIHVpLWhlbHBlci1jbGVhcmZpeCcrdCsnIj4nKygvYWxsfGxlZnQvLnRlc3QodCkmJkM9PTA/Yz8KZjpuOiIiKSsoL2FsbHxyaWdodC8udGVzdCh0KSYmQz09MD9jP246ZjoiIikrdGhpcy5fZ2VuZXJhdGVNb250aFllYXJIZWFkZXIoYSxnLG0saixvLEM+MHx8RD4wLHosdikrJzwvZGl2Pjx0YWJsZSBjbGFzcz0idWktZGF0ZXBpY2tlci1jYWxlbmRhciI+PHRoZWFkPjx0cj4nO3ZhciBBPWs/Jzx0aCBjbGFzcz0idWktZGF0ZXBpY2tlci13ZWVrLWNvbCI+Jyt0aGlzLl9nZXQoYSwid2Vla0hlYWRlciIpKyI8L3RoPiI6IiI7Zm9yKHQ9MDt0PDc7dCsrKXt2YXIgcT0odCtoKSU3O0ErPSI8dGgiKygodCtoKzYpJTc+PTU/JyBjbGFzcz0idWktZGF0ZXBpY2tlci13ZWVrLWVuZCInOiIiKSsnPjxzcGFuIHRpdGxlPSInK3JbcV0rJyI+JytzW3FdKyI8L3NwYW4+PC90aD4ifXgrPUErIjwvdHI+PC90aGVhZD48dGJvZHk+IjtBPXRoaXMuX2dldERheXNJbk1vbnRoKG0sZyk7aWYobT09YS5zZWxlY3RlZFllYXImJmc9PWEuc2VsZWN0ZWRNb250aClhLnNlbGVjdGVkRGF5PU1hdGgubWluKGEuc2VsZWN0ZWREYXksCkEpO3Q9KHRoaXMuX2dldEZpcnN0RGF5T2ZNb250aChtLGcpLWgrNyklNztBPWw/NjpNYXRoLmNlaWwoKHQrQSkvNyk7cT10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShtLGcsMS10KSk7Zm9yKHZhciBPPTA7TzxBO08rKyl7eCs9Ijx0cj4iO3ZhciBQPSFrPyIiOic8dGQgY2xhc3M9InVpLWRhdGVwaWNrZXItd2Vlay1jb2wiPicrdGhpcy5fZ2V0KGEsImNhbGN1bGF0ZVdlZWsiKShxKSsiPC90ZD4iO2Zvcih0PTA7dDw3O3QrKyl7dmFyIEY9cD9wLmFwcGx5KGEuaW5wdXQ/YS5pbnB1dFswXTpudWxsLFtxXSk6W3RydWUsIiJdLEI9cS5nZXRNb250aCgpIT1nLEs9QiYmIUh8fCFGWzBdfHxqJiZxPGp8fG8mJnE+bztQKz0nPHRkIGNsYXNzPSInKygodCtoKzYpJTc+PTU/IiB1aS1kYXRlcGlja2VyLXdlZWstZW5kIjoiIikrKEI/IiB1aS1kYXRlcGlja2VyLW90aGVyLW1vbnRoIjoiIikrKHEuZ2V0VGltZSgpPT1KLmdldFRpbWUoKSYmZz09YS5zZWxlY3RlZE1vbnRoJiYKYS5fa2V5RXZlbnR8fE0uZ2V0VGltZSgpPT1xLmdldFRpbWUoKSYmTS5nZXRUaW1lKCk9PUouZ2V0VGltZSgpPyIgIit0aGlzLl9kYXlPdmVyQ2xhc3M6IiIpKyhLPyIgIit0aGlzLl91bnNlbGVjdGFibGVDbGFzcysiIHVpLXN0YXRlLWRpc2FibGVkIjoiIikrKEImJiF3PyIiOiIgIitGWzFdKyhxLmdldFRpbWUoKT09dS5nZXRUaW1lKCk/IiAiK3RoaXMuX2N1cnJlbnRDbGFzczoiIikrKHEuZ2V0VGltZSgpPT1iLmdldFRpbWUoKT8iIHVpLWRhdGVwaWNrZXItdG9kYXkiOiIiKSkrJyInKygoIUJ8fHcpJiZGWzJdPycgdGl0bGU9IicrRlsyXSsnIic6IiIpKyhLPyIiOicgb25jbGljaz0iRFBfalF1ZXJ5XycreSsiLmRhdGVwaWNrZXIuX3NlbGVjdERheSgnIyIrYS5pZCsiJywiK3EuZ2V0TW9udGgoKSsiLCIrcS5nZXRGdWxsWWVhcigpKycsIHRoaXMpO3JldHVybiBmYWxzZTsiJykrIj4iKyhCJiYhdz8iJiN4YTA7IjpLPyc8c3BhbiBjbGFzcz0idWktc3RhdGUtZGVmYXVsdCI+JytxLmdldERhdGUoKSsKIjwvc3Bhbj4iOic8YSBjbGFzcz0idWktc3RhdGUtZGVmYXVsdCcrKHEuZ2V0VGltZSgpPT1iLmdldFRpbWUoKT8iIHVpLXN0YXRlLWhpZ2hsaWdodCI6IiIpKyhxLmdldFRpbWUoKT09Si5nZXRUaW1lKCk/IiB1aS1zdGF0ZS1hY3RpdmUiOiIiKSsoQj8iIHVpLXByaW9yaXR5LXNlY29uZGFyeSI6IiIpKyciIGhyZWY9IiMiPicrcS5nZXREYXRlKCkrIjwvYT4iKSsiPC90ZD4iO3Euc2V0RGF0ZShxLmdldERhdGUoKSsxKTtxPXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KHEpfXgrPVArIjwvdHI+In1nKys7aWYoZz4xMSl7Zz0wO20rK314Kz0iPC90Ym9keT48L3RhYmxlPiIrKGw/IjwvZGl2PiIrKGlbMF0+MCYmRD09aVsxXS0xPyc8ZGl2IGNsYXNzPSJ1aS1kYXRlcGlja2VyLXJvdy1icmVhayI+PC9kaXY+JzoiIik6IiIpO04rPXh9SSs9Tn1JKz1lKyhkLmJyb3dzZXIubXNpZSYmcGFyc2VJbnQoZC5icm93c2VyLnZlcnNpb24sMTApPDcmJiFhLmlubGluZT8nPGlmcmFtZSBzcmM9ImphdmFzY3JpcHQ6ZmFsc2U7IiBjbGFzcz0idWktZGF0ZXBpY2tlci1jb3ZlciIgZnJhbWVib3JkZXI9IjAiPjwvaWZyYW1lPic6CiIiKTthLl9rZXlFdmVudD1mYWxzZTtyZXR1cm4gSX0sX2dlbmVyYXRlTW9udGhZZWFySGVhZGVyOmZ1bmN0aW9uKGEsYixjLGUsZixoLGksZyl7dmFyIGs9dGhpcy5fZ2V0KGEsImNoYW5nZU1vbnRoIiksbD10aGlzLl9nZXQoYSwiY2hhbmdlWWVhciIpLHU9dGhpcy5fZ2V0KGEsInNob3dNb250aEFmdGVyWWVhciIpLGo9JzxkaXYgY2xhc3M9InVpLWRhdGVwaWNrZXItdGl0bGUiPicsbz0iIjtpZihofHwhaylvKz0nPHNwYW4gY2xhc3M9InVpLWRhdGVwaWNrZXItbW9udGgiPicraVtiXSsiPC9zcGFuPiI7ZWxzZXtpPWUmJmUuZ2V0RnVsbFllYXIoKT09Yzt2YXIgbT1mJiZmLmdldEZ1bGxZZWFyKCk9PWM7bys9JzxzZWxlY3QgY2xhc3M9InVpLWRhdGVwaWNrZXItbW9udGgiIG9uY2hhbmdlPSJEUF9qUXVlcnlfJyt5KyIuZGF0ZXBpY2tlci5fc2VsZWN0TW9udGhZZWFyKCcjIithLmlkKyInLCB0aGlzLCAnTScpO1wiIG9uY2xpY2s9XCJEUF9qUXVlcnlfIit5KyIuZGF0ZXBpY2tlci5fY2xpY2tNb250aFllYXIoJyMiKwphLmlkKyInKTtcIj4iO2Zvcih2YXIgbj0wO248MTI7bisrKWlmKCghaXx8bj49ZS5nZXRNb250aCgpKSYmKCFtfHxuPD1mLmdldE1vbnRoKCkpKW8rPSc8b3B0aW9uIHZhbHVlPSInK24rJyInKyhuPT1iPycgc2VsZWN0ZWQ9InNlbGVjdGVkIic6IiIpKyI+IitnW25dKyI8L29wdGlvbj4iO28rPSI8L3NlbGVjdD4ifXV8fChqKz1vKyhofHwhKGsmJmwpPyImI3hhMDsiOiIiKSk7aWYoaHx8IWwpais9JzxzcGFuIGNsYXNzPSJ1aS1kYXRlcGlja2VyLXllYXIiPicrYysiPC9zcGFuPiI7ZWxzZXtnPXRoaXMuX2dldChhLCJ5ZWFyUmFuZ2UiKS5zcGxpdCgiOiIpO3ZhciByPShuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKTtpPWZ1bmN0aW9uKHMpe3M9cy5tYXRjaCgvY1srLV0uKi8pP2MrcGFyc2VJbnQocy5zdWJzdHJpbmcoMSksMTApOnMubWF0Y2goL1srLV0uKi8pP3IrcGFyc2VJbnQocywxMCk6cGFyc2VJbnQocywxMCk7cmV0dXJuIGlzTmFOKHMpP3I6c307Yj1pKGdbMF0pO2c9TWF0aC5tYXgoYiwKaShnWzFdfHwiIikpO2I9ZT9NYXRoLm1heChiLGUuZ2V0RnVsbFllYXIoKSk6YjtnPWY/TWF0aC5taW4oZyxmLmdldEZ1bGxZZWFyKCkpOmc7Zm9yKGorPSc8c2VsZWN0IGNsYXNzPSJ1aS1kYXRlcGlja2VyLXllYXIiIG9uY2hhbmdlPSJEUF9qUXVlcnlfJyt5KyIuZGF0ZXBpY2tlci5fc2VsZWN0TW9udGhZZWFyKCcjIithLmlkKyInLCB0aGlzLCAnWScpO1wiIG9uY2xpY2s9XCJEUF9qUXVlcnlfIit5KyIuZGF0ZXBpY2tlci5fY2xpY2tNb250aFllYXIoJyMiK2EuaWQrIicpO1wiPiI7Yjw9ZztiKyspais9JzxvcHRpb24gdmFsdWU9IicrYisnIicrKGI9PWM/JyBzZWxlY3RlZD0ic2VsZWN0ZWQiJzoiIikrIj4iK2IrIjwvb3B0aW9uPiI7ais9Ijwvc2VsZWN0PiJ9ais9dGhpcy5fZ2V0KGEsInllYXJTdWZmaXgiKTtpZih1KWorPShofHwhKGsmJmwpPyImI3hhMDsiOiIiKStvO2orPSI8L2Rpdj4iO3JldHVybiBqfSxfYWRqdXN0SW5zdERhdGU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBlPQphLmRyYXdZZWFyKyhjPT0iWSI/YjowKSxmPWEuZHJhd01vbnRoKyhjPT0iTSI/YjowKTtiPU1hdGgubWluKGEuc2VsZWN0ZWREYXksdGhpcy5fZ2V0RGF5c0luTW9udGgoZSxmKSkrKGM9PSJEIj9iOjApO2U9dGhpcy5fcmVzdHJpY3RNaW5NYXgoYSx0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShlLGYsYikpKTthLnNlbGVjdGVkRGF5PWUuZ2V0RGF0ZSgpO2EuZHJhd01vbnRoPWEuc2VsZWN0ZWRNb250aD1lLmdldE1vbnRoKCk7YS5kcmF3WWVhcj1hLnNlbGVjdGVkWWVhcj1lLmdldEZ1bGxZZWFyKCk7aWYoYz09Ik0ifHxjPT0iWSIpdGhpcy5fbm90aWZ5Q2hhbmdlKGEpfSxfcmVzdHJpY3RNaW5NYXg6ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLl9nZXRNaW5NYXhEYXRlKGEsIm1pbiIpO2E9dGhpcy5fZ2V0TWluTWF4RGF0ZShhLCJtYXgiKTtiPWMmJmI8Yz9jOmI7cmV0dXJuIGI9YSYmYj5hP2E6Yn0sX25vdGlmeUNoYW5nZTpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9nZXQoYSwKIm9uQ2hhbmdlTW9udGhZZWFyIik7aWYoYiliLmFwcGx5KGEuaW5wdXQ/YS5pbnB1dFswXTpudWxsLFthLnNlbGVjdGVkWWVhcixhLnNlbGVjdGVkTW9udGgrMSxhXSl9LF9nZXROdW1iZXJPZk1vbnRoczpmdW5jdGlvbihhKXthPXRoaXMuX2dldChhLCJudW1iZXJPZk1vbnRocyIpO3JldHVybiBhPT1udWxsP1sxLDFdOnR5cGVvZiBhPT0ibnVtYmVyIj9bMSxhXTphfSxfZ2V0TWluTWF4RGF0ZTpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLl9kZXRlcm1pbmVEYXRlKGEsdGhpcy5fZ2V0KGEsYisiRGF0ZSIpLG51bGwpfSxfZ2V0RGF5c0luTW9udGg6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gMzItKG5ldyBEYXRlKGEsYiwzMikpLmdldERhdGUoKX0sX2dldEZpcnN0RGF5T2ZNb250aDpmdW5jdGlvbihhLGIpe3JldHVybihuZXcgRGF0ZShhLGIsMSkpLmdldERheSgpfSxfY2FuQWRqdXN0TW9udGg6ZnVuY3Rpb24oYSxiLGMsZSl7dmFyIGY9dGhpcy5fZ2V0TnVtYmVyT2ZNb250aHMoYSk7CmM9dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoYyxlKyhiPDA/YjpmWzBdKmZbMV0pLDEpKTtiPDAmJmMuc2V0RGF0ZSh0aGlzLl9nZXREYXlzSW5Nb250aChjLmdldEZ1bGxZZWFyKCksYy5nZXRNb250aCgpKSk7cmV0dXJuIHRoaXMuX2lzSW5SYW5nZShhLGMpfSxfaXNJblJhbmdlOmZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5fZ2V0TWluTWF4RGF0ZShhLCJtaW4iKTthPXRoaXMuX2dldE1pbk1heERhdGUoYSwibWF4Iik7cmV0dXJuKCFjfHxiLmdldFRpbWUoKT49Yy5nZXRUaW1lKCkpJiYoIWF8fGIuZ2V0VGltZSgpPD1hLmdldFRpbWUoKSl9LF9nZXRGb3JtYXRDb25maWc6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fZ2V0KGEsInNob3J0WWVhckN1dG9mZiIpO2I9dHlwZW9mIGIhPSJzdHJpbmciP2I6KG5ldyBEYXRlKS5nZXRGdWxsWWVhcigpJTEwMCtwYXJzZUludChiLDEwKTtyZXR1cm57c2hvcnRZZWFyQ3V0b2ZmOmIsZGF5TmFtZXNTaG9ydDp0aGlzLl9nZXQoYSwKImRheU5hbWVzU2hvcnQiKSxkYXlOYW1lczp0aGlzLl9nZXQoYSwiZGF5TmFtZXMiKSxtb250aE5hbWVzU2hvcnQ6dGhpcy5fZ2V0KGEsIm1vbnRoTmFtZXNTaG9ydCIpLG1vbnRoTmFtZXM6dGhpcy5fZ2V0KGEsIm1vbnRoTmFtZXMiKX19LF9mb3JtYXREYXRlOmZ1bmN0aW9uKGEsYixjLGUpe2lmKCFiKXthLmN1cnJlbnREYXk9YS5zZWxlY3RlZERheTthLmN1cnJlbnRNb250aD1hLnNlbGVjdGVkTW9udGg7YS5jdXJyZW50WWVhcj1hLnNlbGVjdGVkWWVhcn1iPWI/dHlwZW9mIGI9PSJvYmplY3QiP2I6dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoZSxjLGIpKTp0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShhLmN1cnJlbnRZZWFyLGEuY3VycmVudE1vbnRoLGEuY3VycmVudERheSkpO3JldHVybiB0aGlzLmZvcm1hdERhdGUodGhpcy5fZ2V0KGEsImRhdGVGb3JtYXQiKSxiLHRoaXMuX2dldEZvcm1hdENvbmZpZyhhKSl9fSk7ZC5mbi5kYXRlcGlja2VyPQpmdW5jdGlvbihhKXtpZighZC5kYXRlcGlja2VyLmluaXRpYWxpemVkKXtkKGRvY3VtZW50KS5tb3VzZWRvd24oZC5kYXRlcGlja2VyLl9jaGVja0V4dGVybmFsQ2xpY2spLmZpbmQoImJvZHkiKS5hcHBlbmQoZC5kYXRlcGlja2VyLmRwRGl2KTtkLmRhdGVwaWNrZXIuaW5pdGlhbGl6ZWQ9dHJ1ZX12YXIgYj1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7aWYodHlwZW9mIGE9PSJzdHJpbmciJiYoYT09ImlzRGlzYWJsZWQifHxhPT0iZ2V0RGF0ZSJ8fGE9PSJ3aWRnZXQiKSlyZXR1cm4gZC5kYXRlcGlja2VyWyJfIithKyJEYXRlcGlja2VyIl0uYXBwbHkoZC5kYXRlcGlja2VyLFt0aGlzWzBdXS5jb25jYXQoYikpO2lmKGE9PSJvcHRpb24iJiZhcmd1bWVudHMubGVuZ3RoPT0yJiZ0eXBlb2YgYXJndW1lbnRzWzFdPT0ic3RyaW5nIilyZXR1cm4gZC5kYXRlcGlja2VyWyJfIithKyJEYXRlcGlja2VyIl0uYXBwbHkoZC5kYXRlcGlja2VyLFt0aGlzWzBdXS5jb25jYXQoYikpOwpyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dHlwZW9mIGE9PSJzdHJpbmciP2QuZGF0ZXBpY2tlclsiXyIrYSsiRGF0ZXBpY2tlciJdLmFwcGx5KGQuZGF0ZXBpY2tlcixbdGhpc10uY29uY2F0KGIpKTpkLmRhdGVwaWNrZXIuX2F0dGFjaERhdGVwaWNrZXIodGhpcyxhKX0pfTtkLmRhdGVwaWNrZXI9bmV3IEw7ZC5kYXRlcGlja2VyLmluaXRpYWxpemVkPWZhbHNlO2QuZGF0ZXBpY2tlci51dWlkPShuZXcgRGF0ZSkuZ2V0VGltZSgpO2QuZGF0ZXBpY2tlci52ZXJzaW9uPSIxLjguNSI7d2luZG93WyJEUF9qUXVlcnlfIit5XT1kfSkoalF1ZXJ5KTsKKGZ1bmN0aW9uKGMsail7Yy53aWRnZXQoInVpLmRpYWxvZyIse29wdGlvbnM6e2F1dG9PcGVuOnRydWUsYnV0dG9uczp7fSxjbG9zZU9uRXNjYXBlOnRydWUsY2xvc2VUZXh0OiJjbG9zZSIsZGlhbG9nQ2xhc3M6IiIsZHJhZ2dhYmxlOnRydWUsaGlkZTpudWxsLGhlaWdodDoiYXV0byIsbWF4SGVpZ2h0OmZhbHNlLG1heFdpZHRoOmZhbHNlLG1pbkhlaWdodDoxNTAsbWluV2lkdGg6MTUwLG1vZGFsOmZhbHNlLHBvc2l0aW9uOntteToiY2VudGVyIixhdDoiY2VudGVyIixvZjp3aW5kb3csY29sbGlzaW9uOiJmaXQiLHVzaW5nOmZ1bmN0aW9uKGEpe3ZhciBiPWModGhpcykuY3NzKGEpLm9mZnNldCgpLnRvcDtiPDAmJmModGhpcykuY3NzKCJ0b3AiLGEudG9wLWIpfX0scmVzaXphYmxlOnRydWUsc2hvdzpudWxsLHN0YWNrOnRydWUsdGl0bGU6IiIsd2lkdGg6MzAwLHpJbmRleDoxRTN9LF9jcmVhdGU6ZnVuY3Rpb24oKXt0aGlzLm9yaWdpbmFsVGl0bGU9dGhpcy5lbGVtZW50LmF0dHIoInRpdGxlIik7CmlmKHR5cGVvZiB0aGlzLm9yaWdpbmFsVGl0bGUhPT0ic3RyaW5nIil0aGlzLm9yaWdpbmFsVGl0bGU9IiI7dGhpcy5vcHRpb25zLnRpdGxlPXRoaXMub3B0aW9ucy50aXRsZXx8dGhpcy5vcmlnaW5hbFRpdGxlO3ZhciBhPXRoaXMsYj1hLm9wdGlvbnMsZD1iLnRpdGxlfHwiJiMxNjA7IixmPWMudWkuZGlhbG9nLmdldFRpdGxlSWQoYS5lbGVtZW50KSxnPShhLnVpRGlhbG9nPWMoIjxkaXY+PC9kaXY+IikpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLmhpZGUoKS5hZGRDbGFzcygidWktZGlhbG9nIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsICIrYi5kaWFsb2dDbGFzcykuY3NzKHt6SW5kZXg6Yi56SW5kZXh9KS5hdHRyKCJ0YWJJbmRleCIsLTEpLmNzcygib3V0bGluZSIsMCkua2V5ZG93bihmdW5jdGlvbihpKXtpZihiLmNsb3NlT25Fc2NhcGUmJmkua2V5Q29kZSYmaS5rZXlDb2RlPT09Yy51aS5rZXlDb2RlLkVTQ0FQRSl7YS5jbG9zZShpKTtpLnByZXZlbnREZWZhdWx0KCl9fSkuYXR0cih7cm9sZToiZGlhbG9nIiwKImFyaWEtbGFiZWxsZWRieSI6Zn0pLm1vdXNlZG93bihmdW5jdGlvbihpKXthLm1vdmVUb1RvcChmYWxzZSxpKX0pO2EuZWxlbWVudC5zaG93KCkucmVtb3ZlQXR0cigidGl0bGUiKS5hZGRDbGFzcygidWktZGlhbG9nLWNvbnRlbnQgdWktd2lkZ2V0LWNvbnRlbnQiKS5hcHBlbmRUbyhnKTt2YXIgZT0oYS51aURpYWxvZ1RpdGxlYmFyPWMoIjxkaXY+PC9kaXY+IikpLmFkZENsYXNzKCJ1aS1kaWFsb2ctdGl0bGViYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYWxsIHVpLWhlbHBlci1jbGVhcmZpeCIpLnByZXBlbmRUbyhnKSxoPWMoJzxhIGhyZWY9IiMiPjwvYT4nKS5hZGRDbGFzcygidWktZGlhbG9nLXRpdGxlYmFyLWNsb3NlIHVpLWNvcm5lci1hbGwiKS5hdHRyKCJyb2xlIiwiYnV0dG9uIikuaG92ZXIoZnVuY3Rpb24oKXtoLmFkZENsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpfSxmdW5jdGlvbigpe2gucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWhvdmVyIil9KS5mb2N1cyhmdW5jdGlvbigpe2guYWRkQ2xhc3MoInVpLXN0YXRlLWZvY3VzIil9KS5ibHVyKGZ1bmN0aW9uKCl7aC5yZW1vdmVDbGFzcygidWktc3RhdGUtZm9jdXMiKX0pLmNsaWNrKGZ1bmN0aW9uKGkpe2EuY2xvc2UoaSk7CnJldHVybiBmYWxzZX0pLmFwcGVuZFRvKGUpOyhhLnVpRGlhbG9nVGl0bGViYXJDbG9zZVRleHQ9YygiPHNwYW4+PC9zcGFuPiIpKS5hZGRDbGFzcygidWktaWNvbiB1aS1pY29uLWNsb3NldGhpY2siKS50ZXh0KGIuY2xvc2VUZXh0KS5hcHBlbmRUbyhoKTtjKCI8c3Bhbj48L3NwYW4+IikuYWRkQ2xhc3MoInVpLWRpYWxvZy10aXRsZSIpLmF0dHIoImlkIixmKS5odG1sKGQpLnByZXBlbmRUbyhlKTtpZihjLmlzRnVuY3Rpb24oYi5iZWZvcmVjbG9zZSkmJiFjLmlzRnVuY3Rpb24oYi5iZWZvcmVDbG9zZSkpYi5iZWZvcmVDbG9zZT1iLmJlZm9yZWNsb3NlO2UuZmluZCgiKiIpLmFkZChlKS5kaXNhYmxlU2VsZWN0aW9uKCk7Yi5kcmFnZ2FibGUmJmMuZm4uZHJhZ2dhYmxlJiZhLl9tYWtlRHJhZ2dhYmxlKCk7Yi5yZXNpemFibGUmJmMuZm4ucmVzaXphYmxlJiZhLl9tYWtlUmVzaXphYmxlKCk7YS5fY3JlYXRlQnV0dG9ucyhiLmJ1dHRvbnMpO2EuX2lzT3Blbj1mYWxzZTtjLmZuLmJnaWZyYW1lJiYKZy5iZ2lmcmFtZSgpfSxfaW5pdDpmdW5jdGlvbigpe3RoaXMub3B0aW9ucy5hdXRvT3BlbiYmdGhpcy5vcGVuKCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2Eub3ZlcmxheSYmYS5vdmVybGF5LmRlc3Ryb3koKTthLnVpRGlhbG9nLmhpZGUoKTthLmVsZW1lbnQudW5iaW5kKCIuZGlhbG9nIikucmVtb3ZlRGF0YSgiZGlhbG9nIikucmVtb3ZlQ2xhc3MoInVpLWRpYWxvZy1jb250ZW50IHVpLXdpZGdldC1jb250ZW50IikuaGlkZSgpLmFwcGVuZFRvKCJib2R5Iik7YS51aURpYWxvZy5yZW1vdmUoKTthLm9yaWdpbmFsVGl0bGUmJmEuZWxlbWVudC5hdHRyKCJ0aXRsZSIsYS5vcmlnaW5hbFRpdGxlKTtyZXR1cm4gYX0sd2lkZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudWlEaWFsb2d9LGNsb3NlOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMsZDtpZihmYWxzZSE9PWIuX3RyaWdnZXIoImJlZm9yZUNsb3NlIixhKSl7Yi5vdmVybGF5JiZiLm92ZXJsYXkuZGVzdHJveSgpO2IudWlEaWFsb2cudW5iaW5kKCJrZXlwcmVzcy51aS1kaWFsb2ciKTsKYi5faXNPcGVuPWZhbHNlO2lmKGIub3B0aW9ucy5oaWRlKWIudWlEaWFsb2cuaGlkZShiLm9wdGlvbnMuaGlkZSxmdW5jdGlvbigpe2IuX3RyaWdnZXIoImNsb3NlIixhKX0pO2Vsc2V7Yi51aURpYWxvZy5oaWRlKCk7Yi5fdHJpZ2dlcigiY2xvc2UiLGEpfWMudWkuZGlhbG9nLm92ZXJsYXkucmVzaXplKCk7aWYoYi5vcHRpb25zLm1vZGFsKXtkPTA7YygiLnVpLWRpYWxvZyIpLmVhY2goZnVuY3Rpb24oKXtpZih0aGlzIT09Yi51aURpYWxvZ1swXSlkPU1hdGgubWF4KGQsYyh0aGlzKS5jc3MoInotaW5kZXgiKSl9KTtjLnVpLmRpYWxvZy5tYXhaPWR9cmV0dXJuIGJ9fSxpc09wZW46ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5faXNPcGVufSxtb3ZlVG9Ub3A6ZnVuY3Rpb24oYSxiKXt2YXIgZD10aGlzLGY9ZC5vcHRpb25zO2lmKGYubW9kYWwmJiFhfHwhZi5zdGFjayYmIWYubW9kYWwpcmV0dXJuIGQuX3RyaWdnZXIoImZvY3VzIixiKTtpZihmLnpJbmRleD5jLnVpLmRpYWxvZy5tYXhaKWMudWkuZGlhbG9nLm1heFo9CmYuekluZGV4O2lmKGQub3ZlcmxheSl7Yy51aS5kaWFsb2cubWF4Wis9MTtkLm92ZXJsYXkuJGVsLmNzcygiei1pbmRleCIsYy51aS5kaWFsb2cub3ZlcmxheS5tYXhaPWMudWkuZGlhbG9nLm1heFopfWE9e3Njcm9sbFRvcDpkLmVsZW1lbnQuYXR0cigic2Nyb2xsVG9wIiksc2Nyb2xsTGVmdDpkLmVsZW1lbnQuYXR0cigic2Nyb2xsTGVmdCIpfTtjLnVpLmRpYWxvZy5tYXhaKz0xO2QudWlEaWFsb2cuY3NzKCJ6LWluZGV4IixjLnVpLmRpYWxvZy5tYXhaKTtkLmVsZW1lbnQuYXR0cihhKTtkLl90cmlnZ2VyKCJmb2N1cyIsYik7cmV0dXJuIGR9LG9wZW46ZnVuY3Rpb24oKXtpZighdGhpcy5faXNPcGVuKXt2YXIgYT10aGlzLGI9YS5vcHRpb25zLGQ9YS51aURpYWxvZzthLm92ZXJsYXk9Yi5tb2RhbD9uZXcgYy51aS5kaWFsb2cub3ZlcmxheShhKTpudWxsO2QubmV4dCgpLmxlbmd0aCYmZC5hcHBlbmRUbygiYm9keSIpO2EuX3NpemUoKTthLl9wb3NpdGlvbihiLnBvc2l0aW9uKTtkLnNob3coYi5zaG93KTsKYS5tb3ZlVG9Ub3AodHJ1ZSk7Yi5tb2RhbCYmZC5iaW5kKCJrZXlwcmVzcy51aS1kaWFsb2ciLGZ1bmN0aW9uKGYpe2lmKGYua2V5Q29kZT09PWMudWkua2V5Q29kZS5UQUIpe3ZhciBnPWMoIjp0YWJiYWJsZSIsdGhpcyksZT1nLmZpbHRlcigiOmZpcnN0Iik7Zz1nLmZpbHRlcigiOmxhc3QiKTtpZihmLnRhcmdldD09PWdbMF0mJiFmLnNoaWZ0S2V5KXtlLmZvY3VzKDEpO3JldHVybiBmYWxzZX1lbHNlIGlmKGYudGFyZ2V0PT09ZVswXSYmZi5zaGlmdEtleSl7Zy5mb2N1cygxKTtyZXR1cm4gZmFsc2V9fX0pO2MoYS5lbGVtZW50LmZpbmQoIjp0YWJiYWJsZSIpLmdldCgpLmNvbmNhdChkLmZpbmQoIi51aS1kaWFsb2ctYnV0dG9ucGFuZSA6dGFiYmFibGUiKS5nZXQoKS5jb25jYXQoZC5nZXQoKSkpKS5lcSgwKS5mb2N1cygpO2EuX2lzT3Blbj10cnVlO2EuX3RyaWdnZXIoIm9wZW4iKTtyZXR1cm4gYX19LF9jcmVhdGVCdXR0b25zOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMsZD1mYWxzZSwKZj1jKCI8ZGl2PjwvZGl2PiIpLmFkZENsYXNzKCJ1aS1kaWFsb2ctYnV0dG9ucGFuZSB1aS13aWRnZXQtY29udGVudCB1aS1oZWxwZXItY2xlYXJmaXgiKSxnPWMoIjxkaXY+PC9kaXY+IikuYWRkQ2xhc3MoInVpLWRpYWxvZy1idXR0b25zZXQiKS5hcHBlbmRUbyhmKTtiLnVpRGlhbG9nLmZpbmQoIi51aS1kaWFsb2ctYnV0dG9ucGFuZSIpLnJlbW92ZSgpO3R5cGVvZiBhPT09Im9iamVjdCImJmEhPT1udWxsJiZjLmVhY2goYSxmdW5jdGlvbigpe3JldHVybiEoZD10cnVlKX0pO2lmKGQpe2MuZWFjaChhLGZ1bmN0aW9uKGUsaCl7aD1jLmlzRnVuY3Rpb24oaCk/e2NsaWNrOmgsdGV4dDplfTpoO2U9YygiPGJ1dHRvbj48L2J1dHRvbj4iLGgpLnVuYmluZCgiY2xpY2siKS5jbGljayhmdW5jdGlvbigpe2guY2xpY2suYXBwbHkoYi5lbGVtZW50WzBdLGFyZ3VtZW50cyl9KS5hcHBlbmRUbyhnKTtjLmZuLmJ1dHRvbiYmZS5idXR0b24oKX0pO2YuYXBwZW5kVG8oYi51aURpYWxvZyl9fSxfbWFrZURyYWdnYWJsZTpmdW5jdGlvbigpe2Z1bmN0aW9uIGEoZSl7cmV0dXJue3Bvc2l0aW9uOmUucG9zaXRpb24sCm9mZnNldDplLm9mZnNldH19dmFyIGI9dGhpcyxkPWIub3B0aW9ucyxmPWMoZG9jdW1lbnQpLGc7Yi51aURpYWxvZy5kcmFnZ2FibGUoe2NhbmNlbDoiLnVpLWRpYWxvZy1jb250ZW50LCAudWktZGlhbG9nLXRpdGxlYmFyLWNsb3NlIixoYW5kbGU6Ii51aS1kaWFsb2ctdGl0bGViYXIiLGNvbnRhaW5tZW50OiJkb2N1bWVudCIsc3RhcnQ6ZnVuY3Rpb24oZSxoKXtnPWQuaGVpZ2h0PT09ImF1dG8iPyJhdXRvIjpjKHRoaXMpLmhlaWdodCgpO2ModGhpcykuaGVpZ2h0KGModGhpcykuaGVpZ2h0KCkpLmFkZENsYXNzKCJ1aS1kaWFsb2ctZHJhZ2dpbmciKTtiLl90cmlnZ2VyKCJkcmFnU3RhcnQiLGUsYShoKSl9LGRyYWc6ZnVuY3Rpb24oZSxoKXtiLl90cmlnZ2VyKCJkcmFnIixlLGEoaCkpfSxzdG9wOmZ1bmN0aW9uKGUsaCl7ZC5wb3NpdGlvbj1baC5wb3NpdGlvbi5sZWZ0LWYuc2Nyb2xsTGVmdCgpLGgucG9zaXRpb24udG9wLWYuc2Nyb2xsVG9wKCldO2ModGhpcykucmVtb3ZlQ2xhc3MoInVpLWRpYWxvZy1kcmFnZ2luZyIpLmhlaWdodChnKTsKYi5fdHJpZ2dlcigiZHJhZ1N0b3AiLGUsYShoKSk7Yy51aS5kaWFsb2cub3ZlcmxheS5yZXNpemUoKX19KX0sX21ha2VSZXNpemFibGU6ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihlKXtyZXR1cm57b3JpZ2luYWxQb3NpdGlvbjplLm9yaWdpbmFsUG9zaXRpb24sb3JpZ2luYWxTaXplOmUub3JpZ2luYWxTaXplLHBvc2l0aW9uOmUucG9zaXRpb24sc2l6ZTplLnNpemV9fWE9YT09PWo/dGhpcy5vcHRpb25zLnJlc2l6YWJsZTphO3ZhciBkPXRoaXMsZj1kLm9wdGlvbnMsZz1kLnVpRGlhbG9nLmNzcygicG9zaXRpb24iKTthPXR5cGVvZiBhPT09InN0cmluZyI/YToibixlLHMsdyxzZSxzdyxuZSxudyI7ZC51aURpYWxvZy5yZXNpemFibGUoe2NhbmNlbDoiLnVpLWRpYWxvZy1jb250ZW50Iixjb250YWlubWVudDoiZG9jdW1lbnQiLGFsc29SZXNpemU6ZC5lbGVtZW50LG1heFdpZHRoOmYubWF4V2lkdGgsbWF4SGVpZ2h0OmYubWF4SGVpZ2h0LG1pbldpZHRoOmYubWluV2lkdGgsbWluSGVpZ2h0OmQuX21pbkhlaWdodCgpLApoYW5kbGVzOmEsc3RhcnQ6ZnVuY3Rpb24oZSxoKXtjKHRoaXMpLmFkZENsYXNzKCJ1aS1kaWFsb2ctcmVzaXppbmciKTtkLl90cmlnZ2VyKCJyZXNpemVTdGFydCIsZSxiKGgpKX0scmVzaXplOmZ1bmN0aW9uKGUsaCl7ZC5fdHJpZ2dlcigicmVzaXplIixlLGIoaCkpfSxzdG9wOmZ1bmN0aW9uKGUsaCl7Yyh0aGlzKS5yZW1vdmVDbGFzcygidWktZGlhbG9nLXJlc2l6aW5nIik7Zi5oZWlnaHQ9Yyh0aGlzKS5oZWlnaHQoKTtmLndpZHRoPWModGhpcykud2lkdGgoKTtkLl90cmlnZ2VyKCJyZXNpemVTdG9wIixlLGIoaCkpO2MudWkuZGlhbG9nLm92ZXJsYXkucmVzaXplKCl9fSkuY3NzKCJwb3NpdGlvbiIsZykuZmluZCgiLnVpLXJlc2l6YWJsZS1zZSIpLmFkZENsYXNzKCJ1aS1pY29uIHVpLWljb24tZ3JpcC1kaWFnb25hbC1zZSIpfSxfbWluSGVpZ2h0OmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vcHRpb25zO3JldHVybiBhLmhlaWdodD09PSJhdXRvIj9hLm1pbkhlaWdodDpNYXRoLm1pbihhLm1pbkhlaWdodCwKYS5oZWlnaHQpfSxfcG9zaXRpb246ZnVuY3Rpb24oYSl7dmFyIGI9W10sZD1bMCwwXSxmO2lmKGEpe2lmKHR5cGVvZiBhPT09InN0cmluZyJ8fHR5cGVvZiBhPT09Im9iamVjdCImJiIwImluIGEpe2I9YS5zcGxpdD9hLnNwbGl0KCIgIik6W2FbMF0sYVsxXV07aWYoYi5sZW5ndGg9PT0xKWJbMV09YlswXTtjLmVhY2goWyJsZWZ0IiwidG9wIl0sZnVuY3Rpb24oZyxlKXtpZigrYltnXT09PWJbZ10pe2RbZ109YltnXTtiW2ddPWV9fSk7YT17bXk6Yi5qb2luKCIgIiksYXQ6Yi5qb2luKCIgIiksb2Zmc2V0OmQuam9pbigiICIpfX1hPWMuZXh0ZW5kKHt9LGMudWkuZGlhbG9nLnByb3RvdHlwZS5vcHRpb25zLnBvc2l0aW9uLGEpfWVsc2UgYT1jLnVpLmRpYWxvZy5wcm90b3R5cGUub3B0aW9ucy5wb3NpdGlvbjsoZj10aGlzLnVpRGlhbG9nLmlzKCI6dmlzaWJsZSIpKXx8dGhpcy51aURpYWxvZy5zaG93KCk7dGhpcy51aURpYWxvZy5jc3Moe3RvcDowLGxlZnQ6MH0pLnBvc2l0aW9uKGEpOwpmfHx0aGlzLnVpRGlhbG9nLmhpZGUoKX0sX3NldE9wdGlvbjpmdW5jdGlvbihhLGIpe3ZhciBkPXRoaXMsZj1kLnVpRGlhbG9nLGc9Zi5pcygiOmRhdGEocmVzaXphYmxlKSIpLGU9ZmFsc2U7c3dpdGNoKGEpe2Nhc2UgImJlZm9yZWNsb3NlIjphPSJiZWZvcmVDbG9zZSI7YnJlYWs7Y2FzZSAiYnV0dG9ucyI6ZC5fY3JlYXRlQnV0dG9ucyhiKTtlPXRydWU7YnJlYWs7Y2FzZSAiY2xvc2VUZXh0IjpkLnVpRGlhbG9nVGl0bGViYXJDbG9zZVRleHQudGV4dCgiIitiKTticmVhaztjYXNlICJkaWFsb2dDbGFzcyI6Zi5yZW1vdmVDbGFzcyhkLm9wdGlvbnMuZGlhbG9nQ2xhc3MpLmFkZENsYXNzKCJ1aS1kaWFsb2cgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwgIitiKTticmVhaztjYXNlICJkaXNhYmxlZCI6Yj9mLmFkZENsYXNzKCJ1aS1kaWFsb2ctZGlzYWJsZWQiKTpmLnJlbW92ZUNsYXNzKCJ1aS1kaWFsb2ctZGlzYWJsZWQiKTticmVhaztjYXNlICJkcmFnZ2FibGUiOmI/CmQuX21ha2VEcmFnZ2FibGUoKTpmLmRyYWdnYWJsZSgiZGVzdHJveSIpO2JyZWFrO2Nhc2UgImhlaWdodCI6ZT10cnVlO2JyZWFrO2Nhc2UgIm1heEhlaWdodCI6ZyYmZi5yZXNpemFibGUoIm9wdGlvbiIsIm1heEhlaWdodCIsYik7ZT10cnVlO2JyZWFrO2Nhc2UgIm1heFdpZHRoIjpnJiZmLnJlc2l6YWJsZSgib3B0aW9uIiwibWF4V2lkdGgiLGIpO2U9dHJ1ZTticmVhaztjYXNlICJtaW5IZWlnaHQiOmcmJmYucmVzaXphYmxlKCJvcHRpb24iLCJtaW5IZWlnaHQiLGIpO2U9dHJ1ZTticmVhaztjYXNlICJtaW5XaWR0aCI6ZyYmZi5yZXNpemFibGUoIm9wdGlvbiIsIm1pbldpZHRoIixiKTtlPXRydWU7YnJlYWs7Y2FzZSAicG9zaXRpb24iOmQuX3Bvc2l0aW9uKGIpO2JyZWFrO2Nhc2UgInJlc2l6YWJsZSI6ZyYmIWImJmYucmVzaXphYmxlKCJkZXN0cm95Iik7ZyYmdHlwZW9mIGI9PT0ic3RyaW5nIiYmZi5yZXNpemFibGUoIm9wdGlvbiIsImhhbmRsZXMiLGIpOyFnJiZiIT09ZmFsc2UmJgpkLl9tYWtlUmVzaXphYmxlKGIpO2JyZWFrO2Nhc2UgInRpdGxlIjpjKCIudWktZGlhbG9nLXRpdGxlIixkLnVpRGlhbG9nVGl0bGViYXIpLmh0bWwoIiIrKGJ8fCImIzE2MDsiKSk7YnJlYWs7Y2FzZSAid2lkdGgiOmU9dHJ1ZTticmVha31jLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseShkLGFyZ3VtZW50cyk7ZSYmZC5fc2l6ZSgpfSxfc2l6ZTpmdW5jdGlvbigpe3ZhciBhPXRoaXMub3B0aW9ucyxiO3RoaXMuZWxlbWVudC5jc3Moe3dpZHRoOiJhdXRvIixtaW5IZWlnaHQ6MCxoZWlnaHQ6MH0pO2lmKGEubWluV2lkdGg+YS53aWR0aClhLndpZHRoPWEubWluV2lkdGg7Yj10aGlzLnVpRGlhbG9nLmNzcyh7aGVpZ2h0OiJhdXRvIix3aWR0aDphLndpZHRofSkuaGVpZ2h0KCk7dGhpcy5lbGVtZW50LmNzcyhhLmhlaWdodD09PSJhdXRvIj97bWluSGVpZ2h0Ok1hdGgubWF4KGEubWluSGVpZ2h0LWIsMCksaGVpZ2h0OmMuc3VwcG9ydC5taW5IZWlnaHQ/ImF1dG8iOk1hdGgubWF4KGEubWluSGVpZ2h0LQpiLDApfTp7bWluSGVpZ2h0OjAsaGVpZ2h0Ok1hdGgubWF4KGEuaGVpZ2h0LWIsMCl9KS5zaG93KCk7dGhpcy51aURpYWxvZy5pcygiOmRhdGEocmVzaXphYmxlKSIpJiZ0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZSgib3B0aW9uIiwibWluSGVpZ2h0Iix0aGlzLl9taW5IZWlnaHQoKSl9fSk7Yy5leHRlbmQoYy51aS5kaWFsb2cse3ZlcnNpb246IjEuOC41Iix1dWlkOjAsbWF4WjowLGdldFRpdGxlSWQ6ZnVuY3Rpb24oYSl7YT1hLmF0dHIoImlkIik7aWYoIWEpe3RoaXMudXVpZCs9MTthPXRoaXMudXVpZH1yZXR1cm4idWktZGlhbG9nLXRpdGxlLSIrYX0sb3ZlcmxheTpmdW5jdGlvbihhKXt0aGlzLiRlbD1jLnVpLmRpYWxvZy5vdmVybGF5LmNyZWF0ZShhKX19KTtjLmV4dGVuZChjLnVpLmRpYWxvZy5vdmVybGF5LHtpbnN0YW5jZXM6W10sb2xkSW5zdGFuY2VzOltdLG1heFo6MCxldmVudHM6Yy5tYXAoImZvY3VzLG1vdXNlZG93bixtb3VzZXVwLGtleWRvd24sa2V5cHJlc3MsY2xpY2siLnNwbGl0KCIsIiksCmZ1bmN0aW9uKGEpe3JldHVybiBhKyIuZGlhbG9nLW92ZXJsYXkifSkuam9pbigiICIpLGNyZWF0ZTpmdW5jdGlvbihhKXtpZih0aGlzLmluc3RhbmNlcy5sZW5ndGg9PT0wKXtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yy51aS5kaWFsb2cub3ZlcmxheS5pbnN0YW5jZXMubGVuZ3RoJiZjKGRvY3VtZW50KS5iaW5kKGMudWkuZGlhbG9nLm92ZXJsYXkuZXZlbnRzLGZ1bmN0aW9uKGQpe2lmKGMoZC50YXJnZXQpLnpJbmRleCgpPGMudWkuZGlhbG9nLm92ZXJsYXkubWF4WilyZXR1cm4gZmFsc2V9KX0sMSk7Yyhkb2N1bWVudCkuYmluZCgia2V5ZG93bi5kaWFsb2ctb3ZlcmxheSIsZnVuY3Rpb24oZCl7aWYoYS5vcHRpb25zLmNsb3NlT25Fc2NhcGUmJmQua2V5Q29kZSYmZC5rZXlDb2RlPT09Yy51aS5rZXlDb2RlLkVTQ0FQRSl7YS5jbG9zZShkKTtkLnByZXZlbnREZWZhdWx0KCl9fSk7Yyh3aW5kb3cpLmJpbmQoInJlc2l6ZS5kaWFsb2ctb3ZlcmxheSIsYy51aS5kaWFsb2cub3ZlcmxheS5yZXNpemUpfXZhciBiPQoodGhpcy5vbGRJbnN0YW5jZXMucG9wKCl8fGMoIjxkaXY+PC9kaXY+IikuYWRkQ2xhc3MoInVpLXdpZGdldC1vdmVybGF5IikpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLmNzcyh7d2lkdGg6dGhpcy53aWR0aCgpLGhlaWdodDp0aGlzLmhlaWdodCgpfSk7Yy5mbi5iZ2lmcmFtZSYmYi5iZ2lmcmFtZSgpO3RoaXMuaW5zdGFuY2VzLnB1c2goYik7cmV0dXJuIGJ9LGRlc3Ryb3k6ZnVuY3Rpb24oYSl7dGhpcy5vbGRJbnN0YW5jZXMucHVzaCh0aGlzLmluc3RhbmNlcy5zcGxpY2UoYy5pbkFycmF5KGEsdGhpcy5pbnN0YW5jZXMpLDEpWzBdKTt0aGlzLmluc3RhbmNlcy5sZW5ndGg9PT0wJiZjKFtkb2N1bWVudCx3aW5kb3ddKS51bmJpbmQoIi5kaWFsb2ctb3ZlcmxheSIpO2EucmVtb3ZlKCk7dmFyIGI9MDtjLmVhY2godGhpcy5pbnN0YW5jZXMsZnVuY3Rpb24oKXtiPU1hdGgubWF4KGIsdGhpcy5jc3MoInotaW5kZXgiKSl9KTt0aGlzLm1heFo9Yn0saGVpZ2h0OmZ1bmN0aW9uKCl7dmFyIGEsCmI7aWYoYy5icm93c2VyLm1zaWUmJmMuYnJvd3Nlci52ZXJzaW9uPDcpe2E9TWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodCxkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodCk7Yj1NYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0LGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0KTtyZXR1cm4gYTxiP2Mod2luZG93KS5oZWlnaHQoKSsicHgiOmErInB4In1lbHNlIHJldHVybiBjKGRvY3VtZW50KS5oZWlnaHQoKSsicHgifSx3aWR0aDpmdW5jdGlvbigpe3ZhciBhLGI7aWYoYy5icm93c2VyLm1zaWUmJmMuYnJvd3Nlci52ZXJzaW9uPDcpe2E9TWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFdpZHRoLGRvY3VtZW50LmJvZHkuc2Nyb2xsV2lkdGgpO2I9TWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoLGRvY3VtZW50LmJvZHkub2Zmc2V0V2lkdGgpO3JldHVybiBhPApiP2Mod2luZG93KS53aWR0aCgpKyJweCI6YSsicHgifWVsc2UgcmV0dXJuIGMoZG9jdW1lbnQpLndpZHRoKCkrInB4In0scmVzaXplOmZ1bmN0aW9uKCl7dmFyIGE9YyhbXSk7Yy5lYWNoKGMudWkuZGlhbG9nLm92ZXJsYXkuaW5zdGFuY2VzLGZ1bmN0aW9uKCl7YT1hLmFkZCh0aGlzKX0pO2EuY3NzKHt3aWR0aDowLGhlaWdodDowfSkuY3NzKHt3aWR0aDpjLnVpLmRpYWxvZy5vdmVybGF5LndpZHRoKCksaGVpZ2h0OmMudWkuZGlhbG9nLm92ZXJsYXkuaGVpZ2h0KCl9KX19KTtjLmV4dGVuZChjLnVpLmRpYWxvZy5vdmVybGF5LnByb3RvdHlwZSx7ZGVzdHJveTpmdW5jdGlvbigpe2MudWkuZGlhbG9nLm92ZXJsYXkuZGVzdHJveSh0aGlzLiRlbCl9fSl9KShqUXVlcnkpOwooZnVuY3Rpb24oYyl7Yy51aT1jLnVpfHx7fTt2YXIgbj0vbGVmdHxjZW50ZXJ8cmlnaHQvLG89L3RvcHxjZW50ZXJ8Ym90dG9tLyx0PWMuZm4ucG9zaXRpb24sdT1jLmZuLm9mZnNldDtjLmZuLnBvc2l0aW9uPWZ1bmN0aW9uKGIpe2lmKCFifHwhYi5vZilyZXR1cm4gdC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Yj1jLmV4dGVuZCh7fSxiKTt2YXIgYT1jKGIub2YpLGQ9YVswXSxnPShiLmNvbGxpc2lvbnx8ImZsaXAiKS5zcGxpdCgiICIpLGU9Yi5vZmZzZXQ/Yi5vZmZzZXQuc3BsaXQoIiAiKTpbMCwwXSxoLGssajtpZihkLm5vZGVUeXBlPT09OSl7aD1hLndpZHRoKCk7az1hLmhlaWdodCgpO2o9e3RvcDowLGxlZnQ6MH19ZWxzZSBpZihkLnNjcm9sbFRvJiZkLmRvY3VtZW50KXtoPWEud2lkdGgoKTtrPWEuaGVpZ2h0KCk7aj17dG9wOmEuc2Nyb2xsVG9wKCksbGVmdDphLnNjcm9sbExlZnQoKX19ZWxzZSBpZihkLnByZXZlbnREZWZhdWx0KXtiLmF0PSJsZWZ0IHRvcCI7aD1rPTA7aj0Ke3RvcDpiLm9mLnBhZ2VZLGxlZnQ6Yi5vZi5wYWdlWH19ZWxzZXtoPWEub3V0ZXJXaWR0aCgpO2s9YS5vdXRlckhlaWdodCgpO2o9YS5vZmZzZXQoKX1jLmVhY2goWyJteSIsImF0Il0sZnVuY3Rpb24oKXt2YXIgZj0oYlt0aGlzXXx8IiIpLnNwbGl0KCIgIik7aWYoZi5sZW5ndGg9PT0xKWY9bi50ZXN0KGZbMF0pP2YuY29uY2F0KFsiY2VudGVyIl0pOm8udGVzdChmWzBdKT9bImNlbnRlciJdLmNvbmNhdChmKTpbImNlbnRlciIsImNlbnRlciJdO2ZbMF09bi50ZXN0KGZbMF0pP2ZbMF06ImNlbnRlciI7ZlsxXT1vLnRlc3QoZlsxXSk/ZlsxXToiY2VudGVyIjtiW3RoaXNdPWZ9KTtpZihnLmxlbmd0aD09PTEpZ1sxXT1nWzBdO2VbMF09cGFyc2VJbnQoZVswXSwxMCl8fDA7aWYoZS5sZW5ndGg9PT0xKWVbMV09ZVswXTtlWzFdPXBhcnNlSW50KGVbMV0sMTApfHwwO2lmKGIuYXRbMF09PT0icmlnaHQiKWoubGVmdCs9aDtlbHNlIGlmKGIuYXRbMF09PT0iY2VudGVyIilqLmxlZnQrPWgvCjI7aWYoYi5hdFsxXT09PSJib3R0b20iKWoudG9wKz1rO2Vsc2UgaWYoYi5hdFsxXT09PSJjZW50ZXIiKWoudG9wKz1rLzI7ai5sZWZ0Kz1lWzBdO2oudG9wKz1lWzFdO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZj1jKHRoaXMpLGw9Zi5vdXRlcldpZHRoKCksbT1mLm91dGVySGVpZ2h0KCkscD1wYXJzZUludChjLmN1ckNTUyh0aGlzLCJtYXJnaW5MZWZ0Iix0cnVlKSl8fDAscT1wYXJzZUludChjLmN1ckNTUyh0aGlzLCJtYXJnaW5Ub3AiLHRydWUpKXx8MCx2PWwrcCtwYXJzZUludChjLmN1ckNTUyh0aGlzLCJtYXJnaW5SaWdodCIsdHJ1ZSkpfHwwLHc9bStxK3BhcnNlSW50KGMuY3VyQ1NTKHRoaXMsIm1hcmdpbkJvdHRvbSIsdHJ1ZSkpfHwwLGk9Yy5leHRlbmQoe30saikscjtpZihiLm15WzBdPT09InJpZ2h0IilpLmxlZnQtPWw7ZWxzZSBpZihiLm15WzBdPT09ImNlbnRlciIpaS5sZWZ0LT1sLzI7aWYoYi5teVsxXT09PSJib3R0b20iKWkudG9wLT1tO2Vsc2UgaWYoYi5teVsxXT09PQoiY2VudGVyIilpLnRvcC09bS8yO2kubGVmdD1wYXJzZUludChpLmxlZnQpO2kudG9wPXBhcnNlSW50KGkudG9wKTtyPXtsZWZ0OmkubGVmdC1wLHRvcDppLnRvcC1xfTtjLmVhY2goWyJsZWZ0IiwidG9wIl0sZnVuY3Rpb24ocyx4KXtjLnVpLnBvc2l0aW9uW2dbc11dJiZjLnVpLnBvc2l0aW9uW2dbc11dW3hdKGkse3RhcmdldFdpZHRoOmgsdGFyZ2V0SGVpZ2h0OmssZWxlbVdpZHRoOmwsZWxlbUhlaWdodDptLGNvbGxpc2lvblBvc2l0aW9uOnIsY29sbGlzaW9uV2lkdGg6dixjb2xsaXNpb25IZWlnaHQ6dyxvZmZzZXQ6ZSxteTpiLm15LGF0OmIuYXR9KX0pO2MuZm4uYmdpZnJhbWUmJmYuYmdpZnJhbWUoKTtmLm9mZnNldChjLmV4dGVuZChpLHt1c2luZzpiLnVzaW5nfSkpfSl9O2MudWkucG9zaXRpb249e2ZpdDp7bGVmdDpmdW5jdGlvbihiLGEpe3ZhciBkPWMod2luZG93KTtkPWEuY29sbGlzaW9uUG9zaXRpb24ubGVmdCthLmNvbGxpc2lvbldpZHRoLWQud2lkdGgoKS1kLnNjcm9sbExlZnQoKTsKYi5sZWZ0PWQ+MD9iLmxlZnQtZDpNYXRoLm1heChiLmxlZnQtYS5jb2xsaXNpb25Qb3NpdGlvbi5sZWZ0LGIubGVmdCl9LHRvcDpmdW5jdGlvbihiLGEpe3ZhciBkPWMod2luZG93KTtkPWEuY29sbGlzaW9uUG9zaXRpb24udG9wK2EuY29sbGlzaW9uSGVpZ2h0LWQuaGVpZ2h0KCktZC5zY3JvbGxUb3AoKTtiLnRvcD1kPjA/Yi50b3AtZDpNYXRoLm1heChiLnRvcC1hLmNvbGxpc2lvblBvc2l0aW9uLnRvcCxiLnRvcCl9fSxmbGlwOntsZWZ0OmZ1bmN0aW9uKGIsYSl7aWYoYS5hdFswXSE9PSJjZW50ZXIiKXt2YXIgZD1jKHdpbmRvdyk7ZD1hLmNvbGxpc2lvblBvc2l0aW9uLmxlZnQrYS5jb2xsaXNpb25XaWR0aC1kLndpZHRoKCktZC5zY3JvbGxMZWZ0KCk7dmFyIGc9YS5teVswXT09PSJsZWZ0Ij8tYS5lbGVtV2lkdGg6YS5teVswXT09PSJyaWdodCI/YS5lbGVtV2lkdGg6MCxlPWEuYXRbMF09PT0ibGVmdCI/YS50YXJnZXRXaWR0aDotYS50YXJnZXRXaWR0aCxoPS0yKmEub2Zmc2V0WzBdOwpiLmxlZnQrPWEuY29sbGlzaW9uUG9zaXRpb24ubGVmdDwwP2crZStoOmQ+MD9nK2UraDowfX0sdG9wOmZ1bmN0aW9uKGIsYSl7aWYoYS5hdFsxXSE9PSJjZW50ZXIiKXt2YXIgZD1jKHdpbmRvdyk7ZD1hLmNvbGxpc2lvblBvc2l0aW9uLnRvcCthLmNvbGxpc2lvbkhlaWdodC1kLmhlaWdodCgpLWQuc2Nyb2xsVG9wKCk7dmFyIGc9YS5teVsxXT09PSJ0b3AiPy1hLmVsZW1IZWlnaHQ6YS5teVsxXT09PSJib3R0b20iP2EuZWxlbUhlaWdodDowLGU9YS5hdFsxXT09PSJ0b3AiP2EudGFyZ2V0SGVpZ2h0Oi1hLnRhcmdldEhlaWdodCxoPS0yKmEub2Zmc2V0WzFdO2IudG9wKz1hLmNvbGxpc2lvblBvc2l0aW9uLnRvcDwwP2crZStoOmQ+MD9nK2UraDowfX19fTtpZighYy5vZmZzZXQuc2V0T2Zmc2V0KXtjLm9mZnNldC5zZXRPZmZzZXQ9ZnVuY3Rpb24oYixhKXtpZigvc3RhdGljLy50ZXN0KGMuY3VyQ1NTKGIsInBvc2l0aW9uIikpKWIuc3R5bGUucG9zaXRpb249InJlbGF0aXZlIjt2YXIgZD0KYyhiKSxnPWQub2Zmc2V0KCksZT1wYXJzZUludChjLmN1ckNTUyhiLCJ0b3AiLHRydWUpLDEwKXx8MCxoPXBhcnNlSW50KGMuY3VyQ1NTKGIsImxlZnQiLHRydWUpLDEwKXx8MDtnPXt0b3A6YS50b3AtZy50b3ArZSxsZWZ0OmEubGVmdC1nLmxlZnQraH07InVzaW5nImluIGE/YS51c2luZy5jYWxsKGIsZyk6ZC5jc3MoZyl9O2MuZm4ub2Zmc2V0PWZ1bmN0aW9uKGIpe3ZhciBhPXRoaXNbMF07aWYoIWF8fCFhLm93bmVyRG9jdW1lbnQpcmV0dXJuIG51bGw7aWYoYilyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Yy5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYil9KTtyZXR1cm4gdS5jYWxsKHRoaXMpfX19KShqUXVlcnkpOwooZnVuY3Rpb24oYixjKXtiLndpZGdldCgidWkucHJvZ3Jlc3NiYXIiLHtvcHRpb25zOnt2YWx1ZTowfSxtaW46MCxtYXg6MTAwLF9jcmVhdGU6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLXByb2dyZXNzYmFyIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIikuYXR0cih7cm9sZToicHJvZ3Jlc3NiYXIiLCJhcmlhLXZhbHVlbWluIjp0aGlzLm1pbiwiYXJpYS12YWx1ZW1heCI6dGhpcy5tYXgsImFyaWEtdmFsdWVub3ciOnRoaXMuX3ZhbHVlKCl9KTt0aGlzLnZhbHVlRGl2PWIoIjxkaXYgY2xhc3M9J3VpLXByb2dyZXNzYmFyLXZhbHVlIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWxlZnQnPjwvZGl2PiIpLmFwcGVuZFRvKHRoaXMuZWxlbWVudCk7dGhpcy5fcmVmcmVzaFZhbHVlKCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXByb2dyZXNzYmFyIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIikucmVtb3ZlQXR0cigicm9sZSIpLnJlbW92ZUF0dHIoImFyaWEtdmFsdWVtaW4iKS5yZW1vdmVBdHRyKCJhcmlhLXZhbHVlbWF4IikucmVtb3ZlQXR0cigiYXJpYS12YWx1ZW5vdyIpOwp0aGlzLnZhbHVlRGl2LnJlbW92ZSgpO2IuV2lkZ2V0LnByb3RvdHlwZS5kZXN0cm95LmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sdmFsdWU6ZnVuY3Rpb24oYSl7aWYoYT09PWMpcmV0dXJuIHRoaXMuX3ZhbHVlKCk7dGhpcy5fc2V0T3B0aW9uKCJ2YWx1ZSIsYSk7cmV0dXJuIHRoaXN9LF9zZXRPcHRpb246ZnVuY3Rpb24oYSxkKXtpZihhPT09InZhbHVlIil7dGhpcy5vcHRpb25zLnZhbHVlPWQ7dGhpcy5fcmVmcmVzaFZhbHVlKCk7dGhpcy5fdHJpZ2dlcigiY2hhbmdlIil9Yi5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxfdmFsdWU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnMudmFsdWU7aWYodHlwZW9mIGEhPT0ibnVtYmVyIilhPTA7cmV0dXJuIE1hdGgubWluKHRoaXMubWF4LE1hdGgubWF4KHRoaXMubWluLGEpKX0sX3JlZnJlc2hWYWx1ZTpmdW5jdGlvbigpe3ZhciBhPXRoaXMudmFsdWUoKTt0aGlzLnZhbHVlRGl2LnRvZ2dsZUNsYXNzKCJ1aS1jb3JuZXItcmlnaHQiLAphPT09dGhpcy5tYXgpLndpZHRoKGErIiUiKTt0aGlzLmVsZW1lbnQuYXR0cigiYXJpYS12YWx1ZW5vdyIsYSl9fSk7Yi5leHRlbmQoYi51aS5wcm9ncmVzc2Jhcix7dmVyc2lvbjoiMS44LjUifSl9KShqUXVlcnkpOwooZnVuY3Rpb24oZCl7ZC53aWRnZXQoInVpLnNsaWRlciIsZC51aS5tb3VzZSx7d2lkZ2V0RXZlbnRQcmVmaXg6InNsaWRlIixvcHRpb25zOnthbmltYXRlOmZhbHNlLGRpc3RhbmNlOjAsbWF4OjEwMCxtaW46MCxvcmllbnRhdGlvbjoiaG9yaXpvbnRhbCIscmFuZ2U6ZmFsc2Usc3RlcDoxLHZhbHVlOjAsdmFsdWVzOm51bGx9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLGI9dGhpcy5vcHRpb25zO3RoaXMuX21vdXNlU2xpZGluZz10aGlzLl9rZXlTbGlkaW5nPWZhbHNlO3RoaXMuX2FuaW1hdGVPZmY9dHJ1ZTt0aGlzLl9oYW5kbGVJbmRleD1udWxsO3RoaXMuX2RldGVjdE9yaWVudGF0aW9uKCk7dGhpcy5fbW91c2VJbml0KCk7dGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1zbGlkZXIgdWktc2xpZGVyLSIrdGhpcy5vcmllbnRhdGlvbisiIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIik7Yi5kaXNhYmxlZCYmdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1zbGlkZXItZGlzYWJsZWQgdWktZGlzYWJsZWQiKTsKdGhpcy5yYW5nZT1kKFtdKTtpZihiLnJhbmdlKXtpZihiLnJhbmdlPT09dHJ1ZSl7dGhpcy5yYW5nZT1kKCI8ZGl2PjwvZGl2PiIpO2lmKCFiLnZhbHVlcyliLnZhbHVlcz1bdGhpcy5fdmFsdWVNaW4oKSx0aGlzLl92YWx1ZU1pbigpXTtpZihiLnZhbHVlcy5sZW5ndGgmJmIudmFsdWVzLmxlbmd0aCE9PTIpYi52YWx1ZXM9W2IudmFsdWVzWzBdLGIudmFsdWVzWzBdXX1lbHNlIHRoaXMucmFuZ2U9ZCgiPGRpdj48L2Rpdj4iKTt0aGlzLnJhbmdlLmFwcGVuZFRvKHRoaXMuZWxlbWVudCkuYWRkQ2xhc3MoInVpLXNsaWRlci1yYW5nZSIpO2lmKGIucmFuZ2U9PT0ibWluInx8Yi5yYW5nZT09PSJtYXgiKXRoaXMucmFuZ2UuYWRkQ2xhc3MoInVpLXNsaWRlci1yYW5nZS0iK2IucmFuZ2UpO3RoaXMucmFuZ2UuYWRkQ2xhc3MoInVpLXdpZGdldC1oZWFkZXIiKX1kKCIudWktc2xpZGVyLWhhbmRsZSIsdGhpcy5lbGVtZW50KS5sZW5ndGg9PT0wJiZkKCI8YSBocmVmPScjJz48L2E+IikuYXBwZW5kVG8odGhpcy5lbGVtZW50KS5hZGRDbGFzcygidWktc2xpZGVyLWhhbmRsZSIpOwppZihiLnZhbHVlcyYmYi52YWx1ZXMubGVuZ3RoKWZvcig7ZCgiLnVpLXNsaWRlci1oYW5kbGUiLHRoaXMuZWxlbWVudCkubGVuZ3RoPGIudmFsdWVzLmxlbmd0aDspZCgiPGEgaHJlZj0nIyc+PC9hPiIpLmFwcGVuZFRvKHRoaXMuZWxlbWVudCkuYWRkQ2xhc3MoInVpLXNsaWRlci1oYW5kbGUiKTt0aGlzLmhhbmRsZXM9ZCgiLnVpLXNsaWRlci1oYW5kbGUiLHRoaXMuZWxlbWVudCkuYWRkQ2xhc3MoInVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbCIpO3RoaXMuaGFuZGxlPXRoaXMuaGFuZGxlcy5lcSgwKTt0aGlzLmhhbmRsZXMuYWRkKHRoaXMucmFuZ2UpLmZpbHRlcigiYSIpLmNsaWNrKGZ1bmN0aW9uKGMpe2MucHJldmVudERlZmF1bHQoKX0pLmhvdmVyKGZ1bmN0aW9uKCl7Yi5kaXNhYmxlZHx8ZCh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtaG92ZXIiKX0sZnVuY3Rpb24oKXtkKHRoaXMpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpfSkuZm9jdXMoZnVuY3Rpb24oKXtpZihiLmRpc2FibGVkKWQodGhpcykuYmx1cigpOwplbHNle2QoIi51aS1zbGlkZXIgLnVpLXN0YXRlLWZvY3VzIikucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWZvY3VzIik7ZCh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtZm9jdXMiKX19KS5ibHVyKGZ1bmN0aW9uKCl7ZCh0aGlzKS5yZW1vdmVDbGFzcygidWktc3RhdGUtZm9jdXMiKX0pO3RoaXMuaGFuZGxlcy5lYWNoKGZ1bmN0aW9uKGMpe2QodGhpcykuZGF0YSgiaW5kZXgudWktc2xpZGVyLWhhbmRsZSIsYyl9KTt0aGlzLmhhbmRsZXMua2V5ZG93bihmdW5jdGlvbihjKXt2YXIgZT10cnVlLGY9ZCh0aGlzKS5kYXRhKCJpbmRleC51aS1zbGlkZXItaGFuZGxlIiksaCxnLGk7aWYoIWEub3B0aW9ucy5kaXNhYmxlZCl7c3dpdGNoKGMua2V5Q29kZSl7Y2FzZSBkLnVpLmtleUNvZGUuSE9NRTpjYXNlIGQudWkua2V5Q29kZS5FTkQ6Y2FzZSBkLnVpLmtleUNvZGUuUEFHRV9VUDpjYXNlIGQudWkua2V5Q29kZS5QQUdFX0RPV046Y2FzZSBkLnVpLmtleUNvZGUuVVA6Y2FzZSBkLnVpLmtleUNvZGUuUklHSFQ6Y2FzZSBkLnVpLmtleUNvZGUuRE9XTjpjYXNlIGQudWkua2V5Q29kZS5MRUZUOmU9CmZhbHNlO2lmKCFhLl9rZXlTbGlkaW5nKXthLl9rZXlTbGlkaW5nPXRydWU7ZCh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIik7aD1hLl9zdGFydChjLGYpO2lmKGg9PT1mYWxzZSlyZXR1cm59YnJlYWt9aT1hLm9wdGlvbnMuc3RlcDtoPWEub3B0aW9ucy52YWx1ZXMmJmEub3B0aW9ucy52YWx1ZXMubGVuZ3RoPyhnPWEudmFsdWVzKGYpKTooZz1hLnZhbHVlKCkpO3N3aXRjaChjLmtleUNvZGUpe2Nhc2UgZC51aS5rZXlDb2RlLkhPTUU6Zz1hLl92YWx1ZU1pbigpO2JyZWFrO2Nhc2UgZC51aS5rZXlDb2RlLkVORDpnPWEuX3ZhbHVlTWF4KCk7YnJlYWs7Y2FzZSBkLnVpLmtleUNvZGUuUEFHRV9VUDpnPWEuX3RyaW1BbGlnblZhbHVlKGgrKGEuX3ZhbHVlTWF4KCktYS5fdmFsdWVNaW4oKSkvNSk7YnJlYWs7Y2FzZSBkLnVpLmtleUNvZGUuUEFHRV9ET1dOOmc9YS5fdHJpbUFsaWduVmFsdWUoaC0oYS5fdmFsdWVNYXgoKS1hLl92YWx1ZU1pbigpKS81KTticmVhaztjYXNlIGQudWkua2V5Q29kZS5VUDpjYXNlIGQudWkua2V5Q29kZS5SSUdIVDppZihoPT09CmEuX3ZhbHVlTWF4KCkpcmV0dXJuO2c9YS5fdHJpbUFsaWduVmFsdWUoaCtpKTticmVhaztjYXNlIGQudWkua2V5Q29kZS5ET1dOOmNhc2UgZC51aS5rZXlDb2RlLkxFRlQ6aWYoaD09PWEuX3ZhbHVlTWluKCkpcmV0dXJuO2c9YS5fdHJpbUFsaWduVmFsdWUoaC1pKTticmVha31hLl9zbGlkZShjLGYsZyk7cmV0dXJuIGV9fSkua2V5dXAoZnVuY3Rpb24oYyl7dmFyIGU9ZCh0aGlzKS5kYXRhKCJpbmRleC51aS1zbGlkZXItaGFuZGxlIik7aWYoYS5fa2V5U2xpZGluZyl7YS5fa2V5U2xpZGluZz1mYWxzZTthLl9zdG9wKGMsZSk7YS5fY2hhbmdlKGMsZSk7ZCh0aGlzKS5yZW1vdmVDbGFzcygidWktc3RhdGUtYWN0aXZlIil9fSk7dGhpcy5fcmVmcmVzaFZhbHVlKCk7dGhpcy5fYW5pbWF0ZU9mZj1mYWxzZX0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuaGFuZGxlcy5yZW1vdmUoKTt0aGlzLnJhbmdlLnJlbW92ZSgpO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2xpZGVyIHVpLXNsaWRlci1ob3Jpem9udGFsIHVpLXNsaWRlci12ZXJ0aWNhbCB1aS1zbGlkZXItZGlzYWJsZWQgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiKS5yZW1vdmVEYXRhKCJzbGlkZXIiKS51bmJpbmQoIi5zbGlkZXIiKTsKdGhpcy5fbW91c2VEZXN0cm95KCk7cmV0dXJuIHRoaXN9LF9tb3VzZUNhcHR1cmU6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5vcHRpb25zLGMsZSxmLGgsZztpZihiLmRpc2FibGVkKXJldHVybiBmYWxzZTt0aGlzLmVsZW1lbnRTaXplPXt3aWR0aDp0aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpLGhlaWdodDp0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKX07dGhpcy5lbGVtZW50T2Zmc2V0PXRoaXMuZWxlbWVudC5vZmZzZXQoKTtjPXRoaXMuX25vcm1WYWx1ZUZyb21Nb3VzZSh7eDphLnBhZ2VYLHk6YS5wYWdlWX0pO2U9dGhpcy5fdmFsdWVNYXgoKS10aGlzLl92YWx1ZU1pbigpKzE7aD10aGlzO3RoaXMuaGFuZGxlcy5lYWNoKGZ1bmN0aW9uKGkpe3ZhciBqPU1hdGguYWJzKGMtaC52YWx1ZXMoaSkpO2lmKGU+ail7ZT1qO2Y9ZCh0aGlzKTtnPWl9fSk7aWYoYi5yYW5nZT09PXRydWUmJnRoaXMudmFsdWVzKDEpPT09Yi5taW4pe2crPTE7Zj1kKHRoaXMuaGFuZGxlc1tnXSl9aWYodGhpcy5fc3RhcnQoYSwKZyk9PT1mYWxzZSlyZXR1cm4gZmFsc2U7dGhpcy5fbW91c2VTbGlkaW5nPXRydWU7aC5faGFuZGxlSW5kZXg9ZztmLmFkZENsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKS5mb2N1cygpO2I9Zi5vZmZzZXQoKTt0aGlzLl9jbGlja09mZnNldD0hZChhLnRhcmdldCkucGFyZW50cygpLmFuZFNlbGYoKS5pcygiLnVpLXNsaWRlci1oYW5kbGUiKT97bGVmdDowLHRvcDowfTp7bGVmdDphLnBhZ2VYLWIubGVmdC1mLndpZHRoKCkvMix0b3A6YS5wYWdlWS1iLnRvcC1mLmhlaWdodCgpLzItKHBhcnNlSW50KGYuY3NzKCJib3JkZXJUb3BXaWR0aCIpLDEwKXx8MCktKHBhcnNlSW50KGYuY3NzKCJib3JkZXJCb3R0b21XaWR0aCIpLDEwKXx8MCkrKHBhcnNlSW50KGYuY3NzKCJtYXJnaW5Ub3AiKSwxMCl8fDApfTt0aGlzLl9zbGlkZShhLGcsYyk7cmV0dXJuIHRoaXMuX2FuaW1hdGVPZmY9dHJ1ZX0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdHJ1ZX0sX21vdXNlRHJhZzpmdW5jdGlvbihhKXt2YXIgYj0KdGhpcy5fbm9ybVZhbHVlRnJvbU1vdXNlKHt4OmEucGFnZVgseTphLnBhZ2VZfSk7dGhpcy5fc2xpZGUoYSx0aGlzLl9oYW5kbGVJbmRleCxiKTtyZXR1cm4gZmFsc2V9LF9tb3VzZVN0b3A6ZnVuY3Rpb24oYSl7dGhpcy5oYW5kbGVzLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKTt0aGlzLl9tb3VzZVNsaWRpbmc9ZmFsc2U7dGhpcy5fc3RvcChhLHRoaXMuX2hhbmRsZUluZGV4KTt0aGlzLl9jaGFuZ2UoYSx0aGlzLl9oYW5kbGVJbmRleCk7dGhpcy5fY2xpY2tPZmZzZXQ9dGhpcy5faGFuZGxlSW5kZXg9bnVsbDtyZXR1cm4gdGhpcy5fYW5pbWF0ZU9mZj1mYWxzZX0sX2RldGVjdE9yaWVudGF0aW9uOmZ1bmN0aW9uKCl7dGhpcy5vcmllbnRhdGlvbj10aGlzLm9wdGlvbnMub3JpZW50YXRpb249PT0idmVydGljYWwiPyJ2ZXJ0aWNhbCI6Imhvcml6b250YWwifSxfbm9ybVZhbHVlRnJvbU1vdXNlOmZ1bmN0aW9uKGEpe3ZhciBiO2lmKHRoaXMub3JpZW50YXRpb249PT0iaG9yaXpvbnRhbCIpe2I9CnRoaXMuZWxlbWVudFNpemUud2lkdGg7YT1hLngtdGhpcy5lbGVtZW50T2Zmc2V0LmxlZnQtKHRoaXMuX2NsaWNrT2Zmc2V0P3RoaXMuX2NsaWNrT2Zmc2V0LmxlZnQ6MCl9ZWxzZXtiPXRoaXMuZWxlbWVudFNpemUuaGVpZ2h0O2E9YS55LXRoaXMuZWxlbWVudE9mZnNldC50b3AtKHRoaXMuX2NsaWNrT2Zmc2V0P3RoaXMuX2NsaWNrT2Zmc2V0LnRvcDowKX1iPWEvYjtpZihiPjEpYj0xO2lmKGI8MCliPTA7aWYodGhpcy5vcmllbnRhdGlvbj09PSJ2ZXJ0aWNhbCIpYj0xLWI7YT10aGlzLl92YWx1ZU1heCgpLXRoaXMuX3ZhbHVlTWluKCk7cmV0dXJuIHRoaXMuX3RyaW1BbGlnblZhbHVlKHRoaXMuX3ZhbHVlTWluKCkrYiphKX0sX3N0YXJ0OmZ1bmN0aW9uKGEsYil7dmFyIGM9e2hhbmRsZTp0aGlzLmhhbmRsZXNbYl0sdmFsdWU6dGhpcy52YWx1ZSgpfTtpZih0aGlzLm9wdGlvbnMudmFsdWVzJiZ0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCl7Yy52YWx1ZT10aGlzLnZhbHVlcyhiKTsKYy52YWx1ZXM9dGhpcy52YWx1ZXMoKX1yZXR1cm4gdGhpcy5fdHJpZ2dlcigic3RhcnQiLGEsYyl9LF9zbGlkZTpmdW5jdGlvbihhLGIsYyl7dmFyIGU7aWYodGhpcy5vcHRpb25zLnZhbHVlcyYmdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGgpe2U9dGhpcy52YWx1ZXMoYj8wOjEpO2lmKHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoPT09MiYmdGhpcy5vcHRpb25zLnJhbmdlPT09dHJ1ZSYmKGI9PT0wJiZjPmV8fGI9PT0xJiZjPGUpKWM9ZTtpZihjIT09dGhpcy52YWx1ZXMoYikpe2U9dGhpcy52YWx1ZXMoKTtlW2JdPWM7YT10aGlzLl90cmlnZ2VyKCJzbGlkZSIsYSx7aGFuZGxlOnRoaXMuaGFuZGxlc1tiXSx2YWx1ZTpjLHZhbHVlczplfSk7dGhpcy52YWx1ZXMoYj8wOjEpO2EhPT1mYWxzZSYmdGhpcy52YWx1ZXMoYixjLHRydWUpfX1lbHNlIGlmKGMhPT10aGlzLnZhbHVlKCkpe2E9dGhpcy5fdHJpZ2dlcigic2xpZGUiLGEse2hhbmRsZTp0aGlzLmhhbmRsZXNbYl0sdmFsdWU6Y30pOwphIT09ZmFsc2UmJnRoaXMudmFsdWUoYyl9fSxfc3RvcDpmdW5jdGlvbihhLGIpe3ZhciBjPXtoYW5kbGU6dGhpcy5oYW5kbGVzW2JdLHZhbHVlOnRoaXMudmFsdWUoKX07aWYodGhpcy5vcHRpb25zLnZhbHVlcyYmdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGgpe2MudmFsdWU9dGhpcy52YWx1ZXMoYik7Yy52YWx1ZXM9dGhpcy52YWx1ZXMoKX10aGlzLl90cmlnZ2VyKCJzdG9wIixhLGMpfSxfY2hhbmdlOmZ1bmN0aW9uKGEsYil7aWYoIXRoaXMuX2tleVNsaWRpbmcmJiF0aGlzLl9tb3VzZVNsaWRpbmcpe3ZhciBjPXtoYW5kbGU6dGhpcy5oYW5kbGVzW2JdLHZhbHVlOnRoaXMudmFsdWUoKX07aWYodGhpcy5vcHRpb25zLnZhbHVlcyYmdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGgpe2MudmFsdWU9dGhpcy52YWx1ZXMoYik7Yy52YWx1ZXM9dGhpcy52YWx1ZXMoKX10aGlzLl90cmlnZ2VyKCJjaGFuZ2UiLGEsYyl9fSx2YWx1ZTpmdW5jdGlvbihhKXtpZihhcmd1bWVudHMubGVuZ3RoKXt0aGlzLm9wdGlvbnMudmFsdWU9CnRoaXMuX3RyaW1BbGlnblZhbHVlKGEpO3RoaXMuX3JlZnJlc2hWYWx1ZSgpO3RoaXMuX2NoYW5nZShudWxsLDApfXJldHVybiB0aGlzLl92YWx1ZSgpfSx2YWx1ZXM6ZnVuY3Rpb24oYSxiKXt2YXIgYyxlLGY7aWYoYXJndW1lbnRzLmxlbmd0aD4xKXt0aGlzLm9wdGlvbnMudmFsdWVzW2FdPXRoaXMuX3RyaW1BbGlnblZhbHVlKGIpO3RoaXMuX3JlZnJlc2hWYWx1ZSgpO3RoaXMuX2NoYW5nZShudWxsLGEpfWlmKGFyZ3VtZW50cy5sZW5ndGgpaWYoZC5pc0FycmF5KGFyZ3VtZW50c1swXSkpe2M9dGhpcy5vcHRpb25zLnZhbHVlcztlPWFyZ3VtZW50c1swXTtmb3IoZj0wO2Y8Yy5sZW5ndGg7Zis9MSl7Y1tmXT10aGlzLl90cmltQWxpZ25WYWx1ZShlW2ZdKTt0aGlzLl9jaGFuZ2UobnVsbCxmKX10aGlzLl9yZWZyZXNoVmFsdWUoKX1lbHNlIHJldHVybiB0aGlzLm9wdGlvbnMudmFsdWVzJiZ0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aD90aGlzLl92YWx1ZXMoYSk6dGhpcy52YWx1ZSgpOwplbHNlIHJldHVybiB0aGlzLl92YWx1ZXMoKX0sX3NldE9wdGlvbjpmdW5jdGlvbihhLGIpe3ZhciBjLGU9MDtpZihkLmlzQXJyYXkodGhpcy5vcHRpb25zLnZhbHVlcykpZT10aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aDtkLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7c3dpdGNoKGEpe2Nhc2UgImRpc2FibGVkIjppZihiKXt0aGlzLmhhbmRsZXMuZmlsdGVyKCIudWktc3RhdGUtZm9jdXMiKS5ibHVyKCk7dGhpcy5oYW5kbGVzLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpO3RoaXMuaGFuZGxlcy5hdHRyKCJkaXNhYmxlZCIsImRpc2FibGVkIik7dGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1kaXNhYmxlZCIpfWVsc2V7dGhpcy5oYW5kbGVzLnJlbW92ZUF0dHIoImRpc2FibGVkIik7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1kaXNhYmxlZCIpfWJyZWFrO2Nhc2UgIm9yaWVudGF0aW9uIjp0aGlzLl9kZXRlY3RPcmllbnRhdGlvbigpOwp0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNsaWRlci1ob3Jpem9udGFsIHVpLXNsaWRlci12ZXJ0aWNhbCIpLmFkZENsYXNzKCJ1aS1zbGlkZXItIit0aGlzLm9yaWVudGF0aW9uKTt0aGlzLl9yZWZyZXNoVmFsdWUoKTticmVhaztjYXNlICJ2YWx1ZSI6dGhpcy5fYW5pbWF0ZU9mZj10cnVlO3RoaXMuX3JlZnJlc2hWYWx1ZSgpO3RoaXMuX2NoYW5nZShudWxsLDApO3RoaXMuX2FuaW1hdGVPZmY9ZmFsc2U7YnJlYWs7Y2FzZSAidmFsdWVzIjp0aGlzLl9hbmltYXRlT2ZmPXRydWU7dGhpcy5fcmVmcmVzaFZhbHVlKCk7Zm9yKGM9MDtjPGU7Yys9MSl0aGlzLl9jaGFuZ2UobnVsbCxjKTt0aGlzLl9hbmltYXRlT2ZmPWZhbHNlO2JyZWFrfX0sX3ZhbHVlOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vcHRpb25zLnZhbHVlO3JldHVybiBhPXRoaXMuX3RyaW1BbGlnblZhbHVlKGEpfSxfdmFsdWVzOmZ1bmN0aW9uKGEpe3ZhciBiLGM7aWYoYXJndW1lbnRzLmxlbmd0aCl7Yj10aGlzLm9wdGlvbnMudmFsdWVzW2FdOwpyZXR1cm4gYj10aGlzLl90cmltQWxpZ25WYWx1ZShiKX1lbHNle2I9dGhpcy5vcHRpb25zLnZhbHVlcy5zbGljZSgpO2ZvcihjPTA7YzxiLmxlbmd0aDtjKz0xKWJbY109dGhpcy5fdHJpbUFsaWduVmFsdWUoYltjXSk7cmV0dXJuIGJ9fSxfdHJpbUFsaWduVmFsdWU6ZnVuY3Rpb24oYSl7aWYoYTx0aGlzLl92YWx1ZU1pbigpKXJldHVybiB0aGlzLl92YWx1ZU1pbigpO2lmKGE+dGhpcy5fdmFsdWVNYXgoKSlyZXR1cm4gdGhpcy5fdmFsdWVNYXgoKTt2YXIgYj10aGlzLm9wdGlvbnMuc3RlcD4wP3RoaXMub3B0aW9ucy5zdGVwOjEsYz1hJWI7YT1hLWM7aWYoTWF0aC5hYnMoYykqMj49YilhKz1jPjA/YjotYjtyZXR1cm4gcGFyc2VGbG9hdChhLnRvRml4ZWQoNSkpfSxfdmFsdWVNaW46ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLm1pbn0sX3ZhbHVlTWF4OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5tYXh9LF9yZWZyZXNoVmFsdWU6ZnVuY3Rpb24oKXt2YXIgYT0KdGhpcy5vcHRpb25zLnJhbmdlLGI9dGhpcy5vcHRpb25zLGM9dGhpcyxlPSF0aGlzLl9hbmltYXRlT2ZmP2IuYW5pbWF0ZTpmYWxzZSxmLGg9e30sZyxpLGosbDtpZih0aGlzLm9wdGlvbnMudmFsdWVzJiZ0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCl0aGlzLmhhbmRsZXMuZWFjaChmdW5jdGlvbihrKXtmPShjLnZhbHVlcyhrKS1jLl92YWx1ZU1pbigpKS8oYy5fdmFsdWVNYXgoKS1jLl92YWx1ZU1pbigpKSoxMDA7aFtjLm9yaWVudGF0aW9uPT09Imhvcml6b250YWwiPyJsZWZ0IjoiYm90dG9tIl09ZisiJSI7ZCh0aGlzKS5zdG9wKDEsMSlbZT8iYW5pbWF0ZSI6ImNzcyJdKGgsYi5hbmltYXRlKTtpZihjLm9wdGlvbnMucmFuZ2U9PT10cnVlKWlmKGMub3JpZW50YXRpb249PT0iaG9yaXpvbnRhbCIpe2lmKGs9PT0wKWMucmFuZ2Uuc3RvcCgxLDEpW2U/ImFuaW1hdGUiOiJjc3MiXSh7bGVmdDpmKyIlIn0sYi5hbmltYXRlKTtpZihrPT09MSljLnJhbmdlW2U/ImFuaW1hdGUiOiJjc3MiXSh7d2lkdGg6Zi0KZysiJSJ9LHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpiLmFuaW1hdGV9KX1lbHNle2lmKGs9PT0wKWMucmFuZ2Uuc3RvcCgxLDEpW2U/ImFuaW1hdGUiOiJjc3MiXSh7Ym90dG9tOmYrIiUifSxiLmFuaW1hdGUpO2lmKGs9PT0xKWMucmFuZ2VbZT8iYW5pbWF0ZSI6ImNzcyJdKHtoZWlnaHQ6Zi1nKyIlIn0se3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmIuYW5pbWF0ZX0pfWc9Zn0pO2Vsc2V7aT10aGlzLnZhbHVlKCk7aj10aGlzLl92YWx1ZU1pbigpO2w9dGhpcy5fdmFsdWVNYXgoKTtmPWwhPT1qPyhpLWopLyhsLWopKjEwMDowO2hbYy5vcmllbnRhdGlvbj09PSJob3Jpem9udGFsIj8ibGVmdCI6ImJvdHRvbSJdPWYrIiUiO3RoaXMuaGFuZGxlLnN0b3AoMSwxKVtlPyJhbmltYXRlIjoiY3NzIl0oaCxiLmFuaW1hdGUpO2lmKGE9PT0ibWluIiYmdGhpcy5vcmllbnRhdGlvbj09PSJob3Jpem9udGFsIil0aGlzLnJhbmdlLnN0b3AoMSwxKVtlPyJhbmltYXRlIjoiY3NzIl0oe3dpZHRoOmYrIiUifSwKYi5hbmltYXRlKTtpZihhPT09Im1heCImJnRoaXMub3JpZW50YXRpb249PT0iaG9yaXpvbnRhbCIpdGhpcy5yYW5nZVtlPyJhbmltYXRlIjoiY3NzIl0oe3dpZHRoOjEwMC1mKyIlIn0se3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmIuYW5pbWF0ZX0pO2lmKGE9PT0ibWluIiYmdGhpcy5vcmllbnRhdGlvbj09PSJ2ZXJ0aWNhbCIpdGhpcy5yYW5nZS5zdG9wKDEsMSlbZT8iYW5pbWF0ZSI6ImNzcyJdKHtoZWlnaHQ6ZisiJSJ9LGIuYW5pbWF0ZSk7aWYoYT09PSJtYXgiJiZ0aGlzLm9yaWVudGF0aW9uPT09InZlcnRpY2FsIil0aGlzLnJhbmdlW2U/ImFuaW1hdGUiOiJjc3MiXSh7aGVpZ2h0OjEwMC1mKyIlIn0se3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmIuYW5pbWF0ZX0pfX19KTtkLmV4dGVuZChkLnVpLnNsaWRlcix7dmVyc2lvbjoiMS44LjUifSl9KShqUXVlcnkpOwooZnVuY3Rpb24oZCxwKXtmdW5jdGlvbiB1KCl7cmV0dXJuKyt2fWZ1bmN0aW9uIHcoKXtyZXR1cm4rK3h9dmFyIHY9MCx4PTA7ZC53aWRnZXQoInVpLnRhYnMiLHtvcHRpb25zOnthZGQ6bnVsbCxhamF4T3B0aW9uczpudWxsLGNhY2hlOmZhbHNlLGNvb2tpZTpudWxsLGNvbGxhcHNpYmxlOmZhbHNlLGRpc2FibGU6bnVsbCxkaXNhYmxlZDpbXSxlbmFibGU6bnVsbCxldmVudDoiY2xpY2siLGZ4Om51bGwsaWRQcmVmaXg6InVpLXRhYnMtIixsb2FkOm51bGwscGFuZWxUZW1wbGF0ZToiPGRpdj48L2Rpdj4iLHJlbW92ZTpudWxsLHNlbGVjdDpudWxsLHNob3c6bnVsbCxzcGlubmVyOiI8ZW0+TG9hZGluZyYjODIzMDs8L2VtPiIsdGFiVGVtcGxhdGU6IjxsaT48YSBocmVmPScje2hyZWZ9Jz48c3Bhbj4je2xhYmVsfTwvc3Bhbj48L2E+PC9saT4ifSxfY3JlYXRlOmZ1bmN0aW9uKCl7dGhpcy5fdGFiaWZ5KHRydWUpfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGEsZSl7aWYoYT09InNlbGVjdGVkIil0aGlzLm9wdGlvbnMuY29sbGFwc2libGUmJgplPT10aGlzLm9wdGlvbnMuc2VsZWN0ZWR8fHRoaXMuc2VsZWN0KGUpO2Vsc2V7dGhpcy5vcHRpb25zW2FdPWU7dGhpcy5fdGFiaWZ5KCl9fSxfdGFiSWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEudGl0bGUmJmEudGl0bGUucmVwbGFjZSgvXHMvZywiXyIpLnJlcGxhY2UoL1teXHdcdTAwYzAtXHVGRkZGLV0vZywiIil8fHRoaXMub3B0aW9ucy5pZFByZWZpeCt1KCl9LF9zYW5pdGl6ZVNlbGVjdG9yOmZ1bmN0aW9uKGEpe3JldHVybiBhLnJlcGxhY2UoLzovZywiXFw6Iil9LF9jb29raWU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmNvb2tpZXx8KHRoaXMuY29va2llPXRoaXMub3B0aW9ucy5jb29raWUubmFtZXx8InVpLXRhYnMtIit3KCkpO3JldHVybiBkLmNvb2tpZS5hcHBseShudWxsLFthXS5jb25jYXQoZC5tYWtlQXJyYXkoYXJndW1lbnRzKSkpfSxfdWk6ZnVuY3Rpb24oYSxlKXtyZXR1cm57dGFiOmEscGFuZWw6ZSxpbmRleDp0aGlzLmFuY2hvcnMuaW5kZXgoYSl9fSxfY2xlYW51cDpmdW5jdGlvbigpe3RoaXMubGlzLmZpbHRlcigiLnVpLXN0YXRlLXByb2Nlc3NpbmciKS5yZW1vdmVDbGFzcygidWktc3RhdGUtcHJvY2Vzc2luZyIpLmZpbmQoInNwYW46ZGF0YShsYWJlbC50YWJzKSIpLmVhY2goZnVuY3Rpb24oKXt2YXIgYT0KZCh0aGlzKTthLmh0bWwoYS5kYXRhKCJsYWJlbC50YWJzIikpLnJlbW92ZURhdGEoImxhYmVsLnRhYnMiKX0pfSxfdGFiaWZ5OmZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGUoZyxmKXtnLmNzcygiZGlzcGxheSIsIiIpOyFkLnN1cHBvcnQub3BhY2l0eSYmZi5vcGFjaXR5JiZnWzBdLnN0eWxlLnJlbW92ZUF0dHJpYnV0ZSgiZmlsdGVyIil9dmFyIGI9dGhpcyxjPXRoaXMub3B0aW9ucyxoPS9eIy4rLzt0aGlzLmxpc3Q9dGhpcy5lbGVtZW50LmZpbmQoIm9sLHVsIikuZXEoMCk7dGhpcy5saXM9ZCgiID4gbGk6aGFzKGFbaHJlZl0pIix0aGlzLmxpc3QpO3RoaXMuYW5jaG9ycz10aGlzLmxpcy5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gZCgiYSIsdGhpcylbMF19KTt0aGlzLnBhbmVscz1kKFtdKTt0aGlzLmFuY2hvcnMuZWFjaChmdW5jdGlvbihnLGYpe3ZhciBpPWQoZikuYXR0cigiaHJlZiIpLGw9aS5zcGxpdCgiIyIpWzBdLHE7aWYobCYmKGw9PT1sb2NhdGlvbi50b1N0cmluZygpLnNwbGl0KCIjIilbMF18fAoocT1kKCJiYXNlIilbMF0pJiZsPT09cS5ocmVmKSl7aT1mLmhhc2g7Zi5ocmVmPWl9aWYoaC50ZXN0KGkpKWIucGFuZWxzPWIucGFuZWxzLmFkZChiLl9zYW5pdGl6ZVNlbGVjdG9yKGkpKTtlbHNlIGlmKGkmJmkhPT0iIyIpe2QuZGF0YShmLCJocmVmLnRhYnMiLGkpO2QuZGF0YShmLCJsb2FkLnRhYnMiLGkucmVwbGFjZSgvIy4qJC8sIiIpKTtpPWIuX3RhYklkKGYpO2YuaHJlZj0iIyIraTtmPWQoIiMiK2kpO2lmKCFmLmxlbmd0aCl7Zj1kKGMucGFuZWxUZW1wbGF0ZSkuYXR0cigiaWQiLGkpLmFkZENsYXNzKCJ1aS10YWJzLXBhbmVsIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20iKS5pbnNlcnRBZnRlcihiLnBhbmVsc1tnLTFdfHxiLmxpc3QpO2YuZGF0YSgiZGVzdHJveS50YWJzIix0cnVlKX1iLnBhbmVscz1iLnBhbmVscy5hZGQoZil9ZWxzZSBjLmRpc2FibGVkLnB1c2goZyl9KTtpZihhKXt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLXRhYnMgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiKTsKdGhpcy5saXN0LmFkZENsYXNzKCJ1aS10YWJzLW5hdiB1aS1oZWxwZXItcmVzZXQgdWktaGVscGVyLWNsZWFyZml4IHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWFsbCIpO3RoaXMubGlzLmFkZENsYXNzKCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci10b3AiKTt0aGlzLnBhbmVscy5hZGRDbGFzcygidWktdGFicy1wYW5lbCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tIik7aWYoYy5zZWxlY3RlZD09PXApe2xvY2F0aW9uLmhhc2gmJnRoaXMuYW5jaG9ycy5lYWNoKGZ1bmN0aW9uKGcsZil7aWYoZi5oYXNoPT1sb2NhdGlvbi5oYXNoKXtjLnNlbGVjdGVkPWc7cmV0dXJuIGZhbHNlfX0pO2lmKHR5cGVvZiBjLnNlbGVjdGVkIT09Im51bWJlciImJmMuY29va2llKWMuc2VsZWN0ZWQ9cGFyc2VJbnQoYi5fY29va2llKCksMTApO2lmKHR5cGVvZiBjLnNlbGVjdGVkIT09Im51bWJlciImJnRoaXMubGlzLmZpbHRlcigiLnVpLXRhYnMtc2VsZWN0ZWQiKS5sZW5ndGgpYy5zZWxlY3RlZD0KdGhpcy5saXMuaW5kZXgodGhpcy5saXMuZmlsdGVyKCIudWktdGFicy1zZWxlY3RlZCIpKTtjLnNlbGVjdGVkPWMuc2VsZWN0ZWR8fCh0aGlzLmxpcy5sZW5ndGg/MDotMSl9ZWxzZSBpZihjLnNlbGVjdGVkPT09bnVsbCljLnNlbGVjdGVkPS0xO2Muc2VsZWN0ZWQ9Yy5zZWxlY3RlZD49MCYmdGhpcy5hbmNob3JzW2Muc2VsZWN0ZWRdfHxjLnNlbGVjdGVkPDA/Yy5zZWxlY3RlZDowO2MuZGlzYWJsZWQ9ZC51bmlxdWUoYy5kaXNhYmxlZC5jb25jYXQoZC5tYXAodGhpcy5saXMuZmlsdGVyKCIudWktc3RhdGUtZGlzYWJsZWQiKSxmdW5jdGlvbihnKXtyZXR1cm4gYi5saXMuaW5kZXgoZyl9KSkpLnNvcnQoKTtkLmluQXJyYXkoYy5zZWxlY3RlZCxjLmRpc2FibGVkKSE9LTEmJmMuZGlzYWJsZWQuc3BsaWNlKGQuaW5BcnJheShjLnNlbGVjdGVkLGMuZGlzYWJsZWQpLDEpO3RoaXMucGFuZWxzLmFkZENsYXNzKCJ1aS10YWJzLWhpZGUiKTt0aGlzLmxpcy5yZW1vdmVDbGFzcygidWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmUiKTsKaWYoYy5zZWxlY3RlZD49MCYmdGhpcy5hbmNob3JzLmxlbmd0aCl7dGhpcy5wYW5lbHMuZXEoYy5zZWxlY3RlZCkucmVtb3ZlQ2xhc3MoInVpLXRhYnMtaGlkZSIpO3RoaXMubGlzLmVxKGMuc2VsZWN0ZWQpLmFkZENsYXNzKCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZSIpO2IuZWxlbWVudC5xdWV1ZSgidGFicyIsZnVuY3Rpb24oKXtiLl90cmlnZ2VyKCJzaG93IixudWxsLGIuX3VpKGIuYW5jaG9yc1tjLnNlbGVjdGVkXSxiLnBhbmVsc1tjLnNlbGVjdGVkXSkpfSk7dGhpcy5sb2FkKGMuc2VsZWN0ZWQpfWQod2luZG93KS5iaW5kKCJ1bmxvYWQiLGZ1bmN0aW9uKCl7Yi5saXMuYWRkKGIuYW5jaG9ycykudW5iaW5kKCIudGFicyIpO2IubGlzPWIuYW5jaG9ycz1iLnBhbmVscz1udWxsfSl9ZWxzZSBjLnNlbGVjdGVkPXRoaXMubGlzLmluZGV4KHRoaXMubGlzLmZpbHRlcigiLnVpLXRhYnMtc2VsZWN0ZWQiKSk7dGhpcy5lbGVtZW50W2MuY29sbGFwc2libGU/ImFkZENsYXNzIjoKInJlbW92ZUNsYXNzIl0oInVpLXRhYnMtY29sbGFwc2libGUiKTtjLmNvb2tpZSYmdGhpcy5fY29va2llKGMuc2VsZWN0ZWQsYy5jb29raWUpO2E9MDtmb3IodmFyIGo7aj10aGlzLmxpc1thXTthKyspZChqKVtkLmluQXJyYXkoYSxjLmRpc2FibGVkKSE9LTEmJiFkKGopLmhhc0NsYXNzKCJ1aS10YWJzLXNlbGVjdGVkIik/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXSgidWktc3RhdGUtZGlzYWJsZWQiKTtjLmNhY2hlPT09ZmFsc2UmJnRoaXMuYW5jaG9ycy5yZW1vdmVEYXRhKCJjYWNoZS50YWJzIik7dGhpcy5saXMuYWRkKHRoaXMuYW5jaG9ycykudW5iaW5kKCIudGFicyIpO2lmKGMuZXZlbnQhPT0ibW91c2VvdmVyIil7dmFyIGs9ZnVuY3Rpb24oZyxmKXtmLmlzKCI6bm90KC51aS1zdGF0ZS1kaXNhYmxlZCkiKSYmZi5hZGRDbGFzcygidWktc3RhdGUtIitnKX0sbj1mdW5jdGlvbihnLGYpe2YucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLSIrZyl9O3RoaXMubGlzLmJpbmQoIm1vdXNlb3Zlci50YWJzIiwKZnVuY3Rpb24oKXtrKCJob3ZlciIsZCh0aGlzKSl9KTt0aGlzLmxpcy5iaW5kKCJtb3VzZW91dC50YWJzIixmdW5jdGlvbigpe24oImhvdmVyIixkKHRoaXMpKX0pO3RoaXMuYW5jaG9ycy5iaW5kKCJmb2N1cy50YWJzIixmdW5jdGlvbigpe2soImZvY3VzIixkKHRoaXMpLmNsb3Nlc3QoImxpIikpfSk7dGhpcy5hbmNob3JzLmJpbmQoImJsdXIudGFicyIsZnVuY3Rpb24oKXtuKCJmb2N1cyIsZCh0aGlzKS5jbG9zZXN0KCJsaSIpKX0pfXZhciBtLG87aWYoYy5meClpZihkLmlzQXJyYXkoYy5meCkpe209Yy5meFswXTtvPWMuZnhbMV19ZWxzZSBtPW89Yy5meDt2YXIgcj1vP2Z1bmN0aW9uKGcsZil7ZChnKS5jbG9zZXN0KCJsaSIpLmFkZENsYXNzKCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZSIpO2YuaGlkZSgpLnJlbW92ZUNsYXNzKCJ1aS10YWJzLWhpZGUiKS5hbmltYXRlKG8sby5kdXJhdGlvbnx8Im5vcm1hbCIsZnVuY3Rpb24oKXtlKGYsbyk7Yi5fdHJpZ2dlcigic2hvdyIsCm51bGwsYi5fdWkoZyxmWzBdKSl9KX06ZnVuY3Rpb24oZyxmKXtkKGcpLmNsb3Nlc3QoImxpIikuYWRkQ2xhc3MoInVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlIik7Zi5yZW1vdmVDbGFzcygidWktdGFicy1oaWRlIik7Yi5fdHJpZ2dlcigic2hvdyIsbnVsbCxiLl91aShnLGZbMF0pKX0scz1tP2Z1bmN0aW9uKGcsZil7Zi5hbmltYXRlKG0sbS5kdXJhdGlvbnx8Im5vcm1hbCIsZnVuY3Rpb24oKXtiLmxpcy5yZW1vdmVDbGFzcygidWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmUiKTtmLmFkZENsYXNzKCJ1aS10YWJzLWhpZGUiKTtlKGYsbSk7Yi5lbGVtZW50LmRlcXVldWUoInRhYnMiKX0pfTpmdW5jdGlvbihnLGYpe2IubGlzLnJlbW92ZUNsYXNzKCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZSIpO2YuYWRkQ2xhc3MoInVpLXRhYnMtaGlkZSIpO2IuZWxlbWVudC5kZXF1ZXVlKCJ0YWJzIil9O3RoaXMuYW5jaG9ycy5iaW5kKGMuZXZlbnQrIi50YWJzIiwKZnVuY3Rpb24oKXt2YXIgZz10aGlzLGY9ZChnKS5jbG9zZXN0KCJsaSIpLGk9Yi5wYW5lbHMuZmlsdGVyKCI6bm90KC51aS10YWJzLWhpZGUpIiksbD1kKGIuX3Nhbml0aXplU2VsZWN0b3IoZy5oYXNoKSk7aWYoZi5oYXNDbGFzcygidWktdGFicy1zZWxlY3RlZCIpJiYhYy5jb2xsYXBzaWJsZXx8Zi5oYXNDbGFzcygidWktc3RhdGUtZGlzYWJsZWQiKXx8Zi5oYXNDbGFzcygidWktc3RhdGUtcHJvY2Vzc2luZyIpfHxiLnBhbmVscy5maWx0ZXIoIjphbmltYXRlZCIpLmxlbmd0aHx8Yi5fdHJpZ2dlcigic2VsZWN0IixudWxsLGIuX3VpKHRoaXMsbFswXSkpPT09ZmFsc2Upe3RoaXMuYmx1cigpO3JldHVybiBmYWxzZX1jLnNlbGVjdGVkPWIuYW5jaG9ycy5pbmRleCh0aGlzKTtiLmFib3J0KCk7aWYoYy5jb2xsYXBzaWJsZSlpZihmLmhhc0NsYXNzKCJ1aS10YWJzLXNlbGVjdGVkIikpe2Muc2VsZWN0ZWQ9LTE7Yy5jb29raWUmJmIuX2Nvb2tpZShjLnNlbGVjdGVkLGMuY29va2llKTtiLmVsZW1lbnQucXVldWUoInRhYnMiLApmdW5jdGlvbigpe3MoZyxpKX0pLmRlcXVldWUoInRhYnMiKTt0aGlzLmJsdXIoKTtyZXR1cm4gZmFsc2V9ZWxzZSBpZighaS5sZW5ndGgpe2MuY29va2llJiZiLl9jb29raWUoYy5zZWxlY3RlZCxjLmNvb2tpZSk7Yi5lbGVtZW50LnF1ZXVlKCJ0YWJzIixmdW5jdGlvbigpe3IoZyxsKX0pO2IubG9hZChiLmFuY2hvcnMuaW5kZXgodGhpcykpO3RoaXMuYmx1cigpO3JldHVybiBmYWxzZX1jLmNvb2tpZSYmYi5fY29va2llKGMuc2VsZWN0ZWQsYy5jb29raWUpO2lmKGwubGVuZ3RoKXtpLmxlbmd0aCYmYi5lbGVtZW50LnF1ZXVlKCJ0YWJzIixmdW5jdGlvbigpe3MoZyxpKX0pO2IuZWxlbWVudC5xdWV1ZSgidGFicyIsZnVuY3Rpb24oKXtyKGcsbCl9KTtiLmxvYWQoYi5hbmNob3JzLmluZGV4KHRoaXMpKX1lbHNlIHRocm93ImpRdWVyeSBVSSBUYWJzOiBNaXNtYXRjaGluZyBmcmFnbWVudCBpZGVudGlmaWVyLiI7ZC5icm93c2VyLm1zaWUmJnRoaXMuYmx1cigpfSk7dGhpcy5hbmNob3JzLmJpbmQoImNsaWNrLnRhYnMiLApmdW5jdGlvbigpe3JldHVybiBmYWxzZX0pfSxfZ2V0SW5kZXg6ZnVuY3Rpb24oYSl7aWYodHlwZW9mIGE9PSJzdHJpbmciKWE9dGhpcy5hbmNob3JzLmluZGV4KHRoaXMuYW5jaG9ycy5maWx0ZXIoIltocmVmJD0iK2ErIl0iKSk7cmV0dXJuIGF9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnM7dGhpcy5hYm9ydCgpO3RoaXMuZWxlbWVudC51bmJpbmQoIi50YWJzIikucmVtb3ZlQ2xhc3MoInVpLXRhYnMgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwgdWktdGFicy1jb2xsYXBzaWJsZSIpLnJlbW92ZURhdGEoInRhYnMiKTt0aGlzLmxpc3QucmVtb3ZlQ2xhc3MoInVpLXRhYnMtbmF2IHVpLWhlbHBlci1yZXNldCB1aS1oZWxwZXItY2xlYXJmaXggdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYWxsIik7dGhpcy5hbmNob3JzLmVhY2goZnVuY3Rpb24oKXt2YXIgZT1kLmRhdGEodGhpcywiaHJlZi50YWJzIik7aWYoZSl0aGlzLmhyZWY9CmU7dmFyIGI9ZCh0aGlzKS51bmJpbmQoIi50YWJzIik7ZC5lYWNoKFsiaHJlZiIsImxvYWQiLCJjYWNoZSJdLGZ1bmN0aW9uKGMsaCl7Yi5yZW1vdmVEYXRhKGgrIi50YWJzIil9KX0pO3RoaXMubGlzLnVuYmluZCgiLnRhYnMiKS5hZGQodGhpcy5wYW5lbHMpLmVhY2goZnVuY3Rpb24oKXtkLmRhdGEodGhpcywiZGVzdHJveS50YWJzIik/ZCh0aGlzKS5yZW1vdmUoKTpkKHRoaXMpLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci10b3AgdWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmUgdWktc3RhdGUtaG92ZXIgdWktc3RhdGUtZm9jdXMgdWktc3RhdGUtZGlzYWJsZWQgdWktdGFicy1wYW5lbCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tIHVpLXRhYnMtaGlkZSIpfSk7YS5jb29raWUmJnRoaXMuX2Nvb2tpZShudWxsLGEuY29va2llKTtyZXR1cm4gdGhpc30sYWRkOmZ1bmN0aW9uKGEsZSxiKXtpZihiPT09cCliPXRoaXMuYW5jaG9ycy5sZW5ndGg7CnZhciBjPXRoaXMsaD10aGlzLm9wdGlvbnM7ZT1kKGgudGFiVGVtcGxhdGUucmVwbGFjZSgvI1x7aHJlZlx9L2csYSkucmVwbGFjZSgvI1x7bGFiZWxcfS9nLGUpKTthPSFhLmluZGV4T2YoIiMiKT9hLnJlcGxhY2UoIiMiLCIiKTp0aGlzLl90YWJJZChkKCJhIixlKVswXSk7ZS5hZGRDbGFzcygidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItdG9wIikuZGF0YSgiZGVzdHJveS50YWJzIix0cnVlKTt2YXIgaj1kKCIjIithKTtqLmxlbmd0aHx8KGo9ZChoLnBhbmVsVGVtcGxhdGUpLmF0dHIoImlkIixhKS5kYXRhKCJkZXN0cm95LnRhYnMiLHRydWUpKTtqLmFkZENsYXNzKCJ1aS10YWJzLXBhbmVsIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20gdWktdGFicy1oaWRlIik7aWYoYj49dGhpcy5saXMubGVuZ3RoKXtlLmFwcGVuZFRvKHRoaXMubGlzdCk7ai5hcHBlbmRUbyh0aGlzLmxpc3RbMF0ucGFyZW50Tm9kZSl9ZWxzZXtlLmluc2VydEJlZm9yZSh0aGlzLmxpc1tiXSk7CmouaW5zZXJ0QmVmb3JlKHRoaXMucGFuZWxzW2JdKX1oLmRpc2FibGVkPWQubWFwKGguZGlzYWJsZWQsZnVuY3Rpb24oayl7cmV0dXJuIGs+PWI/KytrOmt9KTt0aGlzLl90YWJpZnkoKTtpZih0aGlzLmFuY2hvcnMubGVuZ3RoPT0xKXtoLnNlbGVjdGVkPTA7ZS5hZGRDbGFzcygidWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmUiKTtqLnJlbW92ZUNsYXNzKCJ1aS10YWJzLWhpZGUiKTt0aGlzLmVsZW1lbnQucXVldWUoInRhYnMiLGZ1bmN0aW9uKCl7Yy5fdHJpZ2dlcigic2hvdyIsbnVsbCxjLl91aShjLmFuY2hvcnNbMF0sYy5wYW5lbHNbMF0pKX0pO3RoaXMubG9hZCgwKX10aGlzLl90cmlnZ2VyKCJhZGQiLG51bGwsdGhpcy5fdWkodGhpcy5hbmNob3JzW2JdLHRoaXMucGFuZWxzW2JdKSk7cmV0dXJuIHRoaXN9LHJlbW92ZTpmdW5jdGlvbihhKXthPXRoaXMuX2dldEluZGV4KGEpO3ZhciBlPXRoaXMub3B0aW9ucyxiPXRoaXMubGlzLmVxKGEpLnJlbW92ZSgpLGM9dGhpcy5wYW5lbHMuZXEoYSkucmVtb3ZlKCk7CmlmKGIuaGFzQ2xhc3MoInVpLXRhYnMtc2VsZWN0ZWQiKSYmdGhpcy5hbmNob3JzLmxlbmd0aD4xKXRoaXMuc2VsZWN0KGErKGErMTx0aGlzLmFuY2hvcnMubGVuZ3RoPzE6LTEpKTtlLmRpc2FibGVkPWQubWFwKGQuZ3JlcChlLmRpc2FibGVkLGZ1bmN0aW9uKGgpe3JldHVybiBoIT1hfSksZnVuY3Rpb24oaCl7cmV0dXJuIGg+PWE/LS1oOmh9KTt0aGlzLl90YWJpZnkoKTt0aGlzLl90cmlnZ2VyKCJyZW1vdmUiLG51bGwsdGhpcy5fdWkoYi5maW5kKCJhIilbMF0sY1swXSkpO3JldHVybiB0aGlzfSxlbmFibGU6ZnVuY3Rpb24oYSl7YT10aGlzLl9nZXRJbmRleChhKTt2YXIgZT10aGlzLm9wdGlvbnM7aWYoZC5pbkFycmF5KGEsZS5kaXNhYmxlZCkhPS0xKXt0aGlzLmxpcy5lcShhKS5yZW1vdmVDbGFzcygidWktc3RhdGUtZGlzYWJsZWQiKTtlLmRpc2FibGVkPWQuZ3JlcChlLmRpc2FibGVkLGZ1bmN0aW9uKGIpe3JldHVybiBiIT1hfSk7dGhpcy5fdHJpZ2dlcigiZW5hYmxlIixudWxsLAp0aGlzLl91aSh0aGlzLmFuY2hvcnNbYV0sdGhpcy5wYW5lbHNbYV0pKTtyZXR1cm4gdGhpc319LGRpc2FibGU6ZnVuY3Rpb24oYSl7YT10aGlzLl9nZXRJbmRleChhKTt2YXIgZT10aGlzLm9wdGlvbnM7aWYoYSE9ZS5zZWxlY3RlZCl7dGhpcy5saXMuZXEoYSkuYWRkQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIik7ZS5kaXNhYmxlZC5wdXNoKGEpO2UuZGlzYWJsZWQuc29ydCgpO3RoaXMuX3RyaWdnZXIoImRpc2FibGUiLG51bGwsdGhpcy5fdWkodGhpcy5hbmNob3JzW2FdLHRoaXMucGFuZWxzW2FdKSl9cmV0dXJuIHRoaXN9LHNlbGVjdDpmdW5jdGlvbihhKXthPXRoaXMuX2dldEluZGV4KGEpO2lmKGE9PS0xKWlmKHRoaXMub3B0aW9ucy5jb2xsYXBzaWJsZSYmdGhpcy5vcHRpb25zLnNlbGVjdGVkIT0tMSlhPXRoaXMub3B0aW9ucy5zZWxlY3RlZDtlbHNlIHJldHVybiB0aGlzO3RoaXMuYW5jaG9ycy5lcShhKS50cmlnZ2VyKHRoaXMub3B0aW9ucy5ldmVudCsiLnRhYnMiKTtyZXR1cm4gdGhpc30sCmxvYWQ6ZnVuY3Rpb24oYSl7YT10aGlzLl9nZXRJbmRleChhKTt2YXIgZT10aGlzLGI9dGhpcy5vcHRpb25zLGM9dGhpcy5hbmNob3JzLmVxKGEpWzBdLGg9ZC5kYXRhKGMsImxvYWQudGFicyIpO3RoaXMuYWJvcnQoKTtpZighaHx8dGhpcy5lbGVtZW50LnF1ZXVlKCJ0YWJzIikubGVuZ3RoIT09MCYmZC5kYXRhKGMsImNhY2hlLnRhYnMiKSl0aGlzLmVsZW1lbnQuZGVxdWV1ZSgidGFicyIpO2Vsc2V7dGhpcy5saXMuZXEoYSkuYWRkQ2xhc3MoInVpLXN0YXRlLXByb2Nlc3NpbmciKTtpZihiLnNwaW5uZXIpe3ZhciBqPWQoInNwYW4iLGMpO2ouZGF0YSgibGFiZWwudGFicyIsai5odG1sKCkpLmh0bWwoYi5zcGlubmVyKX10aGlzLnhocj1kLmFqYXgoZC5leHRlbmQoe30sYi5hamF4T3B0aW9ucyx7dXJsOmgsc3VjY2VzczpmdW5jdGlvbihrLG4pe2QoZS5fc2FuaXRpemVTZWxlY3RvcihjLmhhc2gpKS5odG1sKGspO2UuX2NsZWFudXAoKTtiLmNhY2hlJiZkLmRhdGEoYywiY2FjaGUudGFicyIsCnRydWUpO2UuX3RyaWdnZXIoImxvYWQiLG51bGwsZS5fdWkoZS5hbmNob3JzW2FdLGUucGFuZWxzW2FdKSk7dHJ5e2IuYWpheE9wdGlvbnMuc3VjY2VzcyhrLG4pfWNhdGNoKG0pe319LGVycm9yOmZ1bmN0aW9uKGssbil7ZS5fY2xlYW51cCgpO2UuX3RyaWdnZXIoImxvYWQiLG51bGwsZS5fdWkoZS5hbmNob3JzW2FdLGUucGFuZWxzW2FdKSk7dHJ5e2IuYWpheE9wdGlvbnMuZXJyb3IoayxuLGEsYyl9Y2F0Y2gobSl7fX19KSk7ZS5lbGVtZW50LmRlcXVldWUoInRhYnMiKTtyZXR1cm4gdGhpc319LGFib3J0OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnF1ZXVlKFtdKTt0aGlzLnBhbmVscy5zdG9wKGZhbHNlLHRydWUpO3RoaXMuZWxlbWVudC5xdWV1ZSgidGFicyIsdGhpcy5lbGVtZW50LnF1ZXVlKCJ0YWJzIikuc3BsaWNlKC0yLDIpKTtpZih0aGlzLnhocil7dGhpcy54aHIuYWJvcnQoKTtkZWxldGUgdGhpcy54aHJ9dGhpcy5fY2xlYW51cCgpO3JldHVybiB0aGlzfSx1cmw6ZnVuY3Rpb24oYSwKZSl7dGhpcy5hbmNob3JzLmVxKGEpLnJlbW92ZURhdGEoImNhY2hlLnRhYnMiKS5kYXRhKCJsb2FkLnRhYnMiLGUpO3JldHVybiB0aGlzfSxsZW5ndGg6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hbmNob3JzLmxlbmd0aH19KTtkLmV4dGVuZChkLnVpLnRhYnMse3ZlcnNpb246IjEuOC41In0pO2QuZXh0ZW5kKGQudWkudGFicy5wcm90b3R5cGUse3JvdGF0aW9uOm51bGwscm90YXRlOmZ1bmN0aW9uKGEsZSl7dmFyIGI9dGhpcyxjPXRoaXMub3B0aW9ucyxoPWIuX3JvdGF0ZXx8KGIuX3JvdGF0ZT1mdW5jdGlvbihqKXtjbGVhclRpbWVvdXQoYi5yb3RhdGlvbik7Yi5yb3RhdGlvbj1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dmFyIGs9Yy5zZWxlY3RlZDtiLnNlbGVjdCgrK2s8Yi5hbmNob3JzLmxlbmd0aD9rOjApfSxhKTtqJiZqLnN0b3BQcm9wYWdhdGlvbigpfSk7ZT1iLl91bnJvdGF0ZXx8KGIuX3Vucm90YXRlPSFlP2Z1bmN0aW9uKGope2ouY2xpZW50WCYmYi5yb3RhdGUobnVsbCl9OgpmdW5jdGlvbigpe3Q9Yy5zZWxlY3RlZDtoKCl9KTtpZihhKXt0aGlzLmVsZW1lbnQuYmluZCgidGFic3Nob3ciLGgpO3RoaXMuYW5jaG9ycy5iaW5kKGMuZXZlbnQrIi50YWJzIixlKTtoKCl9ZWxzZXtjbGVhclRpbWVvdXQoYi5yb3RhdGlvbik7dGhpcy5lbGVtZW50LnVuYmluZCgidGFic3Nob3ciLGgpO3RoaXMuYW5jaG9ycy51bmJpbmQoYy5ldmVudCsiLnRhYnMiLGUpO2RlbGV0ZSB0aGlzLl9yb3RhdGU7ZGVsZXRlIHRoaXMuX3Vucm90YXRlfXJldHVybiB0aGlzfX0pfSkoalF1ZXJ5KTsK"
        },
        "bkmrklt/lib.min.js": {
            "content_type": "application/javascript",
            "data": "KGZ1bmN0aW9uKCl7dmFyIEJ1ZmZlckNsYXNzPXR5cGVvZihCdWZmZXIpPT0nZnVuY3Rpb24nP0J1ZmZlcjpBcnJheTt2YXIgX2J1Zj1uZXcgQnVmZmVyQ2xhc3MoMTYpO3ZhciB0b1N0cmluZz1bXTt2YXIgdG9OdW1iZXI9e307Zm9yKHZhciBpPTA7aTwyNTY7aSsrKXt0b1N0cmluZ1tpXT0oaSsweDEwMCkudG9TdHJpbmcoMTYpLnN1YnN0cigxKTt0b051bWJlclt0b1N0cmluZ1tpXV09aTt9CmZ1bmN0aW9uIHBhcnNlKHMpe3ZhciBidWY9bmV3IEJ1ZmZlckNsYXNzKDE2KTt2YXIgaT0wO3MudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bMC05YS1mXVswLTlhLWZdL2csZnVuY3Rpb24ob2N0ZXQpe2J1ZltpKytdPXRvTnVtYmVyW29jdGV0XTt9KTtyZXR1cm4gYnVmO30KZnVuY3Rpb24gdW5wYXJzZShidWYpe3ZhciB0b3M9dG9TdHJpbmcsYj1idWY7cmV0dXJuIHRvc1tiWzBdXSt0b3NbYlsxXV0rdG9zW2JbMl1dK3Rvc1tiWzNdXSsnLScrCnRvc1tiWzRdXSt0b3NbYls1XV0rJy0nKwp0b3NbYls2XV0rdG9zW2JbN11dKyctJysKdG9zW2JbOF1dK3Rvc1tiWzldXSsnLScrCnRvc1tiWzEwXV0rdG9zW2JbMTFdXSt0b3NbYlsxMl1dKwp0b3NbYlsxM11dK3Rvc1tiWzE0XV0rdG9zW2JbMTVdXTt9CnZhciBiMzI9MHgxMDAwMDAwMDAsZmY9MHhmZjtmdW5jdGlvbiB1dWlkKGZtdCxidWYsb2Zmc2V0KXt2YXIgYj1mbXQhPSdiaW5hcnknP19idWY6KGJ1Zj9idWY6bmV3IEJ1ZmZlckNsYXNzKDE2KSk7dmFyIGk9YnVmJiZvZmZzZXR8fDA7dmFyIHI9TWF0aC5yYW5kb20oKSpiMzI7YltpKytdPXImZmY7YltpKytdPXI+Pj44JmZmO2JbaSsrXT1yPj4+MTYmZmY7YltpKytdPXI+Pj4yNCZmZjtyPU1hdGgucmFuZG9tKCkqYjMyO2JbaSsrXT1yJmZmO2JbaSsrXT1yPj4+OCZmZjtiW2krK109cj4+PjE2JjB4MGZ8MHg0MDtiW2krK109cj4+PjI0JmZmO3I9TWF0aC5yYW5kb20oKSpiMzI7YltpKytdPXImMHgzZnwweDgwO2JbaSsrXT1yPj4+OCZmZjtiW2krK109cj4+PjE2JmZmO2JbaSsrXT1yPj4+MjQmZmY7cj1NYXRoLnJhbmRvbSgpKmIzMjtiW2krK109ciZmZjtiW2krK109cj4+PjgmZmY7YltpKytdPXI+Pj4xNiZmZjtiW2krK109cj4+PjI0JmZmO3JldHVybiBmbXQ9PT11bmRlZmluZWQ/dW5wYXJzZShiKTpiO307dXVpZC5wYXJzZT1wYXJzZTt1dWlkLnVucGFyc2U9dW5wYXJzZTt1dWlkLkJ1ZmZlckNsYXNzPUJ1ZmZlckNsYXNzO2lmKHR5cGVvZihtb2R1bGUpIT0ndW5kZWZpbmVkJyl7bW9kdWxlLmV4cG9ydHM9dXVpZDt9ZWxzZXt0aGlzLnV1aWQ9dXVpZDt9fSkoKTtpZighdGhpcy5KU09OKXt0aGlzLkpTT049e307fQooZnVuY3Rpb24oKXtmdW5jdGlvbiBmKG4pe3JldHVybiBuPDEwPycwJytuOm47fQppZih0eXBlb2YgRGF0ZS5wcm90b3R5cGUudG9KU09OIT09J2Z1bmN0aW9uJyl7RGF0ZS5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKGtleSl7cmV0dXJuIGlzRmluaXRlKHRoaXMudmFsdWVPZigpKT90aGlzLmdldFVUQ0Z1bGxZZWFyKCkrJy0nKwpmKHRoaXMuZ2V0VVRDTW9udGgoKSsxKSsnLScrCmYodGhpcy5nZXRVVENEYXRlKCkpKydUJysKZih0aGlzLmdldFVUQ0hvdXJzKCkpKyc6JysKZih0aGlzLmdldFVUQ01pbnV0ZXMoKSkrJzonKwpmKHRoaXMuZ2V0VVRDU2Vjb25kcygpKSsnWic6bnVsbDt9O1N0cmluZy5wcm90b3R5cGUudG9KU09OPU51bWJlci5wcm90b3R5cGUudG9KU09OPUJvb2xlYW4ucHJvdG90eXBlLnRvSlNPTj1mdW5jdGlvbihrZXkpe3JldHVybiB0aGlzLnZhbHVlT2YoKTt9O30KdmFyIGN4PS9bXHUwMDAwXHUwMGFkXHUwNjAwLVx1MDYwNFx1MDcwZlx1MTdiNFx1MTdiNVx1MjAwYy1cdTIwMGZcdTIwMjgtXHUyMDJmXHUyMDYwLVx1MjA2Zlx1ZmVmZlx1ZmZmMC1cdWZmZmZdL2csZXNjYXBhYmxlPS9bXFxcIlx4MDAtXHgxZlx4N2YtXHg5Zlx1MDBhZFx1MDYwMC1cdTA2MDRcdTA3MGZcdTE3YjRcdTE3YjVcdTIwMGMtXHUyMDBmXHUyMDI4LVx1MjAyZlx1MjA2MC1cdTIwNmZcdWZlZmZcdWZmZjAtXHVmZmZmXS9nLGdhcCxpbmRlbnQsbWV0YT17J1xiJzonXFxiJywnXHQnOidcXHQnLCdcbic6J1xcbicsJ1xmJzonXFxmJywnXHInOidcXHInLCciJzonXFwiJywnXFwnOidcXFxcJ30scmVwO2Z1bmN0aW9uIHF1b3RlKHN0cmluZyl7ZXNjYXBhYmxlLmxhc3RJbmRleD0wO3JldHVybiBlc2NhcGFibGUudGVzdChzdHJpbmcpPyciJytzdHJpbmcucmVwbGFjZShlc2NhcGFibGUsZnVuY3Rpb24oYSl7dmFyIGM9bWV0YVthXTtyZXR1cm4gdHlwZW9mIGM9PT0nc3RyaW5nJz9jOidcXHUnKygnMDAwMCcrYS5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTQpO30pKyciJzonIicrc3RyaW5nKyciJzt9CmZ1bmN0aW9uIHN0cihrZXksaG9sZGVyKXt2YXIgaSxrLHYsbGVuZ3RoLG1pbmQ9Z2FwLHBhcnRpYWwsdmFsdWU9aG9sZGVyW2tleV07aWYodmFsdWUmJnR5cGVvZiB2YWx1ZT09PSdvYmplY3QnJiZ0eXBlb2YgdmFsdWUudG9KU09OPT09J2Z1bmN0aW9uJyl7dmFsdWU9dmFsdWUudG9KU09OKGtleSk7fQppZih0eXBlb2YgcmVwPT09J2Z1bmN0aW9uJyl7dmFsdWU9cmVwLmNhbGwoaG9sZGVyLGtleSx2YWx1ZSk7fQpzd2l0Y2godHlwZW9mIHZhbHVlKXtjYXNlJ3N0cmluZyc6cmV0dXJuIHF1b3RlKHZhbHVlKTtjYXNlJ251bWJlcic6cmV0dXJuIGlzRmluaXRlKHZhbHVlKT9TdHJpbmcodmFsdWUpOidudWxsJztjYXNlJ2Jvb2xlYW4nOmNhc2UnbnVsbCc6cmV0dXJuIFN0cmluZyh2YWx1ZSk7Y2FzZSdvYmplY3QnOmlmKCF2YWx1ZSl7cmV0dXJuJ251bGwnO30KZ2FwKz1pbmRlbnQ7cGFydGlhbD1bXTtpZihPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KHZhbHVlKT09PSdbb2JqZWN0IEFycmF5XScpe2xlbmd0aD12YWx1ZS5sZW5ndGg7Zm9yKGk9MDtpPGxlbmd0aDtpKz0xKXtwYXJ0aWFsW2ldPXN0cihpLHZhbHVlKXx8J251bGwnO30Kdj1wYXJ0aWFsLmxlbmd0aD09PTA/J1tdJzpnYXA/J1tcbicrZ2FwKwpwYXJ0aWFsLmpvaW4oJyxcbicrZ2FwKSsnXG4nKwptaW5kKyddJzonWycrcGFydGlhbC5qb2luKCcsJykrJ10nO2dhcD1taW5kO3JldHVybiB2O30KaWYocmVwJiZ0eXBlb2YgcmVwPT09J29iamVjdCcpe2xlbmd0aD1yZXAubGVuZ3RoO2ZvcihpPTA7aTxsZW5ndGg7aSs9MSl7az1yZXBbaV07aWYodHlwZW9mIGs9PT0nc3RyaW5nJyl7dj1zdHIoayx2YWx1ZSk7aWYodil7cGFydGlhbC5wdXNoKHF1b3RlKGspKyhnYXA/JzogJzonOicpK3YpO319fX1lbHNle2ZvcihrIGluIHZhbHVlKXtpZihPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSxrKSl7dj1zdHIoayx2YWx1ZSk7aWYodil7cGFydGlhbC5wdXNoKHF1b3RlKGspKyhnYXA/JzogJzonOicpK3YpO319fX0Kdj1wYXJ0aWFsLmxlbmd0aD09PTA/J3t9JzpnYXA/J3tcbicrZ2FwK3BhcnRpYWwuam9pbignLFxuJytnYXApKydcbicrCm1pbmQrJ30nOid7JytwYXJ0aWFsLmpvaW4oJywnKSsnfSc7Z2FwPW1pbmQ7cmV0dXJuIHY7fX0KaWYodHlwZW9mIEpTT04uc3RyaW5naWZ5IT09J2Z1bmN0aW9uJyl7SlNPTi5zdHJpbmdpZnk9ZnVuY3Rpb24odmFsdWUscmVwbGFjZXIsc3BhY2Upe3ZhciBpO2dhcD0nJztpbmRlbnQ9Jyc7aWYodHlwZW9mIHNwYWNlPT09J251bWJlcicpe2ZvcihpPTA7aTxzcGFjZTtpKz0xKXtpbmRlbnQrPScgJzt9fWVsc2UgaWYodHlwZW9mIHNwYWNlPT09J3N0cmluZycpe2luZGVudD1zcGFjZTt9CnJlcD1yZXBsYWNlcjtpZihyZXBsYWNlciYmdHlwZW9mIHJlcGxhY2VyIT09J2Z1bmN0aW9uJyYmKHR5cGVvZiByZXBsYWNlciE9PSdvYmplY3QnfHx0eXBlb2YgcmVwbGFjZXIubGVuZ3RoIT09J251bWJlcicpKXt0aHJvdyBuZXcgRXJyb3IoJ0pTT04uc3RyaW5naWZ5Jyk7fQpyZXR1cm4gc3RyKCcnLHsnJzp2YWx1ZX0pO307fQppZih0eXBlb2YgSlNPTi5wYXJzZSE9PSdmdW5jdGlvbicpe0pTT04ucGFyc2U9ZnVuY3Rpb24odGV4dCxyZXZpdmVyKXt2YXIgajtmdW5jdGlvbiB3YWxrKGhvbGRlcixrZXkpe3ZhciBrLHYsdmFsdWU9aG9sZGVyW2tleV07aWYodmFsdWUmJnR5cGVvZiB2YWx1ZT09PSdvYmplY3QnKXtmb3IoayBpbiB2YWx1ZSl7aWYoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodmFsdWUsaykpe3Y9d2Fsayh2YWx1ZSxrKTtpZih2IT09dW5kZWZpbmVkKXt2YWx1ZVtrXT12O31lbHNle2RlbGV0ZSB2YWx1ZVtrXTt9fX19CnJldHVybiByZXZpdmVyLmNhbGwoaG9sZGVyLGtleSx2YWx1ZSk7fQp0ZXh0PVN0cmluZyh0ZXh0KTtjeC5sYXN0SW5kZXg9MDtpZihjeC50ZXN0KHRleHQpKXt0ZXh0PXRleHQucmVwbGFjZShjeCxmdW5jdGlvbihhKXtyZXR1cm4nXFx1JysKKCcwMDAwJythLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtNCk7fSk7fQppZigvXltcXSw6e31cc10qJC8udGVzdCh0ZXh0LnJlcGxhY2UoL1xcKD86WyJcXFwvYmZucnRdfHVbMC05YS1mQS1GXXs0fSkvZywnQCcpLnJlcGxhY2UoLyJbXiJcXFxuXHJdKiJ8dHJ1ZXxmYWxzZXxudWxsfC0/XGQrKD86XC5cZCopPyg/OltlRV1bK1wtXT9cZCspPy9nLCddJykucmVwbGFjZSgvKD86Xnw6fCwpKD86XHMqXFspKy9nLCcnKSkpe2o9ZXZhbCgnKCcrdGV4dCsnKScpO3JldHVybiB0eXBlb2YgcmV2aXZlcj09PSdmdW5jdGlvbic/d2Fsayh7Jyc6an0sJycpOmo7fQp0aHJvdyBuZXcgU3ludGF4RXJyb3IoJ0pTT04ucGFyc2UnKTt9O319KCkpOyhmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGN2KGEpe3JldHVybiBmLmlzV2luZG93KGEpP2E6YS5ub2RlVHlwZT09PTk/YS5kZWZhdWx0Vmlld3x8YS5wYXJlbnRXaW5kb3c6ITF9ZnVuY3Rpb24gY3MoYSl7aWYoIWNnW2FdKXt2YXIgYj1jLmJvZHksZD1mKCI8IithKyI+IikuYXBwZW5kVG8oYiksZT1kLmNzcygiZGlzcGxheSIpO2QucmVtb3ZlKCk7aWYoZT09PSJub25lInx8ZT09PSIiKXtjaHx8KGNoPWMuY3JlYXRlRWxlbWVudCgiaWZyYW1lIiksY2guZnJhbWVCb3JkZXI9Y2gud2lkdGg9Y2guaGVpZ2h0PTApLGIuYXBwZW5kQ2hpbGQoY2gpO2lmKCFjaXx8IWNoLmNyZWF0ZUVsZW1lbnQpY2k9KGNoLmNvbnRlbnRXaW5kb3d8fGNoLmNvbnRlbnREb2N1bWVudCkuZG9jdW1lbnQsY2kud3JpdGUoKGMuY29tcGF0TW9kZT09PSJDU1MxQ29tcGF0Ij8iPCFkb2N0eXBlIGh0bWw+IjoiIikrIjxodG1sPjxib2R5PiIpLGNpLmNsb3NlKCk7ZD1jaS5jcmVhdGVFbGVtZW50KGEpLGNpLmJvZHkuYXBwZW5kQ2hpbGQoZCksZT1mLmNzcyhkLCJkaXNwbGF5IiksYi5yZW1vdmVDaGlsZChjaCl9Y2dbYV09ZX1yZXR1cm4gY2dbYV19ZnVuY3Rpb24gY3IoYSxiKXt2YXIgYz17fTtmLmVhY2goY20uY29uY2F0LmFwcGx5KFtdLGNtLnNsaWNlKDAsYikpLGZ1bmN0aW9uKCl7Y1t0aGlzXT1hfSk7cmV0dXJuIGN9ZnVuY3Rpb24gY3EoKXtjbj1ifWZ1bmN0aW9uIGNwKCl7c2V0VGltZW91dChjcSwwKTtyZXR1cm4gY249Zi5ub3coKX1mdW5jdGlvbiBjZigpe3RyeXtyZXR1cm4gbmV3IGEuQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKX1jYXRjaChiKXt9fWZ1bmN0aW9uIGNlKCl7dHJ5e3JldHVybiBuZXcgYS5YTUxIdHRwUmVxdWVzdH1jYXRjaChiKXt9fWZ1bmN0aW9uIGIkKGEsYyl7YS5kYXRhRmlsdGVyJiYoYz1hLmRhdGFGaWx0ZXIoYyxhLmRhdGFUeXBlKSk7dmFyIGQ9YS5kYXRhVHlwZXMsZT17fSxnLGgsaT1kLmxlbmd0aCxqLGs9ZFswXSxsLG0sbixvLHA7Zm9yKGc9MTtnPGk7ZysrKXtpZihnPT09MSlmb3IoaCBpbiBhLmNvbnZlcnRlcnMpdHlwZW9mIGg9PSJzdHJpbmciJiYoZVtoLnRvTG93ZXJDYXNlKCldPWEuY29udmVydGVyc1toXSk7bD1rLGs9ZFtnXTtpZihrPT09IioiKWs9bDtlbHNlIGlmKGwhPT0iKiImJmwhPT1rKXttPWwrIiAiK2ssbj1lW21dfHxlWyIqICIra107aWYoIW4pe3A9Yjtmb3IobyBpbiBlKXtqPW8uc3BsaXQoIiAiKTtpZihqWzBdPT09bHx8alswXT09PSIqIil7cD1lW2pbMV0rIiAiK2tdO2lmKHApe289ZVtvXSxvPT09ITA/bj1wOnA9PT0hMCYmKG49byk7YnJlYWt9fX19IW4mJiFwJiZmLmVycm9yKCJObyBjb252ZXJzaW9uIGZyb20gIittLnJlcGxhY2UoIiAiLCIgdG8gIikpLG4hPT0hMCYmKGM9bj9uKGMpOnAobyhjKSkpfX1yZXR1cm4gY31mdW5jdGlvbiBiWihhLGMsZCl7dmFyIGU9YS5jb250ZW50cyxmPWEuZGF0YVR5cGVzLGc9YS5yZXNwb25zZUZpZWxkcyxoLGksaixrO2ZvcihpIGluIGcpaSBpbiBkJiYoY1tnW2ldXT1kW2ldKTt3aGlsZShmWzBdPT09IioiKWYuc2hpZnQoKSxoPT09YiYmKGg9YS5taW1lVHlwZXx8Yy5nZXRSZXNwb25zZUhlYWRlcigiY29udGVudC10eXBlIikpO2lmKGgpZm9yKGkgaW4gZSlpZihlW2ldJiZlW2ldLnRlc3QoaCkpe2YudW5zaGlmdChpKTticmVha31pZihmWzBdaW4gZClqPWZbMF07ZWxzZXtmb3IoaSBpbiBkKXtpZighZlswXXx8YS5jb252ZXJ0ZXJzW2krIiAiK2ZbMF1dKXtqPWk7YnJlYWt9a3x8KGs9aSl9aj1qfHxrfWlmKGope2ohPT1mWzBdJiZmLnVuc2hpZnQoaik7cmV0dXJuIGRbal19fWZ1bmN0aW9uIGJZKGEsYixjLGQpe2lmKGYuaXNBcnJheShiKSlmLmVhY2goYixmdW5jdGlvbihiLGUpe2N8fGJDLnRlc3QoYSk/ZChhLGUpOmJZKGErIlsiKyh0eXBlb2YgZT09Im9iamVjdCJ8fGYuaXNBcnJheShlKT9iOiIiKSsiXSIsZSxjLGQpfSk7ZWxzZSBpZighYyYmYiE9bnVsbCYmdHlwZW9mIGI9PSJvYmplY3QiKWZvcih2YXIgZSBpbiBiKWJZKGErIlsiK2UrIl0iLGJbZV0sYyxkKTtlbHNlIGQoYSxiKX1mdW5jdGlvbiBiWChhLGMsZCxlLGYsZyl7Zj1mfHxjLmRhdGFUeXBlc1swXSxnPWd8fHt9LGdbZl09ITA7dmFyIGg9YVtmXSxpPTAsaj1oP2gubGVuZ3RoOjAsaz1hPT09YlIsbDtmb3IoO2k8aiYmKGt8fCFsKTtpKyspbD1oW2ldKGMsZCxlKSx0eXBlb2YgbD09InN0cmluZyImJigha3x8Z1tsXT9sPWI6KGMuZGF0YVR5cGVzLnVuc2hpZnQobCksbD1iWChhLGMsZCxlLGwsZykpKTsoa3x8IWwpJiYhZ1siKiJdJiYobD1iWChhLGMsZCxlLCIqIixnKSk7cmV0dXJuIGx9ZnVuY3Rpb24gYlcoYSl7cmV0dXJuIGZ1bmN0aW9uKGIsYyl7dHlwZW9mIGIhPSJzdHJpbmciJiYoYz1iLGI9IioiKTtpZihmLmlzRnVuY3Rpb24oYykpe3ZhciBkPWIudG9Mb3dlckNhc2UoKS5zcGxpdChiTiksZT0wLGc9ZC5sZW5ndGgsaCxpLGo7Zm9yKDtlPGc7ZSsrKWg9ZFtlXSxqPS9eXCsvLnRlc3QoaCksaiYmKGg9aC5zdWJzdHIoMSl8fCIqIiksaT1hW2hdPWFbaF18fFtdLGlbaj8idW5zaGlmdCI6InB1c2giXShjKX19fWZ1bmN0aW9uIGJBKGEsYixjKXt2YXIgZD1iPT09IndpZHRoIj9hLm9mZnNldFdpZHRoOmEub2Zmc2V0SGVpZ2h0LGU9Yj09PSJ3aWR0aCI/YnY6Ync7aWYoZD4wKXtjIT09ImJvcmRlciImJmYuZWFjaChlLGZ1bmN0aW9uKCl7Y3x8KGQtPXBhcnNlRmxvYXQoZi5jc3MoYSwicGFkZGluZyIrdGhpcykpfHwwKSxjPT09Im1hcmdpbiI/ZCs9cGFyc2VGbG9hdChmLmNzcyhhLGMrdGhpcykpfHwwOmQtPXBhcnNlRmxvYXQoZi5jc3MoYSwiYm9yZGVyIit0aGlzKyJXaWR0aCIpKXx8MH0pO3JldHVybiBkKyJweCJ9ZD1ieChhLGIsYik7aWYoZDwwfHxkPT1udWxsKWQ9YS5zdHlsZVtiXXx8MDtkPXBhcnNlRmxvYXQoZCl8fDAsYyYmZi5lYWNoKGUsZnVuY3Rpb24oKXtkKz1wYXJzZUZsb2F0KGYuY3NzKGEsInBhZGRpbmciK3RoaXMpKXx8MCxjIT09InBhZGRpbmciJiYoZCs9cGFyc2VGbG9hdChmLmNzcyhhLCJib3JkZXIiK3RoaXMrIldpZHRoIikpfHwwKSxjPT09Im1hcmdpbiImJihkKz1wYXJzZUZsb2F0KGYuY3NzKGEsYyt0aGlzKSl8fDApfSk7cmV0dXJuIGQrInB4In1mdW5jdGlvbiBibShhLGIpe2Iuc3JjP2YuYWpheCh7dXJsOmIuc3JjLGFzeW5jOiExLGRhdGFUeXBlOiJzY3JpcHQifSk6Zi5nbG9iYWxFdmFsKChiLnRleHR8fGIudGV4dENvbnRlbnR8fGIuaW5uZXJIVE1MfHwiIikucmVwbGFjZShiZSwiLyokMCovIikpLGIucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGIpfWZ1bmN0aW9uIGJsKGEpe2Yubm9kZU5hbWUoYSwiaW5wdXQiKT9iayhhKToiZ2V0RWxlbWVudHNCeVRhZ05hbWUiaW4gYSYmZi5ncmVwKGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlucHV0IiksYmspfWZ1bmN0aW9uIGJrKGEpe2lmKGEudHlwZT09PSJjaGVja2JveCJ8fGEudHlwZT09PSJyYWRpbyIpYS5kZWZhdWx0Q2hlY2tlZD1hLmNoZWNrZWR9ZnVuY3Rpb24gYmooYSl7cmV0dXJuImdldEVsZW1lbnRzQnlUYWdOYW1lImluIGE/YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpOiJxdWVyeVNlbGVjdG9yQWxsImluIGE/YS5xdWVyeVNlbGVjdG9yQWxsKCIqIik6W119ZnVuY3Rpb24gYmkoYSxiKXt2YXIgYztpZihiLm5vZGVUeXBlPT09MSl7Yi5jbGVhckF0dHJpYnV0ZXMmJmIuY2xlYXJBdHRyaWJ1dGVzKCksYi5tZXJnZUF0dHJpYnV0ZXMmJmIubWVyZ2VBdHRyaWJ1dGVzKGEpLGM9Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmKGM9PT0ib2JqZWN0IiliLm91dGVySFRNTD1hLm91dGVySFRNTDtlbHNlIGlmKGMhPT0iaW5wdXQifHxhLnR5cGUhPT0iY2hlY2tib3giJiZhLnR5cGUhPT0icmFkaW8iKXtpZihjPT09Im9wdGlvbiIpYi5zZWxlY3RlZD1hLmRlZmF1bHRTZWxlY3RlZDtlbHNlIGlmKGM9PT0iaW5wdXQifHxjPT09InRleHRhcmVhIiliLmRlZmF1bHRWYWx1ZT1hLmRlZmF1bHRWYWx1ZX1lbHNlIGEuY2hlY2tlZCYmKGIuZGVmYXVsdENoZWNrZWQ9Yi5jaGVja2VkPWEuY2hlY2tlZCksYi52YWx1ZSE9PWEudmFsdWUmJihiLnZhbHVlPWEudmFsdWUpO2IucmVtb3ZlQXR0cmlidXRlKGYuZXhwYW5kbyl9fWZ1bmN0aW9uIGJoKGEsYil7aWYoYi5ub2RlVHlwZT09PTEmJiEhZi5oYXNEYXRhKGEpKXt2YXIgYz1mLmV4cGFuZG8sZD1mLmRhdGEoYSksZT1mLmRhdGEoYixkKTtpZihkPWRbY10pe3ZhciBnPWQuZXZlbnRzO2U9ZVtjXT1mLmV4dGVuZCh7fSxkKTtpZihnKXtkZWxldGUgZS5oYW5kbGUsZS5ldmVudHM9e307Zm9yKHZhciBoIGluIGcpZm9yKHZhciBpPTAsaj1nW2hdLmxlbmd0aDtpPGo7aSsrKWYuZXZlbnQuYWRkKGIsaCsoZ1toXVtpXS5uYW1lc3BhY2U/Ii4iOiIiKStnW2hdW2ldLm5hbWVzcGFjZSxnW2hdW2ldLGdbaF1baV0uZGF0YSl9fX19ZnVuY3Rpb24gYmcoYSxiKXtyZXR1cm4gZi5ub2RlTmFtZShhLCJ0YWJsZSIpP2EuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRib2R5IilbMF18fGEuYXBwZW5kQ2hpbGQoYS5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRib2R5IikpOmF9ZnVuY3Rpb24gVyhhLGIsYyl7Yj1ifHwwO2lmKGYuaXNGdW5jdGlvbihiKSlyZXR1cm4gZi5ncmVwKGEsZnVuY3Rpb24oYSxkKXt2YXIgZT0hIWIuY2FsbChhLGQsYSk7cmV0dXJuIGU9PT1jfSk7aWYoYi5ub2RlVHlwZSlyZXR1cm4gZi5ncmVwKGEsZnVuY3Rpb24oYSxkKXtyZXR1cm4gYT09PWI9PT1jfSk7aWYodHlwZW9mIGI9PSJzdHJpbmciKXt2YXIgZD1mLmdyZXAoYSxmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlVHlwZT09PTF9KTtpZihSLnRlc3QoYikpcmV0dXJuIGYuZmlsdGVyKGIsZCwhYyk7Yj1mLmZpbHRlcihiLGQpfXJldHVybiBmLmdyZXAoYSxmdW5jdGlvbihhLGQpe3JldHVybiBmLmluQXJyYXkoYSxiKT49MD09PWN9KX1mdW5jdGlvbiBWKGEpe3JldHVybiFhfHwhYS5wYXJlbnROb2RlfHxhLnBhcmVudE5vZGUubm9kZVR5cGU9PT0xMX1mdW5jdGlvbiBOKGEsYil7cmV0dXJuKGEmJmEhPT0iKiI/YSsiLiI6IiIpK2IucmVwbGFjZSh6LCJgIikucmVwbGFjZShBLCImIil9ZnVuY3Rpb24gTShhKXt2YXIgYixjLGQsZSxnLGgsaSxqLGssbCxtLG4sbyxwPVtdLHE9W10scj1mLl9kYXRhKHRoaXMsImV2ZW50cyIpO2lmKCEoYS5saXZlRmlyZWQ9PT10aGlzfHwhcnx8IXIubGl2ZXx8YS50YXJnZXQuZGlzYWJsZWR8fGEuYnV0dG9uJiZhLnR5cGU9PT0iY2xpY2siKSl7YS5uYW1lc3BhY2UmJihuPW5ldyBSZWdFeHAoIihefFxcLikiK2EubmFtZXNwYWNlLnNwbGl0KCIuIikuam9pbigiXFwuKD86LipcXC4pPyIpKyIoXFwufCQpIikpLGEubGl2ZUZpcmVkPXRoaXM7dmFyIHM9ci5saXZlLnNsaWNlKDApO2ZvcihpPTA7aTxzLmxlbmd0aDtpKyspZz1zW2ldLGcub3JpZ1R5cGUucmVwbGFjZSh4LCIiKT09PWEudHlwZT9xLnB1c2goZy5zZWxlY3Rvcik6cy5zcGxpY2UoaS0tLDEpO2U9ZihhLnRhcmdldCkuY2xvc2VzdChxLGEuY3VycmVudFRhcmdldCk7Zm9yKGo9MCxrPWUubGVuZ3RoO2o8aztqKyspe209ZVtqXTtmb3IoaT0wO2k8cy5sZW5ndGg7aSsrKXtnPXNbaV07aWYobS5zZWxlY3Rvcj09PWcuc2VsZWN0b3ImJighbnx8bi50ZXN0KGcubmFtZXNwYWNlKSkmJiFtLmVsZW0uZGlzYWJsZWQpe2g9bS5lbGVtLGQ9bnVsbDtpZihnLnByZVR5cGU9PT0ibW91c2VlbnRlciJ8fGcucHJlVHlwZT09PSJtb3VzZWxlYXZlIilhLnR5cGU9Zy5wcmVUeXBlLGQ9ZihhLnJlbGF0ZWRUYXJnZXQpLmNsb3Nlc3QoZy5zZWxlY3RvcilbMF0sZCYmZi5jb250YWlucyhoLGQpJiYoZD1oKTsoIWR8fGQhPT1oKSYmcC5wdXNoKHtlbGVtOmgsaGFuZGxlT2JqOmcsbGV2ZWw6bS5sZXZlbH0pfX19Zm9yKGo9MCxrPXAubGVuZ3RoO2o8aztqKyspe2U9cFtqXTtpZihjJiZlLmxldmVsPmMpYnJlYWs7YS5jdXJyZW50VGFyZ2V0PWUuZWxlbSxhLmRhdGE9ZS5oYW5kbGVPYmouZGF0YSxhLmhhbmRsZU9iaj1lLmhhbmRsZU9iaixvPWUuaGFuZGxlT2JqLm9yaWdIYW5kbGVyLmFwcGx5KGUuZWxlbSxhcmd1bWVudHMpO2lmKG89PT0hMXx8YS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKXtjPWUubGV2ZWwsbz09PSExJiYoYj0hMSk7aWYoYS5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpKWJyZWFrfX1yZXR1cm4gYn19ZnVuY3Rpb24gSyhhLGMsZCl7dmFyIGU9Zi5leHRlbmQoe30sZFswXSk7ZS50eXBlPWEsZS5vcmlnaW5hbEV2ZW50PXt9LGUubGl2ZUZpcmVkPWIsZi5ldmVudC5oYW5kbGUuY2FsbChjLGUpLGUuaXNEZWZhdWx0UHJldmVudGVkKCkmJmRbMF0ucHJldmVudERlZmF1bHQoKX1mdW5jdGlvbiBFKCl7cmV0dXJuITB9ZnVuY3Rpb24gRCgpe3JldHVybiExfWZ1bmN0aW9uIG0oYSxjLGQpe3ZhciBlPWMrImRlZmVyIixnPWMrInF1ZXVlIixoPWMrIm1hcmsiLGk9Zi5kYXRhKGEsZSxiLCEwKTtpJiYoZD09PSJxdWV1ZSJ8fCFmLmRhdGEoYSxnLGIsITApKSYmKGQ9PT0ibWFyayJ8fCFmLmRhdGEoYSxoLGIsITApKSYmc2V0VGltZW91dChmdW5jdGlvbigpeyFmLmRhdGEoYSxnLGIsITApJiYhZi5kYXRhKGEsaCxiLCEwKSYmKGYucmVtb3ZlRGF0YShhLGUsITApLGkucmVzb2x2ZSgpKX0sMCl9ZnVuY3Rpb24gbChhKXtmb3IodmFyIGIgaW4gYSlpZihiIT09InRvSlNPTiIpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gayhhLGMsZCl7aWYoZD09PWImJmEubm9kZVR5cGU9PT0xKXt2YXIgZT0iZGF0YS0iK2MucmVwbGFjZShqLCIkMS0kMiIpLnRvTG93ZXJDYXNlKCk7ZD1hLmdldEF0dHJpYnV0ZShlKTtpZih0eXBlb2YgZD09InN0cmluZyIpe3RyeXtkPWQ9PT0idHJ1ZSI/ITA6ZD09PSJmYWxzZSI/ITE6ZD09PSJudWxsIj9udWxsOmYuaXNOYU4oZCk/aS50ZXN0KGQpP2YucGFyc2VKU09OKGQpOmQ6cGFyc2VGbG9hdChkKX1jYXRjaChnKXt9Zi5kYXRhKGEsYyxkKX1lbHNlIGQ9Yn1yZXR1cm4gZH12YXIgYz1hLmRvY3VtZW50LGQ9YS5uYXZpZ2F0b3IsZT1hLmxvY2F0aW9uLGY9ZnVuY3Rpb24oKXtmdW5jdGlvbiBKKCl7aWYoIWUuaXNSZWFkeSl7dHJ5e2MuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKCJsZWZ0Iil9Y2F0Y2goYSl7c2V0VGltZW91dChKLDEpO3JldHVybn1lLnJlYWR5KCl9fXZhciBlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBlLmZuLmluaXQoYSxiLGgpfSxmPWEualF1ZXJ5LGc9YS4kLGgsaT0vXig/OltePF0qKDxbXHdcV10rPilbXj5dKiR8IyhbXHdcLV0qKSQpLyxqPS9cUy8saz0vXlxzKy8sbD0vXHMrJC8sbT0vXGQvLG49L148KFx3KylccypcLz8+KD86PFwvXDE+KT8kLyxvPS9eW1xdLDp7fVxzXSokLyxwPS9cXCg/OlsiXFxcL2JmbnJ0XXx1WzAtOWEtZkEtRl17NH0pL2cscT0vIlteIlxcXG5ccl0qInx0cnVlfGZhbHNlfG51bGx8LT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/L2cscj0vKD86Xnw6fCwpKD86XHMqXFspKy9nLHM9Lyh3ZWJraXQpWyBcL10oW1x3Ll0rKS8sdD0vKG9wZXJhKSg/Oi4qdmVyc2lvbik/WyBcL10oW1x3Ll0rKS8sdT0vKG1zaWUpIChbXHcuXSspLyx2PS8obW96aWxsYSkoPzouKj8gcnY6KFtcdy5dKykpPy8sdz0vLShbYS16XSkvaWcseD1mdW5jdGlvbihhLGIpe3JldHVybiBiLnRvVXBwZXJDYXNlKCl9LHk9ZC51c2VyQWdlbnQseixBLEIsQz1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLEQ9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxFPUFycmF5LnByb3RvdHlwZS5wdXNoLEY9QXJyYXkucHJvdG90eXBlLnNsaWNlLEc9U3RyaW5nLnByb3RvdHlwZS50cmltLEg9QXJyYXkucHJvdG90eXBlLmluZGV4T2YsST17fTtlLmZuPWUucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjplLGluaXQ6ZnVuY3Rpb24oYSxkLGYpe3ZhciBnLGgsaixrO2lmKCFhKXJldHVybiB0aGlzO2lmKGEubm9kZVR5cGUpe3RoaXMuY29udGV4dD10aGlzWzBdPWEsdGhpcy5sZW5ndGg9MTtyZXR1cm4gdGhpc31pZihhPT09ImJvZHkiJiYhZCYmYy5ib2R5KXt0aGlzLmNvbnRleHQ9Yyx0aGlzWzBdPWMuYm9keSx0aGlzLnNlbGVjdG9yPWEsdGhpcy5sZW5ndGg9MTtyZXR1cm4gdGhpc31pZih0eXBlb2YgYT09InN0cmluZyIpe2EuY2hhckF0KDApIT09IjwifHxhLmNoYXJBdChhLmxlbmd0aC0xKSE9PSI+Inx8YS5sZW5ndGg8Mz9nPWkuZXhlYyhhKTpnPVtudWxsLGEsbnVsbF07aWYoZyYmKGdbMV18fCFkKSl7aWYoZ1sxXSl7ZD1kIGluc3RhbmNlb2YgZT9kWzBdOmQsaz1kP2Qub3duZXJEb2N1bWVudHx8ZDpjLGo9bi5leGVjKGEpLGo/ZS5pc1BsYWluT2JqZWN0KGQpPyhhPVtjLmNyZWF0ZUVsZW1lbnQoalsxXSldLGUuZm4uYXR0ci5jYWxsKGEsZCwhMCkpOmE9W2suY3JlYXRlRWxlbWVudChqWzFdKV06KGo9ZS5idWlsZEZyYWdtZW50KFtnWzFdXSxba10pLGE9KGouY2FjaGVhYmxlP2UuY2xvbmUoai5mcmFnbWVudCk6ai5mcmFnbWVudCkuY2hpbGROb2Rlcyk7cmV0dXJuIGUubWVyZ2UodGhpcyxhKX1oPWMuZ2V0RWxlbWVudEJ5SWQoZ1syXSk7aWYoaCYmaC5wYXJlbnROb2RlKXtpZihoLmlkIT09Z1syXSlyZXR1cm4gZi5maW5kKGEpO3RoaXMubGVuZ3RoPTEsdGhpc1swXT1ofXRoaXMuY29udGV4dD1jLHRoaXMuc2VsZWN0b3I9YTtyZXR1cm4gdGhpc31yZXR1cm4hZHx8ZC5qcXVlcnk/KGR8fGYpLmZpbmQoYSk6dGhpcy5jb25zdHJ1Y3RvcihkKS5maW5kKGEpfWlmKGUuaXNGdW5jdGlvbihhKSlyZXR1cm4gZi5yZWFkeShhKTthLnNlbGVjdG9yIT09YiYmKHRoaXMuc2VsZWN0b3I9YS5zZWxlY3Rvcix0aGlzLmNvbnRleHQ9YS5jb250ZXh0KTtyZXR1cm4gZS5tYWtlQXJyYXkoYSx0aGlzKX0sc2VsZWN0b3I6IiIsanF1ZXJ5OiIxLjYuMiIsbGVuZ3RoOjAsc2l6ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmxlbmd0aH0sdG9BcnJheTpmdW5jdGlvbigpe3JldHVybiBGLmNhbGwodGhpcywwKX0sZ2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsP3RoaXMudG9BcnJheSgpOmE8MD90aGlzW3RoaXMubGVuZ3RoK2FdOnRoaXNbYV19LHB1c2hTdGFjazpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5jb25zdHJ1Y3RvcigpO2UuaXNBcnJheShhKT9FLmFwcGx5KGQsYSk6ZS5tZXJnZShkLGEpLGQucHJldk9iamVjdD10aGlzLGQuY29udGV4dD10aGlzLmNvbnRleHQsYj09PSJmaW5kIj9kLnNlbGVjdG9yPXRoaXMuc2VsZWN0b3IrKHRoaXMuc2VsZWN0b3I/IiAiOiIiKStjOmImJihkLnNlbGVjdG9yPXRoaXMuc2VsZWN0b3IrIi4iK2IrIigiK2MrIikiKTtyZXR1cm4gZH0sZWFjaDpmdW5jdGlvbihhLGIpe3JldHVybiBlLmVhY2godGhpcyxhLGIpfSxyZWFkeTpmdW5jdGlvbihhKXtlLmJpbmRSZWFkeSgpLEEuZG9uZShhKTtyZXR1cm4gdGhpc30sZXE6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT0tMT90aGlzLnNsaWNlKGEpOnRoaXMuc2xpY2UoYSwrYSsxKX0sZmlyc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lcSgwKX0sbGFzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKC0xKX0sc2xpY2U6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2soRi5hcHBseSh0aGlzLGFyZ3VtZW50cyksInNsaWNlIixGLmNhbGwoYXJndW1lbnRzKS5qb2luKCIsIikpfSxtYXA6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGUubWFwKHRoaXMsZnVuY3Rpb24oYixjKXtyZXR1cm4gYS5jYWxsKGIsYyxiKX0pKX0sZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHJldk9iamVjdHx8dGhpcy5jb25zdHJ1Y3RvcihudWxsKX0scHVzaDpFLHNvcnQ6W10uc29ydCxzcGxpY2U6W10uc3BsaWNlfSxlLmZuLmluaXQucHJvdG90eXBlPWUuZm4sZS5leHRlbmQ9ZS5mbi5leHRlbmQ9ZnVuY3Rpb24oKXt2YXIgYSxjLGQsZixnLGgsaT1hcmd1bWVudHNbMF18fHt9LGo9MSxrPWFyZ3VtZW50cy5sZW5ndGgsbD0hMTt0eXBlb2YgaT09ImJvb2xlYW4iJiYobD1pLGk9YXJndW1lbnRzWzFdfHx7fSxqPTIpLHR5cGVvZiBpIT0ib2JqZWN0IiYmIWUuaXNGdW5jdGlvbihpKSYmKGk9e30pLGs9PT1qJiYoaT10aGlzLC0taik7Zm9yKDtqPGs7aisrKWlmKChhPWFyZ3VtZW50c1tqXSkhPW51bGwpZm9yKGMgaW4gYSl7ZD1pW2NdLGY9YVtjXTtpZihpPT09Ziljb250aW51ZTtsJiZmJiYoZS5pc1BsYWluT2JqZWN0KGYpfHwoZz1lLmlzQXJyYXkoZikpKT8oZz8oZz0hMSxoPWQmJmUuaXNBcnJheShkKT9kOltdKTpoPWQmJmUuaXNQbGFpbk9iamVjdChkKT9kOnt9LGlbY109ZS5leHRlbmQobCxoLGYpKTpmIT09YiYmKGlbY109Zil9cmV0dXJuIGl9LGUuZXh0ZW5kKHtub0NvbmZsaWN0OmZ1bmN0aW9uKGIpe2EuJD09PWUmJihhLiQ9ZyksYiYmYS5qUXVlcnk9PT1lJiYoYS5qUXVlcnk9Zik7cmV0dXJuIGV9LGlzUmVhZHk6ITEscmVhZHlXYWl0OjEsaG9sZFJlYWR5OmZ1bmN0aW9uKGEpe2E/ZS5yZWFkeVdhaXQrKzplLnJlYWR5KCEwKX0scmVhZHk6ZnVuY3Rpb24oYSl7aWYoYT09PSEwJiYhLS1lLnJlYWR5V2FpdHx8YSE9PSEwJiYhZS5pc1JlYWR5KXtpZighYy5ib2R5KXJldHVybiBzZXRUaW1lb3V0KGUucmVhZHksMSk7ZS5pc1JlYWR5PSEwO2lmKGEhPT0hMCYmLS1lLnJlYWR5V2FpdD4wKXJldHVybjtBLnJlc29sdmVXaXRoKGMsW2VdKSxlLmZuLnRyaWdnZXImJmUoYykudHJpZ2dlcigicmVhZHkiKS51bmJpbmQoInJlYWR5Iil9fSxiaW5kUmVhZHk6ZnVuY3Rpb24oKXtpZighQSl7QT1lLl9EZWZlcnJlZCgpO2lmKGMucmVhZHlTdGF0ZT09PSJjb21wbGV0ZSIpcmV0dXJuIHNldFRpbWVvdXQoZS5yZWFkeSwxKTtpZihjLmFkZEV2ZW50TGlzdGVuZXIpYy5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixCLCExKSxhLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLGUucmVhZHksITEpO2Vsc2UgaWYoYy5hdHRhY2hFdmVudCl7Yy5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIixCKSxhLmF0dGFjaEV2ZW50KCJvbmxvYWQiLGUucmVhZHkpO3ZhciBiPSExO3RyeXtiPWEuZnJhbWVFbGVtZW50PT1udWxsfWNhdGNoKGQpe31jLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCYmYiYmSigpfX19LGlzRnVuY3Rpb246ZnVuY3Rpb24oYSl7cmV0dXJuIGUudHlwZShhKT09PSJmdW5jdGlvbiJ9LGlzQXJyYXk6QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oYSl7cmV0dXJuIGUudHlwZShhKT09PSJhcnJheSJ9LGlzV2luZG93OmZ1bmN0aW9uKGEpe3JldHVybiBhJiZ0eXBlb2YgYT09Im9iamVjdCImJiJzZXRJbnRlcnZhbCJpbiBhfSxpc05hTjpmdW5jdGlvbihhKXtyZXR1cm4gYT09bnVsbHx8IW0udGVzdChhKXx8aXNOYU4oYSl9LHR5cGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/U3RyaW5nKGEpOklbQy5jYWxsKGEpXXx8Im9iamVjdCJ9LGlzUGxhaW5PYmplY3Q6ZnVuY3Rpb24oYSl7aWYoIWF8fGUudHlwZShhKSE9PSJvYmplY3QifHxhLm5vZGVUeXBlfHxlLmlzV2luZG93KGEpKXJldHVybiExO2lmKGEuY29uc3RydWN0b3ImJiFELmNhbGwoYSwiY29uc3RydWN0b3IiKSYmIUQuY2FsbChhLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwiaXNQcm90b3R5cGVPZiIpKXJldHVybiExO3ZhciBjO2ZvcihjIGluIGEpO3JldHVybiBjPT09Ynx8RC5jYWxsKGEsYyl9LGlzRW1wdHlPYmplY3Q6ZnVuY3Rpb24oYSl7Zm9yKHZhciBiIGluIGEpcmV0dXJuITE7cmV0dXJuITB9LGVycm9yOmZ1bmN0aW9uKGEpe3Rocm93IGF9LHBhcnNlSlNPTjpmdW5jdGlvbihiKXtpZih0eXBlb2YgYiE9InN0cmluZyJ8fCFiKXJldHVybiBudWxsO2I9ZS50cmltKGIpO2lmKGEuSlNPTiYmYS5KU09OLnBhcnNlKXJldHVybiBhLkpTT04ucGFyc2UoYik7aWYoby50ZXN0KGIucmVwbGFjZShwLCJAIikucmVwbGFjZShxLCJdIikucmVwbGFjZShyLCIiKSkpcmV0dXJuKG5ldyBGdW5jdGlvbigicmV0dXJuICIrYikpKCk7ZS5lcnJvcigiSW52YWxpZCBKU09OOiAiK2IpfSxwYXJzZVhNTDpmdW5jdGlvbihiLGMsZCl7YS5ET01QYXJzZXI/KGQ9bmV3IERPTVBhcnNlcixjPWQucGFyc2VGcm9tU3RyaW5nKGIsInRleHQveG1sIikpOihjPW5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MRE9NIiksYy5hc3luYz0iZmFsc2UiLGMubG9hZFhNTChiKSksZD1jLmRvY3VtZW50RWxlbWVudCwoIWR8fCFkLm5vZGVOYW1lfHxkLm5vZGVOYW1lPT09InBhcnNlcmVycm9yIikmJmUuZXJyb3IoIkludmFsaWQgWE1MOiAiK2IpO3JldHVybiBjfSxub29wOmZ1bmN0aW9uKCl7fSxnbG9iYWxFdmFsOmZ1bmN0aW9uKGIpe2ImJmoudGVzdChiKSYmKGEuZXhlY1NjcmlwdHx8ZnVuY3Rpb24oYil7YS5ldmFsLmNhbGwoYSxiKX0pKGIpfSxjYW1lbENhc2U6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSh3LHgpfSxub2RlTmFtZTpmdW5jdGlvbihhLGIpe3JldHVybiBhLm5vZGVOYW1lJiZhLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk9PT1iLnRvVXBwZXJDYXNlKCl9LGVhY2g6ZnVuY3Rpb24oYSxjLGQpe3ZhciBmLGc9MCxoPWEubGVuZ3RoLGk9aD09PWJ8fGUuaXNGdW5jdGlvbihhKTtpZihkKXtpZihpKXtmb3IoZiBpbiBhKWlmKGMuYXBwbHkoYVtmXSxkKT09PSExKWJyZWFrfWVsc2UgZm9yKDtnPGg7KWlmKGMuYXBwbHkoYVtnKytdLGQpPT09ITEpYnJlYWt9ZWxzZSBpZihpKXtmb3IoZiBpbiBhKWlmKGMuY2FsbChhW2ZdLGYsYVtmXSk9PT0hMSlicmVha31lbHNlIGZvcig7ZzxoOylpZihjLmNhbGwoYVtnXSxnLGFbZysrXSk9PT0hMSlicmVhaztyZXR1cm4gYX0sdHJpbTpHP2Z1bmN0aW9uKGEpe3JldHVybiBhPT1udWxsPyIiOkcuY2FsbChhKX06ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/IiI6KGErIiIpLnJlcGxhY2UoaywiIikucmVwbGFjZShsLCIiKX0sbWFrZUFycmF5OmZ1bmN0aW9uKGEsYil7dmFyIGM9Ynx8W107aWYoYSE9bnVsbCl7dmFyIGQ9ZS50eXBlKGEpO2EubGVuZ3RoPT1udWxsfHxkPT09InN0cmluZyJ8fGQ9PT0iZnVuY3Rpb24ifHxkPT09InJlZ2V4cCJ8fGUuaXNXaW5kb3coYSk/RS5jYWxsKGMsYSk6ZS5tZXJnZShjLGEpfXJldHVybiBjfSxpbkFycmF5OmZ1bmN0aW9uKGEsYil7aWYoSClyZXR1cm4gSC5jYWxsKGIsYSk7Zm9yKHZhciBjPTAsZD1iLmxlbmd0aDtjPGQ7YysrKWlmKGJbY109PT1hKXJldHVybiBjO3JldHVybi0xfSxtZXJnZTpmdW5jdGlvbihhLGMpe3ZhciBkPWEubGVuZ3RoLGU9MDtpZih0eXBlb2YgYy5sZW5ndGg9PSJudW1iZXIiKWZvcih2YXIgZj1jLmxlbmd0aDtlPGY7ZSsrKWFbZCsrXT1jW2VdO2Vsc2Ugd2hpbGUoY1tlXSE9PWIpYVtkKytdPWNbZSsrXTthLmxlbmd0aD1kO3JldHVybiBhfSxncmVwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD1bXSxlO2M9ISFjO2Zvcih2YXIgZj0wLGc9YS5sZW5ndGg7ZjxnO2YrKyllPSEhYihhW2ZdLGYpLGMhPT1lJiZkLnB1c2goYVtmXSk7cmV0dXJuIGR9LG1hcDpmdW5jdGlvbihhLGMsZCl7dmFyIGYsZyxoPVtdLGk9MCxqPWEubGVuZ3RoLGs9YSBpbnN0YW5jZW9mIGV8fGohPT1iJiZ0eXBlb2Ygaj09Im51bWJlciImJihqPjAmJmFbMF0mJmFbai0xXXx8aj09PTB8fGUuaXNBcnJheShhKSk7aWYoaylmb3IoO2k8ajtpKyspZj1jKGFbaV0saSxkKSxmIT1udWxsJiYoaFtoLmxlbmd0aF09Zik7ZWxzZSBmb3IoZyBpbiBhKWY9YyhhW2ddLGcsZCksZiE9bnVsbCYmKGhbaC5sZW5ndGhdPWYpO3JldHVybiBoLmNvbmNhdC5hcHBseShbXSxoKX0sZ3VpZDoxLHByb3h5OmZ1bmN0aW9uKGEsYyl7aWYodHlwZW9mIGM9PSJzdHJpbmciKXt2YXIgZD1hW2NdO2M9YSxhPWR9aWYoIWUuaXNGdW5jdGlvbihhKSlyZXR1cm4gYjt2YXIgZj1GLmNhbGwoYXJndW1lbnRzLDIpLGc9ZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShjLGYuY29uY2F0KEYuY2FsbChhcmd1bWVudHMpKSl9O2cuZ3VpZD1hLmd1aWQ9YS5ndWlkfHxnLmd1aWR8fGUuZ3VpZCsrO3JldHVybiBnfSxhY2Nlc3M6ZnVuY3Rpb24oYSxjLGQsZixnLGgpe3ZhciBpPWEubGVuZ3RoO2lmKHR5cGVvZiBjPT0ib2JqZWN0Iil7Zm9yKHZhciBqIGluIGMpZS5hY2Nlc3MoYSxqLGNbal0sZixnLGQpO3JldHVybiBhfWlmKGQhPT1iKXtmPSFoJiZmJiZlLmlzRnVuY3Rpb24oZCk7Zm9yKHZhciBrPTA7azxpO2srKylnKGFba10sYyxmP2QuY2FsbChhW2tdLGssZyhhW2tdLGMpKTpkLGgpO3JldHVybiBhfXJldHVybiBpP2coYVswXSxjKTpifSxub3c6ZnVuY3Rpb24oKXtyZXR1cm4obmV3IERhdGUpLmdldFRpbWUoKX0sdWFNYXRjaDpmdW5jdGlvbihhKXthPWEudG9Mb3dlckNhc2UoKTt2YXIgYj1zLmV4ZWMoYSl8fHQuZXhlYyhhKXx8dS5leGVjKGEpfHxhLmluZGV4T2YoImNvbXBhdGlibGUiKTwwJiZ2LmV4ZWMoYSl8fFtdO3JldHVybnticm93c2VyOmJbMV18fCIiLHZlcnNpb246YlsyXXx8IjAifX0sc3ViOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gYShiLGMpe3JldHVybiBuZXcgYS5mbi5pbml0KGIsYyl9ZS5leHRlbmQoITAsYSx0aGlzKSxhLnN1cGVyY2xhc3M9dGhpcyxhLmZuPWEucHJvdG90eXBlPXRoaXMoKSxhLmZuLmNvbnN0cnVjdG9yPWEsYS5zdWI9dGhpcy5zdWIsYS5mbi5pbml0PWZ1bmN0aW9uKGQsZil7ZiYmZiBpbnN0YW5jZW9mIGUmJiEoZiBpbnN0YW5jZW9mIGEpJiYoZj1hKGYpKTtyZXR1cm4gZS5mbi5pbml0LmNhbGwodGhpcyxkLGYsYil9LGEuZm4uaW5pdC5wcm90b3R5cGU9YS5mbjt2YXIgYj1hKGMpO3JldHVybiBhfSxicm93c2VyOnt9fSksZS5lYWNoKCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0Ii5zcGxpdCgiICIpLGZ1bmN0aW9uKGEsYil7SVsiW29iamVjdCAiK2IrIl0iXT1iLnRvTG93ZXJDYXNlKCl9KSx6PWUudWFNYXRjaCh5KSx6LmJyb3dzZXImJihlLmJyb3dzZXJbei5icm93c2VyXT0hMCxlLmJyb3dzZXIudmVyc2lvbj16LnZlcnNpb24pLGUuYnJvd3Nlci53ZWJraXQmJihlLmJyb3dzZXIuc2FmYXJpPSEwKSxqLnRlc3QoIsKgIikmJihrPS9eW1xzXHhBMF0rLyxsPS9bXHNceEEwXSskLyksaD1lKGMpLGMuYWRkRXZlbnRMaXN0ZW5lcj9CPWZ1bmN0aW9uKCl7Yy5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixCLCExKSxlLnJlYWR5KCl9OmMuYXR0YWNoRXZlbnQmJihCPWZ1bmN0aW9uKCl7Yy5yZWFkeVN0YXRlPT09ImNvbXBsZXRlIiYmKGMuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsQiksZS5yZWFkeSgpKX0pO3JldHVybiBlfSgpLGc9ImRvbmUgZmFpbCBpc1Jlc29sdmVkIGlzUmVqZWN0ZWQgcHJvbWlzZSB0aGVuIGFsd2F5cyBwaXBlIi5zcGxpdCgiICIpLGg9W10uc2xpY2U7Zi5leHRlbmQoe19EZWZlcnJlZDpmdW5jdGlvbigpe3ZhciBhPVtdLGIsYyxkLGU9e2RvbmU6ZnVuY3Rpb24oKXtpZighZCl7dmFyIGM9YXJndW1lbnRzLGcsaCxpLGosaztiJiYoaz1iLGI9MCk7Zm9yKGc9MCxoPWMubGVuZ3RoO2c8aDtnKyspaT1jW2ddLGo9Zi50eXBlKGkpLGo9PT0iYXJyYXkiP2UuZG9uZS5hcHBseShlLGkpOmo9PT0iZnVuY3Rpb24iJiZhLnB1c2goaSk7ayYmZS5yZXNvbHZlV2l0aChrWzBdLGtbMV0pfXJldHVybiB0aGlzfSxyZXNvbHZlV2l0aDpmdW5jdGlvbihlLGYpe2lmKCFkJiYhYiYmIWMpe2Y9Znx8W10sYz0xO3RyeXt3aGlsZShhWzBdKWEuc2hpZnQoKS5hcHBseShlLGYpfWZpbmFsbHl7Yj1bZSxmXSxjPTB9fXJldHVybiB0aGlzfSxyZXNvbHZlOmZ1bmN0aW9uKCl7ZS5yZXNvbHZlV2l0aCh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIHRoaXN9LGlzUmVzb2x2ZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hIWN8fCEhYn0sY2FuY2VsOmZ1bmN0aW9uKCl7ZD0xLGE9W107cmV0dXJuIHRoaXN9fTtyZXR1cm4gZX0sRGVmZXJyZWQ6ZnVuY3Rpb24oYSl7dmFyIGI9Zi5fRGVmZXJyZWQoKSxjPWYuX0RlZmVycmVkKCksZDtmLmV4dGVuZChiLHt0aGVuOmZ1bmN0aW9uKGEsYyl7Yi5kb25lKGEpLmZhaWwoYyk7cmV0dXJuIHRoaXN9LGFsd2F5czpmdW5jdGlvbigpe3JldHVybiBiLmRvbmUuYXBwbHkoYixhcmd1bWVudHMpLmZhaWwuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxmYWlsOmMuZG9uZSxyZWplY3RXaXRoOmMucmVzb2x2ZVdpdGgscmVqZWN0OmMucmVzb2x2ZSxpc1JlamVjdGVkOmMuaXNSZXNvbHZlZCxwaXBlOmZ1bmN0aW9uKGEsYyl7cmV0dXJuIGYuRGVmZXJyZWQoZnVuY3Rpb24oZCl7Zi5lYWNoKHtkb25lOlthLCJyZXNvbHZlIl0sZmFpbDpbYywicmVqZWN0Il19LGZ1bmN0aW9uKGEsYyl7dmFyIGU9Y1swXSxnPWNbMV0saDtmLmlzRnVuY3Rpb24oZSk/YlthXShmdW5jdGlvbigpe2g9ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksaCYmZi5pc0Z1bmN0aW9uKGgucHJvbWlzZSk/aC5wcm9taXNlKCkudGhlbihkLnJlc29sdmUsZC5yZWplY3QpOmRbZ10oaCl9KTpiW2FdKGRbZ10pfSl9KS5wcm9taXNlKCl9LHByb21pc2U6ZnVuY3Rpb24oYSl7aWYoYT09bnVsbCl7aWYoZClyZXR1cm4gZDtkPWE9e319dmFyIGM9Zy5sZW5ndGg7d2hpbGUoYy0tKWFbZ1tjXV09YltnW2NdXTtyZXR1cm4gYX19KSxiLmRvbmUoYy5jYW5jZWwpLmZhaWwoYi5jYW5jZWwpLGRlbGV0ZSBiLmNhbmNlbCxhJiZhLmNhbGwoYixiKTtyZXR1cm4gYn0sd2hlbjpmdW5jdGlvbihhKXtmdW5jdGlvbiBpKGEpe3JldHVybiBmdW5jdGlvbihjKXtiW2FdPWFyZ3VtZW50cy5sZW5ndGg+MT9oLmNhbGwoYXJndW1lbnRzLDApOmMsLS1lfHxnLnJlc29sdmVXaXRoKGcsaC5jYWxsKGIsMCkpfX12YXIgYj1hcmd1bWVudHMsYz0wLGQ9Yi5sZW5ndGgsZT1kLGc9ZDw9MSYmYSYmZi5pc0Z1bmN0aW9uKGEucHJvbWlzZSk/YTpmLkRlZmVycmVkKCk7aWYoZD4xKXtmb3IoO2M8ZDtjKyspYltjXSYmZi5pc0Z1bmN0aW9uKGJbY10ucHJvbWlzZSk/YltjXS5wcm9taXNlKCkudGhlbihpKGMpLGcucmVqZWN0KTotLWU7ZXx8Zy5yZXNvbHZlV2l0aChnLGIpfWVsc2UgZyE9PWEmJmcucmVzb2x2ZVdpdGgoZyxkP1thXTpbXSk7cmV0dXJuIGcucHJvbWlzZSgpfX0pLGYuc3VwcG9ydD1mdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudCgiZGl2IiksYj1jLmRvY3VtZW50RWxlbWVudCxkLGUsZyxoLGksaixrLGwsbSxuLG8scCxxLHIscyx0LHU7YS5zZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIsInQiKSxhLmlubmVySFRNTD0iICAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJyBzdHlsZT0ndG9wOjFweDtmbG9hdDpsZWZ0O29wYWNpdHk6LjU1Oyc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz4iLGQ9YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLGU9YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYSIpWzBdO2lmKCFkfHwhZC5sZW5ndGh8fCFlKXJldHVybnt9O2c9Yy5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKSxoPWcuYXBwZW5kQ2hpbGQoYy5jcmVhdGVFbGVtZW50KCJvcHRpb24iKSksaT1hLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpbnB1dCIpWzBdLGs9e2xlYWRpbmdXaGl0ZXNwYWNlOmEuZmlyc3RDaGlsZC5ub2RlVHlwZT09PTMsdGJvZHk6IWEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRib2R5IikubGVuZ3RoLGh0bWxTZXJpYWxpemU6ISFhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJsaW5rIikubGVuZ3RoLHN0eWxlOi90b3AvLnRlc3QoZS5nZXRBdHRyaWJ1dGUoInN0eWxlIikpLGhyZWZOb3JtYWxpemVkOmUuZ2V0QXR0cmlidXRlKCJocmVmIik9PT0iL2EiLG9wYWNpdHk6L14wLjU1JC8udGVzdChlLnN0eWxlLm9wYWNpdHkpLGNzc0Zsb2F0OiEhZS5zdHlsZS5jc3NGbG9hdCxjaGVja09uOmkudmFsdWU9PT0ib24iLG9wdFNlbGVjdGVkOmguc2VsZWN0ZWQsZ2V0U2V0QXR0cmlidXRlOmEuY2xhc3NOYW1lIT09InQiLHN1Ym1pdEJ1YmJsZXM6ITAsY2hhbmdlQnViYmxlczohMCxmb2N1c2luQnViYmxlczohMSxkZWxldGVFeHBhbmRvOiEwLG5vQ2xvbmVFdmVudDohMCxpbmxpbmVCbG9ja05lZWRzTGF5b3V0OiExLHNocmlua1dyYXBCbG9ja3M6ITEscmVsaWFibGVNYXJnaW5SaWdodDohMH0saS5jaGVja2VkPSEwLGsubm9DbG9uZUNoZWNrZWQ9aS5jbG9uZU5vZGUoITApLmNoZWNrZWQsZy5kaXNhYmxlZD0hMCxrLm9wdERpc2FibGVkPSFoLmRpc2FibGVkO3RyeXtkZWxldGUgYS50ZXN0fWNhdGNoKHYpe2suZGVsZXRlRXhwYW5kbz0hMX0hYS5hZGRFdmVudExpc3RlbmVyJiZhLmF0dGFjaEV2ZW50JiZhLmZpcmVFdmVudCYmKGEuYXR0YWNoRXZlbnQoIm9uY2xpY2siLGZ1bmN0aW9uKCl7ay5ub0Nsb25lRXZlbnQ9ITF9KSxhLmNsb25lTm9kZSghMCkuZmlyZUV2ZW50KCJvbmNsaWNrIikpLGk9Yy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpLGkudmFsdWU9InQiLGkuc2V0QXR0cmlidXRlKCJ0eXBlIiwicmFkaW8iKSxrLnJhZGlvVmFsdWU9aS52YWx1ZT09PSJ0IixpLnNldEF0dHJpYnV0ZSgiY2hlY2tlZCIsImNoZWNrZWQiKSxhLmFwcGVuZENoaWxkKGkpLGw9Yy5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksbC5hcHBlbmRDaGlsZChhLmZpcnN0Q2hpbGQpLGsuY2hlY2tDbG9uZT1sLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCxhLmlubmVySFRNTD0iIixhLnN0eWxlLndpZHRoPWEuc3R5bGUucGFkZGluZ0xlZnQ9IjFweCIsbT1jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0sbz1jLmNyZWF0ZUVsZW1lbnQobT8iZGl2IjoiYm9keSIpLHA9e3Zpc2liaWxpdHk6ImhpZGRlbiIsd2lkdGg6MCxoZWlnaHQ6MCxib3JkZXI6MCxtYXJnaW46MH0sbSYmZi5leHRlbmQocCx7cG9zaXRpb246ImFic29sdXRlIixsZWZ0Oi0xZTMsdG9wOi0xZTN9KTtmb3IodCBpbiBwKW8uc3R5bGVbdF09cFt0XTtvLmFwcGVuZENoaWxkKGEpLG49bXx8YixuLmluc2VydEJlZm9yZShvLG4uZmlyc3RDaGlsZCksay5hcHBlbmRDaGVja2VkPWkuY2hlY2tlZCxrLmJveE1vZGVsPWEub2Zmc2V0V2lkdGg9PT0yLCJ6b29tImluIGEuc3R5bGUmJihhLnN0eWxlLmRpc3BsYXk9ImlubGluZSIsYS5zdHlsZS56b29tPTEsay5pbmxpbmVCbG9ja05lZWRzTGF5b3V0PWEub2Zmc2V0V2lkdGg9PT0yLGEuc3R5bGUuZGlzcGxheT0iIixhLmlubmVySFRNTD0iPGRpdiBzdHlsZT0nd2lkdGg6NHB4Oyc+PC9kaXY+IixrLnNocmlua1dyYXBCbG9ja3M9YS5vZmZzZXRXaWR0aCE9PTIpLGEuaW5uZXJIVE1MPSI8dGFibGU+PHRyPjx0ZCBzdHlsZT0ncGFkZGluZzowO2JvcmRlcjowO2Rpc3BsYXk6bm9uZSc+PC90ZD48dGQ+dDwvdGQ+PC90cj48L3RhYmxlPiIscT1hLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ZCIpLHU9cVswXS5vZmZzZXRIZWlnaHQ9PT0wLHFbMF0uc3R5bGUuZGlzcGxheT0iIixxWzFdLnN0eWxlLmRpc3BsYXk9Im5vbmUiLGsucmVsaWFibGVIaWRkZW5PZmZzZXRzPXUmJnFbMF0ub2Zmc2V0SGVpZ2h0PT09MCxhLmlubmVySFRNTD0iIixjLmRlZmF1bHRWaWV3JiZjLmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUmJihqPWMuY3JlYXRlRWxlbWVudCgiZGl2Iiksai5zdHlsZS53aWR0aD0iMCIsai5zdHlsZS5tYXJnaW5SaWdodD0iMCIsYS5hcHBlbmRDaGlsZChqKSxrLnJlbGlhYmxlTWFyZ2luUmlnaHQ9KHBhcnNlSW50KChjLmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoaixudWxsKXx8e21hcmdpblJpZ2h0OjB9KS5tYXJnaW5SaWdodCwxMCl8fDApPT09MCksby5pbm5lckhUTUw9IiIsbi5yZW1vdmVDaGlsZChvKTtpZihhLmF0dGFjaEV2ZW50KWZvcih0IGlue3N1Ym1pdDoxLGNoYW5nZToxLGZvY3VzaW46MX0pcz0ib24iK3QsdT1zIGluIGEsdXx8KGEuc2V0QXR0cmlidXRlKHMsInJldHVybjsiKSx1PXR5cGVvZiBhW3NdPT0iZnVuY3Rpb24iKSxrW3QrIkJ1YmJsZXMiXT11O289bD1nPWg9bT1qPWE9aT1udWxsO3JldHVybiBrfSgpLGYuYm94TW9kZWw9Zi5zdXBwb3J0LmJveE1vZGVsO3ZhciBpPS9eKD86XHsuKlx9fFxbLipcXSkkLyxqPS8oW2Etel0pKFtBLVpdKS9nO2YuZXh0ZW5kKHtjYWNoZTp7fSx1dWlkOjAsZXhwYW5kbzoialF1ZXJ5IisoZi5mbi5qcXVlcnkrTWF0aC5yYW5kb20oKSkucmVwbGFjZSgvXEQvZywiIiksbm9EYXRhOntlbWJlZDohMCxvYmplY3Q6ImNsc2lkOkQyN0NEQjZFLUFFNkQtMTFjZi05NkI4LTQ0NDU1MzU0MDAwMCIsYXBwbGV0OiEwfSxoYXNEYXRhOmZ1bmN0aW9uKGEpe2E9YS5ub2RlVHlwZT9mLmNhY2hlW2FbZi5leHBhbmRvXV06YVtmLmV4cGFuZG9dO3JldHVybiEhYSYmIWwoYSl9LGRhdGE6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoISFmLmFjY2VwdERhdGEoYSkpe3ZhciBnPWYuZXhwYW5kbyxoPXR5cGVvZiBjPT0ic3RyaW5nIixpLGo9YS5ub2RlVHlwZSxrPWo/Zi5jYWNoZTphLGw9aj9hW2YuZXhwYW5kb106YVtmLmV4cGFuZG9dJiZmLmV4cGFuZG87aWYoKCFsfHxlJiZsJiYha1tsXVtnXSkmJmgmJmQ9PT1iKXJldHVybjtsfHwoaj9hW2YuZXhwYW5kb109bD0rK2YudXVpZDpsPWYuZXhwYW5kbyksa1tsXXx8KGtbbF09e30sanx8KGtbbF0udG9KU09OPWYubm9vcCkpO2lmKHR5cGVvZiBjPT0ib2JqZWN0Inx8dHlwZW9mIGM9PSJmdW5jdGlvbiIpZT9rW2xdW2ddPWYuZXh0ZW5kKGtbbF1bZ10sYyk6a1tsXT1mLmV4dGVuZChrW2xdLGMpO2k9a1tsXSxlJiYoaVtnXXx8KGlbZ109e30pLGk9aVtnXSksZCE9PWImJihpW2YuY2FtZWxDYXNlKGMpXT1kKTtpZihjPT09ImV2ZW50cyImJiFpW2NdKXJldHVybiBpW2ddJiZpW2ddLmV2ZW50cztyZXR1cm4gaD9pW2YuY2FtZWxDYXNlKGMpXXx8aVtjXTppfX0scmVtb3ZlRGF0YTpmdW5jdGlvbihiLGMsZCl7aWYoISFmLmFjY2VwdERhdGEoYikpe3ZhciBlPWYuZXhwYW5kbyxnPWIubm9kZVR5cGUsaD1nP2YuY2FjaGU6YixpPWc/YltmLmV4cGFuZG9dOmYuZXhwYW5kbztpZighaFtpXSlyZXR1cm47aWYoYyl7dmFyIGo9ZD9oW2ldW2VdOmhbaV07aWYoail7ZGVsZXRlIGpbY107aWYoIWwoaikpcmV0dXJufX1pZihkKXtkZWxldGUgaFtpXVtlXTtpZighbChoW2ldKSlyZXR1cm59dmFyIGs9aFtpXVtlXTtmLnN1cHBvcnQuZGVsZXRlRXhwYW5kb3x8aCE9YT9kZWxldGUgaFtpXTpoW2ldPW51bGwsaz8oaFtpXT17fSxnfHwoaFtpXS50b0pTT049Zi5ub29wKSxoW2ldW2VdPWspOmcmJihmLnN1cHBvcnQuZGVsZXRlRXhwYW5kbz9kZWxldGUgYltmLmV4cGFuZG9dOmIucmVtb3ZlQXR0cmlidXRlP2IucmVtb3ZlQXR0cmlidXRlKGYuZXhwYW5kbyk6YltmLmV4cGFuZG9dPW51bGwpfX0sX2RhdGE6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmLmRhdGEoYSxiLGMsITApfSxhY2NlcHREYXRhOmZ1bmN0aW9uKGEpe2lmKGEubm9kZU5hbWUpe3ZhciBiPWYubm9EYXRhW2Eubm9kZU5hbWUudG9Mb3dlckNhc2UoKV07aWYoYilyZXR1cm4gYiE9PSEwJiZhLmdldEF0dHJpYnV0ZSgiY2xhc3NpZCIpPT09Yn1yZXR1cm4hMH19KSxmLmZuLmV4dGVuZCh7ZGF0YTpmdW5jdGlvbihhLGMpe3ZhciBkPW51bGw7aWYodHlwZW9mIGE9PSJ1bmRlZmluZWQiKXtpZih0aGlzLmxlbmd0aCl7ZD1mLmRhdGEodGhpc1swXSk7aWYodGhpc1swXS5ub2RlVHlwZT09PTEpe3ZhciBlPXRoaXNbMF0uYXR0cmlidXRlcyxnO2Zvcih2YXIgaD0wLGk9ZS5sZW5ndGg7aDxpO2grKylnPWVbaF0ubmFtZSxnLmluZGV4T2YoImRhdGEtIik9PT0wJiYoZz1mLmNhbWVsQ2FzZShnLnN1YnN0cmluZyg1KSksayh0aGlzWzBdLGcsZFtnXSkpfX1yZXR1cm4gZH1pZih0eXBlb2YgYT09Im9iamVjdCIpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YuZGF0YSh0aGlzLGEpfSk7dmFyIGo9YS5zcGxpdCgiLiIpO2pbMV09alsxXT8iLiIralsxXToiIjtpZihjPT09Yil7ZD10aGlzLnRyaWdnZXJIYW5kbGVyKCJnZXREYXRhIitqWzFdKyIhIixbalswXV0pLGQ9PT1iJiZ0aGlzLmxlbmd0aCYmKGQ9Zi5kYXRhKHRoaXNbMF0sYSksZD1rKHRoaXNbMF0sYSxkKSk7cmV0dXJuIGQ9PT1iJiZqWzFdP3RoaXMuZGF0YShqWzBdKTpkfXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1mKHRoaXMpLGQ9W2pbMF0sY107Yi50cmlnZ2VySGFuZGxlcigic2V0RGF0YSIralsxXSsiISIsZCksZi5kYXRhKHRoaXMsYSxjKSxiLnRyaWdnZXJIYW5kbGVyKCJjaGFuZ2VEYXRhIitqWzFdKyIhIixkKX0pfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLnJlbW92ZURhdGEodGhpcyxhKX0pfX0pLGYuZXh0ZW5kKHtfbWFyazpmdW5jdGlvbihhLGMpe2EmJihjPShjfHwiZngiKSsibWFyayIsZi5kYXRhKGEsYywoZi5kYXRhKGEsYyxiLCEwKXx8MCkrMSwhMCkpfSxfdW5tYXJrOmZ1bmN0aW9uKGEsYyxkKXthIT09ITAmJihkPWMsYz1hLGE9ITEpO2lmKGMpe2Q9ZHx8ImZ4Ijt2YXIgZT1kKyJtYXJrIixnPWE/MDooZi5kYXRhKGMsZSxiLCEwKXx8MSktMTtnP2YuZGF0YShjLGUsZywhMCk6KGYucmVtb3ZlRGF0YShjLGUsITApLG0oYyxkLCJtYXJrIikpfX0scXVldWU6ZnVuY3Rpb24oYSxjLGQpe2lmKGEpe2M9KGN8fCJmeCIpKyJxdWV1ZSI7dmFyIGU9Zi5kYXRhKGEsYyxiLCEwKTtkJiYoIWV8fGYuaXNBcnJheShkKT9lPWYuZGF0YShhLGMsZi5tYWtlQXJyYXkoZCksITApOmUucHVzaChkKSk7cmV0dXJuIGV8fFtdfX0sZGVxdWV1ZTpmdW5jdGlvbihhLGIpe2I9Ynx8ImZ4Ijt2YXIgYz1mLnF1ZXVlKGEsYiksZD1jLnNoaWZ0KCksZTtkPT09ImlucHJvZ3Jlc3MiJiYoZD1jLnNoaWZ0KCkpLGQmJihiPT09ImZ4IiYmYy51bnNoaWZ0KCJpbnByb2dyZXNzIiksZC5jYWxsKGEsZnVuY3Rpb24oKXtmLmRlcXVldWUoYSxiKX0pKSxjLmxlbmd0aHx8KGYucmVtb3ZlRGF0YShhLGIrInF1ZXVlIiwhMCksbShhLGIsInF1ZXVlIikpfX0pLGYuZm4uZXh0ZW5kKHtxdWV1ZTpmdW5jdGlvbihhLGMpe3R5cGVvZiBhIT0ic3RyaW5nIiYmKGM9YSxhPSJmeCIpO2lmKGM9PT1iKXJldHVybiBmLnF1ZXVlKHRoaXNbMF0sYSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWYucXVldWUodGhpcyxhLGMpO2E9PT0iZngiJiZiWzBdIT09ImlucHJvZ3Jlc3MiJiZmLmRlcXVldWUodGhpcyxhKX0pfSxkZXF1ZXVlOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLmRlcXVldWUodGhpcyxhKX0pfSxkZWxheTpmdW5jdGlvbihhLGIpe2E9Zi5meD9mLmZ4LnNwZWVkc1thXXx8YTphLGI9Ynx8ImZ4IjtyZXR1cm4gdGhpcy5xdWV1ZShiLGZ1bmN0aW9uKCl7dmFyIGM9dGhpcztzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Zi5kZXF1ZXVlKGMsYil9LGEpfSl9LGNsZWFyUXVldWU6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucXVldWUoYXx8ImZ4IixbXSl9LHByb21pc2U6ZnVuY3Rpb24oYSxjKXtmdW5jdGlvbiBtKCl7LS1ofHxkLnJlc29sdmVXaXRoKGUsW2VdKX10eXBlb2YgYSE9InN0cmluZyImJihjPWEsYT1iKSxhPWF8fCJmeCI7dmFyIGQ9Zi5EZWZlcnJlZCgpLGU9dGhpcyxnPWUubGVuZ3RoLGg9MSxpPWErImRlZmVyIixqPWErInF1ZXVlIixrPWErIm1hcmsiLGw7d2hpbGUoZy0tKWlmKGw9Zi5kYXRhKGVbZ10saSxiLCEwKXx8KGYuZGF0YShlW2ddLGosYiwhMCl8fGYuZGF0YShlW2ddLGssYiwhMCkpJiZmLmRhdGEoZVtnXSxpLGYuX0RlZmVycmVkKCksITApKWgrKyxsLmRvbmUobSk7bSgpO3JldHVybiBkLnByb21pc2UoKX19KTt2YXIgbj0vW1xuXHRccl0vZyxvPS9ccysvLHA9L1xyL2cscT0vXig/OmJ1dHRvbnxpbnB1dCkkL2kscj0vXig/OmJ1dHRvbnxpbnB1dHxvYmplY3R8c2VsZWN0fHRleHRhcmVhKSQvaSxzPS9eYSg/OnJlYSk/JC9pLHQ9L14oPzphdXRvZm9jdXN8YXV0b3BsYXl8YXN5bmN8Y2hlY2tlZHxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZHxzZWxlY3RlZCkkL2ksdT0vXDp8Xm9uLyx2LHc7Zi5mbi5leHRlbmQoe2F0dHI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZi5hY2Nlc3ModGhpcyxhLGIsITAsZi5hdHRyKX0scmVtb3ZlQXR0cjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zi5yZW1vdmVBdHRyKHRoaXMsYSl9KX0scHJvcDpmdW5jdGlvbihhLGIpe3JldHVybiBmLmFjY2Vzcyh0aGlzLGEsYiwhMCxmLnByb3ApfSxyZW1vdmVQcm9wOmZ1bmN0aW9uKGEpe2E9Zi5wcm9wRml4W2FdfHxhO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt0cnl7dGhpc1thXT1iLGRlbGV0ZSB0aGlzW2FdfWNhdGNoKGMpe319KX0sYWRkQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGUsZyxoLGk7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zih0aGlzKS5hZGRDbGFzcyhhLmNhbGwodGhpcyxiLHRoaXMuY2xhc3NOYW1lKSl9KTtpZihhJiZ0eXBlb2YgYT09InN0cmluZyIpe2I9YS5zcGxpdChvKTtmb3IoYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKyl7ZT10aGlzW2NdO2lmKGUubm9kZVR5cGU9PT0xKWlmKCFlLmNsYXNzTmFtZSYmYi5sZW5ndGg9PT0xKWUuY2xhc3NOYW1lPWE7ZWxzZXtnPSIgIitlLmNsYXNzTmFtZSsiICI7Zm9yKGg9MCxpPWIubGVuZ3RoO2g8aTtoKyspfmcuaW5kZXhPZigiICIrYltoXSsiICIpfHwoZys9YltoXSsiICIpO2UuY2xhc3NOYW1lPWYudHJpbShnKX19fXJldHVybiB0aGlzfSxyZW1vdmVDbGFzczpmdW5jdGlvbihhKXt2YXIgYyxkLGUsZyxoLGksajtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmKHRoaXMpLnJlbW92ZUNsYXNzKGEuY2FsbCh0aGlzLGIsdGhpcy5jbGFzc05hbWUpKX0pO2lmKGEmJnR5cGVvZiBhPT0ic3RyaW5nInx8YT09PWIpe2M9KGF8fCIiKS5zcGxpdChvKTtmb3IoZD0wLGU9dGhpcy5sZW5ndGg7ZDxlO2QrKyl7Zz10aGlzW2RdO2lmKGcubm9kZVR5cGU9PT0xJiZnLmNsYXNzTmFtZSlpZihhKXtoPSgiICIrZy5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKG4sIiAiKTtmb3IoaT0wLGo9Yy5sZW5ndGg7aTxqO2krKyloPWgucmVwbGFjZSgiICIrY1tpXSsiICIsIiAiKTtnLmNsYXNzTmFtZT1mLnRyaW0oaCl9ZWxzZSBnLmNsYXNzTmFtZT0iIn19cmV0dXJuIHRoaXN9LHRvZ2dsZUNsYXNzOmZ1bmN0aW9uKGEsYil7dmFyIGM9dHlwZW9mIGEsZD10eXBlb2YgYj09ImJvb2xlYW4iO2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGMpe2YodGhpcykudG9nZ2xlQ2xhc3MoYS5jYWxsKHRoaXMsYyx0aGlzLmNsYXNzTmFtZSxiKSxiKX0pO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZihjPT09InN0cmluZyIpe3ZhciBlLGc9MCxoPWYodGhpcyksaT1iLGo9YS5zcGxpdChvKTt3aGlsZShlPWpbZysrXSlpPWQ/aTohaC5oYXNDbGFzcyhlKSxoW2k/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXShlKX1lbHNlIGlmKGM9PT0idW5kZWZpbmVkInx8Yz09PSJib29sZWFuIil0aGlzLmNsYXNzTmFtZSYmZi5fZGF0YSh0aGlzLCJfX2NsYXNzTmFtZV9fIix0aGlzLmNsYXNzTmFtZSksdGhpcy5jbGFzc05hbWU9dGhpcy5jbGFzc05hbWV8fGE9PT0hMT8iIjpmLl9kYXRhKHRoaXMsIl9fY2xhc3NOYW1lX18iKXx8IiJ9KX0saGFzQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGI9IiAiK2ErIiAiO2Zvcih2YXIgYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKylpZigoIiAiK3RoaXNbY10uY2xhc3NOYW1lKyIgIikucmVwbGFjZShuLCIgIikuaW5kZXhPZihiKT4tMSlyZXR1cm4hMDtyZXR1cm4hMX0sdmFsOmZ1bmN0aW9uKGEpe3ZhciBjLGQsZT10aGlzWzBdO2lmKCFhcmd1bWVudHMubGVuZ3RoKXtpZihlKXtjPWYudmFsSG9va3NbZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXXx8Zi52YWxIb29rc1tlLnR5cGVdO2lmKGMmJiJnZXQiaW4gYyYmKGQ9Yy5nZXQoZSwidmFsdWUiKSkhPT1iKXJldHVybiBkO2Q9ZS52YWx1ZTtyZXR1cm4gdHlwZW9mIGQ9PSJzdHJpbmciP2QucmVwbGFjZShwLCIiKTpkPT1udWxsPyIiOmR9cmV0dXJuIGJ9dmFyIGc9Zi5pc0Z1bmN0aW9uKGEpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZCl7dmFyIGU9Zih0aGlzKSxoO2lmKHRoaXMubm9kZVR5cGU9PT0xKXtnP2g9YS5jYWxsKHRoaXMsZCxlLnZhbCgpKTpoPWEsaD09bnVsbD9oPSIiOnR5cGVvZiBoPT0ibnVtYmVyIj9oKz0iIjpmLmlzQXJyYXkoaCkmJihoPWYubWFwKGgsZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/IiI6YSsiIn0pKSxjPWYudmFsSG9va3NbdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXXx8Zi52YWxIb29rc1t0aGlzLnR5cGVdO2lmKCFjfHwhKCJzZXQiaW4gYyl8fGMuc2V0KHRoaXMsaCwidmFsdWUiKT09PWIpdGhpcy52YWx1ZT1ofX0pfX0pLGYuZXh0ZW5kKHt2YWxIb29rczp7b3B0aW9uOntnZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5hdHRyaWJ1dGVzLnZhbHVlO3JldHVybiFifHxiLnNwZWNpZmllZD9hLnZhbHVlOmEudGV4dH19LHNlbGVjdDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiLGM9YS5zZWxlY3RlZEluZGV4LGQ9W10sZT1hLm9wdGlvbnMsZz1hLnR5cGU9PT0ic2VsZWN0LW9uZSI7aWYoYzwwKXJldHVybiBudWxsO2Zvcih2YXIgaD1nP2M6MCxpPWc/YysxOmUubGVuZ3RoO2g8aTtoKyspe3ZhciBqPWVbaF07aWYoai5zZWxlY3RlZCYmKGYuc3VwcG9ydC5vcHREaXNhYmxlZD8hai5kaXNhYmxlZDpqLmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKT09PW51bGwpJiYoIWoucGFyZW50Tm9kZS5kaXNhYmxlZHx8IWYubm9kZU5hbWUoai5wYXJlbnROb2RlLCJvcHRncm91cCIpKSl7Yj1mKGopLnZhbCgpO2lmKGcpcmV0dXJuIGI7ZC5wdXNoKGIpfX1pZihnJiYhZC5sZW5ndGgmJmUubGVuZ3RoKXJldHVybiBmKGVbY10pLnZhbCgpO3JldHVybiBkfSxzZXQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz1mLm1ha2VBcnJheShiKTtmKGEpLmZpbmQoIm9wdGlvbiIpLmVhY2goZnVuY3Rpb24oKXt0aGlzLnNlbGVjdGVkPWYuaW5BcnJheShmKHRoaXMpLnZhbCgpLGMpPj0wfSksYy5sZW5ndGh8fChhLnNlbGVjdGVkSW5kZXg9LTEpO3JldHVybiBjfX19LGF0dHJGbjp7dmFsOiEwLGNzczohMCxodG1sOiEwLHRleHQ6ITAsZGF0YTohMCx3aWR0aDohMCxoZWlnaHQ6ITAsb2Zmc2V0OiEwfSxhdHRyRml4Ont0YWJpbmRleDoidGFiSW5kZXgifSxhdHRyOmZ1bmN0aW9uKGEsYyxkLGUpe3ZhciBnPWEubm9kZVR5cGU7aWYoIWF8fGc9PT0zfHxnPT09OHx8Zz09PTIpcmV0dXJuIGI7aWYoZSYmYyBpbiBmLmF0dHJGbilyZXR1cm4gZihhKVtjXShkKTtpZighKCJnZXRBdHRyaWJ1dGUiaW4gYSkpcmV0dXJuIGYucHJvcChhLGMsZCk7dmFyIGgsaSxqPWchPT0xfHwhZi5pc1hNTERvYyhhKTtqJiYoYz1mLmF0dHJGaXhbY118fGMsaT1mLmF0dHJIb29rc1tjXSxpfHwodC50ZXN0KGMpP2k9dzp2JiZjIT09ImNsYXNzTmFtZSImJihmLm5vZGVOYW1lKGEsImZvcm0iKXx8dS50ZXN0KGMpKSYmKGk9dikpKTtpZihkIT09Yil7aWYoZD09PW51bGwpe2YucmVtb3ZlQXR0cihhLGMpO3JldHVybiBifWlmKGkmJiJzZXQiaW4gaSYmaiYmKGg9aS5zZXQoYSxkLGMpKSE9PWIpcmV0dXJuIGg7YS5zZXRBdHRyaWJ1dGUoYywiIitkKTtyZXR1cm4gZH1pZihpJiYiZ2V0ImluIGkmJmomJihoPWkuZ2V0KGEsYykpIT09bnVsbClyZXR1cm4gaDtoPWEuZ2V0QXR0cmlidXRlKGMpO3JldHVybiBoPT09bnVsbD9iOmh9LHJlbW92ZUF0dHI6ZnVuY3Rpb24oYSxiKXt2YXIgYzthLm5vZGVUeXBlPT09MSYmKGI9Zi5hdHRyRml4W2JdfHxiLGYuc3VwcG9ydC5nZXRTZXRBdHRyaWJ1dGU/YS5yZW1vdmVBdHRyaWJ1dGUoYik6KGYuYXR0cihhLGIsIiIpLGEucmVtb3ZlQXR0cmlidXRlTm9kZShhLmdldEF0dHJpYnV0ZU5vZGUoYikpKSx0LnRlc3QoYikmJihjPWYucHJvcEZpeFtiXXx8YilpbiBhJiYoYVtjXT0hMSkpfSxhdHRySG9va3M6e3R5cGU6e3NldDpmdW5jdGlvbihhLGIpe2lmKHEudGVzdChhLm5vZGVOYW1lKSYmYS5wYXJlbnROb2RlKWYuZXJyb3IoInR5cGUgcHJvcGVydHkgY2FuJ3QgYmUgY2hhbmdlZCIpO2Vsc2UgaWYoIWYuc3VwcG9ydC5yYWRpb1ZhbHVlJiZiPT09InJhZGlvIiYmZi5ub2RlTmFtZShhLCJpbnB1dCIpKXt2YXIgYz1hLnZhbHVlO2Euc2V0QXR0cmlidXRlKCJ0eXBlIixiKSxjJiYoYS52YWx1ZT1jKTtyZXR1cm4gYn19fSx0YWJJbmRleDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBjPWEuZ2V0QXR0cmlidXRlTm9kZSgidGFiSW5kZXgiKTtyZXR1cm4gYyYmYy5zcGVjaWZpZWQ/cGFyc2VJbnQoYy52YWx1ZSwxMCk6ci50ZXN0KGEubm9kZU5hbWUpfHxzLnRlc3QoYS5ub2RlTmFtZSkmJmEuaHJlZj8wOmJ9fSx2YWx1ZTp7Z2V0OmZ1bmN0aW9uKGEsYil7aWYodiYmZi5ub2RlTmFtZShhLCJidXR0b24iKSlyZXR1cm4gdi5nZXQoYSxiKTtyZXR1cm4gYiBpbiBhP2EudmFsdWU6bnVsbH0sc2V0OmZ1bmN0aW9uKGEsYixjKXtpZih2JiZmLm5vZGVOYW1lKGEsImJ1dHRvbiIpKXJldHVybiB2LnNldChhLGIsYyk7YS52YWx1ZT1ifX19LHByb3BGaXg6e3RhYmluZGV4OiJ0YWJJbmRleCIscmVhZG9ubHk6InJlYWRPbmx5IiwiZm9yIjoiaHRtbEZvciIsImNsYXNzIjoiY2xhc3NOYW1lIixtYXhsZW5ndGg6Im1heExlbmd0aCIsY2VsbHNwYWNpbmc6ImNlbGxTcGFjaW5nIixjZWxscGFkZGluZzoiY2VsbFBhZGRpbmciLHJvd3NwYW46InJvd1NwYW4iLGNvbHNwYW46ImNvbFNwYW4iLHVzZW1hcDoidXNlTWFwIixmcmFtZWJvcmRlcjoiZnJhbWVCb3JkZXIiLGNvbnRlbnRlZGl0YWJsZToiY29udGVudEVkaXRhYmxlIn0scHJvcDpmdW5jdGlvbihhLGMsZCl7dmFyIGU9YS5ub2RlVHlwZTtpZighYXx8ZT09PTN8fGU9PT04fHxlPT09MilyZXR1cm4gYjt2YXIgZyxoLGk9ZSE9PTF8fCFmLmlzWE1MRG9jKGEpO2kmJihjPWYucHJvcEZpeFtjXXx8YyxoPWYucHJvcEhvb2tzW2NdKTtyZXR1cm4gZCE9PWI/aCYmInNldCJpbiBoJiYoZz1oLnNldChhLGQsYykpIT09Yj9nOmFbY109ZDpoJiYiZ2V0ImluIGgmJihnPWguZ2V0KGEsYykpIT09Yj9nOmFbY119LHByb3BIb29rczp7fX0pLHc9e2dldDpmdW5jdGlvbihhLGMpe3JldHVybiBmLnByb3AoYSxjKT9jLnRvTG93ZXJDYXNlKCk6Yn0sc2V0OmZ1bmN0aW9uKGEsYixjKXt2YXIgZDtiPT09ITE/Zi5yZW1vdmVBdHRyKGEsYyk6KGQ9Zi5wcm9wRml4W2NdfHxjLGQgaW4gYSYmKGFbZF09ITApLGEuc2V0QXR0cmlidXRlKGMsYy50b0xvd2VyQ2FzZSgpKSk7cmV0dXJuIGN9fSxmLnN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlfHwoZi5hdHRyRml4PWYucHJvcEZpeCx2PWYuYXR0ckhvb2tzLm5hbWU9Zi5hdHRySG9va3MudGl0bGU9Zi52YWxIb29rcy5idXR0b249e2dldDpmdW5jdGlvbihhLGMpe3ZhciBkO2Q9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpO3JldHVybiBkJiZkLm5vZGVWYWx1ZSE9PSIiP2Qubm9kZVZhbHVlOmJ9LHNldDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpO2lmKGQpe2Qubm9kZVZhbHVlPWI7cmV0dXJuIGJ9fX0sZi5lYWNoKFsid2lkdGgiLCJoZWlnaHQiXSxmdW5jdGlvbihhLGIpe2YuYXR0ckhvb2tzW2JdPWYuZXh0ZW5kKGYuYXR0ckhvb2tzW2JdLHtzZXQ6ZnVuY3Rpb24oYSxjKXtpZihjPT09IiIpe2Euc2V0QXR0cmlidXRlKGIsImF1dG8iKTtyZXR1cm4gY319fSl9KSksZi5zdXBwb3J0LmhyZWZOb3JtYWxpemVkfHxmLmVhY2goWyJocmVmIiwic3JjIiwid2lkdGgiLCJoZWlnaHQiXSxmdW5jdGlvbihhLGMpe2YuYXR0ckhvb2tzW2NdPWYuZXh0ZW5kKGYuYXR0ckhvb2tzW2NdLHtnZXQ6ZnVuY3Rpb24oYSl7dmFyIGQ9YS5nZXRBdHRyaWJ1dGUoYywyKTtyZXR1cm4gZD09PW51bGw/YjpkfX0pfSksZi5zdXBwb3J0LnN0eWxlfHwoZi5hdHRySG9va3Muc3R5bGU9e2dldDpmdW5jdGlvbihhKXtyZXR1cm4gYS5zdHlsZS5jc3NUZXh0LnRvTG93ZXJDYXNlKCl8fGJ9LHNldDpmdW5jdGlvbihhLGIpe3JldHVybiBhLnN0eWxlLmNzc1RleHQ9IiIrYn19KSxmLnN1cHBvcnQub3B0U2VsZWN0ZWR8fChmLnByb3BIb29rcy5zZWxlY3RlZD1mLmV4dGVuZChmLnByb3BIb29rcy5zZWxlY3RlZCx7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiPWEucGFyZW50Tm9kZTtiJiYoYi5zZWxlY3RlZEluZGV4LGIucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgpfX0pKSxmLnN1cHBvcnQuY2hlY2tPbnx8Zi5lYWNoKFsicmFkaW8iLCJjaGVja2JveCJdLGZ1bmN0aW9uKCl7Zi52YWxIb29rc1t0aGlzXT17Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgidmFsdWUiKT09PW51bGw/Im9uIjphLnZhbHVlfX19KSxmLmVhY2goWyJyYWRpbyIsImNoZWNrYm94Il0sZnVuY3Rpb24oKXtmLnZhbEhvb2tzW3RoaXNdPWYuZXh0ZW5kKGYudmFsSG9va3NbdGhpc10se3NldDpmdW5jdGlvbihhLGIpe2lmKGYuaXNBcnJheShiKSlyZXR1cm4gYS5jaGVja2VkPWYuaW5BcnJheShmKGEpLnZhbCgpLGIpPj0wfX0pfSk7dmFyIHg9L1wuKC4qKSQvLHk9L14oPzp0ZXh0YXJlYXxpbnB1dHxzZWxlY3QpJC9pLHo9L1wuL2csQT0vIC9nLEI9L1teXHdccy58YF0vZyxDPWZ1bmN0aW9uKGEpe3JldHVybiBhLnJlcGxhY2UoQiwiXFwkJiIpfTtmLmV2ZW50PXthZGQ6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoYS5ub2RlVHlwZSE9PTMmJmEubm9kZVR5cGUhPT04KXtpZihkPT09ITEpZD1EO2Vsc2UgaWYoIWQpcmV0dXJuO3ZhciBnLGg7ZC5oYW5kbGVyJiYoZz1kLGQ9Zy5oYW5kbGVyKSxkLmd1aWR8fChkLmd1aWQ9Zi5ndWlkKyspO3ZhciBpPWYuX2RhdGEoYSk7aWYoIWkpcmV0dXJuO3ZhciBqPWkuZXZlbnRzLGs9aS5oYW5kbGU7anx8KGkuZXZlbnRzPWo9e30pLGt8fChpLmhhbmRsZT1rPWZ1bmN0aW9uKGEpe3JldHVybiB0eXBlb2YgZiE9InVuZGVmaW5lZCImJighYXx8Zi5ldmVudC50cmlnZ2VyZWQhPT1hLnR5cGUpP2YuZXZlbnQuaGFuZGxlLmFwcGx5KGsuZWxlbSxhcmd1bWVudHMpOmJ9KSxrLmVsZW09YSxjPWMuc3BsaXQoIiAiKTt2YXIgbCxtPTAsbjt3aGlsZShsPWNbbSsrXSl7aD1nP2YuZXh0ZW5kKHt9LGcpOntoYW5kbGVyOmQsZGF0YTplfSxsLmluZGV4T2YoIi4iKT4tMT8obj1sLnNwbGl0KCIuIiksbD1uLnNoaWZ0KCksaC5uYW1lc3BhY2U9bi5zbGljZSgwKS5zb3J0KCkuam9pbigiLiIpKToobj1bXSxoLm5hbWVzcGFjZT0iIiksaC50eXBlPWwsaC5ndWlkfHwoaC5ndWlkPWQuZ3VpZCk7dmFyIG89altsXSxwPWYuZXZlbnQuc3BlY2lhbFtsXXx8e307aWYoIW8pe289altsXT1bXTtpZighcC5zZXR1cHx8cC5zZXR1cC5jYWxsKGEsZSxuLGspPT09ITEpYS5hZGRFdmVudExpc3RlbmVyP2EuYWRkRXZlbnRMaXN0ZW5lcihsLGssITEpOmEuYXR0YWNoRXZlbnQmJmEuYXR0YWNoRXZlbnQoIm9uIitsLGspfXAuYWRkJiYocC5hZGQuY2FsbChhLGgpLGguaGFuZGxlci5ndWlkfHwoaC5oYW5kbGVyLmd1aWQ9ZC5ndWlkKSksby5wdXNoKGgpLGYuZXZlbnQuZ2xvYmFsW2xdPSEwfWE9bnVsbH19LGdsb2JhbDp7fSxyZW1vdmU6ZnVuY3Rpb24oYSxjLGQsZSl7aWYoYS5ub2RlVHlwZSE9PTMmJmEubm9kZVR5cGUhPT04KXtkPT09ITEmJihkPUQpO3ZhciBnLGgsaSxqLGs9MCxsLG0sbixvLHAscSxyLHM9Zi5oYXNEYXRhKGEpJiZmLl9kYXRhKGEpLHQ9cyYmcy5ldmVudHM7aWYoIXN8fCF0KXJldHVybjtjJiZjLnR5cGUmJihkPWMuaGFuZGxlcixjPWMudHlwZSk7aWYoIWN8fHR5cGVvZiBjPT0ic3RyaW5nIiYmYy5jaGFyQXQoMCk9PT0iLiIpe2M9Y3x8IiI7Zm9yKGggaW4gdClmLmV2ZW50LnJlbW92ZShhLGgrYyk7cmV0dXJufWM9Yy5zcGxpdCgiICIpO3doaWxlKGg9Y1trKytdKXtyPWgscT1udWxsLGw9aC5pbmRleE9mKCIuIik8MCxtPVtdLGx8fChtPWguc3BsaXQoIi4iKSxoPW0uc2hpZnQoKSxuPW5ldyBSZWdFeHAoIihefFxcLikiK2YubWFwKG0uc2xpY2UoMCkuc29ydCgpLEMpLmpvaW4oIlxcLig/Oi4qXFwuKT8iKSsiKFxcLnwkKSIpKSxwPXRbaF07aWYoIXApY29udGludWU7aWYoIWQpe2ZvcihqPTA7ajxwLmxlbmd0aDtqKyspe3E9cFtqXTtpZihsfHxuLnRlc3QocS5uYW1lc3BhY2UpKWYuZXZlbnQucmVtb3ZlKGEscixxLmhhbmRsZXIsaikscC5zcGxpY2Uoai0tLDEpfWNvbnRpbnVlfW89Zi5ldmVudC5zcGVjaWFsW2hdfHx7fTtmb3Ioaj1lfHwwO2o8cC5sZW5ndGg7aisrKXtxPXBbal07aWYoZC5ndWlkPT09cS5ndWlkKXtpZihsfHxuLnRlc3QocS5uYW1lc3BhY2UpKWU9PW51bGwmJnAuc3BsaWNlKGotLSwxKSxvLnJlbW92ZSYmby5yZW1vdmUuY2FsbChhLHEpO2lmKGUhPW51bGwpYnJlYWt9fWlmKHAubGVuZ3RoPT09MHx8ZSE9bnVsbCYmcC5sZW5ndGg9PT0xKSghby50ZWFyZG93bnx8by50ZWFyZG93bi5jYWxsKGEsbSk9PT0hMSkmJmYucmVtb3ZlRXZlbnQoYSxoLHMuaGFuZGxlKSxnPW51bGwsZGVsZXRlIHRbaF19aWYoZi5pc0VtcHR5T2JqZWN0KHQpKXt2YXIgdT1zLmhhbmRsZTt1JiYodS5lbGVtPW51bGwpLGRlbGV0ZSBzLmV2ZW50cyxkZWxldGUgcy5oYW5kbGUsZi5pc0VtcHR5T2JqZWN0KHMpJiZmLnJlbW92ZURhdGEoYSxiLCEwKX19fSxjdXN0b21FdmVudDp7Z2V0RGF0YTohMCxzZXREYXRhOiEwLGNoYW5nZURhdGE6ITB9LHRyaWdnZXI6ZnVuY3Rpb24oYyxkLGUsZyl7dmFyIGg9Yy50eXBlfHxjLGk9W10sajtoLmluZGV4T2YoIiEiKT49MCYmKGg9aC5zbGljZSgwLC0xKSxqPSEwKSxoLmluZGV4T2YoIi4iKT49MCYmKGk9aC5zcGxpdCgiLiIpLGg9aS5zaGlmdCgpLGkuc29ydCgpKTtpZighIWUmJiFmLmV2ZW50LmN1c3RvbUV2ZW50W2hdfHwhIWYuZXZlbnQuZ2xvYmFsW2hdKXtjPXR5cGVvZiBjPT0ib2JqZWN0Ij9jW2YuZXhwYW5kb10/YzpuZXcgZi5FdmVudChoLGMpOm5ldyBmLkV2ZW50KGgpLGMudHlwZT1oLGMuZXhjbHVzaXZlPWosYy5uYW1lc3BhY2U9aS5qb2luKCIuIiksYy5uYW1lc3BhY2VfcmU9bmV3IFJlZ0V4cCgiKF58XFwuKSIraS5qb2luKCJcXC4oPzouKlxcLik/IikrIihcXC58JCkiKTtpZihnfHwhZSljLnByZXZlbnREZWZhdWx0KCksYy5zdG9wUHJvcGFnYXRpb24oKTtpZighZSl7Zi5lYWNoKGYuY2FjaGUsZnVuY3Rpb24oKXt2YXIgYT1mLmV4cGFuZG8sYj10aGlzW2FdO2ImJmIuZXZlbnRzJiZiLmV2ZW50c1toXSYmZi5ldmVudC50cmlnZ2VyKGMsZCxiLmhhbmRsZS5lbGVtKX0pO3JldHVybn1pZihlLm5vZGVUeXBlPT09M3x8ZS5ub2RlVHlwZT09PTgpcmV0dXJuO2MucmVzdWx0PWIsYy50YXJnZXQ9ZSxkPWQhPW51bGw/Zi5tYWtlQXJyYXkoZCk6W10sZC51bnNoaWZ0KGMpO3ZhciBrPWUsbD1oLmluZGV4T2YoIjoiKTwwPyJvbiIraDoiIjtkb3t2YXIgbT1mLl9kYXRhKGssImhhbmRsZSIpO2MuY3VycmVudFRhcmdldD1rLG0mJm0uYXBwbHkoayxkKSxsJiZmLmFjY2VwdERhdGEoaykmJmtbbF0mJmtbbF0uYXBwbHkoayxkKT09PSExJiYoYy5yZXN1bHQ9ITEsYy5wcmV2ZW50RGVmYXVsdCgpKSxrPWsucGFyZW50Tm9kZXx8ay5vd25lckRvY3VtZW50fHxrPT09Yy50YXJnZXQub3duZXJEb2N1bWVudCYmYX13aGlsZShrJiYhYy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKTtpZighYy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl7dmFyIG4sbz1mLmV2ZW50LnNwZWNpYWxbaF18fHt9O2lmKCghby5fZGVmYXVsdHx8by5fZGVmYXVsdC5jYWxsKGUub3duZXJEb2N1bWVudCxjKT09PSExKSYmKGghPT0iY2xpY2sifHwhZi5ub2RlTmFtZShlLCJhIikpJiZmLmFjY2VwdERhdGEoZSkpe3RyeXtsJiZlW2hdJiYobj1lW2xdLG4mJihlW2xdPW51bGwpLGYuZXZlbnQudHJpZ2dlcmVkPWgsZVtoXSgpKX1jYXRjaChwKXt9biYmKGVbbF09biksZi5ldmVudC50cmlnZ2VyZWQ9Yn19cmV0dXJuIGMucmVzdWx0fX0saGFuZGxlOmZ1bmN0aW9uKGMpe2M9Zi5ldmVudC5maXgoY3x8YS5ldmVudCk7dmFyIGQ9KChmLl9kYXRhKHRoaXMsImV2ZW50cyIpfHx7fSlbYy50eXBlXXx8W10pLnNsaWNlKDApLGU9IWMuZXhjbHVzaXZlJiYhYy5uYW1lc3BhY2UsZz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMCk7Z1swXT1jLGMuY3VycmVudFRhcmdldD10aGlzO2Zvcih2YXIgaD0wLGk9ZC5sZW5ndGg7aDxpO2grKyl7dmFyIGo9ZFtoXTtpZihlfHxjLm5hbWVzcGFjZV9yZS50ZXN0KGoubmFtZXNwYWNlKSl7Yy5oYW5kbGVyPWouaGFuZGxlcixjLmRhdGE9ai5kYXRhLGMuaGFuZGxlT2JqPWo7dmFyIGs9ai5oYW5kbGVyLmFwcGx5KHRoaXMsZyk7ayE9PWImJihjLnJlc3VsdD1rLGs9PT0hMSYmKGMucHJldmVudERlZmF1bHQoKSxjLnN0b3BQcm9wYWdhdGlvbigpKSk7aWYoYy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpKWJyZWFrfX1yZXR1cm4gYy5yZXN1bHR9LHByb3BzOiJhbHRLZXkgYXR0ckNoYW5nZSBhdHRyTmFtZSBidWJibGVzIGJ1dHRvbiBjYW5jZWxhYmxlIGNoYXJDb2RlIGNsaWVudFggY2xpZW50WSBjdHJsS2V5IGN1cnJlbnRUYXJnZXQgZGF0YSBkZXRhaWwgZXZlbnRQaGFzZSBmcm9tRWxlbWVudCBoYW5kbGVyIGtleUNvZGUgbGF5ZXJYIGxheWVyWSBtZXRhS2V5IG5ld1ZhbHVlIG9mZnNldFggb2Zmc2V0WSBwYWdlWCBwYWdlWSBwcmV2VmFsdWUgcmVsYXRlZE5vZGUgcmVsYXRlZFRhcmdldCBzY3JlZW5YIHNjcmVlblkgc2hpZnRLZXkgc3JjRWxlbWVudCB0YXJnZXQgdG9FbGVtZW50IHZpZXcgd2hlZWxEZWx0YSB3aGljaCIuc3BsaXQoIiAiKSxmaXg6ZnVuY3Rpb24oYSl7aWYoYVtmLmV4cGFuZG9dKXJldHVybiBhO3ZhciBkPWE7YT1mLkV2ZW50KGQpO2Zvcih2YXIgZT10aGlzLnByb3BzLmxlbmd0aCxnO2U7KWc9dGhpcy5wcm9wc1stLWVdLGFbZ109ZFtnXTthLnRhcmdldHx8KGEudGFyZ2V0PWEuc3JjRWxlbWVudHx8YyksYS50YXJnZXQubm9kZVR5cGU9PT0zJiYoYS50YXJnZXQ9YS50YXJnZXQucGFyZW50Tm9kZSksIWEucmVsYXRlZFRhcmdldCYmYS5mcm9tRWxlbWVudCYmKGEucmVsYXRlZFRhcmdldD1hLmZyb21FbGVtZW50PT09YS50YXJnZXQ/YS50b0VsZW1lbnQ6YS5mcm9tRWxlbWVudCk7aWYoYS5wYWdlWD09bnVsbCYmYS5jbGllbnRYIT1udWxsKXt2YXIgaD1hLnRhcmdldC5vd25lckRvY3VtZW50fHxjLGk9aC5kb2N1bWVudEVsZW1lbnQsaj1oLmJvZHk7YS5wYWdlWD1hLmNsaWVudFgrKGkmJmkuc2Nyb2xsTGVmdHx8aiYmai5zY3JvbGxMZWZ0fHwwKS0oaSYmaS5jbGllbnRMZWZ0fHxqJiZqLmNsaWVudExlZnR8fDApLGEucGFnZVk9YS5jbGllbnRZKyhpJiZpLnNjcm9sbFRvcHx8aiYmai5zY3JvbGxUb3B8fDApLShpJiZpLmNsaWVudFRvcHx8aiYmai5jbGllbnRUb3B8fDApfWEud2hpY2g9PW51bGwmJihhLmNoYXJDb2RlIT1udWxsfHxhLmtleUNvZGUhPW51bGwpJiYoYS53aGljaD1hLmNoYXJDb2RlIT1udWxsP2EuY2hhckNvZGU6YS5rZXlDb2RlKSwhYS5tZXRhS2V5JiZhLmN0cmxLZXkmJihhLm1ldGFLZXk9YS5jdHJsS2V5KSwhYS53aGljaCYmYS5idXR0b24hPT1iJiYoYS53aGljaD1hLmJ1dHRvbiYxPzE6YS5idXR0b24mMj8zOmEuYnV0dG9uJjQ/MjowKTtyZXR1cm4gYX0sZ3VpZDoxZTgscHJveHk6Zi5wcm94eSxzcGVjaWFsOntyZWFkeTp7c2V0dXA6Zi5iaW5kUmVhZHksdGVhcmRvd246Zi5ub29wfSxsaXZlOnthZGQ6ZnVuY3Rpb24oYSl7Zi5ldmVudC5hZGQodGhpcyxOKGEub3JpZ1R5cGUsYS5zZWxlY3RvciksZi5leHRlbmQoe30sYSx7aGFuZGxlcjpNLGd1aWQ6YS5oYW5kbGVyLmd1aWR9KSl9LHJlbW92ZTpmdW5jdGlvbihhKXtmLmV2ZW50LnJlbW92ZSh0aGlzLE4oYS5vcmlnVHlwZSxhLnNlbGVjdG9yKSxhKX19LGJlZm9yZXVubG9hZDp7c2V0dXA6ZnVuY3Rpb24oYSxiLGMpe2YuaXNXaW5kb3codGhpcykmJih0aGlzLm9uYmVmb3JldW5sb2FkPWMpfSx0ZWFyZG93bjpmdW5jdGlvbihhLGIpe3RoaXMub25iZWZvcmV1bmxvYWQ9PT1iJiYodGhpcy5vbmJlZm9yZXVubG9hZD1udWxsKX19fX0sZi5yZW1vdmVFdmVudD1jLnJlbW92ZUV2ZW50TGlzdGVuZXI/ZnVuY3Rpb24oYSxiLGMpe2EucmVtb3ZlRXZlbnRMaXN0ZW5lciYmYS5yZW1vdmVFdmVudExpc3RlbmVyKGIsYywhMSl9OmZ1bmN0aW9uKGEsYixjKXthLmRldGFjaEV2ZW50JiZhLmRldGFjaEV2ZW50KCJvbiIrYixjKX0sZi5FdmVudD1mdW5jdGlvbihhLGIpe2lmKCF0aGlzLnByZXZlbnREZWZhdWx0KXJldHVybiBuZXcgZi5FdmVudChhLGIpO2EmJmEudHlwZT8odGhpcy5vcmlnaW5hbEV2ZW50PWEsdGhpcy50eXBlPWEudHlwZSx0aGlzLmlzRGVmYXVsdFByZXZlbnRlZD1hLmRlZmF1bHRQcmV2ZW50ZWR8fGEucmV0dXJuVmFsdWU9PT0hMXx8YS5nZXRQcmV2ZW50RGVmYXVsdCYmYS5nZXRQcmV2ZW50RGVmYXVsdCgpP0U6RCk6dGhpcy50eXBlPWEsYiYmZi5leHRlbmQodGhpcyxiKSx0aGlzLnRpbWVTdGFtcD1mLm5vdygpLHRoaXNbZi5leHBhbmRvXT0hMH0sZi5FdmVudC5wcm90b3R5cGU9e3ByZXZlbnREZWZhdWx0OmZ1bmN0aW9uKCl7dGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9RTt2YXIgYT10aGlzLm9yaWdpbmFsRXZlbnQ7IWF8fChhLnByZXZlbnREZWZhdWx0P2EucHJldmVudERlZmF1bHQoKTphLnJldHVyblZhbHVlPSExKX0sc3RvcFByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7dGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZD1FO3ZhciBhPXRoaXMub3JpZ2luYWxFdmVudDshYXx8KGEuc3RvcFByb3BhZ2F0aW9uJiZhLnN0b3BQcm9wYWdhdGlvbigpLGEuY2FuY2VsQnViYmxlPSEwKX0sc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7dGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZD1FLHRoaXMuc3RvcFByb3BhZ2F0aW9uKCl9LGlzRGVmYXVsdFByZXZlbnRlZDpELGlzUHJvcGFnYXRpb25TdG9wcGVkOkQsaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ6RH07dmFyIEY9ZnVuY3Rpb24oYSl7dmFyIGI9YS5yZWxhdGVkVGFyZ2V0LGM9ITEsZD1hLnR5cGU7YS50eXBlPWEuZGF0YSxiIT09dGhpcyYmKGImJihjPWYuY29udGFpbnModGhpcyxiKSksY3x8KGYuZXZlbnQuaGFuZGxlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxhLnR5cGU9ZCkpfSxHPWZ1bmN0aW9uKGEpe2EudHlwZT1hLmRhdGEsZi5ldmVudC5oYW5kbGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfTtmLmVhY2goe21vdXNlZW50ZXI6Im1vdXNlb3ZlciIsbW91c2VsZWF2ZToibW91c2VvdXQifSxmdW5jdGlvbihhLGIpe2YuZXZlbnQuc3BlY2lhbFthXT17c2V0dXA6ZnVuY3Rpb24oYyl7Zi5ldmVudC5hZGQodGhpcyxiLGMmJmMuc2VsZWN0b3I/RzpGLGEpfSx0ZWFyZG93bjpmdW5jdGlvbihhKXtmLmV2ZW50LnJlbW92ZSh0aGlzLGIsYSYmYS5zZWxlY3Rvcj9HOkYpfX19KSxmLnN1cHBvcnQuc3VibWl0QnViYmxlc3x8KGYuZXZlbnQuc3BlY2lhbC5zdWJtaXQ9e3NldHVwOmZ1bmN0aW9uKGEsYil7aWYoIWYubm9kZU5hbWUodGhpcywiZm9ybSIpKWYuZXZlbnQuYWRkKHRoaXMsImNsaWNrLnNwZWNpYWxTdWJtaXQiLGZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0LGM9Yi50eXBlOyhjPT09InN1Ym1pdCJ8fGM9PT0iaW1hZ2UiKSYmZihiKS5jbG9zZXN0KCJmb3JtIikubGVuZ3RoJiZLKCJzdWJtaXQiLHRoaXMsYXJndW1lbnRzKX0pLGYuZXZlbnQuYWRkKHRoaXMsImtleXByZXNzLnNwZWNpYWxTdWJtaXQiLGZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0LGM9Yi50eXBlOyhjPT09InRleHQifHxjPT09InBhc3N3b3JkIikmJmYoYikuY2xvc2VzdCgiZm9ybSIpLmxlbmd0aCYmYS5rZXlDb2RlPT09MTMmJksoInN1Ym1pdCIsdGhpcyxhcmd1bWVudHMpfSk7ZWxzZSByZXR1cm4hMX0sdGVhcmRvd246ZnVuY3Rpb24oYSl7Zi5ldmVudC5yZW1vdmUodGhpcywiLnNwZWNpYWxTdWJtaXQiKX19KTtpZighZi5zdXBwb3J0LmNoYW5nZUJ1YmJsZXMpe3ZhciBILEk9ZnVuY3Rpb24oYSl7dmFyIGI9YS50eXBlLGM9YS52YWx1ZTtiPT09InJhZGlvInx8Yj09PSJjaGVja2JveCI/Yz1hLmNoZWNrZWQ6Yj09PSJzZWxlY3QtbXVsdGlwbGUiP2M9YS5zZWxlY3RlZEluZGV4Pi0xP2YubWFwKGEub3B0aW9ucyxmdW5jdGlvbihhKXtyZXR1cm4gYS5zZWxlY3RlZH0pLmpvaW4oIi0iKToiIjpmLm5vZGVOYW1lKGEsInNlbGVjdCIpJiYoYz1hLnNlbGVjdGVkSW5kZXgpO3JldHVybiBjfSxKPWZ1bmN0aW9uKGMpe3ZhciBkPWMudGFyZ2V0LGUsZztpZighIXkudGVzdChkLm5vZGVOYW1lKSYmIWQucmVhZE9ubHkpe2U9Zi5fZGF0YShkLCJfY2hhbmdlX2RhdGEiKSxnPUkoZCksKGMudHlwZSE9PSJmb2N1c291dCJ8fGQudHlwZSE9PSJyYWRpbyIpJiZmLl9kYXRhKGQsIl9jaGFuZ2VfZGF0YSIsZyk7aWYoZT09PWJ8fGc9PT1lKXJldHVybjtpZihlIT1udWxsfHxnKWMudHlwZT0iY2hhbmdlIixjLmxpdmVGaXJlZD1iLGYuZXZlbnQudHJpZ2dlcihjLGFyZ3VtZW50c1sxXSxkKX19O2YuZXZlbnQuc3BlY2lhbC5jaGFuZ2U9e2ZpbHRlcnM6e2ZvY3Vzb3V0OkosYmVmb3JlZGVhY3RpdmF0ZTpKLGNsaWNrOmZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0LGM9Zi5ub2RlTmFtZShiLCJpbnB1dCIpP2IudHlwZToiIjsoYz09PSJyYWRpbyJ8fGM9PT0iY2hlY2tib3gifHxmLm5vZGVOYW1lKGIsInNlbGVjdCIpKSYmSi5jYWxsKHRoaXMsYSl9LGtleWRvd246ZnVuY3Rpb24oYSl7dmFyIGI9YS50YXJnZXQsYz1mLm5vZGVOYW1lKGIsImlucHV0Iik/Yi50eXBlOiIiOyhhLmtleUNvZGU9PT0xMyYmIWYubm9kZU5hbWUoYiwidGV4dGFyZWEiKXx8YS5rZXlDb2RlPT09MzImJihjPT09ImNoZWNrYm94Inx8Yz09PSJyYWRpbyIpfHxjPT09InNlbGVjdC1tdWx0aXBsZSIpJiZKLmNhbGwodGhpcyxhKX0sYmVmb3JlYWN0aXZhdGU6ZnVuY3Rpb24oYSl7dmFyIGI9YS50YXJnZXQ7Zi5fZGF0YShiLCJfY2hhbmdlX2RhdGEiLEkoYikpfX0sc2V0dXA6ZnVuY3Rpb24oYSxiKXtpZih0aGlzLnR5cGU9PT0iZmlsZSIpcmV0dXJuITE7Zm9yKHZhciBjIGluIEgpZi5ldmVudC5hZGQodGhpcyxjKyIuc3BlY2lhbENoYW5nZSIsSFtjXSk7cmV0dXJuIHkudGVzdCh0aGlzLm5vZGVOYW1lKX0sdGVhcmRvd246ZnVuY3Rpb24oYSl7Zi5ldmVudC5yZW1vdmUodGhpcywiLnNwZWNpYWxDaGFuZ2UiKTtyZXR1cm4geS50ZXN0KHRoaXMubm9kZU5hbWUpfX0sSD1mLmV2ZW50LnNwZWNpYWwuY2hhbmdlLmZpbHRlcnMsSC5mb2N1cz1ILmJlZm9yZWFjdGl2YXRlfWYuc3VwcG9ydC5mb2N1c2luQnViYmxlc3x8Zi5lYWNoKHtmb2N1czoiZm9jdXNpbiIsYmx1cjoiZm9jdXNvdXQifSxmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGUoYSl7dmFyIGM9Zi5ldmVudC5maXgoYSk7Yy50eXBlPWIsYy5vcmlnaW5hbEV2ZW50PXt9LGYuZXZlbnQudHJpZ2dlcihjLG51bGwsYy50YXJnZXQpLGMuaXNEZWZhdWx0UHJldmVudGVkKCkmJmEucHJldmVudERlZmF1bHQoKX12YXIgZD0wO2YuZXZlbnQuc3BlY2lhbFtiXT17c2V0dXA6ZnVuY3Rpb24oKXtkKys9PT0wJiZjLmFkZEV2ZW50TGlzdGVuZXIoYSxlLCEwKX0sdGVhcmRvd246ZnVuY3Rpb24oKXstLWQ9PT0wJiZjLnJlbW92ZUV2ZW50TGlzdGVuZXIoYSxlLCEwKX19fSksZi5lYWNoKFsiYmluZCIsIm9uZSJdLGZ1bmN0aW9uKGEsYyl7Zi5mbltjXT1mdW5jdGlvbihhLGQsZSl7dmFyIGc7aWYodHlwZW9mIGE9PSJvYmplY3QiKXtmb3IodmFyIGggaW4gYSl0aGlzW2NdKGgsZCxhW2hdLGUpO3JldHVybiB0aGlzfWlmKGFyZ3VtZW50cy5sZW5ndGg9PT0yfHxkPT09ITEpZT1kLGQ9YjtjPT09Im9uZSI/KGc9ZnVuY3Rpb24oYSl7Zih0aGlzKS51bmJpbmQoYSxnKTtyZXR1cm4gZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LGcuZ3VpZD1lLmd1aWR8fGYuZ3VpZCsrKTpnPWU7aWYoYT09PSJ1bmxvYWQiJiZjIT09Im9uZSIpdGhpcy5vbmUoYSxkLGUpO2Vsc2UgZm9yKHZhciBpPTAsaj10aGlzLmxlbmd0aDtpPGo7aSsrKWYuZXZlbnQuYWRkKHRoaXNbaV0sYSxnLGQpO3JldHVybiB0aGlzfX0pLGYuZm4uZXh0ZW5kKHt1bmJpbmQ6ZnVuY3Rpb24oYSxiKXtpZih0eXBlb2YgYT09Im9iamVjdCImJiFhLnByZXZlbnREZWZhdWx0KWZvcih2YXIgYyBpbiBhKXRoaXMudW5iaW5kKGMsYVtjXSk7ZWxzZSBmb3IodmFyIGQ9MCxlPXRoaXMubGVuZ3RoO2Q8ZTtkKyspZi5ldmVudC5yZW1vdmUodGhpc1tkXSxhLGIpO3JldHVybiB0aGlzfSxkZWxlZ2F0ZTpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5saXZlKGIsYyxkLGEpfSx1bmRlbGVnYXRlOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD09PTA/dGhpcy51bmJpbmQoImxpdmUiKTp0aGlzLmRpZShiLG51bGwsYyxhKX0sdHJpZ2dlcjpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLmV2ZW50LnRyaWdnZXIoYSxiLHRoaXMpfSl9LHRyaWdnZXJIYW5kbGVyOmZ1bmN0aW9uKGEsYil7aWYodGhpc1swXSlyZXR1cm4gZi5ldmVudC50cmlnZ2VyKGEsYix0aGlzWzBdLCEwKX0sdG9nZ2xlOmZ1bmN0aW9uKGEpe3ZhciBiPWFyZ3VtZW50cyxjPWEuZ3VpZHx8Zi5ndWlkKyssZD0wLGU9ZnVuY3Rpb24oYyl7dmFyIGU9KGYuZGF0YSh0aGlzLCJsYXN0VG9nZ2xlIithLmd1aWQpfHwwKSVkO2YuZGF0YSh0aGlzLCJsYXN0VG9nZ2xlIithLmd1aWQsZSsxKSxjLnByZXZlbnREZWZhdWx0KCk7cmV0dXJuIGJbZV0uYXBwbHkodGhpcyxhcmd1bWVudHMpfHwhMX07ZS5ndWlkPWM7d2hpbGUoZDxiLmxlbmd0aCliW2QrK10uZ3VpZD1jO3JldHVybiB0aGlzLmNsaWNrKGUpfSxob3ZlcjpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLm1vdXNlZW50ZXIoYSkubW91c2VsZWF2ZShifHxhKX19KTt2YXIgTD17Zm9jdXM6ImZvY3VzaW4iLGJsdXI6ImZvY3Vzb3V0Iixtb3VzZWVudGVyOiJtb3VzZW92ZXIiLG1vdXNlbGVhdmU6Im1vdXNlb3V0In07Zi5lYWNoKFsibGl2ZSIsImRpZSJdLGZ1bmN0aW9uKGEsYyl7Zi5mbltjXT1mdW5jdGlvbihhLGQsZSxnKXt2YXIgaCxpPTAsaixrLGwsbT1nfHx0aGlzLnNlbGVjdG9yLG49Zz90aGlzOmYodGhpcy5jb250ZXh0KTtpZih0eXBlb2YgYT09Im9iamVjdCImJiFhLnByZXZlbnREZWZhdWx0KXtmb3IodmFyIG8gaW4gYSluW2NdKG8sZCxhW29dLG0pO3JldHVybiB0aGlzfWlmKGM9PT0iZGllIiYmIWEmJmcmJmcuY2hhckF0KDApPT09Ii4iKXtuLnVuYmluZChnKTtyZXR1cm4gdGhpc31pZihkPT09ITF8fGYuaXNGdW5jdGlvbihkKSllPWR8fEQsZD1iO2E9KGF8fCIiKS5zcGxpdCgiICIpO3doaWxlKChoPWFbaSsrXSkhPW51bGwpe2o9eC5leGVjKGgpLGs9IiIsaiYmKGs9alswXSxoPWgucmVwbGFjZSh4LCIiKSk7aWYoaD09PSJob3ZlciIpe2EucHVzaCgibW91c2VlbnRlciIraywibW91c2VsZWF2ZSIrayk7Y29udGludWV9bD1oLExbaF0/KGEucHVzaChMW2hdK2spLGg9aCtrKTpoPShMW2hdfHxoKStrO2lmKGM9PT0ibGl2ZSIpZm9yKHZhciBwPTAscT1uLmxlbmd0aDtwPHE7cCsrKWYuZXZlbnQuYWRkKG5bcF0sImxpdmUuIitOKGgsbSkse2RhdGE6ZCxzZWxlY3RvcjptLGhhbmRsZXI6ZSxvcmlnVHlwZTpoLG9yaWdIYW5kbGVyOmUscHJlVHlwZTpsfSk7ZWxzZSBuLnVuYmluZCgibGl2ZS4iK04oaCxtKSxlKX1yZXR1cm4gdGhpc319KSxmLmVhY2goImJsdXIgZm9jdXMgZm9jdXNpbiBmb2N1c291dCBsb2FkIHJlc2l6ZSBzY3JvbGwgdW5sb2FkIGNsaWNrIGRibGNsaWNrIG1vdXNlZG93biBtb3VzZXVwIG1vdXNlbW92ZSBtb3VzZW92ZXIgbW91c2VvdXQgbW91c2VlbnRlciBtb3VzZWxlYXZlIGNoYW5nZSBzZWxlY3Qgc3VibWl0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgZXJyb3IiLnNwbGl0KCIgIiksZnVuY3Rpb24oYSxiKXtmLmZuW2JdPWZ1bmN0aW9uKGEsYyl7Yz09bnVsbCYmKGM9YSxhPW51bGwpO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPjA/dGhpcy5iaW5kKGIsYSxjKTp0aGlzLnRyaWdnZXIoYil9LGYuYXR0ckZuJiYoZi5hdHRyRm5bYl09ITApfSksZnVuY3Rpb24oKXtmdW5jdGlvbiB1KGEsYixjLGQsZSxmKXtmb3IodmFyIGc9MCxoPWQubGVuZ3RoO2c8aDtnKyspe3ZhciBpPWRbZ107aWYoaSl7dmFyIGo9ITE7aT1pW2FdO3doaWxlKGkpe2lmKGkuc2l6Y2FjaGU9PT1jKXtqPWRbaS5zaXpzZXRdO2JyZWFrfWlmKGkubm9kZVR5cGU9PT0xKXtmfHwoaS5zaXpjYWNoZT1jLGkuc2l6c2V0PWcpO2lmKHR5cGVvZiBiIT0ic3RyaW5nIil7aWYoaT09PWIpe2o9ITA7YnJlYWt9fWVsc2UgaWYoay5maWx0ZXIoYixbaV0pLmxlbmd0aD4wKXtqPWk7YnJlYWt9fWk9aVthXX1kW2ddPWp9fX1mdW5jdGlvbiB0KGEsYixjLGQsZSxmKXtmb3IodmFyIGc9MCxoPWQubGVuZ3RoO2c8aDtnKyspe3ZhciBpPWRbZ107aWYoaSl7dmFyIGo9ITE7aT1pW2FdO3doaWxlKGkpe2lmKGkuc2l6Y2FjaGU9PT1jKXtqPWRbaS5zaXpzZXRdO2JyZWFrfWkubm9kZVR5cGU9PT0xJiYhZiYmKGkuc2l6Y2FjaGU9YyxpLnNpenNldD1nKTtpZihpLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iKXtqPWk7YnJlYWt9aT1pW2FdfWRbZ109an19fXZhciBhPS8oKD86XCgoPzpcKFteKCldK1wpfFteKCldKykrXCl8XFsoPzpcW1teXFtcXV0qXF18WyciXVteJyJdKlsnIl18W15cW1xdJyJdKykrXF18XFwufFteID4rfiwoXFtcXF0rKSt8Wz4rfl0pKFxzKixccyopPygoPzoufFxyfFxuKSopL2csZD0wLGU9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyxnPSExLGg9ITAsaT0vXFwvZyxqPS9cVy87WzAsMF0uc29ydChmdW5jdGlvbigpe2g9ITE7cmV0dXJuIDB9KTt2YXIgaz1mdW5jdGlvbihiLGQsZixnKXtmPWZ8fFtdLGQ9ZHx8Yzt2YXIgaD1kO2lmKGQubm9kZVR5cGUhPT0xJiZkLm5vZGVUeXBlIT09OSlyZXR1cm5bXTtpZighYnx8dHlwZW9mIGIhPSJzdHJpbmciKXJldHVybiBmO3ZhciBpLGosbixvLHEscixzLHQsdT0hMCx3PWsuaXNYTUwoZCkseD1bXSx5PWI7ZG97YS5leGVjKCIiKSxpPWEuZXhlYyh5KTtpZihpKXt5PWlbM10seC5wdXNoKGlbMV0pO2lmKGlbMl0pe289aVszXTticmVha319fXdoaWxlKGkpO2lmKHgubGVuZ3RoPjEmJm0uZXhlYyhiKSlpZih4Lmxlbmd0aD09PTImJmwucmVsYXRpdmVbeFswXV0paj12KHhbMF0reFsxXSxkKTtlbHNle2o9bC5yZWxhdGl2ZVt4WzBdXT9bZF06ayh4LnNoaWZ0KCksZCk7d2hpbGUoeC5sZW5ndGgpYj14LnNoaWZ0KCksbC5yZWxhdGl2ZVtiXSYmKGIrPXguc2hpZnQoKSksaj12KGIsail9ZWxzZXshZyYmeC5sZW5ndGg+MSYmZC5ub2RlVHlwZT09PTkmJiF3JiZsLm1hdGNoLklELnRlc3QoeFswXSkmJiFsLm1hdGNoLklELnRlc3QoeFt4Lmxlbmd0aC0xXSkmJihxPWsuZmluZCh4LnNoaWZ0KCksZCx3KSxkPXEuZXhwcj9rLmZpbHRlcihxLmV4cHIscS5zZXQpWzBdOnEuc2V0WzBdKTtpZihkKXtxPWc/e2V4cHI6eC5wb3AoKSxzZXQ6cChnKX06ay5maW5kKHgucG9wKCkseC5sZW5ndGg9PT0xJiYoeFswXT09PSJ+Inx8eFswXT09PSIrIikmJmQucGFyZW50Tm9kZT9kLnBhcmVudE5vZGU6ZCx3KSxqPXEuZXhwcj9rLmZpbHRlcihxLmV4cHIscS5zZXQpOnEuc2V0LHgubGVuZ3RoPjA/bj1wKGopOnU9ITE7d2hpbGUoeC5sZW5ndGgpcj14LnBvcCgpLHM9cixsLnJlbGF0aXZlW3JdP3M9eC5wb3AoKTpyPSIiLHM9PW51bGwmJihzPWQpLGwucmVsYXRpdmVbcl0obixzLHcpfWVsc2Ugbj14PVtdfW58fChuPWopLG58fGsuZXJyb3Iocnx8Yik7aWYoZS5jYWxsKG4pPT09IltvYmplY3QgQXJyYXldIilpZighdSlmLnB1c2guYXBwbHkoZixuKTtlbHNlIGlmKGQmJmQubm9kZVR5cGU9PT0xKWZvcih0PTA7blt0XSE9bnVsbDt0Kyspblt0XSYmKG5bdF09PT0hMHx8blt0XS5ub2RlVHlwZT09PTEmJmsuY29udGFpbnMoZCxuW3RdKSkmJmYucHVzaChqW3RdKTtlbHNlIGZvcih0PTA7blt0XSE9bnVsbDt0Kyspblt0XSYmblt0XS5ub2RlVHlwZT09PTEmJmYucHVzaChqW3RdKTtlbHNlIHAobixmKTtvJiYoayhvLGgsZixnKSxrLnVuaXF1ZVNvcnQoZikpO3JldHVybiBmfTtrLnVuaXF1ZVNvcnQ9ZnVuY3Rpb24oYSl7aWYocil7Zz1oLGEuc29ydChyKTtpZihnKWZvcih2YXIgYj0xO2I8YS5sZW5ndGg7YisrKWFbYl09PT1hW2ItMV0mJmEuc3BsaWNlKGItLSwxKX1yZXR1cm4gYX0say5tYXRjaGVzPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGsoYSxudWxsLG51bGwsYil9LGsubWF0Y2hlc1NlbGVjdG9yPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGsoYixudWxsLG51bGwsW2FdKS5sZW5ndGg+MH0say5maW5kPWZ1bmN0aW9uKGEsYixjKXt2YXIgZDtpZighYSlyZXR1cm5bXTtmb3IodmFyIGU9MCxmPWwub3JkZXIubGVuZ3RoO2U8ZjtlKyspe3ZhciBnLGg9bC5vcmRlcltlXTtpZihnPWwubGVmdE1hdGNoW2hdLmV4ZWMoYSkpe3ZhciBqPWdbMV07Zy5zcGxpY2UoMSwxKTtpZihqLnN1YnN0cihqLmxlbmd0aC0xKSE9PSJcXCIpe2dbMV09KGdbMV18fCIiKS5yZXBsYWNlKGksIiIpLGQ9bC5maW5kW2hdKGcsYixjKTtpZihkIT1udWxsKXthPWEucmVwbGFjZShsLm1hdGNoW2hdLCIiKTticmVha319fX1kfHwoZD10eXBlb2YgYi5nZXRFbGVtZW50c0J5VGFnTmFtZSE9InVuZGVmaW5lZCI/Yi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpOltdKTtyZXR1cm57c2V0OmQsZXhwcjphfX0say5maWx0ZXI9ZnVuY3Rpb24oYSxjLGQsZSl7dmFyIGYsZyxoPWEsaT1bXSxqPWMsbT1jJiZjWzBdJiZrLmlzWE1MKGNbMF0pO3doaWxlKGEmJmMubGVuZ3RoKXtmb3IodmFyIG4gaW4gbC5maWx0ZXIpaWYoKGY9bC5sZWZ0TWF0Y2hbbl0uZXhlYyhhKSkhPW51bGwmJmZbMl0pe3ZhciBvLHAscT1sLmZpbHRlcltuXSxyPWZbMV07Zz0hMSxmLnNwbGljZSgxLDEpO2lmKHIuc3Vic3RyKHIubGVuZ3RoLTEpPT09IlxcIiljb250aW51ZTtqPT09aSYmKGk9W10pO2lmKGwucHJlRmlsdGVyW25dKXtmPWwucHJlRmlsdGVyW25dKGYsaixkLGksZSxtKTtpZighZilnPW89ITA7ZWxzZSBpZihmPT09ITApY29udGludWV9aWYoZilmb3IodmFyIHM9MDsocD1qW3NdKSE9bnVsbDtzKyspaWYocCl7bz1xKHAsZixzLGopO3ZhciB0PWVeISFvO2QmJm8hPW51bGw/dD9nPSEwOmpbc109ITE6dCYmKGkucHVzaChwKSxnPSEwKX1pZihvIT09Yil7ZHx8KGo9aSksYT1hLnJlcGxhY2UobC5tYXRjaFtuXSwiIik7aWYoIWcpcmV0dXJuW107YnJlYWt9fWlmKGE9PT1oKWlmKGc9PW51bGwpay5lcnJvcihhKTtlbHNlIGJyZWFrO2g9YX1yZXR1cm4gan0say5lcnJvcj1mdW5jdGlvbihhKXt0aHJvdyJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiAiK2F9O3ZhciBsPWsuc2VsZWN0b3JzPXtvcmRlcjpbIklEIiwiTkFNRSIsIlRBRyJdLG1hdGNoOntJRDovIygoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKS8sQ0xBU1M6L1wuKCg/Oltcd1x1MDBjMC1cdUZGRkZcLV18XFwuKSspLyxOQU1FOi9cW25hbWU9WyciXSooKD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKylbJyJdKlxdLyxBVFRSOi9cW1xzKigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKVxzKig/OihcUz89KVxzKig/OihbJyJdKSguKj8pXDN8KCM/KD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKil8KXwpXHMqXF0vLFRBRzovXigoPzpbXHdcdTAwYzAtXHVGRkZGXCpcLV18XFwuKSspLyxDSElMRDovOihvbmx5fG50aHxsYXN0fGZpcnN0KS1jaGlsZCg/OlwoXHMqKGV2ZW58b2RkfCg/OlsrXC1dP1xkK3woPzpbK1wtXT9cZCopP25ccyooPzpbK1wtXVxzKlxkKyk/KSlccypcKSk/LyxQT1M6LzoobnRofGVxfGd0fGx0fGZpcnN0fGxhc3R8ZXZlbnxvZGQpKD86XCgoXGQqKVwpKT8oPz1bXlwtXXwkKS8sUFNFVURPOi86KCg/Oltcd1x1MDBjMC1cdUZGRkZcLV18XFwuKSspKD86XCgoWyciXT8pKCg/OlwoW15cKV0rXCl8W15cKFwpXSopKylcMlwpKT8vfSxsZWZ0TWF0Y2g6e30sYXR0ck1hcDp7ImNsYXNzIjoiY2xhc3NOYW1lIiwiZm9yIjoiaHRtbEZvciJ9LGF0dHJIYW5kbGU6e2hyZWY6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZ2V0QXR0cmlidXRlKCJocmVmIil9LHR5cGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZ2V0QXR0cmlidXRlKCJ0eXBlIil9fSxyZWxhdGl2ZTp7IisiOmZ1bmN0aW9uKGEsYil7dmFyIGM9dHlwZW9mIGI9PSJzdHJpbmciLGQ9YyYmIWoudGVzdChiKSxlPWMmJiFkO2QmJihiPWIudG9Mb3dlckNhc2UoKSk7Zm9yKHZhciBmPTAsZz1hLmxlbmd0aCxoO2Y8ZztmKyspaWYoaD1hW2ZdKXt3aGlsZSgoaD1oLnByZXZpb3VzU2libGluZykmJmgubm9kZVR5cGUhPT0xKTthW2ZdPWV8fGgmJmgubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWI/aHx8ITE6aD09PWJ9ZSYmay5maWx0ZXIoYixhLCEwKX0sIj4iOmZ1bmN0aW9uKGEsYil7dmFyIGMsZD10eXBlb2YgYj09InN0cmluZyIsZT0wLGY9YS5sZW5ndGg7aWYoZCYmIWoudGVzdChiKSl7Yj1iLnRvTG93ZXJDYXNlKCk7Zm9yKDtlPGY7ZSsrKXtjPWFbZV07aWYoYyl7dmFyIGc9Yy5wYXJlbnROb2RlO2FbZV09Zy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09Yj9nOiExfX19ZWxzZXtmb3IoO2U8ZjtlKyspYz1hW2VdLGMmJihhW2VdPWQ/Yy5wYXJlbnROb2RlOmMucGFyZW50Tm9kZT09PWIpO2QmJmsuZmlsdGVyKGIsYSwhMCl9fSwiIjpmdW5jdGlvbihhLGIsYyl7dmFyIGUsZj1kKyssZz11O3R5cGVvZiBiPT0ic3RyaW5nIiYmIWoudGVzdChiKSYmKGI9Yi50b0xvd2VyQ2FzZSgpLGU9YixnPXQpLGcoInBhcmVudE5vZGUiLGIsZixhLGUsYyl9LCJ+IjpmdW5jdGlvbihhLGIsYyl7dmFyIGUsZj1kKyssZz11O3R5cGVvZiBiPT0ic3RyaW5nIiYmIWoudGVzdChiKSYmKGI9Yi50b0xvd2VyQ2FzZSgpLGU9YixnPXQpLGcoInByZXZpb3VzU2libGluZyIsYixmLGEsZSxjKX19LGZpbmQ6e0lEOmZ1bmN0aW9uKGEsYixjKXtpZih0eXBlb2YgYi5nZXRFbGVtZW50QnlJZCE9InVuZGVmaW5lZCImJiFjKXt2YXIgZD1iLmdldEVsZW1lbnRCeUlkKGFbMV0pO3JldHVybiBkJiZkLnBhcmVudE5vZGU/W2RdOltdfX0sTkFNRTpmdW5jdGlvbihhLGIpe2lmKHR5cGVvZiBiLmdldEVsZW1lbnRzQnlOYW1lIT0idW5kZWZpbmVkIil7dmFyIGM9W10sZD1iLmdldEVsZW1lbnRzQnlOYW1lKGFbMV0pO2Zvcih2YXIgZT0wLGY9ZC5sZW5ndGg7ZTxmO2UrKylkW2VdLmdldEF0dHJpYnV0ZSgibmFtZSIpPT09YVsxXSYmYy5wdXNoKGRbZV0pO3JldHVybiBjLmxlbmd0aD09PTA/bnVsbDpjfX0sVEFHOmZ1bmN0aW9uKGEsYil7aWYodHlwZW9mIGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUhPSJ1bmRlZmluZWQiKXJldHVybiBiLmdldEVsZW1lbnRzQnlUYWdOYW1lKGFbMV0pfX0scHJlRmlsdGVyOntDTEFTUzpmdW5jdGlvbihhLGIsYyxkLGUsZil7YT0iICIrYVsxXS5yZXBsYWNlKGksIiIpKyIgIjtpZihmKXJldHVybiBhO2Zvcih2YXIgZz0wLGg7KGg9YltnXSkhPW51bGw7ZysrKWgmJihlXihoLmNsYXNzTmFtZSYmKCIgIitoLmNsYXNzTmFtZSsiICIpLnJlcGxhY2UoL1tcdFxuXHJdL2csIiAiKS5pbmRleE9mKGEpPj0wKT9jfHxkLnB1c2goaCk6YyYmKGJbZ109ITEpKTtyZXR1cm4hMX0sSUQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGFbMV0ucmVwbGFjZShpLCIiKX0sVEFHOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGFbMV0ucmVwbGFjZShpLCIiKS50b0xvd2VyQ2FzZSgpfSxDSElMRDpmdW5jdGlvbihhKXtpZihhWzFdPT09Im50aCIpe2FbMl18fGsuZXJyb3IoYVswXSksYVsyXT1hWzJdLnJlcGxhY2UoL15cK3xccyovZywiIik7dmFyIGI9LygtPykoXGQqKSg/Om4oWytcLV0/XGQqKSk/Ly5leGVjKGFbMl09PT0iZXZlbiImJiIybiJ8fGFbMl09PT0ib2RkIiYmIjJuKzEifHwhL1xELy50ZXN0KGFbMl0pJiYiMG4rIithWzJdfHxhWzJdKTthWzJdPWJbMV0rKGJbMl18fDEpLTAsYVszXT1iWzNdLTB9ZWxzZSBhWzJdJiZrLmVycm9yKGFbMF0pO2FbMF09ZCsrO3JldHVybiBhfSxBVFRSOmZ1bmN0aW9uKGEsYixjLGQsZSxmKXt2YXIgZz1hWzFdPWFbMV0ucmVwbGFjZShpLCIiKTshZiYmbC5hdHRyTWFwW2ddJiYoYVsxXT1sLmF0dHJNYXBbZ10pLGFbNF09KGFbNF18fGFbNV18fCIiKS5yZXBsYWNlKGksIiIpLGFbMl09PT0ifj0iJiYoYVs0XT0iICIrYVs0XSsiICIpO3JldHVybiBhfSxQU0VVRE86ZnVuY3Rpb24oYixjLGQsZSxmKXtpZihiWzFdPT09Im5vdCIpaWYoKGEuZXhlYyhiWzNdKXx8IiIpLmxlbmd0aD4xfHwvXlx3Ly50ZXN0KGJbM10pKWJbM109ayhiWzNdLG51bGwsbnVsbCxjKTtlbHNle3ZhciBnPWsuZmlsdGVyKGJbM10sYyxkLCEwXmYpO2R8fGUucHVzaC5hcHBseShlLGcpO3JldHVybiExfWVsc2UgaWYobC5tYXRjaC5QT1MudGVzdChiWzBdKXx8bC5tYXRjaC5DSElMRC50ZXN0KGJbMF0pKXJldHVybiEwO3JldHVybiBifSxQT1M6ZnVuY3Rpb24oYSl7YS51bnNoaWZ0KCEwKTtyZXR1cm4gYX19LGZpbHRlcnM6e2VuYWJsZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZGlzYWJsZWQ9PT0hMSYmYS50eXBlIT09ImhpZGRlbiJ9LGRpc2FibGVkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmRpc2FibGVkPT09ITB9LGNoZWNrZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuY2hlY2tlZD09PSEwfSxzZWxlY3RlZDpmdW5jdGlvbihhKXthLnBhcmVudE5vZGUmJmEucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4O3JldHVybiBhLnNlbGVjdGVkPT09ITB9LHBhcmVudDpmdW5jdGlvbihhKXtyZXR1cm4hIWEuZmlyc3RDaGlsZH0sZW1wdHk6ZnVuY3Rpb24oYSl7cmV0dXJuIWEuZmlyc3RDaGlsZH0saGFzOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4hIWsoY1szXSxhKS5sZW5ndGh9LGhlYWRlcjpmdW5jdGlvbihhKXtyZXR1cm4vaFxkL2kudGVzdChhLm5vZGVOYW1lKX0sdGV4dDpmdW5jdGlvbihhKXt2YXIgYj1hLmdldEF0dHJpYnV0ZSgidHlwZSIpLGM9YS50eXBlO3JldHVybiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT0iaW5wdXQiJiYidGV4dCI9PT1jJiYoYj09PWN8fGI9PT1udWxsKX0scmFkaW86ZnVuY3Rpb24oYSl7cmV0dXJuIGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PSJpbnB1dCImJiJyYWRpbyI9PT1hLnR5cGV9LGNoZWNrYm94OmZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT0iaW5wdXQiJiYiY2hlY2tib3giPT09YS50eXBlfSxmaWxlOmZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT0iaW5wdXQiJiYiZmlsZSI9PT1hLnR5cGV9LHBhc3N3b3JkOmZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT0iaW5wdXQiJiYicGFzc3dvcmQiPT09YS50eXBlfSxzdWJtaXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybihiPT09ImlucHV0Inx8Yj09PSJidXR0b24iKSYmInN1Ym1pdCI9PT1hLnR5cGV9LGltYWdlOmZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT0iaW5wdXQiJiYiaW1hZ2UiPT09YS50eXBlfSxyZXNldDpmdW5jdGlvbihhKXt2YXIgYj1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuKGI9PT0iaW5wdXQifHxiPT09ImJ1dHRvbiIpJiYicmVzZXQiPT09YS50eXBlfSxidXR0b246ZnVuY3Rpb24oYSl7dmFyIGI9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybiBiPT09ImlucHV0IiYmImJ1dHRvbiI9PT1hLnR5cGV8fGI9PT0iYnV0dG9uIn0saW5wdXQ6ZnVuY3Rpb24oYSl7cmV0dXJuL2lucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24vaS50ZXN0KGEubm9kZU5hbWUpfSxmb2N1czpmdW5jdGlvbihhKXtyZXR1cm4gYT09PWEub3duZXJEb2N1bWVudC5hY3RpdmVFbGVtZW50fX0sc2V0RmlsdGVyczp7Zmlyc3Q6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYj09PTB9LGxhc3Q6ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIGI9PT1kLmxlbmd0aC0xfSxldmVuOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGIlMj09PTB9LG9kZDpmdW5jdGlvbihhLGIpe3JldHVybiBiJTI9PT0xfSxsdDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGI8Y1szXS0wfSxndDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGI+Y1szXS0wfSxudGg6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBjWzNdLTA9PT1ifSxlcTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGNbM10tMD09PWJ9fSxmaWx0ZXI6e1BTRVVETzpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1iWzFdLGY9bC5maWx0ZXJzW2VdO2lmKGYpcmV0dXJuIGYoYSxjLGIsZCk7aWYoZT09PSJjb250YWlucyIpcmV0dXJuKGEudGV4dENvbnRlbnR8fGEuaW5uZXJUZXh0fHxrLmdldFRleHQoW2FdKXx8IiIpLmluZGV4T2YoYlszXSk+PTA7aWYoZT09PSJub3QiKXt2YXIgZz1iWzNdO2Zvcih2YXIgaD0wLGk9Zy5sZW5ndGg7aDxpO2grKylpZihnW2hdPT09YSlyZXR1cm4hMTtyZXR1cm4hMH1rLmVycm9yKGUpfSxDSElMRDpmdW5jdGlvbihhLGIpe3ZhciBjPWJbMV0sZD1hO3N3aXRjaChjKXtjYXNlIm9ubHkiOmNhc2UiZmlyc3QiOndoaWxlKGQ9ZC5wcmV2aW91c1NpYmxpbmcpaWYoZC5ub2RlVHlwZT09PTEpcmV0dXJuITE7aWYoYz09PSJmaXJzdCIpcmV0dXJuITA7ZD1hO2Nhc2UibGFzdCI6d2hpbGUoZD1kLm5leHRTaWJsaW5nKWlmKGQubm9kZVR5cGU9PT0xKXJldHVybiExO3JldHVybiEwO2Nhc2UibnRoIjp2YXIgZT1iWzJdLGY9YlszXTtpZihlPT09MSYmZj09PTApcmV0dXJuITA7dmFyIGc9YlswXSxoPWEucGFyZW50Tm9kZTtpZihoJiYoaC5zaXpjYWNoZSE9PWd8fCFhLm5vZGVJbmRleCkpe3ZhciBpPTA7Zm9yKGQ9aC5maXJzdENoaWxkO2Q7ZD1kLm5leHRTaWJsaW5nKWQubm9kZVR5cGU9PT0xJiYoZC5ub2RlSW5kZXg9KytpKTtoLnNpemNhY2hlPWd9dmFyIGo9YS5ub2RlSW5kZXgtZjtyZXR1cm4gZT09PTA/aj09PTA6aiVlPT09MCYmai9lPj0wfX0sSUQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5ub2RlVHlwZT09PTEmJmEuZ2V0QXR0cmlidXRlKCJpZCIpPT09Yn0sVEFHOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGI9PT0iKiImJmEubm9kZVR5cGU9PT0xfHxhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1ifSxDTEFTUzpmdW5jdGlvbihhLGIpe3JldHVybigiICIrKGEuY2xhc3NOYW1lfHxhLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSkrIiAiKS5pbmRleE9mKGIpPi0xfSxBVFRSOmZ1bmN0aW9uKGEsYil7dmFyIGM9YlsxXSxkPWwuYXR0ckhhbmRsZVtjXT9sLmF0dHJIYW5kbGVbY10oYSk6YVtjXSE9bnVsbD9hW2NdOmEuZ2V0QXR0cmlidXRlKGMpLGU9ZCsiIixmPWJbMl0sZz1iWzRdO3JldHVybiBkPT1udWxsP2Y9PT0iIT0iOmY9PT0iPSI/ZT09PWc6Zj09PSIqPSI/ZS5pbmRleE9mKGcpPj0wOmY9PT0ifj0iPygiICIrZSsiICIpLmluZGV4T2YoZyk+PTA6Zz9mPT09IiE9Ij9lIT09ZzpmPT09Il49Ij9lLmluZGV4T2YoZyk9PT0wOmY9PT0iJD0iP2Uuc3Vic3RyKGUubGVuZ3RoLWcubGVuZ3RoKT09PWc6Zj09PSJ8PSI/ZT09PWd8fGUuc3Vic3RyKDAsZy5sZW5ndGgrMSk9PT1nKyItIjohMTplJiZkIT09ITF9LFBPUzpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1iWzJdLGY9bC5zZXRGaWx0ZXJzW2VdO2lmKGYpcmV0dXJuIGYoYSxjLGIsZCl9fX0sbT1sLm1hdGNoLlBPUyxuPWZ1bmN0aW9uKGEsYil7cmV0dXJuIlxcIisoYi0wKzEpfTtmb3IodmFyIG8gaW4gbC5tYXRjaClsLm1hdGNoW29dPW5ldyBSZWdFeHAobC5tYXRjaFtvXS5zb3VyY2UrLyg/IVteXFtdKlxdKSg/IVteXChdKlwpKS8uc291cmNlKSxsLmxlZnRNYXRjaFtvXT1uZXcgUmVnRXhwKC8oXig/Oi58XHJ8XG4pKj8pLy5zb3VyY2UrbC5tYXRjaFtvXS5zb3VyY2UucmVwbGFjZSgvXFwoXGQrKS9nLG4pKTt2YXIgcD1mdW5jdGlvbihhLGIpe2E9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYSwwKTtpZihiKXtiLnB1c2guYXBwbHkoYixhKTtyZXR1cm4gYn1yZXR1cm4gYX07dHJ5e0FycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGMuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXMsMClbMF0ubm9kZVR5cGV9Y2F0Y2gocSl7cD1mdW5jdGlvbihhLGIpe3ZhciBjPTAsZD1ifHxbXTtpZihlLmNhbGwoYSk9PT0iW29iamVjdCBBcnJheV0iKUFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGQsYSk7ZWxzZSBpZih0eXBlb2YgYS5sZW5ndGg9PSJudW1iZXIiKWZvcih2YXIgZj1hLmxlbmd0aDtjPGY7YysrKWQucHVzaChhW2NdKTtlbHNlIGZvcig7YVtjXTtjKyspZC5wdXNoKGFbY10pO3JldHVybiBkfX12YXIgcixzO2MuZG9jdW1lbnRFbGVtZW50LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uP3I9ZnVuY3Rpb24oYSxiKXtpZihhPT09Yil7Zz0hMDtyZXR1cm4gMH1pZighYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbnx8IWIuY29tcGFyZURvY3VtZW50UG9zaXRpb24pcmV0dXJuIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24/LTE6MTtyZXR1cm4gYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSY0Py0xOjF9OihyPWZ1bmN0aW9uKGEsYil7aWYoYT09PWIpe2c9ITA7cmV0dXJuIDB9aWYoYS5zb3VyY2VJbmRleCYmYi5zb3VyY2VJbmRleClyZXR1cm4gYS5zb3VyY2VJbmRleC1iLnNvdXJjZUluZGV4O3ZhciBjLGQsZT1bXSxmPVtdLGg9YS5wYXJlbnROb2RlLGk9Yi5wYXJlbnROb2RlLGo9aDtpZihoPT09aSlyZXR1cm4gcyhhLGIpO2lmKCFoKXJldHVybi0xO2lmKCFpKXJldHVybiAxO3doaWxlKGopZS51bnNoaWZ0KGopLGo9ai5wYXJlbnROb2RlO2o9aTt3aGlsZShqKWYudW5zaGlmdChqKSxqPWoucGFyZW50Tm9kZTtjPWUubGVuZ3RoLGQ9Zi5sZW5ndGg7Zm9yKHZhciBrPTA7azxjJiZrPGQ7aysrKWlmKGVba10hPT1mW2tdKXJldHVybiBzKGVba10sZltrXSk7cmV0dXJuIGs9PT1jP3MoYSxmW2tdLC0xKTpzKGVba10sYiwxKX0scz1mdW5jdGlvbihhLGIsYyl7aWYoYT09PWIpcmV0dXJuIGM7dmFyIGQ9YS5uZXh0U2libGluZzt3aGlsZShkKXtpZihkPT09YilyZXR1cm4tMTtkPWQubmV4dFNpYmxpbmd9cmV0dXJuIDF9KSxrLmdldFRleHQ9ZnVuY3Rpb24oYSl7dmFyIGI9IiIsYztmb3IodmFyIGQ9MDthW2RdO2QrKyljPWFbZF0sYy5ub2RlVHlwZT09PTN8fGMubm9kZVR5cGU9PT00P2IrPWMubm9kZVZhbHVlOmMubm9kZVR5cGUhPT04JiYoYis9ay5nZXRUZXh0KGMuY2hpbGROb2RlcykpO3JldHVybiBifSxmdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudCgiZGl2IiksZD0ic2NyaXB0IisobmV3IERhdGUpLmdldFRpbWUoKSxlPWMuZG9jdW1lbnRFbGVtZW50O2EuaW5uZXJIVE1MPSI8YSBuYW1lPSciK2QrIicvPiIsZS5pbnNlcnRCZWZvcmUoYSxlLmZpcnN0Q2hpbGQpLGMuZ2V0RWxlbWVudEJ5SWQoZCkmJihsLmZpbmQuSUQ9ZnVuY3Rpb24oYSxjLGQpe2lmKHR5cGVvZiBjLmdldEVsZW1lbnRCeUlkIT0idW5kZWZpbmVkIiYmIWQpe3ZhciBlPWMuZ2V0RWxlbWVudEJ5SWQoYVsxXSk7cmV0dXJuIGU/ZS5pZD09PWFbMV18fHR5cGVvZiBlLmdldEF0dHJpYnV0ZU5vZGUhPSJ1bmRlZmluZWQiJiZlLmdldEF0dHJpYnV0ZU5vZGUoImlkIikubm9kZVZhbHVlPT09YVsxXT9bZV06YjpbXX19LGwuZmlsdGVyLklEPWZ1bmN0aW9uKGEsYil7dmFyIGM9dHlwZW9mIGEuZ2V0QXR0cmlidXRlTm9kZSE9InVuZGVmaW5lZCImJmEuZ2V0QXR0cmlidXRlTm9kZSgiaWQiKTtyZXR1cm4gYS5ub2RlVHlwZT09PTEmJmMmJmMubm9kZVZhbHVlPT09Yn0pLGUucmVtb3ZlQ2hpbGQoYSksZT1hPW51bGx9KCksZnVuY3Rpb24oKXt2YXIgYT1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpO2EuYXBwZW5kQ2hpbGQoYy5jcmVhdGVDb21tZW50KCIiKSksYS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aD4wJiYobC5maW5kLlRBRz1mdW5jdGlvbihhLGIpe3ZhciBjPWIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYVsxXSk7aWYoYVsxXT09PSIqIil7dmFyIGQ9W107Zm9yKHZhciBlPTA7Y1tlXTtlKyspY1tlXS5ub2RlVHlwZT09PTEmJmQucHVzaChjW2VdKTtjPWR9cmV0dXJuIGN9KSxhLmlubmVySFRNTD0iPGEgaHJlZj0nIyc+PC9hPiIsYS5maXJzdENoaWxkJiZ0eXBlb2YgYS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSE9InVuZGVmaW5lZCImJmEuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoImhyZWYiKSE9PSIjIiYmKGwuYXR0ckhhbmRsZS5ocmVmPWZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgiaHJlZiIsMil9KSxhPW51bGx9KCksYy5xdWVyeVNlbGVjdG9yQWxsJiZmdW5jdGlvbigpe3ZhciBhPWssYj1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpLGQ9Il9fc2l6emxlX18iO2IuaW5uZXJIVE1MPSI8cCBjbGFzcz0nVEVTVCc+PC9wPiI7aWYoIWIucXVlcnlTZWxlY3RvckFsbHx8Yi5xdWVyeVNlbGVjdG9yQWxsKCIuVEVTVCIpLmxlbmd0aCE9PTApe2s9ZnVuY3Rpb24oYixlLGYsZyl7ZT1lfHxjO2lmKCFnJiYhay5pc1hNTChlKSl7dmFyIGg9L14oXHcrJCl8XlwuKFtcd1wtXSskKXxeIyhbXHdcLV0rJCkvLmV4ZWMoYik7aWYoaCYmKGUubm9kZVR5cGU9PT0xfHxlLm5vZGVUeXBlPT09OSkpe2lmKGhbMV0pcmV0dXJuIHAoZS5nZXRFbGVtZW50c0J5VGFnTmFtZShiKSxmKTtpZihoWzJdJiZsLmZpbmQuQ0xBU1MmJmUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSlyZXR1cm4gcChlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoaFsyXSksZil9aWYoZS5ub2RlVHlwZT09PTkpe2lmKGI9PT0iYm9keSImJmUuYm9keSlyZXR1cm4gcChbZS5ib2R5XSxmKTtpZihoJiZoWzNdKXt2YXIgaT1lLmdldEVsZW1lbnRCeUlkKGhbM10pO2lmKCFpfHwhaS5wYXJlbnROb2RlKXJldHVybiBwKFtdLGYpO2lmKGkuaWQ9PT1oWzNdKXJldHVybiBwKFtpXSxmKX10cnl7cmV0dXJuIHAoZS5xdWVyeVNlbGVjdG9yQWxsKGIpLGYpfWNhdGNoKGope319ZWxzZSBpZihlLm5vZGVUeXBlPT09MSYmZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIT09Im9iamVjdCIpe3ZhciBtPWUsbj1lLmdldEF0dHJpYnV0ZSgiaWQiKSxvPW58fGQscT1lLnBhcmVudE5vZGUscj0vXlxzKlsrfl0vLnRlc3QoYik7bj9vPW8ucmVwbGFjZSgvJy9nLCJcXCQmIik6ZS5zZXRBdHRyaWJ1dGUoImlkIixvKSxyJiZxJiYoZT1lLnBhcmVudE5vZGUpO3RyeXtpZighcnx8cSlyZXR1cm4gcChlLnF1ZXJ5U2VsZWN0b3JBbGwoIltpZD0nIitvKyInXSAiK2IpLGYpfWNhdGNoKHMpe31maW5hbGx5e258fG0ucmVtb3ZlQXR0cmlidXRlKCJpZCIpfX19cmV0dXJuIGEoYixlLGYsZyl9O2Zvcih2YXIgZSBpbiBhKWtbZV09YVtlXTtiPW51bGx9fSgpLGZ1bmN0aW9uKCl7dmFyIGE9Yy5kb2N1bWVudEVsZW1lbnQsYj1hLm1hdGNoZXNTZWxlY3Rvcnx8YS5tb3pNYXRjaGVzU2VsZWN0b3J8fGEud2Via2l0TWF0Y2hlc1NlbGVjdG9yfHxhLm1zTWF0Y2hlc1NlbGVjdG9yO2lmKGIpe3ZhciBkPSFiLmNhbGwoYy5jcmVhdGVFbGVtZW50KCJkaXYiKSwiZGl2IiksZT0hMTt0cnl7Yi5jYWxsKGMuZG9jdW1lbnRFbGVtZW50LCJbdGVzdCE9JyddOnNpenpsZSIpfWNhdGNoKGYpe2U9ITB9ay5tYXRjaGVzU2VsZWN0b3I9ZnVuY3Rpb24oYSxjKXtjPWMucmVwbGFjZSgvXD1ccyooW14nIlxdXSopXHMqXF0vZywiPSckMSddIik7aWYoIWsuaXNYTUwoYSkpdHJ5e2lmKGV8fCFsLm1hdGNoLlBTRVVETy50ZXN0KGMpJiYhLyE9Ly50ZXN0KGMpKXt2YXIgZj1iLmNhbGwoYSxjKTtpZihmfHwhZHx8YS5kb2N1bWVudCYmYS5kb2N1bWVudC5ub2RlVHlwZSE9PTExKXJldHVybiBmfX1jYXRjaChnKXt9cmV0dXJuIGsoYyxudWxsLG51bGwsW2FdKS5sZW5ndGg+MH19fSgpLGZ1bmN0aW9uKCl7dmFyIGE9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKTthLmlubmVySFRNTD0iPGRpdiBjbGFzcz0ndGVzdCBlJz48L2Rpdj48ZGl2IGNsYXNzPSd0ZXN0Jz48L2Rpdj4iO2lmKCEhYS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lJiZhLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImUiKS5sZW5ndGghPT0wKXthLmxhc3RDaGlsZC5jbGFzc05hbWU9ImUiO2lmKGEuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZSIpLmxlbmd0aD09PTEpcmV0dXJuO2wub3JkZXIuc3BsaWNlKDEsMCwiQ0xBU1MiKSxsLmZpbmQuQ0xBU1M9ZnVuY3Rpb24oYSxiLGMpe2lmKHR5cGVvZiBiLmdldEVsZW1lbnRzQnlDbGFzc05hbWUhPSJ1bmRlZmluZWQiJiYhYylyZXR1cm4gYi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGFbMV0pfSxhPW51bGx9fSgpLGMuZG9jdW1lbnRFbGVtZW50LmNvbnRhaW5zP2suY29udGFpbnM9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYSE9PWImJihhLmNvbnRhaW5zP2EuY29udGFpbnMoYik6ITApfTpjLmRvY3VtZW50RWxlbWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj9rLmNvbnRhaW5zPWZ1bmN0aW9uKGEsYil7cmV0dXJuISEoYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSYxNil9OmsuY29udGFpbnM9ZnVuY3Rpb24oKXtyZXR1cm4hMX0say5pc1hNTD1mdW5jdGlvbihhKXt2YXIgYj0oYT9hLm93bmVyRG9jdW1lbnR8fGE6MCkuZG9jdW1lbnRFbGVtZW50O3JldHVybiBiP2Iubm9kZU5hbWUhPT0iSFRNTCI6ITF9O3ZhciB2PWZ1bmN0aW9uKGEsYil7dmFyIGMsZD1bXSxlPSIiLGY9Yi5ub2RlVHlwZT9bYl06Yjt3aGlsZShjPWwubWF0Y2guUFNFVURPLmV4ZWMoYSkpZSs9Y1swXSxhPWEucmVwbGFjZShsLm1hdGNoLlBTRVVETywiIik7YT1sLnJlbGF0aXZlW2FdP2ErIioiOmE7Zm9yKHZhciBnPTAsaD1mLmxlbmd0aDtnPGg7ZysrKWsoYSxmW2ddLGQpO3JldHVybiBrLmZpbHRlcihlLGQpfTtmLmZpbmQ9ayxmLmV4cHI9ay5zZWxlY3RvcnMsZi5leHByWyI6Il09Zi5leHByLmZpbHRlcnMsZi51bmlxdWU9ay51bmlxdWVTb3J0LGYudGV4dD1rLmdldFRleHQsZi5pc1hNTERvYz1rLmlzWE1MLGYuY29udGFpbnM9ay5jb250YWluc30oKTt2YXIgTz0vVW50aWwkLyxQPS9eKD86cGFyZW50c3xwcmV2VW50aWx8cHJldkFsbCkvLFE9LywvLFI9L14uW146I1xbXC4sXSokLyxTPUFycmF5LnByb3RvdHlwZS5zbGljZSxUPWYuZXhwci5tYXRjaC5QT1MsVT17Y2hpbGRyZW46ITAsY29udGVudHM6ITAsbmV4dDohMCxwcmV2OiEwfTtmLmZuLmV4dGVuZCh7ZmluZDpmdW5jdGlvbihhKXt2YXIgYj10aGlzLGMsZDtpZih0eXBlb2YgYSE9InN0cmluZyIpcmV0dXJuIGYoYSkuZmlsdGVyKGZ1bmN0aW9uKCl7Zm9yKGM9MCxkPWIubGVuZ3RoO2M8ZDtjKyspaWYoZi5jb250YWlucyhiW2NdLHRoaXMpKXJldHVybiEwfSk7dmFyIGU9dGhpcy5wdXNoU3RhY2soIiIsImZpbmQiLGEpLGcsaCxpO2ZvcihjPTAsZD10aGlzLmxlbmd0aDtjPGQ7YysrKXtnPWUubGVuZ3RoLGYuZmluZChhLHRoaXNbY10sZSk7aWYoYz4wKWZvcihoPWc7aDxlLmxlbmd0aDtoKyspZm9yKGk9MDtpPGc7aSsrKWlmKGVbaV09PT1lW2hdKXtlLnNwbGljZShoLS0sMSk7YnJlYWt9fXJldHVybiBlfSxoYXM6ZnVuY3Rpb24oYSl7dmFyIGI9ZihhKTtyZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24oKXtmb3IodmFyIGE9MCxjPWIubGVuZ3RoO2E8YzthKyspaWYoZi5jb250YWlucyh0aGlzLGJbYV0pKXJldHVybiEwfSl9LG5vdDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2soVyh0aGlzLGEsITEpLCJub3QiLGEpfSxmaWx0ZXI6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKFcodGhpcyxhLCEwKSwiZmlsdGVyIixhKX0saXM6ZnVuY3Rpb24oYSl7cmV0dXJuISFhJiYodHlwZW9mIGE9PSJzdHJpbmciP2YuZmlsdGVyKGEsdGhpcykubGVuZ3RoPjA6dGhpcy5maWx0ZXIoYSkubGVuZ3RoPjApfSxjbG9zZXN0OmZ1bmN0aW9uKGEsYil7dmFyIGM9W10sZCxlLGc9dGhpc1swXTtpZihmLmlzQXJyYXkoYSkpe3ZhciBoLGksaj17fSxrPTE7aWYoZyYmYS5sZW5ndGgpe2ZvcihkPTAsZT1hLmxlbmd0aDtkPGU7ZCsrKWk9YVtkXSxqW2ldfHwoaltpXT1ULnRlc3QoaSk/ZihpLGJ8fHRoaXMuY29udGV4dCk6aSk7d2hpbGUoZyYmZy5vd25lckRvY3VtZW50JiZnIT09Yil7Zm9yKGkgaW4gailoPWpbaV0sKGguanF1ZXJ5P2guaW5kZXgoZyk+LTE6ZihnKS5pcyhoKSkmJmMucHVzaCh7c2VsZWN0b3I6aSxlbGVtOmcsbGV2ZWw6a30pO2c9Zy5wYXJlbnROb2RlLGsrK319cmV0dXJuIGN9dmFyIGw9VC50ZXN0KGEpfHx0eXBlb2YgYSE9InN0cmluZyI/ZihhLGJ8fHRoaXMuY29udGV4dCk6MDtmb3IoZD0wLGU9dGhpcy5sZW5ndGg7ZDxlO2QrKyl7Zz10aGlzW2RdO3doaWxlKGcpe2lmKGw/bC5pbmRleChnKT4tMTpmLmZpbmQubWF0Y2hlc1NlbGVjdG9yKGcsYSkpe2MucHVzaChnKTticmVha31nPWcucGFyZW50Tm9kZTtpZighZ3x8IWcub3duZXJEb2N1bWVudHx8Zz09PWJ8fGcubm9kZVR5cGU9PT0xMSlicmVha319Yz1jLmxlbmd0aD4xP2YudW5pcXVlKGMpOmM7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGMsImNsb3Nlc3QiLGEpfSxpbmRleDpmdW5jdGlvbihhKXtpZighYXx8dHlwZW9mIGE9PSJzdHJpbmciKXJldHVybiBmLmluQXJyYXkodGhpc1swXSxhP2YoYSk6dGhpcy5wYXJlbnQoKS5jaGlsZHJlbigpKTtyZXR1cm4gZi5pbkFycmF5KGEuanF1ZXJ5P2FbMF06YSx0aGlzKX0sYWRkOmZ1bmN0aW9uKGEsYil7dmFyIGM9dHlwZW9mIGE9PSJzdHJpbmciP2YoYSxiKTpmLm1ha2VBcnJheShhJiZhLm5vZGVUeXBlP1thXTphKSxkPWYubWVyZ2UodGhpcy5nZXQoKSxjKTtyZXR1cm4gdGhpcy5wdXNoU3RhY2soVihjWzBdKXx8VihkWzBdKT9kOmYudW5pcXVlKGQpKX0sYW5kU2VsZjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmFkZCh0aGlzLnByZXZPYmplY3QpfX0pLGYuZWFjaCh7cGFyZW50OmZ1bmN0aW9uKGEpe3ZhciBiPWEucGFyZW50Tm9kZTtyZXR1cm4gYiYmYi5ub2RlVHlwZSE9PTExP2I6bnVsbH0scGFyZW50czpmdW5jdGlvbihhKXtyZXR1cm4gZi5kaXIoYSwicGFyZW50Tm9kZSIpfSxwYXJlbnRzVW50aWw6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmLmRpcihhLCJwYXJlbnROb2RlIixjKX0sbmV4dDpmdW5jdGlvbihhKXtyZXR1cm4gZi5udGgoYSwyLCJuZXh0U2libGluZyIpfSxwcmV2OmZ1bmN0aW9uKGEpe3JldHVybiBmLm50aChhLDIsInByZXZpb3VzU2libGluZyIpfSxuZXh0QWxsOmZ1bmN0aW9uKGEpe3JldHVybiBmLmRpcihhLCJuZXh0U2libGluZyIpfSxwcmV2QWxsOmZ1bmN0aW9uKGEpe3JldHVybiBmLmRpcihhLCJwcmV2aW91c1NpYmxpbmciKX0sbmV4dFVudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZi5kaXIoYSwibmV4dFNpYmxpbmciLGMpfSxwcmV2VW50aWw6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmLmRpcihhLCJwcmV2aW91c1NpYmxpbmciLGMpfSxzaWJsaW5nczpmdW5jdGlvbihhKXtyZXR1cm4gZi5zaWJsaW5nKGEucGFyZW50Tm9kZS5maXJzdENoaWxkLGEpfSxjaGlsZHJlbjpmdW5jdGlvbihhKXtyZXR1cm4gZi5zaWJsaW5nKGEuZmlyc3RDaGlsZCl9LGNvbnRlbnRzOmZ1bmN0aW9uKGEpe3JldHVybiBmLm5vZGVOYW1lKGEsImlmcmFtZSIpP2EuY29udGVudERvY3VtZW50fHxhLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ6Zi5tYWtlQXJyYXkoYS5jaGlsZE5vZGVzKX19LGZ1bmN0aW9uKGEsYil7Zi5mblthXT1mdW5jdGlvbihjLGQpe3ZhciBlPWYubWFwKHRoaXMsYixjKSxnPVMuY2FsbChhcmd1bWVudHMpO08udGVzdChhKXx8KGQ9YyksZCYmdHlwZW9mIGQ9PSJzdHJpbmciJiYoZT1mLmZpbHRlcihkLGUpKSxlPXRoaXMubGVuZ3RoPjEmJiFVW2FdP2YudW5pcXVlKGUpOmUsKHRoaXMubGVuZ3RoPjF8fFEudGVzdChkKSkmJlAudGVzdChhKSYmKGU9ZS5yZXZlcnNlKCkpO3JldHVybiB0aGlzLnB1c2hTdGFjayhlLGEsZy5qb2luKCIsIikpfX0pLGYuZXh0ZW5kKHtmaWx0ZXI6ZnVuY3Rpb24oYSxiLGMpe2MmJihhPSI6bm90KCIrYSsiKSIpO3JldHVybiBiLmxlbmd0aD09PTE/Zi5maW5kLm1hdGNoZXNTZWxlY3RvcihiWzBdLGEpP1tiWzBdXTpbXTpmLmZpbmQubWF0Y2hlcyhhLGIpfSxkaXI6ZnVuY3Rpb24oYSxjLGQpe3ZhciBlPVtdLGc9YVtjXTt3aGlsZShnJiZnLm5vZGVUeXBlIT09OSYmKGQ9PT1ifHxnLm5vZGVUeXBlIT09MXx8IWYoZykuaXMoZCkpKWcubm9kZVR5cGU9PT0xJiZlLnB1c2goZyksZz1nW2NdO3JldHVybiBlfSxudGg6ZnVuY3Rpb24oYSxiLGMsZCl7Yj1ifHwxO3ZhciBlPTA7Zm9yKDthO2E9YVtjXSlpZihhLm5vZGVUeXBlPT09MSYmKytlPT09YilicmVhaztyZXR1cm4gYX0sc2libGluZzpmdW5jdGlvbihhLGIpe3ZhciBjPVtdO2Zvcig7YTthPWEubmV4dFNpYmxpbmcpYS5ub2RlVHlwZT09PTEmJmEhPT1iJiZjLnB1c2goYSk7cmV0dXJuIGN9fSk7dmFyIFg9LyBqUXVlcnlcZCs9Iig/OlxkK3xudWxsKSIvZyxZPS9eXHMrLyxaPS88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFtcdzpdKylbXj5dKilcLz4vaWcsJD0vPChbXHc6XSspLyxfPS88dGJvZHkvaSxiYT0vPHwmIz9cdys7LyxiYj0vPCg/OnNjcmlwdHxvYmplY3R8ZW1iZWR8b3B0aW9ufHN0eWxlKS9pLGJjPS9jaGVja2VkXHMqKD86W149XXw9XHMqLmNoZWNrZWQuKS9pLGJkPS9cLyhqYXZhfGVjbWEpc2NyaXB0L2ksYmU9L15ccyo8ISg/OlxbQ0RBVEFcW3xcLVwtKS8sYmY9e29wdGlvbjpbMSwiPHNlbGVjdCBtdWx0aXBsZT0nbXVsdGlwbGUnPiIsIjwvc2VsZWN0PiJdLGxlZ2VuZDpbMSwiPGZpZWxkc2V0PiIsIjwvZmllbGRzZXQ+Il0sdGhlYWQ6WzEsIjx0YWJsZT4iLCI8L3RhYmxlPiJdLHRyOlsyLCI8dGFibGU+PHRib2R5PiIsIjwvdGJvZHk+PC90YWJsZT4iXSx0ZDpbMywiPHRhYmxlPjx0Ym9keT48dHI+IiwiPC90cj48L3Rib2R5PjwvdGFibGU+Il0sY29sOlsyLCI8dGFibGU+PHRib2R5PjwvdGJvZHk+PGNvbGdyb3VwPiIsIjwvY29sZ3JvdXA+PC90YWJsZT4iXSxhcmVhOlsxLCI8bWFwPiIsIjwvbWFwPiJdLF9kZWZhdWx0OlswLCIiLCIiXX07YmYub3B0Z3JvdXA9YmYub3B0aW9uLGJmLnRib2R5PWJmLnRmb290PWJmLmNvbGdyb3VwPWJmLmNhcHRpb249YmYudGhlYWQsYmYudGg9YmYudGQsZi5zdXBwb3J0Lmh0bWxTZXJpYWxpemV8fChiZi5fZGVmYXVsdD1bMSwiZGl2PGRpdj4iLCI8L2Rpdj4iXSksZi5mbi5leHRlbmQoe3RleHQ6ZnVuY3Rpb24oYSl7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7dmFyIGM9Zih0aGlzKTtjLnRleHQoYS5jYWxsKHRoaXMsYixjLnRleHQoKSkpfSk7aWYodHlwZW9mIGEhPSJvYmplY3QiJiZhIT09YilyZXR1cm4gdGhpcy5lbXB0eSgpLmFwcGVuZCgodGhpc1swXSYmdGhpc1swXS5vd25lckRvY3VtZW50fHxjKS5jcmVhdGVUZXh0Tm9kZShhKSk7cmV0dXJuIGYudGV4dCh0aGlzKX0sd3JhcEFsbDpmdW5jdGlvbihhKXtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmKHRoaXMpLndyYXBBbGwoYS5jYWxsKHRoaXMsYikpfSk7aWYodGhpc1swXSl7dmFyIGI9ZihhLHRoaXNbMF0ub3duZXJEb2N1bWVudCkuZXEoMCkuY2xvbmUoITApO3RoaXNbMF0ucGFyZW50Tm9kZSYmYi5pbnNlcnRCZWZvcmUodGhpc1swXSksYi5tYXAoZnVuY3Rpb24oKXt2YXIgYT10aGlzO3doaWxlKGEuZmlyc3RDaGlsZCYmYS5maXJzdENoaWxkLm5vZGVUeXBlPT09MSlhPWEuZmlyc3RDaGlsZDtyZXR1cm4gYX0pLmFwcGVuZCh0aGlzKX1yZXR1cm4gdGhpc30sd3JhcElubmVyOmZ1bmN0aW9uKGEpe2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe2YodGhpcykud3JhcElubmVyKGEuY2FsbCh0aGlzLGIpKX0pO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1mKHRoaXMpLGM9Yi5jb250ZW50cygpO2MubGVuZ3RoP2Mud3JhcEFsbChhKTpiLmFwcGVuZChhKX0pfSx3cmFwOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmKHRoaXMpLndyYXBBbGwoYSl9KX0sdW53cmFwOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucGFyZW50KCkuZWFjaChmdW5jdGlvbigpe2Yubm9kZU5hbWUodGhpcywiYm9keSIpfHxmKHRoaXMpLnJlcGxhY2VXaXRoKHRoaXMuY2hpbGROb2Rlcyl9KS5lbmQoKX0sYXBwZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCEwLGZ1bmN0aW9uKGEpe3RoaXMubm9kZVR5cGU9PT0xJiZ0aGlzLmFwcGVuZENoaWxkKGEpfSl9LHByZXBlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITAsZnVuY3Rpb24oYSl7dGhpcy5ub2RlVHlwZT09PTEmJnRoaXMuaW5zZXJ0QmVmb3JlKGEsdGhpcy5maXJzdENoaWxkKX0pfSxiZWZvcmU6ZnVuY3Rpb24oKXtpZih0aGlzWzBdJiZ0aGlzWzBdLnBhcmVudE5vZGUpcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCExLGZ1bmN0aW9uKGEpe3RoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSx0aGlzKX0pO2lmKGFyZ3VtZW50cy5sZW5ndGgpe3ZhciBhPWYoYXJndW1lbnRzWzBdKTthLnB1c2guYXBwbHkoYSx0aGlzLnRvQXJyYXkoKSk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGEsImJlZm9yZSIsYXJndW1lbnRzKX19LGFmdGVyOmZ1bmN0aW9uKCl7aWYodGhpc1swXSYmdGhpc1swXS5wYXJlbnROb2RlKXJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMSxmdW5jdGlvbihhKXt0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsdGhpcy5uZXh0U2libGluZyl9KTtpZihhcmd1bWVudHMubGVuZ3RoKXt2YXIgYT10aGlzLnB1c2hTdGFjayh0aGlzLCJhZnRlciIsYXJndW1lbnRzKTthLnB1c2guYXBwbHkoYSxmKGFyZ3VtZW50c1swXSkudG9BcnJheSgpKTtyZXR1cm4gYX19LHJlbW92ZTpmdW5jdGlvbihhLGIpe2Zvcih2YXIgYz0wLGQ7KGQ9dGhpc1tjXSkhPW51bGw7YysrKWlmKCFhfHxmLmZpbHRlcihhLFtkXSkubGVuZ3RoKSFiJiZkLm5vZGVUeXBlPT09MSYmKGYuY2xlYW5EYXRhKGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSksZi5jbGVhbkRhdGEoW2RdKSksZC5wYXJlbnROb2RlJiZkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZCk7cmV0dXJuIHRoaXN9LGVtcHR5OmZ1bmN0aW9uKCl7Zm9yKHZhciBhPTAsYjsoYj10aGlzW2FdKSE9bnVsbDthKyspe2Iubm9kZVR5cGU9PT0xJiZmLmNsZWFuRGF0YShiLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikpO3doaWxlKGIuZmlyc3RDaGlsZCliLnJlbW92ZUNoaWxkKGIuZmlyc3RDaGlsZCl9cmV0dXJuIHRoaXN9LGNsb25lOmZ1bmN0aW9uKGEsYil7YT1hPT1udWxsPyExOmEsYj1iPT1udWxsP2E6YjtyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gZi5jbG9uZSh0aGlzLGEsYil9KX0saHRtbDpmdW5jdGlvbihhKXtpZihhPT09YilyZXR1cm4gdGhpc1swXSYmdGhpc1swXS5ub2RlVHlwZT09PTE/dGhpc1swXS5pbm5lckhUTUwucmVwbGFjZShYLCIiKTpudWxsO2lmKHR5cGVvZiBhPT0ic3RyaW5nIiYmIWJiLnRlc3QoYSkmJihmLnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2V8fCFZLnRlc3QoYSkpJiYhYmZbKCQuZXhlYyhhKXx8WyIiLCIiXSlbMV0udG9Mb3dlckNhc2UoKV0pe2E9YS5yZXBsYWNlKFosIjwkMT48LyQyPiIpO3RyeXtmb3IodmFyIGM9MCxkPXRoaXMubGVuZ3RoO2M8ZDtjKyspdGhpc1tjXS5ub2RlVHlwZT09PTEmJihmLmNsZWFuRGF0YSh0aGlzW2NdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikpLHRoaXNbY10uaW5uZXJIVE1MPWEpfWNhdGNoKGUpe3RoaXMuZW1wdHkoKS5hcHBlbmQoYSl9fWVsc2UgZi5pc0Z1bmN0aW9uKGEpP3RoaXMuZWFjaChmdW5jdGlvbihiKXt2YXIgYz1mKHRoaXMpO2MuaHRtbChhLmNhbGwodGhpcyxiLGMuaHRtbCgpKSl9KTp0aGlzLmVtcHR5KCkuYXBwZW5kKGEpO3JldHVybiB0aGlzfSxyZXBsYWNlV2l0aDpmdW5jdGlvbihhKXtpZih0aGlzWzBdJiZ0aGlzWzBdLnBhcmVudE5vZGUpe2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWYodGhpcyksZD1jLmh0bWwoKTtjLnJlcGxhY2VXaXRoKGEuY2FsbCh0aGlzLGIsZCkpfSk7dHlwZW9mIGEhPSJzdHJpbmciJiYoYT1mKGEpLmRldGFjaCgpKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5uZXh0U2libGluZyxjPXRoaXMucGFyZW50Tm9kZTtmKHRoaXMpLnJlbW92ZSgpLGI/ZihiKS5iZWZvcmUoYSk6ZihjKS5hcHBlbmQoYSl9KX1yZXR1cm4gdGhpcy5sZW5ndGg/dGhpcy5wdXNoU3RhY2soZihmLmlzRnVuY3Rpb24oYSk/YSgpOmEpLCJyZXBsYWNlV2l0aCIsYSk6dGhpc30sZGV0YWNoOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnJlbW92ZShhLCEwKX0sZG9tTWFuaXA6ZnVuY3Rpb24oYSxjLGQpe3ZhciBlLGcsaCxpLGo9YVswXSxrPVtdO2lmKCFmLnN1cHBvcnQuY2hlY2tDbG9uZSYmYXJndW1lbnRzLmxlbmd0aD09PTMmJnR5cGVvZiBqPT0ic3RyaW5nIiYmYmMudGVzdChqKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zih0aGlzKS5kb21NYW5pcChhLGMsZCwhMCl9KTtpZihmLmlzRnVuY3Rpb24oaikpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihlKXt2YXIgZz1mKHRoaXMpO2FbMF09ai5jYWxsKHRoaXMsZSxjP2cuaHRtbCgpOmIpLGcuZG9tTWFuaXAoYSxjLGQpfSk7aWYodGhpc1swXSl7aT1qJiZqLnBhcmVudE5vZGUsZi5zdXBwb3J0LnBhcmVudE5vZGUmJmkmJmkubm9kZVR5cGU9PT0xMSYmaS5jaGlsZE5vZGVzLmxlbmd0aD09PXRoaXMubGVuZ3RoP2U9e2ZyYWdtZW50Oml9OmU9Zi5idWlsZEZyYWdtZW50KGEsdGhpcyxrKSxoPWUuZnJhZ21lbnQsaC5jaGlsZE5vZGVzLmxlbmd0aD09PTE/Zz1oPWguZmlyc3RDaGlsZDpnPWguZmlyc3RDaGlsZDtpZihnKXtjPWMmJmYubm9kZU5hbWUoZywidHIiKTtmb3IodmFyIGw9MCxtPXRoaXMubGVuZ3RoLG49bS0xO2w8bTtsKyspZC5jYWxsKGM/YmcodGhpc1tsXSxnKTp0aGlzW2xdLGUuY2FjaGVhYmxlfHxtPjEmJmw8bj9mLmNsb25lKGgsITAsITApOmgpfWsubGVuZ3RoJiZmLmVhY2goayxibSl9cmV0dXJuIHRoaXN9fSksZi5idWlsZEZyYWdtZW50PWZ1bmN0aW9uKGEsYixkKXt2YXIgZSxnLGgsaTtiJiZiWzBdJiYoaT1iWzBdLm93bmVyRG9jdW1lbnR8fGJbMF0pLGkuY3JlYXRlRG9jdW1lbnRGcmFnbWVudHx8KGk9YyksYS5sZW5ndGg9PT0xJiZ0eXBlb2YgYVswXT09InN0cmluZyImJmFbMF0ubGVuZ3RoPDUxMiYmaT09PWMmJmFbMF0uY2hhckF0KDApPT09IjwiJiYhYmIudGVzdChhWzBdKSYmKGYuc3VwcG9ydC5jaGVja0Nsb25lfHwhYmMudGVzdChhWzBdKSkmJihnPSEwLGg9Zi5mcmFnbWVudHNbYVswXV0saCYmaCE9PTEmJihlPWgpKSxlfHwoZT1pLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSxmLmNsZWFuKGEsaSxlLGQpKSxnJiYoZi5mcmFnbWVudHNbYVswXV09aD9lOjEpO3JldHVybntmcmFnbWVudDplLGNhY2hlYWJsZTpnfX0sZi5mcmFnbWVudHM9e30sZi5lYWNoKHthcHBlbmRUbzoiYXBwZW5kIixwcmVwZW5kVG86InByZXBlbmQiLGluc2VydEJlZm9yZToiYmVmb3JlIixpbnNlcnRBZnRlcjoiYWZ0ZXIiLHJlcGxhY2VBbGw6InJlcGxhY2VXaXRoIn0sZnVuY3Rpb24oYSxiKXtmLmZuW2FdPWZ1bmN0aW9uKGMpe3ZhciBkPVtdLGU9ZihjKSxnPXRoaXMubGVuZ3RoPT09MSYmdGhpc1swXS5wYXJlbnROb2RlO2lmKGcmJmcubm9kZVR5cGU9PT0xMSYmZy5jaGlsZE5vZGVzLmxlbmd0aD09PTEmJmUubGVuZ3RoPT09MSl7ZVtiXSh0aGlzWzBdKTtyZXR1cm4gdGhpc31mb3IodmFyIGg9MCxpPWUubGVuZ3RoO2g8aTtoKyspe3ZhciBqPShoPjA/dGhpcy5jbG9uZSghMCk6dGhpcykuZ2V0KCk7ZihlW2hdKVtiXShqKSxkPWQuY29uY2F0KGopfXJldHVybiB0aGlzLnB1c2hTdGFjayhkLGEsZS5zZWxlY3Rvcil9fSksZi5leHRlbmQoe2Nsb25lOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD1hLmNsb25lTm9kZSghMCksZSxnLGg7aWYoKCFmLnN1cHBvcnQubm9DbG9uZUV2ZW50fHwhZi5zdXBwb3J0Lm5vQ2xvbmVDaGVja2VkKSYmKGEubm9kZVR5cGU9PT0xfHxhLm5vZGVUeXBlPT09MTEpJiYhZi5pc1hNTERvYyhhKSl7YmkoYSxkKSxlPWJqKGEpLGc9YmooZCk7Zm9yKGg9MDtlW2hdOysraCliaShlW2hdLGdbaF0pfWlmKGIpe2JoKGEsZCk7aWYoYyl7ZT1iaihhKSxnPWJqKGQpO2ZvcihoPTA7ZVtoXTsrK2gpYmgoZVtoXSxnW2hdKX19ZT1nPW51bGw7cmV0dXJuIGR9LGNsZWFuOmZ1bmN0aW9uKGEsYixkLGUpe3ZhciBnO2I9Ynx8Yyx0eXBlb2YgYi5jcmVhdGVFbGVtZW50PT0idW5kZWZpbmVkIiYmKGI9Yi5vd25lckRvY3VtZW50fHxiWzBdJiZiWzBdLm93bmVyRG9jdW1lbnR8fGMpO3ZhciBoPVtdLGk7Zm9yKHZhciBqPTAsazsoaz1hW2pdKSE9bnVsbDtqKyspe3R5cGVvZiBrPT0ibnVtYmVyIiYmKGsrPSIiKTtpZighayljb250aW51ZTtpZih0eXBlb2Ygaz09InN0cmluZyIpaWYoIWJhLnRlc3Qoaykpaz1iLmNyZWF0ZVRleHROb2RlKGspO2Vsc2V7az1rLnJlcGxhY2UoWiwiPCQxPjwvJDI+Iik7dmFyIGw9KCQuZXhlYyhrKXx8WyIiLCIiXSlbMV0udG9Mb3dlckNhc2UoKSxtPWJmW2xdfHxiZi5fZGVmYXVsdCxuPW1bMF0sbz1iLmNyZWF0ZUVsZW1lbnQoImRpdiIpO28uaW5uZXJIVE1MPW1bMV0rayttWzJdO3doaWxlKG4tLSlvPW8ubGFzdENoaWxkO2lmKCFmLnN1cHBvcnQudGJvZHkpe3ZhciBwPV8udGVzdChrKSxxPWw9PT0idGFibGUiJiYhcD9vLmZpcnN0Q2hpbGQmJm8uZmlyc3RDaGlsZC5jaGlsZE5vZGVzOm1bMV09PT0iPHRhYmxlPiImJiFwP28uY2hpbGROb2RlczpbXTtmb3IoaT1xLmxlbmd0aC0xO2k+PTA7LS1pKWYubm9kZU5hbWUocVtpXSwidGJvZHkiKSYmIXFbaV0uY2hpbGROb2Rlcy5sZW5ndGgmJnFbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChxW2ldKX0hZi5zdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlJiZZLnRlc3QoaykmJm8uaW5zZXJ0QmVmb3JlKGIuY3JlYXRlVGV4dE5vZGUoWS5leGVjKGspWzBdKSxvLmZpcnN0Q2hpbGQpLGs9by5jaGlsZE5vZGVzfXZhciByO2lmKCFmLnN1cHBvcnQuYXBwZW5kQ2hlY2tlZClpZihrWzBdJiZ0eXBlb2Yocj1rLmxlbmd0aCk9PSJudW1iZXIiKWZvcihpPTA7aTxyO2krKylibChrW2ldKTtlbHNlIGJsKGspO2subm9kZVR5cGU/aC5wdXNoKGspOmg9Zi5tZXJnZShoLGspfWlmKGQpe2c9ZnVuY3Rpb24oYSl7cmV0dXJuIWEudHlwZXx8YmQudGVzdChhLnR5cGUpfTtmb3Ioaj0wO2hbal07aisrKWlmKGUmJmYubm9kZU5hbWUoaFtqXSwic2NyaXB0IikmJighaFtqXS50eXBlfHxoW2pdLnR5cGUudG9Mb3dlckNhc2UoKT09PSJ0ZXh0L2phdmFzY3JpcHQiKSllLnB1c2goaFtqXS5wYXJlbnROb2RlP2hbal0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChoW2pdKTpoW2pdKTtlbHNle2lmKGhbal0ubm9kZVR5cGU9PT0xKXt2YXIgcz1mLmdyZXAoaFtqXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IiksZyk7aC5zcGxpY2UuYXBwbHkoaCxbaisxLDBdLmNvbmNhdChzKSl9ZC5hcHBlbmRDaGlsZChoW2pdKX19cmV0dXJuIGh9LGNsZWFuRGF0YTpmdW5jdGlvbihhKXt2YXIgYixjLGQ9Zi5jYWNoZSxlPWYuZXhwYW5kbyxnPWYuZXZlbnQuc3BlY2lhbCxoPWYuc3VwcG9ydC5kZWxldGVFeHBhbmRvO2Zvcih2YXIgaT0wLGo7KGo9YVtpXSkhPW51bGw7aSsrKXtpZihqLm5vZGVOYW1lJiZmLm5vRGF0YVtqLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKWNvbnRpbnVlO2M9altmLmV4cGFuZG9dO2lmKGMpe2I9ZFtjXSYmZFtjXVtlXTtpZihiJiZiLmV2ZW50cyl7Zm9yKHZhciBrIGluIGIuZXZlbnRzKWdba10/Zi5ldmVudC5yZW1vdmUoaixrKTpmLnJlbW92ZUV2ZW50KGosayxiLmhhbmRsZSk7Yi5oYW5kbGUmJihiLmhhbmRsZS5lbGVtPW51bGwpfWg/ZGVsZXRlIGpbZi5leHBhbmRvXTpqLnJlbW92ZUF0dHJpYnV0ZSYmai5yZW1vdmVBdHRyaWJ1dGUoZi5leHBhbmRvKSxkZWxldGUgZFtjXX19fX0pO3ZhciBibj0vYWxwaGFcKFteKV0qXCkvaSxibz0vb3BhY2l0eT0oW14pXSopLyxicD0vKFtBLVpdfF5tcykvZyxicT0vXi0/XGQrKD86cHgpPyQvaSxicj0vXi0/XGQvLGJzPS9eWytcLV09LyxidD0vW14rXC1cLlxkZV0rL2csYnU9e3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdmlzaWJpbGl0eToiaGlkZGVuIixkaXNwbGF5OiJibG9jayJ9LGJ2PVsiTGVmdCIsIlJpZ2h0Il0sYnc9WyJUb3AiLCJCb3R0b20iXSxieCxieSxiejtmLmZuLmNzcz1mdW5jdGlvbihhLGMpe2lmKGFyZ3VtZW50cy5sZW5ndGg9PT0yJiZjPT09YilyZXR1cm4gdGhpcztyZXR1cm4gZi5hY2Nlc3ModGhpcyxhLGMsITAsZnVuY3Rpb24oYSxjLGQpe3JldHVybiBkIT09Yj9mLnN0eWxlKGEsYyxkKTpmLmNzcyhhLGMpfSl9LGYuZXh0ZW5kKHtjc3NIb29rczp7b3BhY2l0eTp7Z2V0OmZ1bmN0aW9uKGEsYil7aWYoYil7dmFyIGM9YngoYSwib3BhY2l0eSIsIm9wYWNpdHkiKTtyZXR1cm4gYz09PSIiPyIxIjpjfXJldHVybiBhLnN0eWxlLm9wYWNpdHl9fX0sY3NzTnVtYmVyOntmaWxsT3BhY2l0eTohMCxmb250V2VpZ2h0OiEwLGxpbmVIZWlnaHQ6ITAsb3BhY2l0eTohMCxvcnBoYW5zOiEwLHdpZG93czohMCx6SW5kZXg6ITAsem9vbTohMH0sY3NzUHJvcHM6eyJmbG9hdCI6Zi5zdXBwb3J0LmNzc0Zsb2F0PyJjc3NGbG9hdCI6InN0eWxlRmxvYXQifSxzdHlsZTpmdW5jdGlvbihhLGMsZCxlKXtpZighIWEmJmEubm9kZVR5cGUhPT0zJiZhLm5vZGVUeXBlIT09OCYmISFhLnN0eWxlKXt2YXIgZyxoLGk9Zi5jYW1lbENhc2UoYyksaj1hLnN0eWxlLGs9Zi5jc3NIb29rc1tpXTtjPWYuY3NzUHJvcHNbaV18fGk7aWYoZD09PWIpe2lmKGsmJiJnZXQiaW4gayYmKGc9ay5nZXQoYSwhMSxlKSkhPT1iKXJldHVybiBnO3JldHVybiBqW2NdfWg9dHlwZW9mIGQ7aWYoaD09PSJudW1iZXIiJiZpc05hTihkKXx8ZD09bnVsbClyZXR1cm47aD09PSJzdHJpbmciJiZicy50ZXN0KGQpJiYoZD0rZC5yZXBsYWNlKGJ0LCIiKStwYXJzZUZsb2F0KGYuY3NzKGEsYykpLGg9Im51bWJlciIpLGg9PT0ibnVtYmVyIiYmIWYuY3NzTnVtYmVyW2ldJiYoZCs9InB4Iik7aWYoIWt8fCEoInNldCJpbiBrKXx8KGQ9ay5zZXQoYSxkKSkhPT1iKXRyeXtqW2NdPWR9Y2F0Y2gobCl7fX19LGNzczpmdW5jdGlvbihhLGMsZCl7dmFyIGUsZztjPWYuY2FtZWxDYXNlKGMpLGc9Zi5jc3NIb29rc1tjXSxjPWYuY3NzUHJvcHNbY118fGMsYz09PSJjc3NGbG9hdCImJihjPSJmbG9hdCIpO2lmKGcmJiJnZXQiaW4gZyYmKGU9Zy5nZXQoYSwhMCxkKSkhPT1iKXJldHVybiBlO2lmKGJ4KXJldHVybiBieChhLGMpfSxzd2FwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD17fTtmb3IodmFyIGUgaW4gYilkW2VdPWEuc3R5bGVbZV0sYS5zdHlsZVtlXT1iW2VdO2MuY2FsbChhKTtmb3IoZSBpbiBiKWEuc3R5bGVbZV09ZFtlXX19KSxmLmN1ckNTUz1mLmNzcyxmLmVhY2goWyJoZWlnaHQiLCJ3aWR0aCJdLGZ1bmN0aW9uKGEsYil7Zi5jc3NIb29rc1tiXT17Z2V0OmZ1bmN0aW9uKGEsYyxkKXt2YXIgZTtpZihjKXtpZihhLm9mZnNldFdpZHRoIT09MClyZXR1cm4gYkEoYSxiLGQpO2Yuc3dhcChhLGJ1LGZ1bmN0aW9uKCl7ZT1iQShhLGIsZCl9KTtyZXR1cm4gZX19LHNldDpmdW5jdGlvbihhLGIpe2lmKCFicS50ZXN0KGIpKXJldHVybiBiO2I9cGFyc2VGbG9hdChiKTtpZihiPj0wKXJldHVybiBiKyJweCJ9fX0pLGYuc3VwcG9ydC5vcGFjaXR5fHwoZi5jc3NIb29rcy5vcGFjaXR5PXtnZXQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYm8udGVzdCgoYiYmYS5jdXJyZW50U3R5bGU/YS5jdXJyZW50U3R5bGUuZmlsdGVyOmEuc3R5bGUuZmlsdGVyKXx8IiIpP3BhcnNlRmxvYXQoUmVnRXhwLiQxKS8xMDArIiI6Yj8iMSI6IiJ9LHNldDpmdW5jdGlvbihhLGIpe3ZhciBjPWEuc3R5bGUsZD1hLmN1cnJlbnRTdHlsZTtjLnpvb209MTt2YXIgZT1mLmlzTmFOKGIpPyIiOiJhbHBoYShvcGFjaXR5PSIrYioxMDArIikiLGc9ZCYmZC5maWx0ZXJ8fGMuZmlsdGVyfHwiIjtjLmZpbHRlcj1ibi50ZXN0KGcpP2cucmVwbGFjZShibixlKTpnKyIgIitlfX0pLGYoZnVuY3Rpb24oKXtmLnN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodHx8KGYuY3NzSG9va3MubWFyZ2luUmlnaHQ9e2dldDpmdW5jdGlvbihhLGIpe3ZhciBjO2Yuc3dhcChhLHtkaXNwbGF5OiJpbmxpbmUtYmxvY2sifSxmdW5jdGlvbigpe2I/Yz1ieChhLCJtYXJnaW4tcmlnaHQiLCJtYXJnaW5SaWdodCIpOmM9YS5zdHlsZS5tYXJnaW5SaWdodH0pO3JldHVybiBjfX0pfSksYy5kZWZhdWx0VmlldyYmYy5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlJiYoYnk9ZnVuY3Rpb24oYSxjKXt2YXIgZCxlLGc7Yz1jLnJlcGxhY2UoYnAsIi0kMSIpLnRvTG93ZXJDYXNlKCk7aWYoIShlPWEub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldykpcmV0dXJuIGI7aWYoZz1lLmdldENvbXB1dGVkU3R5bGUoYSxudWxsKSlkPWcuZ2V0UHJvcGVydHlWYWx1ZShjKSxkPT09IiImJiFmLmNvbnRhaW5zKGEub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsYSkmJihkPWYuc3R5bGUoYSxjKSk7cmV0dXJuIGR9KSxjLmRvY3VtZW50RWxlbWVudC5jdXJyZW50U3R5bGUmJihiej1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9YS5jdXJyZW50U3R5bGUmJmEuY3VycmVudFN0eWxlW2JdLGU9YS5ydW50aW1lU3R5bGUmJmEucnVudGltZVN0eWxlW2JdLGY9YS5zdHlsZTshYnEudGVzdChkKSYmYnIudGVzdChkKSYmKGM9Zi5sZWZ0LGUmJihhLnJ1bnRpbWVTdHlsZS5sZWZ0PWEuY3VycmVudFN0eWxlLmxlZnQpLGYubGVmdD1iPT09ImZvbnRTaXplIj8iMWVtIjpkfHwwLGQ9Zi5waXhlbExlZnQrInB4IixmLmxlZnQ9YyxlJiYoYS5ydW50aW1lU3R5bGUubGVmdD1lKSk7cmV0dXJuIGQ9PT0iIj8iYXV0byI6ZH0pLGJ4PWJ5fHxieixmLmV4cHImJmYuZXhwci5maWx0ZXJzJiYoZi5leHByLmZpbHRlcnMuaGlkZGVuPWZ1bmN0aW9uKGEpe3ZhciBiPWEub2Zmc2V0V2lkdGgsYz1hLm9mZnNldEhlaWdodDtyZXR1cm4gYj09PTAmJmM9PT0wfHwhZi5zdXBwb3J0LnJlbGlhYmxlSGlkZGVuT2Zmc2V0cyYmKGEuc3R5bGUuZGlzcGxheXx8Zi5jc3MoYSwiZGlzcGxheSIpKT09PSJub25lIn0sZi5leHByLmZpbHRlcnMudmlzaWJsZT1mdW5jdGlvbihhKXtyZXR1cm4hZi5leHByLmZpbHRlcnMuaGlkZGVuKGEpfSk7dmFyIGJCPS8lMjAvZyxiQz0vXFtcXSQvLGJEPS9ccj9cbi9nLGJFPS8jLiokLyxiRj0vXiguKj8pOlsgXHRdKihbXlxyXG5dKilccj8kL21nLGJHPS9eKD86Y29sb3J8ZGF0ZXxkYXRldGltZXxlbWFpbHxoaWRkZW58bW9udGh8bnVtYmVyfHBhc3N3b3JkfHJhbmdlfHNlYXJjaHx0ZWx8dGV4dHx0aW1lfHVybHx3ZWVrKSQvaSxiSD0vXig/OmFib3V0fGFwcHxhcHBcLXN0b3JhZ2V8LitcLWV4dGVuc2lvbnxmaWxlfHdpZGdldCk6JC8sYkk9L14oPzpHRVR8SEVBRCkkLyxiSj0vXlwvXC8vLGJLPS9cPy8sYkw9LzxzY3JpcHRcYltePF0qKD86KD8hPFwvc2NyaXB0Pik8W148XSopKjxcL3NjcmlwdD4vZ2ksYk09L14oPzpzZWxlY3R8dGV4dGFyZWEpL2ksYk49L1xzKy8sYk89LyhbPyZdKV89W14mXSovLGJQPS9eKFtcd1wrXC5cLV0rOikoPzpcL1wvKFteXC8/IzpdKikoPzo6KFxkKykpPyk/LyxiUT1mLmZuLmxvYWQsYlI9e30sYlM9e30sYlQsYlU7dHJ5e2JUPWUuaHJlZn1jYXRjaChiVil7YlQ9Yy5jcmVhdGVFbGVtZW50KCJhIiksYlQuaHJlZj0iIixiVD1iVC5ocmVmfWJVPWJQLmV4ZWMoYlQudG9Mb3dlckNhc2UoKSl8fFtdLGYuZm4uZXh0ZW5kKHtsb2FkOmZ1bmN0aW9uKGEsYyxkKXtpZih0eXBlb2YgYSE9InN0cmluZyImJmJRKXJldHVybiBiUS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7aWYoIXRoaXMubGVuZ3RoKXJldHVybiB0aGlzO3ZhciBlPWEuaW5kZXhPZigiICIpO2lmKGU+PTApe3ZhciBnPWEuc2xpY2UoZSxhLmxlbmd0aCk7YT1hLnNsaWNlKDAsZSl9dmFyIGg9IkdFVCI7YyYmKGYuaXNGdW5jdGlvbihjKT8oZD1jLGM9Yik6dHlwZW9mIGM9PSJvYmplY3QiJiYoYz1mLnBhcmFtKGMsZi5hamF4U2V0dGluZ3MudHJhZGl0aW9uYWwpLGg9IlBPU1QiKSk7dmFyIGk9dGhpcztmLmFqYXgoe3VybDphLHR5cGU6aCxkYXRhVHlwZToiaHRtbCIsZGF0YTpjLGNvbXBsZXRlOmZ1bmN0aW9uKGEsYixjKXtjPWEucmVzcG9uc2VUZXh0LGEuaXNSZXNvbHZlZCgpJiYoYS5kb25lKGZ1bmN0aW9uKGEpe2M9YX0pLGkuaHRtbChnP2YoIjxkaXY+IikuYXBwZW5kKGMucmVwbGFjZShiTCwiIikpLmZpbmQoZyk6YykpLGQmJmkuZWFjaChkLFtjLGIsYV0pfX0pO3JldHVybiB0aGlzfSxzZXJpYWxpemU6ZnVuY3Rpb24oKXtyZXR1cm4gZi5wYXJhbSh0aGlzLnNlcmlhbGl6ZUFycmF5KCkpfSxzZXJpYWxpemVBcnJheTpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnRzP2YubWFrZUFycmF5KHRoaXMuZWxlbWVudHMpOnRoaXN9KS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5uYW1lJiYhdGhpcy5kaXNhYmxlZCYmKHRoaXMuY2hlY2tlZHx8Yk0udGVzdCh0aGlzLm5vZGVOYW1lKXx8YkcudGVzdCh0aGlzLnR5cGUpKX0pLm1hcChmdW5jdGlvbihhLGIpe3ZhciBjPWYodGhpcykudmFsKCk7cmV0dXJuIGM9PW51bGw/bnVsbDpmLmlzQXJyYXkoYyk/Zi5tYXAoYyxmdW5jdGlvbihhLGMpe3JldHVybntuYW1lOmIubmFtZSx2YWx1ZTphLnJlcGxhY2UoYkQsIlxyXG4iKX19KTp7bmFtZTpiLm5hbWUsdmFsdWU6Yy5yZXBsYWNlKGJELCJcclxuIil9fSkuZ2V0KCl9fSksZi5lYWNoKCJhamF4U3RhcnQgYWpheFN0b3AgYWpheENvbXBsZXRlIGFqYXhFcnJvciBhamF4U3VjY2VzcyBhamF4U2VuZCIuc3BsaXQoIiAiKSxmdW5jdGlvbihhLGIpe2YuZm5bYl09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuYmluZChiLGEpfX0pLGYuZWFjaChbImdldCIsInBvc3QiXSxmdW5jdGlvbihhLGMpe2ZbY109ZnVuY3Rpb24oYSxkLGUsZyl7Zi5pc0Z1bmN0aW9uKGQpJiYoZz1nfHxlLGU9ZCxkPWIpO3JldHVybiBmLmFqYXgoe3R5cGU6Yyx1cmw6YSxkYXRhOmQsc3VjY2VzczplLGRhdGFUeXBlOmd9KX19KSxmLmV4dGVuZCh7Z2V0U2NyaXB0OmZ1bmN0aW9uKGEsYyl7cmV0dXJuIGYuZ2V0KGEsYixjLCJzY3JpcHQiKX0sZ2V0SlNPTjpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZ2V0KGEsYixjLCJqc29uIil9LGFqYXhTZXR1cDpmdW5jdGlvbihhLGIpe2I/Zi5leHRlbmQoITAsYSxmLmFqYXhTZXR0aW5ncyxiKTooYj1hLGE9Zi5leHRlbmQoITAsZi5hamF4U2V0dGluZ3MsYikpO2Zvcih2YXIgYyBpbntjb250ZXh0OjEsdXJsOjF9KWMgaW4gYj9hW2NdPWJbY106YyBpbiBmLmFqYXhTZXR0aW5ncyYmKGFbY109Zi5hamF4U2V0dGluZ3NbY10pO3JldHVybiBhfSxhamF4U2V0dGluZ3M6e3VybDpiVCxpc0xvY2FsOmJILnRlc3QoYlVbMV0pLGdsb2JhbDohMCx0eXBlOiJHRVQiLGNvbnRlbnRUeXBlOiJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLHByb2Nlc3NEYXRhOiEwLGFzeW5jOiEwLGFjY2VwdHM6e3htbDoiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsaHRtbDoidGV4dC9odG1sIix0ZXh0OiJ0ZXh0L3BsYWluIixqc29uOiJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L2phdmFzY3JpcHQiLCIqIjoiKi8qIn0sY29udGVudHM6e3htbDoveG1sLyxodG1sOi9odG1sLyxqc29uOi9qc29uL30scmVzcG9uc2VGaWVsZHM6e3htbDoicmVzcG9uc2VYTUwiLHRleHQ6InJlc3BvbnNlVGV4dCJ9LGNvbnZlcnRlcnM6eyIqIHRleHQiOmEuU3RyaW5nLCJ0ZXh0IGh0bWwiOiEwLCJ0ZXh0IGpzb24iOmYucGFyc2VKU09OLCJ0ZXh0IHhtbCI6Zi5wYXJzZVhNTH19LGFqYXhQcmVmaWx0ZXI6YlcoYlIpLGFqYXhUcmFuc3BvcnQ6YlcoYlMpLGFqYXg6ZnVuY3Rpb24oYSxjKXtmdW5jdGlvbiB3KGEsYyxsLG0pe2lmKHMhPT0yKXtzPTIscSYmY2xlYXJUaW1lb3V0KHEpLHA9YixuPW18fCIiLHYucmVhZHlTdGF0ZT1hPzQ6MDt2YXIgbyxyLHUsdz1sP2JaKGQsdixsKTpiLHgseTtpZihhPj0yMDAmJmE8MzAwfHxhPT09MzA0KXtpZihkLmlmTW9kaWZpZWQpe2lmKHg9di5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpKWYubGFzdE1vZGlmaWVkW2tdPXg7aWYoeT12LmdldFJlc3BvbnNlSGVhZGVyKCJFdGFnIikpZi5ldGFnW2tdPXl9aWYoYT09PTMwNCljPSJub3Rtb2RpZmllZCIsbz0hMDtlbHNlIHRyeXtyPWIkKGQsdyksYz0ic3VjY2VzcyIsbz0hMH1jYXRjaCh6KXtjPSJwYXJzZXJlcnJvciIsdT16fX1lbHNle3U9YztpZighY3x8YSljPSJlcnJvciIsYTwwJiYoYT0wKX12LnN0YXR1cz1hLHYuc3RhdHVzVGV4dD1jLG8/aC5yZXNvbHZlV2l0aChlLFtyLGMsdl0pOmgucmVqZWN0V2l0aChlLFt2LGMsdV0pLHYuc3RhdHVzQ29kZShqKSxqPWIsdCYmZy50cmlnZ2VyKCJhamF4Iisobz8iU3VjY2VzcyI6IkVycm9yIiksW3YsZCxvP3I6dV0pLGkucmVzb2x2ZVdpdGgoZSxbdixjXSksdCYmKGcudHJpZ2dlcigiYWpheENvbXBsZXRlIixbdixkXSksLS1mLmFjdGl2ZXx8Zi5ldmVudC50cmlnZ2VyKCJhamF4U3RvcCIpKX19dHlwZW9mIGE9PSJvYmplY3QiJiYoYz1hLGE9YiksYz1jfHx7fTt2YXIgZD1mLmFqYXhTZXR1cCh7fSxjKSxlPWQuY29udGV4dHx8ZCxnPWUhPT1kJiYoZS5ub2RlVHlwZXx8ZSBpbnN0YW5jZW9mIGYpP2YoZSk6Zi5ldmVudCxoPWYuRGVmZXJyZWQoKSxpPWYuX0RlZmVycmVkKCksaj1kLnN0YXR1c0NvZGV8fHt9LGssbD17fSxtPXt9LG4sbyxwLHEscixzPTAsdCx1LHY9e3JlYWR5U3RhdGU6MCxzZXRSZXF1ZXN0SGVhZGVyOmZ1bmN0aW9uKGEsYil7aWYoIXMpe3ZhciBjPWEudG9Mb3dlckNhc2UoKTthPW1bY109bVtjXXx8YSxsW2FdPWJ9cmV0dXJuIHRoaXN9LGdldEFsbFJlc3BvbnNlSGVhZGVyczpmdW5jdGlvbigpe3JldHVybiBzPT09Mj9uOm51bGx9LGdldFJlc3BvbnNlSGVhZGVyOmZ1bmN0aW9uKGEpe3ZhciBjO2lmKHM9PT0yKXtpZighbyl7bz17fTt3aGlsZShjPWJGLmV4ZWMobikpb1tjWzFdLnRvTG93ZXJDYXNlKCldPWNbMl19Yz1vW2EudG9Mb3dlckNhc2UoKV19cmV0dXJuIGM9PT1iP251bGw6Y30sb3ZlcnJpZGVNaW1lVHlwZTpmdW5jdGlvbihhKXtzfHwoZC5taW1lVHlwZT1hKTtyZXR1cm4gdGhpc30sYWJvcnQ6ZnVuY3Rpb24oYSl7YT1hfHwiYWJvcnQiLHAmJnAuYWJvcnQoYSksdygwLGEpO3JldHVybiB0aGlzfX07aC5wcm9taXNlKHYpLHYuc3VjY2Vzcz12LmRvbmUsdi5lcnJvcj12LmZhaWwsdi5jb21wbGV0ZT1pLmRvbmUsdi5zdGF0dXNDb2RlPWZ1bmN0aW9uKGEpe2lmKGEpe3ZhciBiO2lmKHM8Milmb3IoYiBpbiBhKWpbYl09W2pbYl0sYVtiXV07ZWxzZSBiPWFbdi5zdGF0dXNdLHYudGhlbihiLGIpfXJldHVybiB0aGlzfSxkLnVybD0oKGF8fGQudXJsKSsiIikucmVwbGFjZShiRSwiIikucmVwbGFjZShiSixiVVsxXSsiLy8iKSxkLmRhdGFUeXBlcz1mLnRyaW0oZC5kYXRhVHlwZXx8IioiKS50b0xvd2VyQ2FzZSgpLnNwbGl0KGJOKSxkLmNyb3NzRG9tYWluPT1udWxsJiYocj1iUC5leGVjKGQudXJsLnRvTG93ZXJDYXNlKCkpLGQuY3Jvc3NEb21haW49ISghcnx8clsxXT09YlVbMV0mJnJbMl09PWJVWzJdJiYoclszXXx8KHJbMV09PT0iaHR0cDoiPzgwOjQ0MykpPT0oYlVbM118fChiVVsxXT09PSJodHRwOiI/ODA6NDQzKSkpKSxkLmRhdGEmJmQucHJvY2Vzc0RhdGEmJnR5cGVvZiBkLmRhdGEhPSJzdHJpbmciJiYoZC5kYXRhPWYucGFyYW0oZC5kYXRhLGQudHJhZGl0aW9uYWwpKSxiWChiUixkLGMsdik7aWYocz09PTIpcmV0dXJuITE7dD1kLmdsb2JhbCxkLnR5cGU9ZC50eXBlLnRvVXBwZXJDYXNlKCksZC5oYXNDb250ZW50PSFiSS50ZXN0KGQudHlwZSksdCYmZi5hY3RpdmUrKz09PTAmJmYuZXZlbnQudHJpZ2dlcigiYWpheFN0YXJ0Iik7aWYoIWQuaGFzQ29udGVudCl7ZC5kYXRhJiYoZC51cmwrPShiSy50ZXN0KGQudXJsKT8iJiI6Ij8iKStkLmRhdGEpLGs9ZC51cmw7aWYoZC5jYWNoZT09PSExKXt2YXIgeD1mLm5vdygpLHk9ZC51cmwucmVwbGFjZShiTywiJDFfPSIreCk7ZC51cmw9eSsoeT09PWQudXJsPyhiSy50ZXN0KGQudXJsKT8iJiI6Ij8iKSsiXz0iK3g6IiIpfX0oZC5kYXRhJiZkLmhhc0NvbnRlbnQmJmQuY29udGVudFR5cGUhPT0hMXx8Yy5jb250ZW50VHlwZSkmJnYuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIixkLmNvbnRlbnRUeXBlKSxkLmlmTW9kaWZpZWQmJihrPWt8fGQudXJsLGYubGFzdE1vZGlmaWVkW2tdJiZ2LnNldFJlcXVlc3RIZWFkZXIoIklmLU1vZGlmaWVkLVNpbmNlIixmLmxhc3RNb2RpZmllZFtrXSksZi5ldGFnW2tdJiZ2LnNldFJlcXVlc3RIZWFkZXIoIklmLU5vbmUtTWF0Y2giLGYuZXRhZ1trXSkpLHYuc2V0UmVxdWVzdEhlYWRlcigiQWNjZXB0IixkLmRhdGFUeXBlc1swXSYmZC5hY2NlcHRzW2QuZGF0YVR5cGVzWzBdXT9kLmFjY2VwdHNbZC5kYXRhVHlwZXNbMF1dKyhkLmRhdGFUeXBlc1swXSE9PSIqIj8iLCAqLyo7IHE9MC4wMSI6IiIpOmQuYWNjZXB0c1siKiJdKTtmb3IodSBpbiBkLmhlYWRlcnMpdi5zZXRSZXF1ZXN0SGVhZGVyKHUsZC5oZWFkZXJzW3VdKTtpZihkLmJlZm9yZVNlbmQmJihkLmJlZm9yZVNlbmQuY2FsbChlLHYsZCk9PT0hMXx8cz09PTIpKXt2LmFib3J0KCk7cmV0dXJuITF9Zm9yKHUgaW57c3VjY2VzczoxLGVycm9yOjEsY29tcGxldGU6MX0pdlt1XShkW3VdKTtwPWJYKGJTLGQsYyx2KTtpZighcCl3KC0xLCJObyBUcmFuc3BvcnQiKTtlbHNle3YucmVhZHlTdGF0ZT0xLHQmJmcudHJpZ2dlcigiYWpheFNlbmQiLFt2LGRdKSxkLmFzeW5jJiZkLnRpbWVvdXQ+MCYmKHE9c2V0VGltZW91dChmdW5jdGlvbigpe3YuYWJvcnQoInRpbWVvdXQiKX0sZC50aW1lb3V0KSk7dHJ5e3M9MSxwLnNlbmQobCx3KX1jYXRjaCh6KXtzdGF0dXM8Mj93KC0xLHopOmYuZXJyb3Ioeil9fXJldHVybiB2fSxwYXJhbTpmdW5jdGlvbihhLGMpe3ZhciBkPVtdLGU9ZnVuY3Rpb24oYSxiKXtiPWYuaXNGdW5jdGlvbihiKT9iKCk6YixkW2QubGVuZ3RoXT1lbmNvZGVVUklDb21wb25lbnQoYSkrIj0iK2VuY29kZVVSSUNvbXBvbmVudChiKX07Yz09PWImJihjPWYuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsKTtpZihmLmlzQXJyYXkoYSl8fGEuanF1ZXJ5JiYhZi5pc1BsYWluT2JqZWN0KGEpKWYuZWFjaChhLGZ1bmN0aW9uKCl7ZSh0aGlzLm5hbWUsdGhpcy52YWx1ZSl9KTtlbHNlIGZvcih2YXIgZyBpbiBhKWJZKGcsYVtnXSxjLGUpO3JldHVybiBkLmpvaW4oIiYiKS5yZXBsYWNlKGJCLCIrIil9fSksZi5leHRlbmQoe2FjdGl2ZTowLGxhc3RNb2RpZmllZDp7fSxldGFnOnt9fSk7dmFyIGJfPWYubm93KCksY2E9LyhcPSlcPygmfCQpfFw/XD8vaTtmLmFqYXhTZXR1cCh7anNvbnA6ImNhbGxiYWNrIixqc29ucENhbGxiYWNrOmZ1bmN0aW9uKCl7cmV0dXJuIGYuZXhwYW5kbysiXyIrYl8rK319KSxmLmFqYXhQcmVmaWx0ZXIoImpzb24ganNvbnAiLGZ1bmN0aW9uKGIsYyxkKXt2YXIgZT1iLmNvbnRlbnRUeXBlPT09ImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCImJnR5cGVvZiBiLmRhdGE9PSJzdHJpbmciO2lmKGIuZGF0YVR5cGVzWzBdPT09Impzb25wInx8Yi5qc29ucCE9PSExJiYoY2EudGVzdChiLnVybCl8fGUmJmNhLnRlc3QoYi5kYXRhKSkpe3ZhciBnLGg9Yi5qc29ucENhbGxiYWNrPWYuaXNGdW5jdGlvbihiLmpzb25wQ2FsbGJhY2spP2IuanNvbnBDYWxsYmFjaygpOmIuanNvbnBDYWxsYmFjayxpPWFbaF0saj1iLnVybCxrPWIuZGF0YSxsPSIkMSIraCsiJDIiO2IuanNvbnAhPT0hMSYmKGo9ai5yZXBsYWNlKGNhLGwpLGIudXJsPT09aiYmKGUmJihrPWsucmVwbGFjZShjYSxsKSksYi5kYXRhPT09ayYmKGorPSgvXD8vLnRlc3Qoaik/IiYiOiI/IikrYi5qc29ucCsiPSIraCkpKSxiLnVybD1qLGIuZGF0YT1rLGFbaF09ZnVuY3Rpb24oYSl7Zz1bYV19LGQuYWx3YXlzKGZ1bmN0aW9uKCl7YVtoXT1pLGcmJmYuaXNGdW5jdGlvbihpKSYmYVtoXShnWzBdKX0pLGIuY29udmVydGVyc1sic2NyaXB0IGpzb24iXT1mdW5jdGlvbigpe2d8fGYuZXJyb3IoaCsiIHdhcyBub3QgY2FsbGVkIik7cmV0dXJuIGdbMF19LGIuZGF0YVR5cGVzWzBdPSJqc29uIjtyZXR1cm4ic2NyaXB0In19KSxmLmFqYXhTZXR1cCh7YWNjZXB0czp7c2NyaXB0OiJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCJ9LGNvbnRlbnRzOntzY3JpcHQ6L2phdmFzY3JpcHR8ZWNtYXNjcmlwdC99LGNvbnZlcnRlcnM6eyJ0ZXh0IHNjcmlwdCI6ZnVuY3Rpb24oYSl7Zi5nbG9iYWxFdmFsKGEpO3JldHVybiBhfX19KSxmLmFqYXhQcmVmaWx0ZXIoInNjcmlwdCIsZnVuY3Rpb24oYSl7YS5jYWNoZT09PWImJihhLmNhY2hlPSExKSxhLmNyb3NzRG9tYWluJiYoYS50eXBlPSJHRVQiLGEuZ2xvYmFsPSExKX0pLGYuYWpheFRyYW5zcG9ydCgic2NyaXB0IixmdW5jdGlvbihhKXtpZihhLmNyb3NzRG9tYWluKXt2YXIgZCxlPWMuaGVhZHx8Yy5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdfHxjLmRvY3VtZW50RWxlbWVudDtyZXR1cm57c2VuZDpmdW5jdGlvbihmLGcpe2Q9Yy5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKSxkLmFzeW5jPSJhc3luYyIsYS5zY3JpcHRDaGFyc2V0JiYoZC5jaGFyc2V0PWEuc2NyaXB0Q2hhcnNldCksZC5zcmM9YS51cmwsZC5vbmxvYWQ9ZC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oYSxjKXtpZihjfHwhZC5yZWFkeVN0YXRlfHwvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KGQucmVhZHlTdGF0ZSkpZC5vbmxvYWQ9ZC5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCxlJiZkLnBhcmVudE5vZGUmJmUucmVtb3ZlQ2hpbGQoZCksZD1iLGN8fGcoMjAwLCJzdWNjZXNzIil9LGUuaW5zZXJ0QmVmb3JlKGQsZS5maXJzdENoaWxkKX0sYWJvcnQ6ZnVuY3Rpb24oKXtkJiZkLm9ubG9hZCgwLDEpfX19fSk7dmFyIGNiPWEuQWN0aXZlWE9iamVjdD9mdW5jdGlvbigpe2Zvcih2YXIgYSBpbiBjZCljZFthXSgwLDEpfTohMSxjYz0wLGNkO2YuYWpheFNldHRpbmdzLnhocj1hLkFjdGl2ZVhPYmplY3Q/ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5pc0xvY2FsJiZjZSgpfHxjZigpfTpjZSxmdW5jdGlvbihhKXtmLmV4dGVuZChmLnN1cHBvcnQse2FqYXg6ISFhLGNvcnM6ISFhJiYid2l0aENyZWRlbnRpYWxzImluIGF9KX0oZi5hamF4U2V0dGluZ3MueGhyKCkpLGYuc3VwcG9ydC5hamF4JiZmLmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oYyl7aWYoIWMuY3Jvc3NEb21haW58fGYuc3VwcG9ydC5jb3JzKXt2YXIgZDtyZXR1cm57c2VuZDpmdW5jdGlvbihlLGcpe3ZhciBoPWMueGhyKCksaSxqO2MudXNlcm5hbWU/aC5vcGVuKGMudHlwZSxjLnVybCxjLmFzeW5jLGMudXNlcm5hbWUsYy5wYXNzd29yZCk6aC5vcGVuKGMudHlwZSxjLnVybCxjLmFzeW5jKTtpZihjLnhockZpZWxkcylmb3IoaiBpbiBjLnhockZpZWxkcyloW2pdPWMueGhyRmllbGRzW2pdO2MubWltZVR5cGUmJmgub3ZlcnJpZGVNaW1lVHlwZSYmaC5vdmVycmlkZU1pbWVUeXBlKGMubWltZVR5cGUpLCFjLmNyb3NzRG9tYWluJiYhZVsiWC1SZXF1ZXN0ZWQtV2l0aCJdJiYoZVsiWC1SZXF1ZXN0ZWQtV2l0aCJdPSJYTUxIdHRwUmVxdWVzdCIpO3RyeXtmb3IoaiBpbiBlKWguc2V0UmVxdWVzdEhlYWRlcihqLGVbal0pfWNhdGNoKGspe31oLnNlbmQoYy5oYXNDb250ZW50JiZjLmRhdGF8fG51bGwpLGQ9ZnVuY3Rpb24oYSxlKXt2YXIgaixrLGwsbSxuO3RyeXtpZihkJiYoZXx8aC5yZWFkeVN0YXRlPT09NCkpe2Q9YixpJiYoaC5vbnJlYWR5c3RhdGVjaGFuZ2U9Zi5ub29wLGNiJiZkZWxldGUgY2RbaV0pO2lmKGUpaC5yZWFkeVN0YXRlIT09NCYmaC5hYm9ydCgpO2Vsc2V7aj1oLnN0YXR1cyxsPWguZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCksbT17fSxuPWgucmVzcG9uc2VYTUwsbiYmbi5kb2N1bWVudEVsZW1lbnQmJihtLnhtbD1uKSxtLnRleHQ9aC5yZXNwb25zZVRleHQ7dHJ5e2s9aC5zdGF0dXNUZXh0fWNhdGNoKG8pe2s9IiJ9IWomJmMuaXNMb2NhbCYmIWMuY3Jvc3NEb21haW4/aj1tLnRleHQ/MjAwOjQwNDpqPT09MTIyMyYmKGo9MjA0KX19fWNhdGNoKHApe2V8fGcoLTEscCl9bSYmZyhqLGssbSxsKX0sIWMuYXN5bmN8fGgucmVhZHlTdGF0ZT09PTQ/ZCgpOihpPSsrY2MsY2ImJihjZHx8KGNkPXt9LGYoYSkudW5sb2FkKGNiKSksY2RbaV09ZCksaC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZCl9LGFib3J0OmZ1bmN0aW9uKCl7ZCYmZCgwLDEpfX19fSk7dmFyIGNnPXt9LGNoLGNpLGNqPS9eKD86dG9nZ2xlfHNob3d8aGlkZSkkLyxjaz0vXihbK1wtXT0pPyhbXGQrLlwtXSspKFthLXolXSopJC9pLGNsLGNtPVtbImhlaWdodCIsIm1hcmdpblRvcCIsIm1hcmdpbkJvdHRvbSIsInBhZGRpbmdUb3AiLCJwYWRkaW5nQm90dG9tIl0sWyJ3aWR0aCIsIm1hcmdpbkxlZnQiLCJtYXJnaW5SaWdodCIsInBhZGRpbmdMZWZ0IiwicGFkZGluZ1JpZ2h0Il0sWyJvcGFjaXR5Il1dLGNuLGNvPWEud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxhLm1velJlcXVlc3RBbmltYXRpb25GcmFtZXx8YS5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lO2YuZm4uZXh0ZW5kKHtzaG93OmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlO2lmKGF8fGE9PT0wKXJldHVybiB0aGlzLmFuaW1hdGUoY3IoInNob3ciLDMpLGEsYixjKTtmb3IodmFyIGc9MCxoPXRoaXMubGVuZ3RoO2c8aDtnKyspZD10aGlzW2ddLGQuc3R5bGUmJihlPWQuc3R5bGUuZGlzcGxheSwhZi5fZGF0YShkLCJvbGRkaXNwbGF5IikmJmU9PT0ibm9uZSImJihlPWQuc3R5bGUuZGlzcGxheT0iIiksZT09PSIiJiZmLmNzcyhkLCJkaXNwbGF5Iik9PT0ibm9uZSImJmYuX2RhdGEoZCwib2xkZGlzcGxheSIsY3MoZC5ub2RlTmFtZSkpKTtmb3IoZz0wO2c8aDtnKyspe2Q9dGhpc1tnXTtpZihkLnN0eWxlKXtlPWQuc3R5bGUuZGlzcGxheTtpZihlPT09IiJ8fGU9PT0ibm9uZSIpZC5zdHlsZS5kaXNwbGF5PWYuX2RhdGEoZCwib2xkZGlzcGxheSIpfHwiIn19cmV0dXJuIHRoaXN9LGhpZGU6ZnVuY3Rpb24oYSxiLGMpe2lmKGF8fGE9PT0wKXJldHVybiB0aGlzLmFuaW1hdGUoY3IoImhpZGUiLDMpLGEsYixjKTtmb3IodmFyIGQ9MCxlPXRoaXMubGVuZ3RoO2Q8ZTtkKyspaWYodGhpc1tkXS5zdHlsZSl7dmFyIGc9Zi5jc3ModGhpc1tkXSwiZGlzcGxheSIpO2chPT0ibm9uZSImJiFmLl9kYXRhKHRoaXNbZF0sIm9sZGRpc3BsYXkiKSYmZi5fZGF0YSh0aGlzW2RdLCJvbGRkaXNwbGF5IixnKX1mb3IoZD0wO2Q8ZTtkKyspdGhpc1tkXS5zdHlsZSYmKHRoaXNbZF0uc3R5bGUuZGlzcGxheT0ibm9uZSIpO3JldHVybiB0aGlzfSxfdG9nZ2xlOmYuZm4udG9nZ2xlLHRvZ2dsZTpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dHlwZW9mIGE9PSJib29sZWFuIjtmLmlzRnVuY3Rpb24oYSkmJmYuaXNGdW5jdGlvbihiKT90aGlzLl90b2dnbGUuYXBwbHkodGhpcyxhcmd1bWVudHMpOmE9PW51bGx8fGQ/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9ZD9hOmYodGhpcykuaXMoIjpoaWRkZW4iKTtmKHRoaXMpW2I/InNob3ciOiJoaWRlIl0oKX0pOnRoaXMuYW5pbWF0ZShjcigidG9nZ2xlIiwzKSxhLGIsYyk7cmV0dXJuIHRoaXN9LGZhZGVUbzpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5maWx0ZXIoIjpoaWRkZW4iKS5jc3MoIm9wYWNpdHkiLDApLnNob3coKS5lbmQoKS5hbmltYXRlKHtvcGFjaXR5OmJ9LGEsYyxkKX0sYW5pbWF0ZTpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1mLnNwZWVkKGIsYyxkKTtpZihmLmlzRW1wdHlPYmplY3QoYSkpcmV0dXJuIHRoaXMuZWFjaChlLmNvbXBsZXRlLFshMV0pO2E9Zi5leHRlbmQoe30sYSk7cmV0dXJuIHRoaXNbZS5xdWV1ZT09PSExPyJlYWNoIjoicXVldWUiXShmdW5jdGlvbigpe2UucXVldWU9PT0hMSYmZi5fbWFyayh0aGlzKTt2YXIgYj1mLmV4dGVuZCh7fSxlKSxjPXRoaXMubm9kZVR5cGU9PT0xLGQ9YyYmZih0aGlzKS5pcygiOmhpZGRlbiIpLGcsaCxpLGosayxsLG0sbixvO2IuYW5pbWF0ZWRQcm9wZXJ0aWVzPXt9O2ZvcihpIGluIGEpe2c9Zi5jYW1lbENhc2UoaSksaSE9PWcmJihhW2ddPWFbaV0sZGVsZXRlIGFbaV0pLGg9YVtnXSxmLmlzQXJyYXkoaCk/KGIuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddPWhbMV0saD1hW2ddPWhbMF0pOmIuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddPWIuc3BlY2lhbEVhc2luZyYmYi5zcGVjaWFsRWFzaW5nW2ddfHxiLmVhc2luZ3x8InN3aW5nIjtpZihoPT09ImhpZGUiJiZkfHxoPT09InNob3ciJiYhZClyZXR1cm4gYi5jb21wbGV0ZS5jYWxsKHRoaXMpO2MmJihnPT09ImhlaWdodCJ8fGc9PT0id2lkdGgiKSYmKGIub3ZlcmZsb3c9W3RoaXMuc3R5bGUub3ZlcmZsb3csdGhpcy5zdHlsZS5vdmVyZmxvd1gsdGhpcy5zdHlsZS5vdmVyZmxvd1ldLGYuY3NzKHRoaXMsImRpc3BsYXkiKT09PSJpbmxpbmUiJiZmLmNzcyh0aGlzLCJmbG9hdCIpPT09Im5vbmUiJiYoZi5zdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQ/KGo9Y3ModGhpcy5ub2RlTmFtZSksaj09PSJpbmxpbmUiP3RoaXMuc3R5bGUuZGlzcGxheT0iaW5saW5lLWJsb2NrIjoodGhpcy5zdHlsZS5kaXNwbGF5PSJpbmxpbmUiLHRoaXMuc3R5bGUuem9vbT0xKSk6dGhpcy5zdHlsZS5kaXNwbGF5PSJpbmxpbmUtYmxvY2siKSl9Yi5vdmVyZmxvdyE9bnVsbCYmKHRoaXMuc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIpO2ZvcihpIGluIGEpaz1uZXcgZi5meCh0aGlzLGIsaSksaD1hW2ldLGNqLnRlc3QoaCk/a1toPT09InRvZ2dsZSI/ZD8ic2hvdyI6ImhpZGUiOmhdKCk6KGw9Y2suZXhlYyhoKSxtPWsuY3VyKCksbD8obj1wYXJzZUZsb2F0KGxbMl0pLG89bFszXXx8KGYuY3NzTnVtYmVyW2ldPyIiOiJweCIpLG8hPT0icHgiJiYoZi5zdHlsZSh0aGlzLGksKG58fDEpK28pLG09KG58fDEpL2suY3VyKCkqbSxmLnN0eWxlKHRoaXMsaSxtK28pKSxsWzFdJiYobj0obFsxXT09PSItPSI/LTE6MSkqbittKSxrLmN1c3RvbShtLG4sbykpOmsuY3VzdG9tKG0saCwiIikpO3JldHVybiEwfSl9LHN0b3A6ZnVuY3Rpb24oYSxiKXthJiZ0aGlzLnF1ZXVlKFtdKSx0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYT1mLnRpbWVycyxjPWEubGVuZ3RoO2J8fGYuX3VubWFyayghMCx0aGlzKTt3aGlsZShjLS0pYVtjXS5lbGVtPT09dGhpcyYmKGImJmFbY10oITApLGEuc3BsaWNlKGMsMSkpfSksYnx8dGhpcy5kZXF1ZXVlKCk7cmV0dXJuIHRoaXN9fSksZi5lYWNoKHtzbGlkZURvd246Y3IoInNob3ciLDEpLHNsaWRlVXA6Y3IoImhpZGUiLDEpLHNsaWRlVG9nZ2xlOmNyKCJ0b2dnbGUiLDEpLGZhZGVJbjp7b3BhY2l0eToic2hvdyJ9LGZhZGVPdXQ6e29wYWNpdHk6ImhpZGUifSxmYWRlVG9nZ2xlOntvcGFjaXR5OiJ0b2dnbGUifX0sZnVuY3Rpb24oYSxiKXtmLmZuW2FdPWZ1bmN0aW9uKGEsYyxkKXtyZXR1cm4gdGhpcy5hbmltYXRlKGIsYSxjLGQpfX0pLGYuZXh0ZW5kKHtzcGVlZDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YSYmdHlwZW9mIGE9PSJvYmplY3QiP2YuZXh0ZW5kKHt9LGEpOntjb21wbGV0ZTpjfHwhYyYmYnx8Zi5pc0Z1bmN0aW9uKGEpJiZhLGR1cmF0aW9uOmEsZWFzaW5nOmMmJmJ8fGImJiFmLmlzRnVuY3Rpb24oYikmJmJ9O2QuZHVyYXRpb249Zi5meC5vZmY/MDp0eXBlb2YgZC5kdXJhdGlvbj09Im51bWJlciI/ZC5kdXJhdGlvbjpkLmR1cmF0aW9uIGluIGYuZnguc3BlZWRzP2YuZnguc3BlZWRzW2QuZHVyYXRpb25dOmYuZnguc3BlZWRzLl9kZWZhdWx0LGQub2xkPWQuY29tcGxldGUsZC5jb21wbGV0ZT1mdW5jdGlvbihhKXtmLmlzRnVuY3Rpb24oZC5vbGQpJiZkLm9sZC5jYWxsKHRoaXMpLGQucXVldWUhPT0hMT9mLmRlcXVldWUodGhpcyk6YSE9PSExJiZmLl91bm1hcmsodGhpcyl9O3JldHVybiBkfSxlYXNpbmc6e2xpbmVhcjpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gYytkKmF9LHN3aW5nOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybigtTWF0aC5jb3MoYSpNYXRoLlBJKS8yKy41KSpkK2N9fSx0aW1lcnM6W10sZng6ZnVuY3Rpb24oYSxiLGMpe3RoaXMub3B0aW9ucz1iLHRoaXMuZWxlbT1hLHRoaXMucHJvcD1jLGIub3JpZz1iLm9yaWd8fHt9fX0pLGYuZngucHJvdG90eXBlPXt1cGRhdGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuc3RlcCYmdGhpcy5vcHRpb25zLnN0ZXAuY2FsbCh0aGlzLmVsZW0sdGhpcy5ub3csdGhpcyksKGYuZnguc3RlcFt0aGlzLnByb3BdfHxmLmZ4LnN0ZXAuX2RlZmF1bHQpKHRoaXMpfSxjdXI6ZnVuY3Rpb24oKXtpZih0aGlzLmVsZW1bdGhpcy5wcm9wXSE9bnVsbCYmKCF0aGlzLmVsZW0uc3R5bGV8fHRoaXMuZWxlbS5zdHlsZVt0aGlzLnByb3BdPT1udWxsKSlyZXR1cm4gdGhpcy5lbGVtW3RoaXMucHJvcF07dmFyIGEsYj1mLmNzcyh0aGlzLmVsZW0sdGhpcy5wcm9wKTtyZXR1cm4gaXNOYU4oYT1wYXJzZUZsb2F0KGIpKT8hYnx8Yj09PSJhdXRvIj8wOmI6YX0sY3VzdG9tOmZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBoKGEpe3JldHVybiBkLnN0ZXAoYSl9dmFyIGQ9dGhpcyxlPWYuZngsZzt0aGlzLnN0YXJ0VGltZT1jbnx8Y3AoKSx0aGlzLnN0YXJ0PWEsdGhpcy5lbmQ9Yix0aGlzLnVuaXQ9Y3x8dGhpcy51bml0fHwoZi5jc3NOdW1iZXJbdGhpcy5wcm9wXT8iIjoicHgiKSx0aGlzLm5vdz10aGlzLnN0YXJ0LHRoaXMucG9zPXRoaXMuc3RhdGU9MCxoLmVsZW09dGhpcy5lbGVtLGgoKSYmZi50aW1lcnMucHVzaChoKSYmIWNsJiYoY28/KGNsPSEwLGc9ZnVuY3Rpb24oKXtjbCYmKGNvKGcpLGUudGljaygpKX0sY28oZykpOmNsPXNldEludGVydmFsKGUudGljayxlLmludGVydmFsKSl9LHNob3c6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMub3JpZ1t0aGlzLnByb3BdPWYuc3R5bGUodGhpcy5lbGVtLHRoaXMucHJvcCksdGhpcy5vcHRpb25zLnNob3c9ITAsdGhpcy5jdXN0b20odGhpcy5wcm9wPT09IndpZHRoInx8dGhpcy5wcm9wPT09ImhlaWdodCI/MTowLHRoaXMuY3VyKCkpLGYodGhpcy5lbGVtKS5zaG93KCl9LGhpZGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMub3JpZ1t0aGlzLnByb3BdPWYuc3R5bGUodGhpcy5lbGVtLHRoaXMucHJvcCksdGhpcy5vcHRpb25zLmhpZGU9ITAsdGhpcy5jdXN0b20odGhpcy5jdXIoKSwwKX0sc3RlcDpmdW5jdGlvbihhKXt2YXIgYj1jbnx8Y3AoKSxjPSEwLGQ9dGhpcy5lbGVtLGU9dGhpcy5vcHRpb25zLGcsaDtpZihhfHxiPj1lLmR1cmF0aW9uK3RoaXMuc3RhcnRUaW1lKXt0aGlzLm5vdz10aGlzLmVuZCx0aGlzLnBvcz10aGlzLnN0YXRlPTEsdGhpcy51cGRhdGUoKSxlLmFuaW1hdGVkUHJvcGVydGllc1t0aGlzLnByb3BdPSEwO2ZvcihnIGluIGUuYW5pbWF0ZWRQcm9wZXJ0aWVzKWUuYW5pbWF0ZWRQcm9wZXJ0aWVzW2ddIT09ITAmJihjPSExKTtpZihjKXtlLm92ZXJmbG93IT1udWxsJiYhZi5zdXBwb3J0LnNocmlua1dyYXBCbG9ja3MmJmYuZWFjaChbIiIsIlgiLCJZIl0sZnVuY3Rpb24oYSxiKXtkLnN0eWxlWyJvdmVyZmxvdyIrYl09ZS5vdmVyZmxvd1thXX0pLGUuaGlkZSYmZihkKS5oaWRlKCk7aWYoZS5oaWRlfHxlLnNob3cpZm9yKHZhciBpIGluIGUuYW5pbWF0ZWRQcm9wZXJ0aWVzKWYuc3R5bGUoZCxpLGUub3JpZ1tpXSk7ZS5jb21wbGV0ZS5jYWxsKGQpfXJldHVybiExfWUuZHVyYXRpb249PUluZmluaXR5P3RoaXMubm93PWI6KGg9Yi10aGlzLnN0YXJ0VGltZSx0aGlzLnN0YXRlPWgvZS5kdXJhdGlvbix0aGlzLnBvcz1mLmVhc2luZ1tlLmFuaW1hdGVkUHJvcGVydGllc1t0aGlzLnByb3BdXSh0aGlzLnN0YXRlLGgsMCwxLGUuZHVyYXRpb24pLHRoaXMubm93PXRoaXMuc3RhcnQrKHRoaXMuZW5kLXRoaXMuc3RhcnQpKnRoaXMucG9zKSx0aGlzLnVwZGF0ZSgpO3JldHVybiEwfX0sZi5leHRlbmQoZi5meCx7dGljazpmdW5jdGlvbigpe2Zvcih2YXIgYT1mLnRpbWVycyxiPTA7YjxhLmxlbmd0aDsrK2IpYVtiXSgpfHxhLnNwbGljZShiLS0sMSk7YS5sZW5ndGh8fGYuZnguc3RvcCgpfSxpbnRlcnZhbDoxMyxzdG9wOmZ1bmN0aW9uKCl7Y2xlYXJJbnRlcnZhbChjbCksY2w9bnVsbH0sc3BlZWRzOntzbG93OjYwMCxmYXN0OjIwMCxfZGVmYXVsdDo0MDB9LHN0ZXA6e29wYWNpdHk6ZnVuY3Rpb24oYSl7Zi5zdHlsZShhLmVsZW0sIm9wYWNpdHkiLGEubm93KX0sX2RlZmF1bHQ6ZnVuY3Rpb24oYSl7YS5lbGVtLnN0eWxlJiZhLmVsZW0uc3R5bGVbYS5wcm9wXSE9bnVsbD9hLmVsZW0uc3R5bGVbYS5wcm9wXT0oYS5wcm9wPT09IndpZHRoInx8YS5wcm9wPT09ImhlaWdodCI/TWF0aC5tYXgoMCxhLm5vdyk6YS5ub3cpK2EudW5pdDphLmVsZW1bYS5wcm9wXT1hLm5vd319fSksZi5leHByJiZmLmV4cHIuZmlsdGVycyYmKGYuZXhwci5maWx0ZXJzLmFuaW1hdGVkPWZ1bmN0aW9uKGEpe3JldHVybiBmLmdyZXAoZi50aW1lcnMsZnVuY3Rpb24oYil7cmV0dXJuIGE9PT1iLmVsZW19KS5sZW5ndGh9KTt2YXIgY3Q9L150KD86YWJsZXxkfGgpJC9pLGN1PS9eKD86Ym9keXxodG1sKSQvaTsiZ2V0Qm91bmRpbmdDbGllbnRSZWN0ImluIGMuZG9jdW1lbnRFbGVtZW50P2YuZm4ub2Zmc2V0PWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXNbMF0sYztpZihhKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zi5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO2lmKCFifHwhYi5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGI9PT1iLm93bmVyRG9jdW1lbnQuYm9keSlyZXR1cm4gZi5vZmZzZXQuYm9keU9mZnNldChiKTt0cnl7Yz1iLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpfWNhdGNoKGQpe312YXIgZT1iLm93bmVyRG9jdW1lbnQsZz1lLmRvY3VtZW50RWxlbWVudDtpZighY3x8IWYuY29udGFpbnMoZyxiKSlyZXR1cm4gYz97dG9wOmMudG9wLGxlZnQ6Yy5sZWZ0fTp7dG9wOjAsbGVmdDowfTt2YXIgaD1lLmJvZHksaT1jdihlKSxqPWcuY2xpZW50VG9wfHxoLmNsaWVudFRvcHx8MCxrPWcuY2xpZW50TGVmdHx8aC5jbGllbnRMZWZ0fHwwLGw9aS5wYWdlWU9mZnNldHx8Zi5zdXBwb3J0LmJveE1vZGVsJiZnLnNjcm9sbFRvcHx8aC5zY3JvbGxUb3AsbT1pLnBhZ2VYT2Zmc2V0fHxmLnN1cHBvcnQuYm94TW9kZWwmJmcuc2Nyb2xsTGVmdHx8aC5zY3JvbGxMZWZ0LG49Yy50b3ArbC1qLG89Yy5sZWZ0K20taztyZXR1cm57dG9wOm4sbGVmdDpvfX06Zi5mbi5vZmZzZXQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXTtpZihhKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zi5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO2lmKCFifHwhYi5vd25lckRvY3VtZW50KXJldHVybiBudWxsO2lmKGI9PT1iLm93bmVyRG9jdW1lbnQuYm9keSlyZXR1cm4gZi5vZmZzZXQuYm9keU9mZnNldChiKTtmLm9mZnNldC5pbml0aWFsaXplKCk7dmFyIGMsZD1iLm9mZnNldFBhcmVudCxlPWIsZz1iLm93bmVyRG9jdW1lbnQsaD1nLmRvY3VtZW50RWxlbWVudCxpPWcuYm9keSxqPWcuZGVmYXVsdFZpZXcsaz1qP2ouZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpOmIuY3VycmVudFN0eWxlLGw9Yi5vZmZzZXRUb3AsbT1iLm9mZnNldExlZnQ7d2hpbGUoKGI9Yi5wYXJlbnROb2RlKSYmYiE9PWkmJmIhPT1oKXtpZihmLm9mZnNldC5zdXBwb3J0c0ZpeGVkUG9zaXRpb24mJmsucG9zaXRpb249PT0iZml4ZWQiKWJyZWFrO2M9aj9qLmdldENvbXB1dGVkU3R5bGUoYixudWxsKTpiLmN1cnJlbnRTdHlsZSxsLT1iLnNjcm9sbFRvcCxtLT1iLnNjcm9sbExlZnQsYj09PWQmJihsKz1iLm9mZnNldFRvcCxtKz1iLm9mZnNldExlZnQsZi5vZmZzZXQuZG9lc05vdEFkZEJvcmRlciYmKCFmLm9mZnNldC5kb2VzQWRkQm9yZGVyRm9yVGFibGVBbmRDZWxsc3x8IWN0LnRlc3QoYi5ub2RlTmFtZSkpJiYobCs9cGFyc2VGbG9hdChjLmJvcmRlclRvcFdpZHRoKXx8MCxtKz1wYXJzZUZsb2F0KGMuYm9yZGVyTGVmdFdpZHRoKXx8MCksZT1kLGQ9Yi5vZmZzZXRQYXJlbnQpLGYub2Zmc2V0LnN1YnRyYWN0c0JvcmRlckZvck92ZXJmbG93Tm90VmlzaWJsZSYmYy5vdmVyZmxvdyE9PSJ2aXNpYmxlIiYmKGwrPXBhcnNlRmxvYXQoYy5ib3JkZXJUb3BXaWR0aCl8fDAsbSs9cGFyc2VGbG9hdChjLmJvcmRlckxlZnRXaWR0aCl8fDApLGs9Y31pZihrLnBvc2l0aW9uPT09InJlbGF0aXZlInx8ay5wb3NpdGlvbj09PSJzdGF0aWMiKWwrPWkub2Zmc2V0VG9wLG0rPWkub2Zmc2V0TGVmdDtmLm9mZnNldC5zdXBwb3J0c0ZpeGVkUG9zaXRpb24mJmsucG9zaXRpb249PT0iZml4ZWQiJiYobCs9TWF0aC5tYXgoaC5zY3JvbGxUb3AsaS5zY3JvbGxUb3ApLG0rPU1hdGgubWF4KGguc2Nyb2xsTGVmdCxpLnNjcm9sbExlZnQpKTtyZXR1cm57dG9wOmwsbGVmdDptfX0sZi5vZmZzZXQ9e2luaXRpYWxpemU6ZnVuY3Rpb24oKXt2YXIgYT1jLmJvZHksYj1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpLGQsZSxnLGgsaT1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpblRvcCIpKXx8MCxqPSI8ZGl2IHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7bWFyZ2luOjA7Ym9yZGVyOjVweCBzb2xpZCAjMDAwO3BhZGRpbmc6MDt3aWR0aDoxcHg7aGVpZ2h0OjFweDsnPjxkaXY+PC9kaXY+PC9kaXY+PHRhYmxlIHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7bWFyZ2luOjA7Ym9yZGVyOjVweCBzb2xpZCAjMDAwO3BhZGRpbmc6MDt3aWR0aDoxcHg7aGVpZ2h0OjFweDsnIGNlbGxwYWRkaW5nPScwJyBjZWxsc3BhY2luZz0nMCc+PHRyPjx0ZD48L3RkPjwvdHI+PC90YWJsZT4iO2YuZXh0ZW5kKGIuc3R5bGUse3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdG9wOjAsbGVmdDowLG1hcmdpbjowLGJvcmRlcjowLHdpZHRoOiIxcHgiLGhlaWdodDoiMXB4Iix2aXNpYmlsaXR5OiJoaWRkZW4ifSksYi5pbm5lckhUTUw9aixhLmluc2VydEJlZm9yZShiLGEuZmlyc3RDaGlsZCksZD1iLmZpcnN0Q2hpbGQsZT1kLmZpcnN0Q2hpbGQsaD1kLm5leHRTaWJsaW5nLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZCx0aGlzLmRvZXNOb3RBZGRCb3JkZXI9ZS5vZmZzZXRUb3AhPT01LHRoaXMuZG9lc0FkZEJvcmRlckZvclRhYmxlQW5kQ2VsbHM9aC5vZmZzZXRUb3A9PT01LGUuc3R5bGUucG9zaXRpb249ImZpeGVkIixlLnN0eWxlLnRvcD0iMjBweCIsdGhpcy5zdXBwb3J0c0ZpeGVkUG9zaXRpb249ZS5vZmZzZXRUb3A9PT0yMHx8ZS5vZmZzZXRUb3A9PT0xNSxlLnN0eWxlLnBvc2l0aW9uPWUuc3R5bGUudG9wPSIiLGQuc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIsZC5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiLHRoaXMuc3VidHJhY3RzQm9yZGVyRm9yT3ZlcmZsb3dOb3RWaXNpYmxlPWUub2Zmc2V0VG9wPT09LTUsdGhpcy5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldD1hLm9mZnNldFRvcCE9PWksYS5yZW1vdmVDaGlsZChiKSxmLm9mZnNldC5pbml0aWFsaXplPWYubm9vcH0sYm9keU9mZnNldDpmdW5jdGlvbihhKXt2YXIgYj1hLm9mZnNldFRvcCxjPWEub2Zmc2V0TGVmdDtmLm9mZnNldC5pbml0aWFsaXplKCksZi5vZmZzZXQuZG9lc05vdEluY2x1ZGVNYXJnaW5JbkJvZHlPZmZzZXQmJihiKz1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpblRvcCIpKXx8MCxjKz1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpbkxlZnQiKSl8fDApO3JldHVybnt0b3A6YixsZWZ0OmN9fSxzZXRPZmZzZXQ6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWYuY3NzKGEsInBvc2l0aW9uIik7ZD09PSJzdGF0aWMiJiYoYS5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiKTt2YXIgZT1mKGEpLGc9ZS5vZmZzZXQoKSxoPWYuY3NzKGEsInRvcCIpLGk9Zi5jc3MoYSwibGVmdCIpLGo9KGQ9PT0iYWJzb2x1dGUifHxkPT09ImZpeGVkIikmJmYuaW5BcnJheSgiYXV0byIsW2gsaV0pPi0xLGs9e30sbD17fSxtLG47aj8obD1lLnBvc2l0aW9uKCksbT1sLnRvcCxuPWwubGVmdCk6KG09cGFyc2VGbG9hdChoKXx8MCxuPXBhcnNlRmxvYXQoaSl8fDApLGYuaXNGdW5jdGlvbihiKSYmKGI9Yi5jYWxsKGEsYyxnKSksYi50b3AhPW51bGwmJihrLnRvcD1iLnRvcC1nLnRvcCttKSxiLmxlZnQhPW51bGwmJihrLmxlZnQ9Yi5sZWZ0LWcubGVmdCtuKSwidXNpbmciaW4gYj9iLnVzaW5nLmNhbGwoYSxrKTplLmNzcyhrKX19LGYuZm4uZXh0ZW5kKHtwb3NpdGlvbjpmdW5jdGlvbigpe2lmKCF0aGlzWzBdKXJldHVybiBudWxsO3ZhciBhPXRoaXNbMF0sYj10aGlzLm9mZnNldFBhcmVudCgpLGM9dGhpcy5vZmZzZXQoKSxkPWN1LnRlc3QoYlswXS5ub2RlTmFtZSk/e3RvcDowLGxlZnQ6MH06Yi5vZmZzZXQoKTtjLnRvcC09cGFyc2VGbG9hdChmLmNzcyhhLCJtYXJnaW5Ub3AiKSl8fDAsYy5sZWZ0LT1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpbkxlZnQiKSl8fDAsZC50b3ArPXBhcnNlRmxvYXQoZi5jc3MoYlswXSwiYm9yZGVyVG9wV2lkdGgiKSl8fDAsZC5sZWZ0Kz1wYXJzZUZsb2F0KGYuY3NzKGJbMF0sImJvcmRlckxlZnRXaWR0aCIpKXx8MDtyZXR1cm57dG9wOmMudG9wLWQudG9wLGxlZnQ6Yy5sZWZ0LWQubGVmdH19LG9mZnNldFBhcmVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3ZhciBhPXRoaXMub2Zmc2V0UGFyZW50fHxjLmJvZHk7d2hpbGUoYSYmIWN1LnRlc3QoYS5ub2RlTmFtZSkmJmYuY3NzKGEsInBvc2l0aW9uIik9PT0ic3RhdGljIilhPWEub2Zmc2V0UGFyZW50O3JldHVybiBhfSl9fSksZi5lYWNoKFsiTGVmdCIsIlRvcCJdLGZ1bmN0aW9uKGEsYyl7dmFyIGQ9InNjcm9sbCIrYztmLmZuW2RdPWZ1bmN0aW9uKGMpe3ZhciBlLGc7aWYoYz09PWIpe2U9dGhpc1swXTtpZighZSlyZXR1cm4gbnVsbDtnPWN2KGUpO3JldHVybiBnPyJwYWdlWE9mZnNldCJpbiBnP2dbYT8icGFnZVlPZmZzZXQiOiJwYWdlWE9mZnNldCJdOmYuc3VwcG9ydC5ib3hNb2RlbCYmZy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbZF18fGcuZG9jdW1lbnQuYm9keVtkXTplW2RdfXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtnPWN2KHRoaXMpLGc/Zy5zY3JvbGxUbyhhP2YoZykuc2Nyb2xsTGVmdCgpOmMsYT9jOmYoZykuc2Nyb2xsVG9wKCkpOnRoaXNbZF09Y30pfX0pLGYuZWFjaChbIkhlaWdodCIsIldpZHRoIl0sZnVuY3Rpb24oYSxjKXt2YXIgZD1jLnRvTG93ZXJDYXNlKCk7Zi5mblsiaW5uZXIiK2NdPWZ1bmN0aW9uKCl7dmFyIGE9dGhpc1swXTtyZXR1cm4gYSYmYS5zdHlsZT9wYXJzZUZsb2F0KGYuY3NzKGEsZCwicGFkZGluZyIpKTpudWxsfSxmLmZuWyJvdXRlciIrY109ZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXTtyZXR1cm4gYiYmYi5zdHlsZT9wYXJzZUZsb2F0KGYuY3NzKGIsZCxhPyJtYXJnaW4iOiJib3JkZXIiKSk6bnVsbH0sZi5mbltkXT1mdW5jdGlvbihhKXt2YXIgZT10aGlzWzBdO2lmKCFlKXJldHVybiBhPT1udWxsP251bGw6dGhpcztpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXt2YXIgYz1mKHRoaXMpO2NbZF0oYS5jYWxsKHRoaXMsYixjW2RdKCkpKX0pO2lmKGYuaXNXaW5kb3coZSkpe3ZhciBnPWUuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50WyJjbGllbnQiK2NdO3JldHVybiBlLmRvY3VtZW50LmNvbXBhdE1vZGU9PT0iQ1NTMUNvbXBhdCImJmd8fGUuZG9jdW1lbnQuYm9keVsiY2xpZW50IitjXXx8Z31pZihlLm5vZGVUeXBlPT09OSlyZXR1cm4gTWF0aC5tYXgoZS5kb2N1bWVudEVsZW1lbnRbImNsaWVudCIrY10sZS5ib2R5WyJzY3JvbGwiK2NdLGUuZG9jdW1lbnRFbGVtZW50WyJzY3JvbGwiK2NdLGUuYm9keVsib2Zmc2V0IitjXSxlLmRvY3VtZW50RWxlbWVudFsib2Zmc2V0IitjXSk7aWYoYT09PWIpe3ZhciBoPWYuY3NzKGUsZCksaT1wYXJzZUZsb2F0KGgpO3JldHVybiBmLmlzTmFOKGkpP2g6aX1yZXR1cm4gdGhpcy5jc3MoZCx0eXBlb2YgYT09InN0cmluZyI/YTphKyJweCIpfX0pLGEualF1ZXJ5PWEuJD1mfSkod2luZG93KTsoZnVuY3Rpb24oYyxqKXtmdW5jdGlvbiBrKGEsYil7dmFyIGQ9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmKCJhcmVhIj09PWQpe2I9YS5wYXJlbnROb2RlO2Q9Yi5uYW1lO2lmKCFhLmhyZWZ8fCFkfHxiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkhPT0ibWFwIilyZXR1cm4gZmFsc2U7YT1jKCJpbWdbdXNlbWFwPSMiK2QrIl0iKVswXTtyZXR1cm4hIWEmJmwoYSl9cmV0dXJuKC9pbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdC8udGVzdChkKT8hYS5kaXNhYmxlZDoiYSI9PWQ/YS5ocmVmfHxiOmIpJiZsKGEpfWZ1bmN0aW9uIGwoYSl7cmV0dXJuIWMoYSkucGFyZW50cygpLmFuZFNlbGYoKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gYy5jdXJDU1ModGhpcywidmlzaWJpbGl0eSIpPT09ImhpZGRlbiJ8fGMuZXhwci5maWx0ZXJzLmhpZGRlbih0aGlzKX0pLmxlbmd0aH1jLnVpPWMudWl8fHt9O2lmKCFjLnVpLnZlcnNpb24pe2MuZXh0ZW5kKGMudWkse3ZlcnNpb246IjEuOC4xNiIsa2V5Q29kZTp7QUxUOjE4LEJBQ0tTUEFDRTo4LENBUFNfTE9DSzoyMCxDT01NQToxODgsQ09NTUFORDo5MSxDT01NQU5EX0xFRlQ6OTEsQ09NTUFORF9SSUdIVDo5MyxDT05UUk9MOjE3LERFTEVURTo0NixET1dOOjQwLEVORDozNSxFTlRFUjoxMyxFU0NBUEU6MjcsSE9NRTozNixJTlNFUlQ6NDUsTEVGVDozNyxNRU5VOjkzLE5VTVBBRF9BREQ6MTA3LE5VTVBBRF9ERUNJTUFMOjExMCxOVU1QQURfRElWSURFOjExMSxOVU1QQURfRU5URVI6MTA4LE5VTVBBRF9NVUxUSVBMWToxMDYsTlVNUEFEX1NVQlRSQUNUOjEwOSxQQUdFX0RPV046MzQsUEFHRV9VUDozMyxQRVJJT0Q6MTkwLFJJR0hUOjM5LFNISUZUOjE2LFNQQUNFOjMyLFRBQjo5LFVQOjM4LFdJTkRPV1M6OTF9fSk7Yy5mbi5leHRlbmQoe3Byb3BBdHRyOmMuZm4ucHJvcHx8Yy5mbi5hdHRyLF9mb2N1czpjLmZuLmZvY3VzLGZvY3VzOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHR5cGVvZiBhPT09Im51bWJlciI/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9dGhpcztzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YyhkKS5mb2N1cygpO2ImJmIuY2FsbChkKX0sYSl9KTp0aGlzLl9mb2N1cy5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHNjcm9sbFBhcmVudDpmdW5jdGlvbigpe3ZhciBhO2E9Yy5icm93c2VyLm1zaWUmJi8oc3RhdGljfHJlbGF0aXZlKS8udGVzdCh0aGlzLmNzcygicG9zaXRpb24iKSl8fC9hYnNvbHV0ZS8udGVzdCh0aGlzLmNzcygicG9zaXRpb24iKSk/dGhpcy5wYXJlbnRzKCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuLyhyZWxhdGl2ZXxhYnNvbHV0ZXxmaXhlZCkvLnRlc3QoYy5jdXJDU1ModGhpcywicG9zaXRpb24iLDEpKSYmLyhhdXRvfHNjcm9sbCkvLnRlc3QoYy5jdXJDU1ModGhpcywib3ZlcmZsb3ciLDEpK2MuY3VyQ1NTKHRoaXMsIm92ZXJmbG93LXkiLDEpK2MuY3VyQ1NTKHRoaXMsIm92ZXJmbG93LXgiLDEpKX0pLmVxKDApOnRoaXMucGFyZW50cygpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybi8oYXV0b3xzY3JvbGwpLy50ZXN0KGMuY3VyQ1NTKHRoaXMsIm92ZXJmbG93IiwxKStjLmN1ckNTUyh0aGlzLCJvdmVyZmxvdy15IiwxKStjLmN1ckNTUyh0aGlzLCJvdmVyZmxvdy14IiwxKSl9KS5lcSgwKTtyZXR1cm4vZml4ZWQvLnRlc3QodGhpcy5jc3MoInBvc2l0aW9uIikpfHwhYS5sZW5ndGg/Yyhkb2N1bWVudCk6YX0sekluZGV4OmZ1bmN0aW9uKGEpe2lmKGEhPT1qKXJldHVybiB0aGlzLmNzcygiekluZGV4IixhKTtpZih0aGlzLmxlbmd0aCl7YT1jKHRoaXNbMF0pO2Zvcih2YXIgYjthLmxlbmd0aCYmYVswXSE9PWRvY3VtZW50Oyl7Yj1hLmNzcygicG9zaXRpb24iKTtpZihiPT09ImFic29sdXRlInx8Yj09PSJyZWxhdGl2ZSJ8fGI9PT0iZml4ZWQiKXtiPXBhcnNlSW50KGEuY3NzKCJ6SW5kZXgiKSwxMCk7aWYoIWlzTmFOKGIpJiZiIT09MClyZXR1cm4gYn1hPWEucGFyZW50KCl9fXJldHVybiAwfSxkaXNhYmxlU2VsZWN0aW9uOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYmluZCgoYy5zdXBwb3J0LnNlbGVjdHN0YXJ0PyJzZWxlY3RzdGFydCI6Im1vdXNlZG93biIpKyIudWktZGlzYWJsZVNlbGVjdGlvbiIsZnVuY3Rpb24oYSl7YS5wcmV2ZW50RGVmYXVsdCgpfSl9LGVuYWJsZVNlbGVjdGlvbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnVuYmluZCgiLnVpLWRpc2FibGVTZWxlY3Rpb24iKX19KTtjLmVhY2goWyJXaWR0aCIsIkhlaWdodCJdLGZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gZChmLGcsbSxuKXtjLmVhY2goZSxmdW5jdGlvbigpe2ctPXBhcnNlRmxvYXQoYy5jdXJDU1MoZiwicGFkZGluZyIrdGhpcyx0cnVlKSl8fDA7aWYobSlnLT1wYXJzZUZsb2F0KGMuY3VyQ1NTKGYsImJvcmRlciIrdGhpcysiV2lkdGgiLHRydWUpKXx8MDtpZihuKWctPXBhcnNlRmxvYXQoYy5jdXJDU1MoZiwibWFyZ2luIit0aGlzLHRydWUpKXx8MH0pO3JldHVybiBnfXZhciBlPWI9PT0iV2lkdGgiP1siTGVmdCIsIlJpZ2h0Il06WyJUb3AiLCJCb3R0b20iXSxoPWIudG9Mb3dlckNhc2UoKSxpPXtpbm5lcldpZHRoOmMuZm4uaW5uZXJXaWR0aCxpbm5lckhlaWdodDpjLmZuLmlubmVySGVpZ2h0LG91dGVyV2lkdGg6Yy5mbi5vdXRlcldpZHRoLG91dGVySGVpZ2h0OmMuZm4ub3V0ZXJIZWlnaHR9O2MuZm5bImlubmVyIitiXT1mdW5jdGlvbihmKXtpZihmPT09ailyZXR1cm4gaVsiaW5uZXIiK2JdLmNhbGwodGhpcyk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2ModGhpcykuY3NzKGgsZCh0aGlzLGYpKyJweCIpfSl9O2MuZm5bIm91dGVyIitiXT1mdW5jdGlvbihmLGcpe2lmKHR5cGVvZiBmIT09Im51bWJlciIpcmV0dXJuIGlbIm91dGVyIitiXS5jYWxsKHRoaXMsZik7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2ModGhpcykuY3NzKGgsZCh0aGlzLGYsdHJ1ZSxnKSsicHgiKX0pfX0pO2MuZXh0ZW5kKGMuZXhwclsiOiJdLHtkYXRhOmZ1bmN0aW9uKGEsYixkKXtyZXR1cm4hIWMuZGF0YShhLGRbM10pfSxmb2N1c2FibGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGsoYSwhaXNOYU4oYy5hdHRyKGEsInRhYmluZGV4IikpKX0sdGFiYmFibGU6ZnVuY3Rpb24oYSl7dmFyIGI9Yy5hdHRyKGEsInRhYmluZGV4IiksZD1pc05hTihiKTtyZXR1cm4oZHx8Yj49MCkmJmsoYSwhZCl9fSk7YyhmdW5jdGlvbigpe3ZhciBhPWRvY3VtZW50LmJvZHksYj1hLmFwcGVuZENoaWxkKGI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikpO2MuZXh0ZW5kKGIuc3R5bGUse21pbkhlaWdodDoiMTAwcHgiLGhlaWdodDoiYXV0byIscGFkZGluZzowLGJvcmRlcldpZHRoOjB9KTtjLnN1cHBvcnQubWluSGVpZ2h0PWIub2Zmc2V0SGVpZ2h0PT09MTAwO2Muc3VwcG9ydC5zZWxlY3RzdGFydD0ib25zZWxlY3RzdGFydCJpbiBiO2EucmVtb3ZlQ2hpbGQoYikuc3R5bGUuZGlzcGxheT0ibm9uZSJ9KTtjLmV4dGVuZChjLnVpLHtwbHVnaW46e2FkZDpmdW5jdGlvbihhLGIsZCl7YT1jLnVpW2FdLnByb3RvdHlwZTtmb3IodmFyIGUgaW4gZCl7YS5wbHVnaW5zW2VdPWEucGx1Z2luc1tlXXx8W107YS5wbHVnaW5zW2VdLnB1c2goW2IsZFtlXV0pfX0sY2FsbDpmdW5jdGlvbihhLGIsZCl7aWYoKGI9YS5wbHVnaW5zW2JdKSYmYS5lbGVtZW50WzBdLnBhcmVudE5vZGUpZm9yKHZhciBlPTA7ZTxiLmxlbmd0aDtlKyspYS5vcHRpb25zW2JbZV1bMF1dJiZiW2VdWzFdLmFwcGx5KGEuZWxlbWVudCxkKX19LGNvbnRhaW5zOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGRvY3VtZW50LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uP2EuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmMTY6YSE9PWImJmEuY29udGFpbnMoYil9LGhhc1Njcm9sbDpmdW5jdGlvbihhLGIpe2lmKGMoYSkuY3NzKCJvdmVyZmxvdyIpPT09ImhpZGRlbiIpcmV0dXJuIGZhbHNlO2I9YiYmYj09PSJsZWZ0Ij8ic2Nyb2xsTGVmdCI6InNjcm9sbFRvcCI7dmFyIGQ9ZmFsc2U7aWYoYVtiXT4wKXJldHVybiB0cnVlO2FbYl09MTtkPWFbYl0+MDthW2JdPTA7cmV0dXJuIGR9LGlzT3ZlckF4aXM6ZnVuY3Rpb24oYSxiLGQpe3JldHVybiBhPmImJmE8YitkfSxpc092ZXI6ZnVuY3Rpb24oYSxiLGQsZSxoLGkpe3JldHVybiBjLnVpLmlzT3ZlckF4aXMoYSxkLGgpJiZjLnVpLmlzT3ZlckF4aXMoYixlLGkpfX0pfX0pKGpRdWVyeSk7OyhmdW5jdGlvbihiLGope2lmKGIuY2xlYW5EYXRhKXt2YXIgaz1iLmNsZWFuRGF0YTtiLmNsZWFuRGF0YT1mdW5jdGlvbihhKXtmb3IodmFyIGM9MCxkOyhkPWFbY10pIT1udWxsO2MrKyl0cnl7YihkKS50cmlnZ2VySGFuZGxlcigicmVtb3ZlIil9Y2F0Y2goZSl7fWsoYSl9fWVsc2V7dmFyIGw9Yi5mbi5yZW1vdmU7Yi5mbi5yZW1vdmU9ZnVuY3Rpb24oYSxjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7aWYoIWMpaWYoIWF8fGIuZmlsdGVyKGEsW3RoaXNdKS5sZW5ndGgpYigiKiIsdGhpcykuYWRkKFt0aGlzXSkuZWFjaChmdW5jdGlvbigpe3RyeXtiKHRoaXMpLnRyaWdnZXJIYW5kbGVyKCJyZW1vdmUiKX1jYXRjaChkKXt9fSk7cmV0dXJuIGwuY2FsbChiKHRoaXMpLGEsYyl9KX19Yi53aWRnZXQ9ZnVuY3Rpb24oYSxjLGQpe3ZhciBlPWEuc3BsaXQoIi4iKVswXSxmO2E9YS5zcGxpdCgiLiIpWzFdO2Y9ZSsiLSIrYTtpZighZCl7ZD1jO2M9Yi5XaWRnZXR9Yi5leHByWyI6Il1bZl09ZnVuY3Rpb24oaCl7cmV0dXJuISFiLmRhdGEoaCxhKX07YltlXT1iW2VdfHx7fTtiW2VdW2FdPWZ1bmN0aW9uKGgsZyl7YXJndW1lbnRzLmxlbmd0aCYmdGhpcy5fY3JlYXRlV2lkZ2V0KGgsZyl9O2M9bmV3IGM7Yy5vcHRpb25zPWIuZXh0ZW5kKHRydWUse30sYy5vcHRpb25zKTtiW2VdW2FdLnByb3RvdHlwZT1iLmV4dGVuZCh0cnVlLGMse25hbWVzcGFjZTplLHdpZGdldE5hbWU6YSx3aWRnZXRFdmVudFByZWZpeDpiW2VdW2FdLnByb3RvdHlwZS53aWRnZXRFdmVudFByZWZpeHx8YSx3aWRnZXRCYXNlQ2xhc3M6Zn0sZCk7Yi53aWRnZXQuYnJpZGdlKGEsYltlXVthXSl9O2Iud2lkZ2V0LmJyaWRnZT1mdW5jdGlvbihhLGMpe2IuZm5bYV09ZnVuY3Rpb24oZCl7dmFyIGU9dHlwZW9mIGQ9PT0ic3RyaW5nIixmPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSxoPXRoaXM7ZD0hZSYmZi5sZW5ndGg/Yi5leHRlbmQuYXBwbHkobnVsbCxbdHJ1ZSxkXS5jb25jYXQoZikpOmQ7aWYoZSYmZC5jaGFyQXQoMCk9PT0iXyIpcmV0dXJuIGg7ZT90aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZz1iLmRhdGEodGhpcyxhKSxpPWcmJmIuaXNGdW5jdGlvbihnW2RdKT9nW2RdLmFwcGx5KGcsZik6ZztpZihpIT09ZyYmaSE9PWope2g9aTtyZXR1cm4gZmFsc2V9fSk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGc9Yi5kYXRhKHRoaXMsYSk7Zz9nLm9wdGlvbihkfHx7fSkuX2luaXQoKTpiLmRhdGEodGhpcyxhLG5ldyBjKGQsdGhpcykpfSk7cmV0dXJuIGh9fTtiLldpZGdldD1mdW5jdGlvbihhLGMpe2FyZ3VtZW50cy5sZW5ndGgmJnRoaXMuX2NyZWF0ZVdpZGdldChhLGMpfTtiLldpZGdldC5wcm90b3R5cGU9e3dpZGdldE5hbWU6IndpZGdldCIsd2lkZ2V0RXZlbnRQcmVmaXg6IiIsb3B0aW9uczp7ZGlzYWJsZWQ6ZmFsc2V9LF9jcmVhdGVXaWRnZXQ6ZnVuY3Rpb24oYSxjKXtiLmRhdGEoYyx0aGlzLndpZGdldE5hbWUsdGhpcyk7dGhpcy5lbGVtZW50PWIoYyk7dGhpcy5vcHRpb25zPWIuZXh0ZW5kKHRydWUse30sdGhpcy5vcHRpb25zLHRoaXMuX2dldENyZWF0ZU9wdGlvbnMoKSxhKTt2YXIgZD10aGlzO3RoaXMuZWxlbWVudC5iaW5kKCJyZW1vdmUuIit0aGlzLndpZGdldE5hbWUsZnVuY3Rpb24oKXtkLmRlc3Ryb3koKX0pO3RoaXMuX2NyZWF0ZSgpO3RoaXMuX3RyaWdnZXIoImNyZWF0ZSIpO3RoaXMuX2luaXQoKX0sX2dldENyZWF0ZU9wdGlvbnM6ZnVuY3Rpb24oKXtyZXR1cm4gYi5tZXRhZGF0YSYmYi5tZXRhZGF0YS5nZXQodGhpcy5lbGVtZW50WzBdKVt0aGlzLndpZGdldE5hbWVdfSxfY3JlYXRlOmZ1bmN0aW9uKCl7fSxfaW5pdDpmdW5jdGlvbigpe30sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC51bmJpbmQoIi4iK3RoaXMud2lkZ2V0TmFtZSkucmVtb3ZlRGF0YSh0aGlzLndpZGdldE5hbWUpO3RoaXMud2lkZ2V0KCkudW5iaW5kKCIuIit0aGlzLndpZGdldE5hbWUpLnJlbW92ZUF0dHIoImFyaWEtZGlzYWJsZWQiKS5yZW1vdmVDbGFzcyh0aGlzLndpZGdldEJhc2VDbGFzcysiLWRpc2FibGVkIHVpLXN0YXRlLWRpc2FibGVkIil9LHdpZGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnR9LG9wdGlvbjpmdW5jdGlvbihhLGMpe3ZhciBkPWE7aWYoYXJndW1lbnRzLmxlbmd0aD09PTApcmV0dXJuIGIuZXh0ZW5kKHt9LHRoaXMub3B0aW9ucyk7aWYodHlwZW9mIGE9PT0ic3RyaW5nIil7aWYoYz09PWopcmV0dXJuIHRoaXMub3B0aW9uc1thXTtkPXt9O2RbYV09Y310aGlzLl9zZXRPcHRpb25zKGQpO3JldHVybiB0aGlzfSxfc2V0T3B0aW9uczpmdW5jdGlvbihhKXt2YXIgYz10aGlzO2IuZWFjaChhLGZ1bmN0aW9uKGQsZSl7Yy5fc2V0T3B0aW9uKGQsZSl9KTtyZXR1cm4gdGhpc30sX3NldE9wdGlvbjpmdW5jdGlvbihhLGMpe3RoaXMub3B0aW9uc1thXT1jO2lmKGE9PT0iZGlzYWJsZWQiKXRoaXMud2lkZ2V0KClbYz8iYWRkQ2xhc3MiOiJyZW1vdmVDbGFzcyJdKHRoaXMud2lkZ2V0QmFzZUNsYXNzKyItZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWQiKS5hdHRyKCJhcmlhLWRpc2FibGVkIixjKTtyZXR1cm4gdGhpc30sZW5hYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3NldE9wdGlvbigiZGlzYWJsZWQiLGZhbHNlKX0sZGlzYWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zZXRPcHRpb24oImRpc2FibGVkIix0cnVlKX0sX3RyaWdnZXI6ZnVuY3Rpb24oYSxjLGQpe3ZhciBlPXRoaXMub3B0aW9uc1thXTtjPWIuRXZlbnQoYyk7Yy50eXBlPShhPT09dGhpcy53aWRnZXRFdmVudFByZWZpeD9hOnRoaXMud2lkZ2V0RXZlbnRQcmVmaXgrYSkudG9Mb3dlckNhc2UoKTtkPWR8fHt9O2lmKGMub3JpZ2luYWxFdmVudCl7YT1iLmV2ZW50LnByb3BzLmxlbmd0aDtmb3IodmFyIGY7YTspe2Y9Yi5ldmVudC5wcm9wc1stLWFdO2NbZl09Yy5vcmlnaW5hbEV2ZW50W2ZdfX10aGlzLmVsZW1lbnQudHJpZ2dlcihjLGQpO3JldHVybiEoYi5pc0Z1bmN0aW9uKGUpJiZlLmNhbGwodGhpcy5lbGVtZW50WzBdLGMsZCk9PT1mYWxzZXx8Yy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl9fX0pKGpRdWVyeSk7OyhmdW5jdGlvbihiKXt2YXIgZD1mYWxzZTtiKGRvY3VtZW50KS5tb3VzZXVwKGZ1bmN0aW9uKCl7ZD1mYWxzZX0pO2Iud2lkZ2V0KCJ1aS5tb3VzZSIse29wdGlvbnM6e2NhbmNlbDoiOmlucHV0LG9wdGlvbiIsZGlzdGFuY2U6MSxkZWxheTowfSxfbW91c2VJbml0OmZ1bmN0aW9uKCl7dmFyIGE9dGhpczt0aGlzLmVsZW1lbnQuYmluZCgibW91c2Vkb3duLiIrdGhpcy53aWRnZXROYW1lLGZ1bmN0aW9uKGMpe3JldHVybiBhLl9tb3VzZURvd24oYyl9KS5iaW5kKCJjbGljay4iK3RoaXMud2lkZ2V0TmFtZSxmdW5jdGlvbihjKXtpZih0cnVlPT09Yi5kYXRhKGMudGFyZ2V0LGEud2lkZ2V0TmFtZSsiLnByZXZlbnRDbGlja0V2ZW50Iikpe2IucmVtb3ZlRGF0YShjLnRhcmdldCxhLndpZGdldE5hbWUrIi5wcmV2ZW50Q2xpY2tFdmVudCIpO2Muc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7cmV0dXJuIGZhbHNlfX0pO3RoaXMuc3RhcnRlZD1mYWxzZX0sX21vdXNlRGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC51bmJpbmQoIi4iKwp0aGlzLndpZGdldE5hbWUpfSxfbW91c2VEb3duOmZ1bmN0aW9uKGEpe2lmKCFkKXt0aGlzLl9tb3VzZVN0YXJ0ZWQmJnRoaXMuX21vdXNlVXAoYSk7dGhpcy5fbW91c2VEb3duRXZlbnQ9YTt2YXIgYz10aGlzLGY9YS53aGljaD09MSxnPXR5cGVvZiB0aGlzLm9wdGlvbnMuY2FuY2VsPT0ic3RyaW5nIiYmYS50YXJnZXQubm9kZU5hbWU/YihhLnRhcmdldCkuY2xvc2VzdCh0aGlzLm9wdGlvbnMuY2FuY2VsKS5sZW5ndGg6ZmFsc2U7aWYoIWZ8fGd8fCF0aGlzLl9tb3VzZUNhcHR1cmUoYSkpcmV0dXJuIHRydWU7dGhpcy5tb3VzZURlbGF5TWV0PSF0aGlzLm9wdGlvbnMuZGVsYXk7aWYoIXRoaXMubW91c2VEZWxheU1ldCl0aGlzLl9tb3VzZURlbGF5VGltZXI9c2V0VGltZW91dChmdW5jdGlvbigpe2MubW91c2VEZWxheU1ldD10cnVlfSx0aGlzLm9wdGlvbnMuZGVsYXkpO2lmKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoYSkmJnRoaXMuX21vdXNlRGVsYXlNZXQoYSkpe3RoaXMuX21vdXNlU3RhcnRlZD10aGlzLl9tb3VzZVN0YXJ0KGEpIT09ZmFsc2U7aWYoIXRoaXMuX21vdXNlU3RhcnRlZCl7YS5wcmV2ZW50RGVmYXVsdCgpO3JldHVybiB0cnVlfX10cnVlPT09Yi5kYXRhKGEudGFyZ2V0LHRoaXMud2lkZ2V0TmFtZSsiLnByZXZlbnRDbGlja0V2ZW50IikmJmIucmVtb3ZlRGF0YShhLnRhcmdldCx0aGlzLndpZGdldE5hbWUrIi5wcmV2ZW50Q2xpY2tFdmVudCIpO3RoaXMuX21vdXNlTW92ZURlbGVnYXRlPWZ1bmN0aW9uKGUpe3JldHVybiBjLl9tb3VzZU1vdmUoZSl9O3RoaXMuX21vdXNlVXBEZWxlZ2F0ZT1mdW5jdGlvbihlKXtyZXR1cm4gYy5fbW91c2VVcChlKX07Yihkb2N1bWVudCkuYmluZCgibW91c2Vtb3ZlLiIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlTW92ZURlbGVnYXRlKS5iaW5kKCJtb3VzZXVwLiIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSk7YS5wcmV2ZW50RGVmYXVsdCgpO3JldHVybiBkPXRydWV9fSxfbW91c2VNb3ZlOmZ1bmN0aW9uKGEpe2lmKGIuYnJvd3Nlci5tc2llJiYhKGRvY3VtZW50LmRvY3VtZW50TW9kZT49OSkmJiFhLmJ1dHRvbilyZXR1cm4gdGhpcy5fbW91c2VVcChhKTtpZih0aGlzLl9tb3VzZVN0YXJ0ZWQpe3RoaXMuX21vdXNlRHJhZyhhKTtyZXR1cm4gYS5wcmV2ZW50RGVmYXVsdCgpfWlmKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoYSkmJnRoaXMuX21vdXNlRGVsYXlNZXQoYSkpKHRoaXMuX21vdXNlU3RhcnRlZD10aGlzLl9tb3VzZVN0YXJ0KHRoaXMuX21vdXNlRG93bkV2ZW50LGEpIT09ZmFsc2UpP3RoaXMuX21vdXNlRHJhZyhhKTp0aGlzLl9tb3VzZVVwKGEpO3JldHVybiF0aGlzLl9tb3VzZVN0YXJ0ZWR9LF9tb3VzZVVwOmZ1bmN0aW9uKGEpe2IoZG9jdW1lbnQpLnVuYmluZCgibW91c2Vtb3ZlLiIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlTW92ZURlbGVnYXRlKS51bmJpbmQoIm1vdXNldXAuIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VVcERlbGVnYXRlKTtpZih0aGlzLl9tb3VzZVN0YXJ0ZWQpe3RoaXMuX21vdXNlU3RhcnRlZD1mYWxzZTthLnRhcmdldD09dGhpcy5fbW91c2VEb3duRXZlbnQudGFyZ2V0JiZiLmRhdGEoYS50YXJnZXQsdGhpcy53aWRnZXROYW1lKyIucHJldmVudENsaWNrRXZlbnQiLHRydWUpO3RoaXMuX21vdXNlU3RvcChhKX1yZXR1cm4gZmFsc2V9LF9tb3VzZURpc3RhbmNlTWV0OmZ1bmN0aW9uKGEpe3JldHVybiBNYXRoLm1heChNYXRoLmFicyh0aGlzLl9tb3VzZURvd25FdmVudC5wYWdlWC1hLnBhZ2VYKSxNYXRoLmFicyh0aGlzLl9tb3VzZURvd25FdmVudC5wYWdlWS1hLnBhZ2VZKSk+PXRoaXMub3B0aW9ucy5kaXN0YW5jZX0sX21vdXNlRGVsYXlNZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tb3VzZURlbGF5TWV0fSxfbW91c2VTdGFydDpmdW5jdGlvbigpe30sX21vdXNlRHJhZzpmdW5jdGlvbigpe30sX21vdXNlU3RvcDpmdW5jdGlvbigpe30sX21vdXNlQ2FwdHVyZTpmdW5jdGlvbigpe3JldHVybiB0cnVlfX0pfSkoalF1ZXJ5KTs7KGZ1bmN0aW9uKGQpe2Qud2lkZ2V0KCJ1aS5kcmFnZ2FibGUiLGQudWkubW91c2Use3dpZGdldEV2ZW50UHJlZml4OiJkcmFnIixvcHRpb25zOnthZGRDbGFzc2VzOnRydWUsYXBwZW5kVG86InBhcmVudCIsYXhpczpmYWxzZSxjb25uZWN0VG9Tb3J0YWJsZTpmYWxzZSxjb250YWlubWVudDpmYWxzZSxjdXJzb3I6ImF1dG8iLGN1cnNvckF0OmZhbHNlLGdyaWQ6ZmFsc2UsaGFuZGxlOmZhbHNlLGhlbHBlcjoib3JpZ2luYWwiLGlmcmFtZUZpeDpmYWxzZSxvcGFjaXR5OmZhbHNlLHJlZnJlc2hQb3NpdGlvbnM6ZmFsc2UscmV2ZXJ0OmZhbHNlLHJldmVydER1cmF0aW9uOjUwMCxzY29wZToiZGVmYXVsdCIsc2Nyb2xsOnRydWUsc2Nyb2xsU2Vuc2l0aXZpdHk6MjAsc2Nyb2xsU3BlZWQ6MjAsc25hcDpmYWxzZSxzbmFwTW9kZToiYm90aCIsc25hcFRvbGVyYW5jZToyMCxzdGFjazpmYWxzZSx6SW5kZXg6ZmFsc2V9LF9jcmVhdGU6ZnVuY3Rpb24oKXtpZih0aGlzLm9wdGlvbnMuaGVscGVyPT0ib3JpZ2luYWwiJiYhL14oPzpyfGF8ZikvLnRlc3QodGhpcy5lbGVtZW50LmNzcygicG9zaXRpb24iKSkpdGhpcy5lbGVtZW50WzBdLnN0eWxlLnBvc2l0aW9uPSJyZWxhdGl2ZSI7dGhpcy5vcHRpb25zLmFkZENsYXNzZXMmJnRoaXMuZWxlbWVudC5hZGRDbGFzcygidWktZHJhZ2dhYmxlIik7dGhpcy5vcHRpb25zLmRpc2FibGVkJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLWRyYWdnYWJsZS1kaXNhYmxlZCIpO3RoaXMuX21vdXNlSW5pdCgpfSxkZXN0cm95OmZ1bmN0aW9uKCl7aWYodGhpcy5lbGVtZW50LmRhdGEoImRyYWdnYWJsZSIpKXt0aGlzLmVsZW1lbnQucmVtb3ZlRGF0YSgiZHJhZ2dhYmxlIikudW5iaW5kKCIuZHJhZ2dhYmxlIikucmVtb3ZlQ2xhc3MoInVpLWRyYWdnYWJsZSB1aS1kcmFnZ2FibGUtZHJhZ2dpbmcgdWktZHJhZ2dhYmxlLWRpc2FibGVkIik7dGhpcy5fbW91c2VEZXN0cm95KCk7cmV0dXJuIHRoaXN9fSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMub3B0aW9ucztpZih0aGlzLmhlbHBlcnx8Yi5kaXNhYmxlZHx8ZChhLnRhcmdldCkuaXMoIi51aS1yZXNpemFibGUtaGFuZGxlIikpcmV0dXJuIGZhbHNlO3RoaXMuaGFuZGxlPXRoaXMuX2dldEhhbmRsZShhKTtpZighdGhpcy5oYW5kbGUpcmV0dXJuIGZhbHNlO2lmKGIuaWZyYW1lRml4KWQoYi5pZnJhbWVGaXg9PT10cnVlPyJpZnJhbWUiOmIuaWZyYW1lRml4KS5lYWNoKGZ1bmN0aW9uKCl7ZCgnPGRpdiBjbGFzcz0idWktZHJhZ2dhYmxlLWlmcmFtZUZpeCIgc3R5bGU9ImJhY2tncm91bmQ6ICNmZmY7Ij48L2Rpdj4nKS5jc3Moe3dpZHRoOnRoaXMub2Zmc2V0V2lkdGgrInB4IixoZWlnaHQ6dGhpcy5vZmZzZXRIZWlnaHQrInB4Iixwb3NpdGlvbjoiYWJzb2x1dGUiLG9wYWNpdHk6IjAuMDAxIix6SW5kZXg6MUUzfSkuY3NzKGQodGhpcykub2Zmc2V0KCkpLmFwcGVuZFRvKCJib2R5Iil9KTtyZXR1cm4gdHJ1ZX0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5vcHRpb25zO3RoaXMuaGVscGVyPXRoaXMuX2NyZWF0ZUhlbHBlcihhKTt0aGlzLl9jYWNoZUhlbHBlclByb3BvcnRpb25zKCk7aWYoZC51aS5kZG1hbmFnZXIpZC51aS5kZG1hbmFnZXIuY3VycmVudD10aGlzO3RoaXMuX2NhY2hlTWFyZ2lucygpO3RoaXMuY3NzUG9zaXRpb249dGhpcy5oZWxwZXIuY3NzKCJwb3NpdGlvbiIpO3RoaXMuc2Nyb2xsUGFyZW50PXRoaXMuaGVscGVyLnNjcm9sbFBhcmVudCgpO3RoaXMub2Zmc2V0PXRoaXMucG9zaXRpb25BYnM9dGhpcy5lbGVtZW50Lm9mZnNldCgpO3RoaXMub2Zmc2V0PXt0b3A6dGhpcy5vZmZzZXQudG9wLXRoaXMubWFyZ2lucy50b3AsbGVmdDp0aGlzLm9mZnNldC5sZWZ0LXRoaXMubWFyZ2lucy5sZWZ0fTtkLmV4dGVuZCh0aGlzLm9mZnNldCx7Y2xpY2s6e2xlZnQ6YS5wYWdlWC10aGlzLm9mZnNldC5sZWZ0LHRvcDphLnBhZ2VZLXRoaXMub2Zmc2V0LnRvcH0scGFyZW50OnRoaXMuX2dldFBhcmVudE9mZnNldCgpLHJlbGF0aXZlOnRoaXMuX2dldFJlbGF0aXZlT2Zmc2V0KCl9KTt0aGlzLm9yaWdpbmFsUG9zaXRpb249dGhpcy5wb3NpdGlvbj10aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKGEpO3RoaXMub3JpZ2luYWxQYWdlWD1hLnBhZ2VYO3RoaXMub3JpZ2luYWxQYWdlWT1hLnBhZ2VZO2IuY3Vyc29yQXQmJnRoaXMuX2FkanVzdE9mZnNldEZyb21IZWxwZXIoYi5jdXJzb3JBdCk7Yi5jb250YWlubWVudCYmdGhpcy5fc2V0Q29udGFpbm1lbnQoKTtpZih0aGlzLl90cmlnZ2VyKCJzdGFydCIsYSk9PT1mYWxzZSl7dGhpcy5fY2xlYXIoKTtyZXR1cm4gZmFsc2V9dGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpO2QudWkuZGRtYW5hZ2VyJiYhYi5kcm9wQmVoYXZpb3VyJiZkLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLGEpO3RoaXMuaGVscGVyLmFkZENsYXNzKCJ1aS1kcmFnZ2FibGUtZHJhZ2dpbmciKTt0aGlzLl9tb3VzZURyYWcoYSx0cnVlKTtkLnVpLmRkbWFuYWdlciYmZC51aS5kZG1hbmFnZXIuZHJhZ1N0YXJ0KHRoaXMsYSk7cmV0dXJuIHRydWV9LF9tb3VzZURyYWc6ZnVuY3Rpb24oYSxiKXt0aGlzLnBvc2l0aW9uPXRoaXMuX2dlbmVyYXRlUG9zaXRpb24oYSk7dGhpcy5wb3NpdGlvbkFicz10aGlzLl9jb252ZXJ0UG9zaXRpb25UbygiYWJzb2x1dGUiKTtpZighYil7Yj10aGlzLl91aUhhc2goKTtpZih0aGlzLl90cmlnZ2VyKCJkcmFnIixhLGIpPT09ZmFsc2Upe3RoaXMuX21vdXNlVXAoe30pO3JldHVybiBmYWxzZX10aGlzLnBvc2l0aW9uPWIucG9zaXRpb259aWYoIXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLm9wdGlvbnMuYXhpcyE9InkiKXRoaXMuaGVscGVyWzBdLnN0eWxlLmxlZnQ9dGhpcy5wb3NpdGlvbi5sZWZ0KyJweCI7aWYoIXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLm9wdGlvbnMuYXhpcyE9IngiKXRoaXMuaGVscGVyWzBdLnN0eWxlLnRvcD10aGlzLnBvc2l0aW9uLnRvcCsicHgiO2QudWkuZGRtYW5hZ2VyJiZkLnVpLmRkbWFuYWdlci5kcmFnKHRoaXMsYSk7cmV0dXJuIGZhbHNlfSxfbW91c2VTdG9wOmZ1bmN0aW9uKGEpe3ZhciBiPWZhbHNlO2lmKGQudWkuZGRtYW5hZ2VyJiYhdGhpcy5vcHRpb25zLmRyb3BCZWhhdmlvdXIpYj1kLnVpLmRkbWFuYWdlci5kcm9wKHRoaXMsYSk7aWYodGhpcy5kcm9wcGVkKXtiPXRoaXMuZHJvcHBlZDt0aGlzLmRyb3BwZWQ9ZmFsc2V9aWYoKCF0aGlzLmVsZW1lbnRbMF18fCF0aGlzLmVsZW1lbnRbMF0ucGFyZW50Tm9kZSkmJnRoaXMub3B0aW9ucy5oZWxwZXI9PSJvcmlnaW5hbCIpcmV0dXJuIGZhbHNlO2lmKHRoaXMub3B0aW9ucy5yZXZlcnQ9PSJpbnZhbGlkIiYmIWJ8fHRoaXMub3B0aW9ucy5yZXZlcnQ9PSJ2YWxpZCImJmJ8fHRoaXMub3B0aW9ucy5yZXZlcnQ9PT10cnVlfHxkLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLnJldmVydCkmJnRoaXMub3B0aW9ucy5yZXZlcnQuY2FsbCh0aGlzLmVsZW1lbnQsYikpe3ZhciBjPXRoaXM7ZCh0aGlzLmhlbHBlcikuYW5pbWF0ZSh0aGlzLm9yaWdpbmFsUG9zaXRpb24scGFyc2VJbnQodGhpcy5vcHRpb25zLnJldmVydER1cmF0aW9uLDEwKSxmdW5jdGlvbigpe2MuX3RyaWdnZXIoInN0b3AiLGEpIT09ZmFsc2UmJmMuX2NsZWFyKCl9KX1lbHNlIHRoaXMuX3RyaWdnZXIoInN0b3AiLGEpIT09ZmFsc2UmJnRoaXMuX2NsZWFyKCk7cmV0dXJuIGZhbHNlfSxfbW91c2VVcDpmdW5jdGlvbihhKXt0aGlzLm9wdGlvbnMuaWZyYW1lRml4PT09dHJ1ZSYmZCgiZGl2LnVpLWRyYWdnYWJsZS1pZnJhbWVGaXgiKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMpfSk7ZC51aS5kZG1hbmFnZXImJmQudWkuZGRtYW5hZ2VyLmRyYWdTdG9wKHRoaXMsYSk7cmV0dXJuIGQudWkubW91c2UucHJvdG90eXBlLl9tb3VzZVVwLmNhbGwodGhpcyxhKX0sY2FuY2VsOmZ1bmN0aW9uKCl7dGhpcy5oZWxwZXIuaXMoIi51aS1kcmFnZ2FibGUtZHJhZ2dpbmciKT90aGlzLl9tb3VzZVVwKHt9KTp0aGlzLl9jbGVhcigpO3JldHVybiB0aGlzfSxfZ2V0SGFuZGxlOmZ1bmN0aW9uKGEpe3ZhciBiPSF0aGlzLm9wdGlvbnMuaGFuZGxlfHwhZCh0aGlzLm9wdGlvbnMuaGFuZGxlLHRoaXMuZWxlbWVudCkubGVuZ3RoP3RydWU6ZmFsc2U7ZCh0aGlzLm9wdGlvbnMuaGFuZGxlLHRoaXMuZWxlbWVudCkuZmluZCgiKiIpLmFuZFNlbGYoKS5lYWNoKGZ1bmN0aW9uKCl7aWYodGhpcz09YS50YXJnZXQpYj10cnVlfSk7cmV0dXJuIGJ9LF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5vcHRpb25zO2E9ZC5pc0Z1bmN0aW9uKGIuaGVscGVyKT9kKGIuaGVscGVyLmFwcGx5KHRoaXMuZWxlbWVudFswXSxbYV0pKTpiLmhlbHBlcj09ImNsb25lIj90aGlzLmVsZW1lbnQuY2xvbmUoKS5yZW1vdmVBdHRyKCJpZCIpOnRoaXMuZWxlbWVudDthLnBhcmVudHMoImJvZHkiKS5sZW5ndGh8fGEuYXBwZW5kVG8oYi5hcHBlbmRUbz09InBhcmVudCI/dGhpcy5lbGVtZW50WzBdLnBhcmVudE5vZGU6Yi5hcHBlbmRUbyk7YVswXSE9dGhpcy5lbGVtZW50WzBdJiYhLyhmaXhlZHxhYnNvbHV0ZSkvLnRlc3QoYS5jc3MoInBvc2l0aW9uIikpJiZhLmNzcygicG9zaXRpb24iLCJhYnNvbHV0ZSIpO3JldHVybiBhfSxfYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcjpmdW5jdGlvbihhKXtpZih0eXBlb2YgYT09InN0cmluZyIpYT1hLnNwbGl0KCIgIik7aWYoZC5pc0FycmF5KGEpKWE9e2xlZnQ6K2FbMF0sdG9wOithWzFdfHwwfTtpZigibGVmdCJpbiBhKXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ9YS5sZWZ0K3RoaXMubWFyZ2lucy5sZWZ0O2lmKCJyaWdodCJpbiBhKXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC1hLnJpZ2h0K3RoaXMubWFyZ2lucy5sZWZ0O2lmKCJ0b3AiaW4gYSl0aGlzLm9mZnNldC5jbGljay50b3A9YS50b3ArdGhpcy5tYXJnaW5zLnRvcDtpZigiYm90dG9tImluIGEpdGhpcy5vZmZzZXQuY2xpY2sudG9wPXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LWEuYm90dG9tK3RoaXMubWFyZ2lucy50b3B9LF9nZXRQYXJlbnRPZmZzZXQ6ZnVuY3Rpb24oKXt0aGlzLm9mZnNldFBhcmVudD10aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKTt2YXIgYT10aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKTtpZih0aGlzLmNzc1Bvc2l0aW9uPT0iYWJzb2x1dGUiJiZ0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmQudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pKXthLmxlZnQrPXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTthLnRvcCs9dGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCl9aWYodGhpcy5vZmZzZXRQYXJlbnRbMF09PWRvY3VtZW50LmJvZHl8fHRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUmJnRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUudG9Mb3dlckNhc2UoKT09Imh0bWwiJiZkLmJyb3dzZXIubXNpZSlhPXt0b3A6MCxsZWZ0OjB9O3JldHVybnt0b3A6YS50b3ArKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcygiYm9yZGVyVG9wV2lkdGgiKSwxMCl8fDApLGxlZnQ6YS5sZWZ0KyhwYXJzZUludCh0aGlzLm9mZnNldFBhcmVudC5jc3MoImJvcmRlckxlZnRXaWR0aCIpLDEwKXx8MCl9fSxfZ2V0UmVsYXRpdmVPZmZzZXQ6ZnVuY3Rpb24oKXtpZih0aGlzLmNzc1Bvc2l0aW9uPT0icmVsYXRpdmUiKXt2YXIgYT10aGlzLmVsZW1lbnQucG9zaXRpb24oKTtyZXR1cm57dG9wOmEudG9wLShwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoInRvcCIpLDEwKXx8MCkrdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCksbGVmdDphLmxlZnQtKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcygibGVmdCIpLDEwKXx8MCkrdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpfX1lbHNlIHJldHVybnt0b3A6MCxsZWZ0OjB9fSxfY2FjaGVNYXJnaW5zOmZ1bmN0aW9uKCl7dGhpcy5tYXJnaW5zPXtsZWZ0OnBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpbkxlZnQiKSwxMCl8fDAsdG9wOnBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpblRvcCIpLDEwKXx8MCxyaWdodDpwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKCJtYXJnaW5SaWdodCIpLDEwKXx8MCxib3R0b206cGFyc2VJbnQodGhpcy5lbGVtZW50LmNzcygibWFyZ2luQm90dG9tIiksMTApfHwwfX0sX2NhY2hlSGVscGVyUHJvcG9ydGlvbnM6ZnVuY3Rpb24oKXt0aGlzLmhlbHBlclByb3BvcnRpb25zPXt3aWR0aDp0aGlzLmhlbHBlci5vdXRlcldpZHRoKCksaGVpZ2h0OnRoaXMuaGVscGVyLm91dGVySGVpZ2h0KCl9fSxfc2V0Q29udGFpbm1lbnQ6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnM7aWYoYS5jb250YWlubWVudD09InBhcmVudCIpYS5jb250YWlubWVudD10aGlzLmhlbHBlclswXS5wYXJlbnROb2RlO2lmKGEuY29udGFpbm1lbnQ9PSJkb2N1bWVudCJ8fGEuY29udGFpbm1lbnQ9PSJ3aW5kb3ciKXRoaXMuY29udGFpbm1lbnQ9W2EuY29udGFpbm1lbnQ9PSJkb2N1bWVudCI/MDpkKHdpbmRvdykuc2Nyb2xsTGVmdCgpLXRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQtdGhpcy5vZmZzZXQucGFyZW50LmxlZnQsYS5jb250YWlubWVudD09ImRvY3VtZW50Ij8wOmQod2luZG93KS5zY3JvbGxUb3AoKS10aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcCwoYS5jb250YWlubWVudD09ImRvY3VtZW50Ij8wOmQod2luZG93KS5zY3JvbGxMZWZ0KCkpK2QoYS5jb250YWlubWVudD09ImRvY3VtZW50Ij9kb2N1bWVudDp3aW5kb3cpLndpZHRoKCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdCwoYS5jb250YWlubWVudD09ImRvY3VtZW50Ij8wOmQod2luZG93KS5zY3JvbGxUb3AoKSkrKGQoYS5jb250YWlubWVudD09ImRvY3VtZW50Ij9kb2N1bWVudDp3aW5kb3cpLmhlaWdodCgpfHxkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wXTtpZighL14oZG9jdW1lbnR8d2luZG93fHBhcmVudCkkLy50ZXN0KGEuY29udGFpbm1lbnQpJiZhLmNvbnRhaW5tZW50LmNvbnN0cnVjdG9yIT1BcnJheSl7YT1kKGEuY29udGFpbm1lbnQpO3ZhciBiPWFbMF07aWYoYil7YS5vZmZzZXQoKTt2YXIgYz1kKGIpLmNzcygib3ZlcmZsb3ciKSE9ImhpZGRlbiI7dGhpcy5jb250YWlubWVudD1bKHBhcnNlSW50KGQoYikuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwxMCl8fDApKyhwYXJzZUludChkKGIpLmNzcygicGFkZGluZ0xlZnQiKSwxMCl8fDApLChwYXJzZUludChkKGIpLmNzcygiYm9yZGVyVG9wV2lkdGgiKSwxMCl8fDApKyhwYXJzZUludChkKGIpLmNzcygicGFkZGluZ1RvcCIpLDEwKXx8MCksKGM/TWF0aC5tYXgoYi5zY3JvbGxXaWR0aCxiLm9mZnNldFdpZHRoKTpiLm9mZnNldFdpZHRoKS0ocGFyc2VJbnQoZChiKS5jc3MoImJvcmRlckxlZnRXaWR0aCIpLDEwKXx8MCktKHBhcnNlSW50KGQoYikuY3NzKCJwYWRkaW5nUmlnaHQiKSwxMCl8fDApLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtdGhpcy5tYXJnaW5zLmxlZnQtdGhpcy5tYXJnaW5zLnJpZ2h0LChjP01hdGgubWF4KGIuc2Nyb2xsSGVpZ2h0LGIub2Zmc2V0SGVpZ2h0KTpiLm9mZnNldEhlaWdodCktKHBhcnNlSW50KGQoYikuY3NzKCJib3JkZXJUb3BXaWR0aCIpLDEwKXx8MCktKHBhcnNlSW50KGQoYikuY3NzKCJwYWRkaW5nQm90dG9tIiksMTApfHwwKS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wLXRoaXMubWFyZ2lucy5ib3R0b21dO3RoaXMucmVsYXRpdmVfY29udGFpbmVyPWF9fWVsc2UgaWYoYS5jb250YWlubWVudC5jb25zdHJ1Y3Rvcj09QXJyYXkpdGhpcy5jb250YWlubWVudD1hLmNvbnRhaW5tZW50fSxfY29udmVydFBvc2l0aW9uVG86ZnVuY3Rpb24oYSxiKXtpZighYiliPXRoaXMucG9zaXRpb247YT1hPT0iYWJzb2x1dGUiPzE6LTE7dmFyIGM9dGhpcy5jc3NQb3NpdGlvbj09ImFic29sdXRlIiYmISh0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmQudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pKT90aGlzLm9mZnNldFBhcmVudDp0aGlzLnNjcm9sbFBhcmVudCxmPS8oaHRtbHxib2R5KS9pLnRlc3QoY1swXS50YWdOYW1lKTtyZXR1cm57dG9wOmIudG9wKwp0aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AqYSt0aGlzLm9mZnNldC5wYXJlbnQudG9wKmEtKGQuYnJvd3Nlci5zYWZhcmkmJmQuYnJvd3Nlci52ZXJzaW9uPDUyNiYmdGhpcy5jc3NQb3NpdGlvbj09ImZpeGVkIj8wOih0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTpmPzA6Yy5zY3JvbGxUb3AoKSkqYSksbGVmdDpiLmxlZnQrdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdCphK3RoaXMub2Zmc2V0LnBhcmVudC5sZWZ0KmEtKGQuYnJvd3Nlci5zYWZhcmkmJmQuYnJvd3Nlci52ZXJzaW9uPDUyNiYmdGhpcy5jc3NQb3NpdGlvbj09ImZpeGVkIj8wOih0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk6Zj8wOmMuc2Nyb2xsTGVmdCgpKSphKX19LF9nZW5lcmF0ZVBvc2l0aW9uOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMub3B0aW9ucyxjPXRoaXMuY3NzUG9zaXRpb249PSJhYnNvbHV0ZSImJiEodGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZkLnVpLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSk/dGhpcy5vZmZzZXRQYXJlbnQ6dGhpcy5zY3JvbGxQYXJlbnQsZj0vKGh0bWx8Ym9keSkvaS50ZXN0KGNbMF0udGFnTmFtZSksZT1hLnBhZ2VYLGg9YS5wYWdlWTtpZih0aGlzLm9yaWdpbmFsUG9zaXRpb24pe3ZhciBnO2lmKHRoaXMuY29udGFpbm1lbnQpe2lmKHRoaXMucmVsYXRpdmVfY29udGFpbmVyKXtnPXRoaXMucmVsYXRpdmVfY29udGFpbmVyLm9mZnNldCgpO2c9W3RoaXMuY29udGFpbm1lbnRbMF0rZy5sZWZ0LHRoaXMuY29udGFpbm1lbnRbMV0rZy50b3AsdGhpcy5jb250YWlubWVudFsyXStnLmxlZnQsdGhpcy5jb250YWlubWVudFszXStnLnRvcF19ZWxzZSBnPXRoaXMuY29udGFpbm1lbnQ7aWYoYS5wYWdlWC10aGlzLm9mZnNldC5jbGljay5sZWZ0PGdbMF0pZT1nWzBdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQ7aWYoYS5wYWdlWS10aGlzLm9mZnNldC5jbGljay50b3A8Z1sxXSloPWdbMV0rdGhpcy5vZmZzZXQuY2xpY2sudG9wO2lmKGEucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdD5nWzJdKWU9Z1syXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0O2lmKGEucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPmdbM10paD1nWzNdK3RoaXMub2Zmc2V0LmNsaWNrLnRvcH1pZihiLmdyaWQpe2g9Yi5ncmlkWzFdP3RoaXMub3JpZ2luYWxQYWdlWStNYXRoLnJvdW5kKChoLXRoaXMub3JpZ2luYWxQYWdlWSkvYi5ncmlkWzFdKSpiLmdyaWRbMV06dGhpcy5vcmlnaW5hbFBhZ2VZO2g9Zz8hKGgtdGhpcy5vZmZzZXQuY2xpY2sudG9wPGdbMV18fGgtdGhpcy5vZmZzZXQuY2xpY2sudG9wPmdbM10pP2g6IShoLXRoaXMub2Zmc2V0LmNsaWNrLnRvcDxnWzFdKT9oLWIuZ3JpZFsxXTpoK2IuZ3JpZFsxXTpoO2U9Yi5ncmlkWzBdP3RoaXMub3JpZ2luYWxQYWdlWCtNYXRoLnJvdW5kKChlLXRoaXMub3JpZ2luYWxQYWdlWCkvYi5ncmlkWzBdKSpiLmdyaWRbMF06dGhpcy5vcmlnaW5hbFBhZ2VYO2U9Zz8hKGUtdGhpcy5vZmZzZXQuY2xpY2subGVmdDxnWzBdfHxlLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ+Z1syXSk/ZTohKGUtdGhpcy5vZmZzZXQuY2xpY2subGVmdDxnWzBdKT9lLWIuZ3JpZFswXTplK2IuZ3JpZFswXTplfX1yZXR1cm57dG9wOmgtdGhpcy5vZmZzZXQuY2xpY2sudG9wLXRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wKyhkLmJyb3dzZXIuc2FmYXJpJiZkLmJyb3dzZXIudmVyc2lvbjw1MjYmJnRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/MDp0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTpmPzA6Yy5zY3JvbGxUb3AoKSksbGVmdDplLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQtdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCsoZC5icm93c2VyLnNhZmFyaSYmZC5icm93c2VyLnZlcnNpb248NTI2JiZ0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPzA6dGhpcy5jc3NQb3NpdGlvbj09ImZpeGVkIj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOmY/MDpjLnNjcm9sbExlZnQoKSl9fSxfY2xlYXI6ZnVuY3Rpb24oKXt0aGlzLmhlbHBlci5yZW1vdmVDbGFzcygidWktZHJhZ2dhYmxlLWRyYWdnaW5nIik7dGhpcy5oZWxwZXJbMF0hPXRoaXMuZWxlbWVudFswXSYmIXRoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbCYmdGhpcy5oZWxwZXIucmVtb3ZlKCk7dGhpcy5oZWxwZXI9bnVsbDt0aGlzLmNhbmNlbEhlbHBlclJlbW92YWw9ZmFsc2V9LF90cmlnZ2VyOmZ1bmN0aW9uKGEsYixjKXtjPWN8fHRoaXMuX3VpSGFzaCgpO2QudWkucGx1Z2luLmNhbGwodGhpcyxhLFtiLGNdKTtpZihhPT0iZHJhZyIpdGhpcy5wb3NpdGlvbkFicz10aGlzLl9jb252ZXJ0UG9zaXRpb25UbygiYWJzb2x1dGUiKTtyZXR1cm4gZC5XaWRnZXQucHJvdG90eXBlLl90cmlnZ2VyLmNhbGwodGhpcyxhLGIsYyl9LHBsdWdpbnM6e30sX3VpSGFzaDpmdW5jdGlvbigpe3JldHVybntoZWxwZXI6dGhpcy5oZWxwZXIscG9zaXRpb246dGhpcy5wb3NpdGlvbixvcmlnaW5hbFBvc2l0aW9uOnRoaXMub3JpZ2luYWxQb3NpdGlvbixvZmZzZXQ6dGhpcy5wb3NpdGlvbkFic319fSk7ZC5leHRlbmQoZC51aS5kcmFnZ2FibGUse3ZlcnNpb246IjEuOC4xNiJ9KTtkLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsImNvbm5lY3RUb1NvcnRhYmxlIix7c3RhcnQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz1kKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpLGY9Yy5vcHRpb25zLGU9ZC5leHRlbmQoe30sYix7aXRlbTpjLmVsZW1lbnR9KTtjLnNvcnRhYmxlcz1bXTtkKGYuY29ubmVjdFRvU29ydGFibGUpLmVhY2goZnVuY3Rpb24oKXt2YXIgaD1kLmRhdGEodGhpcywic29ydGFibGUiKTtpZihoJiYhaC5vcHRpb25zLmRpc2FibGVkKXtjLnNvcnRhYmxlcy5wdXNoKHtpbnN0YW5jZTpoLHNob3VsZFJldmVydDpoLm9wdGlvbnMucmV2ZXJ0fSk7aC5yZWZyZXNoUG9zaXRpb25zKCk7aC5fdHJpZ2dlcigiYWN0aXZhdGUiLGEsZSl9fSl9LHN0b3A6ZnVuY3Rpb24oYSxiKXt2YXIgYz1kKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpLGY9ZC5leHRlbmQoe30sYix7aXRlbTpjLmVsZW1lbnR9KTtkLmVhY2goYy5zb3J0YWJsZXMsZnVuY3Rpb24oKXtpZih0aGlzLmluc3RhbmNlLmlzT3Zlcil7dGhpcy5pbnN0YW5jZS5pc092ZXI9MDtjLmNhbmNlbEhlbHBlclJlbW92YWw9dHJ1ZTt0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWw9ZmFsc2U7aWYodGhpcy5zaG91bGRSZXZlcnQpdGhpcy5pbnN0YW5jZS5vcHRpb25zLnJldmVydD10cnVlO3RoaXMuaW5zdGFuY2UuX21vdXNlU3RvcChhKTt0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyPXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5faGVscGVyO2Mub3B0aW9ucy5oZWxwZXI9PSJvcmlnaW5hbCImJnRoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW0uY3NzKHt0b3A6ImF1dG8iLGxlZnQ6ImF1dG8ifSl9ZWxzZXt0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWw9ZmFsc2U7dGhpcy5pbnN0YW5jZS5fdHJpZ2dlcigiZGVhY3RpdmF0ZSIsYSxmKX19KX0sZHJhZzpmdW5jdGlvbihhLGIpe3ZhciBjPWQodGhpcykuZGF0YSgiZHJhZ2dhYmxlIiksZj10aGlzO2QuZWFjaChjLnNvcnRhYmxlcyxmdW5jdGlvbigpe3RoaXMuaW5zdGFuY2UucG9zaXRpb25BYnM9Yy5wb3NpdGlvbkFiczt0aGlzLmluc3RhbmNlLmhlbHBlclByb3BvcnRpb25zPWMuaGVscGVyUHJvcG9ydGlvbnM7dGhpcy5pbnN0YW5jZS5vZmZzZXQuY2xpY2s9Yy5vZmZzZXQuY2xpY2s7aWYodGhpcy5pbnN0YW5jZS5faW50ZXJzZWN0c1dpdGgodGhpcy5pbnN0YW5jZS5jb250YWluZXJDYWNoZSkpe2lmKCF0aGlzLmluc3RhbmNlLmlzT3Zlcil7dGhpcy5pbnN0YW5jZS5pc092ZXI9MTt0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtPWQoZikuY2xvbmUoKS5yZW1vdmVBdHRyKCJpZCIpLmFwcGVuZFRvKHRoaXMuaW5zdGFuY2UuZWxlbWVudCkuZGF0YSgic29ydGFibGUtaXRlbSIsdHJ1ZSk7dGhpcy5pbnN0YW5jZS5vcHRpb25zLl9oZWxwZXI9dGhpcy5pbnN0YW5jZS5vcHRpb25zLmhlbHBlcjt0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyPWZ1bmN0aW9uKCl7cmV0dXJuIGIuaGVscGVyWzBdfTthLnRhcmdldD10aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtWzBdO3RoaXMuaW5zdGFuY2UuX21vdXNlQ2FwdHVyZShhLHRydWUpO3RoaXMuaW5zdGFuY2UuX21vdXNlU3RhcnQoYSx0cnVlLHRydWUpO3RoaXMuaW5zdGFuY2Uub2Zmc2V0LmNsaWNrLnRvcD1jLm9mZnNldC5jbGljay50b3A7dGhpcy5pbnN0YW5jZS5vZmZzZXQuY2xpY2subGVmdD1jLm9mZnNldC5jbGljay5sZWZ0O3RoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC5sZWZ0LT1jLm9mZnNldC5wYXJlbnQubGVmdC10aGlzLmluc3RhbmNlLm9mZnNldC5wYXJlbnQubGVmdDt0aGlzLmluc3RhbmNlLm9mZnNldC5wYXJlbnQudG9wLT1jLm9mZnNldC5wYXJlbnQudG9wLXRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC50b3A7Yy5fdHJpZ2dlcigidG9Tb3J0YWJsZSIsYSk7Yy5kcm9wcGVkPXRoaXMuaW5zdGFuY2UuZWxlbWVudDtjLmN1cnJlbnRJdGVtPWMuZWxlbWVudDt0aGlzLmluc3RhbmNlLmZyb21PdXRzaWRlPWN9dGhpcy5pbnN0YW5jZS5jdXJyZW50SXRlbSYmdGhpcy5pbnN0YW5jZS5fbW91c2VEcmFnKGEpfWVsc2UgaWYodGhpcy5pbnN0YW5jZS5pc092ZXIpe3RoaXMuaW5zdGFuY2UuaXNPdmVyPTA7dGhpcy5pbnN0YW5jZS5jYW5jZWxIZWxwZXJSZW1vdmFsPXRydWU7dGhpcy5pbnN0YW5jZS5vcHRpb25zLnJldmVydD1mYWxzZTt0aGlzLmluc3RhbmNlLl90cmlnZ2VyKCJvdXQiLGEsdGhpcy5pbnN0YW5jZS5fdWlIYXNoKHRoaXMuaW5zdGFuY2UpKTt0aGlzLmluc3RhbmNlLl9tb3VzZVN0b3AoYSx0cnVlKTt0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyPXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5faGVscGVyO3RoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW0ucmVtb3ZlKCk7dGhpcy5pbnN0YW5jZS5wbGFjZWhvbGRlciYmdGhpcy5pbnN0YW5jZS5wbGFjZWhvbGRlci5yZW1vdmUoKTtjLl90cmlnZ2VyKCJmcm9tU29ydGFibGUiLGEpO2MuZHJvcHBlZD1mYWxzZX19KX19KTtkLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsImN1cnNvciIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGE9ZCgiYm9keSIpLGI9ZCh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKS5vcHRpb25zO2lmKGEuY3NzKCJjdXJzb3IiKSliLl9jdXJzb3I9YS5jc3MoImN1cnNvciIpO2EuY3NzKCJjdXJzb3IiLGIuY3Vyc29yKX0sc3RvcDpmdW5jdGlvbigpe3ZhciBhPWQodGhpcykuZGF0YSgiZHJhZ2dhYmxlIikub3B0aW9uczthLl9jdXJzb3ImJmQoImJvZHkiKS5jc3MoImN1cnNvciIsYS5fY3Vyc29yKX19KTtkLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsIm9wYWNpdHkiLHtzdGFydDpmdW5jdGlvbihhLGIpe2E9ZChiLmhlbHBlcik7Yj1kKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpLm9wdGlvbnM7aWYoYS5jc3MoIm9wYWNpdHkiKSliLl9vcGFjaXR5PWEuY3NzKCJvcGFjaXR5Iik7YS5jc3MoIm9wYWNpdHkiLGIub3BhY2l0eSl9LHN0b3A6ZnVuY3Rpb24oYSxiKXthPWQodGhpcykuZGF0YSgiZHJhZ2dhYmxlIikub3B0aW9uczthLl9vcGFjaXR5JiZkKGIuaGVscGVyKS5jc3MoIm9wYWNpdHkiLGEuX29wYWNpdHkpfX0pO2QudWkucGx1Z2luLmFkZCgiZHJhZ2dhYmxlIiwic2Nyb2xsIix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgYT1kKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpO2lmKGEuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmYS5zY3JvbGxQYXJlbnRbMF0udGFnTmFtZSE9IkhUTUwiKWEub3ZlcmZsb3dPZmZzZXQ9YS5zY3JvbGxQYXJlbnQub2Zmc2V0KCl9LGRyYWc6ZnVuY3Rpb24oYSl7dmFyIGI9ZCh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKSxjPWIub3B0aW9ucyxmPWZhbHNlO2lmKGIuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmYi5zY3JvbGxQYXJlbnRbMF0udGFnTmFtZSE9IkhUTUwiKXtpZighYy5heGlzfHxjLmF4aXMhPSJ4IilpZihiLm92ZXJmbG93T2Zmc2V0LnRvcCtiLnNjcm9sbFBhcmVudFswXS5vZmZzZXRIZWlnaHQtYS5wYWdlWTxjLnNjcm9sbFNlbnNpdGl2aXR5KWIuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcD1mPWIuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCtjLnNjcm9sbFNwZWVkO2Vsc2UgaWYoYS5wYWdlWS1iLm92ZXJmbG93T2Zmc2V0LnRvcDxjLnNjcm9sbFNlbnNpdGl2aXR5KWIuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcD1mPWIuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcC1jLnNjcm9sbFNwZWVkO2lmKCFjLmF4aXN8fGMuYXhpcyE9InkiKWlmKGIub3ZlcmZsb3dPZmZzZXQubGVmdCtiLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aC1hLnBhZ2VYPGMuc2Nyb2xsU2Vuc2l0aXZpdHkpYi5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1mPWIuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQrYy5zY3JvbGxTcGVlZDtlbHNlIGlmKGEucGFnZVgtYi5vdmVyZmxvd09mZnNldC5sZWZ0PGMuc2Nyb2xsU2Vuc2l0aXZpdHkpYi5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1mPWIuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQtYy5zY3JvbGxTcGVlZH1lbHNle2lmKCFjLmF4aXN8fGMuYXhpcyE9IngiKWlmKGEucGFnZVktZChkb2N1bWVudCkuc2Nyb2xsVG9wKCk8Yy5zY3JvbGxTZW5zaXRpdml0eSlmPWQoZG9jdW1lbnQpLnNjcm9sbFRvcChkKGRvY3VtZW50KS5zY3JvbGxUb3AoKS1jLnNjcm9sbFNwZWVkKTtlbHNlIGlmKGQod2luZG93KS5oZWlnaHQoKS0oYS5wYWdlWS1kKGRvY3VtZW50KS5zY3JvbGxUb3AoKSk8Yy5zY3JvbGxTZW5zaXRpdml0eSlmPWQoZG9jdW1lbnQpLnNjcm9sbFRvcChkKGRvY3VtZW50KS5zY3JvbGxUb3AoKStjLnNjcm9sbFNwZWVkKTtpZighYy5heGlzfHxjLmF4aXMhPSJ5IilpZihhLnBhZ2VYLWQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKTxjLnNjcm9sbFNlbnNpdGl2aXR5KWY9ZChkb2N1bWVudCkuc2Nyb2xsTGVmdChkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCktCmMuc2Nyb2xsU3BlZWQpO2Vsc2UgaWYoZCh3aW5kb3cpLndpZHRoKCktKGEucGFnZVgtZChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpKTxjLnNjcm9sbFNlbnNpdGl2aXR5KWY9ZChkb2N1bWVudCkuc2Nyb2xsTGVmdChkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkrYy5zY3JvbGxTcGVlZCl9ZiE9PWZhbHNlJiZkLnVpLmRkbWFuYWdlciYmIWMuZHJvcEJlaGF2aW91ciYmZC51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoYixhKX19KTtkLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsInNuYXAiLHtzdGFydDpmdW5jdGlvbigpe3ZhciBhPWQodGhpcykuZGF0YSgiZHJhZ2dhYmxlIiksYj1hLm9wdGlvbnM7YS5zbmFwRWxlbWVudHM9W107ZChiLnNuYXAuY29uc3RydWN0b3IhPVN0cmluZz9iLnNuYXAuaXRlbXN8fCI6ZGF0YShkcmFnZ2FibGUpIjpiLnNuYXApLmVhY2goZnVuY3Rpb24oKXt2YXIgYz1kKHRoaXMpLGY9Yy5vZmZzZXQoKTt0aGlzIT1hLmVsZW1lbnRbMF0mJmEuc25hcEVsZW1lbnRzLnB1c2goe2l0ZW06dGhpcyx3aWR0aDpjLm91dGVyV2lkdGgoKSxoZWlnaHQ6Yy5vdXRlckhlaWdodCgpLHRvcDpmLnRvcCxsZWZ0OmYubGVmdH0pfSl9LGRyYWc6ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9ZCh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKSxmPWMub3B0aW9ucyxlPWYuc25hcFRvbGVyYW5jZSxoPWIub2Zmc2V0LmxlZnQsZz1oK2MuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgsbj1iLm9mZnNldC50b3Asbz1uK2MuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LGk9Yy5zbmFwRWxlbWVudHMubGVuZ3RoLTE7aT49MDtpLS0pe3ZhciBqPWMuc25hcEVsZW1lbnRzW2ldLmxlZnQsbD1qK2Muc25hcEVsZW1lbnRzW2ldLndpZHRoLGs9Yy5zbmFwRWxlbWVudHNbaV0udG9wLG09aytjLnNuYXBFbGVtZW50c1tpXS5oZWlnaHQ7aWYoai1lPGgmJmg8bCtlJiZrLWU8biYmbjxtK2V8fGotZTxoJiZoPGwrZSYmay1lPG8mJm88bStlfHxqLWU8ZyYmZzxsK2UmJmstZTxuJiZuPG0rZXx8ai1lPGcmJmc8bCtlJiZrLWU8byYmbzxtK2Upe2lmKGYuc25hcE1vZGUhPSJpbm5lciIpe3ZhciBwPU1hdGguYWJzKGstbyk8PWUscT1NYXRoLmFicyhtLW4pPD1lLHI9TWF0aC5hYnMoai1nKTw9ZSxzPU1hdGguYWJzKGwtaCk8PWU7aWYocCliLnBvc2l0aW9uLnRvcD1jLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLHt0b3A6ay1jLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxsZWZ0OjB9KS50b3AtYy5tYXJnaW5zLnRvcDtpZihxKWIucG9zaXRpb24udG9wPWMuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIse3RvcDptLGxlZnQ6MH0pLnRvcC1jLm1hcmdpbnMudG9wO2lmKHIpYi5wb3NpdGlvbi5sZWZ0PWMuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIse3RvcDowLGxlZnQ6ai1jLmhlbHBlclByb3BvcnRpb25zLndpZHRofSkubGVmdC1jLm1hcmdpbnMubGVmdDtpZihzKWIucG9zaXRpb24ubGVmdD1jLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLHt0b3A6MCxsZWZ0Omx9KS5sZWZ0LWMubWFyZ2lucy5sZWZ0fXZhciB0PXB8fHF8fHJ8fHM7aWYoZi5zbmFwTW9kZSE9Im91dGVyIil7cD1NYXRoLmFicyhrLW4pPD1lO3E9TWF0aC5hYnMobS1vKTw9ZTtyPU1hdGguYWJzKGotaCk8PWU7cz1NYXRoLmFicyhsLWcpPD1lO2lmKHApYi5wb3NpdGlvbi50b3A9Yy5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIix7dG9wOmssbGVmdDowfSkudG9wLWMubWFyZ2lucy50b3A7aWYocSliLnBvc2l0aW9uLnRvcD1jLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLHt0b3A6bS1jLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxsZWZ0OjB9KS50b3AtYy5tYXJnaW5zLnRvcDtpZihyKWIucG9zaXRpb24ubGVmdD1jLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLHt0b3A6MCxsZWZ0Omp9KS5sZWZ0LWMubWFyZ2lucy5sZWZ0O2lmKHMpYi5wb3NpdGlvbi5sZWZ0PWMuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIse3RvcDowLGxlZnQ6bC1jLmhlbHBlclByb3BvcnRpb25zLndpZHRofSkubGVmdC1jLm1hcmdpbnMubGVmdH1pZighYy5zbmFwRWxlbWVudHNbaV0uc25hcHBpbmcmJihwfHxxfHxyfHxzfHx0KSljLm9wdGlvbnMuc25hcC5zbmFwJiZjLm9wdGlvbnMuc25hcC5zbmFwLmNhbGwoYy5lbGVtZW50LGEsZC5leHRlbmQoYy5fdWlIYXNoKCkse3NuYXBJdGVtOmMuc25hcEVsZW1lbnRzW2ldLml0ZW19KSk7Yy5zbmFwRWxlbWVudHNbaV0uc25hcHBpbmc9cHx8cXx8cnx8c3x8dH1lbHNle2Muc25hcEVsZW1lbnRzW2ldLnNuYXBwaW5nJiZjLm9wdGlvbnMuc25hcC5yZWxlYXNlJiZjLm9wdGlvbnMuc25hcC5yZWxlYXNlLmNhbGwoYy5lbGVtZW50LGEsZC5leHRlbmQoYy5fdWlIYXNoKCkse3NuYXBJdGVtOmMuc25hcEVsZW1lbnRzW2ldLml0ZW19KSk7Yy5zbmFwRWxlbWVudHNbaV0uc25hcHBpbmc9ZmFsc2V9fX19KTtkLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsInN0YWNrIix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgYT1kKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpLm9wdGlvbnM7YT1kLm1ha2VBcnJheShkKGEuc3RhY2spKS5zb3J0KGZ1bmN0aW9uKGMsZil7cmV0dXJuKHBhcnNlSW50KGQoYykuY3NzKCJ6SW5kZXgiKSwxMCl8fDApLShwYXJzZUludChkKGYpLmNzcygiekluZGV4IiksMTApfHwwKX0pO2lmKGEubGVuZ3RoKXt2YXIgYj1wYXJzZUludChhWzBdLnN0eWxlLnpJbmRleCl8fDA7ZChhKS5lYWNoKGZ1bmN0aW9uKGMpe3RoaXMuc3R5bGUuekluZGV4PWIrY30pO3RoaXNbMF0uc3R5bGUuekluZGV4PWIrYS5sZW5ndGh9fX0pO2QudWkucGx1Z2luLmFkZCgiZHJhZ2dhYmxlIiwiekluZGV4Iix7c3RhcnQ6ZnVuY3Rpb24oYSxiKXthPWQoYi5oZWxwZXIpO2I9ZCh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKS5vcHRpb25zO2lmKGEuY3NzKCJ6SW5kZXgiKSliLl96SW5kZXg9YS5jc3MoInpJbmRleCIpO2EuY3NzKCJ6SW5kZXgiLGIuekluZGV4KX0sc3RvcDpmdW5jdGlvbihhLGIpe2E9ZCh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKS5vcHRpb25zO2EuX3pJbmRleCYmZChiLmhlbHBlcikuY3NzKCJ6SW5kZXgiLGEuX3pJbmRleCl9fSl9KShqUXVlcnkpOztqUXVlcnkuZWZmZWN0c3x8ZnVuY3Rpb24oZixqKXtmdW5jdGlvbiBtKGMpe3ZhciBhO2lmKGMmJmMuY29uc3RydWN0b3I9PUFycmF5JiZjLmxlbmd0aD09MylyZXR1cm4gYztpZihhPS9yZ2JcKFxzKihbMC05XXsxLDN9KVxzKixccyooWzAtOV17MSwzfSlccyosXHMqKFswLTldezEsM30pXHMqXCkvLmV4ZWMoYykpcmV0dXJuW3BhcnNlSW50KGFbMV0sMTApLHBhcnNlSW50KGFbMl0sMTApLHBhcnNlSW50KGFbM10sMTApXTtpZihhPS9yZ2JcKFxzKihbMC05XSsoPzpcLlswLTldKyk/KVwlXHMqLFxzKihbMC05XSsoPzpcLlswLTldKyk/KVwlXHMqLFxzKihbMC05XSsoPzpcLlswLTldKyk/KVwlXHMqXCkvLmV4ZWMoYykpcmV0dXJuW3BhcnNlRmxvYXQoYVsxXSkqMi41NSxwYXJzZUZsb2F0KGFbMl0pKjIuNTUscGFyc2VGbG9hdChhWzNdKSoyLjU1XTtpZihhPS8jKFthLWZBLUYwLTldezJ9KShbYS1mQS1GMC05XXsyfSkoW2EtZkEtRjAtOV17Mn0pLy5leGVjKGMpKXJldHVybltwYXJzZUludChhWzFdLDE2KSxwYXJzZUludChhWzJdLDE2KSxwYXJzZUludChhWzNdLDE2KV07aWYoYT0vIyhbYS1mQS1GMC05XSkoW2EtZkEtRjAtOV0pKFthLWZBLUYwLTldKS8uZXhlYyhjKSlyZXR1cm5bcGFyc2VJbnQoYVsxXSthWzFdLDE2KSxwYXJzZUludChhWzJdK2FbMl0sMTYpLHBhcnNlSW50KGFbM10rYVszXSwxNildO2lmKC9yZ2JhXCgwLCAwLCAwLCAwXCkvLmV4ZWMoYykpcmV0dXJuIG4udHJhbnNwYXJlbnQ7cmV0dXJuIG5bZi50cmltKGMpLnRvTG93ZXJDYXNlKCldfWZ1bmN0aW9uIHMoYyxhKXt2YXIgYjtkb3tiPWYuY3VyQ1NTKGMsYSk7aWYoYiE9IiImJmIhPSJ0cmFuc3BhcmVudCJ8fGYubm9kZU5hbWUoYywiYm9keSIpKWJyZWFrO2E9ImJhY2tncm91bmRDb2xvciJ9d2hpbGUoYz1jLnBhcmVudE5vZGUpO3JldHVybiBtKGIpfWZ1bmN0aW9uIG8oKXt2YXIgYz1kb2N1bWVudC5kZWZhdWx0Vmlldz9kb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKHRoaXMsbnVsbCk6dGhpcy5jdXJyZW50U3R5bGUsYT17fSxiLGQ7aWYoYyYmYy5sZW5ndGgmJmNbMF0mJmNbY1swXV0pZm9yKHZhciBlPWMubGVuZ3RoO2UtLTspe2I9Y1tlXTtpZih0eXBlb2YgY1tiXT09InN0cmluZyIpe2Q9Yi5yZXBsYWNlKC9cLShcdykvZyxmdW5jdGlvbihnLGgpe3JldHVybiBoLnRvVXBwZXJDYXNlKCl9KTthW2RdPWNbYl19fWVsc2UgZm9yKGIgaW4gYylpZih0eXBlb2YgY1tiXT09PSJzdHJpbmciKWFbYl09Y1tiXTtyZXR1cm4gYX1mdW5jdGlvbiBwKGMpe3ZhciBhLGI7Zm9yKGEgaW4gYyl7Yj1jW2FdO2lmKGI9PW51bGx8fGYuaXNGdW5jdGlvbihiKXx8YSBpbiB0fHwvc2Nyb2xsYmFyLy50ZXN0KGEpfHwhL2NvbG9yL2kudGVzdChhKSYmaXNOYU4ocGFyc2VGbG9hdChiKSkpZGVsZXRlIGNbYV19cmV0dXJuIGN9ZnVuY3Rpb24gdShjLGEpe3ZhciBiPXtfOjB9LGQ7Zm9yKGQgaW4gYSlpZihjW2RdIT1hW2RdKWJbZF09YVtkXTtyZXR1cm4gYn1mdW5jdGlvbiBrKGMsYSxiLGQpe2lmKHR5cGVvZiBjPT0ib2JqZWN0Iil7ZD1hO2I9bnVsbDthPWM7Yz1hLmVmZmVjdH1pZihmLmlzRnVuY3Rpb24oYSkpe2Q9YTtiPW51bGw7YT17fX1pZih0eXBlb2YgYT09Im51bWJlciJ8fGYuZnguc3BlZWRzW2FdKXtkPWI7Yj1hO2E9e319aWYoZi5pc0Z1bmN0aW9uKGIpKXtkPWI7Yj1udWxsfWE9YXx8e307Yj1ifHxhLmR1cmF0aW9uO2I9Zi5meC5vZmY/MDp0eXBlb2YgYj09Im51bWJlciI/YjpiIGluIGYuZnguc3BlZWRzP2YuZnguc3BlZWRzW2JdOmYuZnguc3BlZWRzLl9kZWZhdWx0O2Q9ZHx8YS5jb21wbGV0ZTtyZXR1cm5bYyxhLGIsZF19ZnVuY3Rpb24gbChjKXtpZighY3x8dHlwZW9mIGM9PT0ibnVtYmVyInx8Zi5meC5zcGVlZHNbY10pcmV0dXJuIHRydWU7aWYodHlwZW9mIGM9PT0ic3RyaW5nIiYmIWYuZWZmZWN0c1tjXSlyZXR1cm4gdHJ1ZTtyZXR1cm4gZmFsc2V9Zi5lZmZlY3RzPXt9O2YuZWFjaChbImJhY2tncm91bmRDb2xvciIsImJvcmRlckJvdHRvbUNvbG9yIiwiYm9yZGVyTGVmdENvbG9yIiwiYm9yZGVyUmlnaHRDb2xvciIsImJvcmRlclRvcENvbG9yIiwiYm9yZGVyQ29sb3IiLCJjb2xvciIsIm91dGxpbmVDb2xvciJdLGZ1bmN0aW9uKGMsYSl7Zi5meC5zdGVwW2FdPWZ1bmN0aW9uKGIpe2lmKCFiLmNvbG9ySW5pdCl7Yi5zdGFydD1zKGIuZWxlbSxhKTtiLmVuZD1tKGIuZW5kKTtiLmNvbG9ySW5pdD10cnVlfWIuZWxlbS5zdHlsZVthXT0icmdiKCIrTWF0aC5tYXgoTWF0aC5taW4ocGFyc2VJbnQoYi5wb3MqKGIuZW5kWzBdLWIuc3RhcnRbMF0pK2Iuc3RhcnRbMF0sMTApLDI1NSksMCkrIiwiK01hdGgubWF4KE1hdGgubWluKHBhcnNlSW50KGIucG9zKihiLmVuZFsxXS1iLnN0YXJ0WzFdKStiLnN0YXJ0WzFdLDEwKSwyNTUpLDApKyIsIitNYXRoLm1heChNYXRoLm1pbihwYXJzZUludChiLnBvcyooYi5lbmRbMl0tYi5zdGFydFsyXSkrYi5zdGFydFsyXSwxMCksMjU1KSwwKSsiKSJ9fSk7dmFyIG49e2FxdWE6WzAsMjU1LDI1NV0sYXp1cmU6WzI0MCwyNTUsMjU1XSxiZWlnZTpbMjQ1LDI0NSwyMjBdLGJsYWNrOlswLDAsMF0sYmx1ZTpbMCwwLDI1NV0sYnJvd246WzE2NSw0Miw0Ml0sY3lhbjpbMCwyNTUsMjU1XSxkYXJrYmx1ZTpbMCwwLDEzOV0sZGFya2N5YW46WzAsMTM5LDEzOV0sZGFya2dyZXk6WzE2OSwxNjksMTY5XSxkYXJrZ3JlZW46WzAsMTAwLDBdLGRhcmtraGFraTpbMTg5LDE4MywxMDddLGRhcmttYWdlbnRhOlsxMzksMCwxMzldLGRhcmtvbGl2ZWdyZWVuOls4NSwxMDcsNDddLGRhcmtvcmFuZ2U6WzI1NSwxNDAsMF0sZGFya29yY2hpZDpbMTUzLDUwLDIwNF0sZGFya3JlZDpbMTM5LDAsMF0sZGFya3NhbG1vbjpbMjMzLDE1MCwxMjJdLGRhcmt2aW9sZXQ6WzE0OCwwLDIxMV0sZnVjaHNpYTpbMjU1LDAsMjU1XSxnb2xkOlsyNTUsMjE1LDBdLGdyZWVuOlswLDEyOCwwXSxpbmRpZ286Wzc1LDAsMTMwXSxraGFraTpbMjQwLDIzMCwxNDBdLGxpZ2h0Ymx1ZTpbMTczLDIxNiwyMzBdLGxpZ2h0Y3lhbjpbMjI0LDI1NSwyNTVdLGxpZ2h0Z3JlZW46WzE0NCwyMzgsMTQ0XSxsaWdodGdyZXk6WzIxMSwyMTEsMjExXSxsaWdodHBpbms6WzI1NSwxODIsMTkzXSxsaWdodHllbGxvdzpbMjU1LDI1NSwyMjRdLGxpbWU6WzAsMjU1LDBdLG1hZ2VudGE6WzI1NSwwLDI1NV0sbWFyb29uOlsxMjgsMCwwXSxuYXZ5OlswLDAsMTI4XSxvbGl2ZTpbMTI4LDEyOCwwXSxvcmFuZ2U6WzI1NSwxNjUsMF0scGluazpbMjU1LDE5MiwyMDNdLHB1cnBsZTpbMTI4LDAsMTI4XSx2aW9sZXQ6WzEyOCwwLDEyOF0scmVkOlsyNTUsMCwwXSxzaWx2ZXI6WzE5MiwxOTIsMTkyXSx3aGl0ZTpbMjU1LDI1NSwyNTVdLHllbGxvdzpbMjU1LDI1NSwwXSx0cmFuc3BhcmVudDpbMjU1LDI1NSwyNTVdfSxxPVsiYWRkIiwicmVtb3ZlIiwidG9nZ2xlIl0sdD17Ym9yZGVyOjEsYm9yZGVyQm90dG9tOjEsYm9yZGVyQ29sb3I6MSxib3JkZXJMZWZ0OjEsYm9yZGVyUmlnaHQ6MSxib3JkZXJUb3A6MSxib3JkZXJXaWR0aDoxLG1hcmdpbjoxLHBhZGRpbmc6MX07Zi5lZmZlY3RzLmFuaW1hdGVDbGFzcz1mdW5jdGlvbihjLGEsYixkKXtpZihmLmlzRnVuY3Rpb24oYikpe2Q9YjtiPW51bGx9cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgZT1mKHRoaXMpLGc9ZS5hdHRyKCJzdHlsZSIpfHwiICIsaD1wKG8uY2FsbCh0aGlzKSkscix2PWUuYXR0cigiY2xhc3MiKTtmLmVhY2gocSxmdW5jdGlvbih3LGkpe2NbaV0mJmVbaSsiQ2xhc3MiXShjW2ldKX0pO3I9cChvLmNhbGwodGhpcykpO2UuYXR0cigiY2xhc3MiLHYpO2UuYW5pbWF0ZSh1KGgscikse3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmEsZWFzaW5nOmIsY29tcGxldGU6ZnVuY3Rpb24oKXtmLmVhY2gocSxmdW5jdGlvbih3LGkpe2NbaV0mJmVbaSsiQ2xhc3MiXShjW2ldKX0pO2lmKHR5cGVvZiBlLmF0dHIoInN0eWxlIik9PSJvYmplY3QiKXtlLmF0dHIoInN0eWxlIikuY3NzVGV4dD0iIjtlLmF0dHIoInN0eWxlIikuY3NzVGV4dD1nfWVsc2UgZS5hdHRyKCJzdHlsZSIsZyk7ZCYmZC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Zi5kZXF1ZXVlKHRoaXMpfX0pfSl9O2YuZm4uZXh0ZW5kKHtfYWRkQ2xhc3M6Zi5mbi5hZGRDbGFzcyxhZGRDbGFzczpmdW5jdGlvbihjLGEsYixkKXtyZXR1cm4gYT9mLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmFwcGx5KHRoaXMsW3thZGQ6Y30sYSxiLGRdKTp0aGlzLl9hZGRDbGFzcyhjKX0sX3JlbW92ZUNsYXNzOmYuZm4ucmVtb3ZlQ2xhc3MscmVtb3ZlQ2xhc3M6ZnVuY3Rpb24oYyxhLGIsZCl7cmV0dXJuIGE/Zi5lZmZlY3RzLmFuaW1hdGVDbGFzcy5hcHBseSh0aGlzLFt7cmVtb3ZlOmN9LGEsYixkXSk6dGhpcy5fcmVtb3ZlQ2xhc3MoYyl9LF90b2dnbGVDbGFzczpmLmZuLnRvZ2dsZUNsYXNzLHRvZ2dsZUNsYXNzOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIHR5cGVvZiBhPT0iYm9vbGVhbiJ8fGE9PT1qP2I/Zi5lZmZlY3RzLmFuaW1hdGVDbGFzcy5hcHBseSh0aGlzLFthP3thZGQ6Y306e3JlbW92ZTpjfSxiLGQsZV0pOnRoaXMuX3RvZ2dsZUNsYXNzKGMsYSk6Zi5lZmZlY3RzLmFuaW1hdGVDbGFzcy5hcHBseSh0aGlzLFt7dG9nZ2xlOmN9LGEsYixkXSl9LHN3aXRjaENsYXNzOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIGYuZWZmZWN0cy5hbmltYXRlQ2xhc3MuYXBwbHkodGhpcyxbe2FkZDphLHJlbW92ZTpjfSxiLGQsZV0pfX0pO2YuZXh0ZW5kKGYuZWZmZWN0cyx7dmVyc2lvbjoiMS44LjE2IixzYXZlOmZ1bmN0aW9uKGMsYSl7Zm9yKHZhciBiPTA7YjxhLmxlbmd0aDtiKyspYVtiXSE9PW51bGwmJmMuZGF0YSgiZWMuc3RvcmFnZS4iK2FbYl0sY1swXS5zdHlsZVthW2JdXSl9LHJlc3RvcmU6ZnVuY3Rpb24oYyxhKXtmb3IodmFyIGI9MDtiPGEubGVuZ3RoO2IrKylhW2JdIT09bnVsbCYmYy5jc3MoYVtiXSxjLmRhdGEoImVjLnN0b3JhZ2UuIithW2JdKSl9LHNldE1vZGU6ZnVuY3Rpb24oYyxhKXtpZihhPT0idG9nZ2xlIilhPWMuaXMoIjpoaWRkZW4iKT8ic2hvdyI6ImhpZGUiO3JldHVybiBhfSxnZXRCYXNlbGluZTpmdW5jdGlvbihjLGEpe3ZhciBiO3N3aXRjaChjWzBdKXtjYXNlInRvcCI6Yj0wO2JyZWFrO2Nhc2UibWlkZGxlIjpiPTAuNTticmVhaztjYXNlImJvdHRvbSI6Yj0xO2JyZWFrO2RlZmF1bHQ6Yj1jWzBdL2EuaGVpZ2h0fXN3aXRjaChjWzFdKXtjYXNlImxlZnQiOmM9MDticmVhaztjYXNlImNlbnRlciI6Yz0wLjU7YnJlYWs7Y2FzZSJyaWdodCI6Yz0xO2JyZWFrO2RlZmF1bHQ6Yz1jWzFdL2Eud2lkdGh9cmV0dXJue3g6Yyx5OmJ9fSxjcmVhdGVXcmFwcGVyOmZ1bmN0aW9uKGMpe2lmKGMucGFyZW50KCkuaXMoIi51aS1lZmZlY3RzLXdyYXBwZXIiKSlyZXR1cm4gYy5wYXJlbnQoKTt2YXIgYT17d2lkdGg6Yy5vdXRlcldpZHRoKHRydWUpLGhlaWdodDpjLm91dGVySGVpZ2h0KHRydWUpLCJmbG9hdCI6Yy5jc3MoImZsb2F0Iil9LGI9ZigiPGRpdj48L2Rpdj4iKS5hZGRDbGFzcygidWktZWZmZWN0cy13cmFwcGVyIikuY3NzKHtmb250U2l6ZToiMTAwJSIsYmFja2dyb3VuZDoidHJhbnNwYXJlbnQiLGJvcmRlcjoibm9uZSIsbWFyZ2luOjAscGFkZGluZzowfSksZD1kb2N1bWVudC5hY3RpdmVFbGVtZW50O2Mud3JhcChiKTtpZihjWzBdPT09ZHx8Zi5jb250YWlucyhjWzBdLGQpKWYoZCkuZm9jdXMoKTtiPWMucGFyZW50KCk7aWYoYy5jc3MoInBvc2l0aW9uIik9PSJzdGF0aWMiKXtiLmNzcyh7cG9zaXRpb246InJlbGF0aXZlIn0pO2MuY3NzKHtwb3NpdGlvbjoicmVsYXRpdmUifSl9ZWxzZXtmLmV4dGVuZChhLHtwb3NpdGlvbjpjLmNzcygicG9zaXRpb24iKSx6SW5kZXg6Yy5jc3MoInotaW5kZXgiKX0pO2YuZWFjaChbInRvcCIsImxlZnQiLCJib3R0b20iLCJyaWdodCJdLGZ1bmN0aW9uKGUsZyl7YVtnXT1jLmNzcyhnKTtpZihpc05hTihwYXJzZUludChhW2ddLDEwKSkpYVtnXT0iYXV0byJ9KTtjLmNzcyh7cG9zaXRpb246InJlbGF0aXZlIix0b3A6MCxsZWZ0OjAscmlnaHQ6ImF1dG8iLGJvdHRvbToiYXV0byJ9KX1yZXR1cm4gYi5jc3MoYSkuc2hvdygpfSxyZW1vdmVXcmFwcGVyOmZ1bmN0aW9uKGMpe3ZhciBhLGI9ZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtpZihjLnBhcmVudCgpLmlzKCIudWktZWZmZWN0cy13cmFwcGVyIikpe2E9Yy5wYXJlbnQoKS5yZXBsYWNlV2l0aChjKTtpZihjWzBdPT09Ynx8Zi5jb250YWlucyhjWzBdLGIpKWYoYikuZm9jdXMoKTtyZXR1cm4gYX1yZXR1cm4gY30sc2V0VHJhbnNpdGlvbjpmdW5jdGlvbihjLGEsYixkKXtkPWR8fHt9O2YuZWFjaChhLGZ1bmN0aW9uKGUsZyl7dW5pdD1jLmNzc1VuaXQoZyk7aWYodW5pdFswXT4wKWRbZ109dW5pdFswXSpiK3VuaXRbMV19KTtyZXR1cm4gZH19KTtmLmZuLmV4dGVuZCh7ZWZmZWN0OmZ1bmN0aW9uKGMpe3ZhciBhPWsuYXBwbHkodGhpcyxhcmd1bWVudHMpLGI9e29wdGlvbnM6YVsxXSxkdXJhdGlvbjphWzJdLGNhbGxiYWNrOmFbM119O2E9Yi5vcHRpb25zLm1vZGU7dmFyIGQ9Zi5lZmZlY3RzW2NdO2lmKGYuZngub2ZmfHwhZClyZXR1cm4gYT90aGlzW2FdKGIuZHVyYXRpb24sYi5jYWxsYmFjayk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7Yi5jYWxsYmFjayYmYi5jYWxsYmFjay5jYWxsKHRoaXMpfSk7cmV0dXJuIGQuY2FsbCh0aGlzLGIpfSxfc2hvdzpmLmZuLnNob3csc2hvdzpmdW5jdGlvbihjKXtpZihsKGMpKXJldHVybiB0aGlzLl9zaG93LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtlbHNle3ZhciBhPWsuYXBwbHkodGhpcyxhcmd1bWVudHMpO2FbMV0ubW9kZT0ic2hvdyI7cmV0dXJuIHRoaXMuZWZmZWN0LmFwcGx5KHRoaXMsYSl9fSxfaGlkZTpmLmZuLmhpZGUsaGlkZTpmdW5jdGlvbihjKXtpZihsKGMpKXJldHVybiB0aGlzLl9oaWRlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtlbHNle3ZhciBhPWsuYXBwbHkodGhpcyxhcmd1bWVudHMpO2FbMV0ubW9kZT0iaGlkZSI7cmV0dXJuIHRoaXMuZWZmZWN0LmFwcGx5KHRoaXMsYSl9fSxfX3RvZ2dsZTpmLmZuLnRvZ2dsZSx0b2dnbGU6ZnVuY3Rpb24oYyl7aWYobChjKXx8dHlwZW9mIGM9PT0iYm9vbGVhbiJ8fGYuaXNGdW5jdGlvbihjKSlyZXR1cm4gdGhpcy5fX3RvZ2dsZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7ZWxzZXt2YXIgYT1rLmFwcGx5KHRoaXMsYXJndW1lbnRzKTthWzFdLm1vZGU9InRvZ2dsZSI7cmV0dXJuIHRoaXMuZWZmZWN0LmFwcGx5KHRoaXMsYSl9fSxjc3NVbml0OmZ1bmN0aW9uKGMpe3ZhciBhPXRoaXMuY3NzKGMpLGI9W107Zi5lYWNoKFsiZW0iLCJweCIsIiUiLCJwdCJdLGZ1bmN0aW9uKGQsZSl7aWYoYS5pbmRleE9mKGUpPjApYj1bcGFyc2VGbG9hdChhKSxlXX0pO3JldHVybiBifX0pO2YuZWFzaW5nLmpzd2luZz1mLmVhc2luZy5zd2luZztmLmV4dGVuZChmLmVhc2luZyx7ZGVmOiJlYXNlT3V0UXVhZCIsc3dpbmc6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4gZi5lYXNpbmdbZi5lYXNpbmcuZGVmXShjLGEsYixkLGUpfSxlYXNlSW5RdWFkOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIGQqKGEvPWUpKmErYn0sZWFzZU91dFF1YWQ6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4tZCooYS89ZSkqKGEtMikrYn0sZWFzZUluT3V0UXVhZDpmdW5jdGlvbihjLGEsYixkLGUpe2lmKChhLz1lLzIpPDEpcmV0dXJuIGQvMiphKmErYjtyZXR1cm4tZC8yKigtLWEqKGEtMiktMSkrYn0sZWFzZUluQ3ViaWM6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4gZCooYS89ZSkqYSphK2J9LGVhc2VPdXRDdWJpYzpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkKigoYT1hL2UtMSkqYSphKzEpK2J9LGVhc2VJbk91dEN1YmljOmZ1bmN0aW9uKGMsYSxiLGQsZSl7aWYoKGEvPWUvMik8MSlyZXR1cm4gZC8yKmEqYSphK2I7cmV0dXJuIGQvMiooKGEtPTIpKmEqYSsyKStifSxlYXNlSW5RdWFydDpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkKihhLz1lKSphKmEqYStifSxlYXNlT3V0UXVhcnQ6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4tZCooKGE9YS9lLTEpKmEqYSphLTEpK2J9LGVhc2VJbk91dFF1YXJ0OmZ1bmN0aW9uKGMsYSxiLGQsZSl7aWYoKGEvPWUvMik8MSlyZXR1cm4gZC8yKmEqYSphKmErYjtyZXR1cm4tZC8yKigoYS09MikqYSphKmEtMikrYn0sZWFzZUluUXVpbnQ6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4gZCooYS89ZSkqYSphKmEqYStifSxlYXNlT3V0UXVpbnQ6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4gZCooKGE9YS9lLTEpKmEqYSphKmErMSkrYn0sZWFzZUluT3V0UXVpbnQ6ZnVuY3Rpb24oYyxhLGIsZCxlKXtpZigoYS89ZS8yKTwxKXJldHVybiBkLzIqYSphKmEqYSphK2I7cmV0dXJuIGQvMiooKGEtPTIpKmEqYSphKmErMikrYn0sZWFzZUluU2luZTpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybi1kKk1hdGguY29zKGEvZSooTWF0aC5QSS8yKSkrZCtifSxlYXNlT3V0U2luZTpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkKk1hdGguc2luKGEvZSooTWF0aC5QSS8yKSkrYn0sZWFzZUluT3V0U2luZTpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybi1kLzIqKE1hdGguY29zKE1hdGguUEkqYS9lKS0xKStifSxlYXNlSW5FeHBvOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIGE9PTA/YjpkKk1hdGgucG93KDIsMTAqKGEvZS0xKSkrYn0sZWFzZU91dEV4cG86ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4gYT09ZT9iK2Q6ZCooLU1hdGgucG93KDIsLTEwKmEvZSkrMSkrYn0sZWFzZUluT3V0RXhwbzpmdW5jdGlvbihjLGEsYixkLGUpe2lmKGE9PTApcmV0dXJuIGI7aWYoYT09ZSlyZXR1cm4gYitkO2lmKChhLz1lLzIpPDEpcmV0dXJuIGQvMipNYXRoLnBvdygyLDEwKihhLTEpKStiO3JldHVybiBkLzIqKC1NYXRoLnBvdygyLC0xMCotLWEpKzIpK2J9LGVhc2VJbkNpcmM6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4tZCooTWF0aC5zcXJ0KDEtKGEvPWUpKmEpLTEpK2J9LGVhc2VPdXRDaXJjOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIGQqTWF0aC5zcXJ0KDEtKGE9YS9lLTEpKmEpK2J9LGVhc2VJbk91dENpcmM6ZnVuY3Rpb24oYyxhLGIsZCxlKXtpZigoYS89ZS8yKTwxKXJldHVybi1kLzIqKE1hdGguc3FydCgxLWEqYSktMSkrYjtyZXR1cm4gZC8yKihNYXRoLnNxcnQoMS0oYS09MikqYSkrMSkrYn0sZWFzZUluRWxhc3RpYzpmdW5jdGlvbihjLGEsYixkLGUpe2M9MS43MDE1ODt2YXIgZz0wLGg9ZDtpZihhPT0wKXJldHVybiBiO2lmKChhLz1lKT09MSlyZXR1cm4gYitkO2d8fChnPWUqMC4zKTtpZihoPE1hdGguYWJzKGQpKXtoPWQ7Yz1nLzR9ZWxzZSBjPWcvKDIqTWF0aC5QSSkqTWF0aC5hc2luKGQvaCk7cmV0dXJuLShoKk1hdGgucG93KDIsMTAqKGEtPTEpKSpNYXRoLnNpbigoYSplLWMpKjIqTWF0aC5QSS9nKSkrYn0sZWFzZU91dEVsYXN0aWM6ZnVuY3Rpb24oYyxhLGIsZCxlKXtjPTEuNzAxNTg7dmFyIGc9MCxoPWQ7aWYoYT09MClyZXR1cm4gYjtpZigoYS89ZSk9PTEpcmV0dXJuIGIrZDtnfHwoZz1lKjAuMyk7aWYoaDxNYXRoLmFicyhkKSl7aD1kO2M9Zy80fWVsc2UgYz1nLygyKk1hdGguUEkpKk1hdGguYXNpbihkL2gpO3JldHVybiBoKk1hdGgucG93KDIsLTEwKmEpKk1hdGguc2luKChhKmUtYykqMipNYXRoLlBJL2cpK2QrYn0sZWFzZUluT3V0RWxhc3RpYzpmdW5jdGlvbihjLGEsYixkLGUpe2M9MS43MDE1ODt2YXIgZz0wLGg9ZDtpZihhPT0wKXJldHVybiBiO2lmKChhLz1lLzIpPT0yKXJldHVybiBiK2Q7Z3x8KGc9ZSowLjMqMS41KTtpZihoPE1hdGguYWJzKGQpKXtoPWQ7Yz1nLzR9ZWxzZSBjPWcvKDIqTWF0aC5QSSkqTWF0aC5hc2luKGQvaCk7aWYoYTwxKXJldHVybi0wLjUqaCpNYXRoLnBvdygyLDEwKihhLT0xKSkqTWF0aC5zaW4oKGEqZS1jKSoyKk1hdGguUEkvZykrYjtyZXR1cm4gaCpNYXRoLnBvdygyLC0xMCooYS09MSkpKk1hdGguc2luKChhKmUtYykqMipNYXRoLlBJL2cpKjAuNStkK2J9LGVhc2VJbkJhY2s6ZnVuY3Rpb24oYyxhLGIsZCxlLGcpe2lmKGc9PWopZz0xLjcwMTU4O3JldHVybiBkKihhLz1lKSphKigoZysxKSphLWcpK2J9LGVhc2VPdXRCYWNrOmZ1bmN0aW9uKGMsYSxiLGQsZSxnKXtpZihnPT1qKWc9MS43MDE1ODtyZXR1cm4gZCooKGE9YS9lLTEpKmEqKChnKzEpKmErZykrMSkrYn0sZWFzZUluT3V0QmFjazpmdW5jdGlvbihjLGEsYixkLGUsZyl7aWYoZz09ailnPTEuNzAxNTg7aWYoKGEvPWUvMik8MSlyZXR1cm4gZC8yKmEqYSooKChnKj0xLjUyNSkrMSkqYS1nKStiO3JldHVybiBkLzIqKChhLT0yKSphKigoKGcqPTEuNTI1KSsxKSphK2cpKzIpK2J9LGVhc2VJbkJvdW5jZTpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkLWYuZWFzaW5nLmVhc2VPdXRCb3VuY2UoYyxlLWEsMCxkLGUpK2J9LGVhc2VPdXRCb3VuY2U6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4oYS89ZSk8MS8yLjc1P2QqNy41NjI1KmEqYStiOmE8Mi8yLjc1P2QqKDcuNTYyNSooYS09MS41LzIuNzUpKmErMC43NSkrYjphPDIuNS8yLjc1P2QqKDcuNTYyNSooYS09Mi4yNS8yLjc1KSphKzAuOTM3NSkrYjpkKig3LjU2MjUqKGEtPTIuNjI1LzIuNzUpKmErMC45ODQzNzUpK2J9LGVhc2VJbk91dEJvdW5jZTpmdW5jdGlvbihjLGEsYixkLGUpe2lmKGE8ZS8yKXJldHVybiBmLmVhc2luZy5lYXNlSW5Cb3VuY2UoYyxhKjIsMCxkLGUpKjAuNStiO3JldHVybiBmLmVhc2luZy5lYXNlT3V0Qm91bmNlKGMsYSoyLWUsMCxkLGUpKjAuNStkKjAuNStifX0pfShqUXVlcnkpOzsoZnVuY3Rpb24oZSl7ZS5lZmZlY3RzLmJvdW5jZT1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBhPWUodGhpcyksbD1bInBvc2l0aW9uIiwidG9wIiwiYm90dG9tIiwibGVmdCIsInJpZ2h0Il0saD1lLmVmZmVjdHMuc2V0TW9kZShhLGIub3B0aW9ucy5tb2RlfHwiZWZmZWN0IiksZD1iLm9wdGlvbnMuZGlyZWN0aW9ufHwidXAiLGM9Yi5vcHRpb25zLmRpc3RhbmNlfHwyMCxtPWIub3B0aW9ucy50aW1lc3x8NSxpPWIuZHVyYXRpb258fDI1MDsvc2hvd3xoaWRlLy50ZXN0KGgpJiZsLnB1c2goIm9wYWNpdHkiKTtlLmVmZmVjdHMuc2F2ZShhLGwpO2Euc2hvdygpO2UuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGEpO3ZhciBmPWQ9PSJ1cCJ8fGQ9PSJkb3duIj8idG9wIjoibGVmdCI7ZD1kPT0idXAifHxkPT0ibGVmdCI/InBvcyI6Im5lZyI7Yz1iLm9wdGlvbnMuZGlzdGFuY2V8fChmPT0idG9wIj9hLm91dGVySGVpZ2h0KHttYXJnaW46dHJ1ZX0pLzM6YS5vdXRlcldpZHRoKHttYXJnaW46dHJ1ZX0pLzMpO2lmKGg9PSJzaG93IilhLmNzcygib3BhY2l0eSIsMCkuY3NzKGYsZD09InBvcyI/LWM6Yyk7aWYoaD09ImhpZGUiKWMvPW0qMjtoIT0iaGlkZSImJm0tLTtpZihoPT0ic2hvdyIpe3ZhciBnPXtvcGFjaXR5OjF9O2dbZl09KGQ9PSJwb3MiPyIrPSI6Ii09IikrYzthLmFuaW1hdGUoZyxpLzIsYi5vcHRpb25zLmVhc2luZyk7Yy89MjttLS19Zm9yKGc9MDtnPG07ZysrKXt2YXIgaj17fSxrPXt9O2pbZl09KGQ9PSJwb3MiPyItPSI6Iis9IikrYztrW2ZdPShkPT0icG9zIj8iKz0iOiItPSIpK2M7YS5hbmltYXRlKGosaS8yLGIub3B0aW9ucy5lYXNpbmcpLmFuaW1hdGUoayxpLzIsYi5vcHRpb25zLmVhc2luZyk7Yz1oPT0iaGlkZSI/YyoyOmMvMn1pZihoPT0iaGlkZSIpe2c9e29wYWNpdHk6MH07Z1tmXT0oZD09InBvcyI/Ii09IjoiKz0iKStjO2EuYW5pbWF0ZShnLGkvMixiLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7YS5oaWRlKCk7ZS5lZmZlY3RzLnJlc3RvcmUoYSxsKTtlLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihhKTtiLmNhbGxiYWNrJiZiLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pfWVsc2V7aj17fTtrPXt9O2pbZl09KGQ9PSJwb3MiPyItPSI6Iis9IikrYztrW2ZdPShkPT0icG9zIj8iKz0iOiItPSIpK2M7YS5hbmltYXRlKGosaS8yLGIub3B0aW9ucy5lYXNpbmcpLmFuaW1hdGUoayxpLzIsYi5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2UuZWZmZWN0cy5yZXN0b3JlKGEsbCk7ZS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYSk7Yi5jYWxsYmFjayYmYi5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KX1hLnF1ZXVlKCJmeCIsZnVuY3Rpb24oKXthLmRlcXVldWUoKX0pO2EuZGVxdWV1ZSgpfSl9fSkoalF1ZXJ5KTs7KGZ1bmN0aW9uKGope2ouZWZmZWN0cy5leHBsb2RlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YS5vcHRpb25zLnBpZWNlcz9NYXRoLnJvdW5kKE1hdGguc3FydChhLm9wdGlvbnMucGllY2VzKSk6MyxkPWEub3B0aW9ucy5waWVjZXM/TWF0aC5yb3VuZChNYXRoLnNxcnQoYS5vcHRpb25zLnBpZWNlcykpOjM7YS5vcHRpb25zLm1vZGU9YS5vcHRpb25zLm1vZGU9PSJ0b2dnbGUiP2oodGhpcykuaXMoIjp2aXNpYmxlIik/ImhpZGUiOiJzaG93IjphLm9wdGlvbnMubW9kZTt2YXIgYj1qKHRoaXMpLnNob3coKS5jc3MoInZpc2liaWxpdHkiLCJoaWRkZW4iKSxnPWIub2Zmc2V0KCk7Zy50b3AtPXBhcnNlSW50KGIuY3NzKCJtYXJnaW5Ub3AiKSwxMCl8fDA7Zy5sZWZ0LT1wYXJzZUludChiLmNzcygibWFyZ2luTGVmdCIpLDEwKXx8MDtmb3IodmFyIGg9Yi5vdXRlcldpZHRoKHRydWUpLGk9Yi5vdXRlckhlaWdodCh0cnVlKSxlPTA7ZTxjO2UrKylmb3IodmFyIGY9MDtmPGQ7ZisrKWIuY2xvbmUoKS5hcHBlbmRUbygiYm9keSIpLndyYXAoIjxkaXY+PC9kaXY+IikuY3NzKHtwb3NpdGlvbjoiYWJzb2x1dGUiLHZpc2liaWxpdHk6InZpc2libGUiLGxlZnQ6LWYqKGgvZCksdG9wOi1lKihpL2MpfSkucGFyZW50KCkuYWRkQ2xhc3MoInVpLWVmZmVjdHMtZXhwbG9kZSIpLmNzcyh7cG9zaXRpb246ImFic29sdXRlIixvdmVyZmxvdzoiaGlkZGVuIix3aWR0aDpoL2QsaGVpZ2h0OmkvYyxsZWZ0OmcubGVmdCtmKihoL2QpKyhhLm9wdGlvbnMubW9kZT09InNob3ciPyhmLU1hdGguZmxvb3IoZC8yKSkqKGgvZCk6MCksdG9wOmcudG9wK2UqKGkvYykrKGEub3B0aW9ucy5tb2RlPT0ic2hvdyI/KGUtTWF0aC5mbG9vcihjLzIpKSooaS9jKTowKSxvcGFjaXR5OmEub3B0aW9ucy5tb2RlPT0ic2hvdyI/MDoxfSkuYW5pbWF0ZSh7bGVmdDpnLmxlZnQrZiooaC9kKSsoYS5vcHRpb25zLm1vZGU9PSJzaG93Ij8wOihmLU1hdGguZmxvb3IoZC8yKSkqKGgvZCkpLHRvcDpnLnRvcCsKZSooaS9jKSsoYS5vcHRpb25zLm1vZGU9PSJzaG93Ij8wOihlLU1hdGguZmxvb3IoYy8yKSkqKGkvYykpLG9wYWNpdHk6YS5vcHRpb25zLm1vZGU9PSJzaG93Ij8xOjB9LGEuZHVyYXRpb258fDUwMCk7c2V0VGltZW91dChmdW5jdGlvbigpe2Eub3B0aW9ucy5tb2RlPT0ic2hvdyI/Yi5jc3Moe3Zpc2liaWxpdHk6InZpc2libGUifSk6Yi5jc3Moe3Zpc2liaWxpdHk6InZpc2libGUifSkuaGlkZSgpO2EuY2FsbGJhY2smJmEuY2FsbGJhY2suYXBwbHkoYlswXSk7Yi5kZXF1ZXVlKCk7aigiZGl2LnVpLWVmZmVjdHMtZXhwbG9kZSIpLnJlbW92ZSgpfSxhLmR1cmF0aW9ufHw1MDApfSl9fSkoalF1ZXJ5KTs7KGZ1bmN0aW9uKGIpe2IuZWZmZWN0cy5mYWRlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9Yih0aGlzKSxkPWIuZWZmZWN0cy5zZXRNb2RlKGMsYS5vcHRpb25zLm1vZGV8fCJoaWRlIik7Yy5hbmltYXRlKHtvcGFjaXR5OmR9LHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjphLmR1cmF0aW9uLGVhc2luZzphLm9wdGlvbnMuZWFzaW5nLGNvbXBsZXRlOmZ1bmN0aW9uKCl7YS5jYWxsYmFjayYmYS5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Yy5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpOzsoZnVuY3Rpb24oYil7Yi5lZmZlY3RzLmhpZ2hsaWdodD1mdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBhPWIodGhpcyksZT1bImJhY2tncm91bmRJbWFnZSIsImJhY2tncm91bmRDb2xvciIsIm9wYWNpdHkiXSxkPWIuZWZmZWN0cy5zZXRNb2RlKGEsYy5vcHRpb25zLm1vZGV8fCJzaG93IiksZj17YmFja2dyb3VuZENvbG9yOmEuY3NzKCJiYWNrZ3JvdW5kQ29sb3IiKX07aWYoZD09ImhpZGUiKWYub3BhY2l0eT0wO2IuZWZmZWN0cy5zYXZlKGEsZSk7YS5zaG93KCkuY3NzKHtiYWNrZ3JvdW5kSW1hZ2U6Im5vbmUiLGJhY2tncm91bmRDb2xvcjpjLm9wdGlvbnMuY29sb3J8fCIjZmZmZjk5In0pLmFuaW1hdGUoZix7cXVldWU6ZmFsc2UsZHVyYXRpb246Yy5kdXJhdGlvbixlYXNpbmc6Yy5vcHRpb25zLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2Q9PSJoaWRlIiYmYS5oaWRlKCk7Yi5lZmZlY3RzLnJlc3RvcmUoYSxlKTtkPT0ic2hvdyImJiFiLnN1cHBvcnQub3BhY2l0eSYmdGhpcy5zdHlsZS5yZW1vdmVBdHRyaWJ1dGUoImZpbHRlciIpO2MuY2FsbGJhY2smJmMuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpO2EuZGVxdWV1ZSgpfX0pfSl9fSkoalF1ZXJ5KTs7KGZ1bmN0aW9uKGQpe2QuZWZmZWN0cy5wdWxzYXRlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGI9ZCh0aGlzKSxjPWQuZWZmZWN0cy5zZXRNb2RlKGIsYS5vcHRpb25zLm1vZGV8fCJzaG93Iik7dGltZXM9KGEub3B0aW9ucy50aW1lc3x8NSkqMi0xO2R1cmF0aW9uPWEuZHVyYXRpb24/YS5kdXJhdGlvbi8yOmQuZnguc3BlZWRzLl9kZWZhdWx0LzI7aXNWaXNpYmxlPWIuaXMoIjp2aXNpYmxlIik7YW5pbWF0ZVRvPTA7aWYoIWlzVmlzaWJsZSl7Yi5jc3MoIm9wYWNpdHkiLDApLnNob3coKTthbmltYXRlVG89MX1pZihjPT0iaGlkZSImJmlzVmlzaWJsZXx8Yz09InNob3ciJiYhaXNWaXNpYmxlKXRpbWVzLS07Zm9yKGM9MDtjPHRpbWVzO2MrKyl7Yi5hbmltYXRlKHtvcGFjaXR5OmFuaW1hdGVUb30sZHVyYXRpb24sYS5vcHRpb25zLmVhc2luZyk7YW5pbWF0ZVRvPShhbmltYXRlVG8rMSklMn1iLmFuaW1hdGUoe29wYWNpdHk6YW5pbWF0ZVRvfSxkdXJhdGlvbixhLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7YW5pbWF0ZVRvPT0wJiZiLmhpZGUoKTthLmNhbGxiYWNrJiZhLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pO2IucXVldWUoImZ4IixmdW5jdGlvbigpe2IuZGVxdWV1ZSgpfSkuZGVxdWV1ZSgpfSl9fSkoalF1ZXJ5KTs7KGZ1bmN0aW9uKGMpe2MuZWZmZWN0cy5wdWZmPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGE9Yyh0aGlzKSxlPWMuZWZmZWN0cy5zZXRNb2RlKGEsYi5vcHRpb25zLm1vZGV8fCJoaWRlIiksZz1wYXJzZUludChiLm9wdGlvbnMucGVyY2VudCwxMCl8fDE1MCxoPWcvMTAwLGk9e2hlaWdodDphLmhlaWdodCgpLHdpZHRoOmEud2lkdGgoKX07Yy5leHRlbmQoYi5vcHRpb25zLHtmYWRlOnRydWUsbW9kZTplLHBlcmNlbnQ6ZT09ImhpZGUiP2c6MTAwLGZyb206ZT09ImhpZGUiP2k6e2hlaWdodDppLmhlaWdodCpoLHdpZHRoOmkud2lkdGgqaH19KTthLmVmZmVjdCgic2NhbGUiLGIub3B0aW9ucyxiLmR1cmF0aW9uLGIuY2FsbGJhY2spO2EuZGVxdWV1ZSgpfSl9O2MuZWZmZWN0cy5zY2FsZT1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBhPWModGhpcyksZT1jLmV4dGVuZCh0cnVlLHt9LGIub3B0aW9ucyksZz1jLmVmZmVjdHMuc2V0TW9kZShhLGIub3B0aW9ucy5tb2RlfHwiZWZmZWN0IiksaD1wYXJzZUludChiLm9wdGlvbnMucGVyY2VudCwxMCl8fChwYXJzZUludChiLm9wdGlvbnMucGVyY2VudCwxMCk9PTA/MDpnPT0iaGlkZSI/MDoxMDApLGk9Yi5vcHRpb25zLmRpcmVjdGlvbnx8ImJvdGgiLGY9Yi5vcHRpb25zLm9yaWdpbjtpZihnIT0iZWZmZWN0Iil7ZS5vcmlnaW49Znx8WyJtaWRkbGUiLCJjZW50ZXIiXTtlLnJlc3RvcmU9dHJ1ZX1mPXtoZWlnaHQ6YS5oZWlnaHQoKSx3aWR0aDphLndpZHRoKCl9O2EuZnJvbT1iLm9wdGlvbnMuZnJvbXx8KGc9PSJzaG93Ij97aGVpZ2h0OjAsd2lkdGg6MH06Zik7aD17eTppIT0iaG9yaXpvbnRhbCI/aC8xMDA6MSx4OmkhPSJ2ZXJ0aWNhbCI/aC8xMDA6MX07YS50bz17aGVpZ2h0OmYuaGVpZ2h0KmgueSx3aWR0aDpmLndpZHRoKmgueH07aWYoYi5vcHRpb25zLmZhZGUpe2lmKGc9PSJzaG93Iil7YS5mcm9tLm9wYWNpdHk9MDthLnRvLm9wYWNpdHk9MX1pZihnPT0iaGlkZSIpe2EuZnJvbS5vcGFjaXR5PTE7YS50by5vcGFjaXR5PTB9fWUuZnJvbT1hLmZyb207ZS50bz1hLnRvO2UubW9kZT1nO2EuZWZmZWN0KCJzaXplIixlLGIuZHVyYXRpb24sYi5jYWxsYmFjayk7YS5kZXF1ZXVlKCl9KX07Yy5lZmZlY3RzLnNpemU9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYT1jKHRoaXMpLGU9WyJwb3NpdGlvbiIsInRvcCIsImJvdHRvbSIsImxlZnQiLCJyaWdodCIsIndpZHRoIiwiaGVpZ2h0Iiwib3ZlcmZsb3ciLCJvcGFjaXR5Il0sZz1bInBvc2l0aW9uIiwidG9wIiwiYm90dG9tIiwibGVmdCIsInJpZ2h0Iiwib3ZlcmZsb3ciLCJvcGFjaXR5Il0saD1bIndpZHRoIiwiaGVpZ2h0Iiwib3ZlcmZsb3ciXSxpPVsiZm9udFNpemUiXSxmPVsiYm9yZGVyVG9wV2lkdGgiLCJib3JkZXJCb3R0b21XaWR0aCIsInBhZGRpbmdUb3AiLCJwYWRkaW5nQm90dG9tIl0saz1bImJvcmRlckxlZnRXaWR0aCIsImJvcmRlclJpZ2h0V2lkdGgiLCJwYWRkaW5nTGVmdCIsInBhZGRpbmdSaWdodCJdLHA9Yy5lZmZlY3RzLnNldE1vZGUoYSxiLm9wdGlvbnMubW9kZXx8ImVmZmVjdCIpLG49Yi5vcHRpb25zLnJlc3RvcmV8fGZhbHNlLG09Yi5vcHRpb25zLnNjYWxlfHwiYm90aCIsbD1iLm9wdGlvbnMub3JpZ2luLGo9e2hlaWdodDphLmhlaWdodCgpLHdpZHRoOmEud2lkdGgoKX07YS5mcm9tPWIub3B0aW9ucy5mcm9tfHxqO2EudG89Yi5vcHRpb25zLnRvfHxqO2lmKGwpe2w9Yy5lZmZlY3RzLmdldEJhc2VsaW5lKGwsaik7YS5mcm9tLnRvcD0oai5oZWlnaHQtYS5mcm9tLmhlaWdodCkqbC55O2EuZnJvbS5sZWZ0PShqLndpZHRoLWEuZnJvbS53aWR0aCkqbC54O2EudG8udG9wPShqLmhlaWdodC1hLnRvLmhlaWdodCkqbC55O2EudG8ubGVmdD0oai53aWR0aC1hLnRvLndpZHRoKSpsLnh9dmFyIGQ9e2Zyb206e3k6YS5mcm9tLmhlaWdodC9qLmhlaWdodCx4OmEuZnJvbS53aWR0aC9qLndpZHRofSx0bzp7eTphLnRvLmhlaWdodC9qLmhlaWdodCx4OmEudG8ud2lkdGgvai53aWR0aH19O2lmKG09PSJib3gifHxtPT0iYm90aCIpe2lmKGQuZnJvbS55IT1kLnRvLnkpe2U9ZS5jb25jYXQoZik7YS5mcm9tPWMuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGEsZixkLmZyb20ueSxhLmZyb20pO2EudG89Yy5lZmZlY3RzLnNldFRyYW5zaXRpb24oYSxmLGQudG8ueSxhLnRvKX1pZihkLmZyb20ueCE9ZC50by54KXtlPWUuY29uY2F0KGspO2EuZnJvbT1jLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihhLGssZC5mcm9tLngsYS5mcm9tKTthLnRvPWMuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGEsayxkLnRvLngsYS50byl9fWlmKG09PSJjb250ZW50Inx8bT09ImJvdGgiKWlmKGQuZnJvbS55IT1kLnRvLnkpe2U9ZS5jb25jYXQoaSk7YS5mcm9tPWMuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGEsaSxkLmZyb20ueSxhLmZyb20pO2EudG89Yy5lZmZlY3RzLnNldFRyYW5zaXRpb24oYSxpLGQudG8ueSxhLnRvKX1jLmVmZmVjdHMuc2F2ZShhLG4/ZTpnKTthLnNob3coKTtjLmVmZmVjdHMuY3JlYXRlV3JhcHBlcihhKTthLmNzcygib3ZlcmZsb3ciLCJoaWRkZW4iKS5jc3MoYS5mcm9tKTtpZihtPT0iY29udGVudCJ8fG09PSJib3RoIil7Zj1mLmNvbmNhdChbIm1hcmdpblRvcCIsIm1hcmdpbkJvdHRvbSJdKS5jb25jYXQoaSk7az1rLmNvbmNhdChbIm1hcmdpbkxlZnQiLCJtYXJnaW5SaWdodCJdKTtoPWUuY29uY2F0KGYpLmNvbmNhdChrKTthLmZpbmQoIipbd2lkdGhdIikuZWFjaChmdW5jdGlvbigpe2NoaWxkPWModGhpcyk7biYmYy5lZmZlY3RzLnNhdmUoY2hpbGQsaCk7dmFyIG89e2hlaWdodDpjaGlsZC5oZWlnaHQoKSx3aWR0aDpjaGlsZC53aWR0aCgpfTtjaGlsZC5mcm9tPXtoZWlnaHQ6by5oZWlnaHQqZC5mcm9tLnksd2lkdGg6by53aWR0aCpkLmZyb20ueH07Y2hpbGQudG89e2hlaWdodDpvLmhlaWdodCpkLnRvLnksd2lkdGg6by53aWR0aCpkLnRvLnh9O2lmKGQuZnJvbS55IT1kLnRvLnkpe2NoaWxkLmZyb209Yy5lZmZlY3RzLnNldFRyYW5zaXRpb24oY2hpbGQsZixkLmZyb20ueSxjaGlsZC5mcm9tKTtjaGlsZC50bz1jLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjaGlsZCxmLGQudG8ueSxjaGlsZC50byl9aWYoZC5mcm9tLnghPWQudG8ueCl7Y2hpbGQuZnJvbT1jLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjaGlsZCxrLGQuZnJvbS54LGNoaWxkLmZyb20pO2NoaWxkLnRvPWMuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGNoaWxkLGssZC50by54LGNoaWxkLnRvKX1jaGlsZC5jc3MoY2hpbGQuZnJvbSk7Y2hpbGQuYW5pbWF0ZShjaGlsZC50byxiLmR1cmF0aW9uLGIub3B0aW9ucy5lYXNpbmcsZnVuY3Rpb24oKXtuJiZjLmVmZmVjdHMucmVzdG9yZShjaGlsZCxoKX0pfSl9YS5hbmltYXRlKGEudG8se3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmIuZHVyYXRpb24sZWFzaW5nOmIub3B0aW9ucy5lYXNpbmcsY29tcGxldGU6ZnVuY3Rpb24oKXthLnRvLm9wYWNpdHk9PT0wJiZhLmNzcygib3BhY2l0eSIsYS5mcm9tLm9wYWNpdHkpO3A9PSJoaWRlIiYmYS5oaWRlKCk7Yy5lZmZlY3RzLnJlc3RvcmUoYSxuP2U6Zyk7Yy5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYSk7Yi5jYWxsYmFjayYmYi5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7YS5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpOzsoZnVuY3Rpb24oZCl7ZC5lZmZlY3RzLnNoYWtlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGI9ZCh0aGlzKSxqPVsicG9zaXRpb24iLCJ0b3AiLCJib3R0b20iLCJsZWZ0IiwicmlnaHQiXTtkLmVmZmVjdHMuc2V0TW9kZShiLGEub3B0aW9ucy5tb2RlfHwiZWZmZWN0Iik7dmFyIGM9YS5vcHRpb25zLmRpcmVjdGlvbnx8ImxlZnQiLGU9YS5vcHRpb25zLmRpc3RhbmNlfHwyMCxsPWEub3B0aW9ucy50aW1lc3x8MyxmPWEuZHVyYXRpb258fGEub3B0aW9ucy5kdXJhdGlvbnx8MTQwO2QuZWZmZWN0cy5zYXZlKGIsaik7Yi5zaG93KCk7ZC5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoYik7dmFyIGc9Yz09InVwInx8Yz09ImRvd24iPyJ0b3AiOiJsZWZ0IixoPWM9PSJ1cCJ8fGM9PSJsZWZ0Ij8icG9zIjoibmVnIjtjPXt9O3ZhciBpPXt9LGs9e307Y1tnXT0oaD09InBvcyI/Ii09IjoiKz0iKStlO2lbZ109KGg9PSJwb3MiPyIrPSI6Ii09IikrZSoyO2tbZ109KGg9PSJwb3MiPyItPSI6Iis9IikrZSoyO2IuYW5pbWF0ZShjLGYsYS5vcHRpb25zLmVhc2luZyk7Zm9yKGU9MTtlPGw7ZSsrKWIuYW5pbWF0ZShpLGYsYS5vcHRpb25zLmVhc2luZykuYW5pbWF0ZShrLGYsYS5vcHRpb25zLmVhc2luZyk7Yi5hbmltYXRlKGksZixhLm9wdGlvbnMuZWFzaW5nKS5hbmltYXRlKGMsZi8yLGEub3B0aW9ucy5lYXNpbmcsZnVuY3Rpb24oKXtkLmVmZmVjdHMucmVzdG9yZShiLGopO2QuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGIpO2EuY2FsbGJhY2smJmEuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpfSk7Yi5xdWV1ZSgiZngiLGZ1bmN0aW9uKCl7Yi5kZXF1ZXVlKCl9KTtiLmRlcXVldWUoKX0pfX0pKGpRdWVyeSk7OyhmdW5jdGlvbigkKXskLmZuLmF1dG9ncm93PWZ1bmN0aW9uKG9wdGlvbnMpe3RoaXMuZmlsdGVyKCd0ZXh0YXJlYScpLmVhY2goZnVuY3Rpb24oKXt2YXIgJHRoaXM9JCh0aGlzKSxtaW5IZWlnaHQ9JHRoaXMuaGVpZ2h0KCksbGluZUhlaWdodD0kdGhpcy5jc3MoJ2xpbmVIZWlnaHQnKTt2YXIgc2hhZG93PSQoJzxkaXY+PC9kaXY+JykuY3NzKHtwb3NpdGlvbjonYWJzb2x1dGUnLHRvcDotMTAwMDAsbGVmdDotMTAwMDAsd2lkdGg6JCh0aGlzKS53aWR0aCgpLXBhcnNlSW50KCR0aGlzLmNzcygncGFkZGluZ0xlZnQnKSktcGFyc2VJbnQoJHRoaXMuY3NzKCdwYWRkaW5nUmlnaHQnKSksZm9udFNpemU6JHRoaXMuY3NzKCdmb250U2l6ZScpLGZvbnRGYW1pbHk6JHRoaXMuY3NzKCdmb250RmFtaWx5JyksbGluZUhlaWdodDokdGhpcy5jc3MoJ2xpbmVIZWlnaHQnKSxyZXNpemU6J25vbmUnfSkuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSk7dmFyIHVwZGF0ZT1mdW5jdGlvbigpe3ZhciB0aW1lcz1mdW5jdGlvbihzdHJpbmcsbnVtYmVyKXtmb3IodmFyIGk9MCxyPScnO2k8bnVtYmVyO2krKylyKz1zdHJpbmc7cmV0dXJuIHI7fTt2YXIgdmFsPXRoaXMudmFsdWUucmVwbGFjZSgvPC9nLCcmbHQ7JykucmVwbGFjZSgvPi9nLCcmZ3Q7JykucmVwbGFjZSgvJi9nLCcmYW1wOycpLnJlcGxhY2UoL1xuJC8sJzxici8+Jm5ic3A7JykucmVwbGFjZSgvXG4vZywnPGJyLz4nKS5yZXBsYWNlKC8gezIsfS9nLGZ1bmN0aW9uKHNwYWNlKXtyZXR1cm4gdGltZXMoJyZuYnNwOycsc3BhY2UubGVuZ3RoLTEpKycgJ30pO3NoYWRvdy5odG1sKHZhbCk7JCh0aGlzKS5jc3MoJ2hlaWdodCcsTWF0aC5tYXgoc2hhZG93LmhlaWdodCgpKzIwLG1pbkhlaWdodCkpO30KJCh0aGlzKS5jaGFuZ2UodXBkYXRlKS5rZXl1cCh1cGRhdGUpLmtleWRvd24odXBkYXRlKTt1cGRhdGUuYXBwbHkodGhpcyk7fSk7cmV0dXJuIHRoaXM7fX0pKGpRdWVyeSk7d2luZG93LnJhbmd5PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gayhvLHUpe3ZhciB4PXR5cGVvZiBvW3VdO3JldHVybiB4PT0iZnVuY3Rpb24ifHwhISh4PT0ib2JqZWN0IiYmb1t1XSl8fHg9PSJ1bmtub3duIn1mdW5jdGlvbiBMKG8sdSl7cmV0dXJuISEodHlwZW9mIG9bdV09PSJvYmplY3QiJiZvW3VdKX1mdW5jdGlvbiBKKG8sdSl7cmV0dXJuIHR5cGVvZiBvW3VdIT0idW5kZWZpbmVkIn1mdW5jdGlvbiBLKG8pe3JldHVybiBmdW5jdGlvbih1LHgpe2Zvcih2YXIgQj14Lmxlbmd0aDtCLS07KWlmKCFvKHUseFtCXSkpcmV0dXJuIGZhbHNlO3JldHVybiB0cnVlfX1mdW5jdGlvbiB6KG8pe3JldHVybiBvJiZBKG8seSkmJnYobyxzKX1mdW5jdGlvbiBDKG8pe3dpbmRvdy5hbGVydCgiUmFuZ3kgbm90IHN1cHBvcnRlZCBpbiB5b3VyIGJyb3dzZXIuIFJlYXNvbjogIitvKTtjLmluaXRpYWxpemVkPXRydWU7Yy5zdXBwb3J0ZWQ9ZmFsc2V9ZnVuY3Rpb24gTigpe2lmKCFjLmluaXRpYWxpemVkKXt2YXIgbyx1PWZhbHNlLHg9ZmFsc2U7aWYoayhkb2N1bWVudCwiY3JlYXRlUmFuZ2UiKSl7bz1kb2N1bWVudC5jcmVhdGVSYW5nZSgpO2lmKEEobyxuKSYmdihvLGgpKXU9dHJ1ZTtvLmRldGFjaCgpfWlmKChvPUwoZG9jdW1lbnQsImJvZHkiKT9kb2N1bWVudC5ib2R5OmRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0pJiZrKG8sImNyZWF0ZVRleHRSYW5nZSIpKXtvPW8uY3JlYXRlVGV4dFJhbmdlKCk7aWYoeihvKSl4PXRydWV9IXUmJiF4JiZDKCJOZWl0aGVyIFJhbmdlIG5vciBUZXh0UmFuZ2UgYXJlIGltcGxlbWVudGVkIik7Yy5pbml0aWFsaXplZD10cnVlO2MuZmVhdHVyZXM9e2ltcGxlbWVudHNEb21SYW5nZTp1LGltcGxlbWVudHNUZXh0UmFuZ2U6eH07dT1qLmNvbmNhdChmKTt4PTA7Zm9yKG89dS5sZW5ndGg7eDxvOysreCl0cnl7dVt4XShjKX1jYXRjaChCKXtMKHdpbmRvdywiY29uc29sZSIpJiZrKHdpbmRvdy5jb25zb2xlLCJsb2ciKSYmd2luZG93LmNvbnNvbGUubG9nKCJJbml0IGxpc3RlbmVyIHRocmV3IGFuIGV4Y2VwdGlvbi4gQ29udGludWluZy4iLEIpfX19ZnVuY3Rpb24gUChvKXt0aGlzLm5hbWU9bzt0aGlzLnN1cHBvcnRlZD10aGlzLmluaXRpYWxpemVkPWZhbHNlfXZhciBoPVsic3RhcnRDb250YWluZXIiLCJzdGFydE9mZnNldCIsImVuZENvbnRhaW5lciIsImVuZE9mZnNldCIsImNvbGxhcHNlZCIsImNvbW1vbkFuY2VzdG9yQ29udGFpbmVyIiwiU1RBUlRfVE9fU1RBUlQiLCJTVEFSVF9UT19FTkQiLCJFTkRfVE9fU1RBUlQiLCJFTkRfVE9fRU5EIl0sbj1bInNldFN0YXJ0Iiwic2V0U3RhcnRCZWZvcmUiLCJzZXRTdGFydEFmdGVyIiwic2V0RW5kIiwic2V0RW5kQmVmb3JlIiwic2V0RW5kQWZ0ZXIiLCJjb2xsYXBzZSIsInNlbGVjdE5vZGUiLCJzZWxlY3ROb2RlQ29udGVudHMiLCJjb21wYXJlQm91bmRhcnlQb2ludHMiLCJkZWxldGVDb250ZW50cyIsImV4dHJhY3RDb250ZW50cyIsImNsb25lQ29udGVudHMiLCJpbnNlcnROb2RlIiwic3Vycm91bmRDb250ZW50cyIsImNsb25lUmFuZ2UiLCJ0b1N0cmluZyIsImRldGFjaCJdLHM9WyJib3VuZGluZ0hlaWdodCIsImJvdW5kaW5nTGVmdCIsImJvdW5kaW5nVG9wIiwiYm91bmRpbmdXaWR0aCIsImh0bWxUZXh0IiwidGV4dCJdLHk9WyJjb2xsYXBzZSIsImNvbXBhcmVFbmRQb2ludHMiLCJkdXBsaWNhdGUiLCJnZXRCb29rbWFyayIsIm1vdmVUb0Jvb2ttYXJrIiwibW92ZVRvRWxlbWVudFRleHQiLCJwYXJlbnRFbGVtZW50IiwicGFzdGVIVE1MIiwic2VsZWN0Iiwic2V0RW5kUG9pbnQiXSxBPUsoaykscD1LKEwpLHY9SyhKKSxjPXt2ZXJzaW9uOiIxLjJiZXRhMiIsaW5pdGlhbGl6ZWQ6ZmFsc2Usc3VwcG9ydGVkOnRydWUsdXRpbDp7aXNIb3N0TWV0aG9kOmssaXNIb3N0T2JqZWN0OkwsaXNIb3N0UHJvcGVydHk6SixhcmVIb3N0TWV0aG9kczpBLGFyZUhvc3RPYmplY3RzOnAsYXJlSG9zdFByb3BlcnRpZXM6dixpc1RleHRSYW5nZTp6fSxmZWF0dXJlczp7fSxtb2R1bGVzOnt9LGNvbmZpZzp7YWxlcnRPbldhcm46ZmFsc2UscHJlZmVyVGV4dFJhbmdlOmZhbHNlfX07Yy5mYWlsPUM7Yy53YXJuPWZ1bmN0aW9uKG8pe289IlJhbmd5IHdhcm5pbmc6ICIrbztpZihjLmNvbmZpZy5hbGVydE9uV2Fybil3aW5kb3cuYWxlcnQobyk7ZWxzZSB0eXBlb2Ygd2luZG93LmNvbnNvbGUhPSJ1bmRlZmluZWQiJiZ0eXBlb2Ygd2luZG93LmNvbnNvbGUubG9nIT0idW5kZWZpbmVkIiYmd2luZG93LmNvbnNvbGUubG9nKG8pfTtpZih7fS5oYXNPd25Qcm9wZXJ0eSljLnV0aWwuZXh0ZW5kPWZ1bmN0aW9uKG8sdSl7Zm9yKHZhciB4IGluIHUpaWYodS5oYXNPd25Qcm9wZXJ0eSh4KSlvW3hdPXVbeF19O2Vsc2UgQygiaGFzT3duUHJvcGVydHkgbm90IHN1cHBvcnRlZCIpO3ZhciBmPVtdLGo9W107Yy5pbml0PU47Yy5hZGRJbml0TGlzdGVuZXI9ZnVuY3Rpb24obyl7Yy5pbml0aWFsaXplZD9vKGMpOmYucHVzaChvKX07dmFyIHI9W107Yy5hZGRDcmVhdGVNaXNzaW5nTmF0aXZlQXBpTGlzdGVuZXI9ZnVuY3Rpb24obyl7ci5wdXNoKG8pfTtjLmNyZWF0ZU1pc3NpbmdOYXRpdmVBcGk9ZnVuY3Rpb24obyl7bz1vfHx3aW5kb3c7TigpO2Zvcih2YXIgdT0wLHg9ci5sZW5ndGg7dTx4OysrdSlyW3VdKG8pfTtQLnByb3RvdHlwZS5mYWlsPWZ1bmN0aW9uKG8pe3RoaXMuaW5pdGlhbGl6ZWQ9dHJ1ZTt0aGlzLnN1cHBvcnRlZD1mYWxzZTt0aHJvdyBFcnJvcigiTW9kdWxlICciK3RoaXMubmFtZSsiJyBmYWlsZWQgdG8gbG9hZDogIitvKTt9O1AucHJvdG90eXBlLndhcm49ZnVuY3Rpb24obyl7Yy53YXJuKCJNb2R1bGUgIit0aGlzLm5hbWUrIjogIitvKX07UC5wcm90b3R5cGUuY3JlYXRlRXJyb3I9ZnVuY3Rpb24obyl7cmV0dXJuIEVycm9yKCJFcnJvciBpbiBSYW5neSAiK3RoaXMubmFtZSsiIG1vZHVsZTogIitvKX07Yy5jcmVhdGVNb2R1bGU9ZnVuY3Rpb24obyx1KXt2YXIgeD1uZXcgUChvKTtjLm1vZHVsZXNbb109eDtqLnB1c2goZnVuY3Rpb24oQil7dShCLHgpO3guaW5pdGlhbGl6ZWQ9dHJ1ZTt4LnN1cHBvcnRlZD10cnVlfSl9O2MucmVxdWlyZU1vZHVsZXM9ZnVuY3Rpb24obyl7Zm9yKHZhciB1PTAseD1vLmxlbmd0aCxCLEQ7dTx4OysrdSl7RD1vW3VdO0I9Yy5tb2R1bGVzW0RdO2lmKCFCfHwhKEIgaW5zdGFuY2VvZiBQKSl0aHJvdyBFcnJvcigiTW9kdWxlICciK0QrIicgbm90IGZvdW5kIik7aWYoIUIuc3VwcG9ydGVkKXRocm93IEVycm9yKCJNb2R1bGUgJyIrRCsiJyBub3Qgc3VwcG9ydGVkIik7fX07dmFyIE09ZmFsc2U7cD1mdW5jdGlvbigpe2lmKCFNKXtNPXRydWU7Yy5pbml0aWFsaXplZHx8TigpfX07aWYodHlwZW9mIHdpbmRvdz09InVuZGVmaW5lZCIpQygiTm8gd2luZG93IGZvdW5kIik7ZWxzZSBpZih0eXBlb2YgZG9jdW1lbnQ9PSJ1bmRlZmluZWQiKUMoIk5vIGRvY3VtZW50IGZvdW5kIik7ZWxzZXtrKGRvY3VtZW50LCJhZGRFdmVudExpc3RlbmVyIikmJmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLHAsZmFsc2UpO2lmKGsod2luZG93LCJhZGRFdmVudExpc3RlbmVyIikpd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLHAsZmFsc2UpO2Vsc2Ugayh3aW5kb3csImF0dGFjaEV2ZW50Iik/d2luZG93LmF0dGFjaEV2ZW50KCJvbmxvYWQiLHApOkMoIldpbmRvdyBkb2VzIG5vdCBoYXZlIHJlcXVpcmVkIGFkZEV2ZW50TGlzdGVuZXIgb3IgYXR0YWNoRXZlbnQgbWV0aG9kIik7cmV0dXJuIGN9fSgpO3Jhbmd5LmNyZWF0ZU1vZHVsZSgiRG9tVXRpbCIsZnVuY3Rpb24oayxMKXtmdW5jdGlvbiBKKGMpe2Zvcih2YXIgZj0wO2M9Yy5wcmV2aW91c1NpYmxpbmc7KWYrKztyZXR1cm4gZn1mdW5jdGlvbiBLKGMsZil7dmFyIGo9W10scjtmb3Iocj1jO3I7cj1yLnBhcmVudE5vZGUpai5wdXNoKHIpO2ZvcihyPWY7cjtyPXIucGFyZW50Tm9kZSlpZih2KGoscikpcmV0dXJuIHI7cmV0dXJuIG51bGx9ZnVuY3Rpb24geihjLGYsail7Zm9yKGo9aj9jOmMucGFyZW50Tm9kZTtqOyl7Yz1qLnBhcmVudE5vZGU7aWYoYz09PWYpcmV0dXJuIGo7aj1jfXJldHVybiBudWxsfWZ1bmN0aW9uIEMoYyl7Yz1jLm5vZGVUeXBlO3JldHVybiBjPT0zfHxjPT00fHxjPT04fWZ1bmN0aW9uIE4oYyxmKXt2YXIgaj1mLm5leHRTaWJsaW5nLHI9Zi5wYXJlbnROb2RlO2o/ci5pbnNlcnRCZWZvcmUoYyxqKTpyLmFwcGVuZENoaWxkKGMpO3JldHVybiBjfWZ1bmN0aW9uIFAoYyl7aWYoYy5ub2RlVHlwZT09OSlyZXR1cm4gYztlbHNlIGlmKHR5cGVvZiBjLm93bmVyRG9jdW1lbnQhPSJ1bmRlZmluZWQiKXJldHVybiBjLm93bmVyRG9jdW1lbnQ7ZWxzZSBpZih0eXBlb2YgYy5kb2N1bWVudCE9InVuZGVmaW5lZCIpcmV0dXJuIGMuZG9jdW1lbnQ7ZWxzZSBpZihjLnBhcmVudE5vZGUpcmV0dXJuIFAoYy5wYXJlbnROb2RlKTtlbHNlIHRocm93IEVycm9yKCJnZXREb2N1bWVudDogbm8gZG9jdW1lbnQgZm91bmQgZm9yIG5vZGUiKTt9ZnVuY3Rpb24gaChjKXtpZighYylyZXR1cm4iW05vIG5vZGVdIjtyZXR1cm4gQyhjKT8nIicrYy5kYXRhKyciJzpjLm5vZGVUeXBlPT0xPyI8IitjLm5vZGVOYW1lKyhjLmlkPycgaWQ9IicrYy5pZCsnIic6IiIpKyI+WyIrYy5jaGlsZE5vZGVzLmxlbmd0aCsiXSI6Yy5ub2RlTmFtZX1mdW5jdGlvbiBuKGMpe3RoaXMuX25leHQ9dGhpcy5yb290PWN9ZnVuY3Rpb24gcyhjLGYpe3RoaXMubm9kZT1jO3RoaXMub2Zmc2V0PWZ9ZnVuY3Rpb24geShjKXt0aGlzLmNvZGU9dGhpc1tjXTt0aGlzLmNvZGVOYW1lPWM7dGhpcy5tZXNzYWdlPSJET01FeGNlcHRpb246ICIrdGhpcy5jb2RlTmFtZX12YXIgQT1rLnV0aWw7QS5hcmVIb3N0TWV0aG9kcyhkb2N1bWVudCxbImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJjcmVhdGVFbGVtZW50IiwiY3JlYXRlVGV4dE5vZGUiXSl8fEwuZmFpbCgiZG9jdW1lbnQgbWlzc2luZyBhIE5vZGUgY3JlYXRpb24gbWV0aG9kIik7QS5pc0hvc3RNZXRob2QoZG9jdW1lbnQsImdldEVsZW1lbnRzQnlUYWdOYW1lIil8fEwuZmFpbCgiZG9jdW1lbnQgbWlzc2luZyBnZXRFbGVtZW50c0J5VGFnTmFtZSBtZXRob2QiKTt2YXIgcD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTtBLmFyZUhvc3RNZXRob2RzKHAsWyJpbnNlcnRCZWZvcmUiLCJhcHBlbmRDaGlsZCIsImNsb25lTm9kZSJdKXx8TC5mYWlsKCJJbmNvbXBsZXRlIEVsZW1lbnQgaW1wbGVtZW50YXRpb24iKTtwPWRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJ0ZXN0Iik7QS5hcmVIb3N0TWV0aG9kcyhwLFsic3BsaXRUZXh0IiwiZGVsZXRlRGF0YSIsImluc2VydERhdGEiLCJhcHBlbmREYXRhIiwiY2xvbmVOb2RlIl0pfHxMLmZhaWwoIkluY29tcGxldGUgVGV4dCBOb2RlIGltcGxlbWVudGF0aW9uIik7dmFyIHY9ZnVuY3Rpb24oYyxmKXtmb3IodmFyIGo9Yy5sZW5ndGg7ai0tOylpZihjW2pdPT09ZilyZXR1cm4gdHJ1ZTtyZXR1cm4gZmFsc2V9O24ucHJvdG90eXBlPXtfY3VycmVudDpudWxsLGhhc05leHQ6ZnVuY3Rpb24oKXtyZXR1cm4hIXRoaXMuX25leHR9LG5leHQ6ZnVuY3Rpb24oKXt2YXIgYz10aGlzLl9jdXJyZW50PXRoaXMuX25leHQsZjtpZih0aGlzLl9jdXJyZW50KWlmKGY9Yy5maXJzdENoaWxkKXRoaXMuX25leHQ9ZjtlbHNle2ZvcihmPW51bGw7YyE9PXRoaXMucm9vdCYmIShmPWMubmV4dFNpYmxpbmcpOyljPWMucGFyZW50Tm9kZTt0aGlzLl9uZXh0PWZ9cmV0dXJuIHRoaXMuX2N1cnJlbnR9LGRldGFjaDpmdW5jdGlvbigpe3RoaXMuX2N1cnJlbnQ9dGhpcy5fbmV4dD10aGlzLnJvb3Q9bnVsbH19O3MucHJvdG90eXBlPXtlcXVhbHM6ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMubm9kZT09PWMubm9kZSZ0aGlzLm9mZnNldD09Yy5vZmZzZXR9LGluc3BlY3Q6ZnVuY3Rpb24oKXtyZXR1cm4iW0RvbVBvc2l0aW9uKCIraCh0aGlzLm5vZGUpKyI6Iit0aGlzLm9mZnNldCsiKV0ifX07eS5wcm90b3R5cGU9e0lOREVYX1NJWkVfRVJSOjEsSElFUkFSQ0hZX1JFUVVFU1RfRVJSOjMsV1JPTkdfRE9DVU1FTlRfRVJSOjQsTk9fTU9ESUZJQ0FUSU9OX0FMTE9XRURfRVJSOjcsTk9UX0ZPVU5EX0VSUjo4LE5PVF9TVVBQT1JURURfRVJSOjksSU5WQUxJRF9TVEFURV9FUlI6MTF9O3kucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWVzc2FnZX07ay5kb209e2FycmF5Q29udGFpbnM6dixnZXROb2RlSW5kZXg6SixnZXROb2RlTGVuZ3RoOmZ1bmN0aW9uKGMpe3ZhciBmO3JldHVybiBDKGMpP2MubGVuZ3RoOihmPWMuY2hpbGROb2Rlcyk/Zi5sZW5ndGg6MH0sZ2V0Q29tbW9uQW5jZXN0b3I6Syxpc0FuY2VzdG9yT2Y6ZnVuY3Rpb24oYyxmLGope2ZvcihmPWo/ZjpmLnBhcmVudE5vZGU7ZjspaWYoZj09PWMpcmV0dXJuIHRydWU7ZWxzZSBmPWYucGFyZW50Tm9kZTtyZXR1cm4gZmFsc2V9LGdldENsb3Nlc3RBbmNlc3RvckluOnosaXNDaGFyYWN0ZXJEYXRhTm9kZTpDLGluc2VydEFmdGVyOk4sc3BsaXREYXRhTm9kZTpmdW5jdGlvbihjLGYpe3ZhciBqPWMuY2xvbmVOb2RlKGZhbHNlKTtqLmRlbGV0ZURhdGEoMCxmKTtjLmRlbGV0ZURhdGEoZixjLmxlbmd0aC1mKTtOKGosYyk7cmV0dXJuIGp9LGdldERvY3VtZW50OlAsZ2V0V2luZG93OmZ1bmN0aW9uKGMpe2M9UChjKTtpZih0eXBlb2YgYy5kZWZhdWx0VmlldyE9InVuZGVmaW5lZCIpcmV0dXJuIGMuZGVmYXVsdFZpZXc7ZWxzZSBpZih0eXBlb2YgYy5wYXJlbnRXaW5kb3chPSJ1bmRlZmluZWQiKXJldHVybiBjLnBhcmVudFdpbmRvdztlbHNlIHRocm93IEVycm9yKCJDYW5ub3QgZ2V0IGEgd2luZG93IG9iamVjdCBmb3Igbm9kZSIpO30sZ2V0SWZyYW1lV2luZG93OmZ1bmN0aW9uKGMpe2lmKHR5cGVvZiBjLmNvbnRlbnRXaW5kb3chPSJ1bmRlZmluZWQiKXJldHVybiBjLmNvbnRlbnRXaW5kb3c7ZWxzZSBpZih0eXBlb2YgYy5jb250ZW50RG9jdW1lbnQhPSJ1bmRlZmluZWQiKXJldHVybiBjLmNvbnRlbnREb2N1bWVudC5kZWZhdWx0VmlldztlbHNlIHRocm93IEVycm9yKCJnZXRJZnJhbWVXaW5kb3c6IE5vIFdpbmRvdyBvYmplY3QgZm91bmQgZm9yIGlmcmFtZSBlbGVtZW50Iik7fSxnZXRJZnJhbWVEb2N1bWVudDpmdW5jdGlvbihjKXtpZih0eXBlb2YgYy5jb250ZW50RG9jdW1lbnQhPSJ1bmRlZmluZWQiKXJldHVybiBjLmNvbnRlbnREb2N1bWVudDtlbHNlIGlmKHR5cGVvZiBjLmNvbnRlbnRXaW5kb3chPSJ1bmRlZmluZWQiKXJldHVybiBjLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7ZWxzZSB0aHJvdyBFcnJvcigiZ2V0SWZyYW1lV2luZG93OiBObyBEb2N1bWVudCBvYmplY3QgZm91bmQgZm9yIGlmcmFtZSBlbGVtZW50Iik7fSxnZXRCb2R5OmZ1bmN0aW9uKGMpe3JldHVybiBBLmlzSG9zdE9iamVjdChjLCJib2R5Iik/Yy5ib2R5OmMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXX0sZ2V0Um9vdENvbnRhaW5lcjpmdW5jdGlvbihjKXtmb3IodmFyIGY7Zj1jLnBhcmVudE5vZGU7KWM9ZjtyZXR1cm4gY30sY29tcGFyZVBvaW50czpmdW5jdGlvbihjLGYsaixyKXt2YXIgTTtpZihjPT1qKXJldHVybiBmPT09cj8wOmY8cj8tMToxO2Vsc2UgaWYoTT16KGosYyx0cnVlKSlyZXR1cm4gZjw9SihNKT8tMToxO2Vsc2UgaWYoTT16KGMsaix0cnVlKSlyZXR1cm4gSihNKTxyPy0xOjE7ZWxzZXtmPUsoYyxqKTtjPWM9PT1mP2Y6eihjLGYsdHJ1ZSk7aj1qPT09Zj9mOnooaixmLHRydWUpO2lmKGM9PT1qKXRocm93IEVycm9yKCJjb21wYXJlUG9pbnRzIGdvdCB0byBjYXNlIDQgYW5kIGNoaWxkQSBhbmQgY2hpbGRCIGFyZSB0aGUgc2FtZSEiKTtlbHNle2ZvcihmPWYuZmlyc3RDaGlsZDtmOyl7aWYoZj09PWMpcmV0dXJuLTE7ZWxzZSBpZihmPT09ailyZXR1cm4gMTtmPWYubmV4dFNpYmxpbmd9dGhyb3cgRXJyb3IoIlNob3VsZCBub3QgYmUgaGVyZSEiKTt9fX0saW5zcGVjdE5vZGU6aCxjcmVhdGVJdGVyYXRvcjpmdW5jdGlvbihjKXtyZXR1cm4gbmV3IG4oYyl9LERvbVBvc2l0aW9uOnN9O2suRE9NRXhjZXB0aW9uPXl9KTtyYW5neS5jcmVhdGVNb2R1bGUoIkRvbVJhbmdlIixmdW5jdGlvbihrKXtmdW5jdGlvbiBMKGEsZSl7cmV0dXJuIGEubm9kZVR5cGUhPTMmJihsLmlzQW5jZXN0b3JPZihhLGUuc3RhcnRDb250YWluZXIsdHJ1ZSl8fGwuaXNBbmNlc3Rvck9mKGEsZS5lbmRDb250YWluZXIsdHJ1ZSkpfWZ1bmN0aW9uIEooYSl7cmV0dXJuIGwuZ2V0RG9jdW1lbnQoYS5zdGFydENvbnRhaW5lcil9ZnVuY3Rpb24gSyhhLGUsZyl7aWYoZT1hLl9saXN0ZW5lcnNbZV0pZm9yKHZhciBxPTAsRz1lLmxlbmd0aDtxPEc7KytxKWVbcV0uY2FsbChhLHt0YXJnZXQ6YSxhcmdzOmd9KX1mdW5jdGlvbiB6KGEpe3JldHVybiBuZXcgRShhLnBhcmVudE5vZGUsbC5nZXROb2RlSW5kZXgoYSkpfWZ1bmN0aW9uIEMoYSl7cmV0dXJuIG5ldyBFKGEucGFyZW50Tm9kZSxsLmdldE5vZGVJbmRleChhKSsxKX1mdW5jdGlvbiBOKGEsZSxnKXt2YXIgcT1hLm5vZGVUeXBlPT0xMT9hLmZpcnN0Q2hpbGQ6YTtpZihsLmlzQ2hhcmFjdGVyRGF0YU5vZGUoZSkpZz09ZS5sZW5ndGg/bC5pbnNlcnRBZnRlcihhLGUpOmUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSxnPT0wP2U6bC5zcGxpdERhdGFOb2RlKGUsZykpO2Vsc2UgZz49ZS5jaGlsZE5vZGVzLmxlbmd0aD9lLmFwcGVuZENoaWxkKGEpOmUuaW5zZXJ0QmVmb3JlKGEsZS5jaGlsZE5vZGVzW2ddKTtyZXR1cm4gcX1mdW5jdGlvbiBQKGEpe2Zvcih2YXIgZSxnLHE9SihhLnJhbmdlKS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7Zz1hLm5leHQoKTspe2U9YS5pc1BhcnRpYWxseVNlbGVjdGVkU3VidHJlZSgpO2c9Zy5jbG9uZU5vZGUoIWUpO2lmKGUpe2U9YS5nZXRTdWJ0cmVlSXRlcmF0b3IoKTtnLmFwcGVuZENoaWxkKFAoZSkpO2UuZGV0YWNoKHRydWUpfWlmKGcubm9kZVR5cGU9PTEwKXRocm93IG5ldyBRKCJISUVSQVJDSFlfUkVRVUVTVF9FUlIiKTtxLmFwcGVuZENoaWxkKGcpfXJldHVybiBxfWZ1bmN0aW9uIGgoYSxlLGcpe3ZhciBxLEc7Zm9yKGc9Z3x8e3N0b3A6ZmFsc2V9O3E9YS5uZXh0KCk7KWlmKGEuaXNQYXJ0aWFsbHlTZWxlY3RlZFN1YnRyZWUoKSlpZihlKHEpPT09ZmFsc2Upe2cuc3RvcD10cnVlO3JldHVybn1lbHNle3E9YS5nZXRTdWJ0cmVlSXRlcmF0b3IoKTtoKHEsZSxnKTtxLmRldGFjaCh0cnVlKTtpZihnLnN0b3ApcmV0dXJufWVsc2UgZm9yKHE9bC5jcmVhdGVJdGVyYXRvcihxKTtHPXEubmV4dCgpOylpZihlKEcpPT09ZmFsc2Upe2cuc3RvcD10cnVlO3JldHVybn19ZnVuY3Rpb24gbihhKXtmb3IodmFyIGU7YS5uZXh0KCk7KWlmKGEuaXNQYXJ0aWFsbHlTZWxlY3RlZFN1YnRyZWUoKSl7ZT1hLmdldFN1YnRyZWVJdGVyYXRvcigpO24oZSk7ZS5kZXRhY2godHJ1ZSl9ZWxzZSBhLnJlbW92ZSgpfWZ1bmN0aW9uIHMoYSl7Zm9yKHZhciBlLGc9SihhLnJhbmdlKS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCkscTtlPWEubmV4dCgpOyl7aWYoYS5pc1BhcnRpYWxseVNlbGVjdGVkU3VidHJlZSgpKXtlPWUuY2xvbmVOb2RlKGZhbHNlKTtxPWEuZ2V0U3VidHJlZUl0ZXJhdG9yKCk7ZS5hcHBlbmRDaGlsZChzKHEpKTtxLmRldGFjaCh0cnVlKX1lbHNlIGEucmVtb3ZlKCk7aWYoZS5ub2RlVHlwZT09MTApdGhyb3cgbmV3IFEoIkhJRVJBUkNIWV9SRVFVRVNUX0VSUiIpO2cuYXBwZW5kQ2hpbGQoZSl9cmV0dXJuIGd9ZnVuY3Rpb24geShhLGUsZyl7dmFyIHE9ISEoZSYmZS5sZW5ndGgpLEcsVT0hIWc7aWYocSlHPVJlZ0V4cCgiXigiK2Uuam9pbigifCIpKyIpJCIpO3ZhciBiYT1bXTtoKG5ldyBwKGEsZmFsc2UpLGZ1bmN0aW9uKG0pe2lmKCghcXx8Ry50ZXN0KG0ubm9kZVR5cGUpKSYmKCFVfHxnKG0pKSliYS5wdXNoKG0pfSk7cmV0dXJuIGJhfWZ1bmN0aW9uIEEoYSl7cmV0dXJuIlsiKyh0eXBlb2YgYS5nZXROYW1lPT0idW5kZWZpbmVkIj8iUmFuZ2UiOmEuZ2V0TmFtZSgpKSsiKCIrbC5pbnNwZWN0Tm9kZShhLnN0YXJ0Q29udGFpbmVyKSsiOiIrYS5zdGFydE9mZnNldCsiLCAiK2wuaW5zcGVjdE5vZGUoYS5lbmRDb250YWluZXIpKyI6IithLmVuZE9mZnNldCsiKV0ifWZ1bmN0aW9uIHAoYSxlKXt0aGlzLnJhbmdlPWE7dGhpcy5jbG9uZVBhcnRpYWxseVNlbGVjdGVkVGV4dE5vZGVzPWU7aWYoIWEuY29sbGFwc2VkKXt0aGlzLnNjPWEuc3RhcnRDb250YWluZXI7dGhpcy5zbz1hLnN0YXJ0T2Zmc2V0O3RoaXMuZWM9YS5lbmRDb250YWluZXI7dGhpcy5lbz1hLmVuZE9mZnNldDt2YXIgZz1hLmNvbW1vbkFuY2VzdG9yQ29udGFpbmVyO2lmKHRoaXMuc2M9PT10aGlzLmVjJiZsLmlzQ2hhcmFjdGVyRGF0YU5vZGUodGhpcy5zYykpe3RoaXMuaXNTaW5nbGVDaGFyYWN0ZXJEYXRhTm9kZT10cnVlO3RoaXMuX2ZpcnN0PXRoaXMuX2xhc3Q9dGhpcy5fbmV4dD10aGlzLnNjfWVsc2V7dGhpcy5fZmlyc3Q9dGhpcy5fbmV4dD10aGlzLnNjPT09ZyYmIWwuaXNDaGFyYWN0ZXJEYXRhTm9kZSh0aGlzLnNjKT90aGlzLnNjLmNoaWxkTm9kZXNbdGhpcy5zb106bC5nZXRDbG9zZXN0QW5jZXN0b3JJbih0aGlzLnNjLGcsdHJ1ZSk7dGhpcy5fbGFzdD10aGlzLmVjPT09ZyYmIWwuaXNDaGFyYWN0ZXJEYXRhTm9kZSh0aGlzLmVjKT90aGlzLmVjLmNoaWxkTm9kZXNbdGhpcy5lby0xXTpsLmdldENsb3Nlc3RBbmNlc3RvckluKHRoaXMuZWMsZyx0cnVlKX19fWZ1bmN0aW9uIHYoYSl7dGhpcy5jb2RlPXRoaXNbYV07dGhpcy5jb2RlTmFtZT1hO3RoaXMubWVzc2FnZT0iUmFuZ2VFeGNlcHRpb246ICIrdGhpcy5jb2RlTmFtZX1mdW5jdGlvbiBjKGEsZSxnKXt0aGlzLm5vZGVzPXkoYSxlLGcpO3RoaXMuX25leHQ9dGhpcy5ub2Rlc1swXTt0aGlzLl9wb3NpdGlvbj0wfWZ1bmN0aW9uIGYoYSl7cmV0dXJuIGZ1bmN0aW9uKGUsZyl7Zm9yKHZhciBxLEc9Zz9lOmUucGFyZW50Tm9kZTtHOyl7cT1HLm5vZGVUeXBlO2lmKGwuYXJyYXlDb250YWlucyhhLHEpKXJldHVybiBHO0c9Ry5wYXJlbnROb2RlfXJldHVybiBudWxsfX1mdW5jdGlvbiBqKGEsZSl7aWYoRihhLGUpKXRocm93IG5ldyB2KCJJTlZBTElEX05PREVfVFlQRV9FUlIiKTt9ZnVuY3Rpb24gcihhKXtpZighYS5zdGFydENvbnRhaW5lcil0aHJvdyBuZXcgUSgiSU5WQUxJRF9TVEFURV9FUlIiKTt9ZnVuY3Rpb24gTShhLGUpe2lmKCFsLmFycmF5Q29udGFpbnMoZSxhLm5vZGVUeXBlKSl0aHJvdyBuZXcgdigiSU5WQUxJRF9OT0RFX1RZUEVfRVJSIik7fWZ1bmN0aW9uIG8oYSxlKXtpZihlPDB8fGU+KGwuaXNDaGFyYWN0ZXJEYXRhTm9kZShhKT9hLmxlbmd0aDphLmNoaWxkTm9kZXMubGVuZ3RoKSl0aHJvdyBuZXcgUSgiSU5ERVhfU0laRV9FUlIiKTt9ZnVuY3Rpb24gdShhLGUpe2lmKGQoYSx0cnVlKSE9PWQoZSx0cnVlKSl0aHJvdyBuZXcgUSgiV1JPTkdfRE9DVU1FTlRfRVJSIik7fWZ1bmN0aW9uIHgoYSl7aWYoaShhLHRydWUpKXRocm93IG5ldyBRKCJOT19NT0RJRklDQVRJT05fQUxMT1dFRF9FUlIiKTt9ZnVuY3Rpb24gQihhLGUpe2lmKCFhKXRocm93IG5ldyBRKGUpO31mdW5jdGlvbiBEKGEpe3IoYSk7aWYoIWwuYXJyYXlDb250YWlucyhZLGEuc3RhcnRDb250YWluZXIubm9kZVR5cGUpJiYhZChhLnN0YXJ0Q29udGFpbmVyLHRydWUpfHwhbC5hcnJheUNvbnRhaW5zKFksYS5lbmRDb250YWluZXIubm9kZVR5cGUpJiYhZChhLmVuZENvbnRhaW5lcix0cnVlKXx8IShhLnN0YXJ0T2Zmc2V0PD0obC5pc0NoYXJhY3RlckRhdGFOb2RlKGEuc3RhcnRDb250YWluZXIpP2Euc3RhcnRDb250YWluZXIubGVuZ3RoOmEuc3RhcnRDb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGgpKXx8IShhLmVuZE9mZnNldDw9KGwuaXNDaGFyYWN0ZXJEYXRhTm9kZShhLmVuZENvbnRhaW5lcik/YS5lbmRDb250YWluZXIubGVuZ3RoOmEuZW5kQ29udGFpbmVyLmNoaWxkTm9kZXMubGVuZ3RoKSkpdGhyb3cgRXJyb3IoIlJhbmdlIGVycm9yOiBSYW5nZSBpcyBubyBsb25nZXIgdmFsaWQgYWZ0ZXIgRE9NIG11dGF0aW9uICgiK2EuaW5zcGVjdCgpKyIpIik7fWZ1bmN0aW9uIFcoKXt9ZnVuY3Rpb24gZWEoYSl7YS5TVEFSVF9UT19TVEFSVD1PO2EuU1RBUlRfVE9fRU5EPVo7YS5FTkRfVE9fRU5EPWthO2EuRU5EX1RPX1NUQVJUPWxhO2EuTk9ERV9CRUZPUkU9bWE7YS5OT0RFX0FGVEVSPW5hO2EuTk9ERV9CRUZPUkVfQU5EX0FGVEVSPW9hO2EuTk9ERV9JTlNJREU9amF9ZnVuY3Rpb24gJChhKXtlYShhKTtlYShhLnByb3RvdHlwZSl9ZnVuY3Rpb24gWChhLGUpe3JldHVybiBmdW5jdGlvbigpe0QodGhpcyk7dmFyIGc9dGhpcy5zdGFydENvbnRhaW5lcixxPXRoaXMuc3RhcnRPZmZzZXQsRz10aGlzLmNvbW1vbkFuY2VzdG9yQ29udGFpbmVyLFU9bmV3IHAodGhpcyx0cnVlKTtpZihnIT09Ryl7Zz1sLmdldENsb3Nlc3RBbmNlc3RvckluKGcsRyx0cnVlKTtxPUMoZyk7Zz1xLm5vZGU7cT1xLm9mZnNldH1oKFUseCk7VS5yZXNldCgpO0c9YShVKTtVLmRldGFjaCgpO2UodGhpcyxnLHEsZyxxKTtyZXR1cm4gR319ZnVuY3Rpb24gY2EoYSxlLGcpe2Z1bmN0aW9uIHEobSx0KXtyZXR1cm4gZnVuY3Rpb24odyl7cih0aGlzKTtNKHcsZmEpO00oYih3KSxZKTt3PShtP3o6Qykodyk7KHQ/RzpVKSh0aGlzLHcubm9kZSx3Lm9mZnNldCl9fWZ1bmN0aW9uIEcobSx0LHcpe3ZhciBJPW0uZW5kQ29udGFpbmVyLFI9bS5lbmRPZmZzZXQ7aWYodCE9PW0uc3RhcnRDb250YWluZXJ8fHchPT10aGlzLnN0YXJ0T2Zmc2V0KXtpZihiKHQpIT1iKEkpfHxsLmNvbXBhcmVQb2ludHModCx3LEksUik9PTEpe0k9dDtSPXd9ZShtLHQsdyxJLFIpfX1mdW5jdGlvbiBVKG0sdCx3KXt2YXIgST1tLnN0YXJ0Q29udGFpbmVyLFI9bS5zdGFydE9mZnNldDtpZih0IT09bS5lbmRDb250YWluZXJ8fHchPT10aGlzLmVuZE9mZnNldCl7aWYoYih0KSE9YihJKXx8bC5jb21wYXJlUG9pbnRzKHQsdyxJLFIpPT0tMSl7ST10O1I9d31lKG0sSSxSLHQsdyl9fWZ1bmN0aW9uIGJhKG0sdCx3KXtpZih0IT09bS5zdGFydENvbnRhaW5lcnx8dyE9PXRoaXMuc3RhcnRPZmZzZXR8fHQhPT1tLmVuZENvbnRhaW5lcnx8dyE9PXRoaXMuZW5kT2Zmc2V0KWUobSx0LHcsdCx3KX1hLnByb3RvdHlwZT1uZXcgVztrLnV0aWwuZXh0ZW5kKGEucHJvdG90eXBlLHtzZXRTdGFydDpmdW5jdGlvbihtLHQpe3IodGhpcyk7aihtLHRydWUpO28obSx0KTtHKHRoaXMsbSx0KX0sc2V0RW5kOmZ1bmN0aW9uKG0sdCl7cih0aGlzKTtqKG0sdHJ1ZSk7byhtLHQpO1UodGhpcyxtLHQpfSxzZXRTdGFydEJlZm9yZTpxKHRydWUsdHJ1ZSksc2V0U3RhcnRBZnRlcjpxKGZhbHNlLHRydWUpLHNldEVuZEJlZm9yZTpxKHRydWUsZmFsc2UpLHNldEVuZEFmdGVyOnEoZmFsc2UsZmFsc2UpLGNvbGxhcHNlOmZ1bmN0aW9uKG0pe0QodGhpcyk7bT9lKHRoaXMsdGhpcy5zdGFydENvbnRhaW5lcix0aGlzLnN0YXJ0T2Zmc2V0LHRoaXMuc3RhcnRDb250YWluZXIsdGhpcy5zdGFydE9mZnNldCk6ZSh0aGlzLHRoaXMuZW5kQ29udGFpbmVyLHRoaXMuZW5kT2Zmc2V0LHRoaXMuZW5kQ29udGFpbmVyLHRoaXMuZW5kT2Zmc2V0KX0sc2VsZWN0Tm9kZUNvbnRlbnRzOmZ1bmN0aW9uKG0pe3IodGhpcyk7aihtLHRydWUpO2UodGhpcyxtLDAsbSxsLmdldE5vZGVMZW5ndGgobSkpfSxzZWxlY3ROb2RlOmZ1bmN0aW9uKG0pe3IodGhpcyk7aihtLGZhbHNlKTtNKG0sZmEpO3ZhciB0PXoobSk7bT1DKG0pO2UodGhpcyx0Lm5vZGUsdC5vZmZzZXQsbS5ub2RlLG0ub2Zmc2V0KX0sZXh0cmFjdENvbnRlbnRzOlgocyxlKSxkZWxldGVDb250ZW50czpYKG4sZSksY2FuU3Vycm91bmRDb250ZW50czpmdW5jdGlvbigpe0QodGhpcyk7eCh0aGlzLnN0YXJ0Q29udGFpbmVyKTt4KHRoaXMuZW5kQ29udGFpbmVyKTt2YXIgbT1uZXcgcCh0aGlzLHRydWUpLHQ9bS5fZmlyc3QmJkwobS5fZmlyc3QsdGhpcyl8fG0uX2xhc3QmJkwobS5fbGFzdCx0aGlzKTttLmRldGFjaCgpO3JldHVybiF0fSxkZXRhY2g6ZnVuY3Rpb24oKXtnKHRoaXMpfSxzcGxpdEJvdW5kYXJpZXM6ZnVuY3Rpb24oKXtEKHRoaXMpO3ZhciBtPXRoaXMuc3RhcnRDb250YWluZXIsdD10aGlzLnN0YXJ0T2Zmc2V0LHc9dGhpcy5lbmRDb250YWluZXIsST10aGlzLmVuZE9mZnNldCxSPW09PT13O2wuaXNDaGFyYWN0ZXJEYXRhTm9kZSh3KSYmST4wJiZJPHcubGVuZ3RoJiZsLnNwbGl0RGF0YU5vZGUodyxJKTtpZihsLmlzQ2hhcmFjdGVyRGF0YU5vZGUobSkmJnQ+MCYmdDxtLmxlbmd0aCl7bT1sLnNwbGl0RGF0YU5vZGUobSx0KTtpZihSKXtJLT10O3c9bX1lbHNlIHc9PW0ucGFyZW50Tm9kZSYmST49bC5nZXROb2RlSW5kZXgobSkmJkkrKzt0PTB9ZSh0aGlzLG0sdCx3LEkpfSxub3JtYWxpemVCb3VuZGFyaWVzOmZ1bmN0aW9uKCl7RCh0aGlzKTt2YXIgbT10aGlzLnN0YXJ0Q29udGFpbmVyLHQ9dGhpcy5zdGFydE9mZnNldCx3PXRoaXMuZW5kQ29udGFpbmVyLEk9dGhpcy5lbmRPZmZzZXQsUj1mdW5jdGlvbihWKXt2YXIgUz1WLm5leHRTaWJsaW5nO2lmKFMmJlMubm9kZVR5cGU9PVYubm9kZVR5cGUpe3c9VjtJPVYubGVuZ3RoO1YuYXBwZW5kRGF0YShTLmRhdGEpO1MucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChTKX19LHBhPWZ1bmN0aW9uKFYpe3ZhciBTPVYucHJldmlvdXNTaWJsaW5nO2lmKFMmJlMubm9kZVR5cGU9PVYubm9kZVR5cGUpe209Vjt2YXIgcWE9Vi5sZW5ndGg7dD1TLmxlbmd0aDtWLmluc2VydERhdGEoMCxTLmRhdGEpO1MucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChTKTtpZihtPT13KXtJKz10O3c9bX1lbHNlIGlmKHc9PVYucGFyZW50Tm9kZSl7Uz1sLmdldE5vZGVJbmRleChWKTtpZihJPT1TKXt3PVY7ST1xYX1lbHNlIEk+UyYmSS0tfX19LGdhPXRydWU7aWYobC5pc0NoYXJhY3RlckRhdGFOb2RlKHcpKXcubGVuZ3RoPT1JJiZSKHcpO2Vsc2V7aWYoST4wKShnYT13LmNoaWxkTm9kZXNbSS0xXSkmJmwuaXNDaGFyYWN0ZXJEYXRhTm9kZShnYSkmJlIoZ2EpO2dhPSF0aGlzLmNvbGxhcHNlZH1pZihnYSlpZihsLmlzQ2hhcmFjdGVyRGF0YU5vZGUobSkpdD09MCYmcGEobSk7ZWxzZXtpZih0PG0uY2hpbGROb2Rlcy5sZW5ndGgpKFI9bS5jaGlsZE5vZGVzW3RdKSYmbC5pc0NoYXJhY3RlckRhdGFOb2RlKFIpJiZwYShSKX1lbHNle209dzt0PUl9ZSh0aGlzLG0sdCx3LEkpfSxjb2xsYXBzZVRvUG9pbnQ6ZnVuY3Rpb24obSx0KXtEKHRoaXMpO2oobSx0cnVlKTtvKG0sdCk7YmEodGhpcyxtLHQpfX0pOyQoYSl9ZnVuY3Rpb24gaGEoYSl7YS5jb2xsYXBzZWQ9YS5zdGFydENvbnRhaW5lcj09PWEuZW5kQ29udGFpbmVyJiZhLnN0YXJ0T2Zmc2V0PT09YS5lbmRPZmZzZXQ7YS5jb21tb25BbmNlc3RvckNvbnRhaW5lcj1hLmNvbGxhcHNlZD9hLnN0YXJ0Q29udGFpbmVyOmwuZ2V0Q29tbW9uQW5jZXN0b3IoYS5zdGFydENvbnRhaW5lcixhLmVuZENvbnRhaW5lcil9ZnVuY3Rpb24gZGEoYSxlLGcscSxHKXt2YXIgVT1hLnN0YXJ0Q29udGFpbmVyIT09ZXx8YS5zdGFydE9mZnNldCE9PWcsYmE9YS5lbmRDb250YWluZXIhPT1xfHxhLmVuZE9mZnNldCE9PUc7YS5zdGFydENvbnRhaW5lcj1lO2Euc3RhcnRPZmZzZXQ9ZzthLmVuZENvbnRhaW5lcj1xO2EuZW5kT2Zmc2V0PUc7aGEoYSk7SyhhLCJib3VuZGFyeWNoYW5nZSIse3N0YXJ0TW92ZWQ6VSxlbmRNb3ZlZDpiYX0pfWZ1bmN0aW9uIFQoYSl7dGhpcy5zdGFydENvbnRhaW5lcj1hO3RoaXMuc3RhcnRPZmZzZXQ9MDt0aGlzLmVuZENvbnRhaW5lcj1hO3RoaXMuZW5kT2Zmc2V0PTA7dGhpcy5fbGlzdGVuZXJzPXtib3VuZGFyeWNoYW5nZTpbXSxkZXRhY2g6W119O2hhKHRoaXMpfWsucmVxdWlyZU1vZHVsZXMoWyJEb21VdGlsIl0pO3ZhciBsPWsuZG9tLEU9bC5Eb21Qb3NpdGlvbixRPWsuRE9NRXhjZXB0aW9uO3AucHJvdG90eXBlPXtfY3VycmVudDpudWxsLF9uZXh0Om51bGwsX2ZpcnN0Om51bGwsX2xhc3Q6bnVsbCxpc1NpbmdsZUNoYXJhY3RlckRhdGFOb2RlOmZhbHNlLHJlc2V0OmZ1bmN0aW9uKCl7dGhpcy5fY3VycmVudD1udWxsO3RoaXMuX25leHQ9dGhpcy5fZmlyc3R9LGhhc05leHQ6ZnVuY3Rpb24oKXtyZXR1cm4hIXRoaXMuX25leHR9LG5leHQ6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLl9jdXJyZW50PXRoaXMuX25leHQ7aWYoYSl7dGhpcy5fbmV4dD1hIT09dGhpcy5fbGFzdD9hLm5leHRTaWJsaW5nOm51bGw7aWYobC5pc0NoYXJhY3RlckRhdGFOb2RlKGEpJiZ0aGlzLmNsb25lUGFydGlhbGx5U2VsZWN0ZWRUZXh0Tm9kZXMpe2lmKGE9PT10aGlzLmVjKShhPWEuY2xvbmVOb2RlKHRydWUpKS5kZWxldGVEYXRhKHRoaXMuZW8sYS5sZW5ndGgtdGhpcy5lbyk7aWYodGhpcy5fY3VycmVudD09PXRoaXMuc2MpKGE9YS5jbG9uZU5vZGUodHJ1ZSkpLmRlbGV0ZURhdGEoMCx0aGlzLnNvKX19cmV0dXJuIGF9LHJlbW92ZTpmdW5jdGlvbigpe3ZhciBhPXRoaXMuX2N1cnJlbnQsZSxnO2lmKGwuaXNDaGFyYWN0ZXJEYXRhTm9kZShhKSYmKGE9PT10aGlzLnNjfHxhPT09dGhpcy5lYykpe2U9YT09PXRoaXMuc2M/dGhpcy5zbzowO2c9YT09PXRoaXMuZWM/dGhpcy5lbzphLmxlbmd0aDtlIT1nJiZhLmRlbGV0ZURhdGEoZSxnLWUpfWVsc2UgYS5wYXJlbnROb2RlJiZhLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYSl9LGlzUGFydGlhbGx5U2VsZWN0ZWRTdWJ0cmVlOmZ1bmN0aW9uKCl7cmV0dXJuIEwodGhpcy5fY3VycmVudCx0aGlzLnJhbmdlKX0sZ2V0U3VidHJlZUl0ZXJhdG9yOmZ1bmN0aW9uKCl7dmFyIGE7aWYodGhpcy5pc1NpbmdsZUNoYXJhY3RlckRhdGFOb2RlKXthPXRoaXMucmFuZ2UuY2xvbmVSYW5nZSgpO2EuY29sbGFwc2UoKX1lbHNle2E9bmV3IFQoSih0aGlzLnJhbmdlKSk7dmFyIGU9dGhpcy5fY3VycmVudCxnPWUscT0wLEc9ZSxVPWwuZ2V0Tm9kZUxlbmd0aChlKTtpZihsLmlzQW5jZXN0b3JPZihlLHRoaXMuc2MsdHJ1ZSkpe2c9dGhpcy5zYztxPXRoaXMuc299aWYobC5pc0FuY2VzdG9yT2YoZSx0aGlzLmVjLHRydWUpKXtHPXRoaXMuZWM7VT10aGlzLmVvfWRhKGEsZyxxLEcsVSl9cmV0dXJuIG5ldyBwKGEsdGhpcy5jbG9uZVBhcnRpYWxseVNlbGVjdGVkVGV4dE5vZGVzKX0sZGV0YWNoOmZ1bmN0aW9uKGEpe2EmJnRoaXMucmFuZ2UuZGV0YWNoKCk7dGhpcy5yYW5nZT10aGlzLl9jdXJyZW50PXRoaXMuX25leHQ9dGhpcy5fZmlyc3Q9dGhpcy5fbGFzdD10aGlzLnNjPXRoaXMuc289dGhpcy5lYz10aGlzLmVvPW51bGx9fTt2LnByb3RvdHlwZT17QkFEX0JPVU5EQVJZUE9JTlRTX0VSUjoxLElOVkFMSURfTk9ERV9UWVBFX0VSUjoyfTt2LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiB0aGlzLm1lc3NhZ2V9O2MucHJvdG90eXBlPXtfY3VycmVudDpudWxsLGhhc05leHQ6ZnVuY3Rpb24oKXtyZXR1cm4hIXRoaXMuX25leHR9LG5leHQ6ZnVuY3Rpb24oKXt0aGlzLl9jdXJyZW50PXRoaXMuX25leHQ7dGhpcy5fbmV4dD10aGlzLm5vZGVzWysrdGhpcy5fcG9zaXRpb25dO3JldHVybiB0aGlzLl9jdXJyZW50fSxkZXRhY2g6ZnVuY3Rpb24oKXt0aGlzLl9jdXJyZW50PXRoaXMuX25leHQ9dGhpcy5ub2Rlcz1udWxsfX07dmFyIGZhPVsxLDMsNCw1LDcsOCwxMF0sWT1bMiw5LDExXSxpYT1bMSwzLDQsNSw3LDgsMTAsMTFdLGFhPVsxLDMsNCw1LDcsOF0sYj1sLmdldFJvb3RDb250YWluZXIsZD1mKFs5LDExXSksaT1mKFs1LDYsMTAsMTJdKSxGPWYoWzYsMTAsMTJdKSxIPVsic3RhcnRDb250YWluZXIiLCJzdGFydE9mZnNldCIsImVuZENvbnRhaW5lciIsImVuZE9mZnNldCIsImNvbGxhcHNlZCIsImNvbW1vbkFuY2VzdG9yQ29udGFpbmVyIl0sTz0wLFo9MSxrYT0yLGxhPTMsbWE9MCxuYT0xLG9hPTIsamE9MztXLnByb3RvdHlwZT17YXR0YWNoTGlzdGVuZXI6ZnVuY3Rpb24oYSxlKXt0aGlzLl9saXN0ZW5lcnNbYV0ucHVzaChlKX0sY29tcGFyZUJvdW5kYXJ5UG9pbnRzOmZ1bmN0aW9uKGEsZSl7RCh0aGlzKTt1KHRoaXMuc3RhcnRDb250YWluZXIsZS5zdGFydENvbnRhaW5lcik7dmFyIGc9YT09bGF8fGE9PU8/InN0YXJ0IjoiZW5kIixxPWE9PVp8fGE9PU8/InN0YXJ0IjoiZW5kIjtyZXR1cm4gbC5jb21wYXJlUG9pbnRzKHRoaXNbZysiQ29udGFpbmVyIl0sdGhpc1tnKyJPZmZzZXQiXSxlW3ErIkNvbnRhaW5lciJdLGVbcSsiT2Zmc2V0Il0pfSxpbnNlcnROb2RlOmZ1bmN0aW9uKGEpe0QodGhpcyk7TShhLGlhKTt4KHRoaXMuc3RhcnRDb250YWluZXIpO2lmKGwuaXNBbmNlc3Rvck9mKGEsdGhpcy5zdGFydENvbnRhaW5lcix0cnVlKSl0aHJvdyBuZXcgUSgiSElFUkFSQ0hZX1JFUVVFU1RfRVJSIik7dGhpcy5zZXRTdGFydEJlZm9yZShOKGEsdGhpcy5zdGFydENvbnRhaW5lcix0aGlzLnN0YXJ0T2Zmc2V0KSl9LGNsb25lQ29udGVudHM6ZnVuY3Rpb24oKXtEKHRoaXMpO3ZhciBhLGU7aWYodGhpcy5jb2xsYXBzZWQpcmV0dXJuIEoodGhpcykuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO2Vsc2V7aWYodGhpcy5zdGFydENvbnRhaW5lcj09PXRoaXMuZW5kQ29udGFpbmVyJiZsLmlzQ2hhcmFjdGVyRGF0YU5vZGUodGhpcy5zdGFydENvbnRhaW5lcikpe2E9dGhpcy5zdGFydENvbnRhaW5lci5jbG9uZU5vZGUodHJ1ZSk7YS5kYXRhPWEuZGF0YS5zbGljZSh0aGlzLnN0YXJ0T2Zmc2V0LHRoaXMuZW5kT2Zmc2V0KTtlPUoodGhpcykuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO2UuYXBwZW5kQ2hpbGQoYSk7cmV0dXJuIGV9ZWxzZXtlPW5ldyBwKHRoaXMsdHJ1ZSk7YT1QKGUpO2UuZGV0YWNoKCl9cmV0dXJuIGF9fSxjYW5TdXJyb3VuZENvbnRlbnRzOmZ1bmN0aW9uKCl7RCh0aGlzKTt4KHRoaXMuc3RhcnRDb250YWluZXIpO3godGhpcy5lbmRDb250YWluZXIpO3ZhciBhPW5ldyBwKHRoaXMsdHJ1ZSksZT1hLl9maXJzdCYmTChhLl9maXJzdCx0aGlzKXx8YS5fbGFzdCYmTChhLl9sYXN0LHRoaXMpO2EuZGV0YWNoKCk7cmV0dXJuIWV9LHN1cnJvdW5kQ29udGVudHM6ZnVuY3Rpb24oYSl7TShhLGFhKTtpZighdGhpcy5jYW5TdXJyb3VuZENvbnRlbnRzKCkpdGhyb3cgbmV3IHYoIkJBRF9CT1VOREFSWVBPSU5UU19FUlIiKTt2YXIgZT10aGlzLmV4dHJhY3RDb250ZW50cygpO2lmKGEuaGFzQ2hpbGROb2RlcygpKWZvcig7YS5sYXN0Q2hpbGQ7KWEucmVtb3ZlQ2hpbGQoYS5sYXN0Q2hpbGQpO04oYSx0aGlzLnN0YXJ0Q29udGFpbmVyLHRoaXMuc3RhcnRPZmZzZXQpO2EuYXBwZW5kQ2hpbGQoZSk7dGhpcy5zZWxlY3ROb2RlKGEpfSxjbG9uZVJhbmdlOmZ1bmN0aW9uKCl7RCh0aGlzKTtmb3IodmFyIGE9bmV3IFQoSih0aGlzKSksZT1ILmxlbmd0aCxnO2UtLTspe2c9SFtlXTthW2ddPXRoaXNbZ119cmV0dXJuIGF9LHRvU3RyaW5nOmZ1bmN0aW9uKCl7RCh0aGlzKTt2YXIgYT10aGlzLnN0YXJ0Q29udGFpbmVyO2lmKGE9PT10aGlzLmVuZENvbnRhaW5lciYmbC5pc0NoYXJhY3RlckRhdGFOb2RlKGEpKXJldHVybiBhLm5vZGVUeXBlPT0zfHxhLm5vZGVUeXBlPT00P2EuZGF0YS5zbGljZSh0aGlzLnN0YXJ0T2Zmc2V0LHRoaXMuZW5kT2Zmc2V0KToiIjtlbHNle3ZhciBlPVtdO2E9bmV3IHAodGhpcyx0cnVlKTtoKGEsZnVuY3Rpb24oZyl7aWYoZy5ub2RlVHlwZT09M3x8Zy5ub2RlVHlwZT09NCllLnB1c2goZy5kYXRhKX0pO2EuZGV0YWNoKCk7cmV0dXJuIGUuam9pbigiIil9fSxjb21wYXJlTm9kZTpmdW5jdGlvbihhKXtEKHRoaXMpO3ZhciBlPWEucGFyZW50Tm9kZSxnPWwuZ2V0Tm9kZUluZGV4KGEpO2lmKCFlKXRocm93IG5ldyBRKCJOT1RfRk9VTkRfRVJSIik7YT10aGlzLmNvbXBhcmVQb2ludChlLGcpO2U9dGhpcy5jb21wYXJlUG9pbnQoZSxnKzEpO3JldHVybiBhPDA/ZT4wP29hOm1hOmU+MD9uYTpqYX0sY29tcGFyZVBvaW50OmZ1bmN0aW9uKGEsZSl7RCh0aGlzKTtCKGEsIkhJRVJBUkNIWV9SRVFVRVNUX0VSUiIpO3UoYSx0aGlzLnN0YXJ0Q29udGFpbmVyKTtpZihsLmNvbXBhcmVQb2ludHMoYSxlLHRoaXMuc3RhcnRDb250YWluZXIsdGhpcy5zdGFydE9mZnNldCk8MClyZXR1cm4tMTtlbHNlIGlmKGwuY29tcGFyZVBvaW50cyhhLGUsdGhpcy5lbmRDb250YWluZXIsdGhpcy5lbmRPZmZzZXQpPjApcmV0dXJuIDE7cmV0dXJuIDB9LGNyZWF0ZUNvbnRleHR1YWxGcmFnbWVudDpmdW5jdGlvbihhKXtyKHRoaXMpO3ZhciBlPUoodGhpcyksZz1lLmNyZWF0ZUVsZW1lbnQoImRpdiIpO2cuaW5uZXJIVE1MPWE7Zm9yKGE9ZS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7ZT1nLmZpcnN0Q2hpbGQ7KWEuYXBwZW5kQ2hpbGQoZSk7cmV0dXJuIGF9LHRvSHRtbDpmdW5jdGlvbigpe0QodGhpcyk7dmFyIGE9Sih0aGlzKS5jcmVhdGVFbGVtZW50KCJkaXYiKTthLmFwcGVuZENoaWxkKHRoaXMuY2xvbmVDb250ZW50cygpKTtyZXR1cm4gYS5pbm5lckhUTUx9LGludGVyc2VjdHNOb2RlOmZ1bmN0aW9uKGEsZSl7RCh0aGlzKTtCKGEsIk5PVF9GT1VORF9FUlIiKTtpZihsLmdldERvY3VtZW50KGEpIT09Sih0aGlzKSlyZXR1cm4gZmFsc2U7dmFyIGc9YS5wYXJlbnROb2RlLHE9bC5nZXROb2RlSW5kZXgoYSk7QihnLCJOT1RfRk9VTkRfRVJSIik7dmFyIEc9bC5jb21wYXJlUG9pbnRzKGcscSx0aGlzLmVuZENvbnRhaW5lcix0aGlzLmVuZE9mZnNldCk7Zz1sLmNvbXBhcmVQb2ludHMoZyxxKzEsdGhpcy5zdGFydENvbnRhaW5lcix0aGlzLnN0YXJ0T2Zmc2V0KTtyZXR1cm4gZT9HPD0wJiZnPj0wOkc8MCYmZz4wfSxpc1BvaW50SW5SYW5nZTpmdW5jdGlvbihhLGUpe0QodGhpcyk7QihhLCJISUVSQVJDSFlfUkVRVUVTVF9FUlIiKTt1KGEsdGhpcy5zdGFydENvbnRhaW5lcik7cmV0dXJuIGwuY29tcGFyZVBvaW50cyhhLGUsdGhpcy5zdGFydENvbnRhaW5lcix0aGlzLnN0YXJ0T2Zmc2V0KT49MCYmbC5jb21wYXJlUG9pbnRzKGEsZSx0aGlzLmVuZENvbnRhaW5lcix0aGlzLmVuZE9mZnNldCk8PTB9LGludGVyc2VjdHNSYW5nZTpmdW5jdGlvbihhLGUpe0QodGhpcyk7aWYoSihhKSE9Sih0aGlzKSl0aHJvdyBuZXcgUSgiV1JPTkdfRE9DVU1FTlRfRVJSIik7dmFyIGc9bC5jb21wYXJlUG9pbnRzKHRoaXMuc3RhcnRDb250YWluZXIsdGhpcy5zdGFydE9mZnNldCxhLmVuZENvbnRhaW5lcixhLmVuZE9mZnNldCkscT1sLmNvbXBhcmVQb2ludHModGhpcy5lbmRDb250YWluZXIsdGhpcy5lbmRPZmZzZXQsYS5zdGFydENvbnRhaW5lcixhLnN0YXJ0T2Zmc2V0KTtyZXR1cm4gZT9nPD0wJiZxPj0wOmc8MCYmcT4wfSxpbnRlcnNlY3Rpb246ZnVuY3Rpb24oYSl7aWYodGhpcy5pbnRlcnNlY3RzUmFuZ2UoYSkpe3ZhciBlPWwuY29tcGFyZVBvaW50cyh0aGlzLnN0YXJ0Q29udGFpbmVyLHRoaXMuc3RhcnRPZmZzZXQsYS5zdGFydENvbnRhaW5lcixhLnN0YXJ0T2Zmc2V0KSxnPWwuY29tcGFyZVBvaW50cyh0aGlzLmVuZENvbnRhaW5lcix0aGlzLmVuZE9mZnNldCxhLmVuZENvbnRhaW5lcixhLmVuZE9mZnNldCkscT10aGlzLmNsb25lUmFuZ2UoKTtlPT0tMSYmcS5zZXRTdGFydChhLnN0YXJ0Q29udGFpbmVyLGEuc3RhcnRPZmZzZXQpO2c9PTEmJnEuc2V0RW5kKGEuZW5kQ29udGFpbmVyLGEuZW5kT2Zmc2V0KTtyZXR1cm4gcX1yZXR1cm4gbnVsbH0sdW5pb246ZnVuY3Rpb24oYSl7aWYodGhpcy5pbnRlcnNlY3RzUmFuZ2UoYSx0cnVlKSl7dmFyIGU9dGhpcy5jbG9uZVJhbmdlKCk7bC5jb21wYXJlUG9pbnRzKGEuc3RhcnRDb250YWluZXIsYS5zdGFydE9mZnNldCx0aGlzLnN0YXJ0Q29udGFpbmVyLHRoaXMuc3RhcnRPZmZzZXQpPT0tMSYmZS5zZXRTdGFydChhLnN0YXJ0Q29udGFpbmVyLGEuc3RhcnRPZmZzZXQpO2wuY29tcGFyZVBvaW50cyhhLmVuZENvbnRhaW5lcixhLmVuZE9mZnNldCx0aGlzLmVuZENvbnRhaW5lcix0aGlzLmVuZE9mZnNldCk9PTEmJmUuc2V0RW5kKGEuZW5kQ29udGFpbmVyLGEuZW5kT2Zmc2V0KTtyZXR1cm4gZX1lbHNlIHRocm93IG5ldyB2KCJSYW5nZXMgZG8gbm90IGludGVyc2VjdCIpO30sY29udGFpbnNOb2RlOmZ1bmN0aW9uKGEsZSl7cmV0dXJuIGU/dGhpcy5pbnRlcnNlY3RzTm9kZShhLGZhbHNlKTp0aGlzLmNvbXBhcmVOb2RlKGEpPT1qYX0sY29udGFpbnNOb2RlQ29udGVudHM6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuY29tcGFyZVBvaW50KGEsMCk+PTAmJnRoaXMuY29tcGFyZVBvaW50KGEsbC5nZXROb2RlTGVuZ3RoKGEpKTw9MH0sY29udGFpbnNSYW5nZTpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5pbnRlcnNlY3Rpb24oYSkuZXF1YWxzKGEpfSxjb250YWluc05vZGVUZXh0OmZ1bmN0aW9uKGEpe3ZhciBlPXRoaXMuY2xvbmVSYW5nZSgpO2Uuc2VsZWN0Tm9kZShhKTt2YXIgZz1lLmdldE5vZGVzKFszXSk7aWYoZy5sZW5ndGg+MCl7ZS5zZXRTdGFydChnWzBdLDApO2E9Zy5wb3AoKTtlLnNldEVuZChhLGEubGVuZ3RoKTthPXRoaXMuY29udGFpbnNSYW5nZShlKTtlLmRldGFjaCgpO3JldHVybiBhfWVsc2UgcmV0dXJuIHRoaXMuY29udGFpbnNOb2RlQ29udGVudHMoYSl9LGNyZWF0ZU5vZGVJdGVyYXRvcjpmdW5jdGlvbihhLGUpe0QodGhpcyk7cmV0dXJuIG5ldyBjKHRoaXMsYSxlKX0sZ2V0Tm9kZXM6ZnVuY3Rpb24oYSxlKXtEKHRoaXMpO3JldHVybiB5KHRoaXMsYSxlKX0sZ2V0RG9jdW1lbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gSih0aGlzKX0sY29sbGFwc2VCZWZvcmU6ZnVuY3Rpb24oYSl7cih0aGlzKTt0aGlzLnNldEVuZEJlZm9yZShhKTt0aGlzLmNvbGxhcHNlKGZhbHNlKX0sY29sbGFwc2VBZnRlcjpmdW5jdGlvbihhKXtyKHRoaXMpO3RoaXMuc2V0U3RhcnRBZnRlcihhKTt0aGlzLmNvbGxhcHNlKHRydWUpfSxnZXROYW1lOmZ1bmN0aW9uKCl7cmV0dXJuIkRvbVJhbmdlIn0sZXF1YWxzOmZ1bmN0aW9uKGEpe3JldHVybiBULnJhbmdlc0VxdWFsKHRoaXMsYSl9LGluc3BlY3Q6ZnVuY3Rpb24oKXtyZXR1cm4gQSh0aGlzKX19O2NhKFQsZGEsZnVuY3Rpb24oYSl7cihhKTthLnN0YXJ0Q29udGFpbmVyPWEuc3RhcnRPZmZzZXQ9YS5lbmRDb250YWluZXI9YS5lbmRPZmZzZXQ9bnVsbDthLmNvbGxhcHNlZD1hLmNvbW1vbkFuY2VzdG9yQ29udGFpbmVyPW51bGw7SyhhLCJkZXRhY2giLG51bGwpO2EuX2xpc3RlbmVycz1udWxsfSk7ay5yYW5nZVByb3RvdHlwZT1XLnByb3RvdHlwZTtULnJhbmdlUHJvcGVydGllcz1IO1QuUmFuZ2VJdGVyYXRvcj1wO1QuY29weUNvbXBhcmlzb25Db25zdGFudHM9JDtULmNyZWF0ZVByb3RvdHlwZVJhbmdlPWNhO1QuaW5zcGVjdD1BO1QuZ2V0UmFuZ2VEb2N1bWVudD1KO1QucmFuZ2VzRXF1YWw9ZnVuY3Rpb24oYSxlKXtyZXR1cm4gYS5zdGFydENvbnRhaW5lcj09PWUuc3RhcnRDb250YWluZXImJmEuc3RhcnRPZmZzZXQ9PT1lLnN0YXJ0T2Zmc2V0JiZhLmVuZENvbnRhaW5lcj09PWUuZW5kQ29udGFpbmVyJiZhLmVuZE9mZnNldD09PWUuZW5kT2Zmc2V0fTtrLkRvbVJhbmdlPVQ7ay5SYW5nZUV4Y2VwdGlvbj12fSk7cmFuZ3kuY3JlYXRlTW9kdWxlKCJXcmFwcGVkUmFuZ2UiLGZ1bmN0aW9uKGspe2Z1bmN0aW9uIEwoaCxuLHMseSl7dmFyIEE9aC5kdXBsaWNhdGUoKTtBLmNvbGxhcHNlKHMpO3ZhciBwPUEucGFyZW50RWxlbWVudCgpO3ouaXNBbmNlc3Rvck9mKG4scCx0cnVlKXx8KHA9bik7aWYoIXAuY2FuSGF2ZUhUTUwpcmV0dXJuIG5ldyBDKHAucGFyZW50Tm9kZSx6LmdldE5vZGVJbmRleChwKSk7bj16LmdldERvY3VtZW50KHApLmNyZWF0ZUVsZW1lbnQoInNwYW4iKTt2YXIgdixjPXM/IlN0YXJ0VG9TdGFydCI6IlN0YXJ0VG9FbmQiO2Rve3AuaW5zZXJ0QmVmb3JlKG4sbi5wcmV2aW91c1NpYmxpbmcpO0EubW92ZVRvRWxlbWVudFRleHQobil9d2hpbGUoKHY9QS5jb21wYXJlRW5kUG9pbnRzKGMsaCkpPjAmJm4ucHJldmlvdXNTaWJsaW5nKTtjPW4ubmV4dFNpYmxpbmc7aWYodj09LTEmJmMmJnouaXNDaGFyYWN0ZXJEYXRhTm9kZShjKSl7QS5zZXRFbmRQb2ludChzPyJFbmRUb1N0YXJ0IjoiRW5kVG9FbmQiLGgpO2lmKC9bXHJcbl0vLnRlc3QoYy5kYXRhKSl7cD1BLmR1cGxpY2F0ZSgpO3M9cC50ZXh0LnJlcGxhY2UoL1xyXG4vZywiXHIiKS5sZW5ndGg7Zm9yKHM9cC5tb3ZlU3RhcnQoImNoYXJhY3RlciIscyk7cC5jb21wYXJlRW5kUG9pbnRzKCJTdGFydFRvRW5kIixwKT09LTE7KXtzKys7cC5tb3ZlU3RhcnQoImNoYXJhY3RlciIsMSl9fWVsc2Ugcz1BLnRleHQubGVuZ3RoO3A9bmV3IEMoYyxzKX1lbHNle2M9KHl8fCFzKSYmbi5wcmV2aW91c1NpYmxpbmc7cD0ocz0oeXx8cykmJm4ubmV4dFNpYmxpbmcpJiZ6LmlzQ2hhcmFjdGVyRGF0YU5vZGUocyk/bmV3IEMocywwKTpjJiZ6LmlzQ2hhcmFjdGVyRGF0YU5vZGUoYyk/bmV3IEMoYyxjLmxlbmd0aCk6bmV3IEMocCx6LmdldE5vZGVJbmRleChuKSl9bi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG4pO3JldHVybiBwfWZ1bmN0aW9uIEooaCxuKXt2YXIgcyx5LEE9aC5vZmZzZXQscD16LmdldERvY3VtZW50KGgubm9kZSksdj1wLmJvZHkuY3JlYXRlVGV4dFJhbmdlKCksYz16LmlzQ2hhcmFjdGVyRGF0YU5vZGUoaC5ub2RlKTtpZihjKXtzPWgubm9kZTt5PXMucGFyZW50Tm9kZX1lbHNle3M9aC5ub2RlLmNoaWxkTm9kZXM7cz1BPHMubGVuZ3RoP3NbQV06bnVsbDt5PWgubm9kZX1wPXAuY3JlYXRlRWxlbWVudCgic3BhbiIpO3AuaW5uZXJIVE1MPSImI2ZlZmY7IjtzP3kuaW5zZXJ0QmVmb3JlKHAscyk6eS5hcHBlbmRDaGlsZChwKTt2Lm1vdmVUb0VsZW1lbnRUZXh0KHApO3YuY29sbGFwc2UoIW4pO3kucmVtb3ZlQ2hpbGQocCk7aWYoYyl2W24/Im1vdmVTdGFydCI6Im1vdmVFbmQiXSgiY2hhcmFjdGVyIixBKTtyZXR1cm4gdn1rLnJlcXVpcmVNb2R1bGVzKFsiRG9tVXRpbCIsIkRvbVJhbmdlIl0pO3ZhciBLLHo9ay5kb20sQz16LkRvbVBvc2l0aW9uLE49ay5Eb21SYW5nZTtpZihrLmZlYXR1cmVzLmltcGxlbWVudHNEb21SYW5nZSYmKCFrLmZlYXR1cmVzLmltcGxlbWVudHNUZXh0UmFuZ2V8fCFrLmNvbmZpZy5wcmVmZXJUZXh0UmFuZ2UpKXsoZnVuY3Rpb24oKXtmdW5jdGlvbiBoKGYpe2Zvcih2YXIgaj1zLmxlbmd0aCxyO2otLTspe3I9c1tqXTtmW3JdPWYubmF0aXZlUmFuZ2Vbcl19fXZhciBuLHM9Ti5yYW5nZVByb3BlcnRpZXMseSxBO0s9ZnVuY3Rpb24oZil7aWYoIWYpdGhyb3cgRXJyb3IoIlJhbmdlIG11c3QgYmUgc3BlY2lmaWVkIik7dGhpcy5uYXRpdmVSYW5nZT1mO2godGhpcyl9O04uY3JlYXRlUHJvdG90eXBlUmFuZ2UoSyxmdW5jdGlvbihmLGoscixNLG8pe3ZhciB1PWYuZW5kQ29udGFpbmVyIT09TXx8Zi5lbmRPZmZzZXQhPW87aWYoZi5zdGFydENvbnRhaW5lciE9PWp8fGYuc3RhcnRPZmZzZXQhPXJ8fHUpe2Yuc2V0RW5kKE0sbyk7Zi5zZXRTdGFydChqLHIpfX0sZnVuY3Rpb24oZil7Zi5uYXRpdmVSYW5nZS5kZXRhY2goKTtmLmRldGFjaGVkPXRydWU7Zm9yKHZhciBqPXMubGVuZ3RoLHI7ai0tOyl7cj1zW2pdO2Zbcl09bnVsbH19KTtuPUsucHJvdG90eXBlO24uc2VsZWN0Tm9kZT1mdW5jdGlvbihmKXt0aGlzLm5hdGl2ZVJhbmdlLnNlbGVjdE5vZGUoZik7aCh0aGlzKX07bi5kZWxldGVDb250ZW50cz1mdW5jdGlvbigpe3RoaXMubmF0aXZlUmFuZ2UuZGVsZXRlQ29udGVudHMoKTtoKHRoaXMpfTtuLmV4dHJhY3RDb250ZW50cz1mdW5jdGlvbigpe3ZhciBmPXRoaXMubmF0aXZlUmFuZ2UuZXh0cmFjdENvbnRlbnRzKCk7aCh0aGlzKTtyZXR1cm4gZn07bi5jbG9uZUNvbnRlbnRzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubmF0aXZlUmFuZ2UuY2xvbmVDb250ZW50cygpfTtuLnN1cnJvdW5kQ29udGVudHM9ZnVuY3Rpb24oZil7dGhpcy5uYXRpdmVSYW5nZS5zdXJyb3VuZENvbnRlbnRzKGYpO2godGhpcyl9O24uY29sbGFwc2U9ZnVuY3Rpb24oZil7dGhpcy5uYXRpdmVSYW5nZS5jb2xsYXBzZShmKTtoKHRoaXMpfTtuLmNsb25lUmFuZ2U9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IEsodGhpcy5uYXRpdmVSYW5nZS5jbG9uZVJhbmdlKCkpfTtuLnJlZnJlc2g9ZnVuY3Rpb24oKXtoKHRoaXMpfTtuLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubmF0aXZlUmFuZ2UudG9TdHJpbmcoKX07dmFyIHA9ZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoInRlc3QiKTt6LmdldEJvZHkoZG9jdW1lbnQpLmFwcGVuZENoaWxkKHApO3ZhciB2PWRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7di5zZXRTdGFydChwLDApO3Yuc2V0RW5kKHAsMCk7dHJ5e3Yuc2V0U3RhcnQocCwxKTt5PXRydWU7bi5zZXRTdGFydD1mdW5jdGlvbihmLGope3RoaXMubmF0aXZlUmFuZ2Uuc2V0U3RhcnQoZixqKTtoKHRoaXMpfTtuLnNldEVuZD1mdW5jdGlvbihmLGope3RoaXMubmF0aXZlUmFuZ2Uuc2V0RW5kKGYsaik7aCh0aGlzKX07QT1mdW5jdGlvbihmKXtyZXR1cm4gZnVuY3Rpb24oail7dGhpcy5uYXRpdmVSYW5nZVtmXShqKTtoKHRoaXMpfX19Y2F0Y2goYyl7eT1mYWxzZTtuLnNldFN0YXJ0PWZ1bmN0aW9uKGYsail7dHJ5e3RoaXMubmF0aXZlUmFuZ2Uuc2V0U3RhcnQoZixqKX1jYXRjaChyKXt0aGlzLm5hdGl2ZVJhbmdlLnNldEVuZChmLGopO3RoaXMubmF0aXZlUmFuZ2Uuc2V0U3RhcnQoZixqKX1oKHRoaXMpfTtuLnNldEVuZD1mdW5jdGlvbihmLGope3RyeXt0aGlzLm5hdGl2ZVJhbmdlLnNldEVuZChmLGopfWNhdGNoKHIpe3RoaXMubmF0aXZlUmFuZ2Uuc2V0U3RhcnQoZixqKTt0aGlzLm5hdGl2ZVJhbmdlLnNldEVuZChmLGopfWgodGhpcyl9O0E9ZnVuY3Rpb24oZixqKXtyZXR1cm4gZnVuY3Rpb24ocil7dHJ5e3RoaXMubmF0aXZlUmFuZ2VbZl0ocil9Y2F0Y2goTSl7dGhpcy5uYXRpdmVSYW5nZVtqXShyKTt0aGlzLm5hdGl2ZVJhbmdlW2ZdKHIpfWgodGhpcyl9fX1uLnNldFN0YXJ0QmVmb3JlPUEoInNldFN0YXJ0QmVmb3JlIiwic2V0RW5kQmVmb3JlIik7bi5zZXRTdGFydEFmdGVyPUEoInNldFN0YXJ0QWZ0ZXIiLCJzZXRFbmRBZnRlciIpO24uc2V0RW5kQmVmb3JlPUEoInNldEVuZEJlZm9yZSIsInNldFN0YXJ0QmVmb3JlIik7bi5zZXRFbmRBZnRlcj1BKCJzZXRFbmRBZnRlciIsInNldFN0YXJ0QWZ0ZXIiKTt2LnNlbGVjdE5vZGVDb250ZW50cyhwKTtuLnNlbGVjdE5vZGVDb250ZW50cz12LnN0YXJ0Q29udGFpbmVyPT1wJiZ2LmVuZENvbnRhaW5lcj09cCYmdi5zdGFydE9mZnNldD09MCYmdi5lbmRPZmZzZXQ9PXAubGVuZ3RoP2Z1bmN0aW9uKGYpe3RoaXMubmF0aXZlUmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKGYpO2godGhpcyl9OmZ1bmN0aW9uKGYpe3RoaXMuc2V0U3RhcnQoZiwwKTt0aGlzLnNldEVuZChmLE4uZ2V0RW5kT2Zmc2V0KGYpKX07di5zZWxlY3ROb2RlQ29udGVudHMocCk7di5zZXRFbmQocCwzKTt5PWRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7eS5zZWxlY3ROb2RlQ29udGVudHMocCk7eS5zZXRFbmQocCw0KTt5LnNldFN0YXJ0KHAsMik7bi5jb21wYXJlQm91bmRhcnlQb2ludHM9di5jb21wYXJlQm91bmRhcnlQb2ludHModi5TVEFSVF9UT19FTkQseSk9PS0xJnYuY29tcGFyZUJvdW5kYXJ5UG9pbnRzKHYuRU5EX1RPX1NUQVJULHkpPT0xP2Z1bmN0aW9uKGYsail7aj1qLm5hdGl2ZVJhbmdlfHxqO2lmKGY9PWouU1RBUlRfVE9fRU5EKWY9ai5FTkRfVE9fU1RBUlQ7ZWxzZSBpZihmPT1qLkVORF9UT19TVEFSVClmPWouU1RBUlRfVE9fRU5EO3JldHVybiB0aGlzLm5hdGl2ZVJhbmdlLmNvbXBhcmVCb3VuZGFyeVBvaW50cyhmLGopfTpmdW5jdGlvbihmLGope3JldHVybiB0aGlzLm5hdGl2ZVJhbmdlLmNvbXBhcmVCb3VuZGFyeVBvaW50cyhmLGoubmF0aXZlUmFuZ2V8fGopfTt6LmdldEJvZHkoZG9jdW1lbnQpLnJlbW92ZUNoaWxkKHApO3YuZGV0YWNoKCk7eS5kZXRhY2goKX0pKCk7ay5jcmVhdGVOYXRpdmVSYW5nZT1mdW5jdGlvbihoKXtoPWh8fGRvY3VtZW50O3JldHVybiBoLmNyZWF0ZVJhbmdlKCl9fWVsc2UgaWYoay5mZWF0dXJlcy5pbXBsZW1lbnRzVGV4dFJhbmdlKXtLPWZ1bmN0aW9uKGgpe3RoaXMudGV4dFJhbmdlPWg7dGhpcy5yZWZyZXNoKCl9O0sucHJvdG90eXBlPW5ldyBOKGRvY3VtZW50KTtLLnByb3RvdHlwZS5yZWZyZXNoPWZ1bmN0aW9uKCl7dmFyIGgsbixzPXRoaXMudGV4dFJhbmdlO2g9cy5wYXJlbnRFbGVtZW50KCk7dmFyIHk9cy5kdXBsaWNhdGUoKTt5LmNvbGxhcHNlKHRydWUpO249eS5wYXJlbnRFbGVtZW50KCk7eT1zLmR1cGxpY2F0ZSgpO3kuY29sbGFwc2UoZmFsc2UpO3M9eS5wYXJlbnRFbGVtZW50KCk7bj1uPT1zP246ei5nZXRDb21tb25BbmNlc3RvcihuLHMpO249bj09aD9uOnouZ2V0Q29tbW9uQW5jZXN0b3IoaCxuKTtpZih0aGlzLnRleHRSYW5nZS5jb21wYXJlRW5kUG9pbnRzKCJTdGFydFRvRW5kIix0aGlzLnRleHRSYW5nZSk9PTApbj1oPUwodGhpcy50ZXh0UmFuZ2Usbix0cnVlLHRydWUpO2Vsc2V7aD1MKHRoaXMudGV4dFJhbmdlLG4sdHJ1ZSxmYWxzZSk7bj1MKHRoaXMudGV4dFJhbmdlLG4sZmFsc2UsZmFsc2UpfXRoaXMuc2V0U3RhcnQoaC5ub2RlLGgub2Zmc2V0KTt0aGlzLnNldEVuZChuLm5vZGUsbi5vZmZzZXQpfTtLLnJhbmdlVG9UZXh0UmFuZ2U9ZnVuY3Rpb24oaCl7aWYoaC5jb2xsYXBzZWQpcmV0dXJuIEoobmV3IEMoaC5zdGFydENvbnRhaW5lcixoLnN0YXJ0T2Zmc2V0KSx0cnVlKTtlbHNle3ZhciBuPUoobmV3IEMoaC5zdGFydENvbnRhaW5lcixoLnN0YXJ0T2Zmc2V0KSx0cnVlKSxzPUoobmV3IEMoaC5lbmRDb250YWluZXIsaC5lbmRPZmZzZXQpLGZhbHNlKTtoPXouZ2V0RG9jdW1lbnQoaC5zdGFydENvbnRhaW5lcikuYm9keS5jcmVhdGVUZXh0UmFuZ2UoKTtoLnNldEVuZFBvaW50KCJTdGFydFRvU3RhcnQiLG4pO2guc2V0RW5kUG9pbnQoIkVuZFRvRW5kIixzKTtyZXR1cm4gaH19O04uY29weUNvbXBhcmlzb25Db25zdGFudHMoSyk7dmFyIFA9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30oKTtpZih0eXBlb2YgUC5SYW5nZT09InVuZGVmaW5lZCIpUC5SYW5nZT1LO2suY3JlYXRlTmF0aXZlUmFuZ2U9ZnVuY3Rpb24oaCl7aD1ofHxkb2N1bWVudDtyZXR1cm4gaC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpfX1LLnByb3RvdHlwZS5nZXROYW1lPWZ1bmN0aW9uKCl7cmV0dXJuIldyYXBwZWRSYW5nZSJ9O2suV3JhcHBlZFJhbmdlPUs7ay5jcmVhdGVSYW5nZT1mdW5jdGlvbihoKXtoPWh8fGRvY3VtZW50O3JldHVybiBuZXcgSyhrLmNyZWF0ZU5hdGl2ZVJhbmdlKGgpKX07ay5jcmVhdGVSYW5neVJhbmdlPWZ1bmN0aW9uKGgpe2g9aHx8ZG9jdW1lbnQ7cmV0dXJuIG5ldyBOKGgpfTtrLmNyZWF0ZUlmcmFtZVJhbmdlPWZ1bmN0aW9uKGgpe3JldHVybiBrLmNyZWF0ZVJhbmdlKHouZ2V0SWZyYW1lRG9jdW1lbnQoaCkpfTtrLmNyZWF0ZUlmcmFtZVJhbmd5UmFuZ2U9ZnVuY3Rpb24oaCl7cmV0dXJuIGsuY3JlYXRlUmFuZ3lSYW5nZSh6LmdldElmcmFtZURvY3VtZW50KGgpKX07ay5hZGRDcmVhdGVNaXNzaW5nTmF0aXZlQXBpTGlzdGVuZXIoZnVuY3Rpb24oaCl7aD1oLmRvY3VtZW50O2lmKHR5cGVvZiBoLmNyZWF0ZVJhbmdlPT0idW5kZWZpbmVkIiloLmNyZWF0ZVJhbmdlPWZ1bmN0aW9uKCl7cmV0dXJuIGsuY3JlYXRlUmFuZ2UodGhpcyl9O2g9aD1udWxsfSl9KTtyYW5neS5jcmVhdGVNb2R1bGUoIldyYXBwZWRTZWxlY3Rpb24iLGZ1bmN0aW9uKGssTCl7ZnVuY3Rpb24gSihiKXtyZXR1cm4oYnx8d2luZG93KS5nZXRTZWxlY3Rpb24oKX1mdW5jdGlvbiBLKGIpe3JldHVybihifHx3aW5kb3cpLmRvY3VtZW50LnNlbGVjdGlvbn1mdW5jdGlvbiB6KGIsZCxpKXt2YXIgRj1pPyJlbmQiOiJzdGFydCI7aT1pPyJzdGFydCI6ImVuZCI7Yi5hbmNob3JOb2RlPWRbRisiQ29udGFpbmVyIl07Yi5hbmNob3JPZmZzZXQ9ZFtGKyJPZmZzZXQiXTtiLmZvY3VzTm9kZT1kW2krIkNvbnRhaW5lciJdO2IuZm9jdXNPZmZzZXQ9ZFtpKyJPZmZzZXQiXX1mdW5jdGlvbiBDKGIpe2IuYW5jaG9yTm9kZT1iLmZvY3VzTm9kZT1udWxsO2IuYW5jaG9yT2Zmc2V0PWIuZm9jdXNPZmZzZXQ9MDtiLnJhbmdlQ291bnQ9MDtiLmlzQ29sbGFwc2VkPXRydWU7Yi5fcmFuZ2VzLmxlbmd0aD0wfWZ1bmN0aW9uIE4oYil7dmFyIGQ7aWYoYiBpbnN0YW5jZW9mIGope2Q9Yi5fc2VsZWN0aW9uTmF0aXZlUmFuZ2U7aWYoIWQpe2Q9ay5jcmVhdGVOYXRpdmVSYW5nZShjLmdldERvY3VtZW50KGIuc3RhcnRDb250YWluZXIpKTtkLnNldEVuZChiLmVuZENvbnRhaW5lcixiLmVuZE9mZnNldCk7ZC5zZXRTdGFydChiLnN0YXJ0Q29udGFpbmVyLGIuc3RhcnRPZmZzZXQpO2IuX3NlbGVjdGlvbk5hdGl2ZVJhbmdlPWQ7Yi5hdHRhY2hMaXN0ZW5lcigiZGV0YWNoIixmdW5jdGlvbigpe3RoaXMuX3NlbGVjdGlvbk5hdGl2ZVJhbmdlPW51bGx9KX19ZWxzZSBpZihiIGluc3RhbmNlb2YgcilkPWIubmF0aXZlUmFuZ2U7ZWxzZSBpZihrLmZlYXR1cmVzLmltcGxlbWVudHNEb21SYW5nZSYmYiBpbnN0YW5jZW9mIGMuZ2V0V2luZG93KGIuc3RhcnRDb250YWluZXIpLlJhbmdlKWQ9YjtyZXR1cm4gZH1mdW5jdGlvbiBQKGIpe3ZhciBkPWIuZ2V0Tm9kZXMoKSxpO2E6aWYoIWQubGVuZ3RofHxkWzBdLm5vZGVUeXBlIT0xKWk9ZmFsc2U7ZWxzZXtpPTE7Zm9yKHZhciBGPWQubGVuZ3RoO2k8RjsrK2kpaWYoIWMuaXNBbmNlc3Rvck9mKGRbMF0sZFtpXSkpe2k9ZmFsc2U7YnJlYWsgYX1pPXRydWV9aWYoIWkpdGhyb3cgRXJyb3IoImdldFNpbmdsZUVsZW1lbnRGcm9tUmFuZ2U6IHJhbmdlICIrYi5pbnNwZWN0KCkrIiBkaWQgbm90IGNvbnNpc3Qgb2YgYSBzaW5nbGUgZWxlbWVudCIpO3JldHVybiBkWzBdfWZ1bmN0aW9uIGgoYixkKXt2YXIgaT1uZXcgcihkKTtiLl9yYW5nZXM9W2ldO3ooYixpLGZhbHNlKTtiLnJhbmdlQ291bnQ9MTtiLmlzQ29sbGFwc2VkPWkuY29sbGFwc2VkfWZ1bmN0aW9uIG4oYil7Yi5fcmFuZ2VzLmxlbmd0aD0wO2lmKGIuZG9jU2VsZWN0aW9uLnR5cGU9PSJOb25lIilDKGIpO2Vsc2V7dmFyIGQ9Yi5kb2NTZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTtpZihkJiZ0eXBlb2YgZC50ZXh0IT0idW5kZWZpbmVkIiloKGIsZCk7ZWxzZXtiLnJhbmdlQ291bnQ9ZC5sZW5ndGg7Zm9yKHZhciBpLEY9Yy5nZXREb2N1bWVudChkLml0ZW0oMCkpLEg9MDtIPGIucmFuZ2VDb3VudDsrK0gpe2k9ay5jcmVhdGVSYW5nZShGKTtpLnNlbGVjdE5vZGUoZC5pdGVtKEgpKTtiLl9yYW5nZXMucHVzaChpKX1iLmlzQ29sbGFwc2VkPWIucmFuZ2VDb3VudD09MSYmYi5fcmFuZ2VzWzBdLmNvbGxhcHNlZDt6KGIsYi5fcmFuZ2VzW2IucmFuZ2VDb3VudC0xXSxmYWxzZSl9fX1mdW5jdGlvbiBzKGIsZCl7dmFyIGk9Yi5kb2NTZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKSxGPVAoZCksSD1jLmdldERvY3VtZW50KGkuaXRlbSgwKSk7SD1jLmdldEJvZHkoSCkuY3JlYXRlQ29udHJvbFJhbmdlKCk7Zm9yKHZhciBPPTAsWj1pLmxlbmd0aDtPPFo7KytPKUguYWRkKGkuaXRlbShPKSk7dHJ5e0guYWRkKEYpfWNhdGNoKGthKXt0aHJvdyBFcnJvcigiYWRkUmFuZ2UoKTogRWxlbWVudCB3aXRoaW4gdGhlIHNwZWNpZmllZCBSYW5nZSBjb3VsZCBub3QgYmUgYWRkZWQgdG8gY29udHJvbCBzZWxlY3Rpb24gKGRvZXMgaXQgaGF2ZSBsYXlvdXQ/KSIpO31ILnNlbGVjdCgpO24oYil9ZnVuY3Rpb24geShiLGQsaSl7dGhpcy5uYXRpdmVTZWxlY3Rpb249Yjt0aGlzLmRvY1NlbGVjdGlvbj1kO3RoaXMuX3Jhbmdlcz1bXTt0aGlzLndpbj1pO3RoaXMucmVmcmVzaCgpfWZ1bmN0aW9uIEEoYixkKXt2YXIgaT1jLmdldERvY3VtZW50KGRbMF0uc3RhcnRDb250YWluZXIpO2k9Yy5nZXRCb2R5KGkpLmNyZWF0ZUNvbnRyb2xSYW5nZSgpO2Zvcih2YXIgRj0wLEg7RjxyYW5nZUNvdW50OysrRil7SD1QKGRbRl0pO3RyeXtpLmFkZChIKX1jYXRjaChPKXt0aHJvdyBFcnJvcigic2V0UmFuZ2VzKCk6IEVsZW1lbnQgd2l0aGluIHRoZSBvbmUgb2YgdGhlIHNwZWNpZmllZCBSYW5nZXMgY291bGQgbm90IGJlIGFkZGVkIHRvIGNvbnRyb2wgc2VsZWN0aW9uIChkb2VzIGl0IGhhdmUgbGF5b3V0PykiKTt9fWkuc2VsZWN0KCk7bihiKX1mdW5jdGlvbiBwKGIsZCl7aWYoYi5hbmNob3JOb2RlJiZjLmdldERvY3VtZW50KGIuYW5jaG9yTm9kZSkhPT1jLmdldERvY3VtZW50KGQpKXRocm93IG5ldyBNKCJXUk9OR19ET0NVTUVOVF9FUlIiKTt9ZnVuY3Rpb24gdihiKXt2YXIgZD1bXSxpPW5ldyBvKGIuYW5jaG9yTm9kZSxiLmFuY2hvck9mZnNldCksRj1uZXcgbyhiLmZvY3VzTm9kZSxiLmZvY3VzT2Zmc2V0KSxIPXR5cGVvZiBiLmdldE5hbWU9PSJmdW5jdGlvbiI/Yi5nZXROYW1lKCk6IlNlbGVjdGlvbiI7aWYodHlwZW9mIGIucmFuZ2VDb3VudCE9InVuZGVmaW5lZCIpZm9yKHZhciBPPTAsWj1iLnJhbmdlQ291bnQ7TzxaOysrTylkW09dPWouaW5zcGVjdChiLmdldFJhbmdlQXQoTykpO3JldHVybiJbIitIKyIoUmFuZ2VzOiAiK2Quam9pbigiLCAiKSsiKShhbmNob3I6ICIraS5pbnNwZWN0KCkrIiwgZm9jdXM6ICIrRi5pbnNwZWN0KCkrIl0ifWsucmVxdWlyZU1vZHVsZXMoWyJEb21VdGlsIiwiRG9tUmFuZ2UiLCJXcmFwcGVkUmFuZ2UiXSk7ay5jb25maWcuY2hlY2tTZWxlY3Rpb25SYW5nZXM9dHJ1ZTt2YXIgYz1rLmRvbSxmPWsudXRpbCxqPWsuRG9tUmFuZ2Uscj1rLldyYXBwZWRSYW5nZSxNPWsuRE9NRXhjZXB0aW9uLG89Yy5Eb21Qb3NpdGlvbix1LHgsQj1rLnV0aWwuaXNIb3N0TWV0aG9kKHdpbmRvdywiZ2V0U2VsZWN0aW9uIiksRD1rLnV0aWwuaXNIb3N0T2JqZWN0KGRvY3VtZW50LCJzZWxlY3Rpb24iKSxXPUQmJighQnx8ay5jb25maWcucHJlZmVyVGV4dFJhbmdlKTtpZihXKXt1PUs7ay5pc1NlbGVjdGlvblZhbGlkPWZ1bmN0aW9uKGIpe2I9KGJ8fHdpbmRvdykuZG9jdW1lbnQ7dmFyIGQ9Yi5zZWxlY3Rpb247cmV0dXJuIGQudHlwZSE9Ik5vbmUifHxjLmdldERvY3VtZW50KGQuY3JlYXRlUmFuZ2UoKS5wYXJlbnRFbGVtZW50KCkpPT1ifX1lbHNlIGlmKEIpe3U9SjtrLmlzU2VsZWN0aW9uVmFsaWQ9ZnVuY3Rpb24oKXtyZXR1cm4gdHJ1ZX19ZWxzZSBMLmZhaWwoIk5laXRoZXIgZG9jdW1lbnQuc2VsZWN0aW9uIG9yIHdpbmRvdy5nZXRTZWxlY3Rpb24oKSBkZXRlY3RlZC4iKTtrLmdldE5hdGl2ZVNlbGVjdGlvbj11O0I9dSgpO3ZhciBlYT1rLmNyZWF0ZU5hdGl2ZVJhbmdlKGRvY3VtZW50KSwkPWMuZ2V0Qm9keShkb2N1bWVudCksWD1mLmFyZUhvc3RPYmplY3RzKEIsZi5hcmVIb3N0UHJvcGVydGllcyhCLFsiYW5jaG9yT2Zmc2V0IiwiZm9jdXNPZmZzZXQiXSkpO2suZmVhdHVyZXMuc2VsZWN0aW9uSGFzQW5jaG9yQW5kRm9jdXM9WDt2YXIgY2E9Zi5pc0hvc3RNZXRob2QoQiwiZXh0ZW5kIik7ay5mZWF0dXJlcy5zZWxlY3Rpb25IYXNFeHRlbmQ9Y2E7dmFyIGhhPXR5cGVvZiBCLnJhbmdlQ291bnQ9PSJudW1iZXIiO2suZmVhdHVyZXMuc2VsZWN0aW9uSGFzUmFuZ2VDb3VudD1oYTt2YXIgZGE9ZmFsc2UsVD10cnVlO2YuYXJlSG9zdE1ldGhvZHMoQixbImFkZFJhbmdlIiwiZ2V0UmFuZ2VBdCIsInJlbW92ZUFsbFJhbmdlcyJdKSYmdHlwZW9mIEIucmFuZ2VDb3VudD09Im51bWJlciImJmsuZmVhdHVyZXMuaW1wbGVtZW50c0RvbVJhbmdlJiZmdW5jdGlvbigpe3ZhciBiPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlmcmFtZSIpOyQuYXBwZW5kQ2hpbGQoYik7dmFyIGQ9Yy5nZXRJZnJhbWVEb2N1bWVudChiKTtkLm9wZW4oKTtkLndyaXRlKCI8aHRtbD48aGVhZD48L2hlYWQ+PGJvZHk+MTI8L2JvZHk+PC9odG1sPiIpO2QuY2xvc2UoKTt2YXIgaT1jLmdldElmcmFtZVdpbmRvdyhiKS5nZXRTZWxlY3Rpb24oKSxGPWQuZG9jdW1lbnRFbGVtZW50Lmxhc3RDaGlsZC5maXJzdENoaWxkO2Q9ZC5jcmVhdGVSYW5nZSgpO2Quc2V0U3RhcnQoRiwxKTtkLmNvbGxhcHNlKHRydWUpO2kuYWRkUmFuZ2UoZCk7VD1pLnJhbmdlQ291bnQ9PTE7aS5yZW1vdmVBbGxSYW5nZXMoKTt2YXIgSD1kLmNsb25lUmFuZ2UoKTtkLnNldFN0YXJ0KEYsMCk7SC5zZXRFbmQoRiwyKTtpLmFkZFJhbmdlKGQpO2kuYWRkUmFuZ2UoSCk7ZGE9aS5yYW5nZUNvdW50PT0yO2QuZGV0YWNoKCk7SC5kZXRhY2goKTskLnJlbW92ZUNoaWxkKGIpfSgpO2suZmVhdHVyZXMuc2VsZWN0aW9uU3VwcG9ydHNNdWx0aXBsZVJhbmdlcz1kYTtrLmZlYXR1cmVzLmNvbGxhcHNlZE5vbkVkaXRhYmxlU2VsZWN0aW9uc1N1cHBvcnRlZD1UO3ZhciBsPWZhbHNlLEU7aWYoJCYmZi5pc0hvc3RNZXRob2QoJCwiY3JlYXRlQ29udHJvbFJhbmdlIikpe0U9JC5jcmVhdGVDb250cm9sUmFuZ2UoKTtpZihmLmFyZUhvc3RQcm9wZXJ0aWVzKEUsWyJpdGVtIiwiYWRkIl0pKWw9dHJ1ZX1rLmZlYXR1cmVzLmltcGxlbWVudHNDb250cm9sUmFuZ2U9bDt4PVg/ZnVuY3Rpb24oYil7cmV0dXJuIGIuYW5jaG9yTm9kZT09PWIuZm9jdXNOb2RlJiZiLmFuY2hvck9mZnNldD09PWIuZm9jdXNPZmZzZXR9OmZ1bmN0aW9uKGIpe3JldHVybiBiLnJhbmdlQ291bnQ/Yi5nZXRSYW5nZUF0KGIucmFuZ2VDb3VudC0xKS5jb2xsYXBzZWQ6ZmFsc2V9O3ZhciBRO2lmKGYuaXNIb3N0TWV0aG9kKEIsImdldFJhbmdlQXQiKSlRPWZ1bmN0aW9uKGIsZCl7dHJ5e3JldHVybiBiLmdldFJhbmdlQXQoZCl9Y2F0Y2goaSl7cmV0dXJuIG51bGx9fTtlbHNlIGlmKFgpUT1mdW5jdGlvbihiKXt2YXIgZD1jLmdldERvY3VtZW50KGIuYW5jaG9yTm9kZSk7ZD1rLmNyZWF0ZVJhbmdlKGQpO2Quc2V0U3RhcnQoYi5hbmNob3JOb2RlLGIuYW5jaG9yT2Zmc2V0KTtkLnNldEVuZChiLmZvY3VzTm9kZSxiLmZvY3VzT2Zmc2V0KTtpZihkLmNvbGxhcHNlZCE9PXRoaXMuaXNDb2xsYXBzZWQpe2Quc2V0U3RhcnQoYi5mb2N1c05vZGUsYi5mb2N1c09mZnNldCk7ZC5zZXRFbmQoYi5hbmNob3JOb2RlLGIuYW5jaG9yT2Zmc2V0KX1yZXR1cm4gZH07ay5nZXRTZWxlY3Rpb249ZnVuY3Rpb24oYil7Yj1ifHx3aW5kb3c7dmFyIGQ9Yi5fcmFuZ3lTZWxlY3Rpb24saT11KGIpLEY9RD9LKGIpOm51bGw7aWYoZCl7ZC5uYXRpdmVTZWxlY3Rpb249aTtkLmRvY1NlbGVjdGlvbj1GO2QucmVmcmVzaChiKX1lbHNle2Q9bmV3IHkoaSxGLGIpO2IuX3Jhbmd5U2VsZWN0aW9uPWR9cmV0dXJuIGR9O2suZ2V0SWZyYW1lU2VsZWN0aW9uPWZ1bmN0aW9uKGIpe3JldHVybiBrLmdldFNlbGVjdGlvbihjLmdldElmcmFtZVdpbmRvdyhiKSl9O0U9eS5wcm90b3R5cGU7aWYoIVcmJlgmJmYuYXJlSG9zdE1ldGhvZHMoQixbInJlbW92ZUFsbFJhbmdlcyIsImFkZFJhbmdlIl0pKXtFLnJlbW92ZUFsbFJhbmdlcz1mdW5jdGlvbigpe3RoaXMubmF0aXZlU2VsZWN0aW9uLnJlbW92ZUFsbFJhbmdlcygpO0ModGhpcyl9O3ZhciBmYT1mdW5jdGlvbihiLGQpe3ZhciBpPWouZ2V0UmFuZ2VEb2N1bWVudChkKTtpPWsuY3JlYXRlUmFuZ2UoaSk7aS5jb2xsYXBzZVRvUG9pbnQoZC5lbmRDb250YWluZXIsZC5lbmRPZmZzZXQpO2IubmF0aXZlU2VsZWN0aW9uLmFkZFJhbmdlKE4oaSkpO2IubmF0aXZlU2VsZWN0aW9uLmV4dGVuZChkLnN0YXJ0Q29udGFpbmVyLGQuc3RhcnRPZmZzZXQpO2IucmVmcmVzaCgpfTtFLmFkZFJhbmdlPWhhP2Z1bmN0aW9uKGIsZCl7aWYobCYmRCYmdGhpcy5kb2NTZWxlY3Rpb24udHlwZT09IkNvbnRyb2wiKXModGhpcyxiKTtlbHNlIGlmKGQmJmNhKWZhKHRoaXMsYik7ZWxzZXt2YXIgaTtpZihkYSlpPXRoaXMucmFuZ2VDb3VudDtlbHNle3RoaXMucmVtb3ZlQWxsUmFuZ2VzKCk7aT0wfXRoaXMubmF0aXZlU2VsZWN0aW9uLmFkZFJhbmdlKE4oYikpO3RoaXMucmFuZ2VDb3VudD10aGlzLm5hdGl2ZVNlbGVjdGlvbi5yYW5nZUNvdW50O2lmKHRoaXMucmFuZ2VDb3VudD09aSsxKXtpZihrLmNvbmZpZy5jaGVja1NlbGVjdGlvblJhbmdlcylpZigoaT1RKHRoaXMubmF0aXZlU2VsZWN0aW9uLHRoaXMucmFuZ2VDb3VudC0xKSkmJiFqLnJhbmdlc0VxdWFsKGksYikpYj1uZXcgcihpKTt0aGlzLl9yYW5nZXNbdGhpcy5yYW5nZUNvdW50LTFdPWI7eih0aGlzLGIsYWEodGhpcy5uYXRpdmVTZWxlY3Rpb24pKTt0aGlzLmlzQ29sbGFwc2VkPXgodGhpcyl9ZWxzZSB0aGlzLnJlZnJlc2goKX19OmZ1bmN0aW9uKGIsZCl7aWYoZCYmY2EpZmEodGhpcyxiKTtlbHNle3RoaXMubmF0aXZlU2VsZWN0aW9uLmFkZFJhbmdlKE4oYikpO3RoaXMucmVmcmVzaCgpfX07RS5zZXRSYW5nZXM9ZnVuY3Rpb24oYil7aWYobCYmYi5sZW5ndGg+MSlBKHRoaXMsYik7ZWxzZXt0aGlzLnJlbW92ZUFsbFJhbmdlcygpO2Zvcih2YXIgZD0wLGk9Yi5sZW5ndGg7ZDxpOysrZCl0aGlzLmFkZFJhbmdlKGJbZF0pfX19ZWxzZSBpZihmLmlzSG9zdE1ldGhvZChCLCJlbXB0eSIpJiZmLmlzSG9zdE1ldGhvZChlYSwic2VsZWN0IikmJmwmJlcpe0UucmVtb3ZlQWxsUmFuZ2VzPWZ1bmN0aW9uKCl7dHJ5e3RoaXMuZG9jU2VsZWN0aW9uLmVtcHR5KCk7aWYodGhpcy5kb2NTZWxlY3Rpb24udHlwZSE9Ik5vbmUiKXt2YXIgYjtpZih0aGlzLmFuY2hvck5vZGUpYj1jLmdldERvY3VtZW50KHRoaXMuYW5jaG9yTm9kZSk7ZWxzZSBpZih0aGlzLmRvY1NlbGVjdGlvbi50eXBlPT0iQ29udHJvbCIpe3ZhciBkPXRoaXMuZG9jU2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7aWYoZC5sZW5ndGgpYj1jLmdldERvY3VtZW50KGQuaXRlbSgwKSkuYm9keS5jcmVhdGVUZXh0UmFuZ2UoKX1pZihiKXtiLmJvZHkuY3JlYXRlVGV4dFJhbmdlKCkuc2VsZWN0KCk7dGhpcy5kb2NTZWxlY3Rpb24uZW1wdHkoKX19fWNhdGNoKGkpe31DKHRoaXMpfTtFLmFkZFJhbmdlPWZ1bmN0aW9uKGIpe2lmKHRoaXMuZG9jU2VsZWN0aW9uLnR5cGU9PSJDb250cm9sIilzKHRoaXMsYik7ZWxzZXtyLnJhbmdlVG9UZXh0UmFuZ2UoYikuc2VsZWN0KCk7dGhpcy5fcmFuZ2VzWzBdPWI7dGhpcy5yYW5nZUNvdW50PTE7dGhpcy5pc0NvbGxhcHNlZD10aGlzLl9yYW5nZXNbMF0uY29sbGFwc2VkO3oodGhpcyxiLGZhbHNlKX19O0Uuc2V0UmFuZ2VzPWZ1bmN0aW9uKGIpe3RoaXMucmVtb3ZlQWxsUmFuZ2VzKCk7dmFyIGQ9Yi5sZW5ndGg7aWYoZD4xKUEodGhpcyxiKTtlbHNlIGQmJnRoaXMuYWRkUmFuZ2UoYlswXSl9fWVsc2V7TC5mYWlsKCJObyBtZWFucyBvZiBzZWxlY3RpbmcgYSBSYW5nZSBvciBUZXh0UmFuZ2Ugd2FzIGZvdW5kIik7cmV0dXJuIGZhbHNlfUUuZ2V0UmFuZ2VBdD1mdW5jdGlvbihiKXtpZihiPDB8fGI+PXRoaXMucmFuZ2VDb3VudCl0aHJvdyBuZXcgTSgiSU5ERVhfU0laRV9FUlIiKTtlbHNlIHJldHVybiB0aGlzLl9yYW5nZXNbYl19O3ZhciBZO2lmKFcpWT1mdW5jdGlvbihiKXt2YXIgZDtpZihrLmlzU2VsZWN0aW9uVmFsaWQoYi53aW4pKWQ9Yi5kb2NTZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTtlbHNle2Q9Yy5nZXRCb2R5KGIud2luLmRvY3VtZW50KS5jcmVhdGVUZXh0UmFuZ2UoKTtkLmNvbGxhcHNlKHRydWUpfWlmKGIuZG9jU2VsZWN0aW9uLnR5cGU9PSJDb250cm9sIiluKGIpO2Vsc2UgZCYmdHlwZW9mIGQudGV4dCE9InVuZGVmaW5lZCI/aChiLGQpOkMoYil9O2Vsc2UgaWYoZi5pc0hvc3RNZXRob2QoQiwiZ2V0UmFuZ2VBdCIpJiZ0eXBlb2YgQi5yYW5nZUNvdW50PT0ibnVtYmVyIilZPWZ1bmN0aW9uKGIpe2lmKGwmJkQmJmIuZG9jU2VsZWN0aW9uLnR5cGU9PSJDb250cm9sIiluKGIpO2Vsc2V7Yi5fcmFuZ2VzLmxlbmd0aD1iLnJhbmdlQ291bnQ9Yi5uYXRpdmVTZWxlY3Rpb24ucmFuZ2VDb3VudDtpZihiLnJhbmdlQ291bnQpe2Zvcih2YXIgZD0wLGk9Yi5yYW5nZUNvdW50O2Q8aTsrK2QpYi5fcmFuZ2VzW2RdPW5ldyBrLldyYXBwZWRSYW5nZShiLm5hdGl2ZVNlbGVjdGlvbi5nZXRSYW5nZUF0KGQpKTt6KGIsYi5fcmFuZ2VzW2IucmFuZ2VDb3VudC0xXSxhYShiLm5hdGl2ZVNlbGVjdGlvbikpO2IuaXNDb2xsYXBzZWQ9eChiKX1lbHNlIEMoYil9fTtlbHNlIGlmKFgmJnR5cGVvZiBCLmlzQ29sbGFwc2VkPT0iYm9vbGVhbiImJnR5cGVvZiBlYS5jb2xsYXBzZWQ9PSJib29sZWFuIiYmay5mZWF0dXJlcy5pbXBsZW1lbnRzRG9tUmFuZ2UpWT1mdW5jdGlvbihiKXt2YXIgZDtkPWIubmF0aXZlU2VsZWN0aW9uO2lmKGQuYW5jaG9yTm9kZSl7ZD1RKGQsMCk7Yi5fcmFuZ2VzPVtkXTtiLnJhbmdlQ291bnQ9MTtkPWIubmF0aXZlU2VsZWN0aW9uO2IuYW5jaG9yTm9kZT1kLmFuY2hvck5vZGU7Yi5hbmNob3JPZmZzZXQ9ZC5hbmNob3JPZmZzZXQ7Yi5mb2N1c05vZGU9ZC5mb2N1c05vZGU7Yi5mb2N1c09mZnNldD1kLmZvY3VzT2Zmc2V0O2IuaXNDb2xsYXBzZWQ9eChiKX1lbHNlIEMoYil9O2Vsc2V7TC5mYWlsKCJObyBtZWFucyBvZiBvYnRhaW5pbmcgYSBSYW5nZSBvciBUZXh0UmFuZ2UgZnJvbSB0aGUgdXNlcidzIHNlbGVjdGlvbiB3YXMgZm91bmQiKTtyZXR1cm4gZmFsc2V9RS5yZWZyZXNoPWZ1bmN0aW9uKGIpe3ZhciBkPWI/dGhpcy5fcmFuZ2VzLnNsaWNlKDApOm51bGw7WSh0aGlzKTtpZihiKXtiPWQubGVuZ3RoO2lmKGIhPXRoaXMuX3Jhbmdlcy5sZW5ndGgpcmV0dXJuIGZhbHNlO2Zvcig7Yi0tOylpZighai5yYW5nZXNFcXVhbChkW2JdLHRoaXMuX3Jhbmdlc1tiXSkpcmV0dXJuIGZhbHNlO3JldHVybiB0cnVlfX07dmFyIGlhPWZ1bmN0aW9uKGIsZCl7dmFyIGk9Yi5nZXRBbGxSYW5nZXMoKSxGPWZhbHNlO2IucmVtb3ZlQWxsUmFuZ2VzKCk7Zm9yKHZhciBIPTAsTz1pLmxlbmd0aDtIPE87KytIKWlmKEZ8fGQhPT1pW0hdKWIuYWRkUmFuZ2UoaVtIXSk7ZWxzZSBGPXRydWU7Yi5yYW5nZUNvdW50fHxDKGIpfTtFLnJlbW92ZVJhbmdlPWw/ZnVuY3Rpb24oYil7aWYodGhpcy5kb2NTZWxlY3Rpb24udHlwZT09IkNvbnRyb2wiKXt2YXIgZD10aGlzLmRvY1NlbGVjdGlvbi5jcmVhdGVSYW5nZSgpO2I9UChiKTt2YXIgaT1jLmdldERvY3VtZW50KGQuaXRlbSgwKSk7aT1jLmdldEJvZHkoaSkuY3JlYXRlQ29udHJvbFJhbmdlKCk7Zm9yKHZhciBGLEg9ZmFsc2UsTz0wLFo9ZC5sZW5ndGg7TzxaOysrTyl7Rj1kLml0ZW0oTyk7aWYoRiE9PWJ8fEgpaS5hZGQoZC5pdGVtKE8pKTtlbHNlIEg9dHJ1ZX1pLnNlbGVjdCgpO24odGhpcyl9ZWxzZSBpYSh0aGlzLGIpfTpmdW5jdGlvbihiKXtpYSh0aGlzLGIpfTt2YXIgYWE7aWYoIVcmJlgmJmsuZmVhdHVyZXMuaW1wbGVtZW50c0RvbVJhbmdlKXthYT1mdW5jdGlvbihiKXt2YXIgZD1mYWxzZTtpZihiLmFuY2hvck5vZGUpZD1jLmNvbXBhcmVQb2ludHMoYi5hbmNob3JOb2RlLGIuYW5jaG9yT2Zmc2V0LGIuZm9jdXNOb2RlLGIuZm9jdXNPZmZzZXQpPT0xO3JldHVybiBkfTtFLmlzQmFja3dhcmRzPWZ1bmN0aW9uKCl7cmV0dXJuIGFhKHRoaXMpfX1lbHNlIGFhPUUuaXNCYWNrd2FyZHM9ZnVuY3Rpb24oKXtyZXR1cm4gZmFsc2V9O0UudG9TdHJpbmc9ZnVuY3Rpb24oKXtmb3IodmFyIGI9W10sZD0wLGk9dGhpcy5yYW5nZUNvdW50O2Q8aTsrK2QpYltkXT0iIit0aGlzLl9yYW5nZXNbZF07cmV0dXJuIGIuam9pbigiIil9O0UuY29sbGFwc2U9ZnVuY3Rpb24oYixkKXtwKHRoaXMsYik7dmFyIGk9ay5jcmVhdGVSYW5nZShjLmdldERvY3VtZW50KGIpKTtpLmNvbGxhcHNlVG9Qb2ludChiLGQpO3RoaXMucmVtb3ZlQWxsUmFuZ2VzKCk7dGhpcy5hZGRSYW5nZShpKTt0aGlzLmlzQ29sbGFwc2VkPXRydWV9O0UuY29sbGFwc2VUb1N0YXJ0PWZ1bmN0aW9uKCl7aWYodGhpcy5yYW5nZUNvdW50KXt2YXIgYj10aGlzLl9yYW5nZXNbMF07dGhpcy5jb2xsYXBzZShiLnN0YXJ0Q29udGFpbmVyLGIuc3RhcnRPZmZzZXQpfWVsc2UgdGhyb3cgbmV3IE0oIklOVkFMSURfU1RBVEVfRVJSIik7fTtFLmNvbGxhcHNlVG9FbmQ9ZnVuY3Rpb24oKXtpZih0aGlzLnJhbmdlQ291bnQpe3ZhciBiPXRoaXMuX3Jhbmdlc1t0aGlzLnJhbmdlQ291bnQtMV07dGhpcy5jb2xsYXBzZShiLmVuZENvbnRhaW5lcixiLmVuZE9mZnNldCl9ZWxzZSB0aHJvdyBuZXcgTSgiSU5WQUxJRF9TVEFURV9FUlIiKTt9O0Uuc2VsZWN0QWxsQ2hpbGRyZW49ZnVuY3Rpb24oYil7cCh0aGlzLGIpO3ZhciBkPWsuY3JlYXRlUmFuZ2UoYy5nZXREb2N1bWVudChiKSk7ZC5zZWxlY3ROb2RlQ29udGVudHMoYik7dGhpcy5yZW1vdmVBbGxSYW5nZXMoKTt0aGlzLmFkZFJhbmdlKGQpfTtFLmRlbGV0ZUZyb21Eb2N1bWVudD1mdW5jdGlvbigpe2lmKGwmJkQmJnRoaXMuZG9jU2VsZWN0aW9uLnR5cGU9PSJDb250cm9sIil7Zm9yKHZhciBiPXRoaXMuZG9jU2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCksZDtiLmxlbmd0aDspe2Q9Yi5pdGVtKDApO2IucmVtb3ZlKGQpO2QucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkKX10aGlzLnJlZnJlc2goKX1lbHNlIGlmKHRoaXMucmFuZ2VDb3VudCl7Yj10aGlzLmdldEFsbFJhbmdlcygpO3RoaXMucmVtb3ZlQWxsUmFuZ2VzKCk7ZD0wO2Zvcih2YXIgaT1iLmxlbmd0aDtkPGk7KytkKWJbZF0uZGVsZXRlQ29udGVudHMoKTt0aGlzLmFkZFJhbmdlKGJbaS0xXSl9fTtFLmdldEFsbFJhbmdlcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9yYW5nZXMuc2xpY2UoMCl9O0Uuc2V0U2luZ2xlUmFuZ2U9ZnVuY3Rpb24oYil7dGhpcy5zZXRSYW5nZXMoW2JdKX07RS5jb250YWluc05vZGU9ZnVuY3Rpb24oYixkKXtmb3IodmFyIGk9MCxGPXRoaXMuX3Jhbmdlcy5sZW5ndGg7aTxGOysraSlpZih0aGlzLl9yYW5nZXNbaV0uY29udGFpbnNOb2RlKGIsZCkpcmV0dXJuIHRydWU7cmV0dXJuIGZhbHNlfTtFLnRvSHRtbD1mdW5jdGlvbigpe3ZhciBiPSIiO2lmKHRoaXMucmFuZ2VDb3VudCl7Yj1qLmdldFJhbmdlRG9jdW1lbnQodGhpcy5fcmFuZ2VzWzBdKS5jcmVhdGVFbGVtZW50KCJkaXYiKTtmb3IodmFyIGQ9MCxpPXRoaXMuX3Jhbmdlcy5sZW5ndGg7ZDxpOysrZCliLmFwcGVuZENoaWxkKHRoaXMuX3Jhbmdlc1tkXS5jbG9uZUNvbnRlbnRzKCkpO2I9Yi5pbm5lckhUTUx9cmV0dXJuIGJ9O0UuZ2V0TmFtZT1mdW5jdGlvbigpe3JldHVybiJXcmFwcGVkU2VsZWN0aW9uIn07RS5pbnNwZWN0PWZ1bmN0aW9uKCl7cmV0dXJuIHYodGhpcyl9O0UuZGV0YWNoPWZ1bmN0aW9uKCl7dGhpcy53aW49dGhpcy5hbmNob3JOb2RlPXRoaXMuZm9jdXNOb2RlPXRoaXMud2luLl9yYW5neVNlbGVjdGlvbj1udWxsfTt5Lmluc3BlY3Q9djtrLlNlbGVjdGlvbj15O2suc2VsZWN0aW9uUHJvdG90eXBlPUU7ay5hZGRDcmVhdGVNaXNzaW5nTmF0aXZlQXBpTGlzdGVuZXIoZnVuY3Rpb24oYil7aWYodHlwZW9mIGIuZ2V0U2VsZWN0aW9uPT0idW5kZWZpbmVkIiliLmdldFNlbGVjdGlvbj1mdW5jdGlvbigpe3JldHVybiBrLmdldFNlbGVjdGlvbih0aGlzKX07Yj1udWxsfSl9KTtyYW5neS5jcmVhdGVNb2R1bGUoIkNzc0NsYXNzQXBwbGllciIsZnVuY3Rpb24oaSxyKXtmdW5jdGlvbiBzKGEsYil7cmV0dXJuIGEuY2xhc3NOYW1lJiZSZWdFeHAoIig/Ol58XFxzKSIrYisiKD86XFxzfCQpIikudGVzdChhLmNsYXNzTmFtZSl9ZnVuY3Rpb24gdChhLGIpe2lmKGEuY2xhc3NOYW1lKXMoYSxiKXx8KGEuY2xhc3NOYW1lKz0iICIrYik7ZWxzZSBhLmNsYXNzTmFtZT1ifWZ1bmN0aW9uIG8oYSl7cmV0dXJuIGEuc3BsaXQoL1xzKy8pLnNvcnQoKS5qb2luKCIgIil9ZnVuY3Rpb24gdyhhLGIpe3JldHVybiBvKGEuY2xhc3NOYW1lKT09byhiLmNsYXNzTmFtZSl9ZnVuY3Rpb24geChhKXtmb3IodmFyIGI9YS5wYXJlbnROb2RlO2EuaGFzQ2hpbGROb2RlcygpOyliLmluc2VydEJlZm9yZShhLmZpcnN0Q2hpbGQsYSk7Yi5yZW1vdmVDaGlsZChhKX1mdW5jdGlvbiB5KGEsYil7dmFyIGM9YS5jbG9uZVJhbmdlKCk7Yy5zZWxlY3ROb2RlQ29udGVudHMoYik7dmFyIGQ9Yy5pbnRlcnNlY3Rpb24oYSk7ZD1kP2QudG9TdHJpbmcoKToiIjtjLmRldGFjaCgpO3JldHVybiBkIT0iIn1mdW5jdGlvbiB6KGEpe3JldHVybiBhLmdldE5vZGVzKFszXSxmdW5jdGlvbihiKXtyZXR1cm4geShhLGIpfSl9ZnVuY3Rpb24gQShhLGIpe2lmKGEuYXR0cmlidXRlcy5sZW5ndGghPWIuYXR0cmlidXRlcy5sZW5ndGgpcmV0dXJuIGZhbHNlO2Zvcih2YXIgYz0wLGQ9YS5hdHRyaWJ1dGVzLmxlbmd0aCxlLGY7YzxkOysrYyl7ZT1hLmF0dHJpYnV0ZXNbY107Zj1lLm5hbWU7aWYoZiE9ImNsYXNzIil7Zj1iLmF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKGYpO2lmKGUuc3BlY2lmaWVkIT1mLnNwZWNpZmllZClyZXR1cm4gZmFsc2U7aWYoZS5zcGVjaWZpZWQmJmUubm9kZVZhbHVlIT09Zi5ub2RlVmFsdWUpcmV0dXJuIGZhbHNlfX1yZXR1cm4gdHJ1ZX1mdW5jdGlvbiBCKGEsYil7Zm9yKHZhciBjPTAsZD1hLmF0dHJpYnV0ZXMubGVuZ3RoLGU7YzxkOysrYyl7ZT1hLmF0dHJpYnV0ZXNbY10ubmFtZTtpZighKGImJmguYXJyYXlDb250YWlucyhiLGUpKSYmYS5hdHRyaWJ1dGVzW2NdLnNwZWNpZmllZCYmZSE9ImNsYXNzIilyZXR1cm4gdHJ1ZX1yZXR1cm4gZmFsc2V9ZnVuY3Rpb24gQyhhKXt2YXIgYjtyZXR1cm4gYSYmYS5ub2RlVHlwZT09MSYmKChiPWEucGFyZW50Tm9kZSkmJmIubm9kZVR5cGU9PTkmJmIuZGVzaWduTW9kZT09Im9uInx8ayhhKSYmIWsoYS5wYXJlbnROb2RlKSl9ZnVuY3Rpb24gRChhKXtyZXR1cm4oayhhKXx8YS5ub2RlVHlwZSE9MSYmayhhLnBhcmVudE5vZGUpKSYmIUMoYSl9ZnVuY3Rpb24gRShhKXtyZXR1cm4gYSYmYS5ub2RlVHlwZT09MSYmIU0udGVzdChwKGEsImRpc3BsYXkiKSl9ZnVuY3Rpb24gTihhKXtpZihhLmRhdGEubGVuZ3RoPT0wKXJldHVybiB0cnVlO2lmKE8udGVzdChhLmRhdGEpKXJldHVybiBmYWxzZTtzd2l0Y2gocChhLnBhcmVudE5vZGUsIndoaXRlU3BhY2UiKSl7Y2FzZSJwcmUiOmNhc2UicHJlLXdyYXAiOmNhc2UiLW1vei1wcmUtd3JhcCI6cmV0dXJuIGZhbHNlO2Nhc2UicHJlLWxpbmUiOmlmKC9bXHJcbl0vLnRlc3QoYS5kYXRhKSlyZXR1cm4gZmFsc2V9cmV0dXJuIEUoYS5wcmV2aW91c1NpYmxpbmcpfHxFKGEubmV4dFNpYmxpbmcpfWZ1bmN0aW9uIG0oYSxiLGMsZCl7dmFyIGUsZj1jPT0wO2lmKGguaXNBbmNlc3Rvck9mKGIsYSkpdGhyb3cgci5jcmVhdGVFcnJvcigiZGVzY2VuZGFudCBpcyBhbmNlc3RvciBvZiBub2RlIik7aWYoaC5pc0NoYXJhY3RlckRhdGFOb2RlKGIpKWlmKGM9PTApe2M9aC5nZXROb2RlSW5kZXgoYik7Yj1iLnBhcmVudE5vZGV9ZWxzZSBpZihjPT1iLmxlbmd0aCl7Yz1oLmdldE5vZGVJbmRleChiKSsxO2I9Yi5wYXJlbnROb2RlfWVsc2UgdGhyb3cgci5jcmVhdGVFcnJvcigic3BsaXROb2RlQXQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgd2l0aCBvZmZzZXQgaW4gdGhlIG1pZGRsZSBvZiBhIGRhdGEgbm9kZSAoIitjKyIgaW4gIitiLmRhdGEpO3ZhciBnO2c9Yjt2YXIgaj1jO2c9aC5pc0NoYXJhY3RlckRhdGFOb2RlKGcpP2o9PTA/ISFnLnByZXZpb3VzU2libGluZzpqPT1nLmxlbmd0aD8hIWcubmV4dFNpYmxpbmc6dHJ1ZTpqPjAmJmo8Zy5jaGlsZE5vZGVzLmxlbmd0aDtpZihnKXtpZighZSl7ZT1iLmNsb25lTm9kZShmYWxzZSk7Zm9yKGUuaWQmJmUucmVtb3ZlQXR0cmlidXRlKCJpZCIpO2Y9Yi5jaGlsZE5vZGVzW2NdOyllLmFwcGVuZENoaWxkKGYpO2guaW5zZXJ0QWZ0ZXIoZSxiKX1yZXR1cm4gYj09YT9lOm0oYSxlLnBhcmVudE5vZGUsaC5nZXROb2RlSW5kZXgoZSksZCl9ZWxzZSBpZihhIT1iKXtlPWIucGFyZW50Tm9kZTtiPWguZ2V0Tm9kZUluZGV4KGIpO2Z8fGIrKztyZXR1cm4gbShhLGUsYixkKX1yZXR1cm4gYX1mdW5jdGlvbiBGKGEpe3ZhciBiPWE/Im5leHRTaWJsaW5nIjoicHJldmlvdXNTaWJsaW5nIjtyZXR1cm4gZnVuY3Rpb24oYyxkKXt2YXIgZT1jLnBhcmVudE5vZGUsZj1jW2JdO2lmKGYpe2lmKGYmJmYubm9kZVR5cGU9PTMpcmV0dXJuIGZ9ZWxzZSBpZihkKWlmKChmPWVbYl0pJiZmLm5vZGVUeXBlPT0xJiZlLnRhZ05hbWU9PWYudGFnTmFtZSYmdyhlLGYpJiZBKGUsZikpcmV0dXJuIGZbYT8iZmlyc3RDaGlsZCI6Imxhc3RDaGlsZCJdO3JldHVybiBudWxsfX1mdW5jdGlvbiB1KGEpe3RoaXMuZmlyc3RUZXh0Tm9kZT0odGhpcy5pc0VsZW1lbnRNZXJnZT1hLm5vZGVUeXBlPT0xKT9hLmxhc3RDaGlsZDphO3RoaXMudGV4dE5vZGVzPVt0aGlzLmZpcnN0VGV4dE5vZGVdfWZ1bmN0aW9uIHEoYSxiLGMpe3RoaXMuY3NzQ2xhc3M9YTt2YXIgZCxlLGY9bnVsbDtpZih0eXBlb2YgYj09Im9iamVjdCImJmIhPT1udWxsKXtjPWIudGFnTmFtZXM7Zj1iLmVsZW1lbnRQcm9wZXJ0aWVzO2ZvcihkPTA7ZT1QW2QrK107KWlmKGIuaGFzT3duUHJvcGVydHkoZSkpdGhpc1tlXT1iW2VdO2Q9Yi5ub3JtYWxpemV9ZWxzZSBkPWI7dGhpcy5ub3JtYWxpemU9dHlwZW9mIGQ9PSJ1bmRlZmluZWQiP3RydWU6ZDt0aGlzLmF0dHJFeGNlcHRpb25zPVtdO2Q9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0aGlzLmVsZW1lbnRUYWdOYW1lKTt0aGlzLmVsZW1lbnRQcm9wZXJ0aWVzPXt9O2Zvcih2YXIgZyBpbiBmKWlmKGYuaGFzT3duUHJvcGVydHkoZykpe2lmKEcuaGFzT3duUHJvcGVydHkoZykpZz1HW2ddO2RbZ109ZltnXTt0aGlzLmVsZW1lbnRQcm9wZXJ0aWVzW2ddPWRbZ107dGhpcy5hdHRyRXhjZXB0aW9ucy5wdXNoKGcpfXRoaXMuZWxlbWVudFNvcnRlZENsYXNzTmFtZT10aGlzLmVsZW1lbnRQcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KCJjbGFzc05hbWUiKT9vKHRoaXMuZWxlbWVudFByb3BlcnRpZXMuY2xhc3NOYW1lKyIgIithKTphO3RoaXMuYXBwbHlUb0FueVRhZ05hbWU9ZmFsc2U7YT10eXBlb2YgYztpZihhPT0ic3RyaW5nIilpZihjPT0iKiIpdGhpcy5hcHBseVRvQW55VGFnTmFtZT10cnVlO2Vsc2UgdGhpcy50YWdOYW1lcz1jLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXlxzXHMqLywiIikucmVwbGFjZSgvXHNccyokLywiIikuc3BsaXQoL1xzKixccyovKTtlbHNlIGlmKGE9PSJvYmplY3QiJiZ0eXBlb2YgYy5sZW5ndGg9PSJudW1iZXIiKXt0aGlzLnRhZ05hbWVzPVtdO2Q9MDtmb3IoYT1jLmxlbmd0aDtkPGE7KytkKWlmKGNbZF09PSIqIil0aGlzLmFwcGx5VG9BbnlUYWdOYW1lPXRydWU7ZWxzZSB0aGlzLnRhZ05hbWVzLnB1c2goY1tkXS50b0xvd2VyQ2FzZSgpKX1lbHNlIHRoaXMudGFnTmFtZXM9W3RoaXMuZWxlbWVudFRhZ05hbWVdfWkucmVxdWlyZU1vZHVsZXMoWyJXcmFwcGVkU2VsZWN0aW9uIiwiV3JhcHBlZFJhbmdlIl0pO3ZhciBoPWkuZG9tLEg9ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGIsYyxkKXtyZXR1cm4gYyYmZD8iICI6IiJ9cmV0dXJuIGZ1bmN0aW9uKGIsYyl7aWYoYi5jbGFzc05hbWUpYi5jbGFzc05hbWU9Yi5jbGFzc05hbWUucmVwbGFjZShSZWdFeHAoIig/Ol58XFxzKSIrYysiKD86XFxzfCQpIiksYSl9fSgpLHA7aWYodHlwZW9mIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlIT0idW5kZWZpbmVkIilwPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGguZ2V0V2luZG93KGEpLmdldENvbXB1dGVkU3R5bGUoYSxudWxsKVtiXX07ZWxzZSBpZih0eXBlb2YgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmN1cnJlbnRTdHlsZSE9InVuZGVmaW5lZCIpcD1mdW5jdGlvbihhLGIpe3JldHVybiBhLmN1cnJlbnRTdHlsZVtiXX07ZWxzZSByLmZhaWwoIk5vIG1lYW5zIG9mIG9idGFpbmluZyBjb21wdXRlZCBzdHlsZSBwcm9wZXJ0aWVzIGZvdW5kIik7dmFyIGs7KGZ1bmN0aW9uKCl7az10eXBlb2YgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikuaXNDb250ZW50RWRpdGFibGU9PSJib29sZWFuIj9mdW5jdGlvbihhKXtyZXR1cm4gYSYmYS5ub2RlVHlwZT09MSYmYS5pc0NvbnRlbnRFZGl0YWJsZX06ZnVuY3Rpb24oYSl7aWYoIWF8fGEubm9kZVR5cGUhPTF8fGEuY29udGVudEVkaXRhYmxlPT0iZmFsc2UiKXJldHVybiBmYWxzZTtyZXR1cm4gYS5jb250ZW50RWRpdGFibGU9PSJ0cnVlInx8ayhhLnBhcmVudE5vZGUpfX0pKCk7dmFyIE09L15pbmxpbmUoLWJsb2NrfC10YWJsZSk/JC9pLE89L1teXHJcblx0XGYgXHUyMDBCXS8sUT1GKGZhbHNlKSxSPUYodHJ1ZSk7dS5wcm90b3R5cGU9e2RvTWVyZ2U6ZnVuY3Rpb24oKXtmb3IodmFyIGE9W10sYixjLGQ9MCxlPXRoaXMudGV4dE5vZGVzLmxlbmd0aDtkPGU7KytkKXtiPXRoaXMudGV4dE5vZGVzW2RdO2M9Yi5wYXJlbnROb2RlO2FbZF09Yi5kYXRhO2lmKGQpe2MucmVtb3ZlQ2hpbGQoYik7Yy5oYXNDaGlsZE5vZGVzKCl8fGMucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjKX19cmV0dXJuIHRoaXMuZmlyc3RUZXh0Tm9kZS5kYXRhPWE9YS5qb2luKCIiKX0sZ2V0TGVuZ3RoOmZ1bmN0aW9uKCl7Zm9yKHZhciBhPXRoaXMudGV4dE5vZGVzLmxlbmd0aCxiPTA7YS0tOyliKz10aGlzLnRleHROb2Rlc1thXS5sZW5ndGg7cmV0dXJuIGJ9LHRvU3RyaW5nOmZ1bmN0aW9uKCl7Zm9yKHZhciBhPVtdLGI9MCxjPXRoaXMudGV4dE5vZGVzLmxlbmd0aDtiPGM7KytiKWFbYl09IiciK3RoaXMudGV4dE5vZGVzW2JdLmRhdGErIiciO3JldHVybiJbTWVyZ2UoIithLmpvaW4oIiwiKSsiKV0ifX07dmFyIFA9WyJlbGVtZW50VGFnTmFtZSIsImlnbm9yZVdoaXRlU3BhY2UiLCJhcHBseVRvRWRpdGFibGVPbmx5Il0sRz17ImNsYXNzIjoiY2xhc3NOYW1lIn07cS5wcm90b3R5cGU9e2VsZW1lbnRUYWdOYW1lOiJzcGFuIixlbGVtZW50UHJvcGVydGllczp7fSxpZ25vcmVXaGl0ZVNwYWNlOnRydWUsYXBwbHlUb0VkaXRhYmxlT25seTpmYWxzZSxoYXNDbGFzczpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlVHlwZT09MSYmaC5hcnJheUNvbnRhaW5zKHRoaXMudGFnTmFtZXMsYS50YWdOYW1lLnRvTG93ZXJDYXNlKCkpJiZzKGEsdGhpcy5jc3NDbGFzcyl9LGdldFNlbGZPckFuY2VzdG9yV2l0aENsYXNzOmZ1bmN0aW9uKGEpe2Zvcig7YTspe2lmKHRoaXMuaGFzQ2xhc3MoYSx0aGlzLmNzc0NsYXNzKSlyZXR1cm4gYTthPWEucGFyZW50Tm9kZX1yZXR1cm4gbnVsbH0saXNNb2RpZmlhYmxlOmZ1bmN0aW9uKGEpe3JldHVybiF0aGlzLmFwcGx5VG9FZGl0YWJsZU9ubHl8fEQoYSl9LGlzSWdub3JhYmxlV2hpdGVTcGFjZU5vZGU6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuaWdub3JlV2hpdGVTcGFjZSYmYSYmYS5ub2RlVHlwZT09MyYmTihhKX0scG9zdEFwcGx5OmZ1bmN0aW9uKGEsYixjKXtmb3IodmFyIGQ9YVswXSxlPWFbYS5sZW5ndGgtMV0sZj1bXSxnLGo9ZCxJPWUsSj0wLEs9ZS5sZW5ndGgsbixMLGw9MCx2PWEubGVuZ3RoO2w8djsrK2wpe249YVtsXTtpZihMPVEobiwhYykpe2lmKCFnKXtnPW5ldyB1KEwpO2YucHVzaChnKX1nLnRleHROb2Rlcy5wdXNoKG4pO2lmKG49PT1kKXtqPWcuZmlyc3RUZXh0Tm9kZTtKPWoubGVuZ3RofWlmKG49PT1lKXtJPWcuZmlyc3RUZXh0Tm9kZTtLPWcuZ2V0TGVuZ3RoKCl9fWVsc2UgZz1udWxsfWlmKGE9UihlLCFjKSl7aWYoIWcpe2c9bmV3IHUoZSk7Zi5wdXNoKGcpfWcudGV4dE5vZGVzLnB1c2goYSl9aWYoZi5sZW5ndGgpe2w9MDtmb3Iodj1mLmxlbmd0aDtsPHY7KytsKWZbbF0uZG9NZXJnZSgpO2Iuc2V0U3RhcnQoaixKKTtiLnNldEVuZChJLEspfX0sY3JlYXRlQ29udGFpbmVyOmZ1bmN0aW9uKGEpe2E9YS5jcmVhdGVFbGVtZW50KHRoaXMuZWxlbWVudFRhZ05hbWUpO2kudXRpbC5leHRlbmQoYSx0aGlzLmVsZW1lbnRQcm9wZXJ0aWVzKTt0KGEsdGhpcy5jc3NDbGFzcyk7cmV0dXJuIGF9LGFwcGx5VG9UZXh0Tm9kZTpmdW5jdGlvbihhKXt2YXIgYj1hLnBhcmVudE5vZGU7aWYoYi5jaGlsZE5vZGVzLmxlbmd0aD09MSYmaC5hcnJheUNvbnRhaW5zKHRoaXMudGFnTmFtZXMsYi50YWdOYW1lLnRvTG93ZXJDYXNlKCkpKXQoYix0aGlzLmNzc0NsYXNzKTtlbHNle2I9dGhpcy5jcmVhdGVDb250YWluZXIoaC5nZXREb2N1bWVudChhKSk7YS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShiLGEpO2IuYXBwZW5kQ2hpbGQoYSl9fSxpc1JlbW92YWJsZTpmdW5jdGlvbihhKXt2YXIgYjtpZihiPWEudGFnTmFtZS50b0xvd2VyQ2FzZSgpPT10aGlzLmVsZW1lbnRUYWdOYW1lKXtpZihiPW8oYS5jbGFzc05hbWUpPT10aGlzLmVsZW1lbnRTb3J0ZWRDbGFzc05hbWUpe3ZhciBjO2E6e2I9dGhpcy5lbGVtZW50UHJvcGVydGllcztmb3IoYyBpbiBiKWlmKGIuaGFzT3duUHJvcGVydHkoYykmJmFbY10hPT1iW2NdKXtjPWZhbHNlO2JyZWFrIGF9Yz10cnVlfWI9YyYmIUIoYSx0aGlzLmF0dHJFeGNlcHRpb25zKSYmdGhpcy5pc01vZGlmaWFibGUoYSl9Yj1ifXJldHVybiBifSx1bmRvVG9UZXh0Tm9kZTpmdW5jdGlvbihhLGIsYyl7aWYoIWIuY29udGFpbnNOb2RlKGMpKXthPWIuY2xvbmVSYW5nZSgpO2Euc2VsZWN0Tm9kZShjKTtpZihhLmlzUG9pbnRJblJhbmdlKGIuZW5kQ29udGFpbmVyLGIuZW5kT2Zmc2V0KSl7bShjLGIuZW5kQ29udGFpbmVyLGIuZW5kT2Zmc2V0LFtiXSk7Yi5zZXRFbmRBZnRlcihjKX1pZihhLmlzUG9pbnRJblJhbmdlKGIuc3RhcnRDb250YWluZXIsYi5zdGFydE9mZnNldCkpYz1tKGMsYi5zdGFydENvbnRhaW5lcixiLnN0YXJ0T2Zmc2V0LFtiXSl9dGhpcy5pc1JlbW92YWJsZShjKT94KGMpOkgoYyx0aGlzLmNzc0NsYXNzKX0sYXBwbHlUb1JhbmdlOmZ1bmN0aW9uKGEpe2Euc3BsaXRCb3VuZGFyaWVzKCk7dmFyIGI9eihhKTtpZihiLmxlbmd0aCl7Zm9yKHZhciBjLGQ9MCxlPWIubGVuZ3RoO2Q8ZTsrK2Qpe2M9YltkXTshdGhpcy5pc0lnbm9yYWJsZVdoaXRlU3BhY2VOb2RlKGMpJiYhdGhpcy5nZXRTZWxmT3JBbmNlc3RvcldpdGhDbGFzcyhjKSYmdGhpcy5pc01vZGlmaWFibGUoYykmJnRoaXMuYXBwbHlUb1RleHROb2RlKGMpfWEuc2V0U3RhcnQoYlswXSwwKTtjPWJbYi5sZW5ndGgtMV07YS5zZXRFbmQoYyxjLmxlbmd0aCk7dGhpcy5ub3JtYWxpemUmJnRoaXMucG9zdEFwcGx5KGIsYSxmYWxzZSl9fSxhcHBseVRvU2VsZWN0aW9uOmZ1bmN0aW9uKGEpe2E9YXx8d2luZG93O2E9aS5nZXRTZWxlY3Rpb24oYSk7dmFyIGIsYz1hLmdldEFsbFJhbmdlcygpO2EucmVtb3ZlQWxsUmFuZ2VzKCk7Zm9yKHZhciBkPWMubGVuZ3RoO2QtLTspe2I9Y1tkXTt0aGlzLmFwcGx5VG9SYW5nZShiKTthLmFkZFJhbmdlKGIpfX0sdW5kb1RvUmFuZ2U6ZnVuY3Rpb24oYSl7YS5zcGxpdEJvdW5kYXJpZXMoKTt2YXIgYj16KGEpLGMsZCxlPWJbYi5sZW5ndGgtMV07aWYoYi5sZW5ndGgpe2Zvcih2YXIgZj0wLGc9Yi5sZW5ndGg7ZjxnOysrZil7Yz1iW2ZdOyhkPXRoaXMuZ2V0U2VsZk9yQW5jZXN0b3JXaXRoQ2xhc3MoYykpJiZ0aGlzLmlzTW9kaWZpYWJsZShjKSYmdGhpcy51bmRvVG9UZXh0Tm9kZShjLGEsZCk7YS5zZXRTdGFydChiWzBdLDApO2Euc2V0RW5kKGUsZS5sZW5ndGgpfXRoaXMubm9ybWFsaXplJiZ0aGlzLnBvc3RBcHBseShiLGEsdHJ1ZSl9fSx1bmRvVG9TZWxlY3Rpb246ZnVuY3Rpb24oYSl7YT1hfHx3aW5kb3c7YT1pLmdldFNlbGVjdGlvbihhKTt2YXIgYj1hLmdldEFsbFJhbmdlcygpLGM7YS5yZW1vdmVBbGxSYW5nZXMoKTtmb3IodmFyIGQ9MCxlPWIubGVuZ3RoO2Q8ZTsrK2Qpe2M9YltkXTt0aGlzLnVuZG9Ub1JhbmdlKGMpO2EuYWRkUmFuZ2UoYyl9fSxnZXRUZXh0U2VsZWN0ZWRCeVJhbmdlOmZ1bmN0aW9uKGEsYil7dmFyIGM9Yi5jbG9uZVJhbmdlKCk7Yy5zZWxlY3ROb2RlQ29udGVudHMoYSk7dmFyIGQ9Yy5pbnRlcnNlY3Rpb24oYik7ZD1kP2QudG9TdHJpbmcoKToiIjtjLmRldGFjaCgpO3JldHVybiBkfSxpc0FwcGxpZWRUb1JhbmdlOmZ1bmN0aW9uKGEpe2lmKGEuY29sbGFwc2VkKXJldHVybiEhdGhpcy5nZXRTZWxmT3JBbmNlc3RvcldpdGhDbGFzcyhhLmNvbW1vbkFuY2VzdG9yQ29udGFpbmVyKTtlbHNle2Zvcih2YXIgYj1hLmdldE5vZGVzKFszXSksYz0wLGQ7ZD1iW2MrK107KWlmKCF0aGlzLmlzSWdub3JhYmxlV2hpdGVTcGFjZU5vZGUoZCkmJnkoYSxkKSYmdGhpcy5pc01vZGlmaWFibGUoZCkmJiF0aGlzLmdldFNlbGZPckFuY2VzdG9yV2l0aENsYXNzKGQpKXJldHVybiBmYWxzZTtyZXR1cm4gdHJ1ZX19LGlzQXBwbGllZFRvU2VsZWN0aW9uOmZ1bmN0aW9uKGEpe2E9YXx8d2luZG93O2E9aS5nZXRTZWxlY3Rpb24oYSkuZ2V0QWxsUmFuZ2VzKCk7Zm9yKHZhciBiPWEubGVuZ3RoO2ItLTspaWYoIXRoaXMuaXNBcHBsaWVkVG9SYW5nZShhW2JdKSlyZXR1cm4gZmFsc2U7cmV0dXJuIHRydWV9LHRvZ2dsZVJhbmdlOmZ1bmN0aW9uKGEpe3RoaXMuaXNBcHBsaWVkVG9SYW5nZShhKT90aGlzLnVuZG9Ub1JhbmdlKGEpOnRoaXMuYXBwbHlUb1JhbmdlKGEpfSx0b2dnbGVTZWxlY3Rpb246ZnVuY3Rpb24oYSl7dGhpcy5pc0FwcGxpZWRUb1NlbGVjdGlvbihhKT90aGlzLnVuZG9Ub1NlbGVjdGlvbihhKTp0aGlzLmFwcGx5VG9TZWxlY3Rpb24oYSl9LGRldGFjaDpmdW5jdGlvbigpe319O3EudXRpbD17aGFzQ2xhc3M6cyxhZGRDbGFzczp0LHJlbW92ZUNsYXNzOkgsaGFzU2FtZUNsYXNzZXM6dyxyZXBsYWNlV2l0aE93bkNoaWxkcmVuOngsZWxlbWVudHNIYXZlU2FtZU5vbkNsYXNzQXR0cmlidXRlczpBLGVsZW1lbnRIYXNOb25DbGFzc0F0dHJpYnV0ZXM6QixzcGxpdE5vZGVBdDptLGlzRWRpdGFibGVFbGVtZW50OmssaXNFZGl0aW5nSG9zdDpDLGlzRWRpdGFibGU6RH07aS5Dc3NDbGFzc0FwcGxpZXI9cTtpLmNyZWF0ZUNzc0NsYXNzQXBwbGllcj1mdW5jdGlvbihhLGIsYyl7cmV0dXJuIG5ldyBxKGEsYixjKX19KTtyYW5neS5jcmVhdGVNb2R1bGUoIlNlcmlhbGl6ZXIiLGZ1bmN0aW9uKGcsbil7ZnVuY3Rpb24gbyhjLGEpe2E9YXx8W107dmFyIGI9Yy5ub2RlVHlwZSxlPWMuY2hpbGROb2RlcyxkPWUubGVuZ3RoLGY9W2IsYy5ub2RlTmFtZSxkXS5qb2luKCI6IiksaD0iIixrPSIiO3N3aXRjaChiKXtjYXNlIDM6aD1jLm5vZGVWYWx1ZS5yZXBsYWNlKC88L2csIiZsdDsiKS5yZXBsYWNlKC8+L2csIiZndDsiKTticmVhaztjYXNlIDg6aD0iPCEtLSIrYy5ub2RlVmFsdWUucmVwbGFjZSgvPC9nLCImbHQ7IikucmVwbGFjZSgvPi9nLCImZ3Q7IikrIi0tXD4iO2JyZWFrO2RlZmF1bHQ6aD0iPCIrZisiPiI7az0iPC8+IjticmVha31oJiZhLnB1c2goaCk7Zm9yKGI9MDtiPGQ7KytiKW8oZVtiXSxhKTtrJiZhLnB1c2goayk7cmV0dXJuIGF9ZnVuY3Rpb24gaihjKXtjPW8oYykuam9pbigiIik7cmV0dXJuIHUoYykudG9TdHJpbmcoMTYpfWZ1bmN0aW9uIGwoYyxhLGIpe3ZhciBlPVtdLGQ9Yztmb3IoYj1ifHxpLmdldERvY3VtZW50KGMpLmRvY3VtZW50RWxlbWVudDtkJiZkIT1iOyl7ZS5wdXNoKGkuZ2V0Tm9kZUluZGV4KGQsdHJ1ZSkpO2Q9ZC5wYXJlbnROb2RlfXJldHVybiBlLmpvaW4oIi8iKSsiOiIrYX1mdW5jdGlvbiBtKGMsYSxiKXtpZihhKWJ8fGkuZ2V0RG9jdW1lbnQoYSk7ZWxzZXtiPWJ8fGRvY3VtZW50O2E9Yi5kb2N1bWVudEVsZW1lbnR9Yz1jLnNwbGl0KCI6Iik7YT1hO2I9Y1swXT9jWzBdLnNwbGl0KCIvIik6W107Zm9yKHZhciBlPWIubGVuZ3RoLGQ7ZS0tOyl7ZD1wYXJzZUludChiW2VdLDEwKTtpZihkPGEuY2hpbGROb2Rlcy5sZW5ndGgpYT1hLmNoaWxkTm9kZXNbcGFyc2VJbnQoYltlXSwxMCldO2Vsc2UgdGhyb3cgbi5jcmVhdGVFcnJvcigiZGVzZXJpYWxpemVQb3NpdGlvbiBmYWlsZWQ6IG5vZGUgIitpLmluc3BlY3ROb2RlKGEpKyIgaGFzIG5vIGNoaWxkIHdpdGggaW5kZXggIitkKyIsICIrZSk7fXJldHVybiBuZXcgaS5Eb21Qb3NpdGlvbihhLHBhcnNlSW50KGNbMV0sMTApKX1mdW5jdGlvbiBwKGMsYSxiKXtiPWJ8fGcuRG9tUmFuZ2UuZ2V0UmFuZ2VEb2N1bWVudChjKS5kb2N1bWVudEVsZW1lbnQ7aWYoIWkuaXNBbmNlc3Rvck9mKGIsYy5jb21tb25BbmNlc3RvckNvbnRhaW5lcix0cnVlKSl0aHJvdyBFcnJvcigic2VyaWFsaXplUmFuZ2U6IHJhbmdlIGlzIG5vdCB3aG9sbHkgY29udGFpbmVkIHdpdGhpbiBzcGVjaWZpZWQgcm9vdCBub2RlIik7Yz1sKGMuc3RhcnRDb250YWluZXIsYy5zdGFydE9mZnNldCxiKSsiLCIrbChjLmVuZENvbnRhaW5lcixjLmVuZE9mZnNldCxiKTthfHwoYys9InsiK2ooYikrIn0iKTtyZXR1cm4gY31mdW5jdGlvbiBxKGMsYSxiKXtpZihhKWI9Ynx8aS5nZXREb2N1bWVudChhKTtlbHNle2I9Ynx8ZG9jdW1lbnQ7YT1iLmRvY3VtZW50RWxlbWVudH1jPS9eKFteLF0rKSwoW14sXHtdKykoeyhbXn1dKyl9KT8kLy5leGVjKGMpO3ZhciBlPWNbNF0sZD1qKGEpO2lmKGUmJmUhPT1qKGEpKXRocm93IEVycm9yKCJkZXNlcmlhbGl6ZVJhbmdlOiBjaGVja3N1bXMgb2Ygc2VyaWFsaXplZCByYW5nZSByb290IG5vZGUgKCIrCmUrIikgYW5kIHRhcmdldCByb290IG5vZGUgKCIrZCsiKSBkbyBub3QgbWF0Y2giKTtlPW0oY1sxXSxhLGIpO2E9bShjWzJdLGEsYik7Yj1nLmNyZWF0ZVJhbmdlKGIpO2Iuc2V0U3RhcnQoZS5ub2RlLGUub2Zmc2V0KTtiLnNldEVuZChhLm5vZGUsYS5vZmZzZXQpO3JldHVybiBifWZ1bmN0aW9uIHIoYyxhLGIpe2lmKGEpYnx8aS5nZXREb2N1bWVudChhKTtlbHNle2I9Ynx8ZG9jdW1lbnQ7YT1iLmRvY3VtZW50RWxlbWVudH1jPS9eKFteLF0rKSwoW14sXSspKHsoW159XSspfSk/JC8uZXhlYyhjKVszXTtyZXR1cm4hY3x8Yz09PWooYSl9ZnVuY3Rpb24gcyhjLGEsYil7Yz1jfHxnLmdldFNlbGVjdGlvbigpO2M9Yy5nZXRBbGxSYW5nZXMoKTtmb3IodmFyIGU9W10sZD0wLGY9Yy5sZW5ndGg7ZDxmOysrZCllW2RdPXAoY1tkXSxhLGIpO3JldHVybiBlLmpvaW4oInwiKX1mdW5jdGlvbiB0KGMsYSxiKXtpZihhKWI9Ynx8aS5nZXRXaW5kb3coYSk7ZWxzZXtiPWJ8fHdpbmRvdzthPWIuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50fWM9Yy5zcGxpdCgifCIpO2Zvcih2YXIgZT1nLmdldFNlbGVjdGlvbihiKSxkPVtdLGY9MCxoPWMubGVuZ3RoO2Y8aDsrK2YpZFtmXT1xKGNbZl0sYSxiLmRvY3VtZW50KTtlLnNldFJhbmdlcyhkKTtyZXR1cm4gZX1nLnJlcXVpcmVNb2R1bGVzKFsiV3JhcHBlZFNlbGVjdGlvbiIsIldyYXBwZWRSYW5nZSJdKTtpZih0eXBlb2YgZW5jb2RlVVJJQ29tcG9uZW50PT0idW5kZWZpbmVkInx8dHlwZW9mIGRlY29kZVVSSUNvbXBvbmVudD09InVuZGVmaW5lZCIpbi5mYWlsKCJHbG9iYWwgb2JqZWN0IGlzIG1pc3NpbmcgZW5jb2RlVVJJQ29tcG9uZW50IGFuZC9vciBkZWNvZGVVUklDb21wb25lbnQgbWV0aG9kIik7dmFyIHU9ZnVuY3Rpb24oKXt2YXIgYz1udWxsO3JldHVybiBmdW5jdGlvbihhKXtmb3IodmFyIGI9W10sZT0wLGQ9YS5sZW5ndGgsZjtlPGQ7KytlKXtmPWEuY2hhckNvZGVBdChlKTtpZihmPDEyOCliLnB1c2goZik7ZWxzZSBmPDIwNDg/Yi5wdXNoKGY+PjZ8MTkyLGYmNjN8MTI4KTpiLnB1c2goZj4+MTJ8MjI0LGY+PjYmNjN8MTI4LGYmNjN8MTI4KX1hPS0xO2lmKCFjKXtlPVtdO2Q9MDtmb3IodmFyIGg7ZDwyNTY7KytkKXtoPWQ7Zm9yKGY9ODtmLS07KWlmKChoJjEpPT0xKWg9aD4+PjFeMzk4ODI5MjM4NDtlbHNlIGg+Pj49MTtlW2RdPWg+Pj4wfWM9ZX1lPWM7ZD0wO2ZvcihmPWIubGVuZ3RoO2Q8ZjsrK2Qpe2g9KGFeYltkXSkmMjU1O2E9YT4+PjheZVtoXX1yZXR1cm4oYV4tMSk+Pj4wfX0oKSxpPWcuZG9tO2cuc2VyaWFsaXplUG9zaXRpb249bDtnLmRlc2VyaWFsaXplUG9zaXRpb249bTtnLnNlcmlhbGl6ZVJhbmdlPXA7Zy5kZXNlcmlhbGl6ZVJhbmdlPXE7Zy5jYW5EZXNlcmlhbGl6ZVJhbmdlPXI7Zy5zZXJpYWxpemVTZWxlY3Rpb249cztnLmRlc2VyaWFsaXplU2VsZWN0aW9uPXQ7Zy5jYW5EZXNlcmlhbGl6ZVNlbGVjdGlvbj1mdW5jdGlvbihjLGEsYil7dmFyIGU7aWYoYSllPWI/Yi5kb2N1bWVudDppLmdldERvY3VtZW50KGEpO2Vsc2V7Yj1ifHx3aW5kb3c7YT1iLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudH1jPWMuc3BsaXQoInwiKTtiPTA7Zm9yKHZhciBkPWMubGVuZ3RoO2I8ZDsrK2IpaWYoIXIoY1tiXSxhLGUpKXJldHVybiBmYWxzZTtyZXR1cm4gdHJ1ZX07Zy5yZXN0b3JlU2VsZWN0aW9uRnJvbUNvb2tpZT1mdW5jdGlvbihjKXtjPWN8fHdpbmRvdzt2YXIgYTthOnthPWMuZG9jdW1lbnQuY29va2llLnNwbGl0KC9bOyxdLyk7Zm9yKHZhciBiPTAsZT1hLmxlbmd0aCxkO2I8ZTsrK2Ipe2Q9YVtiXS5zcGxpdCgiPSIpO2lmKGRbMF0ucmVwbGFjZSgvXlxzKy8sIiIpPT0icmFuZ3lTZXJpYWxpemVkU2VsZWN0aW9uIilpZihkPWRbMV0pe2E9ZGVjb2RlVVJJQ29tcG9uZW50KGQucmVwbGFjZSgvXHMrJC8sIiIpKTticmVhayBhfX1hPW51bGx9YSYmdChhLGMuZG9jKX07Zy5zYXZlU2VsZWN0aW9uQ29va2llPWZ1bmN0aW9uKGMsYSl7Yz1jfHx3aW5kb3c7YT10eXBlb2YgYT09Im9iamVjdCI/YTp7fTt2YXIgYj1hLmV4cGlyZXM/IjtleHBpcmVzPSIrCmEuZXhwaXJlcy50b1VUQ1N0cmluZygpOiIiLGU9YS5wYXRoPyI7cGF0aD0iK2EucGF0aDoiIixkPWEuZG9tYWluPyI7ZG9tYWluPSIrYS5kb21haW46IiIsZj1hLnNlY3VyZT8iO3NlY3VyZSI6IiIsaD1zKGcuZ2V0U2VsZWN0aW9uKGMpKTtjLmRvY3VtZW50LmNvb2tpZT1lbmNvZGVVUklDb21wb25lbnQoInJhbmd5U2VyaWFsaXplZFNlbGVjdGlvbiIpKyI9IitlbmNvZGVVUklDb21wb25lbnQoaCkrYitlK2QrZn07Zy5nZXRFbGVtZW50Q2hlY2tzdW09an0pOyhmdW5jdGlvbih3aW5kb3csZG9jdW1lbnQsbG9jYXRpb24sc2V0VGltZW91dCxkZWNvZGVVUklDb21wb25lbnQsZW5jb2RlVVJJQ29tcG9uZW50KXt2YXIgZ2xvYmFsPXRoaXM7dmFyIGNoYW5uZWxJZD1NYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMTAwMDApO3ZhciBlbXB0eUZuPUZ1bmN0aW9uLnByb3RvdHlwZTt2YXIgcmVVUkk9L14oKGh0dHAuPzopXC9cLyhbXjpcL1xzXSspKDpcZCspKikvO3ZhciByZVBhcmVudD0vW1wtXHddK1wvXC5cLlwvLzt2YXIgcmVEb3VibGVTbGFzaD0vKFteOl0pXC9cLy9nO3ZhciBuYW1lc3BhY2U9IiI7dmFyIGVhc3lYRE09e307dmFyIF9lYXN5WERNPXdpbmRvdy5lYXN5WERNO3ZhciBJRlJBTUVfUFJFRklYPSJlYXN5WERNXyI7dmFyIEhBU19OQU1FX1BST1BFUlRZX0JVRzt2YXIgdXNlSGFzaD1mYWxzZTt2YXIgZmxhc2hWZXJzaW9uO3ZhciBIQVNfRkxBU0hfVEhST1RUTEVEX0JVRztmdW5jdGlvbiBpc0hvc3RNZXRob2Qob2JqZWN0LHByb3BlcnR5KXt2YXIgdD10eXBlb2Ygb2JqZWN0W3Byb3BlcnR5XTtyZXR1cm4gdD09J2Z1bmN0aW9uJ3x8KCEhKHQ9PSdvYmplY3QnJiZvYmplY3RbcHJvcGVydHldKSl8fHQ9PSd1bmtub3duJzt9CmZ1bmN0aW9uIGlzSG9zdE9iamVjdChvYmplY3QscHJvcGVydHkpe3JldHVybiEhKHR5cGVvZihvYmplY3RbcHJvcGVydHldKT09J29iamVjdCcmJm9iamVjdFtwcm9wZXJ0eV0pO30KZnVuY3Rpb24gaXNBcnJheShvKXtyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pPT09J1tvYmplY3QgQXJyYXldJzt9CmZ1bmN0aW9uIGhhc0ZsYXNoKCl7dHJ5e3ZhciBhY3RpdmVYPW5ldyBBY3RpdmVYT2JqZWN0KCJTaG9ja3dhdmVGbGFzaC5TaG9ja3dhdmVGbGFzaCIpO2ZsYXNoVmVyc2lvbj1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhY3RpdmVYLkdldFZhcmlhYmxlKCIkdmVyc2lvbiIpLm1hdGNoKC8oXGQrKSwoXGQrKSwoXGQrKSwoXGQrKS8pLDEpO0hBU19GTEFTSF9USFJPVFRMRURfQlVHPXBhcnNlSW50KGZsYXNoVmVyc2lvblswXSwxMCk+OSYmcGFyc2VJbnQoZmxhc2hWZXJzaW9uWzFdLDEwKT4wO2FjdGl2ZVg9bnVsbDtyZXR1cm4gdHJ1ZTt9CmNhdGNoKG5vdFN1cHBvcnRlZEV4Y2VwdGlvbil7cmV0dXJuIGZhbHNlO319CnZhciBvbix1bjtpZihpc0hvc3RNZXRob2Qod2luZG93LCJhZGRFdmVudExpc3RlbmVyIikpe29uPWZ1bmN0aW9uKHRhcmdldCx0eXBlLGxpc3RlbmVyKXt0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLGxpc3RlbmVyLGZhbHNlKTt9O3VuPWZ1bmN0aW9uKHRhcmdldCx0eXBlLGxpc3RlbmVyKXt0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLGxpc3RlbmVyLGZhbHNlKTt9O30KZWxzZSBpZihpc0hvc3RNZXRob2Qod2luZG93LCJhdHRhY2hFdmVudCIpKXtvbj1mdW5jdGlvbihvYmplY3Qsc0V2ZW50LGZwTm90aWZ5KXtvYmplY3QuYXR0YWNoRXZlbnQoIm9uIitzRXZlbnQsZnBOb3RpZnkpO307dW49ZnVuY3Rpb24ob2JqZWN0LHNFdmVudCxmcE5vdGlmeSl7b2JqZWN0LmRldGFjaEV2ZW50KCJvbiIrc0V2ZW50LGZwTm90aWZ5KTt9O30KZWxzZXt0aHJvdyBuZXcgRXJyb3IoIkJyb3dzZXIgbm90IHN1cHBvcnRlZCIpO30KdmFyIGRvbUlzUmVhZHk9ZmFsc2UsZG9tUmVhZHlRdWV1ZT1bXSxyZWFkeVN0YXRlO2lmKCJyZWFkeVN0YXRlImluIGRvY3VtZW50KXtyZWFkeVN0YXRlPWRvY3VtZW50LnJlYWR5U3RhdGU7ZG9tSXNSZWFkeT1yZWFkeVN0YXRlPT0iY29tcGxldGUifHwofm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQXBwbGVXZWJLaXQvJykmJihyZWFkeVN0YXRlPT0ibG9hZGVkInx8cmVhZHlTdGF0ZT09ImludGVyYWN0aXZlIikpO30KZWxzZXtkb21Jc1JlYWR5PSEhZG9jdW1lbnQuYm9keTt9CmZ1bmN0aW9uIGRvbV9vblJlYWR5KCl7aWYoZG9tSXNSZWFkeSl7cmV0dXJuO30KZG9tSXNSZWFkeT10cnVlO2Zvcih2YXIgaT0wO2k8ZG9tUmVhZHlRdWV1ZS5sZW5ndGg7aSsrKXtkb21SZWFkeVF1ZXVlW2ldKCk7fQpkb21SZWFkeVF1ZXVlLmxlbmd0aD0wO30KaWYoIWRvbUlzUmVhZHkpe2lmKGlzSG9zdE1ldGhvZCh3aW5kb3csImFkZEV2ZW50TGlzdGVuZXIiKSl7b24oZG9jdW1lbnQsIkRPTUNvbnRlbnRMb2FkZWQiLGRvbV9vblJlYWR5KTt9CmVsc2V7b24oZG9jdW1lbnQsInJlYWR5c3RhdGVjaGFuZ2UiLGZ1bmN0aW9uKCl7aWYoZG9jdW1lbnQucmVhZHlTdGF0ZT09ImNvbXBsZXRlIil7ZG9tX29uUmVhZHkoKTt9fSk7aWYoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsJiZ3aW5kb3c9PT10b3Ape3ZhciBkb1Njcm9sbENoZWNrPWZ1bmN0aW9uKCl7aWYoZG9tSXNSZWFkeSl7cmV0dXJuO30KdHJ5e2RvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCgibGVmdCIpO30KY2F0Y2goZSl7c2V0VGltZW91dChkb1Njcm9sbENoZWNrLDEpO3JldHVybjt9CmRvbV9vblJlYWR5KCk7fTtkb1Njcm9sbENoZWNrKCk7fX0Kb24od2luZG93LCJsb2FkIixkb21fb25SZWFkeSk7fQpmdW5jdGlvbiB3aGVuUmVhZHkoZm4sc2NvcGUpe2lmKGRvbUlzUmVhZHkpe2ZuLmNhbGwoc2NvcGUpO3JldHVybjt9CmRvbVJlYWR5UXVldWUucHVzaChmdW5jdGlvbigpe2ZuLmNhbGwoc2NvcGUpO30pO30KZnVuY3Rpb24gZ2V0UGFyZW50T2JqZWN0KCl7dmFyIG9iaj1wYXJlbnQ7aWYobmFtZXNwYWNlIT09IiIpe2Zvcih2YXIgaT0wLGlpPW5hbWVzcGFjZS5zcGxpdCgiLiIpO2k8aWkubGVuZ3RoO2krKyl7b2JqPW9ialtpaVtpXV07fX0KcmV0dXJuIG9iai5lYXN5WERNO30KZnVuY3Rpb24gbm9Db25mbGljdChucyl7d2luZG93LmVhc3lYRE09X2Vhc3lYRE07bmFtZXNwYWNlPW5zO2lmKG5hbWVzcGFjZSl7SUZSQU1FX1BSRUZJWD0iZWFzeVhETV8iK25hbWVzcGFjZS5yZXBsYWNlKCIuIiwiXyIpKyJfIjt9CnJldHVybiBlYXN5WERNO30KZnVuY3Rpb24gZ2V0RG9tYWluTmFtZSh1cmwpe3JldHVybiB1cmwubWF0Y2gocmVVUkkpWzNdO30KZnVuY3Rpb24gZ2V0UG9ydCh1cmwpe3JldHVybiB1cmwubWF0Y2gocmVVUkkpWzRdfHwiIjt9CmZ1bmN0aW9uIGdldExvY2F0aW9uKHVybCl7dmFyIG09dXJsLnRvTG93ZXJDYXNlKCkubWF0Y2gocmVVUkkpO3ZhciBwcm90bz1tWzJdLGRvbWFpbj1tWzNdLHBvcnQ9bVs0XXx8IiI7aWYoKHByb3RvPT0iaHR0cDoiJiZwb3J0PT0iOjgwIil8fChwcm90bz09Imh0dHBzOiImJnBvcnQ9PSI6NDQzIikpe3BvcnQ9IiI7fQpyZXR1cm4gcHJvdG8rIi8vIitkb21haW4rcG9ydDt9CmZ1bmN0aW9uIHJlc29sdmVVcmwodXJsKXt1cmw9dXJsLnJlcGxhY2UocmVEb3VibGVTbGFzaCwiJDEvIik7aWYoIXVybC5tYXRjaCgvXihodHRwfHxodHRwcyk6XC9cLy8pKXt2YXIgcGF0aD0odXJsLnN1YnN0cmluZygwLDEpPT09Ii8iKT8iIjpsb2NhdGlvbi5wYXRobmFtZTtpZihwYXRoLnN1YnN0cmluZyhwYXRoLmxlbmd0aC0xKSE9PSIvIil7cGF0aD1wYXRoLnN1YnN0cmluZygwLHBhdGgubGFzdEluZGV4T2YoIi8iKSsxKTt9CnVybD1sb2NhdGlvbi5wcm90b2NvbCsiLy8iK2xvY2F0aW9uLmhvc3QrcGF0aCt1cmw7fQp3aGlsZShyZVBhcmVudC50ZXN0KHVybCkpe3VybD11cmwucmVwbGFjZShyZVBhcmVudCwiIik7fQpyZXR1cm4gdXJsO30KZnVuY3Rpb24gYXBwZW5kUXVlcnlQYXJhbWV0ZXJzKHVybCxwYXJhbWV0ZXJzKXt2YXIgaGFzaD0iIixpbmRleE9mPXVybC5pbmRleE9mKCIjIik7aWYoaW5kZXhPZiE9PS0xKXtoYXNoPXVybC5zdWJzdHJpbmcoaW5kZXhPZik7dXJsPXVybC5zdWJzdHJpbmcoMCxpbmRleE9mKTt9CnZhciBxPVtdO2Zvcih2YXIga2V5IGluIHBhcmFtZXRlcnMpe2lmKHBhcmFtZXRlcnMuaGFzT3duUHJvcGVydHkoa2V5KSl7cS5wdXNoKGtleSsiPSIrZW5jb2RlVVJJQ29tcG9uZW50KHBhcmFtZXRlcnNba2V5XSkpO319CnJldHVybiB1cmwrKHVzZUhhc2g/IiMiOih1cmwuaW5kZXhPZigiPyIpPT0tMT8iPyI6IiYiKSkrcS5qb2luKCImIikraGFzaDt9CnZhciBxdWVyeT0oZnVuY3Rpb24oaW5wdXQpe2lucHV0PWlucHV0LnN1YnN0cmluZygxKS5zcGxpdCgiJiIpO3ZhciBkYXRhPXt9LHBhaXIsaT1pbnB1dC5sZW5ndGg7d2hpbGUoaS0tKXtwYWlyPWlucHV0W2ldLnNwbGl0KCI9Iik7ZGF0YVtwYWlyWzBdXT1kZWNvZGVVUklDb21wb25lbnQocGFpclsxXSk7fQpyZXR1cm4gZGF0YTt9KC94ZG1fZT0vLnRlc3QobG9jYXRpb24uc2VhcmNoKT9sb2NhdGlvbi5zZWFyY2g6bG9jYXRpb24uaGFzaCkpO2Z1bmN0aW9uIHVuZGVmKHYpe3JldHVybiB0eXBlb2Ygdj09PSJ1bmRlZmluZWQiO30KdmFyIGdldEpTT049ZnVuY3Rpb24oKXt2YXIgY2FjaGVkPXt9O3ZhciBvYmo9e2E6WzEsMiwzXX0sanNvbj0ie1wiYVwiOlsxLDIsM119IjtpZih0eXBlb2YgSlNPTiE9InVuZGVmaW5lZCImJnR5cGVvZiBKU09OLnN0cmluZ2lmeT09PSJmdW5jdGlvbiImJkpTT04uc3RyaW5naWZ5KG9iaikucmVwbGFjZSgoL1xzL2cpLCIiKT09PWpzb24pe3JldHVybiBKU09OO30KaWYoT2JqZWN0LnRvSlNPTil7aWYoT2JqZWN0LnRvSlNPTihvYmopLnJlcGxhY2UoKC9ccy9nKSwiIik9PT1qc29uKXtjYWNoZWQuc3RyaW5naWZ5PU9iamVjdC50b0pTT047fX0KaWYodHlwZW9mIFN0cmluZy5wcm90b3R5cGUuZXZhbEpTT049PT0iZnVuY3Rpb24iKXtvYmo9anNvbi5ldmFsSlNPTigpO2lmKG9iai5hJiZvYmouYS5sZW5ndGg9PT0zJiZvYmouYVsyXT09PTMpe2NhY2hlZC5wYXJzZT1mdW5jdGlvbihzdHIpe3JldHVybiBzdHIuZXZhbEpTT04oKTt9O319CmlmKGNhY2hlZC5zdHJpbmdpZnkmJmNhY2hlZC5wYXJzZSl7Z2V0SlNPTj1mdW5jdGlvbigpe3JldHVybiBjYWNoZWQ7fTtyZXR1cm4gY2FjaGVkO30KcmV0dXJuIG51bGw7fTtmdW5jdGlvbiBhcHBseShkZXN0aW5hdGlvbixzb3VyY2Usbm9PdmVyd3JpdGUpe3ZhciBtZW1iZXI7Zm9yKHZhciBwcm9wIGluIHNvdXJjZSl7aWYoc291cmNlLmhhc093blByb3BlcnR5KHByb3ApKXtpZihwcm9wIGluIGRlc3RpbmF0aW9uKXttZW1iZXI9c291cmNlW3Byb3BdO2lmKHR5cGVvZiBtZW1iZXI9PT0ib2JqZWN0Iil7YXBwbHkoZGVzdGluYXRpb25bcHJvcF0sbWVtYmVyLG5vT3ZlcndyaXRlKTt9CmVsc2UgaWYoIW5vT3ZlcndyaXRlKXtkZXN0aW5hdGlvbltwcm9wXT1zb3VyY2VbcHJvcF07fX0KZWxzZXtkZXN0aW5hdGlvbltwcm9wXT1zb3VyY2VbcHJvcF07fX19CnJldHVybiBkZXN0aW5hdGlvbjt9CmZ1bmN0aW9uIHRlc3RGb3JOYW1lUHJvcGVydHlCdWcoKXt2YXIgZm9ybT1kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImZvcm0iKSksaW5wdXQ9Zm9ybS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpKTtpbnB1dC5uYW1lPUlGUkFNRV9QUkVGSVgrIlRFU1QiK2NoYW5uZWxJZDtIQVNfTkFNRV9QUk9QRVJUWV9CVUc9aW5wdXQhPT1mb3JtLmVsZW1lbnRzW2lucHV0Lm5hbWVdO2RvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZm9ybSk7fQpmdW5jdGlvbiBjcmVhdGVGcmFtZShjb25maWcpe2lmKHVuZGVmKEhBU19OQU1FX1BST1BFUlRZX0JVRykpe3Rlc3RGb3JOYW1lUHJvcGVydHlCdWcoKTt9CnZhciBmcmFtZTtpZihIQVNfTkFNRV9QUk9QRVJUWV9CVUcpe2ZyYW1lPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIjxpZnJhbWUgbmFtZT1cIiIrY29uZmlnLnByb3BzLm5hbWUrIlwiLz4iKTt9CmVsc2V7ZnJhbWU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiSUZSQU1FIik7ZnJhbWUubmFtZT1jb25maWcucHJvcHMubmFtZTt9CmZyYW1lLmlkPWZyYW1lLm5hbWU9Y29uZmlnLnByb3BzLm5hbWU7ZGVsZXRlIGNvbmZpZy5wcm9wcy5uYW1lO2lmKGNvbmZpZy5vbkxvYWQpe29uKGZyYW1lLCJsb2FkIixjb25maWcub25Mb2FkKTt9CmlmKHR5cGVvZiBjb25maWcuY29udGFpbmVyPT0ic3RyaW5nIil7Y29uZmlnLmNvbnRhaW5lcj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb25maWcuY29udGFpbmVyKTt9CmlmKCFjb25maWcuY29udGFpbmVyKXthcHBseShmcmFtZS5zdHlsZSx7cG9zaXRpb246ImFic29sdXRlIix0b3A6Ii0yMDAwcHgifSk7Y29uZmlnLmNvbnRhaW5lcj1kb2N1bWVudC5ib2R5O30KdmFyIHNyYz1jb25maWcucHJvcHMuc3JjO2RlbGV0ZSBjb25maWcucHJvcHMuc3JjO2FwcGx5KGZyYW1lLGNvbmZpZy5wcm9wcyk7ZnJhbWUuYm9yZGVyPWZyYW1lLmZyYW1lQm9yZGVyPTA7ZnJhbWUuYWxsb3dUcmFuc3BhcmVuY3k9dHJ1ZTtjb25maWcuY29udGFpbmVyLmFwcGVuZENoaWxkKGZyYW1lKTtmcmFtZS5zcmM9c3JjO2NvbmZpZy5wcm9wcy5zcmM9c3JjO3JldHVybiBmcmFtZTt9CmZ1bmN0aW9uIGNoZWNrQWNsKGFjbCxkb21haW4pe2lmKHR5cGVvZiBhY2w9PSJzdHJpbmciKXthY2w9W2FjbF07fQp2YXIgcmUsaT1hY2wubGVuZ3RoO3doaWxlKGktLSl7cmU9YWNsW2ldO3JlPW5ldyBSZWdFeHAocmUuc3Vic3RyKDAsMSk9PSJeIj9yZTooIl4iK3JlLnJlcGxhY2UoLyhcKikvZywiLiQxIikucmVwbGFjZSgvXD8vZywiLiIpKyIkIikpO2lmKHJlLnRlc3QoZG9tYWluKSl7cmV0dXJuIHRydWU7fX0KcmV0dXJuIGZhbHNlO30KZnVuY3Rpb24gcHJlcGFyZVRyYW5zcG9ydFN0YWNrKGNvbmZpZyl7dmFyIHByb3RvY29sPWNvbmZpZy5wcm90b2NvbCxzdGFja0Vscztjb25maWcuaXNIb3N0PWNvbmZpZy5pc0hvc3R8fHVuZGVmKHF1ZXJ5LnhkbV9wKTt1c2VIYXNoPWNvbmZpZy5oYXNofHxmYWxzZTtpZighY29uZmlnLnByb3BzKXtjb25maWcucHJvcHM9e307fQppZighY29uZmlnLmlzSG9zdCl7Y29uZmlnLmNoYW5uZWw9cXVlcnkueGRtX2M7Y29uZmlnLnNlY3JldD1xdWVyeS54ZG1fcztjb25maWcucmVtb3RlPXF1ZXJ5LnhkbV9lO3Byb3RvY29sPXF1ZXJ5LnhkbV9wO2lmKGNvbmZpZy5hY2wmJiFjaGVja0FjbChjb25maWcuYWNsLGNvbmZpZy5yZW1vdGUpKXt0aHJvdyBuZXcgRXJyb3IoIkFjY2VzcyBkZW5pZWQgZm9yICIrY29uZmlnLnJlbW90ZSk7fX0KZWxzZXtjb25maWcucmVtb3RlPXJlc29sdmVVcmwoY29uZmlnLnJlbW90ZSk7Y29uZmlnLmNoYW5uZWw9Y29uZmlnLmNoYW5uZWx8fCJkZWZhdWx0IitjaGFubmVsSWQrKztjb25maWcuc2VjcmV0PU1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygyKTtpZih1bmRlZihwcm90b2NvbCkpe2lmKGdldExvY2F0aW9uKGxvY2F0aW9uLmhyZWYpPT1nZXRMb2NhdGlvbihjb25maWcucmVtb3RlKSl7cHJvdG9jb2w9IjQiO30KZWxzZSBpZihpc0hvc3RNZXRob2Qod2luZG93LCJwb3N0TWVzc2FnZSIpfHxpc0hvc3RNZXRob2QoZG9jdW1lbnQsInBvc3RNZXNzYWdlIikpe3Byb3RvY29sPSIxIjt9CmVsc2UgaWYoY29uZmlnLnN3ZiYmaXNIb3N0TWV0aG9kKHdpbmRvdywiQWN0aXZlWE9iamVjdCIpJiZoYXNGbGFzaCgpKXtwcm90b2NvbD0iNiI7fQplbHNlIGlmKG5hdmlnYXRvci5wcm9kdWN0PT09IkdlY2tvIiYmImZyYW1lRWxlbWVudCJpbiB3aW5kb3cmJm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignV2ViS2l0Jyk9PS0xKXtwcm90b2NvbD0iNSI7fQplbHNlIGlmKGNvbmZpZy5yZW1vdGVIZWxwZXIpe2NvbmZpZy5yZW1vdGVIZWxwZXI9cmVzb2x2ZVVybChjb25maWcucmVtb3RlSGVscGVyKTtwcm90b2NvbD0iMiI7fQplbHNle3Byb3RvY29sPSIwIjt9fX0KY29uZmlnLnByb3RvY29sPXByb3RvY29sO3N3aXRjaChwcm90b2NvbCl7Y2FzZSIwIjphcHBseShjb25maWcse2ludGVydmFsOjEwMCxkZWxheToyMDAwLHVzZVJlc2l6ZTp0cnVlLHVzZVBhcmVudDpmYWxzZSx1c2VQb2xsaW5nOmZhbHNlfSx0cnVlKTtpZihjb25maWcuaXNIb3N0KXtpZighY29uZmlnLmxvY2FsKXt2YXIgZG9tYWluPWxvY2F0aW9uLnByb3RvY29sKyIvLyIrbG9jYXRpb24uaG9zdCxpbWFnZXM9ZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW1nIiksaW1hZ2U7dmFyIGk9aW1hZ2VzLmxlbmd0aDt3aGlsZShpLS0pe2ltYWdlPWltYWdlc1tpXTtpZihpbWFnZS5zcmMuc3Vic3RyaW5nKDAsZG9tYWluLmxlbmd0aCk9PT1kb21haW4pe2NvbmZpZy5sb2NhbD1pbWFnZS5zcmM7YnJlYWs7fX0KaWYoIWNvbmZpZy5sb2NhbCl7Y29uZmlnLmxvY2FsPXdpbmRvdzt9fQp2YXIgcGFyYW1ldGVycz17eGRtX2M6Y29uZmlnLmNoYW5uZWwseGRtX3A6MH07aWYoY29uZmlnLmxvY2FsPT09d2luZG93KXtjb25maWcudXNlUG9sbGluZz10cnVlO2NvbmZpZy51c2VQYXJlbnQ9dHJ1ZTtjb25maWcubG9jYWw9bG9jYXRpb24ucHJvdG9jb2wrIi8vIitsb2NhdGlvbi5ob3N0K2xvY2F0aW9uLnBhdGhuYW1lK2xvY2F0aW9uLnNlYXJjaDtwYXJhbWV0ZXJzLnhkbV9lPWNvbmZpZy5sb2NhbDtwYXJhbWV0ZXJzLnhkbV9wYT0xO30KZWxzZXtwYXJhbWV0ZXJzLnhkbV9lPXJlc29sdmVVcmwoY29uZmlnLmxvY2FsKTt9CmlmKGNvbmZpZy5jb250YWluZXIpe2NvbmZpZy51c2VSZXNpemU9ZmFsc2U7cGFyYW1ldGVycy54ZG1fcG89MTt9CmNvbmZpZy5yZW1vdGU9YXBwZW5kUXVlcnlQYXJhbWV0ZXJzKGNvbmZpZy5yZW1vdGUscGFyYW1ldGVycyk7fQplbHNle2FwcGx5KGNvbmZpZyx7Y2hhbm5lbDpxdWVyeS54ZG1fYyxyZW1vdGU6cXVlcnkueGRtX2UsdXNlUGFyZW50OiF1bmRlZihxdWVyeS54ZG1fcGEpLHVzZVBvbGxpbmc6IXVuZGVmKHF1ZXJ5LnhkbV9wbyksdXNlUmVzaXplOmNvbmZpZy51c2VQYXJlbnQ/ZmFsc2U6Y29uZmlnLnVzZVJlc2l6ZX0pO30Kc3RhY2tFbHM9W25ldyBlYXN5WERNLnN0YWNrLkhhc2hUcmFuc3BvcnQoY29uZmlnKSxuZXcgZWFzeVhETS5zdGFjay5SZWxpYWJsZUJlaGF2aW9yKHt9KSxuZXcgZWFzeVhETS5zdGFjay5RdWV1ZUJlaGF2aW9yKHtlbmNvZGU6dHJ1ZSxtYXhMZW5ndGg6NDAwMC1jb25maWcucmVtb3RlLmxlbmd0aH0pLG5ldyBlYXN5WERNLnN0YWNrLlZlcmlmeUJlaGF2aW9yKHtpbml0aWF0ZTpjb25maWcuaXNIb3N0fSldO2JyZWFrO2Nhc2UiMSI6c3RhY2tFbHM9W25ldyBlYXN5WERNLnN0YWNrLlBvc3RNZXNzYWdlVHJhbnNwb3J0KGNvbmZpZyldO2JyZWFrO2Nhc2UiMiI6c3RhY2tFbHM9W25ldyBlYXN5WERNLnN0YWNrLk5hbWVUcmFuc3BvcnQoY29uZmlnKSxuZXcgZWFzeVhETS5zdGFjay5RdWV1ZUJlaGF2aW9yKCksbmV3IGVhc3lYRE0uc3RhY2suVmVyaWZ5QmVoYXZpb3Ioe2luaXRpYXRlOmNvbmZpZy5pc0hvc3R9KV07YnJlYWs7Y2FzZSIzIjpzdGFja0Vscz1bbmV3IGVhc3lYRE0uc3RhY2suTml4VHJhbnNwb3J0KGNvbmZpZyldO2JyZWFrO2Nhc2UiNCI6c3RhY2tFbHM9W25ldyBlYXN5WERNLnN0YWNrLlNhbWVPcmlnaW5UcmFuc3BvcnQoY29uZmlnKV07YnJlYWs7Y2FzZSI1IjpzdGFja0Vscz1bbmV3IGVhc3lYRE0uc3RhY2suRnJhbWVFbGVtZW50VHJhbnNwb3J0KGNvbmZpZyldO2JyZWFrO2Nhc2UiNiI6aWYoIWZsYXNoVmVyc2lvbil7aGFzRmxhc2goKTt9CnN0YWNrRWxzPVtuZXcgZWFzeVhETS5zdGFjay5GbGFzaFRyYW5zcG9ydChjb25maWcpXTticmVhazt9CnN0YWNrRWxzLnB1c2gobmV3IGVhc3lYRE0uc3RhY2suUXVldWVCZWhhdmlvcih7bGF6eTpjb25maWcubGF6eSxyZW1vdmU6dHJ1ZX0pKTtyZXR1cm4gc3RhY2tFbHM7fQpmdW5jdGlvbiBjaGFpblN0YWNrKHN0YWNrRWxlbWVudHMpe3ZhciBzdGFja0VsLGRlZmF1bHRzPXtpbmNvbWluZzpmdW5jdGlvbihtZXNzYWdlLG9yaWdpbil7dGhpcy51cC5pbmNvbWluZyhtZXNzYWdlLG9yaWdpbik7fSxvdXRnb2luZzpmdW5jdGlvbihtZXNzYWdlLHJlY2lwaWVudCl7dGhpcy5kb3duLm91dGdvaW5nKG1lc3NhZ2UscmVjaXBpZW50KTt9LGNhbGxiYWNrOmZ1bmN0aW9uKHN1Y2Nlc3Mpe3RoaXMudXAuY2FsbGJhY2soc3VjY2Vzcyk7fSxpbml0OmZ1bmN0aW9uKCl7dGhpcy5kb3duLmluaXQoKTt9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmRvd24uZGVzdHJveSgpO319O2Zvcih2YXIgaT0wLGxlbj1zdGFja0VsZW1lbnRzLmxlbmd0aDtpPGxlbjtpKyspe3N0YWNrRWw9c3RhY2tFbGVtZW50c1tpXTthcHBseShzdGFja0VsLGRlZmF1bHRzLHRydWUpO2lmKGkhPT0wKXtzdGFja0VsLmRvd249c3RhY2tFbGVtZW50c1tpLTFdO30KaWYoaSE9PWxlbi0xKXtzdGFja0VsLnVwPXN0YWNrRWxlbWVudHNbaSsxXTt9fQpyZXR1cm4gc3RhY2tFbDt9CmZ1bmN0aW9uIHJlbW92ZUZyb21TdGFjayhlbGVtZW50KXtlbGVtZW50LnVwLmRvd249ZWxlbWVudC5kb3duO2VsZW1lbnQuZG93bi51cD1lbGVtZW50LnVwO2VsZW1lbnQudXA9ZWxlbWVudC5kb3duPW51bGw7fQphcHBseShlYXN5WERNLHt2ZXJzaW9uOiIyLjQuMTUuMTE4IixxdWVyeTpxdWVyeSxzdGFjazp7fSxhcHBseTphcHBseSxnZXRKU09OT2JqZWN0OmdldEpTT04sd2hlblJlYWR5OndoZW5SZWFkeSxub0NvbmZsaWN0Om5vQ29uZmxpY3R9KTtlYXN5WERNLkRvbUhlbHBlcj17b246b24sdW46dW4scmVxdWlyZXNKU09OOmZ1bmN0aW9uKHBhdGgpe2lmKCFpc0hvc3RPYmplY3Qod2luZG93LCJKU09OIikpe2RvY3VtZW50LndyaXRlKCc8Jysnc2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgc3JjPSInK3BhdGgrJyI+PCcrJy9zY3JpcHQ+Jyk7fX19OyhmdW5jdGlvbigpe3ZhciBfbWFwPXt9O2Vhc3lYRE0uRm49e3NldDpmdW5jdGlvbihuYW1lLGZuKXtfbWFwW25hbWVdPWZuO30sZ2V0OmZ1bmN0aW9uKG5hbWUsZGVsKXt2YXIgZm49X21hcFtuYW1lXTtpZihkZWwpe2RlbGV0ZSBfbWFwW25hbWVdO30KcmV0dXJuIGZuO319O30oKSk7ZWFzeVhETS5Tb2NrZXQ9ZnVuY3Rpb24oY29uZmlnKXt2YXIgc3RhY2s9Y2hhaW5TdGFjayhwcmVwYXJlVHJhbnNwb3J0U3RhY2soY29uZmlnKS5jb25jYXQoW3tpbmNvbWluZzpmdW5jdGlvbihtZXNzYWdlLG9yaWdpbil7Y29uZmlnLm9uTWVzc2FnZShtZXNzYWdlLG9yaWdpbik7fSxjYWxsYmFjazpmdW5jdGlvbihzdWNjZXNzKXtpZihjb25maWcub25SZWFkeSl7Y29uZmlnLm9uUmVhZHkoc3VjY2Vzcyk7fX19XSkpLHJlY2lwaWVudD1nZXRMb2NhdGlvbihjb25maWcucmVtb3RlKTt0aGlzLm9yaWdpbj1nZXRMb2NhdGlvbihjb25maWcucmVtb3RlKTt0aGlzLmRlc3Ryb3k9ZnVuY3Rpb24oKXtzdGFjay5kZXN0cm95KCk7fTt0aGlzLnBvc3RNZXNzYWdlPWZ1bmN0aW9uKG1lc3NhZ2Upe3N0YWNrLm91dGdvaW5nKG1lc3NhZ2UscmVjaXBpZW50KTt9O3N0YWNrLmluaXQoKTt9O2Vhc3lYRE0uUnBjPWZ1bmN0aW9uKGNvbmZpZyxqc29uUnBjQ29uZmlnKXtpZihqc29uUnBjQ29uZmlnLmxvY2FsKXtmb3IodmFyIG1ldGhvZCBpbiBqc29uUnBjQ29uZmlnLmxvY2FsKXtpZihqc29uUnBjQ29uZmlnLmxvY2FsLmhhc093blByb3BlcnR5KG1ldGhvZCkpe3ZhciBtZW1iZXI9anNvblJwY0NvbmZpZy5sb2NhbFttZXRob2RdO2lmKHR5cGVvZiBtZW1iZXI9PT0iZnVuY3Rpb24iKXtqc29uUnBjQ29uZmlnLmxvY2FsW21ldGhvZF09e21ldGhvZDptZW1iZXJ9O319fX0KdmFyIHN0YWNrPWNoYWluU3RhY2socHJlcGFyZVRyYW5zcG9ydFN0YWNrKGNvbmZpZykuY29uY2F0KFtuZXcgZWFzeVhETS5zdGFjay5ScGNCZWhhdmlvcih0aGlzLGpzb25ScGNDb25maWcpLHtjYWxsYmFjazpmdW5jdGlvbihzdWNjZXNzKXtpZihjb25maWcub25SZWFkeSl7Y29uZmlnLm9uUmVhZHkoc3VjY2Vzcyk7fX19XSkpO3RoaXMub3JpZ2luPWdldExvY2F0aW9uKGNvbmZpZy5yZW1vdGUpO3RoaXMuZGVzdHJveT1mdW5jdGlvbigpe3N0YWNrLmRlc3Ryb3koKTt9O3N0YWNrLmluaXQoKTt9O2Vhc3lYRE0uc3RhY2suU2FtZU9yaWdpblRyYW5zcG9ydD1mdW5jdGlvbihjb25maWcpe3ZhciBwdWIsZnJhbWUsc2VuZCx0YXJnZXRPcmlnaW47cmV0dXJuKHB1Yj17b3V0Z29pbmc6ZnVuY3Rpb24obWVzc2FnZSxkb21haW4sZm4pe3NlbmQobWVzc2FnZSk7aWYoZm4pe2ZuKCk7fX0sZGVzdHJveTpmdW5jdGlvbigpe2lmKGZyYW1lKXtmcmFtZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGZyYW1lKTtmcmFtZT1udWxsO319LG9uRE9NUmVhZHk6ZnVuY3Rpb24oKXt0YXJnZXRPcmlnaW49Z2V0TG9jYXRpb24oY29uZmlnLnJlbW90ZSk7aWYoY29uZmlnLmlzSG9zdCl7YXBwbHkoY29uZmlnLnByb3BzLHtzcmM6YXBwZW5kUXVlcnlQYXJhbWV0ZXJzKGNvbmZpZy5yZW1vdGUse3hkbV9lOmxvY2F0aW9uLnByb3RvY29sKyIvLyIrbG9jYXRpb24uaG9zdCtsb2NhdGlvbi5wYXRobmFtZSx4ZG1fYzpjb25maWcuY2hhbm5lbCx4ZG1fcDo0fSksbmFtZTpJRlJBTUVfUFJFRklYK2NvbmZpZy5jaGFubmVsKyJfcHJvdmlkZXIifSk7ZnJhbWU9Y3JlYXRlRnJhbWUoY29uZmlnKTtlYXN5WERNLkZuLnNldChjb25maWcuY2hhbm5lbCxmdW5jdGlvbihzZW5kRm4pe3NlbmQ9c2VuZEZuO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtwdWIudXAuY2FsbGJhY2sodHJ1ZSk7fSwwKTtyZXR1cm4gZnVuY3Rpb24obXNnKXtwdWIudXAuaW5jb21pbmcobXNnLHRhcmdldE9yaWdpbik7fTt9KTt9CmVsc2V7c2VuZD1nZXRQYXJlbnRPYmplY3QoKS5Gbi5nZXQoY29uZmlnLmNoYW5uZWwsdHJ1ZSkoZnVuY3Rpb24obXNnKXtwdWIudXAuaW5jb21pbmcobXNnLHRhcmdldE9yaWdpbik7fSk7c2V0VGltZW91dChmdW5jdGlvbigpe3B1Yi51cC5jYWxsYmFjayh0cnVlKTt9LDApO319LGluaXQ6ZnVuY3Rpb24oKXt3aGVuUmVhZHkocHViLm9uRE9NUmVhZHkscHViKTt9fSk7fTtlYXN5WERNLnN0YWNrLkZsYXNoVHJhbnNwb3J0PWZ1bmN0aW9uKGNvbmZpZyl7dmFyIHB1YixmcmFtZSxzZW5kLHRhcmdldE9yaWdpbixzd2Ysc3dmQ29udGFpbmVyO2Z1bmN0aW9uIG9uTWVzc2FnZShtZXNzYWdlLG9yaWdpbil7c2V0VGltZW91dChmdW5jdGlvbigpe3B1Yi51cC5pbmNvbWluZyhtZXNzYWdlLHRhcmdldE9yaWdpbik7fSwwKTt9CmZ1bmN0aW9uIGFkZFN3Zihkb21haW4pe3ZhciB1cmw9Y29uZmlnLnN3ZisiP2hvc3Q9Iitjb25maWcuaXNIb3N0O3ZhciBpZD0iZWFzeVhETV9zd2ZfIitNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMTAwMDApO2Vhc3lYRE0uRm4uc2V0KCJmbGFzaF9sb2FkZWQiK2RvbWFpbi5yZXBsYWNlKC9bXC0uXS9nLCJfIiksZnVuY3Rpb24oKXtlYXN5WERNLnN0YWNrLkZsYXNoVHJhbnNwb3J0W2RvbWFpbl0uc3dmPXN3Zj1zd2ZDb250YWluZXIuZmlyc3RDaGlsZDt2YXIgcXVldWU9ZWFzeVhETS5zdGFjay5GbGFzaFRyYW5zcG9ydFtkb21haW5dLnF1ZXVlO2Zvcih2YXIgaT0wO2k8cXVldWUubGVuZ3RoO2krKyl7cXVldWVbaV0oKTt9CnF1ZXVlLmxlbmd0aD0wO30pO2lmKGNvbmZpZy5zd2ZDb250YWluZXIpe3N3ZkNvbnRhaW5lcj0odHlwZW9mIGNvbmZpZy5zd2ZDb250YWluZXI9PSJzdHJpbmciKT9kb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb25maWcuc3dmQ29udGFpbmVyKTpjb25maWcuc3dmQ29udGFpbmVyO30KZWxzZXtzd2ZDb250YWluZXI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7YXBwbHkoc3dmQ29udGFpbmVyLnN0eWxlLEhBU19GTEFTSF9USFJPVFRMRURfQlVHJiZjb25maWcuc3dmTm9UaHJvdHRsZT97aGVpZ2h0OiIyMHB4Iix3aWR0aDoiMjBweCIscG9zaXRpb246ImZpeGVkIixyaWdodDowLHRvcDowfTp7aGVpZ2h0OiIxcHgiLHdpZHRoOiIxcHgiLHBvc2l0aW9uOiJhYnNvbHV0ZSIsb3ZlcmZsb3c6ImhpZGRlbiIscmlnaHQ6MCx0b3A6MH0pO2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc3dmQ29udGFpbmVyKTt9CnZhciBmbGFzaFZhcnM9ImNhbGxiYWNrPWZsYXNoX2xvYWRlZCIrZG9tYWluLnJlcGxhY2UoL1tcLS5dL2csIl8iKSsiJnByb3RvPSIrZ2xvYmFsLmxvY2F0aW9uLnByb3RvY29sKyImZG9tYWluPSIrZ2V0RG9tYWluTmFtZShnbG9iYWwubG9jYXRpb24uaHJlZikrIiZwb3J0PSIrZ2V0UG9ydChnbG9iYWwubG9jYXRpb24uaHJlZikrIiZucz0iK25hbWVzcGFjZTtzd2ZDb250YWluZXIuaW5uZXJIVE1MPSI8b2JqZWN0IGhlaWdodD0nMjAnIHdpZHRoPScyMCcgdHlwZT0nYXBwbGljYXRpb24veC1zaG9ja3dhdmUtZmxhc2gnIGlkPSciK2lkKyInIGRhdGE9JyIrdXJsKyInPiIrIjxwYXJhbSBuYW1lPSdhbGxvd1NjcmlwdEFjY2VzcycgdmFsdWU9J2Fsd2F5cyc+PC9wYXJhbT4iKyI8cGFyYW0gbmFtZT0nd21vZGUnIHZhbHVlPSd0cmFuc3BhcmVudCc+IisiPHBhcmFtIG5hbWU9J21vdmllJyB2YWx1ZT0nIisKdXJsKyInPjwvcGFyYW0+IisiPHBhcmFtIG5hbWU9J2ZsYXNodmFycycgdmFsdWU9JyIrCmZsYXNoVmFycysiJz48L3BhcmFtPiIrIjxlbWJlZCB0eXBlPSdhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCcgRmxhc2hWYXJzPSciKwpmbGFzaFZhcnMrIicgYWxsb3dTY3JpcHRBY2Nlc3M9J2Fsd2F5cycgd21vZGU9J3RyYW5zcGFyZW50JyBzcmM9JyIrCnVybCsiJyBoZWlnaHQ9JzEnIHdpZHRoPScxJz48L2VtYmVkPiIrIjwvb2JqZWN0PiI7fQpyZXR1cm4ocHViPXtvdXRnb2luZzpmdW5jdGlvbihtZXNzYWdlLGRvbWFpbixmbil7c3dmLnBvc3RNZXNzYWdlKGNvbmZpZy5jaGFubmVsLG1lc3NhZ2UudG9TdHJpbmcoKSk7aWYoZm4pe2ZuKCk7fX0sZGVzdHJveTpmdW5jdGlvbigpe3RyeXtzd2YuZGVzdHJveUNoYW5uZWwoY29uZmlnLmNoYW5uZWwpO30KY2F0Y2goZSl7fQpzd2Y9bnVsbDtpZihmcmFtZSl7ZnJhbWUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChmcmFtZSk7ZnJhbWU9bnVsbDt9fSxvbkRPTVJlYWR5OmZ1bmN0aW9uKCl7dGFyZ2V0T3JpZ2luPWNvbmZpZy5yZW1vdGU7ZWFzeVhETS5Gbi5zZXQoImZsYXNoXyIrY29uZmlnLmNoYW5uZWwrIl9pbml0IixmdW5jdGlvbigpe3NldFRpbWVvdXQoZnVuY3Rpb24oKXtwdWIudXAuY2FsbGJhY2sodHJ1ZSk7fSk7fSk7ZWFzeVhETS5Gbi5zZXQoImZsYXNoXyIrY29uZmlnLmNoYW5uZWwrIl9vbk1lc3NhZ2UiLG9uTWVzc2FnZSk7Y29uZmlnLnN3Zj1yZXNvbHZlVXJsKGNvbmZpZy5zd2YpO3ZhciBzd2Zkb21haW49Z2V0RG9tYWluTmFtZShjb25maWcuc3dmKTt2YXIgZm49ZnVuY3Rpb24oKXtlYXN5WERNLnN0YWNrLkZsYXNoVHJhbnNwb3J0W3N3ZmRvbWFpbl0uaW5pdD10cnVlO3N3Zj1lYXN5WERNLnN0YWNrLkZsYXNoVHJhbnNwb3J0W3N3ZmRvbWFpbl0uc3dmO3N3Zi5jcmVhdGVDaGFubmVsKGNvbmZpZy5jaGFubmVsLGNvbmZpZy5zZWNyZXQsZ2V0TG9jYXRpb24oY29uZmlnLnJlbW90ZSksY29uZmlnLmlzSG9zdCk7aWYoY29uZmlnLmlzSG9zdCl7aWYoSEFTX0ZMQVNIX1RIUk9UVExFRF9CVUcmJmNvbmZpZy5zd2ZOb1Rocm90dGxlKXthcHBseShjb25maWcucHJvcHMse3Bvc2l0aW9uOiJmaXhlZCIscmlnaHQ6MCx0b3A6MCxoZWlnaHQ6IjIwcHgiLHdpZHRoOiIyMHB4In0pO30KYXBwbHkoY29uZmlnLnByb3BzLHtzcmM6YXBwZW5kUXVlcnlQYXJhbWV0ZXJzKGNvbmZpZy5yZW1vdGUse3hkbV9lOmdldExvY2F0aW9uKGxvY2F0aW9uLmhyZWYpLHhkbV9jOmNvbmZpZy5jaGFubmVsLHhkbV9wOjYseGRtX3M6Y29uZmlnLnNlY3JldH0pLG5hbWU6SUZSQU1FX1BSRUZJWCtjb25maWcuY2hhbm5lbCsiX3Byb3ZpZGVyIn0pO2ZyYW1lPWNyZWF0ZUZyYW1lKGNvbmZpZyk7fX07aWYoZWFzeVhETS5zdGFjay5GbGFzaFRyYW5zcG9ydFtzd2Zkb21haW5dJiZlYXN5WERNLnN0YWNrLkZsYXNoVHJhbnNwb3J0W3N3ZmRvbWFpbl0uaW5pdCl7Zm4oKTt9CmVsc2V7aWYoIWVhc3lYRE0uc3RhY2suRmxhc2hUcmFuc3BvcnRbc3dmZG9tYWluXSl7ZWFzeVhETS5zdGFjay5GbGFzaFRyYW5zcG9ydFtzd2Zkb21haW5dPXtxdWV1ZTpbZm5dfTthZGRTd2Yoc3dmZG9tYWluKTt9CmVsc2V7ZWFzeVhETS5zdGFjay5GbGFzaFRyYW5zcG9ydFtzd2Zkb21haW5dLnF1ZXVlLnB1c2goZm4pO319fSxpbml0OmZ1bmN0aW9uKCl7d2hlblJlYWR5KHB1Yi5vbkRPTVJlYWR5LHB1Yik7fX0pO307ZWFzeVhETS5zdGFjay5Qb3N0TWVzc2FnZVRyYW5zcG9ydD1mdW5jdGlvbihjb25maWcpe3ZhciBwdWIsZnJhbWUsY2FsbGVyV2luZG93LHRhcmdldE9yaWdpbjtmdW5jdGlvbiBfZ2V0T3JpZ2luKGV2ZW50KXtpZihldmVudC5vcmlnaW4pe3JldHVybiBnZXRMb2NhdGlvbihldmVudC5vcmlnaW4pO30KaWYoZXZlbnQudXJpKXtyZXR1cm4gZ2V0TG9jYXRpb24oZXZlbnQudXJpKTt9CmlmKGV2ZW50LmRvbWFpbil7cmV0dXJuIGxvY2F0aW9uLnByb3RvY29sKyIvLyIrZXZlbnQuZG9tYWluO30KdGhyb3ciVW5hYmxlIHRvIHJldHJpZXZlIHRoZSBvcmlnaW4gb2YgdGhlIGV2ZW50Ijt9CmZ1bmN0aW9uIF93aW5kb3dfb25NZXNzYWdlKGV2ZW50KXt2YXIgb3JpZ2luPV9nZXRPcmlnaW4oZXZlbnQpO2lmKG9yaWdpbj09dGFyZ2V0T3JpZ2luJiZldmVudC5kYXRhLnN1YnN0cmluZygwLGNvbmZpZy5jaGFubmVsLmxlbmd0aCsxKT09Y29uZmlnLmNoYW5uZWwrIiAiKXtwdWIudXAuaW5jb21pbmcoZXZlbnQuZGF0YS5zdWJzdHJpbmcoY29uZmlnLmNoYW5uZWwubGVuZ3RoKzEpLG9yaWdpbik7fX0KcmV0dXJuKHB1Yj17b3V0Z29pbmc6ZnVuY3Rpb24obWVzc2FnZSxkb21haW4sZm4pe2NhbGxlcldpbmRvdy5wb3N0TWVzc2FnZShjb25maWcuY2hhbm5lbCsiICIrbWVzc2FnZSxkb21haW58fHRhcmdldE9yaWdpbik7aWYoZm4pe2ZuKCk7fX0sZGVzdHJveTpmdW5jdGlvbigpe3VuKHdpbmRvdywibWVzc2FnZSIsX3dpbmRvd19vbk1lc3NhZ2UpO2lmKGZyYW1lKXtjYWxsZXJXaW5kb3c9bnVsbDtmcmFtZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGZyYW1lKTtmcmFtZT1udWxsO319LG9uRE9NUmVhZHk6ZnVuY3Rpb24oKXt0YXJnZXRPcmlnaW49Z2V0TG9jYXRpb24oY29uZmlnLnJlbW90ZSk7aWYoY29uZmlnLmlzSG9zdCl7dmFyIHdhaXRGb3JSZWFkeT1mdW5jdGlvbihldmVudCl7aWYoZXZlbnQuZGF0YT09Y29uZmlnLmNoYW5uZWwrIi1yZWFkeSIpe2NhbGxlcldpbmRvdz0oInBvc3RNZXNzYWdlImluIGZyYW1lLmNvbnRlbnRXaW5kb3cpP2ZyYW1lLmNvbnRlbnRXaW5kb3c6ZnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudDt1bih3aW5kb3csIm1lc3NhZ2UiLHdhaXRGb3JSZWFkeSk7b24od2luZG93LCJtZXNzYWdlIixfd2luZG93X29uTWVzc2FnZSk7c2V0VGltZW91dChmdW5jdGlvbigpe3B1Yi51cC5jYWxsYmFjayh0cnVlKTt9LDApO319O29uKHdpbmRvdywibWVzc2FnZSIsd2FpdEZvclJlYWR5KTthcHBseShjb25maWcucHJvcHMse3NyYzphcHBlbmRRdWVyeVBhcmFtZXRlcnMoY29uZmlnLnJlbW90ZSx7eGRtX2U6Z2V0TG9jYXRpb24obG9jYXRpb24uaHJlZikseGRtX2M6Y29uZmlnLmNoYW5uZWwseGRtX3A6MX0pLG5hbWU6SUZSQU1FX1BSRUZJWCtjb25maWcuY2hhbm5lbCsiX3Byb3ZpZGVyIn0pO2ZyYW1lPWNyZWF0ZUZyYW1lKGNvbmZpZyk7fQplbHNle29uKHdpbmRvdywibWVzc2FnZSIsX3dpbmRvd19vbk1lc3NhZ2UpO2NhbGxlcldpbmRvdz0oInBvc3RNZXNzYWdlImluIHdpbmRvdy5wYXJlbnQpP3dpbmRvdy5wYXJlbnQ6d2luZG93LnBhcmVudC5kb2N1bWVudDtjYWxsZXJXaW5kb3cucG9zdE1lc3NhZ2UoY29uZmlnLmNoYW5uZWwrIi1yZWFkeSIsdGFyZ2V0T3JpZ2luKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7cHViLnVwLmNhbGxiYWNrKHRydWUpO30sMCk7fX0saW5pdDpmdW5jdGlvbigpe3doZW5SZWFkeShwdWIub25ET01SZWFkeSxwdWIpO319KTt9O2Vhc3lYRE0uc3RhY2suRnJhbWVFbGVtZW50VHJhbnNwb3J0PWZ1bmN0aW9uKGNvbmZpZyl7dmFyIHB1YixmcmFtZSxzZW5kLHRhcmdldE9yaWdpbjtyZXR1cm4ocHViPXtvdXRnb2luZzpmdW5jdGlvbihtZXNzYWdlLGRvbWFpbixmbil7c2VuZC5jYWxsKHRoaXMsbWVzc2FnZSk7aWYoZm4pe2ZuKCk7fX0sZGVzdHJveTpmdW5jdGlvbigpe2lmKGZyYW1lKXtmcmFtZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGZyYW1lKTtmcmFtZT1udWxsO319LG9uRE9NUmVhZHk6ZnVuY3Rpb24oKXt0YXJnZXRPcmlnaW49Z2V0TG9jYXRpb24oY29uZmlnLnJlbW90ZSk7aWYoY29uZmlnLmlzSG9zdCl7YXBwbHkoY29uZmlnLnByb3BzLHtzcmM6YXBwZW5kUXVlcnlQYXJhbWV0ZXJzKGNvbmZpZy5yZW1vdGUse3hkbV9lOmdldExvY2F0aW9uKGxvY2F0aW9uLmhyZWYpLHhkbV9jOmNvbmZpZy5jaGFubmVsLHhkbV9wOjV9KSxuYW1lOklGUkFNRV9QUkVGSVgrY29uZmlnLmNoYW5uZWwrIl9wcm92aWRlciJ9KTtmcmFtZT1jcmVhdGVGcmFtZShjb25maWcpO2ZyYW1lLmZuPWZ1bmN0aW9uKHNlbmRGbil7ZGVsZXRlIGZyYW1lLmZuO3NlbmQ9c2VuZEZuO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtwdWIudXAuY2FsbGJhY2sodHJ1ZSk7fSwwKTtyZXR1cm4gZnVuY3Rpb24obXNnKXtwdWIudXAuaW5jb21pbmcobXNnLHRhcmdldE9yaWdpbik7fTt9O30KZWxzZXtpZihkb2N1bWVudC5yZWZlcnJlciYmZ2V0TG9jYXRpb24oZG9jdW1lbnQucmVmZXJyZXIpIT1xdWVyeS54ZG1fZSl7d2luZG93LnRvcC5sb2NhdGlvbj1xdWVyeS54ZG1fZTt9CnNlbmQ9d2luZG93LmZyYW1lRWxlbWVudC5mbihmdW5jdGlvbihtc2cpe3B1Yi51cC5pbmNvbWluZyhtc2csdGFyZ2V0T3JpZ2luKTt9KTtwdWIudXAuY2FsbGJhY2sodHJ1ZSk7fX0saW5pdDpmdW5jdGlvbigpe3doZW5SZWFkeShwdWIub25ET01SZWFkeSxwdWIpO319KTt9O2Vhc3lYRE0uc3RhY2suTmFtZVRyYW5zcG9ydD1mdW5jdGlvbihjb25maWcpe3ZhciBwdWI7dmFyIGlzSG9zdCxjYWxsZXJXaW5kb3cscmVtb3RlV2luZG93LHJlYWR5Q291bnQsY2FsbGJhY2sscmVtb3RlT3JpZ2luLHJlbW90ZVVybDtmdW5jdGlvbiBfc2VuZE1lc3NhZ2UobWVzc2FnZSl7dmFyIHVybD1jb25maWcucmVtb3RlSGVscGVyKyhpc0hvc3Q/IiNfMyI6IiNfMiIpK2NvbmZpZy5jaGFubmVsO2NhbGxlcldpbmRvdy5jb250ZW50V2luZG93LnNlbmRNZXNzYWdlKG1lc3NhZ2UsdXJsKTt9CmZ1bmN0aW9uIF9vblJlYWR5KCl7aWYoaXNIb3N0KXtpZigrK3JlYWR5Q291bnQ9PT0yfHwhaXNIb3N0KXtwdWIudXAuY2FsbGJhY2sodHJ1ZSk7fX0KZWxzZXtfc2VuZE1lc3NhZ2UoInJlYWR5Iik7cHViLnVwLmNhbGxiYWNrKHRydWUpO319CmZ1bmN0aW9uIF9vbk1lc3NhZ2UobWVzc2FnZSl7cHViLnVwLmluY29taW5nKG1lc3NhZ2UscmVtb3RlT3JpZ2luKTt9CmZ1bmN0aW9uIF9vbkxvYWQoKXtpZihjYWxsYmFjayl7c2V0VGltZW91dChmdW5jdGlvbigpe2NhbGxiYWNrKHRydWUpO30sMCk7fX0KcmV0dXJuKHB1Yj17b3V0Z29pbmc6ZnVuY3Rpb24obWVzc2FnZSxkb21haW4sZm4pe2NhbGxiYWNrPWZuO19zZW5kTWVzc2FnZShtZXNzYWdlKTt9LGRlc3Ryb3k6ZnVuY3Rpb24oKXtjYWxsZXJXaW5kb3cucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjYWxsZXJXaW5kb3cpO2NhbGxlcldpbmRvdz1udWxsO2lmKGlzSG9zdCl7cmVtb3RlV2luZG93LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocmVtb3RlV2luZG93KTtyZW1vdGVXaW5kb3c9bnVsbDt9fSxvbkRPTVJlYWR5OmZ1bmN0aW9uKCl7aXNIb3N0PWNvbmZpZy5pc0hvc3Q7cmVhZHlDb3VudD0wO3JlbW90ZU9yaWdpbj1nZXRMb2NhdGlvbihjb25maWcucmVtb3RlKTtjb25maWcubG9jYWw9cmVzb2x2ZVVybChjb25maWcubG9jYWwpO2lmKGlzSG9zdCl7ZWFzeVhETS5Gbi5zZXQoY29uZmlnLmNoYW5uZWwsZnVuY3Rpb24obWVzc2FnZSl7aWYoaXNIb3N0JiZtZXNzYWdlPT09InJlYWR5Iil7ZWFzeVhETS5Gbi5zZXQoY29uZmlnLmNoYW5uZWwsX29uTWVzc2FnZSk7X29uUmVhZHkoKTt9fSk7cmVtb3RlVXJsPWFwcGVuZFF1ZXJ5UGFyYW1ldGVycyhjb25maWcucmVtb3RlLHt4ZG1fZTpjb25maWcubG9jYWwseGRtX2M6Y29uZmlnLmNoYW5uZWwseGRtX3A6Mn0pO2FwcGx5KGNvbmZpZy5wcm9wcyx7c3JjOnJlbW90ZVVybCsnIycrY29uZmlnLmNoYW5uZWwsbmFtZTpJRlJBTUVfUFJFRklYK2NvbmZpZy5jaGFubmVsKyJfcHJvdmlkZXIifSk7cmVtb3RlV2luZG93PWNyZWF0ZUZyYW1lKGNvbmZpZyk7fQplbHNle2NvbmZpZy5yZW1vdGVIZWxwZXI9Y29uZmlnLnJlbW90ZTtlYXN5WERNLkZuLnNldChjb25maWcuY2hhbm5lbCxfb25NZXNzYWdlKTt9CmNhbGxlcldpbmRvdz1jcmVhdGVGcmFtZSh7cHJvcHM6e3NyYzpjb25maWcubG9jYWwrIiNfNCIrY29uZmlnLmNoYW5uZWx9LG9uTG9hZDpmdW5jdGlvbiBvbkxvYWQoKXt2YXIgdz1jYWxsZXJXaW5kb3d8fHRoaXM7dW4odywibG9hZCIsb25Mb2FkKTtlYXN5WERNLkZuLnNldChjb25maWcuY2hhbm5lbCsiX2xvYWQiLF9vbkxvYWQpOyhmdW5jdGlvbiB0ZXN0KCl7aWYodHlwZW9mIHcuY29udGVudFdpbmRvdy5zZW5kTWVzc2FnZT09ImZ1bmN0aW9uIil7X29uUmVhZHkoKTt9CmVsc2V7c2V0VGltZW91dCh0ZXN0LDUwKTt9fSgpKTt9fSk7fSxpbml0OmZ1bmN0aW9uKCl7d2hlblJlYWR5KHB1Yi5vbkRPTVJlYWR5LHB1Yik7fX0pO307ZWFzeVhETS5zdGFjay5IYXNoVHJhbnNwb3J0PWZ1bmN0aW9uKGNvbmZpZyl7dmFyIHB1Yjt2YXIgbWU9dGhpcyxpc0hvc3QsX3RpbWVyLHBvbGxJbnRlcnZhbCxfbGFzdE1zZyxfbXNnTnIsX2xpc3RlbmVyV2luZG93LF9jYWxsZXJXaW5kb3c7dmFyIHVzZVBhcmVudCxfcmVtb3RlT3JpZ2luO2Z1bmN0aW9uIF9zZW5kTWVzc2FnZShtZXNzYWdlKXtpZighX2NhbGxlcldpbmRvdyl7cmV0dXJuO30KdmFyIHVybD1jb25maWcucmVtb3RlKyIjIisoX21zZ05yKyspKyJfIittZXNzYWdlOygoaXNIb3N0fHwhdXNlUGFyZW50KT9fY2FsbGVyV2luZG93LmNvbnRlbnRXaW5kb3c6X2NhbGxlcldpbmRvdykubG9jYXRpb249dXJsO30KZnVuY3Rpb24gX2hhbmRsZUhhc2goaGFzaCl7X2xhc3RNc2c9aGFzaDtwdWIudXAuaW5jb21pbmcoX2xhc3RNc2cuc3Vic3RyaW5nKF9sYXN0TXNnLmluZGV4T2YoIl8iKSsxKSxfcmVtb3RlT3JpZ2luKTt9CmZ1bmN0aW9uIF9wb2xsSGFzaCgpe2lmKCFfbGlzdGVuZXJXaW5kb3cpe3JldHVybjt9CnZhciBocmVmPV9saXN0ZW5lcldpbmRvdy5sb2NhdGlvbi5ocmVmLGhhc2g9IiIsaW5kZXhPZj1ocmVmLmluZGV4T2YoIiMiKTtpZihpbmRleE9mIT0tMSl7aGFzaD1ocmVmLnN1YnN0cmluZyhpbmRleE9mKTt9CmlmKGhhc2gmJmhhc2ghPV9sYXN0TXNnKXtfaGFuZGxlSGFzaChoYXNoKTt9fQpmdW5jdGlvbiBfYXR0YWNoTGlzdGVuZXJzKCl7X3RpbWVyPXNldEludGVydmFsKF9wb2xsSGFzaCxwb2xsSW50ZXJ2YWwpO30KcmV0dXJuKHB1Yj17b3V0Z29pbmc6ZnVuY3Rpb24obWVzc2FnZSxkb21haW4pe19zZW5kTWVzc2FnZShtZXNzYWdlKTt9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt3aW5kb3cuY2xlYXJJbnRlcnZhbChfdGltZXIpO2lmKGlzSG9zdHx8IXVzZVBhcmVudCl7X2NhbGxlcldpbmRvdy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKF9jYWxsZXJXaW5kb3cpO30KX2NhbGxlcldpbmRvdz1udWxsO30sb25ET01SZWFkeTpmdW5jdGlvbigpe2lzSG9zdD1jb25maWcuaXNIb3N0O3BvbGxJbnRlcnZhbD1jb25maWcuaW50ZXJ2YWw7X2xhc3RNc2c9IiMiK2NvbmZpZy5jaGFubmVsO19tc2dOcj0wO3VzZVBhcmVudD1jb25maWcudXNlUGFyZW50O19yZW1vdGVPcmlnaW49Z2V0TG9jYXRpb24oY29uZmlnLnJlbW90ZSk7aWYoaXNIb3N0KXtjb25maWcucHJvcHM9e3NyYzpjb25maWcucmVtb3RlLG5hbWU6SUZSQU1FX1BSRUZJWCtjb25maWcuY2hhbm5lbCsiX3Byb3ZpZGVyIn07aWYodXNlUGFyZW50KXtjb25maWcub25Mb2FkPWZ1bmN0aW9uKCl7X2xpc3RlbmVyV2luZG93PXdpbmRvdztfYXR0YWNoTGlzdGVuZXJzKCk7cHViLnVwLmNhbGxiYWNrKHRydWUpO307fQplbHNle3ZhciB0cmllcz0wLG1heD1jb25maWcuZGVsYXkvNTA7KGZ1bmN0aW9uIGdldFJlZigpe2lmKCsrdHJpZXM+bWF4KXt0aHJvdyBuZXcgRXJyb3IoIlVuYWJsZSB0byByZWZlcmVuY2UgbGlzdGVuZXJ3aW5kb3ciKTt9CnRyeXtfbGlzdGVuZXJXaW5kb3c9X2NhbGxlcldpbmRvdy5jb250ZW50V2luZG93LmZyYW1lc1tJRlJBTUVfUFJFRklYK2NvbmZpZy5jaGFubmVsKyJfY29uc3VtZXIiXTt9CmNhdGNoKGV4KXt9CmlmKF9saXN0ZW5lcldpbmRvdyl7X2F0dGFjaExpc3RlbmVycygpO3B1Yi51cC5jYWxsYmFjayh0cnVlKTt9CmVsc2V7c2V0VGltZW91dChnZXRSZWYsNTApO319KCkpO30KX2NhbGxlcldpbmRvdz1jcmVhdGVGcmFtZShjb25maWcpO30KZWxzZXtfbGlzdGVuZXJXaW5kb3c9d2luZG93O19hdHRhY2hMaXN0ZW5lcnMoKTtpZih1c2VQYXJlbnQpe19jYWxsZXJXaW5kb3c9cGFyZW50O3B1Yi51cC5jYWxsYmFjayh0cnVlKTt9CmVsc2V7YXBwbHkoY29uZmlnLHtwcm9wczp7c3JjOmNvbmZpZy5yZW1vdGUrIiMiK2NvbmZpZy5jaGFubmVsK25ldyBEYXRlKCksbmFtZTpJRlJBTUVfUFJFRklYK2NvbmZpZy5jaGFubmVsKyJfY29uc3VtZXIifSxvbkxvYWQ6ZnVuY3Rpb24oKXtwdWIudXAuY2FsbGJhY2sodHJ1ZSk7fX0pO19jYWxsZXJXaW5kb3c9Y3JlYXRlRnJhbWUoY29uZmlnKTt9fX0saW5pdDpmdW5jdGlvbigpe3doZW5SZWFkeShwdWIub25ET01SZWFkeSxwdWIpO319KTt9O2Vhc3lYRE0uc3RhY2suUmVsaWFibGVCZWhhdmlvcj1mdW5jdGlvbihjb25maWcpe3ZhciBwdWIsY2FsbGJhY2s7dmFyIGlkT3V0PTAsaWRJbj0wLGN1cnJlbnRNZXNzYWdlPSIiO3JldHVybihwdWI9e2luY29taW5nOmZ1bmN0aW9uKG1lc3NhZ2Usb3JpZ2luKXt2YXIgaW5kZXhPZj1tZXNzYWdlLmluZGV4T2YoIl8iKSxhY2s9bWVzc2FnZS5zdWJzdHJpbmcoMCxpbmRleE9mKS5zcGxpdCgiLCIpO21lc3NhZ2U9bWVzc2FnZS5zdWJzdHJpbmcoaW5kZXhPZisxKTtpZihhY2tbMF09PWlkT3V0KXtjdXJyZW50TWVzc2FnZT0iIjtpZihjYWxsYmFjayl7Y2FsbGJhY2sodHJ1ZSk7fX0KaWYobWVzc2FnZS5sZW5ndGg+MCl7cHViLmRvd24ub3V0Z29pbmcoYWNrWzFdKyIsIitpZE91dCsiXyIrY3VycmVudE1lc3NhZ2Usb3JpZ2luKTtpZihpZEluIT1hY2tbMV0pe2lkSW49YWNrWzFdO3B1Yi51cC5pbmNvbWluZyhtZXNzYWdlLG9yaWdpbik7fX19LG91dGdvaW5nOmZ1bmN0aW9uKG1lc3NhZ2Usb3JpZ2luLGZuKXtjdXJyZW50TWVzc2FnZT1tZXNzYWdlO2NhbGxiYWNrPWZuO3B1Yi5kb3duLm91dGdvaW5nKGlkSW4rIiwiKygrK2lkT3V0KSsiXyIrbWVzc2FnZSxvcmlnaW4pO319KTt9O2Vhc3lYRE0uc3RhY2suUXVldWVCZWhhdmlvcj1mdW5jdGlvbihjb25maWcpe3ZhciBwdWIscXVldWU9W10sd2FpdGluZz10cnVlLGluY29taW5nPSIiLGRlc3Ryb3lpbmcsbWF4TGVuZ3RoPTAsbGF6eT1mYWxzZSxkb0ZyYWdtZW50PWZhbHNlO2Z1bmN0aW9uIGRpc3BhdGNoKCl7aWYoY29uZmlnLnJlbW92ZSYmcXVldWUubGVuZ3RoPT09MCl7cmVtb3ZlRnJvbVN0YWNrKHB1Yik7cmV0dXJuO30KaWYod2FpdGluZ3x8cXVldWUubGVuZ3RoPT09MHx8ZGVzdHJveWluZyl7cmV0dXJuO30Kd2FpdGluZz10cnVlO3ZhciBtZXNzYWdlPXF1ZXVlLnNoaWZ0KCk7cHViLmRvd24ub3V0Z29pbmcobWVzc2FnZS5kYXRhLG1lc3NhZ2Uub3JpZ2luLGZ1bmN0aW9uKHN1Y2Nlc3Mpe3dhaXRpbmc9ZmFsc2U7aWYobWVzc2FnZS5jYWxsYmFjayl7c2V0VGltZW91dChmdW5jdGlvbigpe21lc3NhZ2UuY2FsbGJhY2soc3VjY2Vzcyk7fSwwKTt9CmRpc3BhdGNoKCk7fSk7fQpyZXR1cm4ocHViPXtpbml0OmZ1bmN0aW9uKCl7aWYodW5kZWYoY29uZmlnKSl7Y29uZmlnPXt9O30KaWYoY29uZmlnLm1heExlbmd0aCl7bWF4TGVuZ3RoPWNvbmZpZy5tYXhMZW5ndGg7ZG9GcmFnbWVudD10cnVlO30KaWYoY29uZmlnLmxhenkpe2xhenk9dHJ1ZTt9CmVsc2V7cHViLmRvd24uaW5pdCgpO319LGNhbGxiYWNrOmZ1bmN0aW9uKHN1Y2Nlc3Mpe3dhaXRpbmc9ZmFsc2U7dmFyIHVwPXB1Yi51cDtkaXNwYXRjaCgpO3VwLmNhbGxiYWNrKHN1Y2Nlc3MpO30saW5jb21pbmc6ZnVuY3Rpb24obWVzc2FnZSxvcmlnaW4pe2lmKGRvRnJhZ21lbnQpe3ZhciBpbmRleE9mPW1lc3NhZ2UuaW5kZXhPZigiXyIpLHNlcT1wYXJzZUludChtZXNzYWdlLnN1YnN0cmluZygwLGluZGV4T2YpLDEwKTtpbmNvbWluZys9bWVzc2FnZS5zdWJzdHJpbmcoaW5kZXhPZisxKTtpZihzZXE9PT0wKXtpZihjb25maWcuZW5jb2RlKXtpbmNvbWluZz1kZWNvZGVVUklDb21wb25lbnQoaW5jb21pbmcpO30KcHViLnVwLmluY29taW5nKGluY29taW5nLG9yaWdpbik7aW5jb21pbmc9IiI7fX0KZWxzZXtwdWIudXAuaW5jb21pbmcobWVzc2FnZSxvcmlnaW4pO319LG91dGdvaW5nOmZ1bmN0aW9uKG1lc3NhZ2Usb3JpZ2luLGZuKXtpZihjb25maWcuZW5jb2RlKXttZXNzYWdlPWVuY29kZVVSSUNvbXBvbmVudChtZXNzYWdlKTt9CnZhciBmcmFnbWVudHM9W10sZnJhZ21lbnQ7aWYoZG9GcmFnbWVudCl7d2hpbGUobWVzc2FnZS5sZW5ndGghPT0wKXtmcmFnbWVudD1tZXNzYWdlLnN1YnN0cmluZygwLG1heExlbmd0aCk7bWVzc2FnZT1tZXNzYWdlLnN1YnN0cmluZyhmcmFnbWVudC5sZW5ndGgpO2ZyYWdtZW50cy5wdXNoKGZyYWdtZW50KTt9CndoaWxlKChmcmFnbWVudD1mcmFnbWVudHMuc2hpZnQoKSkpe3F1ZXVlLnB1c2goe2RhdGE6ZnJhZ21lbnRzLmxlbmd0aCsiXyIrZnJhZ21lbnQsb3JpZ2luOm9yaWdpbixjYWxsYmFjazpmcmFnbWVudHMubGVuZ3RoPT09MD9mbjpudWxsfSk7fX0KZWxzZXtxdWV1ZS5wdXNoKHtkYXRhOm1lc3NhZ2Usb3JpZ2luOm9yaWdpbixjYWxsYmFjazpmbn0pO30KaWYobGF6eSl7cHViLmRvd24uaW5pdCgpO30KZWxzZXtkaXNwYXRjaCgpO319LGRlc3Ryb3k6ZnVuY3Rpb24oKXtkZXN0cm95aW5nPXRydWU7cHViLmRvd24uZGVzdHJveSgpO319KTt9O2Vhc3lYRE0uc3RhY2suVmVyaWZ5QmVoYXZpb3I9ZnVuY3Rpb24oY29uZmlnKXt2YXIgcHViLG15U2VjcmV0LHRoZWlyU2VjcmV0LHZlcmlmaWVkPWZhbHNlO2Z1bmN0aW9uIHN0YXJ0VmVyaWZpY2F0aW9uKCl7bXlTZWNyZXQ9TWF0aC5yYW5kb20oKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDIpO3B1Yi5kb3duLm91dGdvaW5nKG15U2VjcmV0KTt9CnJldHVybihwdWI9e2luY29taW5nOmZ1bmN0aW9uKG1lc3NhZ2Usb3JpZ2luKXt2YXIgaW5kZXhPZj1tZXNzYWdlLmluZGV4T2YoIl8iKTtpZihpbmRleE9mPT09LTEpe2lmKG1lc3NhZ2U9PT1teVNlY3JldCl7cHViLnVwLmNhbGxiYWNrKHRydWUpO30KZWxzZSBpZighdGhlaXJTZWNyZXQpe3RoZWlyU2VjcmV0PW1lc3NhZ2U7aWYoIWNvbmZpZy5pbml0aWF0ZSl7c3RhcnRWZXJpZmljYXRpb24oKTt9CnB1Yi5kb3duLm91dGdvaW5nKG1lc3NhZ2UpO319CmVsc2V7aWYobWVzc2FnZS5zdWJzdHJpbmcoMCxpbmRleE9mKT09PXRoZWlyU2VjcmV0KXtwdWIudXAuaW5jb21pbmcobWVzc2FnZS5zdWJzdHJpbmcoaW5kZXhPZisxKSxvcmlnaW4pO319fSxvdXRnb2luZzpmdW5jdGlvbihtZXNzYWdlLG9yaWdpbixmbil7cHViLmRvd24ub3V0Z29pbmcobXlTZWNyZXQrIl8iK21lc3NhZ2Usb3JpZ2luLGZuKTt9LGNhbGxiYWNrOmZ1bmN0aW9uKHN1Y2Nlc3Mpe2lmKGNvbmZpZy5pbml0aWF0ZSl7c3RhcnRWZXJpZmljYXRpb24oKTt9fX0pO307ZWFzeVhETS5zdGFjay5ScGNCZWhhdmlvcj1mdW5jdGlvbihwcm94eSxjb25maWcpe3ZhciBwdWIsc2VyaWFsaXplcj1jb25maWcuc2VyaWFsaXplcnx8Z2V0SlNPTigpO3ZhciBfY2FsbGJhY2tDb3VudGVyPTAsX2NhbGxiYWNrcz17fTtmdW5jdGlvbiBfc2VuZChkYXRhKXtkYXRhLmpzb25ycGM9IjIuMCI7cHViLmRvd24ub3V0Z29pbmcoc2VyaWFsaXplci5zdHJpbmdpZnkoZGF0YSkpO30KZnVuY3Rpb24gX2NyZWF0ZU1ldGhvZChkZWZpbml0aW9uLG1ldGhvZCl7dmFyIHNsaWNlPUFycmF5LnByb3RvdHlwZS5zbGljZTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgbD1hcmd1bWVudHMubGVuZ3RoLGNhbGxiYWNrLG1lc3NhZ2U9e21ldGhvZDptZXRob2R9O2lmKGw+MCYmdHlwZW9mIGFyZ3VtZW50c1tsLTFdPT09ImZ1bmN0aW9uIil7aWYobD4xJiZ0eXBlb2YgYXJndW1lbnRzW2wtMl09PT0iZnVuY3Rpb24iKXtjYWxsYmFjaz17c3VjY2Vzczphcmd1bWVudHNbbC0yXSxlcnJvcjphcmd1bWVudHNbbC0xXX07bWVzc2FnZS5wYXJhbXM9c2xpY2UuY2FsbChhcmd1bWVudHMsMCxsLTIpO30KZWxzZXtjYWxsYmFjaz17c3VjY2Vzczphcmd1bWVudHNbbC0xXX07bWVzc2FnZS5wYXJhbXM9c2xpY2UuY2FsbChhcmd1bWVudHMsMCxsLTEpO30KX2NhbGxiYWNrc1siIisoKytfY2FsbGJhY2tDb3VudGVyKV09Y2FsbGJhY2s7bWVzc2FnZS5pZD1fY2FsbGJhY2tDb3VudGVyO30KZWxzZXttZXNzYWdlLnBhcmFtcz1zbGljZS5jYWxsKGFyZ3VtZW50cywwKTt9CmlmKGRlZmluaXRpb24ubmFtZWRQYXJhbXMmJm1lc3NhZ2UucGFyYW1zLmxlbmd0aD09PTEpe21lc3NhZ2UucGFyYW1zPW1lc3NhZ2UucGFyYW1zWzBdO30KX3NlbmQobWVzc2FnZSk7fTt9CmZ1bmN0aW9uIF9leGVjdXRlTWV0aG9kKG1ldGhvZCxpZCxmbixwYXJhbXMpe2lmKCFmbil7aWYoaWQpe19zZW5kKHtpZDppZCxlcnJvcjp7Y29kZTotMzI2MDEsbWVzc2FnZToiUHJvY2VkdXJlIG5vdCBmb3VuZC4ifX0pO30KcmV0dXJuO30KdmFyIHN1Y2Nlc3MsZXJyb3I7aWYoaWQpe3N1Y2Nlc3M9ZnVuY3Rpb24ocmVzdWx0KXtzdWNjZXNzPWVtcHR5Rm47X3NlbmQoe2lkOmlkLHJlc3VsdDpyZXN1bHR9KTt9O2Vycm9yPWZ1bmN0aW9uKG1lc3NhZ2UsZGF0YSl7ZXJyb3I9ZW1wdHlGbjt2YXIgbXNnPXtpZDppZCxlcnJvcjp7Y29kZTotMzIwOTksbWVzc2FnZTptZXNzYWdlfX07aWYoZGF0YSl7bXNnLmVycm9yLmRhdGE9ZGF0YTt9Cl9zZW5kKG1zZyk7fTt9CmVsc2V7c3VjY2Vzcz1lcnJvcj1lbXB0eUZuO30KaWYoIWlzQXJyYXkocGFyYW1zKSl7cGFyYW1zPVtwYXJhbXNdO30KdHJ5e3ZhciByZXN1bHQ9Zm4ubWV0aG9kLmFwcGx5KGZuLnNjb3BlLHBhcmFtcy5jb25jYXQoW3N1Y2Nlc3MsZXJyb3JdKSk7aWYoIXVuZGVmKHJlc3VsdCkpe3N1Y2Nlc3MocmVzdWx0KTt9fQpjYXRjaChleDEpe2Vycm9yKGV4MS5tZXNzYWdlKTt9fQpyZXR1cm4ocHViPXtpbmNvbWluZzpmdW5jdGlvbihtZXNzYWdlLG9yaWdpbil7dmFyIGRhdGE9c2VyaWFsaXplci5wYXJzZShtZXNzYWdlKTtpZihkYXRhLm1ldGhvZCl7aWYoY29uZmlnLmhhbmRsZSl7Y29uZmlnLmhhbmRsZShkYXRhLF9zZW5kKTt9CmVsc2V7X2V4ZWN1dGVNZXRob2QoZGF0YS5tZXRob2QsZGF0YS5pZCxjb25maWcubG9jYWxbZGF0YS5tZXRob2RdLGRhdGEucGFyYW1zKTt9fQplbHNle3ZhciBjYWxsYmFjaz1fY2FsbGJhY2tzW2RhdGEuaWRdO2lmKGRhdGEuZXJyb3Ipe2lmKGNhbGxiYWNrLmVycm9yKXtjYWxsYmFjay5lcnJvcihkYXRhLmVycm9yKTt9fQplbHNlIGlmKGNhbGxiYWNrLnN1Y2Nlc3Mpe2NhbGxiYWNrLnN1Y2Nlc3MoZGF0YS5yZXN1bHQpO30KZGVsZXRlIF9jYWxsYmFja3NbZGF0YS5pZF07fX0saW5pdDpmdW5jdGlvbigpe2lmKGNvbmZpZy5yZW1vdGUpe2Zvcih2YXIgbWV0aG9kIGluIGNvbmZpZy5yZW1vdGUpe2lmKGNvbmZpZy5yZW1vdGUuaGFzT3duUHJvcGVydHkobWV0aG9kKSl7cHJveHlbbWV0aG9kXT1fY3JlYXRlTWV0aG9kKGNvbmZpZy5yZW1vdGVbbWV0aG9kXSxtZXRob2QpO319fQpwdWIuZG93bi5pbml0KCk7fSxkZXN0cm95OmZ1bmN0aW9uKCl7Zm9yKHZhciBtZXRob2QgaW4gY29uZmlnLnJlbW90ZSl7aWYoY29uZmlnLnJlbW90ZS5oYXNPd25Qcm9wZXJ0eShtZXRob2QpJiZwcm94eS5oYXNPd25Qcm9wZXJ0eShtZXRob2QpKXtkZWxldGUgcHJveHlbbWV0aG9kXTt9fQpwdWIuZG93bi5kZXN0cm95KCk7fX0pO307Z2xvYmFsLmVhc3lYRE09ZWFzeVhETTt9KSh3aW5kb3csZG9jdW1lbnQsbG9jYXRpb24sd2luZG93LnNldFRpbWVvdXQsZGVjb2RlVVJJQ29tcG9uZW50LGVuY29kZVVSSUNvbXBvbmVudCk7dmFyIGhleGNhc2U9MDt2YXIgYjY0cGFkPSIiO2Z1bmN0aW9uIGhleF9tZDUocyl7cmV0dXJuIHJzdHIyaGV4KHJzdHJfbWQ1KHN0cjJyc3RyX3V0ZjgocykpKTt9CmZ1bmN0aW9uIGI2NF9tZDUocyl7cmV0dXJuIHJzdHIyYjY0KHJzdHJfbWQ1KHN0cjJyc3RyX3V0ZjgocykpKTt9CmZ1bmN0aW9uIGFueV9tZDUocyxlKXtyZXR1cm4gcnN0cjJhbnkocnN0cl9tZDUoc3RyMnJzdHJfdXRmOChzKSksZSk7fQpmdW5jdGlvbiBoZXhfaG1hY19tZDUoayxkKQp7cmV0dXJuIHJzdHIyaGV4KHJzdHJfaG1hY19tZDUoc3RyMnJzdHJfdXRmOChrKSxzdHIycnN0cl91dGY4KGQpKSk7fQpmdW5jdGlvbiBiNjRfaG1hY19tZDUoayxkKQp7cmV0dXJuIHJzdHIyYjY0KHJzdHJfaG1hY19tZDUoc3RyMnJzdHJfdXRmOChrKSxzdHIycnN0cl91dGY4KGQpKSk7fQpmdW5jdGlvbiBhbnlfaG1hY19tZDUoayxkLGUpCntyZXR1cm4gcnN0cjJhbnkocnN0cl9obWFjX21kNShzdHIycnN0cl91dGY4KGspLHN0cjJyc3RyX3V0ZjgoZCkpLGUpO30KZnVuY3Rpb24gbWQ1X3ZtX3Rlc3QoKQp7cmV0dXJuIGhleF9tZDUoImFiYyIpLnRvTG93ZXJDYXNlKCk9PSI5MDAxNTA5ODNjZDI0ZmIwZDY5NjNmN2QyOGUxN2Y3MiI7fQpmdW5jdGlvbiByc3RyX21kNShzKQp7cmV0dXJuIGJpbmwycnN0cihiaW5sX21kNShyc3RyMmJpbmwocykscy5sZW5ndGgqOCkpO30KZnVuY3Rpb24gcnN0cl9obWFjX21kNShrZXksZGF0YSkKe3ZhciBia2V5PXJzdHIyYmlubChrZXkpO2lmKGJrZXkubGVuZ3RoPjE2KWJrZXk9YmlubF9tZDUoYmtleSxrZXkubGVuZ3RoKjgpO3ZhciBpcGFkPUFycmF5KDE2KSxvcGFkPUFycmF5KDE2KTtmb3IodmFyIGk9MDtpPDE2O2krKykKe2lwYWRbaV09YmtleVtpXV4weDM2MzYzNjM2O29wYWRbaV09YmtleVtpXV4weDVDNUM1QzVDO30KdmFyIGhhc2g9YmlubF9tZDUoaXBhZC5jb25jYXQocnN0cjJiaW5sKGRhdGEpKSw1MTIrZGF0YS5sZW5ndGgqOCk7cmV0dXJuIGJpbmwycnN0cihiaW5sX21kNShvcGFkLmNvbmNhdChoYXNoKSw1MTIrMTI4KSk7fQpmdW5jdGlvbiByc3RyMmhleChpbnB1dCkKe3RyeXtoZXhjYXNlfWNhdGNoKGUpe2hleGNhc2U9MDt9CnZhciBoZXhfdGFiPWhleGNhc2U/IjAxMjM0NTY3ODlBQkNERUYiOiIwMTIzNDU2Nzg5YWJjZGVmIjt2YXIgb3V0cHV0PSIiO3ZhciB4O2Zvcih2YXIgaT0wO2k8aW5wdXQubGVuZ3RoO2krKykKe3g9aW5wdXQuY2hhckNvZGVBdChpKTtvdXRwdXQrPWhleF90YWIuY2hhckF0KCh4Pj4+NCkmMHgwRikKK2hleF90YWIuY2hhckF0KHgmMHgwRik7fQpyZXR1cm4gb3V0cHV0O30KZnVuY3Rpb24gcnN0cjJiNjQoaW5wdXQpCnt0cnl7YjY0cGFkfWNhdGNoKGUpe2I2NHBhZD0nJzt9CnZhciB0YWI9IkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8iO3ZhciBvdXRwdXQ9IiI7dmFyIGxlbj1pbnB1dC5sZW5ndGg7Zm9yKHZhciBpPTA7aTxsZW47aSs9MykKe3ZhciB0cmlwbGV0PShpbnB1dC5jaGFyQ29kZUF0KGkpPDwxNil8KGkrMTxsZW4/aW5wdXQuY2hhckNvZGVBdChpKzEpPDw4OjApfChpKzI8bGVuP2lucHV0LmNoYXJDb2RlQXQoaSsyKTowKTtmb3IodmFyIGo9MDtqPDQ7aisrKQp7aWYoaSo4K2oqNj5pbnB1dC5sZW5ndGgqOClvdXRwdXQrPWI2NHBhZDtlbHNlIG91dHB1dCs9dGFiLmNoYXJBdCgodHJpcGxldD4+PjYqKDMtaikpJjB4M0YpO319CnJldHVybiBvdXRwdXQ7fQpmdW5jdGlvbiByc3RyMmFueShpbnB1dCxlbmNvZGluZykKe3ZhciBkaXZpc29yPWVuY29kaW5nLmxlbmd0aDt2YXIgaSxqLHEseCxxdW90aWVudDt2YXIgZGl2aWRlbmQ9QXJyYXkoTWF0aC5jZWlsKGlucHV0Lmxlbmd0aC8yKSk7Zm9yKGk9MDtpPGRpdmlkZW5kLmxlbmd0aDtpKyspCntkaXZpZGVuZFtpXT0oaW5wdXQuY2hhckNvZGVBdChpKjIpPDw4KXxpbnB1dC5jaGFyQ29kZUF0KGkqMisxKTt9CnZhciBmdWxsX2xlbmd0aD1NYXRoLmNlaWwoaW5wdXQubGVuZ3RoKjgvKE1hdGgubG9nKGVuY29kaW5nLmxlbmd0aCkvTWF0aC5sb2coMikpKTt2YXIgcmVtYWluZGVycz1BcnJheShmdWxsX2xlbmd0aCk7Zm9yKGo9MDtqPGZ1bGxfbGVuZ3RoO2orKykKe3F1b3RpZW50PUFycmF5KCk7eD0wO2ZvcihpPTA7aTxkaXZpZGVuZC5sZW5ndGg7aSsrKQp7eD0oeDw8MTYpK2RpdmlkZW5kW2ldO3E9TWF0aC5mbG9vcih4L2Rpdmlzb3IpO3gtPXEqZGl2aXNvcjtpZihxdW90aWVudC5sZW5ndGg+MHx8cT4wKQpxdW90aWVudFtxdW90aWVudC5sZW5ndGhdPXE7fQpyZW1haW5kZXJzW2pdPXg7ZGl2aWRlbmQ9cXVvdGllbnQ7fQp2YXIgb3V0cHV0PSIiO2ZvcihpPXJlbWFpbmRlcnMubGVuZ3RoLTE7aT49MDtpLS0pCm91dHB1dCs9ZW5jb2RpbmcuY2hhckF0KHJlbWFpbmRlcnNbaV0pO3JldHVybiBvdXRwdXQ7fQpmdW5jdGlvbiBzdHIycnN0cl91dGY4KGlucHV0KQp7dmFyIG91dHB1dD0iIjt2YXIgaT0tMTt2YXIgeCx5O3doaWxlKCsraTxpbnB1dC5sZW5ndGgpCnt4PWlucHV0LmNoYXJDb2RlQXQoaSk7eT1pKzE8aW5wdXQubGVuZ3RoP2lucHV0LmNoYXJDb2RlQXQoaSsxKTowO2lmKDB4RDgwMDw9eCYmeDw9MHhEQkZGJiYweERDMDA8PXkmJnk8PTB4REZGRikKe3g9MHgxMDAwMCsoKHgmMHgwM0ZGKTw8MTApKyh5JjB4MDNGRik7aSsrO30KaWYoeDw9MHg3RikKb3V0cHV0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlKHgpO2Vsc2UgaWYoeDw9MHg3RkYpCm91dHB1dCs9U3RyaW5nLmZyb21DaGFyQ29kZSgweEMwfCgoeD4+PjYpJjB4MUYpLDB4ODB8KHgmMHgzRikpO2Vsc2UgaWYoeDw9MHhGRkZGKQpvdXRwdXQrPVN0cmluZy5mcm9tQ2hhckNvZGUoMHhFMHwoKHg+Pj4xMikmMHgwRiksMHg4MHwoKHg+Pj42KSYweDNGKSwweDgwfCh4JjB4M0YpKTtlbHNlIGlmKHg8PTB4MUZGRkZGKQpvdXRwdXQrPVN0cmluZy5mcm9tQ2hhckNvZGUoMHhGMHwoKHg+Pj4xOCkmMHgwNyksMHg4MHwoKHg+Pj4xMikmMHgzRiksMHg4MHwoKHg+Pj42KSYweDNGKSwweDgwfCh4JjB4M0YpKTt9CnJldHVybiBvdXRwdXQ7fQpmdW5jdGlvbiBzdHIycnN0cl91dGYxNmxlKGlucHV0KQp7dmFyIG91dHB1dD0iIjtmb3IodmFyIGk9MDtpPGlucHV0Lmxlbmd0aDtpKyspCm91dHB1dCs9U3RyaW5nLmZyb21DaGFyQ29kZShpbnB1dC5jaGFyQ29kZUF0KGkpJjB4RkYsKGlucHV0LmNoYXJDb2RlQXQoaSk+Pj44KSYweEZGKTtyZXR1cm4gb3V0cHV0O30KZnVuY3Rpb24gc3RyMnJzdHJfdXRmMTZiZShpbnB1dCkKe3ZhciBvdXRwdXQ9IiI7Zm9yKHZhciBpPTA7aTxpbnB1dC5sZW5ndGg7aSsrKQpvdXRwdXQrPVN0cmluZy5mcm9tQ2hhckNvZGUoKGlucHV0LmNoYXJDb2RlQXQoaSk+Pj44KSYweEZGLGlucHV0LmNoYXJDb2RlQXQoaSkmMHhGRik7cmV0dXJuIG91dHB1dDt9CmZ1bmN0aW9uIHJzdHIyYmlubChpbnB1dCkKe3ZhciBvdXRwdXQ9QXJyYXkoaW5wdXQubGVuZ3RoPj4yKTtmb3IodmFyIGk9MDtpPG91dHB1dC5sZW5ndGg7aSsrKQpvdXRwdXRbaV09MDtmb3IodmFyIGk9MDtpPGlucHV0Lmxlbmd0aCo4O2krPTgpCm91dHB1dFtpPj41XXw9KGlucHV0LmNoYXJDb2RlQXQoaS84KSYweEZGKTw8KGklMzIpO3JldHVybiBvdXRwdXQ7fQpmdW5jdGlvbiBiaW5sMnJzdHIoaW5wdXQpCnt2YXIgb3V0cHV0PSIiO2Zvcih2YXIgaT0wO2k8aW5wdXQubGVuZ3RoKjMyO2krPTgpCm91dHB1dCs9U3RyaW5nLmZyb21DaGFyQ29kZSgoaW5wdXRbaT4+NV0+Pj4oaSUzMikpJjB4RkYpO3JldHVybiBvdXRwdXQ7fQpmdW5jdGlvbiBiaW5sX21kNSh4LGxlbikKe3hbbGVuPj41XXw9MHg4MDw8KChsZW4pJTMyKTt4WygoKGxlbis2NCk+Pj45KTw8NCkrMTRdPWxlbjt2YXIgYT0xNzMyNTg0MTkzO3ZhciBiPS0yNzE3MzM4Nzk7dmFyIGM9LTE3MzI1ODQxOTQ7dmFyIGQ9MjcxNzMzODc4O2Zvcih2YXIgaT0wO2k8eC5sZW5ndGg7aSs9MTYpCnt2YXIgb2xkYT1hO3ZhciBvbGRiPWI7dmFyIG9sZGM9Yzt2YXIgb2xkZD1kO2E9bWQ1X2ZmKGEsYixjLGQseFtpKzBdLDcsLTY4MDg3NjkzNik7ZD1tZDVfZmYoZCxhLGIsYyx4W2krMV0sMTIsLTM4OTU2NDU4Nik7Yz1tZDVfZmYoYyxkLGEsYix4W2krMl0sMTcsNjA2MTA1ODE5KTtiPW1kNV9mZihiLGMsZCxhLHhbaSszXSwyMiwtMTA0NDUyNTMzMCk7YT1tZDVfZmYoYSxiLGMsZCx4W2krNF0sNywtMTc2NDE4ODk3KTtkPW1kNV9mZihkLGEsYixjLHhbaSs1XSwxMiwxMjAwMDgwNDI2KTtjPW1kNV9mZihjLGQsYSxiLHhbaSs2XSwxNywtMTQ3MzIzMTM0MSk7Yj1tZDVfZmYoYixjLGQsYSx4W2krN10sMjIsLTQ1NzA1OTgzKTthPW1kNV9mZihhLGIsYyxkLHhbaSs4XSw3LDE3NzAwMzU0MTYpO2Q9bWQ1X2ZmKGQsYSxiLGMseFtpKzldLDEyLC0xOTU4NDE0NDE3KTtjPW1kNV9mZihjLGQsYSxiLHhbaSsxMF0sMTcsLTQyMDYzKTtiPW1kNV9mZihiLGMsZCxhLHhbaSsxMV0sMjIsLTE5OTA0MDQxNjIpO2E9bWQ1X2ZmKGEsYixjLGQseFtpKzEyXSw3LDE4MDQ2MDM2ODIpO2Q9bWQ1X2ZmKGQsYSxiLGMseFtpKzEzXSwxMiwtNDAzNDExMDEpO2M9bWQ1X2ZmKGMsZCxhLGIseFtpKzE0XSwxNywtMTUwMjAwMjI5MCk7Yj1tZDVfZmYoYixjLGQsYSx4W2krMTVdLDIyLDEyMzY1MzUzMjkpO2E9bWQ1X2dnKGEsYixjLGQseFtpKzFdLDUsLTE2NTc5NjUxMCk7ZD1tZDVfZ2coZCxhLGIsYyx4W2krNl0sOSwtMTA2OTUwMTYzMik7Yz1tZDVfZ2coYyxkLGEsYix4W2krMTFdLDE0LDY0MzcxNzcxMyk7Yj1tZDVfZ2coYixjLGQsYSx4W2krMF0sMjAsLTM3Mzg5NzMwMik7YT1tZDVfZ2coYSxiLGMsZCx4W2krNV0sNSwtNzAxNTU4NjkxKTtkPW1kNV9nZyhkLGEsYixjLHhbaSsxMF0sOSwzODAxNjA4Myk7Yz1tZDVfZ2coYyxkLGEsYix4W2krMTVdLDE0LC02NjA0NzgzMzUpO2I9bWQ1X2dnKGIsYyxkLGEseFtpKzRdLDIwLC00MDU1Mzc4NDgpO2E9bWQ1X2dnKGEsYixjLGQseFtpKzldLDUsNTY4NDQ2NDM4KTtkPW1kNV9nZyhkLGEsYixjLHhbaSsxNF0sOSwtMTAxOTgwMzY5MCk7Yz1tZDVfZ2coYyxkLGEsYix4W2krM10sMTQsLTE4NzM2Mzk2MSk7Yj1tZDVfZ2coYixjLGQsYSx4W2krOF0sMjAsMTE2MzUzMTUwMSk7YT1tZDVfZ2coYSxiLGMsZCx4W2krMTNdLDUsLTE0NDQ2ODE0NjcpO2Q9bWQ1X2dnKGQsYSxiLGMseFtpKzJdLDksLTUxNDAzNzg0KTtjPW1kNV9nZyhjLGQsYSxiLHhbaSs3XSwxNCwxNzM1MzI4NDczKTtiPW1kNV9nZyhiLGMsZCxhLHhbaSsxMl0sMjAsLTE5MjY2MDc3MzQpO2E9bWQ1X2hoKGEsYixjLGQseFtpKzVdLDQsLTM3ODU1OCk7ZD1tZDVfaGgoZCxhLGIsYyx4W2krOF0sMTEsLTIwMjI1NzQ0NjMpO2M9bWQ1X2hoKGMsZCxhLGIseFtpKzExXSwxNiwxODM5MDMwNTYyKTtiPW1kNV9oaChiLGMsZCxhLHhbaSsxNF0sMjMsLTM1MzA5NTU2KTthPW1kNV9oaChhLGIsYyxkLHhbaSsxXSw0LC0xNTMwOTkyMDYwKTtkPW1kNV9oaChkLGEsYixjLHhbaSs0XSwxMSwxMjcyODkzMzUzKTtjPW1kNV9oaChjLGQsYSxiLHhbaSs3XSwxNiwtMTU1NDk3NjMyKTtiPW1kNV9oaChiLGMsZCxhLHhbaSsxMF0sMjMsLTEwOTQ3MzA2NDApO2E9bWQ1X2hoKGEsYixjLGQseFtpKzEzXSw0LDY4MTI3OTE3NCk7ZD1tZDVfaGgoZCxhLGIsYyx4W2krMF0sMTEsLTM1ODUzNzIyMik7Yz1tZDVfaGgoYyxkLGEsYix4W2krM10sMTYsLTcyMjUyMTk3OSk7Yj1tZDVfaGgoYixjLGQsYSx4W2krNl0sMjMsNzYwMjkxODkpO2E9bWQ1X2hoKGEsYixjLGQseFtpKzldLDQsLTY0MDM2NDQ4Nyk7ZD1tZDVfaGgoZCxhLGIsYyx4W2krMTJdLDExLC00MjE4MTU4MzUpO2M9bWQ1X2hoKGMsZCxhLGIseFtpKzE1XSwxNiw1MzA3NDI1MjApO2I9bWQ1X2hoKGIsYyxkLGEseFtpKzJdLDIzLC05OTUzMzg2NTEpO2E9bWQ1X2lpKGEsYixjLGQseFtpKzBdLDYsLTE5ODYzMDg0NCk7ZD1tZDVfaWkoZCxhLGIsYyx4W2krN10sMTAsMTEyNjg5MTQxNSk7Yz1tZDVfaWkoYyxkLGEsYix4W2krMTRdLDE1LC0xNDE2MzU0OTA1KTtiPW1kNV9paShiLGMsZCxhLHhbaSs1XSwyMSwtNTc0MzQwNTUpO2E9bWQ1X2lpKGEsYixjLGQseFtpKzEyXSw2LDE3MDA0ODU1NzEpO2Q9bWQ1X2lpKGQsYSxiLGMseFtpKzNdLDEwLC0xODk0OTg2NjA2KTtjPW1kNV9paShjLGQsYSxiLHhbaSsxMF0sMTUsLTEwNTE1MjMpO2I9bWQ1X2lpKGIsYyxkLGEseFtpKzFdLDIxLC0yMDU0OTIyNzk5KTthPW1kNV9paShhLGIsYyxkLHhbaSs4XSw2LDE4NzMzMTMzNTkpO2Q9bWQ1X2lpKGQsYSxiLGMseFtpKzE1XSwxMCwtMzA2MTE3NDQpO2M9bWQ1X2lpKGMsZCxhLGIseFtpKzZdLDE1LC0xNTYwMTk4MzgwKTtiPW1kNV9paShiLGMsZCxhLHhbaSsxM10sMjEsMTMwOTE1MTY0OSk7YT1tZDVfaWkoYSxiLGMsZCx4W2krNF0sNiwtMTQ1NTIzMDcwKTtkPW1kNV9paShkLGEsYixjLHhbaSsxMV0sMTAsLTExMjAyMTAzNzkpO2M9bWQ1X2lpKGMsZCxhLGIseFtpKzJdLDE1LDcxODc4NzI1OSk7Yj1tZDVfaWkoYixjLGQsYSx4W2krOV0sMjEsLTM0MzQ4NTU1MSk7YT1zYWZlX2FkZChhLG9sZGEpO2I9c2FmZV9hZGQoYixvbGRiKTtjPXNhZmVfYWRkKGMsb2xkYyk7ZD1zYWZlX2FkZChkLG9sZGQpO30KcmV0dXJuIEFycmF5KGEsYixjLGQpO30KZnVuY3Rpb24gbWQ1X2NtbihxLGEsYix4LHMsdCkKe3JldHVybiBzYWZlX2FkZChiaXRfcm9sKHNhZmVfYWRkKHNhZmVfYWRkKGEscSksc2FmZV9hZGQoeCx0KSkscyksYik7fQpmdW5jdGlvbiBtZDVfZmYoYSxiLGMsZCx4LHMsdCkKe3JldHVybiBtZDVfY21uKChiJmMpfCgofmIpJmQpLGEsYix4LHMsdCk7fQpmdW5jdGlvbiBtZDVfZ2coYSxiLGMsZCx4LHMsdCkKe3JldHVybiBtZDVfY21uKChiJmQpfChjJih+ZCkpLGEsYix4LHMsdCk7fQpmdW5jdGlvbiBtZDVfaGgoYSxiLGMsZCx4LHMsdCkKe3JldHVybiBtZDVfY21uKGJeY15kLGEsYix4LHMsdCk7fQpmdW5jdGlvbiBtZDVfaWkoYSxiLGMsZCx4LHMsdCkKe3JldHVybiBtZDVfY21uKGNeKGJ8KH5kKSksYSxiLHgscyx0KTt9CmZ1bmN0aW9uIHNhZmVfYWRkKHgseSkKe3ZhciBsc3c9KHgmMHhGRkZGKSsoeSYweEZGRkYpO3ZhciBtc3c9KHg+PjE2KSsoeT4+MTYpKyhsc3c+PjE2KTtyZXR1cm4obXN3PDwxNil8KGxzdyYweEZGRkYpO30KZnVuY3Rpb24gYml0X3JvbChudW0sY250KQp7cmV0dXJuKG51bTw8Y250KXwobnVtPj4+KDMyLWNudCkpO30KZnVuY3Rpb24gQmlidGV4UGFyc2VyKCl7dGhpcy5wb3M9MDt0aGlzLmlucHV0PSIiO3RoaXMuZW50cmllcz17fTt0aGlzLnN0cmluZ3M9e0pBTjoiSmFudWFyeSIsRkVCOiJGZWJydWFyeSIsTUFSOiJNYXJjaCIsQVBSOiJBcHJpbCIsTUFZOiJNYXkiLEpVTjoiSnVuZSIsSlVMOiJKdWx5IixBVUc6IkF1Z3VzdCIsU0VQOiJTZXB0ZW1iZXIiLE9DVDoiT2N0b2JlciIsTk9WOiJOb3ZlbWJlciIsREVDOiJEZWNlbWJlciJ9O3RoaXMuY3VycmVudEtleT0iIjt0aGlzLmN1cnJlbnRFbnRyeT0iIjt0aGlzLnNldElucHV0PWZ1bmN0aW9uKHQpe3RoaXMuaW5wdXQ9dDt9CnRoaXMuZ2V0RW50cmllcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLmVudHJpZXM7fQp0aGlzLmlzV2hpdGVzcGFjZT1mdW5jdGlvbihzKXtyZXR1cm4ocz09JyAnfHxzPT0nXHInfHxzPT0nXHQnfHxzPT0nXG4nKTt9CnRoaXMubWF0Y2g9ZnVuY3Rpb24ocyl7dGhpcy5za2lwV2hpdGVzcGFjZSgpO2lmKHRoaXMuaW5wdXQuc3Vic3RyaW5nKHRoaXMucG9zLHRoaXMucG9zK3MubGVuZ3RoKT09cyl7dGhpcy5wb3MrPXMubGVuZ3RoO31lbHNle3Rocm93IlRva2VuIG1pc21hdGNoLCBleHBlY3RlZCAiK3MrIiwgZm91bmQgIit0aGlzLmlucHV0LnN1YnN0cmluZyh0aGlzLnBvcyk7fQp0aGlzLnNraXBXaGl0ZXNwYWNlKCk7fQp0aGlzLnRyeU1hdGNoPWZ1bmN0aW9uKHMpe3RoaXMuc2tpcFdoaXRlc3BhY2UoKTtpZih0aGlzLmlucHV0LnN1YnN0cmluZyh0aGlzLnBvcyx0aGlzLnBvcytzLmxlbmd0aCk9PXMpe3JldHVybiB0cnVlO31lbHNle3JldHVybiBmYWxzZTt9CnRoaXMuc2tpcFdoaXRlc3BhY2UoKTt9CnRoaXMuc2tpcFdoaXRlc3BhY2U9ZnVuY3Rpb24oKXt3aGlsZSh0aGlzLmlzV2hpdGVzcGFjZSh0aGlzLmlucHV0W3RoaXMucG9zXSkpe3RoaXMucG9zKys7fQppZih0aGlzLmlucHV0W3RoaXMucG9zXT09IiUiKXt3aGlsZSh0aGlzLmlucHV0W3RoaXMucG9zXSE9IlxuIil7dGhpcy5wb3MrKzt9CnRoaXMuc2tpcFdoaXRlc3BhY2UoKTt9fQp0aGlzLnZhbHVlX2JyYWNlcz1mdW5jdGlvbigpe3ZhciBicmFjZWNvdW50PTA7dGhpcy5tYXRjaCgieyIpO3ZhciBzdGFydD10aGlzLnBvczt3aGlsZSh0cnVlKXtpZih0aGlzLmlucHV0W3RoaXMucG9zXT09J30nJiZ0aGlzLmlucHV0W3RoaXMucG9zLTFdIT0nXFwnKXtpZihicmFjZWNvdW50PjApe2JyYWNlY291bnQtLTt9ZWxzZXt2YXIgZW5kPXRoaXMucG9zO3RoaXMubWF0Y2goIn0iKTtyZXR1cm4gdGhpcy5pbnB1dC5zdWJzdHJpbmcoc3RhcnQsZW5kKTt9fWVsc2UgaWYodGhpcy5pbnB1dFt0aGlzLnBvc109PSd7Jyl7YnJhY2Vjb3VudCsrO31lbHNlIGlmKHRoaXMucG9zPT10aGlzLmlucHV0Lmxlbmd0aC0xKXt0aHJvdyJVbnRlcm1pbmF0ZWQgdmFsdWUiO30KdGhpcy5wb3MrKzt9fQp0aGlzLnZhbHVlX3F1b3Rlcz1mdW5jdGlvbigpe3RoaXMubWF0Y2goJyInKTt2YXIgc3RhcnQ9dGhpcy5wb3M7d2hpbGUodHJ1ZSl7aWYodGhpcy5pbnB1dFt0aGlzLnBvc109PSciJyYmdGhpcy5pbnB1dFt0aGlzLnBvcy0xXSE9J1xcJyl7dmFyIGVuZD10aGlzLnBvczt0aGlzLm1hdGNoKCciJyk7cmV0dXJuIHRoaXMuaW5wdXQuc3Vic3RyaW5nKHN0YXJ0LGVuZCk7fWVsc2UgaWYodGhpcy5wb3M9PXRoaXMuaW5wdXQubGVuZ3RoLTEpe3Rocm93IlVudGVybWluYXRlZCB2YWx1ZToiK3RoaXMuaW5wdXQuc3Vic3RyaW5nKHN0YXJ0KTt9CnRoaXMucG9zKys7fX0KdGhpcy5zaW5nbGVfdmFsdWU9ZnVuY3Rpb24oKXt2YXIgc3RhcnQ9dGhpcy5wb3M7aWYodGhpcy50cnlNYXRjaCgieyIpKXtyZXR1cm4gdGhpcy52YWx1ZV9icmFjZXMoKTt9ZWxzZSBpZih0aGlzLnRyeU1hdGNoKCciJykpe3JldHVybiB0aGlzLnZhbHVlX3F1b3RlcygpO31lbHNle3ZhciBrPXRoaXMua2V5KCk7aWYodGhpcy5zdHJpbmdzW2sudG9VcHBlckNhc2UoKV0pe3JldHVybiB0aGlzLnN0cmluZ3Nba107fWVsc2UgaWYoay5tYXRjaCgiXlswLTldKyQiKSl7cmV0dXJuIGs7fWVsc2V7dGhyb3ciVmFsdWUgZXhwZWN0ZWQ6Iit0aGlzLmlucHV0LnN1YnN0cmluZyhzdGFydCk7fX19CnRoaXMudmFsdWU9ZnVuY3Rpb24oKXt2YXIgdmFsdWVzPVtdO3ZhbHVlcy5wdXNoKHRoaXMuc2luZ2xlX3ZhbHVlKCkpO3doaWxlKHRoaXMudHJ5TWF0Y2goIiMiKSl7dGhpcy5tYXRjaCgiIyIpO3ZhbHVlcy5wdXNoKHRoaXMuc2luZ2xlX3ZhbHVlKCkpO30KcmV0dXJuIHZhbHVlcy5qb2luKCIiKTt9CnRoaXMua2V5PWZ1bmN0aW9uKCl7dmFyIHN0YXJ0PXRoaXMucG9zO3doaWxlKHRydWUpe2lmKHRoaXMucG9zPT10aGlzLmlucHV0Lmxlbmd0aCl7dGhyb3ciUnVuYXdheSBrZXkiO30KaWYodGhpcy5pbnB1dFt0aGlzLnBvc10ubWF0Y2goIlthLXpBLVowLTlfOlxcLi8tXSIpKXt0aGlzLnBvcysrfWVsc2V7cmV0dXJuIHRoaXMuaW5wdXQuc3Vic3RyaW5nKHN0YXJ0LHRoaXMucG9zKS50b1VwcGVyQ2FzZSgpO319fQp0aGlzLmtleV9lcXVhbHNfdmFsdWU9ZnVuY3Rpb24oKXt2YXIga2V5PXRoaXMua2V5KCk7aWYodGhpcy50cnlNYXRjaCgiPSIpKXt0aGlzLm1hdGNoKCI9Iik7dmFyIHZhbD10aGlzLnZhbHVlKCk7cmV0dXJuW2tleSx2YWxdO31lbHNle3Rocm93Ii4uLiA9IHZhbHVlIGV4cGVjdGVkLCBlcXVhbHMgc2lnbiBtaXNzaW5nOiIrdGhpcy5pbnB1dC5zdWJzdHJpbmcodGhpcy5wb3MpO319CnRoaXMua2V5X3ZhbHVlX2xpc3Q9ZnVuY3Rpb24oKXt2YXIga3Y9dGhpcy5rZXlfZXF1YWxzX3ZhbHVlKCk7dGhpcy5lbnRyaWVzW3RoaXMuY3VycmVudEVudHJ5XVtrdlswXV09a3ZbMV07d2hpbGUodGhpcy50cnlNYXRjaCgiLCIpKXt0aGlzLm1hdGNoKCIsIik7aWYodGhpcy50cnlNYXRjaCgifSIpKXticmVhazt9Cmt2PXRoaXMua2V5X2VxdWFsc192YWx1ZSgpO3RoaXMuZW50cmllc1t0aGlzLmN1cnJlbnRFbnRyeV1ba3ZbMF1dPWt2WzFdO319CnRoaXMuZW50cnlfYm9keT1mdW5jdGlvbigpe3RoaXMuY3VycmVudEVudHJ5PXRoaXMua2V5KCk7dGhpcy5lbnRyaWVzW3RoaXMuY3VycmVudEVudHJ5XT1uZXcgT2JqZWN0KCk7dGhpcy5tYXRjaCgiLCIpO3RoaXMua2V5X3ZhbHVlX2xpc3QoKTt9CnRoaXMuZGlyZWN0aXZlPWZ1bmN0aW9uKCl7dGhpcy5tYXRjaCgiQCIpO3JldHVybiJAIit0aGlzLmtleSgpO30KdGhpcy5zdHJpbmc9ZnVuY3Rpb24oKXt2YXIga3Y9dGhpcy5rZXlfZXF1YWxzX3ZhbHVlKCk7dGhpcy5zdHJpbmdzW2t2WzBdLnRvVXBwZXJDYXNlKCldPWt2WzFdO30KdGhpcy5wcmVhbWJsZT1mdW5jdGlvbigpe3RoaXMudmFsdWUoKTt9CnRoaXMuY29tbWVudD1mdW5jdGlvbigpe3RoaXMudmFsdWUoKTt9CnRoaXMuZW50cnk9ZnVuY3Rpb24oKXt0aGlzLmVudHJ5X2JvZHkoKTt9CnRoaXMuYmlidGV4PWZ1bmN0aW9uKCl7d2hpbGUodGhpcy50cnlNYXRjaCgiQCIpKXt2YXIgZD10aGlzLmRpcmVjdGl2ZSgpLnRvVXBwZXJDYXNlKCk7dGhpcy5tYXRjaCgieyIpO2lmKGQ9PSJAU1RSSU5HIil7dGhpcy5zdHJpbmcoKTt9ZWxzZSBpZihkPT0iQFBSRUFNQkxFIil7dGhpcy5wcmVhbWJsZSgpO31lbHNlIGlmKGQ9PSJAQ09NTUVOVCIpe3RoaXMuY29tbWVudCgpO31lbHNle3RoaXMuZW50cnkoKTt9CnRoaXMubWF0Y2goIn0iKTt9fX0KZnVuY3Rpb24gQmlidGV4RGlzcGxheSgpe3RoaXMuZml4VmFsdWU9ZnVuY3Rpb24odmFsdWUpe3ZhbHVlPXZhbHVlLnJlcGxhY2UoL1xcZ2xxcVxzPy9nLCImYmRxdW87Iik7dmFsdWU9dmFsdWUucmVwbGFjZSgvXFxncnFxXHM/L2csJyZyZHF1bzsnKTt2YWx1ZT12YWx1ZS5yZXBsYWNlKC9cXCAvZywnJm5ic3A7Jyk7dmFsdWU9dmFsdWUucmVwbGFjZSgvXFx1cmwvZywnJyk7dmFsdWU9dmFsdWUucmVwbGFjZSgvLS0tL2csJyZtZGFzaDsnKTt2YWx1ZT12YWx1ZS5yZXBsYWNlKC97XFwiYX0vZywnJmF1bWw7Jyk7dmFsdWU9dmFsdWUucmVwbGFjZSgvXHtcXCJvXH0vZywnJm91bWw7Jyk7dmFsdWU9dmFsdWUucmVwbGFjZSgve1xcInV9L2csJyZ1dW1sOycpO3ZhbHVlPXZhbHVlLnJlcGxhY2UoL3tcXCJBfS9nLCcmQXVtbDsnKTt2YWx1ZT12YWx1ZS5yZXBsYWNlKC97XFwiT30vZywnJk91bWw7Jyk7dmFsdWU9dmFsdWUucmVwbGFjZSgve1xcIlV9L2csJyZVdW1sOycpO3ZhbHVlPXZhbHVlLnJlcGxhY2UoL1xcc3MvZywnJnN6bGlnOycpO3ZhbHVlPXZhbHVlLnJlcGxhY2UoL1x7KC4qPylcfS9nLCckMScpO3JldHVybiB2YWx1ZTt9CnRoaXMuZGlzcGxheUJpYnRleDI9ZnVuY3Rpb24oaSxvKXt2YXIgYj1uZXcgQmlidGV4UGFyc2VyKCk7Yi5zZXRJbnB1dChpKTtiLmJpYnRleCgpO3ZhciBlPWIuZ2V0RW50cmllcygpO3ZhciBvbGQ9by5maW5kKCIqIik7Zm9yKHZhciBpdGVtIGluIGUpe3ZhciB0cGw9JCgiLmJpYnRleF90ZW1wbGF0ZSIpLmNsb25lKCkucmVtb3ZlQ2xhc3MoJ2JpYnRleF90ZW1wbGF0ZScpO3RwbC5hZGRDbGFzcygidW51c2VkIik7Zm9yKHZhciBrZXkgaW4gZVtpdGVtXSl7dmFyIGZpZWxkcz10cGwuZmluZCgiLiIra2V5LnRvTG93ZXJDYXNlKCkpO2Zvcih2YXIgaT0wO2k8ZmllbGRzLnNpemUoKTtpKyspe3ZhciBmPSQoZmllbGRzW2ldKTtmLnJlbW92ZUNsYXNzKCJ1bnVzZWQiKTt2YXIgdmFsdWU9dGhpcy5maXhWYWx1ZShlW2l0ZW1dW2tleV0pO2lmKGYuaXMoImEiKSl7Zi5hdHRyKCJocmVmIix2YWx1ZSk7fWVsc2V7dmFyIGN1cnJlbnRIVE1MPWYuaHRtbCgpfHwiIjtpZihjdXJyZW50SFRNTC5tYXRjaCgiJSIpKXtmLmh0bWwoY3VycmVudEhUTUwucmVwbGFjZSgiJSIsdmFsdWUpKTt9ZWxzZXtmLmh0bWwodmFsdWUpO319fX0KdmFyIGVtcHR5RmllbGRzPXRwbC5maW5kKCJzcGFuIC51bnVzZWQiKTtlbXB0eUZpZWxkcy5lYWNoKGZ1bmN0aW9uKGtleSxmKXtpZihmLmlubmVySFRNTC5tYXRjaCgiJSIpKXtmLmlubmVySFRNTD0iIjt9fSk7by5hcHBlbmQodHBsKTt0cGwuc2hvdygpO30Kb2xkLnJlbW92ZSgpO30KdGhpcy5kaXNwbGF5QmlidGV4PWZ1bmN0aW9uKGlucHV0LG91dHB1dCl7dmFyIGI9bmV3IEJpYnRleFBhcnNlcigpO2Iuc2V0SW5wdXQoaW5wdXQpO2IuYmlidGV4KCk7dmFyIG9sZD1vdXRwdXQuZmluZCgiKiIpO3ZhciBlbnRyaWVzPWIuZ2V0RW50cmllcygpO2Zvcih2YXIgZW50cnlLZXkgaW4gZW50cmllcyl7dmFyIGVudHJ5PWVudHJpZXNbZW50cnlLZXldO3ZhciB0cGw9JCgiLmJpYnRleF90ZW1wbGF0ZSIpLmNsb25lKCkucmVtb3ZlQ2xhc3MoJ2JpYnRleF90ZW1wbGF0ZScpO3ZhciBrZXlzPVtdO2Zvcih2YXIga2V5IGluIGVudHJ5KXtrZXlzLnB1c2goa2V5LnRvVXBwZXJDYXNlKCkpO30KdmFyIHJlbW92ZWQ9ZmFsc2U7ZG97dmFyIGNvbmRzPXRwbC5maW5kKCIuaWYiKTtpZihjb25kcy5zaXplKCk9PTApe2JyZWFrO30KdmFyIGNvbmQ9Y29uZHMuZmlyc3QoKTtjb25kLnJlbW92ZUNsYXNzKCJpZiIpO3ZhciBpZlRydWU9dHJ1ZTt2YXIgY2xhc3NMaXN0PWNvbmQuYXR0cignY2xhc3MnKS5zcGxpdCgnICcpOyQuZWFjaChjbGFzc0xpc3QsZnVuY3Rpb24oaW5kZXgsY2xzKXtpZihrZXlzLmluZGV4T2YoY2xzLnRvVXBwZXJDYXNlKCkpPDApe2lmVHJ1ZT1mYWxzZTt9CmNvbmQucmVtb3ZlQ2xhc3MoY2xzKTt9KTtpZighaWZUcnVlKXtjb25kLnJlbW92ZSgpO319d2hpbGUodHJ1ZSk7Zm9yKHZhciBpbmRleCBpbiBrZXlzKXt2YXIga2V5PWtleXNbaW5kZXhdO3ZhciB2YWx1ZT1lbnRyeVtrZXldfHwiIjt0cGwuZmluZCgic3Bhbjpub3QoYSkuIitrZXkudG9Mb3dlckNhc2UoKSkuaHRtbCh0aGlzLmZpeFZhbHVlKHZhbHVlKSk7dHBsLmZpbmQoImEuIitrZXkudG9Mb3dlckNhc2UoKSkuYXR0cignaHJlZicsdGhpcy5maXhWYWx1ZSh2YWx1ZSkpO30Kb3V0cHV0LmFwcGVuZCh0cGwpO3RwbC5zaG93KCk7fQpvbGQucmVtb3ZlKCk7fX0KZnVuY3Rpb24gYmlidGV4X2pzX2RyYXcoKXtpZigkKCIuYmlidGV4X3RlbXBsYXRlIikuc2l6ZSgpPT0wKXskKCJib2R5IikuYXBwZW5kKCI8ZGl2IGNsYXNzPVwiYmlidGV4X3RlbXBsYXRlXCI+PGRpdiBjbGFzcz1cImlmIGF1dGhvclwiIHN0eWxlPVwiZm9udC13ZWlnaHQ6IGJvbGQ7XCI+XG4gIDxzcGFuIGNsYXNzPVwiaWYgeWVhclwiPlxuICAgIDxzcGFuIGNsYXNzPVwieWVhclwiPjwvc3Bhbj4sIFxuICA8L3NwYW4+XG4gIDxzcGFuIGNsYXNzPVwiYXV0aG9yXCI+PC9zcGFuPlxuICA8c3BhbiBjbGFzcz1cImlmIHVybFwiIHN0eWxlPVwibWFyZ2luLWxlZnQ6IDIwcHhcIj5cbiAgICA8YSBjbGFzcz1cInVybFwiIHN0eWxlPVwiY29sb3I6YmxhY2s7IGZvbnQtc2l6ZToxMHB4XCI+KHZpZXcgb25saW5lKTwvYT5cbiAgPC9zcGFuPlxuPC9kaXY+XG48ZGl2IHN0eWxlPVwibWFyZ2luLWxlZnQ6IDEwcHg7IG1hcmdpbi1ib3R0b206NXB4O1wiPlxuICA8c3BhbiBjbGFzcz1cInRpdGxlXCI+PC9zcGFuPlxuPC9kaXY+PC9kaXY+Iik7fQokKCIuYmlidGV4X3RlbXBsYXRlIikuaGlkZSgpOyhuZXcgQmlidGV4RGlzcGxheSgpKS5kaXNwbGF5QmlidGV4KCQoIiNiaWJ0ZXhfaW5wdXQiKS52YWwoKSwkKCIjYmlidGV4X2Rpc3BsYXkiKSk7fQooZnVuY3Rpb24oKXt2YXIgcm9vdD10aGlzO3ZhciBwcmV2aW91c1VuZGVyc2NvcmU9cm9vdC5fO3ZhciBicmVha2VyPXt9O3ZhciBBcnJheVByb3RvPUFycmF5LnByb3RvdHlwZSxPYmpQcm90bz1PYmplY3QucHJvdG90eXBlLEZ1bmNQcm90bz1GdW5jdGlvbi5wcm90b3R5cGU7dmFyIHNsaWNlPUFycmF5UHJvdG8uc2xpY2UsdW5zaGlmdD1BcnJheVByb3RvLnVuc2hpZnQsdG9TdHJpbmc9T2JqUHJvdG8udG9TdHJpbmcsaGFzT3duUHJvcGVydHk9T2JqUHJvdG8uaGFzT3duUHJvcGVydHk7dmFyCm5hdGl2ZUZvckVhY2g9QXJyYXlQcm90by5mb3JFYWNoLG5hdGl2ZU1hcD1BcnJheVByb3RvLm1hcCxuYXRpdmVSZWR1Y2U9QXJyYXlQcm90by5yZWR1Y2UsbmF0aXZlUmVkdWNlUmlnaHQ9QXJyYXlQcm90by5yZWR1Y2VSaWdodCxuYXRpdmVGaWx0ZXI9QXJyYXlQcm90by5maWx0ZXIsbmF0aXZlRXZlcnk9QXJyYXlQcm90by5ldmVyeSxuYXRpdmVTb21lPUFycmF5UHJvdG8uc29tZSxuYXRpdmVJbmRleE9mPUFycmF5UHJvdG8uaW5kZXhPZixuYXRpdmVMYXN0SW5kZXhPZj1BcnJheVByb3RvLmxhc3RJbmRleE9mLG5hdGl2ZUlzQXJyYXk9QXJyYXkuaXNBcnJheSxuYXRpdmVLZXlzPU9iamVjdC5rZXlzLG5hdGl2ZUJpbmQ9RnVuY1Byb3RvLmJpbmQ7dmFyIF89ZnVuY3Rpb24ob2JqKXtyZXR1cm4gbmV3IHdyYXBwZXIob2JqKTt9O2lmKHR5cGVvZiBtb2R1bGUhPT0ndW5kZWZpbmVkJyYmbW9kdWxlLmV4cG9ydHMpe21vZHVsZS5leHBvcnRzPV87Xy5fPV87fWVsc2V7cm9vdFsnXyddPV87fQpfLlZFUlNJT049JzEuMS43Jzt2YXIgZWFjaD1fLmVhY2g9Xy5mb3JFYWNoPWZ1bmN0aW9uKG9iaixpdGVyYXRvcixjb250ZXh0KXtpZihvYmo9PW51bGwpcmV0dXJuO2lmKG5hdGl2ZUZvckVhY2gmJm9iai5mb3JFYWNoPT09bmF0aXZlRm9yRWFjaCl7b2JqLmZvckVhY2goaXRlcmF0b3IsY29udGV4dCk7fWVsc2UgaWYob2JqLmxlbmd0aD09PStvYmoubGVuZ3RoKXtmb3IodmFyIGk9MCxsPW9iai5sZW5ndGg7aTxsO2krKyl7aWYoaSBpbiBvYmomJml0ZXJhdG9yLmNhbGwoY29udGV4dCxvYmpbaV0saSxvYmopPT09YnJlYWtlcilyZXR1cm47fX1lbHNle2Zvcih2YXIga2V5IGluIG9iail7aWYoaGFzT3duUHJvcGVydHkuY2FsbChvYmosa2V5KSl7aWYoaXRlcmF0b3IuY2FsbChjb250ZXh0LG9ialtrZXldLGtleSxvYmopPT09YnJlYWtlcilyZXR1cm47fX19fTtfLm1hcD1mdW5jdGlvbihvYmosaXRlcmF0b3IsY29udGV4dCl7dmFyIHJlc3VsdHM9W107aWYob2JqPT1udWxsKXJldHVybiByZXN1bHRzO2lmKG5hdGl2ZU1hcCYmb2JqLm1hcD09PW5hdGl2ZU1hcClyZXR1cm4gb2JqLm1hcChpdGVyYXRvcixjb250ZXh0KTtlYWNoKG9iaixmdW5jdGlvbih2YWx1ZSxpbmRleCxsaXN0KXtyZXN1bHRzW3Jlc3VsdHMubGVuZ3RoXT1pdGVyYXRvci5jYWxsKGNvbnRleHQsdmFsdWUsaW5kZXgsbGlzdCk7fSk7cmV0dXJuIHJlc3VsdHM7fTtfLnJlZHVjZT1fLmZvbGRsPV8uaW5qZWN0PWZ1bmN0aW9uKG9iaixpdGVyYXRvcixtZW1vLGNvbnRleHQpe3ZhciBpbml0aWFsPW1lbW8hPT12b2lkIDA7aWYob2JqPT1udWxsKW9iaj1bXTtpZihuYXRpdmVSZWR1Y2UmJm9iai5yZWR1Y2U9PT1uYXRpdmVSZWR1Y2Upe2lmKGNvbnRleHQpaXRlcmF0b3I9Xy5iaW5kKGl0ZXJhdG9yLGNvbnRleHQpO3JldHVybiBpbml0aWFsP29iai5yZWR1Y2UoaXRlcmF0b3IsbWVtbyk6b2JqLnJlZHVjZShpdGVyYXRvcik7fQplYWNoKG9iaixmdW5jdGlvbih2YWx1ZSxpbmRleCxsaXN0KXtpZighaW5pdGlhbCl7bWVtbz12YWx1ZTtpbml0aWFsPXRydWU7fWVsc2V7bWVtbz1pdGVyYXRvci5jYWxsKGNvbnRleHQsbWVtbyx2YWx1ZSxpbmRleCxsaXN0KTt9fSk7aWYoIWluaXRpYWwpdGhyb3cgbmV3IFR5cGVFcnJvcigiUmVkdWNlIG9mIGVtcHR5IGFycmF5IHdpdGggbm8gaW5pdGlhbCB2YWx1ZSIpO3JldHVybiBtZW1vO307Xy5yZWR1Y2VSaWdodD1fLmZvbGRyPWZ1bmN0aW9uKG9iaixpdGVyYXRvcixtZW1vLGNvbnRleHQpe2lmKG9iaj09bnVsbClvYmo9W107aWYobmF0aXZlUmVkdWNlUmlnaHQmJm9iai5yZWR1Y2VSaWdodD09PW5hdGl2ZVJlZHVjZVJpZ2h0KXtpZihjb250ZXh0KWl0ZXJhdG9yPV8uYmluZChpdGVyYXRvcixjb250ZXh0KTtyZXR1cm4gbWVtbyE9PXZvaWQgMD9vYmoucmVkdWNlUmlnaHQoaXRlcmF0b3IsbWVtbyk6b2JqLnJlZHVjZVJpZ2h0KGl0ZXJhdG9yKTt9CnZhciByZXZlcnNlZD0oXy5pc0FycmF5KG9iaik/b2JqLnNsaWNlKCk6Xy50b0FycmF5KG9iaikpLnJldmVyc2UoKTtyZXR1cm4gXy5yZWR1Y2UocmV2ZXJzZWQsaXRlcmF0b3IsbWVtbyxjb250ZXh0KTt9O18uZmluZD1fLmRldGVjdD1mdW5jdGlvbihvYmosaXRlcmF0b3IsY29udGV4dCl7dmFyIHJlc3VsdDthbnkob2JqLGZ1bmN0aW9uKHZhbHVlLGluZGV4LGxpc3Qpe2lmKGl0ZXJhdG9yLmNhbGwoY29udGV4dCx2YWx1ZSxpbmRleCxsaXN0KSl7cmVzdWx0PXZhbHVlO3JldHVybiB0cnVlO319KTtyZXR1cm4gcmVzdWx0O307Xy5maWx0ZXI9Xy5zZWxlY3Q9ZnVuY3Rpb24ob2JqLGl0ZXJhdG9yLGNvbnRleHQpe3ZhciByZXN1bHRzPVtdO2lmKG9iaj09bnVsbClyZXR1cm4gcmVzdWx0cztpZihuYXRpdmVGaWx0ZXImJm9iai5maWx0ZXI9PT1uYXRpdmVGaWx0ZXIpcmV0dXJuIG9iai5maWx0ZXIoaXRlcmF0b3IsY29udGV4dCk7ZWFjaChvYmosZnVuY3Rpb24odmFsdWUsaW5kZXgsbGlzdCl7aWYoaXRlcmF0b3IuY2FsbChjb250ZXh0LHZhbHVlLGluZGV4LGxpc3QpKXJlc3VsdHNbcmVzdWx0cy5sZW5ndGhdPXZhbHVlO30pO3JldHVybiByZXN1bHRzO307Xy5yZWplY3Q9ZnVuY3Rpb24ob2JqLGl0ZXJhdG9yLGNvbnRleHQpe3ZhciByZXN1bHRzPVtdO2lmKG9iaj09bnVsbClyZXR1cm4gcmVzdWx0cztlYWNoKG9iaixmdW5jdGlvbih2YWx1ZSxpbmRleCxsaXN0KXtpZighaXRlcmF0b3IuY2FsbChjb250ZXh0LHZhbHVlLGluZGV4LGxpc3QpKXJlc3VsdHNbcmVzdWx0cy5sZW5ndGhdPXZhbHVlO30pO3JldHVybiByZXN1bHRzO307Xy5ldmVyeT1fLmFsbD1mdW5jdGlvbihvYmosaXRlcmF0b3IsY29udGV4dCl7dmFyIHJlc3VsdD10cnVlO2lmKG9iaj09bnVsbClyZXR1cm4gcmVzdWx0O2lmKG5hdGl2ZUV2ZXJ5JiZvYmouZXZlcnk9PT1uYXRpdmVFdmVyeSlyZXR1cm4gb2JqLmV2ZXJ5KGl0ZXJhdG9yLGNvbnRleHQpO2VhY2gob2JqLGZ1bmN0aW9uKHZhbHVlLGluZGV4LGxpc3Qpe2lmKCEocmVzdWx0PXJlc3VsdCYmaXRlcmF0b3IuY2FsbChjb250ZXh0LHZhbHVlLGluZGV4LGxpc3QpKSlyZXR1cm4gYnJlYWtlcjt9KTtyZXR1cm4gcmVzdWx0O307dmFyIGFueT1fLnNvbWU9Xy5hbnk9ZnVuY3Rpb24ob2JqLGl0ZXJhdG9yLGNvbnRleHQpe2l0ZXJhdG9yPWl0ZXJhdG9yfHxfLmlkZW50aXR5O3ZhciByZXN1bHQ9ZmFsc2U7aWYob2JqPT1udWxsKXJldHVybiByZXN1bHQ7aWYobmF0aXZlU29tZSYmb2JqLnNvbWU9PT1uYXRpdmVTb21lKXJldHVybiBvYmouc29tZShpdGVyYXRvcixjb250ZXh0KTtlYWNoKG9iaixmdW5jdGlvbih2YWx1ZSxpbmRleCxsaXN0KXtpZihyZXN1bHR8PWl0ZXJhdG9yLmNhbGwoY29udGV4dCx2YWx1ZSxpbmRleCxsaXN0KSlyZXR1cm4gYnJlYWtlcjt9KTtyZXR1cm4hIXJlc3VsdDt9O18uaW5jbHVkZT1fLmNvbnRhaW5zPWZ1bmN0aW9uKG9iaix0YXJnZXQpe3ZhciBmb3VuZD1mYWxzZTtpZihvYmo9PW51bGwpcmV0dXJuIGZvdW5kO2lmKG5hdGl2ZUluZGV4T2YmJm9iai5pbmRleE9mPT09bmF0aXZlSW5kZXhPZilyZXR1cm4gb2JqLmluZGV4T2YodGFyZ2V0KSE9LTE7YW55KG9iaixmdW5jdGlvbih2YWx1ZSl7aWYoZm91bmQ9dmFsdWU9PT10YXJnZXQpcmV0dXJuIHRydWU7fSk7cmV0dXJuIGZvdW5kO307Xy5pbnZva2U9ZnVuY3Rpb24ob2JqLG1ldGhvZCl7dmFyIGFyZ3M9c2xpY2UuY2FsbChhcmd1bWVudHMsMik7cmV0dXJuIF8ubWFwKG9iaixmdW5jdGlvbih2YWx1ZSl7cmV0dXJuKG1ldGhvZC5jYWxsP21ldGhvZHx8dmFsdWU6dmFsdWVbbWV0aG9kXSkuYXBwbHkodmFsdWUsYXJncyk7fSk7fTtfLnBsdWNrPWZ1bmN0aW9uKG9iaixrZXkpe3JldHVybiBfLm1hcChvYmosZnVuY3Rpb24odmFsdWUpe3JldHVybiB2YWx1ZVtrZXldO30pO307Xy5tYXg9ZnVuY3Rpb24ob2JqLGl0ZXJhdG9yLGNvbnRleHQpe2lmKCFpdGVyYXRvciYmXy5pc0FycmF5KG9iaikpcmV0dXJuIE1hdGgubWF4LmFwcGx5KE1hdGgsb2JqKTt2YXIgcmVzdWx0PXtjb21wdXRlZDotSW5maW5pdHl9O2VhY2gob2JqLGZ1bmN0aW9uKHZhbHVlLGluZGV4LGxpc3Qpe3ZhciBjb21wdXRlZD1pdGVyYXRvcj9pdGVyYXRvci5jYWxsKGNvbnRleHQsdmFsdWUsaW5kZXgsbGlzdCk6dmFsdWU7Y29tcHV0ZWQ+PXJlc3VsdC5jb21wdXRlZCYmKHJlc3VsdD17dmFsdWU6dmFsdWUsY29tcHV0ZWQ6Y29tcHV0ZWR9KTt9KTtyZXR1cm4gcmVzdWx0LnZhbHVlO307Xy5taW49ZnVuY3Rpb24ob2JqLGl0ZXJhdG9yLGNvbnRleHQpe2lmKCFpdGVyYXRvciYmXy5pc0FycmF5KG9iaikpcmV0dXJuIE1hdGgubWluLmFwcGx5KE1hdGgsb2JqKTt2YXIgcmVzdWx0PXtjb21wdXRlZDpJbmZpbml0eX07ZWFjaChvYmosZnVuY3Rpb24odmFsdWUsaW5kZXgsbGlzdCl7dmFyIGNvbXB1dGVkPWl0ZXJhdG9yP2l0ZXJhdG9yLmNhbGwoY29udGV4dCx2YWx1ZSxpbmRleCxsaXN0KTp2YWx1ZTtjb21wdXRlZDxyZXN1bHQuY29tcHV0ZWQmJihyZXN1bHQ9e3ZhbHVlOnZhbHVlLGNvbXB1dGVkOmNvbXB1dGVkfSk7fSk7cmV0dXJuIHJlc3VsdC52YWx1ZTt9O18uc29ydEJ5PWZ1bmN0aW9uKG9iaixpdGVyYXRvcixjb250ZXh0KXtyZXR1cm4gXy5wbHVjayhfLm1hcChvYmosZnVuY3Rpb24odmFsdWUsaW5kZXgsbGlzdCl7cmV0dXJue3ZhbHVlOnZhbHVlLGNyaXRlcmlhOml0ZXJhdG9yLmNhbGwoY29udGV4dCx2YWx1ZSxpbmRleCxsaXN0KX07fSkuc29ydChmdW5jdGlvbihsZWZ0LHJpZ2h0KXt2YXIgYT1sZWZ0LmNyaXRlcmlhLGI9cmlnaHQuY3JpdGVyaWE7cmV0dXJuIGE8Yj8tMTphPmI/MTowO30pLCd2YWx1ZScpO307Xy5ncm91cEJ5PWZ1bmN0aW9uKG9iaixpdGVyYXRvcil7dmFyIHJlc3VsdD17fTtlYWNoKG9iaixmdW5jdGlvbih2YWx1ZSxpbmRleCl7dmFyIGtleT1pdGVyYXRvcih2YWx1ZSxpbmRleCk7KHJlc3VsdFtrZXldfHwocmVzdWx0W2tleV09W10pKS5wdXNoKHZhbHVlKTt9KTtyZXR1cm4gcmVzdWx0O307Xy5zb3J0ZWRJbmRleD1mdW5jdGlvbihhcnJheSxvYmosaXRlcmF0b3Ipe2l0ZXJhdG9yfHwoaXRlcmF0b3I9Xy5pZGVudGl0eSk7dmFyIGxvdz0wLGhpZ2g9YXJyYXkubGVuZ3RoO3doaWxlKGxvdzxoaWdoKXt2YXIgbWlkPShsb3craGlnaCk+PjE7aXRlcmF0b3IoYXJyYXlbbWlkXSk8aXRlcmF0b3Iob2JqKT9sb3c9bWlkKzE6aGlnaD1taWQ7fQpyZXR1cm4gbG93O307Xy50b0FycmF5PWZ1bmN0aW9uKGl0ZXJhYmxlKXtpZighaXRlcmFibGUpcmV0dXJuW107aWYoaXRlcmFibGUudG9BcnJheSlyZXR1cm4gaXRlcmFibGUudG9BcnJheSgpO2lmKF8uaXNBcnJheShpdGVyYWJsZSkpcmV0dXJuIHNsaWNlLmNhbGwoaXRlcmFibGUpO2lmKF8uaXNBcmd1bWVudHMoaXRlcmFibGUpKXJldHVybiBzbGljZS5jYWxsKGl0ZXJhYmxlKTtyZXR1cm4gXy52YWx1ZXMoaXRlcmFibGUpO307Xy5zaXplPWZ1bmN0aW9uKG9iail7cmV0dXJuIF8udG9BcnJheShvYmopLmxlbmd0aDt9O18uZmlyc3Q9Xy5oZWFkPWZ1bmN0aW9uKGFycmF5LG4sZ3VhcmQpe3JldHVybihuIT1udWxsKSYmIWd1YXJkP3NsaWNlLmNhbGwoYXJyYXksMCxuKTphcnJheVswXTt9O18ucmVzdD1fLnRhaWw9ZnVuY3Rpb24oYXJyYXksaW5kZXgsZ3VhcmQpe3JldHVybiBzbGljZS5jYWxsKGFycmF5LChpbmRleD09bnVsbCl8fGd1YXJkPzE6aW5kZXgpO307Xy5sYXN0PWZ1bmN0aW9uKGFycmF5KXtyZXR1cm4gYXJyYXlbYXJyYXkubGVuZ3RoLTFdO307Xy5jb21wYWN0PWZ1bmN0aW9uKGFycmF5KXtyZXR1cm4gXy5maWx0ZXIoYXJyYXksZnVuY3Rpb24odmFsdWUpe3JldHVybiEhdmFsdWU7fSk7fTtfLmZsYXR0ZW49ZnVuY3Rpb24oYXJyYXkpe3JldHVybiBfLnJlZHVjZShhcnJheSxmdW5jdGlvbihtZW1vLHZhbHVlKXtpZihfLmlzQXJyYXkodmFsdWUpKXJldHVybiBtZW1vLmNvbmNhdChfLmZsYXR0ZW4odmFsdWUpKTttZW1vW21lbW8ubGVuZ3RoXT12YWx1ZTtyZXR1cm4gbWVtbzt9LFtdKTt9O18ud2l0aG91dD1mdW5jdGlvbihhcnJheSl7cmV0dXJuIF8uZGlmZmVyZW5jZShhcnJheSxzbGljZS5jYWxsKGFyZ3VtZW50cywxKSk7fTtfLnVuaXE9Xy51bmlxdWU9ZnVuY3Rpb24oYXJyYXksaXNTb3J0ZWQpe3JldHVybiBfLnJlZHVjZShhcnJheSxmdW5jdGlvbihtZW1vLGVsLGkpe2lmKDA9PWl8fChpc1NvcnRlZD09PXRydWU/Xy5sYXN0KG1lbW8pIT1lbDohXy5pbmNsdWRlKG1lbW8sZWwpKSltZW1vW21lbW8ubGVuZ3RoXT1lbDtyZXR1cm4gbWVtbzt9LFtdKTt9O18udW5pb249ZnVuY3Rpb24oKXtyZXR1cm4gXy51bmlxKF8uZmxhdHRlbihhcmd1bWVudHMpKTt9O18uaW50ZXJzZWN0aW9uPV8uaW50ZXJzZWN0PWZ1bmN0aW9uKGFycmF5KXt2YXIgcmVzdD1zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtyZXR1cm4gXy5maWx0ZXIoXy51bmlxKGFycmF5KSxmdW5jdGlvbihpdGVtKXtyZXR1cm4gXy5ldmVyeShyZXN0LGZ1bmN0aW9uKG90aGVyKXtyZXR1cm4gXy5pbmRleE9mKG90aGVyLGl0ZW0pPj0wO30pO30pO307Xy5kaWZmZXJlbmNlPWZ1bmN0aW9uKGFycmF5LG90aGVyKXtyZXR1cm4gXy5maWx0ZXIoYXJyYXksZnVuY3Rpb24odmFsdWUpe3JldHVybiFfLmluY2x1ZGUob3RoZXIsdmFsdWUpO30pO307Xy56aXA9ZnVuY3Rpb24oKXt2YXIgYXJncz1zbGljZS5jYWxsKGFyZ3VtZW50cyk7dmFyIGxlbmd0aD1fLm1heChfLnBsdWNrKGFyZ3MsJ2xlbmd0aCcpKTt2YXIgcmVzdWx0cz1uZXcgQXJyYXkobGVuZ3RoKTtmb3IodmFyIGk9MDtpPGxlbmd0aDtpKyspcmVzdWx0c1tpXT1fLnBsdWNrKGFyZ3MsIiIraSk7cmV0dXJuIHJlc3VsdHM7fTtfLmluZGV4T2Y9ZnVuY3Rpb24oYXJyYXksaXRlbSxpc1NvcnRlZCl7aWYoYXJyYXk9PW51bGwpcmV0dXJuLTE7dmFyIGksbDtpZihpc1NvcnRlZCl7aT1fLnNvcnRlZEluZGV4KGFycmF5LGl0ZW0pO3JldHVybiBhcnJheVtpXT09PWl0ZW0/aTotMTt9CmlmKG5hdGl2ZUluZGV4T2YmJmFycmF5LmluZGV4T2Y9PT1uYXRpdmVJbmRleE9mKXJldHVybiBhcnJheS5pbmRleE9mKGl0ZW0pO2ZvcihpPTAsbD1hcnJheS5sZW5ndGg7aTxsO2krKylpZihhcnJheVtpXT09PWl0ZW0pcmV0dXJuIGk7cmV0dXJuLTE7fTtfLmxhc3RJbmRleE9mPWZ1bmN0aW9uKGFycmF5LGl0ZW0pe2lmKGFycmF5PT1udWxsKXJldHVybi0xO2lmKG5hdGl2ZUxhc3RJbmRleE9mJiZhcnJheS5sYXN0SW5kZXhPZj09PW5hdGl2ZUxhc3RJbmRleE9mKXJldHVybiBhcnJheS5sYXN0SW5kZXhPZihpdGVtKTt2YXIgaT1hcnJheS5sZW5ndGg7d2hpbGUoaS0tKWlmKGFycmF5W2ldPT09aXRlbSlyZXR1cm4gaTtyZXR1cm4tMTt9O18ucmFuZ2U9ZnVuY3Rpb24oc3RhcnQsc3RvcCxzdGVwKXtpZihhcmd1bWVudHMubGVuZ3RoPD0xKXtzdG9wPXN0YXJ0fHwwO3N0YXJ0PTA7fQpzdGVwPWFyZ3VtZW50c1syXXx8MTt2YXIgbGVuPU1hdGgubWF4KE1hdGguY2VpbCgoc3RvcC1zdGFydCkvc3RlcCksMCk7dmFyIGlkeD0wO3ZhciByYW5nZT1uZXcgQXJyYXkobGVuKTt3aGlsZShpZHg8bGVuKXtyYW5nZVtpZHgrK109c3RhcnQ7c3RhcnQrPXN0ZXA7fQpyZXR1cm4gcmFuZ2U7fTtfLmJpbmQ9ZnVuY3Rpb24oZnVuYyxvYmope2lmKGZ1bmMuYmluZD09PW5hdGl2ZUJpbmQmJm5hdGl2ZUJpbmQpcmV0dXJuIG5hdGl2ZUJpbmQuYXBwbHkoZnVuYyxzbGljZS5jYWxsKGFyZ3VtZW50cywxKSk7dmFyIGFyZ3M9c2xpY2UuY2FsbChhcmd1bWVudHMsMik7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmMuYXBwbHkob2JqLGFyZ3MuY29uY2F0KHNsaWNlLmNhbGwoYXJndW1lbnRzKSkpO307fTtfLmJpbmRBbGw9ZnVuY3Rpb24ob2JqKXt2YXIgZnVuY3M9c2xpY2UuY2FsbChhcmd1bWVudHMsMSk7aWYoZnVuY3MubGVuZ3RoPT0wKWZ1bmNzPV8uZnVuY3Rpb25zKG9iaik7ZWFjaChmdW5jcyxmdW5jdGlvbihmKXtvYmpbZl09Xy5iaW5kKG9ialtmXSxvYmopO30pO3JldHVybiBvYmo7fTtfLm1lbW9pemU9ZnVuY3Rpb24oZnVuYyxoYXNoZXIpe3ZhciBtZW1vPXt9O2hhc2hlcnx8KGhhc2hlcj1fLmlkZW50aXR5KTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIga2V5PWhhc2hlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwobWVtbyxrZXkpP21lbW9ba2V5XToobWVtb1trZXldPWZ1bmMuYXBwbHkodGhpcyxhcmd1bWVudHMpKTt9O307Xy5kZWxheT1mdW5jdGlvbihmdW5jLHdhaXQpe3ZhciBhcmdzPXNsaWNlLmNhbGwoYXJndW1lbnRzLDIpO3JldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmMuYXBwbHkoZnVuYyxhcmdzKTt9LHdhaXQpO307Xy5kZWZlcj1mdW5jdGlvbihmdW5jKXtyZXR1cm4gXy5kZWxheS5hcHBseShfLFtmdW5jLDFdLmNvbmNhdChzbGljZS5jYWxsKGFyZ3VtZW50cywxKSkpO307dmFyIGxpbWl0PWZ1bmN0aW9uKGZ1bmMsd2FpdCxkZWJvdW5jZSl7dmFyIHRpbWVvdXQ7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGNvbnRleHQ9dGhpcyxhcmdzPWFyZ3VtZW50czt2YXIgdGhyb3R0bGVyPWZ1bmN0aW9uKCl7dGltZW91dD1udWxsO2Z1bmMuYXBwbHkoY29udGV4dCxhcmdzKTt9O2lmKGRlYm91bmNlKWNsZWFyVGltZW91dCh0aW1lb3V0KTtpZihkZWJvdW5jZXx8IXRpbWVvdXQpdGltZW91dD1zZXRUaW1lb3V0KHRocm90dGxlcix3YWl0KTt9O307Xy50aHJvdHRsZT1mdW5jdGlvbihmdW5jLHdhaXQpe3JldHVybiBsaW1pdChmdW5jLHdhaXQsZmFsc2UpO307Xy5kZWJvdW5jZT1mdW5jdGlvbihmdW5jLHdhaXQpe3JldHVybiBsaW1pdChmdW5jLHdhaXQsdHJ1ZSk7fTtfLm9uY2U9ZnVuY3Rpb24oZnVuYyl7dmFyIHJhbj1mYWxzZSxtZW1vO3JldHVybiBmdW5jdGlvbigpe2lmKHJhbilyZXR1cm4gbWVtbztyYW49dHJ1ZTtyZXR1cm4gbWVtbz1mdW5jLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt9O307Xy53cmFwPWZ1bmN0aW9uKGZ1bmMsd3JhcHBlcil7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGFyZ3M9W2Z1bmNdLmNvbmNhdChzbGljZS5jYWxsKGFyZ3VtZW50cykpO3JldHVybiB3cmFwcGVyLmFwcGx5KHRoaXMsYXJncyk7fTt9O18uY29tcG9zZT1mdW5jdGlvbigpe3ZhciBmdW5jcz1zbGljZS5jYWxsKGFyZ3VtZW50cyk7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGFyZ3M9c2xpY2UuY2FsbChhcmd1bWVudHMpO2Zvcih2YXIgaT1mdW5jcy5sZW5ndGgtMTtpPj0wO2ktLSl7YXJncz1bZnVuY3NbaV0uYXBwbHkodGhpcyxhcmdzKV07fQpyZXR1cm4gYXJnc1swXTt9O307Xy5hZnRlcj1mdW5jdGlvbih0aW1lcyxmdW5jKXtyZXR1cm4gZnVuY3Rpb24oKXtpZigtLXRpbWVzPDEpe3JldHVybiBmdW5jLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt9fTt9O18ua2V5cz1uYXRpdmVLZXlzfHxmdW5jdGlvbihvYmope2lmKG9iaiE9PU9iamVjdChvYmopKXRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgb2JqZWN0Jyk7dmFyIGtleXM9W107Zm9yKHZhciBrZXkgaW4gb2JqKWlmKGhhc093blByb3BlcnR5LmNhbGwob2JqLGtleSkpa2V5c1trZXlzLmxlbmd0aF09a2V5O3JldHVybiBrZXlzO307Xy52YWx1ZXM9ZnVuY3Rpb24ob2JqKXtyZXR1cm4gXy5tYXAob2JqLF8uaWRlbnRpdHkpO307Xy5mdW5jdGlvbnM9Xy5tZXRob2RzPWZ1bmN0aW9uKG9iail7dmFyIG5hbWVzPVtdO2Zvcih2YXIga2V5IGluIG9iail7aWYoXy5pc0Z1bmN0aW9uKG9ialtrZXldKSluYW1lcy5wdXNoKGtleSk7fQpyZXR1cm4gbmFtZXMuc29ydCgpO307Xy5leHRlbmQ9ZnVuY3Rpb24ob2JqKXtlYWNoKHNsaWNlLmNhbGwoYXJndW1lbnRzLDEpLGZ1bmN0aW9uKHNvdXJjZSl7Zm9yKHZhciBwcm9wIGluIHNvdXJjZSl7aWYoc291cmNlW3Byb3BdIT09dm9pZCAwKW9ialtwcm9wXT1zb3VyY2VbcHJvcF07fX0pO3JldHVybiBvYmo7fTtfLmRlZmF1bHRzPWZ1bmN0aW9uKG9iail7ZWFjaChzbGljZS5jYWxsKGFyZ3VtZW50cywxKSxmdW5jdGlvbihzb3VyY2Upe2Zvcih2YXIgcHJvcCBpbiBzb3VyY2Upe2lmKG9ialtwcm9wXT09bnVsbClvYmpbcHJvcF09c291cmNlW3Byb3BdO319KTtyZXR1cm4gb2JqO307Xy5jbG9uZT1mdW5jdGlvbihvYmope3JldHVybiBfLmlzQXJyYXkob2JqKT9vYmouc2xpY2UoKTpfLmV4dGVuZCh7fSxvYmopO307Xy50YXA9ZnVuY3Rpb24ob2JqLGludGVyY2VwdG9yKXtpbnRlcmNlcHRvcihvYmopO3JldHVybiBvYmo7fTtfLmlzRXF1YWw9ZnVuY3Rpb24oYSxiKXtpZihhPT09YilyZXR1cm4gdHJ1ZTt2YXIgYXR5cGU9dHlwZW9mKGEpLGJ0eXBlPXR5cGVvZihiKTtpZihhdHlwZSE9YnR5cGUpcmV0dXJuIGZhbHNlO2lmKGE9PWIpcmV0dXJuIHRydWU7aWYoKCFhJiZiKXx8KGEmJiFiKSlyZXR1cm4gZmFsc2U7aWYoYS5fY2hhaW4pYT1hLl93cmFwcGVkO2lmKGIuX2NoYWluKWI9Yi5fd3JhcHBlZDtpZihhLmlzRXF1YWwpcmV0dXJuIGEuaXNFcXVhbChiKTtpZihiLmlzRXF1YWwpcmV0dXJuIGIuaXNFcXVhbChhKTtpZihfLmlzRGF0ZShhKSYmXy5pc0RhdGUoYikpcmV0dXJuIGEuZ2V0VGltZSgpPT09Yi5nZXRUaW1lKCk7aWYoXy5pc05hTihhKSYmXy5pc05hTihiKSlyZXR1cm4gZmFsc2U7aWYoXy5pc1JlZ0V4cChhKSYmXy5pc1JlZ0V4cChiKSkKcmV0dXJuIGEuc291cmNlPT09Yi5zb3VyY2UmJmEuZ2xvYmFsPT09Yi5nbG9iYWwmJmEuaWdub3JlQ2FzZT09PWIuaWdub3JlQ2FzZSYmYS5tdWx0aWxpbmU9PT1iLm11bHRpbGluZTtpZihhdHlwZSE9PSdvYmplY3QnKXJldHVybiBmYWxzZTtpZihhLmxlbmd0aCYmKGEubGVuZ3RoIT09Yi5sZW5ndGgpKXJldHVybiBmYWxzZTt2YXIgYUtleXM9Xy5rZXlzKGEpLGJLZXlzPV8ua2V5cyhiKTtpZihhS2V5cy5sZW5ndGghPWJLZXlzLmxlbmd0aClyZXR1cm4gZmFsc2U7Zm9yKHZhciBrZXkgaW4gYSlpZighKGtleSBpbiBiKXx8IV8uaXNFcXVhbChhW2tleV0sYltrZXldKSlyZXR1cm4gZmFsc2U7cmV0dXJuIHRydWU7fTtfLmlzRW1wdHk9ZnVuY3Rpb24ob2JqKXtpZihfLmlzQXJyYXkob2JqKXx8Xy5pc1N0cmluZyhvYmopKXJldHVybiBvYmoubGVuZ3RoPT09MDtmb3IodmFyIGtleSBpbiBvYmopaWYoaGFzT3duUHJvcGVydHkuY2FsbChvYmosa2V5KSlyZXR1cm4gZmFsc2U7cmV0dXJuIHRydWU7fTtfLmlzRWxlbWVudD1mdW5jdGlvbihvYmope3JldHVybiEhKG9iaiYmb2JqLm5vZGVUeXBlPT0xKTt9O18uaXNBcnJheT1uYXRpdmVJc0FycmF5fHxmdW5jdGlvbihvYmope3JldHVybiB0b1N0cmluZy5jYWxsKG9iaik9PT0nW29iamVjdCBBcnJheV0nO307Xy5pc09iamVjdD1mdW5jdGlvbihvYmope3JldHVybiBvYmo9PT1PYmplY3Qob2JqKTt9O18uaXNBcmd1bWVudHM9ZnVuY3Rpb24ob2JqKXtyZXR1cm4hIShvYmomJmhhc093blByb3BlcnR5LmNhbGwob2JqLCdjYWxsZWUnKSk7fTtfLmlzRnVuY3Rpb249ZnVuY3Rpb24ob2JqKXtyZXR1cm4hIShvYmomJm9iai5jb25zdHJ1Y3RvciYmb2JqLmNhbGwmJm9iai5hcHBseSk7fTtfLmlzU3RyaW5nPWZ1bmN0aW9uKG9iail7cmV0dXJuISEob2JqPT09Jyd8fChvYmomJm9iai5jaGFyQ29kZUF0JiZvYmouc3Vic3RyKSk7fTtfLmlzTnVtYmVyPWZ1bmN0aW9uKG9iail7cmV0dXJuISEob2JqPT09MHx8KG9iaiYmb2JqLnRvRXhwb25lbnRpYWwmJm9iai50b0ZpeGVkKSk7fTtfLmlzTmFOPWZ1bmN0aW9uKG9iail7cmV0dXJuIG9iaiE9PW9iajt9O18uaXNCb29sZWFuPWZ1bmN0aW9uKG9iail7cmV0dXJuIG9iaj09PXRydWV8fG9iaj09PWZhbHNlO307Xy5pc0RhdGU9ZnVuY3Rpb24ob2JqKXtyZXR1cm4hIShvYmomJm9iai5nZXRUaW1lem9uZU9mZnNldCYmb2JqLnNldFVUQ0Z1bGxZZWFyKTt9O18uaXNSZWdFeHA9ZnVuY3Rpb24ob2JqKXtyZXR1cm4hIShvYmomJm9iai50ZXN0JiZvYmouZXhlYyYmKG9iai5pZ25vcmVDYXNlfHxvYmouaWdub3JlQ2FzZT09PWZhbHNlKSk7fTtfLmlzTnVsbD1mdW5jdGlvbihvYmope3JldHVybiBvYmo9PT1udWxsO307Xy5pc1VuZGVmaW5lZD1mdW5jdGlvbihvYmope3JldHVybiBvYmo9PT12b2lkIDA7fTtfLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyb290Ll89cHJldmlvdXNVbmRlcnNjb3JlO3JldHVybiB0aGlzO307Xy5pZGVudGl0eT1mdW5jdGlvbih2YWx1ZSl7cmV0dXJuIHZhbHVlO307Xy50aW1lcz1mdW5jdGlvbihuLGl0ZXJhdG9yLGNvbnRleHQpe2Zvcih2YXIgaT0wO2k8bjtpKyspaXRlcmF0b3IuY2FsbChjb250ZXh0LGkpO307Xy5taXhpbj1mdW5jdGlvbihvYmope2VhY2goXy5mdW5jdGlvbnMob2JqKSxmdW5jdGlvbihuYW1lKXthZGRUb1dyYXBwZXIobmFtZSxfW25hbWVdPW9ialtuYW1lXSk7fSk7fTt2YXIgaWRDb3VudGVyPTA7Xy51bmlxdWVJZD1mdW5jdGlvbihwcmVmaXgpe3ZhciBpZD1pZENvdW50ZXIrKztyZXR1cm4gcHJlZml4P3ByZWZpeCtpZDppZDt9O18udGVtcGxhdGVTZXR0aW5ncz17ZXZhbHVhdGU6LzwlKFtcc1xTXSs/KSU+L2csaW50ZXJwb2xhdGU6LzwlPShbXHNcU10rPyklPi9nfTtfLnRlbXBsYXRlPWZ1bmN0aW9uKHN0cixkYXRhKXt2YXIgYz1fLnRlbXBsYXRlU2V0dGluZ3M7dmFyIHRtcGw9J3ZhciBfX3A9W10scHJpbnQ9ZnVuY3Rpb24oKXtfX3AucHVzaC5hcHBseShfX3AsYXJndW1lbnRzKTt9OycrJ3dpdGgob2JqfHx7fSl7X19wLnB1c2goXCcnKwpzdHIucmVwbGFjZSgvXFwvZywnXFxcXCcpLnJlcGxhY2UoLycvZywiXFwnIikucmVwbGFjZShjLmludGVycG9sYXRlLGZ1bmN0aW9uKG1hdGNoLGNvZGUpe3JldHVybiInLCIrY29kZS5yZXBsYWNlKC9cXCcvZywiJyIpKyIsJyI7fSkucmVwbGFjZShjLmV2YWx1YXRlfHxudWxsLGZ1bmN0aW9uKG1hdGNoLGNvZGUpe3JldHVybiInKTsiK2NvZGUucmVwbGFjZSgvXFwnL2csIiciKS5yZXBsYWNlKC9bXHJcblx0XS9nLCcgJykrIl9fcC5wdXNoKCciO30pLnJlcGxhY2UoL1xyL2csJ1xccicpLnJlcGxhY2UoL1xuL2csJ1xcbicpLnJlcGxhY2UoL1x0L2csJ1xcdCcpCisiJyk7fXJldHVybiBfX3Auam9pbignJyk7Ijt2YXIgZnVuYz1uZXcgRnVuY3Rpb24oJ29iaicsdG1wbCk7cmV0dXJuIGRhdGE/ZnVuYyhkYXRhKTpmdW5jO307dmFyIHdyYXBwZXI9ZnVuY3Rpb24ob2JqKXt0aGlzLl93cmFwcGVkPW9iajt9O18ucHJvdG90eXBlPXdyYXBwZXIucHJvdG90eXBlO3ZhciByZXN1bHQ9ZnVuY3Rpb24ob2JqLGNoYWluKXtyZXR1cm4gY2hhaW4/XyhvYmopLmNoYWluKCk6b2JqO307dmFyIGFkZFRvV3JhcHBlcj1mdW5jdGlvbihuYW1lLGZ1bmMpe3dyYXBwZXIucHJvdG90eXBlW25hbWVdPWZ1bmN0aW9uKCl7dmFyIGFyZ3M9c2xpY2UuY2FsbChhcmd1bWVudHMpO3Vuc2hpZnQuY2FsbChhcmdzLHRoaXMuX3dyYXBwZWQpO3JldHVybiByZXN1bHQoZnVuYy5hcHBseShfLGFyZ3MpLHRoaXMuX2NoYWluKTt9O307Xy5taXhpbihfKTtlYWNoKFsncG9wJywncHVzaCcsJ3JldmVyc2UnLCdzaGlmdCcsJ3NvcnQnLCdzcGxpY2UnLCd1bnNoaWZ0J10sZnVuY3Rpb24obmFtZSl7dmFyIG1ldGhvZD1BcnJheVByb3RvW25hbWVdO3dyYXBwZXIucHJvdG90eXBlW25hbWVdPWZ1bmN0aW9uKCl7bWV0aG9kLmFwcGx5KHRoaXMuX3dyYXBwZWQsYXJndW1lbnRzKTtyZXR1cm4gcmVzdWx0KHRoaXMuX3dyYXBwZWQsdGhpcy5fY2hhaW4pO307fSk7ZWFjaChbJ2NvbmNhdCcsJ2pvaW4nLCdzbGljZSddLGZ1bmN0aW9uKG5hbWUpe3ZhciBtZXRob2Q9QXJyYXlQcm90b1tuYW1lXTt3cmFwcGVyLnByb3RvdHlwZVtuYW1lXT1mdW5jdGlvbigpe3JldHVybiByZXN1bHQobWV0aG9kLmFwcGx5KHRoaXMuX3dyYXBwZWQsYXJndW1lbnRzKSx0aGlzLl9jaGFpbik7fTt9KTt3cmFwcGVyLnByb3RvdHlwZS5jaGFpbj1mdW5jdGlvbigpe3RoaXMuX2NoYWluPXRydWU7cmV0dXJuIHRoaXM7fTt3cmFwcGVyLnByb3RvdHlwZS52YWx1ZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl93cmFwcGVkO307fSkoKTsoZnVuY3Rpb24oKXt2YXIgYXN5bmM9e307dmFyIHJvb3Q9dGhpcyxwcmV2aW91c19hc3luYz1yb290LmFzeW5jO2lmKHR5cGVvZiBtb2R1bGUhPT0ndW5kZWZpbmVkJyYmbW9kdWxlLmV4cG9ydHMpe21vZHVsZS5leHBvcnRzPWFzeW5jO30KZWxzZXtyb290LmFzeW5jPWFzeW5jO30KYXN5bmMubm9Db25mbGljdD1mdW5jdGlvbigpe3Jvb3QuYXN5bmM9cHJldmlvdXNfYXN5bmM7cmV0dXJuIGFzeW5jO307dmFyIF9mb3JFYWNoPWZ1bmN0aW9uKGFycixpdGVyYXRvcil7aWYoYXJyLmZvckVhY2gpe3JldHVybiBhcnIuZm9yRWFjaChpdGVyYXRvcik7fQpmb3IodmFyIGk9MDtpPGFyci5sZW5ndGg7aSs9MSl7aXRlcmF0b3IoYXJyW2ldLGksYXJyKTt9fTt2YXIgX21hcD1mdW5jdGlvbihhcnIsaXRlcmF0b3Ipe2lmKGFyci5tYXApe3JldHVybiBhcnIubWFwKGl0ZXJhdG9yKTt9CnZhciByZXN1bHRzPVtdO19mb3JFYWNoKGFycixmdW5jdGlvbih4LGksYSl7cmVzdWx0cy5wdXNoKGl0ZXJhdG9yKHgsaSxhKSk7fSk7cmV0dXJuIHJlc3VsdHM7fTt2YXIgX3JlZHVjZT1mdW5jdGlvbihhcnIsaXRlcmF0b3IsbWVtbyl7aWYoYXJyLnJlZHVjZSl7cmV0dXJuIGFyci5yZWR1Y2UoaXRlcmF0b3IsbWVtbyk7fQpfZm9yRWFjaChhcnIsZnVuY3Rpb24oeCxpLGEpe21lbW89aXRlcmF0b3IobWVtbyx4LGksYSk7fSk7cmV0dXJuIG1lbW87fTt2YXIgX2tleXM9ZnVuY3Rpb24ob2JqKXtpZihPYmplY3Qua2V5cyl7cmV0dXJuIE9iamVjdC5rZXlzKG9iaik7fQp2YXIga2V5cz1bXTtmb3IodmFyIGsgaW4gb2JqKXtpZihvYmouaGFzT3duUHJvcGVydHkoaykpe2tleXMucHVzaChrKTt9fQpyZXR1cm4ga2V5czt9O3ZhciBfaW5kZXhPZj1mdW5jdGlvbihhcnIsaXRlbSl7aWYoYXJyLmluZGV4T2Ype3JldHVybiBhcnIuaW5kZXhPZihpdGVtKTt9CmZvcih2YXIgaT0wO2k8YXJyLmxlbmd0aDtpKz0xKXtpZihhcnJbaV09PT1pdGVtKXtyZXR1cm4gaTt9fQpyZXR1cm4tMTt9O2FzeW5jLm5leHRUaWNrPWZ1bmN0aW9uKGZuKXtpZih0eXBlb2YgcHJvY2Vzcz09PSd1bmRlZmluZWQnfHwhKHByb2Nlc3MubmV4dFRpY2spKXtzZXRUaW1lb3V0KGZuLDApO30KZWxzZXtwcm9jZXNzLm5leHRUaWNrKGZuKTt9fTthc3luYy5mb3JFYWNoPWZ1bmN0aW9uKGFycixpdGVyYXRvcixjYWxsYmFjayl7aWYoIWFyci5sZW5ndGgpe3JldHVybiBjYWxsYmFjaygpO30KdmFyIGNvbXBsZXRlZD0wO19mb3JFYWNoKGFycixmdW5jdGlvbih4KXtpdGVyYXRvcih4LGZ1bmN0aW9uKGVycil7aWYoZXJyKXtjYWxsYmFjayhlcnIpO2NhbGxiYWNrPWZ1bmN0aW9uKCl7fTt9CmVsc2V7Y29tcGxldGVkKz0xO2lmKGNvbXBsZXRlZD09PWFyci5sZW5ndGgpe2NhbGxiYWNrKCk7fX19KTt9KTt9O2FzeW5jLmZvckVhY2hTZXJpZXM9ZnVuY3Rpb24oYXJyLGl0ZXJhdG9yLGNhbGxiYWNrKXtpZighYXJyLmxlbmd0aCl7cmV0dXJuIGNhbGxiYWNrKCk7fQp2YXIgY29tcGxldGVkPTA7dmFyIGl0ZXJhdGU9ZnVuY3Rpb24oKXtpdGVyYXRvcihhcnJbY29tcGxldGVkXSxmdW5jdGlvbihlcnIpe2lmKGVycil7Y2FsbGJhY2soZXJyKTtjYWxsYmFjaz1mdW5jdGlvbigpe307fQplbHNle2NvbXBsZXRlZCs9MTtpZihjb21wbGV0ZWQ9PT1hcnIubGVuZ3RoKXtjYWxsYmFjaygpO30KZWxzZXtpdGVyYXRlKCk7fX19KTt9O2l0ZXJhdGUoKTt9O3ZhciBkb1BhcmFsbGVsPWZ1bmN0aW9uKGZuKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgYXJncz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO3JldHVybiBmbi5hcHBseShudWxsLFthc3luYy5mb3JFYWNoXS5jb25jYXQoYXJncykpO307fTt2YXIgZG9TZXJpZXM9ZnVuY3Rpb24oZm4pe3JldHVybiBmdW5jdGlvbigpe3ZhciBhcmdzPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7cmV0dXJuIGZuLmFwcGx5KG51bGwsW2FzeW5jLmZvckVhY2hTZXJpZXNdLmNvbmNhdChhcmdzKSk7fTt9O3ZhciBfYXN5bmNNYXA9ZnVuY3Rpb24oZWFjaGZuLGFycixpdGVyYXRvcixjYWxsYmFjayl7dmFyIHJlc3VsdHM9W107YXJyPV9tYXAoYXJyLGZ1bmN0aW9uKHgsaSl7cmV0dXJue2luZGV4OmksdmFsdWU6eH07fSk7ZWFjaGZuKGFycixmdW5jdGlvbih4LGNhbGxiYWNrKXtpdGVyYXRvcih4LnZhbHVlLGZ1bmN0aW9uKGVycix2KXtyZXN1bHRzW3guaW5kZXhdPXY7Y2FsbGJhY2soZXJyKTt9KTt9LGZ1bmN0aW9uKGVycil7Y2FsbGJhY2soZXJyLHJlc3VsdHMpO30pO307YXN5bmMubWFwPWRvUGFyYWxsZWwoX2FzeW5jTWFwKTthc3luYy5tYXBTZXJpZXM9ZG9TZXJpZXMoX2FzeW5jTWFwKTthc3luYy5yZWR1Y2U9ZnVuY3Rpb24oYXJyLG1lbW8saXRlcmF0b3IsY2FsbGJhY2spe2FzeW5jLmZvckVhY2hTZXJpZXMoYXJyLGZ1bmN0aW9uKHgsY2FsbGJhY2spe2l0ZXJhdG9yKG1lbW8seCxmdW5jdGlvbihlcnIsdil7bWVtbz12O2NhbGxiYWNrKGVycik7fSk7fSxmdW5jdGlvbihlcnIpe2NhbGxiYWNrKGVycixtZW1vKTt9KTt9O2FzeW5jLmluamVjdD1hc3luYy5yZWR1Y2U7YXN5bmMuZm9sZGw9YXN5bmMucmVkdWNlO2FzeW5jLnJlZHVjZVJpZ2h0PWZ1bmN0aW9uKGFycixtZW1vLGl0ZXJhdG9yLGNhbGxiYWNrKXt2YXIgcmV2ZXJzZWQ9X21hcChhcnIsZnVuY3Rpb24oeCl7cmV0dXJuIHg7fSkucmV2ZXJzZSgpO2FzeW5jLnJlZHVjZShyZXZlcnNlZCxtZW1vLGl0ZXJhdG9yLGNhbGxiYWNrKTt9O2FzeW5jLmZvbGRyPWFzeW5jLnJlZHVjZVJpZ2h0O3ZhciBfZmlsdGVyPWZ1bmN0aW9uKGVhY2hmbixhcnIsaXRlcmF0b3IsY2FsbGJhY2spe3ZhciByZXN1bHRzPVtdO2Fycj1fbWFwKGFycixmdW5jdGlvbih4LGkpe3JldHVybntpbmRleDppLHZhbHVlOnh9O30pO2VhY2hmbihhcnIsZnVuY3Rpb24oeCxjYWxsYmFjayl7aXRlcmF0b3IoeC52YWx1ZSxmdW5jdGlvbih2KXtpZih2KXtyZXN1bHRzLnB1c2goeCk7fQpjYWxsYmFjaygpO30pO30sZnVuY3Rpb24oZXJyKXtjYWxsYmFjayhfbWFwKHJlc3VsdHMuc29ydChmdW5jdGlvbihhLGIpe3JldHVybiBhLmluZGV4LWIuaW5kZXg7fSksZnVuY3Rpb24oeCl7cmV0dXJuIHgudmFsdWU7fSkpO30pO307YXN5bmMuZmlsdGVyPWRvUGFyYWxsZWwoX2ZpbHRlcik7YXN5bmMuZmlsdGVyU2VyaWVzPWRvU2VyaWVzKF9maWx0ZXIpO2FzeW5jLnNlbGVjdD1hc3luYy5maWx0ZXI7YXN5bmMuc2VsZWN0U2VyaWVzPWFzeW5jLmZpbHRlclNlcmllczt2YXIgX3JlamVjdD1mdW5jdGlvbihlYWNoZm4sYXJyLGl0ZXJhdG9yLGNhbGxiYWNrKXt2YXIgcmVzdWx0cz1bXTthcnI9X21hcChhcnIsZnVuY3Rpb24oeCxpKXtyZXR1cm57aW5kZXg6aSx2YWx1ZTp4fTt9KTtlYWNoZm4oYXJyLGZ1bmN0aW9uKHgsY2FsbGJhY2spe2l0ZXJhdG9yKHgudmFsdWUsZnVuY3Rpb24odil7aWYoIXYpe3Jlc3VsdHMucHVzaCh4KTt9CmNhbGxiYWNrKCk7fSk7fSxmdW5jdGlvbihlcnIpe2NhbGxiYWNrKF9tYXAocmVzdWx0cy5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuaW5kZXgtYi5pbmRleDt9KSxmdW5jdGlvbih4KXtyZXR1cm4geC52YWx1ZTt9KSk7fSk7fTthc3luYy5yZWplY3Q9ZG9QYXJhbGxlbChfcmVqZWN0KTthc3luYy5yZWplY3RTZXJpZXM9ZG9TZXJpZXMoX3JlamVjdCk7dmFyIF9kZXRlY3Q9ZnVuY3Rpb24oZWFjaGZuLGFycixpdGVyYXRvcixtYWluX2NhbGxiYWNrKXtlYWNoZm4oYXJyLGZ1bmN0aW9uKHgsY2FsbGJhY2spe2l0ZXJhdG9yKHgsZnVuY3Rpb24ocmVzdWx0KXtpZihyZXN1bHQpe21haW5fY2FsbGJhY2soeCk7fQplbHNle2NhbGxiYWNrKCk7fX0pO30sZnVuY3Rpb24oZXJyKXttYWluX2NhbGxiYWNrKCk7fSk7fTthc3luYy5kZXRlY3Q9ZG9QYXJhbGxlbChfZGV0ZWN0KTthc3luYy5kZXRlY3RTZXJpZXM9ZG9TZXJpZXMoX2RldGVjdCk7YXN5bmMuc29tZT1mdW5jdGlvbihhcnIsaXRlcmF0b3IsbWFpbl9jYWxsYmFjayl7YXN5bmMuZm9yRWFjaChhcnIsZnVuY3Rpb24oeCxjYWxsYmFjayl7aXRlcmF0b3IoeCxmdW5jdGlvbih2KXtpZih2KXttYWluX2NhbGxiYWNrKHRydWUpO21haW5fY2FsbGJhY2s9ZnVuY3Rpb24oKXt9O30KY2FsbGJhY2soKTt9KTt9LGZ1bmN0aW9uKGVycil7bWFpbl9jYWxsYmFjayhmYWxzZSk7fSk7fTthc3luYy5hbnk9YXN5bmMuc29tZTthc3luYy5ldmVyeT1mdW5jdGlvbihhcnIsaXRlcmF0b3IsbWFpbl9jYWxsYmFjayl7YXN5bmMuZm9yRWFjaChhcnIsZnVuY3Rpb24oeCxjYWxsYmFjayl7aXRlcmF0b3IoeCxmdW5jdGlvbih2KXtpZighdil7bWFpbl9jYWxsYmFjayhmYWxzZSk7bWFpbl9jYWxsYmFjaz1mdW5jdGlvbigpe307fQpjYWxsYmFjaygpO30pO30sZnVuY3Rpb24oZXJyKXttYWluX2NhbGxiYWNrKHRydWUpO30pO307YXN5bmMuYWxsPWFzeW5jLmV2ZXJ5O2FzeW5jLnNvcnRCeT1mdW5jdGlvbihhcnIsaXRlcmF0b3IsY2FsbGJhY2spe2FzeW5jLm1hcChhcnIsZnVuY3Rpb24oeCxjYWxsYmFjayl7aXRlcmF0b3IoeCxmdW5jdGlvbihlcnIsY3JpdGVyaWEpe2lmKGVycil7Y2FsbGJhY2soZXJyKTt9CmVsc2V7Y2FsbGJhY2sobnVsbCx7dmFsdWU6eCxjcml0ZXJpYTpjcml0ZXJpYX0pO319KTt9LGZ1bmN0aW9uKGVycixyZXN1bHRzKXtpZihlcnIpe3JldHVybiBjYWxsYmFjayhlcnIpO30KZWxzZXt2YXIgZm49ZnVuY3Rpb24obGVmdCxyaWdodCl7dmFyIGE9bGVmdC5jcml0ZXJpYSxiPXJpZ2h0LmNyaXRlcmlhO3JldHVybiBhPGI/LTE6YT5iPzE6MDt9O2NhbGxiYWNrKG51bGwsX21hcChyZXN1bHRzLnNvcnQoZm4pLGZ1bmN0aW9uKHgpe3JldHVybiB4LnZhbHVlO30pKTt9fSk7fTthc3luYy5hdXRvPWZ1bmN0aW9uKHRhc2tzLGNhbGxiYWNrKXtjYWxsYmFjaz1jYWxsYmFja3x8ZnVuY3Rpb24oKXt9O3ZhciBrZXlzPV9rZXlzKHRhc2tzKTtpZigha2V5cy5sZW5ndGgpe3JldHVybiBjYWxsYmFjayhudWxsKTt9CnZhciBjb21wbGV0ZWQ9W107dmFyIGxpc3RlbmVycz1bXTt2YXIgYWRkTGlzdGVuZXI9ZnVuY3Rpb24oZm4pe2xpc3RlbmVycy51bnNoaWZ0KGZuKTt9O3ZhciByZW1vdmVMaXN0ZW5lcj1mdW5jdGlvbihmbil7Zm9yKHZhciBpPTA7aTxsaXN0ZW5lcnMubGVuZ3RoO2krPTEpe2lmKGxpc3RlbmVyc1tpXT09PWZuKXtsaXN0ZW5lcnMuc3BsaWNlKGksMSk7cmV0dXJuO319fTt2YXIgdGFza0NvbXBsZXRlPWZ1bmN0aW9uKCl7X2ZvckVhY2gobGlzdGVuZXJzLGZ1bmN0aW9uKGZuKXtmbigpO30pO307YWRkTGlzdGVuZXIoZnVuY3Rpb24oKXtpZihjb21wbGV0ZWQubGVuZ3RoPT09a2V5cy5sZW5ndGgpe2NhbGxiYWNrKG51bGwpO319KTtfZm9yRWFjaChrZXlzLGZ1bmN0aW9uKGspe3ZhciB0YXNrPSh0YXNrc1trXWluc3RhbmNlb2YgRnVuY3Rpb24pP1t0YXNrc1trXV06dGFza3Nba107dmFyIHRhc2tDYWxsYmFjaz1mdW5jdGlvbihlcnIpe2lmKGVycil7Y2FsbGJhY2soZXJyKTtjYWxsYmFjaz1mdW5jdGlvbigpe307fQplbHNle2NvbXBsZXRlZC5wdXNoKGspO3Rhc2tDb21wbGV0ZSgpO319O3ZhciByZXF1aXJlcz10YXNrLnNsaWNlKDAsTWF0aC5hYnModGFzay5sZW5ndGgtMSkpfHxbXTt2YXIgcmVhZHk9ZnVuY3Rpb24oKXtyZXR1cm4gX3JlZHVjZShyZXF1aXJlcyxmdW5jdGlvbihhLHgpe3JldHVybihhJiZfaW5kZXhPZihjb21wbGV0ZWQseCkhPT0tMSk7fSx0cnVlKTt9O2lmKHJlYWR5KCkpe3Rhc2tbdGFzay5sZW5ndGgtMV0odGFza0NhbGxiYWNrKTt9CmVsc2V7dmFyIGxpc3RlbmVyPWZ1bmN0aW9uKCl7aWYocmVhZHkoKSl7cmVtb3ZlTGlzdGVuZXIobGlzdGVuZXIpO3Rhc2tbdGFzay5sZW5ndGgtMV0odGFza0NhbGxiYWNrKTt9fTthZGRMaXN0ZW5lcihsaXN0ZW5lcik7fX0pO307YXN5bmMud2F0ZXJmYWxsPWZ1bmN0aW9uKHRhc2tzLGNhbGxiYWNrKXtpZighdGFza3MubGVuZ3RoKXtyZXR1cm4gY2FsbGJhY2soKTt9CmNhbGxiYWNrPWNhbGxiYWNrfHxmdW5jdGlvbigpe307dmFyIHdyYXBJdGVyYXRvcj1mdW5jdGlvbihpdGVyYXRvcil7cmV0dXJuIGZ1bmN0aW9uKGVycil7aWYoZXJyKXtjYWxsYmFjayhlcnIpO2NhbGxiYWNrPWZ1bmN0aW9uKCl7fTt9CmVsc2V7dmFyIGFyZ3M9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO3ZhciBuZXh0PWl0ZXJhdG9yLm5leHQoKTtpZihuZXh0KXthcmdzLnB1c2god3JhcEl0ZXJhdG9yKG5leHQpKTt9CmVsc2V7YXJncy5wdXNoKGNhbGxiYWNrKTt9CmFzeW5jLm5leHRUaWNrKGZ1bmN0aW9uKCl7aXRlcmF0b3IuYXBwbHkobnVsbCxhcmdzKTt9KTt9fTt9O3dyYXBJdGVyYXRvcihhc3luYy5pdGVyYXRvcih0YXNrcykpKCk7fTthc3luYy5wYXJhbGxlbD1mdW5jdGlvbih0YXNrcyxjYWxsYmFjayl7Y2FsbGJhY2s9Y2FsbGJhY2t8fGZ1bmN0aW9uKCl7fTtpZih0YXNrcy5jb25zdHJ1Y3Rvcj09PUFycmF5KXthc3luYy5tYXAodGFza3MsZnVuY3Rpb24oZm4sY2FsbGJhY2spe2lmKGZuKXtmbihmdW5jdGlvbihlcnIpe3ZhciBhcmdzPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtpZihhcmdzLmxlbmd0aDw9MSl7YXJncz1hcmdzWzBdO30KY2FsbGJhY2suY2FsbChudWxsLGVycixhcmdzfHxudWxsKTt9KTt9fSxjYWxsYmFjayk7fQplbHNle3ZhciByZXN1bHRzPXt9O2FzeW5jLmZvckVhY2goX2tleXModGFza3MpLGZ1bmN0aW9uKGssY2FsbGJhY2spe3Rhc2tzW2tdKGZ1bmN0aW9uKGVycil7dmFyIGFyZ3M9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO2lmKGFyZ3MubGVuZ3RoPD0xKXthcmdzPWFyZ3NbMF07fQpyZXN1bHRzW2tdPWFyZ3M7Y2FsbGJhY2soZXJyKTt9KTt9LGZ1bmN0aW9uKGVycil7Y2FsbGJhY2soZXJyLHJlc3VsdHMpO30pO319O2FzeW5jLnNlcmllcz1mdW5jdGlvbih0YXNrcyxjYWxsYmFjayl7Y2FsbGJhY2s9Y2FsbGJhY2t8fGZ1bmN0aW9uKCl7fTtpZih0YXNrcy5jb25zdHJ1Y3Rvcj09PUFycmF5KXthc3luYy5tYXBTZXJpZXModGFza3MsZnVuY3Rpb24oZm4sY2FsbGJhY2spe2lmKGZuKXtmbihmdW5jdGlvbihlcnIpe3ZhciBhcmdzPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtpZihhcmdzLmxlbmd0aDw9MSl7YXJncz1hcmdzWzBdO30KY2FsbGJhY2suY2FsbChudWxsLGVycixhcmdzfHxudWxsKTt9KTt9fSxjYWxsYmFjayk7fQplbHNle3ZhciByZXN1bHRzPXt9O2FzeW5jLmZvckVhY2hTZXJpZXMoX2tleXModGFza3MpLGZ1bmN0aW9uKGssY2FsbGJhY2spe3Rhc2tzW2tdKGZ1bmN0aW9uKGVycil7dmFyIGFyZ3M9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO2lmKGFyZ3MubGVuZ3RoPD0xKXthcmdzPWFyZ3NbMF07fQpyZXN1bHRzW2tdPWFyZ3M7Y2FsbGJhY2soZXJyKTt9KTt9LGZ1bmN0aW9uKGVycil7Y2FsbGJhY2soZXJyLHJlc3VsdHMpO30pO319O2FzeW5jLml0ZXJhdG9yPWZ1bmN0aW9uKHRhc2tzKXt2YXIgbWFrZUNhbGxiYWNrPWZ1bmN0aW9uKGluZGV4KXt2YXIgZm49ZnVuY3Rpb24oKXtpZih0YXNrcy5sZW5ndGgpe3Rhc2tzW2luZGV4XS5hcHBseShudWxsLGFyZ3VtZW50cyk7fQpyZXR1cm4gZm4ubmV4dCgpO307Zm4ubmV4dD1mdW5jdGlvbigpe3JldHVybihpbmRleDx0YXNrcy5sZW5ndGgtMSk/bWFrZUNhbGxiYWNrKGluZGV4KzEpOm51bGw7fTtyZXR1cm4gZm47fTtyZXR1cm4gbWFrZUNhbGxiYWNrKDApO307YXN5bmMuYXBwbHk9ZnVuY3Rpb24oZm4pe3ZhciBhcmdzPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gZm4uYXBwbHkobnVsbCxhcmdzLmNvbmNhdChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7fTt9O3ZhciBfY29uY2F0PWZ1bmN0aW9uKGVhY2hmbixhcnIsZm4sY2FsbGJhY2spe3ZhciByPVtdO2VhY2hmbihhcnIsZnVuY3Rpb24oeCxjYil7Zm4oeCxmdW5jdGlvbihlcnIseSl7cj1yLmNvbmNhdCh5fHxbXSk7Y2IoZXJyKTt9KTt9LGZ1bmN0aW9uKGVycil7Y2FsbGJhY2soZXJyLHIpO30pO307YXN5bmMuY29uY2F0PWRvUGFyYWxsZWwoX2NvbmNhdCk7YXN5bmMuY29uY2F0U2VyaWVzPWRvU2VyaWVzKF9jb25jYXQpO2FzeW5jLndoaWxzdD1mdW5jdGlvbih0ZXN0LGl0ZXJhdG9yLGNhbGxiYWNrKXtpZih0ZXN0KCkpe2l0ZXJhdG9yKGZ1bmN0aW9uKGVycil7aWYoZXJyKXtyZXR1cm4gY2FsbGJhY2soZXJyKTt9CmFzeW5jLndoaWxzdCh0ZXN0LGl0ZXJhdG9yLGNhbGxiYWNrKTt9KTt9CmVsc2V7Y2FsbGJhY2soKTt9fTthc3luYy51bnRpbD1mdW5jdGlvbih0ZXN0LGl0ZXJhdG9yLGNhbGxiYWNrKXtpZighdGVzdCgpKXtpdGVyYXRvcihmdW5jdGlvbihlcnIpe2lmKGVycil7cmV0dXJuIGNhbGxiYWNrKGVycik7fQphc3luYy51bnRpbCh0ZXN0LGl0ZXJhdG9yLGNhbGxiYWNrKTt9KTt9CmVsc2V7Y2FsbGJhY2soKTt9fTthc3luYy5xdWV1ZT1mdW5jdGlvbih3b3JrZXIsY29uY3VycmVuY3kpe3ZhciB3b3JrZXJzPTA7dmFyIHRhc2tzPVtdO3ZhciBxPXtjb25jdXJyZW5jeTpjb25jdXJyZW5jeSxwdXNoOmZ1bmN0aW9uKGRhdGEsY2FsbGJhY2spe3Rhc2tzLnB1c2goe2RhdGE6ZGF0YSxjYWxsYmFjazpjYWxsYmFja30pO2FzeW5jLm5leHRUaWNrKHEucHJvY2Vzcyk7fSxwcm9jZXNzOmZ1bmN0aW9uKCl7aWYod29ya2VyczxxLmNvbmN1cnJlbmN5JiZ0YXNrcy5sZW5ndGgpe3ZhciB0YXNrPXRhc2tzLnNwbGljZSgwLDEpWzBdO3dvcmtlcnMrPTE7d29ya2VyKHRhc2suZGF0YSxmdW5jdGlvbigpe3dvcmtlcnMtPTE7aWYodGFzay5jYWxsYmFjayl7dGFzay5jYWxsYmFjay5hcHBseSh0YXNrLGFyZ3VtZW50cyk7fQpxLnByb2Nlc3MoKTt9KTt9fSxsZW5ndGg6ZnVuY3Rpb24oKXtyZXR1cm4gdGFza3MubGVuZ3RoO319O3JldHVybiBxO307dmFyIF9jb25zb2xlX2ZuPWZ1bmN0aW9uKG5hbWUpe3JldHVybiBmdW5jdGlvbihmbil7dmFyIGFyZ3M9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO2ZuLmFwcGx5KG51bGwsYXJncy5jb25jYXQoW2Z1bmN0aW9uKGVycil7dmFyIGFyZ3M9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO2lmKHR5cGVvZiBjb25zb2xlIT09J3VuZGVmaW5lZCcpe2lmKGVycil7aWYoY29uc29sZS5lcnJvcil7Y29uc29sZS5lcnJvcihlcnIpO319CmVsc2UgaWYoY29uc29sZVtuYW1lXSl7X2ZvckVhY2goYXJncyxmdW5jdGlvbih4KXtjb25zb2xlW25hbWVdKHgpO30pO319fV0pKTt9O307YXN5bmMubG9nPV9jb25zb2xlX2ZuKCdsb2cnKTthc3luYy5kaXI9X2NvbnNvbGVfZm4oJ2RpcicpO2FzeW5jLm1lbW9pemU9ZnVuY3Rpb24oZm4saGFzaGVyKXt2YXIgbWVtbz17fTtoYXNoZXI9aGFzaGVyfHxmdW5jdGlvbih4KXtyZXR1cm4geDt9O3JldHVybiBmdW5jdGlvbigpe3ZhciBhcmdzPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7dmFyIGNhbGxiYWNrPWFyZ3MucG9wKCk7dmFyIGtleT1oYXNoZXIuYXBwbHkobnVsbCxhcmdzKTtpZihrZXkgaW4gbWVtbyl7Y2FsbGJhY2suYXBwbHkobnVsbCxtZW1vW2tleV0pO30KZWxzZXtmbi5hcHBseShudWxsLGFyZ3MuY29uY2F0KFtmdW5jdGlvbigpe21lbW9ba2V5XT1hcmd1bWVudHM7Y2FsbGJhY2suYXBwbHkobnVsbCxhcmd1bWVudHMpO31dKSk7fX07fTt9KCkpOzsoZnVuY3Rpb24oJCl7dmFyIGllNj0kLmJyb3dzZXIubXNpZSYmcGFyc2VJbnQoJC5icm93c2VyLnZlcnNpb24pPT09NiYmdHlwZW9mIHdpbmRvd1snWE1MSHR0cFJlcXVlc3QnXSE9PSdvYmplY3QnLGllNz0kLmJyb3dzZXIubXNpZSYmcGFyc2VJbnQoJC5icm93c2VyLnZlcnNpb24pPT09NyxpZVF1aXJrcz1udWxsLHc9W107JC5tb2RhbD1mdW5jdGlvbihkYXRhLG9wdGlvbnMpe3JldHVybiAkLm1vZGFsLmltcGwuaW5pdChkYXRhLG9wdGlvbnMpO307JC5tb2RhbC5jbG9zZT1mdW5jdGlvbigpeyQubW9kYWwuaW1wbC5jbG9zZSgpO307JC5tb2RhbC5mb2N1cz1mdW5jdGlvbihwb3MpeyQubW9kYWwuaW1wbC5mb2N1cyhwb3MpO307JC5tb2RhbC5zZXRDb250YWluZXJEaW1lbnNpb25zPWZ1bmN0aW9uKCl7JC5tb2RhbC5pbXBsLnNldENvbnRhaW5lckRpbWVuc2lvbnMoKTt9OyQubW9kYWwuc2V0UG9zaXRpb249ZnVuY3Rpb24oKXskLm1vZGFsLmltcGwuc2V0UG9zaXRpb24oKTt9OyQubW9kYWwudXBkYXRlPWZ1bmN0aW9uKGhlaWdodCx3aWR0aCl7JC5tb2RhbC5pbXBsLnVwZGF0ZShoZWlnaHQsd2lkdGgpO307JC5mbi5tb2RhbD1mdW5jdGlvbihvcHRpb25zKXtyZXR1cm4gJC5tb2RhbC5pbXBsLmluaXQodGhpcyxvcHRpb25zKTt9OyQubW9kYWwuZGVmYXVsdHM9e2FwcGVuZFRvOidib2R5Jyxmb2N1czp0cnVlLG9wYWNpdHk6NTAsb3ZlcmxheUlkOidzaW1wbGVtb2RhbC1vdmVybGF5JyxvdmVybGF5Q3NzOnt9LGNvbnRhaW5lcklkOidzaW1wbGVtb2RhbC1jb250YWluZXInLGNvbnRhaW5lckNzczp7fSxkYXRhSWQ6J3NpbXBsZW1vZGFsLWRhdGEnLGRhdGFDc3M6e30sbWluSGVpZ2h0Om51bGwsbWluV2lkdGg6bnVsbCxtYXhIZWlnaHQ6bnVsbCxtYXhXaWR0aDpudWxsLGF1dG9SZXNpemU6ZmFsc2UsYXV0b1Bvc2l0aW9uOnRydWUsekluZGV4OjEwMDAsY2xvc2U6dHJ1ZSxjbG9zZUhUTUw6JzxhIGNsYXNzPSJtb2RhbENsb3NlSW1nIiB0aXRsZT0iQ2xvc2UiPjwvYT4nLGNsb3NlQ2xhc3M6J3NpbXBsZW1vZGFsLWNsb3NlJyxlc2NDbG9zZTp0cnVlLG92ZXJsYXlDbG9zZTpmYWxzZSxwb3NpdGlvbjpudWxsLHBlcnNpc3Q6ZmFsc2UsbW9kYWw6dHJ1ZSxvbk9wZW46bnVsbCxvblNob3c6bnVsbCxvbkNsb3NlOm51bGx9OyQubW9kYWwuaW1wbD17ZDp7fSxpbml0OmZ1bmN0aW9uKGRhdGEsb3B0aW9ucyl7dmFyIHM9dGhpcztpZihzLmQuZGF0YSl7cmV0dXJuIGZhbHNlO30KaWVRdWlya3M9JC5icm93c2VyLm1zaWUmJiEkLmJveE1vZGVsO3Mubz0kLmV4dGVuZCh7fSwkLm1vZGFsLmRlZmF1bHRzLG9wdGlvbnMpO3MuekluZGV4PXMuby56SW5kZXg7cy5vY2NiPWZhbHNlO2lmKHR5cGVvZiBkYXRhPT09J29iamVjdCcpe2RhdGE9ZGF0YSBpbnN0YW5jZW9mIGpRdWVyeT9kYXRhOiQoZGF0YSk7cy5kLnBsYWNlaG9sZGVyPWZhbHNlO2lmKGRhdGEucGFyZW50KCkucGFyZW50KCkuc2l6ZSgpPjApe2RhdGEuYmVmb3JlKCQoJzxzcGFuPjwvc3Bhbj4nKS5hdHRyKCdpZCcsJ3NpbXBsZW1vZGFsLXBsYWNlaG9sZGVyJykuY3NzKHtkaXNwbGF5Oidub25lJ30pKTtzLmQucGxhY2Vob2xkZXI9dHJ1ZTtzLmRpc3BsYXk9ZGF0YS5jc3MoJ2Rpc3BsYXknKTtpZighcy5vLnBlcnNpc3Qpe3MuZC5vcmlnPWRhdGEuY2xvbmUodHJ1ZSk7fX19CmVsc2UgaWYodHlwZW9mIGRhdGE9PT0nc3RyaW5nJ3x8dHlwZW9mIGRhdGE9PT0nbnVtYmVyJyl7ZGF0YT0kKCc8ZGl2PjwvZGl2PicpLmh0bWwoZGF0YSk7fQplbHNle2FsZXJ0KCdTaW1wbGVNb2RhbCBFcnJvcjogVW5zdXBwb3J0ZWQgZGF0YSB0eXBlOiAnK3R5cGVvZiBkYXRhKTtyZXR1cm4gczt9CnMuY3JlYXRlKGRhdGEpO2RhdGE9bnVsbDtzLm9wZW4oKTtpZigkLmlzRnVuY3Rpb24ocy5vLm9uU2hvdykpe3Muby5vblNob3cuYXBwbHkocyxbcy5kXSk7fQpyZXR1cm4gczt9LGNyZWF0ZTpmdW5jdGlvbihkYXRhKXt2YXIgcz10aGlzO3c9cy5nZXREaW1lbnNpb25zKCk7aWYocy5vLm1vZGFsJiZpZTYpe3MuZC5pZnJhbWU9JCgnPGlmcmFtZSBzcmM9ImphdmFzY3JpcHQ6ZmFsc2U7Ij48L2lmcmFtZT4nKS5jc3MoJC5leHRlbmQocy5vLmlmcmFtZUNzcyx7ZGlzcGxheTonbm9uZScsb3BhY2l0eTowLHBvc2l0aW9uOidmaXhlZCcsaGVpZ2h0OndbMF0sd2lkdGg6d1sxXSx6SW5kZXg6cy5vLnpJbmRleCx0b3A6MCxsZWZ0OjB9KSkuYXBwZW5kVG8ocy5vLmFwcGVuZFRvKTt9CnMuZC5vdmVybGF5PSQoJzxkaXY+PC9kaXY+JykuYXR0cignaWQnLHMuby5vdmVybGF5SWQpLmFkZENsYXNzKCdzaW1wbGVtb2RhbC1vdmVybGF5JykuY3NzKCQuZXh0ZW5kKHMuby5vdmVybGF5Q3NzLHtkaXNwbGF5Oidub25lJyxvcGFjaXR5OnMuby5vcGFjaXR5LzEwMCxoZWlnaHQ6cy5vLm1vZGFsP3dbMF06MCx3aWR0aDpzLm8ubW9kYWw/d1sxXTowLHBvc2l0aW9uOidmaXhlZCcsbGVmdDowLHRvcDowLHpJbmRleDpzLm8uekluZGV4KzF9KSkuYXBwZW5kVG8ocy5vLmFwcGVuZFRvKTtzLmQuY29udGFpbmVyPSQoJzxkaXY+PC9kaXY+JykuYXR0cignaWQnLHMuby5jb250YWluZXJJZCkuYWRkQ2xhc3MoJ3NpbXBsZW1vZGFsLWNvbnRhaW5lcicpLmNzcygkLmV4dGVuZChzLm8uY29udGFpbmVyQ3NzLHtkaXNwbGF5Oidub25lJyxwb3NpdGlvbjonZml4ZWQnLHpJbmRleDpzLm8uekluZGV4KzJ9KSkuYXBwZW5kKHMuby5jbG9zZSYmcy5vLmNsb3NlSFRNTD8kKHMuby5jbG9zZUhUTUwpLmFkZENsYXNzKHMuby5jbG9zZUNsYXNzKTonJykuYXBwZW5kVG8ocy5vLmFwcGVuZFRvKTtzLmQud3JhcD0kKCc8ZGl2PjwvZGl2PicpLmF0dHIoJ3RhYkluZGV4JywtMSkuYWRkQ2xhc3MoJ3NpbXBsZW1vZGFsLXdyYXAnKS5jc3Moe2hlaWdodDonMTAwJScsb3V0bGluZTowLHdpZHRoOicxMDAlJ30pLmFwcGVuZFRvKHMuZC5jb250YWluZXIpO3MuZC5kYXRhPWRhdGEuYXR0cignaWQnLGRhdGEuYXR0cignaWQnKXx8cy5vLmRhdGFJZCkuYWRkQ2xhc3MoJ3NpbXBsZW1vZGFsLWRhdGEnKS5jc3MoJC5leHRlbmQocy5vLmRhdGFDc3Mse2Rpc3BsYXk6J25vbmUnfSkpLmFwcGVuZFRvKCdib2R5Jyk7ZGF0YT1udWxsO3Muc2V0Q29udGFpbmVyRGltZW5zaW9ucygpO3MuZC5kYXRhLmFwcGVuZFRvKHMuZC53cmFwKTtpZihpZTZ8fGllUXVpcmtzKXtzLmZpeElFKCk7fX0sYmluZEV2ZW50czpmdW5jdGlvbigpe3ZhciBzPXRoaXM7JCgnLicrcy5vLmNsb3NlQ2xhc3MpLmJpbmQoJ2NsaWNrLnNpbXBsZW1vZGFsJyxmdW5jdGlvbihlKXtlLnByZXZlbnREZWZhdWx0KCk7cy5jbG9zZSgpO30pO2lmKHMuby5tb2RhbCYmcy5vLmNsb3NlJiZzLm8ub3ZlcmxheUNsb3NlKXtzLmQub3ZlcmxheS5iaW5kKCdjbGljay5zaW1wbGVtb2RhbCcsZnVuY3Rpb24oZSl7ZS5wcmV2ZW50RGVmYXVsdCgpO3MuY2xvc2UoKTt9KTt9CiQoZG9jdW1lbnQpLmJpbmQoJ2tleWRvd24uc2ltcGxlbW9kYWwnLGZ1bmN0aW9uKGUpe2lmKHMuby5tb2RhbCYmZS5rZXlDb2RlPT09OSl7cy53YXRjaFRhYihlKTt9CmVsc2UgaWYoKHMuby5jbG9zZSYmcy5vLmVzY0Nsb3NlKSYmZS5rZXlDb2RlPT09Mjcpe2UucHJldmVudERlZmF1bHQoKTtzLmNsb3NlKCk7fX0pOyQod2luZG93KS5iaW5kKCdyZXNpemUuc2ltcGxlbW9kYWwnLGZ1bmN0aW9uKCl7dz1zLmdldERpbWVuc2lvbnMoKTtzLm8uYXV0b1Jlc2l6ZT9zLnNldENvbnRhaW5lckRpbWVuc2lvbnMoKTpzLm8uYXV0b1Bvc2l0aW9uJiZzLnNldFBvc2l0aW9uKCk7aWYoaWU2fHxpZVF1aXJrcyl7cy5maXhJRSgpO30KZWxzZSBpZihzLm8ubW9kYWwpe3MuZC5pZnJhbWUmJnMuZC5pZnJhbWUuY3NzKHtoZWlnaHQ6d1swXSx3aWR0aDp3WzFdfSk7cy5kLm92ZXJsYXkuY3NzKHtoZWlnaHQ6d1swXSx3aWR0aDp3WzFdfSk7fX0pO30sdW5iaW5kRXZlbnRzOmZ1bmN0aW9uKCl7JCgnLicrdGhpcy5vLmNsb3NlQ2xhc3MpLnVuYmluZCgnY2xpY2suc2ltcGxlbW9kYWwnKTskKGRvY3VtZW50KS51bmJpbmQoJ2tleWRvd24uc2ltcGxlbW9kYWwnKTskKHdpbmRvdykudW5iaW5kKCdyZXNpemUuc2ltcGxlbW9kYWwnKTt0aGlzLmQub3ZlcmxheS51bmJpbmQoJ2NsaWNrLnNpbXBsZW1vZGFsJyk7fSxmaXhJRTpmdW5jdGlvbigpe3ZhciBzPXRoaXMscD1zLm8ucG9zaXRpb247JC5lYWNoKFtzLmQuaWZyYW1lfHxudWxsLCFzLm8ubW9kYWw/bnVsbDpzLmQub3ZlcmxheSxzLmQuY29udGFpbmVyXSxmdW5jdGlvbihpLGVsKXtpZihlbCl7dmFyIGJjaD0nZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQnLGJjdz0nZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCcsYnNoPSdkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodCcsYnNsPSdkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQnLGJzdD0nZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AnLGJzdz0nZG9jdW1lbnQuYm9keS5zY3JvbGxXaWR0aCcsY2g9J2RvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQnLGN3PSdkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgnLHNsPSdkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCcsc3Q9J2RvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AnLHM9ZWxbMF0uc3R5bGU7cy5wb3NpdGlvbj0nYWJzb2x1dGUnO2lmKGk8Mil7cy5yZW1vdmVFeHByZXNzaW9uKCdoZWlnaHQnKTtzLnJlbW92ZUV4cHJlc3Npb24oJ3dpZHRoJyk7cy5zZXRFeHByZXNzaW9uKCdoZWlnaHQnLCcnK2JzaCsnID4gJytiY2grJyA/ICcrYnNoKycgOiAnK2JjaCsnICsgInB4IicpO3Muc2V0RXhwcmVzc2lvbignd2lkdGgnLCcnK2JzdysnID4gJytiY3crJyA/ICcrYnN3KycgOiAnK2JjdysnICsgInB4IicpO30KZWxzZXt2YXIgdGUsbGU7aWYocCYmcC5jb25zdHJ1Y3Rvcj09PUFycmF5KXt2YXIgdG9wPXBbMF0/dHlwZW9mIHBbMF09PT0nbnVtYmVyJz9wWzBdLnRvU3RyaW5nKCk6cFswXS5yZXBsYWNlKC9weC8sJycpOmVsLmNzcygndG9wJykucmVwbGFjZSgvcHgvLCcnKTt0ZT10b3AuaW5kZXhPZignJScpPT09LTE/dG9wKycgKyAodCA9ICcrc3QrJyA/ICcrc3QrJyA6ICcrYnN0KycpICsgInB4Iic6cGFyc2VJbnQodG9wLnJlcGxhY2UoLyUvLCcnKSkrJyAqICgoJytjaCsnIHx8ICcrYmNoKycpIC8gMTAwKSArICh0ID0gJytzdCsnID8gJytzdCsnIDogJytic3QrJykgKyAicHgiJztpZihwWzFdKXt2YXIgbGVmdD10eXBlb2YgcFsxXT09PSdudW1iZXInP3BbMV0udG9TdHJpbmcoKTpwWzFdLnJlcGxhY2UoL3B4LywnJyk7bGU9bGVmdC5pbmRleE9mKCclJyk9PT0tMT9sZWZ0KycgKyAodCA9ICcrc2wrJyA/ICcrc2wrJyA6ICcrYnNsKycpICsgInB4Iic6cGFyc2VJbnQobGVmdC5yZXBsYWNlKC8lLywnJykpKycgKiAoKCcrY3crJyB8fCAnK2JjdysnKSAvIDEwMCkgKyAodCA9ICcrc2wrJyA/ICcrc2wrJyA6ICcrYnNsKycpICsgInB4Iic7fX0KZWxzZXt0ZT0nKCcrY2grJyB8fCAnK2JjaCsnKSAvIDIgLSAodGhpcy5vZmZzZXRIZWlnaHQgLyAyKSArICh0ID0gJytzdCsnID8gJytzdCsnIDogJytic3QrJykgKyAicHgiJztsZT0nKCcrY3crJyB8fCAnK2JjdysnKSAvIDIgLSAodGhpcy5vZmZzZXRXaWR0aCAvIDIpICsgKHQgPSAnK3NsKycgPyAnK3NsKycgOiAnK2JzbCsnKSArICJweCInO30Kcy5yZW1vdmVFeHByZXNzaW9uKCd0b3AnKTtzLnJlbW92ZUV4cHJlc3Npb24oJ2xlZnQnKTtzLnNldEV4cHJlc3Npb24oJ3RvcCcsdGUpO3Muc2V0RXhwcmVzc2lvbignbGVmdCcsbGUpO319fSk7fSxmb2N1czpmdW5jdGlvbihwb3Mpe3ZhciBzPXRoaXMscD1wb3MmJiQuaW5BcnJheShwb3MsWydmaXJzdCcsJ2xhc3QnXSkhPT0tMT9wb3M6J2ZpcnN0Jzt2YXIgaW5wdXQ9JCgnOmlucHV0OmVuYWJsZWQ6dmlzaWJsZTonK3Ascy5kLndyYXApO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtpbnB1dC5sZW5ndGg+MD9pbnB1dC5mb2N1cygpOnMuZC53cmFwLmZvY3VzKCk7fSwwKTt9LGdldERpbWVuc2lvbnM6ZnVuY3Rpb24oKXt2YXIgZWw9JCh3aW5kb3cpO3ZhciBoPSQuYnJvd3Nlci5vcGVyYSYmJC5icm93c2VyLnZlcnNpb24+JzkuNScmJiQuZm4uanF1ZXJ5PCcxLjMnfHwkLmJyb3dzZXIub3BlcmEmJiQuYnJvd3Nlci52ZXJzaW9uPCc5LjUnJiYkLmZuLmpxdWVyeT4nMS4yLjYnP2VsWzBdLmlubmVySGVpZ2h0OmVsLmhlaWdodCgpO3JldHVybltoLGVsLndpZHRoKCldO30sZ2V0VmFsOmZ1bmN0aW9uKHYsZCl7cmV0dXJuIHY/KHR5cGVvZiB2PT09J251bWJlcic/djp2PT09J2F1dG8nPzA6di5pbmRleE9mKCclJyk+MD8oKHBhcnNlSW50KHYucmVwbGFjZSgvJS8sJycpKS8xMDApKihkPT09J2gnP3dbMF06d1sxXSkpOnBhcnNlSW50KHYucmVwbGFjZSgvcHgvLCcnKSkpOm51bGw7fSx1cGRhdGU6ZnVuY3Rpb24oaGVpZ2h0LHdpZHRoKXt2YXIgcz10aGlzO2lmKCFzLmQuZGF0YSl7cmV0dXJuIGZhbHNlO30Kcy5kLm9yaWdIZWlnaHQ9cy5nZXRWYWwoaGVpZ2h0LCdoJyk7cy5kLm9yaWdXaWR0aD1zLmdldFZhbCh3aWR0aCwndycpO3MuZC5kYXRhLmhpZGUoKTtoZWlnaHQmJnMuZC5jb250YWluZXIuY3NzKCdoZWlnaHQnLGhlaWdodCk7d2lkdGgmJnMuZC5jb250YWluZXIuY3NzKCd3aWR0aCcsd2lkdGgpO3Muc2V0Q29udGFpbmVyRGltZW5zaW9ucygpO3MuZC5kYXRhLnNob3coKTtzLm8uZm9jdXMmJnMuZm9jdXMoKTtzLnVuYmluZEV2ZW50cygpO3MuYmluZEV2ZW50cygpO30sc2V0Q29udGFpbmVyRGltZW5zaW9uczpmdW5jdGlvbigpe3ZhciBzPXRoaXMsYmFkSUU9aWU2fHxpZTc7dmFyIGNoPXMuZC5vcmlnSGVpZ2h0P3MuZC5vcmlnSGVpZ2h0OiQuYnJvd3Nlci5vcGVyYT9zLmQuY29udGFpbmVyLmhlaWdodCgpOnMuZ2V0VmFsKGJhZElFP3MuZC5jb250YWluZXJbMF0uY3VycmVudFN0eWxlWydoZWlnaHQnXTpzLmQuY29udGFpbmVyLmNzcygnaGVpZ2h0JyksJ2gnKSxjdz1zLmQub3JpZ1dpZHRoP3MuZC5vcmlnV2lkdGg6JC5icm93c2VyLm9wZXJhP3MuZC5jb250YWluZXIud2lkdGgoKTpzLmdldFZhbChiYWRJRT9zLmQuY29udGFpbmVyWzBdLmN1cnJlbnRTdHlsZVsnd2lkdGgnXTpzLmQuY29udGFpbmVyLmNzcygnd2lkdGgnKSwndycpLGRoPXMuZC5kYXRhLm91dGVySGVpZ2h0KHRydWUpLGR3PXMuZC5kYXRhLm91dGVyV2lkdGgodHJ1ZSk7cy5kLm9yaWdIZWlnaHQ9cy5kLm9yaWdIZWlnaHR8fGNoO3MuZC5vcmlnV2lkdGg9cy5kLm9yaWdXaWR0aHx8Y3c7dmFyIG14b2g9cy5vLm1heEhlaWdodD9zLmdldFZhbChzLm8ubWF4SGVpZ2h0LCdoJyk6bnVsbCxteG93PXMuby5tYXhXaWR0aD9zLmdldFZhbChzLm8ubWF4V2lkdGgsJ3cnKTpudWxsLG1oPW14b2gmJm14b2g8d1swXT9teG9oOndbMF0sbXc9bXhvdyYmbXhvdzx3WzFdP214b3c6d1sxXTt2YXIgbW9oPXMuby5taW5IZWlnaHQ/cy5nZXRWYWwocy5vLm1pbkhlaWdodCwnaCcpOidhdXRvJztpZighY2gpe2lmKCFkaCl7Y2g9bW9oO30KZWxzZXtpZihkaD5taCl7Y2g9bWg7fQplbHNlIGlmKHMuby5taW5IZWlnaHQmJm1vaCE9PSdhdXRvJyYmZGg8bW9oKXtjaD1tb2g7fQplbHNle2NoPWRoO319fQplbHNle2NoPXMuby5hdXRvUmVzaXplJiZjaD5taD9taDpjaDxtb2g/bW9oOmNoO30KdmFyIG1vdz1zLm8ubWluV2lkdGg/cy5nZXRWYWwocy5vLm1pbldpZHRoLCd3Jyk6J2F1dG8nO2lmKCFjdyl7aWYoIWR3KXtjdz1tb3c7fQplbHNle2lmKGR3Pm13KXtjdz1tdzt9CmVsc2UgaWYocy5vLm1pbldpZHRoJiZtb3chPT0nYXV0bycmJmR3PG1vdyl7Y3c9bW93O30KZWxzZXtjdz1kdzt9fX0KZWxzZXtjdz1zLm8uYXV0b1Jlc2l6ZSYmY3c+bXc/bXc6Y3c8bW93P21vdzpjdzt9CnMuZC5jb250YWluZXIuY3NzKHtoZWlnaHQ6Y2gsd2lkdGg6Y3d9KTtzLmQud3JhcC5jc3Moe292ZXJmbG93OihkaD5jaHx8ZHc+Y3cpPydhdXRvJzondmlzaWJsZSd9KTtzLm8uYXV0b1Bvc2l0aW9uJiZzLnNldFBvc2l0aW9uKCk7fSxzZXRQb3NpdGlvbjpmdW5jdGlvbigpe3ZhciBzPXRoaXMsdG9wLGxlZnQsaGM9KHdbMF0vMiktKHMuZC5jb250YWluZXIub3V0ZXJIZWlnaHQodHJ1ZSkvMiksdmM9KHdbMV0vMiktKHMuZC5jb250YWluZXIub3V0ZXJXaWR0aCh0cnVlKS8yKTtpZihzLm8ucG9zaXRpb24mJk9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChzLm8ucG9zaXRpb24pPT09J1tvYmplY3QgQXJyYXldJyl7dG9wPXMuby5wb3NpdGlvblswXXx8aGM7bGVmdD1zLm8ucG9zaXRpb25bMV18fHZjO31lbHNle3RvcD1oYztsZWZ0PXZjO30Kcy5kLmNvbnRhaW5lci5jc3Moe2xlZnQ6bGVmdCx0b3A6dG9wfSk7fSx3YXRjaFRhYjpmdW5jdGlvbihlKXt2YXIgcz10aGlzO2lmKCQoZS50YXJnZXQpLnBhcmVudHMoJy5zaW1wbGVtb2RhbC1jb250YWluZXInKS5sZW5ndGg+MCl7cy5pbnB1dHM9JCgnOmlucHV0OmVuYWJsZWQ6dmlzaWJsZTpmaXJzdCwgOmlucHV0OmVuYWJsZWQ6dmlzaWJsZTpsYXN0JyxzLmQuZGF0YVswXSk7aWYoKCFlLnNoaWZ0S2V5JiZlLnRhcmdldD09PXMuaW5wdXRzW3MuaW5wdXRzLmxlbmd0aC0xXSl8fChlLnNoaWZ0S2V5JiZlLnRhcmdldD09PXMuaW5wdXRzWzBdKXx8cy5pbnB1dHMubGVuZ3RoPT09MCl7ZS5wcmV2ZW50RGVmYXVsdCgpO3ZhciBwb3M9ZS5zaGlmdEtleT8nbGFzdCc6J2ZpcnN0JztzLmZvY3VzKHBvcyk7fX0KZWxzZXtlLnByZXZlbnREZWZhdWx0KCk7cy5mb2N1cygpO319LG9wZW46ZnVuY3Rpb24oKXt2YXIgcz10aGlzO3MuZC5pZnJhbWUmJnMuZC5pZnJhbWUuc2hvdygpO2lmKCQuaXNGdW5jdGlvbihzLm8ub25PcGVuKSl7cy5vLm9uT3Blbi5hcHBseShzLFtzLmRdKTt9CmVsc2V7cy5kLm92ZXJsYXkuc2hvdygpO3MuZC5jb250YWluZXIuc2hvdygpO3MuZC5kYXRhLnNob3coKTt9CnMuby5mb2N1cyYmcy5mb2N1cygpO3MuYmluZEV2ZW50cygpO30sY2xvc2U6ZnVuY3Rpb24oKXt2YXIgcz10aGlzO2lmKCFzLmQuZGF0YSl7cmV0dXJuIGZhbHNlO30Kcy51bmJpbmRFdmVudHMoKTtpZigkLmlzRnVuY3Rpb24ocy5vLm9uQ2xvc2UpJiYhcy5vY2NiKXtzLm9jY2I9dHJ1ZTtzLm8ub25DbG9zZS5hcHBseShzLFtzLmRdKTt9CmVsc2V7aWYocy5kLnBsYWNlaG9sZGVyKXt2YXIgcGg9JCgnI3NpbXBsZW1vZGFsLXBsYWNlaG9sZGVyJyk7aWYocy5vLnBlcnNpc3Qpe3BoLnJlcGxhY2VXaXRoKHMuZC5kYXRhLnJlbW92ZUNsYXNzKCdzaW1wbGVtb2RhbC1kYXRhJykuY3NzKCdkaXNwbGF5JyxzLmRpc3BsYXkpKTt9CmVsc2V7cy5kLmRhdGEuaGlkZSgpLnJlbW92ZSgpO3BoLnJlcGxhY2VXaXRoKHMuZC5vcmlnKTt9fQplbHNle3MuZC5kYXRhLmhpZGUoKS5yZW1vdmUoKTt9CnMuZC5jb250YWluZXIuaGlkZSgpLnJlbW92ZSgpO3MuZC5vdmVybGF5LmhpZGUoKTtzLmQuaWZyYW1lJiZzLmQuaWZyYW1lLmhpZGUoKS5yZW1vdmUoKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7cy5kLm92ZXJsYXkucmVtb3ZlKCk7cy5kPXt9O30sMCk7fX19O30pKGpRdWVyeSk7KGZ1bmN0aW9uKCQpeyQuZm4uYmVSZXNldENTUz1mdW5jdGlvbigpe3Jlc2V0U3R5bGVzKHRoaXMpO3JldHVybiB0aGlzO307ZnVuY3Rpb24gcmVzZXRTdHlsZXMoZWxlbWVudCl7dmFyIHRhZ05hbWU9JChlbGVtZW50KVswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCk7dmFyIGVsZW1lbnRzPW5ldyBBcnJheSgpO3ZhciBzdHlsZXM9bmV3IEFycmF5KCk7ZWxlbWVudHNbMF09WydodG1sJywnYm9keScsJ2RpdicsJ3NwYW4nLCdhcHBsZXQnLCdvYmplY3QnLCdpZnJhbWUnLCdoMScsJ2gyJywnaDMnLCdoNCcsJ2g1JywnaDYnLCdwJywnYmxvY2txdW90ZScsJ3ByZScsJ2EnLCdhYmJyJywnYWNyb255bScsJ2FkZHJlc3MnLCdiaWcnLCdjaXRlJywnY29kZScsJ2RlbCcsJ2RmbicsJ2VtJywnZm9udCcsJ2ltZycsJ2lucycsJ2tiZCcsJ3EnLCdzJywnc2FtcCcsJ3NtYWxsJywnc3RyaWtlJywnc3Ryb25nJywnc3ViJywnc3VwJywndHQnLCd2YXInLCdiJywndScsJ2knLCdjZW50ZXInLCdkbCcsJ2R0JywnZGQnLCdvbCcsJ3VsJywnbGknLCdmaWVsZHNldCcsJ2Zvcm0nLCdsYWJlbCcsJ2xlZ2VuZCcsJ3RhYmxlJywnY2FwdGlvbicsJ3Rib2R5JywndGZvb3QnLCd0aGVhZCcsJ3RyJywndGgnLCd0ZCddO3ZhciBzPXttYXJnaW46JzAnLHBhZGRpbmc6JzAnLGJvcmRlcjonMCcsb3V0bGluZTonMCcsZm9udFNpemU6JzEwMCUnLHZlcnRpY2FsQWxpZ246J2Jhc2VsaW5lJyxiYWNrZ3JvdW5kOid0cmFuc3BhcmVudCd9O3N0eWxlc1swXT1zO2VsZW1lbnRzWzFdPVsnYm9keSddO3M9e2xpbmVIZWlnaHQ6JzEnfTtzdHlsZXNbMV09cztlbGVtZW50c1syXT1bJ29sJywndWwnXTtzPXtsaXN0U3R5bGU6J25vbmUnfQpzdHlsZXNbMl09cztlbGVtZW50c1szXT1bJ2Jsb2NrcXVvdGUnLCdxJ107cz17cXVvdGVzOidub25lJ30Kc3R5bGVzWzNdPXM7ZWxlbWVudHNbNF09WydpbnMnXTtzPXt0ZXh0RGVjb3JhdGlvbjonbm9uZSd9CnN0eWxlc1s0XT1zO2VsZW1lbnRzWzVdPVsnZGVsJ107cz17dGV4dERlY29yYXRpb246J2xpbmUtdGhyb3VnaCd9CnN0eWxlc1s1XT1zO2VsZW1lbnRzWzZdPVsndGFibGUnXTtzPXtib3JkZXJDb2xsYXBzZTonY29sbGFwc2UnLGJvcmRlclNwYWNpbmc6JzAnfQpzdHlsZXNbNl09czskKGVsZW1lbnRzKS5lYWNoKGZ1bmN0aW9uKGkpeyQodGhpcykuZWFjaChmdW5jdGlvbihrKXtpZih0YWdOYW1lPT10aGlzKXthZGRTdHlsZXMoZWxlbWVudCxzdHlsZXNbaV0pO319KTt9KTt9CmZ1bmN0aW9uIGFkZFN0eWxlcyhlbGVtZW50LHN0eWxlcyl7Zm9yKGtleSBpbiBzdHlsZXMpeyQoZWxlbWVudCkuY3NzKGtleSxzdHlsZXNba2V5XSk7fX19KShqUXVlcnkpOw=="
        },
        "kanso.js": {
            "content_type": "application/javascript",
            "data": "LypnbG9iYWwgd2luZG93OiBmYWxzZSwgJDogZmFsc2UsIHBhZ2VUcmFja2VyOiBmYWxzZSwga2Fuc286IHRydWUgKi8KCi8qKgogKiBib290c3RyYXBwZWQga2Fuc28gY29kZSwKICogcmVxdWlyZWQgYmVmb3JlIHRoZSBjb21tb25qcyBlbnZpcm9ubWVudCBpcyBhdmFpbGFibGUuCiAqLwoKKGZ1bmN0aW9uIChleHBvcnRzKSB7CgogICAgZXhwb3J0cy5tb2R1bGVDYWNoZSA9IHt9OwoKICAgIGV4cG9ydHMubm9ybWFsaXplUGF0aCA9IGZ1bmN0aW9uIChwKSB7CiAgICAgICAgdmFyIHBhdGggPSBbXTsKICAgICAgICB2YXIgcGFydHMgPSBwLnNwbGl0KCcvJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICBpZiAocGFydHNbaV0gPT09ICcuLicpIHsKICAgICAgICAgICAgICAgIHBhdGgucG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAocGFydHNbaV0gIT09ICcuJykgewogICAgICAgICAgICAgICAgcGF0aC5wdXNoKHBhcnRzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcGF0aC5qb2luKCcvJyk7CiAgICB9OwoKICAgIGV4cG9ydHMuZGlybmFtZSA9IGZ1bmN0aW9uIChwKSB7CiAgICAgICAgaWYgKHAgPT09ICcvJykgewogICAgICAgICAgICByZXR1cm4gcDsKICAgICAgICB9CiAgICAgICAgdmFyIHBhcnRzID0gcC5zcGxpdCgnLycpOwogICAgICAgIHBhcnRzLnBvcCgpOwogICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDEgJiYgcGFydHNbMF0gPT09ICcnKSB7CiAgICAgICAgICAgIHJldHVybiAnLyc7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYXJ0cy5qb2luKCcvJyk7CiAgICB9OwoKICAgIGV4cG9ydHMuY3JlYXRlUmVxdWlyZSA9IGZ1bmN0aW9uIChjdXJyZW50KSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHsKICAgICAgICAgICAgdmFyIHBhdGg7CiAgICAgICAgICAgIGlmICh0YXJnZXQuY2hhckF0KDApID09PSAnLicpIHsKICAgICAgICAgICAgICAgIHZhciBkaXIgPSBleHBvcnRzLmRpcm5hbWUoY3VycmVudCk7CiAgICAgICAgICAgICAgICBwYXRoID0gZXhwb3J0cy5ub3JtYWxpemVQYXRoKGRpciArICcvJyArIHRhcmdldCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBwYXRoID0gZXhwb3J0cy5ub3JtYWxpemVQYXRoKHRhcmdldCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG0gPSBrYW5zby5tb2R1bGVDYWNoZVtwYXRoXTsKICAgICAgICAgICAgaWYgKCFtKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHN1Y2ggbW9kdWxlOiAnICsgcGF0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFtLmxvYWRlZCkgewogICAgICAgICAgICAgICAgbS5leHBvcnRzID0ge307CiAgICAgICAgICAgICAgICAvLyBzZXQgdGhpcyB0byB0cnVlICpiZWZvcmUqIGNhbGxpbmcgbS5sb2FkIHNvIGNpcmN1bGFyCiAgICAgICAgICAgICAgICAvLyByZXF1aXJlcyBkb24ndCBibG93IHRoZSBjYWxsIHN0YWNrCiAgICAgICAgICAgICAgICBtLmxvYWRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBtLmxvYWQobSwgbS5leHBvcnRzLCBleHBvcnRzLmNyZWF0ZVJlcXVpcmUocGF0aCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtLmV4cG9ydHM7CiAgICAgICAgfTsKICAgIH07CgogICAgaWYgKHR5cGVvZiByZXF1aXJlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIC8vIG1ha2UgcmVxdWlyZSBhdmFpbGFibGUgZ2xvYmFsbHksIHVubGVzcyBhbHJlYWR5IGluIGEgY29tbW9uanMKICAgICAgICAvLyBlbnZpcm9ubWVudAogICAgICAgIHRoaXMucmVxdWlyZSA9IGV4cG9ydHMuY3JlYXRlUmVxdWlyZSgnJyk7CiAgICB9CgogICAgZXhwb3J0cy5pbml0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBrYW5zbyA9IHJlcXVpcmUoJ2thbnNvL2NvcmUnKTsKICAgICAgICBmb3IgKHZhciBrIGluIGthbnNvKSB7CiAgICAgICAgICAgIGlmIChrYW5zby5oYXNPd25Qcm9wZXJ0eShrKSkgewogICAgICAgICAgICAgICAgZXhwb3J0c1trXSA9IGthbnNvW2tdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGthbnNvLmluaXQoKTsKICAgIH07Cgp9KCh0eXBlb2YgZXhwb3J0cyA9PT0gJ3VuZGVmaW5lZCcpID8gdGhpcy5rYW5zbyA9IHt9OiBtb2R1bGUuZXhwb3J0cykpOwoKCi8qKgogKiBsaWIvYXBwLmpzIGFkZHMgdGhlIHdyYXBwZWQgYW5kIGNvbmNhdGVuYXRlZCBsaXN0IG9mIGNvbW1vbmpzIG1vZHVsZXMgYWZ0ZXIKICogdGhpcyBjb2RlLgogKi8KCgovKioqKioqKioqKiBsaWIvYXBwICoqKioqKioqKiovCgprYW5zby5tb2R1bGVDYWNoZVsibGliL2FwcCJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKioKICogVmFsdWVzIGV4cG9ydGVkIGZyb20gdGhpcyBtb2R1bGUgd2lsbCBhdXRvbWF0aWNhbGx5IGJlIHVzZWQgdG8gZ2VuZXJhdGUKICogdGhlIGRlc2lnbiBkb2MgcHVzaGVkIHRvIENvdWNoREIuCiAqLwoKbW9kdWxlLmV4cG9ydHMgPSB7CiAgICB0eXBlczogcmVxdWlyZSgnLi90eXBlcycpLAogICAgc2hvd3M6IHJlcXVpcmUoJy4vc2hvd3MnKSwKICAgIGxpc3RzOiByZXF1aXJlKCcuL2xpc3RzJyksCiAgICB2aWV3czogcmVxdWlyZSgnLi92aWV3cycpLAogICAgdXBkYXRlczogcmVxdWlyZSgnLi91cGRhdGVzJyksCiAgICBmaWx0ZXJzOiByZXF1aXJlKCcuL2ZpbHRlcnMnKSwKICAgIHJld3JpdGVzOiByZXF1aXJlKCcuL3Jld3JpdGVzJyksCiAgICB2YWxpZGF0ZV9kb2NfdXBkYXRlOiByZXF1aXJlKCcuL3ZhbGlkYXRlJyksCiAgICBldmVudHM6IHJlcXVpcmUoJy4vZXZlbnRzJykKfTsKCgoKCn0pfTsKCi8qKioqKioqKioqIGxpYi9iaWJ0ZXggKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJsaWIvYmlidGV4Il0gPSB7bG9hZDogKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUpIHsKCi8qKgogKiBNb2RpZmllZCBmcm9tCiAqIGh0dHA6Ly9iaWJ0ZXgtanMuZ29vZ2xlY29kZS5jb20vc3ZuL3RydW5rL3NyYy9iaWJ0ZXhfanMuanMKICogTUlUIExpY2Vuc2UKICogQ29weXJpZ2h0IChjKSAyMDEwIGhlbnJpay5tdWVoZQogKgogKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICogCiAqLwoKLy8gSXNzdWVzOgovLyAgbm8gY29tbWVudCBoYW5kbGluZyB3aXRoaW4gc3RyaW5ncwovLyAgbm8gc3RyaW5nIGNvbmNhdGVuYXRpb24KLy8gIG5vIHZhcmlhYmxlIHZhbHVlcyB5ZXQKCi8vIEdyYW1tYXIgaW1wbGVtZW50ZWQgaGVyZToKLy8gIGJpYnRleCAtPiAoc3RyaW5nIHwgcHJlYW1ibGUgfCBjb21tZW50IHwgZW50cnkpKjsKLy8gIHN0cmluZyAtPiAnQFNUUklORycgJ3snIGtleV9lcXVhbHNfdmFsdWUgJ30nOwovLyAgcHJlYW1ibGUgLT4gJ0BQUkVBTUJMRScgJ3snIHZhbHVlICd9JzsKLy8gIGNvbW1lbnQgLT4gJ0BDT01NRU5UJyAneycgdmFsdWUgJ30nOwovLyAgZW50cnkgLT4gJ0AnIGtleSAneycga2V5ICcsJyBrZXlfdmFsdWVfbGlzdCAnfSc7Ci8vICBrZXlfdmFsdWVfbGlzdCAtPiBrZXlfZXF1YWxzX3ZhbHVlICgnLCcga2V5X2VxdWFsc192YWx1ZSkqOwovLyAga2V5X2VxdWFsc192YWx1ZSAtPiBrZXkgJz0nIHZhbHVlOwovLyAgdmFsdWUgLT4gdmFsdWVfcXVvdGVzIHwgdmFsdWVfYnJhY2VzIHwga2V5OwovLyAgdmFsdWVfcXVvdGVzIC0+ICciJyAuKj8gJyInOyAvLyBub3QgcXVpdGUKLy8gIHZhbHVlX2JyYWNlcyAtPiAneycgLio/ICciJzsgLy8gbm90IHF1aXRlCmZ1bmN0aW9uIEJpYnRleFBhcnNlcigpIHsKICB0aGlzLnBvcyA9IDA7CiAgdGhpcy5pbnB1dCA9ICIiOwogIAogIHRoaXMuZW50cmllcyA9IHt9OwogIHRoaXMuc3RyaW5ncyA9IHsKICAgICAgSkFOOiAiSmFudWFyeSIsCiAgICAgIEZFQjogIkZlYnJ1YXJ5IiwKICAgICAgTUFSOiAiTWFyY2giLCAgICAgIAogICAgICBBUFI6ICJBcHJpbCIsCiAgICAgIE1BWTogIk1heSIsCiAgICAgIEpVTjogIkp1bmUiLAogICAgICBKVUw6ICJKdWx5IiwKICAgICAgQVVHOiAiQXVndXN0IiwKICAgICAgU0VQOiAiU2VwdGVtYmVyIiwKICAgICAgT0NUOiAiT2N0b2JlciIsCiAgICAgIE5PVjogIk5vdmVtYmVyIiwKICAgICAgREVDOiAiRGVjZW1iZXIiCiAgfTsKICB0aGlzLmN1cnJlbnRLZXkgPSAiIjsKICB0aGlzLmN1cnJlbnRFbnRyeSA9ICIiOwogIAoKICB0aGlzLnNldElucHV0ID0gZnVuY3Rpb24odCkgewogICAgdGhpcy5pbnB1dCA9IHQ7CiAgfQogIAogIHRoaXMuZ2V0RW50cmllcyA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5lbnRyaWVzOwogIH0KCiAgdGhpcy5pc1doaXRlc3BhY2UgPSBmdW5jdGlvbihzKSB7CiAgICByZXR1cm4gKHMgPT0gJyAnIHx8IHMgPT0gJ1xyJyB8fCBzID09ICdcdCcgfHwgcyA9PSAnXG4nKTsKICB9CgogIHRoaXMubWF0Y2ggPSBmdW5jdGlvbihzKSB7CiAgICB0aGlzLnNraXBXaGl0ZXNwYWNlKCk7CiAgICBpZiAodGhpcy5pbnB1dC5zdWJzdHJpbmcodGhpcy5wb3MsIHRoaXMucG9zK3MubGVuZ3RoKSA9PSBzKSB7CiAgICAgIHRoaXMucG9zICs9IHMubGVuZ3RoOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgIlRva2VuIG1pc21hdGNoLCBleHBlY3RlZCAiICsgcyArICIsIGZvdW5kICIgKyB0aGlzLmlucHV0LnN1YnN0cmluZyh0aGlzLnBvcyk7CiAgICB9CiAgICB0aGlzLnNraXBXaGl0ZXNwYWNlKCk7CiAgfQoKICB0aGlzLnRyeU1hdGNoID0gZnVuY3Rpb24ocykgewogICAgdGhpcy5za2lwV2hpdGVzcGFjZSgpOwogICAgaWYgKHRoaXMuaW5wdXQuc3Vic3RyaW5nKHRoaXMucG9zLCB0aGlzLnBvcytzLmxlbmd0aCkgPT0gcykgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXMuc2tpcFdoaXRlc3BhY2UoKTsKICB9CgogIHRoaXMuc2tpcFdoaXRlc3BhY2UgPSBmdW5jdGlvbigpIHsKICAgIHdoaWxlICh0aGlzLmlzV2hpdGVzcGFjZSh0aGlzLmlucHV0W3RoaXMucG9zXSkpIHsKICAgICAgdGhpcy5wb3MrKzsKICAgIH0KICAgIGlmICh0aGlzLmlucHV0W3RoaXMucG9zXSA9PSAiJSIpIHsKICAgICAgd2hpbGUodGhpcy5pbnB1dFt0aGlzLnBvc10gIT0gIlxuIikgewogICAgICAgIHRoaXMucG9zKys7CiAgICAgIH0KICAgICAgdGhpcy5za2lwV2hpdGVzcGFjZSgpOwogICAgfQogIH0KCiAgdGhpcy52YWx1ZV9icmFjZXMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBicmFjZWNvdW50ID0gMDsKICAgIHRoaXMubWF0Y2goInsiKTsKICAgIHZhciBzdGFydCA9IHRoaXMucG9zOwogICAgd2hpbGUodHJ1ZSkgewogICAgICBpZiAodGhpcy5pbnB1dFt0aGlzLnBvc10gPT0gJ30nICYmIHRoaXMuaW5wdXRbdGhpcy5wb3MtMV0gIT0gJ1xcJykgewogICAgICAgIGlmIChicmFjZWNvdW50ID4gMCkgewogICAgICAgICAgYnJhY2Vjb3VudC0tOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgZW5kID0gdGhpcy5wb3M7CiAgICAgICAgICB0aGlzLm1hdGNoKCJ9Iik7CiAgICAgICAgICByZXR1cm4gdGhpcy5pbnB1dC5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMuaW5wdXRbdGhpcy5wb3NdID09ICd7JykgewogICAgICAgIGJyYWNlY291bnQrKzsKICAgICAgfSBlbHNlIGlmICh0aGlzLnBvcyA9PSB0aGlzLmlucHV0Lmxlbmd0aC0xKSB7CiAgICAgICAgdGhyb3cgIlVudGVybWluYXRlZCB2YWx1ZSI7CiAgICAgIH0KICAgICAgdGhpcy5wb3MrKzsKICAgIH0KICB9CgogIHRoaXMudmFsdWVfcXVvdGVzID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLm1hdGNoKCciJyk7CiAgICB2YXIgc3RhcnQgPSB0aGlzLnBvczsKICAgIHdoaWxlKHRydWUpIHsKICAgICAgaWYgKHRoaXMuaW5wdXRbdGhpcy5wb3NdID09ICciJyAmJiB0aGlzLmlucHV0W3RoaXMucG9zLTFdICE9ICdcXCcpIHsKICAgICAgICAgIHZhciBlbmQgPSB0aGlzLnBvczsKICAgICAgICAgIHRoaXMubWF0Y2goJyInKTsKICAgICAgICAgIHJldHVybiB0aGlzLmlucHV0LnN1YnN0cmluZyhzdGFydCwgZW5kKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnBvcyA9PSB0aGlzLmlucHV0Lmxlbmd0aC0xKSB7CiAgICAgICAgdGhyb3cgIlVudGVybWluYXRlZCB2YWx1ZToiICsgdGhpcy5pbnB1dC5zdWJzdHJpbmcoc3RhcnQpOwogICAgICB9CiAgICAgIHRoaXMucG9zKys7CiAgICB9CiAgfQogIAogIHRoaXMuc2luZ2xlX3ZhbHVlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgc3RhcnQgPSB0aGlzLnBvczsKICAgIGlmICh0aGlzLnRyeU1hdGNoKCJ7IikpIHsKICAgICAgcmV0dXJuIHRoaXMudmFsdWVfYnJhY2VzKCk7CiAgICB9IGVsc2UgaWYgKHRoaXMudHJ5TWF0Y2goJyInKSkgewogICAgICByZXR1cm4gdGhpcy52YWx1ZV9xdW90ZXMoKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBrID0gdGhpcy5rZXkoKTsKICAgICAgaWYgKHRoaXMuc3RyaW5nc1trLnRvVXBwZXJDYXNlKCldKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3RyaW5nc1trXTsKICAgICAgfSBlbHNlIGlmIChrLm1hdGNoKCJeWzAtOV0rJCIpKSB7CiAgICAgICAgcmV0dXJuIGs7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgIlZhbHVlIGV4cGVjdGVkOiIgKyB0aGlzLmlucHV0LnN1YnN0cmluZyhzdGFydCk7CiAgICAgIH0KICAgIH0KICB9CiAgCiAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHZhbHVlcyA9IFtdOwogICAgdmFsdWVzLnB1c2godGhpcy5zaW5nbGVfdmFsdWUoKSk7CiAgICB3aGlsZSAodGhpcy50cnlNYXRjaCgiIyIpKSB7CiAgICAgIHRoaXMubWF0Y2goIiMiKTsKICAgICAgdmFsdWVzLnB1c2godGhpcy5zaW5nbGVfdmFsdWUoKSk7CiAgICB9CiAgICByZXR1cm4gdmFsdWVzLmpvaW4oIiIpOwogIH0KCiAgdGhpcy5rZXkgPSBmdW5jdGlvbigpIHsKICAgIHZhciBzdGFydCA9IHRoaXMucG9zOwogICAgd2hpbGUodHJ1ZSkgewogICAgICBpZiAodGhpcy5wb3MgPT0gdGhpcy5pbnB1dC5sZW5ndGgpIHsKICAgICAgICB0aHJvdyAiUnVuYXdheSBrZXkiOwogICAgICB9CiAgICAKICAgICAgaWYgKHRoaXMuaW5wdXRbdGhpcy5wb3NdLm1hdGNoKCJbYS16QS1aMC05XzpcXC4vLV0iKSkgewogICAgICAgIHRoaXMucG9zKysKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5pbnB1dC5zdWJzdHJpbmcoc3RhcnQsIHRoaXMucG9zKS50b1VwcGVyQ2FzZSgpOwogICAgICB9CiAgICB9CiAgfQoKICB0aGlzLmtleV9lcXVhbHNfdmFsdWUgPSBmdW5jdGlvbigpIHsKICAgIHZhciBrZXkgPSB0aGlzLmtleSgpOwogICAgaWYgKHRoaXMudHJ5TWF0Y2goIj0iKSkgewogICAgICB0aGlzLm1hdGNoKCI9Iik7CiAgICAgIHZhciB2YWwgPSB0aGlzLnZhbHVlKCk7CiAgICAgIHJldHVybiBbIGtleSwgdmFsIF07CiAgICB9IGVsc2UgewogICAgICB0aHJvdyAiLi4uID0gdmFsdWUgZXhwZWN0ZWQsIGVxdWFscyBzaWduIG1pc3Npbmc6IiArIHRoaXMuaW5wdXQuc3Vic3RyaW5nKHRoaXMucG9zKTsKICAgIH0KICB9CgogIHRoaXMua2V5X3ZhbHVlX2xpc3QgPSBmdW5jdGlvbigpIHsKICAgIHZhciBrdiA9IHRoaXMua2V5X2VxdWFsc192YWx1ZSgpOwogICAgdGhpcy5lbnRyaWVzW3RoaXMuY3VycmVudEVudHJ5XVtrdlswXV0gPSBrdlsxXTsKICAgIHdoaWxlICh0aGlzLnRyeU1hdGNoKCIsIikpIHsKICAgICAgdGhpcy5tYXRjaCgiLCIpOwogICAgICAvLyBmaXhlcyBwcm9ibGVtcyB3aXRoIGNvbW1hcyBhdCB0aGUgZW5kIG9mIGEgbGlzdAogICAgICBpZiAodGhpcy50cnlNYXRjaCgifSIpKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAga3YgPSB0aGlzLmtleV9lcXVhbHNfdmFsdWUoKTsKICAgICAgdGhpcy5lbnRyaWVzW3RoaXMuY3VycmVudEVudHJ5XVtrdlswXV0gPSBrdlsxXTsKICAgIH0KICB9CgogIHRoaXMuZW50cnlfYm9keSA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5jdXJyZW50RW50cnkgPSB0aGlzLmtleSgpOwogICAgdGhpcy5lbnRyaWVzW3RoaXMuY3VycmVudEVudHJ5XSA9IG5ldyBPYmplY3QoKTsgICAgCiAgICB0aGlzLm1hdGNoKCIsIik7CiAgICB0aGlzLmtleV92YWx1ZV9saXN0KCk7CiAgfQoKICB0aGlzLmRpcmVjdGl2ZSA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMubWF0Y2goIkAiKTsKICAgIHJldHVybiAiQCIrdGhpcy5rZXkoKTsKICB9CgogIHRoaXMuc3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGt2ID0gdGhpcy5rZXlfZXF1YWxzX3ZhbHVlKCk7CiAgICB0aGlzLnN0cmluZ3Nba3ZbMF0udG9VcHBlckNhc2UoKV0gPSBrdlsxXTsKICB9CgogIHRoaXMucHJlYW1ibGUgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMudmFsdWUoKTsKICB9CgogIHRoaXMuY29tbWVudCA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy52YWx1ZSgpOyAvLyB0aGlzIGlzIHdyb25nCiAgfQoKICB0aGlzLmVudHJ5ID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmVudHJ5X2JvZHkoKTsKICB9CgogIHRoaXMuYmlidGV4ID0gZnVuY3Rpb24oKSB7CiAgICB3aGlsZSh0aGlzLnRyeU1hdGNoKCJAIikpIHsKICAgICAgdmFyIGQgPSB0aGlzLmRpcmVjdGl2ZSgpLnRvVXBwZXJDYXNlKCk7CiAgICAgIHRoaXMubWF0Y2goInsiKTsKICAgICAgaWYgKGQgPT0gIkBTVFJJTkciKSB7CiAgICAgICAgdGhpcy5zdHJpbmcoKTsKICAgICAgfSBlbHNlIGlmIChkID09ICJAUFJFQU1CTEUiKSB7CiAgICAgICAgdGhpcy5wcmVhbWJsZSgpOwogICAgICB9IGVsc2UgaWYgKGQgPT0gIkBDT01NRU5UIikgewogICAgICAgIHRoaXMuY29tbWVudCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZW50cnkoKTsKICAgICAgfQogICAgICB0aGlzLm1hdGNoKCJ9Iik7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBCaWJ0ZXhEaXNwbGF5KCkgewogIHRoaXMuZml4VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxnbHFxXHM/L2csICImYmRxdW87Iik7CiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xcZ3JxcVxzPy9nLCAnJnJkcXVvOycpOwogICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cXCAvZywgJyZuYnNwOycpOwogICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cXHVybC9nLCAnJyk7CiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoLy0tLS9nLCAnJm1kYXNoOycpOwogICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC97XFwiYX0vZywgJyZhdW1sOycpOwogICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9ce1xcIm9cfS9nLCAnJm91bWw7Jyk7CiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL3tcXCJ1fS9nLCAnJnV1bWw7Jyk7CiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL3tcXCJBfS9nLCAnJkF1bWw7Jyk7CiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL3tcXCJPfS9nLCAnJk91bWw7Jyk7CiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL3tcXCJVfS9nLCAnJlV1bWw7Jyk7CiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xcc3MvZywgJyZzemxpZzsnKTsKICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXHsoLio/KVx9L2csICckMScpOwogICAgcmV0dXJuIHZhbHVlOwogIH0KICAKICB0aGlzLmRpc3BsYXlCaWJ0ZXgyID0gZnVuY3Rpb24oaSwgbykgewogICAgdmFyIGIgPSBuZXcgQmlidGV4UGFyc2VyKCk7CiAgICBiLnNldElucHV0KGkpOwogICAgYi5iaWJ0ZXgoKTsKCiAgICB2YXIgZSA9IGIuZ2V0RW50cmllcygpOwogICAgdmFyIG9sZCA9IG8uZmluZCgiKiIpOwogIAogICAgZm9yICh2YXIgaXRlbSBpbiBlKSB7CiAgICAgIHZhciB0cGwgPSAkKCIuYmlidGV4X3RlbXBsYXRlIikuY2xvbmUoKS5yZW1vdmVDbGFzcygnYmlidGV4X3RlbXBsYXRlJyk7CiAgICAgIHRwbC5hZGRDbGFzcygidW51c2VkIik7CiAgICAgIAogICAgICBmb3IgKHZhciBrZXkgaW4gZVtpdGVtXSkgewogICAgICAKICAgICAgICB2YXIgZmllbGRzID0gdHBsLmZpbmQoIi4iICsga2V5LnRvTG93ZXJDYXNlKCkpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmllbGRzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICB2YXIgZiA9ICQoZmllbGRzW2ldKTsKICAgICAgICAgIGYucmVtb3ZlQ2xhc3MoInVudXNlZCIpOwogICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5maXhWYWx1ZShlW2l0ZW1dW2tleV0pOwogICAgICAgICAgaWYgKGYuaXMoImEiKSkgewogICAgICAgICAgICBmLmF0dHIoImhyZWYiLCB2YWx1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgY3VycmVudEhUTUwgPSBmLmh0bWwoKSB8fCAiIjsKICAgICAgICAgICAgaWYgKGN1cnJlbnRIVE1MLm1hdGNoKCIlIikpIHsKICAgICAgICAgICAgICAvLyAiY29tcGxleCIgdGVtcGxhdGUgZmllbGQKICAgICAgICAgICAgICBmLmh0bWwoY3VycmVudEhUTUwucmVwbGFjZSgiJSIsIHZhbHVlKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gc2ltcGxlIGZpZWxkCiAgICAgICAgICAgICAgZi5odG1sKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgCiAgICAgIHZhciBlbXB0eUZpZWxkcyA9IHRwbC5maW5kKCJzcGFuIC51bnVzZWQiKTsKICAgICAgZW1wdHlGaWVsZHMuZWFjaChmdW5jdGlvbiAoa2V5LGYpIHsKICAgICAgICBpZiAoZi5pbm5lckhUTUwubWF0Y2goIiUiKSkgewogICAgICAgICAgZi5pbm5lckhUTUwgPSAiIjsKICAgICAgICB9CiAgICAgIH0pOwogICAgCiAgICAgIG8uYXBwZW5kKHRwbCk7CiAgICAgIHRwbC5zaG93KCk7CiAgICB9CiAgICAKICAgIG9sZC5yZW1vdmUoKTsKICB9CgoKICB0aGlzLmRpc3BsYXlCaWJ0ZXggPSBmdW5jdGlvbihpbnB1dCwgb3V0cHV0KSB7CiAgICAvLyBwYXJzZSBiaWJ0ZXggaW5wdXQKICAgIHZhciBiID0gbmV3IEJpYnRleFBhcnNlcigpOwogICAgYi5zZXRJbnB1dChpbnB1dCk7CiAgICBiLmJpYnRleCgpOwogICAgCiAgICAvLyBzYXZlIG9sZCBlbnRyaWVzIHRvIHJlbW92ZSB0aGVtIGxhdGVyCiAgICB2YXIgb2xkID0gb3V0cHV0LmZpbmQoIioiKTsgICAgCgogICAgLy8gaXRlcmF0ZSBvdmVyIGJpYlRlWCBlbnRyaWVzCiAgICB2YXIgZW50cmllcyA9IGIuZ2V0RW50cmllcygpOwogICAgZm9yICh2YXIgZW50cnlLZXkgaW4gZW50cmllcykgewogICAgICB2YXIgZW50cnkgPSBlbnRyaWVzW2VudHJ5S2V5XTsKICAgICAgCiAgICAgIC8vIGZpbmQgdGVtcGxhdGUKICAgICAgdmFyIHRwbCA9ICQoIi5iaWJ0ZXhfdGVtcGxhdGUiKS5jbG9uZSgpLnJlbW92ZUNsYXNzKCdiaWJ0ZXhfdGVtcGxhdGUnKTsKICAgICAgCiAgICAgIC8vIGZpbmQgYWxsIGtleXMgaW4gdGhlIGVudHJ5CiAgICAgIHZhciBrZXlzID0gW107CiAgICAgIGZvciAodmFyIGtleSBpbiBlbnRyeSkgewogICAgICAgIGtleXMucHVzaChrZXkudG9VcHBlckNhc2UoKSk7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIGZpbmQgYWxsIGlmcyBhbmQgY2hlY2sgdGhlbQogICAgICB2YXIgcmVtb3ZlZCA9IGZhbHNlOwogICAgICBkbyB7CiAgICAgICAgLy8gZmluZCBuZXh0IGlmCiAgICAgICAgdmFyIGNvbmRzID0gdHBsLmZpbmQoIi5pZiIpOwogICAgICAgIGlmIChjb25kcy5zaXplKCkgPT0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGNoZWNrIGlmCiAgICAgICAgdmFyIGNvbmQgPSBjb25kcy5maXJzdCgpOwogICAgICAgIGNvbmQucmVtb3ZlQ2xhc3MoImlmIik7CiAgICAgICAgdmFyIGlmVHJ1ZSA9IHRydWU7CiAgICAgICAgdmFyIGNsYXNzTGlzdCA9IGNvbmQuYXR0cignY2xhc3MnKS5zcGxpdCgnICcpOwogICAgICAgICQuZWFjaCggY2xhc3NMaXN0LCBmdW5jdGlvbihpbmRleCwgY2xzKXsKICAgICAgICAgIGlmKGtleXMuaW5kZXhPZihjbHMudG9VcHBlckNhc2UoKSkgPCAwKSB7CiAgICAgICAgICAgIGlmVHJ1ZSA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgY29uZC5yZW1vdmVDbGFzcyhjbHMpOwogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIC8vIHJlbW92ZSBmYWxzZSBpZnMKICAgICAgICBpZiAoIWlmVHJ1ZSkgewogICAgICAgICAgY29uZC5yZW1vdmUoKTsKICAgICAgICB9CiAgICAgIH0gd2hpbGUgKHRydWUpOwogICAgICAKICAgICAgLy8gZmlsbCBpbiByZW1haW5pbmcgZmllbGRzIAogICAgICBmb3IgKHZhciBpbmRleCBpbiBrZXlzKSB7CiAgICAgICAgdmFyIGtleSA9IGtleXNbaW5kZXhdOwogICAgICAgIHZhciB2YWx1ZSA9IGVudHJ5W2tleV0gfHwgIiI7CiAgICAgICAgdHBsLmZpbmQoInNwYW46bm90KGEpLiIgKyBrZXkudG9Mb3dlckNhc2UoKSkuaHRtbCh0aGlzLmZpeFZhbHVlKHZhbHVlKSk7CiAgICAgICAgdHBsLmZpbmQoImEuIiArIGtleS50b0xvd2VyQ2FzZSgpKS5hdHRyKCdocmVmJywgdGhpcy5maXhWYWx1ZSh2YWx1ZSkpOwogICAgICB9CiAgICAgIAogICAgICBvdXRwdXQuYXBwZW5kKHRwbCk7CiAgICAgIHRwbC5zaG93KCk7CiAgICB9CiAgICAKICAgIC8vIHJlbW92ZSBvbGQgZW50cmllcwogICAgb2xkLnJlbW92ZSgpOwogIH0KCn0KCmZ1bmN0aW9uIGJpYnRleF9qc19kcmF3KCkgewogICAgLy8gY2hlY2sgZm9yIHRlbXBsYXRlLCBhZGQgZGVmYXVsdAogICAgaWYgKCQoIi5iaWJ0ZXhfdGVtcGxhdGUiKS5zaXplKCkgPT0gMCkgewogICAgICAkKCJib2R5IikuYXBwZW5kKCI8ZGl2IGNsYXNzPVwiYmlidGV4X3RlbXBsYXRlXCI+PGRpdiBjbGFzcz1cImlmIGF1dGhvclwiIHN0eWxlPVwiZm9udC13ZWlnaHQ6IGJvbGQ7XCI+XG4gIDxzcGFuIGNsYXNzPVwiaWYgeWVhclwiPlxuICAgIDxzcGFuIGNsYXNzPVwieWVhclwiPjwvc3Bhbj4sIFxuICA8L3NwYW4+XG4gIDxzcGFuIGNsYXNzPVwiYXV0aG9yXCI+PC9zcGFuPlxuICA8c3BhbiBjbGFzcz1cImlmIHVybFwiIHN0eWxlPVwibWFyZ2luLWxlZnQ6IDIwcHhcIj5cbiAgICA8YSBjbGFzcz1cInVybFwiIHN0eWxlPVwiY29sb3I6YmxhY2s7IGZvbnQtc2l6ZToxMHB4XCI+KHZpZXcgb25saW5lKTwvYT5cbiAgPC9zcGFuPlxuPC9kaXY+XG48ZGl2IHN0eWxlPVwibWFyZ2luLWxlZnQ6IDEwcHg7IG1hcmdpbi1ib3R0b206NXB4O1wiPlxuICA8c3BhbiBjbGFzcz1cInRpdGxlXCI+PC9zcGFuPlxuPC9kaXY+PC9kaXY+Iik7CiAgICB9ICAgIAogICAgJCgiLmJpYnRleF90ZW1wbGF0ZSIpLmhpZGUoKTsKICAgIChuZXcgQmlidGV4RGlzcGxheSgpKS5kaXNwbGF5QmlidGV4KCQoIiNiaWJ0ZXhfaW5wdXQiKS52YWwoKSwgJCgiI2JpYnRleF9kaXNwbGF5IikpOwp9CgoKCi8qKgogKiBQYXJzZXMgYSBzdHJpbmcgaW50byBiaWJ0ZXgKICovCmV4cG9ydHMuQmlidGV4UGFyc2VyID0gQmlidGV4UGFyc2VyOwoKfSl9OwoKLyoqKioqKioqKiogbGliL2V2ZW50cyAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImxpYi9ldmVudHMiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLyoqCiAqIEJpbmRpbmdzIHRvIEthbnNvIGV2ZW50cwogKgogKiAobW9zdCBvZiB0aGlzIGlzIHRha2VuIGZyb20gdGhlIGthbnNvIGFkbWluIGFwcCBleGFtcGxlLAogKiAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9jYW9sYW4va2Fuc28vYmxvYi9tYXN0ZXIvYWRtaW4vbGliL2FwcC5qcykKICovCgp2YXIgZXZlbnRzID0gcmVxdWlyZSgna2Fuc28vZXZlbnRzJyksCiAgICBzZXNzaW9uID0gcmVxdWlyZSgna2Fuc28vc2Vzc2lvbicpLAogICAgdGVtcGxhdGVzID0gcmVxdWlyZSgna2Fuc28vdGVtcGxhdGVzJyksCiAgICBldmVudHMgPSByZXF1aXJlKCdrYW5zby9ldmVudHMnKSwKICAgIGRiID0gcmVxdWlyZSgna2Fuc28vZGInKTsKCgoKLyoqCiAqIFRoZSBpbml0IG1ldGhvZCBmaXJlcyB3aGVuIHRoZSBhcHAgaXMgaW5pdGlhbGx5IGxvYWRlZCBmcm9tIGEgcGFnZSByZW5kZXJlZAogKiBieSBDb3VjaERCLiAgKERPRVNOJ1QgU0VFTSBUTyBXT1JLKQogKi8KZXZlbnRzLm9uKCdpbml0JywgZnVuY3Rpb24gKCkgewogICAgYmluZFNlc3Npb25Db250cm9scygpOwp9KTsKCgovKioKICogVGhlIHNlc3Npb25DaGFuZ2UgZXZlbnQgZmlyZXMgd2hlbiB0aGUgYXBwIGlzIGZpcnN0IGxvYWRlZCBhbmQgdGhlIHVzZXIncwogKiBzZXNzaW9uIGluZm9ybWF0aW9uIGJlY29tZXMgYXZhaWxhYmxlLiBJdCBpcyBhbHNvIGZpcmVkIHdoZW5ldmVyIGEgY2hhbmdlCiAqIHRvIHRoZSB1c2VyJ3Mgc2Vzc2lvbiBpcyBkZXRlY3RlZCwgZm9yIGV4YW1wbGUgYWZ0ZXIgbG9nZ2luZyBpbiBvciBvdXQuCiAqLwpldmVudHMub24oJ3Nlc3Npb25DaGFuZ2UnLCBmdW5jdGlvbiAodXNlckN0eCwgcmVxKSB7CiAgICAkKCcjc2Vzc2lvbicpLnJlcGxhY2VXaXRoKHRlbXBsYXRlcy5yZW5kZXIoJ3Nlc3Npb24uaHRtbCcsIHJlcSwgdXNlckN0eCkpOwogICAgJCgnI3JlZ2lzdHJhdGlvbicpLnJlcGxhY2VXaXRoKHRlbXBsYXRlcy5yZW5kZXIoJ3JlZ2lzdHJhdGlvbi5odG1sJywgcmVxLCB1c2VyQ3R4KSk7Cn0pOwoKCgovKioKICogVGhlIHVwZGF0ZUZhaWx1cmUgZXZlbnQgZmlyZXMgd2hlbiBhbiB1cGRhdGUgZnVuY3Rpb24gcmV0dXJucyBhIGRvY3VtZW50IGFzCiAqIHRoZSBmaXJzdCBwYXJ0IG9mIGFuIGFycmF5LCBidXQgdGhlIGNsaWVudC1zaWRlIHJlcXVlc3QgdG8gdXBkYXRlIHRoZQogKiBkb2N1bWVudCBmYWlscy4KICovCgpldmVudHMub24oJ3VwZGF0ZUZhaWx1cmUnLCBmdW5jdGlvbiAoZXJyLCBpbmZvLCByZXEsIHJlcywgZG9jKSB7CiAgICBhbGVydChlcnIubWVzc2FnZSB8fCBlcnIudG9TdHJpbmcoKSk7Cn0pOwoKCi8vIC0tLSBucmFtYSBvbmx5IGFmdGVyIGhlcmUKCi8qKgogKiBhZnRlclJlc3BvbnNlIGlzIG5vdCBkb2N1bWVudGVkLCBidXQgSSB0aGluayBpdCBmaXJlcyBhZnRlciB0aGUKICogZG9jdW1lbnQgaGFzIGJlZW4gcmVuZGVyZWQgYnkgdGhlIGNsaWVudCAoYW5kIG5vdCBhZnRlciByZW5kZXJpbmcgYnkgdGhlIHNlcnZlcikKICovCmV2ZW50cy5vbignYWZ0ZXJSZXNwb25zZScsIGZ1bmN0aW9uKGluZm8sIHJlcSwgcmVzKSB7CglpZiggcmVxLmNsaWVudCAmJiB0eXBlb2YgJCAhPT0ndW5kZWZpbmVkJyApIHsKICAgICAgICAkKCcuX3RpbWVhZ28nKS50aW1lYWdvKCk7CiAgICAgICAgJCgnLl9zb3J0LW1lJykuc29ydGxpc3QoKTsKICAgICAgICAkKCd0ZXh0YXJlYS5fbnJhbWEtbm90ZS1jb250ZW50JykuYXV0b2dyb3coKTsKCX0KfSk7CgoKLyoqCiAqIC0tLSBtb2RpZmllZCBmcm9tIHRoZSBrYW5zbyBhZG1pbiBhcHAKICogaXQncyBsaXZlID0gY2FsbCBvbmx5IG9uY2UKICovCnZhciBiaW5kU2Vzc2lvbkNvbnRyb2xzID0gZnVuY3Rpb24gKCkgewogICAgJCgnI3Nlc3Npb24gLmxvZ291dCBhJykuZGllKCkubGl2ZSgnY2xpY2snLCBmdW5jdGlvbiAoZXYpIHsKICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHNlc3Npb24ubG9nb3V0KCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CiAgICAkKCcubG9naW4gYScpLmRpZSgpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2YXIgZGl2ID0gJCgnPGRpdj48aDI+TG9naW48L2gyPjwvZGl2PicpOwogICAgICAgIGRpdi5hcHBlbmQoJzxmb3JtIGlkPSJsb2dpbl9mb3JtIiBhY3Rpb249Ii9fc2Vzc2lvbiIgbWV0aG9kPSJQT1NUIj4nICsKICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImdlbmVyYWxfZXJyb3JzIj48L2Rpdj4nICsKICAgICAgICAgICAgJzxkaXYgY2xhc3M9InVzZXJuYW1lIGZpZWxkIj4nICsKICAgICAgICAgICAgICAgICc8bGFiZWwgZm9yPSJpZF9uYW1lIj5Vc2VybmFtZTwvbGFiZWw+JyArCiAgICAgICAgICAgICAgICAnPGlucHV0IGlkPSJpZF9uYW1lIiBuYW1lPSJuYW1lIiB0eXBlPSJ0ZXh0IiAvPicgKwogICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImVycm9ycyI+PC9kaXY+JyArCiAgICAgICAgICAgICc8L2Rpdj4nICsKICAgICAgICAgICAgJzxkaXYgY2xhc3M9InBhc3N3b3JkIGZpZWxkIj4nICsKICAgICAgICAgICAgICAgICc8bGFiZWwgZm9yPSJpZF9wYXNzd29yZCI+UGFzc3dvcmQ8L2xhYmVsPicgKwogICAgICAgICAgICAgICAgJzxpbnB1dCBpZD0iaWRfcGFzc3dvcmQiIG5hbWU9InBhc3N3b3JkIiB0eXBlPSJwYXNzd29yZCIgLz4nICsKICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJlcnJvcnMiPjwvZGl2PicgKwogICAgICAgICAgICAnPC9kaXY+JyArCiAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJhY3Rpb25zIj4nICsKICAgICAgICAgICAgICAgICc8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0iaWRfY2FuY2VsIiB2YWx1ZT0iQ2FuY2VsIiAvPicgKwogICAgICAgICAgICAgICAgJzxpbnB1dCB0eXBlPSJzdWJtaXQiIGlkPSJpZF9sb2dpbiIgdmFsdWU9IkxvZ2luIiAvPicgKwogICAgICAgICAgICAnPC9kaXY+JyArCiAgICAgICAgJzwvZm9ybT4nKTsKICAgICAgICAkKCcjaWRfY2FuY2VsJywgZGl2KS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICQubW9kYWwuY2xvc2UoKTsKICAgICAgICB9KTsKICAgICAgICAkKCdmb3JtJywgZGl2KS5zdWJtaXQoZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciB1c2VybmFtZSA9ICQoJ2lucHV0W25hbWU9Im5hbWUiXScsIGRpdikudmFsKCk7CiAgICAgICAgICAgIHZhciBwYXNzd29yZCA9ICQoJ2lucHV0W25hbWU9InBhc3N3b3JkIl0nLCBkaXYpLnZhbCgpOwogICAgICAgICAgICBjb25zb2xlLmxvZygkKCcudXNlcm5hbWUgLmVycm9ycycsIGRpdikpOwogICAgICAgICAgICAkKCcudXNlcm5hbWUgLmVycm9ycycsIGRpdikudGV4dCgKICAgICAgICAgICAgICAgIHVzZXJuYW1lID8gJyc6ICdQbGVhc2UgZW50ZXIgYSB1c2VybmFtZScKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJCgnLnBhc3N3b3JkIC5lcnJvcnMnLCBkaXYpLnRleHQoCiAgICAgICAgICAgICAgICBwYXNzd29yZCA/ICcnOiAnUGxlYXNlIGVudGVyIGEgcGFzc3dvcmQnCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICh1c2VybmFtZSAmJiBwYXNzd29yZCkgewogICAgICAgICAgICAgICAgc2Vzc2lvbi5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQsIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAkKCcuZ2VuZXJhbF9lcnJvcnMnLCBkaXYpLnRleHQoZXJyID8gZXJyLnRvU3RyaW5nKCk6ICcnKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWVycikgewogICAgICAgICAgICAgICAgICAgICAgICAkKGRpdikuZmFkZU91dCgnc2xvdycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQubW9kYWwuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0pOwogICAgICAgIGRpdi5tb2RhbCh7YXV0b1Jlc2l6ZTogdHJ1ZSwgb3ZlcmxheUNsb3NlOiB0cnVlfSk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CiAgICAkKCcuc2lnbnVwIGEnKS5kaWUoKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uIChldikgewogICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdmFyIGRpdiA9ICQoJzxkaXY+PGgyPkNyZWF0ZSBhbiBhY2NvdW50PC9oMj48L2Rpdj4nKTsKICAgICAgICBkaXYuYXBwZW5kKCI8cD5JdCdzIGZyZWUuPC9wPiIpOwogICAgICAgIGRpdi5hcHBlbmQoJzxmb3JtIGlkPSJzaWdudXBfZm9ybSIgYWN0aW9uPSIvX3Nlc3Npb24iIG1ldGhvZD0iUE9TVCI+JyArCiAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJnZW5lcmFsX2Vycm9ycyI+PC9kaXY+JyArCiAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJ1c2VybmFtZSBmaWVsZCI+JyArCiAgICAgICAgICAgICAgICAnPGxhYmVsIGZvcj0iaWRfbmFtZSI+VXNlcm5hbWU8L2xhYmVsPicgKwogICAgICAgICAgICAgICAgJzxpbnB1dCBpZD0iaWRfbmFtZSIgbmFtZT0ibmFtZSIgdHlwZT0idGV4dCIgLz4nICsKICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJlcnJvcnMiPjwvZGl2PicgKwogICAgICAgICAgICAnPC9kaXY+JyArCiAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJwYXNzd29yZCBmaWVsZCI+JyArCiAgICAgICAgICAgICAgICAnPGxhYmVsIGZvcj0iaWRfcGFzc3dvcmQiPlBhc3N3b3JkPC9sYWJlbD4nICsKICAgICAgICAgICAgICAgICc8aW5wdXQgaWQ9ImlkX3Bhc3N3b3JkIiBuYW1lPSJwYXNzd29yZCIgdHlwZT0icGFzc3dvcmQiIC8+JyArCiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iZXJyb3JzIj48L2Rpdj4nICsKICAgICAgICAgICAgJzwvZGl2PicgKwogICAgICAgICAgICAnPGRpdiBjbGFzcz0iYWN0aW9ucyI+JyArCiAgICAgICAgICAgICAgICAnPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9ImlkX2NhbmNlbCIgdmFsdWU9IkNhbmNlbCIgLz4nICsKICAgICAgICAgICAgICAgICc8aW5wdXQgdHlwZT0ic3VibWl0IiBpZD0iaWRfY3JlYXRlIiB2YWx1ZT0iQ3JlYXRlIiAvPicgKwogICAgICAgICAgICAnPC9kaXY+JyArCiAgICAgICAgJzwvZm9ybT4nKTsKICAgICAgICAkKCcjaWRfY2FuY2VsJywgZGl2KS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICQubW9kYWwuY2xvc2UoKTsKICAgICAgICB9KTsKICAgICAgICAkKCdmb3JtJywgZGl2KS5zdWJtaXQoZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciB1c2VybmFtZSA9ICQoJ2lucHV0W25hbWU9Im5hbWUiXScsIGRpdikudmFsKCk7CiAgICAgICAgICAgIHZhciBwYXNzd29yZCA9ICQoJ2lucHV0W25hbWU9InBhc3N3b3JkIl0nLCBkaXYpLnZhbCgpOwogICAgICAgICAgICBjb25zb2xlLmxvZygkKCcudXNlcm5hbWUgLmVycm9ycycsIGRpdikpOwogICAgICAgICAgICAkKCcudXNlcm5hbWUgLmVycm9ycycsIGRpdikudGV4dCgKICAgICAgICAgICAgICAgIHVzZXJuYW1lID8gJyc6ICdQbGVhc2UgZW50ZXIgYSB1c2VybmFtZScKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJCgnLnBhc3N3b3JkIC5lcnJvcnMnLCBkaXYpLnRleHQoCiAgICAgICAgICAgICAgICBwYXNzd29yZCA/ICcnOiAnUGxlYXNlIGVudGVyIGEgcGFzc3dvcmQnCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICh1c2VybmFtZSAmJiBwYXNzd29yZCkgewogICAgICAgICAgICAgICAgc2Vzc2lvbi5zaWdudXAodXNlcm5hbWUsIHBhc3N3b3JkLCBmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAkKCcuZ2VuZXJhbF9lcnJvcnMnLCBkaXYpLnRleHQoZXJyb3IgPyBlcnJvci50b1N0cmluZygpOiAnJyk7CiAgICAgICAgICAgICAgICAgICAgaWYoIGVycm9yICkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiggZXJyb3Iuc3RhdHVzID09PSA0MDkgfHwgZXJyb3IuZXJyb3IgPT09ICdjb25mbGljdCcgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuZ2VuZXJhbF9lcnJvcnMnLCBkaXYpLnRleHQoJ1RoYXQgdXNlcm5hbWUgaXMgYWxyZWFkeSB0YWtlbicpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQsIGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmdlbmVyYWxfZXJyb3JzJywgZGl2KS50ZXh0KGVycm9yID8gZXJyb3IudG9TdHJpbmcoKTogJycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkaXYpLmZhZGVPdXQoJ3Nsb3cnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5tb2RhbC5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9KTsKICAgICAgICBkaXYubW9kYWwoe2F1dG9SZXNpemU6IHRydWUsIG92ZXJsYXlDbG9zZTogdHJ1ZX0pOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0pOwp9OwoKfSl9OwoKLyoqKioqKioqKiogbGliL2ZpbHRlcnMgKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJsaWIvZmlsdGVycyJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKioKICogRmlsdGVyIGZ1bmN0aW9ucyB0byBiZSBleHBvcnRlZCBmcm9tIHRoZSBkZXNpZ24gZG9jLgogKi8KCgp9KX07CgovKioqKioqKioqKiBsaWIvbGlzdHMgKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJsaWIvbGlzdHMiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLyoqCiAqIExpc3QgZnVuY3Rpb25zIHRvIGJlIGV4cG9ydGVkIGZyb20gdGhlIGRlc2lnbiBkb2MuCiAqLwp2YXIgdGVtcGxhdGVzID0gcmVxdWlyZSgna2Fuc28vdGVtcGxhdGVzJyksCiAgICBldmVudHMgPSByZXF1aXJlKCdrYW5zby9ldmVudHMnKSwKICAgIGRiID0gcmVxdWlyZSgna2Fuc28vZGInKSwKICAgIF8gPSByZXF1aXJlKCcuL3VuZGVyc2NvcmUnKS5fLAogICAgbnJhbWFfaW5pdCA9IHJlcXVpcmUoJy4vbnJhbWEyX2luaXQnKS5pbml0OwoKCi8qKgogKiBzZXQgdGhlIHRpdGxlIGVsZW1lbnQgZm9yIGEgcGFnZSBiYXNlZCBvbiB0aGUgcXVlcnkKICovCnZhciBtYWtlX3RpdGxlID0gZnVuY3Rpb24od2hhdCwgcmVxKSB7CiAgICB2YXIgdGl0bGUgPSAnTm90ZS1vLXJhbWEgOiAnOwogICAgaWYoIHJlcS5xdWVyeSAmJiByZXEucXVlcnkudXNlciApIHsKICAgICAgICB0aXRsZSArPSByZXEucXVlcnkudXNlcisiJ3MgIit3aGF0OwogICAgfSBlbHNlIHsKICAgICAgICB0aXRsZSArPSB3aGF0OwogICAgfQogICAgcmV0dXJuIHRpdGxlOwp9CgovKioKICogVGhlIHRlbXBsYXRlcyBuZWVkIHRvIGtub3cgd2hhdCdzIGluIHRoZSBwYXRoIG9mIHRoZSBjdXJyZW50IHVybCBhbmQgaG93IHRvCiAqIGluY2x1ZGUgcGFydHMgb2YgdGhhdCBpbiBjcmVhdGluZyBsaW5rcy4KICogVGhpcyBtYXkgaW5jbHVkZSBnYXJiYWdlIGxpa2UgJ2dyb3VwJyBhbmQgJ2Rlc2NlbmRpbmcnIHBhcmFtZXRlcnMuCiAqCiAqIFVzZTogZS5nLiA8YSBocmVmPSJ7YmFzZVVSTH17cXVlcnlfdXNlcl91cmx9L2F1dGhvcnMve2F1dGhvcn0iPnthdXRob3J9PC9hPgogKiAgd2lsbCBwcm92aWRlIGEgbGluayB0byAvdXNlcnMvdXNlci9hdXRob3JzL2F1dGhvciBmcm9tIGEgcGFnZSB3aXRoIGEgdXNlciBpbiBpdHMgcGF0aCwKICogIGFuZCBhIGxpbmsgdG8gL2F1dGhvcnMvYXV0aG9yIGZyb20gYSBwYWdlIHdpdGggbm8gc3VjaCBsaW5rLgogKi8KdmFyIF9tYWtlX3F1ZXJ5X3VybHMgPSBmdW5jdGlvbiggcmVxKSB7CiAgICB2YXIgcXVlcnlfdXJscyA9IHt9CiAgICBfKHJlcS5xdWVyeSkuZWFjaChmdW5jdGlvbih2YWx1ZSwga2V5KXsKICAgICAgICBxdWVyeV91cmxzWydxdWVyeV8nK2tleV0gPSB2YWx1ZTsKICAgICAgICBxdWVyeV91cmxzWydxdWVyeV8nK2tleSsnX3VybCddID0gJy8nK2tleSsncy8nK2VuY29kZVVSSUNvbXBvbmVudCggdmFsdWUgKTsKICAgIH0pOwogICAgcmV0dXJuIHF1ZXJ5X3VybHM7Cn0KCi8qKgogKiB1c2VkIGluIHRlbXBsYXRlcyA6IHRydWUgaWYgYnJvc3dlci1yZW5kZXJlZCBhbmQgdGhlIGN1cnJlbnQgbm90ZXMgJiBxdW90ZXMgYXJlIHRoZSB1c2VyJ3MKICogIChjb21iaW5lIHRoZSB0d28gdGhpbmdzIGJlY2F1c2Ugd2UncmUgbWFpbmx5IGludGVyZXN0ZWQgaW4gd2hldGhlciB0aGUgdXNlciBjYW4gZWRpdCkKICovCnZhciBfaXNfdXNlcnNfb3duX3BhZ2UgPSBmdW5jdGlvbihyZXEpIHsKICAgIHJldHVybiB7CiAgICAgICAgaXNfdXNlcnNfb3duX3BhZ2UgOiByZXEuY2xpZW50ICYmIHJlcS5xdWVyeS51c2VyICYmIHJlcS5xdWVyeS51c2VyPT1yZXEudXNlckN0eC5uYW1lCiAgICB9Owp9CgoKLyoqCiAqCiAqLwp2YXIgbWFrZV91bml2ZXJzYWxfdGVtcGxhdGVfZGF0YSA9IGZ1bmN0aW9uKHJlcSkgewogICAgdmFyIHVuaXZlcnNhbF90ZW1wbGF0ZV9kYXRhID0gXy5leHRlbmQoCiAgICAgICAgX21ha2VfcXVlcnlfdXJscyhyZXEpLAogICAgICAgIF9pc191c2Vyc19vd25fcGFnZShyZXEpLAogICAgICAgIHsgcmVxX2NsaWVudCA6IHJlcS5jbGllbnQgfQogICAgKTsKCiAgICAvL1RPRE8gcmVtb3ZlIChmb3IgdGVzdGluZyBvbmx5KQogICAgaWYoIHJlcS5jbGllbnQgKSB7CiAgICAgICAgd2luZG93LnJlcSA9IHJlcTsKICAgICAgICB3aW5kb3cudXRkID0gdW5pdmVyc2FsX3RlbXBsYXRlX2RhdGE7CiAgICAgICAgd2luZG93Ll8gPSBfOwogICAgfQogICAgCiAgICByZXR1cm4gdW5pdmVyc2FsX3RlbXBsYXRlX2RhdGE7Cn0KCmV4cG9ydHMuYWxsX3VzZXJzID0gZnVuY3Rpb24gKGhlYWQsIHJlcSkgewoKICAgIHN0YXJ0KHtjb2RlOiAyMDAsIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ3RleHQvaHRtbCd9fSk7CgogICAgLy8gZmV0Y2ggYWxsIHRoZSByb3dzCiAgICB2YXIgdXNlcnMgPSBbXTsKICAgIHZhciByb3c7CiAgICB3aGlsZSggcm93ID0gZ2V0Um93KCkgKSB7CiAgICAgICAgdmFyIHVwZGF0ZWRfdGltZSA9ICcnOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHVwZGF0ZWRfdGltZSA9IG5ldyBEYXRlKHBhcnNlSW50KHJvdy52YWx1ZS5tYXgpKS50b0lTT1N0cmluZygpCiAgICAgICAgfSBjYXRjaChlKSB7fQogICAgICAgIHVzZXJzLnB1c2goewogICAgICAgICAgICB1c2VyX2lkIDogcm93LmtleSwKICAgICAgICAgICAgdXBkYXRlZF90aW1lIDogdXBkYXRlZF90aW1lICAgIC8vdGhpcyBpcyB0aW1lIGEgc291cmNlIHdhcyB1cGRhdGVkCiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gZ2VuZXJhdGUgdGhlIG1hcmt1cCBmb3IgYSBsaXN0IG9mIHVzZXJzCiAgICB2YXIgY29udGVudCA9IHRlbXBsYXRlcy5yZW5kZXIoJ2FsbF91c2Vycy5odG1sJywgcmVxLCBfKHsKICAgICAgICAgICAgdXNlcnMgOiB1c2VycwogICAgICAgIH0pLmV4dGVuZCggbWFrZV91bml2ZXJzYWxfdGVtcGxhdGVfZGF0YShyZXEpICkKICAgICk7CgogICAgcmV0dXJuIHt0aXRsZTogbWFrZV90aXRsZSgndXNlcnMnLHJlcSksIGNvbnRlbnQ6IGNvbnRlbnR9OwoKfTsKCgovKioKICogbGlzdCBhbGwgc291cmNlcyBmb3Igc2luZ2xlIHVzZXIgb3IgZm9yIGFsbCB1c2VycwogKiB3b3JrcyB3aXRoIHZpZXcgdXNlcklkX3NvdXJjZQogKiBUaGUgc291cmNlcyBhcmUgbGlzdGVkIGluIHRoZSBvcmRlciB0aGV5IHdlcmUgbGFzdCB1cGRhdGVkCiAqLwpleHBvcnRzLnNvdXJjZXMgPSBmdW5jdGlvbihoZWFkLCByZXEpIHsKICAgIHN0YXJ0KHtjb2RlOiAyMDAsIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ3RleHQvaHRtbCd9fSk7CgogICAgdmFyIHNvdXJjZXMgPSBbXTsKICAgIHZhciByb3c7CiAgICB3aGlsZSggcm93ID0gZ2V0Um93KCkgKSB7CiAgICAgICAgaWYoIHJvdy5kb2MgKSB7CiAgICAgICAgICAgIHZhciB0aGluZyA9IHJvdy5kb2M7CiAgICAgICAgICAgIGlmKCB0aGluZy50eXBlICYmIHRoaW5nLnR5cGUgPT0gJ3NvdXJjZScgKSB7CiAgICAgICAgICAgICAgICBpZiggdGhpbmcucGFnZV9pZCApIHsKICAgICAgICAgICAgICAgICAgICB0aGluZy5wYWdlX2lkX2VuYyA9IGVuY29kZVVSSUNvbXBvbmVudCh0aGluZy5wYWdlX2lkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCB0aGluZy51cGRhdGVkICkgewogICAgICAgICAgICAgICAgICAgIHRoaW5nLnVwZGF0ZWRfdGltZSA9IG5ldyBEYXRlKHRoaW5nLnVwZGF0ZWQpLnRvSVNPU3RyaW5nKCk7ICAgLy9odW1hbi1yZWFkYWJsZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc291cmNlcy5wdXNoKHRoaW5nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgdmFyIGNvbnRlbnQgPSB0ZW1wbGF0ZXMucmVuZGVyKCdzb3VyY2VzLmh0bWwnLCByZXEsIF8oewogICAgICAgICAgICBzb3VyY2VzIDogc291cmNlcwogICAgICAgIH0pLmV4dGVuZCggbWFrZV91bml2ZXJzYWxfdGVtcGxhdGVfZGF0YShyZXEpICkKICAgICk7CiAgICAKICAgIHJldHVybiB7dGl0bGU6IG1ha2VfdGl0bGUoJ3NvdXJjZXMnLHJlcSksIGNvbnRlbnQ6IGNvbnRlbnQgfTsKfTsKCgovKioKICogbGlzdCBhdXRob3JzIChhbmQgdGhlaXIgc291cmNlcykKICogdXNlIHdpdGggdXNlcklkX2F1dGhvciB2aWV3CiAqCiAqIEhlcmUgd2UgZXhwbG9pdCB0aGUgZmFjdCB0aGF0IHRoZSByb3dzIGFyZSBzb3J0ZWQgYnkgYXV0aG9yLgogKiBUaGUgcXVlcnkgc2hvdWxkIHByb3ZpZGUgYXV0aG9yX2luZGV4X2luX2tleSB0byBzcGVjaWZ5IHdoZXJlIGluIHRoZSB2aWV3LXByb3ZpZGVkCiAqICAga2V5IGFuIGF1dGhvcidzIG5hbWUgY2FuIGJlIGZvdW5kLgogKi8KZXhwb3J0cy5hdXRob3JzID0gZnVuY3Rpb24gKGhlYWQsIHJlcSkgewoKICAgIHN0YXJ0KHtjb2RlOiAyMDAsIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ3RleHQvaHRtbCd9fSk7CgogICAgdmFyIGF1dGhvcnMgPSBbXTsgICAvL2tleXMgd2lsbCBiZSBhdXRob3JzLCB2YWx1ZXMgd2lsbCBiZSBhIGxpc3Qgb2Ygc291cmNlcwogICAgdmFyIGF1dGhvcl9pbmRleF9pbl9rZXkgPSBwYXJzZUludCggcmVxLnF1ZXJ5LmF1dGhvcl9pbmRleF9pbl9rZXkgKTsKCiAgICB2YXIgcm93ID0gZ2V0Um93KCk7CiAgICB3aGlsZSggcm93ICkgewogICAgICAgIGlmKCAhcm93IHx8ICFyb3cua2V5IHx8ICFyb3cua2V5W2F1dGhvcl9pbmRleF9pbl9rZXldICkgewogICAgICAgICAgICByb3cgPSBnZXRSb3coKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHZhciBjdXJyZW50X2F1dGhvciA9IHJvdy5rZXlbYXV0aG9yX2luZGV4X2luX2tleV07CiAgICAgICAgYXV0aG9yX3NvdXJjZXMgPSB7CiAgICAgICAgICAgIGF1dGhvcl9uYW1lIDogY3VycmVudF9hdXRob3IsCiAgICAgICAgICAgIHNvdXJjZXMgOiBbcm93LmRvY10KICAgICAgICB9OwogICAgICAgIHJvdyA9IGdldFJvdygpOwogICAgICAgIHdoaWxlKCByb3cgJiYgcm93LmtleVthdXRob3JfaW5kZXhfaW5fa2V5XSA9PSBjdXJyZW50X2F1dGhvciApIHsKICAgICAgICAgICAgYXV0aG9yX3NvdXJjZXMuc291cmNlcy5wdXNoKHJvdy5kb2MpCiAgICAgICAgICAgIHJvdyA9IGdldFJvdygpOwogICAgICAgIH0KICAgICAgICBhdXRob3JzLnB1c2goYXV0aG9yX3NvdXJjZXMpOwogICAgfQoKICAgIHZhciBjb250ZW50ID0gdGVtcGxhdGVzLnJlbmRlcignYXV0aG9ycy5odG1sJywgcmVxLCBfKHsKICAgICAgICAgICAgYXV0aG9ycyA6IGF1dGhvcnMKICAgICAgICB9KS5leHRlbmQoIG1ha2VfdW5pdmVyc2FsX3RlbXBsYXRlX2RhdGEocmVxKSApCiAgICApOwoKICAgIHJldHVybiB7dGl0bGU6IG1ha2VfdGl0bGUoJ2F1dGhvcnMnLHJlcSksIGNvbnRlbnQ6IGNvbnRlbnR9OwoKfTsKCi8qKgogKiB0YWcgY2xvdWQgZm9yIFthbGwgdXNlcnMnIHwgYSB1c2VyJ3NdIHRhZ3MKICogdXNlciB3aXRoIHZpZXdzOiB0YWdzX2FsbCBhbmQgdGFncwogKgogKiB0aGUgcXVlcnkgc2hvdWxkIGluY2x1ZGUgdGFnX2luZGV4X2luX2tleSB3aGljaCBzcGVjaWZpZXMgdGhlIGluZGV4IG9mIHRoZSB0YWcKICogICBpbiB0aGUga2V5IHByb3ZpZGVkIGJ5IHRoZSB2aWV3CiAqLwpleHBvcnRzLnRhZ3MgPSBmdW5jdGlvbihoZWFkLCByZXEpIHsKICAgIHN0YXJ0KHtjb2RlOiAyMDAsIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ3RleHQvaHRtbCd9fSk7CgogICAgdmFyIHRhZ19pbmRleF9pbl9rZXkgPSBwYXJzZUludCggcmVxLnF1ZXJ5LnRhZ19pbmRleF9pbl9rZXkgKTsKICAgIAogICAgdmFyIHRhZ3MgPSBbXTsKICAgIAogICAgdmFyIHJvdyA7CiAgICB3aGlsZSggcm93ID0gZ2V0Um93KCkgKSB7CiAgICAgICAgaWYoICFyb3cua2V5IHx8ICFyb3cua2V5W3RhZ19pbmRleF9pbl9rZXldICkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdGFncy5wdXNoKHsKICAgICAgICAgICB0ZXh0IDogcm93LmtleVt0YWdfaW5kZXhfaW5fa2V5XSwKICAgICAgICAgICB3ZWlnaHQgOiByb3cudmFsdWUsCiAgICAgICAgICAgdXJsIDogIi8iCiAgICAgICAgfSk7CiAgICB9CiAgICB2YXIgY29udGVudCA9IHRlbXBsYXRlcy5yZW5kZXIoJ3RhZ3MuaHRtbCcsIHJlcSwgXyh7CiAgICAgICAgICAgIHRhZ3MgOiB0YWdzCiAgICAgICAgfSkuZXh0ZW5kKCBtYWtlX3VuaXZlcnNhbF90ZW1wbGF0ZV9kYXRhKHJlcSkgKQogICAgKTsKCiAgICBpZiggcmVxLmNsaWVudCApIHsKICAgICAgICB3aW5kb3cudGFncyA9IHRhZ3M7IC8vdG9kbyByZW1vdmUKICAgICAgICAkKGRvY3VtZW50KS5vbmUoJ25yYW1hX3BhZ2VfbG9hZGVkJywgZnVuY3Rpb24oKXsKICAgICAgICAgICAgJCgnI3RhZ19jbG91ZCcpLmpRQ2xvdWQodGFncywgewogICAgICAgICAgICAgICAgY2FsbGJhY2sgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAkKCcjdGFnX2Nsb3VkIGEnKS5lYWNoKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuYXR0cignaHJlZicsIHJlcS51c2VyQ3R4LmJhc2VVUkwgKyAocmVxLnF1ZXJ5LnVzZXIgPyAnL3VzZXJzLycrZW5jb2RlVVJJQ29tcG9uZW50KHJlcS5xdWVyeS51c2VyKSA6ICcnKSArICcvdGFncy8nKyAkKHRoaXMpLnRleHQoKSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQoKCiAgICByZXR1cm4ge3RpdGxlOiBtYWtlX3RpdGxlKCd0YWdzJyxyZXEpLCBjb250ZW50OiBjb250ZW50fTsKfQoKLyoqCiAqIFdyaXR0ZW4gZm9yIHNpbmdsZSBvciBtdWx0aS11c2Vycy4KICogVE9ETyBmYWN0b3Igb3V0IGNvbW1vbiBwYXJ0cyB3aXRoIGV4cG9ydHMucXVvdGVzCiAqIChtb3N0IG9mIHRoaXMgaXMgZHVwbGljYXRlZCwgYW5kIHRoZSBucmFtYSBwYXJ0IGlzIFZFUkJBVElNKQogKi8KZXhwb3J0cy5mbG93ID0gZnVuY3Rpb24oaGVhZCwgcmVxKSB7CiAgICBzdGFydCh7Y29kZTogMjAwLCBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICd0ZXh0L2h0bWwnfX0pOwoKICAgIHZhciBmaW5kX3NvdXJjZSA9IHt9OyAgIC8vaW5kZXhlZCBieSBfaWQKICAgIHZhciBmaW5kX3F1b3RlID0ge307ICAgIC8vaW5kZXhlZCBieSBxdW90ZV9oYXNoLCBwcmlvcml0eSB0byB0aGUgZmlyc3Qgd2UgZmluZAogICAgdmFyIGZpbmRfbm90ZSA9IHt9OyAvL2luZGV4ZWQgYnkgX2lkCiAgIAogICAgdmFyIHJvdzsKICAgIHdoaWxlKCByb3cgID0gZ2V0Um93KCkgKSB7CiAgICAgICAgdmFyIHRoaW5nID0gcm93LmRvYzsgICAgICAgIC8vIDwtLSBOQiBtdXN0IGJlIHVzZWQgd2l0aCA/aW5jbHVkZV9kb2NzPXRydWUKICAgICAgICAKICAgICAgICBpZiggIXRoaW5nIHx8ICF0aGluZy50eXBlICkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYoIHRoaW5nLnR5cGUgPT0gJ3NvdXJjZScgKSB7CiAgICAgICAgICAgIHZhciBzb3VyY2UgPSB0aGluZzsKICAgICAgICAgICAgZmluZF9zb3VyY2Vbc291cmNlLl9pZF0gPSBzb3VyY2U7CiAgICAgICAgICAgIHNvdXJjZS51cGRhdGVkX3RpbWUgPSBuZXcgRGF0ZShzb3VyY2UudXBkYXRlZCkudG9JU09TdHJpbmcoKTsgICAvL25iIHNob3VsZCBub3QgcGVyc2lzdCB0aGlzIHByb3BlcnR5CiAgICAgICAgfQogICAgICAgIGlmKCB0aGluZy50eXBlID09ICdxdW90ZScgKSB7CiAgICAgICAgICAgIHZhciBxdW90ZSA9IHRoaW5nOwogICAgICAgICAgICBpZiggIWZpbmRfcXVvdGVbcXVvdGUuaGFzaF0gKSB7CiAgICAgICAgICAgICAgICBmaW5kX3F1b3RlW3F1b3RlLmhhc2hdID0gcXVvdGU7CiAgICAgICAgICAgICAgICBxdW90ZS51c2VycyA9IFtdOyAgIC8vbmIgc2hvdWxkIG5vdCBwZXJzaXN0IHRoaXMgcHJvcGVydHkgKHF1b3RlcyBhcmUgbm90IHVwZGF0ZWQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmluZF9xdW90ZVtxdW90ZS5oYXNoXS51c2Vycy5wdXNoKHF1b3RlLnVzZXJfaWQpOwogICAgICAgIH0KICAgICAgICBpZiggdGhpbmcudHlwZSA9PSAnbm90ZScgKSB7CiAgICAgICAgICAgIHZhciBub3RlID0gdGhpbmc7CiAgICAgICAgICAgIGZpbmRfbm90ZVtub3RlLl9pZF0gPSBub3RlOwogICAgICAgIH0KICAgIH0KCiAgICAvL2F0dGFjaCBub3RlcyB0byBxdW90ZXMKICAgIHZhciBub3RlcyA9IF8udmFsdWVzKGZpbmRfbm90ZSk7CiAgICB2YXIgbm90ZV9vcnBoYW5faWRzID0gW107ICAgLy9pZHMgb2Ygbm90ZXMgd2l0aCBubyBxdW90ZSBmb3VuZDsgCiAgICBfLmVhY2gobm90ZXMsIGZ1bmN0aW9uKG5vdGUpIHsKICAgICAgICB2YXIgcXVvdGUgPSBmaW5kX3F1b3RlW25vdGUucXVvdGVfaGFzaF07CiAgICAgICAgaWYoICFxdW90ZSApIHsKICAgICAgICAgICAgbm90ZV9vcnBoYW5faWRzLnB1c2gobm90ZS5faWQpOwogICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgaWYoICFxdW90ZS5ub3RlcyApewogICAgICAgICAgICAgICAgcXVvdGUubm90ZXMgPSBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBxdW90ZS5ub3Rlcy5wdXNoKG5vdGUpOwogICAgICAgIH0KICAgIH0pOwogICAgLy8gZm9yIG5vdyB3ZSBkb24ndCBkbyBhbnl0aGluZyB3aXRoIHRoZSBub3RlIG9ycGhhbnMKICAgIAogICAgLy9hdHRhY2ggc291cmNlcyB0byBxdW90ZXMKICAgIHZhciBxdW90ZXMgPSBfLnZhbHVlcyhmaW5kX3F1b3RlKTsKICAgIF8uZWFjaChxdW90ZXMsIGZ1bmN0aW9uKHF1b3RlKXsKICAgICAgICBxdW90ZS5zb3VyY2UgPSBmaW5kX3NvdXJjZVtxdW90ZS5zb3VyY2VfaWRdOyAvL21heSBiZSB1bmRlZmluZWQKICAgIH0pOwogICAgCiAgICBpZiggcmVxLmNsaWVudCApIHsKICAgICAgICB3aW5kb3cucXVvdGVzID0gcXVvdGVzOyAvL1RPRE8gZGVidWcgb25seQoKICAgICAgICAkKGRvY3VtZW50KS5vbmUoJ25yYW1hX3BhZ2VfbG9hZGVkJywgZnVuY3Rpb24oKXsKICAgICAgICAgICAgJCgnLl9zb3J0LW1lJykuc29ydGxpc3QoKTsKICAgICAgICAgICAgJCgndGV4dGFyZWEuX25yYW1hLW5vdGUtY29udGVudCcpLmF1dG9ncm93KCk7CiAgICAgICAgfSk7CiAgICB9CiAgICAKICAgIHZhciBjb250ZW50ID0gdGVtcGxhdGVzLnJlbmRlcignZmxvdy5odG1sJywgcmVxLCBfKHsKICAgICAgICAgICAgcXVvdGVzIDogcXVvdGVzCiAgICAgICAgfSkuZXh0ZW5kKCBtYWtlX3VuaXZlcnNhbF90ZW1wbGF0ZV9kYXRhKHJlcSkgKQogICAgKTsKCgogICAgLy8gLS0gY29uZmlndXJlIG5yYW1hLCBhdHRhY2ggZXZlbnQgbGlzdG5lcnMgKGNvcGllZCB2ZXJiYXRpbSBmcm9tIGV4cG9ydHMucXVvdGVzKQogICAgaWYoIHJlcS5jbGllbnQgKSB7CiAgICAgICAgCiAgICAgICAgdmFyIG5yYW1hID0gbnJhbWFfaW5pdChmaW5kX3NvdXJjZSk7CiAgICAgICAgd2luZG93Lm5yYW1hID0gbnJhbWE7ICAgICAgICAgICAgICAgICAgIC8vVE9ETyByZW1vdmUhCiAgICAgICAgCiAgICAgICAgJChkb2N1bWVudCkub25lKCducmFtYV9wYWdlX2xvYWRlZCcsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICQoJy5fbnJhbWEtbm90ZScpLmVhY2goZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciAkbm90ZSA9ICQodGhpcyk7CiAgICAgICAgICAgICAgICB2YXIgbm90ZV9pZCA9ICRub3RlLmF0dHIoJ2lkJyk7CiAgICAgICAgICAgICAgICAkbm90ZS5kYXRhKCducmFtYV9ub3RlJywgZmluZF9ub3RlW25vdGVfaWRdKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvL3NhdmUgYWZ0ZXIgbm90ZXMgaGF2ZSBiZWVuIGVkaXRlZAogICAgICAgICAgICAkKCd0ZXh0YXJlYS5fbnJhbWEtbm90ZS1jb250ZW50Jykub25lKCdibHVyJywgbnJhbWEubm90ZXMudXBkYXRlX29uX2JsdXIpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy9jb25maWd1cmUgYWRkIGEgbm90ZQogICAgICAgICAgICAkKCcuYWRkLWEtbm90ZScpLmRpZSgpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhZGQgYSBub3RlIC4uLicpOwogICAgICAgICAgICAgICAgdmFyICRxdW90ZSA9ICQodGhpcykucGFyZW50cygnLl9ucmFtYS1xdW90ZScpLmZpcnN0KCk7CiAgICAgICAgICAgICAgICB2YXIgcXVvdGUgPSBmaW5kX3F1b3RlWyRxdW90ZS5hdHRyKCdpZCcpXTsKICAgICAgICAgICAgICAgIHZhciBub3RlID0gbnJhbWEubm90ZXMuY3JlYXRlKHF1b3RlKTsKICAgICAgICAgICAgICAgIC8vYWRkIHRvIHBhZ2UgZGF0YQogICAgICAgICAgICAgICAgZmluZF9ub3RlW25vdGUuX2lkXSA9IG5vdGU7CiAgICAgICAgICAgICAgICAvL2Rpc3BsYXkgbm90ZQogICAgICAgICAgICAgICAgdmFyIG5vdGVfaHRtbCA9ICc8bGkgaWQ9Iicrbm90ZS5faWQrJyIgY2xhc3M9Il9ucmFtYS1ub3RlIj48dGV4dGFyZWEgY2xhc3M9Il9ucmFtYS1ub3RlLWNvbnRlbnQiPicrbm90ZS5jb250ZW50Kyc8L3RleHRhcmVhPjwvbGk+JzsKICAgICAgICAgICAgICAgIHZhciAkbm90ZSA9ICQobm90ZV9odG1sKTsKICAgICAgICAgICAgICAgICQoJ3VsLm5vdGVzJywkcXVvdGUpLnByZXBlbmQoJG5vdGUpOwogICAgICAgICAgICAgICAgJG5vdGUgPSAkKCcjJytub3RlLl9pZCk7ICAgICAgICAvL292ZXJ3cml0ZSBhZnRlciBwcmVwZW5kCiAgICAgICAgICAgICAgICAkbm90ZS5kYXRhKCducmFtYV9ub3RlJyxub3RlKTsKICAgICAgICAgICAgICAgICQoJ3RleHRhcmVhJywgJG5vdGUpLmZvY3VzKCkuc2VsZWN0KCkub25lKCdibHVyJywgbnJhbWEubm90ZXMudXBkYXRlX29uX2JsdXIpOwogICAgICAgICAgICAgICAgJG5vdGUuaGlkZSgpLnNob3coNTAwLCBmdW5jdGlvbigpeyAkKCcjJytub3RlLl9pZCkuYXV0b2dyb3coKS5mb2N1cygpLnNlbGVjdCgpOyB9KTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkb25lJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy9UT0RPIGNhbiBvbmx5IGRvIHRoaXMgaWYgdXNlciBvd25zIHRoZSBxdW90ZSEhIQogICAgICAgICAgICAKICAgICAgICAgICAgLy9jb25maWd1cmUgZGVsZXRlIGEgcXVvdGUKICAgICAgICAgICAgdmFyIGRlbGV0ZV9vbl9tZXRhX2NsaWNrID0gZnVuY3Rpb24oZSl7CiAgICAgICAgICAgICAgICBpZiggIWUuYWx0S2V5ICYmICFlLm1ldGFLZXkgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyICRxdW90ZSA9ICQodGhpcykucGFyZW50cygnLl9ucmFtYS1xdW90ZScpLmZpcnN0KCk7CiAgICAgICAgICAgICAgICB2YXIgcXVvdGUgPSBmaW5kX3F1b3RlWyAkcXVvdGUuYXR0cignaWQnKSBdOwogICAgICAgICAgICAgICAgaWYoIHF1b3RlLnVzZXJfaWRbMF0gIT0gJyonICkgewogICAgICAgICAgICAgICAgICAgIGlmKCAhcmVxLnVzZXJDdHggfHwgcmVxLnVzZXJDdHgubmFtZSAhPSBxdW90ZS51c2VyX2lkICkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2Fubm90IGRlbGV0ZSBhbm90aGVyIHVzZXJzIHF1b3RlcycpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyICRub3RlcyA9ICAkKCcuX25yYW1hLW5vdGUnLCAkcXVvdGUpOyAgCiAgICAgICAgICAgICAgICBpZiggJG5vdGVzLmxlbmd0aCAhPSAwICkgewogICAgICAgICAgICAgICAgICAgIC8vZG9uJ3QgZGVsZXRlIHF1b3RlcyB3aXRoIG5vdGVzIGF0dGFjaGVkIC4uLgogICAgICAgICAgICAgICAgICAgICRxdW90ZS5jc3Moeydib3JkZXItdG9wJzonMXB4IGRhc2hlZCByZWQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JvcmRlci1ib3R0b20nOicxcHggZGFzaGVkIHJlZCd9KQogICAgICAgICAgICAgICAgICAgIC8vLi4uIGluc3RlYWQgbWFrZSB0aGUgcmVsZXZhbnQgbm90ZXMgYm91bmNlCiAgICAgICAgICAgICAgICAgICAgJG5vdGVzLmVmZmVjdCgnYm91bmNlJywgZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1b3RlLmNzcyh7J2JvcmRlci10b3AnOidub25lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYm9yZGVyLWJvdHRvbSc6J25vbmUnfSw1MDApOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vcmVtb3ZlIHRoZSBxdW90ZQogICAgICAgICAgICAgICAgJHF1b3RlLmNzcygnYmFja2dyb3VuZC1jb2xvcicsJ29yYW5nZScpOwogICAgICAgICAgICAgICAgbnJhbWEucGVyc2lzdC5ybShxdW90ZSwgZnVuY3Rpb24oZXJyb3IsIGRhdGEpewogICAgICAgICAgICAgICAgICAgIGlmKCBlcnJvciApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbnJhbWEuX2RlYnVnKHttc2c6J25yYW1hOiBlcnJvciByZW1vdmluZyBxdW90ZScsZXJyb3I6ZXJyb3J9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVvdGUuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywncmVkJykuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRlKHsnYmFja2dyb3VuZC1jb2xvcic6J2JsYWNrJ30sIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1b3RlLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJCgnLnF1b3RlLWNvbnRlbnQnKS5kaWUoKS5saXZlKCdjbGljaycsIGRlbGV0ZV9vbl9tZXRhX2NsaWNrKTsKICAgICAgICB9KTsKICAgIH0KICAgIAogICAgCgogICAgcmV0dXJuIHt0aXRsZTogbWFrZV90aXRsZSgnZmxvdycscmVxKSwgY29udGVudDogY29udGVudH07Cgp9CgoKCi8qKgogKiBsaXN0cyBxdW90ZXMgb3JnYW5pc2VkIGJ5IHNvdXJjZS4KICogY2FuIGhhbmRsZSBvbmUgb3IgbW9yZSBzb3VyY2VzLgogKiBtYWtlcyBubyBhc3N1bXB0aW9ucyBhYm91dCBrZXlzIG9yIHZhbHVlczsgY2FuIG9ubHkgYmUgdXNlZCB3aXRoIGluY2x1ZGVfZG9jcwogKiAKICogZm9yIHVzZSB3aXRoCiAqICAgLSAgL3NvdXJjZXMvOnNvdXJjZQogKiAgIC0gIC91c2Vycy86dXNlci9zb3VyY2VzLzpzb3VyY2UKICogICAtIC90YWdzLzp0YWcKICogICAtIC91c2Vycy86dXNlci90YWdzLzp0YWcKICovCmV4cG9ydHMucXVvdGVzID0gZnVuY3Rpb24oaGVhZCwgcmVxKSB7CiAgICBzdGFydCh7Y29kZTogMjAwLCBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICd0ZXh0L2h0bWwnfX0pOwoKICAgIHZhciBmaW5kX3NvdXJjZSA9IHt9OyAgIC8vaW5kZXhlZCBieSBwYWdlX2lkLCB0aGUgZmlyc3Qgc291cmNlIHdlIGZpbmQgZ2V0cyBwcmlvcml0eQogICAgdmFyIGZpbmRfcXVvdGUgPSB7fTsgICAgLy9pbmRleGVkIGJ5IHF1b3RlX2hhc2ggCiAgICB2YXIgbm90ZXNfZm9yX3F1b3RlcyA9IHt9OwogICAgdmFyIGZpbmRfbm90ZSA9IHt9OyAvL2luZGV4ZWQgYnkgX2lkCiAgIAogICAgdmFyIHJvdzsKICAgIHdoaWxlKCByb3cgID0gZ2V0Um93KCkgKSB7CiAgICAgICAgdmFyIHRoaW5nID0gcm93LmRvYzsgICAgICAgIC8vIDwtLSBOQiBtdXN0IGJlIHVzZWQgd2l0aCA/aW5jbHVkZV9kb2NzPXRydWUKICAgICAgICAKICAgICAgICBpZiggIXRoaW5nIHx8ICF0aGluZy50eXBlICkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYoIHRoaW5nLnR5cGUgPT0gJ3NvdXJjZScgKSB7CiAgICAgICAgICAgIHZhciBzb3VyY2UgPSB0aGluZzsKICAgICAgICAgICAgaWYoICFmaW5kX3NvdXJjZVtzb3VyY2UucGFnZV9pZF0gKSB7CiAgICAgICAgICAgICAgICBmaW5kX3NvdXJjZVtzb3VyY2UucGFnZV9pZF0gPSBzb3VyY2U7CiAgICAgICAgICAgICAgICBzb3VyY2UudXBkYXRlZF90aW1lID0gbmV3IERhdGUoc291cmNlLnVwZGF0ZWQpLnRvSVNPU3RyaW5nKCk7ICAgLy9uYiBzaG91bGQgbm90IHBlcnNpc3QgdGhpcyBwcm9wZXJ0eQogICAgICAgICAgICAgICAgc291cmNlLnVzZXJzID0gW107ICAgICAgICAgIC8vbmIgc2hvdWxkIG5vdCBwZXJzaXN0IHRoaXMgcHJvcGVydHkKICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5kX3NvdXJjZVtzb3VyY2UucGFnZV9pZF0udXNlcnMucHVzaChzb3VyY2UudXNlcl9pZCk7CiAgICAgICAgfQogICAgICAgIGlmKCB0aGluZy50eXBlID09ICdxdW90ZScgKSB7CiAgICAgICAgICAgIHZhciBxdW90ZSA9IHRoaW5nOwogICAgICAgICAgICBpZiggIWZpbmRfcXVvdGVbcXVvdGUuaGFzaF0gKSB7CiAgICAgICAgICAgICAgICBmaW5kX3F1b3RlW3F1b3RlLmhhc2hdID0gcXVvdGU7CiAgICAgICAgICAgICAgICBxdW90ZS51c2VycyA9IFtdOyAgIC8vbmIgc2hvdWxkIG5vdCBwZXJzaXN0IHRoaXMgcHJvcGVydHkgKHF1b3RlcyBhcmUgbm90IHVwZGF0ZWQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmluZF9xdW90ZVtxdW90ZS5oYXNoXS51c2Vycy5wdXNoKHF1b3RlLnVzZXJfaWQpOwogICAgICAgIH0KICAgICAgICBpZiggdGhpbmcudHlwZSA9PSAnbm90ZScgKSB7CiAgICAgICAgICAgIHZhciBub3RlID0gdGhpbmc7CiAgICAgICAgICAgIGZpbmRfbm90ZVtub3RlLl9pZF0gPSBub3RlOwogICAgICAgICAgICBpZiggIW5vdGVzX2Zvcl9xdW90ZXNbbm90ZS5xdW90ZV9oYXNoXSAgKSB7CiAgICAgICAgICAgICAgICBub3Rlc19mb3JfcXVvdGVzW25vdGUucXVvdGVfaGFzaF0gPSBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBub3Rlc19mb3JfcXVvdGVzW25vdGUucXVvdGVfaGFzaF0ucHVzaChub3RlKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gLS0gYXR0YWNoIG5vdGVzIHRvIHF1b3RlcyBhbmQgcXVvdGVzIHRvIHNvdXJjZXMKICAgIHZhciBxdW90ZXMgPSBfKGZpbmRfcXVvdGUpLnZhbHVlcygpOwogICAgdmFyIG9ycGhhbmVkX3F1b3RlcyA9IFtdOyAgICAgICAgLy9mb3Igbm93IHdlIGRvbid0IGRvIGFueXRoaW5nIHdpdGggb3ByaGFucwogICAgXyhxdW90ZXMpLmVhY2goZnVuY3Rpb24ocXVvdGUpIHsKICAgICAgICBxdW90ZS5ub3RlcyA9IG5vdGVzX2Zvcl9xdW90ZXNbcXVvdGUuaGFzaF0gfHwgW107CiAgICAgICAgdmFyIHNvdXJjZSA9IGZpbmRfc291cmNlW3F1b3RlLnBhZ2VfaWRdOwogICAgICAgIGlmKCAhc291cmNlICkgewogICAgICAgICAgICBvcnBoYW5lZF9xdW90ZXMucHVzaChxdW90ZSk7CiAgICAgICAgfSBlbHNlewogICAgICAgICAgICBpZiggIXNvdXJjZS5xdW90ZXMgKSB7CiAgICAgICAgICAgICAgICBzb3VyY2UucXVvdGVzID0gW107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc291cmNlLnF1b3Rlcy5wdXNoKHF1b3RlKTsKICAgICAgICB9CiAgICB9KTsKICAgIHZhciBzb3VyY2VzID0gXyhmaW5kX3NvdXJjZSkudmFsdWVzKCk7CgogICAgLy8gLS0gZm9yIGVhY2ggc291cmNlLCBzb3J0IGl0cyBxdW90ZXMgYnkgcGFnZV9vcmRlcgogICAgdmFyIGFycmF5X2NvbXBhcml0b3IgPSBmdW5jdGlvbihhLGIpewogICAgICAgIGlmKCBhLmxlbmd0aCA9PSAwICkgewogICAgICAgICAgICByZXR1cm4gYi5sZW5ndGggPT0gMCA/IDAgOiAtMSAvKmIgZmlyc3QqLzsKICAgICAgICB9CiAgICAgICAgaWYoIGIubGVuZ3RoID09IDAgKSB7CiAgICAgICAgICAgIHJldHVybiBhLmxlbmd0aCA9PSAwID8gMCA6IDEgLyogYSBmaXJzdCAqLzsKICAgICAgICB9CiAgICAgICAgdmFyIGxlZnQgPSBhWzBdOwogICAgICAgIHZhciByaWdodCA9IGJbMF07CiAgICAgICAgaWYoIGxlZnQgPT0gcmlnaHQgKSB7CiAgICAgICAgICAgIHJldHVybiBhcnJheV9jb21wYXJpdG9yKGEuc2xpY2UoMSksYi5zbGljZSgxKSk7IC8vbmIgc2xpY2UgZG9lcyBub3QgbW9kaWZ5IGluIHBsYWNlCiAgICAgICAgfQogICAgICAgIHJldHVybiBsZWZ0IC0gcmlnaHQgLyogK3ZlID0gYSBmaXJzdCAqLzsKICAgIH07CiAgICB2YXIgcGFnZV9vcmRlcl9jb21wYXJpdG9yID0gZnVuY3Rpb24oYSxiKSB7CiAgICAgICAgLy8gLS0gYXJyYXlzCiAgICAgICAgaWYoIGEgaW5zdGFuY2VvZiBBcnJheSAmJiBiIGluc3RhbmNlb2YgQXJyYXkgKSB7CiAgICAgICAgICAgIHJldHVybiBhcnJheV9jb21wYXJpdG9yKGEsYik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYoIGEgaW5zdGFuY2VvZiBBcnJheSApIHsgcmV0dXJuIDE7IH0gLy9hcnJheXMgYmVmb3JlIGV2ZXJ5dGhpbmcgZWxzZQogICAgICAgICAgICBpZiggYiBpbnN0YW5jZW9mIEFycmF5ICkgeyByZXR1cm4gLTE7IH0KICAgICAgICB9CiAgICAgICAgLy8gLS0gbnVtYmVycwogICAgICAgIHZhciBhX251bSA9IHBhcnNlRmxvYXQoYSksCiAgICAgICAgICAgIGJfbnVtID0gcGFyc2VGbG9hdChiKSwKICAgICAgICAgICAgX2lzX251bSA9IGZ1bmN0aW9uKG4peyByZXR1cm4gIWlzTmFOKG4pICYmIGlzRmluaXRlKG4pOyB9ICAvL3RoYW5rIHlvdSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE4MDgyL3ZhbGlkYXRlLW51bWJlcnMtaW4tamF2YXNjcmlwdC1pc251bWVyaWMKICAgICAgICAgICAgYV9pc19udW0gPSBfaXNfbnVtKGFfbnVtKSwKICAgICAgICAgICAgYl9pc19udW0gPSBfaXNfbnVtKGJfbnVtKTsKICAgICAgICBpZiggYV9pc19udW0gJiYgYl9pc19udW0gKSB7ICAKICAgICAgICAgICAgcmV0dXJuIGFfbnVtIC0gYl9udW07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYoIGFfbnVtICkgeyByZXR1cm4gMTsgfQogICAgICAgICAgICBpZiggYl9udW0gKSB7IHJldHVybiAtMTsgfQogICAgICAgIH0KICAgICAgICAvLyAtLSB3aGF0ZXZlciBlbHNlCiAgICAgICAgcmV0dXJuIGEgPiBiID8gMSA6IChhIDwgYiA/IC0xIDogMCk7CiAgICB9CiAgICB2YXIgcXVvdGVfc29ydGVyID0gZnVuY3Rpb24oYSxiKXsgcmV0dXJuIHBhZ2Vfb3JkZXJfY29tcGFyaXRvcihhLnBhZ2Vfb3JkZXIsIGIucGFnZV9vcmRlcikgfTsgICAgLy8gPC0tIE5CIGIsYSBiZWNhdXNlIHdlIHdhbnQgYXNjZW5kaW5nIG9yZGVyCiAgICBfKHNvdXJjZXMpLmVhY2goZnVuY3Rpb24oc291cmNlKXsKICAgICAgICB2YXIgc291cmNlX3F1b3RlcyA9IHNvdXJjZS5xdW90ZXM7CiAgICAgICAgaWYoIHNvdXJjZV9xdW90ZXMgKSB7CiAgICAgICAgICAgIHNvdXJjZV9xdW90ZXMuc29ydChxdW90ZV9zb3J0ZXIpOwogICAgICAgIH0KICAgIH0pOwogICAgCiAgICAKICAgIC8vIC0tIGNvbmZpZ3VyZSBucmFtYSwgYXR0YWNoIGV2ZW50IGxpc3RuZXJzCiAgICBpZiggcmVxLmNsaWVudCApIHsKICAgICAgICAKICAgICAgICB2YXIgbnJhbWEgPSBucmFtYV9pbml0KGZpbmRfc291cmNlKTsKICAgICAgICB3aW5kb3cubnJhbWEgPSBucmFtYTsgICAgICAgICAgICAgICAgICAgLy9UT0RPIHJlbW92ZSEKICAgICAgICAKICAgICAgICAkKGRvY3VtZW50KS5vbmUoJ25yYW1hX3BhZ2VfbG9hZGVkJywgZnVuY3Rpb24oKXsKICAgICAgICAgICAgJCgnLl9ucmFtYS1ub3RlJykuZWFjaChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyICRub3RlID0gJCh0aGlzKTsKICAgICAgICAgICAgICAgIHZhciBub3RlX2lkID0gJG5vdGUuYXR0cignaWQnKTsKICAgICAgICAgICAgICAgICRub3RlLmRhdGEoJ25yYW1hX25vdGUnLCBmaW5kX25vdGVbbm90ZV9pZF0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vc2F2ZSBhZnRlciBub3RlcyBoYXZlIGJlZW4gZWRpdGVkCiAgICAgICAgICAgICQoJ3RleHRhcmVhLl9ucmFtYS1ub3RlLWNvbnRlbnQnKS5vbmUoJ2JsdXInLCBucmFtYS5ub3Rlcy51cGRhdGVfb25fYmx1cik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvL2NvbmZpZ3VyZSBhZGQgYSBub3RlCiAgICAgICAgICAgICQoJy5hZGQtYS1ub3RlJykuZGllKCkubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2FkZCBhIG5vdGUgLi4uJyk7CiAgICAgICAgICAgICAgICB2YXIgJHF1b3RlID0gJCh0aGlzKS5wYXJlbnRzKCcuX25yYW1hLXF1b3RlJykuZmlyc3QoKTsKICAgICAgICAgICAgICAgIHZhciBxdW90ZSA9IGZpbmRfcXVvdGVbJHF1b3RlLmF0dHIoJ2lkJyldOwogICAgICAgICAgICAgICAgdmFyIG5vdGUgPSBucmFtYS5ub3Rlcy5jcmVhdGUocXVvdGUpOwogICAgICAgICAgICAgICAgLy9hZGQgdG8gcGFnZSBkYXRhCiAgICAgICAgICAgICAgICBmaW5kX25vdGVbbm90ZS5faWRdID0gbm90ZTsKICAgICAgICAgICAgICAgIC8vZGlzcGxheSBub3RlCiAgICAgICAgICAgICAgICB2YXIgbm90ZV9odG1sID0gJzxsaSBpZD0iJytub3RlLl9pZCsnIiBjbGFzcz0iX25yYW1hLW5vdGUiPjx0ZXh0YXJlYSBjbGFzcz0iX25yYW1hLW5vdGUtY29udGVudCI+Jytub3RlLmNvbnRlbnQrJzwvdGV4dGFyZWE+PC9saT4nOwogICAgICAgICAgICAgICAgdmFyICRub3RlID0gJChub3RlX2h0bWwpOwogICAgICAgICAgICAgICAgJCgndWwubm90ZXMnLCRxdW90ZSkucHJlcGVuZCgkbm90ZSk7CiAgICAgICAgICAgICAgICAkbm90ZSA9ICQoJyMnK25vdGUuX2lkKTsgICAgICAgIC8vb3ZlcndyaXRlIGFmdGVyIHByZXBlbmQKICAgICAgICAgICAgICAgICRub3RlLmRhdGEoJ25yYW1hX25vdGUnLG5vdGUpOwogICAgICAgICAgICAgICAgJCgndGV4dGFyZWEnLCAkbm90ZSkuZm9jdXMoKS5zZWxlY3QoKS5vbmUoJ2JsdXInLCBucmFtYS5ub3Rlcy51cGRhdGVfb25fYmx1cik7CiAgICAgICAgICAgICAgICAkbm90ZS5oaWRlKCkuc2hvdyg1MDAsIGZ1bmN0aW9uKCl7ICQoJyMnK25vdGUuX2lkKS5hdXRvZ3JvdygpLmZvY3VzKCkuc2VsZWN0KCk7IH0pOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2RvbmUnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvL1RPRE8gY2FuIG9ubHkgZG8gdGhpcyBpZiB1c2VyIG93bnMgdGhlIHF1b3RlISEhCiAgICAgICAgICAgIAogICAgICAgICAgICAvL2NvbmZpZ3VyZSBkZWxldGUgYSBxdW90ZQogICAgICAgICAgICB2YXIgZGVsZXRlX29uX21ldGFfY2xpY2sgPSBmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgIGlmKCAhZS5hbHRLZXkgJiYgIWUubWV0YUtleSApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgJHF1b3RlID0gJCh0aGlzKS5wYXJlbnRzKCcuX25yYW1hLXF1b3RlJykuZmlyc3QoKTsKICAgICAgICAgICAgICAgIHZhciBxdW90ZSA9IGZpbmRfcXVvdGVbICRxdW90ZS5hdHRyKCdpZCcpIF07CiAgICAgICAgICAgICAgICBpZiggcXVvdGUudXNlcl9pZFswXSAhPSAnKicgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoICFyZXEudXNlckN0eCB8fCByZXEudXNlckN0eC5uYW1lICE9IHF1b3RlLnVzZXJfaWQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjYW5ub3QgZGVsZXRlIGFub3RoZXIgdXNlcnMgcXVvdGVzJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgJG5vdGVzID0gICQoJy5fbnJhbWEtbm90ZScsICRxdW90ZSk7ICAKICAgICAgICAgICAgICAgIGlmKCAkbm90ZXMubGVuZ3RoICE9IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgLy9kb24ndCBkZWxldGUgcXVvdGVzIHdpdGggbm90ZXMgYXR0YWNoZWQgLi4uCiAgICAgICAgICAgICAgICAgICAgJHF1b3RlLmNzcyh7J2JvcmRlci10b3AnOicxcHggZGFzaGVkIHJlZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYm9yZGVyLWJvdHRvbSc6JzFweCBkYXNoZWQgcmVkJ30pCiAgICAgICAgICAgICAgICAgICAgLy8uLi4gaW5zdGVhZCBtYWtlIHRoZSByZWxldmFudCBub3RlcyBib3VuY2UKICAgICAgICAgICAgICAgICAgICAkbm90ZXMuZWZmZWN0KCdib3VuY2UnLCBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAkcXVvdGUuY3NzKHsnYm9yZGVyLXRvcCc6J25vbmUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdib3JkZXItYm90dG9tJzonbm9uZSd9LDUwMCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9yZW1vdmUgdGhlIHF1b3RlCiAgICAgICAgICAgICAgICAkcXVvdGUuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywnb3JhbmdlJyk7CiAgICAgICAgICAgICAgICBucmFtYS5wZXJzaXN0LnJtKHF1b3RlLCBmdW5jdGlvbihlcnJvciwgZGF0YSl7CiAgICAgICAgICAgICAgICAgICAgaWYoIGVycm9yICkgewogICAgICAgICAgICAgICAgICAgICAgICBucmFtYS5fZGVidWcoe21zZzonbnJhbWE6IGVycm9yIHJlbW92aW5nIHF1b3RlJyxlcnJvcjplcnJvcn0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdW90ZS5jc3MoJ2JhY2tncm91bmQtY29sb3InLCdyZWQnKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGUoeydiYWNrZ3JvdW5kLWNvbG9yJzonYmxhY2snfSwgZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVvdGUucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkKCcucXVvdGUtY29udGVudCcpLmRpZSgpLmxpdmUoJ2NsaWNrJywgZGVsZXRlX29uX21ldGFfY2xpY2spOwogICAgICAgIH0pOwogICAgfQogICAgCiAgICAKICAgIAogICAgLy9UT0RPIHJlbW92ZSAhCiAgICBpZiggcmVxLmNsaWVudCApIHsKICAgICAgICB3aW5kb3cuc291cmNlcyA9IHNvdXJjZXM7CiAgICAgICAgd2luZG93LmZpbmRfcXVvdGUgPSBmaW5kX3F1b3RlOwogICAgfQogICAgdmFyIGNvbnRlbnQgPSB0ZW1wbGF0ZXMucmVuZGVyKCdxdW90ZXMuaHRtbCcsIHJlcSwgXyh7CiAgICAgICAgICAgIHNvdXJjZXMgOiBzb3VyY2VzLAogICAgICAgICAgICBub19zb3VyY2VzIDogKHNvdXJjZXMubGVuZ3RoID09IDApICAvL2JlY2F1c2UgISFbXSA9PSB0cnVlCiAgICAgICAgfSkuZXh0ZW5kKCBtYWtlX3VuaXZlcnNhbF90ZW1wbGF0ZV9kYXRhKHJlcSkgKQogICAgKTsKCiAgICByZXR1cm4ge3RpdGxlOiBtYWtlX3RpdGxlKCdub3RlcycscmVxKSwgY29udGVudDogY29udGVudCB9Owp9CgoKCgoKfSl9OwoKLyoqKioqKioqKiogbGliL21kNSAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImxpYi9tZDUiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLyoKICogQSBKYXZhU2NyaXB0IGltcGxlbWVudGF0aW9uIG9mIHRoZSBSU0EgRGF0YSBTZWN1cml0eSwgSW5jLiBNRDUgTWVzc2FnZQogKiBEaWdlc3QgQWxnb3JpdGhtLCBhcyBkZWZpbmVkIGluIFJGQyAxMzIxLgogKiBWZXJzaW9uIDIuMiBDb3B5cmlnaHQgKEMpIFBhdWwgSm9obnN0b24gMTk5OSAtIDIwMDkKICogT3RoZXIgY29udHJpYnV0b3JzOiBHcmVnIEhvbHQsIEFuZHJldyBLZXBlcnQsIFlkbmFyLCBMb3N0aW5ldAogKiBEaXN0cmlidXRlZCB1bmRlciB0aGUgQlNEIExpY2Vuc2UKICogU2VlIGh0dHA6Ly9wYWpob21lLm9yZy51ay9jcnlwdC9tZDUgZm9yIG1vcmUgaW5mby4KICovCgovKgogKiBDb25maWd1cmFibGUgdmFyaWFibGVzLiBZb3UgbWF5IG5lZWQgdG8gdHdlYWsgdGhlc2UgdG8gYmUgY29tcGF0aWJsZSB3aXRoCiAqIHRoZSBzZXJ2ZXItc2lkZSwgYnV0IHRoZSBkZWZhdWx0cyB3b3JrIGluIG1vc3QgY2FzZXMuCiAqLwp2YXIgaGV4Y2FzZSA9IDA7ICAgLyogaGV4IG91dHB1dCBmb3JtYXQuIDAgLSBsb3dlcmNhc2U7IDEgLSB1cHBlcmNhc2UgICAgICAgICovCnZhciBiNjRwYWQgID0gIiI7ICAvKiBiYXNlLTY0IHBhZCBjaGFyYWN0ZXIuICI9IiBmb3Igc3RyaWN0IFJGQyBjb21wbGlhbmNlICAgKi8KCi8qCiAqIFRoZXNlIGFyZSB0aGUgZnVuY3Rpb25zIHlvdSdsbCB1c3VhbGx5IHdhbnQgdG8gY2FsbAogKiBUaGV5IHRha2Ugc3RyaW5nIGFyZ3VtZW50cyBhbmQgcmV0dXJuIGVpdGhlciBoZXggb3IgYmFzZS02NCBlbmNvZGVkIHN0cmluZ3MKICovCmZ1bmN0aW9uIGhleF9tZDUocykgICAgeyByZXR1cm4gcnN0cjJoZXgocnN0cl9tZDUoc3RyMnJzdHJfdXRmOChzKSkpOyB9CmZ1bmN0aW9uIGI2NF9tZDUocykgICAgeyByZXR1cm4gcnN0cjJiNjQocnN0cl9tZDUoc3RyMnJzdHJfdXRmOChzKSkpOyB9CmZ1bmN0aW9uIGFueV9tZDUocywgZSkgeyByZXR1cm4gcnN0cjJhbnkocnN0cl9tZDUoc3RyMnJzdHJfdXRmOChzKSksIGUpOyB9CmZ1bmN0aW9uIGhleF9obWFjX21kNShrLCBkKQogIHsgcmV0dXJuIHJzdHIyaGV4KHJzdHJfaG1hY19tZDUoc3RyMnJzdHJfdXRmOChrKSwgc3RyMnJzdHJfdXRmOChkKSkpOyB9CmZ1bmN0aW9uIGI2NF9obWFjX21kNShrLCBkKQogIHsgcmV0dXJuIHJzdHIyYjY0KHJzdHJfaG1hY19tZDUoc3RyMnJzdHJfdXRmOChrKSwgc3RyMnJzdHJfdXRmOChkKSkpOyB9CmZ1bmN0aW9uIGFueV9obWFjX21kNShrLCBkLCBlKQogIHsgcmV0dXJuIHJzdHIyYW55KHJzdHJfaG1hY19tZDUoc3RyMnJzdHJfdXRmOChrKSwgc3RyMnJzdHJfdXRmOChkKSksIGUpOyB9CgovKgogKiBQZXJmb3JtIGEgc2ltcGxlIHNlbGYtdGVzdCB0byBzZWUgaWYgdGhlIFZNIGlzIHdvcmtpbmcKICovCmZ1bmN0aW9uIG1kNV92bV90ZXN0KCkKewogIHJldHVybiBoZXhfbWQ1KCJhYmMiKS50b0xvd2VyQ2FzZSgpID09ICI5MDAxNTA5ODNjZDI0ZmIwZDY5NjNmN2QyOGUxN2Y3MiI7Cn0KCi8qCiAqIENhbGN1bGF0ZSB0aGUgTUQ1IG9mIGEgcmF3IHN0cmluZwogKi8KZnVuY3Rpb24gcnN0cl9tZDUocykKewogIHJldHVybiBiaW5sMnJzdHIoYmlubF9tZDUocnN0cjJiaW5sKHMpLCBzLmxlbmd0aCAqIDgpKTsKfQoKLyoKICogQ2FsY3VsYXRlIHRoZSBITUFDLU1ENSwgb2YgYSBrZXkgYW5kIHNvbWUgZGF0YSAocmF3IHN0cmluZ3MpCiAqLwpmdW5jdGlvbiByc3RyX2htYWNfbWQ1KGtleSwgZGF0YSkKewogIHZhciBia2V5ID0gcnN0cjJiaW5sKGtleSk7CiAgaWYoYmtleS5sZW5ndGggPiAxNikgYmtleSA9IGJpbmxfbWQ1KGJrZXksIGtleS5sZW5ndGggKiA4KTsKCiAgdmFyIGlwYWQgPSBBcnJheSgxNiksIG9wYWQgPSBBcnJheSgxNik7CiAgZm9yKHZhciBpID0gMDsgaSA8IDE2OyBpKyspCiAgewogICAgaXBhZFtpXSA9IGJrZXlbaV0gXiAweDM2MzYzNjM2OwogICAgb3BhZFtpXSA9IGJrZXlbaV0gXiAweDVDNUM1QzVDOwogIH0KCiAgdmFyIGhhc2ggPSBiaW5sX21kNShpcGFkLmNvbmNhdChyc3RyMmJpbmwoZGF0YSkpLCA1MTIgKyBkYXRhLmxlbmd0aCAqIDgpOwogIHJldHVybiBiaW5sMnJzdHIoYmlubF9tZDUob3BhZC5jb25jYXQoaGFzaCksIDUxMiArIDEyOCkpOwp9CgovKgogKiBDb252ZXJ0IGEgcmF3IHN0cmluZyB0byBhIGhleCBzdHJpbmcKICovCmZ1bmN0aW9uIHJzdHIyaGV4KGlucHV0KQp7CiAgdHJ5IHsgaGV4Y2FzZSB9IGNhdGNoKGUpIHsgaGV4Y2FzZT0wOyB9CiAgdmFyIGhleF90YWIgPSBoZXhjYXNlID8gIjAxMjM0NTY3ODlBQkNERUYiIDogIjAxMjM0NTY3ODlhYmNkZWYiOwogIHZhciBvdXRwdXQgPSAiIjsKICB2YXIgeDsKICBmb3IodmFyIGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpKyspCiAgewogICAgeCA9IGlucHV0LmNoYXJDb2RlQXQoaSk7CiAgICBvdXRwdXQgKz0gaGV4X3RhYi5jaGFyQXQoKHggPj4+IDQpICYgMHgwRikKICAgICAgICAgICArICBoZXhfdGFiLmNoYXJBdCggeCAgICAgICAgJiAweDBGKTsKICB9CiAgcmV0dXJuIG91dHB1dDsKfQoKLyoKICogQ29udmVydCBhIHJhdyBzdHJpbmcgdG8gYSBiYXNlLTY0IHN0cmluZwogKi8KZnVuY3Rpb24gcnN0cjJiNjQoaW5wdXQpCnsKICB0cnkgeyBiNjRwYWQgfSBjYXRjaChlKSB7IGI2NHBhZD0nJzsgfQogIHZhciB0YWIgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyI7CiAgdmFyIG91dHB1dCA9ICIiOwogIHZhciBsZW4gPSBpbnB1dC5sZW5ndGg7CiAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSArPSAzKQogIHsKICAgIHZhciB0cmlwbGV0ID0gKGlucHV0LmNoYXJDb2RlQXQoaSkgPDwgMTYpCiAgICAgICAgICAgICAgICB8IChpICsgMSA8IGxlbiA/IGlucHV0LmNoYXJDb2RlQXQoaSsxKSA8PCA4IDogMCkKICAgICAgICAgICAgICAgIHwgKGkgKyAyIDwgbGVuID8gaW5wdXQuY2hhckNvZGVBdChpKzIpICAgICAgOiAwKTsKICAgIGZvcih2YXIgaiA9IDA7IGogPCA0OyBqKyspCiAgICB7CiAgICAgIGlmKGkgKiA4ICsgaiAqIDYgPiBpbnB1dC5sZW5ndGggKiA4KSBvdXRwdXQgKz0gYjY0cGFkOwogICAgICBlbHNlIG91dHB1dCArPSB0YWIuY2hhckF0KCh0cmlwbGV0ID4+PiA2KigzLWopKSAmIDB4M0YpOwogICAgfQogIH0KICByZXR1cm4gb3V0cHV0Owp9CgovKgogKiBDb252ZXJ0IGEgcmF3IHN0cmluZyB0byBhbiBhcmJpdHJhcnkgc3RyaW5nIGVuY29kaW5nCiAqLwpmdW5jdGlvbiByc3RyMmFueShpbnB1dCwgZW5jb2RpbmcpCnsKICB2YXIgZGl2aXNvciA9IGVuY29kaW5nLmxlbmd0aDsKICB2YXIgaSwgaiwgcSwgeCwgcXVvdGllbnQ7CgogIC8qIENvbnZlcnQgdG8gYW4gYXJyYXkgb2YgMTYtYml0IGJpZy1lbmRpYW4gdmFsdWVzLCBmb3JtaW5nIHRoZSBkaXZpZGVuZCAqLwogIHZhciBkaXZpZGVuZCA9IEFycmF5KE1hdGguY2VpbChpbnB1dC5sZW5ndGggLyAyKSk7CiAgZm9yKGkgPSAwOyBpIDwgZGl2aWRlbmQubGVuZ3RoOyBpKyspCiAgewogICAgZGl2aWRlbmRbaV0gPSAoaW5wdXQuY2hhckNvZGVBdChpICogMikgPDwgOCkgfCBpbnB1dC5jaGFyQ29kZUF0KGkgKiAyICsgMSk7CiAgfQoKICAvKgogICAqIFJlcGVhdGVkbHkgcGVyZm9ybSBhIGxvbmcgZGl2aXNpb24uIFRoZSBiaW5hcnkgYXJyYXkgZm9ybXMgdGhlIGRpdmlkZW5kLAogICAqIHRoZSBsZW5ndGggb2YgdGhlIGVuY29kaW5nIGlzIHRoZSBkaXZpc29yLiBPbmNlIGNvbXB1dGVkLCB0aGUgcXVvdGllbnQKICAgKiBmb3JtcyB0aGUgZGl2aWRlbmQgZm9yIHRoZSBuZXh0IHN0ZXAuIEFsbCByZW1haW5kZXJzIGFyZSBzdG9yZWQgZm9yIGxhdGVyCiAgICogdXNlLgogICAqLwogIHZhciBmdWxsX2xlbmd0aCA9IE1hdGguY2VpbChpbnB1dC5sZW5ndGggKiA4IC8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKE1hdGgubG9nKGVuY29kaW5nLmxlbmd0aCkgLyBNYXRoLmxvZygyKSkpOwogIHZhciByZW1haW5kZXJzID0gQXJyYXkoZnVsbF9sZW5ndGgpOwogIGZvcihqID0gMDsgaiA8IGZ1bGxfbGVuZ3RoOyBqKyspCiAgewogICAgcXVvdGllbnQgPSBBcnJheSgpOwogICAgeCA9IDA7CiAgICBmb3IoaSA9IDA7IGkgPCBkaXZpZGVuZC5sZW5ndGg7IGkrKykKICAgIHsKICAgICAgeCA9ICh4IDw8IDE2KSArIGRpdmlkZW5kW2ldOwogICAgICBxID0gTWF0aC5mbG9vcih4IC8gZGl2aXNvcik7CiAgICAgIHggLT0gcSAqIGRpdmlzb3I7CiAgICAgIGlmKHF1b3RpZW50Lmxlbmd0aCA+IDAgfHwgcSA+IDApCiAgICAgICAgcXVvdGllbnRbcXVvdGllbnQubGVuZ3RoXSA9IHE7CiAgICB9CiAgICByZW1haW5kZXJzW2pdID0geDsKICAgIGRpdmlkZW5kID0gcXVvdGllbnQ7CiAgfQoKICAvKiBDb252ZXJ0IHRoZSByZW1haW5kZXJzIHRvIHRoZSBvdXRwdXQgc3RyaW5nICovCiAgdmFyIG91dHB1dCA9ICIiOwogIGZvcihpID0gcmVtYWluZGVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkKICAgIG91dHB1dCArPSBlbmNvZGluZy5jaGFyQXQocmVtYWluZGVyc1tpXSk7CgogIHJldHVybiBvdXRwdXQ7Cn0KCi8qCiAqIEVuY29kZSBhIHN0cmluZyBhcyB1dGYtOC4KICogRm9yIGVmZmljaWVuY3ksIHRoaXMgYXNzdW1lcyB0aGUgaW5wdXQgaXMgdmFsaWQgdXRmLTE2LgogKi8KZnVuY3Rpb24gc3RyMnJzdHJfdXRmOChpbnB1dCkKewogIHZhciBvdXRwdXQgPSAiIjsKICB2YXIgaSA9IC0xOwogIHZhciB4LCB5OwoKICB3aGlsZSgrK2kgPCBpbnB1dC5sZW5ndGgpCiAgewogICAgLyogRGVjb2RlIHV0Zi0xNiBzdXJyb2dhdGUgcGFpcnMgKi8KICAgIHggPSBpbnB1dC5jaGFyQ29kZUF0KGkpOwogICAgeSA9IGkgKyAxIDwgaW5wdXQubGVuZ3RoID8gaW5wdXQuY2hhckNvZGVBdChpICsgMSkgOiAwOwogICAgaWYoMHhEODAwIDw9IHggJiYgeCA8PSAweERCRkYgJiYgMHhEQzAwIDw9IHkgJiYgeSA8PSAweERGRkYpCiAgICB7CiAgICAgIHggPSAweDEwMDAwICsgKCh4ICYgMHgwM0ZGKSA8PCAxMCkgKyAoeSAmIDB4MDNGRik7CiAgICAgIGkrKzsKICAgIH0KCiAgICAvKiBFbmNvZGUgb3V0cHV0IGFzIHV0Zi04ICovCiAgICBpZih4IDw9IDB4N0YpCiAgICAgIG91dHB1dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHgpOwogICAgZWxzZSBpZih4IDw9IDB4N0ZGKQogICAgICBvdXRwdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgweEMwIHwgKCh4ID4+PiA2ICkgJiAweDFGKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMHg4MCB8ICggeCAgICAgICAgICYgMHgzRikpOwogICAgZWxzZSBpZih4IDw9IDB4RkZGRikKICAgICAgb3V0cHV0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhFMCB8ICgoeCA+Pj4gMTIpICYgMHgwRiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDB4ODAgfCAoKHggPj4+IDYgKSAmIDB4M0YpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAweDgwIHwgKCB4ICAgICAgICAgJiAweDNGKSk7CiAgICBlbHNlIGlmKHggPD0gMHgxRkZGRkYpCiAgICAgIG91dHB1dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4RjAgfCAoKHggPj4+IDE4KSAmIDB4MDcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAweDgwIHwgKCh4ID4+PiAxMikgJiAweDNGKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMHg4MCB8ICgoeCA+Pj4gNiApICYgMHgzRiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDB4ODAgfCAoIHggICAgICAgICAmIDB4M0YpKTsKICB9CiAgcmV0dXJuIG91dHB1dDsKfQoKLyoKICogRW5jb2RlIGEgc3RyaW5nIGFzIHV0Zi0xNgogKi8KZnVuY3Rpb24gc3RyMnJzdHJfdXRmMTZsZShpbnB1dCkKewogIHZhciBvdXRwdXQgPSAiIjsKICBmb3IodmFyIGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpKyspCiAgICBvdXRwdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSggaW5wdXQuY2hhckNvZGVBdChpKSAgICAgICAgJiAweEZGLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlucHV0LmNoYXJDb2RlQXQoaSkgPj4+IDgpICYgMHhGRik7CiAgcmV0dXJuIG91dHB1dDsKfQoKZnVuY3Rpb24gc3RyMnJzdHJfdXRmMTZiZShpbnB1dCkKewogIHZhciBvdXRwdXQgPSAiIjsKICBmb3IodmFyIGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpKyspCiAgICBvdXRwdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoaW5wdXQuY2hhckNvZGVBdChpKSA+Pj4gOCkgJiAweEZGLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmNoYXJDb2RlQXQoaSkgICAgICAgICYgMHhGRik7CiAgcmV0dXJuIG91dHB1dDsKfQoKLyoKICogQ29udmVydCBhIHJhdyBzdHJpbmcgdG8gYW4gYXJyYXkgb2YgbGl0dGxlLWVuZGlhbiB3b3JkcwogKiBDaGFyYWN0ZXJzID4yNTUgaGF2ZSB0aGVpciBoaWdoLWJ5dGUgc2lsZW50bHkgaWdub3JlZC4KICovCmZ1bmN0aW9uIHJzdHIyYmlubChpbnB1dCkKewogIHZhciBvdXRwdXQgPSBBcnJheShpbnB1dC5sZW5ndGggPj4gMik7CiAgZm9yKHZhciBpID0gMDsgaSA8IG91dHB1dC5sZW5ndGg7IGkrKykKICAgIG91dHB1dFtpXSA9IDA7CiAgZm9yKHZhciBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aCAqIDg7IGkgKz0gOCkKICAgIG91dHB1dFtpPj41XSB8PSAoaW5wdXQuY2hhckNvZGVBdChpIC8gOCkgJiAweEZGKSA8PCAoaSUzMik7CiAgcmV0dXJuIG91dHB1dDsKfQoKLyoKICogQ29udmVydCBhbiBhcnJheSBvZiBsaXR0bGUtZW5kaWFuIHdvcmRzIHRvIGEgc3RyaW5nCiAqLwpmdW5jdGlvbiBiaW5sMnJzdHIoaW5wdXQpCnsKICB2YXIgb3V0cHV0ID0gIiI7CiAgZm9yKHZhciBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aCAqIDMyOyBpICs9IDgpCiAgICBvdXRwdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoaW5wdXRbaT4+NV0gPj4+IChpICUgMzIpKSAmIDB4RkYpOwogIHJldHVybiBvdXRwdXQ7Cn0KCi8qCiAqIENhbGN1bGF0ZSB0aGUgTUQ1IG9mIGFuIGFycmF5IG9mIGxpdHRsZS1lbmRpYW4gd29yZHMsIGFuZCBhIGJpdCBsZW5ndGguCiAqLwpmdW5jdGlvbiBiaW5sX21kNSh4LCBsZW4pCnsKICAvKiBhcHBlbmQgcGFkZGluZyAqLwogIHhbbGVuID4+IDVdIHw9IDB4ODAgPDwgKChsZW4pICUgMzIpOwogIHhbKCgobGVuICsgNjQpID4+PiA5KSA8PCA0KSArIDE0XSA9IGxlbjsKCiAgdmFyIGEgPSAgMTczMjU4NDE5MzsKICB2YXIgYiA9IC0yNzE3MzM4Nzk7CiAgdmFyIGMgPSAtMTczMjU4NDE5NDsKICB2YXIgZCA9ICAyNzE3MzM4Nzg7CgogIGZvcih2YXIgaSA9IDA7IGkgPCB4Lmxlbmd0aDsgaSArPSAxNikKICB7CiAgICB2YXIgb2xkYSA9IGE7CiAgICB2YXIgb2xkYiA9IGI7CiAgICB2YXIgb2xkYyA9IGM7CiAgICB2YXIgb2xkZCA9IGQ7CgogICAgYSA9IG1kNV9mZihhLCBiLCBjLCBkLCB4W2krIDBdLCA3ICwgLTY4MDg3NjkzNik7CiAgICBkID0gbWQ1X2ZmKGQsIGEsIGIsIGMsIHhbaSsgMV0sIDEyLCAtMzg5NTY0NTg2KTsKICAgIGMgPSBtZDVfZmYoYywgZCwgYSwgYiwgeFtpKyAyXSwgMTcsICA2MDYxMDU4MTkpOwogICAgYiA9IG1kNV9mZihiLCBjLCBkLCBhLCB4W2krIDNdLCAyMiwgLTEwNDQ1MjUzMzApOwogICAgYSA9IG1kNV9mZihhLCBiLCBjLCBkLCB4W2krIDRdLCA3ICwgLTE3NjQxODg5Nyk7CiAgICBkID0gbWQ1X2ZmKGQsIGEsIGIsIGMsIHhbaSsgNV0sIDEyLCAgMTIwMDA4MDQyNik7CiAgICBjID0gbWQ1X2ZmKGMsIGQsIGEsIGIsIHhbaSsgNl0sIDE3LCAtMTQ3MzIzMTM0MSk7CiAgICBiID0gbWQ1X2ZmKGIsIGMsIGQsIGEsIHhbaSsgN10sIDIyLCAtNDU3MDU5ODMpOwogICAgYSA9IG1kNV9mZihhLCBiLCBjLCBkLCB4W2krIDhdLCA3ICwgIDE3NzAwMzU0MTYpOwogICAgZCA9IG1kNV9mZihkLCBhLCBiLCBjLCB4W2krIDldLCAxMiwgLTE5NTg0MTQ0MTcpOwogICAgYyA9IG1kNV9mZihjLCBkLCBhLCBiLCB4W2krMTBdLCAxNywgLTQyMDYzKTsKICAgIGIgPSBtZDVfZmYoYiwgYywgZCwgYSwgeFtpKzExXSwgMjIsIC0xOTkwNDA0MTYyKTsKICAgIGEgPSBtZDVfZmYoYSwgYiwgYywgZCwgeFtpKzEyXSwgNyAsICAxODA0NjAzNjgyKTsKICAgIGQgPSBtZDVfZmYoZCwgYSwgYiwgYywgeFtpKzEzXSwgMTIsIC00MDM0MTEwMSk7CiAgICBjID0gbWQ1X2ZmKGMsIGQsIGEsIGIsIHhbaSsxNF0sIDE3LCAtMTUwMjAwMjI5MCk7CiAgICBiID0gbWQ1X2ZmKGIsIGMsIGQsIGEsIHhbaSsxNV0sIDIyLCAgMTIzNjUzNTMyOSk7CgogICAgYSA9IG1kNV9nZyhhLCBiLCBjLCBkLCB4W2krIDFdLCA1ICwgLTE2NTc5NjUxMCk7CiAgICBkID0gbWQ1X2dnKGQsIGEsIGIsIGMsIHhbaSsgNl0sIDkgLCAtMTA2OTUwMTYzMik7CiAgICBjID0gbWQ1X2dnKGMsIGQsIGEsIGIsIHhbaSsxMV0sIDE0LCAgNjQzNzE3NzEzKTsKICAgIGIgPSBtZDVfZ2coYiwgYywgZCwgYSwgeFtpKyAwXSwgMjAsIC0zNzM4OTczMDIpOwogICAgYSA9IG1kNV9nZyhhLCBiLCBjLCBkLCB4W2krIDVdLCA1ICwgLTcwMTU1ODY5MSk7CiAgICBkID0gbWQ1X2dnKGQsIGEsIGIsIGMsIHhbaSsxMF0sIDkgLCAgMzgwMTYwODMpOwogICAgYyA9IG1kNV9nZyhjLCBkLCBhLCBiLCB4W2krMTVdLCAxNCwgLTY2MDQ3ODMzNSk7CiAgICBiID0gbWQ1X2dnKGIsIGMsIGQsIGEsIHhbaSsgNF0sIDIwLCAtNDA1NTM3ODQ4KTsKICAgIGEgPSBtZDVfZ2coYSwgYiwgYywgZCwgeFtpKyA5XSwgNSAsICA1Njg0NDY0MzgpOwogICAgZCA9IG1kNV9nZyhkLCBhLCBiLCBjLCB4W2krMTRdLCA5ICwgLTEwMTk4MDM2OTApOwogICAgYyA9IG1kNV9nZyhjLCBkLCBhLCBiLCB4W2krIDNdLCAxNCwgLTE4NzM2Mzk2MSk7CiAgICBiID0gbWQ1X2dnKGIsIGMsIGQsIGEsIHhbaSsgOF0sIDIwLCAgMTE2MzUzMTUwMSk7CiAgICBhID0gbWQ1X2dnKGEsIGIsIGMsIGQsIHhbaSsxM10sIDUgLCAtMTQ0NDY4MTQ2Nyk7CiAgICBkID0gbWQ1X2dnKGQsIGEsIGIsIGMsIHhbaSsgMl0sIDkgLCAtNTE0MDM3ODQpOwogICAgYyA9IG1kNV9nZyhjLCBkLCBhLCBiLCB4W2krIDddLCAxNCwgIDE3MzUzMjg0NzMpOwogICAgYiA9IG1kNV9nZyhiLCBjLCBkLCBhLCB4W2krMTJdLCAyMCwgLTE5MjY2MDc3MzQpOwoKICAgIGEgPSBtZDVfaGgoYSwgYiwgYywgZCwgeFtpKyA1XSwgNCAsIC0zNzg1NTgpOwogICAgZCA9IG1kNV9oaChkLCBhLCBiLCBjLCB4W2krIDhdLCAxMSwgLTIwMjI1NzQ0NjMpOwogICAgYyA9IG1kNV9oaChjLCBkLCBhLCBiLCB4W2krMTFdLCAxNiwgIDE4MzkwMzA1NjIpOwogICAgYiA9IG1kNV9oaChiLCBjLCBkLCBhLCB4W2krMTRdLCAyMywgLTM1MzA5NTU2KTsKICAgIGEgPSBtZDVfaGgoYSwgYiwgYywgZCwgeFtpKyAxXSwgNCAsIC0xNTMwOTkyMDYwKTsKICAgIGQgPSBtZDVfaGgoZCwgYSwgYiwgYywgeFtpKyA0XSwgMTEsICAxMjcyODkzMzUzKTsKICAgIGMgPSBtZDVfaGgoYywgZCwgYSwgYiwgeFtpKyA3XSwgMTYsIC0xNTU0OTc2MzIpOwogICAgYiA9IG1kNV9oaChiLCBjLCBkLCBhLCB4W2krMTBdLCAyMywgLTEwOTQ3MzA2NDApOwogICAgYSA9IG1kNV9oaChhLCBiLCBjLCBkLCB4W2krMTNdLCA0ICwgIDY4MTI3OTE3NCk7CiAgICBkID0gbWQ1X2hoKGQsIGEsIGIsIGMsIHhbaSsgMF0sIDExLCAtMzU4NTM3MjIyKTsKICAgIGMgPSBtZDVfaGgoYywgZCwgYSwgYiwgeFtpKyAzXSwgMTYsIC03MjI1MjE5NzkpOwogICAgYiA9IG1kNV9oaChiLCBjLCBkLCBhLCB4W2krIDZdLCAyMywgIDc2MDI5MTg5KTsKICAgIGEgPSBtZDVfaGgoYSwgYiwgYywgZCwgeFtpKyA5XSwgNCAsIC02NDAzNjQ0ODcpOwogICAgZCA9IG1kNV9oaChkLCBhLCBiLCBjLCB4W2krMTJdLCAxMSwgLTQyMTgxNTgzNSk7CiAgICBjID0gbWQ1X2hoKGMsIGQsIGEsIGIsIHhbaSsxNV0sIDE2LCAgNTMwNzQyNTIwKTsKICAgIGIgPSBtZDVfaGgoYiwgYywgZCwgYSwgeFtpKyAyXSwgMjMsIC05OTUzMzg2NTEpOwoKICAgIGEgPSBtZDVfaWkoYSwgYiwgYywgZCwgeFtpKyAwXSwgNiAsIC0xOTg2MzA4NDQpOwogICAgZCA9IG1kNV9paShkLCBhLCBiLCBjLCB4W2krIDddLCAxMCwgIDExMjY4OTE0MTUpOwogICAgYyA9IG1kNV9paShjLCBkLCBhLCBiLCB4W2krMTRdLCAxNSwgLTE0MTYzNTQ5MDUpOwogICAgYiA9IG1kNV9paShiLCBjLCBkLCBhLCB4W2krIDVdLCAyMSwgLTU3NDM0MDU1KTsKICAgIGEgPSBtZDVfaWkoYSwgYiwgYywgZCwgeFtpKzEyXSwgNiAsICAxNzAwNDg1NTcxKTsKICAgIGQgPSBtZDVfaWkoZCwgYSwgYiwgYywgeFtpKyAzXSwgMTAsIC0xODk0OTg2NjA2KTsKICAgIGMgPSBtZDVfaWkoYywgZCwgYSwgYiwgeFtpKzEwXSwgMTUsIC0xMDUxNTIzKTsKICAgIGIgPSBtZDVfaWkoYiwgYywgZCwgYSwgeFtpKyAxXSwgMjEsIC0yMDU0OTIyNzk5KTsKICAgIGEgPSBtZDVfaWkoYSwgYiwgYywgZCwgeFtpKyA4XSwgNiAsICAxODczMzEzMzU5KTsKICAgIGQgPSBtZDVfaWkoZCwgYSwgYiwgYywgeFtpKzE1XSwgMTAsIC0zMDYxMTc0NCk7CiAgICBjID0gbWQ1X2lpKGMsIGQsIGEsIGIsIHhbaSsgNl0sIDE1LCAtMTU2MDE5ODM4MCk7CiAgICBiID0gbWQ1X2lpKGIsIGMsIGQsIGEsIHhbaSsxM10sIDIxLCAgMTMwOTE1MTY0OSk7CiAgICBhID0gbWQ1X2lpKGEsIGIsIGMsIGQsIHhbaSsgNF0sIDYgLCAtMTQ1NTIzMDcwKTsKICAgIGQgPSBtZDVfaWkoZCwgYSwgYiwgYywgeFtpKzExXSwgMTAsIC0xMTIwMjEwMzc5KTsKICAgIGMgPSBtZDVfaWkoYywgZCwgYSwgYiwgeFtpKyAyXSwgMTUsICA3MTg3ODcyNTkpOwogICAgYiA9IG1kNV9paShiLCBjLCBkLCBhLCB4W2krIDldLCAyMSwgLTM0MzQ4NTU1MSk7CgogICAgYSA9IHNhZmVfYWRkKGEsIG9sZGEpOwogICAgYiA9IHNhZmVfYWRkKGIsIG9sZGIpOwogICAgYyA9IHNhZmVfYWRkKGMsIG9sZGMpOwogICAgZCA9IHNhZmVfYWRkKGQsIG9sZGQpOwogIH0KICByZXR1cm4gQXJyYXkoYSwgYiwgYywgZCk7Cn0KCi8qCiAqIFRoZXNlIGZ1bmN0aW9ucyBpbXBsZW1lbnQgdGhlIGZvdXIgYmFzaWMgb3BlcmF0aW9ucyB0aGUgYWxnb3JpdGhtIHVzZXMuCiAqLwpmdW5jdGlvbiBtZDVfY21uKHEsIGEsIGIsIHgsIHMsIHQpCnsKICByZXR1cm4gc2FmZV9hZGQoYml0X3JvbChzYWZlX2FkZChzYWZlX2FkZChhLCBxKSwgc2FmZV9hZGQoeCwgdCkpLCBzKSxiKTsKfQpmdW5jdGlvbiBtZDVfZmYoYSwgYiwgYywgZCwgeCwgcywgdCkKewogIHJldHVybiBtZDVfY21uKChiICYgYykgfCAoKH5iKSAmIGQpLCBhLCBiLCB4LCBzLCB0KTsKfQpmdW5jdGlvbiBtZDVfZ2coYSwgYiwgYywgZCwgeCwgcywgdCkKewogIHJldHVybiBtZDVfY21uKChiICYgZCkgfCAoYyAmICh+ZCkpLCBhLCBiLCB4LCBzLCB0KTsKfQpmdW5jdGlvbiBtZDVfaGgoYSwgYiwgYywgZCwgeCwgcywgdCkKewogIHJldHVybiBtZDVfY21uKGIgXiBjIF4gZCwgYSwgYiwgeCwgcywgdCk7Cn0KZnVuY3Rpb24gbWQ1X2lpKGEsIGIsIGMsIGQsIHgsIHMsIHQpCnsKICByZXR1cm4gbWQ1X2NtbihjIF4gKGIgfCAofmQpKSwgYSwgYiwgeCwgcywgdCk7Cn0KCi8qCiAqIEFkZCBpbnRlZ2Vycywgd3JhcHBpbmcgYXQgMl4zMi4gVGhpcyB1c2VzIDE2LWJpdCBvcGVyYXRpb25zIGludGVybmFsbHkKICogdG8gd29yayBhcm91bmQgYnVncyBpbiBzb21lIEpTIGludGVycHJldGVycy4KICovCmZ1bmN0aW9uIHNhZmVfYWRkKHgsIHkpCnsKICB2YXIgbHN3ID0gKHggJiAweEZGRkYpICsgKHkgJiAweEZGRkYpOwogIHZhciBtc3cgPSAoeCA+PiAxNikgKyAoeSA+PiAxNikgKyAobHN3ID4+IDE2KTsKICByZXR1cm4gKG1zdyA8PCAxNikgfCAobHN3ICYgMHhGRkZGKTsKfQoKLyoKICogQml0d2lzZSByb3RhdGUgYSAzMi1iaXQgbnVtYmVyIHRvIHRoZSBsZWZ0LgogKi8KZnVuY3Rpb24gYml0X3JvbChudW0sIGNudCkKewogIHJldHVybiAobnVtIDw8IGNudCkgfCAobnVtID4+PiAoMzIgLSBjbnQpKTsKfQoKZXhwb3J0cy5iNjRfaG1hY19tZDUgPSBiNjRfaG1hY19tZDU7Cgp9KX07CgovKioqKioqKioqKiBsaWIvbnJhbWEyX2luaXQgKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJsaWIvbnJhbWEyX2luaXQiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLyoqCiAqIENhbGwgdGhpcyAobm90IG5yYW1hMikgdG8gbG9hZCB0aGUgZnVuY3Rpb25zLgogKiBOQiBjYW4gb25seSBiZSBjYWxsZWQgY2xpZW50IHNpZGUhCiAqIAogKi8KdmFyIGRiID0gcmVxdWlyZSgna2Fuc28vZGInKSwKICAgIHV0aWxzID0gcmVxdWlyZSgna2Fuc28vdXRpbHMnKSwKICAgIHNlc3Npb24gPSByZXF1aXJlKCdrYW5zby9zZXNzaW9uJyksCiAgICBfID0gcmVxdWlyZSgnLi91bmRlcnNjb3JlJykuXywKICAgIEJpYnRleFBhcnNlciA9IHJlcXVpcmUoJy4vYmlidGV4JykuQmlidGV4UGFyc2VyLCAgICAgIC8vbmIgdGhpcyBpcyBtb3JlIHVwdG9kYXRlIHRoYW4gdGhhdCBpbmNsLiB3aXRoIGthbnNvIDAuMC43CiAgICBiNjRfaG1hY19tZDUgPSByZXF1aXJlKCcuL21kNScpLmI2NF9obWFjX21kNSwKICAgIHV1aWRfc3luYyA9IHJlcXVpcmUoJy4vdXVpZCcpOwogICAgbnJhbWFfY29uc3RydWN0b3JzID0gcmVxdWlyZSgnLi9ucmFtYTInKTsKCi8qKgogKiByZXF1aXJlcyBnbG9iYWwgJAogKi8KdmFyIF9pbml0ID0gZnVuY3Rpb24oKXsKICAgIGlmKCB0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZScgKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJucmFtYS5pbml0IGNhbiBvbmx5IGJlIHJ1biBpbiB0aGUgYnJvd3NlciAod2luZG93IG9yIGRvY3VtZW50IG5vdCBkZWZpbmVkKSIpOwogICAgfQogICAgaWYoIHR5cGVvZiAkID09PSAndW5kZWZpbmVkJyApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm5yYW1hLmluaXQgcmVxdWlyZXMgZ2xvYmFsICQgKGpRdWVyeSkiKTsKICAgIH0KCiAgICB2YXIgbGliID0gewogICAgICAgICckJyA6ICQsCiAgICAgICAgJ18nIDogXywKICAgICAgICBCaWJ0ZXhQYXJzZXIgOiBCaWJ0ZXhQYXJzZXIsCiAgICAgICAgYjY0X2htYWNfbWQ1IDogYjY0X2htYWNfbWQ1CiAgICB9OwogICAgCiAgICAvLyB0ZW1wb3JhcnkgcGF0Y2ggKGthbnNvJ3MgZGIgbGFja3MgdXBkYXRlcykKICAgIGlmKCAhZGIuZG9VcGRhdGUgKSB7CiAgICAgICAgZGIuZG9VcGRhdGUgPSBmdW5jdGlvbiggZG9jLCB1cGRhdGVfbmFtZSwgY2FsbGJhY2sgKSB7CiAgICAgICAgICAgIHZhciB1cmwgPSB1dGlscy5nZXRCYXNlVVJMKCkgKyAnL3VwZGF0ZS8nICsgdXBkYXRlX25hbWUgKycvJyArIGRiLmVuY29kZSggZG9jLl9pZCApOwogICAgICAgICAgICB2YXIgcmVxID0gewogICAgICAgICAgICAgICAgdHlwZTogJ1BVVCcsCiAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGRvYyksCiAgICAgICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsCiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICAgZXhwZWN0X2pzb246ZmFsc2UgICAgICAgICAgICAgICAvL2FzIG9mIGNvdWNoZGIgMS4xLjAsIHVwZGF0ZXMgc2VlbSB0byBkZWZ5IGF0dGVtcHRzIHRvIGFsdGVyIGhlYWRlcnMgJiByZXR1cm4gdGV4dC9odG1sIGhlYWRlci4KICAgICAgICAgICAgfTsKICAgICAgICAgICAgZGIucmVxdWVzdChyZXEsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgfQogICAgdmFyIG5yYW1hID0ge307CiAgICBucmFtYS51dWlkID0gbnJhbWFfY29uc3RydWN0b3JzLl9tYWtlX3V1aWQodXVpZF9zeW5jKTsKICAgIG5yYW1hLnNldHRpbmdzID0gXy5leHRlbmQoIG5yYW1hX2NvbnN0cnVjdG9ycy5fbWFrZV9zZXR0aW5ncyggbnJhbWEudXVpZCApLCB7CiAgICAgICAgLy8gLS0gaW50ZXJuYWxzCiAgICAgICAgaXNfZW1iZWRkZWQgOiBmYWxzZSwgICAgIC8vc2V0IHRvIGZhbHNlIHdoZW4gYmVpbmcgdXNlZCBvbiB0aGUgc2VydmVyCiAgICAgICAgZGVidWcgOiB0cnVlLAogICAgICAgIHVzZXJfaWQgOiAnKkVSUk9SJywKICAgICAgICAvLyAtLSBxdW90ZXMgJiBub3RlIHNldHRpbmdzCiAgICAgICAgbm90ZV9zdHlsZSA6IHt9LAogICAgICAgIG5vdGVfaW5uZXJfc3R5bGUgOiB7fSwKICAgICAgICBub3RlX2VkaXRvcl9zdHlsZSA6IHt9CiAgICB9KTsKICAgIG5yYW1hLl9kZWJ1ZyA9IG5yYW1hX2NvbnN0cnVjdG9ycy5fbWFrZV9kZWJ1ZyhucmFtYS5zZXR0aW5ncywgd2luZG93LCBsaWIpOwogICAgbnJhbWEubG9nID0gbnJhbWFfY29uc3RydWN0b3JzLl9tYWtlX2xvZ2dpbmcobnJhbWEuc2V0dGluZ3MsICQpOwogICAgbnJhbWEuZGIgPSBkYjsKICAgIG5yYW1hLnNlc3Npb24gPSBzZXNzaW9uOwogICAgbnJhbWEucGVyc2lzdCA9IG5yYW1hX2NvbnN0cnVjdG9ycy5fbWFrZV9wZXJzaXN0KG5yYW1hLmRiLCBucmFtYS5zZXNzaW9uLCBucmFtYS51dWlkLCBucmFtYS5fZGVidWcpOwogICAgbnJhbWEuc291cmNlcyA9IG5yYW1hX2NvbnN0cnVjdG9ycy5fbWFrZV9zb3VyY2VzKG5yYW1hLnNldHRpbmdzLCBucmFtYS5wZXJzaXN0LCBucmFtYS5fZGVidWcsIGxpYik7CiAgICAKICAgIG5yYW1hLm5vdGVzID0gbnJhbWFfY29uc3RydWN0b3JzLl9tYWtlX25vdGVzKG5yYW1hLnNldHRpbmdzLCBucmFtYS51dWlkLCBucmFtYS5wZXJzaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnJhbWEuc291cmNlcywgbnVsbC8qcXVvdGVzKi8sIG5yYW1hLl9kZWJ1Zyk7CiAgICAKICAgIC8qKgogICAgICogcmV0dXJuIHVybHMgZm9yIHZhcmlvdXMgdGhpbmdzICh2YXJpZXMgZGVwZW5kaW5nIG9uIGN1cnJlbnQgdXJsKQogICAgICovCiAgICBucmFtYS5rYW5zb191cmxzID0ge30KICAgIG5yYW1hLmthbnNvX3VybHMudGFnID0gZnVuY3Rpb24odGFnLCByZXEpIHsKICAgICAgICByZXR1cm4gcmVxLnVzZXJDdHguYmFzZVVSTCArIChyZXEucXVlcnkudXNlciA/ICcvdXNlcnMvJytlbmNvZGVVUklDb21wb25lbnQocmVxLnF1ZXJ5LnVzZXIpIDogJycpICsgJy90YWdzLycrIHRhZzsKICAgIH0KICAgIAogICAgCiAgICByZXR1cm4gbnJhbWE7Cn07CgoKZXhwb3J0cy5pbml0ID0gXy5vbmNlKF9pbml0KTsKCn0pfTsKCi8qKioqKioqKioqIGxpYi9yZXdyaXRlcyAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImxpYi9yZXdyaXRlcyJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKioKICogUmV3cml0ZSBzZXR0aW5ncyB0byBiZSBleHBvcnRlZCBmcm9tIHRoZSBkZXNpZ24gZG9jCiAqCiAqIE5CIDogZm9yIG5yYW1hLCB0aGUgcGFyYW1ldGVyIG5hbWVzIG1hdHRlciBiZWNhdXNlIHJlcS5xdWVyeSBpcyB1c2VkCiAqICAgICAgaW4gdGVtcGxhdGluZy4gIFRoZWlyIG5hbWVzIG11c3QgbWF0Y2ggdGhlIHVybHMgdXNlZCB0byBhY2Nlc3MgdGhlbSwKICogICAgICBlLmcuICc6dXNlcicgZm9yIHNvbWV0aGluZyByZXByZW5zZXRlZCBpbiBhIHVybCBhcyAvdXNlcnMvOnVzZXIKICoKICovCgptb2R1bGUuZXhwb3J0cyA9IFsKICAgIHtmcm9tOiAnL3N0YXRpYy8qJywgdG86ICdzdGF0aWMvKid9LAogICAge2Zyb206ICcveGRtLyonLCB0bzogJ3hkbS8qJ30sCiAgICAvLyAtLSBmb3IgdGhlIG5yYW1hIGFwcGxpY2F0aW9uCiAgICB7CiAgICAgICAgZnJvbSA6ICcvc291cmNlcycsICAgICAgICAgICAgICAvL2FsbCBzb3VyY2VzCiAgICAgICAgdG8gOiAnX2xpc3Qvc291cmNlcy9zb3VyY2UnLAogICAgICAgIHF1ZXJ5IDogewogICAgICAgICAgICBpbmNsdWRlX2RvY3MgOiAndHJ1ZScsICAvL2ZvciBzb21lIHJlYXNvbiBpdCBtdXN0IGJlICd0cnVlJywgbm90IHRydWUuCiAgICAgICAgICAgIGRlc2NlbmRpbmcgOiAndHJ1ZScKICAgICAgICB9IAogICAgfSwKICAgIHsKICAgICAgICBmcm9tOiAnL3VzZXJzJywgICAgICAgICAgICAgICAgICAgLy9saXN0IGFsbCB1c2VyczsgaW50ZW5kZWQgYXMgYW4gZW50cnkgcG9pbnQgZm9yIHNlYXJjaCBlbmdpbmVzIDogVE9ETyBuZWVkcyB1cGRhdGluZyEKICAgICAgICB0bzogJ19saXN0L2FsbF91c2Vycy9hbGxfdXNlcl9pZHMnLAogICAgICAgIG1ldGhvZCA6ICdHRVQnLAogICAgICAgIHF1ZXJ5IDogewogICAgICAgICAgZ3JvdXAgOiAndHJ1ZScKICAgICAgICB9IAogICAgfSwKICAgIHsKICAgICAgICBmcm9tIDogJy91c2Vycy86dXNlcicsICAgICAgLy9jdXJyZW50bHkgYWxsIHNvdXJjZXMgZm9yIGEgcGFydGljdWxhciB1c2VyLCBwcm9iYWJseSBtb2RpZmllZCBpbiBmdXR1cmUKICAgICAgICB0byA6ICdfbGlzdC9mbG93L3F1b3RlcycsCiAgICAgICAgcXVlcnkgOiB7CiAgICAgICAgICAgIGVuZF9rZXk6IFsiOnVzZXIiXSwKICAgICAgICAgICAgc3RhcnRfa2V5IDogWyI6dXNlciIsIHt9XSwKICAgICAgICAgICAgaW5jbHVkZV9kb2NzIDogJ3RydWUnLAogICAgICAgICAgICBkZXNjZW5kaW5nIDogJ3RydWUnCiAgICAgICAgfSAKICAgIH0sCiAgICB7CiAgICAgICAgZnJvbSA6ICcvdXNlcnMvOnVzZXIvc291cmNlcycsICAgICAgLy9jdXJyZW50bHkgYWxsIHNvdXJjZXMgZm9yIGEgcGFydGljdWxhciB1c2VyLCBwcm9iYWJseSBtb2RpZmllZCBpbiBmdXR1cmUKICAgICAgICB0byA6ICdfbGlzdC9zb3VyY2VzL3VzZXJJZF9zb3VyY2UnLAogICAgICAgIHF1ZXJ5IDogewogICAgICAgICAgICBlbmRfa2V5OiBbIjp1c2VyIl0sCiAgICAgICAgICAgIHN0YXJ0X2tleSA6IFsiOnVzZXIiLCB7fV0sCiAgICAgICAgICAgIGluY2x1ZGVfZG9jcyA6ICd0cnVlJywKICAgICAgICAgICAgZGVzY2VuZGluZyA6ICd0cnVlJwogICAgICAgIH0gCiAgICB9LAogICAgewogICAgICAgIGZyb20gOiAnL2F1dGhvcnMnLAogICAgICAgIHRvIDogJ19saXN0L2F1dGhvcnMvYXV0aG9yX3VzZXJJZCcsCiAgICAgICAgcXVlcnkgOiB7CiAgICAgICAgICAgIGluY2x1ZGVfZG9jcyA6ICd0cnVlJywKICAgICAgICAgICAgZGVzY2VuZGluZyA6ICdmYWxzZScsCiAgICAgICAgICAgIHJlZHVjZSA6ICdmYWxzZScsCiAgICAgICAgICAgIGF1dGhvcl9pbmRleF9pbl9rZXkgOiAnMCcKICAgICAgICB9CiAgICB9LAogICAgewogICAgICAgIGZyb20gOiAnL2F1dGhvcnMvOmF1dGhvcicsICAgLy9hbGwgc291cmNlcyBmb3IgYW4gYXV0aG9yIAogICAgICAgIHRvIDogJ19saXN0L2F1dGhvcnMvYXV0aG9yX3VzZXJJZCcsCiAgICAgICAgcXVlcnkgOiB7CiAgICAgICAgICAgIHN0YXJ0X2tleSA6ICBbIjphdXRob3IiXSwKICAgICAgICAgICAgZW5kX2tleSA6IFsiOmF1dGhvciIsIHt9XSwKICAgICAgICAgICAgaW5jbHVkZV9kb2NzIDogJ3RydWUnLAogICAgICAgICAgICBkZXNjZW5kaW5nIDogJ2ZhbHNlJywKICAgICAgICAgICAgcmVkdWNlIDogJ2ZhbHNlJywKICAgICAgICAgICAgYXV0aG9yX2luZGV4X2luX2tleSA6ICcwJwogICAgICAgIH0KICAgIH0sCiAgICB7CiAgICAgICAgZnJvbSA6ICcvdXNlcnMvOnVzZXIvYXV0aG9ycycsICAgICAgICAgICAgICAvL2xpc3QgYSB1c2VyJ3MgYXV0aG9ycwogICAgICAgIHRvIDogJ19saXN0L2F1dGhvcnMvdXNlcklkX2F1dGhvcicsCiAgICAgICAgcXVlcnkgOiB7CiAgICAgICAgICAgIHN0YXJ0X2tleSA6IFsiOnVzZXIiXSwKICAgICAgICAgICAgZW5kX2tleSA6IFsiOnVzZXIiLHt9XSwKICAgICAgICAgICAgcmVkdWNlIDogJ2ZhbHNlJywKICAgICAgICAgICAgaW5jbHVkZV9kb2NzIDogJ3RydWUnLCAgIC8vZG9jcyBhcmUgc291cmNlcyAKICAgICAgICAgICAgYXV0aG9yX2luZGV4X2luX2tleSA6ICcxJwogICAgICAgIH0KICAgIH0sCiAgICB7CiAgICAgICAgZnJvbSA6ICcvdXNlcnMvOnVzZXIvYXV0aG9ycy86YXV0aG9yJywgICAgLy9hbGwgc291cmNlcyBmb3IgYW4gYXV0aG9yICYgdXNlcgogICAgICAgIHRvIDogJ19saXN0L2F1dGhvcnMvYXV0aG9yX3VzZXJJZCcsCiAgICAgICAgcXVlcnkgOiB7CiAgICAgICAgICAgIHN0YXJ0X2tleSA6ICBbIjphdXRob3IiLCAiOnVzZXIiXSwKICAgICAgICAgICAgZW5kX2tleSA6IFsiOmF1dGhvciIsICI6dXNlciIsIHt9XSwKICAgICAgICAgICAgaW5jbHVkZV9kb2NzIDogJ3RydWUnLAogICAgICAgICAgICBkZXNjZW5kaW5nIDogJ2ZhbHNlJywKICAgICAgICAgICAgcmVkdWNlIDogJ2ZhbHNlJywKICAgICAgICAgICAgYXV0aG9yX2luZGV4X2luX2tleSA6ICcwJwogICAgICAgIH0KICAgIH0sCiAgICB7CiAgICAgICAgZnJvbSA6ICcvc291cmNlcy86c291cmNlJywgICAgICAgICAgICAgICAgICAvL2V2ZXJ5b25lJ3Mgbm90ZXMgb24gYSBzb3VyY2UKICAgICAgICB0byA6ICdfbGlzdC9xdW90ZXMvcGFnZUlkX3VzZXJJZCcsCiAgICAgICAgcXVlcnkgOiB7CiAgICAgICAgICAgIHN0YXJ0a2V5IDogWyI6c291cmNlIl0sCiAgICAgICAgICAgIGVuZGtleSA6IFsiOnNvdXJjZSIse31dLAogICAgICAgICAgICBpbmNsdWRlX2RvY3MgOiAndHJ1ZScKICAgICAgICB9CiAgICB9LAogICAgewogICAgICAgIGZyb20gOiAnL3VzZXJzLzp1c2VyL3NvdXJjZXMvOnNvdXJjZScsICAgIC8vdGhlIHVzZXIncyBub3RlcyBvbiBhIHNvdXJjZQogICAgICAgIHRvIDogJ19saXN0L3F1b3Rlcy9wYWdlSWRfdXNlcklkJywKICAgICAgICBxdWVyeSA6IHsKICAgICAgICAgICAga2V5IDogWyI6c291cmNlIiwiOnVzZXIiXSwKICAgICAgICAgICAgaW5jbHVkZV9kb2NzIDogJ3RydWUnCiAgICAgICAgfQogICAgfSwKICAgIHsKICAgICAgICBmcm9tIDogJy90YWdzJywgICAgICAgICAgICAgICAgICAgICAgICAgLy9hbGwgdGFncywgd2l0aCBmcmVxdWVuY3kKICAgICAgICB0byA6ICdfbGlzdC90YWdzL3RhZ3NfYWxsJywKICAgICAgICBxdWVyeSA6IHsKICAgICAgICAgICAgZ3JvdXAgOiAndHJ1ZScsCiAgICAgICAgICAgIHRhZ19pbmRleF9pbl9rZXkgOiAnMCcKICAgICAgICB9CiAgICB9LAogICAgewogICAgICAgIGZyb20gOiAnL3RhZ3MvOnRhZycsICAgICAgICAgICAgICAgICAgIC8vc2hvdyBldmVyeXRoaW5nIG1hcmtlZCB3aXRoIGEgcGFydGljdWxhciB0YWcKICAgICAgICB0byA6ICdfbGlzdC9xdW90ZXMvdGFncycsCiAgICAgICAgcXVlcnkgOiB7CiAgICAgICAgICAgIGVuZGtleSA6IFsiOnRhZyJdLAogICAgICAgICAgICBzdGFydGtleSA6IFsiOnRhZyIsIHt9XSwKICAgICAgICAgICAgcmVkdWNlIDogJ2ZhbHNlJywKICAgICAgICAgICAgZGVzY2VuZGluZyA6ICd0cnVlJywKICAgICAgICAgICAgaW5jbHVkZV9kb2NzIDogJ3RydWUnCiAgICAgICAgfQogICAgfSwKICAgIHsKICAgICAgICBmcm9tIDogJy90YWdzLzp0YWcvcmVjZW50JywgICAgICAgICAgICAvL3NhbWUgYXMgcHJldmlvdXMgYnV0IHdpdGggZmxvdwogICAgICAgIHRvIDogJ19saXN0L2Zsb3cvdGFncycsCiAgICAgICAgcXVlcnkgOiB7CiAgICAgICAgICAgIGVuZGtleSA6IFsiOnRhZyJdLAogICAgICAgICAgICBzdGFydGtleSA6IFsiOnRhZyIsIHt9XSwKICAgICAgICAgICAgcmVkdWNlIDogJ2ZhbHNlJywKICAgICAgICAgICAgZGVzY2VuZGluZyA6ICd0cnVlJywKICAgICAgICAgICAgaW5jbHVkZV9kb2NzIDogJ3RydWUnCiAgICAgICAgfQogICAgfSwKICAgIHsKICAgICAgICBmcm9tIDogJy91c2Vycy86dXNlci90YWdzJywKICAgICAgICB0byA6ICdfbGlzdC90YWdzL3RhZ3NfdXNlcicsCiAgICAgICAgcXVlcnkgOiB7CiAgICAgICAgICAgIHN0YXJ0a2V5IDogWyI6dXNlciJdLAogICAgICAgICAgICBlbmRrZXkgOiBbIjp1c2VyIiwge31dLAogICAgICAgICAgICBncm91cF9sZXZlbCA6ICcyJywKICAgICAgICAgICAgdGFnX2luZGV4X2luX2tleSA6ICcxJwogICAgICAgIH0KICAgIH0sCiAgICB7CiAgICAgICAgZnJvbSA6ICcvdXNlcnMvOnVzZXIvdGFncy86dGFnJywgICAgICAgICAgICAgICAgIC8vc2hvdyBldmVyeXRoaW5nIG9mIGEgdXNlcnMnIG1hcmtlZCB3aXRoIGEgcGFydGljdWxhciB0YWcKICAgICAgICB0byA6ICdfbGlzdC9xdW90ZXMvdGFncycsCiAgICAgICAgcXVlcnkgOiB7CiAgICAgICAgICBlbmRrZXkgOiBbIjp0YWciLCI6dXNlciJdLAogICAgICAgICAgc3RhcnRrZXkgOiBbIjp0YWciLCAiOnVzZXIiLCB7fV0sCiAgICAgICAgICByZWR1Y2UgOiAnZmFsc2UnLAogICAgICAgICAgZGVzY2VuZGluZyA6ICd0cnVlJywKICAgICAgICAgIGluY2x1ZGVfZG9jcyA6ICd0cnVlJwogICAgICAgIH0KICAgIH0sCiAgICB7CiAgICAgICAgZnJvbSA6ICcvdXNlcnMvOnVzZXIvdGFncy86dGFnL3JlY2VudCcsICAgICAgICAgICAgICAgICAvL3Nob3cgZXZlcnl0aGluZyBvZiBhIHVzZXJzJyBtYXJrZWQgd2l0aCBhIHBhcnRpY3VsYXIgdGFnCiAgICAgICAgdG8gOiAnX2xpc3QvZmxvdy90YWdzJywKICAgICAgICBxdWVyeSA6IHsKICAgICAgICAgIGVuZGtleSA6IFsiOnRhZyIsIjp1c2VyIl0sCiAgICAgICAgICBzdGFydGtleSA6IFsiOnRhZyIsICI6dXNlciIsIHt9XSwKICAgICAgICAgIHJlZHVjZSA6ICdmYWxzZScsCiAgICAgICAgICBkZXNjZW5kaW5nIDogJ3RydWUnLAogICAgICAgICAgaW5jbHVkZV9kb2NzIDogJ3RydWUnCiAgICAgICAgfQogICAgfSwKICAgIAogICAgLy8gLS0gZm9yIHRoZSBib29rbWFya2xldC9lbWJlZGVkIGNsaWVudAogICAgewogICAgICAgIGZyb20gOiAnL3VwZGF0ZS9zb3VyY2UvOmlkJywKICAgICAgICB0byA6ICdfdXBkYXRlL3NvdXJjZS86aWQnCiAgICB9LAogICAgCiAgICAvLyAtLSBnZW5lcmljCiAgICB7IGZyb206ICcvJywgdG86ICdfc2hvdy93ZWxjb21lJyB9LAogICAge2Zyb206ICcqJywgdG86ICdfc2hvdy9ub3RfZm91bmQnfQpdOwoKCn0pfTsKCi8qKioqKioqKioqIGxpYi9zaG93cyAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImxpYi9zaG93cyJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKioKICogU2hvdyBmdW5jdGlvbnMgdG8gYmUgZXhwb3J0ZWQgZnJvbSB0aGUgZGVzaWduIGRvYy4KICovCgp2YXIgdGVtcGxhdGVzID0gcmVxdWlyZSgna2Fuc28vdGVtcGxhdGVzJyksCiAgICB1dWlkX3N5bmMgPSByZXF1aXJlKCcuL3V1aWQnKTsKICAgIG5yYW1hX2NvbnN0cnVjdG9ycyA9IHJlcXVpcmUoJy4vbnJhbWEyJyk7Cgp2YXIgbnJhbWEgPSB7fTsKbnJhbWEudXVpZCA9IG5yYW1hX2NvbnN0cnVjdG9ycy5fbWFrZV91dWlkKHV1aWRfc3luYyk7CgpleHBvcnRzLndlbGNvbWUgPSBmdW5jdGlvbiAoZG9jLCByZXEpIHsKICAgIHZhciBkYXRhID0gewogICAgICAgIGFub25fdXNlcl9uYW1lIDogJyonK25yYW1hLnV1aWQodHJ1ZSkuc2xpY2UoMCwxMCkKICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICB0aXRsZTogJ05vdGUtby1yYW1hIDogbm90ZSAtIHF1b3RlIC0gYW5hbHlzZScsCiAgICAgICAgY29udGVudDogdGVtcGxhdGVzLnJlbmRlcignd2VsY29tZS5odG1sJywgcmVxLCBkYXRhKQogICAgfTsKfTsKCmV4cG9ydHMubm90X2ZvdW5kID0gZnVuY3Rpb24gKGRvYywgcmVxKSB7CiAgICByZXR1cm4gewogICAgICAgIHRpdGxlOiAnNDA0IC0gTm90IEZvdW5kJywKICAgICAgICBjb250ZW50OiB0ZW1wbGF0ZXMucmVuZGVyKCc0MDQuaHRtbCcsIHJlcSwge30pCiAgICB9Owp9OwoKCn0pfTsKCi8qKioqKioqKioqIGxpYi90eXBlcyAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImxpYi90eXBlcyJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKioKICogS2Fuc28gZG9jdW1lbnQgdHlwZXMgdG8gZXhwb3J0CiAqLwp2YXIgVHlwZSA9IHJlcXVpcmUoJ2thbnNvL3R5cGVzJykuVHlwZSwKICAgIGZpZWxkcyA9IHJlcXVpcmUoJ2thbnNvL2ZpZWxkcycpLAogICAgd2lkZ2V0cyA9IHJlcXVpcmUoJ2thbnNvL3dpZGdldHMnKTsKCgoKCn0pfTsKCi8qKioqKioqKioqIGxpYi91bmRlcnNjb3JlICoqKioqKioqKiovCgprYW5zby5tb2R1bGVDYWNoZVsibGliL3VuZGVyc2NvcmUiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLy8gICAgIFVuZGVyc2NvcmUuanMgMS4xLjcKLy8gICAgIChjKSAyMDExIEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBJbmMuCi8vICAgICBVbmRlcnNjb3JlIGlzIGZyZWVseSBkaXN0cmlidXRhYmxlIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KLy8gICAgIFBvcnRpb25zIG9mIFVuZGVyc2NvcmUgYXJlIGluc3BpcmVkIG9yIGJvcnJvd2VkIGZyb20gUHJvdG90eXBlLAovLyAgICAgT2xpdmVyIFN0ZWVsZSdzIEZ1bmN0aW9uYWwsIGFuZCBKb2huIFJlc2lnJ3MgTWljcm8tVGVtcGxhdGluZy4KLy8gICAgIEZvciBhbGwgZGV0YWlscyBhbmQgZG9jdW1lbnRhdGlvbjoKLy8gICAgIGh0dHA6Ly9kb2N1bWVudGNsb3VkLmdpdGh1Yi5jb20vdW5kZXJzY29yZQoKKGZ1bmN0aW9uKCkgewoKICAvLyBCYXNlbGluZSBzZXR1cAogIC8vIC0tLS0tLS0tLS0tLS0tCgogIC8vIEVzdGFibGlzaCB0aGUgcm9vdCBvYmplY3QsIGB3aW5kb3dgIGluIHRoZSBicm93c2VyLCBvciBgZ2xvYmFsYCBvbiB0aGUgc2VydmVyLgogIHZhciByb290ID0gdGhpczsKCiAgLy8gU2F2ZSB0aGUgcHJldmlvdXMgdmFsdWUgb2YgdGhlIGBfYCB2YXJpYWJsZS4KICB2YXIgcHJldmlvdXNVbmRlcnNjb3JlID0gcm9vdC5fOwoKICAvLyBFc3RhYmxpc2ggdGhlIG9iamVjdCB0aGF0IGdldHMgcmV0dXJuZWQgdG8gYnJlYWsgb3V0IG9mIGEgbG9vcCBpdGVyYXRpb24uCiAgdmFyIGJyZWFrZXIgPSB7fTsKCiAgLy8gU2F2ZSBieXRlcyBpbiB0aGUgbWluaWZpZWQgKGJ1dCBub3QgZ3ppcHBlZCkgdmVyc2lvbjoKICB2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSwgT2JqUHJvdG8gPSBPYmplY3QucHJvdG90eXBlLCBGdW5jUHJvdG8gPSBGdW5jdGlvbi5wcm90b3R5cGU7CgogIC8vIENyZWF0ZSBxdWljayByZWZlcmVuY2UgdmFyaWFibGVzIGZvciBzcGVlZCBhY2Nlc3MgdG8gY29yZSBwcm90b3R5cGVzLgogIHZhciBzbGljZSAgICAgICAgICAgID0gQXJyYXlQcm90by5zbGljZSwKICAgICAgdW5zaGlmdCAgICAgICAgICA9IEFycmF5UHJvdG8udW5zaGlmdCwKICAgICAgdG9TdHJpbmcgICAgICAgICA9IE9ialByb3RvLnRvU3RyaW5nLAogICAgICBoYXNPd25Qcm9wZXJ0eSAgID0gT2JqUHJvdG8uaGFzT3duUHJvcGVydHk7CgogIC8vIEFsbCAqKkVDTUFTY3JpcHQgNSoqIG5hdGl2ZSBmdW5jdGlvbiBpbXBsZW1lbnRhdGlvbnMgdGhhdCB3ZSBob3BlIHRvIHVzZQogIC8vIGFyZSBkZWNsYXJlZCBoZXJlLgogIHZhcgogICAgbmF0aXZlRm9yRWFjaCAgICAgID0gQXJyYXlQcm90by5mb3JFYWNoLAogICAgbmF0aXZlTWFwICAgICAgICAgID0gQXJyYXlQcm90by5tYXAsCiAgICBuYXRpdmVSZWR1Y2UgICAgICAgPSBBcnJheVByb3RvLnJlZHVjZSwKICAgIG5hdGl2ZVJlZHVjZVJpZ2h0ICA9IEFycmF5UHJvdG8ucmVkdWNlUmlnaHQsCiAgICBuYXRpdmVGaWx0ZXIgICAgICAgPSBBcnJheVByb3RvLmZpbHRlciwKICAgIG5hdGl2ZUV2ZXJ5ICAgICAgICA9IEFycmF5UHJvdG8uZXZlcnksCiAgICBuYXRpdmVTb21lICAgICAgICAgPSBBcnJheVByb3RvLnNvbWUsCiAgICBuYXRpdmVJbmRleE9mICAgICAgPSBBcnJheVByb3RvLmluZGV4T2YsCiAgICBuYXRpdmVMYXN0SW5kZXhPZiAgPSBBcnJheVByb3RvLmxhc3RJbmRleE9mLAogICAgbmF0aXZlSXNBcnJheSAgICAgID0gQXJyYXkuaXNBcnJheSwKICAgIG5hdGl2ZUtleXMgICAgICAgICA9IE9iamVjdC5rZXlzLAogICAgbmF0aXZlQmluZCAgICAgICAgID0gRnVuY1Byb3RvLmJpbmQ7CgogIC8vIENyZWF0ZSBhIHNhZmUgcmVmZXJlbmNlIHRvIHRoZSBVbmRlcnNjb3JlIG9iamVjdCBmb3IgdXNlIGJlbG93LgogIHZhciBfID0gZnVuY3Rpb24ob2JqKSB7IHJldHVybiBuZXcgd3JhcHBlcihvYmopOyB9OwoKICAvLyBFeHBvcnQgdGhlIFVuZGVyc2NvcmUgb2JqZWN0IGZvciAqKkNvbW1vbkpTKiosIHdpdGggYmFja3dhcmRzLWNvbXBhdGliaWxpdHkKICAvLyBmb3IgdGhlIG9sZCBgcmVxdWlyZSgpYCBBUEkuIElmIHdlJ3JlIG5vdCBpbiBDb21tb25KUywgYWRkIGBfYCB0byB0aGUKICAvLyBnbG9iYWwgb2JqZWN0LgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgbW9kdWxlLmV4cG9ydHMgPSBfOwogICAgXy5fID0gXzsKICB9IGVsc2UgewogICAgLy8gRXhwb3J0ZWQgYXMgYSBzdHJpbmcsIGZvciBDbG9zdXJlIENvbXBpbGVyICJhZHZhbmNlZCIgbW9kZS4KICAgIHJvb3RbJ18nXSA9IF87CiAgfQoKICAvLyBDdXJyZW50IHZlcnNpb24uCiAgXy5WRVJTSU9OID0gJzEuMS43JzsKCiAgLy8gQ29sbGVjdGlvbiBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBUaGUgY29ybmVyc3RvbmUsIGFuIGBlYWNoYCBpbXBsZW1lbnRhdGlvbiwgYWthIGBmb3JFYWNoYC4KICAvLyBIYW5kbGVzIG9iamVjdHMgd2l0aCB0aGUgYnVpbHQtaW4gYGZvckVhY2hgLCBhcnJheXMsIGFuZCByYXcgb2JqZWN0cy4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgZm9yRWFjaGAgaWYgYXZhaWxhYmxlLgogIHZhciBlYWNoID0gXy5lYWNoID0gXy5mb3JFYWNoID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm47CiAgICBpZiAobmF0aXZlRm9yRWFjaCAmJiBvYmouZm9yRWFjaCA9PT0gbmF0aXZlRm9yRWFjaCkgewogICAgICBvYmouZm9yRWFjaChpdGVyYXRvciwgY29udGV4dCk7CiAgICB9IGVsc2UgaWYgKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gb2JqLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGlmIChpIGluIG9iaiAmJiBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtpXSwgaSwgb2JqKSA9PT0gYnJlYWtlcikgcmV0dXJuOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpba2V5XSwga2V5LCBvYmopID09PSBicmVha2VyKSByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgLy8gUmV0dXJuIHRoZSByZXN1bHRzIG9mIGFwcGx5aW5nIHRoZSBpdGVyYXRvciB0byBlYWNoIGVsZW1lbnQuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYG1hcGAgaWYgYXZhaWxhYmxlLgogIF8ubWFwID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdHM7CiAgICBpZiAobmF0aXZlTWFwICYmIG9iai5tYXAgPT09IG5hdGl2ZU1hcCkgcmV0dXJuIG9iai5tYXAoaXRlcmF0b3IsIGNvbnRleHQpOwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICByZXN1bHRzW3Jlc3VsdHMubGVuZ3RoXSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgLy8gKipSZWR1Y2UqKiBidWlsZHMgdXAgYSBzaW5nbGUgcmVzdWx0IGZyb20gYSBsaXN0IG9mIHZhbHVlcywgYWthIGBpbmplY3RgLAogIC8vIG9yIGBmb2xkbGAuIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGByZWR1Y2VgIGlmIGF2YWlsYWJsZS4KICBfLnJlZHVjZSA9IF8uZm9sZGwgPSBfLmluamVjdCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIG1lbW8sIGNvbnRleHQpIHsKICAgIHZhciBpbml0aWFsID0gbWVtbyAhPT0gdm9pZCAwOwogICAgaWYgKG9iaiA9PSBudWxsKSBvYmogPSBbXTsKICAgIGlmIChuYXRpdmVSZWR1Y2UgJiYgb2JqLnJlZHVjZSA9PT0gbmF0aXZlUmVkdWNlKSB7CiAgICAgIGlmIChjb250ZXh0KSBpdGVyYXRvciA9IF8uYmluZChpdGVyYXRvciwgY29udGV4dCk7CiAgICAgIHJldHVybiBpbml0aWFsID8gb2JqLnJlZHVjZShpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlKGl0ZXJhdG9yKTsKICAgIH0KICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKCFpbml0aWFsKSB7CiAgICAgICAgbWVtbyA9IHZhbHVlOwogICAgICAgIGluaXRpYWwgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIG1lbW8gPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG1lbW8sIHZhbHVlLCBpbmRleCwgbGlzdCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFpbml0aWFsKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJSZWR1Y2Ugb2YgZW1wdHkgYXJyYXkgd2l0aCBubyBpbml0aWFsIHZhbHVlIik7CiAgICByZXR1cm4gbWVtbzsKICB9OwoKICAvLyBUaGUgcmlnaHQtYXNzb2NpYXRpdmUgdmVyc2lvbiBvZiByZWR1Y2UsIGFsc28ga25vd24gYXMgYGZvbGRyYC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgcmVkdWNlUmlnaHRgIGlmIGF2YWlsYWJsZS4KICBfLnJlZHVjZVJpZ2h0ID0gXy5mb2xkciA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIG1lbW8sIGNvbnRleHQpIHsKICAgIGlmIChvYmogPT0gbnVsbCkgb2JqID0gW107CiAgICBpZiAobmF0aXZlUmVkdWNlUmlnaHQgJiYgb2JqLnJlZHVjZVJpZ2h0ID09PSBuYXRpdmVSZWR1Y2VSaWdodCkgewogICAgICBpZiAoY29udGV4dCkgaXRlcmF0b3IgPSBfLmJpbmQoaXRlcmF0b3IsIGNvbnRleHQpOwogICAgICByZXR1cm4gbWVtbyAhPT0gdm9pZCAwID8gb2JqLnJlZHVjZVJpZ2h0KGl0ZXJhdG9yLCBtZW1vKSA6IG9iai5yZWR1Y2VSaWdodChpdGVyYXRvcik7CiAgICB9CiAgICB2YXIgcmV2ZXJzZWQgPSAoXy5pc0FycmF5KG9iaikgPyBvYmouc2xpY2UoKSA6IF8udG9BcnJheShvYmopKS5yZXZlcnNlKCk7CiAgICByZXR1cm4gXy5yZWR1Y2UocmV2ZXJzZWQsIGl0ZXJhdG9yLCBtZW1vLCBjb250ZXh0KTsKICB9OwoKICAvLyBSZXR1cm4gdGhlIGZpcnN0IHZhbHVlIHdoaWNoIHBhc3NlcyBhIHRydXRoIHRlc3QuIEFsaWFzZWQgYXMgYGRldGVjdGAuCiAgXy5maW5kID0gXy5kZXRlY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0OwogICAgYW55KG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpIHsKICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIHRoYXQgcGFzcyBhIHRydXRoIHRlc3QuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGZpbHRlcmAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYHNlbGVjdGAuCiAgXy5maWx0ZXIgPSBfLnNlbGVjdCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHRzID0gW107CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiByZXN1bHRzOwogICAgaWYgKG5hdGl2ZUZpbHRlciAmJiBvYmouZmlsdGVyID09PSBuYXRpdmVGaWx0ZXIpIHJldHVybiBvYmouZmlsdGVyKGl0ZXJhdG9yLCBjb250ZXh0KTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSkgcmVzdWx0c1tyZXN1bHRzLmxlbmd0aF0gPSB2YWx1ZTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgLy8gUmV0dXJuIGFsbCB0aGUgZWxlbWVudHMgZm9yIHdoaWNoIGEgdHJ1dGggdGVzdCBmYWlscy4KICBfLnJlamVjdCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHRzID0gW107CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiByZXN1bHRzOwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpZiAoIWl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSkgcmVzdWx0c1tyZXN1bHRzLmxlbmd0aF0gPSB2YWx1ZTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgYWxsIG9mIHRoZSBlbGVtZW50cyBtYXRjaCBhIHRydXRoIHRlc3QuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGV2ZXJ5YCBpZiBhdmFpbGFibGUuCiAgLy8gQWxpYXNlZCBhcyBgYWxsYC4KICBfLmV2ZXJ5ID0gXy5hbGwgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0ID0gdHJ1ZTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdDsKICAgIGlmIChuYXRpdmVFdmVyeSAmJiBvYmouZXZlcnkgPT09IG5hdGl2ZUV2ZXJ5KSByZXR1cm4gb2JqLmV2ZXJ5KGl0ZXJhdG9yLCBjb250ZXh0KTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKCEocmVzdWx0ID0gcmVzdWx0ICYmIGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSkpIHJldHVybiBicmVha2VyOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIERldGVybWluZSBpZiBhdCBsZWFzdCBvbmUgZWxlbWVudCBpbiB0aGUgb2JqZWN0IG1hdGNoZXMgYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBzb21lYCBpZiBhdmFpbGFibGUuCiAgLy8gQWxpYXNlZCBhcyBgYW55YC4KICB2YXIgYW55ID0gXy5zb21lID0gXy5hbnkgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IF8uaWRlbnRpdHk7CiAgICB2YXIgcmVzdWx0ID0gZmFsc2U7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiByZXN1bHQ7CiAgICBpZiAobmF0aXZlU29tZSAmJiBvYmouc29tZSA9PT0gbmF0aXZlU29tZSkgcmV0dXJuIG9iai5zb21lKGl0ZXJhdG9yLCBjb250ZXh0KTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKHJlc3VsdCB8PSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpIHJldHVybiBicmVha2VyOwogICAgfSk7CiAgICByZXR1cm4gISFyZXN1bHQ7CiAgfTsKCiAgLy8gRGV0ZXJtaW5lIGlmIGEgZ2l2ZW4gdmFsdWUgaXMgaW5jbHVkZWQgaW4gdGhlIGFycmF5IG9yIG9iamVjdCB1c2luZyBgPT09YC4KICAvLyBBbGlhc2VkIGFzIGBjb250YWluc2AuCiAgXy5pbmNsdWRlID0gXy5jb250YWlucyA9IGZ1bmN0aW9uKG9iaiwgdGFyZ2V0KSB7CiAgICB2YXIgZm91bmQgPSBmYWxzZTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIGZvdW5kOwogICAgaWYgKG5hdGl2ZUluZGV4T2YgJiYgb2JqLmluZGV4T2YgPT09IG5hdGl2ZUluZGV4T2YpIHJldHVybiBvYmouaW5kZXhPZih0YXJnZXQpICE9IC0xOwogICAgYW55KG9iaiwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKGZvdW5kID0gdmFsdWUgPT09IHRhcmdldCkgcmV0dXJuIHRydWU7CiAgICB9KTsKICAgIHJldHVybiBmb3VuZDsKICB9OwoKICAvLyBJbnZva2UgYSBtZXRob2QgKHdpdGggYXJndW1lbnRzKSBvbiBldmVyeSBpdGVtIGluIGEgY29sbGVjdGlvbi4KICBfLmludm9rZSA9IGZ1bmN0aW9uKG9iaiwgbWV0aG9kKSB7CiAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTsKICAgIHJldHVybiBfLm1hcChvYmosIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiAobWV0aG9kLmNhbGwgPyBtZXRob2QgfHwgdmFsdWUgOiB2YWx1ZVttZXRob2RdKS5hcHBseSh2YWx1ZSwgYXJncyk7CiAgICB9KTsKICB9OwoKICAvLyBDb252ZW5pZW5jZSB2ZXJzaW9uIG9mIGEgY29tbW9uIHVzZSBjYXNlIG9mIGBtYXBgOiBmZXRjaGluZyBhIHByb3BlcnR5LgogIF8ucGx1Y2sgPSBmdW5jdGlvbihvYmosIGtleSkgewogICAgcmV0dXJuIF8ubWFwKG9iaiwgZnVuY3Rpb24odmFsdWUpeyByZXR1cm4gdmFsdWVba2V5XTsgfSk7CiAgfTsKCiAgLy8gUmV0dXJuIHRoZSBtYXhpbXVtIGVsZW1lbnQgb3IgKGVsZW1lbnQtYmFzZWQgY29tcHV0YXRpb24pLgogIF8ubWF4ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgaWYgKCFpdGVyYXRvciAmJiBfLmlzQXJyYXkob2JqKSkgcmV0dXJuIE1hdGgubWF4LmFwcGx5KE1hdGgsIG9iaik7CiAgICB2YXIgcmVzdWx0ID0ge2NvbXB1dGVkIDogLUluZmluaXR5fTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgdmFyIGNvbXB1dGVkID0gaXRlcmF0b3IgPyBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkgOiB2YWx1ZTsKICAgICAgY29tcHV0ZWQgPj0gcmVzdWx0LmNvbXB1dGVkICYmIChyZXN1bHQgPSB7dmFsdWUgOiB2YWx1ZSwgY29tcHV0ZWQgOiBjb21wdXRlZH0pOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0LnZhbHVlOwogIH07CgogIC8vIFJldHVybiB0aGUgbWluaW11bSBlbGVtZW50IChvciBlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS4KICBfLm1pbiA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGlmICghaXRlcmF0b3IgJiYgXy5pc0FycmF5KG9iaikpIHJldHVybiBNYXRoLm1pbi5hcHBseShNYXRoLCBvYmopOwogICAgdmFyIHJlc3VsdCA9IHtjb21wdXRlZCA6IEluZmluaXR5fTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgdmFyIGNvbXB1dGVkID0gaXRlcmF0b3IgPyBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkgOiB2YWx1ZTsKICAgICAgY29tcHV0ZWQgPCByZXN1bHQuY29tcHV0ZWQgJiYgKHJlc3VsdCA9IHt2YWx1ZSA6IHZhbHVlLCBjb21wdXRlZCA6IGNvbXB1dGVkfSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQudmFsdWU7CiAgfTsKCiAgLy8gU29ydCB0aGUgb2JqZWN0J3MgdmFsdWVzIGJ5IGEgY3JpdGVyaW9uIHByb2R1Y2VkIGJ5IGFuIGl0ZXJhdG9yLgogIF8uc29ydEJ5ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgcmV0dXJuIF8ucGx1Y2soXy5tYXAob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB2YWx1ZSA6IHZhbHVlLAogICAgICAgIGNyaXRlcmlhIDogaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpCiAgICAgIH07CiAgICB9KS5zb3J0KGZ1bmN0aW9uKGxlZnQsIHJpZ2h0KSB7CiAgICAgIHZhciBhID0gbGVmdC5jcml0ZXJpYSwgYiA9IHJpZ2h0LmNyaXRlcmlhOwogICAgICByZXR1cm4gYSA8IGIgPyAtMSA6IGEgPiBiID8gMSA6IDA7CiAgICB9KSwgJ3ZhbHVlJyk7CiAgfTsKCiAgLy8gR3JvdXBzIHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24gcHJvZHVjZWQgYnkgYW4gaXRlcmF0b3IKICBfLmdyb3VwQnkgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yKSB7CiAgICB2YXIgcmVzdWx0ID0ge307CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7CiAgICAgIHZhciBrZXkgPSBpdGVyYXRvcih2YWx1ZSwgaW5kZXgpOwogICAgICAocmVzdWx0W2tleV0gfHwgKHJlc3VsdFtrZXldID0gW10pKS5wdXNoKHZhbHVlKTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBVc2UgYSBjb21wYXJhdG9yIGZ1bmN0aW9uIHRvIGZpZ3VyZSBvdXQgYXQgd2hhdCBpbmRleCBhbiBvYmplY3Qgc2hvdWxkCiAgLy8gYmUgaW5zZXJ0ZWQgc28gYXMgdG8gbWFpbnRhaW4gb3JkZXIuIFVzZXMgYmluYXJ5IHNlYXJjaC4KICBfLnNvcnRlZEluZGV4ID0gZnVuY3Rpb24oYXJyYXksIG9iaiwgaXRlcmF0b3IpIHsKICAgIGl0ZXJhdG9yIHx8IChpdGVyYXRvciA9IF8uaWRlbnRpdHkpOwogICAgdmFyIGxvdyA9IDAsIGhpZ2ggPSBhcnJheS5sZW5ndGg7CiAgICB3aGlsZSAobG93IDwgaGlnaCkgewogICAgICB2YXIgbWlkID0gKGxvdyArIGhpZ2gpID4+IDE7CiAgICAgIGl0ZXJhdG9yKGFycmF5W21pZF0pIDwgaXRlcmF0b3Iob2JqKSA/IGxvdyA9IG1pZCArIDEgOiBoaWdoID0gbWlkOwogICAgfQogICAgcmV0dXJuIGxvdzsKICB9OwoKICAvLyBTYWZlbHkgY29udmVydCBhbnl0aGluZyBpdGVyYWJsZSBpbnRvIGEgcmVhbCwgbGl2ZSBhcnJheS4KICBfLnRvQXJyYXkgPSBmdW5jdGlvbihpdGVyYWJsZSkgewogICAgaWYgKCFpdGVyYWJsZSkgICAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgaWYgKGl0ZXJhYmxlLnRvQXJyYXkpICAgICAgICAgcmV0dXJuIGl0ZXJhYmxlLnRvQXJyYXkoKTsKICAgIGlmIChfLmlzQXJyYXkoaXRlcmFibGUpKSAgICAgIHJldHVybiBzbGljZS5jYWxsKGl0ZXJhYmxlKTsKICAgIGlmIChfLmlzQXJndW1lbnRzKGl0ZXJhYmxlKSkgIHJldHVybiBzbGljZS5jYWxsKGl0ZXJhYmxlKTsKICAgIHJldHVybiBfLnZhbHVlcyhpdGVyYWJsZSk7CiAgfTsKCiAgLy8gUmV0dXJuIHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaW4gYW4gb2JqZWN0LgogIF8uc2l6ZSA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8udG9BcnJheShvYmopLmxlbmd0aDsKICB9OwoKICAvLyBBcnJheSBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0KCiAgLy8gR2V0IHRoZSBmaXJzdCBlbGVtZW50IG9mIGFuIGFycmF5LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIHRoZSBmaXJzdCBOCiAgLy8gdmFsdWVzIGluIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgaGVhZGAuIFRoZSAqKmd1YXJkKiogY2hlY2sgYWxsb3dzIGl0IHRvIHdvcmsKICAvLyB3aXRoIGBfLm1hcGAuCiAgXy5maXJzdCA9IF8uaGVhZCA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkgewogICAgcmV0dXJuIChuICE9IG51bGwpICYmICFndWFyZCA/IHNsaWNlLmNhbGwoYXJyYXksIDAsIG4pIDogYXJyYXlbMF07CiAgfTsKCiAgLy8gUmV0dXJucyBldmVyeXRoaW5nIGJ1dCB0aGUgZmlyc3QgZW50cnkgb2YgdGhlIGFycmF5LiBBbGlhc2VkIGFzIGB0YWlsYC4KICAvLyBFc3BlY2lhbGx5IHVzZWZ1bCBvbiB0aGUgYXJndW1lbnRzIG9iamVjdC4gUGFzc2luZyBhbiAqKmluZGV4Kiogd2lsbCByZXR1cm4KICAvLyB0aGUgcmVzdCBvZiB0aGUgdmFsdWVzIGluIHRoZSBhcnJheSBmcm9tIHRoYXQgaW5kZXggb253YXJkLiBUaGUgKipndWFyZCoqCiAgLy8gY2hlY2sgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgXy5tYXBgLgogIF8ucmVzdCA9IF8udGFpbCA9IGZ1bmN0aW9uKGFycmF5LCBpbmRleCwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAoaW5kZXggPT0gbnVsbCkgfHwgZ3VhcmQgPyAxIDogaW5kZXgpOwogIH07CgogIC8vIEdldCB0aGUgbGFzdCBlbGVtZW50IG9mIGFuIGFycmF5LgogIF8ubGFzdCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICByZXR1cm4gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07CiAgfTsKCiAgLy8gVHJpbSBvdXQgYWxsIGZhbHN5IHZhbHVlcyBmcm9tIGFuIGFycmF5LgogIF8uY29tcGFjdCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICByZXR1cm4gXy5maWx0ZXIoYXJyYXksIGZ1bmN0aW9uKHZhbHVlKXsgcmV0dXJuICEhdmFsdWU7IH0pOwogIH07CgogIC8vIFJldHVybiBhIGNvbXBsZXRlbHkgZmxhdHRlbmVkIHZlcnNpb24gb2YgYW4gYXJyYXkuCiAgXy5mbGF0dGVuID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHJldHVybiBfLnJlZHVjZShhcnJheSwgZnVuY3Rpb24obWVtbywgdmFsdWUpIHsKICAgICAgaWYgKF8uaXNBcnJheSh2YWx1ZSkpIHJldHVybiBtZW1vLmNvbmNhdChfLmZsYXR0ZW4odmFsdWUpKTsKICAgICAgbWVtb1ttZW1vLmxlbmd0aF0gPSB2YWx1ZTsKICAgICAgcmV0dXJuIG1lbW87CiAgICB9LCBbXSk7CiAgfTsKCiAgLy8gUmV0dXJuIGEgdmVyc2lvbiBvZiB0aGUgYXJyYXkgdGhhdCBkb2VzIG5vdCBjb250YWluIHRoZSBzcGVjaWZpZWQgdmFsdWUocykuCiAgXy53aXRob3V0ID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHJldHVybiBfLmRpZmZlcmVuY2UoYXJyYXksIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgfTsKCiAgLy8gUHJvZHVjZSBhIGR1cGxpY2F0ZS1mcmVlIHZlcnNpb24gb2YgdGhlIGFycmF5LiBJZiB0aGUgYXJyYXkgaGFzIGFscmVhZHkKICAvLyBiZWVuIHNvcnRlZCwgeW91IGhhdmUgdGhlIG9wdGlvbiBvZiB1c2luZyBhIGZhc3RlciBhbGdvcml0aG0uCiAgLy8gQWxpYXNlZCBhcyBgdW5pcXVlYC4KICBfLnVuaXEgPSBfLnVuaXF1ZSA9IGZ1bmN0aW9uKGFycmF5LCBpc1NvcnRlZCkgewogICAgcmV0dXJuIF8ucmVkdWNlKGFycmF5LCBmdW5jdGlvbihtZW1vLCBlbCwgaSkgewogICAgICBpZiAoMCA9PSBpIHx8IChpc1NvcnRlZCA9PT0gdHJ1ZSA/IF8ubGFzdChtZW1vKSAhPSBlbCA6ICFfLmluY2x1ZGUobWVtbywgZWwpKSkgbWVtb1ttZW1vLmxlbmd0aF0gPSBlbDsKICAgICAgcmV0dXJuIG1lbW87CiAgICB9LCBbXSk7CiAgfTsKCiAgLy8gUHJvZHVjZSBhbiBhcnJheSB0aGF0IGNvbnRhaW5zIHRoZSB1bmlvbjogZWFjaCBkaXN0aW5jdCBlbGVtZW50IGZyb20gYWxsIG9mCiAgLy8gdGhlIHBhc3NlZC1pbiBhcnJheXMuCiAgXy51bmlvbiA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIF8udW5pcShfLmZsYXR0ZW4oYXJndW1lbnRzKSk7CiAgfTsKCiAgLy8gUHJvZHVjZSBhbiBhcnJheSB0aGF0IGNvbnRhaW5zIGV2ZXJ5IGl0ZW0gc2hhcmVkIGJldHdlZW4gYWxsIHRoZQogIC8vIHBhc3NlZC1pbiBhcnJheXMuIChBbGlhc2VkIGFzICJpbnRlcnNlY3QiIGZvciBiYWNrLWNvbXBhdC4pCiAgXy5pbnRlcnNlY3Rpb24gPSBfLmludGVyc2VjdCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgcmVzdCA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBfLmZpbHRlcihfLnVuaXEoYXJyYXkpLCBmdW5jdGlvbihpdGVtKSB7CiAgICAgIHJldHVybiBfLmV2ZXJ5KHJlc3QsIGZ1bmN0aW9uKG90aGVyKSB7CiAgICAgICAgcmV0dXJuIF8uaW5kZXhPZihvdGhlciwgaXRlbSkgPj0gMDsKICAgICAgfSk7CiAgICB9KTsKICB9OwoKICAvLyBUYWtlIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gb25lIGFycmF5IGFuZCBhbm90aGVyLgogIC8vIE9ubHkgdGhlIGVsZW1lbnRzIHByZXNlbnQgaW4ganVzdCB0aGUgZmlyc3QgYXJyYXkgd2lsbCByZW1haW4uCiAgXy5kaWZmZXJlbmNlID0gZnVuY3Rpb24oYXJyYXksIG90aGVyKSB7CiAgICByZXR1cm4gXy5maWx0ZXIoYXJyYXksIGZ1bmN0aW9uKHZhbHVlKXsgcmV0dXJuICFfLmluY2x1ZGUob3RoZXIsIHZhbHVlKTsgfSk7CiAgfTsKCiAgLy8gWmlwIHRvZ2V0aGVyIG11bHRpcGxlIGxpc3RzIGludG8gYSBzaW5nbGUgYXJyYXkgLS0gZWxlbWVudHMgdGhhdCBzaGFyZQogIC8vIGFuIGluZGV4IGdvIHRvZ2V0aGVyLgogIF8uemlwID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgIHZhciBsZW5ndGggPSBfLm1heChfLnBsdWNrKGFyZ3MsICdsZW5ndGgnKSk7CiAgICB2YXIgcmVzdWx0cyA9IG5ldyBBcnJheShsZW5ndGgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgcmVzdWx0c1tpXSA9IF8ucGx1Y2soYXJncywgIiIgKyBpKTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIElmIHRoZSBicm93c2VyIGRvZXNuJ3Qgc3VwcGx5IHVzIHdpdGggaW5kZXhPZiAoSSdtIGxvb2tpbmcgYXQgeW91LCAqKk1TSUUqKiksCiAgLy8gd2UgbmVlZCB0aGlzIGZ1bmN0aW9uLiBSZXR1cm4gdGhlIHBvc2l0aW9uIG9mIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGFuCiAgLy8gaXRlbSBpbiBhbiBhcnJheSwgb3IgLTEgaWYgdGhlIGl0ZW0gaXMgbm90IGluY2x1ZGVkIGluIHRoZSBhcnJheS4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgaW5kZXhPZmAgaWYgYXZhaWxhYmxlLgogIC8vIElmIHRoZSBhcnJheSBpcyBsYXJnZSBhbmQgYWxyZWFkeSBpbiBzb3J0IG9yZGVyLCBwYXNzIGB0cnVlYAogIC8vIGZvciAqKmlzU29ydGVkKiogdG8gdXNlIGJpbmFyeSBzZWFyY2guCiAgXy5pbmRleE9mID0gZnVuY3Rpb24oYXJyYXksIGl0ZW0sIGlzU29ydGVkKSB7CiAgICBpZiAoYXJyYXkgPT0gbnVsbCkgcmV0dXJuIC0xOwogICAgdmFyIGksIGw7CiAgICBpZiAoaXNTb3J0ZWQpIHsKICAgICAgaSA9IF8uc29ydGVkSW5kZXgoYXJyYXksIGl0ZW0pOwogICAgICByZXR1cm4gYXJyYXlbaV0gPT09IGl0ZW0gPyBpIDogLTE7CiAgICB9CiAgICBpZiAobmF0aXZlSW5kZXhPZiAmJiBhcnJheS5pbmRleE9mID09PSBuYXRpdmVJbmRleE9mKSByZXR1cm4gYXJyYXkuaW5kZXhPZihpdGVtKTsKICAgIGZvciAoaSA9IDAsIGwgPSBhcnJheS5sZW5ndGg7IGkgPCBsOyBpKyspIGlmIChhcnJheVtpXSA9PT0gaXRlbSkgcmV0dXJuIGk7CiAgICByZXR1cm4gLTE7CiAgfTsKCgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBsYXN0SW5kZXhPZmAgaWYgYXZhaWxhYmxlLgogIF8ubGFzdEluZGV4T2YgPSBmdW5jdGlvbihhcnJheSwgaXRlbSkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiAtMTsKICAgIGlmIChuYXRpdmVMYXN0SW5kZXhPZiAmJiBhcnJheS5sYXN0SW5kZXhPZiA9PT0gbmF0aXZlTGFzdEluZGV4T2YpIHJldHVybiBhcnJheS5sYXN0SW5kZXhPZihpdGVtKTsKICAgIHZhciBpID0gYXJyYXkubGVuZ3RoOwogICAgd2hpbGUgKGktLSkgaWYgKGFycmF5W2ldID09PSBpdGVtKSByZXR1cm4gaTsKICAgIHJldHVybiAtMTsKICB9OwoKICAvLyBHZW5lcmF0ZSBhbiBpbnRlZ2VyIEFycmF5IGNvbnRhaW5pbmcgYW4gYXJpdGhtZXRpYyBwcm9ncmVzc2lvbi4gQSBwb3J0IG9mCiAgLy8gdGhlIG5hdGl2ZSBQeXRob24gYHJhbmdlKClgIGZ1bmN0aW9uLiBTZWUKICAvLyBbdGhlIFB5dGhvbiBkb2N1bWVudGF0aW9uXShodHRwOi8vZG9jcy5weXRob24ub3JnL2xpYnJhcnkvZnVuY3Rpb25zLmh0bWwjcmFuZ2UpLgogIF8ucmFuZ2UgPSBmdW5jdGlvbihzdGFydCwgc3RvcCwgc3RlcCkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPD0gMSkgewogICAgICBzdG9wID0gc3RhcnQgfHwgMDsKICAgICAgc3RhcnQgPSAwOwogICAgfQogICAgc3RlcCA9IGFyZ3VtZW50c1syXSB8fCAxOwoKICAgIHZhciBsZW4gPSBNYXRoLm1heChNYXRoLmNlaWwoKHN0b3AgLSBzdGFydCkgLyBzdGVwKSwgMCk7CiAgICB2YXIgaWR4ID0gMDsKICAgIHZhciByYW5nZSA9IG5ldyBBcnJheShsZW4pOwoKICAgIHdoaWxlKGlkeCA8IGxlbikgewogICAgICByYW5nZVtpZHgrK10gPSBzdGFydDsKICAgICAgc3RhcnQgKz0gc3RlcDsKICAgIH0KCiAgICByZXR1cm4gcmFuZ2U7CiAgfTsKCiAgLy8gRnVuY3Rpb24gKGFoZW0pIEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBDcmVhdGUgYSBmdW5jdGlvbiBib3VuZCB0byBhIGdpdmVuIG9iamVjdCAoYXNzaWduaW5nIGB0aGlzYCwgYW5kIGFyZ3VtZW50cywKICAvLyBvcHRpb25hbGx5KS4gQmluZGluZyB3aXRoIGFyZ3VtZW50cyBpcyBhbHNvIGtub3duIGFzIGBjdXJyeWAuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYEZ1bmN0aW9uLmJpbmRgIGlmIGF2YWlsYWJsZS4KICAvLyBXZSBjaGVjayBmb3IgYGZ1bmMuYmluZGAgZmlyc3QsIHRvIGZhaWwgZmFzdCB3aGVuIGBmdW5jYCBpcyB1bmRlZmluZWQuCiAgXy5iaW5kID0gZnVuY3Rpb24oZnVuYywgb2JqKSB7CiAgICBpZiAoZnVuYy5iaW5kID09PSBuYXRpdmVCaW5kICYmIG5hdGl2ZUJpbmQpIHJldHVybiBuYXRpdmVCaW5kLmFwcGx5KGZ1bmMsIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkob2JqLCBhcmdzLmNvbmNhdChzbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgIH07CiAgfTsKCiAgLy8gQmluZCBhbGwgb2YgYW4gb2JqZWN0J3MgbWV0aG9kcyB0byB0aGF0IG9iamVjdC4gVXNlZnVsIGZvciBlbnN1cmluZyB0aGF0CiAgLy8gYWxsIGNhbGxiYWNrcyBkZWZpbmVkIG9uIGFuIG9iamVjdCBiZWxvbmcgdG8gaXQuCiAgXy5iaW5kQWxsID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgZnVuY3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICBpZiAoZnVuY3MubGVuZ3RoID09IDApIGZ1bmNzID0gXy5mdW5jdGlvbnMob2JqKTsKICAgIGVhY2goZnVuY3MsIGZ1bmN0aW9uKGYpIHsgb2JqW2ZdID0gXy5iaW5kKG9ialtmXSwgb2JqKTsgfSk7CiAgICByZXR1cm4gb2JqOwogIH07CgogIC8vIE1lbW9pemUgYW4gZXhwZW5zaXZlIGZ1bmN0aW9uIGJ5IHN0b3JpbmcgaXRzIHJlc3VsdHMuCiAgXy5tZW1vaXplID0gZnVuY3Rpb24oZnVuYywgaGFzaGVyKSB7CiAgICB2YXIgbWVtbyA9IHt9OwogICAgaGFzaGVyIHx8IChoYXNoZXIgPSBfLmlkZW50aXR5KTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGtleSA9IGhhc2hlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChtZW1vLCBrZXkpID8gbWVtb1trZXldIDogKG1lbW9ba2V5XSA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICB9OwogIH07CgogIC8vIERlbGF5cyBhIGZ1bmN0aW9uIGZvciB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcywgYW5kIHRoZW4gY2FsbHMKICAvLyBpdCB3aXRoIHRoZSBhcmd1bWVudHMgc3VwcGxpZWQuCiAgXy5kZWxheSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgcmV0dXJuIGZ1bmMuYXBwbHkoZnVuYywgYXJncyk7IH0sIHdhaXQpOwogIH07CgogIC8vIERlZmVycyBhIGZ1bmN0aW9uLCBzY2hlZHVsaW5nIGl0IHRvIHJ1biBhZnRlciB0aGUgY3VycmVudCBjYWxsIHN0YWNrIGhhcwogIC8vIGNsZWFyZWQuCiAgXy5kZWZlciA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIHJldHVybiBfLmRlbGF5LmFwcGx5KF8sIFtmdW5jLCAxXS5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKSk7CiAgfTsKCiAgLy8gSW50ZXJuYWwgZnVuY3Rpb24gdXNlZCB0byBpbXBsZW1lbnQgYF8udGhyb3R0bGVgIGFuZCBgXy5kZWJvdW5jZWAuCiAgdmFyIGxpbWl0ID0gZnVuY3Rpb24oZnVuYywgd2FpdCwgZGVib3VuY2UpIHsKICAgIHZhciB0aW1lb3V0OwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY29udGV4dCA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgIHZhciB0aHJvdHRsZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICB9OwogICAgICBpZiAoZGVib3VuY2UpIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgaWYgKGRlYm91bmNlIHx8ICF0aW1lb3V0KSB0aW1lb3V0ID0gc2V0VGltZW91dCh0aHJvdHRsZXIsIHdhaXQpOwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIHdoZW4gaW52b2tlZCwgd2lsbCBvbmx5IGJlIHRyaWdnZXJlZCBhdCBtb3N0IG9uY2UKICAvLyBkdXJpbmcgYSBnaXZlbiB3aW5kb3cgb2YgdGltZS4KICBfLnRocm90dGxlID0gZnVuY3Rpb24oZnVuYywgd2FpdCkgewogICAgcmV0dXJuIGxpbWl0KGZ1bmMsIHdhaXQsIGZhbHNlKTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIGFzIGxvbmcgYXMgaXQgY29udGludWVzIHRvIGJlIGludm9rZWQsIHdpbGwgbm90CiAgLy8gYmUgdHJpZ2dlcmVkLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgaXQgc3RvcHMgYmVpbmcgY2FsbGVkIGZvcgogIC8vIE4gbWlsbGlzZWNvbmRzLgogIF8uZGVib3VuY2UgPSBmdW5jdGlvbihmdW5jLCB3YWl0KSB7CiAgICByZXR1cm4gbGltaXQoZnVuYywgd2FpdCwgdHJ1ZSk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBhdCBtb3N0IG9uZSB0aW1lLCBubyBtYXR0ZXIgaG93CiAgLy8gb2Z0ZW4geW91IGNhbGwgaXQuIFVzZWZ1bCBmb3IgbGF6eSBpbml0aWFsaXphdGlvbi4KICBfLm9uY2UgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB2YXIgcmFuID0gZmFsc2UsIG1lbW87CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChyYW4pIHJldHVybiBtZW1vOwogICAgICByYW4gPSB0cnVlOwogICAgICByZXR1cm4gbWVtbyA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyB0aGUgZmlyc3QgZnVuY3Rpb24gcGFzc2VkIGFzIGFuIGFyZ3VtZW50IHRvIHRoZSBzZWNvbmQsCiAgLy8gYWxsb3dpbmcgeW91IHRvIGFkanVzdCBhcmd1bWVudHMsIHJ1biBjb2RlIGJlZm9yZSBhbmQgYWZ0ZXIsIGFuZAogIC8vIGNvbmRpdGlvbmFsbHkgZXhlY3V0ZSB0aGUgb3JpZ2luYWwgZnVuY3Rpb24uCiAgXy53cmFwID0gZnVuY3Rpb24oZnVuYywgd3JhcHBlcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IFtmdW5jXS5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKTsKICAgICAgcmV0dXJuIHdyYXBwZXIuYXBwbHkodGhpcywgYXJncyk7CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IGlzIHRoZSBjb21wb3NpdGlvbiBvZiBhIGxpc3Qgb2YgZnVuY3Rpb25zLCBlYWNoCiAgLy8gY29uc3VtaW5nIHRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIGZ1bmN0aW9uIHRoYXQgZm9sbG93cy4KICBfLmNvbXBvc2UgPSBmdW5jdGlvbigpIHsKICAgIHZhciBmdW5jcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIGZvciAodmFyIGkgPSBmdW5jcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIGFyZ3MgPSBbZnVuY3NbaV0uYXBwbHkodGhpcywgYXJncyldOwogICAgICB9CiAgICAgIHJldHVybiBhcmdzWzBdOwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB3aWxsIG9ubHkgYmUgZXhlY3V0ZWQgYWZ0ZXIgYmVpbmcgY2FsbGVkIE4gdGltZXMuCiAgXy5hZnRlciA9IGZ1bmN0aW9uKHRpbWVzLCBmdW5jKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGlmICgtLXRpbWVzIDwgMSkgeyByZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9CiAgICB9OwogIH07CgoKICAvLyBPYmplY3QgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSZXRyaWV2ZSB0aGUgbmFtZXMgb2YgYW4gb2JqZWN0J3MgcHJvcGVydGllcy4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgT2JqZWN0LmtleXNgCiAgXy5rZXlzID0gbmF0aXZlS2V5cyB8fCBmdW5jdGlvbihvYmopIHsKICAgIGlmIChvYmogIT09IE9iamVjdChvYmopKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIG9iamVjdCcpOwogICAgdmFyIGtleXMgPSBbXTsKICAgIGZvciAodmFyIGtleSBpbiBvYmopIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkga2V5c1trZXlzLmxlbmd0aF0gPSBrZXk7CiAgICByZXR1cm4ga2V5czsKICB9OwoKICAvLyBSZXRyaWV2ZSB0aGUgdmFsdWVzIG9mIGFuIG9iamVjdCdzIHByb3BlcnRpZXMuCiAgXy52YWx1ZXMgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBfLm1hcChvYmosIF8uaWRlbnRpdHkpOwogIH07CgogIC8vIFJldHVybiBhIHNvcnRlZCBsaXN0IG9mIHRoZSBmdW5jdGlvbiBuYW1lcyBhdmFpbGFibGUgb24gdGhlIG9iamVjdC4KICAvLyBBbGlhc2VkIGFzIGBtZXRob2RzYAogIF8uZnVuY3Rpb25zID0gXy5tZXRob2RzID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgbmFtZXMgPSBbXTsKICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgaWYgKF8uaXNGdW5jdGlvbihvYmpba2V5XSkpIG5hbWVzLnB1c2goa2V5KTsKICAgIH0KICAgIHJldHVybiBuYW1lcy5zb3J0KCk7CiAgfTsKCiAgLy8gRXh0ZW5kIGEgZ2l2ZW4gb2JqZWN0IHdpdGggYWxsIHRoZSBwcm9wZXJ0aWVzIGluIHBhc3NlZC1pbiBvYmplY3QocykuCiAgXy5leHRlbmQgPSBmdW5jdGlvbihvYmopIHsKICAgIGVhY2goc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLCBmdW5jdGlvbihzb3VyY2UpIHsKICAgICAgZm9yICh2YXIgcHJvcCBpbiBzb3VyY2UpIHsKICAgICAgICBpZiAoc291cmNlW3Byb3BdICE9PSB2b2lkIDApIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gb2JqOwogIH07CgogIC8vIEZpbGwgaW4gYSBnaXZlbiBvYmplY3Qgd2l0aCBkZWZhdWx0IHByb3BlcnRpZXMuCiAgXy5kZWZhdWx0cyA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewogICAgICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkgewogICAgICAgIGlmIChvYmpbcHJvcF0gPT0gbnVsbCkgb2JqW3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gQ3JlYXRlIGEgKHNoYWxsb3ctY2xvbmVkKSBkdXBsaWNhdGUgb2YgYW4gb2JqZWN0LgogIF8uY2xvbmUgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBfLmlzQXJyYXkob2JqKSA/IG9iai5zbGljZSgpIDogXy5leHRlbmQoe30sIG9iaik7CiAgfTsKCiAgLy8gSW52b2tlcyBpbnRlcmNlcHRvciB3aXRoIHRoZSBvYmosIGFuZCB0aGVuIHJldHVybnMgb2JqLgogIC8vIFRoZSBwcmltYXJ5IHB1cnBvc2Ugb2YgdGhpcyBtZXRob2QgaXMgdG8gInRhcCBpbnRvIiBhIG1ldGhvZCBjaGFpbiwgaW4KICAvLyBvcmRlciB0byBwZXJmb3JtIG9wZXJhdGlvbnMgb24gaW50ZXJtZWRpYXRlIHJlc3VsdHMgd2l0aGluIHRoZSBjaGFpbi4KICBfLnRhcCA9IGZ1bmN0aW9uKG9iaiwgaW50ZXJjZXB0b3IpIHsKICAgIGludGVyY2VwdG9yKG9iaik7CiAgICByZXR1cm4gb2JqOwogIH07CgogIC8vIFBlcmZvcm0gYSBkZWVwIGNvbXBhcmlzb24gdG8gY2hlY2sgaWYgdHdvIG9iamVjdHMgYXJlIGVxdWFsLgogIF8uaXNFcXVhbCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIC8vIENoZWNrIG9iamVjdCBpZGVudGl0eS4KICAgIGlmIChhID09PSBiKSByZXR1cm4gdHJ1ZTsKICAgIC8vIERpZmZlcmVudCB0eXBlcz8KICAgIHZhciBhdHlwZSA9IHR5cGVvZihhKSwgYnR5cGUgPSB0eXBlb2YoYik7CiAgICBpZiAoYXR5cGUgIT0gYnR5cGUpIHJldHVybiBmYWxzZTsKICAgIC8vIEJhc2ljIGVxdWFsaXR5IHRlc3QgKHdhdGNoIG91dCBmb3IgY29lcmNpb25zKS4KICAgIGlmIChhID09IGIpIHJldHVybiB0cnVlOwogICAgLy8gT25lIGlzIGZhbHN5IGFuZCB0aGUgb3RoZXIgdHJ1dGh5LgogICAgaWYgKCghYSAmJiBiKSB8fCAoYSAmJiAhYikpIHJldHVybiBmYWxzZTsKICAgIC8vIFVud3JhcCBhbnkgd3JhcHBlZCBvYmplY3RzLgogICAgaWYgKGEuX2NoYWluKSBhID0gYS5fd3JhcHBlZDsKICAgIGlmIChiLl9jaGFpbikgYiA9IGIuX3dyYXBwZWQ7CiAgICAvLyBPbmUgb2YgdGhlbSBpbXBsZW1lbnRzIGFuIGlzRXF1YWwoKT8KICAgIGlmIChhLmlzRXF1YWwpIHJldHVybiBhLmlzRXF1YWwoYik7CiAgICBpZiAoYi5pc0VxdWFsKSByZXR1cm4gYi5pc0VxdWFsKGEpOwogICAgLy8gQ2hlY2sgZGF0ZXMnIGludGVnZXIgdmFsdWVzLgogICAgaWYgKF8uaXNEYXRlKGEpICYmIF8uaXNEYXRlKGIpKSByZXR1cm4gYS5nZXRUaW1lKCkgPT09IGIuZ2V0VGltZSgpOwogICAgLy8gQm90aCBhcmUgTmFOPwogICAgaWYgKF8uaXNOYU4oYSkgJiYgXy5pc05hTihiKSkgcmV0dXJuIGZhbHNlOwogICAgLy8gQ29tcGFyZSByZWd1bGFyIGV4cHJlc3Npb25zLgogICAgaWYgKF8uaXNSZWdFeHAoYSkgJiYgXy5pc1JlZ0V4cChiKSkKICAgICAgcmV0dXJuIGEuc291cmNlICAgICA9PT0gYi5zb3VyY2UgJiYKICAgICAgICAgICAgIGEuZ2xvYmFsICAgICA9PT0gYi5nbG9iYWwgJiYKICAgICAgICAgICAgIGEuaWdub3JlQ2FzZSA9PT0gYi5pZ25vcmVDYXNlICYmCiAgICAgICAgICAgICBhLm11bHRpbGluZSAgPT09IGIubXVsdGlsaW5lOwogICAgLy8gSWYgYSBpcyBub3QgYW4gb2JqZWN0IGJ5IHRoaXMgcG9pbnQsIHdlIGNhbid0IGhhbmRsZSBpdC4KICAgIGlmIChhdHlwZSAhPT0gJ29iamVjdCcpIHJldHVybiBmYWxzZTsKICAgIC8vIENoZWNrIGZvciBkaWZmZXJlbnQgYXJyYXkgbGVuZ3RocyBiZWZvcmUgY29tcGFyaW5nIGNvbnRlbnRzLgogICAgaWYgKGEubGVuZ3RoICYmIChhLmxlbmd0aCAhPT0gYi5sZW5ndGgpKSByZXR1cm4gZmFsc2U7CiAgICAvLyBOb3RoaW5nIGVsc2Ugd29ya2VkLCBkZWVwIGNvbXBhcmUgdGhlIGNvbnRlbnRzLgogICAgdmFyIGFLZXlzID0gXy5rZXlzKGEpLCBiS2V5cyA9IF8ua2V5cyhiKTsKICAgIC8vIERpZmZlcmVudCBvYmplY3Qgc2l6ZXM/CiAgICBpZiAoYUtleXMubGVuZ3RoICE9IGJLZXlzLmxlbmd0aCkgcmV0dXJuIGZhbHNlOwogICAgLy8gUmVjdXJzaXZlIGNvbXBhcmlzb24gb2YgY29udGVudHMuCiAgICBmb3IgKHZhciBrZXkgaW4gYSkgaWYgKCEoa2V5IGluIGIpIHx8ICFfLmlzRXF1YWwoYVtrZXldLCBiW2tleV0pKSByZXR1cm4gZmFsc2U7CiAgICByZXR1cm4gdHJ1ZTsKICB9OwoKICAvLyBJcyBhIGdpdmVuIGFycmF5IG9yIG9iamVjdCBlbXB0eT8KICBfLmlzRW1wdHkgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmIChfLmlzQXJyYXkob2JqKSB8fCBfLmlzU3RyaW5nKG9iaikpIHJldHVybiBvYmoubGVuZ3RoID09PSAwOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKGhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSByZXR1cm4gZmFsc2U7CiAgICByZXR1cm4gdHJ1ZTsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgRE9NIGVsZW1lbnQ/CiAgXy5pc0VsZW1lbnQgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiAhIShvYmogJiYgb2JqLm5vZGVUeXBlID09IDEpOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYW4gYXJyYXk/CiAgLy8gRGVsZWdhdGVzIHRvIEVDTUE1J3MgbmF0aXZlIEFycmF5LmlzQXJyYXkKICBfLmlzQXJyYXkgPSBuYXRpdmVJc0FycmF5IHx8IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJzsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhcmlhYmxlIGFuIG9iamVjdD8KICBfLmlzT2JqZWN0ID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gb2JqID09PSBPYmplY3Qob2JqKTsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhcmlhYmxlIGFuIGFyZ3VtZW50cyBvYmplY3Q/CiAgXy5pc0FyZ3VtZW50cyA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuICEhKG9iaiAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgJ2NhbGxlZScpKTsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgZnVuY3Rpb24/CiAgXy5pc0Z1bmN0aW9uID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gISEob2JqICYmIG9iai5jb25zdHJ1Y3RvciAmJiBvYmouY2FsbCAmJiBvYmouYXBwbHkpOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYSBzdHJpbmc/CiAgXy5pc1N0cmluZyA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuICEhKG9iaiA9PT0gJycgfHwgKG9iaiAmJiBvYmouY2hhckNvZGVBdCAmJiBvYmouc3Vic3RyKSk7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIG51bWJlcj8KICBfLmlzTnVtYmVyID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gISEob2JqID09PSAwIHx8IChvYmogJiYgb2JqLnRvRXhwb25lbnRpYWwgJiYgb2JqLnRvRml4ZWQpKTsKICB9OwoKICAvLyBJcyB0aGUgZ2l2ZW4gdmFsdWUgYE5hTmA/IGBOYU5gIGhhcHBlbnMgdG8gYmUgdGhlIG9ubHkgdmFsdWUgaW4gSmF2YVNjcmlwdAogIC8vIHRoYXQgZG9lcyBub3QgZXF1YWwgaXRzZWxmLgogIF8uaXNOYU4gPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogIT09IG9iajsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgYm9vbGVhbj8KICBfLmlzQm9vbGVhbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gdHJ1ZSB8fCBvYmogPT09IGZhbHNlOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYSBkYXRlPwogIF8uaXNEYXRlID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gISEob2JqICYmIG9iai5nZXRUaW1lem9uZU9mZnNldCAmJiBvYmouc2V0VVRDRnVsbFllYXIpOwogIH07CgogIC8vIElzIHRoZSBnaXZlbiB2YWx1ZSBhIHJlZ3VsYXIgZXhwcmVzc2lvbj8KICBfLmlzUmVnRXhwID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gISEob2JqICYmIG9iai50ZXN0ICYmIG9iai5leGVjICYmIChvYmouaWdub3JlQ2FzZSB8fCBvYmouaWdub3JlQ2FzZSA9PT0gZmFsc2UpKTsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGVxdWFsIHRvIG51bGw/CiAgXy5pc051bGwgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IG51bGw7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YXJpYWJsZSB1bmRlZmluZWQ/CiAgXy5pc1VuZGVmaW5lZCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gdm9pZCAwOwogIH07CgogIC8vIFV0aWxpdHkgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gUnVuIFVuZGVyc2NvcmUuanMgaW4gKm5vQ29uZmxpY3QqIG1vZGUsIHJldHVybmluZyB0aGUgYF9gIHZhcmlhYmxlIHRvIGl0cwogIC8vIHByZXZpb3VzIG93bmVyLiBSZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBVbmRlcnNjb3JlIG9iamVjdC4KICBfLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHsKICAgIHJvb3QuXyA9IHByZXZpb3VzVW5kZXJzY29yZTsKICAgIHJldHVybiB0aGlzOwogIH07CgogIC8vIEtlZXAgdGhlIGlkZW50aXR5IGZ1bmN0aW9uIGFyb3VuZCBmb3IgZGVmYXVsdCBpdGVyYXRvcnMuCiAgXy5pZGVudGl0eSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICByZXR1cm4gdmFsdWU7CiAgfTsKCiAgLy8gUnVuIGEgZnVuY3Rpb24gKipuKiogdGltZXMuCiAgXy50aW1lcyA9IGZ1bmN0aW9uIChuLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgaSk7CiAgfTsKCiAgLy8gQWRkIHlvdXIgb3duIGN1c3RvbSBmdW5jdGlvbnMgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LCBlbnN1cmluZyB0aGF0CiAgLy8gdGhleSdyZSBjb3JyZWN0bHkgYWRkZWQgdG8gdGhlIE9PUCB3cmFwcGVyIGFzIHdlbGwuCiAgXy5taXhpbiA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChfLmZ1bmN0aW9ucyhvYmopLCBmdW5jdGlvbihuYW1lKXsKICAgICAgYWRkVG9XcmFwcGVyKG5hbWUsIF9bbmFtZV0gPSBvYmpbbmFtZV0pOwogICAgfSk7CiAgfTsKCiAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgaW50ZWdlciBpZCAodW5pcXVlIHdpdGhpbiB0aGUgZW50aXJlIGNsaWVudCBzZXNzaW9uKS4KICAvLyBVc2VmdWwgZm9yIHRlbXBvcmFyeSBET00gaWRzLgogIHZhciBpZENvdW50ZXIgPSAwOwogIF8udW5pcXVlSWQgPSBmdW5jdGlvbihwcmVmaXgpIHsKICAgIHZhciBpZCA9IGlkQ291bnRlcisrOwogICAgcmV0dXJuIHByZWZpeCA/IHByZWZpeCArIGlkIDogaWQ7CiAgfTsKCiAgLy8gQnkgZGVmYXVsdCwgVW5kZXJzY29yZSB1c2VzIEVSQi1zdHlsZSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzLCBjaGFuZ2UgdGhlCiAgLy8gZm9sbG93aW5nIHRlbXBsYXRlIHNldHRpbmdzIHRvIHVzZSBhbHRlcm5hdGl2ZSBkZWxpbWl0ZXJzLgogIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgIGV2YWx1YXRlICAgIDogLzwlKFtcc1xTXSs/KSU+L2csCiAgICBpbnRlcnBvbGF0ZSA6IC88JT0oW1xzXFNdKz8pJT4vZwogIH07CgogIC8vIEphdmFTY3JpcHQgbWljcm8tdGVtcGxhdGluZywgc2ltaWxhciB0byBKb2huIFJlc2lnJ3MgaW1wbGVtZW50YXRpb24uCiAgLy8gVW5kZXJzY29yZSB0ZW1wbGF0aW5nIGhhbmRsZXMgYXJiaXRyYXJ5IGRlbGltaXRlcnMsIHByZXNlcnZlcyB3aGl0ZXNwYWNlLAogIC8vIGFuZCBjb3JyZWN0bHkgZXNjYXBlcyBxdW90ZXMgd2l0aGluIGludGVycG9sYXRlZCBjb2RlLgogIF8udGVtcGxhdGUgPSBmdW5jdGlvbihzdHIsIGRhdGEpIHsKICAgIHZhciBjICA9IF8udGVtcGxhdGVTZXR0aW5nczsKICAgIHZhciB0bXBsID0gJ3ZhciBfX3A9W10scHJpbnQ9ZnVuY3Rpb24oKXtfX3AucHVzaC5hcHBseShfX3AsYXJndW1lbnRzKTt9OycgKwogICAgICAnd2l0aChvYmp8fHt9KXtfX3AucHVzaChcJycgKwogICAgICBzdHIucmVwbGFjZSgvXFwvZywgJ1xcXFwnKQogICAgICAgICAucmVwbGFjZSgvJy9nLCAiXFwnIikKICAgICAgICAgLnJlcGxhY2UoYy5pbnRlcnBvbGF0ZSwgZnVuY3Rpb24obWF0Y2gsIGNvZGUpIHsKICAgICAgICAgICByZXR1cm4gIicsIiArIGNvZGUucmVwbGFjZSgvXFwnL2csICInIikgKyAiLCciOwogICAgICAgICB9KQogICAgICAgICAucmVwbGFjZShjLmV2YWx1YXRlIHx8IG51bGwsIGZ1bmN0aW9uKG1hdGNoLCBjb2RlKSB7CiAgICAgICAgICAgcmV0dXJuICInKTsiICsgY29kZS5yZXBsYWNlKC9cXCcvZywgIiciKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1xyXG5cdF0vZywgJyAnKSArICJfX3AucHVzaCgnIjsKICAgICAgICAgfSkKICAgICAgICAgLnJlcGxhY2UoL1xyL2csICdcXHInKQogICAgICAgICAucmVwbGFjZSgvXG4vZywgJ1xcbicpCiAgICAgICAgIC5yZXBsYWNlKC9cdC9nLCAnXFx0JykKICAgICAgICAgKyAiJyk7fXJldHVybiBfX3Auam9pbignJyk7IjsKICAgIHZhciBmdW5jID0gbmV3IEZ1bmN0aW9uKCdvYmonLCB0bXBsKTsKICAgIHJldHVybiBkYXRhID8gZnVuYyhkYXRhKSA6IGZ1bmM7CiAgfTsKCiAgLy8gVGhlIE9PUCBXcmFwcGVyCiAgLy8gLS0tLS0tLS0tLS0tLS0tCgogIC8vIElmIFVuZGVyc2NvcmUgaXMgY2FsbGVkIGFzIGEgZnVuY3Rpb24sIGl0IHJldHVybnMgYSB3cmFwcGVkIG9iamVjdCB0aGF0CiAgLy8gY2FuIGJlIHVzZWQgT08tc3R5bGUuIFRoaXMgd3JhcHBlciBob2xkcyBhbHRlcmVkIHZlcnNpb25zIG9mIGFsbCB0aGUKICAvLyB1bmRlcnNjb3JlIGZ1bmN0aW9ucy4gV3JhcHBlZCBvYmplY3RzIG1heSBiZSBjaGFpbmVkLgogIHZhciB3cmFwcGVyID0gZnVuY3Rpb24ob2JqKSB7IHRoaXMuX3dyYXBwZWQgPSBvYmo7IH07CgogIC8vIEV4cG9zZSBgd3JhcHBlci5wcm90b3R5cGVgIGFzIGBfLnByb3RvdHlwZWAKICBfLnByb3RvdHlwZSA9IHdyYXBwZXIucHJvdG90eXBlOwoKICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gY29udGludWUgY2hhaW5pbmcgaW50ZXJtZWRpYXRlIHJlc3VsdHMuCiAgdmFyIHJlc3VsdCA9IGZ1bmN0aW9uKG9iaiwgY2hhaW4pIHsKICAgIHJldHVybiBjaGFpbiA/IF8ob2JqKS5jaGFpbigpIDogb2JqOwogIH07CgogIC8vIEEgbWV0aG9kIHRvIGVhc2lseSBhZGQgZnVuY3Rpb25zIHRvIHRoZSBPT1Agd3JhcHBlci4KICB2YXIgYWRkVG9XcmFwcGVyID0gZnVuY3Rpb24obmFtZSwgZnVuYykgewogICAgd3JhcHBlci5wcm90b3R5cGVbbmFtZV0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIHVuc2hpZnQuY2FsbChhcmdzLCB0aGlzLl93cmFwcGVkKTsKICAgICAgcmV0dXJuIHJlc3VsdChmdW5jLmFwcGx5KF8sIGFyZ3MpLCB0aGlzLl9jaGFpbik7CiAgICB9OwogIH07CgogIC8vIEFkZCBhbGwgb2YgdGhlIFVuZGVyc2NvcmUgZnVuY3Rpb25zIHRvIHRoZSB3cmFwcGVyIG9iamVjdC4KICBfLm1peGluKF8pOwoKICAvLyBBZGQgYWxsIG11dGF0b3IgQXJyYXkgZnVuY3Rpb25zIHRvIHRoZSB3cmFwcGVyLgogIGVhY2goWydwb3AnLCAncHVzaCcsICdyZXZlcnNlJywgJ3NoaWZ0JywgJ3NvcnQnLCAnc3BsaWNlJywgJ3Vuc2hpZnQnXSwgZnVuY3Rpb24obmFtZSkgewogICAgdmFyIG1ldGhvZCA9IEFycmF5UHJvdG9bbmFtZV07CiAgICB3cmFwcGVyLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICBtZXRob2QuYXBwbHkodGhpcy5fd3JhcHBlZCwgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIHJlc3VsdCh0aGlzLl93cmFwcGVkLCB0aGlzLl9jaGFpbik7CiAgICB9OwogIH0pOwoKICAvLyBBZGQgYWxsIGFjY2Vzc29yIEFycmF5IGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlci4KICBlYWNoKFsnY29uY2F0JywgJ2pvaW4nLCAnc2xpY2UnXSwgZnVuY3Rpb24obmFtZSkgewogICAgdmFyIG1ldGhvZCA9IEFycmF5UHJvdG9bbmFtZV07CiAgICB3cmFwcGVyLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gcmVzdWx0KG1ldGhvZC5hcHBseSh0aGlzLl93cmFwcGVkLCBhcmd1bWVudHMpLCB0aGlzLl9jaGFpbik7CiAgICB9OwogIH0pOwoKICAvLyBTdGFydCBjaGFpbmluZyBhIHdyYXBwZWQgVW5kZXJzY29yZSBvYmplY3QuCiAgd3JhcHBlci5wcm90b3R5cGUuY2hhaW4gPSBmdW5jdGlvbigpIHsKICAgIHRoaXMuX2NoYWluID0gdHJ1ZTsKICAgIHJldHVybiB0aGlzOwogIH07CgogIC8vIEV4dHJhY3RzIHRoZSByZXN1bHQgZnJvbSBhIHdyYXBwZWQgYW5kIGNoYWluZWQgb2JqZWN0LgogIHdyYXBwZXIucHJvdG90eXBlLnZhbHVlID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5fd3JhcHBlZDsKICB9OwoKfSkoKTsKCn0pfTsKCi8qKioqKioqKioqIGxpYi91cGRhdGVzICoqKioqKioqKiovCgprYW5zby5tb2R1bGVDYWNoZVsibGliL3VwZGF0ZXMiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLyoqCiAqIFVwZGF0ZSBmdW5jdGlvbnMgdG8gYmUgZXhwb3J0ZWQgZnJvbSB0aGUgZGVzaWduIGRvYy4KICovCgp2YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyksCiAgICBfID0gcmVxdWlyZSgnLi91bmRlcnNjb3JlJykuXzsgIC8vbmIgTk9UIHRoZSB2ZXJzaW9uIHNoaXBwZWQgd2l0aCBrYW5zbyAwLjAuNyAtLSB0aGF0IGxhY2tzIF8udW5pb24KCgoKLyoqCiAqIFRoaXMgd2lsbCBvbmx5IGFjY2VwdCBqc29uIGRhdGEgKG5vIHN1Ym1pc3Npb24pCiAqICB0byByZW1vdmUga2Fuc28gd3JhcHBpbmcgYXJvdW5kIGl0LCBtb2RpZnkgdGhlIF9kZXNpZ24gZW50cnkgdG86IHsKICAgInNvdXJjZSI6ICJmdW5jdGlvbihkb2MsIHJlcSl7dmFyIGZuID0gcmVxdWlyZShcImxpYi9hcHBcIilbXCJ1cGRhdGVzXCJdW1wic291cmNlXCJdO3JldHVybiBmbihkb2MscmVxKTt9Igp9CiAqLwpleHBvcnRzLnNvdXJjZSA9IGZ1bmN0aW9uIChkb2MsIHJlcSkgewoKICAgIHZhciBtYWtlX2Vycm9yID0gZnVuY3Rpb24obXNnKSB7CiAgICAgICAgdmFyIGZvcm1fc3RyOwogICAgICAgIGZvciggdmFyIGkgaW4gcmVxLmZvcm0gKSB7IGZvcm1fc3RyKz1pKycgOiAnKyByZXEuZm9ybVtpXSsgJ1xuJzsgfTsKICAgICAgICByZXR1cm4gW251bGwsIHsKICAgICAgICAgICAgY29kZTogNDAwLCAgLy9kb2Vzbid0IGN1cnJlbnRseSB3b3JrLCBzZWUgaHR0cHM6Ly9pc3N1ZXMuYXBhY2hlLm9yZy9qaXJhL2Jyb3dzZS9DT1VDSERCLTY0OAogICAgICAgICAgICBoZWFkZXJzOiB7IkNvbnRlbnQtVHlwZSIgOiAiYXBwbGljYXRpb24vanNvbiJ9LCAvL2RvZXNuJ3QgY3VycmVudGx5IHdvcmsKICAgICAgICAgICAgYm9keTogJ3siZXJyb3IiOiInK21zZysnIiwicmVxX2Zvcm0iOiInK2Zvcm1fc3RyKyciLCJyZXFfYm9keSI6IicrcmVxLmJvZHkrJyJ9JwogICAgICAgIH1dOwogICAgfTsKICAgIAogICAgaWYoICFkb2MgKSB7CiAgICAgICAgLy9jcmVhdGUgbmV3IHNvdXJjZQogICAgICAgIC8vdmFyIGRhdGEgPSByZXEuZm9ybTsKICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UocmVxLmJvZHkpOwogICAgICAgIAogICAgICAgIGlmKCAhZGF0YS5faWQgKSB7CiAgICAgICAgICAgIHJldHVybiBtYWtlX2Vycm9yKCdlcnJvcjogbm8gZG9jX2lkIHN1cHBsaWVkIGluIHN1Ym1pdHRlZCBkYXRhJyk7CiAgICAgICAgfQogICAgICAgIGlmICggIWRhdGEudHlwZSB8fCAhZGF0YS50eXBlID09ICdzb3VyY2UnICkgewogICAgICAgICAgICByZXR1cm4gbWFrZV9lcnJvcignZXJyb3I6IHR5cGUgbWlzc2luZyBvciBub3Qgc2V0IHRvIHNvdXJjZS4nKTsKICAgICAgICB9CiAgICAgICAgdmFyIG5ld19zb3VyY2UgPSBfLmV4dGVuZCh7fSwgZGF0YSwgewogICAgICAgICAgICBfaWQgOiBkYXRhLl9pZCwKICAgICAgICAgICAgY3JlYXRlZCA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLAogICAgICAgICAgICB1cGRhdGVkIDogbmV3IERhdGUoKS5nZXRUaW1lKCkKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gW25ld19zb3VyY2UsICdjcmVhdGVkJ107CiAgICB9IGVsc2UgewogICAgICAgIGFkZGl0aW9ucyA9IEpTT04ucGFyc2UocmVxLmJvZHkpOwogICAgICAgIC8vLS0gYXBwZW5kIHRhZ3MgCiAgICAgICAgdmFyIG5ld190YWdzID0gXy51bmlvbihkb2MudGFnc3x8W10sIGFkZGl0aW9ucy50YWdzfHxbXSk7CiAgICAgICAgZG9jID0gXy5leHRlbmQoZG9jLCBhZGRpdGlvbnMsIHt0YWdzOm5ld190YWdzfSk7CiAgICAgICAgCiAgICAgICAgZG9jLnVwZGF0ZWQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICByZXR1cm4gW2RvYywgICd1cGRhdGVkJwogICAgICAgICAgLyp7CiAgICAgICAgICAgIGNvZGU6IDIwMCwgIC8vZG9lc24ndCBjdXJyZW50bHkgd29yaywgc2VlIGh0dHBzOi8vaXNzdWVzLmFwYWNoZS5vcmcvamlyYS9icm93c2UvQ09VQ0hEQi02NDgKICAgICAgICAgICAgLy9oZWFkZXJzOiB7IkNvbnRlbnQtVHlwZSIgOiAiYXBwbGljYXRpb24vanNvbiJ9LCAvL2RvZXNuJ3Qgc2VlbSB0byB3b3JrIGVpdGhlcgogICAgICAgICAgICBoZWFkZXJzOiB7IkNvbnRlbnQtVHlwZSIgOiAndGV4dC9odG1sJ30sICAgICAgICAvL3RoaXMgaXMgd2hhdCB5b3UgZ2V0IAogICAgICAgICAgICBib2R5OiAndXBkYXRlZCcKICAgICAgICAgIH0qLwogICAgICAgIF07CiAgICB9Cn07CgoKCgp9KX07CgovKioqKioqKioqKiBsaWIvdXRpbHMgKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJsaWIvdXRpbHMiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLyoqCiAqIHV0aWxpdGllcyBmb3IgbnJhbWEKICoKICogQ29weXJpZ2h0IChjKSAyMDExIFN0ZXBoZW4gQS4gQnV0dGVyZmlsbCwgaHR0cDovL25vdGUtby1yYW1hLmNvbQogKiAKICovCgogCgp9KX07CgovKioqKioqKioqKiBsaWIvdXVpZCAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImxpYi91dWlkIl0gPSB7bG9hZDogKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUpIHsKCihmdW5jdGlvbigpIHsKICAvKgogICogR2VuZXJhdGUgYSBSRkM0MTIyKHY0KSBVVUlECiAgKgogICogRG9jdW1lbnRhdGlvbiBhdCBodHRwczovL2dpdGh1Yi5jb20vYnJvb2ZhL25vZGUtdXVpZAogICoKICAqIE1JVCAmIEdQTCBkdWFsIGxpY2Vuc2UKICAqLwoKICAvLyBVc2Ugbm9kZS5qcyBCdWZmZXIgY2xhc3MgaWYgYXZhaWxhYmxlLCBvdGhlcndpc2UgdXNlIHRoZSBBcnJheSBjbGFzcwogIHZhciBCdWZmZXJDbGFzcyA9IHR5cGVvZihCdWZmZXIpID09ICdmdW5jdGlvbicgPyBCdWZmZXIgOiBBcnJheTsKCiAgLy8gQnVmZmVyIHVzZWQgZm9yIGdlbmVyYXRpbmcgc3RyaW5nIHV1aWRzCiAgdmFyIF9idWYgPSBuZXcgQnVmZmVyQ2xhc3MoMTYpOwoKICAvLyBDYWNoZSBudW1iZXIgPC0+IGhleCBzdHJpbmcgZm9yIG9jdGV0IHZhbHVlcwogIHZhciB0b1N0cmluZyA9IFtdOwogIHZhciB0b051bWJlciA9IHt9OwogIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgIHRvU3RyaW5nW2ldID0gKGkgKyAweDEwMCkudG9TdHJpbmcoMTYpLnN1YnN0cigxKTsKICAgIHRvTnVtYmVyW3RvU3RyaW5nW2ldXSA9IGk7CiAgfQoKICBmdW5jdGlvbiBwYXJzZShzKSB7CiAgICB2YXIgYnVmID0gbmV3IEJ1ZmZlckNsYXNzKDE2KTsKICAgIHZhciBpID0gMDsKICAgIHMudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bMC05YS1mXVswLTlhLWZdL2csIGZ1bmN0aW9uKG9jdGV0KSB7CiAgICAgIGJ1ZltpKytdID0gdG9OdW1iZXJbb2N0ZXRdOwogICAgfSk7CiAgICByZXR1cm4gYnVmOwogIH0KCiAgZnVuY3Rpb24gdW5wYXJzZShidWYpIHsKICAgIHZhciB0b3MgPSB0b1N0cmluZywgYiA9IGJ1ZjsKICAgIHJldHVybiB0b3NbYlswXV0gKyB0b3NbYlsxXV0gKyB0b3NbYlsyXV0gKyB0b3NbYlszXV0gKyAnLScgKwogICAgICAgICAgIHRvc1tiWzRdXSArIHRvc1tiWzVdXSArICctJyArCiAgICAgICAgICAgdG9zW2JbNl1dICsgdG9zW2JbN11dICsgJy0nICsKICAgICAgICAgICB0b3NbYls4XV0gKyB0b3NbYls5XV0gKyAnLScgKwogICAgICAgICAgIHRvc1tiWzEwXV0gKyB0b3NbYlsxMV1dICsgdG9zW2JbMTJdXSArCiAgICAgICAgICAgdG9zW2JbMTNdXSArIHRvc1tiWzE0XV0gKyB0b3NbYlsxNV1dOwogIH0KCiAgdmFyIGIzMiA9IDB4MTAwMDAwMDAwLCBmZiA9IDB4ZmY7CiAgZnVuY3Rpb24gdXVpZChmbXQsIGJ1Ziwgb2Zmc2V0KSB7CiAgICB2YXIgYiA9IGZtdCAhPSAnYmluYXJ5JyA/IF9idWYgOiAoYnVmID8gYnVmIDogbmV3IEJ1ZmZlckNsYXNzKDE2KSk7CiAgICB2YXIgaSA9IGJ1ZiAmJiBvZmZzZXQgfHwgMDsKCiAgICB2YXIgciA9IE1hdGgucmFuZG9tKCkqYjMyOwogICAgYltpKytdID0gciAmIGZmOwogICAgYltpKytdID0gcj4+PjggJiBmZjsKICAgIGJbaSsrXSA9IHI+Pj4xNiAmIGZmOwogICAgYltpKytdID0gcj4+PjI0ICYgZmY7CiAgICByID0gTWF0aC5yYW5kb20oKSpiMzI7CiAgICBiW2krK10gPSByICYgZmY7CiAgICBiW2krK10gPSByPj4+OCAmIGZmOwogICAgYltpKytdID0gcj4+PjE2ICYgMHgwZiB8IDB4NDA7IC8vIFNlZSBSRkM0MTIyIHNlY3QuIDQuMS4zCiAgICBiW2krK10gPSByPj4+MjQgJiBmZjsKICAgIHIgPSBNYXRoLnJhbmRvbSgpKmIzMjsKICAgIGJbaSsrXSA9IHIgJiAweDNmIHwgMHg4MDsgLy8gU2VlIFJGQzQxMjIgc2VjdC4gNC40CiAgICBiW2krK10gPSByPj4+OCAmIGZmOwogICAgYltpKytdID0gcj4+PjE2ICYgZmY7CiAgICBiW2krK10gPSByPj4+MjQgJiBmZjsKICAgIHIgPSBNYXRoLnJhbmRvbSgpKmIzMjsKICAgIGJbaSsrXSA9IHIgJiBmZjsKICAgIGJbaSsrXSA9IHI+Pj44ICYgZmY7CiAgICBiW2krK10gPSByPj4+MTYgJiBmZjsKICAgIGJbaSsrXSA9IHI+Pj4yNCAmIGZmOwoKICAgIHJldHVybiBmbXQgPT09IHVuZGVmaW5lZCA/IHVucGFyc2UoYikgOiBiOwogIH07CgogIHV1aWQucGFyc2UgPSBwYXJzZTsKICB1dWlkLnVucGFyc2UgPSB1bnBhcnNlOwogIHV1aWQuQnVmZmVyQ2xhc3MgPSBCdWZmZXJDbGFzczsKCiAgaWYgKHR5cGVvZihtb2R1bGUpICE9ICd1bmRlZmluZWQnKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHV1aWQ7CiAgfSBlbHNlIHsKICAgIC8vIEluIGJyb3dzZXI/IFNldCBhcyB0b3AtbGV2ZWwgZnVuY3Rpb24KICAgIHRoaXMudXVpZCA9IHV1aWQ7CiAgfQp9KSgpOwoKfSl9OwoKLyoqKioqKioqKiogbGliL3ZhbGlkYXRlICoqKioqKioqKiovCgprYW5zby5tb2R1bGVDYWNoZVsibGliL3ZhbGlkYXRlIl0gPSB7bG9hZDogKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUpIHsKCi8qKgogKiBUaGUgdmFsaWRhdGVfZG9jX3VwZGF0ZSBmdW5jdGlvbiB0byBiZSBleHBvcnRlZCBmcm9tIHRoZSBkZXNpZ24gZG9jLgogKi8KCnZhciB0eXBlcyA9IHJlcXVpcmUoJ2thbnNvL3R5cGVzJyksCiAgICBhcHBfdHlwZXMgPSByZXF1aXJlKCcuL3R5cGVzJyk7CgoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAobmV3RG9jLCBvbGREb2MsIHVzZXJDdHgpIHsKICAgIHR5cGVzLnZhbGlkYXRlX2RvY191cGRhdGUoYXBwX3R5cGVzLCBuZXdEb2MsIG9sZERvYywgdXNlckN0eCk7CiAgICAKICAgIC8qKgogICAgICogaWYgdXNlcl9pZCBvZiBhIGRvY3VtZW50Y29udGFpbnMgQCwgbXVzdCBiZSBsb2dnZWQgaW4gYXMgdGhhdCB1c2VyIHRvIG1ha2UgY2hhbmdlcwogICAgICovCiAgICB2YXIgdmVyaWZ5X3VzZXIgPSBmdW5jdGlvbiB2ZXJpZnlfdXNlcih1c2VyX2lkKSB7CiAgICAgICAgaWYoIHVzZXJfaWQgJiYgdXNlcl9pZFswXSAhPSAnKicgKSB7CiAgICAgICAgICAgIGlmICh1c2VyQ3R4Lm5hbWUgPT0gbnVsbCApIHsKICAgICAgICAgICAgICAgIHRocm93KHtmb3JiaWRkZW46ICdUaGlzIHVzZXIgbXVzdCBiZSBsb2dnZWQgaW4gdG8gbWFrZSBjaGFuZ2VzICgqIHBvbGljeSkuIHVzZXJfaWQ6Jyt1c2VyX2lkfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoIHVzZXJDdHgubmFtZSAhPSB1c2VyX2lkICkgewogICAgICAgICAgICAgICAgdGhyb3coe2ZvcmJpZGRlbjogJ1RoaXMgdXNlciBjYW5ub3QgbWFrZSBjaGFuZ2VzIHRvIGFub3RoZXIgdXNlclwncyBkb2N1bWVudHMgKCogcG9saWN5KS51c2VyX2lkOicrdXNlcl9pZH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgaWYoIG5ld0RvYyApIHsKICAgICAgICB2ZXJpZnlfdXNlcihuZXdEb2MudXNlcl9pZCk7CiAgICB9CiAgICBpZiggb2xkRG9jICkgewogICAgICAgIHZlcmlmeV91c2VyKG9sZERvYy51c2VyX2lkKTsKICAgIH0KICAgIAp9OwoKCn0pfTsKCi8qKioqKioqKioqIGxpYi92aWV3cyAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImxpYi92aWV3cyJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKioKICogVmlldyBmdW5jdGlvbnMgdG8gYmUgZXhwb3J0ZWQgZnJvbSB0aGUgZGVzaWduIGRvYy4KICovCgovLyA9PT0gZm9yIHRoZSBib29rbWFya2xldCAoL290aGVyKSBjbGllbnQKCi8qKgogKiB0byByZXF1ZXN0IGFsbCBub3RlcyBvciBhbGwgcXVvdGVzIG9uIGEgcGFydGljdWxhciBzb3VyY2UsCiAqICAgZWl0aGVyIGZvciBhIHBhcnRpY3VsYXIgdXNlciBvciBmb3IgYWxsIHVzZXJzCiAqIFRPRE8gOiBzaG91bGQgcHJvYmFibHkgc2tpcCBkb2MudHlwZSBhbmQgcHJvdmlkZSBldmVyeXRoaW5nCiAqLwpleHBvcnRzLnBhZ2VJZF90eXBlX3VzZXJJZCA9IHsKICAgIG1hcCA6IGZ1bmN0aW9uKGRvYykgewogICAgICAgIGlmKCBkb2MucGFnZV9pZCAmJiBkb2MudHlwZSApIHsKICAgICAgICAgICAgaWYoIGRvYy51c2VyX2lkICkgewogICAgICAgICAgICAgICAgZW1pdChbZG9jLnBhZ2VfaWQsIGRvYy50eXBlLCBkb2MudXNlcl9pZF0sZG9jKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9ubyB1c2VyX2lkCiAgICAgICAgICAgIGVtaXQoW2RvYy5wYWdlX2lkLCBkb2MudHlwZSwgbnVsbF0sZG9jKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfTsKCgoKLy8gPT09IGZvciB0aGUgY291Y2hBcHAKCi8qKgogKiBhbGwgdXNlcnMKICogaHR0cDovL2xvY2FsaG9zdDo1OTg0L25yYW1hL19kZXNpZ24vbnJhbWEvX3ZpZXcvYWxsX3VzZXJfaWRzCiovIApleHBvcnRzLmFsbF91c2VyX2lkcyA9IHsKICAgIG1hcCA6IGZ1bmN0aW9uKGRvYykgewogICAgICAgIGlmKCBkb2MudHlwZSA9PSAnc291cmNlJyAmJiBkb2MudXBkYXRlZCkgewogICAgICAgICAgICBlbWl0KGRvYy51c2VyX2lkLCBkb2MudXBkYXRlZCk7CiAgICAgICAgfQogICAgfSwKICAgIHJlZHVjZSA6ICdfc3RhdHMnCn07CgovKioKICogdG8gZGlzcGxheSBhbGwgc291cmNlcyAoZm9yIGFsbCB1c2Vycykgb3JkZXJlZCBieSBtb3N0IHJlY2VudGx5IHVwZGF0ZWQKICovCmV4cG9ydHMuc291cmNlID0gewogICAgbWFwIDogZnVuY3Rpb24oZG9jKSB7CiAgICAgICAgaWYoIGRvYy50eXBlICYmIGRvYy50eXBlID09ICJzb3VyY2UiICkgewogICAgICAgICAgICBpZiggZG9jLnVwZGF0ZWQgJiYgZG9jLnBhZ2VfaWQgKSB7CiAgICAgICAgICAgICAgICBlbWl0KFtkb2MudXBkYXRlZCwgZG9jLnBhZ2VfaWRdLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfTsKCi8qKgogKiB0byBkaXNwbGF5IGFsbCBzb3VyY2VzIGZvciBhIHBhcnRpY3VsYXIgdXNlcgogKi8KZXhwb3J0cy51c2VySWRfc291cmNlID0gewogICAgbWFwIDogZnVuY3Rpb24oZG9jKSB7CiAgICAgICAgaWYoIGRvYy50eXBlICYmIGRvYy50eXBlID09ICJzb3VyY2UiICkgewogICAgICAgICAgICBpZiggZG9jLnVzZXJfaWQgJiYgZG9jLnBhZ2VfaWQgJiYgZG9jLnVwZGF0ZWQgKSB7CiAgICAgICAgICAgICAgICBlbWl0KFtkb2MudXNlcl9pZCwgZG9jLnVwZGF0ZWRdLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfTsKCi8qKgogKiB0byBkaXNwbGF5IFthbGwgdXNlcnMnIHwgYSB1c2VyJ3NdIG5vdGVzIG9uIGEgc2luZ2xlIHNvdXJjZS4KICogZS5nLgogKiAgIGh0dHA6Ly9sb2NhbGhvc3Q6NTk4NC9ucmFtYS9fZGVzaWduL25yYW1hL192aWV3L3BhZ2VJZF91c2VySWQ/a2V5PVsiaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Lb21vZG9fZHJhZ29ucz9oPWkiLCJzdGV2ZUBnbWFpbC5jb20iXQogKi8KZXhwb3J0cy5wYWdlSWRfdXNlcklkPSB7CiAgbWFwIDogZnVuY3Rpb24oZG9jKSB7CiAgICBpZiggZG9jLnVzZXJfaWQgJiYgZG9jLnBhZ2VfaWQgKSB7CiAgICAgIGVtaXQoW2RvYy5wYWdlX2lkLCBkb2MudXNlcl9pZF0sIG51bGwpOwogICAgfQogIH0KfTsKCgovLyAtLSBhdXRob3Igdmlld3MKLy8gICAgdGhlc2UgZGlmZmVyIGFsbW9zdCBvbmx5IGluIG9yZGVyIG9mIGVtaXNzaW9ucyBidXQgZG9uJ3QgaGF2ZSBlbGVnYW50IHdheSB0byBleHByZXNzIHRoaXMgcmVsYXRpb24KCi8qKgogKiB0byBkaXNwbGF5IGEgdXNlcidzIGF1dGhvcnMgYW5kLCBmb3IgZWFjaCBhdXRob3IsIHRoZSBzb3VyY2VzCiAqLwpleHBvcnRzLnVzZXJJZF9hdXRob3IgPSB7CiAgbWFwIDogZnVuY3Rpb24oZG9jKSB7CiAgICBpZiggZG9jLnR5cGUgJiYgZG9jLnR5cGUgPT0gJ3NvdXJjZScgKSB7CiAgICAgIGlmKCBkb2MuQVVUSE9SICYmIGRvYy51c2VyX2lkICkgewogICAgICAgIHZhciB5ZWFyID0gZG9jLllFQVIgfHwgMDsgICAgLy9vcmRlciBpcyBbbnVsbCwgMTk2NSwgMTk5MCwgMjAwMF0sICAodHlwaWNhbGx5IHJldmVyc2VkKQogICAgICAgIGZvciggaWR4IGluIGRvYy5BVVRIT1IgKSB7CiAgICAgICAgICBlbWl0KCBbIGRvYy51c2VyX2lkLCBkb2MuQVVUSE9SW2lkeF0sIDUwMDAteWVhciBdLCAxICk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKICByZWR1Y2UgOiAiX2NvdW50Igp9Ci8qKgogKiB0byBkaXNwbGF5IGFsbCBzb3VyY2VzIGJ5IGFuIGF1dGhvciwgb3IgYWxsIG9mIGEgdXNlcidzIHNvdXJjZXMgYnkgYW4gYXV0aG9yLAogKiBzb3J0ZWQgYnkgeWVhci4KICogJiB0byBkaXNwbGF5IGFsbCBhdXRob3JzIHdpdGggZWFjaCBhdXRob3IncyBzb3VyY2VzIAogKiAoV2UgYXJlIHRyZWF0aW5nIGF1dGhvcnMgbGlrZSB0YWdzOyBhdXRob3JzIHRhZyBzb3VyY2VzLCBub3Qgbm90ZXMpCiAqLwpleHBvcnRzLmF1dGhvcl91c2VySWQgPSB7CiAgbWFwIDogZnVuY3Rpb24oZG9jKSB7CiAgICBpZiggZG9jLnR5cGUgJiYgZG9jLnR5cGUgPT0gJ3NvdXJjZScgKSB7CiAgICAgIGlmKCBkb2MuQVVUSE9SICYmIGRvYy51c2VyX2lkICkgewogICAgICAgIHZhciB5ZWFyX29yZGVyID0gNTAwMCAtIHBhcnNlSW50KGRvYy5ZRUFSKSB8fCA1MDAwOyAgICAvL29yZGVyIGlzIFtudWxsLCAxOTY1LCAxOTkwLCAyMDAwXSwgICh0eXBpY2FsbHkgcmV2ZXJzZWQpCiAgICAgICAgZm9yKCBpZHggaW4gZG9jLkFVVEhPUiApIHsKICAgICAgICAgIGVtaXQoIFtkb2MuQVVUSE9SW2lkeF0sIGRvYy51c2VyX2lkLCB5ZWFyX29yZGVyXSwgMSApOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sCiAgcmVkdWNlIDogIl9jb3VudCIKfTsKCgovLyAtLSB0YWdzCgovKioKICogdG8gZGlzcGxheSBhbGwgdGFncwogKi8KZXhwb3J0cy50YWdzX2FsbD0gewogIG1hcCA6IGZ1bmN0aW9uKGRvYykgewogICAgaWYoIGRvYy50eXBlICYmIGRvYy50eXBlID09ICdub3RlJyApIHsKICAgICAgaWYoIGRvYy50YWdzICkgewogICAgICAgIGZvciggaWR4IGluIGRvYy50YWdzICkgewogICAgICAgICAgdmFyIHRhZyA9IGRvYy50YWdzW2lkeF07CiAgICAgICAgICBlbWl0KFt0YWddLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LAogIHJlZHVjZSA6ICdfY291bnQnCn07CmV4cG9ydHMudGFnc191c2VyPSB7CiAgbWFwIDogZnVuY3Rpb24oZG9jKSB7CiAgICBpZiggZG9jLnR5cGUgJiYgZG9jLnR5cGUgPT0gJ25vdGUnICkgewogICAgICBpZiggZG9jLnRhZ3MgJiYgZG9jLnVzZXJfaWQgKSB7CiAgICAgICAgZm9yKCBpZHggaW4gZG9jLnRhZ3MgKSB7CiAgICAgICAgICB2YXIgdGFnID0gZG9jLnRhZ3NbaWR4XTsKICAgICAgICAgIGVtaXQoW2RvYy51c2VyX2lkLCB0YWddLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LAogIHJlZHVjZSA6ICdfY291bnQnCn07Ci8qKgogKiB0byBzaG93IFthbGwgdXNlcnMnIHwgYSB1c2VyJ3NdIG5vdGVzIG9uIGEgdGFnIG9yZ2FuaXNlZCBieSBzb3VyY2UsCiAqICAgd2hlcmUgdGhlIHNvdXJjZXMgYXJlIHNvcnRlZCBieSBtb3N0IHJlY2VudGx5IHVwZGF0ZWQKICoKICogdXNlZCB3aXRoIGluY2x1ZGVfZG9jcywgaXQgd2lsbCBncmFiIHRyaXBsZXMgb2YgYSBub3RlLCBhIHNvdXJjZSAmIGEgcXVvdGUuCiAqIHNlZSBodHRwOi8vYmxvZy5jb3VjaGJhc2UuY29tL3doYXQlRTIlODAlOTlzLW5ldy1hcGFjaGUtY291Y2hkYi0wMTEtJUUyJTgwJTk0LXBhcnQtdHdvLXZpZXdzLWpvaW5zLXJlZHV4LXJhdy1jb2xsYXRpb24tc3BlZWQKICovCmV4cG9ydHMudGFncyA9IHsKICBtYXAgOiBmdW5jdGlvbihkb2MpIHsKICAgIGlmKCBkb2MudHlwZSAmJiBkb2MudHlwZSA9PSAnbm90ZScgKSB7CiAgICAgIHZhciBub3RlID0gZG9jOwogICAgICBpZiggbm90ZS50YWdzICkgewogICAgICAgIGlmKCBub3RlLnVzZXJfaWQgJiYgbm90ZS5zb3VyY2VfaWQgJiYgbm90ZS5xdW90ZV9pZCAmJiBub3RlLnVwZGF0ZWQpIHsKICAgICAgICAgIGZvciggdmFyIGlkeCBpbiBub3RlLnRhZ3MgKSB7CiAgICAgICAgICAgIHZhciB0YWcgPSBub3RlLnRhZ3NbaWR4XTsKICAgICAgICAgICAgZW1pdChbIHRhZywgbm90ZS51c2VyX2lkLCBub3RlLnVwZGF0ZWQgXSwgbnVsbCk7ICAgICAgICAgICAgICAgICAgLy9pbmNsdWRlIHRoZSBub3RlIGl0ZXNlbGYKICAgICAgICAgICAgZW1pdChbIHRhZywgbm90ZS51c2VyX2lkLCBub3RlLnVwZGF0ZWQgXSwge19pZDpub3RlLnNvdXJjZV9pZH0pOyAgLy9pbmNsdWRlIHRoZSBzb3VyY2UKICAgICAgICAgICAgZW1pdChbIHRhZywgbm90ZS51c2VyX2lkLCBub3RlLnVwZGF0ZWQgXSwge19pZDpub3RlLnF1b3RlX2lkfSk7ICAgLy9pbmNsdWRlIHRoZSBxdW90ZQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sCiAgcmVkdWNlIDogIl9jb3VudCIKfTsKCi8qKgogKiBmb3IgdGhlIGZsb3csIHNob3cgbm90ZXMgYnkgcmVjZW5jeS4gIEFsbG93cyBhIHF1b3RlLWNlbnRyZWQgdmlldyByYXRoZXIgdGhhbgogKiAgc291cmNlLWNlbnRyZWQuCiAqCiAqIFdhc3RlZnVsIC0tIGVtaXRzIHNvdXJjZSBmb3IgZXZlcnkgbm90ZSBhbmQgYWdhaW4gZm9yIGV2ZXJ5IHF1b3RlLgogKiBCZWNhdXNlIHF1b3RlcyBhcmUgZW1pdHRlZCBpbiBvcmRlciBvZiBDUkVBVElPTiAobm90IGluIG9yZGVyIG5vdGVzIGFyZSB1cGRhdGVkLAogKiB0aGlzIHZpZXcgZW5kcyB1cCBiZWluZyBvdXQgb2Ygb3JkZXIpLgogKiBJZiBsaW1pdGVkLCB0aGVyZSBtaWdodCBiZSBub3RlcyB3aXRoIG1pc3NpbmcgcXVvdGVzICh0aGlzIGNvdWxkIGhhcHBlbiB3aGVyZQogKiB0aGVyZSBpcyBhIGRlbGF5IGJldHdlZW4gY3JlYXRpbmcgYSBxdW90ZSBhbmQgYWRkaW5nIGEgbm90ZSkuCiAqIChDb3VsZCBmaXggYm90aCBwcm9ibGVtcyBieSBoYXZpbmcgdXBkYXRlcyB0byBub3RlcyBjYXVzaW5nIHF1b3RlcyB0byBiZSB1cGRhdGVkCiAqIHRvbywganVzdCBhcyBzb3VyY2VzIGFyZS4pCiAqCiAqIExpa2UgdGFncywgaXQgcHJvdmlkZXMgbm90ZS1xdW90ZS1zb3VyY2UgdHJpcGxlcyBhbmQgbXVzdCBiZSB1c2VkIHdpdGgKICogIGluY2x1ZGVfZG9jcwogKi8gCmV4cG9ydHMucXVvdGVzID0gewogIG1hcCA6IGZ1bmN0aW9uKGRvYykgewogICAgaWYoIGRvYy50eXBlICYmIGRvYy51c2VyX2lkICYmIGRvYy5zb3VyY2VfaWQgJiYgZG9jLnVwZGF0ZWQgKSB7CiAgICAgIGlmKCBkb2MudHlwZSA9PSAnbm90ZScgJiYgZG9jLnF1b3RlX2lkICkgewogICAgICAgIHZhciBub3RlID0gZG9jOwogICAgICAgIGVtaXQoWyBub3RlLnVzZXJfaWQsIG5vdGUudXBkYXRlZCBdLCBudWxsKTsgICAgICAgICAgICAgICAgICAvL2luY2x1ZGUgdGhlIG5vdGUgaXRlc2VsZgogICAgICAgIGVtaXQoWyBub3RlLnVzZXJfaWQsIG5vdGUudXBkYXRlZCBdLCB7X2lkOm5vdGUuc291cmNlX2lkfSk7ICAvL2luY2x1ZGUgdGhlIHNvdXJjZQogICAgICAgIC8vZW1pdChbIG5vdGUudXNlcl9pZCwgbm90ZS51cGRhdGVkIF0sIHtfaWQ6bm90ZS5xdW90ZV9pZH0pOyAgIC8vaW5jbHVkZSB0aGUgcXVvdGUKICAgICAgfQogICAgICBpZiggZG9jLnR5cGUgPT0gJ3F1b3RlJyApIHsKICAgICAgICB2YXIgcXVvdGUgPSBkb2M7CiAgICAgICAgZW1pdChbIHF1b3RlLnVzZXJfaWQsIHF1b3RlLmNyZWF0ZWQgXSwgbnVsbCk7CiAgICAgICAgZW1pdChbIHF1b3RlLnVzZXJfaWQsIHF1b3RlLmNyZWF0ZWQgXSwge19pZDpxdW90ZS5zb3VyY2VfaWR9KQogICAgICB9CiAgICB9CiAgfQp9OwoKfSl9OwoKLyoqKioqKioqKiogbGliL25yYW1hMiAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImxpYi9ucmFtYTIiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLyoqCiAqIG5vdGUtby1yYW1hLCBzZWNvbmQgYXR0ZW1wdAogKiBDb3B5cmlnaHQgKGMpIDIwMTEgU3RlcGhlbiBBLiBCdXR0ZXJmaWxsCiAqCiAqIEZvciBkZXBlbmRlbmNpZXMgc2VlIGxpYi5qcwogKgogKiBUbyBydW4gYXMgYm9va21hcmtsZXQgKGNoYW5nZSB1cmw7IGRlbGV0ZSB0aGUgJ25vdycgcGFyYW0gaWYgbm90IGluIGRldmVsb3BlbnQgbW9kZSk6CiAqICAgamF2YXNjcmlwdDooZnVuY3Rpb24oKXtkZWxldGUgbW9kdWxlO2RlbGV0ZSBleHBvcnRzO19ucmFtYV9ia21rbHQ9dHJ1ZTtfbnJhbWFfdXNlcj0nc3RldmUnO2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JykpLnNyYz0naHR0cDovL2xvY2FsaG9zdDo1OTg0L25yYW1hL19kZXNpZ24vbnJhbWEvYmttcmtsdC9ucmFtYTIuanM/bm93PW5ldyBEYXRlKCkuZ2V0VGltZSgpJzsgfSkoKTsKICoKICogVG8gZW1iZWQgaW4gcGFnZToKICogICA8c2NyaXB0IHNyYz0nbGliLm1pbi5qcyIgPjwvc2NyaXB0PgogKiAgIDxzY3JpcHQ+CiAqICAgICBfbnJhbWFfYmtta2x0ID0gZmFsc2U7CiAqICAgPC9zY3JpcHQ+CiAqICAgPHNjcmlwdCBzcmM9Im5yYW1hMl9iYXNlLmpzIiA+PC9zY3JpcHQ+CiAqCiAqIFRvIHVzZSBhcyBhIGNvbW1vbkpTIG1vZHVsZSAoc2VlIG5lYXIgdGhlIGVuZCBmb3IgYSBsaXN0IG9mIGRlcGVuZGVuY2llcyk6CiAqICAgbnJhbWEgPSByZXF1aXJlKCcuL25yYW1hJyk7CiAqICAgCiAqIE5COiBucmFtYSB3aWxsIG9ubHkgd29yayBpZiB1c2VycyBhY2NlcHQgY29va2llcyBmcm9tIGFsbCB3ZWJzaXRlcyAoYmVjYXVzZSBYRE0gbmVlZGVkKQogKgogKiBUT0RPIC0tIGxvYWQgc2V0dGluZ3MgZnJvbSBzZXJ2ZXIgZm9yIGxvZ2dlZC1pbiB1c2VycwogKi8KCi8qCiAgICBUaGlzIGZpbGUgaXMgcGFydCBvZiBOb3RlLW8tcmFtYS4KCiAgICBOb3RlLW8tcmFtYSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgTm90ZS1vLXJhbWEgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIE5vdGUtby1yYW1hLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoqLwoKLyoqCiAqIFdyYXBwaW5nIGZvciBib3RoIDxzY3JpcHQ+IGFuZCBjb21tb25KUyByZXF1aXJlKCkgdXNlCiAqIFRoYW5rcyB0byBodHRwOi8vY2FvbGFubWNtYWhvbi5jb20vcG9zdHMvd3JpdGluZ19mb3Jfbm9kZV9hbmRfdGhlX2Jyb3dzZXIKICogVGhlIGZ1bmN0aW9uIG1heSBiZSBjYWxsZWQgd2l0aCBleHBvcnRzIHVuZGVmaW5lZCB0byBwcmV2ZW50IGV4ZWN1dGlvbiAodGhpcwogKiBpcyB0byBhbGxvdyBjaGVja2luZyBucmFtYSBub3QgYWxyZWFkeSBsb2FkZWQsIHNlZSBiZWxvdykuCiAqLwooZnVuY3Rpb24oZXhwb3J0cyl7CiAgICB2YXIgX05SQU1BX0xJQl9VUkwgPSAiaHR0cDovL2xvY2FsaG9zdDo1OTg0L25yYW1hL19kZXNpZ24vbnJhbWEvYmttcmtsdC9saWIubWluLmpzIjsgLy93aGVyZSB0byBsb2FkIGxpYiBmcm9tIChmb3IgYm9va21hcmtsZXQgb25seSkKCiAgICAvKioKICAgICAqIGZpeCB1dWlkcyBzbyB0aGF0IGl0IGRvZXNuJ3QgaW5jbHVkZSBkYXNoZXMgKG5vIGdvb2QgZm9yIGNvdWNoREIpCiAgICAgKiBhbHNvIGluY2x1ZGUgYSB0cmFpbGluZyBOIHRvIG1hcmsgdGhlIHNvdXJjZQogICAgICovCiAgICBleHBvcnRzLl9tYWtlX3V1aWQgPSBmdW5jdGlvbih1dWlkKSB7CiAgICAgICAgdmFyIG5ld191dWlkID0gZnVuY3Rpb24gKHVzZV9iMzYvKm9wdGlvbmFsKi8pewogICAgICAgICAgICBpZiggdXNlX2IzNiApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludCh1dWlkKCkucmVwbGFjZSgvLS9nLCcnKSwgMTYpLnRvU3RyaW5nKDM2KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAgdXVpZCgpLnJlcGxhY2UoLy0vZywnJykrJ04nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXdfdXVpZDsKICAgIH07CgogICAgLyoqCiAgICAgKiBUaGVzZSBhcmUgc29tZSBzZXR0aW5ncyBmb3IgZW1iZWRkZWQgbW9kZSAoYmttcmtsdCBvciA8c2NyaXB0PikuCiAgICAgKiBPdGhlcnMgYXJlIGFkZGVkIGR1cmluZyBpbml0IChzZWUgcGFnZV9pZCBhbmQgcm9vdF9ub2RlKS4KICAgICAqIFdoZW4gdXNlZCBvbiB0aGUgc2VydmVyLCBzb21lIHNldHRpbmdzIGFyZSBvdmVycmlkZW4uCiAgICAgKi8KICAgIGV4cG9ydHMuX21ha2Vfc2V0dGluZ3MgPSBmdW5jdGlvbihucmFtYV91dWlkKXsKICAgICAgICB2YXIgJCA9IGpRdWVyeTsKICAgICAgICB2YXIgc2V0dGluZ3MgPSB7CiAgICAgICAgICAgIC8vIC0tIGludGVybmFscwogICAgICAgICAgICBpc19lbWJlZGRlZCA6IHRydWUsICAgICAvL3NldCB0byBmYWxzZSB3aGVuIGJlaW5nIHVzZWQgb24gdGhlIHNlcnZlcgogICAgICAgICAgICBkZWJ1ZyA6IHRydWUsCiAgICAgICAgICAgIGRiX25hbWUgOiAnbnJhbWEnLAogICAgICAgICAgICAvL3hkbV91cmw6ICdodHRwOi8vbm90ZW9yYW1hLmlyaXNjb3VjaC5jb20vX2Rlc2lnbi9ucmFtYS9fcmV3cml0ZS94ZG0vcHJvdmlkZXIuaHRtbCcsCiAgICAgICAgICAgIHhkbV91cmwgOiAnaHR0cDovL2xvY2FsaG9zdDo1OTg0L25yYW1hL19kZXNpZ24vbnJhbWEvX3Jld3JpdGUveGRtL3Byb3ZpZGVyLmh0bWwnLAogICAgICAgICAgICAvL3hkbV91cmwgOiAnaHR0cDovL2xvY2FsaG9zdDo1OTg0L25yYW1hL19kZXNpZ24vbnJhbWEvX3Jld3JpdGUveGRtL3Byb3ZpZGVyLmRlYnVnLmh0bWwnLAogICAgICAgICAgICAvLyAtLSB1c2VyIGlkZW50aWZpY2F0aW9uCiAgICAgICAgICAgIHVzZXJfaWQgOiAnKicrbnJhbWFfdXVpZCh0cnVlKS5zbGljZSgwLDEwKSwgLy9kZWZhdWx0IHRvIHJhbmRvbSBhbm9ueW1vdXMgdXNlcgogICAgICAgICAgICBwYXNzd29yZCA6ICduZXcnLCAgIC8vVE9ETyB0aGluayBvZiBjbGV2ZXIgd2F5IHRvIHN0b3JlIHRoaXMKICAgICAgICAgICAgbWVfb25seSA6IHRydWUsICAgIC8vc2hvdyBvbmx5IG15IG5vdGVzIGFuZCBxdW90ZXMKICAgICAgICAgICAgLy8gLS0gcXVvdGVzICYgbm90ZSBzZXR0aW5ncwogICAgICAgICAgICBub3RlX2RlZmF1bHRfdGV4dCA6ICd0eXBlIG5vdycsCiAgICAgICAgICAgIGJhY2tncm91bmRfY29sb3IgOiAnI0ZDRjZDRicsICAgLy9mb3IgcXVvdGVzCiAgICAgICAgICAgIGJhY2tncm91bmRfY29sb3Jfb3RoZXIgOiAncmdiYSgyNDAsMjQwLDI0MCwwLjUpJywgICAvL2NvbG9yIGZvciBvdGhlciBwcGwncyBub3RlcyBhbmQgcXVvdGVzIChUT0RPKQogICAgICAgICAgICBub3RlX2JhY2tncm91bmRfY29sb3IgOiAncmdiYSgyNDAsMjQwLDI0MCwwLjkpJywgCiAgICAgICAgICAgIHBlcnNpc3Rfc3RhcnRlZF9jb2xvciA6ICcjRkZCRjAwJywgIC8vI0ZGQkYwMD1vcmFuZ2UKICAgICAgICAgICAgbm90ZV93aWR0aCA6IDE1MCwgLy9waXhlbHMKICAgICAgICAgICAgbWF4X3F1b3RlX2xlbmd0aCA6IDUwMDAsICAvL3VzZWZ1bCBiZWNhdXNlIHByZXZlbnRzCiAgICAgICAgICAgIC8vIC0tIHN0eWxpbmcKICAgICAgICAgICAgc3R5bGUgOiB7ICAgLy9hcHBsaWVzIHRvIG5vdGVfZWRpdG9yICYgZGlhbG9ncwogICAgICAgICAgICAgICAgZm9udEZhbWlseSA6ICJQYWxhdGlubywgJ1BhbGF0aW5vIExpbm90eXBlJywgR2VvcmdpYSwgVGltZXMsICdUaW1lcyBOZXcgUm9tYW4nLCBzZXJpZiIsCiAgICAgICAgICAgICAgICBmb250U2l6ZSA6ICcxMnB4JywKICAgICAgICAgICAgICAgIGNvbG9yIDogJ3JnYigwLDAsMCknCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG5vdGVfc3R5bGUgOiB7CiAgICAgICAgICAgICAgICAnYm9yZGVyJyA6ICcxcHggc29saWQnLAogICAgICAgICAgICAgICAgJ2JhY2tncm91bmQtY29sb3InIDogJ3JnYigyMjksMjI5LDI5OSknLCAgICAvL2RlZmF1bHQgaW4gY2FzZSBvcHRpb25zLm5vdGVfYmFja2dyb3VuZF9jb2xvciBmYWlscwogICAgICAgICAgICAgICAgJ2JvcmRlci1jb2xvcicgOiAnI0NEQzBCMCcsCiAgICAgICAgICAgICAgICAnYm94LXNoYWRvdycgOiAnMCAwIDhweCByZ2JhKDAsMCwwLDAuMiknLAogICAgICAgICAgICAgICAgJy1tb3otYm94LXNoYWRvdycgOiAnMCAwIDhweCByZ2JhKDAsMCwwLDAuMiknLAogICAgICAgICAgICAgICAgJy13ZWJraXQtYm94LXNoYWRvdycgOiAnMCAwIDhweCByZ2JhKDAsMCwwLDAuMiknLAogICAgICAgICAgICAgICAgJ3BhZGRpbmcnIDogJzNweCcsCiAgICAgICAgICAgICAgICAnY3Vyc29yJyA6ICdtb3ZlJywKICAgICAgICAgICAgICAgICdoZWlnaHQnIDogJ2F1dG8nLAogICAgICAgICAgICAgICAgJ3otaW5kZXgnIDogJzk5OTgnIC8vdHJ5IHRvIGVuc3VyZSBhbHdheXMgb24gdG9wCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG5vdGVfaW5uZXJfc3R5bGUgOiB7fSwKICAgICAgICAgICAgbm90ZV9lZGl0b3Jfc3R5bGUgOiB7CiAgICAgICAgICAgICAgICAnd3JhcCcgOiAnc29mdCcsCiAgICAgICAgICAgICAgICAncGFkZGluZy1sZWZ0JyA6ICcxcHgnLAogICAgICAgICAgICAgICAgJ3BhZGRpbmctdG9wJyA6ICcxcHgnLAogICAgICAgICAgICAgICAgJ3BhZGRpbmctcmlnaHQnIDogJzBweCcsCiAgICAgICAgICAgICAgICAncGFkZGluZy1ib3R0b20nIDogJzBweCcsCiAgICAgICAgICAgICAgICAnYm9yZGVyJyA6ICdub25lJywKICAgICAgICAgICAgICAgICdyZXNpemUnIDogJ25vbmUnLCAgICAgIC8vcmVtb3ZlIGRyYWdnYWJsZSByZXNpemUgaGFuZGxlIGluIGNocm9tZQogICAgICAgICAgICAgICAgJ2xpbmUtaGVpZ2h0JyA6ICcxLjNlbScsCiAgICAgICAgICAgICAgICAnYmFja2dyb3VuZC1jb2xvcicgOiAnaW5oZXJpdCcsCiAgICAgICAgICAgICAgICAndGV4dC1zaGFkb3cnIDogJzFweCAxcHggMjBweCByZ2JhKDI1MCwyNTAsMjUwLDEpLCAtMXB4IC0xcHggMjBweCByZ2JhKDI1MCwyNTAsMjUwLDEpLCAwIDAgMXB4IHJnYmEoMjUwLDI1MCwyNTAsMSknLAogICAgICAgICAgICAgICAgJy1tb3otdGV4dC1zaGFkb3cnIDogJzFweCAxcHggMjBweCByZ2JhKDI1MCwyNTAsMjUwLDEpLCAtMXB4IC0xcHggMjBweCByZ2JhKDI1MCwyNTAsMjUwLDEpLCAwIDAgMXB4IHJnYmEoMjUwLDI1MCwyNTAsMSknLAogICAgICAgICAgICAgICAgJy13ZWJraXQtdGV4dC1zaGFkb3cnIDogJzFweCAxcHggMjBweCByZ2JhKDI1MCwyNTAsMjUwLDEpLCAtMXB4IC0xcHggMjBweCByZ2JhKDI1MCwyNTAsMjUwLDEpLCAwIDAgMXB4IHJnYmEoMjUwLDI1MCwyNTAsMSknCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNpbXBsZW1vZGFsIDogewogICAgICAgICAgICAgICAgYXV0b1Jlc2l6ZTogdHJ1ZSwKICAgICAgICAgICAgICAgIG92ZXJsYXlDbG9zZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHpJbmRleCA6IDMyMDAwLAogICAgICAgICAgICAgICAgb3ZlcmxheUNzcyA6IHsgJ2JhY2tncm91bmQtY29sb3InIDogJyMwMDAnIH0sCiAgICAgICAgICAgICAgICBjb250YWluZXJDc3MgOiB7CiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0IDogJ2F1dG8nLAogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvciA6ICcjZmZmJywKICAgICAgICAgICAgICAgICAgICBib3JkZXI6ICc4cHggc29saWQgIzQ0NCcsCiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogJzEycHgnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb25TaG93IDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICBfLmRlbGF5KCBmdW5jdGlvbigpIHsgJCgnLnNpbXBsZW1vZGFsLWNvbnRhaW5lcicpLmNzcyh7aGVpZ2h0OidhdXRvJ30pOyB9LCA1MCApCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHNldHRpbmdzLm5vdGVfc3R5bGUud2lkdGggPSBzZXR0aW5ncy5ub3RlX3dpZHRoKyJweCI7CiAgICAgICAgc2V0dGluZ3Mubm90ZV9lZGl0b3Jfc3R5bGUud2lkdGggPSBzZXR0aW5ncy5ub3RlX3dpZHRoKyJweCI7CiAgICAgICAgJC5leHRlbmQoc2V0dGluZ3Mubm90ZV9lZGl0b3Jfc3R5bGUsIHNldHRpbmdzLnN0eWxlKTsKICAgICAgICAkLmV4dGVuZChzZXR0aW5ncy5zaW1wbGVtb2RhbC5jb250YWluZXJDc3MsIHNldHRpbmdzLnN0eWxlKTsKICAgICAgICByZXR1cm4gc2V0dGluZ3M7CiAgICB9OwogICAgICAgIAoKICAgIC8qKgogICAgICogY2F1dGlvbiA6IGlmIHNldHRpbmdzLmRlYnVnLCB0aGlzIHdpbGwgYWRkIHRvIHdpbmRvdyAoaWYgZGVmaW5lZCkKICAgICAqLwogICAgZXhwb3J0cy5fbWFrZV9kZWJ1ZyA9IGZ1bmN0aW9uKHNldHRpbmdzLCB3aW5kb3cpIHsKICAgICAgICB2YXIgJCA9IGpRdWVyeTsKICAgICAgICB2YXIgX2RlYnVnID0gZnVuY3Rpb24oKXt9OyAgICAvL2RvZXMgbm90aGluZyBpZiBub3QgZGVidWdnaW5nCiAgICAgICAgaWYoIHNldHRpbmdzLmRlYnVnICYmIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICkgewogICAgICAgICAgICAvL3dpbmRvdy4kPWpRdWVyeTsgICAgICAgICAgICAgICAgICAgICAgICAvLzwtLSBuYiBicmVha3Mgbm9Db25mbGljdAogICAgICAgICAgICBfZGVidWcgPSBmdW5jdGlvbiBfZGVidWcoKXsKICAgICAgICAgICAgICAgIHZhciBtYXBfb3JfYXJyYXkgPSBhcmd1bWVudHMubGVuZ3RoID09IDEgPyBhcmd1bWVudHNbMF0gOiBhcmd1bWVudHM7CiAgICAgICAgICAgICAgICAkLmVhY2gobWFwX29yX2FycmF5LCBmdW5jdGlvbihrZXksdmFsKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIGlzRmluaXRlKGtleSkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkgPSAnYScra2V5OyAgICAgIC8vYWxsb3dzIHVzIHRvIGhhbmRsZSBhcnJheXMKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiggdHlwZW9mICQubG9nID09PSAnZnVuY3Rpb24nICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5sb2coJ25yYW1hX2RlYnVnIHNldHRpbmcgJytrZXkrJz0nK3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3dba2V5XT12YWw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwogICAgICAgICAgICAvL2NvbnZlbmllbmNlIGNhbGxiYWNrIGZvciB0ZXN0aW5nIGFzeW5jCiAgICAgICAgICAgIHdpbmRvdy5jYiA9IGZ1bmN0aW9uKCl7ICQubG9nKCd3aW5kb3cuY2IgY2FsbGVkLCBzZW5kaW5nIGFyZ3VtZW50cyB0byBfZGVidWcnKTsgX2RlYnVnKGFyZ3VtZW50cyk7IH07IAogICAgICAgIH0KICAgICAgICByZXR1cm4gX2RlYnVnOwogICAgfTsKICAgIAogICAgLyoqCiAgICAgKiBjYXV0aW9uOiBleHRlbmRzICQKICAgICAqLwogICAgZXhwb3J0cy5fbWFrZV9sb2dnaW5nID0gZnVuY3Rpb24oc2V0dGluZ3MsICQpIHsKICAgICAgICB2YXIgbG9nZ2VyID0gZnVuY3Rpb24oKXsgcmV0dXJuIGZhbHNlOyB9OwogICAgICAgIGlmKCBzZXR0aW5ncy5kZWJ1ZyApIHsKICAgICAgICAgICAgbG9nZ2VyID0gZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIC8vIHdpbGwgbm90IGxvZyBhbnl0aGluZyB1bmxlc3MgaW4gZGVidWcgbW9kZQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGFyZ3MsIGZ1bmN0aW9uKGlkeCwgYXJnKXsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkLmV4dGVuZCh7ImxvZyI6bG9nZ2VyfSk7CiAgICAgICAgcmV0dXJuIGxvZ2dlcjsKICAgIH07CgogICAgLyoqCiAgICAgKiBAcmV0dXJucyB0aGUgcnBjIHRyYW5zcG9ydCBmb3IgeGRtIAogICAgICovCiAgICBleHBvcnRzLl9tYWtlX3JwYyA9IGZ1bmN0aW9uKHNldHRpbmdzLCBlYXN5WERNLCAkKSB7CiAgICAgICAgdmFyIHJwYyA9IHt9OwogICAgICAgIHJwYy4kID0gJDsKICAgICAgICAKICAgICAgICAvL2xvY2FsIGZ1bmN0aW9ucyBhbGxvdyBjb21tdW5pY2F0aW9uIGZyb20gdGhlIHNlcnZlciB0byB1c2VyCiAgICAgICAgdmFyIGxvY2FsID0ge307CiAgICAgICAgbG9jYWwuZ2V0X3ZlcnNpb24gPSB7CiAgICAgICAgICAgIG1ldGhvZCA6IGZ1bmN0aW9uKHN1Y2Nlc3MsIGVycm9yKXsgc3VjY2VzcygiMC4yIik7IH0KICAgICAgICB9OwogICAgICAgIGxvY2FsLm1zZyA9IHsKICAgICAgICAgICAgbWV0aG9kIDogZnVuY3Rpb24obWVzc2FnZSwgc3VjY2VzcywgZXJyb3IpewogICAgICAgICAgICAgICAgaWYoIHR5cGVvZiBtZXNzYWdlID09PSAnc3RyaW5nJyApIHsKICAgICAgICAgICAgICAgICAgICBhbGVydChtZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzKCdkb25lJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIGRpc3BsYXkgYSBkaWFsb2cgdXNpbmcgalF1ZXJ5LnNpbXBsZW1vZGFsLCBtaW5pbXNpbmcgeHNzIHZ1bG5lcmFiaWxpdGllcwogICAgICAgICAqLwogICAgICAgIGxvY2FsLm1vZGFsID0gewogICAgICAgICAgICBtZXRob2QgOiBmdW5jdGlvbihkaXZfc3RyLCBzdWNjZXNzLCBlcnJvcil7CiAgICAgICAgICAgICAgICBpZiggdHlwZW9mIGRpdl9zdHIgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRkaXYgPSBycGMuJCgnPGRpdj4nK2Rpdl9zdHIrJzwvZGl2PicpOwogICAgICAgICAgICAgICAgICAgIHJwYy4kKCcjaWRfb2snLCAkZGl2KS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJwYy4kLm1vZGFsLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MoJ29rJyk7ICAgICAgICAgIC8vbmIgdGhpcyBvbmx5IHRyaWdnZXJzIGNiIG9uIHJlbW90ZSBlbmQgKG5vIGZ1bmN0aW9uIGlzIHBhc3NlZCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkZGl2LmJlUmVzZXRDU1MoKS5tb2RhbChzZXR0aW5ncy5zaW1wbGVtb2RhbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHZhciBycGNfbmFtZXMgPSBbJ2RiX3NhdmVEb2MnLCAnZGJfcmVtb3ZlRG9jJywgJ2RiX2dldFZpZXcnLCAnZGJfZG9VcGRhdGUnLAogICAgICAgICAgICAgICAgICAgICAgICAgJ3Nlc3Npb25fbG9naW4nLCAnc2Vzc2lvbl9sb2dvdXQnLCAnc2Vzc2lvbl9pbmZvJ107CiAgICAgICAgdmFyIHJlbW90ZSA9IHsgfTsKICAgICAgICBycGMuJC5lYWNoKHJwY19uYW1lcywgZnVuY3Rpb24oaWR4LG5hbWUpewogICAgICAgICAgICByZW1vdGVbbmFtZV0gPSB7fTsgICAgICAvL2NyZWF0ZSBhIHN0dWIgICAgICAKICAgICAgICB9KTsKICAgICAgICBpZiggc2V0dGluZ3MuZGVidWcgKSB7CiAgICAgICAgICAgIHJlbW90ZS50ZXN0ID0ge307CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHZhciBfcnBjID0gbmV3IGVhc3lYRE0uUnBjKHsgcmVtb3RlOnNldHRpbmdzLnhkbV91cmwgfSx7IHJlbW90ZTpyZW1vdGUsIGxvY2FsOmxvY2FsIH0pOwogICAgICAgIC8vaWRlYWxseSBfcnBjIHdvdWxkIGJlIGFsbCB3ZSBuZWVkLCBidXQgc29tZSB0d2Vha2luZyBpcyBuZWVkZWQgLi4uCiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogZ2V0IHJwYyB0byB3b3JrIHdpdGgga2Fuc28uZGIgYW5kIGthbnNvLnNlc3Npb24gOiBjYWxsYmFjayBhcmd1bWVudHMgcGFzc2VkIGFzIGFuIGFycmF5LgogICAgICAgICAqIChTZWUgdGhlIGNvcnJlc3BvbmRpbmcgd3JhcHBlcnMgaW4geGRtL3Byb3ZpZGVyLmpzfGh0bWwgdG8gZ2V0IGZ1bGwgcGljdHVyZS4pCiAgICAgICAgICogd3JhcF91bmFycmF5IGlzIGZvciB1bmRvaW5nIHRoZSBlZmZlY3RzIG9mIGV4ZWN1dGluZyBjYWxsYmFja3Mgd2l0aCBhbGwgcGFyYW1ldGVycwogICAgICAgICAqIGNvbGxhcHNlZCBpbnRvIGFuIGFycmF5IChlYXN5WERNIG9ubHkgYWxsb3dzIGZvciBjYWxsYmFja3Mgd2l0aCBhIHNpbmdsZSBwYXJhbWV0ZXIpLgogICAgICAgICAqLwogICAgICAgIHZhciBfY2FsbGJhY2tfd3JhcHBlciA9IGZ1bmN0aW9uKGZuKXsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgbmV3X2FyZ3MgPSBhcmd1bWVudHNbMF07CiAgICAgICAgICAgICAgICBmbi5hcHBseShudWxsLCBuZXdfYXJncyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHZhciBfd3JhcF91bmFycmF5ID0gZnVuY3Rpb24oIG1ldGhvZCApIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCApIHsKICAgICAgICAgICAgICAgIHZhciBuZXdfYXJndW1lbnRzID0gXy5tYXAoYXJndW1lbnRzLCBmdW5jdGlvbihhcmcpewogICAgICAgICAgICAgICAgICAgIGlmKCB0eXBlb2YoYXJnKSA9PSAnZnVuY3Rpb24nICkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NhbGxiYWNrX3dyYXBwZXIoYXJnKTsgICAgLy93cmFwIGJlY2F1c2Ugd2UncmUgcHV0dGluZyBwYXJhbWV0ZXJzIGludG8gYXJyYXkgZm9yIHhkbQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJnOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBtZXRob2QuYXBwbHkobnVsbCwgbmV3X2FyZ3VtZW50cyk7ICAKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gZmluYWxseSwgYWRkIHRoZSBycGMgZnVuY3Rpb25zCiAgICAgICAgcnBjLiQuZWFjaChycGNfbmFtZXMsIGZ1bmN0aW9uKGlkeCxuYW1lKXsKICAgICAgICAgICAgcnBjW25hbWVdID0gX3dyYXBfdW5hcnJheSggX3JwY1tuYW1lXSApOyAgICAgIAogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIHJldHVybiBycGM7CiAgICB9OwogICAgCiAgICAKICAgIC8qKgogICAgICogQHJldHVybiBhIHN1YnNldCBvZiBrYW5zbydzIGRiIG1vZHVsZSwgc2FtZSBBUEkKICAgICAqIEFueSA0MDMgRm9yYmlkZGVuIGVycm9ycyB3aWxsIHRyaWdnZXIgYSBjdXN0b20gZXZlbnQsICducmFtYV80MDMnCiAgICAgKi8KICAgIGV4cG9ydHMuX21ha2VfZGIgPSBmdW5jdGlvbihycGMsICQpIHsKICAgICAgICB2YXIgZGIgPSB7fTsKICAgICAgICBkYi4kID0gJDsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiB3ZSB3YW50IHRvIGNhcHR1cmUgNDAzIChmb3JiaWRkZW4pIGVycm9ycyBzbyB0aGF0IHRoZSB1c2VyIGNhbiBsb2dpbgogICAgICAgICAqIGNhdXRpb24gOiBhc3N1bWVzIGxhc3QgYXJndW1lbnQgaXMgdGhlIHVuaXF1ZSBjYWxsYmFjayAoYXMgbm9kZSBqcykKICAgICAgICAgKi8KICAgICAgICB2YXIgX3dyYXBfNDAzX2NhbGxiYWNrID0gZnVuY3Rpb24oIGNhbGxiYWNrICkgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXJyb3IsIGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmKCBlcnJvciAmJiAoIGVycm9yLnN0YXR1cyA9PT0gNDAzIHx8IGVycm9yLmVycm9yID09PSAnZm9yYmlkZGVuJyApICkgewogICAgICAgICAgICAgICAgICAgIHZhciB1c2VyX2lkID0gJyc7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9pZCA9IGVycm9yLm1lc3NhZ2Uuc2xpY2UoZXJyb3IubWVzc2FnZS5pbmRleE9mKCd1c2VyX2lkOicpKzgpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkge30KICAgICAgICAgICAgICAgICAgICBkYi4kKGRvY3VtZW50KS50cmlnZ2VyKCducmFtYV80MDMnLCB1c2VyX2lkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgdmFyIF93cmFwXzQwMyA9IGZ1bmN0aW9uKCBmbiApIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgYXJnc1thcmdzLmxlbmd0aC0xXSA9IF93cmFwXzQwM19jYWxsYmFjayggYXJnc1thcmdzLmxlbmd0aC0xXSApOwogICAgICAgICAgICAgICAgcmV0dXJuIGZuLmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRiLnNhdmVEb2MgPSBfd3JhcF80MDMoIHJwYy5kYl9zYXZlRG9jICk7CiAgICAgICAgZGIucmVtb3ZlRG9jID0gX3dyYXBfNDAzKCBycGMuZGJfcmVtb3ZlRG9jICk7CiAgICAgICAgZGIuZ2V0VmlldyA9IF93cmFwXzQwMyggcnBjLmRiX2dldFZpZXcgKTsKICAgICAgICBkYi5kb1VwZGF0ZSA9IF93cmFwXzQwMyggcnBjLmRiX2RvVXBkYXRlICkKICAgICAgICAKICAgICAgICByZXR1cm4gZGI7CiAgICB9OwoKICAgIC8qKgogICAgICogQHJldHVybiBhIHN1YnNldCBvZiBrYW5zbydzIHNlc3Npb24gbW9kdWxlLCBzYW1lIEFQSQogICAgICovCiAgICBleHBvcnRzLl9tYWtlX3Nlc3Npb24gPSBmdW5jdGlvbihycGMpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsb2dpbiA6IHJwYy5zZXNzaW9uX2xvZ2luLAogICAgICAgICAgICBsb2dvdXQgOiBycGMuc2Vzc2lvbl9sb2dvdXQsCiAgICAgICAgICAgIGluZm8gOiBycGMuc2Vzc2lvbl9pbmZvIAogICAgICAgIH07CiAgICB9OwoKCiAgICAvKioKICAgICAqIEBwYXJhbSBkYntPYmplY3R9IGltcGxlbWVudHMgKGEgc3Vic2V0IG9mKSBrYW5zbydzIGRiIG1vZHVsZQogICAgICogQHBhcmFtIHNlc3Npb257T2JqZWN0fSBpbXBsZW1lbnRzIChhIHN1YnNldCBvZikga2Fuc28ncyBzZXNzaW9uIG1vZHVsZQogICAgICogQHBhcmFtIHV1aWR7ZnVuY3Rpb259IHJldHVybnMgYSB1dWlkIHN5bmNocm9uaW91c2x5CiAgICAgKi8KICAgIGV4cG9ydHMuX21ha2VfcGVyc2lzdCA9IGZ1bmN0aW9uKGRiLCBzZXNzaW9uLCB1dWlkLCBfZGVidWcpIHsKICAgICAgICBwZXJzaXN0ID0ge307CiAgICAgICAgcGVyc2lzdC4kID0galF1ZXJ5OwoKICAgICAgICAvL2xvZyBlcnJvcnMgKHVzZWQgdG8gd3JhcCBjYWxsYmFja3MgZnJvbSBkYiAmIHNlc3Npb24pCiAgICAgICAgdmFyIF9kZWJ1Z193cmFwID0gZnVuY3Rpb24obmFtZSwgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCBlcnJvciApIHsKICAgICAgICAgICAgICAgICAgICBfZGVidWcoe21zZzonbnJhbWFfJytuYW1lKyc6IGVycm9yJyxlcnJvcjplcnJvcn0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIAogICAgICAgIC8qKgogICAgICAgICAqIHNhdmUgYSBub3RlIG9yIGEgcXVvdGUgKG9yIHRoYXQgSlNPTi5zdHJpbmdpZnkgd2lsbCB3b3JrIG9uLCByZWFsbHkpLgogICAgICAgICAqIE5COiBJZiBzdWNjZXNzZnVsLCB3aWxsIHVwZGF0ZSBhIF9yZXYgcHJvcGVydHkgb24gdGhpbmcgYW5kIGluc2VydCBfaWQKICAgICAgICAgKiBOQjogaWYgb3B0aW9ucy5jbG9uZV9vbl9jb25mbGljdCwgQHBhcmFtIHRoaW5nIHdpbGwgaGF2ZSBpdHMgcHJvcGVydGllcyB1cGRhdGVkICBpbmNsLiBuZXcgX2lkCiAgICAgICAgICovCiAgICAgICAgcGVyc2lzdC5zYXZlID0gZnVuY3Rpb24odGhpbmcsIG9wdGlvbnMvKm9wdGlvbmFsKi8sIGNhbGxiYWNrLypyZXF1aXJlZCovICkgewogICAgICAgICAgICBpZiggIWNhbGxiYWNrICkgewogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zOwogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGRlZmF1bHRzID0gewogICAgICAgICAgICAgICAgY2xvbmVfb25fY29uZmxpY3QgOiBmYWxzZSAgIC8vZS5nLiBzZXQgdG8gdHJ1ZSB1c2VkIHdoZW4gc2F2aW5nIG5vdGVzCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHBlcnNpc3QuJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsKCiAgICAgICAgICAgIGRiLnNhdmVEb2ModGhpbmcsIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCBlcnJvciApIHsKICAgICAgICAgICAgICAgICAgICBpZiggc2V0dGluZ3MuY2xvbmVfb25fY29uZmxpY3QgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBlcnJvci5zdGF0dXMgPT0gNDA5IHx8IGVycm9yLmVycm9yID09ICJjb25mbGljdCIpICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJzaXN0LiQubG9nKCducmFtYV9wZXJzaXN0LnNhdmU6IGNvbmZsaWN0IG9uIHNhdmUgZm9yICcrKHRoaW5nLnR5cGUgfHwgJycpKycgJyt0aGluZy5faWQrJyAtLS0gc3RhcnRlZCBjbG9uaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJzaXN0LmNsb25lKHRoaW5nLCBjYWxsYmFjayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgX2RlYnVnKHttc2c6J25yYW1hX3BlcnNpc3Quc2F2ZTogZXJyb3InLGVycm9yOmVycm9yfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaW5nLl9yZXYgPSBkYXRhLnJldjsKICAgICAgICAgICAgICAgICAgICB0aGluZy5faWQgPSBkYXRhLmlkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGRhdGEpOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBjcmVhdGUgYW5kIHBlcnNpc3QgYSBjbG9uZSBvZiBhIG5vdGUgb3IgcXVvdGUsIHVwZGF0aW5nIHRoZQogICAgICAgICAqIHBhc3NlZCB0aGluZyBpbiBwbGFjZS4KICAgICAgICAgKi8KICAgICAgICBwZXJzaXN0LmNsb25lID0gZnVuY3Rpb24odGhpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBuZXdfaWQgPSB1dWlkKCk7CiAgICAgICAgICAgIHZhciB1cGRhdGVzID0gewogICAgICAgICAgICAgICAgX2lkIDogbmV3X2lkLAogICAgICAgICAgICAgICAgcmVwbGFjZXNfaWQgOiB0aGluZy5faWQgfTsKICAgICAgICAgICAgdmFyIGNsb25lZF90aGluZyA9IHBlcnNpc3QuJC5leHRlbmQodHJ1ZSwge30sIHRoaW5nLCB1cGRhdGVzKTsgCiAgICAgICAgICAgIGRlbGV0ZSBjbG9uZWRfdGhpbmcuX3JldjsgIC8vcmV2aXNpb24gaXMgbm8gbG9uZ2VyIHZhbGlkCiAgICAgICAgICAgIHBlcnNpc3Quc2F2ZShjbG9uZWRfdGhpbmcsIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpbmcgPSBjbG9uZWRfdGhpbmc7ICAgLy9tZXNzeQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsZGF0YSk7ICAgCiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIGFzc3VtZXMgdGhhdCB0aGluZy50eXBlIChlLmcuICdzb3VyY2UnKSBpcyB0aGUgbmFtZSBvZiB0aGUgY291Y2hkYiB1cGRhdGUgZnVuY3Rpb24KICAgICAgICAgKiB0aGluZyBtdXN0IGhhdmUgLnR5cGUgYW5kIC5faWQgYXR0cmlidXRlcwogICAgICAgICAqLwogICAgICAgIHBlcnNpc3QudXBkYXRlID0gZnVuY3Rpb24odGhpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGRiLmRvVXBkYXRlKCB0aGluZywgZW5jb2RlVVJJQ29tcG9uZW50KCB0aGluZy50eXBlICksIF9kZWJ1Z193cmFwKCdwZXJzaXN0LnVwZGF0ZScsIGNhbGxiYWNrKSApOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIGRlbGV0ZXMgYSBxdW90ZSBvciBub3RlIGZyb20gdGhlIHNlcnZlciBwcm92aWRpbmcgaXQgaGFzIGEgJ19yZXYnIHByb3BlcnR5LgogICAgICAgICAqIGlmIG5vIF9yZXYgcHJvcGVydHksIG5vdGhpbmcgaGFwcGVucyBidXQgdGhpcyBpcyBjYWxsYmFjaydlZCBhcyBzdWNjZXNzLgogICAgICAgICAqICAod2UgZXhwbG9pdCB0aGlzIC0tIGFic2VuY2Ugb2YgX3JldiBtZWFucyBpdCdzIG5vdCBiZWVuIHBlcnNpc3RlZCkKICAgICAgICAgKi8KICAgICAgICBwZXJzaXN0LnJtID0gZnVuY3Rpb24odGhpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGlmKCAhdGhpbmcuX3JldiApIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHsgZGVsZXRlZDpmYWxzZSwgbWVzc2FnZTonbnJhbWFfcGVyc2lzdC5ybSBkaWQgbm90IGRlbGV0ZSBiZWNhdXNlICcrKHRoaW5nLnR5cGUgfHwnJykrJyAnKyh0aGluZy5faWQgfHwgJycpKycgaGFzIG5vIF9yZXYnfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGIucmVtb3ZlRG9jKHRoaW5nLCBfZGVidWdfd3JhcCgncGVyc2lzdC5ybScsY2FsbGJhY2spKTsKICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBsb2FkcyBkYXRhIGZvciBhIHBhZ2UgKGUuZy4gYWxsIHF1b3RlcykKICAgICAgICAgKiBAcGFyYW0gb3B0aW9ucy5wYWdlX2lkIGlzIHRoZSBwYWdlIHRvIGxvYWQgc3R1ZmYgZm9yIChyZXF1aXJlZCkKICAgICAgICAgKiBAcGFyYW0gb3B0aW9ucy50eXBle1N0cmluZ30gc3BlY2lmaWVzIHdoaWNoIHR5cGUgb2Ygb2JqZWN0cyB0byBsb2FkIChyZXF1aXJlZCkKICAgICAgICAgKiBAcGFyYW0gb3B0aW9ucy51c2VyX2lke1N0cmluZ30gW29wdGlvbmFsXSBvbWl0IGlmIGxvYWRpbmcgZm9yIGFsbCB1c2VycwogICAgICAgICAqLwogICAgICAgIHBlcnNpc3QubG9hZCA9IGZ1bmN0aW9uKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBkZWZhdWx0cyA9IHsKICAgICAgICAgICAgICAgIHBhZ2VfaWQgOiB1bmRlZmluZWQsIHR5cGUgOiBudWxsLCB1c2VyX2lkIDogbnVsbCwKICAgICAgICAgICAgICAgIHN1Y2Nlc3MgOiBudWxsLCBlcnJvciA6IG51bGwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGxvYWRfc2V0dGluZ3MgPSBwZXJzaXN0LiQuZXh0ZW5kKHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7CiAgICAgICAgICAgIAogICAgICAgICAgICB2YXIgcXVlcnk7CiAgICAgICAgICAgIGlmKCAhbG9hZF9zZXR0aW5ncy50eXBlICkgewogICAgICAgICAgICAgICAgcXVlcnkgPSB7c3RhcnRrZXk6J1siJytsb2FkX3NldHRpbmdzLnBhZ2VfaWQrJyJdJywgZW5ka2V5OidbIicrbG9hZF9zZXR0aW5ncy5wYWdlX2lkKyciLHt9XSd9OwogICAgICAgICAgICB9IGVsc2UgeyAvL3R5cGUgaXMgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICBpZiggIWxvYWRfc2V0dGluZ3MudXNlcl9pZCApIHsKICAgICAgICAgICAgICAgICAgICBxdWVyeSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRrZXk6J1siJytsb2FkX3NldHRpbmdzLnBhZ2VfaWQrJyIsIicrbG9hZF9zZXR0aW5ncy50eXBlKyciXScsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZGtleTonWyInK2xvYWRfc2V0dGluZ3MucGFnZV9pZCsnIiwiJytsb2FkX3NldHRpbmdzLnR5cGUrJyIse31dJwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9IGVsc2UgeyAgICAvL3R5cGUgYW5kIHVzZXJfaWQgYXJlIHNwZWNpZmllZAogICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0ge2tleTonWyInK2xvYWRfc2V0dGluZ3MucGFnZV9pZCsnIiwiJytsb2FkX3NldHRpbmdzLnR5cGUrJyIsIicrbG9hZF9zZXR0aW5ncy51c2VyX2lkKyciXScgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBkYi5nZXRWaWV3KCdwYWdlSWRfdHlwZV91c2VySWQnLCBxdWVyeSwgX2RlYnVnX3dyYXAoJ3BlcnNpc3QubG9hZCcsY2FsbGJhY2spKTsKICAgICAgICB9OwogICAgCiAgICAgICAgcmV0dXJuIHBlcnNpc3Q7CiAgICB9OwoKCiAgICAvKioKICAgICAqIFdheXMgb2Ygc2VyaWFsaXppbmcgYW5kIHJlc3RvcmluZyByYW5neSByYW5nZSBvYmplY3RzLgogICAgICogVGhlc2Ugd291bGQgaWRlYWxseSB3b3JrIGFjcm9zcyBicm93c2VyczsgcmFuZ3lfMV8yIGNsYWltcyBub3QgdG8uICAKICAgICAqIChIYXZpbmcgbXVsdGlwbGUgd2F5cyBhbGxvdyB1cyB0byB1cGdyYWRlIHRoZSBtZXRob2Qgb2Ygc2VyaWFsaXphdGlvbgogICAgICogd2hpbGUgc3RpbGwgYmVpbmcgYWJsZSB0byBjb3JyZWN0bHkgZGVzZXJpYWxpemUgcXVvdGVzIGNyZWF0ZWQgd2l0aCBvbGRlcgogICAgICogbWV0aG9kcy4pCiAgICAgKiBAcGFyYW0gbGlie21hcH0gcHJvdmlkZXMgcmFuZ3kKICAgICAqLwogICAgZXhwb3J0cy5fbWFrZV9zZXJpYWxpemVycyA9IGZ1bmN0aW9uKHNldHRpbmdzLCBsaWIpewogICAgICAgIHZhciBzZXJpYWxpemVycyA9IHsKICAgICAgICAgICAgcmFuZ3lfMV8yIDogewogICAgICAgICAgICAgICAgaWQgOiAncmFuZ3lfMV8yJywgICAvLyBpZCBtdXN0IG1hdGNoIHRoZSBuYW1lCiAgICAgICAgICAgICAgICBzZXJpYWxpemUgOiBmdW5jdGlvbihyYW5nZSkgewogICAgICAgICAgICAgICAgICAgIC8vIHNlY29uZCBwYXJhbSBtZWFucyBkbyBub3QgY29tcHV0ZSBjaGVja3N1bSAoYmVjYXVzZSBhZGRpbmcgaGlnaGxpZ2h0cyB0byBwYWdlIHNjcmV3cyBpdCB1cCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGliLnJhbmd5LnNlcmlhbGl6ZVJhbmdlKHJhbmdlLCB0cnVlLCBzZXR0aW5ncy5yb290X25vZGUpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlc2VyaWFsaXplIDogZnVuY3Rpb24odGV4dCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBsaWIucmFuZ3kuZGVzZXJpYWxpemVSYW5nZSh0ZXh0LCBzZXR0aW5ncy5yb290X25vZGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNlcmlhbGl6ZXJzLmN1cnJlbnQgPSBzZXJpYWxpemVycy5yYW5neV8xXzI7ICAgLy8gdGhlIHNlcmlhbGl6ZXIgdG8gYmUgdXNlZCBpbiBjcmVhdGluZyBuZXcgcXVvdGVzCiAgICAgICAgcmV0dXJuIHNlcmlhbGl6ZXJzOwogICAgfTsKCgoKICAgIC8qKgogICAgICogZm9yIGVhY2ggcGFnZV9pZCB3aXRoIG5vdGVzLCBlYWNoIHVzZXIgbXVzdCBjcmVhdGUgYSBzb3VyY2UuICAKICAgICAqICBAcGFyYW0gbGlie21hcH0gcHJvdmlkZXMgZGVwZW5kZW5jaWVzIDogCiAgICAgKiAgICAtIGI2NF9obWFjX21kNSAgICBmcm9tIG1kNS5qcyAKICAgICAqICAgIC0gQmlidGV4UGFyc2VyICAgIGZyb20gYmlidGV4LmpzCiAgICAgKiAgICAtICQgICAgICAgICAgICAgICBmcm9tIGpRdWVyeQogICAgICovCiAgICBleHBvcnRzLl9tYWtlX3NvdXJjZXMgPSBmdW5jdGlvbihzZXR0aW5ncywgcGVyc2lzdCwgX2RlYnVnLCBsaWIvKm9wdGlvbmFsKi8pIHsKICAgICAgICB2YXIgc291cmNlcyA9IHt9OwogICAgICAgIGxpYi4kLmV4dGVuZChzb3VyY2VzLCBsaWIpOyAvL2FkZCBsaWIuYjY0X2htYWNfbWQ1IGV0YyB0byBzb3VyY2VzCiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybnMgdGhlIGlkIG9mIGEgc291cmNlIHJlY29yZCBmb3IgdGhlIHVzZXIgYW5kIHBhZ2UKICAgICAgICAgKiBAcGFyYW0gb3ttYXB9IHNob3VsZCBjb250YWluIHVzZXJfaWQgYW5kIHBhZ2VfaWQKICAgICAgICAgKi8KICAgICAgICBzb3VyY2VzLmNhbGN1bGF0ZV9pZCA9IGZ1bmN0aW9uKG8pIHsKICAgICAgICAgICAgcmV0dXJuICdzb3VyY2VfJytzb3VyY2VzLmI2NF9obWFjX21kNShvLnVzZXJfaWQsIG8ucGFnZV9pZCk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0gYXR0cnMgbXVzdCBjb250YWluIHBhZ2VfaWQgJiB1c2VyX2lkIDsgY2FuIGJlIG5vdGUgb3IgcXVvdGUKICAgICAgICAgKi8KICAgICAgICBzb3VyY2VzLmNyZWF0ZSA9IGZ1bmN0aW9uKGF0dHJzKSB7CiAgICAgICAgICAgIHZhciBkZWZhdWx0cyA9IHsKICAgICAgICAgICAgICAgIHRhZ3MgOiBbXSAgICAgLy90aGUgcGVyc2lzdC51cGRhdGUgd2lsbCBhcHBlbmQsIG5vdCByZW1vdmUgdGFncwogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiggc2V0dGluZ3MuaXNfZW1iZWRkZWQgKSB7CiAgICAgICAgICAgICAgICBkZWZhdWx0cy5wYWdlX3RpdGxlID0gZG9jdW1lbnQudGl0bGU7CiAgICAgICAgICAgICAgICBkZWZhdWx0cy51cmwgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBzb3VyY2UgPSBzb3VyY2VzLiQuZXh0ZW5kKHRydWUsIGRlZmF1bHRzLCBhdHRycyk7CiAgICAgICAgICAgIHNvdXJjZS5faWQgPSBzb3VyY2VzLmNhbGN1bGF0ZV9pZChzb3VyY2UpOyAgLy9uYiBtdXN0IG92ZXJ3cml0ZSBfaWQgaW4gY2FzZSBjYWxsZWQgd2l0aCBub3RlIG9yIHF1b3RlIG9iamVjdCEKICAgICAgICAgICAgc291cmNlLnR5cGUgPSAnc291cmNlJzsKICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlIG9yIHVwZGF0ZSBhIHNvdXJjZS4KICAgICAgICAgKiBAcGFyYW0gc291cmNlIG11c3QgY29udGFpbiAoVElUTEUgb3IgcGFnZV90aXRsZSksIHVybCwgcGFnZV9pZAogICAgICAgICAqICAgICAgJiB1c2VyX2lkIGlmIHVwZGF0ZSBpcyBiZWluZyBjYWxsZWQgdG8gY3JlYXRlIGEgbmV3IHNvdXJjZQogICAgICAgICAqIENhbiBiZSBjYWxsZWQgd2l0aCBlaXRoZXIgYSBzb3VyY2Ugb3IgYSBub3RlIG9yIGEgcXVvdGUKICAgICAgICAgKiBDYXV0aW9uOiBpZiBjYWxsZWQgd2l0aCBzb3VyY2UsIHNvdXJjZSB3aWxsIGJlIG1vZGlmaWVkIGluIHBsYWNlLgogICAgICAgICAqLwogICAgICAgIHNvdXJjZXMudXBkYXRlID0gZnVuY3Rpb24odGhpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBzb3VyY2UgPSAoIHRoaW5nLnR5cGUgPT0gJ3NvdXJjZScgPyB0aGluZyA6IHNvdXJjZXMuY3JlYXRlKHRoaW5nKSApOwogICAgICAgICAgICBwZXJzaXN0LnVwZGF0ZShzb3VyY2UsIGNhbGxiYWNrKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIGNhbGwgdXBkYXRlIG9uY2UgcGVyIHNvdXJjZSBvbmx5IChidXQgaWYgaXQgZmFpbHMsIHdpbGwgcmVwZWF0IG5leHQKICAgICAgICAgKiB0aW1lIGl0IGlzIGNhbGxlZCkKICAgICAgICAgKiBjYW4gYmUgY2FsbGVkIHdpdGggZWl0aGVyIGEgc291cmNlIG9yIGEgbm90ZSBvciBhIHF1b3RlIAogICAgICAgICAqLwogICAgICAgIHZhciBfdXBkYXRlX21lbW8gPSBbXTsKICAgICAgICBzb3VyY2VzLnVwZGF0ZV9vbmNlID0gZnVuY3Rpb24odGhpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBzb3VyY2VfaWQgPSAoIHRoaW5nLnR5cGUgPT0gJ3NvdXJjZScgPyB0aGluZy5faWQgOiB0aGluZy5zb3VyY2VfaWQgKTsKICAgICAgICAgICAgdmFyIGFscmVhZHlfZG9uZSA9ICggc291cmNlcy5fLmluZGV4T2YoX3VwZGF0ZV9tZW1vLCBzb3VyY2VfaWQpICE9IC0xICk7CiAgICAgICAgICAgIGlmKCBhbHJlYWR5X2RvbmUgICkgewogICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgJ2FscmVhZHkgZG9uZScpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNvdXJjZXMudXBkYXRlKHRoaW5nLCBmdW5jdGlvbihlcnJvciwgZGF0YSl7CiAgICAgICAgICAgICAgICBpZighZXJyb3IpewogICAgICAgICAgICAgICAgICAgIF91cGRhdGVfbWVtby5wdXNoKHNvdXJjZV9pZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgZGF0YSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogVGhpcyBzaG91bGQgcmV0dXJuIGFuIGFycmF5IG9mIHN0cmluZ3Mgd2hpY2ggY2Fub25pY2FsbHkgcmVwcmVzZW50IGF1dGhvcnMKICAgICAgICAgKiBAcGFyYW0gYXV0aG9yc3tzdHJpbmd9IGlzIHRoZSBhdXRob3JzLgogICAgICAgICAqIFRPRE86IG1ha2UgdGhpcyB3b3JrIChzZWUganMtYmlidGV4PykKICAgICAgICAgKi8KICAgICAgICB2YXIgX3BhcnNlX2F1dGhvcnMgPSBmdW5jdGlvbiggYXV0aG9ycy8qU3RyaW5nKi8gKSB7CiAgICAgICAgICAgIF9kZWJ1Zyh7YXV0aG9yczphdXRob3JzfSk7CiAgICAgICAgICAgIHJldHVybiBhdXRob3JzLnNwbGl0KCcgYW5kICcpOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogcXVpY2tseSBhdHRlbXB0IHRvIGd1ZXNzIHdoZXRoZXIgc29tZXRoaW5nIGlzIGJpYnRleAogICAgICAgICAqLwogICAgICAgIC8vIGxpa2UgdGhpczogQHRleHQgeyA9ICwgfQogICAgICAgIHZhciBfYmliX3JleCA9IC8oXnxbXjAtOUEtWiZcL1w/XSspKEApKFswLTlBLVpfXSpbQS1aX10rW2EtejAtOV9dKikoW1xzXFNdKj97KShbXHNcU10qPz0pKFtcc1xTXSo/LCkoW1xzXFNdKj99KS9naQogICAgICAgIHNvdXJjZXMuZGV0ZWN0X2JpYnRleCA9IGZ1bmN0aW9uKCB0ZXh0ICkgewogICAgICAgICAgICByZXR1cm4gISEoIHRleHQubWF0Y2goX2JpYl9yZXgpICk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIGdpdmVuIGEgc3RyaW5nLCBhdHRlbXB0cyB0byBwYXJzZSBpdCBhcyBiaWJ0ZXggYW5kIHVwZGF0ZSB0aGUgc291cmNlCiAgICAgICAgICogd2l0aCB0aGUgcmVzdWx0cy4KICAgICAgICAgKiBAcGFyYW0gdGhpbmcgY2FuIGJlIGEgc291cmNlLCBxdW90ZSBvciBub3RlCiAgICAgICAgICogRS5nLgogICAgICAgICAqICAgYj0nQGluY29sbGVjdGlvbntCYWlsbGFyZ2VvbjoxOTk1bHUsCUFkZHJlc3MgPSB7T3hmb3JkfSwJQXV0aG9yID0ge0JhaWxsYXJnZW9uLCBSZW57XCdlfWUgYW5kIEtvdG92c2t5LCBMYXVyYSBhbmQgTmVlZGhhbSwgQW15fSwJQm9va3RpdGxlID0ge0NhdXNhbCBjb2duaXRpb24uIEEgbXVsdGlkaXNjaXBsaW5hcnkgZGViYXRlfSwJRGF0ZS1BZGRlZCA9IHsyMDEwLTA4LTA0IDE3OjQwOjIxICswMTAwfSwJRGF0ZS1Nb2RpZmllZCA9IHsyMDEwLTA4LTA0IDE3OjQwOjM4ICswMTAwfSwJRWRpdG9yID0ge1NwZXJiZXIsIERhbiBhbmQgUHJlbWFjaywgRGF2aWR9LAlQYWdlcyA9IHs3OS0xMTV9LAlQdWJsaXNoZXIgPSB7Q2xhcmVuZG9ufSwJVGl0bGUgPSB7VGhlIEFjcXVpc2l0aW9uIG9mIFBoeXNpY2FsIEtub3dsZWRnZSBJbiBJbmZhbmN5fSwJWWVhciA9IHsxOTk1fX0nCiAgICAgICAgICovCiAgICAgICAgc291cmNlcy51cGRhdGVfZnJvbV9iaWJ0ZXggPSBmdW5jdGlvbihiaWJfc3RyLCB0aGluZywgY2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBzb3VyY2VzLkJpYnRleFBhcnNlcigpOwogICAgICAgICAgICB2YXIgcmVzdWx0czsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHBhcnNlci5zZXRJbnB1dChiaWJfc3RyKTsKICAgICAgICAgICAgICAgIHBhcnNlci5iaWJ0ZXgoKTsKICAgICAgICAgICAgICAgIHJlc3VsdHMgPSBwYXJzZXIuZ2V0RW50cmllcygpOwogICAgICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgICAgIF9kZWJ1ZygiY2F1Z2h0IGVycm9yIHBhcnNpbmcgYmlidGV4IixlKQogICAgICAgICAgICAgICAgY2FsbGJhY2soJ2Vycm9yIHBhcnNpbmcgYmlidGV4ICcrZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoIHNvdXJjZXMuXy5zaXplKHJlc3VsdHMpICE9IDEgKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjaygnbnJhbWFfc291cmNlcy5wYXJzZV9iaWJ0ZXg6IGlucHV0IGNvbnRhaW5lZCAnK3NvdXJjZXMuXy5zaXplKHJlc3VsdHMpKycgZW50cmllcyAoJytiaWJfc3RyKycpJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGVudHJ5ID0gc291cmNlcy5fLnRvQXJyYXkocmVzdWx0cylbMF07CiAgICAgICAgICAgIGlmKCBlbnRyeS5BVVRIT1IgKSB7CiAgICAgICAgICAgICAgICBlbnRyeS5BVVRIT1JfVEVYVCA9IGVudHJ5LkFVVEhPUjsKICAgICAgICAgICAgICAgIGVudHJ5LkFVVEhPUiA9IF9wYXJzZV9hdXRob3JzKGVudHJ5LkFVVEhPUl9URVhUKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbnRyeS5iaWJ0ZXggPSBiaWJfc3RyOwogICAgICAgICAgICB2YXIgc291cmNlID0gc291cmNlcy5jcmVhdGUodGhpbmcpOwogICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2VzLiQuZXh0ZW5kKHRydWUsIHt9LCBzb3VyY2UsIGVudHJ5KTsKICAgICAgICAgICAgc291cmNlcy51cGRhdGUoc291cmNlLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gc291cmNlczsKICAgIH07CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBUaGlzIGlzIG9ubHkgaW50ZW5kZWQgdG8gd29yayBlbWJlZGRlZCBpbiBhIHBhZ2UsIG5vdCBvbiB0aGUgc2VydmVyLgogICAgICogbGliIG11c3QgaW5jbHVkZQogICAgICAgICAgICBiNjRfaG1hY19tZDUgCiAgICAgICAgICAgIHJhbmd5IAogICAgICAgICAgICAkICggalF1ZXJ5ICkKICAgICAgICAgICAgXyA6IHdpbmRvdy5fCiAgICAgKi8KICAgIGV4cG9ydHMuX21ha2VfcXVvdGVzID0gZnVuY3Rpb24oc2V0dGluZ3MsIHV1aWQsIHBlcnNpc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXMsIHNlcmlhbGl6ZXJzLCBfZGVidWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYikgewogICAgICAgIHZhciBxdW90ZXMgPSB7fTsKICAgICAgICBsaWIuJC5leHRlbmQocXVvdGVzLCBsaWIpOyAgLy9hZGQgaXRlbXMgaW4gbGliIHRvIHF1b3RlcwoKICAgICAgICAvKioKICAgICAgICAgKiBAcmV0dXJucyBhIGhhc2ggZm9yIGRldGVybWluaW5nIHdoZXRoZXIgdHdvIHF1b3RlcyBhcmUgdGhlIHNhbWUKICAgICAgICAgKiAgICAgYWNyb3NzIGRpZmZlcmVudCB1c2Vycy4KICAgICAgICAgKi8KICAgICAgICBxdW90ZXMuY2FsY3VsYXRlX2hhc2ggPSBmdW5jdGlvbihxdW90ZSkgewogICAgICAgICAgICB2YXIgaGFzaCA9IHF1b3Rlcy5iNjRfaG1hY19tZDUocXVvdGUucGFnZV9pZCwgcXVvdGUuY29udGVudCk7CiAgICAgICAgICAgIHJldHVybiBoYXNoOwogICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIEBwYXJhbSByYW5nZSBpcyBhIFJhbmd5IHJhbmdlIG9iamVjdAogICAgICAgICAqLwogICAgICAgIHF1b3Rlcy5jcmVhdGUgPSBmdW5jdGlvbihyYW5nZSkgewogICAgICAgICAgICB2YXIgbmV3X3F1b3RlID0gewogICAgICAgICAgICAgICAgX2lkIDogJ3FfJyt1dWlkKCksICAKICAgICAgICAgICAgICAgIHR5cGUgOiAncXVvdGUnLAogICAgICAgICAgICAgICAgY29udGVudCA6IHF1b3Rlcy4kLnRyaW0oIHJhbmdlLnRvU3RyaW5nKCkgKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRfY29sb3IgOiBzZXR0aW5ncy5iYWNrZ3JvdW5kX2NvbG9yLAogICAgICAgICAgICAgICAgdXJsIDogZG9jdW1lbnQubG9jYXRpb24uaHJlZiwKICAgICAgICAgICAgICAgIHBhZ2VfaWQgOiBzZXR0aW5ncy5wYWdlX2lkLCAgCiAgICAgICAgICAgICAgICBwYWdlX3RpdGxlIDogZG9jdW1lbnQudGl0bGUsCiAgICAgICAgICAgICAgICAvL3RoZSB4cG9pbnRlciB0byB0aGUgcXVvdGUgKHdlbGwsIGl0IGlzbid0IGFjdHVhbGx5IGFuIHhwb2ludGVyIGJ1dCAgYW55IHNlcmlhbGl6ZWQgcmVwcmVzZW50YXRpb24gb2YgdGhlIHJhbmVnKQogICAgICAgICAgICAgICAgeHB0ciA6IHNlcmlhbGl6ZXJzLmN1cnJlbnQuc2VyaWFsaXplKHJhbmdlKSwKICAgICAgICAgICAgICAgIC8vdGhlIG5hbWUgb2YgdGhlIG1ldGhvZCB1c2VkIHRvIHNlcmFsaXNlCiAgICAgICAgICAgICAgICB4cHRyX21ldGhvZCA6IHNlcmlhbGl6ZXJzLmN1cnJlbnQuaWQsCiAgICAgICAgICAgICAgICBwYWdlX29yZGVyIDogcXVvdGVzLmNhbGN1bGF0ZV9wYWdlX29yZGVyKHJhbmdlKSwKICAgICAgICAgICAgICAgIGNyZWF0ZWQgOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSwKICAgICAgICAgICAgICAgIHVwZGF0ZWQgOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSwKICAgICAgICAgICAgICAgIHVzZXJfaWQgOiBzZXR0aW5ncy51c2VyX2lkCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG5ld19xdW90ZS5oYXNoID0gcXVvdGVzLmNhbGN1bGF0ZV9oYXNoKG5ld19xdW90ZSk7CiAgICAgICAgICAgIG5ld19xdW90ZS5zb3VyY2VfaWQgPSBzb3VyY2VzLmNhbGN1bGF0ZV9pZCh7CiAgICAgICAgICAgICAgICB1c2VyX2lkIDogbmV3X3F1b3RlLnVzZXJfaWQsCiAgICAgICAgICAgICAgICBwYWdlX2lkIDogbmV3X3F1b3RlLnBhZ2VfaWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBuZXdfcXVvdGU7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBxdW90ZXMuc2F2ZSA9IGZ1bmN0aW9uKHF1b3RlLCBvcHRpb25zLypvcHRpb25hbCovLCBjYWxsYmFjaykgewogICAgICAgICAgICBpZiggIWNhbGxiYWNrICkgewogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zOwogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vdXBkYXRlIHRoZSBzb3VyY2UgYmVmb3JlIHNhdmluZyBhbnkgcXVvdGVzCiAgICAgICAgICAgIHNvdXJjZXMudXBkYXRlX29uY2UocXVvdGUsIGZ1bmN0aW9uKGVycm9yLCBkYXRhKSB7CiAgICAgICAgICAgICAgICBpZiggZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgcXVvdGVzLiQubG9nKCdlcnJvciBpbiBucmFtYV9xdW90ZXMuc2F2ZSBpcyBkdWUgdG8gY2FsbCB0byBzb3VyY2VzLnVwZGF0ZV9vbmNlLicpCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGRhdGEpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBlcnNpc3Quc2F2ZShxdW90ZSwgb3B0aW9ucywgY2FsbGJhY2spOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIGF0dGVtcHQgdG8gaGlnaGxpZ2h0IHF1b3RlIGludG8gdGhlIEhUTUwgZG9jdW1lbnQuICBNYXkgZmFpbCBpZiByYW5nZQogICAgICAgICAqIGNhbm5vdCBiZSBkZWNvZGVkOyBmYWlscyBzaWxlbnRseS4gIE5vZGVzIGFkZGVkIHRvIHRoZSBET00gd2lsbCBoYXZlIHRoZQogICAgICAgICAqIHF1b3RlIG9iamVjdCBzdG9yZWQgd2l0aCBqUXVlcnkuZGF0YSAoa2V5OiducmFtYV9xdW90ZScpCiAgICAgICAgICoKICAgICAgICAgKiBDaGVja3MgdGhhdCBxdW90ZSBub3QgYWxyZWFkeSBvbiBwYWdlOyB3aWxsIG5vdCByZS1kaXNwbGF5IGlmIGl0IGlzLgogICAgICAgICAqCiAgICAgICAgICogZGVwZW5kcyBSYW5neSArIGl0cyBoaWdobGlnaHQgbW9kdWxlCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHN1Y2Nlc3NmdWwgKG9yIHF1b3RlIGFscmVhZHkgZGlzcGxheWVkKSwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgICAgICovCiAgICAgICAgcXVvdGVzLmRpc3BsYXkgPSBmdW5jdGlvbihxdW90ZSkgewogICAgICAgICAgICBpZiggcXVvdGVzLiQoJy4nK3F1b3RlLl9pZCkubGVuZ3RoICE9IDAgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsgIC8vcXVvdGUgYWxyZWFkeSBkaXNwbGF5ZWQKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcmFuZ2UgPSBxdW90ZXMuZ2V0X3JhbmdlKHF1b3RlKTsKICAgICAgICAgICAgaWYoIHJhbmdlID09IG51bGwgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIF9yYW5neV9oaWdobGlnaHRlciA9IHF1b3Rlcy5yYW5neS5jcmVhdGVDc3NDbGFzc0FwcGxpZXIoIl9ucmFtYS1xdW90ZSAiK3F1b3RlLl9pZCxmYWxzZSk7CiAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgIF9yYW5neV9oaWdobGlnaHRlci5hcHBseVRvUmFuZ2UocmFuZ2UpOwogICAgICAgICAgICB9IGNhdGNoKGVycm9yKSB7IC8vc2VlbXMgdG8gYmUgcmFyZQogICAgICAgICAgICAgICAgaWYoIHNldHRpbmdzLmRlYnVnICkgewogICAgICAgICAgICAgICAgICAgIHF1b3Rlcy4kLmxvZygibnJhbWE6IGVycm9yIHVzaW5nIFJhbmR5J3MgY3JlYXRlQ3NzQ2xhc3NBcHBsaWVyLmFwcGx5VG9SYW5nZSwgcmUtdGhyb3dpbmciKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAgIC8vc2lsZW50bHkgZmFpbCBpZiBub3QgaW4gZGVidWcgbW9kZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHF1b3Rlcy4kKCcuJytxdW90ZS5faWQpLmNzcygnYmFja2dyb3VuZC1jb2xvcicscXVvdGUuYmFja2dyb3VuZF9jb2xvcikuZGF0YSgnbnJhbWFfcXVvdGUnLHF1b3RlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiByZW1vdmUgYSBxdW90ZSdzIGhpZ2hsaWdodHMgZnJvbSB0aGUgSFRNTCBkb2N1bWVudC4KICAgICAgICAgKiBsZWF2ZXMgalF1ZXJ5LmRhdGEoJ25yYW1hX3F1b3RlJykgYW5kIF9pZCBhcyBjbGFzcyBpbnRhY3QsIHNvIHF1b3RlIGNhbgogICAgICAgICAqICAgc3RpbGwgYmUgZm91bmQgKHRvZG86IG5vdCBzdXJlIHRoaXMgaXMgYSBnb29kIGlkZWEhKS4KICAgICAgICAgKiB0b2RvIC0tIHRoaXMgd291bGQgaWRlYWxseSByZW1vdmUgdGhlIGVsZW1lbnRzIHNvIHRoYXQgc3Vic2VxdWVudCBxdW90ZXMKICAgICAgICAgKiAgaGFkIG1vcmUgcmVsaWFibGUgeHBvaW50ZXJzIChhcyBsb25nIGFzIHdlIGRvbid0IGhhdmUgYSB3YXkgb2YgZ2V0dGluZwogICAgICAgICAqICBnb29kIHhwb2ludGVycykuCiAgICAgICAgICovCiAgICAgICAgcXVvdGVzLnVuZGlzcGxheSA9IGZ1bmN0aW9uKHF1b3RlKSB7CiAgICAgICAgICAgIHF1b3Rlcy4kKCcuJytxdW90ZS5faWQpLgogICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoJ19ucmFtYS1xdW90ZScpLgogICAgICAgICAgICAgICAgY3NzKHsnYm9yZGVyLXRvcCc6J25vbmUnLCAnYm9yZGVyLWJvdHRvbSc6J25vbmUnLCAnYm94LXNoYWRvdyc6J25vbmUnfSkuCiAgICAgICAgICAgICAgICAvL3JlbW92ZUNsYXNzKHF1b3RlLl9pZCkuIC8vbm90IHN1cmUgd2hldGhlciBJIHdhbnQgdG8gZG8gdGhpcyB5ZXQKICAgICAgICAgICAgICAgIGNzcygnYmFja2dyb3VuZC1jb2xvcicsJ3JlZCcpLgogICAgICAgICAgICAgICAgYW5pbWF0ZSh7J2JhY2tncm91bmQtY29sb3InOidibGFjayd9LCBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIHF1b3Rlcy4kKHRoaXMpLmNzcygnYmFja2dyb3VuZC1jb2xvcicsJ2luaGVyaXQnKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgcXVvdGVzLmZsYXNoID0gZnVuY3Rpb24ocXVvdGVfaWQpIHsKICAgICAgICAgICAgdmFyICRxdW90ZV9ub2RlcyA9IHF1b3Rlcy4kKCcuJytxdW90ZV9pZCk7CiAgICAgICAgICAgICRxdW90ZV9ub2Rlcy5jc3Moeydib3JkZXItdG9wJzonMXB4IGRhc2hlZCBibGFjaycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JvcmRlci1ib3R0b20nOicxcHggZGFzaGVkIGJsYWNrJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYm94LXNoYWRvdyc6JzAgMCAyMHB4JyArIHNldHRpbmdzLmJhY2tncm91bmRfY29sb3IgfSk7CiAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAkcXVvdGVfbm9kZXMuY3NzKHsnYm9yZGVyLXRvcCc6J25vbmUnLCAnYm9yZGVyLWJvdHRvbSc6J25vbmUnLCAnYm94LXNoYWRvdyc6J25vbmUnfSk7ICAgICAgICAgICAgCiAgICAgICAgICAgIH0sNjAwKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIHJlcXVlc3QgcXVvdGUgZGVsZXRlIGZyb20gc2VydmVyIGFuZCByZW1vdmUgZnJvbSBwYWdlIGlmIHN1Y2Nlc3NmdWwKICAgICAgICAgKi8KICAgICAgICBxdW90ZXMucmVtb3ZlID0gZnVuY3Rpb24ocXVvdGUpIHsKICAgICAgICAgICAgcXVvdGVzLiQoJy4nK3F1b3RlLl9pZCkuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywnb3JhbmdlJyk7CiAgICAgICAgICAgIHBlcnNpc3Qucm0ocXVvdGUsIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgcXVvdGVzLnVuZGlzcGxheShxdW90ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogbG9hZCBxdW90ZXMgZnJvbSBzZXJ2ZXIgYW5kIGRpc3BsYXkgb24gdGhpcyBwYWdlCiAgICAgICAgICovCiAgICAgICAgcXVvdGVzLmxvYWQgPSBmdW5jdGlvbihwYWdlX2lkLCBjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgdXNlcl9pZCA9IHNldHRpbmdzLm1lX29ubHkgPyBzZXR0aW5ncy51c2VyX2lkIDogdW5kZWZpbmVkOwogICAgICAgICAgICBwZXJzaXN0LmxvYWQoewogICAgICAgICAgICAgICAgcGFnZV9pZCA6IHBhZ2VfaWQsCiAgICAgICAgICAgICAgICB0eXBlIDogJ3F1b3RlJywKICAgICAgICAgICAgICAgIHVzZXJfaWQgOiB1c2VyX2lkCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgJiYgZGF0YSApIHsKICAgICAgICAgICAgICAgICAgICBxdW90ZXMuJC5sb2coJ25yYW1hX3F1b3Rlcy5sb2FkIGdvdCAnICsgKCBkYXRhLnJvd3MgPyBkYXRhLnJvd3MubGVuZ3RoIDogMCApICsgJyBxdW90ZXMgZnJvbSBzZXJ2ZXIgZm9yIHVzZXIgJyt1c2VyX2lkKTsKICAgICAgICAgICAgICAgICAgICAvL25lZWQgdG8gc29ydCBxdW90ZXMgYnkgdGhlIHRpbWUgdGhleSB3ZXJlIGFkZGVkIHRvIHBhZ2UgZm9yIGJlc3QgY2hhbmNlIG9mIGRpc3BsYXlpbmcgdGhlbQogICAgICAgICAgICAgICAgICAgIHZhciBfc29ydGVyID0gZnVuY3Rpb24oYSxiKXsgcmV0dXJuIGEudmFsdWUuY3JlYXRlZCAtIGIudmFsdWUuY3JlYXRlZCB9OwogICAgICAgICAgICAgICAgICAgIGRhdGEucm93cy5zb3J0KF9zb3J0ZXIpOwogICAgICAgICAgICAgICAgICAgIHZhciBfZmFpbGluZ19xdW90ZXMgPSBbXQogICAgICAgICAgICAgICAgICAgIHF1b3Rlcy4kLmVhY2goZGF0YS5yb3dzLCBmdW5jdGlvbihpbmRleCwgcm93KXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHF1b3RlID0gcm93LnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHF1b3Rlcy5kaXNwbGF5KHF1b3RlKTsgIC8vdGhpcyB3b24ndCByZS1kaXNwbGF5IHF1b3RlcyBhbHJlYWR5IHByZXNlbnQKICAgICAgICAgICAgICAgICAgICAgICAgaWYoICFzdWNjZXNzICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2ZhaWxpbmdfcXVvdGVzLnB1c2gocXVvdGUuX2lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmKCBfZmFpbGluZ19xdW90ZXMubGVuZ3RoID4gMCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVvdGVzLiQubG9nKCdmYWlsZWQgdG8gZGlzcGxheSAnK19mYWlsaW5nX3F1b3Rlcy5sZW5ndGgrJyBxdW90ZXMsIF9pZHM6ICcrX2ZhaWxpbmdfcXVvdGVzLmpvaW4oJ1xuXHQnKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGRhdGEpOwogICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybnMgdGhlIHJhbmdlIGZvciB0aGUgc3BlY2lmaWVkIHF1b3RlIG9yIG51bGwgaWYgbm90IHBvc3NpYmxlLgogICAgICAgICAqIGNhdXRpb246IHRoaXMgbWF5IGZhaWwgb25jZSB0aGUgcXVvdGUgaGFzIGJlZW4gaGlnaGxpZ2h0ZWQhCiAgICAgICAgICovCiAgICAgICAgcXVvdGVzLmdldF9yYW5nZSA9IGZ1bmN0aW9uKHF1b3RlKSB7CiAgICAgICAgICAgIHZhciBtZXRob2QgPSBxdW90ZS54cHRyX21ldGhvZCB8fCAnX21ldGhvZF91bnNwZWNpZmllZCc7IC8vbWV0aG9kIGZvciByZWNvdmVyaW5nIHRoZSByYW5nZSBmcm9tIHRoZSBxdW90ZQogICAgICAgICAgICBpZiggISAobWV0aG9kIGluIHNlcmlhbGl6ZXJzKSApIHsKICAgICAgICAgICAgICAgIHF1b3Rlcy4kLmxvZygndW5rbm93biB4cHRyX21ldGhvZCAoJyttZXRob2QrJykgZm9yIHF1b3RlICcrcXVvdGUuX2lkKTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgc2VyaWFsaXplciA9IHNlcmlhbGl6ZXJzW21ldGhvZF07CiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWFsaXplci5kZXNlcmlhbGl6ZShxdW90ZS54cHRyKTsKICAgICAgICAgICAgfSBjYXRjaChlcnJvcikgewogICAgICAgICAgICAgICAgLy9xdW90ZXMuJC5sb2coJ25yYW1hX3F1b3Rlcy5kaXNwbGF5IEZBSUwgd2l0aCByYW5nZSA9ICcrcXVvdGUueHB0cisnXG5cdCBmb3IgcXVvdGUgJytxdW90ZS5faWQpOwogICAgICAgICAgICAgICAgLy9fZGVidWcoe2NhdGNoX2Vycm9yOmVycm9yfSk7ICAvL25vdCB1c3VhbGx5IGluZm9ybWF0aXZlCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybnMgYSBxdW90ZSBvYmplY3QgKG9yIG51bGwgaWYgbm90IGZvdW5kKQogICAgICAgICAqLwogICAgICAgIHF1b3Rlcy5nZXRfZnJvbV9wYWdlID0gZnVuY3Rpb24ocXVvdGVfaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHF1b3Rlcy4kKCcuJytxdW90ZV9pZCkuZmlyc3QoKS5kYXRhKCducmFtYV9xdW90ZScpIHx8IG51bGw7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0gcmFuZ2V7UmFuZ3l9CiAgICAgICAgICogQHJldHVybnMgYW4gYXJyYXkgcmVwcmVzZW50aW5nIHRoZSBvcmRlciB0aGlzIHF1b3RlIHByb2JhYmx5IGFwcGVhcnMKICAgICAgICAgKiBvbiB0aGUgcGFnZS4gIEFzc3VtZXMgdGhhdCBlYXJsaWVyIGluIERPTSBtZWFucyBlYXJsaWVyIG9uIHNjcmVlbi4KICAgICAgICAgKiAodGhlIGFsdGVybmF0aXZlIHdvdWxkIGJlIHRvIHVzZSBoZWlnaHQsIGJ1dCB0aGF0IGZhaWxzIGZvciBjb2x1bW5zCiAgICAgICAgICogJiB2YXJ5aW5nIGhlaWdodCkKICAgICAgICAgKi8KICAgICAgICBxdW90ZXMuY2FsY3VsYXRlX3BhZ2Vfb3JkZXIgPSBmdW5jdGlvbiBjYWxjdWxhdGVfcGFnZV9vcmRlcihyYW5nZSkgewogICAgICAgICAgICB2YXIgZG9jX2hlaWdodCA9IHF1b3Rlcy4kKHNldHRpbmdzLnJvb3Rfbm9kZSkuaGVpZ2h0KCk7CiAgICAgICAgICAgIHZhciBkb2Nfd2lkdGggPSBxdW90ZXMuJChzZXR0aW5ncy5yb290X25vZGUpLndpZHRoKCk7CiAgICAgICAgICAgIC8vdG9kbwogICAgICAgICAgICB2YXIgbm9kZSA9IHJhbmdlLnN0YXJ0Q29udGFpbmVyOwogICAgICAgICAgICB2YXIgcGFnZV9vcmRlciA9IFtyYW5nZS5zdGFydE9mZnNldF07ICAgLy9jcmVhdGUgaW4gcmV2ZXJzZSBvcmRlciwgd2lsbCByZXZlcnNlIGl0CiAgICAgICAgICAgIHdoaWxlICggbm9kZSAmJiBub2RlICE9IGRvY3VtZW50LmJvZHkgKSB7CiAgICAgICAgICAgICAgICBwYWdlX29yZGVyLnB1c2gocXVvdGVzLnJhbmd5LmRvbS5nZXROb2RlSW5kZXgobm9kZSwgdHJ1ZSkpOwogICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYWdlX29yZGVyLnJldmVyc2UoKTsKICAgICAgICAgICAgcmV0dXJuIHBhZ2Vfb3JkZXI7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBjYWxjdWxhdGUgdGhlIG9mZnNldCAoLnRvcCwgLmxlZnQpIG9mIGEgcXVvdGUKICAgICAgICAgKi8KICAgICAgICBxdW90ZXMub2Zmc2V0ID0gZnVuY3Rpb24ocXVvdGVfaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHF1b3Rlcy4kKCcuJytxdW90ZV9pZCkuZmlyc3QoKS5vZmZzZXQoKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIHJldHVybiBxdW90ZXM7CiAgICB9OwogICAgCiAgICAKICAgIC8qKgogICAgICogIEBwYXJhbSBxdW90ZXMgY2FuIGJlIHNldCB0byBudWxsOyBpZiBwcm92aWRlZCBpdCBpcyB1c2VkIHRvIHBvc2l0aW9uIG5vZXMKICAgICAqLwogICAgZXhwb3J0cy5fbWFrZV9ub3RlcyA9IGZ1bmN0aW9uKHNldHRpbmdzLCB1dWlkLCBwZXJzaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlcywgcXVvdGVzLCBfZGVidWcpIHsKICAgICAgICB2YXIgbm90ZXMgPSB7fTsKICAgICAgICB2YXIgJCA9IGpRdWVyeTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgYSBuZXcgbm90ZSBmb3IgYSBzcGVjaWZpZWQgcXVvdGUuCiAgICAgICAgICovCiAgICAgICAgbm90ZXMuY3JlYXRlID0gZnVuY3Rpb24ocXVvdGUpewogICAgICAgICAgICB2YXIgbmV3X25vdGUgPSB7CiAgICAgICAgICAgICAgICBfaWQgOiAnbl8nK3V1aWQoKSwgIAogICAgICAgICAgICAgICAgdHlwZSA6ICdub3RlJywKICAgICAgICAgICAgICAgIGNvbnRlbnQgOiBzZXR0aW5ncy5ub3RlX2RlZmF1bHRfdGV4dCwKICAgICAgICAgICAgICAgIHF1b3RlX2lkIDogcXVvdGUuX2lkLAogICAgICAgICAgICAgICAgcXVvdGVfaGFzaCA6IHF1b3RlLmhhc2gsICAgIC8vY2FuIGF0dGFjaCB0byB0aGUgc2FtZSBxdW90ZSBmcm9tIG90aGVyIHVzZXJzCiAgICAgICAgICAgICAgICB0YWdzIDogW10sICAgICAgICAgICAgICAgICAgLy93aWxsIGNhY2hlIHRoZSAjcyB0byBzYXZlIHVzIHBhcnNpbmcgdGV4dCBpbiBjcmVhdGluZyBhIHZpZXcKICAgICAgICAgICAgICAgIGJhY2tncm91bmRfY29sb3IgOiBzZXR0aW5ncy5ub3RlX2JhY2tncm91bmRfY29sb3IsCiAgICAgICAgICAgICAgICB3aWR0aCA6IHNldHRpbmdzLm5vdGVfd2lkdGgsCiAgICAgICAgICAgICAgICBwYWdlX2lkIDogcXVvdGUucGFnZV9pZCwgIAogICAgICAgICAgICAgICAgY3JlYXRlZCA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLAogICAgICAgICAgICAgICAgdXBkYXRlZCA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLAogICAgICAgICAgICAgICAgdXNlcl9pZCA6IHF1b3RlLnVzZXJfaWQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbmV3X25vdGUuc291cmNlX2lkID0gc291cmNlcy5jYWxjdWxhdGVfaWQoewogICAgICAgICAgICAgICAgdXNlcl9pZCA6IG5ld19ub3RlLnVzZXJfaWQsCiAgICAgICAgICAgICAgICBwYWdlX2lkIDogbmV3X25vdGUucGFnZV9pZAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG5ld19ub3RlOwogICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIGV4dHJhY3QgdGFncyBmcm9tIG5vdGUKICAgICAgICAgKiBsb3NlbHkgYmFzZWQgb24gbGluZXMgMTA2LTcgb2YgaHR0cHM6Ly9yYXcuZ2l0aHViLmNvbS9iY2hlcnJ5L3R3aXR0ZXItdGV4dC1qcy9tYXN0ZXIvdHdpdHRlci10ZXh0LmpzCiAgICAgICAgICovCiAgICAgICAgdmFyIF9oYXNodGFnX3JlZ2V4ID0gLyhefFteMC05QS1aJlwvXD9dKykoI3zvvIMpKFswLTlBLVpfXSpbQS1aX10rW2EtejAtOV9dKikvZ2k7CiAgICAgICAgbm90ZXMuZ2V0X3RhZ3MgPSBmdW5jdGlvbihub3RlKSB7CiAgICAgICAgICAgIHZhciB0YWdzID0gW107CiAgICAgICAgICAgIG5vdGUuY29udGVudC5yZXBsYWNlKF9oYXNodGFnX3JlZ2V4LCBmdW5jdGlvbihtYXRjaCwgYmVmb3JlLCBoYXNoLCBoYXNoVGV4dCkgewogICAgICAgICAgICAgICAgdGFncy5wdXNoKGhhc2hUZXh0KTsgIAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHRhZ3M7CiAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgbm90ZXMuc2F2ZSA9IGZ1bmN0aW9uKG5vdGUsIG9wdGlvbnMvKm9wdGlvbmFsKi8sIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGlmKCAhY2FsbGJhY2sgKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9leHRyYWN0IGFuZCBzdG9yZSB0aGUgdGFncwogICAgICAgICAgICBub3RlLnRhZ3MgPSBub3Rlcy5nZXRfdGFncyhub3RlKTsKICAgICAgICAgICAgLy91cGRhdGUgdGhlIHNvdXJjZSBiZWZvcmUgc2F2aW5nIGFueSBxdW90ZXMKICAgICAgICAgICAgc291cmNlcy51cGRhdGVfb25jZShub3RlLCBmdW5jdGlvbihlcnJvciwgZGF0YSkgewogICAgICAgICAgICAgICAgaWYoIGVycm9yICkgewogICAgICAgICAgICAgICAgICAgICQubG9nKCdlcnJvciBpbiBucmFtYV9ub3Rlcy5zYXZlLCBkdWUgdG8gY2FsbCB0byBucmFtYV9zb3VyY2VzLnVwZGF0ZV9vbmNlLicpCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGRhdGEpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwZXJzaXN0LnNhdmUobm90ZSwgb3B0aW9ucywgY2FsbGJhY2spOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICB2YXIgX3ppbmRleF9jb3VudGVyID0gMTAwMDA7IC8vdXNlZCBmb3IgYnJpbmdpbmcgbm90ZXMgdG8gdGhlIGZyb250IGFuZCB0byBlbnN1cmUgbmV3IG5vdGVzIGFyZSBvbiB0b3AKICAgICAgICBub3Rlcy5icmluZ190b19mcm9udCA9IGZ1bmN0aW9uKCRub3RlKSB7CiAgICAgICAgICAgICRub3RlLmNzcygnei1pbmRleCcsIF96aW5kZXhfY291bnRlcisrKTsgIC8vbW92ZSBub3RlIHRvIGZyb25nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBkaXNwYWx5IGEgbm90ZSBvbiB0aGUgcGFnZSAtLSBpLmUuIGNyZWF0ZSBhbmQgc3R5bGUgdGhlIEhUTUwgYW5kIGFkZCBpdAogICAgICAgICAqIHRvIHRoZSBhcHByb3JpYXRlIHBhcnQgb2YgdGhlIGRvY3VtZW50ICh0aGUgI19ucmFtYV9ub3RlcykuCiAgICAgICAgICogSWYgbm90ZSBkb2VzIG5vdCBoYXZlIHBvc2l0aW9uIGluZm8gKGVpdGhlciBiZWNhdXNlIGl0IGlzIG5ld2x5IGNyZWF0ZWQsCiAgICAgICAgICogb3IgYmVjYXVzZSBpdCB3YXMgY3JlYXRlZCBvbiB0aGUgc2VydmVyKSwgYXR0ZW1wdCB0byBwb3NpdGlvbiBpdCBuZWFyIHRoZSBxdW90ZS4KICAgICAgICAgKi8KICAgICAgICBub3Rlcy5kaXNwbGF5ID0gZnVuY3Rpb24obm90ZSwgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgb3B0aW9uc19kZWZhdWx0cyA9IHsKICAgICAgICAgICAgICAgIGZvY3VzIDogdHJ1ZSAgICAgICAgLy9zZXQgZm9jdXMgdG8gdGhlIG5vdGUncyB0ZXh0YXJlYSBhZnRlciBjcmVhdGluZyBpdD8KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGRpc3BsYXlfc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgb3B0aW9uc19kZWZhdWx0cywgb3B0aW9ucyApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIGFwcGx5IHNvbWUgcG9zaXRpb25pbmcgZGVmYXVsdHMgdG8gbm90ZXMKICAgICAgICAgICAgdmFyIG5vdGVfZGVmYXVsdHMgPSB7fTsKICAgICAgICAgICAgdmFyIHZpZXdwb3J0X3dpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7CiAgICAgICAgICAgIC8vc2hpZnQgcXVvdGVzIGhvcml6b250YWxseSBieSAxLzMwIG9mIHZpZXdwb3J0X3dpZHRoCiAgICAgICAgICAgIHZhciByYW5kb21fc2hpZnQgPSBmdW5jdGlvbigpe3JldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqKHZpZXdwb3J0X3dpZHRoLzMwKSl9OwogICAgICAgICAgICB2YXIgbm90ZV9yaWdodF9nYXAgPSBNYXRoLm1pbigxNSwgdmlld3BvcnRfd2lkdGgvNjUpOwogICAgICAgICAgICBub3RlX2RlZmF1bHRzLmxlZnQgPSB2aWV3cG9ydF93aWR0aCAtIG5vdGVfcmlnaHRfZ2FwIC0gKG5vdGUud2lkdGggfHwgc2V0dGluZ3Mubm90ZV93aWR0aCkgLSByYW5kb21fc2hpZnQoKTsKICAgICAgICAgICAgLy90byBnZXQgZGVmYXVsdCBmb3IgdG9wIHdlIG5lZWQgcG9zaXRpb24gb2YgYXNzb2NpYXRlZCBxdW90ZSAtLS0gb25seSBjb21wdXRlIHRoaXMgaWYgd2UgcmVhbGx5IG5lZWQgaXQKICAgICAgICAgICAgaWYoICFub3RlLnRvcCApIHsKICAgICAgICAgICAgICAgIHZhciBxdW90ZV9vZmZzZXQgPSBudWxsOwogICAgICAgICAgICAgICAgaWYoIG5vdGUucXVvdGVfaWQgJiYgcXVvdGVzICkgewogICAgICAgICAgICAgICAgICAgIHF1b3RlX29mZnNldCA9IHF1b3Rlcy5vZmZzZXQobm90ZS5xdW90ZV9pZCk7ICAgIC8vbWF5IHJldHVybiBudWxsIGlmIGNhbid0IGJlIGNvbXB1dGVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiggcXVvdGVfb2Zmc2V0ICkgewogICAgICAgICAgICAgICAgICAgIG5vdGVfZGVmYXVsdHMudG9wID0gcXVvdGVfb2Zmc2V0LnRvcCArIHJhbmRvbV9zaGlmdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBub3RlX2RlZmF1bHRzLnRvcCA9IDAgKyByYW5kb21fc2hpZnQoKTsgLy9wdXQgbm90ZSBhdCB0b3Agb2Ygc2NyZWVuIGlmIGNhbid0IGRvIGJldHRlcgogICAgICAgICAgICAgICAgICAgICQubG9nKCJucmFtYSB1bmFibGUgdG8gZ2V0IGRlZmF1bHQgcG9zaXRpb24gZm9yIG5vdGUgIiArIG5vdGUuX2lkICsgIiBiZWNhdXNlIG5vIHF1b3RlIG9mZnNldCBmb3VuZCBmb3IgcXVvdGUgIiArIG5vdGUucXVvdGVfaWQgKyAiKGhhcyB0aGUgcXVvdGUgYmVlbiBhZGRlZCB0byB0aGUgcGFnZT8pIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gCiAgICAgICAgICAgIG5vdGUgPSAkLmV4dGVuZCh0cnVlLCB7fSwgbm90ZV9kZWZhdWx0cywgbm90ZSApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0gY2hlY2sgdGhlIG5vdGUgY29udGFpbmVyIGRpdiBleGlzdHMsIGFwcGVuZCB0byBkb2N1bWVudC5ib2R5IGlmIG5vdAogICAgICAgICAgICBpZiggJCgnI19ucmFtYV9ub3RlcycpLmxlbmd0aCA9PSAwICkgewogICAgICAgICAgICAgICAgJCgnPGRpdiBpZD0iX25yYW1hX25vdGVzIj48L2Rpdj4nKS5hcHBlbmRUbygnYm9keScpLgogICAgICAgICAgICAgICAgICAgIGNzcyh7cG9zaXRpb246ImFic29sdXRlIiwgbGVmdDoiMHB4IiwgdG9wOiIwcHgiLHdpZHRoOiIwJSIsIGhlaWdodDoiMCUifSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLSBzdGFydCBwcm9wZXJseSBoZXJlCiAgICAgICAgICAgIGlmKCAkKCcjJytub3RlLl9pZCkubGVuZ3RoICE9IDAgKSB7ICAKICAgICAgICAgICAgICAgIG5vdGVzLnVuZGlzcGxheShub3RlKTsgLy9JZiBub3RlIGFscmVhZHkgZGlzcGxheWVkLCB1bmRpc3BsYXkgaXQgZmlyc3QuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHBvc19hdHRycyA9IHsKICAgICAgICAgICAgICAgICJwb3NpdGlvbiI6ImFic29sdXRlIiwKICAgICAgICAgICAgICAgICJsZWZ0Ijpub3RlLmxlZnQrInB4IiwKICAgICAgICAgICAgICAgICJ0b3AiOm5vdGUudG9wKyJweCIKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIHRleHRhcmVhID0gJCgnPHRleHRhcmVhPjwvdGV4dGFyZWE+JykuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsKG5vdGUuY29udGVudCkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzKHNldHRpbmdzLm5vdGVfZWRpdG9yX3N0eWxlKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmUoJ2JsdXInLCBub3Rlcy51cGRhdGVfb25fYmx1cikuICAvL21ha2Ugc3VyZSBlZGl0cyBhcmUgc2F2ZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvZ3JvdygpOwogICAgICAgICAgICB2YXIgaW5uZXJfZGl2ID0gJCgnPGRpdj48L2Rpdj4nKS5jc3Moc2V0dGluZ3Mubm90ZV9pbm5lcl9zdHlsZSkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kKHRleHRhcmVhKTsKICAgICAgICAgICAgdmFyIGVkaXRfbm90ZSA9ICQoJzxkaXY+PC9kaXYnKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyKCdpZCcsbm90ZS5faWQpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKCdfbnJhbWEtbm90ZScpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlUmVzZXRDU1MoKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3MocG9zX2F0dHJzKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3Moc2V0dGluZ3Mubm90ZV9zdHlsZSkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzKCd6LWluZGV4JyxfemluZGV4X2NvdW50ZXIrKykuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgbm90ZS5iYWNrZ3JvdW5kX2NvbG9yIHx8IHNldHRpbmdzLm5vdGVfYmFja2dyb3VuZF9jb2xvcikuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSgnbnJhbWFfbm90ZScsbm90ZSkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kKGlubmVyX2RpdikuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kVG8oJyNfbnJhbWFfbm90ZXMnKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGUoeyBjdXJzb3I6J21vdmUnLCBvcGFjaXR5OjAuNjYsIHN0b3A6bm90ZXMudXBkYXRlX29uX2RyYWcgfSkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlkZSgpLnNob3coInNjYWxlIix7fSwyMDAsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBkaXNwbGF5X3NldHRpbmdzLmZvY3VzICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGFyZWEuZm9jdXMoKS5zZWxlY3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogcmVtb3ZlIEhUTUwgbm9kZSByZXByZXNlbmluZyBub3RlIGZyb20gdGhlIHBhZ2UKICAgICAgICAgKi8KICAgICAgICBub3Rlcy51bmRpc3BsYXkgPSBmdW5jdGlvbihub3RlKSB7CiAgICAgICAgICAgICQoJyMnK25vdGUuX2lkKS5yZW1vdmUoKTsKICAgICAgICB9OwoKICAgICAgICAvLyAtLSBjYWxsIHRoaXMgdG8gcmUtZW5hYmxlIG5vdGUgd2hlbiBlcnJvciBzYXZpbmcgb3IgZGVsZXRpbmcKICAgICAgICB2YXIgX2ZpbmFsbHkgPSBmdW5jdGlvbiBfZmluYWxseSgkbm90ZSwgcmVzdG9yZV9iYWNrZ3JvdW5kICl7CiAgICAgICAgICAgIHZhciAkdGV4dGFyZWEgPSAkKCd0ZXh0YXJlYScsICRub3RlKTsKICAgICAgICAgICAgLy9tYWtlIGNoYW5nZXMgdG8gdGV4dGFyZWEgcG9zc2libGUgJiBlbnN1cmUgdGhleSB0cmlnZ2VyIHVwZGF0ZXMKICAgICAgICAgICAgJHRleHRhcmVhLnJlbW92ZUF0dHIoImRpc2FibGVkIik7CiAgICAgICAgICAgICR0ZXh0YXJlYS51bmJpbmQoJ2JsdXInLCBub3Rlcy51cGRhdGVfb25fYmx1cikub25lKCdibHVyJywgbm90ZXMudXBkYXRlX29uX2JsdXIpOyAgLy9tYWtlIHN1cmUgZWRpdHMgYXJlIHNhdmVkCiAgICAgICAgICAgIGlmKCByZXN0b3JlX2JhY2tncm91bmQgKSB7CiAgICAgICAgICAgICAgICAkdGV4dGFyZWEucGFyZW50cygnLl9ucmFtYS1ub3RlJykuY3NzKHtiYWNrZ3JvdW5kQ29sb3I6c2V0dGluZ3Mubm90ZV9iYWNrZ3JvdW5kX2NvbG9yfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIGV2ZW50IGhhbmRsZXIgZm9yIGJsdXIgZXZlbnQgb24gVEVYVEFSRUEgb2YgJG5vdGUKICAgICAgICAgKiBUaGlzIGhhbmRsZXMgZGlzcGxheSwgbG9naWMgJiBwZXJzaXN0ZW5jZS4KICAgICAgICAgKiBpZiAmIHdoZW4gc3VjY2Vzc2Z1bGx5IHBlcnNpc3RlZCwgdGhlIG5vdGUgaXMgc3RvcmVkIGFzIGEganF1ZXJ5LmRhdGEgYXR0cgogICAgICAgICAqIG9uIHRoZSAkbm90ZSAoa2V5Om5yYW1hX25vdGUpCiAgICAgICAgICovCiAgICAgICAgbm90ZXMudXBkYXRlX29uX2JsdXIgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciAkdGV4dGFyZWEgPSAkKHRoaXMpOwogICAgICAgICAgICAkdGV4dGFyZWEudW5iaW5kKCdibHVyJywgbm90ZXMudXBkYXRlX29uX2JsdXIpLgogICAgICAgICAgICAgICAgYXR0cigiZGlzYWJsZWQiLCAiZGlzYWJsZWQiKTsgICAvL2Rpc2FibGUgdGV4dCBhcmVhIHdoaWxlIGF0dGVtcHRpbmcgdG8gcGVyc2lzdAogICAgICAgICAgICAkbm90ZSA9ICR0ZXh0YXJlYS5wYXJlbnRzKCcuX25yYW1hLW5vdGUnKS5maXJzdCgpOwogICAgICAgICAgICAkbm90ZS5jc3MoJ2JhY2tncm91bmQtY29sb3InLCBzZXR0aW5ncy5wZXJzaXN0X3N0YXJ0ZWRfY29sb3IpOwogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC0tIGRlbGV0ZSBub3RlIGlmIG5vdGUgY29udGVudCBpcyBlbXB0eQogICAgICAgICAgICB2YXIgbmV3X2NvbnRlbnQgPSAkdGV4dGFyZWEudmFsKCk7CiAgICAgICAgICAgIGlmKCAkLnRyaW0obmV3X2NvbnRlbnQpID09ICcnICkgewogICAgICAgICAgICAgICAgJC5sb2coIm5yYW1hX25vdGVzLnVwZGF0ZSAtLSBkZWxldGluZyBub3RlICIrJG5vdGUuYXR0cignaWQnKSk7CiAgICAgICAgICAgICAgICBub3Rlcy5yZW1vdmUoJG5vdGUpOyAKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgdmFyIG5vdGUgPSAkbm90ZS5kYXRhKCducmFtYV9ub3RlJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLSBpZiBjb250ZW50IHVuY2hhbmdlZCwgZG8gbm90aGluZyAoc28gbW92aW5nIGEgbm90ZSB3b24ndCB0cmlnZ2VyIGEgY2hhbmdlKQogICAgICAgICAgICB2YXIgb2xkX2NvbnRlbnQgPSBub3RlLmNvbnRlbnQ7CiAgICAgICAgICAgIGlmKCBvbGRfY29udGVudCA9PSBuZXdfY29udGVudCApIHsKICAgICAgICAgICAgICAgIF9maW5hbGx5KCRub3RlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgCiAgICAgICAgICAgIHZhciB1cGRhdGVzID0gewogICAgICAgICAgICAgICAgY29udGVudCA6IG5ld19jb250ZW50LAogICAgICAgICAgICAgICAgdXBkYXRlZCA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmKCBzZXR0aW5ncy5pc19lbWJlZGRlZCApIHsKICAgICAgICAgICAgICAgICQuZXh0ZW5kKHVwZGF0ZXMsIHsKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kX2NvbG9yIDogc2V0dGluZ3Mubm90ZV9iYWNrZ3JvdW5kX2NvbG9yLAogICAgICAgICAgICAgICAgICAgIGxlZnQgOiAkbm90ZS5vZmZzZXQoKS5sZWZ0LAogICAgICAgICAgICAgICAgICAgIHRvcCA6ICRub3RlLm9mZnNldCgpLnRvcCwKICAgICAgICAgICAgICAgICAgICBkb2NfaGVpZ2h0IDogJChkb2N1bWVudCkuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgZG9jX3dpZHRoIDogJChkb2N1bWVudCkud2lkdGgoKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG5ld19ub3RlID0gJC5leHRlbmQodHJ1ZSwge30sIG5vdGUsIHVwZGF0ZXMpOyAgIAogICAgICAgICAgICAKICAgICAgICAgICAgbm90ZXMuc2F2ZShuZXdfbm90ZSwge2Nsb25lX29uX2NvbmZsaWN0OnRydWV9LCBmdW5jdGlvbihlcnJvcixkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCBlcnJvciApIHsKICAgICAgICAgICAgICAgICAgICAkbm90ZS5jc3Moe2JhY2tncm91bmRDb2xvciA6IHNldHRpbmdzLnBlcnNpc3RfZmFpbGVkX2NvbG9yfSk7CiAgICAgICAgICAgICAgICAgICAgX2ZpbmFsbHkoJG5vdGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8kLmxvZygibnJhbWFfbm90ZXMudXBkYXRlX29uX2JsdXI6IHdhcyBwZXJzaXN0ZWQgbm90ZSBfaWQ6IituZXdfbm90ZS5faWQrIiBmb3IgcXVvdGU6IituZXdfbm90ZS5xdW90ZV9pZCk7CiAgICAgICAgICAgICAgICAgICAgJG5vdGUuYXR0cignaWQnLG5ld19ub3RlLl9pZCk7IC8vbWF5IGhhdmUgY2hhbmdlZCAoc2F2ZSBjYW4gY2xvbmUpCiAgICAgICAgICAgICAgICAgICAgJG5vdGUgPSAkKCcjJytuZXdfbm90ZS5faWQpOyAgIC8vaGF2ZSB0byB1cGRhdGUgYWZ0ZXIgY2hhbmdpbmcgaWQgYXR0cmlidXRlCiAgICAgICAgICAgICAgICAgICAgJG5vdGUuZGF0YSgnbnJhbWFfbm90ZScsIG5ld19ub3RlKTsKICAgICAgICAgICAgICAgICAgICAvL2NoZWNrIGZvciBiaWJ0ZXggKGRvIHRoaXMgYWZ0ZXIgc2F2ZSB0byBhdm9pZCBjb25mbGljdHMpCiAgICAgICAgICAgICAgICAgICAgaWYoIHNvdXJjZXMuZGV0ZWN0X2JpYnRleChuZXdfbm90ZS5jb250ZW50KSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlcy51cGRhdGVfZnJvbV9iaWJ0ZXgobmV3X25vdGUuY29udGVudCwgbmV3X25vdGUsIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycrbm90ZS5faWQpLmNzcyh7Ym9yZGVyOicxcHggc29saWQgIzAxREYwMSd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2ZpbmFsbHkoICRub3RlLCB0cnVlICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9maW5hbGx5KCAkbm90ZSwgdHJ1ZSApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgbm90ZXMudXBkYXRlX29uX2RyYWcgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciAkdGV4dGFyZWEgPSAkKCd0ZXh0YXJlYScsICQodGhpcykgKS5maXJzdCgpOwogICAgICAgICAgICBpZiggJHRleHRhcmVhLmF0dHIoJ2Rpc2FibGVkJykgKSB7CiAgICAgICAgICAgICAgICAkLmxvZygnbnJhbWFfbm90ZXMudXBkYXRlX29uX2RyYWc6IHNhdmUgY3VycmVudGx5IGluIHByb2dyZXNzJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJC5sb2coIm5yYW1hX25vdGVzLnVwZGF0ZV9vbl9kcmFnIHN0YXJ0aW5nIik7CiAgICAgICAgICAgICR0ZXh0YXJlYS5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgIHZhciAkbm90ZSA9ICAkKHRoaXMpOwogICAgICAgICAgICB2YXIgbm90ZSA9ICRub3RlLmRhdGEoJ25yYW1hX25vdGUnKTsKICAgICAgICAgICAgdmFyIHVwZGF0ZXMgPSB7CiAgICAgICAgICAgICAgICBsZWZ0IDogJG5vdGUub2Zmc2V0KCkubGVmdCwKICAgICAgICAgICAgICAgIHRvcCA6ICRub3RlLm9mZnNldCgpLnRvcCwKICAgICAgICAgICAgICAgIGRvY19oZWlnaHQgOiAkKGRvY3VtZW50KS5oZWlnaHQoKSwKICAgICAgICAgICAgICAgIGRvY193aWR0aCA6ICQoZG9jdW1lbnQpLndpZHRoKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbm90ZSA9ICQuZXh0ZW5kKHRydWUsIG5vdGUsIHVwZGF0ZXMpOyAgIAogICAgICAgICAgICBub3Rlcy5zYXZlKG5vdGUsIHtjbG9uZV9vbl9jb25mbGljdDpmYWxzZX0sIGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIC8vZXJyb3JzIGFyZSBpZ25vcmVkIC0tIG5vdGUgbG9jYXRpb24gbm90IGNyaXRpY2FsCiAgICAgICAgICAgICAgICAkdGV4dGFyZWEucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiByZXF1ZXN0IGRlbGV0ZSBmcm9tIHNlcnZlciAmIHJlbW92ZSBmcm9tIGRvY3VtZW50IGlmIHN1Y2NlZWRzCiAgICAgICAgICovCiAgICAgICAgbm90ZXMucmVtb3ZlID0gZnVuY3Rpb24oJG5vdGUpIHsKICAgICAgICAgICAgdmFyIG5vdGVfaWQgPSAkbm90ZS5hdHRyKCdpZCcpOwogICAgICAgICAgICAkbm90ZS5jc3MoJ2JhY2tncm91bmQtY29sb3InLCdyZWQnKTsKICAgICAgICAgICAgdmFyIG5vdGUgPSAkbm90ZS5kYXRhKCducmFtYV9ub3RlJyk7CiAgICAgICAgICAgIHBlcnNpc3Qucm0obm90ZSwgZnVuY3Rpb24oZXJyb3IsIGRhdGEpewogICAgICAgICAgICAgICAgaWYoIGVycm9yICkgewogICAgICAgICAgICAgICAgICAgIF9maW5hbGx5KCRub3RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICQubG9nKCJucmFtYV9ub3Rlcy5yZW1vdmUgZGVsZXRlZCBub3RlICIrbm90ZV9pZCsiIGZyb20gc2VydmVyLiIpOwogICAgICAgICAgICAgICAgICAgICQoJyMnK25vdGVfaWQpLmhpZGUoJ3B1ZmYnLHt9LDMwMCtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqNjAwKSwgZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycrbm90ZV9pZCkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAKICAgICAgICAvKioKICAgICAgICAgKiBsb2FkIG5vdGVzIGZyb20gc2VydmVyIGFuZCBkaXNwbGF5IG9uIHRoaXMgcGFnZQogICAgICAgICAqIHJ1biBhZnRlciBxdW90ZXMgaGF2ZSBiZWVuIGxvYWRlZCBhbmQgZGlzcGxheWVkIGluIGNhc2Ugbm90ZXMgbmVlZCBwb3NpdGlvbmluZwogICAgICAgICAqLwogICAgICAgIG5vdGVzLmxvYWQgPSBmdW5jdGlvbihwYWdlX2lkLCBjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgdXNlcl9pZCA9IHNldHRpbmdzLm1lX29ubHkgPyBzZXR0aW5ncy51c2VyX2lkIDogdW5kZWZpbmVkOwogICAgICAgICAgICBwZXJzaXN0LmxvYWQoewogICAgICAgICAgICAgICAgcGFnZV9pZCA6IHBhZ2VfaWQsCiAgICAgICAgICAgICAgICB0eXBlIDogJ25vdGUnLAogICAgICAgICAgICAgICAgdXNlcl9pZCA6IHVzZXJfaWQKICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IsIGRhdGEpewogICAgICAgICAgICAgICAgaWYoIGVycm9yICkgewogICAgICAgICAgICAgICAgICAgIF9kZWJ1Zyh7bXNnOiducmFtYV9ub3Rlcy5sb2FkIGVycm9yOicsIGVycm9yOmVycm9yfSkKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJC5sb2coJ25yYW1hX25vdGVzLmxvYWQgZ290ICcgKyAoIGRhdGEgPyAoZGF0YS5yb3dzID8gZGF0YS5yb3dzLmxlbmd0aCA6IDAgKSA6IDApICsgJyBub3RlcyBmcm9tIHNlcnZlciBmb3IgdXNlciAnK3VzZXJfaWQpOwogICAgICAgICAgICAgICAgaWYoIGRhdGEgJiYgZGF0YS5yb3dzICkgewogICAgICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLnJvd3MsIGZ1bmN0aW9uKGluZGV4LHJvdyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub3RlID0gcm93LnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICBub3Rlcy5kaXNwbGF5KG5vdGUsIHtmb2N1czpmYWxzZX0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGRhdGEpOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBAcmV0dXJucyBfaWRzIG9mIG5vdGVzIGlmIEBwYXJhbSBxdW90ZSBoYXMgbm90ZXMgYXR0YWNoZWQKICAgICAgICAgKi8KICAgICAgICBub3Rlcy5maW5kID0gZnVuY3Rpb24ocXVvdGUpIHsKICAgICAgICAgICAgdmFyIF9pZHMgPSBbXTsKICAgICAgICAgICAgJCgnLl9ucmFtYS1ub3RlJykuZWFjaChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHJlbF9xdW90ZV9pZCA9ICQodGhpcykuZGF0YSgnbnJhbWFfbm90ZScpLnF1b3RlX2lkOwogICAgICAgICAgICAgICAgaWYoIHJlbF9xdW90ZV9pZCA9PSBxdW90ZS5faWQgKSB7CiAgICAgICAgICAgICAgICAgICAgX2lkcy5wdXNoKCQodGhpcykuYXR0cignaWQnKSk7ICAvL2FkZCBfaWQgb2YgdGhlIG5vdGUgdG8gdGhlIGxpc3QKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBfaWRzOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgcmV0dXJuIG5vdGVzOwogICAgfTsKICAgIAogICAgCiAgICAKICAgIAogICAgLyoqCiAgICAgKiBmb3IgZGlhbG9ncyAodG9kbyAtLSBtb3ZlIGV2ZW50IGhhbmRsZXJzKQogICAgICovCiAgICBleHBvcnRzLl9tYWtlX3VpID0gZnVuY3Rpb24oc2V0dGluZ3MsIHNlc3Npb24sIF9kZWJ1Zyl7CiAgICAgICAgdmFyICQgPSBqUXVlcnk7CiAgICAgICAgdmFyIHVpID0ge307CiAgICAgICAgCiAgICAgICAgdmFyIF91cGRhdGVfdXNlcl9pZCA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgaWYoIGRhdGEgJiYgZGF0YS51c2VyQ3R4ICYmIGRhdGEudXNlckN0eC5uYW1lICkgewogICAgICAgICAgICAgICAgdmFyIGxvZ2dlZF9pbl9hcyA9IGRhdGEudXNlckN0eC5uYW1lOwogICAgICAgICAgICAgICAgaWYoIGxvZ2dlZF9pbl9hcyAhPSBzZXR0aW5ncy51c2VyX2lkICkgewogICAgICAgICAgICAgICAgICAgIC8vdXNlcm5hbWUgaGFzIGNoYW5nZWQKICAgICAgICAgICAgICAgICAgICB1aS5kaWFsb2dzLndhcm5fdXNlcl9kaXNjcmVwYW5jeShsb2dnZWRfaW5fYXMpOwogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLnVzZXJfaWQgPSBsb2dnZWRfaW5fYXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIC8qKiAKICAgICAgICAgKiBtYXkgdXBkYXRlIHNldHRpbmdzLnVzZXJfaWQuICBtYXkgcmVzdWx0IGluIG1vZGFsIGRpYWxvZyB3YXJuaW5nCiAgICAgICAgICovCiAgICAgICAgdWkuaW5mbyA9IGZ1bmN0aW9uKGNhbGxiYWNrKXsKICAgICAgICAgICAgc2Vzc2lvbi5pbmZvKGZ1bmN0aW9uKGVycm9yLCBkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgX3VwZGF0ZV91c2VyX2lkKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsZGF0YSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogbWF5IHVwZGF0ZSBzZXR0aW5ncy51c2VyX2lkLiAgbWF5IHJlc3VsdCBpbiBtb2RhbCBkaWFsb2cgd2FybmluZwogICAgICAgICAqLwogICAgICAgIHVpLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkLCBjYWxsYmFjayl7CiAgICAgICAgICAgIHNlc3Npb24ubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkLCBmdW5jdGlvbihlcnJvcixkYXRhKXsKICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgX3VwZGF0ZV91c2VyX2lkKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsZGF0YSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgoKICAgICAgICB1aS5kaWFsb2dzID0ge307CiAgICAgICAgLyoqCiAgICAgICAgICogc3dpdGNoIHVzZXJfaWQgaWYgbG9nZ2VkIGluOyBvdGhlcndpc2UgY2hlY2sgd2hldGhlciBjb25maWd1cmVkIGZvcgogICAgICAgICAqIGFub255bW91cyB1c2VyIGFuZCByZXF1ZXN0IHVzZXIgdG8gbG9nIGluIGlmIG5vdC4KICAgICAgICAgKi8KICAgICAgICB1aS5kaWFsb2dzLmxvZ2luX2lmX25lY2Vzc2FyeSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHVpLmluZm8oIGZ1bmN0aW9uKGVycm9yLGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmKCBkYXRhICYmIGRhdGEudXNlckN0eCAmJiBkYXRhLnVzZXJDdHgubmFtZSApIHsKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCAnYWxyZWFkeSBsb2dnZWQgaW4nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy9ub3QgbG9nZ2VkIGluCiAgICAgICAgICAgICAgICAgICAgaWYoIHNldHRpbmdzLnVzZXJfaWQgJiYgc2V0dGluZ3MudXNlcl9pZFswXSA9PSAnKicgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vYW5vbnltb3VzCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsICdhbm9ueW1vdXMgdXNlcicpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpLmRpYWxvZ3MubG9naW4oc2V0dGluZ3MudXNlcl9pZCwgY2FsbGJhY2spOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBkaXNwYWx5IGEgbG9naW4gZGlhbG9nLgogICAgICAgICAqIEBwYXJhbSBjYWxsYmFja3tGdW5jdGlvbn0gd2lsbCBiZSBjYWxsZWQgd2l0aCBhbiBlcnJvciBpZiB0aGUgdXNlciBjYW5jZWxzLgogICAgICAgICAqLwogICAgICAgIHVpLmRpYWxvZ3MubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgbXNnLypvcHRpb25hbCovLCBjYWxsYmFjaykgewogICAgICAgICAgICBpZiggIWNhbGxiYWNrICkgewogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBtc2c7CiAgICAgICAgICAgICAgICBtc2cgPSAnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbGFzdF9lcnJvciA9IHttZXNzYWdlOid5b3UgY2FuY2VsbGVkJ307ICAvL3JlcG9ydCByZXN1bHRzIG9mIGxhc3QgZXJyb3IgaWYgdXNlciBjYW5jZWxzCiAgICAgICAgICAgIHZhciAkZGl2ID0gJCgnPGRpdj48aDI+PGEgaHJlZj0iaHR0cDovL3d3dy5ub3RlLW8tcmFtYS5jb20iIHRhcmdldD0iX2JsYW5rIj5Ob3RlLW8tcmFtYTwvYT4gOiBsb2dpbjwvaDI+PC9kaXY+Jyk7CiAgICAgICAgICAgICRkaXYuYXBwZW5kKCc8Zm9ybSBpZD0ibG9naW5fZm9ybSIgYWN0aW9uPSIvX3Nlc3Npb24iIG1ldGhvZD0iUE9TVCI+JyArCiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iZ2VuZXJhbF9lcnJvcnMiPicrbXNnKyc8L2Rpdj4nICsKICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJ1c2VybmFtZSBmaWVsZCI+JyArCiAgICAgICAgICAgICAgICAgICAgJzxsYWJlbCBmb3I9ImlkX25hbWUiPlVzZXJuYW1lPC9sYWJlbD4nICsKICAgICAgICAgICAgICAgICAgICAnPGlucHV0IGlkPSJpZF9uYW1lIiBuYW1lPSJuYW1lIiB0eXBlPSJ0ZXh0IiAvPicgKwogICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJlcnJvcnMiPiZuYnNwOzwvZGl2PicgKwogICAgICAgICAgICAgICAgJzwvZGl2PicgKwogICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9InBhc3N3b3JkIGZpZWxkIj4nICsKICAgICAgICAgICAgICAgICAgICAnPGxhYmVsIGZvcj0iaWRfcGFzc3dvcmQiPlBhc3N3b3JkPC9sYWJlbD4nICsKICAgICAgICAgICAgICAgICAgICAnPGlucHV0IGlkPSJpZF9wYXNzd29yZCIgbmFtZT0icGFzc3dvcmQiIHR5cGU9InBhc3N3b3JkIiAvPicgKwogICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJlcnJvcnMiPiZuYnNwOzwvZGl2PicgKwogICAgICAgICAgICAgICAgJzwvZGl2PicgKwogICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImFjdGlvbnMiPicgKwogICAgICAgICAgICAgICAgICAgICc8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0iaWRfY2FuY2VsIiB2YWx1ZT0iQ2FuY2VsIiAvPicgKwogICAgICAgICAgICAgICAgICAgICc8aW5wdXQgdHlwZT0ic3VibWl0IiBpZD0iaWRfbG9naW4iIHZhbHVlPSJMb2dpbiIgLz4nICsKICAgICAgICAgICAgICAgICc8L2Rpdj4nICsKICAgICAgICAgICAgJzwvZm9ybT4nKTsKICAgICAgICAgICAgJGRpdi5iZVJlc2V0Q1NTKCk7CiAgICAgICAgICAgICQoJy5nZW5lcmFsX2Vycm9ycywgLmVycm9ycycsICRkaXYpLmNzcyh7Y29sb3I6J3JlZCd9KTsKICAgICAgICAgICAgJCgnI2lkX25hbWUnLCRkaXYpLnZhbCh1c2VybmFtZXx8JycpOwogICAgICAgICAgICAkKCcjaWRfY2FuY2VsJywgJGRpdikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJC5tb2RhbC5jbG9zZSgpOwogICAgICAgICAgICAgICAgY2FsbGJhY2sobGFzdF9lcnJvcik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkKCdmb3JtJywgJGRpdikuc3VibWl0KGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHZhciB1c2VybmFtZSA9ICQoJ2lucHV0W25hbWU9Im5hbWUiXScsICRkaXYpLnZhbCgpOwogICAgICAgICAgICAgICAgdmFyIHBhc3N3b3JkID0gJCgnaW5wdXRbbmFtZT0icGFzc3dvcmQiXScsICRkaXYpLnZhbCgpOwogICAgICAgICAgICAgICAgJCgnLnVzZXJuYW1lIC5lcnJvcnMnLCAkZGl2KS50ZXh0KAogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID8gJyc6ICdQbGVhc2UgZW50ZXIgYSB1c2VybmFtZScKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkKCcucGFzc3dvcmQgLmVycm9ycycsICRkaXYpLnRleHQoCiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQgPyAnJzogJ1BsZWFzZSBlbnRlciBhIHBhc3N3b3JkJwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICh1c2VybmFtZSAmJiBwYXNzd29yZCkgewogICAgICAgICAgICAgICAgICAgIHVpLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZCwgZnVuY3Rpb24gKGVycm9yLCBkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9kZWJ1Zyh7ZXJyb3I6ZXJyb3J9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIGVycm9yICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9lcnJvciA9IGVycm9yOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yX21zZyA9IGVycm9yLm1lc3NhZ2UgfHwgIkVycm9yICIrKGVycm9yLnN0YXR1cyB8fCAnJykrIiBsb2dnaW5nIGluIChuZXR3b3JrIGNvbm5lY3Rpb24/KSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuZ2VuZXJhbF9lcnJvcnMnLCAkZGl2KS50ZXh0KGVycm9yX21zZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCRkaXYpLmZhZGVPdXQoJ3Nsb3cnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5tb2RhbC5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRkaXYubW9kYWwoc2V0dGluZ3Muc2ltcGxlbW9kYWwpOwogICAgICAgICAgICBfLmRlbGF5KCBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgaWYoIHVzZXJuYW1lICkgewogICAgICAgICAgICAgICAgICAgICQoJyNpZF9wYXNzd29yZCcpLmZvY3VzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIDUwICk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB1aS5kaWFsb2dzLndhcm5fdXNlcl9kaXNjcmVwYW5jeSA9IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGlmKCAhY2FsbGJhY2sgKSB7IGNhbGxiYWNrID0gZnVuY3Rpb24oKXt9OyB9CiAgICAgICAgICAgIHZhciB3aG8gPSBzZXR0aW5ncy51c2VyX2lkWzBdPT0nKicgPyAnYW5vbnltb3VzIHVzZXJzJyA6IHNldHRpbmdzLnVzZXJfaWQ7CiAgICAgICAgICAgICQubG9nKCd1c2VyIGxvZ2dlZCBpbiBhcyAnK25hbWUrJyBidXQgdGhpcyBib29rbWFya2xldCB3YXMgY29uZmlndXJlZCBmb3IgJyt3aG8gKTsKICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgJ25vdCBpbXBsZW1lbnRlZCB5ZXQnKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiB1aTsKICAgIH07CgoKICAgIC8qKgogICAgICogcHV0IG5yYW1hIHRvZ2V0aGVyIHdoZW4gdXNlZCBhcyBia21ya2x0IG9yIGVtYmVkZGVkIDxzY3JpcHQ+CiAgICAgKiAoc2VlIG5yYW1hMl9pbml0LmpzIGZvciB0aGUgY29ycmVzcG9uaW5nIGluaXQgZm9yIHRoZSBzZXJ2ZXIgcGFydHMpCiAgICAgKiBjYXV0aW9uOiBzb21lIGluaXQgcmVxdWlyZXMgcGFnZSBsb2FkIHRvIGJlIGNvbXBsZXRlCiAgICAgKiBAcGFyYW0gY2FsbGJhY2t7RnVuY3Rpb259IGlzIGNhbGxlZCB3aGVuIGluaXQgZG9uZS4KICAgICAqLwogICAgdmFyIF9ucmFtYV9pbml0ID0gZnVuY3Rpb24obnJhbWEsIGpRdWVyeSwgY2FsbGJhY2spIHsKICAgICAgICBucmFtYS4kID0galF1ZXJ5OwoKICAgICAgICBucmFtYS51dWlkID0gZXhwb3J0cy5fbWFrZV91dWlkKHV1aWQpOwoKICAgICAgICBucmFtYS5zZXR0aW5ncyA9IGV4cG9ydHMuX21ha2Vfc2V0dGluZ3MobnJhbWEudXVpZCk7CiAgICAgICAgLy9kZXRlY3QgdXNlciBpZiBzZXQgYnkgYmttcmtsdCBvciBzY3JpcHQgKHdpbGwgYmUgb3ZlcnJpZGVuIGJ5IHNlc3Npb24gY29va2llcykKICAgICAgICBpZiggdHlwZW9mIF9ucmFtYV91c2VyICE9PSAndW5kZWZpbmVkJyAmJiBfbnJhbWFfdXNlciApIHsKICAgICAgICAgICAgbnJhbWEuc2V0dGluZ3MudXNlcl9pZCA9IF9ucmFtYV91c2VyOwogICAgICAgIH0KCiAgICAgICAgbnJhbWEuX2RlYnVnID0gZXhwb3J0cy5fbWFrZV9kZWJ1ZyhucmFtYS5zZXR0aW5ncywgd2luZG93KTsKICAgICAgICBucmFtYS5sb2cgPSBleHBvcnRzLl9tYWtlX2xvZ2dpbmcobnJhbWEuc2V0dGluZ3MsIG5yYW1hLiQpOwogICAgICAgIG5yYW1hLnJwYyA9IGV4cG9ydHMuX21ha2VfcnBjKG5yYW1hLnNldHRpbmdzLCBlYXN5WERNLCBucmFtYS4kKTsKICAgICAgICBucmFtYS5kYiA9IGV4cG9ydHMuX21ha2VfZGIobnJhbWEucnBjLCBucmFtYS4kKTsKICAgICAgICBucmFtYS5zZXNzaW9uID0gZXhwb3J0cy5fbWFrZV9zZXNzaW9uKG5yYW1hLnJwYyk7CiAgICAgICAgbnJhbWEucGVyc2lzdCA9IGV4cG9ydHMuX21ha2VfcGVyc2lzdChucmFtYS5kYiwgbnJhbWEuc2Vzc2lvbiwgbnJhbWEudXVpZCwgbnJhbWEuX2RlYnVnKTsKICAgICAgICAKICAgICAgICB2YXIgbGliID0gewogICAgICAgICAgICBiNjRfaG1hY19tZDUgOiB3aW5kb3cuYjY0X2htYWNfbWQ1LAogICAgICAgICAgICByYW5neSA6IHdpbmRvdy5yYW5neSwKICAgICAgICAgICAgQmlidGV4UGFyc2VyIDogd2luZG93LkJpYnRleFBhcnNlciwKICAgICAgICAgICAgJCA6IGpRdWVyeSwKICAgICAgICAgICAgXyA6IHdpbmRvdy5fCiAgICAgICAgfTsKICAgICAgICBucmFtYS5zZXJpYWxpemVycyA9IGV4cG9ydHMuX21ha2Vfc2VyaWFsaXplcnMobnJhbWEuc2V0dGluZ3MsIGxpYik7CiAgICAgICAgbnJhbWEuc291cmNlcyA9IGV4cG9ydHMuX21ha2Vfc291cmNlcyhucmFtYS5zZXR0aW5ncywgbnJhbWEucGVyc2lzdCwgbnJhbWEuX2RlYnVnLCBsaWIpOwogICAgICAgIG5yYW1hLnF1b3RlcyA9IGV4cG9ydHMuX21ha2VfcXVvdGVzKG5yYW1hLnNldHRpbmdzLCBucmFtYS51dWlkLCBucmFtYS5wZXJzaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5yYW1hLnNvdXJjZXMsIG5yYW1hLnNlcmlhbGl6ZXJzLCBucmFtYS5fZGVidWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGliKTsKICAgICAgICBucmFtYS5ub3RlcyA9IGV4cG9ydHMuX21ha2Vfbm90ZXMobnJhbWEuc2V0dGluZ3MsIG5yYW1hLnV1aWQsIG5yYW1hLnBlcnNpc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5yYW1hLnNvdXJjZXMsIG5yYW1hLnF1b3RlcywgbnJhbWEuX2RlYnVnKTsKICAgICAgICBucmFtYS51aSA9IGV4cG9ydHMuX21ha2VfdWkobnJhbWEuc2V0dGluZ3MsIG5yYW1hLnNlc3Npb24sIG5yYW1hLl9kZWJ1Zyk7CgogICAgICAgIC8qKgogICAgICAgICAqIG1haW4gc2V0dXA6CiAgICAgICAgICogIC0gaW5pdCBkZXBlbmRlbmNpZXMgJiBucmFtYQogICAgICAgICAqICAtIGxvYWQgbm90ZXMgJiBxdW90ZXM7CiAgICAgICAgICogIC0gY29uZmlndXJlIGV2ZW50cyAoc2VsZWN0IHRvIGNyZWF0ZSBxdW90ZSwgZXRjKQogICAgICAgICAqLwogICAgICAgIG5yYW1hLiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBucmFtYS5zZXR0aW5ncy5wYWdlX2lkIGlzIGEgdmFsdWUgcy50LiB0d28gcGFnZSBpbnN0YW5jZXMgaGF2ZSB0aGUgc2FtZSBwYWdlX2lkIGV4YWN0bHkKICAgICAgICAgICAgICogICB3aGVuIHdlIHdhbnQgdG8gbG9hZCB0aGUgc2FtZSBub3RlcyAmIHF1b3RlcyBvbnRvIHRob3NlIHBhZ2VzLiAgVGhpcyBpcyByZWFsbHkKICAgICAgICAgICAgICogICBoYXJkIHRvIGNvbXB1dGUgKGUuZy4gRE9JIGhlbHBzIGJ1dCBpZiBkaWZmZXJlbnQgdXNlcnMgc2VlIGFuIGFydGljbGUgd2l0aAogICAgICAgICAgICAgKiAgIGRpZmZlcmVudCBmb3JtYXR0aW5nLCBzaG91bGQgd2UgbG9hZCB0aGUgc2FtZSBub3RlcyAmIHF1b3Rlcz8gIFByb2JhYmx5LikKICAgICAgICAgICAgICogSW4gZnV0dXJlIHRoaXMgbWlnaHQgYmUgZG9pIG9yIHNpbWlsYXIKICAgICAgICAgICAgICovCiAgICAgICAgICAgIG5yYW1hLnNldHRpbmdzLnBhZ2VfaWQgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wrIi8vIit3aW5kb3cubG9jYXRpb24uaG9zdCt3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7ICAvL3RoZSB1cmwgd2l0aCBubyA/cXVlcnkgb3IgI2FuY2hvciBkZXRhaWxzCiAgICAgICAgICAgIC8vcmVtb3ZlIHRyYWlsaW5nIHNsYXNoCiAgICAgICAgICAgIHZhciBsYXN0ID0gbnJhbWEuc2V0dGluZ3MucGFnZV9pZC5sZW5ndGgtMTsKICAgICAgICAgICAgaWYoIG5yYW1hLnNldHRpbmdzLnBhZ2VfaWRbbGFzdF09PScvJyApIHsKICAgICAgICAgICAgICAgIG5yYW1hLnNldHRpbmdzLnBhZ2VfaWQgPSBucmFtYS5zZXR0aW5ncy5wYWdlX2lkLnNsaWNlKDAsbGFzdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiB0aGlzIGlzIHRoZSBub2RlIHdpdGhpbiB3aGljaCBub3RlcyBhbmQgcXVvdGVzIGFyZSBwb3NzaWJsZSBhbmQKICAgICAgICAgICAgICogcmVsYXRpdmUgdG8gd2hpY2ggdGhlaXIgbG9jYXRpb25zIGFyZSBkZWZpbmVkLgogICAgICAgICAgICAgKiBNaWdodCBldmVudHVhbGx5IGJlIGNvbmZpZ3VyZWQgcGVyLXNpdGUKICAgICAgICAgICAgICovCiAgICAgICAgICAgIC8vbnJhbWEuc2V0dGluZ3Mucm9vdF9ub2RlID0gbnJhbWEuJCgnI3JlYWRPdmVybGF5JylbMF07IAogICAgICAgICAgICBucmFtYS5zZXR0aW5ncy5yb290X25vZGUgPSBkb2N1bWVudC5ib2R5OwogICAgCiAgICAgICAgICAgIHJhbmd5LmluaXQoKTsKICAgIAogICAgICAgICAgICBucmFtYS4kLmxvZygnbnJhbWE6IHN0YXJ0aW5nIC4uLicpOwogICAgICAgICAgICBucmFtYS51aS5kaWFsb2dzLmxvZ2luX2lmX25lY2Vzc2FyeShmdW5jdGlvbihlcnJvciwgaWdub3JlKXsKICAgICAgICAgICAgICAgIGlmKCBlcnJvciApIHsKICAgICAgICAgICAgICAgICAgICBucmFtYS5fZGVidWcoe21zZzonZXJyb3IgbG9nZ2luZyBpbicsZXJyb3I6ZXJyb3J9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy9fLmRlZmVyIG1lYW5zIHdhaXQgdW50aWwgY2FsbHN0YWNrIGNsZWFyZWQKICAgICAgICAgICAgICAgICAgICBfLmRlZmVyKG5yYW1hLnF1b3Rlcy5sb2FkLCBucmFtYS5zZXR0aW5ncy5wYWdlX2lkLCBmdW5jdGlvbihlcnJvciwgZGF0YSl7CiAgICAgICAgICAgICAgICAgICAgICAgIF8uZGVmZXIobnJhbWEubm90ZXMubG9hZCwgbnJhbWEuc2V0dGluZ3MucGFnZV9pZCwgbnJhbWEuX2RlYnVnICk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIGNvbmZpZ3VyZSBldmVudHMgLS0tCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBkZWFsIHdpdGggNDAzIEZvcmJpZGRlbiBldmVudHMgKHNlc3Npb24gZXhwaXJlcywgZXRjKQogICAgICAgICAgICBucmFtYS4kKGRvY3VtZW50KS5iaW5kKCducmFtYV80MDMnLCBmdW5jdGlvbihlLCB1c2VyX2lkKXsKICAgICAgICAgICAgICAgIG5yYW1hLnVpLmRpYWxvZ3MubG9naW4odXNlcl9pZCwgJ1BsZWFzZSBsb2dpbiBhbmQgcmUtdHJ5LicsIG5yYW1hLl9kZWJ1Zyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy90aHJvdHRsZTIgaXMgbGlrZSBfLnRocm90dGxlKGZuKSBidXQgdGhpcyBjYWxscyBmbiBCRUZPUkUgdGltb3V0CiAgICAgICAgICAgIHZhciB0aHJvdHRsZTIgPSBmdW5jdGlvbihmdW5jKSB7CiAgICAgICAgICAgICAgICB2YXIgdGltZW91dDsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc2V0X3RpbWVvdXQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBpZiggIXRpbWVvdXQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KHJlc2V0X3RpbWVvdXQsIG5yYW1hLnNldHRpbmdzLmV2ZW50X2RlbGF5KTsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gaGlnaGxpZ2h0aW5nIHRleHQgY3JlYXRlcyBhIHF1b3RlCiAgICAgICAgICAgIHZhciBjcmVhdGVfcXVvdGVfZnJvbV9zZWxlY3Rpb24gPSBmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgIGlmKCBlLnNoaWZ0S2V5IHx8IGUuY3RybEtleSB8fCBlLmFsdEtleSB8fCBlLm1ldGFLZXkpIHsKICAgICAgICAgICAgICAgICAgICAvL2FueSBtb2RpZmllciBrZXkgY2FuY2VscyBxdW90ZSBjcmVhdGlvbgogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vbnJhbWEuJC5sb2coIm5yYW1hMiBjYXVnaHQgbW91c2UgdXAiKTsKICAgICAgICAgICAgICAgIHZhciBzZWxlY3Rpb24gPSByYW5neS5nZXRTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICAgIGlmKCBzZWxlY3Rpb24uaXNDb2xsYXBzZWQgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gc2VsZWN0aW9uLmdldFJhbmdlQXQoMCk7CiAgICAgICAgICAgICAgICAvL2NoZWNrIHRoYXQgbm90IHRvbyBtdWNoIHRleHQgaGFzIGJlZW4gc2VsZWN0ZWQgKGF2b2lkIGFjY2lkZW50YWwgc2VsZWN0aW5nIGxvYWRzIG9mIGRvYykKICAgICAgICAgICAgICAgIGlmKCBucmFtYS5zZXR0aW5ncy5tYXhfcXVvdGVfbGVuZ3RoID4gMCApIHsKICAgICAgICAgICAgICAgICAgICBpZiggcmFuZ2UudG9TdHJpbmcoKS5sZW5ndGggPiBucmFtYS5zZXR0aW5ncy5tYXhfcXVvdGVfbGVuZ3RoICl7CiAgICAgICAgICAgICAgICAgICAgICAgIG5yYW1hLiQubG9nKCducmFtYSBubyBxdW90ZSAtLSAnICsgcmFuZ2UudG9TdHJpbmcoKS5sZW5ndGggKyAnIGNoYXJhY3RlcnMgc2VsZWN0ZWQuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgcXVvdGUgPSBucmFtYS5xdW90ZXMuY3JlYXRlKHJhbmdlKTsKICAgICAgICAgICAgICAgIGlmKCBxdW90ZS5jb250ZW50ICE9ICcnICkgewogICAgICAgICAgICAgICAgICAgIG5yYW1hLnF1b3Rlcy5zYXZlKHF1b3RlLCBmdW5jdGlvbihlcnJvciwgZGF0YSl7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vKHRvZG8gLS0gc29tZSBpbmRpY2F0ZSB0aGF0IGl0IGhhcyBmYWlsZWQ/CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAhZXJyb3IgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBucmFtYS5xdW90ZXMuZGlzcGxheShxdW90ZSk7ICAgLy9kaXNwbGF5IHRoZSBxdW90ZSBvbmx5IGFmdGVyIGl0IGhhcyBiZWVuIHNhdmVkCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBucmFtYS5fZGVidWcoKGZ1bmN0aW9uKCl7IHZhciBhPXt9OyBhW3F1b3RlLl9pZF09cXVvdGU7IHJldHVybiBhOyB9KSgpKTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG5yYW1hLiQoZG9jdW1lbnQpLmJpbmQoIm1vdXNldXAiLCB0aHJvdHRsZTIoY3JlYXRlX3F1b3RlX2Zyb21fc2VsZWN0aW9uKSApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy9jbGljayBhIHF1b3RlIHRvIGNyZWF0ZSBhIG5vdGUKICAgICAgICAgICAgdmFyIGNyZWF0ZV9ub3RlX2Zyb21fcXVvdGVfY2xpY2sgPSBmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgIGlmKCBlLnNoaWZ0S2V5IHx8IGUuY3RybEtleSApIHsKICAgICAgICAgICAgICAgICAgICAvL3NoaWZ0IGtleSBjYW5jZWxzIG5vdGVjcmVhdGlvbiwgc28gZG9lcyBjdHJsCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoIGUuYWx0S2V5IHx8IGUubWV0YUtleSApIHsKICAgICAgICAgICAgICAgICAgICAvL2FsdCBrZXkgY2F1c2VzIHF1b3RlIGRlbGV0aW9uIChpbiBzZXBhcmF0ZSBoYW5kbGVyKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gICAKICAgICAgICAgICAgICAgIHZhciBxdW90ZSA9IG5yYW1hLiQodGhpcykuZGF0YSgnbnJhbWFfcXVvdGUnKTsKICAgICAgICAgICAgICAgIHZhciBub3RlID0gbnJhbWEubm90ZXMuY3JlYXRlKHF1b3RlKTsKICAgICAgICAgICAgICAgIG5yYW1hLm5vdGVzLmRpc3BsYXkobm90ZSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG5yYW1hLiQoJy5fbnJhbWEtcXVvdGUnKS5saXZlKCdjbGljaycsIHRocm90dGxlMihjcmVhdGVfbm90ZV9mcm9tX3F1b3RlX2NsaWNrKSApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gYWx0LSBvciBtZXRhLWNsaWNrIGEgcXVvdGUgdG8gZGVsZXRlIGl0IChhZnRlciBjaGVja2luZyB0aGVyZSBhcmUgbm8gbGlua2VkIG5vdGVzKQogICAgICAgICAgICBucmFtYS4kKCcuX25yYW1hLXF1b3RlJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgIGlmKCBlLmFsdEtleSB8fCBlLm1ldGFLZXkgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHF1b3RlID0gbnJhbWEuJCh0aGlzKS5kYXRhKCducmFtYV9xdW90ZScpOwogICAgICAgICAgICAgICAgICAgIHZhciBub3RlX2lkcyA9IG5yYW1hLm5vdGVzLmZpbmQocXVvdGUpOwogICAgICAgICAgICAgICAgICAgIGlmKCBub3RlX2lkcy5sZW5ndGggIT0gMCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9kb24ndCBkZWxldGUgcXVvdGVzIHdpdGggbm90ZXMgYXR0YWNoZWQgLi4uCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkcXVvdGVfbm9kZXMgPSBucmFtYS4kKCcuJytxdW90ZS5faWQpOwogICAgICAgICAgICAgICAgICAgICAgICAkcXVvdGVfbm9kZXMuY3NzKHsnYm9yZGVyLXRvcCc6JzFweCBkYXNoZWQgcmVkJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYm9yZGVyLWJvdHRvbSc6JzFweCBkYXNoZWQgcmVkJ30pCiAgICAgICAgICAgICAgICAgICAgICAgIC8vLi4uIGluc3RlYWQgbWFrZSB0aGUgcmVsZXZhbnQgbm90ZXMgYm91bmNlCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHN0ciA9ICcjJyArIG5vdGVfaWRzLmpvaW4oJywgIycpOwogICAgICAgICAgICAgICAgICAgICAgICBucmFtYS4kKGlkc3RyKS5lZmZlY3QoJ2JvdW5jZScsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVvdGVfbm9kZXMuY3NzKHsnYm9yZGVyLXRvcCc6J25vbmUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYm9yZGVyLWJvdHRvbSc6J25vbmUnfSw1MDApCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG5yYW1hLnF1b3Rlcy5yZW1vdmUocXVvdGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAKICAgICAgICAgICAgLy9jbGljayBvbiBhIG5vdGUgdG8gZW5hYmxlIGVkaXRpbmcsIGJyaW5nIGl0IHRvIHRoZSBmcm9udCBhbmQgZmxhc2ggdGhlIGFzc29jaWF0ZWQgcXVvdGUKICAgICAgICAgICAgbnJhbWEuJCgnLl9ucmFtYS1ub3RlIHRleHRhcmVhJykubGl2ZSgnY2xpY2snLGZ1bmN0aW9uKGUpewogICAgICAgICAgICAgICAgdmFyICR0ZXh0YXJlYSA9IG5yYW1hLiQodGhpcyk7CiAgICAgICAgICAgICAgICB2YXIgJG5vdGUgPSBucmFtYS4kKHRoaXMpLnBhcmVudHMoJy5fbnJhbWEtbm90ZScpLmZpcnN0KCk7CiAgICAgICAgICAgICAgICBucmFtYS5ub3Rlcy5icmluZ190b19mcm9udCgkbm90ZSk7CiAgICAgICAgICAgICAgICB2YXIgbm90ZT0gJG5vdGUuZGF0YSgnbnJhbWFfbm90ZScpOwogICAgICAgICAgICAgICAgbnJhbWEucXVvdGVzLmZsYXNoKG5vdGUucXVvdGVfaWQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vdGFiYmluZyBvdXQgb2YgYSBub3RlIGRvZXNuJ3QgbW92ZSB0byBuZXh0IG5vdGUgKGJlY2F1c2Ugd2VpcmQpLgogICAgICAgICAgICAvL3RoYW5rIHlvdSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEzMTQ0NTAvanF1ZXJ5LWhvdy10by1jYXB0dXJlLXRoZS10YWIta2V5cHJlc3Mtd2l0aGluLWEtdGV4dGJveAogICAgICAgICAgICBucmFtYS4kKCcuX25yYW1hLW5vdGUnKS5saXZlKCdrZXlkb3duJyxmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgIGlmKCBlLndoaWNoID09IDkgKSB7CiAgICAgICAgICAgICAgICAgICAgbnJhbWEuJCgndGV4dGFyZWEnLCB0aGlzKS5ibHVyKCk7CiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vID09PSBpbml0IGRvbmUKICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICB9KTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBJVCBBTEwgU1RBUlRTIEhFUkUKICAgICAqIERldGVybWluZSBob3cgdG8gaW5pdGlhbGl6ZSBkZXBlbmRpbmcgb24gd2hldGhlciBib29rbWFya2xldCBvciBlbWJlZGRlZCBpbiBwYWdlCiAgICAgKi8KICAgIGlmKCB0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcgKSB7ICAgIC8vZXhwb3J0cyB1bmRlZmluZWQgbWVhbnMgbnJhbWEgaXMgYWxyZWFkeSBsb2FkZWQgLS0gYm9va21hcmtsZXQgbWF5IGJlIGNhbGxlZCBtb3JlIHRoYW4gb25jZSkKCiAgICAgICAgaWYoIHR5cGVvZiBfbnJhbWFfYmtta2x0ID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgcmVxdWlyZSAhPT0gJ3VuZGVmaW5lZCcgKSB7CiAgICAgICAgICAgIC8vdGhpcyBzY3JpcHQgaXMgYmVpbmcgdXNlZCBhcyBhIGNvbW1vbkpTIG1vZHVsZQogICAgICAgICAgICAvL2FscmVhZHkgZGVmaW5lZCBleHBvcnRzOyBpbml0aWFsaXNhdGlvbiBpcyBoYW5kbGVkIGluIGFub3RoZXIgbW9kdWxlLgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmKCB0eXBlb2YgX25yYW1hX2JrbWtsdCA9PT0gJ3VuZGVmaW5lZCcgfHwgIV9ucmFtYV9ia21rbHQgKSB7CiAgICAgICAgICAgICAgICAvL3J1biBhcyBlbWJlZGRlZCA8c2NyaXB0PiAKICAgICAgICAgICAgICAgIF9ucmFtYV9pbml0KGV4cG9ydHMsIGpRdWVyeSwgZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICBleHBvcnRzLl9pbml0YWxpemVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gcnVuIGluIGJvb2ttYXJrbGV0IG1vZGUKICAgICAgICAgICAgICAgIC8vIGZpcnN0IHJlbW92ZSBoZWFkIC0tIGZvciBzb21lIHJlYXNvbiB0aGlzIHNlZW1zIHRvIGhlbHAgYXZvaWQgY2xhc2hlcyBpbiBGRgogICAgICAgICAgICAgICAgdmFyIG9sZF9oZWFkID0gZG9jdW1lbnQuaGVhZC5pbm5lckhUTUw7CiAgICAgICAgICAgICAgICB2YXIgcmVzdG9yZV9kb2N1bWVudF9oZWFkID0gZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5oZWFkLmlubmVySFRNTCA9IG9sZF9oZWFkOwogICAgICAgICAgICAgICAgfTsgCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgICAgICAgICAvL2FsdC4gbWV0aG9kIC0tIGNhbid0IHNldCBpbm5lckhUTUwgd2l0aCBzYWZhcmkgKG90aGVycz8pCiAgICAgICAgICAgICAgICAgICAgdmFyIGhlYWQgPSBkb2N1bWVudC5oZWFkOwogICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IFtdOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKGhlYWQuZmlyc3RDaGlsZCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IGhlYWQuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIGNoaWxkLm5vZGVOYW1lICE9PSAnU0NSSVBUJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goIGNoaWxkICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaGVhZC5yZW1vdmVDaGlsZCggY2hpbGQgKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXN0b3JlX2RvY3VtZW50X2hlYWQgPSBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSggY2hpbGRyZW4ubGVuZ3RoICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZC5hcHBlbmRDaGlsZCggY2hpbGRyZW4ucG9wKCkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAKICAgICAgICAgICAgICAgIC8vIGxvYWQgbGlicmFyaWVzICYgb25seSBzdGFydCB3b3JrIGFmdGVyIHRoZXkgbG9hZGVkCiAgICAgICAgICAgICAgICAvLyBhZGFwdGVkIGZyb20galF1ZXJ5IGFqYXhUcmFuc3BvcnQsIHRoYW5rIHlvdSBhbHNvIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNzU2MzgyL2Jvb2ttYXJrbGV0LXdhaXQtdW50aWwtamF2YXNjcmlwdC1pcy1sb2FkZWQKICAgICAgICAgICAgICAgIHZhciBsb2FkU2NyaXB0MiA9IGZ1bmN0aW9uKHVybCwgY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaGVhZCA9IGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICJoZWFkIiApWzBdIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICAgICAgICAgICAgICAgICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggInNjcmlwdCIgKTsKICAgICAgICAgICAgICAgICAgICAvL3NjcmlwdC5jaGFyc2V0ID0gc2V0IHRoaXM/JAogICAgICAgICAgICAgICAgICAgIHNjcmlwdC5zcmMgPSB1cmw7CiAgICAgICAgICAgICAgICAgICAgc2NyaXB0Lm9ubG9hZCA9IHNjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiggXywgaXNBYm9ydCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBpc0Fib3J0IHx8ICFzY3JpcHQucmVhZHlTdGF0ZSB8fCAvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KCBzY3JpcHQucmVhZHlTdGF0ZSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIG1lbW9yeSBsZWFrIGluIElFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHQub25sb2FkID0gc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHNjcmlwdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBoZWFkICYmIHNjcmlwdC5wYXJlbnROb2RlICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQucmVtb3ZlQ2hpbGQoIHNjcmlwdCApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVyZWZlcmVuY2UgdGhlIHNjcmlwdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0ID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhaXNBYm9ydCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayggMjAwLCAic3VjY2VzcyIgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIGluc2VydEJlZm9yZSBpbnN0ZWFkIG9mIGFwcGVuZENoaWxkICB0byBjaXJjdW12ZW50IGFuIElFNiBidWcuCiAgICAgICAgICAgICAgICAgICAgaGVhZC5pbnNlcnRCZWZvcmUoIHNjcmlwdCwgaGVhZC5maXJzdENoaWxkICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2FkU2NyaXB0MihfTlJBTUFfTElCX1VSTCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5Lm5vQ29uZmxpY3QoKTsKICAgICAgICAgICAgICAgICAgICBfbnJhbWFfaW5pdChleHBvcnRzLCBqUXVlcnksIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3RvcmVfZG9jdW1lbnRfaGVhZCgpOwogICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzLl9pbml0YWxpemVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQovLyBpZiBleHBvcnRzIGlzIG5vdCBkZWZpbmVkLCBvciBpZiBfbnJhbWFfYmtta2x0IGV4aXN0cywgYXR0YWNoIGV2ZXJ5dGhpbmcgdG8gdGhpcy5ucmFtYQovLyAgICAgYnV0IGlmIG5yYW1hIGlzIGFscmVhZHkgZGVmaW5lZCwgZG8gbm90aGluZyAoc2VuZCB1bmRlZmluZWQpCi8vIG90aGVyd2lzZSBiZWhhdmUgYXMgYSBjb21tb25KUyBtb2R1bGUKfSkoCiAgICAoIHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgX25yYW1hX2JrbWtsdCA9PT0gJ3VuZGVmaW5lZCcgKSA/CiAgICAgICAgZXhwb3J0cwogICAgOigKICAgICAgICAoIHR5cGVvZiBucmFtYSA9PT0gJ3VuZGVmaW5lZCcgfHwgIW5yYW1hLl9pbml0YWxpemVkICkgPwogICAgICAgICAgICBucmFtYT17fQogICAgICAgIDoKICAgICAgICAgICAgdW5kZWZpbmVkICAgLy9wcmV2ZW50IGV4ZWN1dGlvbiBpZiBucmFtYSBhbHJlYWR5IGRlZmluZWQKICAgICkKKTsgICAKCn0pfTsKCi8qKioqKioqKioqIGthbnNvL3RlbXBsYXRlcyAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImthbnNvL3RlbXBsYXRlcyJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7Cgp2YXIgZHVzdF9tb2R1bGUgPSB7ZXhwb3J0czoge319OwooZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewp2YXIgZHVzdCA9IHt9OwoKKGZ1bmN0aW9uKGR1c3QpIHsKCmR1c3QuY2FjaGUgPSB7fTsKCmR1c3QucmVnaXN0ZXIgPSBmdW5jdGlvbihuYW1lLCB0bXBsKSB7CiAgaWYgKCFuYW1lKSByZXR1cm47CiAgZHVzdC5jYWNoZVtuYW1lXSA9IHRtcGw7Cn07CgpkdXN0LnJlbmRlciA9IGZ1bmN0aW9uKG5hbWUsIGNvbnRleHQsIGNhbGxiYWNrKSB7CiAgdmFyIGNodW5rID0gbmV3IFN0dWIoY2FsbGJhY2spLmhlYWQ7CiAgZHVzdC5sb2FkKG5hbWUsIGNodW5rLCBDb250ZXh0LndyYXAoY29udGV4dCkpLmVuZCgpOwp9OwoKZHVzdC5zdHJlYW0gPSBmdW5jdGlvbihuYW1lLCBjb250ZXh0KSB7CiAgdmFyIHN0cmVhbSA9IG5ldyBTdHJlYW0oKTsKICBkdXN0Lm5leHRUaWNrKGZ1bmN0aW9uKCkgewogICAgZHVzdC5sb2FkKG5hbWUsIHN0cmVhbS5oZWFkLCBDb250ZXh0LndyYXAoY29udGV4dCkpLmVuZCgpOwogIH0pOwogIHJldHVybiBzdHJlYW07Cn07CgpkdXN0LnJlbmRlclNvdXJjZSA9IGZ1bmN0aW9uKHNvdXJjZSwgY29udGV4dCwgY2FsbGJhY2spIHsKICByZXR1cm4gZHVzdC5jb21waWxlRm4oc291cmNlKShjb250ZXh0LCBjYWxsYmFjayk7Cn07CgpkdXN0LmNvbXBpbGVGbiA9IGZ1bmN0aW9uKHNvdXJjZSwgbmFtZSkgewogIHZhciB0bXBsID0gZHVzdC5sb2FkU291cmNlKGR1c3QuY29tcGlsZShzb3VyY2UsIG5hbWUpKTsKICByZXR1cm4gZnVuY3Rpb24oY29udGV4dCwgY2FsbGJhY2spIHsKICAgIHZhciBtYXN0ZXIgPSBjYWxsYmFjayA/IG5ldyBTdHViKGNhbGxiYWNrKSA6IG5ldyBTdHJlYW0oKTsKICAgIGR1c3QubmV4dFRpY2soZnVuY3Rpb24oKSB7CiAgICAgIHRtcGwobWFzdGVyLmhlYWQsIENvbnRleHQud3JhcChjb250ZXh0KSkuZW5kKCk7CiAgICB9KTsKICAgIHJldHVybiBtYXN0ZXI7CiAgfQp9OwoKZHVzdC5sb2FkID0gZnVuY3Rpb24obmFtZSwgY2h1bmssIGNvbnRleHQpIHsKICB2YXIgdG1wbCA9IGR1c3QuY2FjaGVbbmFtZV07CiAgaWYgKHRtcGwpIHsKICAgIHJldHVybiB0bXBsKGNodW5rLCBjb250ZXh0KTsKICB9IGVsc2UgewogICAgaWYgKGR1c3Qub25Mb2FkKSB7CiAgICAgIHJldHVybiBjaHVuay5tYXAoZnVuY3Rpb24oY2h1bmspIHsKICAgICAgICBkdXN0Lm9uTG9hZChuYW1lLCBmdW5jdGlvbihlcnIsIHNyYykgewogICAgICAgICAgaWYgKGVycikgcmV0dXJuIGNodW5rLnNldEVycm9yKGVycik7CiAgICAgICAgICBpZiAoIWR1c3QuY2FjaGVbbmFtZV0pIGR1c3QubG9hZFNvdXJjZShkdXN0LmNvbXBpbGUoc3JjLCBuYW1lKSk7CiAgICAgICAgICBkdXN0LmNhY2hlW25hbWVdKGNodW5rLCBjb250ZXh0KS5lbmQoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gY2h1bmsuc2V0RXJyb3IobmV3IEVycm9yKCJUZW1wbGF0ZSBOb3QgRm91bmQ6ICIgKyBuYW1lKSk7CiAgfQp9OwoKZHVzdC5sb2FkU291cmNlID0gZnVuY3Rpb24oc291cmNlLCBwYXRoKSB7CiAgcmV0dXJuIGV2YWwoc291cmNlKTsKfTsKCmlmIChBcnJheS5pc0FycmF5KSB7CiAgZHVzdC5pc0FycmF5ID0gQXJyYXkuaXNBcnJheTsKfSBlbHNlIHsKICBkdXN0LmlzQXJyYXkgPSBmdW5jdGlvbihhcnIpIHsKICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PSAiW29iamVjdCBBcnJheV0iOwogIH07Cn0KCmR1c3QubmV4dFRpY2sgPSBmdW5jdGlvbihjYWxsYmFjaykgewogIHNldFRpbWVvdXQoY2FsbGJhY2ssIDApOwp9CgpkdXN0LmlzRW1wdHkgPSBmdW5jdGlvbih2YWx1ZSkgewogIGlmIChkdXN0LmlzQXJyYXkodmFsdWUpICYmICF2YWx1ZS5sZW5ndGgpIHJldHVybiB0cnVlOwogIGlmICh2YWx1ZSA9PT0gMCkgcmV0dXJuIGZhbHNlOwogIHJldHVybiAoIXZhbHVlKTsKfTsKCmR1c3QuZmlsdGVyID0gZnVuY3Rpb24oc3RyaW5nLCBhdXRvLCBmaWx0ZXJzKSB7CiAgaWYgKGZpbHRlcnMpIHsKICAgIGZvciAodmFyIGk9MCwgbGVuPWZpbHRlcnMubGVuZ3RoOyBpPGxlbjsgaSsrKSB7CiAgICAgIHZhciBuYW1lID0gZmlsdGVyc1tpXTsKICAgICAgaWYgKG5hbWUgPT09ICJzIikgewogICAgICAgIGF1dG8gPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHN0cmluZyA9IGR1c3QuZmlsdGVyc1tuYW1lXShzdHJpbmcpOwogICAgICB9CiAgICB9CiAgfQogIGlmIChhdXRvKSB7CiAgICBzdHJpbmcgPSBkdXN0LmZpbHRlcnNbYXV0b10oc3RyaW5nKTsKICB9CiAgcmV0dXJuIHN0cmluZzsKfTsKCmR1c3QuZmlsdGVycyA9IHsKICBoOiBmdW5jdGlvbih2YWx1ZSkgeyByZXR1cm4gZHVzdC5lc2NhcGVIdG1sKHZhbHVlKTsgfSwKICBqOiBmdW5jdGlvbih2YWx1ZSkgeyByZXR1cm4gZHVzdC5lc2NhcGVKcyh2YWx1ZSk7IH0sCiAgdTogZW5jb2RlVVJJLAogIHVjOiBlbmNvZGVVUklDb21wb25lbnQKfQoKZnVuY3Rpb24gQ29udGV4dChzdGFjaywgZ2xvYmFsLCBibG9ja3MpIHsKICB0aGlzLnN0YWNrICA9IHN0YWNrOwogIHRoaXMuZ2xvYmFsID0gZ2xvYmFsOwogIHRoaXMuYmxvY2tzID0gYmxvY2tzOwp9CgpkdXN0Lm1ha2VCYXNlID0gZnVuY3Rpb24oZ2xvYmFsKSB7CiAgcmV0dXJuIG5ldyBDb250ZXh0KG5ldyBTdGFjaygpLCBnbG9iYWwpOwp9CgpDb250ZXh0LndyYXAgPSBmdW5jdGlvbihjb250ZXh0KSB7CiAgaWYgKGNvbnRleHQgaW5zdGFuY2VvZiBDb250ZXh0KSB7CiAgICByZXR1cm4gY29udGV4dDsKICB9CiAgcmV0dXJuIG5ldyBDb250ZXh0KG5ldyBTdGFjayhjb250ZXh0KSk7Cn0KCkNvbnRleHQucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKGtleSkgewogIHZhciBjdHggPSB0aGlzLnN0YWNrLCB2YWx1ZTsKCiAgd2hpbGUoY3R4KSB7CiAgICBpZiAoY3R4LmlzT2JqZWN0KSB7CiAgICAgIHZhbHVlID0gY3R4LmhlYWRba2V5XTsKICAgICAgaWYgKCEodmFsdWUgPT09IHVuZGVmaW5lZCkpIHsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH0KICAgIH0KICAgIGN0eCA9IGN0eC50YWlsOwogIH0KICByZXR1cm4gdGhpcy5nbG9iYWwgPyB0aGlzLmdsb2JhbFtrZXldIDogdW5kZWZpbmVkOwp9OwoKQ29udGV4dC5wcm90b3R5cGUuZ2V0UGF0aCA9IGZ1bmN0aW9uKGN1ciwgZG93bikgewogIHZhciBjdHggPSB0aGlzLnN0YWNrLAogICAgICBsZW4gPSBkb3duLmxlbmd0aDsKCiAgaWYgKGN1ciAmJiBsZW4gPT09IDApIHJldHVybiBjdHguaGVhZDsKICBpZiAoIWN0eC5pc09iamVjdCkgcmV0dXJuIHVuZGVmaW5lZDsKICBjdHggPSBjdHguaGVhZDsKICB2YXIgaSA9IDA7CiAgd2hpbGUoY3R4ICYmIGkgPCBsZW4pIHsKICAgIGN0eCA9IGN0eFtkb3duW2ldXTsKICAgIGkrKzsKICB9CiAgcmV0dXJuIGN0eDsKfTsKCkNvbnRleHQucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihoZWFkLCBpZHgsIGxlbikgewogIHJldHVybiBuZXcgQ29udGV4dChuZXcgU3RhY2soaGVhZCwgdGhpcy5zdGFjaywgaWR4LCBsZW4pLCB0aGlzLmdsb2JhbCwgdGhpcy5ibG9ja3MpOwp9OwoKQ29udGV4dC5wcm90b3R5cGUucmViYXNlID0gZnVuY3Rpb24oaGVhZCkgewogIHJldHVybiBuZXcgQ29udGV4dChuZXcgU3RhY2soaGVhZCksIHRoaXMuZ2xvYmFsLCB0aGlzLmJsb2Nrcyk7Cn07CgpDb250ZXh0LnByb3RvdHlwZS5jdXJyZW50ID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMuc3RhY2suaGVhZDsKfTsKCkNvbnRleHQucHJvdG90eXBlLmdldEJsb2NrID0gZnVuY3Rpb24oa2V5KSB7CiAgdmFyIGJsb2NrcyA9IHRoaXMuYmxvY2tzOwoKICBpZiAoIWJsb2NrcykgcmV0dXJuOwogIHZhciBsZW4gPSBibG9ja3MubGVuZ3RoLCBmbjsKICB3aGlsZSAobGVuLS0pIHsKICAgIGZuID0gYmxvY2tzW2xlbl1ba2V5XTsKICAgIGlmIChmbikgcmV0dXJuIGZuOwogIH0KfQoKQ29udGV4dC5wcm90b3R5cGUuc2hpZnRCbG9ja3MgPSBmdW5jdGlvbihsb2NhbHMpIHsKICB2YXIgYmxvY2tzID0gdGhpcy5ibG9ja3M7CgogIGlmIChsb2NhbHMpIHsKICAgIGlmICghYmxvY2tzKSB7CiAgICAgIG5ld0Jsb2NrcyA9IFtsb2NhbHNdOwogICAgfSBlbHNlIHsKICAgICAgbmV3QmxvY2tzID0gYmxvY2tzLmNvbmNhdChbbG9jYWxzXSk7CiAgICB9CiAgICByZXR1cm4gbmV3IENvbnRleHQodGhpcy5zdGFjaywgdGhpcy5nbG9iYWwsIG5ld0Jsb2Nrcyk7CiAgfQogIHJldHVybiB0aGlzOwp9CgpmdW5jdGlvbiBTdGFjayhoZWFkLCB0YWlsLCBpZHgsIGxlbikgewogIHRoaXMudGFpbCA9IHRhaWw7CiAgdGhpcy5pc09iamVjdCA9ICFkdXN0LmlzQXJyYXkoaGVhZCkgJiYgaGVhZCAmJiB0eXBlb2YgaGVhZCA9PT0gIm9iamVjdCI7CiAgdGhpcy5oZWFkID0gaGVhZDsKICB0aGlzLmluZGV4ID0gaWR4OwogIHRoaXMub2YgPSBsZW47Cn0KCmZ1bmN0aW9uIFN0dWIoY2FsbGJhY2spIHsKICB0aGlzLmhlYWQgPSBuZXcgQ2h1bmsodGhpcyk7CiAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrOwogIHRoaXMub3V0ID0gJyc7Cn0KClN0dWIucHJvdG90eXBlLmZsdXNoID0gZnVuY3Rpb24oKSB7CiAgdmFyIGNodW5rID0gdGhpcy5oZWFkOwoKICB3aGlsZSAoY2h1bmspIHsKICAgIGlmIChjaHVuay5mbHVzaGFibGUpIHsKICAgICAgdGhpcy5vdXQgKz0gY2h1bmsuZGF0YTsKICAgIH0gZWxzZSBpZiAoY2h1bmsuZXJyb3IpIHsKICAgICAgdGhpcy5jYWxsYmFjayhjaHVuay5lcnJvcik7CiAgICAgIHRoaXMuZmx1c2ggPSBmdW5jdGlvbigpIHt9OwogICAgICByZXR1cm47CiAgICB9IGVsc2UgewogICAgICByZXR1cm47CiAgICB9CiAgICBjaHVuayA9IGNodW5rLm5leHQ7CiAgICB0aGlzLmhlYWQgPSBjaHVuazsKICB9CiAgdGhpcy5jYWxsYmFjayhudWxsLCB0aGlzLm91dCk7Cn0KCmZ1bmN0aW9uIFN0cmVhbSgpIHsKICB0aGlzLmhlYWQgPSBuZXcgQ2h1bmsodGhpcyk7Cn0KClN0cmVhbS5wcm90b3R5cGUuZmx1c2ggPSBmdW5jdGlvbigpIHsKICB2YXIgY2h1bmsgPSB0aGlzLmhlYWQ7CgogIHdoaWxlKGNodW5rKSB7CiAgICBpZiAoY2h1bmsuZmx1c2hhYmxlKSB7CiAgICAgIHRoaXMuZW1pdCgnZGF0YScsIGNodW5rLmRhdGEpOwogICAgfSBlbHNlIGlmIChjaHVuay5lcnJvcikgewogICAgICB0aGlzLmVtaXQoJ2Vycm9yJywgY2h1bmsuZXJyb3IpOwogICAgICB0aGlzLmZsdXNoID0gZnVuY3Rpb24oKSB7fTsKICAgICAgcmV0dXJuOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY2h1bmsgPSBjaHVuay5uZXh0OwogICAgdGhpcy5oZWFkID0gY2h1bms7CiAgfQogIHRoaXMuZW1pdCgnZW5kJyk7Cn0KClN0cmVhbS5wcm90b3R5cGUuZW1pdCA9IGZ1bmN0aW9uKHR5cGUsIGRhdGEpIHsKICB2YXIgZXZlbnRzID0gdGhpcy5ldmVudHM7CgogIGlmIChldmVudHMgJiYgZXZlbnRzW3R5cGVdKSB7CiAgICBldmVudHNbdHlwZV0oZGF0YSk7CiAgfQp9CgpTdHJlYW0ucHJvdG90eXBlLm9uID0gZnVuY3Rpb24odHlwZSwgY2FsbGJhY2spIHsKICBpZiAoIXRoaXMuZXZlbnRzKSB7CiAgICB0aGlzLmV2ZW50cyA9IHt9OwogIH0KICB0aGlzLmV2ZW50c1t0eXBlXSA9IGNhbGxiYWNrOwogIHJldHVybiB0aGlzOwp9CgpmdW5jdGlvbiBDaHVuayhyb290LCBuZXh0LCB0YXBzKSB7CiAgdGhpcy5yb290ID0gcm9vdDsKICB0aGlzLm5leHQgPSBuZXh0OwogIHRoaXMuZGF0YSA9ICcnOwogIHRoaXMuZmx1c2hhYmxlID0gZmFsc2U7CiAgdGhpcy50YXBzID0gdGFwczsKfQoKQ2h1bmsucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oZGF0YSkgewogIHZhciB0YXBzICA9IHRoaXMudGFwczsKCiAgaWYgKHRhcHMpIHsKICAgIGRhdGEgPSB0YXBzLmdvKGRhdGEpOwogIH0KICB0aGlzLmRhdGEgKz0gZGF0YTsKICByZXR1cm4gdGhpczsKfQoKQ2h1bmsucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uKGRhdGEpIHsKICBpZiAoZGF0YSkgewogICAgdGhpcy53cml0ZShkYXRhKTsKICB9CiAgdGhpcy5mbHVzaGFibGUgPSB0cnVlOwogIHRoaXMucm9vdC5mbHVzaCgpOwogIHJldHVybiB0aGlzOwp9CgpDaHVuay5wcm90b3R5cGUubWFwID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICB2YXIgY3Vyc29yID0gbmV3IENodW5rKHRoaXMucm9vdCwgdGhpcy5uZXh0LCB0aGlzLnRhcHMpLAogICAgICBicmFuY2ggPSBuZXcgQ2h1bmsodGhpcy5yb290LCBjdXJzb3IsIHRoaXMudGFwcyk7CgogIHRoaXMubmV4dCA9IGJyYW5jaDsKICB0aGlzLmZsdXNoYWJsZSA9IHRydWU7CiAgY2FsbGJhY2soYnJhbmNoKTsKICByZXR1cm4gY3Vyc29yOwp9CgpDaHVuay5wcm90b3R5cGUudGFwID0gZnVuY3Rpb24odGFwKSB7CiAgdmFyIHRhcHMgPSB0aGlzLnRhcHM7CgogIGlmICh0YXBzKSB7CiAgICB0aGlzLnRhcHMgPSB0YXBzLnB1c2godGFwKTsKICB9IGVsc2UgewogICAgdGhpcy50YXBzID0gbmV3IFRhcCh0YXApOwogIH0KICByZXR1cm4gdGhpczsKfQoKQ2h1bmsucHJvdG90eXBlLnVudGFwID0gZnVuY3Rpb24oKSB7CiAgdGhpcy50YXBzID0gdGhpcy50YXBzLnRhaWw7CiAgcmV0dXJuIHRoaXM7Cn0KCkNodW5rLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbihib2R5LCBjb250ZXh0KSB7CiAgcmV0dXJuIGJvZHkodGhpcywgY29udGV4dCk7Cn0KCkNodW5rLnByb3RvdHlwZS5yZWZlcmVuY2UgPSBmdW5jdGlvbihlbGVtLCBjb250ZXh0LCBhdXRvLCBmaWx0ZXJzKSB7CiAgaWYgKHR5cGVvZiBlbGVtID09PSAiZnVuY3Rpb24iKSB7CiAgICBlbGVtID0gZWxlbSh0aGlzLCBjb250ZXh0LCBudWxsLCB7YXV0bzogYXV0bywgZmlsdGVyczogZmlsdGVyc30pOwogICAgaWYgKGVsZW0gaW5zdGFuY2VvZiBDaHVuaykgewogICAgICByZXR1cm4gZWxlbTsKICAgIH0KICB9CiAgaWYgKCFkdXN0LmlzRW1wdHkoZWxlbSkpIHsKICAgIHJldHVybiB0aGlzLndyaXRlKGR1c3QuZmlsdGVyKGVsZW0sIGF1dG8sIGZpbHRlcnMpKTsKICB9IGVsc2UgewogICAgcmV0dXJuIHRoaXM7CiAgfQp9OwoKQ2h1bmsucHJvdG90eXBlLnNlY3Rpb24gPSBmdW5jdGlvbihlbGVtLCBjb250ZXh0LCBib2RpZXMsIHBhcmFtcykgewogIGlmICh0eXBlb2YgZWxlbSA9PT0gImZ1bmN0aW9uIikgewogICAgZWxlbSA9IGVsZW0odGhpcywgY29udGV4dCwgYm9kaWVzLCBwYXJhbXMpOwogICAgaWYgKGVsZW0gaW5zdGFuY2VvZiBDaHVuaykgewogICAgICByZXR1cm4gZWxlbTsKICAgIH0KICB9CgogIHZhciBib2R5ID0gYm9kaWVzLmJsb2NrLAogICAgICBza2lwID0gYm9kaWVzWydlbHNlJ107CgogIGlmIChwYXJhbXMpIHsKICAgIGNvbnRleHQgPSBjb250ZXh0LnB1c2gocGFyYW1zKTsKICB9CgogIGlmIChkdXN0LmlzQXJyYXkoZWxlbSkpIHsKICAgIGlmIChib2R5KSB7CiAgICAgIHZhciBsZW4gPSBlbGVtLmxlbmd0aCwgY2h1bmsgPSB0aGlzOwogICAgICBmb3IgKHZhciBpPTA7IGk8bGVuOyBpKyspIHsKICAgICAgICBjaHVuayA9IGJvZHkoY2h1bmssIGNvbnRleHQucHVzaChlbGVtW2ldLCBpLCBsZW4pKTsKICAgICAgfQogICAgICByZXR1cm4gY2h1bms7CiAgICB9CiAgfSBlbHNlIGlmIChlbGVtID09PSB0cnVlKSB7CiAgICBpZiAoYm9keSkgcmV0dXJuIGJvZHkodGhpcywgY29udGV4dCk7CiAgfSBlbHNlIGlmIChlbGVtIHx8IGVsZW0gPT09IDApIHsKICAgIGlmIChib2R5KSByZXR1cm4gYm9keSh0aGlzLCBjb250ZXh0LnB1c2goZWxlbSkpOwogIH0gZWxzZSBpZiAoc2tpcCkgewogICAgcmV0dXJuIHNraXAodGhpcywgY29udGV4dCk7CiAgfQogIHJldHVybiB0aGlzOwp9OwoKQ2h1bmsucHJvdG90eXBlLmV4aXN0cyA9IGZ1bmN0aW9uKGVsZW0sIGNvbnRleHQsIGJvZGllcykgewogIHZhciBib2R5ID0gYm9kaWVzLmJsb2NrLAogICAgICBza2lwID0gYm9kaWVzWydlbHNlJ107CgogIGlmICghZHVzdC5pc0VtcHR5KGVsZW0pKSB7CiAgICBpZiAoYm9keSkgcmV0dXJuIGJvZHkodGhpcywgY29udGV4dCk7CiAgfSBlbHNlIGlmIChza2lwKSB7CiAgICByZXR1cm4gc2tpcCh0aGlzLCBjb250ZXh0KTsKICB9CiAgcmV0dXJuIHRoaXM7Cn0KCkNodW5rLnByb3RvdHlwZS5ub3RleGlzdHMgPSBmdW5jdGlvbihlbGVtLCBjb250ZXh0LCBib2RpZXMpIHsKICB2YXIgYm9keSA9IGJvZGllcy5ibG9jaywKICAgICAgc2tpcCA9IGJvZGllc1snZWxzZSddOwoKICBpZiAoZHVzdC5pc0VtcHR5KGVsZW0pKSB7CiAgICBpZiAoYm9keSkgcmV0dXJuIGJvZHkodGhpcywgY29udGV4dCk7CiAgfSBlbHNlIGlmIChza2lwKSB7CiAgICByZXR1cm4gc2tpcCh0aGlzLCBjb250ZXh0KTsKICB9CiAgcmV0dXJuIHRoaXM7Cn0KCkNodW5rLnByb3RvdHlwZS5ibG9jayA9IGZ1bmN0aW9uKGVsZW0sIGNvbnRleHQsIGJvZGllcykgewogIHZhciBib2R5ID0gYm9kaWVzLmJsb2NrOwoKICBpZiAoZWxlbSkgewogICAgYm9keSA9IGVsZW07CiAgfQoKICBpZiAoYm9keSkgewogICAgcmV0dXJuIGJvZHkodGhpcywgY29udGV4dCk7CiAgfQogIHJldHVybiB0aGlzOwp9OwoKQ2h1bmsucHJvdG90eXBlLnBhcnRpYWwgPSBmdW5jdGlvbihlbGVtLCBjb250ZXh0KSB7CiAgaWYgKHR5cGVvZiBlbGVtID09PSAiZnVuY3Rpb24iKSB7CiAgICByZXR1cm4gdGhpcy5jYXB0dXJlKGVsZW0sIGNvbnRleHQsIGZ1bmN0aW9uKG5hbWUsIGNodW5rKSB7CiAgICAgIGR1c3QubG9hZChuYW1lLCBjaHVuaywgY29udGV4dCkuZW5kKCk7CiAgICB9KTsKICB9CiAgcmV0dXJuIGR1c3QubG9hZChlbGVtLCB0aGlzLCBjb250ZXh0KTsKfTsKCkNodW5rLnByb3RvdHlwZS5oZWxwZXIgPSBmdW5jdGlvbihuYW1lLCBjb250ZXh0LCBib2RpZXMsIHBhcmFtcykgewogIHJldHVybiBkdXN0LmhlbHBlcnNbbmFtZV0odGhpcywgY29udGV4dCwgYm9kaWVzLCBwYXJhbXMpOwp9OwoKQ2h1bmsucHJvdG90eXBlLmNhcHR1cmUgPSBmdW5jdGlvbihib2R5LCBjb250ZXh0LCBjYWxsYmFjaykgewogIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbihjaHVuaykgewogICAgdmFyIHN0dWIgPSBuZXcgU3R1YihmdW5jdGlvbihlcnIsIG91dCkgewogICAgICBpZiAoZXJyKSB7CiAgICAgICAgY2h1bmsuc2V0RXJyb3IoZXJyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWxsYmFjayhvdXQsIGNodW5rKTsKICAgICAgfQogICAgfSk7CiAgICBib2R5KHN0dWIuaGVhZCwgY29udGV4dCkuZW5kKCk7CiAgfSk7Cn07CgpDaHVuay5wcm90b3R5cGUuc2V0RXJyb3IgPSBmdW5jdGlvbihlcnIpIHsKICB0aGlzLmVycm9yID0gZXJyOwogIHRoaXMucm9vdC5mbHVzaCgpOwogIHJldHVybiB0aGlzOwp9OwoKZHVzdC5oZWxwZXJzID0gewogIHNlcDogZnVuY3Rpb24oY2h1bmssIGNvbnRleHQsIGJvZGllcykgewogICAgaWYgKGNvbnRleHQuc3RhY2suaW5kZXggPT09IGNvbnRleHQuc3RhY2sub2YgLSAxKSB7CiAgICAgIHJldHVybiBjaHVuazsKICAgIH0KICAgIHJldHVybiBib2RpZXMuYmxvY2soY2h1bmssIGNvbnRleHQpOwogIH0sCgogIGlkeDogZnVuY3Rpb24oY2h1bmssIGNvbnRleHQsIGJvZGllcykgewogICAgcmV0dXJuIGJvZGllcy5ibG9jayhjaHVuaywgY29udGV4dC5wdXNoKGNvbnRleHQuc3RhY2suaW5kZXgpKTsKICB9Cn0KCmZ1bmN0aW9uIFRhcChoZWFkLCB0YWlsKSB7CiAgdGhpcy5oZWFkID0gaGVhZDsKICB0aGlzLnRhaWwgPSB0YWlsOwp9CgpUYXAucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbih0YXApIHsKICByZXR1cm4gbmV3IFRhcCh0YXAsIHRoaXMpOwp9OwoKVGFwLnByb3RvdHlwZS5nbyA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgdmFyIHRhcCA9IHRoaXM7CgogIHdoaWxlKHRhcCkgewogICAgdmFsdWUgPSB0YXAuaGVhZCh2YWx1ZSk7CiAgICB0YXAgPSB0YXAudGFpbDsKICB9CiAgcmV0dXJuIHZhbHVlOwp9OwoKdmFyIEhDSEFSUyA9IG5ldyBSZWdFeHAoL1smPD5cIl0vKSwKICAgIEFNUCAgICA9IC8mL2csCiAgICBMVCAgICAgPSAvPC9nLAogICAgR1QgICAgID0gLz4vZywKICAgIFFVT1QgICA9IC9cIi9nOwoKZHVzdC5lc2NhcGVIdG1sID0gZnVuY3Rpb24ocykgewogIGlmICh0eXBlb2YgcyA9PT0gInN0cmluZyIpIHsKICAgIGlmICghSENIQVJTLnRlc3QocykpIHsKICAgICAgcmV0dXJuIHM7CiAgICB9CiAgICByZXR1cm4gcy5yZXBsYWNlKEFNUCwnJmFtcDsnKS5yZXBsYWNlKExULCcmbHQ7JykucmVwbGFjZShHVCwnJmd0OycpLnJlcGxhY2UoUVVPVCwnJnF1b3Q7Jyk7CiAgfQogIHJldHVybiBzOwp9OwoKdmFyIEJTID0gL1xcL2csCiAgICBDUiA9IC9cci9nLAogICAgTFMgPSAvXHUyMDI4L2csCiAgICBQUyA9IC9cdTIwMjkvZywKICAgIE5MID0gL1xuL2csCiAgICBMRiA9IC9cZi9nLAogICAgU1EgPSAvJy9nLAogICAgRFEgPSAvIi9nLAogICAgVEIgPSAvXHQvZzsKCmR1c3QuZXNjYXBlSnMgPSBmdW5jdGlvbihzKSB7CiAgaWYgKHR5cGVvZiBzID09PSAic3RyaW5nIikgewogICAgcmV0dXJuIHMKICAgICAgLnJlcGxhY2UoQlMsICdcXFxcJykKICAgICAgLnJlcGxhY2UoRFEsICdcXCInKQogICAgICAucmVwbGFjZShTUSwgIlxcJyIpCiAgICAgIC5yZXBsYWNlKENSLCAnXFxyJykKICAgICAgLnJlcGxhY2UoTFMsICdcXHUyMDI4JykKICAgICAgLnJlcGxhY2UoUFMsICdcXHUyMDI5JykKICAgICAgLnJlcGxhY2UoTkwsICdcXG4nKQogICAgICAucmVwbGFjZShMRiwgJ1xcZicpCiAgICAgIC5yZXBsYWNlKFRCLCAiXFx0Iik7CiAgfQogIHJldHVybiBzOwp9OwoKfSkoZHVzdCk7CgppZiAodHlwZW9mIGV4cG9ydHMgIT09ICJ1bmRlZmluZWQiKSB7CiAgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAidW5kZWZpbmVkIikgewogICAgICByZXF1aXJlKCcuL3NlcnZlcicpKGR1c3QpOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGR1c3Q7Cn0KKGZ1bmN0aW9uKCl7ZHVzdC5yZWdpc3RlcigiNDA0Lmh0bWwiLGJvZHlfMCk7ZnVuY3Rpb24gYm9keV8wKGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIjxoMT40MDQgLSBOb3QgRm91bmQ8L2gxPiIpLndyaXRlKCJcbiIpO31yZXR1cm4gYm9keV8wO30pKCk7KGZ1bmN0aW9uKCl7ZHVzdC5yZWdpc3RlcigiYWxsX3VzZXJzLmh0bWwiLGJvZHlfMCk7ZnVuY3Rpb24gYm9keV8wKGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIjxoMT5ub3RlLW8tcmFtYSB1c2VyczwvaDE+Iikud3JpdGUoIlxuIikud3JpdGUoIlxuIikud3JpdGUoIjx1bCBjbGFzcz1cInVzZXJzXCI+Iikud3JpdGUoIlxuICAiKS5zZWN0aW9uKGN0eC5nZXQoInVzZXJzIiksY3R4LHsiYmxvY2siOmJvZHlfMX0sbnVsbCkud3JpdGUoIlxuIikud3JpdGUoIjwvdWw+Iikud3JpdGUoIlxuIik7fWZ1bmN0aW9uIGJvZHlfMShjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPGxpIGNsYXNzPVwidXNlci1saW5lXCI+Iikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGgyIGNsYXNzPVwidXNlci1saW5lXCI+PGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldCgidXNlcl9pZCIpLGN0eCwiaCIsWyJ1YyJdKS53cml0ZSgiXCIgY2xhc3M9XCJ1c2VyX2lkXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoInVzZXJfaWQiKSxjdHgsImgiKS53cml0ZSgiPC9hPjwvaDI+Iikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGRpdiBjbGFzcz0ndXBkYXRlZC1saW5lJz4iKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiVXBkYXRlZCA8YWJiciBjbGFzcz1cInVwZGF0ZWRfdGltZSBfdGltZWFnb1wiIHRpdGxlPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoInVwZGF0ZWRfdGltZSIpLGN0eCwiaCIpLndyaXRlKCJcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgidXBkYXRlZF90aW1lIiksY3R4LCJoIikud3JpdGUoIjwvYWJicj4uIikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8L2xpPiIpLndyaXRlKCJcbiAgICAiKTt9cmV0dXJuIGJvZHlfMDt9KSgpOyhmdW5jdGlvbigpe2R1c3QucmVnaXN0ZXIoImF1dGhvcnMuaHRtbCIsYm9keV8wKTt2YXIgYmxvY2tzPXt3aGF0OmJvZHlfMX07ZnVuY3Rpb24gYm9keV8wKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLnBhcnRpYWwoInVzZXJfaGVhZGVyLmh0bWwiLGN0eCkud3JpdGUoIlxuIikud3JpdGUoIlxuIikud3JpdGUoIjxkaXYgY2xhc3M9XCJuYXZpZ2F0aW9uXCI+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCItLSIpLndyaXRlKCJcbiAgICAiKS5ub3RleGlzdHMoY3R4LmdldCgiaXNfdXNlcnNfb3duX3BhZ2UiKSxjdHgseyJibG9jayI6Ym9keV81fSxudWxsKS53cml0ZSgiXG4gICAgIikuZXhpc3RzKGN0eC5nZXRQYXRoKGZhbHNlLFsidXNlckN0eCIsIm5hbWUiXSksY3R4LHsiYmxvY2siOmJvZHlfOH0sbnVsbCkud3JpdGUoIlxuIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLnNlY3Rpb24oY3R4LmdldCgiYXV0aG9ycyIpLGN0eCx7ImJsb2NrIjpib2R5XzExfSxudWxsKS53cml0ZSgiXG4iKS5ub3RleGlzdHMoY3R4LmdldCgiYXV0aG9ycyIpLGN0eCx7ImJsb2NrIjpib2R5XzE2fSxudWxsKS53cml0ZSgiXG4iKTt9ZnVuY3Rpb24gYm9keV8xKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLmV4aXN0cyhjdHguZ2V0KCJxdWVyeV9hdXRob3IiKSxjdHgseyJlbHNlIjpib2R5XzIsImJsb2NrIjpib2R5XzR9LG51bGwpO31mdW5jdGlvbiBib2R5XzIoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsuZXhpc3RzKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgseyJibG9jayI6Ym9keV8zfSxudWxsKS53cml0ZSgiYXV0aG9ycyIpO31mdW5jdGlvbiBib2R5XzMoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsucmVmZXJlbmNlKGN0eC5nZXRQYXRoKGZhbHNlLFsiYXV0aG9ycyIsImxlbmd0aCJdKSxjdHgsImgiKS53cml0ZSgiICIpO31mdW5jdGlvbiBib2R5XzQoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoInNvdXJjZXMiKTt9ZnVuY3Rpb24gYm9keV81KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgseyJibG9jayI6Ym9keV82fSxudWxsKS53cml0ZSgiXG4gICAgIik7fWZ1bmN0aW9uIGJvZHlfNihjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgic2VlICIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdXNlcl91cmwiKSxjdHgsImgiKS53cml0ZSgiL3NvdXJjZXNcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdXNlciIpLGN0eCwiaCIpLndyaXRlKCIncyBzb3VyY2VzPC9hPiBvciIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdXNlcl91cmwiKSxjdHgsImgiKS53cml0ZSgiL3RhZ3NcIj50YWdzPC9hPiIpLmV4aXN0cyhjdHguZ2V0UGF0aChmYWxzZSxbInVzZXJDdHgiLCJuYW1lIl0pLGN0eCx7ImJsb2NrIjpib2R5Xzd9LG51bGwpLndyaXRlKCJcbiAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfNyhjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiOyA8YnIgLz4tLSAiKTt9ZnVuY3Rpb24gYm9keV84KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoImdvIHRvICIpLndyaXRlKCJcbiAgICAgICAgIikubm90ZXhpc3RzKGN0eC5nZXQoImlzX3VzZXJzX293bl9wYWdlIiksY3R4LHsiYmxvY2siOmJvZHlfOX0sbnVsbCkud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi9zb3VyY2VzXCI+IikuZXhpc3RzKGN0eC5nZXQoImlzX3VzZXJzX293bl9wYWdlIiksY3R4LHsiYmxvY2siOmJvZHlfMTB9LG51bGwpLndyaXRlKCJzb3VyY2VzPC9hPiBvciIpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLndyaXRlKCIvdXNlcnMvIikucmVmZXJlbmNlKGN0eC5nZXRQYXRoKGZhbHNlLFsidXNlckN0eCIsIm5hbWUiXSksY3R4LCJoIixbInVjIl0pLndyaXRlKCIvdGFnc1wiPnRhZ3M8L2E+Iikud3JpdGUoIlxuICAgICIpO31mdW5jdGlvbiBib2R5XzkoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLndyaXRlKCIvdXNlcnMvIikucmVmZXJlbmNlKGN0eC5nZXRQYXRoKGZhbHNlLFsidXNlckN0eCIsIm5hbWUiXSksY3R4LCJoIixbInVjIl0pLndyaXRlKCIvYXV0aG9yc1wiPnlvdXIgYXV0aG9yczwvYT4sIikud3JpdGUoIlxuICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8xMChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgieW91ciAiKTt9ZnVuY3Rpb24gYm9keV8xMShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgIikud3JpdGUoIjxoMT4iKS53cml0ZSgiXG4gICAgICAgICIpLnJlZmVyZW5jZShjdHguZ2V0KCJhdXRob3JfbmFtZSIpLGN0eCwiaCIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPC9oMT4iKS53cml0ZSgiXG4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjx1bCBjbGFzcz1cInNvdXJjZXNcIj4iKS53cml0ZSgiXG4gICAgICAgICIpLnNlY3Rpb24oY3R4LmdldCgic291cmNlcyIpLGN0eCx7ImJsb2NrIjpib2R5XzEyfSxudWxsKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjwvdWw+Iikud3JpdGUoIlxuIik7fWZ1bmN0aW9uIGJvZHlfMTIoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjxsaSBjbGFzcz1cInNvdXJjZVwiPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGRpdiBjbGFzcz1cInRpdGxlLWxpbmVcIj4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3VzZXJzLyIpLnJlZmVyZW5jZShjdHguZ2V0KCJ1c2VyX2lkIiksY3R4LCJoIixbInVjIl0pLndyaXRlKCIvc291cmNlcy8iKS5yZWZlcmVuY2UoY3R4LmdldCgicGFnZV9pZCIpLGN0eCwiaCIsWyJ1YyJdKS53cml0ZSgiXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoIlRJVExFIiksY3R4LCJoIikucmVmZXJlbmNlKGN0eC5nZXQoInBhZ2VfdGl0bGUiKSxjdHgsImgiKS5ub3RleGlzdHMoY3R4LmdldCgiVElUTEUiKSxjdHgseyJibG9jayI6Ym9keV8xM30sbnVsbCkud3JpdGUoIjwvYT4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoIllFQVIiKSxjdHgseyJibG9jayI6Ym9keV8xNX0sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCI8ZGl2IGNsYXNzPVwiY2l0YXRpb25cIj4iKS5wYXJ0aWFsKCJiaWJsaW9ncmFwaGljX2RldGFpbHMuaHRtbCIsY3R4KS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjwvbGk+Iikud3JpdGUoIlxuICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8xMyhjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay5ub3RleGlzdHMoY3R4LmdldCgicGFnZV90aXRsZSIpLGN0eCx7ImJsb2NrIjpib2R5XzE0fSxudWxsKTt9ZnVuY3Rpb24gYm9keV8xNChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgidW50aXRsZWQiKTt9ZnVuY3Rpb24gYm9keV8xNShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiKDxzcGFuIGNsYXNzPVwieWVhclwiPiIpLnJlZmVyZW5jZShjdHguZ2V0KCJZRUFSIiksY3R4LCJoIikud3JpdGUoIjwvc3Bhbj4pIik7fWZ1bmN0aW9uIGJvZHlfMTYoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICIpLm5vdGV4aXN0cyhjdHguZ2V0KCJxdWVyeV9hdXRob3IiKSxjdHgseyJibG9jayI6Ym9keV8xN30sbnVsbCkud3JpdGUoIlxuIik7fWZ1bmN0aW9uIGJvZHlfMTcoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgicXVlcnlfdXNlciIpLGN0eCx7ImJsb2NrIjpib2R5XzE4fSxudWxsKS53cml0ZSgiXG4gICAgIik7fWZ1bmN0aW9uIGJvZHlfMTgoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjxwPiIpLmV4aXN0cyhjdHguZ2V0KCJpc191c2Vyc19vd25fcGFnZSIpLGN0eCx7ImVsc2UiOmJvZHlfMTksImJsb2NrIjpib2R5XzIwfSxudWxsKS53cml0ZSgiIG5vIHNvdXJjZXMgd2l0aCBhdXRob3JzIHlldC48L2E+Iikud3JpdGUoIlxuICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8xOShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdXNlciIpLGN0eCwiaCIpLndyaXRlKCIgaGFzIik7fWZ1bmN0aW9uIGJvZHlfMjAoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIllvdSBoYXZlIik7fXJldHVybiBib2R5XzA7fSkoKTsoZnVuY3Rpb24oKXtkdXN0LnJlZ2lzdGVyKCJiYXNlLmh0bWwiLGJvZHlfMCk7ZnVuY3Rpb24gYm9keV8wKGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIjwhRE9DVFlQRSBodG1sIFBVQkxJQyBcIi0vL1czQy8vRFREIFhIVE1MIDEuMCBTdHJpY3QvL0VOXCIgXCJodHRwOi8vd3d3LnczLm9yZy9UUi94aHRtbDEvRFREL3hodG1sMS1zdHJpY3QuZHRkXCI+ICIpLndyaXRlKCJcbiIpLndyaXRlKCI8aHRtbCB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcIiB4bWw6bGFuZz1cImVuXCIgbGFuZz1cImVuXCI+ICIpLndyaXRlKCJcbiAgIikud3JpdGUoIjxoZWFkPiAiKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxtZXRhIGh0dHAtZXF1aXY9XCJDb250ZW50LVR5cGVcIiBjb250ZW50PVwidGV4dC9odG1sOyBjaGFyc2V0PVVURi04XCIgLz4gIikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8bGluayByZWw9XCJzdHlsZXNoZWV0XCIgdHlwZT1cInRleHQvY3NzXCIgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi9zdGF0aWMvc3R5bGUuY3NzXCIgLz4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjx0aXRsZT4iKS5yZWZlcmVuY2UoY3R4LmdldCgidGl0bGUiKSxjdHgsImgiKS53cml0ZSgiPC90aXRsZT4gIikud3JpdGUoIlxuICAiKS53cml0ZSgiPC9oZWFkPiAiKS53cml0ZSgiXG4gICIpLndyaXRlKCI8Ym9keT4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8IS0tIHNlc3Npb24gbWFuYWdlbWVudCAtLT4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxkaXYgaWQ9XCJzZXNzaW9uLWNvbnRhaW5lclwiPiIpLndyaXRlKCJcbiAgICAgICIpLndyaXRlKCI8ZGl2IGlkPVwibnJhbWFfbG9nb1wiPjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLndyaXRlKCJcIj5Ob3RlLW8tcmFtYTwvYT48L2Rpdj4iKS53cml0ZSgiXG4gICAgICAiKS5wYXJ0aWFsKCJzZXNzaW9uLmh0bWwiLGN0eCkud3JpdGUoIlxuICAgICIpLndyaXRlKCI8L2Rpdj4iKS53cml0ZSgiXG4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxkaXYgaWQ9XCJjb250ZW50XCI+Iikud3JpdGUoIlxuICAgICAgIikucmVmZXJlbmNlKGN0eC5nZXQoImNvbnRlbnQiKSxjdHgsImgiLFsicyJdKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPHNjcmlwdCBzcmM9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLndyaXRlKCIvc3RhdGljL2pzL2pxdWVyeS0xLjUuMi5taW4uanNcIj48L3NjcmlwdD4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxzY3JpcHQgc3JjPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3N0YXRpYy9qcy9qcXVlcnktdWkubWluLmpzXCI+PC9zY3JpcHQ+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8c2NyaXB0IHNyYz1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi9zdGF0aWMvanMvanNvbjIuanNcIj48L3NjcmlwdD4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxzY3JpcHQgc3JjPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3N0YXRpYy9qcy9qcXVlcnkuc2ltcGxlbW9kYWwtMS40LjEuanNcIj48L3NjcmlwdD4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxzY3JpcHQgc3JjPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3N0YXRpYy9qcy9qcXVlcnkuYXV0b2dyb3ctdGV4dGFyZWEuanNcIj48L3NjcmlwdD4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxzY3JpcHQgc3JjPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3N0YXRpYy9qcy9qcXVlcnkuc29ydGxpc3QuanNcIj48L3NjcmlwdD4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxzY3JpcHQgc3JjPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3N0YXRpYy9qcy9qcXVlcnkudGltZWFnby5qc1wiPjwvc2NyaXB0PiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPHNjcmlwdCBzcmM9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLndyaXRlKCIvc3RhdGljL2pzL2pxdWVyeS5qcWNsb3VkLm1pbi5qc1wiPjwvc2NyaXB0PiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPHNjcmlwdCBzcmM9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLndyaXRlKCIva2Fuc28uanNcIj48L3NjcmlwdD4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIlxuICAiKS53cml0ZSgiPC9ib2R5PiIpLndyaXRlKCJcbiIpLndyaXRlKCI8L2h0bWw+Iikud3JpdGUoIlxuIik7fXJldHVybiBib2R5XzA7fSkoKTsoZnVuY3Rpb24oKXtkdXN0LnJlZ2lzdGVyKCJiaWJsaW9ncmFwaGljX2RldGFpbHMuaHRtbCIsYm9keV8wKTtmdW5jdGlvbiBib2R5XzAoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiPGRpdiBjbGFzcz1cImJpYmxpb2dyYXBoaWMtZGV0YWlsc1wiPiIpLndyaXRlKCJcbiAgICAiKS5leGlzdHMoY3R4LmdldCgiQVVUSE9SIiksY3R4LHsiYmxvY2siOmJvZHlfMX0sbnVsbCkud3JpdGUoIlxuICAgICIpLmV4aXN0cyhjdHguZ2V0KCJKT1VSTkFMIiksY3R4LHsiYmxvY2siOmJvZHlfNX0sbnVsbCkud3JpdGUoIlxuICAgICIpLmV4aXN0cyhjdHguZ2V0KCJCT09LVElUTEUiKSxjdHgseyJibG9jayI6Ym9keV83fSxudWxsKS53cml0ZSgiXG4gICAgIikuZXhpc3RzKGN0eC5nZXQoInVybCIpLGN0eCx7ImJsb2NrIjpib2R5XzEwfSxudWxsKS53cml0ZSgiXG4gICAgIikuZXhpc3RzKGN0eC5nZXQoInVwZGF0ZWRfdGltZSIpLGN0eCx7ImJsb2NrIjpib2R5XzExfSxudWxsKS53cml0ZSgiXG4iKS53cml0ZSgiPC9kaXY+Iik7fWZ1bmN0aW9uIGJvZHlfMShjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjxkaXYgY2xhc3M9XCJhdXRob3JzXCI+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikuc2VjdGlvbihjdHguZ2V0KCJBVVRIT1IiKSxjdHgseyJibG9jayI6Ym9keV8yfSxudWxsKS53cml0ZSgiLiIpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiAgICAiKTt9ZnVuY3Rpb24gYm9keV8yKGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV91c2VyX3VybCIpLGN0eCwiaCIpLndyaXRlKCIvYXV0aG9ycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgodHJ1ZSxbXSksY3R4LCJoIixbInVjIl0pLndyaXRlKCJcIiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCJjbGFzcz1cImF1dGhvciBhdXRob3JfIikuaGVscGVyKCJpZHgiLGN0eCx7ImJsb2NrIjpib2R5XzN9LG51bGwpLndyaXRlKCJcIiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIj4iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgodHJ1ZSxbXSksY3R4LCJoIikud3JpdGUoIjwvYT4iKS5oZWxwZXIoInNlcCIsY3R4LHsiYmxvY2siOmJvZHlfNH0sbnVsbCk7fWZ1bmN0aW9uIGJvZHlfMyhjaGssY3R4KXtyZXR1cm4gY2hrLnJlZmVyZW5jZShjdHguZ2V0UGF0aCh0cnVlLFtdKSxjdHgsImgiKTt9ZnVuY3Rpb24gYm9keV80KGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIiBhbmQgIik7fWZ1bmN0aW9uIGJvZHlfNShjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjxkaXY+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjxzcGFuIGNsYXNzPVwiam91cm5hbFwiPiIpLnJlZmVyZW5jZShjdHguZ2V0KCJKT1VSTkFMIiksY3R4LCJoIikud3JpdGUoIjwvc3Bhbj4iKS53cml0ZSgiXG4gICAgICAgICAgICAiKS5yZWZlcmVuY2UoY3R4LmdldCgiVk9MVU1FIiksY3R4LCJoIikud3JpdGUoIigiKS5yZWZlcmVuY2UoY3R4LmdldCgiTlVNQkVSIiksY3R4LCJoIikud3JpdGUoIikuIikud3JpdGUoIlxuICAgICAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoIlBBR0VTIiksY3R4LHsiYmxvY2siOmJvZHlfNn0sbnVsbCkud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAgICIpO31mdW5jdGlvbiBib2R5XzYoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoInBwLiA8c3BhbiBjbGFzcz1cIlBBR0VTXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoIlBBR0VTIiksY3R4LCJoIikud3JpdGUoIjwvc3Bhbj4uIikud3JpdGUoIlxuICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfNyhjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjxkaXY+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIkluIDxzcGFuIGNsYXNzPVwiYm9va3RpdGxlXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoIkJPT0tUSVRMRSIpLGN0eCwiaCIpLndyaXRlKCI8L3NwYW4+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoIkVESVRPUiIpLGN0eCx7ImJsb2NrIjpib2R5Xzh9LG51bGwpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8c3BhbiBjbGFzcz1cInB1Ymxpc2hlclwiPiIpLnJlZmVyZW5jZShjdHguZ2V0KCJQVUJMSVNIRVIiKSxjdHgsImgiKS53cml0ZSgiPC9zcGFuPjoiKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPHNwYW4gY2xhc3M9XCJhZGRyZXNzXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoIkFERFJFU1MiKSxjdHgsImgiKS53cml0ZSgiPC9zcGFuPi4iKS53cml0ZSgiXG4gICAgICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgiUEFHRVMiKSxjdHgseyJibG9jayI6Ym9keV85fSxudWxsKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8L2Rpdj4iKS53cml0ZSgiXG4gICAgIik7fWZ1bmN0aW9uIGJvZHlfOChjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiKGVkcy4pIDxzcGFuIGNsYXNzPVwiZWRpdG9yXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoIkVESVRPUiIpLGN0eCwiaCIpLndyaXRlKCI8L3NwYW4+LiIpLndyaXRlKCJcbiAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzkoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoInBwLiA8c3BhbiBjbGFzcz1cIlBBR0VTXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoIlBBR0VTIiksY3R4LCJoIikud3JpdGUoIjwvc3Bhbj4uIikud3JpdGUoIlxuICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMTAoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8ZGl2PiIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoInVybCIpLGN0eCwiaCIpLndyaXRlKCJcIiB0YXJnZXQ9XCJfYmxhbmtcIiBjbGFzcz1cInRpdGxlXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoInVybCIpLGN0eCwiaCIpLndyaXRlKCI8L2E+Iikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAgICIpO31mdW5jdGlvbiBib2R5XzExKGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGRpdj4iKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiVXBkYXRlZCA8YWJiciBjbGFzcz1cIl90aW1lYWdvXCIgdGl0bGU9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgidXBkYXRlZF90aW1lIiksY3R4LCJoIikud3JpdGUoIlwiPiIpLnJlZmVyZW5jZShjdHguZ2V0KCJ1cGRhdGVkX3RpbWUiKSxjdHgsImgiKS53cml0ZSgiPC9hYmJyPi4iKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8L2Rpdj4iKS53cml0ZSgiXG4gICAgIik7fXJldHVybiBib2R5XzA7fSkoKTsoZnVuY3Rpb24oKXtkdXN0LnJlZ2lzdGVyKCJiaWJsaW9ncmFwaGljX2RldGFpbHNfY29tcGFjdC5odG1sIixib2R5XzApO2Z1bmN0aW9uIGJvZHlfMChjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCI8ZGl2IGNsYXNzPVwiYmlibGlvZ3JhcGhpYy1kZXRhaWxzIGNvbXBhY3RcIj4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxkaXY+Iikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiJm1kYXNoOyIpLndyaXRlKCJcbiAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoIkFVVEhPUiIpLGN0eCx7ImJsb2NrIjpib2R5XzF9LG51bGwpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV91c2VyX3VybCIpLGN0eCwiaCIpLndyaXRlKCIvc291cmNlcy8iKS5yZWZlcmVuY2UoY3R4LmdldCgicGFnZV9pZCIpLGN0eCwiaCIsWyJ1YyJdKS53cml0ZSgiXCI+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikucmVmZXJlbmNlKGN0eC5nZXQoIlRJVExFIiksY3R4LCJoIikubm90ZXhpc3RzKGN0eC5nZXQoIlRJVExFIiksY3R4LHsiYmxvY2siOmJvZHlfNn0sbnVsbCkud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPC9hPiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8ZGl2PiIpLndyaXRlKCJcbiAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoIkpPVVJOQUwiKSxjdHgseyJibG9jayI6Ym9keV84fSxudWxsKS53cml0ZSgiXG4gICAgICAgICIpLmV4aXN0cyhjdHguZ2V0KCJCT09LVElUTEUiKSxjdHgseyJibG9jayI6Ym9keV8xMH0sbnVsbCkud3JpdGUoIlxuICAgICIpLndyaXRlKCI8L2Rpdj4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxkaXY+Iikud3JpdGUoIlxuICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgidXJsIiksY3R4LHsiYmxvY2siOmJvZHlfMTN9LG51bGwpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAgICIpLmV4aXN0cyhjdHguZ2V0KCJ1cGRhdGVkX3RpbWUiKSxjdHgseyJibG9jayI6Ym9keV8xNH0sbnVsbCkud3JpdGUoIlxuIikud3JpdGUoIjwvZGl2PiIpO31mdW5jdGlvbiBib2R5XzEoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPHNwYW4gY2xhc3M9XCJhdXRob3JzXCI+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLnNlY3Rpb24oY3R4LmdldCgiQVVUSE9SIiksY3R4LHsiYmxvY2siOmJvZHlfMn0sbnVsbCkud3JpdGUoIi4iKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPC9zcGFuPiIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLmV4aXN0cyhjdHguZ2V0KCJZRUFSIiksY3R4LHsiYmxvY2siOmJvZHlfNX0sbnVsbCkud3JpdGUoIlxuICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8yKGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV91c2VyX3VybCIpLGN0eCwiaCIpLndyaXRlKCIvYXV0aG9ycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgodHJ1ZSxbXSksY3R4LCJoIixbInVjIl0pLndyaXRlKCJcIiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiY2xhc3M9XCJhdXRob3IgYXV0aG9yXyIpLmhlbHBlcigiaWR4IixjdHgseyJibG9jayI6Ym9keV8zfSxudWxsKS53cml0ZSgiXCIiKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPiIpLnJlZmVyZW5jZShjdHguZ2V0UGF0aCh0cnVlLFtdKSxjdHgsImgiKS53cml0ZSgiPC9hPiIpLmhlbHBlcigic2VwIixjdHgseyJibG9jayI6Ym9keV80fSxudWxsKTt9ZnVuY3Rpb24gYm9keV8zKGNoayxjdHgpe3JldHVybiBjaGsucmVmZXJlbmNlKGN0eC5nZXRQYXRoKHRydWUsW10pLGN0eCwiaCIpO31mdW5jdGlvbiBib2R5XzQoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiIGFuZCAiKTt9ZnVuY3Rpb24gYm9keV81KGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIig8c3BhbiBjbGFzcz1cInllYXJcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgiWUVBUiIpLGN0eCwiaCIpLndyaXRlKCI8L3NwYW4+KSIpO31mdW5jdGlvbiBib2R5XzYoY2hrLGN0eCl7cmV0dXJuIGNoay5yZWZlcmVuY2UoY3R4LmdldCgicGFnZV90aXRsZSIpLGN0eCwiaCIpLm5vdGV4aXN0cyhjdHguZ2V0KCJwYWdlX3RpdGxlIiksY3R4LHsiYmxvY2siOmJvZHlfN30sbnVsbCk7fWZ1bmN0aW9uIGJvZHlfNyhjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJ1bnRpdGxlZCIpO31mdW5jdGlvbiBib2R5XzgoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPHNwYW4+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCI8c3BhbiBjbGFzcz1cImpvdXJuYWxcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgiSk9VUk5BTCIpLGN0eCwiaCIpLndyaXRlKCI8L3NwYW4+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLnJlZmVyZW5jZShjdHguZ2V0KCJWT0xVTUUiKSxjdHgsImgiKS53cml0ZSgiKCIpLnJlZmVyZW5jZShjdHguZ2V0KCJOVU1CRVIiKSxjdHgsImgiKS53cml0ZSgiKS4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoIlBBR0VTIiksY3R4LHsiYmxvY2siOmJvZHlfOX0sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjwvc3Bhbj4iKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzkoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCJwcC4gPHNwYW4gY2xhc3M9XCJQQUdFU1wiPiIpLnJlZmVyZW5jZShjdHguZ2V0KCJQQUdFUyIpLGN0eCwiaCIpLndyaXRlKCI8L3NwYW4+LiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8xMChjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8c3Bhbj4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIkluIDxzcGFuIGNsYXNzPVwiYm9va3RpdGxlXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoIkJPT0tUSVRMRSIpLGN0eCwiaCIpLndyaXRlKCI8L3NwYW4+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLmV4aXN0cyhjdHguZ2V0KCJFRElUT1IiKSxjdHgseyJibG9jayI6Ym9keV8xMX0sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCI8c3BhbiBjbGFzcz1cInB1Ymxpc2hlclwiPiIpLnJlZmVyZW5jZShjdHguZ2V0KCJQVUJMSVNIRVIiKSxjdHgsImgiKS53cml0ZSgiPC9zcGFuPjoiKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIjxzcGFuIGNsYXNzPVwiYWRkcmVzc1wiPiIpLnJlZmVyZW5jZShjdHguZ2V0KCJBRERSRVNTIiksY3R4LCJoIikud3JpdGUoIjwvc3Bhbj4uIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLmV4aXN0cyhjdHguZ2V0KCJQQUdFUyIpLGN0eCx7ImJsb2NrIjpib2R5XzEyfSxudWxsKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPC9zcGFuPiIpLndyaXRlKCJcbiAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMTEoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCIoZWRzLikgPHNwYW4gY2xhc3M9XCJlZGl0b3JcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgiRURJVE9SIiksY3R4LCJoIikud3JpdGUoIjwvc3Bhbj4uIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzEyKGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgicHAuIDxzcGFuIGNsYXNzPVwiUEFHRVNcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgiUEFHRVMiKSxjdHgsImgiKS53cml0ZSgiPC9zcGFuPi4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMTMoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPHNwYW4+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoInVybCIpLGN0eCwiaCIpLndyaXRlKCJcIiB0YXJnZXQ9XCJfYmxhbmtcIiBjbGFzcz1cInRpdGxlXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoInVybCIpLGN0eCwiaCIpLndyaXRlKCI8L2E+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjwvc3Bhbj4iKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzE0KGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGRpdj4iKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiVXBkYXRlZCA8YWJiciBjbGFzcz1cIl90aW1lYWdvXCIgdGl0bGU9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgidXBkYXRlZF90aW1lIiksY3R4LCJoIikud3JpdGUoIlwiPiIpLnJlZmVyZW5jZShjdHguZ2V0KCJ1cGRhdGVkX3RpbWUiKSxjdHgsImgiKS53cml0ZSgiPC9hYmJyPi4iKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8L2Rpdj4iKS53cml0ZSgiXG4gICAgIik7fXJldHVybiBib2R5XzA7fSkoKTsoZnVuY3Rpb24oKXtkdXN0LnJlZ2lzdGVyKCJmbG93Lmh0bWwiLGJvZHlfMCk7dmFyIGJsb2Nrcz17d2hhdDpib2R5XzF9O2Z1bmN0aW9uIGJvZHlfMChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay5wYXJ0aWFsKCJ1c2VyX2hlYWRlci5odG1sIixjdHgpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLndyaXRlKCI8ZGl2IGNsYXNzPVwibmF2aWdhdGlvblwiID4iKS53cml0ZSgiXG4gICAgIikubm90ZXhpc3RzKGN0eC5nZXQoImlzX3VzZXJzX293bl9wYWdlIiksY3R4LHsiYmxvY2siOmJvZHlfMn0sbnVsbCkud3JpdGUoIlxuICAgICIpLndyaXRlKCJcbiAgICAiKS5ub3RleGlzdHMoY3R4LmdldCgiaXNfdXNlcnNfb3duX3BhZ2UiKSxjdHgseyJlbHNlIjpib2R5XzExLCJibG9jayI6Ym9keV8xM30sbnVsbCkud3JpdGUoIlxuIikud3JpdGUoIlxuIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLmV4aXN0cyhjdHguZ2V0KCJxdWVyeV90YWciKSxjdHgseyJibG9jayI6Ym9keV8xOH0sbnVsbCkud3JpdGUoIlxuICAgICIpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLnNlY3Rpb24oY3R4LmdldCgicXVvdGVzIiksY3R4LHsiYmxvY2siOmJvZHlfMTl9LG51bGwpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLnBhcnRpYWwoImZvb3Rlcl9ldmVudC5odG1sIixjdHgpO31mdW5jdGlvbiBib2R5XzEoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIm5vdGVzIik7fWZ1bmN0aW9uIGJvZHlfMihjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICIpLmV4aXN0cyhjdHguZ2V0UGF0aChmYWxzZSxbInVzZXJDdHgiLCJuYW1lIl0pLGN0eCx7ImJsb2NrIjpib2R5XzN9LG51bGwpLndyaXRlKCJcbiAgICAiKTt9ZnVuY3Rpb24gYm9keV8zKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICIpLmV4aXN0cyhjdHguZ2V0KCJxdWVyeV91c2VyIiksY3R4LHsiZWxzZSI6Ym9keV80LCJibG9jayI6Ym9keV84fSxudWxsKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzQoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLm5vdGV4aXN0cyhjdHguZ2V0KCJub19zb3VyY2VzIiksY3R4LHsiYmxvY2siOmJvZHlfNX0sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfNShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCItLSBzZWUgJmFtcDsgZWRpdCA8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3VzZXJzLyIpLnJlZmVyZW5jZShjdHguZ2V0UGF0aChmYWxzZSxbInVzZXJDdHgiLCJuYW1lIl0pLGN0eCwiaCIsWyJ1YyJdKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfc291cmNlX3VybCIpLGN0eCwiaCIpLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV90YWdfdXJsIiksY3R4LCJoIikud3JpdGUoIlwiPm9ubHkgeW91ciBub3RlcyAiKS5leGlzdHMoY3R4LmdldCgicXVlcnlfdGFnIiksY3R4LHsiYmxvY2siOmJvZHlfNn0sbnVsbCkuZXhpc3RzKGN0eC5nZXQoInF1ZXJ5X3NvdXJjZSIpLGN0eCx7ImJsb2NrIjpib2R5Xzd9LG51bGwpLndyaXRlKCI8L2E+OyA8YnIgLz4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfNihjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgid2l0aCB0aGlzIHRhZyIpO31mdW5jdGlvbiBib2R5XzcoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIm9uIHRoaXMgc291cmNlIik7fWZ1bmN0aW9uIGJvZHlfOChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIi0tIHNlZSAmYW1wOyBlZGl0IDxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLndyaXRlKCIvdXNlcnMvIikucmVmZXJlbmNlKGN0eC5nZXRQYXRoKGZhbHNlLFsidXNlckN0eCIsIm5hbWUiXSksY3R4LCJoIixbInVjIl0pLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV9zb3VyY2VfdXJsIiksY3R4LCJoIikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3RhZ191cmwiKSxjdHgsImgiKS53cml0ZSgiXCI+eW91ciBub3RlcyAiKS5leGlzdHMoY3R4LmdldCgicXVlcnlfdGFnIiksY3R4LHsiYmxvY2siOmJvZHlfOX0sbnVsbCkuZXhpc3RzKGN0eC5nZXQoInF1ZXJ5X3NvdXJjZSIpLGN0eCx7ImJsb2NrIjpib2R5XzEwfSxudWxsKS53cml0ZSgiPC9hPjsgPGJyIC8+Iikud3JpdGUoIlxuICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfOShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgid2l0aCB0aGlzIHRhZyIpO31mdW5jdGlvbiBib2R5XzEwKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJvbiB0aGlzIHNvdXJjZSIpO31mdW5jdGlvbiBib2R5XzExKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgIikuZXhpc3RzKGN0eC5nZXRQYXRoKGZhbHNlLFsidXNlckN0eCIsIm5hbWUiXSksY3R4LHsiYmxvY2siOmJvZHlfMTJ9LG51bGwpLndyaXRlKCJcbiAgICAiKTt9ZnVuY3Rpb24gYm9keV8xMihjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiLS0gICAgICAgICIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCJnbyB0byAiKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi9zb3VyY2VzXCI+eW91ciBzb3VyY2VzPC9hPiwiKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi9hdXRob3JzXCI+YXV0aG9yczwvYT4gb3IiKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi90YWdzXCI+dGFnczwvYT4gIikud3JpdGUoIlxuICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8xMyhjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICIpLmV4aXN0cyhjdHguZ2V0KCJxdWVyeV91c2VyIiksY3R4LHsiZWxzZSI6Ym9keV8xNCwiYmxvY2siOmJvZHlfMTZ9LG51bGwpLndyaXRlKCJcbiAgICAiKTt9ZnVuY3Rpb24gYm9keV8xNChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiXG4gICAgICAgICAgICAiKS5leGlzdHMoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgseyJibG9jayI6Ym9keV8xNX0sbnVsbCkud3JpdGUoIlxuICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8xNShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIi0tICAgICAgICAiKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoImdvIHRvICIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi9zb3VyY2VzXCI+eW91ciBzb3VyY2VzPC9hPiwiKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLndyaXRlKCIvdXNlcnMvIikucmVmZXJlbmNlKGN0eC5nZXRQYXRoKGZhbHNlLFsidXNlckN0eCIsIm5hbWUiXSksY3R4LCJoIixbInVjIl0pLndyaXRlKCIvYXV0aG9yc1wiPmF1dGhvcnM8L2E+IG9yIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3VzZXJzLyIpLnJlZmVyZW5jZShjdHguZ2V0UGF0aChmYWxzZSxbInVzZXJDdHgiLCJuYW1lIl0pLGN0eCwiaCIsWyJ1YyJdKS53cml0ZSgiL3RhZ3NcIj50YWdzPC9hPiAiKS53cml0ZSgiXG4gICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8xNihjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiLS0gICAgICAgICIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCJzZWUiKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3VzZXJfdXJsIiksY3R4LCJoIikud3JpdGUoIi9zb3VyY2VzXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgsImgiKS53cml0ZSgiJ3Mgc291cmNlczwvYT4sIikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV91c2VyX3VybCIpLGN0eCwiaCIpLndyaXRlKCIvYXV0aG9yc1wiPmF1dGhvcnM8L2E+IG9yIikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV91c2VyX3VybCIpLGN0eCwiaCIpLndyaXRlKCIvdGFnc1wiPnRhZ3M8L2E+IikuZXhpc3RzKGN0eC5nZXRQYXRoKGZhbHNlLFsidXNlckN0eCIsIm5hbWUiXSksY3R4LHsiYmxvY2siOmJvZHlfMTd9LG51bGwpLndyaXRlKCJcbiAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMTcoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIjsgIik7fWZ1bmN0aW9uIGJvZHlfMTgoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICIpLndyaXRlKCI8aDE+IyIpLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV90YWciKSxjdHgsImgiKS53cml0ZSgiPC9oMT4iKS53cml0ZSgiXG4iKTt9ZnVuY3Rpb24gYm9keV8xOShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgIikud3JpdGUoIjxkaXYgY2xhc3M9XCJfbnJhbWEtcXVvdGVcIiBpZD1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJoYXNoIiksY3R4LCJoIikud3JpdGUoIlwiID4iKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8ZGl2IGNsYXNzPVwicXVvdGUtbGluZSBmbG93XCI+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIlwiPHNwYW4gY2xhc3M9XCJxdW90ZS1jb250ZW50XCI+IikucmVmZXJlbmNlKGN0eC5nZXQoImNvbnRlbnQiKSxjdHgsImgiKS53cml0ZSgiPC9zcGFuPlwiIikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIlxuICAgICAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoImlzX3VzZXJzX293bl9wYWdlIiksY3R4LHsiYmxvY2siOmJvZHlfMjB9LG51bGwpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGRpdiBjbGFzcz1cInNvdXJjZS1mb3Itc2luZ2xlLXF1b3RlXCI+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikuc2VjdGlvbihjdHguZ2V0KCJzb3VyY2UiKSxjdHgseyJibG9jayI6Ym9keV8yMX0sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjxkaXYgY2xhc3M9XCJjaXRlZC1ieVwiPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS5ub3RleGlzdHMoY3R4LmdldCgicXVlcnlfdXNlciIpLGN0eCx7ImJsb2NrIjpib2R5XzIyfSxudWxsKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPHVsIGNsYXNzPVwibm90ZXMgX3NvcnQtbWUgIikubm90ZXhpc3RzKGN0eC5nZXQoImlzX3VzZXJzX293bl9wYWdlIiksY3R4LHsiYmxvY2siOmJvZHlfMjV9LG51bGwpLndyaXRlKCJcIj4iKS53cml0ZSgiXG4gICAgICAgICAgICAiKS5zZWN0aW9uKGN0eC5nZXQoIm5vdGVzIiksY3R4LHsiYmxvY2siOmJvZHlfMjZ9LG51bGwpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjwvdWw+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8L2Rpdj4iKS53cml0ZSgiXG4iKTt9ZnVuY3Rpb24gYm9keV8yMChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIjxhIGNsYXNzPVwiYWRkLWEtbm90ZVwiPlsrXTwvYT4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIlxuICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMjEoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLnBhcnRpYWwoImJpYmxpb2dyYXBoaWNfZGV0YWlsc19jb21wYWN0Lmh0bWwiLGN0eCkud3JpdGUoIlxuICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMjIoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiW2NpdGVkIGJ5Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS5zZWN0aW9uKGN0eC5nZXQoInVzZXJzIiksY3R4LHsiYmxvY2siOmJvZHlfMjN9LG51bGwpLndyaXRlKCJdIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzIzKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCI8c3BhbiBjbGFzcz0ncXVvdGUtdXNlcl9pZCc+PGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgodHJ1ZSxbXSksY3R4LCJoIixbInVjIl0pLndyaXRlKCJcIj4iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgodHJ1ZSxbXSksY3R4LCJoIikud3JpdGUoIjwvYT48L3NwYW4+IikuaGVscGVyKCJzZXAiLGN0eCx7ImJsb2NrIjpib2R5XzI0fSxudWxsKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzI0KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCIsICIpO31mdW5jdGlvbiBib2R5XzI1KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJfbm90X3VzZXJfcGFnZSIpO31mdW5jdGlvbiBib2R5XzI2KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGxpIGlkPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoIl9pZCIpLGN0eCwiaCIpLndyaXRlKCJcIiBjbGFzcz1cIl9ucmFtYS1ub3RlXCI+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgiaXNfdXNlcnNfb3duX3BhZ2UiKSxjdHgseyJlbHNlIjpib2R5XzI3LCJibG9jayI6Ym9keV8yOX0sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCI8L2xpPiIpLndyaXRlKCJcbiAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzI3KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICIpLm5vdGV4aXN0cyhjdHguZ2V0KCJxdWVyeV91c2VyIiksY3R4LHsiYmxvY2siOmJvZHlfMjh9LG51bGwpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCI8c3BhbiBjbGFzcz1cIl9ucmFtYS1ub3RlLWNvbnRlbnRcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgiY29udGVudCIpLGN0eCwiaCIpLndyaXRlKCI8L3NwYW4+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8yOChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIjxzcGFuIGNsYXNzPSdxdW90ZS11c2VyX2lkJz48YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3VzZXJzLyIpLnJlZmVyZW5jZShjdHguZ2V0KCJ1c2VyX2lkIiksY3R4LCJoIixbInVjIl0pLndyaXRlKCJcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgidXNlcl9pZCIpLGN0eCwiaCIpLndyaXRlKCI8L2E+PC9zcGFuPl0iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8yOShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPHRleHRhcmVhIGNsYXNzPVwiX25yYW1hLW5vdGUtY29udGVudFwiIHJvd3M9XCIxXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoImNvbnRlbnQiKSxjdHgsImgiKS53cml0ZSgiPC90ZXh0YXJlYT4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICIpO31yZXR1cm4gYm9keV8wO30pKCk7KGZ1bmN0aW9uKCl7ZHVzdC5yZWdpc3RlcigiZm9vdGVyX2V2ZW50Lmh0bWwiLGJvZHlfMCk7ZnVuY3Rpb24gYm9keV8wKGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIjxzY3JpcHQ+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCJpZiggdHlwZW9mICQgIT09ICd1bmRlZmluZWQnICkgeyIpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIiQoZG9jdW1lbnQpLnRyaWdnZXIoJ25yYW1hX3BhZ2VfbG9hZGVkJyk7Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCJ9Iikud3JpdGUoIlxuIikud3JpdGUoIjwvc2NyaXB0PiIpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpO31yZXR1cm4gYm9keV8wO30pKCk7KGZ1bmN0aW9uKCl7ZHVzdC5yZWdpc3RlcigicXVvdGVzLmh0bWwiLGJvZHlfMCk7dmFyIGJsb2Nrcz17d2hhdDpib2R5XzF9O2Z1bmN0aW9uIGJvZHlfMChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay5wYXJ0aWFsKCJ1c2VyX2hlYWRlci5odG1sIixjdHgpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLndyaXRlKCI8ZGl2IGNsYXNzPVwibmF2aWdhdGlvblwiID4iKS53cml0ZSgiXG4gICAgIikuZXhpc3RzKGN0eC5nZXQoImlzX3VzZXJzX293bl9wYWdlIiksY3R4LHsiZWxzZSI6Ym9keV8yLCJibG9jayI6Ym9keV8xNH0sbnVsbCkud3JpdGUoIlxuICAgICIpLndyaXRlKCJcbiAgICAiKS5ub3RleGlzdHMoY3R4LmdldCgiaXNfdXNlcnNfb3duX3BhZ2UiKSxjdHgseyJlbHNlIjpib2R5XzE3LCJibG9jayI6Ym9keV8xOX0sbnVsbCkud3JpdGUoIlxuIikud3JpdGUoIlxuIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLndyaXRlKCI8aDE+Iikud3JpdGUoIlxuICAgICIpLmV4aXN0cyhjdHguZ2V0KCJxdWVyeV90YWciKSxjdHgseyJibG9jayI6Ym9keV8yNH0sbnVsbCkud3JpdGUoIlxuICAgICIpLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV9hdXRob3IiKSxjdHgsImgiKS53cml0ZSgiXG4iKS53cml0ZSgiPC9oMT4iKS53cml0ZSgiXG4iKS53cml0ZSgiXG4iKS5zZWN0aW9uKGN0eC5nZXQoInNvdXJjZXMiKSxjdHgseyJibG9jayI6Ym9keV8yNX0sbnVsbCkud3JpdGUoIlxuIikuZXhpc3RzKGN0eC5nZXQoIm5vX3NvdXJjZXMiKSxjdHgseyJibG9jayI6Ym9keV80Nn0sbnVsbCkud3JpdGUoIlxuIikud3JpdGUoIlxuIikucGFydGlhbCgiZm9vdGVyX2V2ZW50Lmh0bWwiLGN0eCk7fWZ1bmN0aW9uIGJvZHlfMShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgibm90ZXMiKTt9ZnVuY3Rpb24gYm9keV8yKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgIikuZXhpc3RzKGN0eC5nZXRQYXRoKGZhbHNlLFsidXNlckN0eCIsIm5hbWUiXSksY3R4LHsiZWxzZSI6Ym9keV8zLCJibG9jayI6Ym9keV81fSxudWxsKS53cml0ZSgiXG4gICAgIik7fWZ1bmN0aW9uIGJvZHlfMyhjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgicXVlcnlfdXNlciIpLGN0eCx7ImJsb2NrIjpib2R5XzR9LG51bGwpLndyaXRlKCJcbiAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfNChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIi0tIHNlZSA8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfc291cmNlX3VybCIpLGN0eCwiaCIpLndyaXRlKCJcIj5ldmVyeW9uZSdzIG5vdGVzIG9uIHRoaXM8L2E+OyIpLndyaXRlKCJcbiAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzUoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgseyJlbHNlIjpib2R5XzYsImJsb2NrIjpib2R5XzExfSxudWxsKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzYoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLm5vdGV4aXN0cyhjdHguZ2V0KCJub19zb3VyY2VzIiksY3R4LHsiZWxzZSI6Ym9keV83LCJibG9jayI6Ym9keV84fSxudWxsKS53cml0ZSgiXG4gICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV83KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV84KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIi0tIHNlZSAmYW1wOyBlZGl0IDxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLndyaXRlKCIvdXNlcnMvIikucmVmZXJlbmNlKGN0eC5nZXRQYXRoKGZhbHNlLFsidXNlckN0eCIsIm5hbWUiXSksY3R4LCJoIixbInVjIl0pLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV9zb3VyY2VfdXJsIiksY3R4LCJoIikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3RhZ191cmwiKSxjdHgsImgiKS53cml0ZSgiXCI+b25seSB5b3VyIG5vdGVzICIpLmV4aXN0cyhjdHguZ2V0KCJxdWVyeV90YWciKSxjdHgseyJibG9jayI6Ym9keV85fSxudWxsKS5leGlzdHMoY3R4LmdldCgicXVlcnlfc291cmNlIiksY3R4LHsiYmxvY2siOmJvZHlfMTB9LG51bGwpLndyaXRlKCI8L2E+OyIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV85KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJ3aXRoIHRoaXMgdGFnIik7fWZ1bmN0aW9uIGJvZHlfMTAoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIm9uIHRoaXMgc291cmNlIik7fWZ1bmN0aW9uIGJvZHlfMTEoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCItLSBzZWUgJmFtcDsgZWRpdCA8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3VzZXJzLyIpLnJlZmVyZW5jZShjdHguZ2V0UGF0aChmYWxzZSxbInVzZXJDdHgiLCJuYW1lIl0pLGN0eCwiaCIsWyJ1YyJdKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfc291cmNlX3VybCIpLGN0eCwiaCIpLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV90YWdfdXJsIiksY3R4LCJoIikud3JpdGUoIlwiPnlvdXIgbm90ZXMgIikuZXhpc3RzKGN0eC5nZXQoInF1ZXJ5X3RhZyIpLGN0eCx7ImJsb2NrIjpib2R5XzEyfSxudWxsKS5leGlzdHMoY3R4LmdldCgicXVlcnlfc291cmNlIiksY3R4LHsiYmxvY2siOmJvZHlfMTN9LG51bGwpLndyaXRlKCI8L2E+OyIpLndyaXRlKCJcbiAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzEyKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJ3aXRoIHRoaXMgdGFnIik7fWZ1bmN0aW9uIGJvZHlfMTMoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIm9uIHRoaXMgc291cmNlIik7fWZ1bmN0aW9uIGJvZHlfMTQoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiLS0gc2VlIDxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV90YWdfdXJsIiksY3R4LCJoIikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3NvdXJjZV91cmwiKSxjdHgsImgiKS53cml0ZSgiXCI+ZXZlcnlvbmUncyBub3RlcyAiKS5leGlzdHMoY3R4LmdldCgicXVlcnlfdGFnIiksY3R4LHsiYmxvY2siOmJvZHlfMTV9LG51bGwpLmV4aXN0cyhjdHguZ2V0KCJxdWVyeV9zb3VyY2UiKSxjdHgseyJibG9jayI6Ym9keV8xNn0sbnVsbCkud3JpdGUoIjwvYT47Iikud3JpdGUoIlxuICAgICIpO31mdW5jdGlvbiBib2R5XzE1KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJ3aXRoIHRoaXMgdGFnIik7fWZ1bmN0aW9uIGJvZHlfMTYoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIm9uIHRoaXMgc291cmNlIik7fWZ1bmN0aW9uIGJvZHlfMTcoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAiKS5leGlzdHMoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgseyJibG9jayI6Ym9keV8xOH0sbnVsbCkud3JpdGUoIlxuICAgICIpO31mdW5jdGlvbiBib2R5XzE4KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8YnIgLz4tLSAgICAgICAgIikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoImdvIHRvICIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3VzZXJzLyIpLnJlZmVyZW5jZShjdHguZ2V0UGF0aChmYWxzZSxbInVzZXJDdHgiLCJuYW1lIl0pLGN0eCwiaCIsWyJ1YyJdKS53cml0ZSgiL3NvdXJjZXNcIj55b3VyIHNvdXJjZXM8L2E+LCIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3VzZXJzLyIpLnJlZmVyZW5jZShjdHguZ2V0UGF0aChmYWxzZSxbInVzZXJDdHgiLCJuYW1lIl0pLGN0eCwiaCIsWyJ1YyJdKS53cml0ZSgiL2F1dGhvcnNcIj5hdXRob3JzPC9hPiBvciIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3VzZXJzLyIpLnJlZmVyZW5jZShjdHguZ2V0UGF0aChmYWxzZSxbInVzZXJDdHgiLCJuYW1lIl0pLGN0eCwiaCIsWyJ1YyJdKS53cml0ZSgiL3RhZ3NcIj50YWdzPC9hPiAiKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzE5KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgseyJlbHNlIjpib2R5XzIwLCJibG9jayI6Ym9keV8yMn0sbnVsbCkud3JpdGUoIlxuICAgICIpO31mdW5jdGlvbiBib2R5XzIwKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLmV4aXN0cyhjdHguZ2V0UGF0aChmYWxzZSxbInVzZXJDdHgiLCJuYW1lIl0pLGN0eCx7ImJsb2NrIjpib2R5XzIxfSxudWxsKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzIxKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGJyIC8+LS0gICAgICAgICIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiZ28gdG8gIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3VzZXJzLyIpLnJlZmVyZW5jZShjdHguZ2V0UGF0aChmYWxzZSxbInVzZXJDdHgiLCJuYW1lIl0pLGN0eCwiaCIsWyJ1YyJdKS53cml0ZSgiL3NvdXJjZXNcIj55b3VyIHNvdXJjZXM8L2E+LCIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi9hdXRob3JzXCI+YXV0aG9yczwvYT4gb3IiKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLndyaXRlKCIvdXNlcnMvIikucmVmZXJlbmNlKGN0eC5nZXRQYXRoKGZhbHNlLFsidXNlckN0eCIsIm5hbWUiXSksY3R4LCJoIixbInVjIl0pLndyaXRlKCIvdGFnc1wiPnRhZ3M8L2E+ICIpLndyaXRlKCJcbiAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzIyKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8YnIgLz4tLSAgICAgICAgIikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoInNlZSIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdXNlcl91cmwiKSxjdHgsImgiKS53cml0ZSgiL3NvdXJjZXNcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdXNlciIpLGN0eCwiaCIpLndyaXRlKCIncyBzb3VyY2VzPC9hPiwiKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3VzZXJfdXJsIiksY3R4LCJoIikud3JpdGUoIi9hdXRob3JzXCI+YXV0aG9yczwvYT4gb3IiKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3VzZXJfdXJsIiksY3R4LCJoIikud3JpdGUoIi90YWdzXCI+dGFnczwvYT4iKS5leGlzdHMoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgseyJibG9jayI6Ym9keV8yM30sbnVsbCkud3JpdGUoIlxuICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8yMyhjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiOyAiKTt9ZnVuY3Rpb24gYm9keV8yNChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiIyIpLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV90YWciKSxjdHgsImgiKTt9ZnVuY3Rpb24gYm9keV8yNShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgIikud3JpdGUoIjxoMiBjbGFzcz1cInRpdGxlLWxpbmVcIj4iKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdXNlcl91cmwiKSxjdHgsImgiKS53cml0ZSgiL3NvdXJjZXMvIikucmVmZXJlbmNlKGN0eC5nZXQoInBhZ2VfaWQiKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIlwiPiIpLndyaXRlKCJcbiAgICAgICAgIikucmVmZXJlbmNlKGN0eC5nZXQoIlRJVExFIiksY3R4LCJoIikubm90ZXhpc3RzKGN0eC5nZXQoIlRJVExFIiksY3R4LHsiYmxvY2siOmJvZHlfMjZ9LG51bGwpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjwvYT4iKS53cml0ZSgiXG4gICAgICAgICIpLmV4aXN0cyhjdHguZ2V0KCJZRUFSIiksY3R4LHsiYmxvY2siOmJvZHlfMjh9LG51bGwpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPC9oMj4iKS53cml0ZSgiXG4gICAgIikucGFydGlhbCgiYmlibGlvZ3JhcGhpY19kZXRhaWxzLmh0bWwiLGN0eCkud3JpdGUoIlxuICAgICIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPGRpdiBjbGFzcz0ncXVvdGVzJz4iKS53cml0ZSgiXG4gICAgICAgICIpLmV4aXN0cyhjdHguZ2V0KCJxdW90ZXMiKSxjdHgseyJlbHNlIjpib2R5XzI5LCJibG9jayI6Ym9keV8zNH0sbnVsbCkud3JpdGUoIlxuICAgICIpLndyaXRlKCI8L2Rpdj4iKS53cml0ZSgiXG4iKTt9ZnVuY3Rpb24gYm9keV8yNihjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay5yZWZlcmVuY2UoY3R4LmdldCgicGFnZV90aXRsZSIpLGN0eCwiaCIpLm5vdGV4aXN0cyhjdHguZ2V0KCJwYWdlX3RpdGxlIiksY3R4LHsiYmxvY2siOmJvZHlfMjd9LG51bGwpO31mdW5jdGlvbiBib2R5XzI3KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJ1bnRpdGxlZCIpO31mdW5jdGlvbiBib2R5XzI4KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCIoPHNwYW4gY2xhc3M9XCJ5ZWFyXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoIllFQVIiKSxjdHgsImgiKS53cml0ZSgiPC9zcGFuPikiKTt9ZnVuY3Rpb24gYm9keV8yOShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgiaXNfdXNlcnNfb3duX3BhZ2UiKSxjdHgseyJlbHNlIjpib2R5XzMwLCJibG9jayI6Ym9keV8zM30sbnVsbCkud3JpdGUoIlxuICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8zMChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgseyJlbHNlIjpib2R5XzMxLCJibG9jayI6Ym9keV8zMn0sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMzEoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPHA+VGhlcmUgYXJlIG5vIG5vdGVzIG9uIHRoaXMgc291cmNlLjwvcD4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMzIoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPHA+IikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgsImgiKS53cml0ZSgiIGhhcyBub3RlcyBvbiB0aGlzIHNvdXJjZS48L3A+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzMzKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPHA+WW91IGhhdmUgbm8gbm90ZXMgb24gdGhpcyBzb3VyY2UuPC9wPiIpLndyaXRlKCJcbiAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzM0KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICIpLnNlY3Rpb24oY3R4LmdldCgicXVvdGVzIiksY3R4LHsiYmxvY2siOmJvZHlfMzV9LG51bGwpLndyaXRlKCJcbiAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMzUoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCI8ZGl2IGNsYXNzPVwiX25yYW1hLXF1b3RlXCIgaWQ9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiaGFzaCIpLGN0eCwiaCIpLndyaXRlKCJcIiA+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGRpdiBjbGFzcz1cInF1b3RlLWxpbmVcIj4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiXCI8c3BhbiBjbGFzcz1cInF1b3RlLWNvbnRlbnRcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgiY29udGVudCIpLGN0eCwiaCIpLndyaXRlKCI8L3NwYW4+XCIiKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgiaXNfdXNlcnNfb3duX3BhZ2UiKSxjdHgseyJlbHNlIjpib2R5XzM2LCJibG9jayI6Ym9keV80MH0sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCI8dWwgY2xhc3M9XCJub3RlcyBfc29ydC1tZSAiKS5ub3RleGlzdHMoY3R4LmdldCgiaXNfdXNlcnNfb3duX3BhZ2UiKSxjdHgseyJibG9jayI6Ym9keV80MX0sbnVsbCkud3JpdGUoIlwiPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICIpLnNlY3Rpb24oY3R4LmdldCgibm90ZXMiKSxjdHgseyJibG9jayI6Ym9keV80Mn0sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPC91bD4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzM2KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKS5ub3RleGlzdHMoY3R4LmdldCgicXVlcnlfdXNlciIpLGN0eCx7ImJsb2NrIjpib2R5XzM3fSxudWxsKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMzcoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiW2NpdGVkIGJ5Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKS5zZWN0aW9uKGN0eC5nZXQoInVzZXJzIiksY3R4LHsiYmxvY2siOmJvZHlfMzh9LG51bGwpLndyaXRlKCJdIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzM4KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCI8c3BhbiBjbGFzcz0ncXVvdGUtdXNlcl9pZCc+PGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgodHJ1ZSxbXSksY3R4LCJoIixbInVjIl0pLndyaXRlKCJcIj4iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgodHJ1ZSxbXSksY3R4LCJoIikud3JpdGUoIjwvYT48L3NwYW4+IikuaGVscGVyKCJzZXAiLGN0eCx7ImJsb2NrIjpib2R5XzM5fSxudWxsKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzM5KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCIsICIpO31mdW5jdGlvbiBib2R5XzQwKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGEgY2xhc3M9XCJhZGQtYS1ub3RlXCI+WytdPC9hPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzQxKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJfbm90X3VzZXJfcGFnZSIpO31mdW5jdGlvbiBib2R5XzQyKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGxpIGlkPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoIl9pZCIpLGN0eCwiaCIpLndyaXRlKCJcIiBjbGFzcz1cIl9ucmFtYS1ub3RlXCI+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgiaXNfdXNlcnNfb3duX3BhZ2UiKSxjdHgseyJlbHNlIjpib2R5XzQzLCJibG9jayI6Ym9keV80NX0sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCI8L2xpPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzQzKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIpLm5vdGV4aXN0cyhjdHguZ2V0KCJxdWVyeV91c2VyIiksY3R4LHsiYmxvY2siOmJvZHlfNDR9LG51bGwpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCI8c3BhbiBjbGFzcz1cIl9ucmFtYS1ub3RlLWNvbnRlbnRcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgiY29udGVudCIpLGN0eCwiaCIpLndyaXRlKCI8L3NwYW4+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV80NChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIjxzcGFuIGNsYXNzPSdxdW90ZS11c2VyX2lkJz48YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3VzZXJzLyIpLnJlZmVyZW5jZShjdHguZ2V0KCJ1c2VyX2lkIiksY3R4LCJoIixbInVjIl0pLndyaXRlKCJcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgidXNlcl9pZCIpLGN0eCwiaCIpLndyaXRlKCI8L2E+PC9zcGFuPl0iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV80NShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPHRleHRhcmVhIGNsYXNzPVwiX25yYW1hLW5vdGUtY29udGVudFwiIHJvd3M9XCIxXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoImNvbnRlbnQiKSxjdHgsImgiKS53cml0ZSgiPC90ZXh0YXJlYT4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzQ2KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPHA+Iikud3JpdGUoIlxuICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgiaXNfdXNlcnNfb3duX3BhZ2UiKSxjdHgseyJlbHNlIjpib2R5XzQ3LCJibG9jayI6Ym9keV81MH0sbnVsbCkud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgibm8gbm90ZXMiKS53cml0ZSgiXG4gICAgICAgICIpLmV4aXN0cyhjdHguZ2V0KCJxdWVyeV9zb3VyY2UiKSxjdHgseyJlbHNlIjpib2R5XzUxLCJibG9jayI6Ym9keV81Nn0sbnVsbCkud3JpdGUoIlxuICAgICIpLndyaXRlKCI8L3A+Iikud3JpdGUoIlxuIik7fWZ1bmN0aW9uIGJvZHlfNDcoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgseyJlbHNlIjpib2R5XzQ4LCJibG9jayI6Ym9keV80OX0sbnVsbCkud3JpdGUoIlxuICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV80OChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIk5vIG9uZSBoYXMiKS53cml0ZSgiXG4gICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV80OShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgsImgiKS53cml0ZSgiIGhhcyBubyBub3RlcyIpLndyaXRlKCJcbiAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzUwKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCJZb3UgaGF2ZSIpLndyaXRlKCJcbiAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfNTEoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoInF1ZXJ5X3RhZyIpLGN0eCx7ImVsc2UiOmJvZHlfNTIsImJsb2NrIjpib2R5XzU1fSxudWxsKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzUyKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgicXVlcnlfYXV0aG9yIiksY3R4LHsiZWxzZSI6Ym9keV81MywiYmxvY2siOmJvZHlfNTR9LG51bGwpLndyaXRlKCJcbiAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzUzKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIm9uIHRoaXMuIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzU0KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoImZvciBhdXRob3IgIikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X2F1dGhvciIpLGN0eCwiaCIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV81NShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoInRhZ2dlZCB3aXRoICMiKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdGFnIiksY3R4LCJoIikud3JpdGUoIlxuICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfNTYoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIm9uIHRoaXMgc291cmNlIikud3JpdGUoIlxuICAgICAgICAiKTt9cmV0dXJuIGJvZHlfMDt9KSgpOyhmdW5jdGlvbigpe2R1c3QucmVnaXN0ZXIoInJlZ2lzdHJhdGlvbi5odG1sIixib2R5XzApO2Z1bmN0aW9uIGJvZHlfMChjaGssY3R4KXtyZXR1cm4gY2hrLnNlY3Rpb24oY3R4LmdldCgidXNlckN0eCIpLGN0eCx7ImJsb2NrIjpib2R5XzF9LG51bGwpLndyaXRlKCJcbiIpO31mdW5jdGlvbiBib2R5XzEoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICIpLndyaXRlKCI8ZGl2IGlkPVwicmVnaXN0cmF0aW9uXCI+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPGRpdiBjbGFzcz1cImNvbHVtbi1jb250YWluZXJcIiBzdHlsZT1cInBvc2l0aW9uOnJlbGF0aXZlO1wiPiIpLndyaXRlKCJcbiAgICAgICIpLndyaXRlKCI8ZGl2IGNsYXNzPVwibGVmdC1jb2x1bW5cIiIpLndyaXRlKCJcbiAgICAgICAgICAgIikud3JpdGUoInN0eWxlPVwid2lkdGg6IDM3NXB4XCIgPiIpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjxkaXYgY2xhc3M9XCJsZWZ0LWNvbHVtbi1pbm5lclwiIikud3JpdGUoIlxuICAgICAgICAgICAgICIpLndyaXRlKCJzdHlsZT1cInBhZGRpbmctcmlnaHQ6IDE1cHg7XCI+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjxoMiA+R2V0IGl0PC9oMj4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICIpLndyaXRlKCI8cD5TdGVwIDE6ICIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS5ub3RleGlzdHMoY3R4LmdldCgibmFtZSIpLGN0eCx7ImVsc2UiOmJvZHlfMiwiYmxvY2siOmJvZHlfM30sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCI8YnIgLz4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIjxzcGFuICIpLmV4aXN0cyhjdHguZ2V0KCJuYW1lIiksY3R4LHsiYmxvY2siOmJvZHlfNH0sbnVsbCkud3JpdGUoIj4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAiKS53cml0ZSgiKFlvdSBkb24ndCBuZWVkIHRvIHNpZ24gdXAsIGJ1dCBpZiB5b3UgY2hvb3NlIG5vdCB0byBvdGhlcnMgbWF5IGVkaXQiKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAiKS53cml0ZSgib3IgZGVsZXRlIHlvdXIgbm90ZXMuKSIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPHNwYW4+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAiKS53cml0ZSgiPC9wPiIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCJcbiAgICAgICAgICAgICAgIikud3JpdGUoIjxwPlN0ZXAgMjogZHJhZyB0aGUgbGluayBiZWxvdyB0byB0aGUgYm9va21hcmsgYmFyIGluIHlvdXIgYnJvd3NlciAob3Igb3RoZXJ3aXNlIGJvb2ttYXJrIGl0KS48L3A+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAiKS53cml0ZSgiXG4gICAgICAgICAgICAgICIpLndyaXRlKCI8cCBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyXCI+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLm5vdGV4aXN0cyhjdHguZ2V0KCJuYW1lIiksY3R4LHsiZWxzZSI6Ym9keV81LCJibG9jayI6Ym9keV82fSxudWxsKS53cml0ZSgiXG4gICAgICAgICAgICAgICIpLndyaXRlKCI8L3A+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiAgICAgICAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8ZGl2IGNsYXNzPVwicmlnaHQtY29sdW1uXCIiKS53cml0ZSgiXG4gICAgICAgICAgICAgIikud3JpdGUoInN0eWxlPVwicG9zaXRpb246YWJzb2x1dGU7IHJpZ2h0OjA7IHRvcDowOyB3aWR0aDogMzc0cHg7Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjQkJCOyIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoIm5hbWUiKSxjdHgseyJibG9jayI6Ym9keV84fSxudWxsKS53cml0ZSgiXCI+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjxkaXYgY2xhc3M9XCJyaWdodC1jb2x1bW4taW5uZXJcIiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgIikud3JpdGUoInN0eWxlPVwicGFkZGluZy1sZWZ0OiAyNXB4XCIgPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGgyIHN0eWxlPVwibWFyZ2luLXRvcDogMDtcIj4uLi4gb3IgdHJ5IGl0IGZpcnN0PC9oMj4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIjxwPkNsaWNrIHRvIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS5ub3RleGlzdHMoY3R4LmdldCgibmFtZSIpLGN0eCx7ImVsc2UiOmJvZHlfOSwiYmxvY2siOmJvZHlfMTB9LG51bGwpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPC9wPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPHVsIGNsYXNzPVwiaW5zdHJ1Y3Rpb25zXCIgPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIjxsaT5TZWxlY3RpbmcgdGV4dCBoaWdobGlnaHRzIGl0IGFuZCBhZGRzIGl0IHRvIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLndyaXRlKCIvdXNlcnMvIikubm90ZXhpc3RzKGN0eC5nZXQoIm5hbWUiKSxjdHgseyJlbHNlIjpib2R5XzExLCJibG9jayI6Ym9keV8xMn0sbnVsbCkud3JpdGUoIlwiPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgieW91ciBxdW90ZXMiKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPC9hPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIjwvbGk+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGxpPkNsaWNraW5nIGhpZ2hsaWdodGVkIHRleHQgYWRkcyBhIG5vdGUgdG8gdGhlIHBhZ2UuIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPC9saT4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCI8bGk+WW91IGNhbiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3VzZXJzLyIpLm5vdGV4aXN0cyhjdHguZ2V0KCJuYW1lIiksY3R4LHsiZWxzZSI6Ym9keV8xMywiYmxvY2siOmJvZHlfMTR9LG51bGwpLndyaXRlKCJcIj4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoInJldmlldyB5b3VyIG5vdGVzIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIjwvYT4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCI8L2xpPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIjxsaT5JZiB5b3UgY29tZSBiYWNrIHRvIHRoaXMgcGFnZSwgbm90ZXMgd2lsbCIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCJyZS1sb2FkIHdoZW4geW91Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAgICAgIikubm90ZXhpc3RzKGN0eC5nZXQoIm5hbWUiKSxjdHgseyJlbHNlIjpib2R5XzE1LCJibG9jayI6Ym9keV8xNn0sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPC9saT4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIjwvdWw+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuIik7fWZ1bmN0aW9uIGJvZHlfMihjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICIpLndyaXRlKCJkb25lISAod2VsY29tZSAiKS5yZWZlcmVuY2UoY3R4LmdldCgibmFtZSIpLGN0eCwiaCIpLndyaXRlKCIpIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzMoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAiKS53cml0ZSgiKG9wdGlvbmFsKSIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICIpLndyaXRlKCI8c3BhbiBjbGFzcz1cInNpZ251cFwiPjxhIGhyZWY9XCIjXCI+U2lnbiB1cDwvYT48L3NwYW4+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgIikud3JpdGUoIm9yIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgIikud3JpdGUoIjxzcGFuIGNsYXNzPVwibG9naW5cIj48YSBocmVmPVwiI1wiPmxvZ2luPC9hPjwvc3Bhbj4uIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzQoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgic3R5bGU9XCJjb2xvcjpncmV5OyB0ZXh0LWRlY29yYXRpb246IGxpbmUtdGhyb3VnaDtcIiIpO31mdW5jdGlvbiBib2R5XzUoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIjxhIGhyZWY9XCJqYXZhc2NyaXB0OihmdW5jdGlvbigpe2RlbGV0ZSBtb2R1bGU7ZGVsZXRlIGV4cG9ydHM7X25yYW1hX2JrbWtsdD10cnVlO19ucmFtYV91c2VyPSciKS5yZWZlcmVuY2UoY3R4LmdldCgibmFtZSIpLGN0eCwiaCIpLndyaXRlKCInO2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JykpLnNyYz0naHR0cDovL2xvY2FsaG9zdDo1OTg0L25yYW1hL19kZXNpZ24vbnJhbWEvYmttcmtsdC9ucmFtYTIuanM/bm93PW5ldyBEYXRlKCkuZ2V0VGltZSgpJzsgfSkoKTtcIj4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAiKS53cml0ZSgiIU5vdGUtby1yYW1hIEJvb2ttYXJrbGV0IC0tICIpLnJlZmVyZW5jZShjdHguZ2V0KCJuYW1lIiksY3R4LCJoIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCI8L2E+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzYoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIjxhIGhyZWY9XCJqYXZhc2NyaXB0OihmdW5jdGlvbigpe2RlbGV0ZSBtb2R1bGU7ZGVsZXRlIGV4cG9ydHM7X25yYW1hX2JrbWtsdD10cnVlOyIpLmV4aXN0cyhjdHguZ2V0KCJhbm9uX3VzZXJfbmFtZSIpLGN0eCx7ImJsb2NrIjpib2R5Xzd9LG51bGwpLndyaXRlKCJkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpKS5zcmM9J2h0dHA6Ly9sb2NhbGhvc3Q6NTk4NC9ucmFtYS9fZGVzaWduL25yYW1hL2JrbXJrbHQvbnJhbWEyLmpzP25vdz1uZXcgRGF0ZSgpLmdldFRpbWUoKSc7IH0pKCk7XCI+Iikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgIikud3JpdGUoIiFOb3RlLW8tcmFtYSBCb29rbWFya2xldCAtLSBBbm9uLiBVc2VyICIpLnJlZmVyZW5jZShjdHguZ2V0KCJhbm9uX3VzZXJfbmFtZSIpLGN0eCwiaCIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPC9hPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV83KGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIl9ucmFtYV91c2VyPSciKS5yZWZlcmVuY2UoY3R4LmdldCgiYW5vbl91c2VyX25hbWUiKSxjdHgsImgiKS53cml0ZSgiJzsiKTt9ZnVuY3Rpb24gYm9keV84KGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoImNvbG9yOmdyZXk7IHRleHQtZGVjb3JhdGlvbjogbGluZS10aHJvdWdoOyIpO31mdW5jdGlvbiBib2R5XzkoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiZW5hYmxlIG5vdGUtby1yYW1hIGZvciB0aGlzIHBhZ2UuIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8xMChjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIjxhIGhyZWY9XCJqYXZhc2NyaXB0OihmdW5jdGlvbigpe2RlbGV0ZSBtb2R1bGU7ZGVsZXRlIGV4cG9ydHM7X25yYW1hX2JrbWtsdD10cnVlO19ucmFtYV91c2VyPScqdHJ5aXQnO2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JykpLnNyYz0naHR0cDovL2xvY2FsaG9zdDo1OTg0L25yYW1hL19kZXNpZ24vbnJhbWEvYmttcmtsdC9ucmFtYTIuanM/bm93PW5ldyBEYXRlKCkuZ2V0VGltZSgpJzsgfSkoKTtcIj4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiZW5hYmxlIG5vdGUtby1yYW1hIGZvciB0aGlzIHBhZ2UuIikud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPC9hPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMTEoY2hrLGN0eCl7cmV0dXJuIGNoay5yZWZlcmVuY2UoY3R4LmdldCgibmFtZSIpLGN0eCwiaCIsWyJ1YyJdKTt9ZnVuY3Rpb24gYm9keV8xMihjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCIqdHJ5aXQiKTt9ZnVuY3Rpb24gYm9keV8xMyhjaGssY3R4KXtyZXR1cm4gY2hrLnJlZmVyZW5jZShjdHguZ2V0KCJuYW1lIiksY3R4LCJoIixbInVjIl0pO31mdW5jdGlvbiBib2R5XzE0KGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIip0cnlpdCIpO31mdW5jdGlvbiBib2R5XzE1KGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiZW5hYmxlIG5vdGUtby1yYW1hLiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICIpO31mdW5jdGlvbiBib2R5XzE2KGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cImphdmFzY3JpcHQ6KGZ1bmN0aW9uKCl7ZGVsZXRlIG1vZHVsZTtkZWxldGUgZXhwb3J0cztfbnJhbWFfYmtta2x0PXRydWU7X25yYW1hX3VzZXI9Jyp0cnlpdCc7ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKSkuc3JjPSdodHRwOi8vbG9jYWxob3N0OjU5ODQvbnJhbWEvX2Rlc2lnbi9ucmFtYS9ia21ya2x0L25yYW1hMi5qcz9ub3c9bmV3IERhdGUoKS5nZXRUaW1lKCknOyB9KSgpO1wiPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIpLndyaXRlKCJlbmFibGUgbm90ZS1vLXJhbWE8L2E+LiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgICAgICIpO31yZXR1cm4gYm9keV8wO30pKCk7KGZ1bmN0aW9uKCl7ZHVzdC5yZWdpc3Rlcigic2Vzc2lvbi5odG1sIixib2R5XzApO2Z1bmN0aW9uIGJvZHlfMChjaGssY3R4KXtyZXR1cm4gY2hrLnNlY3Rpb24oY3R4LmdldCgidXNlckN0eCIpLGN0eCx7ImJsb2NrIjpib2R5XzF9LG51bGwpLndyaXRlKCJcbiIpO31mdW5jdGlvbiBib2R5XzEoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICIpLndyaXRlKCI8ZGl2IGlkPVwic2Vzc2lvblwiIGNsYXNzPVwiIikuZXhpc3RzKGN0eC5nZXQoIm5hbWUiKSxjdHgseyJlbHNlIjpib2R5XzIsImJsb2NrIjpib2R5XzN9LG51bGwpLndyaXRlKCJcIj4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxzcGFuIGNsYXNzPVwidXNlcm5hbWVcIj48YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS53cml0ZSgiL3VzZXJzLyIpLnJlZmVyZW5jZShjdHguZ2V0KCJuYW1lIiksY3R4LCJoIixbInVjIl0pLndyaXRlKCJcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgibmFtZSIpLGN0eCwiaCIpLndyaXRlKCI8L2E+PC9zcGFuPiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPHVsIGNsYXNzPVwiYWN0aW9uc1wiPiIpLndyaXRlKCJcbiAgICAgICIpLndyaXRlKCI8bGkgY2xhc3M9XCJsb2dvdXRcIj48YSBocmVmPVwiI1wiPkxvZ291dDwvYT48L2xpPiIpLndyaXRlKCJcbiAgICAgICIpLndyaXRlKCI8bGkgY2xhc3M9XCJzaWdudXBcIj48YSBocmVmPVwiI1wiPlNpZ251cDwvYT48L2xpPiIpLndyaXRlKCJcbiAgICAgICIpLndyaXRlKCI8bGkgY2xhc3M9XCJsb2dpblwiPjxhIGhyZWY9XCIjXCI+TG9naW48L2E+PC9saT4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjwvdWw+Iikud3JpdGUoIlxuICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuIik7fWZ1bmN0aW9uIGJvZHlfMihjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJsb2dnZWRvdXQiKTt9ZnVuY3Rpb24gYm9keV8zKGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoImxvZ2dlZGluIik7fXJldHVybiBib2R5XzA7fSkoKTsoZnVuY3Rpb24oKXtkdXN0LnJlZ2lzdGVyKCJzb3VyY2VzLmh0bWwiLGJvZHlfMCk7dmFyIGJsb2Nrcz17d2hhdDpib2R5XzF9O2Z1bmN0aW9uIGJvZHlfMChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay5wYXJ0aWFsKCJ1c2VyX2hlYWRlci5odG1sIixjdHgpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLndyaXRlKCI8ZGl2IGNsYXNzPVwibmF2aWdhdGlvblwiPiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiLS0iKS53cml0ZSgiXG4gICAgIikubm90ZXhpc3RzKGN0eC5nZXQoImlzX3VzZXJzX293bl9wYWdlIiksY3R4LHsiYmxvY2siOmJvZHlfMn0sbnVsbCkud3JpdGUoIlxuICAgICIpLmV4aXN0cyhjdHguZ2V0UGF0aChmYWxzZSxbInVzZXJDdHgiLCJuYW1lIl0pLGN0eCx7ImJsb2NrIjpib2R5XzV9LG51bGwpLndyaXRlKCJcbiIpLndyaXRlKCI8L2Rpdj4iKS53cml0ZSgiXG4iKS53cml0ZSgiXG4iKS53cml0ZSgiXG4iKS53cml0ZSgiXG4iKS53cml0ZSgiPHVsIGNsYXNzPVwic291cmNlc1wiPiIpLndyaXRlKCJcbiAgICAiKS5zZWN0aW9uKGN0eC5nZXQoInNvdXJjZXMiKSxjdHgseyJibG9jayI6Ym9keV84fSxudWxsKS53cml0ZSgiXG4iKS53cml0ZSgiPC91bD4iKS53cml0ZSgiXG4iKS5ub3RleGlzdHMoY3R4LmdldCgic291cmNlcyIpLGN0eCx7ImJsb2NrIjpib2R5XzEyfSxudWxsKS53cml0ZSgiXG4iKS53cml0ZSgiXG4iKS53cml0ZSgiXG4iKTt9ZnVuY3Rpb24gYm9keV8xKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLnJlZmVyZW5jZShjdHguZ2V0UGF0aChmYWxzZSxbInNvdXJjZXMiLCJsZW5ndGgiXSksY3R4LCJoIikud3JpdGUoIiBzb3VyY2VzIik7fWZ1bmN0aW9uIGJvZHlfMihjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICIpLmV4aXN0cyhjdHguZ2V0KCJxdWVyeV91c2VyIiksY3R4LHsiYmxvY2siOmJvZHlfM30sbnVsbCkud3JpdGUoIlxuICAgICIpO31mdW5jdGlvbiBib2R5XzMoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoInNlZSAiKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3VzZXJfdXJsIiksY3R4LCJoIikud3JpdGUoIi9hdXRob3JzXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgsImgiKS53cml0ZSgiJ3MgYXV0aG9yczwvYT4gb3IiKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3VzZXJfdXJsIiksY3R4LCJoIikud3JpdGUoIi90YWdzXCI+dGFnczwvYT4iKS5leGlzdHMoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgseyJibG9jayI6Ym9keV80fSxudWxsKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzQoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIjsgPGJyIC8+LS0gIik7fWZ1bmN0aW9uIGJvZHlfNShjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCJnbyB0byIpLndyaXRlKCJcbiAgICAgICAgIikubm90ZXhpc3RzKGN0eC5nZXQoImlzX3VzZXJzX293bl9wYWdlIiksY3R4LHsiYmxvY2siOmJvZHlfNn0sbnVsbCkud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi9hdXRob3JzXCI+IikuZXhpc3RzKGN0eC5nZXQoImlzX3VzZXJzX293bl9wYWdlIiksY3R4LHsiYmxvY2siOmJvZHlfN30sbnVsbCkud3JpdGUoImF1dGhvcnM8L2E+IG9yIikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi90YWdzXCI+dGFnczwvYT4iKS53cml0ZSgiXG4gICAgIik7fWZ1bmN0aW9uIGJvZHlfNihjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi9zb3VyY2VzXCI+eW91ciBzb3VyY2VzPC9hPiwiKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzcoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoInlvdXIgIik7fWZ1bmN0aW9uIGJvZHlfOChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8bGkgY2xhc3M9XCJzb3VyY2VcIj4iKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPGRpdiBjbGFzcz1cInRpdGxlLWxpbmVcIj4iKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLndyaXRlKCIvdXNlcnMvIikucmVmZXJlbmNlKGN0eC5nZXQoInVzZXJfaWQiKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi9zb3VyY2VzLyIpLnJlZmVyZW5jZShjdHguZ2V0KCJwYWdlX2lkIiksY3R4LCJoIixbInVjIl0pLndyaXRlKCJcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgiVElUTEUiKSxjdHgsImgiKS5ub3RleGlzdHMoY3R4LmdldCgiVElUTEUiKSxjdHgseyJibG9jayI6Ym9keV85fSxudWxsKS53cml0ZSgiPC9hPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoIllFQVIiKSxjdHgseyJibG9jayI6Ym9keV8xMX0sbnVsbCkud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIjxkaXYgY2xhc3M9XCJjaXRhdGlvblwiPiIpLnBhcnRpYWwoImJpYmxpb2dyYXBoaWNfZGV0YWlscy5odG1sIixjdHgpLndyaXRlKCI8L2Rpdj4iKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8L2xpPiIpLndyaXRlKCJcbiAgICAiKTt9ZnVuY3Rpb24gYm9keV85KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLnJlZmVyZW5jZShjdHguZ2V0KCJwYWdlX3RpdGxlIiksY3R4LCJoIikubm90ZXhpc3RzKGN0eC5nZXQoInBhZ2VfdGl0bGUiKSxjdHgseyJibG9jayI6Ym9keV8xMH0sbnVsbCk7fWZ1bmN0aW9uIGJvZHlfMTAoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoInVudGl0bGVkIik7fWZ1bmN0aW9uIGJvZHlfMTEoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIig8c3BhbiBjbGFzcz1cInllYXJcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgiWUVBUiIpLGN0eCwiaCIpLndyaXRlKCI8L3NwYW4+KSIpO31mdW5jdGlvbiBib2R5XzEyKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPHA+Iikud3JpdGUoIlxuICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgicXVlcnlfdXNlciIpLGN0eCx7ImVsc2UiOmJvZHlfMTMsImJsb2NrIjpib2R5XzE0fSxudWxsKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCJzb3VyY2VzIikud3JpdGUoIlxuICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgicXVlcnlfYXV0aG9yIiksY3R4LHsiYmxvY2siOmJvZHlfMTV9LG51bGwpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPC9wPiIpLndyaXRlKCJcbiIpO31mdW5jdGlvbiBib2R5XzEzKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCJObyBvbmUgaGFzICIpLndyaXRlKCJcbiAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMTQoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgIikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgsImgiKS53cml0ZSgiIGhhcyBubyAiKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzE1KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCJieSAiKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfYXV0aG9yIiksY3R4LCJoIikud3JpdGUoIlxuICAgICAgICAiKTt9cmV0dXJuIGJvZHlfMDt9KSgpOyhmdW5jdGlvbigpe2R1c3QucmVnaXN0ZXIoInRhZ3MuaHRtbCIsYm9keV8wKTt2YXIgYmxvY2tzPXt3aGF0OmJvZHlfMX07ZnVuY3Rpb24gYm9keV8wKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLnBhcnRpYWwoInVzZXJfaGVhZGVyLmh0bWwiLGN0eCkud3JpdGUoIlxuIikud3JpdGUoIlxuIikud3JpdGUoIjxkaXYgY2xhc3M9XCJuYXZpZ2F0aW9uXCI+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCItLSIpLndyaXRlKCJcbiAgICAiKS5ub3RleGlzdHMoY3R4LmdldCgiaXNfdXNlcnNfb3duX3BhZ2UiKSxjdHgseyJibG9jayI6Ym9keV8yfSxudWxsKS53cml0ZSgiXG4gICAgIikuZXhpc3RzKGN0eC5nZXRQYXRoKGZhbHNlLFsidXNlckN0eCIsIm5hbWUiXSksY3R4LHsiYmxvY2siOmJvZHlfNX0sbnVsbCkud3JpdGUoIlxuIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLndyaXRlKCI8ZGl2IHN0eWxlPVwicG9zaXRpb246cmVsYXRpdmU7XCI+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8ZGl2IHN0eWxlPVwibWFyZ2luLXJpZ2h0OiA1NTFweFwiPiIpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjx1bCBjbGFzcz0ndGFncy1saXN0JyA+Iikud3JpdGUoIlxuICAgICAgICAgICAgIikuc2VjdGlvbihjdHguZ2V0KCJ0YWdzIiksY3R4LHsiYmxvY2siOmJvZHlfOH0sbnVsbCkud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPC91bD4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPGRpdiBjbGFzcz0ndGFncy1jbG91ZCcgaWQ9XCJ0YWdfY2xvdWRcIiIpLndyaXRlKCJcbiAgICAgICAgICIpLndyaXRlKCJzdHlsZT1cInBvc2l0aW9uOmFic29sdXRlOyByaWdodDowOyB0b3A6MDsgd2lkdGg6IDU1MHB4OyBoZWlnaHQ6IDM1MHB4O1wiPiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPC9kaXY+Iikud3JpdGUoIlxuIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiIpLndyaXRlKCJcbiIpLnBhcnRpYWwoImZvb3Rlcl9ldmVudC5odG1sIixjdHgpO31mdW5jdGlvbiBib2R5XzEoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoInRhZ3MiKTt9ZnVuY3Rpb24gYm9keV8yKGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgseyJibG9jayI6Ym9keV8zfSxudWxsKS53cml0ZSgiXG4gICAgIik7fWZ1bmN0aW9uIGJvZHlfMyhjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgic2VlICIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdXNlcl91cmwiKSxjdHgsImgiKS53cml0ZSgiL3NvdXJjZXNcIj4iKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdXNlciIpLGN0eCwiaCIpLndyaXRlKCIncyBzb3VyY2VzPC9hPiBvciIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdXNlcl91cmwiKSxjdHgsImgiKS53cml0ZSgiL2F1dGhvcnNcIj5hdXRob3JzPC9hPiIpLmV4aXN0cyhjdHguZ2V0UGF0aChmYWxzZSxbInVzZXJDdHgiLCJuYW1lIl0pLGN0eCx7ImJsb2NrIjpib2R5XzR9LG51bGwpLndyaXRlKCJcbiAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfNChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiOyA8YnIgLz4tLSAiKTt9ZnVuY3Rpb24gYm9keV81KGNoayxjdHgpe2N0eD1jdHguc2hpZnRCbG9ja3MoYmxvY2tzKTtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoImdvIHRvICIpLndyaXRlKCJcbiAgICAgICAgIikubm90ZXhpc3RzKGN0eC5nZXQoImlzX3VzZXJzX293bl9wYWdlIiksY3R4LHsiYmxvY2siOmJvZHlfNn0sbnVsbCkud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi9zb3VyY2VzXCI+IikuZXhpc3RzKGN0eC5nZXQoImlzX3VzZXJzX293bl9wYWdlIiksY3R4LHsiYmxvY2siOmJvZHlfN30sbnVsbCkud3JpdGUoInNvdXJjZXM8L2E+IG9yIikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi9hdXRob3JzXCI+YXV0aG9yczwvYT4iKS53cml0ZSgiXG4gICAgIik7fWZ1bmN0aW9uIGJvZHlfNihjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIi90YWdzXCI+eW91ciB0YWdzPC9hPiwiKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzcoY2hrLGN0eCl7Y3R4PWN0eC5zaGlmdEJsb2NrcyhibG9ja3MpO3JldHVybiBjaGsud3JpdGUoInlvdXIgIik7fWZ1bmN0aW9uIGJvZHlfOChjaGssY3R4KXtjdHg9Y3R4LnNoaWZ0QmxvY2tzKGJsb2Nrcyk7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAgICAgIikud3JpdGUoIjxsaSBjbGFzcz1cInRhZ1wiPjxhIGhyZWY9XCIiKS5yZWZlcmVuY2UoY3R4LmdldCgiYmFzZVVSTCIpLGN0eCwiaCIpLnJlZmVyZW5jZShjdHguZ2V0KCJxdWVyeV91c2VyX3VybCIpLGN0eCwiaCIpLndyaXRlKCIvdGFncy8iKS5yZWZlcmVuY2UoY3R4LmdldCgidGV4dCIpLGN0eCwiaCIsWyJ1YyJdKS53cml0ZSgiXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoInRleHQiKSxjdHgsImgiKS53cml0ZSgiPC9hPjwvbGk+Iikud3JpdGUoIlxuICAgICAgICAgICAgIik7fXJldHVybiBib2R5XzA7fSkoKTsoZnVuY3Rpb24oKXtkdXN0LnJlZ2lzdGVyKCJ1c2VyX2hlYWRlci5odG1sIixib2R5XzApO2Z1bmN0aW9uIGJvZHlfMChjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCI8aDIgY2xhc3M9XCJ1c2VyLWxpbmVcIj4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxzcGFuIGNsYXNzPVwidXNlci1uYW1lXCI+Iikud3JpdGUoIlxuICAgICAgICAiKS5leGlzdHMoY3R4LmdldCgiaXNfdXNlcnNfb3duX3BhZ2UiKSxjdHgseyJlbHNlIjpib2R5XzEsImJsb2NrIjpib2R5XzR9LG51bGwpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPC9zcGFuPiIpLndyaXRlKCJcbiAgICAiKS5ibG9jayhjdHguZ2V0QmxvY2soIndoYXQiKSxjdHgseyJibG9jayI6Ym9keV81fSxudWxsKS53cml0ZSgiXG4iKS53cml0ZSgiPC9oMj4iKS53cml0ZSgiXG4iKTt9ZnVuY3Rpb24gYm9keV8xKGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgIikuZXhpc3RzKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgseyJlbHNlIjpib2R5XzIsImJsb2NrIjpib2R5XzN9LG51bGwpLndyaXRlKCJcbiAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfMihjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi9zb3VyY2VzXCI+RXZlcnlvbmU8L2E+J3MiKS53cml0ZSgiXG4gICAgICAgICAgICAiKTt9ZnVuY3Rpb24gYm9keV8zKGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIlxuICAgICAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdXNlcl91cmwiKSxjdHgsImgiKS53cml0ZSgiXCI+IikucmVmZXJlbmNlKGN0eC5nZXQoInF1ZXJ5X3VzZXIiKSxjdHgsImgiKS53cml0ZSgiPC9hPidzIikud3JpdGUoIlxuICAgICAgICAgICAgIik7fWZ1bmN0aW9uIGJvZHlfNChjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiIikucmVmZXJlbmNlKGN0eC5nZXQoImJhc2VVUkwiKSxjdHgsImgiKS5yZWZlcmVuY2UoY3R4LmdldCgicXVlcnlfdXNlcl91cmwiKSxjdHgsImgiKS53cml0ZSgiXCI+WW91cjwvYT4iKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzUoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCJ0aGluZ3MiKS53cml0ZSgiXG4gICAgIik7fXJldHVybiBib2R5XzA7fSkoKTsoZnVuY3Rpb24oKXtkdXN0LnJlZ2lzdGVyKCJ3ZWxjb21lLmh0bWwiLGJvZHlfMCk7ZnVuY3Rpb24gYm9keV8wKGNoayxjdHgpe3JldHVybiBjaGsud3JpdGUoIjxoMSBzdHlsZT1cIm1hcmdpbi1ib3R0b206MDtcIj5Ob3RlLW8tcmFtYTwvaDE+Iikud3JpdGUoIlxuIikud3JpdGUoIlxuIikud3JpdGUoIjxkaXYgY2xhc3M9XCJpbnN0cnVjdGlvbnNcIj4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxwIHN0eWxlPVwibWFyZ2luLXRvcDowO1wiPkFkZCBub3RlcyBhbmQgaGlnaGxpZ2h0cyB0byBhbnkgd2ViIHBhZ2UuIikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGJyIC8+T3JnYW5pc2UgYW5kIHJldmlldyB5b3VyIG5vdGVzIGJ5IHNvdXJjZSwgYXV0aG9yIGFuZCAjdGFnLiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPHA+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPGRpdj4iKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8aW1nIHNyYz1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi9zdGF0aWMvaW1nL25yYW1hX2RlbW8ucG5nXCIiKS53cml0ZSgiXG4gICAgICAgICAgICAgIikud3JpdGUoInN0eWxlPVwiZGlzcGxheTogYmxvY2s7IG1hcmdpbi1sZWZ0OiBhdXRvOyBtYXJnaW4tcmlnaHQ6IGF1dG87XCIgLz4iKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8cCBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlclwiPiIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCI8aT5GaWd1cmU8L2k+LiIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCJMZWZ0IHBhbmVsOiBhbm5vdGF0ZSBhbnkgd2ViIHBhZ2UuIikud3JpdGUoIlxuICAgICAgICAgICAgIikud3JpdGUoIlJpZ2h0IHBhbmVsOiBvcmdhbmlzZSB5b3VyIG5vdGVzLiIpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjwvcD4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiXG4gICAgIikud3JpdGUoIlxuICAgICIpLndyaXRlKCJcbiAgICAiKS5wYXJ0aWFsKCJyZWdpc3RyYXRpb24uaHRtbCIsY3R4KS53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiXG4gICAgIikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8aDI+SG93IHRvIHVzZSBpdDwvaDI+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8cD5Zb3UgY2FuIHVzZSBOb3RlLW8tcmFtYSBvbiBhbnkgcGFnZSB5b3UgdmlzaXQuPC9wPiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPHA+V2hlbiBicm93c2luZyBhIHBhZ2UsIGhpdCB0aGUgYm9va21hcmsgeW91IGp1c3QgbWFkZSAoc3RlcCAyIGFib3ZlKSB0byBzdGFydCBtYWtpbmcgbm90ZXMuIikud3JpdGUoIlxuICAgICIpLndyaXRlKCIoVGhpcyBib29rbWFyayB3b24ndCB0YWtlIHlvdSB0byBhbm90aGVyIHBhZ2UsIGl0IGp1c3QgaW5qZWN0cyBzb21lIGNvZGUuKSIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxwPiIpLndyaXRlKCJcbiAgICAgICAgIikuc2VjdGlvbihjdHguZ2V0KCJ1c2VyQ3R4IiksY3R4LHsiYmxvY2siOmJvZHlfMX0sbnVsbCkud3JpdGUoIlxuICAgICIpLndyaXRlKCI8L3A+Iikud3JpdGUoIlxuIikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8aHIgLz4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8aDI+UHJvYmxlbXM/PC9oMj4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjxwPiIpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIk5vdGUtby1yYW1hIHNob3VsZCB3b3JrIGluIHJlY2VudCB2ZXJzaW9ucyBvZiBGaXJlZm94LCBDaHJvbWUgYW5kIFNhZmFyaS4iKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8YnIgLz4iKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCJXZSBkb24ndCBwcm9taXNlIHRoYXQgaXQgd2lsbCB3b3JrIGluIG9sZGVyIGJyb3dzZXJzIG9yIEludGVybmV0IEV4cGxvcmVyLiA8aT5UYW50IHBpczwvaT4uIikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGJyIC8+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8L3A+PHA+Iikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiSWYgaXQgZG9lc24ndCB3b3JrLCB5b3UgbWF5IG5lZWQgdG8gc2V0IHlvdXIgYnJvd3NlciB0byBhY2NlcHQgY29va2llcyIpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoImZyb20gYWxsIHdlYnNpdGVzIChzb3JyeSkuIikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8L3A+PHA+Iikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiSXNzdWVzIDxhIGhyZWY9XCJodHRwczovL2dpdGh1Yi5jb20vYnV0dGVyZmlsbC9ub3RlLW8tcmFtYS9pc3N1ZXNcIj5tYXkgYmUgcmVwb3J0ZWQgaGVyZTwvYT4uIikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8L3A+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8aDI+UHJvIHRpcHM8L2gyPiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPHVsIGNsYXNzPVwiaW5zdHJ1Y3Rpb25zXCIgPiIpLndyaXRlKCJcbiAgICAgICAgIikud3JpdGUoIjxsaT5Nb3ZlIG5vdGVzIGJ5IGRyYWdnaW5nIGFueSBlZGdlLjwvbGk+Iikud3JpdGUoIlxuICAgICAgICAiKS53cml0ZSgiPGxpPmFsdC0gb3IgbWV0YS0gY2xpY2sgYSBxdW90ZSB0byBkZWxldGUgaXQuPC9saT4iKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8bGk+VXNlICN0YWdzIGluIG5vdGVzICgqKipMSU5LIHlvdXIgdGFncykuPC9saT4iKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8bGk+UGFzdGUgYSBiaWJ0ZXggZW50cnkgaW50byBhIG5vdGUgdG8gb3JnYW5pc2UgYnkgYXV0aG9yICgqKipMSU5LIHlvdXIgYXV0aG9ycykuPC9saT4iKS53cml0ZSgiXG4gICAgIikud3JpdGUoIjwvdWw+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPGhyIC8+Iikud3JpdGUoIlxuIikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8aDI+QWJvdXQ8L2gyPiIpLndyaXRlKCJcbiAgICAiKS53cml0ZSgiPHA+Tm90ZS1vLXJhbWEgaXMgY29weXJpZ2h0IChjKSAyMDA3LTExIFN0ZXBoZW4gQS4gQnV0dGVyZmlsbC4iKS53cml0ZSgiXG4gICAgICAgICIpLndyaXRlKCI8YSBocmVmPVwiaHR0cHM6Ly9naXRodWIuY29tL2J1dHRlcmZpbGwvbm90ZS1vLXJhbWFcIiB0YXJnZXQ9XCJfYmxhbmtcIj5Tb3VyY2UgY29kZSBpcyBwdWJsaWNseSBhdmFpbGJsZS48L2E+Iikud3JpdGUoIlxuICAgICIpLndyaXRlKCI8L3A+Iikud3JpdGUoIlxuIikud3JpdGUoIjwvZGl2PiIpLndyaXRlKCJcbiIpO31mdW5jdGlvbiBib2R5XzEoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiXG4gICAgICAgICAgICAiKS53cml0ZSgiVG8gc2VlIGFsbCB5b3VyIG5vdGVzIikubm90ZXhpc3RzKGN0eC5nZXQoIm5hbWUiKSxjdHgseyJibG9jayI6Ym9keV8yfSxudWxsKS53cml0ZSgiLCIpLndyaXRlKCJcbiAgICAgICAgICAgICIpLndyaXRlKCJjbGljayB5b3VyIHVzZXIgbmFtZSBvbiB0aGUgdG9wIHJpZ2h0IG9mIHRoaXMgcGFnZSIpLmV4aXN0cyhjdHguZ2V0KCJuYW1lIiksY3R4LHsiYmxvY2siOmJvZHlfM30sbnVsbCkud3JpdGUoIi4iKS53cml0ZSgiXG4gICAgICAgICIpO31mdW5jdGlvbiBib2R5XzIoY2hrLGN0eCl7cmV0dXJuIGNoay53cml0ZSgiIHNpZ24gdXAgb3IgbG9nIGluLCB0aGVuIik7fWZ1bmN0aW9uIGJvZHlfMyhjaGssY3R4KXtyZXR1cm4gY2hrLndyaXRlKCJcbiAgICAgICAgICAgICAgICAiKS53cml0ZSgiPGEgaHJlZj1cIiIpLnJlZmVyZW5jZShjdHguZ2V0KCJiYXNlVVJMIiksY3R4LCJoIikud3JpdGUoIi91c2Vycy8iKS5yZWZlcmVuY2UoY3R4LmdldFBhdGgoZmFsc2UsWyJ1c2VyQ3R4IiwibmFtZSJdKSxjdHgsImgiLFsidWMiXSkud3JpdGUoIlwiPiIpLndyaXRlKCJcbiAgICAgICAgICAgICAgICAgICAgIikud3JpdGUoIm9yIGhlcmU8L2E+Iik7fXJldHVybiBib2R5XzA7fSkoKTsKfShkdXN0X21vZHVsZSwgZHVzdF9tb2R1bGUuZXhwb3J0cykpOwp2YXIgZHVzdCA9IGR1c3RfbW9kdWxlLmV4cG9ydHM7Ci8qZ2xvYmFsIGR1c3Q6IHRydWUsIGxvZzogZmFsc2UgKi8KCi8qKgogKiBDQVVUSU9OIFdIRU4gRURJVElORyBUSElTIEZJTEUhCiAqCiAqIFRoZSByZXN0IG9mIHRoaXMgIG1vZHVsZSBpcyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBieSBrYW5zbyB3aGVuIHRoZSBhcHAKICogaXMgcHVzaGVkIHRvIHRoZSBkYXRhYmFzZS4KICoKICogVGhpcyBpcyB0byB3b3JrIGFyb3VuZCB0aGUgZmFjdCB0aGF0IGR1c3QgdGVtcGxhdGVzIHN0b3JlIHN0YXRlCiAqIG9uIHRoZSBtb2R1bGUgaXRzZWxmIGJ1dCBjb3VjaGRiIGRvZXNuJ3QgeWV0IHByb3ZpZGUgYSBtb2R1bGUgY2FjaGUsCiAqIG1lYW5pbmcgc3RhdGUgZG9lcyBub3QgcGVyc2lzdCBiZXR3ZWVuIGVhY2ggcmVxdWlyZSgpLiBUaGUgd29ya2Fyb3VuZAogKiBpbnZvbHZlcyB3cml0aW5nIGFsbCB0ZW1wbGF0ZXMgZGlyZWN0bHkgaW50byB0aGUgbW9kdWxlLCBzbyB0aGV5IGFyZSBhZGRlZCBvbgogKiBlYWNoIHJlcXVpcmUuCiAqCiAqIFRPRE86IFdoZW4gYSBtb2R1bGUgY2FjaGUgaXMgaW1wbGVtZW50ZWQgaW4gQ291Y2hEQiwgc3RvcCB0aGlzIG1vZHVsZSBmcm9tCiAqIGJlaW5nIGF1dG8tZ2VuZXJhdGVkLCBzZWU6IGh0dHBzOi8vaXNzdWVzLmFwYWNoZS5vcmcvamlyYS9icm93c2UvQ09VQ0hEQi04OTAKICoKICogRm9yIHRoZSBjb2RlIHRoYXQgZ2VuZXJhdGVzIHRoZSByZXN0IG9mIHRoaXMgZmlsZSwgc2VlOiBsaWIvdGVtcGxhdGVzLmpzCiAqLwoKLyoqCiAqIEthbnNvIHVzZXMgRHVzdCB0ZW1wbGF0ZXMgZm9yIHJlbmRlcmluZyBwYWdlcy4KICogVG8gbGVhcm4gbW9yZSBhYm91dCB0aGUgc3ludGF4LCBzZWUgdGhlCiAqIDxhIGhyZWY9Imh0dHA6Ly9ha2R1YnlhLmdpdGh1Yi5jb20vZHVzdGpzLyI+RHVzdCBzaXRlPC9hPi4KICoKICogU2luY2UgRHVzdCBzdG9yZXMgY29tcGlsZWQgdGVtcGxhdGVzIG9uIHRoZSBtb2R1bGUgaXRzZWxmLCB0aGUKICogdGVtcGxhdGVzIG1vZHVsZSBkb2VzIHNvbWUgaW50ZXJlc3RpbmcgdGhpbmdzIHRvIHdvcmsgYXJvdW5kIHRoZSBsYWNrCiAqIG9mIGEgbW9kdWxlIGNhY2hlIGluIENvdWNoREIuIEJlY2F1c2Ugb2YgdGhpcywgY29tcGlsZWQgdGVtcGxhdGVzIGFyZQogKiBhdXRvbWF0aWNhbGx5IGFkZGVkIHRvIHRoaXMgbW9kdWxlIGZyb20geW91ciB0ZW1wbGF0ZXMgZm9sZGVyIGVhY2ggdGltZQogKiB5b3VyIGFwcCBpcyBwdXNoZWQgdG8gQ291Y2hEQi4gWW91IGNhbiBzZWUgYSBsaXN0IG9mIHRoZSBsb2FkZWQgdGVtcGxhdGUKICogbmFtZXMgb24gdGhlICdsb2FkZWQnIHByb3BlcnR5IG9mIHRoaXMgbW9kdWxlLgogKgogKiBAbW9kdWxlCiAqLwoKCi8qKgogKiBNb2R1bGUgZGVwZW5kZW5jaWVzCiAqLwoKdmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpLAogICAgZmxhc2htZXNzYWdlcyA9IHJlcXVpcmUoJy4vZmxhc2htZXNzYWdlcycpOwoKCi8qKgogKiBTeW5jaHJvbm91c2x5IHJlbmRlciBkdXN0IHRlbXBsYXRlIGFuZCByZXR1cm4gcmVzdWx0LCBhdXRvbWF0aWNhbGx5IGFkZGluZwogKiBiYXNlVVJMIHRvIHRoZSB0ZW1wbGF0ZSdzIGNvbnRleHQuIFRoZSByZXF1ZXN0IG9iamVjdCBpcyByZXF1aXJlZCBzbyB3ZQogKiBjYW4gZGV0ZXJtaW5lIHRoZSB2YWx1ZSBvZiBiYXNlVVJMLgogKgogKiBAbmFtZSByZW5kZXIobmFtZSwgcmVxLCBjb250ZXh0KQogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogKiBAcGFyYW0ge09iamVjdH0gcmVxCiAqIEBwYXJhbSB7T2JqZWN0fSBjb250ZXh0CiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5yZW5kZXIgPSBmdW5jdGlvbiAobmFtZSwgcmVxLCBjb250ZXh0KSB7CiAgICBjb250ZXh0LmJhc2VVUkwgPSB1dGlscy5nZXRCYXNlVVJMKHJlcSk7CiAgICBjb250ZXh0LmlzQnJvd3NlciA9IHV0aWxzLmlzQnJvd3NlcigpOwogICAgY29udGV4dC51c2VyQ3R4ID0gcmVxLnVzZXJDdHg7CiAgICBpZiAoIWNvbnRleHQuZmxhc2hNZXNzYWdlcykgewogICAgICAgIGNvbnRleHQuZmxhc2hNZXNzYWdlcyA9IGZsYXNobWVzc2FnZXMuZ2V0TWVzc2FnZXMocmVxKTsKICAgIH0KICAgIHZhciByID0gJyc7CiAgICBkdXN0LnJlbmRlcihuYW1lLCBjb250ZXh0LCBmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICB9CiAgICAgICAgciA9IHJlc3VsdDsKICAgIH0pOwogICAgcmV0dXJuIHI7Cn07CgoKLyoqCiAqIEV4cG9ydHMgdGhlIG5hbWVzIG9mIGFsbCB0ZW1wbGF0ZXMgbG9hZGVkIGludG8gdGhlIGR1c3QgY2FjaGUKICovCgpleHBvcnRzLmxvYWRlZCA9IFtdOwpmb3IgKHZhciBrIGluIGR1c3QuY2FjaGUpIHsKICAgIGlmIChkdXN0LmNhY2hlLmhhc093blByb3BlcnR5KGspKSB7CiAgICAgICAgZXhwb3J0cy5sb2FkZWQucHVzaChrKTsKICAgIH0KfQoKCn0pfTsKCi8qKioqKioqKioqIGthbnNvL2FjdGlvbnMgKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJrYW5zby9hY3Rpb25zIl0gPSB7bG9hZDogKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUpIHsKCi8qZ2xvYmFsICQ6IGZhbHNlLCBrYW5zbzogdHJ1ZSovCgp2YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyk7CgovKioKICogSW1wbGVtZW50YXRpb24gb2Ygd2lkZ2V0IGFjdGlvbnMuIFRoZXNlIGFyZSBwcm9jZWR1cmVzCiAqIHRoYXQgY2FuIGJlIHJlZmVyZW5jZWQgYnkgd2lkZ2V0cyB0byBwcmVzZW50L2NvbGxlY3QgaW5mb3JtYXRpb24sCiAqIG1hbmlwdWxhdGUgdGhlIERPTSwgb3Igb3RoZXJ3aXNlIGFmZmVjdCB0aGUgYXBwbGljYXRpb24gc3RhdGUKICogd2hlbiBhIHdpZGdldCBpcyBhY3RlZCB1cG9uLgogKgogKiBAbW9kdWxlCiAqLwoKLyoqCiAqIE1vZHVsZSBkZXBlbmRlbmNpZXMKICovCgp2YXIgd2lkZ2V0cyA9IHJlcXVpcmUoJy4vd2lkZ2V0cycpLAogICAgc2FuaXRpemUgPSByZXF1aXJlKCcuL3Nhbml0aXplJyksCiAgICBfID0gcmVxdWlyZSgnLi91bmRlcnNjb3JlJykuXzsKCnZhciBoID0gc2FuaXRpemUuZXNjYXBlSHRtbDsKCi8qKgogKiBDcmVhdGUgYSBjbG9zdXJlIHRoYXQgbG9hZHMge21vZHVsZX0sIGFuZCBpbnZva2VzIHttZXRob2R9CiAqIG9uIGl0LiBUaGUge29wdGlvbnN9IHBhcmFtZXRlciBpcyBwcmVwZW5jZWQgdG8gdGhlIG1ldGhvZCdzCiAqIGFyZ3VtZW50IGxpc3QuIFRoaXMgc2VwYXJhdGUgZnVuY3Rpb24gc2lsZW5jZXMgYSBsaW50IHdhcm5pbmcuCiAqIFNlZSB0aGUgcGFyc2UgbWV0aG9kIGZvciBkZXRhaWxzLgogKi8KZXhwb3J0cy5tYWtlX2FjdGlvbl9oYW5kbGVyID0gZnVuY3Rpb24gKG1vZHVsZSwgbWV0aG9kLCBvcHRpb25zKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhcmdzID0gWyBvcHRpb25zIF0uY29uY2F0KAogICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuc2xpY2UuYXBwbHkoYXJndW1lbnRzKQogICAgICAgICk7CiAgICAgICAgcmV0dXJuIHJlcXVpcmUobW9kdWxlKVttZXRob2RdLmFwcGx5KG51bGwsIGFyZ3MpOwogICAgfTsKfTsKCi8qKgogKiBDb252ZXJ0IGFuIG9iamVjdCBjb250YWluaW5nIHNldmVyYWwgWyBtb2R1bGUsIGNhbGxiYWNrIF0gb3IKICogeyBtb2R1bGU6IHgsIGNhbGxiYWNrOiB5IH0gaXRlbXMgaW4gdG8gYW4gb2JqZWN0IGNvbnRhaW5pbmcKICogc2V2ZXJhbCBuYXRpdmUgamF2YXNjcmlwdCBmdW5jdGlvbnMsIGJ5IHVzaW5nIHJlcXVpcmUuCiAqCiAqIEBwYXJhbSBhY3Rpb25zIEFuIG9iamVjdCwgY29udGFpbmluZyBpdGVtcyBkZXNjcmliaW5nIGEKICogICAgICAgICAgZnVuY3Rpb24gdGhhdCBjYW4gYmUgb2J0YWluZWQgdmlhIHJlcXVpcmUoKS4KICovCmV4cG9ydHMucGFyc2UgPSBmdW5jdGlvbiAoYWN0aW9ucykgewogICAgdmFyIHJ2ID0ge307CiAgICBmb3IgKHZhciBrIGluIGFjdGlvbnMpIHsKICAgICAgICB2YXIgbW9kdWxlLCBjYWxsYmFjaywgb3B0aW9uczsKICAgICAgICB2YXIgYWN0aW9uID0gYWN0aW9uc1trXTsKICAgICAgICBpZiAoYWN0aW9uID09PSBmYWxzZSkgewogICAgICAgICAgICBydltrXSA9IHV0aWxzLmVtcHR5RnVuY3Rpb247CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKF8uaXNBcnJheShhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICBtb2R1bGUgPSBhY3Rpb25bMF07CiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IGFjdGlvblsxXTsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBhY3Rpb25bMl07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoXy5pc0Z1bmN0aW9uKGFjdGlvbikpIHsKICAgICAgICAgICAgICAgIHJ2W2tdID0gYWN0aW9uOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKGFjdGlvbikgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICBtb2R1bGUgPSBhY3Rpb24ubW9kdWxlOwogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBhY3Rpb24uY2FsbGJhY2s7CiAgICAgICAgICAgICAgICBvcHRpb25zID0gYWN0aW9uLm9wdGlvbnM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgJ0FjdGlvbiBgJyArIGsgKyAnYCBpcyBgJyArIHR5cGVvZihhY3Rpb24pICsgJ2AsICcgKwogICAgICAgICAgICAgICAgICAgICAgICAid2hpY2ggdGhpcyBmdW5jdGlvbiBkb2Vzbid0IGtub3cgaG93IHRvIGludGVycHJldCIKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLyogUmVzb2x2ZSBmdW5jdGlvbiBkZXNjcmlwdGlvbiB0byBhY3R1YWwgZnVuY3Rpb24gKi8KICAgICAgICAgICAgcnZba10gPSBleHBvcnRzLm1ha2VfYWN0aW9uX2hhbmRsZXIobW9kdWxlLCBjYWxsYmFjaywgb3B0aW9ucyk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHJ2Owp9OwoKLyoqCiAqIEFuIGFjdGlvbiB0aGF0IHByb2R1Y2VzIGEgbW9kYWwgZGlhbG9nIGJveCwgd2l0aCBidXR0b25zIGFsb25nCiAqIGl0cyBib3R0b20uIFRoZSBjb250ZW50cyBvZiB0aGUgZGlhbG9nIGNhbiBiZSBjb250cm9sbGVkIGJ5CiAqIHNldHRpbmcgZWl0aGVyIG9wdGlvbnMud2lkZ2V0IG9yIG9wdGlvbnMudHlwZS4gSWYgYm90aCBhcmUKICogc3BlY2lmaWVkLCB0aGUgd2lkZ2V0IHdpbGwgYmUgdXNlZC4gSWYgb25seSB0eXBlIGlzIHNwZWNpZmllZCwKICogdGhpcyBmdW5jdGlvbiB0cmFuc3BhcmVudGx5IGluc3RhbnNpYXRlcyBhbiBlbWJlZEZvcm0gd2lkZ2V0LAogKiB3aGljaCBkb2VzIHRoZSBhY3R1YWwgZm9ybSByZW5kZXJpbmcgYW5kIHByZXNlbnRhdGlvbi4KICovCgpleHBvcnRzLm1vZGFsRGlhbG9nID0gZnVuY3Rpb24gKGFjdGlvbl9vcHRpb25zLCBhY3Rpb25fbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlX25hbWUsIGZpZWxkLCBwYXRoLCB2YWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXcsIGVycm9ycywgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSk7CiAgICBhY3Rpb25fb3B0aW9ucyA9IChhY3Rpb25fb3B0aW9ucyB8fCB7fSk7CgogICAgdmFyIHdpZGdldCA9IGFjdGlvbl9vcHRpb25zLndpZGdldDsKICAgIHZhciBuYW1lID0gc2FuaXRpemUuZ2VuZXJhdGVEb21OYW1lKHBhdGgpOwogICAgdmFyIHBhdGhfZXh0cmEgPSAob3B0aW9ucy5wYXRoX2V4dHJhIHx8IFtdKS5jb25jYXQoWyAnbW9kYWwnIF0pOwogICAgdmFyIG9wZXJhdGlvbiA9ICd1cGRhdGUnOwogICAgaWYgKGFjdGlvbl9uYW1lICE9PSAnZWRpdCcpIHsKICAgICAgICBvcGVyYXRpb24gPSBhY3Rpb25fbmFtZTsKICAgIH0KICAgIHZhciB3aWRnZXRfb3B0aW9ucyA9IHsKICAgICAgICBwYXRoX2V4dHJhOiBwYXRoX2V4dHJhLAogICAgICAgIG9wZXJhdGlvbjogb3BlcmF0aW9uCiAgICB9OwoKICAgIC8qIFJlc29sdmUgd2lkZ2V0ICovCiAgICBpZiAoIXdpZGdldCAmJiBhY3Rpb25fb3B0aW9ucy50eXBlKSB7CiAgICAgICAgd2lkZ2V0ID0gd2lkZ2V0cy5lbWJlZEZvcm0oCiAgICAgICAgICAgIF8uZGVmYXVsdHMoYWN0aW9uX29wdGlvbnMub3B0aW9ucyB8fCB7fSwgewogICAgICAgICAgICAgICAgdHlwZTogYWN0aW9uX29wdGlvbnMudHlwZQogICAgICAgICAgICB9KQogICAgICAgICk7CiAgICB9CgogICAgaWYgKCF3aWRnZXQpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgICAgICdtb2RhbERpYWxvZzogVW5hYmxlIHRvIGRldGVybWluZSB0aGUgd2lkZ2V0IHRvJyArCiAgICAgICAgICAgICcgdXNlIGZvciB0aGUgZmllbGQgbmFtZWQgYCcgKyBwYXRoLmpvaW4oJy4nKSArICdgOycgKwogICAgICAgICAgICAnIHdpZGdldCBvciBmaWVsZCB0eXBlIHdhcyBub3QgY29ycmVjdGx5IHNwZWNpZmllZCcKICAgICAgICApOwogICAgfQoKICAgIC8qIERpYWxvZyBzZXR1cCBhbmQgZXZlbnQgaGFuZGxpbmc6CiAgICAgICAgVGhpcyBpcyB3cmFwcGVkIGluIGEgY2xvc3VyZSB0byBhbGxvdyBpdCB0byBlYXNpbHkgYmUKICAgICAgICB1c2VkIGluc2lkZSBib3RoIHN5bmNocm9ub3VzIGFuZCBhc3luY2hyb25vdXMgZnVuY3Rpb25zLiAqLwoKICAgIHZhciBnZW5lcmF0ZU1vZGFsRGlhbG9nID0gZnVuY3Rpb24gKCkgewoKICAgICAgICAvKiBHZW5lcmF0ZSBzdHJpbmdzIGZvciBjb250ZW50ICovCiAgICAgICAgdmFyIGNhbmNlbF9sYWJlbCA9ICdDYW5jZWwnOwogICAgICAgIHZhciB0eXBlX2xhYmVsID0gdXRpbHMudGl0bGVpemUodHlwZV9uYW1lKTsKICAgICAgICB2YXIgYWN0aW9uX2xhYmVsID0gdXRpbHMudGl0bGVpemUoYWN0aW9uX25hbWUpOwoKICAgICAgICAvKiBHZW5lcmF0ZSBpbm5lciBlbGVtZW50cyAqLwogICAgICAgIHZhciB0aXRsZV9lbHQgPSAkKAogICAgICAgICAgICAnPGgyPicgKyBbIGFjdGlvbl9sYWJlbCwgdHlwZV9sYWJlbCBdLmpvaW4oJyAnKSArICc8L2gyPicKICAgICAgICApOwogICAgICAgIHZhciBva19lbHQgPSAkKAogICAgICAgICAgICAnPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IicgKyBoKGFjdGlvbl9sYWJlbCkgKyAnIiAvPicKICAgICAgICApOwogICAgICAgIHZhciBjYW5jZWxfZWx0ID0gJCgKICAgICAgICAgICAgJzxpbnB1dCB0eXBlPSJidXR0b24iIHZhbHVlPSInICsgaChjYW5jZWxfbGFiZWwpICsgJyIgLz4nCiAgICAgICAgKTsKICAgICAgICB2YXIgYWN0aW9uc19lbHQgPSAkKAogICAgICAgICAgICAnPGRpdiBjbGFzcz0iYWN0aW9ucyIgLz4nCiAgICAgICAgKTsKCiAgICAgICAgLyogQ3JlYXRlIHdpZGdldCdzIHBhcmVudCBlbGVtZW50ICovCiAgICAgICAgdmFyIGRpdiA9ICQoJzxkaXYgLz4nKTsKCiAgICAgICAgLyogQWRkIGRpYWxvZyB0aXRsZSAqLwogICAgICAgIGRpdi5hcHBlbmQodGl0bGVfZWx0KTsKCiAgICAgICAgLyogRHJhdyB3aWRnZXQgKi8KICAgICAgICBkaXYuYXBwZW5kKAogICAgICAgICAgICB3aWRnZXQudG9IVE1MKAogICAgICAgICAgICAgICAgbmFtZSwgdmFsdWUsIHJhdywgZmllbGQsIHdpZGdldF9vcHRpb25zCiAgICAgICAgICAgICkKICAgICAgICApOwoKICAgICAgICAvKiBGaW5kIHRoZSBmb3JtIGVsZW1lbnQ6CiAgICAgICAgICAgIFRoaXMgaXMgY3JlYXRlZCBieSB0aGUgY2FsbCB0byB3aWRnZXQudG9IVE1MLCBhYm92ZS4gKi8KCiAgICAgICAgdmFyIGZvcm1fZWx0ID0gZGl2LmNsb3Nlc3RDaGlsZCgnZm9ybScpOwoKICAgICAgICBpZiAoZm9ybV9lbHQubGVuZ3RoIDw9IDApIHsKCiAgICAgICAgICAgIC8qIE5vIGZvcm0gZWxlbWVudCBmb3VuZD8KICAgICAgICAgICAgICAgIEdlbmVyYXRlIG9uZSBhbmQgd3JhcCB0aGUgY29udGVudHMgb2YgdGhlIGRpYWxvZyB3aXRoIGl0LgogICAgICAgICAgICAgICAgVGhpcyBwcm92aWRlcyBzdXBwb3J0IGZvciB3aWRnZXRzIG90aGVyIHRoYW4gZW1iZWRGb3JtLiAqLwoKICAgICAgICAgICAgdmFyIHdyYXBwZXJfZWx0ID0gJCgnPGRpdiAvPicpOwogICAgICAgICAgICBmb3JtX2VsdCA9ICQoJzxmb3JtIC8+Jyk7CiAgICAgICAgICAgIGZvcm1fZWx0LmFwcGVuZChkaXYpOwogICAgICAgICAgICB3cmFwcGVyX2VsdC5hcHBlbmQoZm9ybV9lbHQpOwogICAgICAgICAgICBkaXYgPSB3cmFwcGVyX2VsdDsKICAgICAgICB9CgogICAgICAgIC8qIEhhbmRsZSBzdWNjZXNzICovCiAgICAgICAgb2tfZWx0LmNsaWNrKGZ1bmN0aW9uIChldikgewoKICAgICAgICAgICAgLyogVmFsaWRhdGUgd2lkZ2V0OgogICAgICAgICAgICAgICAgVGhpcyB1c3VhbGx5IGRlZmVycyB0byBhIGZvcm0gdHlwZSdzIGltcGxlbWVudGF0aW9uLgogICAgICAgICAgICAgICAgTW9zdCBzaW1wbGUgd2lkZ2V0cyBqdXN0IHJldHVybiB0cnVlIGZvciB0aGlzIG1ldGhvZC4gKi8KCiAgICAgICAgICAgIGVycm9ycyA9IHdpZGdldC52YWxpZGF0ZShkaXYsIHBhdGgsIHdpZGdldF9vcHRpb25zKTsKCiAgICAgICAgICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkgewoKICAgICAgICAgICAgICAgIC8qIFJlcG9zdCBkaWFsb2cgYm94OgogICAgICAgICAgICAgICAgICAgIFRoaXMgd2lsbCByZXBsYWNlIHRoZSBjdXJyZW50IGRpYWxvZyBib3guCiAgICAgICAgICAgICAgICAgICAgVGhlIG1vZGFsIGRpYWxvZyByZXR1cm5zIHRvIHRoZSBldmVudCBsb29wIGJlZm9yZQogICAgICAgICAgICAgICAgICAgIGFjdHVhbGx5IHJlbW92aW5nIGl0cyBlbGVtZW50cywgc28gd2UgZG8gdGhlIHNhbWUuICovCgogICAgICAgICAgICAgICAgJC5tb2RhbC5jbG9zZSgpOwoKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGV4cG9ydHMubW9kYWxEaWFsb2coCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9vcHRpb25zLCBhY3Rpb25fbmFtZSwgdHlwZV9uYW1lLCBmaWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGgsIHZhbHVlLCByYXcsIGVycm9ycywgb3B0aW9ucywgY2FsbGJhY2sKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSwgMCk7CgogICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICAgIC8qIENsb3NlIHRoZSBkaWFsb2cgYm94OgogICAgICAgICAgICAgICAgICAgIEFnYWluLCBub3RlIHRoYXQgdGhlIGRpYWxvZyBib3ggd29uJ3QgYWN0dWFsbHkgZGlzYXBwZWFyCiAgICAgICAgICAgICAgICAgICAgdW50aWwgd2UndmUgdW53b3VuZCBhbmQgcmV0dXJuZWQgdG8gdGhlIG1haW4gZXZlbnQKICAgICAgICAgICAgICAgICAgICBsb29wLiBJZiB5b3UgZGVwZW5kIHVwb24gY2xvc3VyZSwgdXNlIHNldFRpbWVvdXQoKS4gKi8KCiAgICAgICAgICAgICAgICBjYWxsYmFjaygKICAgICAgICAgICAgICAgICAgICB0cnVlLCB3aWRnZXQuZ2V0VmFsdWUoZGl2LCBwYXRoLCB3aWRnZXRfb3B0aW9ucykKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgLyogT3JkZXIgbWF0dGVyczoKICAgICAgICAgICAgICAgICAgICBUaGUgY2FsbGJhY2sgbWF5IHJlZmVyIHRvIGVsZW1lbnRzIGluc2lkZSBvZiB0aGUgbW9kYWwKICAgICAgICAgICAgICAgICAgICBkaWFsb2csIHNvIGRvbid0IGRlc3Ryb3kgaXQgdW50aWwgYWZ0ZXIgaXQgcmV0dXJucywgYW5kCiAgICAgICAgICAgICAgICAgICAgaGFzIGhhZCBhIGNoYW5jZSB0byByZWdpc3RlciBhbnkgY2FsbGJhY2tzIC8gdGltZW91dHMuICovCgogICAgICAgICAgICAgICAgJC5tb2RhbC5jbG9zZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0pOwoKICAgICAgICAvKiBIYW5kbGUgZmFpbHVyZSAqLwogICAgICAgIGNhbmNlbF9lbHQuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjYWxsYmFjaygKICAgICAgICAgICAgICAgIGZhbHNlLCB3aWRnZXQuZ2V0VmFsdWUoZGl2LCBwYXRoLCB3aWRnZXRfb3B0aW9ucykKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJC5tb2RhbC5jbG9zZSgpOwogICAgICAgIH0pOwoKICAgICAgICAvKiBNYWtlIGRlZmF1bHQgZm9ybSBhY3Rpb24gJ29rJyAqLwogICAgICAgIGZvcm1fZWx0LnN1Ym1pdChmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgb2tfZWx0LmNsaWNrKCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9KTsKCiAgICAgICAgLyogSW5zZXJ0IGRpYWxvZy1tYW5hZ2VkIGVsZW1lbnRzICovCiAgICAgICAgYWN0aW9uc19lbHQuYXBwZW5kKG9rX2VsdCk7CiAgICAgICAgYWN0aW9uc19lbHQuYXBwZW5kKGNhbmNlbF9lbHQpOwogICAgICAgIGZvcm1fZWx0LmFwcGVuZChhY3Rpb25zX2VsdCk7CgogICAgICAgIC8qIExhdW5jaCBkaWFsb2cgKi8KICAgICAgICBkaXYubW9kYWwoKTsKCiAgICAgICAgLyogSW5pdGlhbGl6ZSB3aWRnZXQ6CiAgICAgICAgICAgIFdlIGRvIHRoaXMgbGFzdCAtLSB0aGlzIG1ha2VzIHN1cmUgYWxsIGVsZW1lbnRzIGFyZSBwcmVzZW50CiAgICAgICAgICAgIGFuZCBpbml0aWFsaXplZCBwcmlvciB0byBjbGllbnQtc2lkZSB3aWRnZXQgaW5pdGlhbGl6YXRpb24uICovCgogICAgICAgIHdpZGdldC5jbGllbnRJbml0KAogICAgICAgICAgICBmaWVsZCwgcGF0aCwgdmFsdWUsIHJhdywgZXJyb3JzLCB3aWRnZXRfb3B0aW9ucwogICAgICAgICk7CiAgICB9OwoKICAgIHJldHVybiBnZW5lcmF0ZU1vZGFsRGlhbG9nKCk7Cn07CgoKCn0pfTsKCi8qKioqKioqKioqIGthbnNvL2Nvb2tpZXMgKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJrYW5zby9jb29raWVzIl0gPSB7bG9hZDogKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUpIHsKCi8qZ2xvYmFsIGVzY2FwZTogZmFsc2UgKi8KCi8qKgogKiBGdW5jdGlvbnMgcmVsYXRlZCB0byB0aGUgbWFuaXB1bGF0aW9uIGFuZCByZWFkaW5nIG9mIGNvb2tpZXMuCiAqCiAqIEBtb2R1bGUKICovCgp2YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyk7CgoKLyoqCiAqIFJlYWQgY29va2llcyBjdXJyZW50bHkgc3RvcmVkIGluIHRoZSBicm93c2VyLCByZXR1cm5pbmcgYW4gb2JqZWN0CiAqIGtleWVkIGJ5IGNvb2tpZSBuYW1lLgogKgogKiBAbmFtZSByZWFkQnJvd3NlckNvb2tpZXMoKQogKiBAcmV0dXJucyBPYmplY3QKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnJlYWRCcm93c2VyQ29va2llcyA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdXRpbHMuaXNCcm93c2VyKCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlYWRCcm93c2VyQ29va2llcyBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICB9CiAgICB2YXIgY29va2llcyA9IHt9OwogICAgdmFyIHBhcnRzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7CiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGFydHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICB2YXIgbmFtZSA9IHBhcnRzW2ldLnNwbGl0KCc9JylbMF07CiAgICAgICAgdmFyIHZhbHVlID0gcGFydHNbaV0uc3BsaXQoJz0nKS5zbGljZSgxKS5qb2luKCc9Jyk7CiAgICAgICAgY29va2llc1tuYW1lXSA9IHZhbHVlOwogICAgfQogICAgcmV0dXJuIGNvb2tpZXM7Cn07CgovKioKICogUmVhZHMgYnJvd3NlciBjb29raWVzIGFuZCByZXR1cm5lZCB0aGUgdmFsdWUgb2YgdGhlIG5hbWVkIGNvb2tpZS4KICoKICogQG5hbWUgcmVhZEJyb3dzZXJDb29raWUobmFtZSkKICogQHJldHVybnMge1N0cmluZ30KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnJlYWRCcm93c2VyQ29va2llID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgIHJldHVybiBleHBvcnRzLnJlYWRCcm93c2VyQ29va2llcygpW25hbWVdOwp9OwoKLyoqCiAqIENyZWF0ZXMgYSBzdHJpbmcgZm9yIHN0b3JpbmcgYSBjb29raWUgb24gdGhlIGJyb3dzZXIuCiAqCiAqIEBuYW1lIGNvb2tpZVN0cmluZyhyZXEsIG9wdCkKICogQHBhcmFtIHtSZXF1ZXN0IE9iamVjdH0gcmVxCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHQKICogQHJldHVybnMge1N0cmluZ30KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmNvb2tpZVN0cmluZyA9IGZ1bmN0aW9uIChyZXEsIG9wdCkgewogICAgdmFyIHBhdGggPSBvcHQucGF0aCB8fCB1dGlscy5nZXRCYXNlVVJMKHJlcSkgKyAnLyc7CiAgICB2YXIgc3RyID0gZXNjYXBlKG9wdC5uYW1lKSArICc9JyArIGVzY2FwZShvcHQudmFsdWUpICsgJzsgcGF0aD0nICsgcGF0aDsKICAgIGlmIChvcHQuZGF5cykgewogICAgICAgIHZhciBleHBpcmVzID0gbmV3IERhdGUoKS5zZXRUaW1lKAogICAgICAgICAgICBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIDEwMDAgKiA2MCAqIDYwICogMjQgKiBvcHQuZGF5cwogICAgICAgICk7CiAgICAgICAgc3RyICs9ICc7IGV4cGlyZXM9JyArIGV4cGlyZXMudG9HTVRTdHJpbmcoKTsKICAgIH0KICAgIHJldHVybiBzdHI7Cn07CgovKioKICogU2V0cyBhIGNvb2tpZSBvbiB0aGUgYnJvd3NlciwgZm9yIHVzZSBjbGllbnQtc2lkZSBvbmx5LgogKgogKiBAbmFtZSBzZXRCcm93c2VyQ29va2llKHJlcSwgb3B0KQogKiBAcGFyYW0ge1JlcXVlc3QgT2JqZWN0fSByZXEKICogQHBhcmFtIHtPYmplY3R9IG9wdAogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuc2V0QnJvd3NlckNvb2tpZSA9IGZ1bmN0aW9uIChyZXEsIG9wdCkgewogICAgaWYgKCF1dGlscy5pc0Jyb3dzZXIoKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignc2V0QnJvd3NlckNvb2tpZSBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICB9CiAgICB2YXIgc3RyID0gKHR5cGVvZiBvcHQgPT09ICdzdHJpbmcnKSA/IG9wdDogZXhwb3J0cy5jb29raWVTdHJpbmcocmVxLCBvcHQpOwogICAgLy9jb25zb2xlLmxvZygnZG9jdW1lbnQuY29va2llID0gJyArIHN0cik7CiAgICBkb2N1bWVudC5jb29raWUgPSBzdHI7Cn07CgovKioKICogQ3JlYXRlcyBhIFNldC1Db29raWUgaGVhZGVyIG9uIGEgcmVzcG9uc2Ugb2JqZWN0LgogKgogKiBAbmFtZSBzZXRSZXNwb25zZUNvb2tpZShyZXEsIHJlcywgb3B0KQogKiBAcGFyYW0ge1JlcXVlc3QgT2JqZWN0fSByZXEKICogQHBhcmFtIHtSZXNwb25zZSBPYmplY3R9IHJlcwogKiBAcGFyYW0ge09iamVjdH0gb3B0CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5zZXRSZXNwb25zZUNvb2tpZSA9IGZ1bmN0aW9uIChyZXEsIHJlcywgb3B0KSB7CiAgICB2YXIgc3RyID0gKHR5cGVvZiBvcHQgPT09ICdzdHJpbmcnKSA/IG9wdDogZXhwb3J0cy5jb29raWVTdHJpbmcocmVxLCBvcHQpOwogICAgaWYgKHR5cGVvZiByZXMgIT09ICdvYmplY3QnKSB7CiAgICAgICAgcmVzID0ge2NvZGU6IDIwMCwgYm9keTogcmVzfTsKICAgIH0KICAgIGlmICghcmVzLmhlYWRlcnMpIHsKICAgICAgICByZXMuaGVhZGVycyA9IHt9OwogICAgfQogICAgLy8gVE9ETzogaXMgaXQgcG9zc2libGUgdG8gc2VuZCBtdWx0aXBsZSBzZXQtY29va2llIGhlYWRlcnMgYnkgdHVybmluZwogICAgLy8gaGVhZGVycyBpbnRvIGFuIGFycmF5IGxpa2UgaW4gbm9kZT8KICAgIC8vIFhYWDoganVzdCByZXBsYWNpbmcgYWxsIGNvb2tpZXMgZm9yIG5vdyAtIG5vdCBpZGVhbCEKICAgIHJlcy5oZWFkZXJzWydTZXQtQ29va2llJ10gPSBzdHI7Cn07CgoKfSl9OwoKLyoqKioqKioqKioga2Fuc28vY29yZSAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImthbnNvL2NvcmUiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLypnbG9iYWwgd2luZG93OiBmYWxzZSwgZ2V0Um93OiB0cnVlLCBzdGFydDogdHJ1ZSwgJDogZmFsc2UsIHBhZ2VUcmFja2VyOiB0cnVlLAogIGthbnNvOiB0cnVlLCBsb2c6IHRydWUsIGNvbnNvbGU6IHRydWUsIHNlbmQ6IHRydWUgKi8KCi8qKgogKiBUaGUgY29yZSBtb2R1bGUgY29udGFpbnMgZnVuY3Rpb25zIHVzZWQgYnkga2Fuc28gdG8gZmFjaWxpdGF0ZSB0aGUgcnVubmluZwogKiBvZiB5b3VyIGFwcC4gWW91IHNob3VsZG4ndCBuZWVkIHRvIHVzZSBhbnkgb2YgdGhlIGZ1bmN0aW9ucyBoZXJlIGRpcmVjdGx5CiAqIHVubGVzcyB5b3UncmUgbWVzc2luZyB3aXRoIHRoZSBpbnRlcm5hbHMgb2YgS2Fuc28uCiAqCiAqIEBtb2R1bGUKICovCgoKLyoqCiAqIE1vZHVsZSBkZXBlbmRlbmNpZXMKICovCgp2YXIgc2V0dGluZ3MgPSByZXF1aXJlKCcuL3NldHRpbmdzJyksIC8vIG1vZHVsZSBhdXRvLWdlbmVyYXRlZAogICAgdXJsID0gcmVxdWlyZSgnLi91cmwnKSwKICAgIGRiID0gcmVxdWlyZSgnLi9kYicpLAogICAgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyksCiAgICBzZXNzaW9uID0gcmVxdWlyZSgnLi9zZXNzaW9uJyksCiAgICBjb29raWVzID0gcmVxdWlyZSgnLi9jb29raWVzJyksCiAgICBmbGFzaG1lc3NhZ2VzID0gcmVxdWlyZSgnLi9mbGFzaG1lc3NhZ2VzJyksCiAgICB0ZW1wbGF0ZXMgPSByZXF1aXJlKCcuL3RlbXBsYXRlcycpLAogICAgZXZlbnRzID0gcmVxdWlyZSgnLi9ldmVudHMnKSwKICAgIHVybFBhcnNlID0gdXJsLnBhcnNlLAogICAgdXJsRm9ybWF0ID0gdXJsLmZvcm1hdCwKICAgIF8gPSByZXF1aXJlKCcuL3VuZGVyc2NvcmUnKS5fOwoKCi8qKgogKiBUaGlzIGlzIGJlY2F1c2UgdGhlIGZpcnN0IHBhZ2UgaGl0IGFsc28gdHJpZ2dlcnMga2Fuc28gdG8gaGFuZGxlIHRoZSB1cmwKICogY2xpZW50LXNpZGUuIEtub3dpbmcgaXQgaXMgdGhlIGZpcnN0IHBhZ2UgYmVpbmcgbG9hZGVkIG1lYW5zIHdlIGNhbiBzdG9wCiAqIHRoZSBwYWdlVHJhY2tlciBjb2RlIGZyb20gc3VibWl0dGluZyB0aGUgVVJMIHR3aWNlLiBFeHBvcnRlZCBiZWNhdXNlIHRoaXMKICogbWlnaHQgYmUgdXNlZnVsIGluZm9ybWF0aW9uIHRvIG90aGVyIG1vZHVsZXMsIGl0IHNob3VsZCBub3QgYmUgbW9kaWZpZWQKICogYnkgdGhlbS4KICovCgovL2V4cG9ydHMuaW5pdGlhbF9oaXQgPSB1dGlscy5pbml0aWFsX2hpdDsKCgovKioKICogVGhpcyB2YXJpYWJsZSBrZWVwcyB0cmFjayBvZiB3aGV0aGVyIG9yIG5vdCB0aGUgYnJvd3NlciBzdXBwb3J0cwogKiBwdXNoc3RhdGUgZm9yIG1hbmlwdWxhdGluZyBicm93c2VyIGhpc3RvcnkuCiAqLwoKZXhwb3J0cy5oaXN0b3J5X3N1cHBvcnQgPSBmYWxzZTsKCi8qKgogKiBTdG9yZXMgdGhlIGN1cnJlbnQgaHRtbDUgaGlzdG9yeSBzdGF0ZSB0byBkZXRlY3QgZHVwbGljYXRlIHBvcHN0YXRlIGV2ZW50cwogKi8KCmV4cG9ydHMuY3VycmVudF9zdGF0ZSA9IG51bGw7CgovKioKICogU2V0IHRvIHRydWUgd2hlbiBzZXRVUkwgaXMgY2FsbGVkIHNvIHRoZSBvbnBvcHN0YXRlIHdoaWNoIGZpcmVzIGFmdGVyd2FyZHMKICoga25vd3MgaXQgaXMgdGhlIHJlc3VsdCBvZiBhbiBleHBsaWNpdCBjYWxsIHRvIHNldFVSTCAoYXMgb3Bwb3NlZCB0byBjbGlja2luZwogKiB0aGUgYmFjaywgZm9yd2FyZCBvciByZWxvYWQgYnV0dG9ucykuIFRoaXMgbWVhbnMgd2UgY2FuIGF2b2lkIHNob3dpbmcgYQogKiBjb25maXJtYXRpb24gZGlhbG9nIGZvciBQT1NUIHJlcXVlc3RzIGluIHRoZXNlIGNpcmN1bXN0YW5jZXMuCiAqLwoKZXhwb3J0cy5zZXRfY2FsbGVkID0gZmFsc2U7CgoKaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CiAgICBpZiAoIXdpbmRvdy5jb25zb2xlKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2cgaXMgZ29pbmcgdG8gY2F1c2UgZXJyb3JzLCBqdXN0IHN0dWIgdGhlIGZ1bmN0aW9ucwogICAgICAgIC8vIGZvciBub3cuIFRPRE86IGFkZCBsb2dnaW5nIHV0aWxpdHkgZm9yIElFPwogICAgICAgIHdpbmRvdy5jb25zb2xlID0gewogICAgICAgICAgICBsb2c6IGZ1bmN0aW9uICgpIHt9LAogICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkge30sCiAgICAgICAgICAgIGluZm86IGZ1bmN0aW9uICgpIHt9LAogICAgICAgICAgICB3YXJuOiBmdW5jdGlvbiAoKSB7fQogICAgICAgIH07CiAgICB9CiAgICB2YXIgY29uc29sZSA9IHdpbmRvdy5jb25zb2xlOwp9CgoKLyoqCiAqIEdsb2JhbCBmdW5jdGlvbnMgcmVxdWlyZWQgdG8gbWF0Y2ggdGhlIENvdWNoREIgSmF2YVNjcmlwdCBlbnZpcm9ubWVudC4KICovCgppZiAodHlwZW9mIGdldFJvdyA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIHdpbmRvdy5nZXRSb3cgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Owp9CmlmICh0eXBlb2Ygc3RhcnQgPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CiAgICB3aW5kb3cuc3RhcnQgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgIC8vY29uc29sZS5sb2coJ3N0YXJ0Jyk7CiAgICAgICAgLy9jb25zb2xlLmxvZyhvcHRpb25zKTsKICAgIH07Cn0KaWYgKHR5cGVvZiBzZW5kID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgewogICAgd2luZG93LnNlbmQgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgIC8vY29uc29sZS5sb2coJ3NlbmQnKTsKICAgICAgICAvL2NvbnNvbGUubG9nKG9wdGlvbnMpOwogICAgfTsKfQppZiAodHlwZW9mIGxvZyA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIHdpbmRvdy5sb2cgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7CiAgICB9Owp9CgoKLyoqCiAqIFVzZWQgdG8gc3RvcmUgdXNlckN0eCwgcGVyaW9kaWNhbGx5IHVwZGF0ZWQgbGlrZSBvbiBzZXNzaW9uLmxvZ2luIGFuZAogKiBzZXNzaW9uLmxvZ291dC4gVE9ETzogT3IgaWYgYSBwZXJtaXNzaW9ucyBlcnJvciBpcyByZXR1cm5lZCBmcm9tIGEgZGIgbWV0aG9kPwogKi8KCi8vIFRPRE86IGFkZGVkIHRvIHV0aWxzIHRvIGF2b2lkIGNpcmN1bGFyIGRlcGVuZGVuY3kgYnVnIGluIGNvdWNoZGIKLy9leHBvcnRzLnVzZXJDdHggPSB1dGlscy51c2VyQ3R4OwoKCgoKLyoqCiAqIFRoZSBtb2R1bGUgbG9hZGVkIGFzIHRoZSBkZXNpZ24gZG9jdW1lbnQgKGxvYWQgcHJvcGVydHkgaW4ga2Fuc28uanNvbikuCiAqIExpa2VseSB0byBjYXVzZSBjaXJjdWxhciByZXF1aXJlIGluIGNvdWNoZGIgc28gb25seSBydW4gYnJvd3NlciBzaWRlLgogKiBUT0RPOiB3aGVuIGNpcmN1bGFyIHJlcXVpcmVzIGFyZSBmaXhlZCBpbiBjb3VjaGRiLCByZW1vdmUgdGhlIGlzQnJvd3NlciBjaGVjawogKi8KCmlmICh1dGlscy5pc0Jyb3dzZXIpIHsKICAgIGV4cG9ydHMuYXBwID0ge307CiAgICBpZiAoc2V0dGluZ3MubG9hZCkgewogICAgICAgIGV4cG9ydHMuYXBwID0gcmVxdWlyZShzZXR0aW5ncy5sb2FkKTsKICAgIH0KfQoKCi8qKgogKiBDYWxsZWQgYnkga2Fuc28uanMgb25jZSB0aGUgZGVzaWduIGRvYyBoYXMgYmVlbiBsb2FkZWQuCiAqLwoKZXhwb3J0cy5pbml0ID0gZnVuY3Rpb24gKCkgewoKICAgIGlmICh3aW5kb3cuaGlzdG9yeSAmJiBoaXN0b3J5LnB1c2hTdGF0ZSkgewogICAgICAgIGV4cG9ydHMuaGlzdG9yeV9zdXBwb3J0ID0gdHJ1ZTsKCiAgICAgICAgJCgnZm9ybScpLmxpdmUoJ3N1Ym1pdCcsIGZ1bmN0aW9uIChldikgewogICAgICAgICAgICB2YXIgYWN0aW9uID0gJCh0aGlzKS5hdHRyKCdhY3Rpb24nKSB8fCBleHBvcnRzLmdldFVSTCgpOwogICAgICAgICAgICB2YXIgbWV0aG9kID0gJCh0aGlzKS5hdHRyKCdtZXRob2QnKS50b1VwcGVyQ2FzZSgpOwoKICAgICAgICAgICAgLy8gX3Nlc3Npb24gaXMgYSBzcGVjaWFsIGNhc2UgYWx3YXlzIGF2YWlsYWJsZSBhdCB0aGUgcm9vdCB1cmwKICAgICAgICAgICAgaWYgKGFjdGlvbiAhPT0gJy9fc2Vzc2lvbicgJiYgZXhwb3J0cy5pc0FwcFVSTChhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZXhwb3J0cy5hcHBQYXRoKGFjdGlvbik7CiAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgdmFyIGZpZWxkcyA9ICQodGhpcykuc2VyaWFsaXplQXJyYXkoKTsKICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge307CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRzW2ldLm5hbWVdID0gZmllbGRzW2ldLnZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXhwb3J0cy5zZXRVUkwobWV0aG9kLCB1cmwsIGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgICQoJ2EnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uIChldikgewogICAgICAgICAgICB2YXIgaHJlZiA9ICQodGhpcykuYXR0cignaHJlZicpOwoKICAgICAgICAgICAgaWYgKGhyZWYgJiYgZXhwb3J0cy5pc0FwcFVSTChocmVmKSkgewogICAgICAgICAgICAgICAgdmFyIHVybCA9IGV4cG9ydHMuYXBwUGF0aChocmVmKTsKICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBleHBvcnRzLnNldFVSTCgnR0VUJywgdXJsLCB7fSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgd2luZG93Lm9ucG9wc3RhdGUgPSBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgdmFyIHVybCA9IGV4cG9ydHMuZ2V0VVJMKCk7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IGV2LnN0YXRlIHx8IHt9OwogICAgICAgICAgICB2YXIgbWV0aG9kID0gc3RhdGUubWV0aG9kIHx8ICdHRVQnOwogICAgICAgICAgICB2YXIgZGF0YSA9IHN0YXRlLmRhdGE7CiAgICAgICAgICAgIHZhciBjb3VudCA9IHN0YXRlLmhpc3RvcnlfY291bnQ7CgogICAgICAgICAgICBpZiAobWV0aG9kICE9PSAnR0VUJyAmJiBtZXRob2QgIT09ICdIRUFEJykgewogICAgICAgICAgICAgICAgLy8gdW5zYWZlIG1ldGhvZCwgdW5sZXNzIGNhdXNlZCBieSBhbiBleHBsaWNpdCBjYWxsIHRvIHNldFVSTAogICAgICAgICAgICAgICAgLy8gc2hvdyBhIGNvbmZpcm1hdGlvbiBkaWFsb2cKICAgICAgICAgICAgICAgIGlmICghZXhwb3J0cy5zZXRfY2FsbGVkKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogYXQgdGhpcyBwb2ludCBpcyBpdCB0b28gbGF0ZSB0byB1bmRvIHRoZSBwb3BzdGF0ZT8KICAgICAgICAgICAgICAgICAgICB2YXIgcmVzZW5kID0gY29uZmlybSgKICAgICAgICAgICAgICAgICAgICAgICAgJ0luIG9yZGVyIHRvIGNvbXBsZXRlIHRoaXMgcmVxdWVzdCB0aGUgYnJvd3NlciB3aWxsICcgKwogICAgICAgICAgICAgICAgICAgICAgICAnaGF2ZSB0byByZS1zZW5kIGluZm9ybWF0aW9uLCByZXBlYXRpbmcgYW55ICcgKwogICAgICAgICAgICAgICAgICAgICAgICAncHJldmlvdXMgYWN0aW9uIChzdWNoIGFzIGNyZWF0aW5nIGEgZG9jdW1lbnQpLlxuXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJ1JlLXNlbmQgaW5mb3JtYXRpb24/JwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNlbmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJfY291bnQgPSBleHBvcnRzLmN1cnJlbnRfc3RhdGUuaGlzdG9yeV9jb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkuZ28oY3Vycl9jb3VudCAtIGNvdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyByZXNldCBzZXRfY2FsbGVkCiAgICAgICAgICAgIGV4cG9ydHMuc2V0X2NhbGxlZCA9IGZhbHNlOwoKICAgICAgICAgICAgdmFyIGN1cnIgPSBleHBvcnRzLmN1cnJlbnRfc3RhdGU7CiAgICAgICAgICAgIGlmIChjdXJyICYmCiAgICAgICAgICAgICAgICBjdXJyLnVybCA9PT0gdXJsICYmCiAgICAgICAgICAgICAgICBjdXJyLnRpbWVzdGFtcCA9PT0gc3RhdGUudGltZXN0YW1wICYmCiAgICAgICAgICAgICAgICAoY3Vyci5tZXRob2QgfHwgJ0dFVCcpID09PSAoc3RhdGUubWV0aG9kIHx8ICdHRVQnKSkgewogICAgICAgICAgICAgICAgLy8gZHVwbGljYXRlIHBvcHN0YXRlIGV2ZW50CiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnZHVwbGljYXRlIHBvcHN0YXRlIGV2ZW50Jyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXhwb3J0cy5jdXJyZW50X3N0YXRlID0gewogICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsCiAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IHN0YXRlLnRpbWVzdGFtcCwKICAgICAgICAgICAgICAgIGhpc3RvcnlfY291bnQ6IGNvdW50CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGV4cG9ydHMuaGFuZGxlKG1ldGhvZCwgdXJsLCBkYXRhKTsKICAgICAgICB9OwogICAgICAgIHdpbmRvdy5vbnBvcHN0YXRlKHt9KTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIC8vIFRoaXMgYnJvd3NlciBoYXMgbm8gaHRtbDUgIGhpc3Rvcnkgc3VwcG9ydCwgYXR0ZW1wdCB0bwogICAgICAgIC8vIGVuaGFuY2UgdGhlIHBhZ2UgYW55d2F5CiAgICAgICAgLy8gVE9ETzogZmlndXJlIG91dCB0aGUgZGF0YSBmcm9tIHRoZSBpbml0aWFsIHJlcXVlc3QgYXMgdGhpcwogICAgICAgIC8vIHJlLXJlbmRlcmluZyBtaWdodCB3aXBlIHJlbGV2YW50IGRhdGEgZnJvbSB0aGUgcmVzcG9uc2UKICAgICAgICAvLyBUT0RPOiBmaWd1cmUgb3V0IHRoZSBtZXRob2QgZnJvbSB0aGUgaW5pdGlhbCByZXF1ZXN0CiAgICAgICAgLy8gYmVjYXVzZSB0aGUgaW5pdGlhbCByZXF1ZXN0IG1heSBoYXZlIGJlZW4gYSBQT1NUIChwb2ludGluZyB0bwogICAgICAgIC8vIGFuIHVwZGF0ZSBmdW5jdGlvbiBpbnN0ZWFkIG9mIHRoZSBzaG93IHRoaXMgR0VUIG1pZ2h0IHJlbmRlcikKICAgICAgICAvLwogICAgICAgIC8vIC0gcGVyaGFwcyB1c2UgY29va2llcyB0byBwYXNzIHRoZSBtZXRob2QgYW5kIGRhdGEgYmFjayB0byB0aGUgY2xpZW50PwogICAgICAgIC8vCiAgICAgICAgZXhwb3J0cy5oYW5kbGUoJ0dFVCcsIGV4cG9ydHMuZ2V0VVJMKCksIHt9KTsKICAgIH0KCiAgICAvLyBUT0RPOiBzaG91bGQgdGhpcyBiZSBhZnRlciB1c2VyQ3R4IGlzIGF2YWlsYWJsZT8/CiAgICAvLyBjYWxsIGluaXQgb24gYXBwIHRvbwogICAgZXZlbnRzLmVtaXQoJ2luaXQnKTsKfTsKCgovKioKICogRXh0cmFjdHMgZ3JvdXBzIGZyb20gYSB1cmwsIGVnOgogKiAnL3NvbWUvcGF0aCcgd2l0aCBwYXR0ZXJuICcvc29tZS86bmFtZScgLT4ge25hbWU6ICdwYXRoJ30KICoKICogQG5hbWUgcmV3cml0ZUdyb3VwcyhwYXR0ZXJuLCB1cmwpCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXR0ZXJuCiAqIEBwYXJhbSB7U3RyaW5nfSB1cmwKICogQHJldHVybnMge09iamVjdH0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnJld3JpdGVHcm91cHMgPSBmdW5jdGlvbiAocGF0dGVybiwgdXJsKSB7CiAgICB2YXIgcGF0aG5hbWUgPSB1cmxQYXJzZSh1cmwpLnBhdGhuYW1lOwogICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgKICAgICAgICAnXicgKyBwYXR0ZXJuLnJlcGxhY2UoLzpcdysvZywgJyhbXi9dKyknKS5yZXBsYWNlKC9cKi9nLCAnLionKSArICckJwogICAgKTsKICAgIHZhciBtID0gcmUuZXhlYyhwYXRobmFtZSk7CiAgICBpZiAoIW0pIHsKICAgICAgICByZXR1cm4gW107CiAgICB9CiAgICB2YXIgdmFsdWVzID0gbS5zbGljZSgxKTsKICAgIHZhciBrZXlzID0gW107CiAgICB2YXIgbWF0Y2hlcyA9IHBhdHRlcm4ubWF0Y2goLzpcdysvZykgfHwgW107CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hdGNoZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBrZXlzLnB1c2gobWF0Y2hlc1tpXS5zdWJzdHIoMSkpOwogICAgfQogICAgdmFyIGdyb3VwcyA9IHt9OwogICAgZm9yICh2YXIgaiA9IDA7IGogPCBrZXlzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgZ3JvdXBzW2tleXNbal1dID0gdmFsdWVzW2pdOwogICAgfQogICAgcmV0dXJuIGdyb3VwczsKfTsKCi8qKgogKiBFeHRyYWN0cyBhIHNwbGF0IHZhbHVlIGZyb20gYSByZXdyaXRlIHBhdHRlcm4gYW5kIG1hdGNoaW5nIFVSTC4KICoKICogQG5hbWUgcmV3cml0ZVNwbGF0KHBhdHRlcm4sIHVybCkKICogQHBhcmFtIHtTdHJpbmd9IHBhdHRlcm4KICogQHBhcmFtIHtTdHJpbmd9IHVybAogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMucmV3cml0ZVNwbGF0ID0gZnVuY3Rpb24gKHBhdHRlcm4sIHVybCkgewogICAgLy8gc3BsYXRzIGFyZSBvbmx5IHN1cHBvcnRlZCBhdCB0aGUgZW5kIG9mIGEgcmV3cml0ZSBwYXR0ZXJuCiAgICBpZiAocGF0dGVybi5jaGFyQXQocGF0dGVybi5sZW5ndGggLSAxKSA9PT0gJyonKSB7CiAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cChwYXR0ZXJuLnN1YnN0cigwLCBwYXR0ZXJuLmxlbmd0aCAtIDEpICsgJyguKiknKTsKICAgICAgICB2YXIgbWF0Y2ggPSByZS5leGVjKHVybCk7CiAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXRjaFsxXTsKICAgICAgICB9CiAgICB9Cn07CgoKLyoqCiAqIEF0dGVtcHRzIHRvIG1hdGNoIHJld3JpdGUgZnJvbSBwYXR0ZXJucyB0byBhIFVSTCwgcmV0dXJuaW5nIHRoZQogKiBtYXRjaGluZyByZXdyaXRlIG9iamVjdCBpZiBzdWNjZXNzZnVsLgogKgogKiBAbmFtZSBtYXRjaFVSTChtZXRob2QsIHVybCkKICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZAogKiBAcGFyYW0ge1N0cmluZ30gdXJsCiAqIEByZXR1cm5zIHtPYmplY3R9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5tYXRjaFVSTCA9IGZ1bmN0aW9uIChtZXRob2QsIHVybCkgewogICAgdmFyIHBhdGhuYW1lID0gdXJsUGFyc2UodXJsKS5wYXRobmFtZTsKICAgIHZhciByZXdyaXRlcyA9IGthbnNvLmFwcC5yZXdyaXRlczsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmV3cml0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgciA9IHJld3JpdGVzW2ldOwogICAgICAgIGlmICghci5tZXRob2QgfHwgbWV0aG9kID09PSByLm1ldGhvZCkgewogICAgICAgICAgICB2YXIgZnJvbSA9IHIuZnJvbTsKICAgICAgICAgICAgZnJvbSA9IGZyb20ucmVwbGFjZSgvXCokLywgJyguKiknKTsKICAgICAgICAgICAgZnJvbSA9IGZyb20ucmVwbGFjZSgvOlx3Ky9nLCAnKFteL10rKScpOwogICAgICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKCdeJyArIGZyb20gKyAnJCcpOwogICAgICAgICAgICBpZiAocmUudGVzdChwYXRobmFtZSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiByOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9OwoKLyoqCiAqIFJlcGxhY2UgZ3JvdXAgbmFtZXMgaW4gYSBzdHJpbmcgd2l0aCB0aGUgdmFsdWUgb2YgdGhhdCBncm91cAogKiBlZzogIi86bmFtZSIgd2l0aCBncm91cHMge25hbWU6ICd0ZXN0J30gLT4gIi90ZXN0IgogKgogKiBAbmFtZSByZXBsYWNlR3JvdXBzKHZhbCwgZ3JvdXBzLCBzcGxhdCkKICogQHBhcmFtIHtTdHJpbmd9IHZhbAogKiBAcGFyYW0ge09iamVjdH0gZ3JvdXBzCiAqIEBwYXJhbSB7U3RyaW5nfSBzcGxhdAogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMucmVwbGFjZUdyb3VwcyA9IGZ1bmN0aW9uICh2YWwsIGdyb3Vwcywgc3BsYXQpIHsKICAgIHZhciBrLCBtYXRjaCwgcmVzdWx0ID0gdmFsOwoKICAgIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykgewogICAgICAgIHJlc3VsdCA9IHZhbC5zcGxpdCgnLycpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzdWx0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG1hdGNoID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAoayBpbiBncm91cHMpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHRbaV0gPT09ICc6JyArIGspIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbaV0gPSBkZWNvZGVVUklDb21wb25lbnQoZ3JvdXBzW2tdKTsKICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFtYXRjaCAmJiByZXN1bHRbaV0gPT09ICcqJykgewogICAgICAgICAgICAgICAgcmVzdWx0W2ldID0gc3BsYXQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmpvaW4oJy8nKTsKICAgIH0KICAgIGVsc2UgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICByZXN1bHQgPSB2YWwuc2xpY2UoKTsKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHZhbC5sZW5ndGg7IGorKykgewogICAgICAgICAgICBtYXRjaCA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGsgaW4gZ3JvdXBzKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsW2pdID09PSAnOicgKyBrKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2pdID0gZGVjb2RlVVJJQ29tcG9uZW50KGdyb3Vwc1trXSk7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghbWF0Y2ggJiYgdmFsW2pdID09PSAnKicpIHsKICAgICAgICAgICAgICAgIHJlc3VsdFtqXSA9IHNwbGF0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKfTsKCgovKioKICogQ3JlYXRlcyBhIG5ldyByZXF1ZXN0IG9iamVjdCBmcm9tIGEgdXJsIGFuZCBtYXRjaGluZyByZXdyaXRlIG9iamVjdC4KICogUXVlcnkgcGFyYW1ldGVycyBhcmUgYXV0b21hdGljYWxseSBwb3B1bGF0ZWQgZnJvbSByZXdyaXRlIHBhdHRlcm4uCiAqCiAqIEBuYW1lIGNyZWF0ZVJlcXVlc3QobWV0aG9kLCB1cmwsIGRhdGEsIG1hdGNoLCBjYWxsYmFjaykKICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZAogKiBAcGFyYW0ge1N0cmluZ30gdXJsCiAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhCiAqIEBwYXJhbSB7T2JqZWN0fSBtYXRjaAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuY3JlYXRlUmVxdWVzdCA9IGZ1bmN0aW9uIChtZXRob2QsIHVybCwgZGF0YSwgbWF0Y2gsIGNhbGxiYWNrKSB7CiAgICB2YXIgZ3JvdXBzID0gZXhwb3J0cy5yZXdyaXRlR3JvdXBzKG1hdGNoLmZyb20sIHVybCk7CiAgICB2YXIgcXVlcnkgPSB1cmxQYXJzZSh1cmwsIHRydWUpLnF1ZXJ5IHx8IHt9OwogICAgdmFyIGs7CiAgICBpZiAobWF0Y2gucXVlcnkpIHsKICAgICAgICBmb3IgKGsgaW4gbWF0Y2gucXVlcnkpIHsKICAgICAgICAgICAgaWYgKG1hdGNoLnF1ZXJ5Lmhhc093blByb3BlcnR5KGspKSB7CiAgICAgICAgICAgICAgICBxdWVyeVtrXSA9IGV4cG9ydHMucmVwbGFjZUdyb3VwcyhtYXRjaC5xdWVyeVtrXSwgZ3JvdXBzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGlmIChncm91cHMpIHsKICAgICAgICBmb3IgKGsgaW4gZ3JvdXBzKSB7CiAgICAgICAgICAgIGlmIChncm91cHMuaGFzT3duUHJvcGVydHkoaykpIHsKICAgICAgICAgICAgICAgIHF1ZXJ5W2tdID0gZGVjb2RlVVJJQ29tcG9uZW50KGdyb3Vwc1trXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAvLyBzcGxhdHMgYXJlIGF2YWlsYWJsZSBmb3IgcmV3cml0aW5nIG1hdGNoLnRvLCBidXQgbm90IGFjY2Vzc2libGUgb24KICAgIC8vIHRoZSByZXF1ZXN0IG9iamVjdCAoY291Y2hkYiAxLjEueCksIHN0b3JpbmcgaW4gYSBzZXBhcmF0ZSB2YXJpYWJsZQogICAgLy8gZm9yIG5vdwogICAgdmFyIHNwbGF0ID0gZXhwb3J0cy5yZXdyaXRlU3BsYXQobWF0Y2guZnJvbSwgdXJsKTsKICAgIHZhciB0byA9IGV4cG9ydHMucmVwbGFjZUdyb3VwcyhtYXRjaC50bywgcXVlcnksIHNwbGF0KTsKICAgIHZhciByZXEgPSB7CiAgICAgICAgbWV0aG9kOiBtZXRob2QsCiAgICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICAgIGhlYWRlcnM6IHt9LAogICAgICAgIHBhdGg6IHRvLnNwbGl0KCcvJyksCiAgICAgICAgY2xpZW50OiB0cnVlLAogICAgICAgIGluaXRpYWxfaGl0OiB1dGlscy5pbml0aWFsX2hpdCwKICAgICAgICBjb29raWU6IGNvb2tpZXMucmVhZEJyb3dzZXJDb29raWVzKCkKICAgIH07CiAgICBpZiAoZGF0YSkgewogICAgICAgIHJlcS5mb3JtID0gZGF0YTsKICAgIH0KCiAgICBkYi5uZXdVVUlEKDEwMCwgZnVuY3Rpb24gKGVyciwgdXVpZCkgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7CiAgICAgICAgfQogICAgICAgIHJlcS51dWlkID0gdXVpZDsKCiAgICAgICAgaWYgKHV0aWxzLnVzZXJDdHgpIHsKICAgICAgICAgICAgcmVxLnVzZXJDdHggPSB1dGlscy51c2VyQ3R4OwogICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgcmVxKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHNlc3Npb24uaW5mbyhmdW5jdGlvbiAoZXJyLCBzZXNzaW9uKSB7CiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXEudXNlckN0eCA9IHNlc3Npb24udXNlckN0eDsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlcSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwp9OwoKCi8qKgogKiBIYW5kbGVzIHJldHVybiB2YWx1ZXMgZnJvbSBzaG93IC8gbGlzdCAvIHVwZGF0ZSBmdW5jdGlvbnMKICovCgpleHBvcnRzLmhhbmRsZVJlc3BvbnNlID0gZnVuY3Rpb24gKHJlcSwgcmVzKSB7CiAgICAvL2NvbnNvbGUubG9nKCdyZXNwb25zZScpOwogICAgLy9jb25zb2xlLmxvZyhyZXMpOwogICAgaWYgKHJlcSAmJiB0eXBlb2YgcmVzID09PSAnb2JqZWN0JykgewogICAgICAgIGlmIChyZXMuaGVhZGVycykgewogICAgICAgICAgICBpZiAocmVzLmhlYWRlcnNbJ1NldC1Db29raWUnXSkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuY29va2llID0gcmVzLmhlYWRlcnNbJ1NldC1Db29raWUnXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbG9jID0gcmVzLmhlYWRlcnNbJ0xvY2F0aW9uJ107CiAgICAgICAgICAgIGlmIChsb2MgJiYgXy5pbmRleE9mKFszMDEsIDMwMiwgMzAzLCAzMDddLCByZXMuY29kZSkgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBpZiAoZXhwb3J0cy5pc0FwcFVSTChsb2MpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gcmVzZXQgbWV0aG9kIHRvIEdFVCB1bmxlc3MgcmVzcG9uc2UgaXMgYSAzMDcKICAgICAgICAgICAgICAgICAgICB2YXIgbWV0aG9kID0gcmVzLmNvZGUgPT09IDMwNyA/IHJlcS5tZXRob2QgfHwgJ0dFVCc6ICdHRVQnOwogICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuc2V0VVJMKG1ldGhvZCwgZXhwb3J0cy5hcHBQYXRoKGxvYykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24gPSBsb2M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn07CgoKLyoqCiAqIEZldGNoZXMgdGhlIHJlbGV2YW50IGRvY3VtZW50IGFuZCBjYWxscyB0aGUgbmFtZWQgc2hvdyBmdW5jdGlvbi4KICoKICogQG5hbWUgcnVuU2hvd0Jyb3dzZXIocmVxLCBuYW1lLCBkb2NpZCwgY2FsbGJhY2spCiAqIEBwYXJhbSB7T2JqZWN0fSByZXEKICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICogQHBhcmFtIHtTdHJpbmd9IGRvY2lkCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5ydW5TaG93QnJvd3NlciA9IGZ1bmN0aW9uIChyZXEsIG5hbWUsIGRvY2lkLCBjYWxsYmFjaykgewogICAgdmFyIHJlc3VsdDsKICAgIHZhciBmbiA9IGthbnNvLmFwcC5zaG93c1tuYW1lXTsKCiAgICB2YXIgaW5mbyA9IHsKICAgICAgICB0eXBlOiAnc2hvdycsCiAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICB0YXJnZXQ6IGRvY2lkLAogICAgICAgIHF1ZXJ5OiByZXEucXVlcnksCiAgICAgICAgZm46IGZuCiAgICB9OwogICAgZXZlbnRzLmVtaXQoJ2JlZm9yZVJlc291cmNlJywgaW5mbyk7CgogICAgaWYgKGRvY2lkKSB7CiAgICAgICAgZGIuZ2V0RG9jKGRvY2lkLCByZXEucXVlcnksIGZ1bmN0aW9uIChlcnIsIGRvYykgewogICAgICAgICAgICB2YXIgY3VycmVudF9yZXEgPSAodXRpbHMuY3VycmVudFJlcXVlc3QoKSB8fCB7fSk7CiAgICAgICAgICAgIGlmIChjdXJyZW50X3JlcS51dWlkID09PSByZXEudXVpZCkgewogICAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHJlcyA9IGV4cG9ydHMucnVuU2hvdyhmbiwgZG9jLCByZXEpOwogICAgICAgICAgICAgICAgZXZlbnRzLmVtaXQoJ2FmdGVyUmVzcG9uc2UnLCBpbmZvLCByZXEsIHJlcyk7CiAgICAgICAgICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5oYW5kbGVSZXNwb25zZShyZXEsIHJlcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm5lZCB3aXRob3V0IHJlc3BvbnNlLCBtZWFuaW5nIGNvb2tpZXMgd29uJ3QgYmUgc2V0CiAgICAgICAgICAgICAgICAgICAgLy8gYnkgaGFuZGxlUmVzcG9uc2VIZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcS5vdXRnb2luZ19mbGFzaF9tZXNzYWdlcykgewogICAgICAgICAgICAgICAgICAgICAgICBmbGFzaG1lc3NhZ2VzLnNldENvb2tpZUJyb3dzZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEsIHJlcS5vdXRnb2luZ19mbGFzaF9tZXNzYWdlcwogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHZhciByZXMgPSBleHBvcnRzLnJ1blNob3coZm4sIG51bGwsIHJlcSk7CiAgICAgICAgZXZlbnRzLmVtaXQoJ2FmdGVyUmVzcG9uc2UnLCBpbmZvLCByZXEsIHJlcyk7CiAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgICBleHBvcnRzLmhhbmRsZVJlc3BvbnNlKHJlcSwgcmVzKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHJldHVybmVkIHdpdGhvdXQgcmVzcG9uc2UsIG1lYW5pbmcgY29va2llcyB3b24ndCBiZSBzZXQgYnkKICAgICAgICAgICAgLy8gaGFuZGxlUmVzcG9uc2VIZWFkZXJzCiAgICAgICAgICAgIGlmIChyZXEub3V0Z29pbmdfZmxhc2hfbWVzc2FnZXMpIHsKICAgICAgICAgICAgICAgIGZsYXNobWVzc2FnZXMuc2V0Q29va2llQnJvd3NlcigKICAgICAgICAgICAgICAgICAgICByZXEsIHJlcS5vdXRnb2luZ19mbGFzaF9tZXNzYWdlcwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYWxsYmFjaygpOwogICAgfQp9OwoKLyoqCiAqIEhlbHBlciBmb3IgcnVuU2hvdy9ydW5MaXN0LgogKgogKiBAbmFtZSBwYXJzZVJlc3BvbnNlKHJlcSwgcmVzKQogKiBAcGFyYW0ge09iamVjdH0gcmVxCiAqIEBwYXJhbSB7T2JqZWN0fSByZXMKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnBhcnNlUmVzcG9uc2UgPSBmdW5jdGlvbiAocmVxLCByZXMpIHsKICAgIHZhciBpZHMgPSBfLndpdGhvdXQoXy5rZXlzKHJlcyksICd0aXRsZScsICdjb2RlJywgJ2hlYWRlcnMnLCAnYm9keScpOwogICAgaWYgKHJlcS5jbGllbnQpIHsKICAgICAgICBpZiAocmVzLnRpdGxlKSB7CiAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gcmVzLnRpdGxlOwogICAgICAgIH0KICAgICAgICBfLmVhY2goaWRzLCBmdW5jdGlvbiAoaWQpIHsKICAgICAgICAgICAgJCgnIycgKyBpZCkuaHRtbChyZXNbaWRdKTsKICAgICAgICB9KTsKICAgIH0KICAgIGVsc2UgaWYgKCFyZXMuYm9keSkgewogICAgICAgIHZhciBjb250ZXh0ID0ge3RpdGxlOiByZXMudGl0bGUgfHwgJyd9OwogICAgICAgIF8uZWFjaChpZHMsIGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgICBjb250ZXh0W2lkXSA9IHJlc1tpZF07CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGJvZHkgPSB0ZW1wbGF0ZXMucmVuZGVyKAogICAgICAgICAgICBzZXR0aW5ncy5iYXNlX3RlbXBsYXRlIHx8ICdiYXNlLmh0bWwnLCByZXEsIGNvbnRleHQKICAgICAgICApOwogICAgICAgIHJlcyA9IHsKICAgICAgICAgICAgYm9keTogYm9keSwKICAgICAgICAgICAgY29kZTogcmVzLmNvZGUgfHwgMjAwLAogICAgICAgICAgICBoZWFkZXJzOiByZXMuaGVhZGVycwogICAgICAgIH07CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIGJvZHk6IHJlcy5ib2R5LAogICAgICAgIGNvZGU6IHJlcy5jb2RlLAogICAgICAgIGhlYWRlcnM6IHJlcy5oZWFkZXJzCiAgICB9Owp9OwoKLyoqCiAqIFJ1bnMgYSBzaG93IGZ1bmN0aW9uIHdpdGggdGhlIGdpdmVuIGRvY3VtZW50IGFuZCByZXF1ZXN0IG9iamVjdCwKICogZW1pdHRpbmcgcmVsZXZhbnQgZXZlbnRzLiBUaGlzIGZ1bmN0aW9uIHJ1bnMgYm90aCBzZXJ2ZXIgYW5kIGNsaWVudC1zaWRlLgogKgogKiBAbmFtZSBydW5TaG93KGZuLCBkb2MsIHJlcSkKICogQHBhcmFtIHtGdW5jdGlvbn0gZm4KICogQHBhcmFtIHtPYmplY3R9IGRvYwogKiBAcGFyYW0ge09iamVjdH0gcmVxCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5wYXJzZVJlc3BvbnNlID0gZnVuY3Rpb24gKHJlcSwgcmVzKSB7CiAgICB2YXIgaWRzID0gXy53aXRob3V0KF8ua2V5cyhyZXMpLCAndGl0bGUnLCAnY29kZScsICdoZWFkZXJzJywgJ2JvZHknKTsKICAgIGlmIChyZXEuY2xpZW50KSB7CiAgICAgICAgaWYgKHJlcy50aXRsZSkgewogICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IHJlcy50aXRsZTsKICAgICAgICB9CiAgICAgICAgXy5lYWNoKGlkcywgZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICAgICQoJyMnICsgaWQpLmh0bWwocmVzW2lkXSk7CiAgICAgICAgfSk7CiAgICB9CiAgICBlbHNlIGlmICghcmVzLmJvZHkpIHsKICAgICAgICB2YXIgY29udGV4dCA9IHt0aXRsZTogcmVzLnRpdGxlIHx8ICcnfTsKICAgICAgICBfLmVhY2goaWRzLCBmdW5jdGlvbiAoaWQpIHsKICAgICAgICAgICAgY29udGV4dFtpZF0gPSByZXNbaWRdOwogICAgICAgIH0pOwogICAgICAgIHZhciBib2R5ID0gdGVtcGxhdGVzLnJlbmRlcigKICAgICAgICAgICAgc2V0dGluZ3MuYmFzZV90ZW1wbGF0ZSB8fCAnYmFzZS5odG1sJywgcmVxLCBjb250ZXh0CiAgICAgICAgKTsKICAgICAgICByZXMgPSB7CiAgICAgICAgICAgIGJvZHk6IGJvZHksCiAgICAgICAgICAgIGNvZGU6IHJlcy5jb2RlIHx8IDIwMCwKICAgICAgICAgICAgaGVhZGVyczogcmVzLmhlYWRlcnMKICAgICAgICB9OwogICAgfQogICAgcmV0dXJuIHsKICAgICAgICBib2R5OiByZXMuYm9keSwKICAgICAgICBjb2RlOiByZXMuY29kZSwKICAgICAgICBoZWFkZXJzOiByZXMuaGVhZGVycwogICAgfTsKfTsKCmV4cG9ydHMucnVuU2hvdyA9IGZ1bmN0aW9uIChmbiwgZG9jLCByZXEpIHsKICAgIHJlcSA9IGZsYXNobWVzc2FnZXMudXBkYXRlUmVxdWVzdChyZXEpOwogICAgdXRpbHMuY3VycmVudFJlcXVlc3QocmVxKTsKICAgIHZhciBpbmZvID0gewogICAgICAgIHR5cGU6ICdzaG93JywKICAgICAgICBuYW1lOiByZXEucGF0aFsxXSwKICAgICAgICB0YXJnZXQ6IHJlcS5wYXRoWzJdLAogICAgICAgIHF1ZXJ5OiByZXEucXVlcnksCiAgICAgICAgZm46IGZuCiAgICB9OwogICAgZXZlbnRzLmVtaXQoJ2JlZm9yZVJlcXVlc3QnLCBpbmZvLCByZXEpOwogICAgdmFyIHJlcyA9IGZuKGRvYywgcmVxKTsKCiAgICBpZiAoIShyZXMgaW5zdGFuY2VvZiBPYmplY3QpKSB7CiAgICAgICAgcmVzID0ge2NvZGU6IDIwMCwgYm9keTogcmVzfTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHJlcyA9IGV4cG9ydHMucGFyc2VSZXNwb25zZShyZXEsIHJlcyk7CiAgICB9CiAgICBldmVudHMuZW1pdCgnYmVmb3JlUmVzcG9uc2VTdGFydCcsIGluZm8sIHJlcSwgcmVzKTsKICAgIGV2ZW50cy5lbWl0KCdiZWZvcmVSZXNwb25zZURhdGEnLCBpbmZvLCByZXEsIHJlcywgcmVzLmJvZHkgfHwgJycpOwoKICAgIHJlcyA9IGZsYXNobWVzc2FnZXMudXBkYXRlUmVzcG9uc2UocmVxLCByZXMpOwogICAgcmVxLnJlc3BvbnNlX3JlY2VpdmVkID0gdHJ1ZTsKICAgIHJldHVybiByZXM7Cn07CgovKioKICogRmV0Y2hlcyB0aGUgcmVsZXZhbnQgZG9jdW1lbnQgYW5kIGNhbGxzIHRoZSBuYW1lZCB1cGRhdGUgZnVuY3Rpb24uCiAqCiAqIEBuYW1lIHJ1blVwZGF0ZUJyb3dzZXIocmVxLCBuYW1lLCBkb2NpZCwgY2FsbGJhY2spCiAqIEBwYXJhbSB7T2JqZWN0fSByZXEKICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICogQHBhcmFtIHtTdHJpbmd9IGRvY2lkCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5ydW5VcGRhdGVCcm93c2VyID0gZnVuY3Rpb24gKHJlcSwgbmFtZSwgZG9jaWQsIGNhbGxiYWNrKSB7CiAgICB2YXIgcmVzdWx0OwogICAgdmFyIGZuID0ga2Fuc28uYXBwLnVwZGF0ZXNbbmFtZV07CgogICAgdmFyIGluZm8gPSB7CiAgICAgICAgdHlwZTogJ3VwZGF0ZScsCiAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICB0YXJnZXQ6IGRvY2lkLAogICAgICAgIHF1ZXJ5OiByZXEucXVlcnksCiAgICAgICAgZm46IGZuCiAgICB9OwogICAgZXZlbnRzLmVtaXQoJ2JlZm9yZVJlc291cmNlJywgaW5mbyk7CgogICAgaWYgKGRvY2lkKSB7CiAgICAgICAgZGIuZ2V0RG9jKGRvY2lkLCByZXEucXVlcnksIGZ1bmN0aW9uIChlcnIsIGRvYykgewogICAgICAgICAgICB2YXIgY3VycmVudF9yZXEgPSAodXRpbHMuY3VycmVudFJlcXVlc3QoKSB8fCB7fSk7CiAgICAgICAgICAgIGlmIChjdXJyZW50X3JlcS51dWlkID09PSByZXEudXVpZCkgewogICAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXhwb3J0cy5ydW5VcGRhdGUoZm4sIGRvYywgcmVxLCBmdW5jdGlvbiAoZXJyLCByZXMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50cy5lbWl0KCd1cGRhdGVGYWlsdXJlJywgZXJyLCBpbmZvLCByZXEsIHJlcywgZG9jKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGV2ZW50cy5lbWl0KCdhZnRlclJlc3BvbnNlJywgaW5mbywgcmVxLCByZXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChyZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5oYW5kbGVSZXNwb25zZShyZXEsIHJlc1sxXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm5lZCB3aXRob3V0IHJlc3BvbnNlLCBtZWFuaW5nIGNvb2tpZXMgd29uJ3QgYmUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGJ5IGhhbmRsZVJlc3BvbnNlSGVhZGVycwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxLm91dGdvaW5nX2ZsYXNoX21lc3NhZ2VzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFzaG1lc3NhZ2VzLnNldENvb2tpZUJyb3dzZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLCByZXEub3V0Z29pbmdfZmxhc2hfbWVzc2FnZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBleHBvcnRzLnJ1blVwZGF0ZShmbiwgbnVsbCwgcmVxLCBmdW5jdGlvbiAoZXJyLCByZXMpIHsKICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgZXZlbnRzLmVtaXQoJ3VwZGF0ZUZhaWx1cmUnLCBlcnIsIGluZm8sIHJlcSwgcmVzLCBudWxsKTsKICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV2ZW50cy5lbWl0KCdhZnRlclJlc3BvbnNlJywgaW5mbywgcmVxLCByZXMpOwogICAgICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICAgICAgICBleHBvcnRzLmhhbmRsZVJlc3BvbnNlKHJlcSwgcmVzWzFdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIHJldHVybmVkIHdpdGhvdXQgcmVzcG9uc2UsIG1lYW5pbmcgY29va2llcyB3b24ndCBiZSBzZXQgYnkKICAgICAgICAgICAgICAgIC8vIGhhbmRsZVJlc3BvbnNlSGVhZGVycwogICAgICAgICAgICAgICAgaWYgKHJlcS5vdXRnb2luZ19mbGFzaF9tZXNzYWdlcykgewogICAgICAgICAgICAgICAgICAgIGZsYXNobWVzc2FnZXMuc2V0Q29va2llQnJvd3NlcigKICAgICAgICAgICAgICAgICAgICAgICAgcmVxLCByZXEub3V0Z29pbmdfZmxhc2hfbWVzc2FnZXMKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhbGxiYWNrKCk7CiAgICAgICAgfSk7CiAgICB9Cn07CgovKioKICogUnVucyBhIHVwZGF0ZSBmdW5jdGlvbiB3aXRoIHRoZSBnaXZlbiBkb2N1bWVudCBhbmQgcmVxdWVzdCBvYmplY3QsCiAqIGVtaXR0aW5nIHJlbGV2YW50IGV2ZW50cy4gVGhpcyBmdW5jdGlvbiBydW5zIGJvdGggc2VydmVyIGFuZCBjbGllbnQtc2lkZS4KICoKICogQG5hbWUgcnVuVXBkYXRlKGZuLCBkb2MsIHJlcSkKICogQHBhcmFtIHtGdW5jdGlvbn0gZm4KICogQHBhcmFtIHtPYmplY3R9IGRvYwogKiBAcGFyYW0ge09iamVjdH0gcmVxCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5ydW5VcGRhdGUgPSBmdW5jdGlvbiAoZm4sIGRvYywgcmVxLCBjYikgewogICAgcmVxID0gZmxhc2htZXNzYWdlcy51cGRhdGVSZXF1ZXN0KHJlcSk7CiAgICB1dGlscy5jdXJyZW50UmVxdWVzdChyZXEpOwogICAgdmFyIGluZm8gPSB7CiAgICAgICAgdHlwZTogJ3VwZGF0ZScsCiAgICAgICAgbmFtZTogcmVxLnBhdGhbMV0sCiAgICAgICAgdGFyZ2V0OiByZXEucGF0aFsyXSwKICAgICAgICBxdWVyeTogcmVxLnF1ZXJ5LAogICAgICAgIGZuOiBmbgogICAgfTsKICAgIGV2ZW50cy5lbWl0KCdiZWZvcmVSZXF1ZXN0JywgaW5mbywgcmVxKTsKICAgIHZhciB2YWwgPSBmbihkb2MsIHJlcSk7CgogICAgdmFyIHJlcyA9IHZhbCA/IHZhbFsxXTogbnVsbDsKICAgIGlmICghKHJlcyBpbnN0YW5jZW9mIE9iamVjdCkpIHsKICAgICAgICByZXMgPSB7Y29kZTogMjAwLCBib2R5OiByZXN9OwogICAgfQogICAgZWxzZSB7CiAgICAgICAgcmVzID0gZXhwb3J0cy5wYXJzZVJlc3BvbnNlKHJlcSwgcmVzKTsKICAgIH0KICAgIGV2ZW50cy5lbWl0KCdiZWZvcmVSZXNwb25zZVN0YXJ0JywgaW5mbywgcmVxLCByZXMpOwogICAgZXZlbnRzLmVtaXQoJ2JlZm9yZVJlc3BvbnNlRGF0YScsIGluZm8sIHJlcSwgcmVzLCByZXMuYm9keSB8fCAnJyk7CgogICAgdmFyIHIgPSBbCiAgICAgICAgdmFsID8gdmFsWzBdOiBudWxsLAogICAgICAgIGZsYXNobWVzc2FnZXMudXBkYXRlUmVzcG9uc2UocmVxLCByZXMpCiAgICBdOwogICAgaWYgKHJlcS5jbGllbnQgJiYgclswXSkgewogICAgICAgIGRiLnNhdmVEb2MoclswXSwgZnVuY3Rpb24gKGVyciwgcmVzKSB7CiAgICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYihlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcS5yZXNwb25zZV9yZWNlaXZlZCA9IHRydWU7CiAgICAgICAgICAgIGNiKG51bGwsIHIpOwogICAgICAgIH0pOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgcmVxLnJlc3BvbnNlX3JlY2VpdmVkID0gdHJ1ZTsKICAgICAgICBjYihudWxsLCByKTsKICAgIH0KfTsKCgovKioKICogQ3JlYXRlcyBhIGZha2UgaGVhZCBvYmplY3QgZnJvbSB2aWV3IHJlc3VsdHMgZm9yIHBhc3NpbmcgdG8gYSBsaXN0IGZ1bmN0aW9uCiAqIGJlaW5nIHJ1biBjbGllbnQtc2lkZS4KICoKICogQG5hbWUgY3JlYXRlSGVhZChkYXRhKQogKiBAcGFyYW0ge09iamVjdH0gZGF0YQogKiBAcmV0dXJucyB7T2JqZWN0fQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuY3JlYXRlSGVhZCA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB2YXIgaGVhZCA9IHt9OwogICAgZm9yICh2YXIgayBpbiBkYXRhKSB7CiAgICAgICAgaWYgKGsgIT09ICdyb3dzJykgewogICAgICAgICAgICBoZWFkW2tdID0gZGF0YVtrXTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gaGVhZDsKfTsKCgovKioKICogRmV0Y2hlcyB0aGUgcmVsZXZhbnQgdmlldyBhbmQgY2FsbHMgdGhlIG5hbWVkIGxpc3QgZnVuY3Rpb24gd2l0aCB0aGUgcmVzdWx0cy4KICoKICogQG5hbWUgcnVuTGlzdEJyb3dzZXIocmVxLCBuYW1lLCB2aWV3LCBjYWxsYmFjaykKICogQHBhcmFtIHtPYmplY3R9IHJlcQogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogKiBAcGFyYW0ge1N0cmluZ30gdmlldwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMucnVuTGlzdEJyb3dzZXIgPSBmdW5jdGlvbiAocmVxLCBuYW1lLCB2aWV3LCBjYWxsYmFjaykgewogICAgdmFyIGZuID0ga2Fuc28uYXBwLmxpc3RzW25hbWVdOwoKICAgIHZhciBpbmZvID0gewogICAgICAgIHR5cGU6ICdsaXN0JywKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIHRhcmdldDogdmlldywKICAgICAgICBxdWVyeTogcmVxLnF1ZXJ5LAogICAgICAgIGZuOiBmbgogICAgfTsKICAgIGV2ZW50cy5lbWl0KCdiZWZvcmVSZXNvdXJjZScsIGluZm8pOwoKICAgIGlmICh2aWV3KSB7CiAgICAgICAgLy8gdXBkYXRlX3NlcSB1c2VkIGluIGhlYWQgcGFyYW1ldGVyIHBhc3NlZCB0byBsaXN0IGZ1bmN0aW9uCiAgICAgICAgcmVxLnF1ZXJ5LnVwZGF0ZV9zZXEgPSB0cnVlOwogICAgICAgIGRiLmdldFZpZXcodmlldywgcmVxLnF1ZXJ5LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50X3JlcSA9ICh1dGlscy5jdXJyZW50UmVxdWVzdCgpIHx8IHt9KTsKICAgICAgICAgICAgaWYgKGN1cnJlbnRfcmVxLnV1aWQgPT09IHJlcS51dWlkKSB7CiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBnZXRSb3cgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEucm93cy5zaGlmdCgpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHN0YXJ0ID0gZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ3N0YXJ0Jyk7CiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXMpOwogICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuaGFuZGxlUmVzcG9uc2UocmVxLCByZXMpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHZhciBoZWFkID0gZXhwb3J0cy5jcmVhdGVIZWFkKGRhdGEpOwogICAgICAgICAgICAgICAgdmFyIHJlcyA9IGV4cG9ydHMucnVuTGlzdChmbiwgaGVhZCwgcmVxKTsKICAgICAgICAgICAgICAgIGV2ZW50cy5lbWl0KCdhZnRlclJlc3BvbnNlJywgaW5mbywgcmVxLCByZXMpOwogICAgICAgICAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuaGFuZGxlUmVzcG9uc2UocmVxLCByZXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuZWQgd2l0aG91dCByZXNwb25zZSwgbWVhbmluZyBjb29raWVzIHdvbid0IGJlIHNldAogICAgICAgICAgICAgICAgICAgIC8vIGJ5IGhhbmRsZVJlc3BvbnNlSGVhZGVycwogICAgICAgICAgICAgICAgICAgIGlmIChyZXEub3V0Z29pbmdfZmxhc2hfbWVzc2FnZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmxhc2htZXNzYWdlcy5zZXRDb29raWVCcm93c2VyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLCByZXEub3V0Z29pbmdfZmxhc2hfbWVzc2FnZXMKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBnZXRSb3cgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgLy8gVE9ETzogY2hlY2sgaWYgaXQgc2hvdWxkIHRocm93IGhlcmUKICAgIGVsc2UgewogICAgICAgIHZhciBlID0gbmV3IEVycm9yKCdubyB2aWV3IHNwZWNpZmllZCcpOwogICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICBjYWxsYmFjayhlKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgfQp9OwoKLyoqCiAqIFJ1bnMgYSBsaXN0IGZ1bmN0aW9uIHdpdGggdGhlIGdpdmVuIGRvY3VtZW50IGFuZCByZXF1ZXN0IG9iamVjdCwKICogZW1pdHRpbmcgcmVsZXZhbnQgZXZlbnRzLiBUaGlzIGZ1bmN0aW9uIHJ1bnMgYm90aCBzZXJ2ZXIgYW5kIGNsaWVudC1zaWRlLgogKgogKiBAbmFtZSBydW5MaXN0KGZuLCBoZWFkLCByZXEpCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAqIEBwYXJhbSB7T2JqZWN0fSBoZWFkCiAqIEBwYXJhbSB7T2JqZWN0fSByZXEKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnJ1bkxpc3QgPSBmdW5jdGlvbiAoZm4sIGhlYWQsIHJlcSkgewogICAgcmVxID0gZmxhc2htZXNzYWdlcy51cGRhdGVSZXF1ZXN0KHJlcSk7CiAgICB1dGlscy5jdXJyZW50UmVxdWVzdChyZXEpOwogICAgdmFyIGluZm8gPSB7CiAgICAgICAgdHlwZTogJ2xpc3QnLAogICAgICAgIG5hbWU6IHJlcS5wYXRoWzFdLAogICAgICAgIHRhcmdldDogcmVxLnBhdGhbMl0sCiAgICAgICAgcXVlcnk6IHJlcS5xdWVyeSwKICAgICAgICBmbjogZm4KICAgIH07CiAgICAvLyBjYWNoZSByZXNwb25zZSBmcm9tIHN0YXJ0IGNhbGwKICAgIHZhciBzdGFydF9yZXM7CiAgICB2YXIgX3N0YXJ0ID0gc3RhcnQ7CiAgICBzdGFydCA9IGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBzdGFydF9yZXMgPSByZXM7CiAgICAgICAgZXZlbnRzLmVtaXQoJ2JlZm9yZVJlc3BvbnNlU3RhcnQnLCBpbmZvLCByZXEsIHJlcyk7CiAgICAgICAgaWYgKHJlcy5ib2R5KSB7CiAgICAgICAgICAgIGV2ZW50cy5lbWl0KCdiZWZvcmVSZXNwb25zZURhdGEnLCBpbmZvLCByZXEsIHJlcywgcmVzLmJvZHkpOwogICAgICAgIH0KICAgICAgICBfc3RhcnQoZmxhc2htZXNzYWdlcy51cGRhdGVSZXNwb25zZShyZXEsIHJlcykpOwogICAgfTsKICAgIHZhciBfc2VuZCA9IHNlbmQ7CiAgICBzZW5kID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICBpZiAoIXN0YXJ0X3Jlcy5ib2R5KSB7CiAgICAgICAgICAgIHN0YXJ0X3Jlcy5ib2R5ID0gJyc7CiAgICAgICAgfQogICAgICAgIC8vIFRPRE86IGRvZXMgaXQgbWFrZSBzZW5zZSB0byBzdG9yZSBkYXRhIGhlcmUgYW5kIHVzZSB1cCBtZW1vcnkKICAgICAgICAvLyBvbiB0aGUgc2VydmVyPwogICAgICAgIHN0YXJ0X3Jlcy5ib2R5ICs9IGRhdGE7CiAgICAgICAgZXZlbnRzLmVtaXQoJ2JlZm9yZVJlc3BvbnNlRGF0YScsIGluZm8sIHJlcSwgc3RhcnRfcmVzLCBkYXRhKTsKICAgICAgICBfc2VuZChkYXRhKTsKICAgIH07CiAgICBldmVudHMuZW1pdCgnYmVmb3JlUmVxdWVzdCcsIGluZm8sIHJlcSk7CiAgICB2YXIgdmFsID0gZm4oaGVhZCwgcmVxKTsKCiAgICBpZiAodmFsIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICAgICAgdmFsID0gZXhwb3J0cy5wYXJzZVJlc3BvbnNlKHJlcSwgdmFsKS5ib2R5OwogICAgfQogICAgaWYgKCFzdGFydF9yZXMpIHsKICAgICAgICBzdGFydF9yZXMgPSB7Y29kZTogMjAwLCBib2R5OiB2YWx9OwogICAgICAgIGV2ZW50cy5lbWl0KCdiZWZvcmVSZXNwb25zZVN0YXJ0JywgaW5mbywgcmVxLCBzdGFydF9yZXMpOwogICAgICAgIGV2ZW50cy5lbWl0KCdiZWZvcmVSZXNwb25zZURhdGEnLCBpbmZvLCByZXEsIHN0YXJ0X3JlcywgdmFsKTsKICAgICAgICBzdGFydCA9IF9zdGFydDsKICAgICAgICBzZW5kID0gX3NlbmQ7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBzdGFydF9yZXMuYm9keSA9IHN0YXJ0X3Jlcy5ib2R5ID8gc3RhcnRfcmVzLmJvZHkgKyB2YWw6IHZhbDsKICAgICAgICBldmVudHMuZW1pdCgnYmVmb3JlUmVzcG9uc2VEYXRhJywgaW5mbywgcmVxLCBzdGFydF9yZXMsIHZhbCk7CiAgICB9CiAgICBzdGFydCA9IF9zdGFydDsKICAgIHNlbmQgPSBfc2VuZDsKICAgIHJlcS5yZXNwb25zZV9yZWNlaXZlZCA9IHRydWU7CiAgICByZXR1cm4gdmFsOwp9OwoKCi8qKgogKiBDcmVhdGVzIGEgcmVxdWVzdCBvYmplY3QgZm9yIHRoZSB1cmwgYW5kIHJ1bnMgYXBwcm9wcmlhdGUgc2hvdywgbGlzdCBvcgogKiB1cGRhdGUgZnVuY3Rpb25zLgogKgogKiBAbmFtZSBoYW5kbGUobWV0aG9kLCB1cmwsIGRhdGEpCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRob2QKICogQHBhcmFtIHtTdHJpbmd9IHVybAogKiBAcGFyYW0ge09iamVjdH0gZGF0YQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuaGFuZGxlID0gZnVuY3Rpb24gKG1ldGhvZCwgdXJsLCBkYXRhKSB7CiAgICB2YXIgbWF0Y2ggPSBleHBvcnRzLm1hdGNoVVJMKG1ldGhvZCwgdXJsKTsKICAgIGlmIChtYXRjaCkgewogICAgICAgIHZhciBwYXJzZWQgPSB1cmxQYXJzZSh1cmwpOwogICAgICAgIGV4cG9ydHMuY3JlYXRlUmVxdWVzdChtZXRob2QsIHVybCwgZGF0YSwgbWF0Y2gsIGZ1bmN0aW9uIChlcnIsIHJlcSkgewogICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXEpOwoKICAgICAgICAgICAgdmFyIG1zZyA9IG1ldGhvZCArICcgJyArIHVybCArICcgLT4gJyArCiAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShyZXEucGF0aC5qb2luKCcvJykpICsgJyAnICsKICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHJlcS5xdWVyeSk7CgogICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgICAgbXNnICs9ICcgZGF0YTogJyArIEpTT04uc3RyaW5naWZ5KGRhdGEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpOwogICAgICAgICAgICB1dGlscy5jdXJyZW50UmVxdWVzdChyZXEpOwoKICAgICAgICAgICAgdmFyIGFmdGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKHBhcnNlZC5oYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gd2UgaGF2ZSB0byBoYW5kbGUgaW4tcGFnZSBhbmNob3JzIG1hbnVhbGx5IGJlY2F1c2Ugd2UndmUKICAgICAgICAgICAgICAgICAgICAvLyBoaWphY2tlZCB0aGUgaGFzaCBwYXJ0IG9mIHRoZSB1cmwKICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBkb24ndCByZS1oYW5kbGUgdGhlIHBhZ2UgaWYgb25seSB0aGUgaGFzaCBoYXMKICAgICAgICAgICAgICAgICAgICAvLyBjaGFuZ2VkCgogICAgICAgICAgICAgICAgICAgIC8vIHRlc3QgaWYgYSB2YWxpZCBlbGVtZW50IG5hbWUgb3IgaWQKICAgICAgICAgICAgICAgICAgICBpZiAoLyNbQS1aYS16X1wtOlwuXSsvLnRlc3QocGFyc2VkLmhhc2gpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbCA9ICQocGFyc2VkLmhhc2gpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWwubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgZWwub2Zmc2V0KCkudG9wKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJzZWQuaGFzaCA9PT0gJyMnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNjcm9sbCB0byB0b3Agb2YgcGFnZQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IGhhbmRsZSBpbnZhbGlkIHZhbHVlcz8KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBzcmMsIGZuLCBuYW1lOwoKICAgICAgICAgICAgaWYgKHJlcS5wYXRoWzBdID09PSAnX3Nob3cnKSB7CiAgICAgICAgICAgICAgICBleHBvcnRzLnJ1blNob3dCcm93c2VyKAogICAgICAgICAgICAgICAgICAgIHJlcSwgcmVxLnBhdGhbMV0sIHJlcS5wYXRoLnNsaWNlKDIpLmpvaW4oJy8nKSwgYWZ0ZXIKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAocmVxLnBhdGhbMF0gPT09ICdfbGlzdCcpIHsKICAgICAgICAgICAgICAgIGV4cG9ydHMucnVuTGlzdEJyb3dzZXIoCiAgICAgICAgICAgICAgICAgICAgcmVxLCByZXEucGF0aFsxXSwgcmVxLnBhdGguc2xpY2UoMikuam9pbignLycpLCBhZnRlcgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChyZXEucGF0aFswXSA9PT0gJ191cGRhdGUnKSB7CiAgICAgICAgICAgICAgICBleHBvcnRzLnJ1blVwZGF0ZUJyb3dzZXIoCiAgICAgICAgICAgICAgICAgICAgcmVxLCByZXEucGF0aFsxXSwgcmVxLnBhdGguc2xpY2UoMikuam9pbignLycpLCBhZnRlcgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdVbmtub3duIHJld3JpdGUgdGFyZ2V0OiAnICsgcmVxLnBhdGguam9pbignLycpKTsKICAgICAgICAgICAgICAgIHZhciBuZXd1cmwgPSBleHBvcnRzLmdldEJhc2VVUkwoKSArICcvX2RiL19kZXNpZ24vJyArCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MubmFtZSArICcvJyArIHJlcS5wYXRoLmpvaW4oJy8nKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZWRpcmVjdGluZyB0bzogJyArIG5ld3VybCk7CiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBuZXd1cmw7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZyhtZXRob2QgKyAnICcgKyB1cmwgKyAnIC0+IFs0MDRdJyk7CiAgICAgICAgd2luZG93LmxvY2F0aW9uID0gZXhwb3J0cy5nZXRCYXNlVVJMKCkgKyB1cmw7CiAgICB9CgogICAgLyoqCiAgICAgKiBpZiBnb29nbGUgYW5hbHl0aWNzIGlzIGluY2x1ZGVkIG9uIHRoZSBwYWdlLCBhbmQgdGhpcyB1cmwKICAgICAqIGhhcyBub3QgYmVlbiB0cmFja2VkIChub3QgdGhlIGluaXRpYWwgaGl0KSB0aGVuIG1hbnVhbGx5CiAgICAgKiB0cmFjayBhIHBhZ2Ugdmlldy4gVGhpcyBpcyBkb25lIGNvbnNpc3RlbnRseSBmb3IgaGFzaC1iYXNlZAogICAgICogYW5kIHB1c2hTdGF0ZSB1cmxzCiAgICAgKi8KICAgIGlmICh3aW5kb3cucGFnZVRyYWNrZXIgJiYgIXV0aWxzLmluaXRpYWxfaGl0KSB7CiAgICAgICAgcGFnZVRyYWNrZXIuX3RyYWNrUGFnZXZpZXcodXJsKTsKICAgIH0KICAgIHV0aWxzLmluaXRpYWxfaGl0ID0gZmFsc2U7Cn07CgoKLyoqCiAqIEFkZCBhIGhpc3RvcnkgZW50cnkgZm9yIHRoZSBnaXZlbiB1cmwsIHByZWZpeGVkIHdpdGggdGhlIGJhc2VVUkwgZm9yIHRoZSBhcHAuCiAqCiAqIEBuYW1lIHNldFVSTChtZXRob2QsIHVybCwgZGF0YSkKICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZAogKiBAcGFyYW0ge1N0cmluZ30gdXJsCiAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIChvcHRpb25hbCkKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnNldFVSTCA9IGZ1bmN0aW9uIChtZXRob2QsIHVybCwgZGF0YSkgewogICAgdmFyIGZ1bGx1cmwgPSBleHBvcnRzLmdldEJhc2VVUkwoKSArIHVybDsKICAgIHZhciBzdGF0ZSA9IHsKICAgICAgICBtZXRob2Q6IG1ldGhvZCwKICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS5nZXRUaW1lKCksCiAgICAgICAgaGlzdG9yeV9jb3VudDogd2luZG93Lmhpc3RvcnkubGVuZ3RoICsgMQogICAgfTsKICAgIC8vIHRoaXMgaXMgdGhlIHJlc3VsdCBvZiBhIGRpcmVjdCBjYWxsIHRvIHNldFVSTAogICAgLy8gKGRvbid0IHNob3cgY29uZmlybWF0aW9uIGRpYWxvZyBmb3IgdW5zYWZlIHN0YXRlcyBuZWVkaW5nIHRvIHJlLXN1Ym1pdCkKICAgIGV4cG9ydHMuc2V0X2NhbGxlZCA9IHRydWU7CgogICAgLyoqCiAgICAgKiBpZiB0aGUgY3VycmVudCByZXF1ZXN0IGlzIHVuc2FmZSwgd2UgcmVwbGFjZSBpdCBzbyBjbGlja2luZyB0aGUgYmFjawogICAgICogYnV0dG9uICdza2lwcycgaXQgd2l0aG91dCBzaG93aW5nIGEgZGlhbG9nLgogICAgICoKICAgICAqIFRoaXMgbWVhbnMgR0VUMSwgUE9TVDIsIEdFVDMgd291bGQgcmVzdWx0IGluIGEgaGlzdG9yeSBvZiBHRVQxLCBHRVQzLgogICAgICogQ2xpY2tpbmcgYmFjayBhZnRlciBHRVQzIHdvdWxkbid0IHJlLXN1Ym1pdCBhIGZvcm0uCiAgICAgKgogICAgICogRG9pbmcgR0VUMSwgUE9TVDIsIHRoZW4gY2xpY2tpbmcgYmFjayBhbmQgZm9yd2FyZCBhZ2FpbiB3b3VsZCByZXN1bHQKICAgICAqIGluIGEgY29uZmlybWF0aW9uIGRpYWxvZyBhc2tpbmcgaWYgeW91IHdhbnQgdG8gcmUtc3VibWl0LgogICAgICovCgogICAgdmFyIGN1cnJfc3RhdGUgPSBleHBvcnRzLmN1cnJlbnRfc3RhdGU7CiAgICB2YXIgY3Vycl9tZXRob2QgPSBjdXJyX3N0YXRlID8gKGN1cnJfc3RhdGUubWV0aG9kIHx8ICdHRVQnKTogJ0dFVCc7CgogICAgaWYgKGN1cnJfbWV0aG9kICE9PSAnR0VUJyAmJiBjdXJyX21ldGhvZCAhPT0gJ0hFQUQnKSB7CiAgICAgICAgLy8gdW5zYWZlIG1ldGhvZCBvbiBjdXJyZW50IHJlcXVlc3QsIHJlcGxhY2UgaXQKICAgICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoc3RhdGUsIGRvY3VtZW50LnRpdGxlLCBmdWxsdXJsKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIC8vIGxhc3QgcmVxdWVzdCB3YXMgc2FmZSwgYWRkIGEgbmV3IGVudHJ5IGluIHRoZSBoaXN0b3J5CiAgICAgICAgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHN0YXRlLCBkb2N1bWVudC50aXRsZSwgZnVsbHVybCk7CiAgICB9CiAgICAvLyBtYW51YWxseSBmaXJlIHBvcHN0YXRlIGV2ZW50CiAgICB3aW5kb3cub25wb3BzdGF0ZSh7c3RhdGU6IHN0YXRlfSk7Cn07CgoKLyoqCiAqIFRoaXMgd2FzIG1vdmVkIHRvIHV0aWxzIHRvIGF2b2lkIGEgY2lyY3VsYXIgZGVwZW5kZW5jeSBiZXR3ZWVuCiAqIGNvcmUuanMgYW5kIGRiLmpzLi4uIGhvd2V2ZXIsIGl0IHNob3VsZCBiZSBhY2Nlc3NlZCB2aWEgdGhlIGNvcmUuanMgbW9kdWxlCiAqIGFzIGl0IG1heSBnZXQgbW92ZWQgYmFjayBvbmNlIGNpcmN1bGFyIGRlcGVuZGVuY2llcyBhcmUgZml4ZWQgaW4gY291Y2hkYidzCiAqIGNvbW1vbmpzIGltcGxlbWVudGF0aW9uLgogKi8KCmV4cG9ydHMuZ2V0QmFzZVVSTCA9IHV0aWxzLmdldEJhc2VVUkw7CgoKLyoqCiAqIEdldHMgdGhlIGN1cnJlbnQgYXBwLWxldmVsIFVSTCAod2l0aG91dCBiYXNlVVJMIHByZWZpeCkuCiAqCiAqIEBuYW1lIGdldFVSTCgpCiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5nZXRVUkwgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKCdcXC9fcmV3cml0ZSguKikkJyk7CgogICAgdmFyIGxvYyA9IHVybFBhcnNlKHdpbmRvdy5sb2NhdGlvbiksCiAgICAgICAgbWF0Y2ggPSByZS5leGVjKGxvYy5wYXRobmFtZSk7CgogICAgaWYgKG1hdGNoKSB7CiAgICAgICAgdmFyIG5ld3VybCA9IHsKICAgICAgICAgICAgcGF0aG5hbWU6IG1hdGNoWzFdIHx8ICcvJywKICAgICAgICAgICAgaGFzaDogbG9jLmhhc2gKICAgICAgICB9OwogICAgICAgIGlmIChsb2Muc2VhcmNoKSB7CiAgICAgICAgICAgIG5ld3VybC5zZWFyY2ggPSBsb2Muc2VhcmNoOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdXJsRm9ybWF0KG5ld3VybCkgfHwgJy8nOwogICAgfQogICAgcmV0dXJuICcnICsgd2luZG93LmxvY2F0aW9uIHx8ICcvJzsKfTsKCi8qKgogKiBUZXN0cyBpcyB0d28gdXJscyBhcmUgb2YgdGhlIHNhbWUgb3JpZ2luLiBBY2NlcHRzIHBhcnNlZCB1cmwgb2JqZWN0cwogKiBvciBzdHJpbmdzIGFzIGFyZ3VtZW50cy4KICoKICogQG5hbWUgc2FtZU9yaWdpbihhLCBiKQogKiBAcGFyYW0gYQogKiBAcGFyYW0gYgogKiBAcmV0dXJucyBCb29sZWFuCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5zYW1lT3JpZ2luID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgIHZhciBhcCA9ICh0eXBlb2YgYSA9PT0gJ3N0cmluZycpID8gdXJsUGFyc2UoYSk6IGE7CiAgICB2YXIgYnAgPSAodHlwZW9mIGIgPT09ICdzdHJpbmcnKSA/IHVybFBhcnNlKGIpOiBiOwogICAgLy8gaWYgb25lIHVybCBpcyByZWxhdGl2ZSB0byBjdXJyZW50IG9yaWdpbiwgcmV0dXJuIHRydWUKICAgIGlmIChhcC5wcm90b2NvbCA9PT0gdW5kZWZpbmVkIHx8IGJwLnByb3RvY29sID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiAoCiAgICAgICAgYXAucHJvdG9jb2wgPT09IGJwLnByb3RvY29sICYmCiAgICAgICAgYXAuaG9zdG5hbWUgPT09IGJwLmhvc3RuYW1lICYmCiAgICAgICAgYXAucG9ydCA9PT0gYnAucG9ydAogICAgKTsKfTsKCi8qKgogKiBDb252ZXJ0cyBhIGZ1bGwgdXJsIHRvIGFuIGFwcC1sZXZlbCB1cmwgKHdpdGhvdXQgYmFzZVVSTCBwcmVmaXgpLgogKiBleGFtcGxlOiB7YmFzZVVSTH0vc29tZS9wYXRoIC0+IC9zb21lL3BhdGgKICoKICogQG5hbWUgYXBwUGF0aChwKQogKiBAcGFyYW0ge1N0cmluZ30gcAogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuYXBwUGF0aCA9IGZ1bmN0aW9uIChwKSB7CiAgICAvLyBoYXNoIGxpbmtzIG5lZWQgY3VycmVudCBVUkwgcHJlcGVuZGluZwogICAgaWYgKHAuY2hhckF0KDApID09PSAnIycpIHsKICAgICAgICB2YXIgbmV3dXJsID0gdXJsUGFyc2UoZXhwb3J0cy5nZXRVUkwoKSk7CiAgICAgICAgbmV3dXJsLmhhc2ggPSBwOwogICAgICAgIHJldHVybiBleHBvcnRzLmFwcFBhdGgodXJsRm9ybWF0KG5ld3VybCkpOwogICAgfQogICAgZWxzZSBpZiAocC5jaGFyQXQoMCkgPT09ICc/JykgewogICAgICAgIC8vIGlmIHRoZSByZXF1ZXN0IGlzIGp1c3QgYSBxdWVyeSwgdGhlbiBwcmVwZW5kIHRoZSBjdXJyZW50IGFwcCBwYXRoCiAgICAgICAgLy8gYXMgYSBicm93c2VyIHdvdWxkCiAgICAgICAgdmFyIG5ld3VybDIgPSB1cmxQYXJzZShleHBvcnRzLmdldFVSTCgpKTsKICAgICAgICBkZWxldGUgbmV3dXJsMi5xdWVyeTsKICAgICAgICBkZWxldGUgbmV3dXJsMi5zZWFyY2g7CiAgICAgICAgZGVsZXRlIG5ld3VybDIuaHJlZjsKICAgICAgICBuZXd1cmwyLnNlYXJjaCA9IHA7CiAgICAgICAgcmV0dXJuIGV4cG9ydHMuYXBwUGF0aCh1cmxGb3JtYXQobmV3dXJsMikpOwogICAgfQogICAgZWxzZSBpZiAoL1x3KzovLnRlc3QocCkpIHsKICAgICAgICAvLyBpbmNsdWRlIHByb3RvY29sCiAgICAgICAgdmFyIG9yaWdpbiA9IHAuc3BsaXQoJy8nKS5zbGljZSgwLCAzKS5qb2luKCcvJyk7CiAgICAgICAgLy8gY29lcmNlIHdpbmRvdy5sb2NhdGlvbiB0byBhIHJlYWwgc3RyaW5nIHNvIHdlIGNhbiB1c2Ugc3BsaXQgaW4gSUUKICAgICAgICB2YXIgbG9jID0gJycgKyB3aW5kb3cubG9jYXRpb247CiAgICAgICAgaWYgKG9yaWdpbiA9PT0gbG9jLnNwbGl0KCcvJykuc2xpY2UoMCwgMykuam9pbignLycpKSB7CiAgICAgICAgICAgIC8vIHJlbW92ZSBvcmlnaW4sIHNldCBwIHRvIHBhdGhuYW1lIG9ubHkKICAgICAgICAgICAgLy8gSUUgb2Z0ZW4gYWRkcyB0aGlzIHRvIGEgdGFncywgaGVuY2Ugd2h5IHdlIHN0cmlwIGl0IG91dCBub3cKICAgICAgICAgICAgcCA9IHAuc3Vic3RyKG9yaWdpbi5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gbm90IHNhbWUgb3JpZ2luLCByZXR1cm4gb3JpZ2luYWwgZnVsbCBwYXRoCiAgICAgICAgICAgIHJldHVybiBwOwogICAgICAgIH0KICAgIH0KICAgIHZhciBiYXNlID0gZXhwb3J0cy5nZXRCYXNlVVJMKCk7CiAgICBpZiAocC5zdWJzdHIoMCwgYmFzZS5sZW5ndGgpID09PSBiYXNlKSB7CiAgICAgICAgcmV0dXJuIHAuc3Vic3RyKGJhc2UubGVuZ3RoKTsKICAgIH0KICAgIHJldHVybiBwOwp9OwoKCi8qKgogKiBVc2VkIHRvIGRlY2lkZSB3aGV0aGVyIHRvIGhhbmRsZSBhIGxpbmsgb3Igbm90LiBTaG91bGQgZGV0ZWN0IGFwcCB2cy4KICogZXh0ZXJuYWwgdXJscy4KICoKICogQG5hbWUgaXNBcHBVUkwodXJsKQogKiBAcGFyYW0ge1N0cmluZ30gdXJsCiAqIEByZXR1cm5zIHtCb29sZWFufQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuaXNBcHBVUkwgPSBmdW5jdGlvbiAodXJsKSB7CiAgICAvLyBjb2VyY2Ugd2luZG93LmxvY2F0aW9uIHRvIGEgcmVhbCBzdHJpbmcgaW4gSUUKICAgIHJldHVybiBleHBvcnRzLnNhbWVPcmlnaW4odXJsLCAnJyArIHdpbmRvdy5sb2NhdGlvbik7Cn07CgoKfSl9OwoKLyoqKioqKioqKioga2Fuc28vZXZlbnRzICoqKioqKioqKiovCgprYW5zby5tb2R1bGVDYWNoZVsia2Fuc28vZXZlbnRzIl0gPSB7bG9hZDogKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUpIHsKCi8qZ2xvYmFsIF9fa2Fuc29qc19ldmVudF9saXN0ZW5lcnM6IHRydWUqLwoKLyoqCiAqIFRoZSBldmVudHMgbW9kdWxlIGhhbmRsZXMgZXZlbnRzIGVtaXR0ZWQgYnkgS2Fuc28gYXMgd2VsbCBhcyBjdXN0b20KICogZXZlbnRzIGRlZmluZWQgYnkgYSBLYW5zbyBhcHAuIFRoZXNlIGV2ZW50cyBjYW4gYmUgdXNlZCBjbGllbnQtc2lkZQogKiBvciBzZXJ2ZXItc2lkZS4gQWx0aG91Z2ggeW91IGFyZSBsaW1pdGVkIHRvIHN5bmNocm9ub3VzIG9wZXJhdGlvbiBvbgogKiB0aGUgc2VydmVyLCBzbyBldmVudHMgYXJlIGxlc3MgbGlrZWx5IHRvIGJlIHVzZWZ1bCB0aGVyZS4KICoKICogQG1vZHVsZQogKi8KCi8qKgogKiBNb2R1bGUgZGVwZW5kZW5jaWVzCiAqLwoKdmFyIF8gPSByZXF1aXJlKCcuL3VuZGVyc2NvcmUnKS5fOwoKCi8qKgogKiBTdG9yZXMgdGhlIGJvdW5kIGxpc3RlbmVycwogKgogKiBUaGVzZSBtdXN0IGJlIHN0b3JlZCBpbiBhIGdsb2JhbCBzaW5jZSB0aGUgZm9ybXMgY29kZSBmaXJlcyBzb21lIGV2ZW50cyB1c2luZwogKiBzY3JpcHQgdGFncywgd2hpY2ggd2lsbCBmYWlsIHRvIHJlZmVyZW5jZSB0aGUgbGlzdGVuZXJzIG9iamVjdCBpZiBhIGxvY2FsIHZhcgogKiBpcyB1c2VkLgogKgogKiBXZSB0ZXN0IGZvciBhIHByZS1leGlzdGluZyBnbG9iYWwgYXMgYWRtaW4gYXBwIG1pZ2h0IHJlcXVpcmUgdGhpcyBtb2R1bGUKICogaW4gbXVsdGlwbGUgY29udGV4dHMsIGFuZCB3ZSBkb24ndCB3YW50IHRvIGxvc2UgcHJldmlvdXMgZXZlbnQgbGlzdGVuZXJzLgogKi8KCmlmICh0eXBlb2YgX19rYW5zb2pzX2V2ZW50X2xpc3RlbmVycyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgIF9fa2Fuc29qc19ldmVudF9saXN0ZW5lcnMgPSB7fTsKfQoKCi8qKgogKiBBZGRzIGEgbGlzdGVuZXIgZnVuY3Rpb24gZm9yIHRoZSBnaXZlbiBldmVudCBuYW1lLgogKgogKiBAbmFtZSBvbihuYW1lLCBsaXN0ZW5lcikKICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLm9uID0gZnVuY3Rpb24gKG5hbWUsIGxpc3RlbmVyKSB7CiAgICBpZiAoIV9fa2Fuc29qc19ldmVudF9saXN0ZW5lcnNbbmFtZV0pIHsKICAgICAgICBfX2thbnNvanNfZXZlbnRfbGlzdGVuZXJzW25hbWVdID0gW107CiAgICB9CiAgICBfX2thbnNvanNfZXZlbnRfbGlzdGVuZXJzW25hbWVdLnB1c2gobGlzdGVuZXIpOwp9OwoKLyoqCiAqIEJpbmRzIGFuIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBnaXZlbiBldmVudCBuYW1lLCBidXQgdW5iaW5kcyBpdAogKiBhZnRlciBpdHMgZmlyc3QgaW52b2NhdGlvbi4KICoKICogQG5hbWUgb25jZShuYW1lLCBsaXN0ZW5lcikKICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLm9uY2UgPSBmdW5jdGlvbiAobmFtZSwgbGlzdGVuZXIpIHsKICAgIHZhciBmbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gbGlzdGVuZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICBleHBvcnRzLnJlbW92ZUxpc3RlbmVyKG5hbWUsIGxpc3RlbmVyKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICAgIGZuLmxpc3RlbmVyID0gbGlzdGVuZXI7CiAgICBleHBvcnRzLm9uKG5hbWUsIGZuKTsKfTsKCi8qKgogKiBUcmlnZ2VycyBhbnkgZXZlbnQgbGlzdGVuZXJzIGJvdW5kIHRvIHRoZSBnaXZlbiBldmVudCBuYW1lLiBMaXN0ZW5lcnMKICogYXJlIGNhbGxlZCBpbiB0aGUgb3JkZXIgdGhleSB3ZXJlIGJvdW5kLiBJZiBhIGxpc3RlbmVyIHJldHVybnMgZmFsc2UKICogc3Vic2VxdWVudCBldmVudCBsaXN0ZW5lcnMgaW4gdGhlIGNoYWluIGFyZSBub3QgY2FsbGVkLgogKgogKiBUaGUgZmlyc3QgYXJndW1lbnQgaXMgdGhlIGV2ZW50IG5hbWUgdG8gZW1pdCBhbnkgYWRkaXRpb25hbCBhcmd1bWVudHMKICogYXJlIHVzZWQgYXMgYXJndW1lbnRzIHRvIHRoZSBib3VuZCBldmVudCBsaXN0ZW5lcnMuCiAqCiAqIEBuYW1lIGVtaXQobmFtZSwgWy4uLl0pCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAqIEBwYXJhbSAuLi4KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmVtaXQgPSBmdW5jdGlvbiAobmFtZSkgewogICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgdmFyIGZucyA9IGV4cG9ydHMubGlzdGVuZXJzKG5hbWUpOwogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGZucy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIHZhciByZXN1bHQgPSBmbnNbaV0uYXBwbHkobnVsbCwgYXJncyk7CiAgICAgICAgaWYgKHJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KfTsKCi8qKgogKiBSZXR1cm5zIGFuIGFycmF5IG9mIHRoZSBib3VuZCBldmVudCBsaXN0ZW5lcnMgZm9yIHRoZSBnaXZlbiBldmVudCBuYW1lLgogKiBJZiBubyBldmVudHMgYXJlIGJvdW5kLCBhbiBlbXB0eSBhcnJheSBpcyByZXR1cm5lZC4KICoKICogQG5hbWUgbGlzdGVuZXJzKG5hbWUpCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAqIEByZXR1cm5zIHtBcnJheX0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmxpc3RlbmVycyA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICB2YXIgZm5zID0gX19rYW5zb2pzX2V2ZW50X2xpc3RlbmVyc1tuYW1lXSB8fCBbXTsKICAgIHJldHVybiBfX2thbnNvanNfZXZlbnRfbGlzdGVuZXJzW25hbWVdIHx8IFtdOwp9OwoKLyoqCiAqIFJlbW92ZXMgYWxsIGJvdW5kIGV2ZW50IGxpc3RlbmVycyBmb3IgYSBnaXZlbiBldmVudCBuYW1lLgogKgogKiBAbmFtZSByZW1vdmVBbGxMaXN0ZW5lcnMobmFtZSkKICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnJlbW92ZUFsbExpc3RlbmVycyA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICBkZWxldGUgX19rYW5zb2pzX2V2ZW50X2xpc3RlbmVyc1tuYW1lXTsKfTsKCi8qKgogKiBSZW1vdmVzIGEgc3BlY2lmaWMgZXZlbnQgbGlzdGVuZXIgZm9yIGEgZ2l2ZW4gZXZlbnQgbmFtZS4KICoKICogQG5hbWUgcmVtb3ZlTGlzdGVuZXIobmFtZSwgbGlzdGVuZXIpCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAqIEBwYXJhbSB7RnVuY3Rpb259IGxpc3RlbmVyCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5yZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uIChuYW1lLCBsaXN0ZW5lcikgewogICAgX19rYW5zb2pzX2V2ZW50X2xpc3RlbmVyc1tuYW1lXSA9IF8uZmlsdGVyKGV4cG9ydHMubGlzdGVuZXJzKG5hbWUpLCBmdW5jdGlvbiAobCkgewogICAgICAgIHJldHVybiBsICE9PSBsaXN0ZW5lciAmJiAoIWwubGlzdGVuZXIgfHwgbC5saXN0ZW5lciAhPT0gbGlzdGVuZXIpOwogICAgfSk7Cn07CgoKfSl9OwoKLyoqKioqKioqKioga2Fuc28vZGIgKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJrYW5zby9kYiJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKmdsb2JhbCAkOiBmYWxzZSwga2Fuc286IHRydWUgKi8KCi8qKgogKiBDb250YWlucyBmdW5jdGlvbnMgZm9yIHF1ZXJ5aW5nIGFuZCBzdG9yaW5nIGRhdGEgaW4gQ291Y2hEQi4KICoKICogQG1vZHVsZQogKi8KCgovKioKICogTW9kdWxlIGRlcGVuZGVuY2llcwogKi8KCnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMnKSwKICAgIHNldHRpbmdzID0gcmVxdWlyZSgnLi9zZXR0aW5ncycpLAogICAgc2Vzc2lvbiA9IG51bGw7CgovKiBBdm9pZCBhIGNpcmN1bGFyIHJlcXVpcmUgaW4gQ291Y2hEQiAqLwoKaWYgKHV0aWxzLmlzQnJvd3NlcikgewogICAgc2Vzc2lvbiA9IHJlcXVpcmUoJy4vc2Vzc2lvbicpOwp9CgoKLyoqCiAqIFdoZW4gYSBkYiBjYWxsIHJlc3VsdHMgaW4gYW4gdW5hdXRob3JpemVkIHJlc3BvbnNlLCB0aGUgdXNlcidzIHNlc3Npb24gaXMKICogY2hlY2tlZCB0byBzZWUgaWYgdGhlaXIgc2Vzc2lvbiBoYXMgdGltZWQgb3V0IG9yIHRoZXkndmUgbG9nZ2VkIG91dCBpbgogKiBhbm90aGVyIHNjcmVlbi4KICoKICogVGhpcyBjaGVjayBpcyB0aHJvdHRsZWQgdG8gb25jZSBwZXIgc2Vjb25kLCB0byBhdm9pZCBmbG9vZGluZyB0aGUgc2VydmVyIGlmCiAqIG11bHRpcGxlIHJlcXVlc3RzIGFyZSBtYWRlIHdpdGggaW5jb3JyZWN0IHBlcm1pc3Npb25zLgogKi8KCnZhciBsYXN0X3Nlc3Npb25fY2hlY2sgPSAwOwoKCi8qKgogKiBDYWNoZSBmb3IgZGVzaWduIGRvY3VtZW50cyBmZXRjaGVkIHZpYSBnZXREZXNpZ25Eb2MuCiAqLwoKZXhwb3J0cy5kZXNpZ25fZG9jcyA9IHt9OwoKCi8qKgogKiBUYWtlbiBmcm9tIGpRdWVyeSAxLjQuNCBzbyB3ZSBjYW4gc3VwcG9ydCBtb3JlIHJlY2VudCB2ZXJzaW9ucyBvZiBqUXVlcnkuCiAqLwoKdmFyIGh0dHBEYXRhID0gZnVuY3Rpb24gKHhociwgdHlwZSwgcykgewogICAgdmFyIGN0ID0geGhyLmdldFJlc3BvbnNlSGVhZGVyKCJjb250ZW50LXR5cGUiKSB8fCAiIiwKICAgICAgICB4bWwgPSB0eXBlID09PSAieG1sIiB8fCAhdHlwZSAmJiBjdC5pbmRleE9mKCJ4bWwiKSA+PSAwLAogICAgICAgIGRhdGEgPSB4bWwgPyB4aHIucmVzcG9uc2VYTUwgOiB4aHIucmVzcG9uc2VUZXh0OwoKICAgIGlmICh4bWwgJiYgZGF0YS5kb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgPT09ICJwYXJzZXJlcnJvciIpIHsKICAgICAgICAkLmVycm9yKCJwYXJzZXJlcnJvciIpOwogICAgfQogICAgaWYgKHMgJiYgcy5kYXRhRmlsdGVyKSB7CiAgICAgICAgZGF0YSA9IHMuZGF0YUZpbHRlcihkYXRhLCB0eXBlKTsKICAgIH0KICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIpIHsKICAgICAgICBpZiAodHlwZSA9PT0gImpzb24iIHx8ICF0eXBlICYmIGN0LmluZGV4T2YoImpzb24iKSA+PSAwKSB7CiAgICAgICAgICAgIGRhdGEgPSAkLnBhcnNlSlNPTihkYXRhKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gInNjcmlwdCIgfHwgIXR5cGUgJiYgY3QuaW5kZXhPZigiamF2YXNjcmlwdCIpID49IDApIHsKICAgICAgICAgICAgJC5nbG9iYWxFdmFsKGRhdGEpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBkYXRhOwp9OwoKCi8qKgogKiBSZXR1cm5zIGEgZnVuY3Rpb24gZm9yIGhhbmRsaW5nIGFqYXggcmVzcG9uc2VkIGZyb20ganF1ZXJ5IGFuZCBjYWxscwogKiB0aGUgY2FsbGJhY2sgd2l0aCB0aGUgZGF0YSBvciBhcHByb3ByaWF0ZSBlcnJvci4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwcml2YXRlCiAqLwoKZnVuY3Rpb24gb25Db21wbGV0ZShvcHRpb25zLCBjYWxsYmFjaykgewogICAgcmV0dXJuIGZ1bmN0aW9uIChyZXEpIHsKICAgICAgICB2YXIgcmVzcDsKICAgICAgICB2YXIgY3R5cGUgPSByZXEuZ2V0UmVzcG9uc2VIZWFkZXIoJ0NvbnRlbnQtVHlwZScpOwogICAgICAgIGlmIChjdHlwZSA9PT0gJ2FwcGxpY2F0aW9uL2pzb24nIHx8IGN0eXBlID09PSAndGV4dC9qc29uJykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmVzcCA9IGh0dHBEYXRhKHJlcSwgImpzb24iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiAob3B0aW9ucy5leHBlY3RfanNvbikgewogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKAogICAgICAgICAgICAgICAgICAgIG5ldyBFcnJvcignRXhwZWN0ZWQgSlNPTiByZXNwb25zZSwgZ290ICcgKyBjdHlwZSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzcCA9IHJlcS5yZXNwb25zZVRleHQ7CiAgICAgICAgfQogICAgICAgIGlmIChyZXEuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgICAgLy8gcmV0dXJuZWQgJ1VuYXV0aG9yaXplZCcsIGNoZWNrIHRoZSB1c2VyJ3Mgc2Vzc2lvbiBpZiBpdCdzIG5vdAogICAgICAgICAgICAvLyBiZWVuIGNoZWNrZWQgb24gYW4gJ1VuYXV0aG9yaXplZCcgcmVwc29uc2UgaW4gdGhlIGxhc3Qgc2Vjb25kCiAgICAgICAgICAgIGlmIChzZXNzaW9uICYmIGxhc3Rfc2Vzc2lvbl9jaGVjayA8IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gMTAwMCkgewogICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmZvKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT09IDIwMCB8fCByZXEuc3RhdHVzID09PSAyMDEgfHwgcmVxLnN0YXR1cyA9PT0gMjAyKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3ApOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChyZXNwLmVycm9yKSB7CiAgICAgICAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IocmVzcC5yZWFzb24gfHwgcmVzcC5lcnJvcik7CiAgICAgICAgICAgIGVyci5lcnJvciA9IHJlc3AuZXJyb3I7CiAgICAgICAgICAgIGVyci5yZWFzb24gPSByZXNwLnJlYXNvbjsKICAgICAgICAgICAgZXJyLnN0YXR1cyA9IHJlcS5zdGF0dXM7CiAgICAgICAgICAgIGNhbGxiYWNrKGVycik7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBUT0RPOiBtYXAgc3RhdHVzIGNvZGUgdG8gbWVhbmluZ2Z1bCBlcnJvciBtZXNzYWdlCiAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcignUmV0dXJuZWQgc3RhdHVzIGNvZGU6ICcgKyByZXEuc3RhdHVzKSk7CiAgICAgICAgfQogICAgfTsKfQoKLyoqCiAqIEVuY29kZXMgYSBkb2N1bWVudCBpZCBvciB2aWV3LCBsaXN0IG9yIHNob3cgbmFtZS4KICoKICogQG5hbWUgZW5jb2RlKHN0cikKICogQHBhcmFtIHtTdHJpbmd9IHN0cgogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuZW5jb2RlID0gZnVuY3Rpb24gKHN0cikgewogICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChzdHIpLnJlcGxhY2UoL15fZGVzaWduJTJGLywgJ19kZXNpZ24vJyk7Cn07CgoKLyoqCiAqIE1ha2UgYSByZXF1ZXN0LCB3aXRoIHNvbWUgZGVmYXVsdCBzZXR0aW5ncyBhbmQgcHJvcGVyIGNhbGxiYWNrCiAqIGhhbmRsaW5nLiBVc2VkIGJlaGluZC10aGUtc2NlbmVzIGJ5IG1vc3Qgb3RoZXIgREIgbW9kdWxlIGZ1bmN0aW9ucy4KICoKICogQG5hbWUgcmVxdWVzdChvcHRpb25zLCBjYWxsYmFjaykKICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnJlcXVlc3QgPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHsKICAgIG9wdGlvbnMuY29tcGxldGUgPSBvbkNvbXBsZXRlKG9wdGlvbnMsIGNhbGxiYWNrKTsKICAgIG9wdGlvbnMuZGF0YVR5cGUgPSAnanNvbic7CiAgICAkLmFqYXgob3B0aW9ucyk7Cn07CgoKLyoqCiAqIEZldGNoZXMgYSByZXdyaXRlIGZyb20gdGhlIGRhdGFiYXNlIHRoZSBhcHAgaXMgcnVubmluZyBvbi4gUmVzdWx0cwogKiBhcmUgcGFzc2VkIHRvIHRoZSBjYWxsYmFjaywgd2l0aCB0aGUgZmlyc3QgYXJndW1lbnQgb2YgdGhlIGNhbGxiYWNrCiAqIHJlc2VydmVkIGZvciBhbnkgZXhjZXB0aW9ucyB0aGF0IG9jY3VycmVkIChub2RlLmpzIHN0eWxlKS4KICoKICogQG5hbWUgZ2V0UmV3cml0ZShwYXRoLCBbcV0sIGNhbGxiYWNrKQogKiBAcGFyYW0ge1N0cmluZ30gcGF0aAogKiBAcGFyYW0ge09iamVjdH0gcSAob3B0aW9uYWwpCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5nZXRSZXdyaXRlID0gZnVuY3Rpb24gKHBhdGgsIC8qb3B0aW9uYWwqL3EsIGNhbGxiYWNrKSB7CiAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdnZXRSZXdyaXRlIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgIH0KICAgIGlmICghY2FsbGJhY2spIHsKICAgICAgICBjYWxsYmFjayA9IHE7CiAgICAgICAgcSA9IHt9OwogICAgfQogICAgLy8gcHJlcGVuZCBmb3J3YXJkLXNsYXNoIGlmIG1pc3NpbmcKICAgIHBhdGggPSAocGF0aFswXSA9PT0gJy8nKSA/IHBhdGg6ICcvJyArIHBhdGg7CgogICAgdmFyIGJhc2UgPSB1dGlscy5nZXRCYXNlVVJMKCk7CiAgICB2YXIgbmFtZSA9IGV4cG9ydHMuZW5jb2RlKHNldHRpbmdzLm5hbWUpOwogICAgdmFyIHJlcSA9IHsKICAgICAgICB1cmw6IGJhc2UgKyAnL19kYi9fZGVzaWduLycgKyBuYW1lICsgJy9fcmV3cml0ZScgKyBwYXRoLAogICAgICAgIGRhdGE6IGV4cG9ydHMuc3RyaW5naWZ5UXVlcnkocSkKICAgIH07CiAgICBleHBvcnRzLnJlcXVlc3QocmVxLCBjYWxsYmFjayk7Cn07CgoKLyoqCiAqIEZldGNoZXMgYSBkb2N1bWVudCBmcm9tIHRoZSBkYXRhYmFzZSB0aGUgYXBwIGlzIHJ1bm5pbmcgb24uIFJlc3VsdHMgYXJlCiAqIHBhc3NlZCB0byB0aGUgY2FsbGJhY2ssIHdpdGggdGhlIGZpcnN0IGFyZ3VtZW50IG9mIHRoZSBjYWxsYmFjayByZXNlcnZlZAogKiBmb3IgYW55IGV4Y2VwdGlvbnMgdGhhdCBvY2N1cnJlZCAobm9kZS5qcyBzdHlsZSkuCiAqCiAqIEBuYW1lIGdldERvYyhpZCwgW3EsIG9wdGlvbnNdLCBjYWxsYmFjaykKICogQHBhcmFtIHtTdHJpbmd9IGlkCiAqIEBwYXJhbSB7T2JqZWN0fSBxIChvcHRpb25hbCkKICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgKG9wdGlvbmFsKQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuZ2V0RG9jID0gZnVuY3Rpb24gKGlkLCAvKm9wdGlvbmFsKi9xLCAvKm9wdGlvbmFsKi9vcHRpb25zLCBjYWxsYmFjaykgewogICAgaWYgKCF1dGlscy5pc0Jyb3dzZXIoKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignZ2V0RG9jIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgIH0KICAgIGlmICghaWQpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2dldERvYyByZXF1aXJlcyBhbiBpZCBwYXJhbWV0ZXIgdG8gd29yayBwcm9wZXJseScpOwogICAgfQogICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgIGlmICghb3B0aW9ucykgewogICAgICAgICAgICAvKiBBcml0eSA9IDI6IE9taXRzIHEsIG9wdGlvbnMgKi8KICAgICAgICAgICAgY2FsbGJhY2sgPSBxOwogICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIHEgPSB7fTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLyogQXJpdHkgPSAzOiBPbWl0cyBvcHRpb25zICovCiAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9uczsKICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgIH0KICAgIH0KICAgIHZhciB1cmw7CiAgICBpZiAob3B0aW9ucy5kYikgewogICAgICAgIC8qIEZvcmNlIGxlYWRpbmcgc2xhc2g7IG1ha2UgYWJzb2x1dGUgcGF0aCAqLwogICAgICAgIHVybCA9IChvcHRpb25zLmRiLnN1YnN0cigwLCAxKSAhPT0gJy8nID8gJy8nIDogJycpICsgb3B0aW9ucy5kYjsKICAgIH0gZWxzZSB7CiAgICAgICAgdXJsID0gdXRpbHMuZ2V0QmFzZVVSTCgpICsgJy9fZGInOwogICAgfQogICAgdmFyIHJlcSA9IHsKICAgICAgICB1cmw6IHVybCArICcvJyArIGV4cG9ydHMuZW5jb2RlKGlkKSwKICAgICAgICBkYXRhOiBleHBvcnRzLnN0cmluZ2lmeVF1ZXJ5KHEpLAogICAgICAgIGV4cGVjdF9qc29uOiB0cnVlCiAgICB9OwogICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgY2FsbGJhY2spOwp9OwoKCi8qKgogKiBTYXZlcyBhIGRvY3VtZW50IHRvIHRoZSBkYXRhYmFzZSB0aGUgYXBwIGlzIHJ1bm5pbmcgb24uIFJlc3VsdHMgYXJlCiAqIHBhc3NlZCB0byB0aGUgY2FsbGJhY2ssIHdpdGggdGhlIGZpcnN0IGFyZ3VtZW50IG9mIHRoZSBjYWxsYmFjayByZXNlcnZlZAogKiBmb3IgYW55IGV4Y2VwdGlvbnMgdGhhdCBvY2N1cnJlZCAobm9kZS5qcyBzdHlsZSkuCiAqCiAqIEBuYW1lIHNhdmVEb2MoZG9jLCBbb3B0aW9uc10sIGNhbGxiYWNrKQogKiBAcGFyYW0ge09iamVjdH0gZG9jCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIChvcHRpb25hbCkKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnNhdmVEb2MgPSBmdW5jdGlvbiAoZG9jLCAvKm9wdGlvbmFsKi9vcHRpb25zLCBjYWxsYmFjaykgewogICAgaWYgKCF1dGlscy5pc0Jyb3dzZXIoKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignc2F2ZURvYyBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICB9CiAgICB2YXIgbWV0aG9kLCB1cmw7CiAgICBpZiAob3B0aW9ucy5kYikgewogICAgICAgIC8qIEZvcmNlIGxlYWRpbmcgc2xhc2g7IG1ha2UgYWJzb2x1dGUgcGF0aCAqLwogICAgICAgIHVybCA9IChvcHRpb25zLmRiLnN1YnN0cigwLCAxKSAhPT0gJy8nID8gJy8nIDogJycpICsgb3B0aW9ucy5kYjsKICAgIH0gZWxzZSB7CiAgICAgICAgdXJsID0gdXRpbHMuZ2V0QmFzZVVSTCgpICsgJy9fZGInOwogICAgfQogICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgIC8qIEFyaXR5ID0gMjogT21pdHMgb3B0aW9ucyAqLwogICAgICAgIGNhbGxiYWNrID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICB9CiAgICBpZiAoZG9jLl9pZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbWV0aG9kID0gIlBPU1QiOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbWV0aG9kID0gIlBVVCI7CiAgICAgICAgdXJsICs9ICcvJyArIGRvYy5faWQ7CiAgICB9CiAgICB2YXIgcmVxID0gewogICAgICAgIHR5cGU6IG1ldGhvZCwKICAgICAgICB1cmw6IHVybCwKICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShkb2MpLAogICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSwKICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgIGV4cGVjdF9qc29uOiB0cnVlCiAgICB9OwogICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgY2FsbGJhY2spOwp9OwoKLyoqCiAqIERlbGV0ZXMgYSBkb2N1bWVudCBmcm9tIHRoZSBkYXRhYmFzZSB0aGUgYXBwIGlzIHJ1bm5pbmcgb24uIFJlc3VsdHMgYXJlCiAqIHBhc3NlZCB0byB0aGUgY2FsbGJhY2ssIHdpdGggdGhlIGZpcnN0IGFyZ3VtZW50IG9mIHRoZSBjYWxsYmFjayByZXNlcnZlZAogKiBmb3IgYW55IGV4Y2VwdGlvbnMgdGhhdCBvY2N1cnJlZCAobm9kZS5qcyBzdHlsZSkuCiAqCiAqIEBuYW1lIHJlbW92ZURvYyhkb2MsIFtvcHRpb25zXSwgY2FsbGJhY2spCiAqIEBwYXJhbSB7T2JqZWN0fSBkb2MKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnJlbW92ZURvYyA9IGZ1bmN0aW9uIChkb2MsIC8qb3B0aW9uYWwqL29wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdyZW1vdmVEb2MgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpOwogICAgfQogICAgaWYgKCFkb2MuX2lkKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdyZW1vdmVEb2MgcmVxdWlyZXMgYW4gX2lkIGZpZWxkIGluIHlvdXIgZG9jdW1lbnQnKTsKICAgIH0KICAgIGlmICghZG9jLl9yZXYpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlbW92ZURvYyByZXF1aXJlcyBhIF9yZXYgZmllbGQgaW4geW91ciBkb2N1bWVudCcpOwogICAgfQogICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgIC8qIEFyaXR5ID0gMjogT21pdHMgb3B0aW9ucyAqLwogICAgICAgIGNhbGxiYWNrID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICB9CiAgICB2YXIgdXJsOwogICAgaWYgKG9wdGlvbnMuZGIpIHsKICAgICAgICAvKiBGb3JjZSBsZWFkaW5nIHNsYXNoOyBtYWtlIGFic29sdXRlIHBhdGggKi8KICAgICAgICB1cmwgPSAob3B0aW9ucy5kYi5zdWJzdHIoMCwgMSkgIT09ICcvJyA/ICcvJyA6ICcnKSArIG9wdGlvbnMuZGIgKyAnLyc7CiAgICB9IGVsc2UgewogICAgICAgIHVybCA9IHV0aWxzLmdldEJhc2VVUkwoKSArICcvX2RiLyc7CiAgICB9CiAgICB1cmwgKz0gZXhwb3J0cy5lbmNvZGUoZG9jLl9pZCkgKyAnP3Jldj0nICsgZXhwb3J0cy5lbmNvZGUoZG9jLl9yZXYpOwogICAgdmFyIHJlcSA9IHsKICAgICAgICB0eXBlOiAnREVMRVRFJywKICAgICAgICB1cmw6IHVybAogICAgfTsKICAgIGV4cG9ydHMucmVxdWVzdChyZXEsIGNhbGxiYWNrKTsKfTsKCgovKioKICogRmV0Y2hlcyBhIHZpZXcgZnJvbSB0aGUgZGF0YWJhc2UgdGhlIGFwcCBpcyBydW5uaW5nIG9uLiBSZXN1bHRzIGFyZQogKiBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrLCB3aXRoIHRoZSBmaXJzdCBhcmd1bWVudCBvZiB0aGUgY2FsbGJhY2sgcmVzZXJ2ZWQKICogZm9yIGFueSBleGNlcHRpb25zIHRoYXQgb2NjdXJyZWQgKG5vZGUuanMgc3R5bGUpLgogKgogKiBAbmFtZSBnZXRWaWV3KHZpZXcsIFtxXSwgY2FsbGJhY2spCiAqIEBwYXJhbSB7U3RyaW5nfSB2aWV3CiAqIEBwYXJhbSB7T2JqZWN0fSBxIChvcHRpb25hbCkKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmdldFZpZXcgPSBmdW5jdGlvbiAodmlldywgLypvcHRpb25hbCovcSwgLypvcHRpb25hbCovb3B0aW9ucywgY2FsbGJhY2spIHsKICAgIGlmICghdXRpbHMuaXNCcm93c2VyKCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2dldFZpZXcgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpOwogICAgfQogICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgIGlmICghb3B0aW9ucykgewogICAgICAgICAgICAvKiBBcml0eSA9IDI6IE9taXRzIHEsIG9wdGlvbnMgKi8KICAgICAgICAgICAgY2FsbGJhY2sgPSBxOwogICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIHEgPSB7fTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLyogQXJpdHkgPSAzOiBPbWl0cyBvcHRpb25zICovCiAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9uczsKICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgIH0KICAgIH0KICAgIHZhciBiYXNlOwogICAgaWYgKG9wdGlvbnMuZGIpIHsKICAgICAgICAvKiBGb3JjZSBsZWFkaW5nIHNsYXNoOyBtYWtlIGFic29sdXRlIHBhdGggKi8KICAgICAgICBiYXNlID0gKG9wdGlvbnMuZGIuc3Vic3RyKDAsIDEpICE9PSAnLycgPyAnLycgOiAnJykgKyBvcHRpb25zLmRiOwogICAgfSBlbHNlIHsKICAgICAgICBiYXNlID0gdXRpbHMuZ2V0QmFzZVVSTCgpOwogICAgfQogICAgdmFyIG5hbWUgPSBleHBvcnRzLmVuY29kZShzZXR0aW5ncy5uYW1lKTsKICAgIHZhciB2aWV3bmFtZSA9IGV4cG9ydHMuZW5jb2RlKHZpZXcpOwogICAgdmFyIHJlcSA9IHsKICAgICAgICB1cmw6ICgKICAgICAgICAgICAgYmFzZSArIChvcHRpb25zLmRiID8gJycgOiAnL19kYicpICsgJy9fZGVzaWduLycgKwogICAgICAgICAgICAgICAgKG9wdGlvbnMuZGIgfHwgbmFtZSkgKyAnL192aWV3LycgKyB2aWV3bmFtZQogICAgICAgICksCiAgICAgICAgZGF0YTogZXhwb3J0cy5zdHJpbmdpZnlRdWVyeShxKSwKICAgICAgICBleHBlY3RfanNvbjogdHJ1ZQogICAgfTsKICAgIGV4cG9ydHMucmVxdWVzdChyZXEsIGNhbGxiYWNrKTsKfTsKCgovKioKICogVHJhbnNmb3JtcyBhbmQgZmV0Y2hlcyBhIHZpZXcgdGhyb3VnaCBhIGxpc3QgZnJvbSB0aGUgZGF0YWJhc2UgdGhlIGFwcAogKiBpcyBydW5uaW5nIG9uLiBSZXN1bHRzIGFyZSBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrLCB3aXRoIHRoZSBmaXJzdAogKiBhcmd1bWVudCBvZiB0aGUgY2FsbGJhY2sgcmVzZXJ2ZWQgZm9yIGFueSBleGNlcHRpb25zIHRoYXQgb2NjdXJyZWQKICogKG5vZGUuanMgc3R5bGUpLgogKgogKiBAbmFtZSBnZXRMaXN0KGxpc3QsIHZpZXcsIFtxXSwgY2FsbGJhY2spCiAqIEBwYXJhbSB7U3RyaW5nfSBsaXN0CiAqIEBwYXJhbSB7U3RyaW5nfSB2aWV3CiAqIEBwYXJhbSB7T2JqZWN0fSBxIChvcHRpb25hbCkKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwdWJsaWMKICovCgovLyBUT0RPOiBydW4gbGlzdCBmdW5jdGlvbiBjbGllbnQtc2lkZT8KZXhwb3J0cy5nZXRMaXN0ID0gZnVuY3Rpb24gKGxpc3QsIHZpZXcsIC8qb3B0aW9uYWwqL3EsIGNhbGxiYWNrKSB7CiAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdnZXRMaXN0IGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgIH0KICAgIGlmICghY2FsbGJhY2spIHsKICAgICAgICBjYWxsYmFjayA9IHE7CiAgICAgICAgcSA9IHt9OwogICAgfQogICAgdmFyIGJhc2UgPSB1dGlscy5nZXRCYXNlVVJMKCk7CiAgICB2YXIgbmFtZSA9IGV4cG9ydHMuZW5jb2RlKHNldHRpbmdzLm5hbWUpOwogICAgdmFyIGxpc3RuYW1lID0gZXhwb3J0cy5lbmNvZGUobGlzdCk7CiAgICB2YXIgdmlld25hbWUgPSBleHBvcnRzLmVuY29kZSh2aWV3KTsKICAgIHZhciByZXEgPSB7CiAgICAgICAgdXJsOiBiYXNlICsgJy9fZGIvX2Rlc2lnbi8nICsgbmFtZSArICcvX2xpc3QvJyArIGxpc3RuYW1lICsKICAgICAgICAgICAgICcvJyArIHZpZXduYW1lLAogICAgICAgIGRhdGE6IGV4cG9ydHMuc3RyaW5naWZ5UXVlcnkocSkKICAgIH07CiAgICBleHBvcnRzLnJlcXVlc3QocmVxLCBjYWxsYmFjayk7Cn07CgovKioKICogVHJhbnNmb3JtcyBhbmQgZmV0Y2hlcyBhIGRvY3VtZW50IHRocm91Z2ggYSBzaG93IGZyb20gdGhlIGRhdGFiYXNlIHRoZSBhcHAKICogaXMgcnVubmluZyBvbi4gUmVzdWx0cyBhcmUgcGFzc2VkIHRvIHRoZSBjYWxsYmFjaywgd2l0aCB0aGUgZmlyc3QKICogYXJndW1lbnQgb2YgdGhlIGNhbGxiYWNrIHJlc2VydmVkIGZvciBhbnkgZXhjZXB0aW9ucyB0aGF0IG9jY3VycmVkCiAqIChub2RlLmpzIHN0eWxlKS4KICoKICogQG5hbWUgZ2V0U2hvdyhzaG93LCBkb2NpZCwgW3FdLCBjYWxsYmFjaykKICogQHBhcmFtIHtTdHJpbmd9IHNob3cKICogQHBhcmFtIHtTdHJpbmd9IGRvY2lkCiAqIEBwYXJhbSB7T2JqZWN0fSBxIChvcHRpb25hbCkKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwdWJsaWMKICovCgovLyBUT0RPOiBydW4gc2hvdyBmdW5jdGlvbiBjbGllbnQtc2lkZT8KZXhwb3J0cy5nZXRTaG93ID0gZnVuY3Rpb24gKHNob3csIGRvY2lkLCAvKm9wdGlvbmFsKi9xLCBjYWxsYmFjaykgewogICAgaWYgKCF1dGlscy5pc0Jyb3dzZXIoKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignZ2V0U2hvdyBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICB9CiAgICBpZiAoIWNhbGxiYWNrKSB7CiAgICAgICAgY2FsbGJhY2sgPSBxOwogICAgICAgIHEgPSB7fTsKICAgIH0KICAgIHZhciBiYXNlID0gdXRpbHMuZ2V0QmFzZVVSTCgpOwogICAgdmFyIG5hbWUgPSBleHBvcnRzLmVuY29kZShzZXR0aW5ncy5uYW1lKTsKICAgIHZhciBzaG93bmFtZSA9IGV4cG9ydHMuZW5jb2RlKHNob3cpOwogICAgdmFyIHNob3dfdXJsID0gYmFzZSArICcvX2RiL19kZXNpZ24vJyArIG5hbWUgKyAnL19zaG93LycgKyBzaG93bmFtZTsKICAgIHZhciByZXEgPSB7CiAgICAgICAgdXJsOiBzaG93X3VybCArIChkb2NpZCA/ICcvJyArIGV4cG9ydHMuZW5jb2RlKGRvY2lkKTogJycpLAogICAgICAgIGRhdGE6IGV4cG9ydHMuc3RyaW5naWZ5UXVlcnkocSkKICAgIH07CiAgICBleHBvcnRzLnJlcXVlc3QocmVxLCBjYWxsYmFjayk7Cn07CgoKLyoqCiAqIEdldCBhbGwgZG9jdW1lbnRzIChpbmNsdWRpbmcgZGVzaWduIGRvY3MpLgogKgogKiBAbmFtZSBhbGwoW3FdLCBjYWxsYmFjaykKICogQHBhcmFtIHtPYmplY3R9IHEgKG9wdGlvbmFsKQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuYWxsID0gZnVuY3Rpb24gKC8qb3B0aW9uYWwqL3EsIGNhbGxiYWNrKSB7CiAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdhbGwgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpOwogICAgfQogICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgIGNhbGxiYWNrID0gcTsKICAgICAgICBxID0ge307CiAgICB9CiAgICB2YXIgYmFzZSA9IHV0aWxzLmdldEJhc2VVUkwoKTsKICAgIHZhciByZXEgPSB7CiAgICAgICAgdXJsOiBiYXNlICsgJy9fZGIvX2FsbF9kb2NzJywKICAgICAgICBkYXRhOiBleHBvcnRzLnN0cmluZ2lmeVF1ZXJ5KHEpLAogICAgICAgIGV4cGVjdF9qc29uOiB0cnVlCiAgICB9OwogICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgY2FsbGJhY2spOwp9OwoKCi8qKgogKiBQcm9wZXJseSBlbmNvZGVzIHF1ZXJ5IHBhcmFtZXRlcnMgdG8gQ291Y2hEQiB2aWV3cyBldGMuIEhhbmRsZSBjb21wbGV4CiAqIGtleXMgYW5kIG90aGVyIG5vbi1zdHJpbmcgcGFyYW1ldGVycyBieSBwYXNzaW5nIHRocm91Z2ggSlNPTi5zdHJpbmdpZnkuCiAqIFJldHVybnMgYSBzaGFsbG93LWNvcGllZCBjbG9uZSBvZiB0aGUgb3JpZ2luYWwgcXVlcnkgYWZ0ZXIgY29tcGxleCB2YWx1ZXMKICogaGF2ZSBiZWVuIHN0cmluZ2lmaWVkLgogKgogKiBAbmFtZSBzdHJpbmdpZnlRdWVyeShxdWVyeSkKICogQHBhcmFtIHtPYmplY3R9IHF1ZXJ5CiAqIEByZXR1cm5zIHtPYmplY3R9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5zdHJpbmdpZnlRdWVyeSA9IGZ1bmN0aW9uIChxdWVyeSkgewogICAgdmFyIHEgPSB7fTsKICAgIGZvciAodmFyIGsgaW4gcXVlcnkpIHsKICAgICAgICBpZiAodHlwZW9mIHF1ZXJ5W2tdICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICBxW2tdID0gSlNPTi5zdHJpbmdpZnkocXVlcnlba10pOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcVtrXSA9IHF1ZXJ5W2tdOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBxOwp9OwoKCi8qKgogKiBSZXR1cm5zIGEgbmV3IFVVSUQgZ2VuZXJhdGVkIGJ5IENvdWNoREIuIEl0cyBwb3NzaWJsZSB0byBjYWNoZQogKiBtdWx0aXBsZSBVVUlEcyBmb3IgbGF0ZXIgdXNlLCB0byBhdm9pZCBtYWtpbmcgdG9vIG1hbnkgcmVxdWVzdHMuCiAqCiAqIEBuYW1lIG5ld1VVSUQoY2FjaGVOdW0sIGNhbGxiYWNrKQogKiBAcGFyYW0ge051bWJlcn0gY2FjaGVOdW0gKG9wdGlvbmFsLCBkZWZhdWx0OiAxKQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogKiBAYXBpIHB1YmxpYwogKi8KCnZhciB1dWlkQ2FjaGUgPSBbXTsKCmV4cG9ydHMubmV3VVVJRCA9IGZ1bmN0aW9uIChjYWNoZU51bSwgY2FsbGJhY2spIHsKICAgIGlmICghdXRpbHMuaXNCcm93c2VyKCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ25ld1VVSUQgY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpOwogICAgfQogICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgIGNhbGxiYWNrID0gY2FjaGVOdW07CiAgICAgICAgY2FjaGVOdW0gPSAxOwogICAgfQogICAgaWYgKHV1aWRDYWNoZS5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgdXVpZENhY2hlLnNoaWZ0KCkpOwogICAgfQogICAgdmFyIGJhc2UgPSB1dGlscy5nZXRCYXNlVVJMKCk7CiAgICB2YXIgcmVxID0gewogICAgICAgIHVybDogJy9fdXVpZHMnLAogICAgICAgIGRhdGE6IHtjb3VudDogY2FjaGVOdW19LAogICAgICAgIGV4cGVjdF9qc29uOiB0cnVlCiAgICB9OwogICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgZnVuY3Rpb24gKGVyciwgcmVzcCkgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7CiAgICAgICAgfQogICAgICAgIHV1aWRDYWNoZSA9IHJlc3AudXVpZHM7CiAgICAgICAgY2FsbGJhY2sobnVsbCwgdXVpZENhY2hlLnNoaWZ0KCkpOwogICAgfSk7Cn07CgovKioKICogQ3JlYXRlcyBhIENvdWNoREIgZGF0YWJhc2UuCiAqCiAqIElmIHlvdSdyZSBydW5uaW5nIGJlaGluZCBhIHZpcnR1YWwgaG9zdCB5b3UnbGwgbmVlZCB0byBzZXQgdXAKICogYXBwcm9wcmlhdGUgcmV3cml0ZXMgZm9yIGEgUFVUIHJlcXVlc3QgdG8gJy8nIGFuZCB0dXJuIG9mZiBzYWZlIHJld3JpdGVzLgogKgogKiBAbmFtZSBjcmVhdGVEYXRhYmFzZShuYW1lLCBjYWxsYmFjaykKICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmNyZWF0ZURhdGFiYXNlID0gZnVuY3Rpb24gKG5hbWUsIGNhbGxiYWNrKSB7CiAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjcmVhdGVEYXRhYmFzZSBjYW5ub3QgYmUgY2FsbGVkIHNlcnZlci1zaWRlJyk7CiAgICB9CiAgICB2YXIgcmVxID0gewogICAgICAgIHR5cGU6ICdQVVQnLAogICAgICAgIHVybDogJy8nICsgZXhwb3J0cy5lbmNvZGUobmFtZS5yZXBsYWNlKC9eXC8rLywgJycpKQogICAgfTsKICAgIGV4cG9ydHMucmVxdWVzdChyZXEsIGNhbGxiYWNrKTsKfTsKCi8qKgogKiBEZWxldGVzIGEgQ291Y2hEQiBkYXRhYmFzZS4KICoKICogSWYgeW91J3JlIHJ1bm5pbmcgYmVoaW5kIGEgdmlydHVhbCBob3N0IHlvdSdsbCBuZWVkIHRvIHNldCB1cAogKiBhcHByb3ByaWF0ZSByZXdyaXRlcyBmb3IgYSBERUxFVEUgcmVxdWVzdCB0byAnLycgYW5kIHR1cm4gb2ZmIHNhZmUgcmV3cml0ZXMuCiAqCiAqIEBuYW1lIGRlbGV0ZURhdGFiYXNlKG5hbWUsIGNhbGxiYWNrKQogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuZGVsZXRlRGF0YWJhc2UgPSBmdW5jdGlvbiAobmFtZSwgY2FsbGJhY2spIHsKICAgIGlmICghdXRpbHMuaXNCcm93c2VyKCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2RlbGV0ZURhdGFiYXNlIGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgIH0KICAgIHZhciByZXEgPSB7CiAgICAgICAgdHlwZTogJ0RFTEVURScsCiAgICAgICAgdXJsOiAnLycgKyBleHBvcnRzLmVuY29kZShuYW1lLnJlcGxhY2UoL15cLysvLCAnJykpCiAgICB9OwogICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgY2FsbGJhY2spOwp9OwoKCi8qKgogKiBGZXRjaGVzIHRoZSBtb3N0IHJlY2VudCByZXZpc2lvbiBvZiB0aGUgcmVwbGljYXRpb24gZG9jdW1lbnQKICogcmVmZXJyZWQgdG8gYnkgdGhlIGlkIHBhcmFtZXRlci4KICoKICogSWYgeW91J3JlIHJ1bm5pbmcgYmVoaW5kIGEgdmlydHVhbCBob3N0IHlvdSdsbCBuZWVkIHRvIHNldCB1cAogKiBhcHByb3ByaWF0ZSByZXdyaXRlcyB0byAvX3JlcGxpY2F0b3IsIHdoaWNoIHdpbGwgYWxzbyBtZWFuIHR1cm5pbmcKICogb2ZmIHNhZmUgcmV3cml0ZXMuCiAqCiAqIFRoaXMgZnVuY3Rpb24gb25seSB3b3JrcyB3aXRoIENvdWNoREIgPj0gMS4xLCBzaW5jZSBpdCB1c2VzIHRoZQogKiBfcmVwbGljYXRvciBkYXRhYmFzZS4KICoKICogQG5hbWUgZ2V0UmVwbGljYXRpb24oaWQsIGNhbGxiYWNrKQogKiBAcGFyYW0ge1N0cmluZ30gaWQKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmdldFJlcGxpY2F0aW9uID0gZnVuY3Rpb24gKGlkLCBjYWxsYmFjaykgewogICAgaWYgKCF1dGlscy5pc0Jyb3dzZXIoKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignZ2V0UmVwbGljYXRpb24gY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpOwogICAgfQogICAgdmFyIHJlcSA9IHsKICAgICAgICB1cmw6ICcvX3JlcGxpY2F0b3IvJyArIGV4cG9ydHMuZW5jb2RlKGlkKSwKICAgICAgICBjYWNoZTogZmFsc2UgLyogV29yayBhcm91bmQgSUU3IGlzc3VlICovCiAgICB9OwogICAgZXhwb3J0cy5yZXF1ZXN0KHJlcSwgY2FsbGJhY2spOwp9OwoKLyoqCiAqIFJlcGxpY2F0ZXMgb3B0aW9ucy5zb3VyY2UgdG8gb3B0aW9ucy50YXJnZXQuIFRoZSBzdHJpbmdzCiAqIG9wdGlvbnMuc291cmNlIGFuZCBvcHRpb25zLnRhcmdldCBhcmUgZWFjaCBlaXRoZXIgYQogKiBDb3VjaERCIGRhdGFiYXNlIG5hbWUgb3IgYSBDb3VjaERCIGRhdGFiYXNlIFVSSS4KICoKICogSWYgeW91J3JlIHJ1bm5pbmcgYmVoaW5kIGEgdmlydHVhbCBob3N0IHlvdSdsbCBuZWVkIHRvIHNldCB1cAogKiBhcHByb3ByaWF0ZSByZXdyaXRlcyB0byAvX3JlcGxpY2F0b3IsIHdoaWNoIHdpbGwgYWxzbyBtZWFuIHR1cm5pbmcKICogb2ZmIHNhZmUgcmV3cml0ZXMuCiAqCiAqIFRoaXMgZnVuY3Rpb24gb25seSB3b3JrcyB3aXRoIENvdWNoREIgPj0gMS4xLCBzaW5jZSBpdCB1c2VzIHRoZQogKiBfcmVwbGljYXRvciBkYXRhYmFzZS4KICoKICogQG5hbWUgc3RhcnRSZXBsaWNhdGlvbihvcHRpb25zLCBjYWxsYmFjaykKICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnN0YXJ0UmVwbGljYXRpb24gPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHsKICAgIGlmICghdXRpbHMuaXNCcm93c2VyKCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3N0YXJ0UmVwbGljYXRpb24gY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpOwogICAgfQogICAgaWYgKCFvcHRpb25zLnNvdXJjZSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignc291cmNlIHBhcmFtZXRlciBtdXN0IGJlIHByb3ZpZGVkJyk7CiAgICB9CiAgICBpZiAoIW9wdGlvbnMudGFyZ2V0KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd0YXJnZXQgcGFyYW1ldGVyIG11c3QgYmUgcHJvdmlkZWQnKTsKICAgIH0KICAgIHZhciByZXEgPSB7CiAgICAgICAgdHlwZTogJ1BPU1QnLAogICAgICAgIHVybDogJy9fcmVwbGljYXRvcicsCiAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkob3B0aW9ucyksCiAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJwogICAgfTsKICAgIGV4cG9ydHMucmVxdWVzdChyZXEsIGNhbGxiYWNrKTsKfTsKCi8qKgogKiBXYWl0cyBmb3IgYSByZXBsaWNhdGlvbiBvcGVyYXRpb24gdG8gZW50ZXIgYSBzcGVjaWZpYyBzdGF0ZS4KICogd2FpdFJlcGxpY2F0aW9uIHBvbGxzIHRoZSBfcmVwbGljYXRpb24gZGF0YWJhc2UgdXNpbmcgdGhlCiAqIGRvYyBwcm92aWRlZCwgYW5kIGV2YWx1YXRlcyBzdGF0ZV9mdW5jdGlvbihkb2MpIGF0IGVhY2ggaXRlcmF0aW9uLgogKiBUaGlzIGZ1bmN0aW9uIHN0b3BzIHBvbGxpbmcgYW5kIGludm9rZXMgY2FsbGJhY2sgd2hlbiB0aGUKICogc3RhdGVfZnVuY3Rpb24gZXZhbHVhdGVzIHRvIHRydWUuIElmIHN0YXRlX2Z1bmN0aW9uIGlzIG5vdAogKiBwcm92aWRlZCwgd2FpdFJlcGxpY2F0aW9uIHdhaXRzIGZvciB0aGUgZG9jJ3MgX3JlcGxpY2F0aW9uX3N0YXRlCiAqIHRvIGNoYW5nZSBmcm9tICd0cmlnZ2VyZWQnIHRvICdjb21wbGV0ZWQnIChvciAnZXJyb3InKS4KICoKICogSWYgeW91J3JlIHJ1bm5pbmcgYmVoaW5kIGEgdmlydHVhbCBob3N0IHlvdSdsbCBuZWVkIHRvIHNldCB1cAogKiBhcHByb3ByaWF0ZSByZXdyaXRlcyB0byAvX3JlcGxpY2F0b3IsIHdoaWNoIHdpbGwgYWxzbyBtZWFuIHR1cm5pbmcKICogb2ZmIHNhZmUgcmV3cml0ZXMuCiAqCiAqIFRoaXMgZnVuY3Rpb24gb25seSB3b3JrcyB3aXRoIENvdWNoREIgPj0gMS4xLCBzaW5jZSBpdCB1c2VzIHRoZQogKiBfcmVwbGljYXRvciBkYXRhYmFzZS4KICoKICogQG5hbWUgd2FpdFJlcGxpY2F0aW9uKGRvYywgW29wdGlvbnMsIHN0YXRlX2Z1bmN0aW9uXSwgY2FsbGJhY2spCiAqIEBwYXJhbSB7T2JqZWN0fSBkb2MKICogQHBhcmFtIHtGdW5jdGlvbn0gc3RhdGVfZnVuY3Rpb24gKG9wdGlvbmFsKQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMud2FpdFJlcGxpY2F0aW9uID0gZnVuY3Rpb24gKGRvYywgLypvcHRpb25hbCovb3B0aW9ucywgLypvcHRpb25hbCovc3RhdGVfZnVuY3Rpb24sIGNhbGxiYWNrKSB7CiAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd3YWl0UmVwbGljYXRpb24gY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpOwogICAgfQogICAgdmFyIGRlZmF1bHRfc3RhdGVfZnVuY3Rpb24gPSBmdW5jdGlvbiAocmVjZW50X2RvYywgaW5pdGlhbF9kb2MpIHsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgcmVjZW50X2RvYy5fcmVwbGljYXRpb25fc3RhdGUgPT09ICdjb21wbGV0ZWQnIHx8CiAgICAgICAgICAgICAgcmVjZW50X2RvYy5fcmVwbGljYXRpb25fc3RhdGUgPT09ICdlcnJvcicKICAgICAgICApOwogICAgfTsKICAgIGlmICghY2FsbGJhY2spIHsKICAgICAgICBpZiAoIXN0YXRlX2Z1bmN0aW9uKSB7CiAgICAgICAgICAgIC8qIEFyaXR5ID0gMjogZG9jLCBjYWxsYmFjayAqLwogICAgICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnM7CiAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgc3RhdGVfZnVuY3Rpb24gPSBkZWZhdWx0X3N0YXRlX2Z1bmN0aW9uOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8qIEFyaXR5ID0gMzogZG9jLCBvcHRpb25zLCBjYWxsYmFjayAqLwogICAgICAgICAgICBjYWxsYmFjayA9IHN0YXRlX2Z1bmN0aW9uOwogICAgICAgICAgICBzdGF0ZV9mdW5jdGlvbiA9IGRlZmF1bHRfc3RhdGVfZnVuY3Rpb247CiAgICAgICAgfQogICAgfQogICAgaWYgKG9wdGlvbnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgIH0KICAgIGlmIChvcHRpb25zLmxpbWl0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICBvcHRpb25zLmxpbWl0ID0gMTAwOyAvKiB0aW1lcyAqLwogICAgfQogICAgaWYgKG9wdGlvbnMuZGVsYXkgPT09IHVuZGVmaW5lZCkgewogICAgICAgIG9wdGlvbnMuZGVsYXkgPSAyMDAwOyAvKiBtcyAqLwogICAgfQoKICAgIC8qIEZldGNoIGxhdGVzdCByZXZpc2lvbiAqLwogICAgZXhwb3J0cy5nZXRSZXBsaWNhdGlvbihkb2MuaWQsIGZ1bmN0aW9uIChlcnIsIHJ2KSB7CgogICAgICAgIC8qIENoZWNrIGZvciBlcnJvciwgdGhlbiBmb3IgYW4gaW50ZXJlc3RpbmcgZXZlbnQgKi8KICAgICAgICBpZiAoZXJyIHx8IHN0YXRlX2Z1bmN0aW9uKHJ2LCBkb2MpKSB7CiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIsIHJ2LCBkb2MpOwogICAgICAgIH0KICAgICAgICAvKiBUZXJtaW5hdGlvbiBjb25kaXRpb24gZm9yIHJlY3Vyc2lvbi4uLiAqLwogICAgICAgIGlmIChvcHRpb25zLmxpbWl0ID4gMCkgewoKICAgICAgICAgICAgLyogLi4ud2l0aCB3ZWxsLWRlZmluZWQgcHJvZ3Jlc3MgdG93YXJkIGl0ICovCiAgICAgICAgICAgIG9wdGlvbnMubGltaXQgLT0gMTsKCiAgICAgICAgICAgIC8qIEdvIGFyb3VuZCAqLwogICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZXhwb3J0cy53YWl0UmVwbGljYXRpb24oCiAgICAgICAgICAgICAgICAgICAgZG9jLCBvcHRpb25zLCBzdGF0ZV9mdW5jdGlvbiwgY2FsbGJhY2sKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0sIG9wdGlvbnMuZGVsYXkpOwogICAgICAgIH0KICAgIH0pOwp9OwoKLyoqCiAqIFN0b3BzIGEgcmVwbGljYXRpb24gb3BlcmF0aW9uIGFscmVhZHkgaW4gcHJvZ3Jlc3MuCiAqIFRoZSBkb2MgcGFyYW1ldGVyIGNhbiBiZSBvYnRhaW5lZCBieSBjYWxsaW5nIGdldFJlcGxpY2F0aW9uLgogKgogKiBJZiB5b3UncmUgcnVubmluZyBiZWhpbmQgYSB2aXJ0dWFsIGhvc3QgeW91J2xsIG5lZWQgdG8gc2V0IHVwCiAqIGFwcHJvcHJpYXRlIHJld3JpdGVzIHRvIC9fcmVwbGljYXRvciwgd2hpY2ggd2lsbCBhbHNvIG1lYW4gdHVybmluZwogKiBvZmYgc2FmZSByZXdyaXRlcy4KICoKICogVGhpcyBmdW5jdGlvbiBvbmx5IHdvcmtzIHdpdGggQ291Y2hEQiA+PSAxLjEsIHNpbmNlIGl0IHVzZXMgdGhlCiAqIF9yZXBsaWNhdG9yIGRhdGFiYXNlLgogKgogKiBAbmFtZSBzdG9wUmVwbGljYXRpb24oZG9jLCBjYWxsYmFjaywgW29wdGlvbnNdKQogKiBAcGFyYW0ge1N0cmluZ30gaWQKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQHBhcmFtIHtGdW5jdGlvbn0gb3B0aW9ucwogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuc3RvcFJlcGxpY2F0aW9uID0gZnVuY3Rpb24gKGRvYywgY2FsbGJhY2ssIC8qb3B0aW9uYWwqL29wdGlvbnMpIHsKCiAgICBpZiAoIXV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzdG9wUmVwbGljYXRpb24gY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpOwogICAgfQoKICAgIGlmIChvcHRpb25zID09PSB1bmRlZmluZWQpIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICB9CiAgICBpZiAob3B0aW9ucy5saW1pdCA9PT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMubGltaXQgPT09IG51bGwpIHsKICAgICAgICBvcHRpb25zLmxpbWl0ID0gMzsgLyogdGltZXMgKi8KICAgIH0KICAgIGlmIChvcHRpb25zLmRlbGF5ID09PSB1bmRlZmluZWQgfHwgb3B0aW9ucy5kZWxheSA9PT0gbnVsbCkgewogICAgICAgIG9wdGlvbnMuZGVsYXkgPSA1MDA7IC8qIG1zICovCiAgICB9CgogICAgdmFyIHJlcSA9IHsKICAgICAgICB0eXBlOiAnREVMRVRFJywKICAgICAgICB1cmw6ICcvX3JlcGxpY2F0b3IvJyArCiAgICAgICAgICBleHBvcnRzLmVuY29kZShkb2MuX2lkKSArCiAgICAgICAgICAnP3Jldj0nICsgZXhwb3J0cy5lbmNvZGUoZG9jLl9yZXYpCiAgICB9OwoKICAgIGV4cG9ydHMucmVxdWVzdChyZXEsIGZ1bmN0aW9uIChlcnIsIHJ2KSB7CgogICAgICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1cyA9PT0gNDA5KSB7ICAvKiBEb2N1bWVudCB1cGRhdGUgY29uZmxpY3QgKi8KCiAgICAgICAgICAgIC8qIFJhY2UgY29uZGl0aW9uOgogICAgICAgICAgICAgICAgVGhlIENvdWNoREIgcmVwbGljYXRpb24gZmluaXNoZWQgKG9yIHdhcyB1cGRhdGVkKSBiZXR3ZWVuCiAgICAgICAgICAgICAgICB0aGUgY2FsbGVyJ3MgZ2V0UmVwbGljYXRpb24gYW5kIG5vdy4gU3ViamVjdCB0byByZXN0cmljdGlvbnMKICAgICAgICAgICAgICAgIGluIG9wdGlvbnMsIGNhbGwgZ2V0UmVwbGljYXRpb24gYW5kIHRoZW4gdHJ5IGFnYWluLiAqLwoKICAgICAgICAgICAgLyogVGVybWluYXRpb24gY29uZGl0aW9uIGZvciByZWN1cnNpb24uLi4gKi8KICAgICAgICAgICAgaWYgKG9wdGlvbnMubGltaXQgPiAwKSB7CgogICAgICAgICAgICAgICAgLyogLi4ud2l0aCB3ZWxsLWRlZmluZWQgcHJvZ3Jlc3MgdG93YXJkIGl0ICovCiAgICAgICAgICAgICAgICBvcHRpb25zLmxpbWl0IC09IDE7CgogICAgICAgICAgICAgICAgcmV0dXJuIGV4cG9ydHMuZ2V0UmVwbGljYXRpb24oZG9jLl9pZCwgZnVuY3Rpb24gKGUsIGQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgICAgJ1RoZSBzcGVjaWZpZWQgcmVwbGljYXRpb24gZG9jdW1lbnQgY2hhbmdlZCAnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAnc2luY2UgbGFzdCByZWFkLCBhbmQgd2UgZmFpbGVkIHRvIHJlLXJlcXVlc3QgaXQnCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8qIEdvIGFyb3VuZCAqLwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5zdG9wUmVwbGljYXRpb24oZCwgY2FsbGJhY2ssIG9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMuZGVsYXkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgIC8qIE5vcm1hbCBjYXNlOgogICAgICAgICAgICAgICAgUmVwbGljYXRpb24gZG9jdW1lbnQgd2FzIG5vdCBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0CiAgICAgICAgICAgICAgICByZWFkOyBnbyBhaGVhZCBhbmQgaW52b2tlIHRoZSBjYWxsYmFjayBhbmQgcmV0dXJuLiAqLwoKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVyciwgcnYpOwogICAgICAgIH0KCiAgICAgICAgLyogTm90IHJlYWNoZWQgKi8KICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgfSk7Cgp9OwoKLyoqCiAqIERlbGV0ZXMgYW4gZXhpc3RpbmcgdXNlciBkb2N1bWVudCwgZ2l2ZW4gaXRzIHVzZXJuYW1lLiBZb3UKICogbXVzdCBiZSBsb2dnZWQgaW4gYXMgYW4gYWRtaW5pc3RyYXRpdmUgdXNlciBmb3IgdGhpcyBmdW5jdGlvbgogKiB0byBzdWNjZWVkLgogKgogKiBAbmFtZSBkZWxldGVVc2VyKHVzZXJuYW1lLCBjYWxsYmFjaykKICogQHBhcmFtIHtTdHJpbmd9IHVzZXJuYW1lCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5kZWxldGVVc2VyID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBjYWxsYmFjaykgewogICAgdmFyIGlkID0gJ29yZy5jb3VjaGRiLnVzZXI6JyArIHVzZXJuYW1lOwoKICAgIGV4cG9ydHMudXNlckRiKGZ1bmN0aW9uIChlcnIsIHVzZXJkYikgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7CiAgICAgICAgfQogICAgICAgIHZhciByZXEgPSB7CiAgICAgICAgICAgIHR5cGU6ICdERUxFVEUnLAogICAgICAgICAgICB1cmw6ICcvJyArIGV4cG9ydHMuZW5jb2RlKHVzZXJkYikgKyAnLycgKyBleHBvcnRzLmVuY29kZShpZCksCiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicKICAgICAgICB9OwogICAgICAgIGV4cG9ydHMucmVxdWVzdChyZXEsIGNhbGxiYWNrKTsKICAgIH0pOwp9OwoKLyoqCiAqIEZldGNoIGEgZGVzaWduIGRvY3VtZW50IGZyb20gQ291Y2hEQi4gQnkgZGVmYXVsdCwgdGhlCiAqIHJlc3VsdHMgb2YgdGhpcyBmdW5jdGlvbiBhcmUgY2FjaGVkIHdpdGhpbiB0aGUgamF2YXNjcmlwdAogKiBlbmdpbmUuIFRvIGF2b2lkIHRoaXMsIHBhc3MgdHJ1ZSBmb3IgdGhlIG5vX2NhY2hlIGFyZ3VtZW50LgogKgogKiBAbmFtZSBnZXREZXNpZ25Eb2MobmFtZSwgY2FsbGJhY2ssIG5vX2NhY2hlKQogKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiAoaS5lLiBwYXRoIHRvKSB0aGUgZGVzaWduIGRvY3VtZW50LgogKiBAcGFyYW0gY2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRvIGludm9rZSB3aGVuIHRoZSByZXF1ZXN0IGNvbXBsZXRlcy4KICogQHBhcmFtIG5vX2NhY2hlIG9wdGlvbmFsOyB0cnVlIHRvIGZvcmNlIGEgY2FjaGUgbWlzcyBmb3IgdGhpcyByZXF1ZXN0LgogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuZ2V0RGVzaWduRG9jID0gZnVuY3Rpb24gKG5hbWUsIGNhbGxiYWNrLCBub19jYWNoZSkgewogICAgaWYgKCFub19jYWNoZSAmJiBleHBvcnRzLmRlc2lnbl9kb2NzW25hbWVdKSB7CiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIGV4cG9ydHMuZGVzaWduX2RvY3NbbmFtZV0pOwogICAgfQogICAgZXhwb3J0cy5nZXREb2MoJ19kZXNpZ24vJyArIG5hbWUsIHt9LCBmdW5jdGlvbiAoZXJyLCBkZG9jKSB7CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTsKICAgICAgICB9CiAgICAgICAgZXhwb3J0cy5kZXNpZ25fZG9jc1tuYW1lXSA9IGRkb2M7CiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIGV4cG9ydHMuZGVzaWduX2RvY3NbbmFtZV0pOwogICAgfSk7Cn07CgoKCn0pfTsKCi8qKioqKioqKioqIGthbnNvL2ZpZWxkc2V0ICoqKioqKioqKiovCgprYW5zby5tb2R1bGVDYWNoZVsia2Fuc28vZmllbGRzZXQiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLyoqCiAqIEZ1bmN0aW9ucyBmb3IgZGVhbGluZyB3aXRoIGNvbGxlY3Rpb25zIG9mIGZpZWxkcy4gVXNlZCBieSBib3RoIHRoZQogKiB0eXBlcyBhbmQgZm9ybXMgbW9kdWxlcy4KICoKICogQG1vZHVsZQogKi8KCi8qKgogKiBNb2R1bGUgZGVwZW5kZW5jaWVzCiAqLwoKdmFyIF8gPSByZXF1aXJlKCcuL3VuZGVyc2NvcmUnKS5fLAogICAgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyk7CgoKLyoqCiAqIFJldHVybnMgYSBoaWVyYWNoeSBvZiBkZWZhdWx0IHZhbHVlcyBmb3IgYSBnaXZlbiBzZXQgb2YgRmllbGQgb2JqZWN0cwogKgogKiBAbmFtZSBjcmVhdGVEZWZhdWx0cyhmaWVsZHMsIHJlcSkKICogQHBhcmFtIHtPYmplY3R9IGZpZWxkcwogKiBAcGFyYW0ge09iamVjdH0gcmVxIC0gdGhlIHJlcXVlc3Qgb2JqZWN0IHRvIHBhc3MgdG8gZGVmYXVsdF92YWx1ZSBmdW5jdGlvbnMKICogQHJldHVybnMge09iamVjdH0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmNyZWF0ZURlZmF1bHRzID0gZnVuY3Rpb24gKGZpZWxkcywgLypvcHRpb25hbCovcmVxKSB7CiAgICBpZiAoIXJlcSkgewogICAgICAgIHJlcSA9IHV0aWxzLmN1cnJlbnRSZXF1ZXN0KCk7CiAgICB9CiAgICB2YXIgZmllbGRzX21vZHVsZSA9IHJlcXVpcmUoJy4vZmllbGRzJyk7CiAgICByZXR1cm4gXy5yZWR1Y2UoXy5rZXlzKGZpZWxkcyksIGZ1bmN0aW9uIChyZXN1bHQsIGspIHsKICAgICAgICB2YXIgZiA9IGZpZWxkc1trXTsKICAgICAgICBpZiAoZiBpbnN0YW5jZW9mIGZpZWxkc19tb2R1bGUuRmllbGQgfHwKICAgICAgICAgICAgZiBpbnN0YW5jZW9mIGZpZWxkc19tb2R1bGUuRW1iZWRkZWQgfHwKICAgICAgICAgICAgZiBpbnN0YW5jZW9mIGZpZWxkc19tb2R1bGUuRW1iZWRkZWRMaXN0KSB7CiAgICAgICAgICAgIGlmIChmLmhhc093blByb3BlcnR5KCdkZWZhdWx0X3ZhbHVlJykpIHsKICAgICAgICAgICAgICAgIGlmIChfLmlzRnVuY3Rpb24oZi5kZWZhdWx0X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtrXSA9IGYuZGVmYXVsdF92YWx1ZShyZXEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2tdID0gZi5kZWZhdWx0X3ZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGYgaW5zdGFuY2VvZiBPYmplY3QpIHsKICAgICAgICAgICAgcmVzdWx0W2tdID0gZXhwb3J0cy5jcmVhdGVEZWZhdWx0cyhmLCByZXEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgICAgICdUaGUgZmllbGQgdHlwZSBgJyArICh0eXBlb2YgZikgKyAnYCBpcyBub3Qgc3VwcG9ydGVkLicKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0sIHt9KTsKfTsKCi8qKgogKiBWYWxpZGF0ZSBhIHNwZWNpZmljIGZpZWxkLCByZXR1cm5pbmcgYWxsIHZhbGlkYXRpb24gZXJyb3JzIGFzIGFuIGFycmF5IHdpdGgKICogZWFjaCBlcnJvcidzIGZpZWxkIHByb3BlcnR5IHByZWZpeGVkIGJ5IHRoZSBjdXJyZW50IHBhdGguCiAqCiAqIEBuYW1lIHZhbGlkYXRlRmllbGQoZmllbGQsIGRvYywgdmFsdWUsIHJhdywgcGF0aCkKICogQHBhcmFtIHtGaWVsZH0gZmllbGQKICogQHBhcmFtIHtPYmplY3R9IGRvYwogKiBAcGFyYW0gdmFsdWUKICogQHBhcmFtIHJhdwogKiBAcGFyYW0ge0FycmF5fSBwYXRoCiAqIEByZXR1cm5zIHtBcnJheX0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnZhbGlkYXRlRmllbGQgPSBmdW5jdGlvbiAoZmllbGQsIGRvYywgdmFsdWUsIHJhdywgcGF0aCkgewogICAgcmV0dXJuIF8ubWFwKGZpZWxkLnZhbGlkYXRlKGRvYywgdmFsdWUsIHJhdyksIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBlcnIuZmllbGQgPSBwYXRoLmNvbmNhdChlcnIuZmllbGQgfHwgW10pOwogICAgICAgIGVyci5oYXNfZmllbGQgPSB0cnVlOwogICAgICAgIHJldHVybiBlcnI7CiAgICB9KTsKfTsKCi8qKgogKiBWYWxpZGF0ZXMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgZmllbGRzIG9yIG90aGVyIHN1Yi1vYmplY3RzLCBpdGVyYXRpbmcgb3ZlcgogKiBlYWNoIHByb3BlcnR5IGFuZCByZWN1cnNpbmcgdGhyb3VnaCBzdWItb2JqZWN0cyB0byBmaW5kIGFsbCBGaWVsZHMuCiAqCiAqIFJldHVybnMgYW4gYXJyYXkgb2YgdmFsaWRhdGlvbiBlcnJvcnMsIGVhY2ggd2l0aCBhIGZpZWxkIHByb3BlcnR5IHNldCB0byB0aGUKICogcGF0aCBvZiB0aGUgZmllbGQgd2hpY2ggY2F1c2VkIHRoZSBlcnJvci4KICoKICogQG5hbWUgdmFsaWRhdGUoZmllbGRzLCBkb2MsIHZhbHVlcywgcmF3LCBwYXRoLCBleHRyYSkKICogQHBhcmFtIHtPYmplY3R9IGZpZWxkcwogKiBAcGFyYW0ge09iamVjdH0gZG9jCiAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZXMKICogQHBhcmFtIHtPYmplY3R9IHJhdwogKiBAcGFyYW0ge0FycmF5fSBwYXRoCiAqIEBwYXJhbSB7Qm9vbGVhbn0gZXh0cmEgLSB3aGV0aGVyIHRvIGFsbG93IGV4dHJhIHZhbHVlcyBub3QgY292ZXJlZCBieSBhIGZpZWxkCiAqIEByZXR1cm5zIHtBcnJheX0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnZhbGlkYXRlID0gZnVuY3Rpb24gKGZpZWxkcywgZG9jLCB2YWx1ZXMsIHJhdywgcGF0aCwgZXh0cmEpIHsKICAgIHZhbHVlcyA9IHZhbHVlcyB8fCB7fTsKICAgIGZpZWxkcyA9IGZpZWxkcyB8fCB7fTsKICAgIHJhdyA9IHJhdyB8fCB7fTsKCiAgICAvLyBFeHBlY3Rpbmcgc3ViLW9iamVjdCwgbm90IGEgdmFsdWUKICAgIGlmICh0eXBlb2YgdmFsdWVzICE9PSAnb2JqZWN0JykgewogICAgICAgIHZhciBlID0gbmV3IEVycm9yKCdVbmV4cGVjdGVkIHByb3BlcnR5IC0gdmFsaWRhdGlvbiAxJyk7CiAgICAgICAgZS5maWVsZCA9IHBhdGg7CiAgICAgICAgZS5oYXNfZmllbGQgPSBmYWxzZTsKICAgICAgICByZXR1cm4gW2VdOwogICAgfQoKICAgIC8vIEVuc3VyZSB3ZSB3YWxrIHRocm91Z2ggYWxsIHBhdGhzIG9mIGJvdGggZmllbGRzIGFuZCB2YWx1ZXMgYnkgY29tYmluaW5nCiAgICAvLyB0aGUga2V5cyBvZiBib3RoLiBPdGhlcndpc2UsIHdlIG1pZ2h0IG1pc3Mgb3V0IGNoZWNraW5nIGZvciBtaXNzaW5nCiAgICAvLyByZXF1aXJlZCBmaWVsZHMsIG9yIG1heSBub3QgZGV0ZWN0IHRoZSBwcmVzZW5jZSBvZiBleHRyYSBmaWVsZHMuCgogICAgdmFyIGtleXMgPSBfLnVuaXEoXy5rZXlzKGZpZWxkcykuY29uY2F0KF8ua2V5cyh2YWx1ZXMpKSk7CiAgICB2YXIgZmllbGRzX21vZHVsZSA9IHJlcXVpcmUoJy4vZmllbGRzJyk7CgogICAgcmV0dXJuIF8ucmVkdWNlKGtleXMsIGZ1bmN0aW9uIChlcnJzLCBrKSB7CiAgICAgICAgdmFyIGYgPSBmaWVsZHNba107CiAgICAgICAgaWYgKGYgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvLyBFeHRyYSB2YWx1ZSB3aXRoIG5vIGFzc29jaWF0ZWQgZmllbGQgZGV0ZWN0ZWQKICAgICAgICAgICAgaWYgKCFleHRyYSkgewogICAgICAgICAgICAgICAgLy8gaWdub3JlIHN5c3RlbSBwcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICBpZiAoIShwYXRoLmxlbmd0aCA9PT0gMCAmJiBrLmNoYXJBdCgwKSA9PT0gJ18nKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBlID0gbmV3IEVycm9yKCdVbmV4cGVjdGVkIHByb3BlcnR5IC0gdmFsaWRhdGlvbiAyJyk7CiAgICAgICAgICAgICAgICAgICAgZS5maWVsZCA9IHBhdGguY29uY2F0KFtrXSk7CiAgICAgICAgICAgICAgICAgICAgZS5oYXNfZmllbGQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBlcnJzLnB1c2goZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGVycnM7CiAgICAgICAgfQogICAgICAgIHZhciBmbiA9IGV4cG9ydHMudmFsaWRhdGU7CiAgICAgICAgaWYgKGYgaW5zdGFuY2VvZiBmaWVsZHNfbW9kdWxlLkZpZWxkIHx8CiAgICAgICAgICAgIGYgaW5zdGFuY2VvZiBmaWVsZHNfbW9kdWxlLkVtYmVkZGVkIHx8CiAgICAgICAgICAgIGYgaW5zdGFuY2VvZiBmaWVsZHNfbW9kdWxlLkVtYmVkZGVkTGlzdCkgewogICAgICAgICAgICBmbiA9IGV4cG9ydHMudmFsaWRhdGVGaWVsZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVycnMuY29uY2F0KAogICAgICAgICAgICBmbi5jYWxsKHRoaXMsIGYsIGRvYywgdmFsdWVzW2tdLCByYXdba10sIHBhdGguY29uY2F0KFtrXSksIGV4dHJhKQogICAgICAgICk7CiAgICB9LCBbXSk7Cn07CgovKioKICogQXV0aG9yaXplIGEgc3BlY2lmaWMgZmllbGQsIHJldHVybmluZyBhbGwgcGVybWlzc2lvbnMgZXJyb3JzIGFzIGFuIGFycmF5IHdpdGgKICogZWFjaCBlcnJvcidzIGZpZWxkIHByb3BlcnR5IHByZWZpeGVkIGJ5IHRoZSBjdXJyZW50IHBhdGguCiAqCiAqIEBuYW1lIGF1dGhGaWVsZChmLCBuRG9jLCBvRG9jLCBuVmFsLCBvVmFsLCB1c2VyLCBwYXRoKQogKiBAcGFyYW0ge0ZpZWxkfSBmICAgICAtIGZpZWxkIG9iamVjdAogKiBAcGFyYW0ge09iamVjdH0gbkRvYyAtIG5ldyBkb2N1bWVudAogKiBAcGFyYW0ge09iamVjdH0gb0RvYyAtIG9sZCBkb2N1bWVudAogKiBAcGFyYW0gblZhbCAgICAgICAgICAtIG5ldyBmaWVsZCB2YWx1ZQogKiBAcGFyYW0gb1ZhbCAgICAgICAgICAtIG9sZCBmaWVsZCB2YWx1ZQogKiBAcGFyYW0ge09iamVjdH0gdXNlciAtIHVzZXIgY29udGV4dCBvYmplY3QKICogQHBhcmFtIHtBcnJheX0gcGF0aCAgLSBjdXJyZW50IHBhdGgKICogQHJldHVybnMge0FycmF5fQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuYXV0aEZpZWxkID0gZnVuY3Rpb24gKGYsIG5Eb2MsIG9Eb2MsIG5WYWwsIG9WYWwsIHVzZXIsIHBhdGgpIHsKICAgIC8vbG9nKCdhdXRoRmllbGQ6ICcgKyBwYXRoLmpvaW4oJy4nKSk7CiAgICByZXR1cm4gXy5tYXAoZi5hdXRob3JpemUobkRvYywgb0RvYywgblZhbCwgb1ZhbCwgdXNlciksIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBlcnIuZmllbGQgPSBwYXRoLmNvbmNhdChlcnIuZmllbGQgfHwgW10pOwogICAgICAgIGVyci5oYXNfZmllbGQgPSB0cnVlOwogICAgICAgIHJldHVybiBlcnI7CiAgICB9KTsKfTsKCi8qKgogKiBBdXRob3JpemVzIGFuIG9iamVjdCBjb250YWluaW5nIGZpZWxkcyBvciBvdGhlciBzdWItb2JqZWN0cywgaXRlcmF0aW5nIG92ZXIKICogZWFjaCBwcm9wZXJ0eSBhbmQgcmVjdXJzaW5nIHRocm91Z2ggc3ViLW9iamVjdHMgdG8gZmluZCBhbGwgRmllbGRzLgogKgogKiBSZXR1cm5zIGFuIGFycmF5IG9mIHBlcm1pc3Npb25zIGVycm9ycywgZWFjaCB3aXRoIGEgZmllbGQgcHJvcGVydHkgc2V0IHRvIHRoZQogKiBwYXRoIG9mIHRoZSBmaWVsZCB3aGljaCBjYXVzZWQgdGhlIGVycm9yLgogKgogKiBAbmFtZSBhdXRoRmllbGRTZXQoZiwgbkRvYywgb0RvYywgblZhbCwgb1ZhbCwgdXNlciwgcGF0aCkKICogQHBhcmFtIHtGaWVsZH0gZiAgICAgLSBmaWVsZCBvYmplY3QKICogQHBhcmFtIHtPYmplY3R9IG5Eb2MgLSBuZXcgZG9jdW1lbnQKICogQHBhcmFtIHtPYmplY3R9IG9Eb2MgLSBvbGQgZG9jdW1lbnQKICogQHBhcmFtIG5WYWwgICAgICAgICAgLSBuZXcgZmllbGQgdmFsdWUKICogQHBhcmFtIG9WYWwgICAgICAgICAgLSBvbGQgZmllbGQgdmFsdWUKICogQHBhcmFtIHtPYmplY3R9IHVzZXIgLSB1c2VyIGNvbnRleHQgb2JqZWN0CiAqIEBwYXJhbSB7QXJyYXl9IHBhdGggIC0gY3VycmVudCBwYXRoCiAqIEBwYXJhbSB7Qm9vbGVhbn0gZXh0cmEgLSB3aGV0aGVyIHRvIHJhaXNlIGFuIGVycm9yIG9uIGFkZGl0aW9uYWwgZmllbGRzCiAqIEByZXR1cm5zIHtBcnJheX0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmF1dGhGaWVsZFNldCA9IGZ1bmN0aW9uIChmLCBuRG9jLCBvRG9jLCBuVmFsLCBvVmFsLCB1c2VyLCBwYXRoLCBleHRyYSkgewogICAgLy9sb2coJ2F1dGhGaWVsZFNldDogJyArIHBhdGguam9pbignLicpKTsKICAgIG5WYWwgPSBuVmFsIHx8IHt9OwogICAgb1ZhbCA9IG9WYWwgfHwge307CiAgICBmID0gZiB8fCB7fTsKCiAgICAvLyBFeHBlY3Rpbmcgc3ViLW9iamVjdCwgbm90IGEgdmFsdWUKICAgIC8vIFRoaXMgKnNob3VsZCogYmUgcGlja2VkIHVwIGJ5IHZhbGlkYXRpb24sIGFuZCBiZSByYWlzZWQgYXMgYSB2YWxpZGF0aW9uCiAgICAvLyBlcnJvciBiZWZvcmUgaXQgZ2V0cyB0byB0aGUgYXV0aCBzdGFnZQogICAgaWYgKHR5cGVvZiBuVmFsICE9PSAnb2JqZWN0JykgewogICAgICAgIHZhciBlID0gbmV3IEVycm9yKCdVbmV4cGVjdGVkIHByb3BlcnR5IDEnKTsKICAgICAgICBlLmZpZWxkID0gcGF0aDsKICAgICAgICBlLmhhc19maWVsZCA9IGZhbHNlOwogICAgICAgIHJldHVybiBbZV07CiAgICB9CgogICAgLy8gRW5zdXJlIHdlIHdhbGsgdGhyb3VnaCBhbGwgcGF0aHMgb2YgYm90aCBmaWVsZHMgYW5kIHZhbHVlcyBieSBjb21iaW5pbmcKICAgIC8vIHRoZSBrZXlzIG9mIGJvdGguIE90aGVyd2lzZSwgd2UgbWlnaHQgbWlzcyBvdXQgY2hlY2tpbmcgZm9yIG1pc3NpbmcKICAgIC8vIHJlcXVpcmVkIGZpZWxkcywgb3IgbWF5IG5vdCBkZXRlY3QgdGhlIHByZXNlbmNlIG9mIGV4dHJhIGZpZWxkcy4KCiAgICB2YXIgZktleXMgPSBfLmtleXMoZik7CiAgICB2YXIgbmV3S2V5cyA9IF8ua2V5cyhuVmFsKTsKICAgIHZhciBvbGRLZXlzID0gXy5rZXlzKG9WYWwpOwogICAgdmFyIGtleXMgPSBfLnVuaXEoZktleXMuY29uY2F0KG5ld0tleXMpLmNvbmNhdChvbGRLZXlzKSk7CgogICAgdmFyIGZpZWxkc19tb2R1bGUgPSByZXF1aXJlKCcuL2ZpZWxkcycpOwoKICAgIHJldHVybiBfLnJlZHVjZShrZXlzLCBmdW5jdGlvbiAoZXJycywgaykgewogICAgICAgIHZhciBmaWVsZCA9IGZba107CiAgICAgICAgaWYgKGZpZWxkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgLy8gRXh0cmEgdmFsdWUgd2l0aCBubyBhc3NvY2lhdGVkIGZpZWxkIGRldGVjdGVkCiAgICAgICAgICAgIC8vIFRoaXMgKnNob3VsZCogYmUgcGlja2VkIHVwIGJ5IHZhbGlkYXRpb24sIGFuZCBiZSByYWlzZWQgYXMgYQogICAgICAgICAgICAvLyB2YWxpZGF0aW9uIGVycm9yIGJlZm9yZSBpdCBnZXRzIHRvIHRoZSBhdXRoIHN0YWdlCiAgICAgICAgICAgIGlmICghZXh0cmEpIHsKICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBzeXN0ZW0gcHJvcGVydGllcwogICAgICAgICAgICAgICAgaWYgKCEocGF0aC5sZW5ndGggPT09IDAgJiYgay5jaGFyQXQoMCkgPT09ICdfJykpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IG5ldyBFcnJvcignVW5leHBlY3RlZCBwcm9wZXJ0eSAyJyk7CiAgICAgICAgICAgICAgICAgICAgZS5maWVsZCA9IHBhdGguY29uY2F0KFtrXSk7CiAgICAgICAgICAgICAgICAgICAgZS5oYXNfZmllbGQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBlcnJzLnB1c2goZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGVycnM7CiAgICAgICAgfQogICAgICAgIHZhciBmbiA9IGV4cG9ydHMuYXV0aEZpZWxkU2V0OwogICAgICAgIGlmIChmaWVsZCBpbnN0YW5jZW9mIGZpZWxkc19tb2R1bGUuRmllbGQgfHwKICAgICAgICAgICAgZmllbGQgaW5zdGFuY2VvZiBmaWVsZHNfbW9kdWxlLkVtYmVkZGVkIHx8CiAgICAgICAgICAgIGZpZWxkIGluc3RhbmNlb2YgZmllbGRzX21vZHVsZS5FbWJlZGRlZExpc3QpIHsKICAgICAgICAgICAgZm4gPSBleHBvcnRzLmF1dGhGaWVsZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVycnMuY29uY2F0KGZuKAogICAgICAgICAgICBmaWVsZCwgbkRvYywgb0RvYywgblZhbFtrXSwgb1ZhbFtrXSwgdXNlciwgcGF0aC5jb25jYXQoW2tdKSwgZXh0cmEKICAgICAgICApKTsKICAgIH0sIFtdKTsKfTsKCgoKfSl9OwoKLyoqKioqKioqKioga2Fuc28vZmxhc2htZXNzYWdlcyAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImthbnNvL2ZsYXNobWVzc2FnZXMiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLypnbG9iYWwgdW5lc2NhcGU6IGZhbHNlICovCgovKioKICogRmxhc2ggbWVzc2FnZXMgaGVscCB5b3Ugc3RvcmUgc3RhdGUgYmV0d2VlbiByZXF1ZXN0cywgc3VjaCBhcyByZXBvcnRpbmcgYQogKiBzdWNjZXNzZnVsIG9yIGZhaWxlZCBvcGVyYXRpb24gYWZ0ZXIgYSByZWRpcmVjdC4KICoKICogVGhlIGZsYXNoIG1lc3NhZ2UgaW1wbGVtZW50YXRpb24gaW4gdGhpcyBtb2R1bGUgaGFuZGxlcyBib3RoIGZhbGxiYWNrIGNvdWNoZGIKICogbW9kZSwgdXNpbmcgY29va2llcyB0byBwZXJzaXN0IHN0YXRlIGJldHdlZW4gcmVxdWVzdHMsIGFzIHdlbGwgYXMgc3VwcG9ydGluZwogKiBjbGllbnQtc2lkZSBvcGVyYXRpb24sIGNvcnJlY3RseSBoYW5kbGluZyBuZXcgbWVzc2FnZXMgZXZlbiBpbnNpZGUgdGhlCiAqIGNhbGxiYWNrcyBvZiBhc3luYyBmdW5jdGlvbnMuCiAqCiAqIEZsYXNoIG1lc3NhZ2VzIG9ubHkgcGVyc2lzdCBmb3IgdGhlIG5leHQgcmVxdWVzdCBvciB0aGUgbmV4dCB0ZW1wbGF0ZSByZW5kZXIhCiAqIFRoYXQgbWVhbnMgMiByZWRpcmVjdHMgd2l0aG91dCBleHBsaWNpdGx5IGN1cnJ5aW5nIHRoZSBmbGFzaCBtZXNzYWdlcyB3aWxsCiAqIGNhdXNlIHRoZSBtZXNzYWdlcyB0byBiZSBsb3N0LgogKgogKiBAbW9kdWxlCiAqLwoKLyoqCiAqIE1vZHVsZSBkZXBlbmRlbmNpZXMKICovCgp2YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyksCiAgICBjb29raWVzID0gcmVxdWlyZSgnLi9jb29raWVzJyksCiAgICBfID0gcmVxdWlyZSgnLi91bmRlcnNjb3JlJyk7CgoKLyoqCiAqIFJlYWRzIHRoZSBmbGFzaCBtZXNzYWdlcyBjb29raWUgZnJvbSBhIHJlcXVlc3Qgb2JqZWN0LCByZXR1cm5pbmcgYW4KICogYXJyYXkgb2YgaW5jb21pbmcgbWVzc2FnZXMuCiAqCiAqIEBuYW1lIHJlYWRSZXF1ZXN0Q29va2llKHJlcSkKICogQHBhcmFtIHtPYmplY3R9IHJlcQogKiBAcmV0dXJucyB7QXJyYXl9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5yZWFkUmVxdWVzdENvb2tpZSA9IGZ1bmN0aW9uIChyZXEpIHsKICAgIHZhciBjb29raWUgPSByZXEuY29va2llLl9rYW5zb19mbGFzaDsKICAgIHZhciBtZXNzYWdlcyA9IGNvb2tpZSA/IEpTT04ucGFyc2UodW5lc2NhcGUoY29va2llKSk6IFtdOwogICAgcmV0dXJuIF8ubWFwKG1lc3NhZ2VzLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgdmFsLmluY29taW5nID0gdHJ1ZTsKICAgICAgICB2YWwub3V0Z29pbmcgPSBmYWxzZTsKICAgICAgICByZXR1cm4gdmFsOwogICAgfSk7Cn07CgovKioKICogUmVhZHMgdGhlIGZsYXNoIG1lc3NhZ2VzIGNvb2tpZSBmcm9tIHRoZSBicm93c2VyLCByZXR1cm5pbmcgYW4KICogYXJyYXkgb2YgaW5jb21pbmcgbWVzc2FnZXMuCiAqCiAqIEBuYW1lIHJlYWRCcm93c2VyQ29va2llKCkKICogQHJldHVybnMge0FycmF5fQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMucmVhZEJyb3dzZXJDb29raWUgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY29va2llID0gY29va2llcy5yZWFkQnJvd3NlckNvb2tpZSgnX2thbnNvX2ZsYXNoJyk7CiAgICB2YXIgbWVzc2FnZXMgPSBjb29raWUgPyBKU09OLnBhcnNlKHVuZXNjYXBlKGNvb2tpZSkpOiBbXTsKICAgIHJldHVybiBfLm1hcChtZXNzYWdlcywgZnVuY3Rpb24gKHZhbCkgewogICAgICAgIHZhbC5pbmNvbWluZyA9IHRydWU7CiAgICAgICAgdmFsLm91dGdvaW5nID0gZmFsc2U7CiAgICAgICAgcmV0dXJuIHZhbDsKICAgIH0pOwp9OwoKLyoqCiAqIEFkZHMgYSBmbGFzaF9tZXNzYWdlcyBwcm9wZXJ0eSB0byBhIHJlcXVlc3QgY29udGFpbmluZyBhbGwgaW5jb21pbmcKICogbWVzc2FnZXMuCiAqCiAqIEBuYW1lIHVwZGF0ZVJlcXVlc3QocmVxKQogKiBAcGFyYW0ge09iamVjdH0gcmVxCiAqIEByZXR1cm5zIHtSZXF1ZXN0IE9iamVjdH0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnVwZGF0ZVJlcXVlc3QgPSBmdW5jdGlvbiAocmVxKSB7CiAgICB2YXIgbWVzc2FnZXMgPSBleHBvcnRzLnJlYWRSZXF1ZXN0Q29va2llKHJlcSk7CiAgICByZXEuZmxhc2hfbWVzc2FnZXMgPSBfLm1hcChtZXNzYWdlcywgZnVuY3Rpb24gKHZhbCkgewogICAgICAgIHZhbC5pbmNvbWluZyA9IHRydWU7CiAgICAgICAgdmFsLm91dGdvaW5nID0gZmFsc2U7CiAgICAgICAgcmV0dXJuIHZhbDsKICAgIH0pOwogICAgcmV0dXJuIHJlcTsKfTsKCi8qKgogKiBHZXQncyBhbGwgY3VycmVudCBmbGFzaCBtZXNzYWdlcywgc3RvcHBpbmcgdGhlbSBmcm9tIGJlaW5nIG91dGdvaW5nIG9uIHRoZQogKiBuZXh0IHJlcXVlc3Qgc28gdGhleSdyZSBub3QgcmVwZWF0ZWQuCiAqCiAqIEBuYW1lIGdldE1lc3NhZ2VzKHJlcSkKICogQHBhcmFtIHtPYmplY3R9IHJlcQogKiBAcmV0dXJucyB7QXJyYXl9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5nZXRNZXNzYWdlcyA9IGZ1bmN0aW9uIChyZXEpIHsKICAgIGlmICh1dGlscy5pc0Jyb3dzZXIoKSkgewogICAgICAgIC8vIGFsc28gcmVtb3ZlIGFueSBtZXNzYWdlcyBmcm9tIHRoaXMgcmVxdWVzdCBhbHJlYWR5IHNldCBpbiB0aGUgY29va2llCiAgICAgICAgdmFyIGNvb2tpZV9tZXNzYWdlcyA9IGV4cG9ydHMucmVhZEJyb3dzZXJDb29raWUoKTsKICAgICAgICB2YXIgYm1lc3NhZ2VzID0gXy5maWx0ZXIoY29va2llX21lc3NhZ2VzLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICAgIHJldHVybiB2YWwucmVxICE9PSByZXEudXVpZDsKICAgICAgICB9KTsKICAgICAgICBpZiAoYm1lc3NhZ2VzLmxlbmd0aCAhPT0gY29va2llX21lc3NhZ2VzLmxlbmd0aCkgewogICAgICAgICAgICBleHBvcnRzLnNldEJyb3dzZXJDb29raWUocmVxLCBibWVzc2FnZXMpOwogICAgICAgIH0KICAgIH0KCiAgICB2YXIgbWVzc2FnZXMgPSBfLm1hcChyZXEuZmxhc2hfbWVzc2FnZXMsIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICB2YWwub3V0Z29pbmcgPSBmYWxzZTsKICAgICAgICByZXR1cm4gdmFsOwogICAgfSk7CiAgICByZXEuZmxhc2hfbWVzc2FnZXMgPSBtZXNzYWdlczsKCiAgICByZXR1cm4gXy5tYXAobWVzc2FnZXMsIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICByZXR1cm4gdmFsLmRhdGE7CiAgICB9KTsKfTsKCi8qKgogKiBGaWx0ZXJzIGFsbCBhdmFpbGFibGUgbWVzc2FnZXMgb24gYSByZXF1ZXN0IG9iamVjdCwgcmV0dXJuaW5nIG9ubHkgdGhvc2UKICogZmxhZ2dlZCBhcyBvdXRnb2luZyAoc2VuZGluZyBpbiB0aGUgcmVzcG9uc2UgdG8gYmUgbWFkZSBhdmFpbGFibGUgdG8gdGhlIG5leHQKICogcmVxdWVzdCkuCiAqCiAqIEBuYW1lIGdldE91dGdvaW5nTWVzc2FnZXMocmVxKQogKiBAcGFyYW0ge09iamVjdH0gcmVxCiAqIEByZXR1cm5zIHtBcnJheX0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmdldE91dGdvaW5nTWVzc2FnZXMgPSBmdW5jdGlvbiAocmVxKSB7CiAgICByZXR1cm4gXy5maWx0ZXIocmVxLmZsYXNoX21lc3NhZ2VzLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgcmV0dXJuIHZhbC5vdXRnb2luZzsKICAgIH0pOwp9OwoKLyoqCiAqIFVwZGF0ZXMgYSByZXNwb25zZSBvYmplY3QgYWZ0ZXIgYSBsaXN0LCBzaG93IG9yIHVwZGF0ZSBmdW5jdGlvbiBoYXMgcmV0dXJuZWQsCiAqIHNldHRpbmcgdGhlIGZsYXNoIG1lc3NhZ2VzIGNvb2tpZSB0byBpbmNsdWRlIHRoZSBvdXRnb2luZyBtZXNzYWdlcy4KICoKICogQG5hbWUgdXBkYXRlUmVzcG9uc2UocmVxLCByZXMpCiAqIEBwYXJhbSB7T2JqZWN0fSByZXEKICogQHBhcmFtIHtPYmplY3R9IHJlcwogKiBAcmV0dXJucyB7UmVzcG9uc2UgT2JqZWN0fQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMudXBkYXRlUmVzcG9uc2UgPSBmdW5jdGlvbiAocmVxLCByZXMpIHsKICAgIHZhciBtZXNzYWdlcyA9IF8ubWFwKGV4cG9ydHMuZ2V0T3V0Z29pbmdNZXNzYWdlcyhyZXEpLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgZGVsZXRlIHZhbC5vdXRnb2luZzsKICAgICAgICBkZWxldGUgdmFsLmluY29taW5nOwogICAgICAgIHJldHVybiB2YWw7CiAgICB9KTsKICAgIGlmIChyZXEucmVzcG9uc2VfcmVjZWl2ZWQpIHsKICAgICAgICBleHBvcnRzLnNldEJyb3dzZXJDb29raWUocmVxLCBtZXNzYWdlcyk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBjb29raWVzLnNldFJlc3BvbnNlQ29va2llKHJlcSwgcmVzLCB7CiAgICAgICAgICAgIG5hbWU6ICdfa2Fuc29fZmxhc2gnLAogICAgICAgICAgICB2YWx1ZTogSlNPTi5zdHJpbmdpZnkobWVzc2FnZXMpCiAgICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gcmVzOwp9OwoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgZmxhc2ggbWVzc2FnZSBvYmplY3QsIGFzc29jaWF0aW5nIGl0IHdpdGggdGhlIGdpdmVuIHJlcXVlc3QuCiAqCiAqIEBuYW1lIGNyZWF0ZU1lc3NhZ2UocmVxLCBtc2cpCiAqIEBwYXJhbSB7T2JqZWN0fSByZXEKICogQHBhcmFtIHtTdHJpbmd9IG1zZwogKiBAcmV0dXJucyB7T2JqZWN0fQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuY3JlYXRlTWVzc2FnZSA9IGZ1bmN0aW9uIChyZXEsIG1zZykgewogICAgcmV0dXJuIHsKICAgICAgICByZXE6IHJlcS51dWlkLAogICAgICAgIGRhdGE6IG1zZwogICAgfTsKfTsKCi8qKgogKiBTdG9yZXMgYSBsaXN0IG9mIG1lc3NhZ2VzIGluIHRoZSBmbGFzaCBtZXNzYWdlcyBjb29raWUuIFRoaXMgZnVuY3Rpb24gaXMgZm9yCiAqIGNsaWVudC1zaWRlIHVzZS4KICoKICogQG5hbWUgc2V0QnJvd3NlckNvb2tpZShyZXEsIG1lc3NhZ2VzKQogKiBAcGFyYW0ge09iamVjdH0gcmVxCiAqIEBwYXJhbSB7QXJyYXl9IG1lc3NhZ2VzCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5zZXRCcm93c2VyQ29va2llID0gZnVuY3Rpb24gKHJlcSwgbWVzc2FnZXMpIHsKICAgIGNvb2tpZXMuc2V0QnJvd3NlckNvb2tpZShyZXEsIHsKICAgICAgICBuYW1lOiAnX2thbnNvX2ZsYXNoJywKICAgICAgICB2YWx1ZTogSlNPTi5zdHJpbmdpZnkobWVzc2FnZXMpCiAgICB9KTsKfTsKCi8qKgogKiBBZGRzIGEgbmV3IGZsYXNoIG1lc3NhZ2UgZm9yIHRoZSBjdXJyZW50IHJlcXVlc3QuIElmIHRoZSBsaXN0LCBzaG93IG9yIHVwZGF0ZQogKiBmdW5jdGlvbiBoYXMgbm90IHJldHVybmVkLCBpdCdzIGFkZGVkIHRvIHRoZSByZXNwb25zZSBTZXQtQ29va2llIGhlYWRlciwKICogb3RoZXJ3aXNlIChpZiBpdHMgdGhlIHJlc3VsdCBvZiBhIGNsaWVudC1zaWRlIGFzeW5jIG9wZXJhdGlvbikgaXQncyBhZGRlZAogKiBkaXJlY3RseSB0byB0aGUgYnJvd3NlcnMgY29va2llcy4KICoKICogQG5hbWUgYWRkTWVzc2FnZShyZXEsIG1zZykKICogQHBhcmFtIHtPYmplY3R9IHJlcQogKiBAcGFyYW0ge1N0cmluZ30gbXNnCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5hZGRNZXNzYWdlID0gZnVuY3Rpb24gKHJlcSwgbXNnKSB7CiAgICBpZiAoIXJlcS5mbGFzaF9tZXNzYWdlcykgewogICAgICAgIHJlcS5mbGFzaF9tZXNzYWdlcyA9IFtdOwogICAgfQogICAgdmFyIG1lc3NhZ2UgPSBleHBvcnRzLmNyZWF0ZU1lc3NhZ2UocmVxLCBtc2cpOwogICAgaWYgKHJlcS5yZXNwb25zZV9yZWNlaXZlZCkgewogICAgICAgIC8vIHRoZSBmdW5jdGlvbiBoYXMgYWxyZWFkeSByZXR1cm5lZCwgYWRkTWVzc2FnZSBtdXN0IGhhdmUgYmVlbiBjYWxsZWQKICAgICAgICAvLyBpbiBhIGNhbGxiYWNrIGZvciBzb21lIGNsaWVudC1zaWRlIG9ubHkgZnVuY3Rpb24sIHNldCB0aGUgY29va2llCiAgICAgICAgLy8gZGlyZWN0bHkKICAgICAgICB2YXIgbWVzc2FnZXMgPSBleHBvcnRzLnJlYWRCcm93c2VyQ29va2llKCk7CgogICAgICAgIG1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7CiAgICAgICAgZXhwb3J0cy5zZXRCcm93c2VyQ29va2llKHJlcSwgbWVzc2FnZXMpOwogICAgICAgIHJlcS5mbGFzaF9tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbWVzc2FnZS5vdXRnb2luZyA9IHRydWU7CiAgICAgICAgcmVxLmZsYXNoX21lc3NhZ2VzLnB1c2gobWVzc2FnZSk7CiAgICB9Cn07CgoKCn0pfTsKCi8qKioqKioqKioqIGthbnNvL2Zvcm1zICoqKioqKioqKiovCgprYW5zby5tb2R1bGVDYWNoZVsia2Fuc28vZm9ybXMiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLyoqCiAqIEZ1bmN0aW9ucyBmb3IgdGhlIHJlbmRlcmluZywgcGFyc2luZyBhbmQgdmFsaWRhdGlvbiBvZiBmb3Jtcy4KICoKICogQG1vZHVsZQogKi8KCi8qKgogKiBNb2R1bGUgZGVwZW5kZW5jaWVzCiAqLwoKdmFyIGNvcmUgPSByZXF1aXJlKCcuL2NvcmUnKSwKICAgIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpLAogICAgZmllbGRzZXQgPSByZXF1aXJlKCcuL2ZpZWxkc2V0JyksCiAgICByZW5kZXIgPSByZXF1aXJlKCcuL3JlbmRlcicpLAogICAgXyA9IHJlcXVpcmUoJy4vdW5kZXJzY29yZScpLl87CgoKLyoqCiAqIEZvcm0gb2JqZWN0LCBwcmVzZW50cyBmaWVsZHMgYW5kIHBhcnNlcyByZXNwb25zZXMuCiAqCiAqICMjIyMgT3B0aW9ucyAjIyMjCiAqCiAqIDx0YWJsZSBjbGFzcz0ib3B0aW9ucyI+CiAqICAgPHRyPgogKiAgICAgIDx0ZCBjbGFzcz0ibmFtZSI+ZXhjbHVkZTwvdGQ+CiAqICAgICAgPHRkIGNsYXNzPSJ0eXBlIj5BcnJheTwvdGQ+CiAqICAgICAgPHRkIGNsYXNzPSJkZXNjcmlwdGlvbiI+YSBsaXN0IG9mIGZpZWxkIG5hbWVzIHRvIGV4Y2x1ZGU8L3RkPgogKiAgIDwvdHI+CiAqICAgPHRyPgogKiAgICAgIDx0ZCBjbGFzcz0ibmFtZSI+ZmllbGRzPC90ZD4KICogICAgICA8dGQgY2xhc3M9InR5cGUiPkFycmF5PC90ZD4KICogICAgICA8dGQgY2xhc3M9ImRlc2NyaXB0aW9uIj4KICogICAgICAgICAgYSBzdWJzZXQgb2YgZmllbGRzIHRvIHVzZSAoaW52ZXJzZSBvZiBleGNsdWRlZCkKICogICAgICA8L3RkPgogKiAgIDwvdHI+CiAqIDwvdGFibGU+CiAqCiAqIEBuYW1lIEZvcm0oZmllbGRzIHwgdHlwZSwgW2RvY10pCiAqIEBwYXJhbSB7T2JqZWN0fSBmaWVsZHMgIC0gYW4gb2JqZWN0IGxpdGVyYWwgY29udGFpbmluZyBmaWVsZHMgb3IgYSBUeXBlCiAqIEBwYXJhbSB7T2JqZWN0fSBkb2MgICAgIC0gKG9wdGlvbmFsKSB0aGUgb3JpZ2luYWwgZG9jdW1lbnQgYmVpbmcgZWRpdGVkCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gKG9wdGlvbmFsKSBzZWUgYXZhaWxhYmxlIG9wdGlvbnMgYWJvdmUKICogQGNvbnN0cnVjdG9yCiAqIEBhcGkgcHVibGljCiAqLwoKdmFyIEZvcm0gPSBleHBvcnRzLkZvcm0gPSBmdW5jdGlvbiBGb3JtKGZpZWxkcywgZG9jLCBvcHRpb25zKSB7CiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAgIHRoaXMudmFsdWVzID0gbnVsbDsKICAgIGlmIChkb2MpIHsKICAgICAgICB0aGlzLnZhbHVlcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZG9jKSk7IC8qIENvcHkgKi8KICAgICAgICB0aGlzLmluaXRpYWxfZG9jID0gZG9jOwogICAgfQogICAgaWYgKGZpZWxkcyAmJiBmaWVsZHMuZmllbGRzKSB7CiAgICAgICAgdGhpcy50eXBlID0gZmllbGRzOwogICAgICAgIHRoaXMuZmllbGRzID0gdGhpcy50eXBlLmZpZWxkczsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHRoaXMuZmllbGRzID0gZmllbGRzOwogICAgfQogICAgLyppZiAodXRpbHMuY29uc3RydWN0b3JOYW1lKGZpZWxkcykgPT09ICdUeXBlJykgewogICAgICAgIHRoaXMudHlwZSA9IGZpZWxkczsKICAgICAgICB0aGlzLmZpZWxkcyA9IHRoaXMudHlwZS5maWVsZDsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHRoaXMuZmllbGRzID0gZmllbGRzOwogICAgfSovCn07CgoKLyoqCiAqIE92ZXJyaWRlcyB2YWx1ZXMgaW4gZG9jX2Egd2l0aCB2YWx1ZXMgaW4gZG9jX2IsIG9ubHkgd2hlbiBhIGZpZWxkIGlzIHByZXNlbnQKICogZm9yIHRoYXQgdmFsdWUuIFRoaXMgbWVhbnMgcHJvcGVydGllcyBub3QgaW4gZmllbGRzIChvciBpbiBleGNsdWRlZCBmaWVsZHMpCiAqIGFyZSByZXRhaW5lZCwgd2hpbGUgcHJvcGVydGllcyB3aGljaCBhcmUgY292ZXJlZCBieSB0aGUgZmllbGRzZXQgYXJlCiAqIHJlcGxhY2VkLgogKgogKiBUaGlzIGlzIHVzZWQgd2hlbiB1cGRhdGluZyB0aGUgZm9ybSdzIHZhbHVlcyB3aXRoIGEgcmVxdWVzdCB3aGVuIGl0cyBiZWVuCiAqIGluaXRpYXRlZCB3aXRoIGEgcHJldmlvdXMgZG9jdW1lbnQuIFlvdSBzaG91bGRuJ3Qgbm9ybWFsbHkgbmVlZCB0byBjYWxsIHRoaXMKICogZGlyZWN0bHkuCiAqCiAqIFJldHVybnMgdGhlIHVwZGF0ZWQgZG9jX2Egb2JqZWN0LgogKgogKiBAbmFtZSBvdmVycmlkZShleGNsdWRlcywgZmllbGRfc3Vic2V0LCBmaWVsZHMsIGRvY19hLCBkb2NfYiwgcGF0aCkKICogQHBhcmFtIHtBcnJheSB8IG51bGx9IGV4Y2x1ZGVzCiAqIEBwYXJhbSB7QXJyYXkgfCBudWxsfSBmaWVsZF9zdWJzZXQKICogQHBhcmFtIHtPYmplY3R9IEZpZWxkcwogKiBAcGFyYW0ge09iamVjdH0gZG9jX2EKICogQHBhcmFtIHtPYmplY3R9IGRvY19iCiAqIEBwYXJhbSB7QXJyYXl9IHBhdGgKICogQHJldHVybnMge09iamVjdH0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLm92ZXJyaWRlID0gZnVuY3Rpb24gKGV4Y2x1ZGVzLCBmaWVsZF9zdWJzZXQsIGZpZWxkcywgZG9jX2EsIGRvY19iLCBwYXRoKSB7CiAgICBmaWVsZHMgPSBmaWVsZHMgfHwge307CiAgICBkb2NfYSA9IGRvY19hIHx8IHt9OwoKICAgIHZhciBmaWVsZHNfbW9kdWxlID0gcmVxdWlyZSgnLi9maWVsZHMnKTsKICAgIHZhciBleGNsdWRlX3BhdGhzID0gXy5tYXAoKGV4Y2x1ZGVzIHx8IFtdKSwgZnVuY3Rpb24gKHApIHsKICAgICAgICByZXR1cm4gcC5zcGxpdCgnLicpOwogICAgfSk7CiAgICB2YXIgc3Vic2V0X3BhdGhzID0gXy5tYXAoKGZpZWxkX3N1YnNldCB8fCBbXSksIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgcmV0dXJuIHAuc3BsaXQoJy4nKTsKICAgIH0pOwoKICAgIHZhciBrZXlzID0gXy5rZXlzKGRvY19iKTsKCiAgICBfLmVhY2goa2V5cywgZnVuY3Rpb24gKGspIHsKICAgICAgICB2YXIgZiA9IGZpZWxkc1trXTsKICAgICAgICB2YXIgYiA9IGRvY19iW2tdOwogICAgICAgIHZhciBmX3BhdGggPSBwYXRoLmNvbmNhdChba10pOwoKICAgICAgICBpZiAodHlwZW9mIGIgIT09ICdvYmplY3QnIHx8CiAgICAgICAgICAgIGYgaW5zdGFuY2VvZiBmaWVsZHNfbW9kdWxlLkZpZWxkIHx8CiAgICAgICAgICAgIGYgaW5zdGFuY2VvZiBmaWVsZHNfbW9kdWxlLkVtYmVkZGVkIHx8CiAgICAgICAgICAgIGYgaW5zdGFuY2VvZiBmaWVsZHNfbW9kdWxlLkVtYmVkZGVkTGlzdCkgewoKICAgICAgICAgICAgaWYgKGV4Y2x1ZGVzKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV4Y2x1ZGVfcGF0aHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAodXRpbHMuaXNTdWJQYXRoKGV4Y2x1ZGVfcGF0aHNbaV0sIGZfcGF0aCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmllbGRfc3Vic2V0KSB7CiAgICAgICAgICAgICAgICB2YXIgaW5fc3Vic2V0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHN1YnNldF9wYXRocy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIGlmICh1dGlscy5pc1N1YlBhdGgoc3Vic2V0X3BhdGhzW2pdLCBmX3BhdGgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluX3N1YnNldCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFpbl9zdWJzZXQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZG9jX2Fba10gPSBiOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZG9jX2Fba10gPSBleHBvcnRzLm92ZXJyaWRlKAogICAgICAgICAgICAgICAgZXhjbHVkZXMsIGZpZWxkX3N1YnNldCwgZmllbGRzW2tdLCBkb2NfYVtrXSwgYiwgZl9wYXRoCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gZG9jX2E7Cn07CgovKioKICogUGFyc2VzIGEgcmVxdWVzdCBhbmQgdmFsaWRhdGVzIHRoZSByZXN1bHQsIGJpbmRpbmcgdmFsdWVzIGFuZCBlcnJvcnMgdG8KICogdGhlIGZvcm0gaW5zdGFuY2UuCiAqCiAqIEBuYW1lIEZvcm0udmFsaWRhdGUocmVxKQogKiBAcGFyYW0ge09iamVjdH0gcmVxCiAqIEByZXR1cm5zIHtGb3JtfQogKiBAYXBpIHB1YmxpYwogKi8KCkZvcm0ucHJvdG90eXBlLnZhbGlkYXRlID0gZnVuY3Rpb24gKC8qb3B0aW9uYWwqL3JlcSkgewogICAgaWYgKCFyZXEpIHsKICAgICAgICByZXEgPSB1dGlscy5jdXJyZW50UmVxdWVzdCgpOwogICAgfQoKICAgIC8qIFRoaXMgaXMgdGhlIHJlcXVlc3QgcGF5bG9hZDoKICAgICAgICBUaGlzIGNvbnRhaW5zIGFsbCBvZiB0aGUgZm9ybSBmaWVsZHMgdGhhdCBhcmUgdXNlZCBieQogICAgICAgIGZvcm1WYWx1ZXNUb1RyZWUgYW5kIHBhcnNlUmF3LCBhbmQgbXVzdCBiZSBjb3BpZWQgZmlyc3QuICovCgogICAgdGhpcy5yYXcgPSAocmVxLmZvcm0gfHwge30pOwoKICAgIHZhciB0eXBlX2NsYXNzID0gcmVxdWlyZSgnLi90eXBlcycpLlR5cGU7CiAgICB2YXIgdHJlZSA9IGV4cG9ydHMuZm9ybVZhbHVlc1RvVHJlZSh0aGlzLnJhdyk7CgogICAgdGhpcy52YWx1ZXMgPSBleHBvcnRzLm92ZXJyaWRlKAogICAgICAgIHRoaXMub3B0aW9ucy5leGNsdWRlLAogICAgICAgIHRoaXMub3B0aW9ucy5maWVsZHMsCiAgICAgICAgdGhpcy5maWVsZHMsCiAgICAgICAgdGhpcy52YWx1ZXMgfHwgZmllbGRzZXQuY3JlYXRlRGVmYXVsdHModGhpcy5maWVsZHMsIHJlcSkgfHwge30sCiAgICAgICAgZXhwb3J0cy5wYXJzZVJhdyh0aGlzLmZpZWxkcywgdHJlZSksCiAgICAgICAgW10KICAgICk7CiAgICAKICAgIHRoaXMuZXJyb3JzID0gZmllbGRzZXQudmFsaWRhdGUoCiAgICAgICAgdGhpcy5maWVsZHMsIHRoaXMudmFsdWVzLCB0aGlzLnZhbHVlcywgdGhpcy5yYXcsIFtdLCBmYWxzZQogICAgKTsKCiAgICBpZiAodGhpcy50eXBlKSB7CiAgICAgICAgaWYgKHRoaXMudHlwZSBpbnN0YW5jZW9mIHR5cGVfY2xhc3MpIHsKICAgICAgICAgICAgLy8gcnVuIHRvcCBsZXZlbCBwZXJtaXNzaW9ucyBmaXJzdAogICAgICAgICAgICB2YXIgdHlwZV9lcnJzID0gdGhpcy50eXBlLmF1dGhvcml6ZVR5cGVMZXZlbCgKICAgICAgICAgICAgICAgIHRoaXMudmFsdWVzLCB0aGlzLmluaXRpYWxfZG9jLCByZXEudXNlckN0eAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAodHlwZV9lcnJzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMgPSB0aGlzLmVycm9ycy5jb25jYXQodHlwZV9lcnJzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGlmIG5vIHRvcC1sZXZlbCBwZXJtaXNzaW9ucyBlcnJvcnMsIGNoZWNrIGVhY2ggZmllbGQKICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzID0gdGhpcy5lcnJvcnMuY29uY2F0KAogICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZS5hdXRob3JpemUoCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWVzLCB0aGlzLmluaXRpYWxfZG9jLCByZXEudXNlckN0eAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvKiBQcm9ncmFtbWVyIGVycm9yOiBkaXNwbGF5IGEgdXNlZnVsIGRpYWdub3N0aWMgbWVzc2FnZSAqLwogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgICAgICAgICAnRW5jb3VudGVyZWQgYSB0eXBlIG9iamVjdCB0aGF0IGlzIG5vdCBhbiBpbnN0YW5jZSBvZicgKwogICAgICAgICAgICAgICAgICAgICcgYFR5cGVgOyBjaGVjayBsaWIvdHlwZXMuanMgZm9yIHByb3BlciBpbnN0YW5zaWF0aW9uJwogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICAKICAgIH0KICAgIGVsc2UgewogICAgICAgIHRoaXMuZXJyb3JzID0gdGhpcy5lcnJvcnMuY29uY2F0KGZpZWxkc2V0LmF1dGhGaWVsZFNldCgKICAgICAgICAgICAgdGhpcy5maWVsZHMsIHRoaXMudmFsdWVzLCB0aGlzLmluaXRpYWxfZG9jLCB0aGlzLnZhbHVlcywKICAgICAgICAgICAgdGhpcy5pbml0aWFsX2RvYywgcmVxLnVzZXJDdHgsIFtdLCB0cnVlCiAgICAgICAgKSk7CiAgICB9CgogICAgLy8gY2xlYXIgZmllbGQgcHJvcGVydGllcyBvbiBlcnJvcnMgZm9yIGV4Y2x1ZGVkIGZpZWxkcwogICAgdmFyIGV4Y2x1ZGVzID0gdGhpcy5vcHRpb25zLmV4Y2x1ZGU7CiAgICBpZiAoZXhjbHVkZXMpIHsKICAgICAgICB2YXIgZXhjbF9wYXRocyA9IF8ubWFwKGV4Y2x1ZGVzLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICByZXR1cm4gcC5zcGxpdCgnLicpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuZXJyb3JzID0gXy5tYXAodGhpcy5lcnJvcnMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmICghZS5maWVsZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGV4Y2xfcGF0aHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBwYXRoID0gZXhjbF9wYXRoc1tpXTsKICAgICAgICAgICAgICAgIGlmICh1dGlscy5pc1N1YlBhdGgocGF0aCwgZS5maWVsZCkpIHsKICAgICAgICAgICAgICAgICAgICBlLm1lc3NhZ2UgPSBlLmZpZWxkLmpvaW4oJy4nKSArICc6ICcgKyAoCiAgICAgICAgICAgICAgICAgICAgICAgIGUubWVzc2FnZSB8fCBlLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBlLmZpZWxkOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIGNsZWFyIGZpZWxkIHByb3BlcnRpZXMgb24gZXJyb3JzIG5vdCBpbiBmaWVsZHMgc3Vic2V0CiAgICB2YXIgZmllbGRfc3Vic2V0ID0gdGhpcy5vcHRpb25zLmZpZWxkczsKICAgIGlmIChmaWVsZF9zdWJzZXQpIHsKICAgICAgICB2YXIgc3Vic2V0X3BhdGhzID0gXy5tYXAoZmllbGRfc3Vic2V0LCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICByZXR1cm4gcC5zcGxpdCgnLicpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuZXJyb3JzID0gXy5tYXAodGhpcy5lcnJvcnMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmICghZS5maWVsZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHN1YnNldF9wYXRocy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgdmFyIHBhdGggPSBzdWJzZXRfcGF0aHNbaV07CiAgICAgICAgICAgICAgICBpZiAoIXV0aWxzLmlzU3ViUGF0aChwYXRoLCBlLmZpZWxkKSkgewogICAgICAgICAgICAgICAgICAgIGUubWVzc2FnZSA9IGUuZmllbGQuam9pbignLicpICsgJzogJyArICgKICAgICAgICAgICAgICAgICAgICAgICAgZS5tZXNzYWdlIHx8IGUudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGUuZmllbGQ7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7Cn07CgovKioKICogQWZ0ZXIgYSBmb3JtIGhhcyBjYWxsZWQgdmFsaWRhdGUsIHRoaXMgZnVuY3Rpb24gd2lsbCByZXR1cm4gdHJ1ZSBpZiB0aGUgZm9ybQogKiBpcyB2YWxpZCwgZmFsc2Ugb3RoZXJ3aXNlLgogKgogKiBAbmFtZSBGb3JtLmlzVmFsaWQoKQogKiBAcmV0dXJucyB7Qm9vbGVhbn0KICogQGFwaSBwdWJsaWMKICovCgpGb3JtLnByb3RvdHlwZS5pc1ZhbGlkID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuICEodGhpcy5lcnJvcnMgJiYgdGhpcy5lcnJvcnMubGVuZ3RoKTsKfTsKCi8qKgogKiBGaWx0ZXJzIGFuIGFycmF5IG9mIGVycm9ycywgcmV0dXJuaW5nIG9ubHkgdGhvc2UgYmVsb3cgYSBzcGVjaWZpYyBmaWVsZCBwYXRoCiAqCiAqIEBwYXJhbSB7QXJyYXl9IGVycnMKICogQHBhcmFtIHtBcnJheX0gcGF0aAogKiBAcmV0dXJucyB7QXJyYXl9CiAqLwoKdmFyIGVycnNCZWxvd1BhdGggPSBmdW5jdGlvbiAoZXJycywgcGF0aCkgewogICAgaWYgKCFwYXRoIHx8ICFwYXRoLmxlbmd0aCkgewogICAgICAgIHJldHVybiBlcnJzOwogICAgfQogICAgcmV0dXJuIF8uZmlsdGVyKGVycnMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKCFlLmZpZWxkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHV0aWxzLmlzU3ViUGF0aChwYXRoLCBlLmZpZWxkKTsKICAgIH0pOwp9OwoKLyoqCiAqIEZpbHRlcnMgYSBsaXN0IG9mIGVycm9ycywgcmV0dXJuaW5nIG9ubHkgdGhvc2Ugd2l0aG91dCBhIGZpZWxkIHByb3BlcnR5LgogKiBUaGlzIGlzIHVzZWQgdG8gcG9wdWxhdGUgdGhlIGVycm9ycyBhdCB0aGUgdG9wIG9mIHRoZSBmb3JtLCB3aGljaCBhcHBseQogKiBnZW5lcmFsbHksIG9yIGNhbm5vdCBiZSBhdHRyaWJ1dGVkIHRvIGEgc2luZ2xlIGZpZWxkLgogKgogKiBAcGFyYW0ge0FycmF5fSBlcnJzCiAqIEByZXR1cm5zIHtBcnJheX0KICovCgp2YXIgZXJyc1dpdGhvdXRGaWVsZHMgPSBmdW5jdGlvbiAoZXJycykgewogICAgcmV0dXJuIF8uZmlsdGVyKGVycnMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuICFlLmZpZWxkOwogICAgfSk7Cn07CgovKioKICogQ29udmVydHMgY3VycmVudCBmb3JtIHRvIGEgSFRNTCBzdHJpbmcsIHVzaW5nIGFuIG9wdGlvbmFsIHJlbmRlcmVyIGNsYXNzLgogKgogKiBAbmFtZSBGb3JtLnRvSFRNTChyZXEsIFtSZW5kZXJlckNsYXNzXSkKICogQHBhcmFtIHtPYmplY3R9IHJlcSBLYW5zbyByZXF1ZXN0IG9iamVjdDsgbnVsbCBmb3IgbW9zdCByZWNlbnQuIChvcHRpb25hbCkKICogQHBhcmFtIHtSZW5kZXJlcn0gUmVuZGVyZXJDbGFzcyAob3B0aW9uYWwpCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIEFuIG9iamVjdCBjb250YWluaW5nIHdpZGdldCBvcHRpb25zLCB3aGljaAogKiAgICAgICAgICB3aWxsIHVsdGltYXRlbHkgYmUgcHJvdmlkZWQgdG8gZWFjaCB3aWRnZXQncyB0b0hUTUwgbWV0aG9kLgogKiBAcGFyYW0ge0Jvb2xlYW59IGNyZWF0ZV9kZWZhdWx0cyAob3B0aW9uYWwpIFNldCB0aGlzIHRvIHRydWUgaWYgeW91J3ZlCiAqICAgICAgICAgIHByb3ZpZGVkIGEgZG9jdW1lbnQgaW4ge2RvY30sIGJ1dCB3b3VsZCBzdGlsbCBsaWtlIGRlZmF1bHQKICogICAgICAgICAgdmFsdWVzIHRvIGJlIG1lcmdlZCBpbiB0byBpdCB2aWEgY3JlYXRlRGVmYXVsdHMuIEZvciBhIGZpZWxkIGYsCiAqICAgICAgICAgIHRoZSBkZWZhdWx0IHZhbHVlIGlzIGFkZGVkIHRvIHtkb2N9IGlmIGFuZCBvbmx5IGlmIGRvY1tmXQogKiAgICAgICAgICBpcyB1bmRlZmluZWQsIG51bGwsIG9yIG5vdCBwcmVzZW50LiBEZWZhdWx0cyB0byBvZmYuCiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqIEBhcGkgcHVibGljCiAqLwoKRm9ybS5wcm90b3R5cGUudG9IVE1MID0gZnVuY3Rpb24gKC8qIG9wdGlvbmFsICovIHJlcSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIG9wdGlvbmFsICovIFJlbmRlcmVyQ2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBvcHRpb25hbCAqLyBvcHRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogb3B0aW9uYWwgKi8gY3JlYXRlX2RlZmF1bHRzKSB7CiAgICBpZiAoIXJlcSkgewogICAgICAgIHJlcSA9IHV0aWxzLmN1cnJlbnRSZXF1ZXN0KCk7CiAgICB9CiAgICB2YXIgdmFsdWVzID0gdGhpcy52YWx1ZXM7CgogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICBvcHRpb25zLm9wZXJhdGlvbiA9IG9wdGlvbnMub3BlcmF0aW9uIHx8ICh2YWx1ZXMgPyAndXBkYXRlJzogJ2FkZCcpOwoKICAgIGlmIChjcmVhdGVfZGVmYXVsdHMpIHsKICAgICAgICB2YWx1ZXMgPSBfLmRlZmF1bHRzKAogICAgICAgICAgICB2YWx1ZXMsIGZpZWxkc2V0LmNyZWF0ZURlZmF1bHRzKHRoaXMuZmllbGRzLCByZXEpCiAgICAgICAgKTsKICAgIH0gZWxzZSBpZiAoIXZhbHVlcykgewogICAgICAgIHZhbHVlcyA9IGZpZWxkc2V0LmNyZWF0ZURlZmF1bHRzKHRoaXMuZmllbGRzLCByZXEpOwogICAgfQoKICAgIFJlbmRlcmVyQ2xhc3MgPSAoUmVuZGVyZXJDbGFzcyB8fCByZW5kZXIuZGVmYXVsdFJlbmRlcmVyKCkpOwogICAgdmFyIHJlbmRlcmVyID0gbmV3IFJlbmRlcmVyQ2xhc3MoKTsKICAgIHJldHVybiAoCiAgICAgICAgcmVuZGVyZXIuc3RhcnQoCiAgICAgICAgICAgIGVycnNXaXRob3V0RmllbGRzKHRoaXMuZXJyb3JzKQogICAgICAgICkgKwogICAgICAgIHRoaXMucmVuZGVyRmllbGRzKAogICAgICAgICAgICByZW5kZXJlciwgdGhpcy5maWVsZHMsIHZhbHVlcywgdGhpcy5yYXcsIHRoaXMuZXJyb3JzLCBbXSwgb3B0aW9ucwogICAgICAgICkgKwogICAgICAgIHJlbmRlcmVyLmVuZCgpICsKICAgICAgICByZW5kZXIuc2NyaXB0VGFnRm9yRXZlbnQoJ3JlbmRlckZpbmlzaCcpCiAgICApOwp9OwoKLyoqCiAqIEZpbHRlcnMgYW4gYXJyYXkgb2YgZXJyb3JzLCByZXR1cm5pbmcgb25seSB0aG9zZSBiZWxvdyBhIHNwZWNpZmljIGZpZWxkIHBhdGgKICoKICogQHBhcmFtIHtBcnJheX0gZXJycwogKiBAcGFyYW0ge0FycmF5fSBwYXRoCiAqIEByZXR1cm5zIHtBcnJheX0KICovCgp2YXIgZXJyc0JlbG93UGF0aCA9IGZ1bmN0aW9uIChlcnJzLCBwYXRoKSB7CiAgICByZXR1cm4gXy5maWx0ZXIoZXJycywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGF0aC5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICBpZiAocGF0aFtpXSAhPT0gZS5maWVsZFtpXSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfSk7Cn07CgovKioKICogSXRlcmF0ZXMgb3ZlciBmaWVsZHMgYW5kIHN1Yi1vYmplY3RzIGNhbGxpbmcgdGhlIGNvcnJlY3QgcmVuZGVyZXIgZnVuY3Rpb24gb24KICogZWFjaC4gUmV0dXJucyBhIEhUTUwgcmVwcmVzZW50YXRpb24gb2YgdGhlIGZpZWxkcy4gVXNlZCBpbnRlcm5hbGx5IGJ5IHRoZQogKiB0b0hUTUwgbWV0aG9kLCB5b3Ugc2hvdWxkIG5vdCBuZWVkIHRvIGNhbGwgdGhpcyBmdW5jdGlvbiBkaXJlY3RseS4KICoKICogQG5hbWUgRm9ybS5yZW5kZXJGaWVsZHMocmVuZGVyZXIsIGZpZWxkcywgdmFsdWVzLCByYXcsIGVyciwgcGF0aCkKICogQHBhcmFtIHtPYmplY3R9IHJlbmRlcmVyCiAqIEBwYXJhbSB7T2JqZWN0fSBmaWVsZHMKICogQHBhcmFtIHtPYmplY3R9IHZhbHVlcwogKiBAcGFyYW0ge0FycmF5fSBlcnJzCiAqIEBwYXJhbSB7QXJyYXl9IHBhdGgKICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgd2lkZ2V0IG9wdGlvbnMsIHdoaWNoCiAqICAgICAgICAgIHdpbGwgdWx0aW1hdGVseSBiZSBwcm92aWRlZCB0byBlYWNoIHdpZGdldCdzIHRvSFRNTCBtZXRob2QuCiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqIEBhcGkgcHVibGljCiAqLwoKRm9ybS5wcm90b3R5cGUucmVuZGVyRmllbGRzID0gZnVuY3Rpb24gKHJlbmRlcmVyLCBmaWVsZHMsIHZhbHVlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhdywgZXJycywgcGF0aCwgb3B0aW9ucykgewogICAgZmllbGRzID0gZmllbGRzIHx8IHt9OwogICAgdmFsdWVzID0gdmFsdWVzIHx8IHt9OwogICAgcmF3ID0gcmF3IHx8IHt9OwogICAgZXJycyA9IGVycnMgfHwgW107CiAgICBwYXRoID0gcGF0aCB8fCBbXTsKCiAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICB2YXIgZXhjbHVkZXMgPSB0aGlzLm9wdGlvbnMuZXhjbHVkZTsKICAgIHZhciBmaWVsZF9zdWJzZXQgPSB0aGlzLm9wdGlvbnMuZmllbGRzOwogICAgdmFyIGtleXMgPSBfLmtleXMoZmllbGRzKTsKCiAgICB2YXIgZmllbGRzX21vZHVsZSA9IHJlcXVpcmUoJy4vZmllbGRzJyk7CgogICAgcmV0dXJuIF8ucmVkdWNlKGtleXMsIGZ1bmN0aW9uIChodG1sLCBrKSB7CgogICAgICAgIHZhciBmX3BhdGggPSBwYXRoLmNvbmNhdChba10pOwoKICAgICAgICBpZiAoZXhjbHVkZXMpIHsKICAgICAgICAgICAgaWYgKF8uaW5kZXhPZihleGNsdWRlcywgZl9wYXRoLmpvaW4oJy4nKSkgIT09IC0xKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaHRtbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZmllbGRfc3Vic2V0KSB7CiAgICAgICAgICAgIGlmIChfLmluZGV4T2YoZmllbGRfc3Vic2V0LCBmX3BhdGguam9pbignLicpKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBodG1sOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgZl9lcnJzID0gZXJyc0JlbG93UGF0aChlcnJzLCBmX3BhdGgpOwogICAgICAgIHZhciBmID0gZmllbGRzW2tdOwoKICAgICAgICBpZiAoZiBpbnN0YW5jZW9mIGZpZWxkc19tb2R1bGUuRmllbGQgfHwKICAgICAgICAgICAgZiBpbnN0YW5jZW9mIGZpZWxkc19tb2R1bGUuRW1iZWRkZWQgfHwKICAgICAgICAgICAgZiBpbnN0YW5jZW9mIGZpZWxkc19tb2R1bGUuRW1iZWRkZWRMaXN0KSB7CgogICAgICAgICAgICByZXR1cm4gaHRtbCArIHJlbmRlcmVyLmZpZWxkKAogICAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICAgIGZfcGF0aCwKICAgICAgICAgICAgICAgIHZhbHVlc1trXSwKICAgICAgICAgICAgICAgIChyYXdba10gPT09IHVuZGVmaW5lZCkgPyB2YWx1ZXNba106IHJhd1trXSwKICAgICAgICAgICAgICAgIGZfZXJycywKICAgICAgICAgICAgICAgIChvcHRpb25zIHx8IHt9KQogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChmIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICAgICAgICAgIHJldHVybiBodG1sICsgKGsgPyByZW5kZXJlci5iZWdpbkdyb3VwKGZfcGF0aCkgOiAnJykgKwogICAgICAgICAgICAgICAgdGhhdC5yZW5kZXJGaWVsZHMoCiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIsCiAgICAgICAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZXNba10sCiAgICAgICAgICAgICAgICAgICAgKHJhd1trXSA9PT0gdW5kZWZpbmVkKSA/IHZhbHVlc1trXTogcmF3W2tdLAogICAgICAgICAgICAgICAgICAgIGVycnMsCiAgICAgICAgICAgICAgICAgICAgZl9wYXRoLAogICAgICAgICAgICAgICAgICAgIChvcHRpb25zIHx8IHt9KQogICAgICAgICAgICAgICAgKSArIChrID8gcmVuZGVyZXIuZW5kR3JvdXAoZl9wYXRoKSA6ICcnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgICAgICAgICAnVGhlIGZpZWxkIHR5cGUgYCcgKyAodHlwZW9mIGYpICsgJ2AgaXMgbm90IHN1cHBvcnRlZC4nCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfSwgJycpOwp9OwoKCi8qKgogKiBUcmFuc2Zvcm1zIGEgZmxhdCBvYmplY3QgZnJvbSBhIHJlcXVlc3QgcXVlcnkgdG8gYSBwcm9wZXIKICogaGllcmFyY2h5IG9mIHByb3BlcnRpZXMuCiAqCiAqIDxwcmU+eydvbmUudHdvJzogJ3ZhbCd9IC0tPiB7b25lOiB7dHdvOiAndmFsJ319PC9wcmU+CiAqCiAqIEBuYW1lIGZvcm1WYWx1ZXNUb1RyZWUoZm9ybSkKICogQHBhcmFtIHtPYmplY3R9IHF1ZXJ5CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5mb3JtVmFsdWVzVG9UcmVlID0gZnVuY3Rpb24gKGZvcm0pIHsKICAgIHZhciB0cmVlID0ge307CiAgICBmb3IgKHZhciBrIGluIGZvcm0pIHsKICAgICAgICB1dGlscy5zZXRQcm9wZXJ0eVBhdGgodHJlZSwgay5zcGxpdCgnLicpLCBmb3JtW2tdKTsKICAgIH0KICAgIHJldHVybiB0cmVlOwp9OwoKCi8qKgogKiBUcmFuc2Zvcm1zIGEgcmF3IHF1ZXJ5IG9iamVjdCBmcm9tIGZvcm1WYWx1ZXNUb1RyZWUgdG8gYQogKiBkb2N1bWVudCB3aGljaCBmb2xsb3dzIHRoZSBzY2hlbWEgZm9yIHRoZSBnaXZlbiB0eXBlLgogKgogKiBAbmFtZSBwYXJzZVJhdyhmaWVsZHMsIHJhdykKICogQHBhcmFtIHtPYmplY3R9IGZpZWxkcwogKiBAcGFyYW0ge09iamVjdH0gcmF3CiAqIEByZXR1cm5zIHtPYmplY3R9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5wYXJzZVJhdyA9IGZ1bmN0aW9uIChmaWVsZHMsIHJhdykgewogICAgdmFyIGRvYyA9IHt9OwogICAgcmF3ID0gcmF3IHx8IHt9OwogICAgdmFyIGZpZWxkc19tb2R1bGUgPSByZXF1aXJlKCcuL2ZpZWxkcycpOwoKICAgIGZvciAodmFyIGsgaW4gZmllbGRzKSB7CiAgICAgICAgdmFyIGYgPSBmaWVsZHNba107CiAgICAgICAgdmFyIHIgPSByYXdba107CgogICAgICAgIGlmIChmIGluc3RhbmNlb2YgZmllbGRzX21vZHVsZS5GaWVsZCkgewogICAgICAgICAgICBpZiAoIWYuaXNFbXB0eShyKSkgewogICAgICAgICAgICAgICAgZG9jW2tdID0gZi5wYXJzZShyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICghZi5vbWl0X2VtcHR5KSB7CiAgICAgICAgICAgICAgICBkb2Nba10gPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZiBpbnN0YW5jZW9mIGZpZWxkc19tb2R1bGUuRW1iZWRkZWQpIHsKICAgICAgICAgICAgaWYgKCFmLmlzRW1wdHkocikpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgciA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICBpZiAociAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jW2tdID0gSlNPTi5wYXJzZShyKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBkb2Nba10gPSB7fTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkb2Nba10gPSBleHBvcnRzLnBhcnNlUmF3KGYudHlwZS5maWVsZHMsIHIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGYgaW5zdGFuY2VvZiBmaWVsZHNfbW9kdWxlLkVtYmVkZGVkTGlzdCkgewogICAgICAgICAgICBkb2Nba10gPSBbXTsKICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJbaV0gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJbaV0gIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY1trXVtpXSA9IEpTT04ucGFyc2UocltpXSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jW2tdW2ldID0ge307CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZG9jW2tdW2ldID0gZXhwb3J0cy5wYXJzZVJhdyhmLnR5cGUuZmllbGRzLCByW2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWRvY1trXS5sZW5ndGggJiYgZi5vbWl0X2VtcHR5KSB7CiAgICAgICAgICAgICAgICBkZWxldGUgZG9jW2tdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGYgaW5zdGFuY2VvZiBPYmplY3QpIHsKICAgICAgICAgICAgZG9jW2tdID0gZXhwb3J0cy5wYXJzZVJhdyhmLCByKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgICAgICAgICAnVGhlIGZpZWxkIHR5cGUgYCcgKyAodHlwZW9mIGYpICsgJ2AgaXMgbm90IHN1cHBvcnRlZC4nCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGRvYzsKfTsKCgoKfSl9OwoKLyoqKioqKioqKioga2Fuc28vcGF0aCAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImthbnNvL3BhdGgiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLyoqCiAqIFBhdGggZnVuY3Rpb25zIHBvcnRlZCBmcm9tIG5vZGUuanMgdG8gd29yayBpbiBDb3VjaERCIGFuZCB0aGUgYnJvd3Nlci4KICogVGhpcyBtb2R1bGUgaXMgdXNlZCBpbnRlcm5hbGx5IGJ5IEthbnNvLCBhbHRob3VnaCB5b3UgY2FuIHVzZSBpdCBpbiB5b3VyCiAqIGFwcHMgdG9vIGlmIHlvdSBmaW5kIHRoZSBmdW5jdGlvbnMgdXNlZnVsLgogKgogKiBAbW9kdWxlCiAqLwoKLy8gQ29weXJpZ2h0IEpveWVudCwgSW5jLiBhbmQgb3RoZXIgTm9kZSBjb250cmlidXRvcnMuCi8vCi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhCi8vIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUKLy8gIlNvZnR3YXJlIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZwovLyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsCi8vIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQKLy8gcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlCi8vIGZvbGxvd2luZyBjb25kaXRpb25zOgovLwovLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZAovLyBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KLy8KLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MKLy8gT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRgovLyBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOCi8vIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLAovLyBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IKLy8gT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRQovLyBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoKLyoqCiAqIEZyb20gbm9kZS5qcyB2MC4yLjYKICovCgovKioKICogSm9pbnMgbXVsdGlwbGUgcGF0aHMgdG9nZXRoZXIgdXNpbmcgJy8nLiBBY2NlcHRzIGEgYXJiaXRyYXJ5IG51bWJlciBvZgogKiBzdHJpbmdzIGFzIGFyZ3VtZW50cywgcmV0dXJuaW5nIHRoZSBqb2luZWQgcmVzdWx0IGFzIGEgc2luZ2xlIHN0cmluZy4KICoKICogQG5hbWUgam9pbihwYXRoLCBbLi4uXSkKICogQHJldHVybnMge1N0cmluZ30KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmpvaW4gPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gZXhwb3J0cy5ub3JtYWxpemUoQXJyYXkucHJvdG90eXBlLmpvaW4uY2FsbChhcmd1bWVudHMsICIvIikpOwp9OwoKLyoqCiAqIE5vcm1hbGl6ZXMgYSBwYXRoIHNwbGl0IGludG8gYW4gYXJyYXksIHRha2luZyBjYXJlIG9mICcuLicgYW5kICcuJyBwYXJ0cy4KICoKICogQG5hbWUgbm9ybWFsaXplQXJyYXkocGFydHMsIFtrZWVwQmxhbmtzXSkKICogQHBhcmFtIHtBcnJheX0gcGFydHMKICogQHBhcmFtIHtCb29sZWFufSBrZWVwQmxhbmtzCiAqIEByZXR1cm5zIHtBcnJheX0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLm5vcm1hbGl6ZUFycmF5ID0gZnVuY3Rpb24gKHBhcnRzLCBrZWVwQmxhbmtzKSB7CiAgICB2YXIgZGlyZWN0b3JpZXMgPSBbXSwgcHJldjsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gcGFydHMubGVuZ3RoIC0gMTsgaSA8PSBsOyBpKyspIHsKICAgICAgICB2YXIgZGlyZWN0b3J5ID0gcGFydHNbaV07CgogICAgICAgIC8vIGlmIGl0J3MgYmxhbmssIGJ1dCBpdCdzIG5vdCB0aGUgZmlyc3QgdGhpbmcsIGFuZCBub3QgdGhlIGxhc3QKICAgICAgICAvLyB0aGluZywgc2tpcCBpdC4KICAgICAgICBpZiAoZGlyZWN0b3J5ID09PSAiIiAmJiBpICE9PSAwICYmIGkgIT09IGwgJiYgIWtlZXBCbGFua3MpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBpdCdzIGEgZG90LCBhbmQgdGhlcmUgd2FzIHNvbWUgcHJldmlvdXMgZGlyIGFscmVhZHksIHRoZW4KICAgICAgICAvLyBza2lwIGl0LgogICAgICAgIGlmIChkaXJlY3RvcnkgPT09ICIuIiAmJiBwcmV2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBpdCBzdGFydHMgd2l0aCAiIiwgYW5kIGlzIGEgLiBvciAuLiwgdGhlbiBza2lwIGl0LgogICAgICAgIGlmIChkaXJlY3Rvcmllcy5sZW5ndGggPT09IDEgJiYgZGlyZWN0b3JpZXNbMF0gPT09ICIiICYmIChkaXJlY3RvcnkgPT09ICIuIiB8fCBkaXJlY3RvcnkgPT09ICIuLiIpKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGRpcmVjdG9yeSA9PT0gIi4uIiAmJiBkaXJlY3Rvcmllcy5sZW5ndGggJiYgcHJldiAhPT0gIi4uIiAmJiBwcmV2ICE9PSAiLiIgJiYgcHJldiAhPT0gdW5kZWZpbmVkICYmIChwcmV2ICE9PSAiIiB8fCBrZWVwQmxhbmtzKSkgewogICAgICAgICAgICBkaXJlY3Rvcmllcy5wb3AoKTsKICAgICAgICAgICAgcHJldiA9IGRpcmVjdG9yaWVzLnNsaWNlKC0xKVswXTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChwcmV2ID09PSAiLiIpIHsKICAgICAgICAgICAgICAgIGRpcmVjdG9yaWVzLnBvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRpcmVjdG9yaWVzLnB1c2goZGlyZWN0b3J5KTsKICAgICAgICAgICAgcHJldiA9IGRpcmVjdG9yeTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gZGlyZWN0b3JpZXM7Cn07CgovKioKICogTm9ybWFsaXplIGEgc3RyaW5nIHBhdGgsIHRha2luZyBjYXJlIG9mICcuLicgYW5kICcuJyBwYXJ0cy4KICoKICogQG5hbWUgbm9ybWFsaXplKHBhdGgsIFtrZWVwQmxhbmtzXSkKICogQHBhcmFtIHtTdHJpbmd9IHBhdGgKICogQHBhcmFtIHtCb29sZWFufSBrZWVwQmxhbmtzCiAqIEByZXR1cm5zIHN0cmluZwogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMubm9ybWFsaXplID0gZnVuY3Rpb24gKHBhdGgsIGtlZXBCbGFua3MpIHsKICAgIHJldHVybiBleHBvcnRzLm5vcm1hbGl6ZUFycmF5KHBhdGguc3BsaXQoIi8iKSwga2VlcEJsYW5rcykuam9pbigiLyIpOwp9OwoKLyoqCiAqIFJldHVybiB0aGUgZGlyZWN0b3J5IG5hbWUgb2YgYSBwYXRoLiBTaW1pbGFyIHRvIHRoZSBVbml4IGRpcm5hbWUgY29tbWFuZC4KICoKICogQG5hbWUgZGlybmFtZShwYXRoKQogKiBAcGFyYW0ge1N0cmluZ30gcGF0aAogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuZGlybmFtZSA9IGZ1bmN0aW9uIChwYXRoKSB7CiAgICBpZiAocGF0aC5sZW5ndGggPiAxICYmICcvJyA9PT0gcGF0aFtwYXRoLmxlbmd0aCAtIDFdKSB7CiAgICAgICAgcGF0aCA9IHBhdGgucmVwbGFjZSgvXC8rJC8sICcnKTsKICAgIH0KICAgIHZhciBsYXN0U2xhc2ggPSBwYXRoLmxhc3RJbmRleE9mKCcvJyk7CiAgICBzd2l0Y2ggKGxhc3RTbGFzaCkgewogICAgY2FzZSAtMToKICAgICAgICByZXR1cm4gJy4nOwogICAgY2FzZSAwOgogICAgICAgIHJldHVybiAnLyc7CiAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiBwYXRoLnN1YnN0cmluZygwLCBsYXN0U2xhc2gpOwogICAgfQp9OwoKLyoqCiAqIFJldHVybiB0aGUgbGFzdCBwb3J0aW9uIG9mIGEgcGF0aC4gU2ltaWxhciB0byB0aGUgVW5peCBiYXNlbmFtZSBjb21tYW5kLgogKgogKiAqKkV4YW1wbGUqKgogKiA8cHJlPjxjb2RlIGNsYXNzPSJqYXZhc2NyaXB0Ij5wYXRoLmJhc2VuYW1lKCcvZm9vL2Jhci9iYXovYXNkZi9xdXV4Lmh0bWwnKQogKiAvLyByZXR1cm5zCiAqICdxdXV4Lmh0bWwnCiAqCiAqIHBhdGguYmFzZW5hbWUoJy9mb28vYmFyL2Jhei9hc2RmL3F1dXguaHRtbCcsICcuaHRtbCcpCiAqIC8vIHJldHVybnMKICogJ3F1dXgnCiAqIDwvY29kZT48L3ByZT4KICoKICogQG5hbWUgYmFzZW5hbWUocGF0aCwgZXh0KQogKiBAcGFyYW0ge1N0cmluZ30gcGF0aAogKiBAcGFyYW0ge1N0cmluZ30gZXh0CiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5iYXNlbmFtZSA9IGZ1bmN0aW9uIChwYXRoLCBleHQpIHsKICAgIHZhciBmID0gcGF0aC5zdWJzdHIocGF0aC5sYXN0SW5kZXhPZigiLyIpICsgMSk7CiAgICBpZiAoZXh0ICYmIGYuc3Vic3RyKC0xICogZXh0Lmxlbmd0aCkgPT09IGV4dCkgewogICAgICAgIGYgPSBmLnN1YnN0cigwLCBmLmxlbmd0aCAtIGV4dC5sZW5ndGgpOwogICAgfQogICAgcmV0dXJuIGY7Cn07CgovKioKICogUmV0dXJuIHRoZSBleHRlbnNpb24gb2YgdGhlIHBhdGguIEV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGxhc3QgJy4nIGluIHRoZSBsYXN0CiAqIHBvcnRpb24gb2YgdGhlIHBhdGguIElmIHRoZXJlIGlzIG5vICcuJyBpbiB0aGUgbGFzdCBwb3J0aW9uIG9mIHRoZSBwYXRoIG9yCiAqIHRoZSBvbmx5ICcuJyBpcyB0aGUgZmlyc3QgY2hhcmFjdGVyLCB0aGVuIGl0IHJldHVybnMgYW4gZW1wdHkgc3RyaW5nLgogKgogKiA8cHJlPjxjb2RlIGNsYXNzPSJqYXZhc2NyaXB0Ij5wYXRoLmV4dG5hbWUoJ2luZGV4Lmh0bWwnKQogKiAvLyByZXR1cm5zCiAqICcuaHRtbCcKICoKICogcGF0aC5leHRuYW1lKCdpbmRleCcpCiAqIC8vIHJldHVybnMKICogJycKICogPC9jb2RlPjwvcHJlPgogKgogKiBAbmFtZSBleHRuYW1lKHBhdGgpCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoCiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5leHRuYW1lID0gZnVuY3Rpb24gKHBhdGgpIHsKICAgIHZhciBkb3QgPSBwYXRoLmxhc3RJbmRleE9mKCcuJyksCiAgICAgICAgc2xhc2ggPSBwYXRoLmxhc3RJbmRleE9mKCcvJyk7CiAgICAvLyBUaGUgbGFzdCBkb3QgbXVzdCBiZSBpbiB0aGUgbGFzdCBwYXRoIGNvbXBvbmVudCwgYW5kIGl0ICh0aGUgbGFzdCBkb3QpCiAgICAvLyBtdXN0IG5vdCBzdGFydCB0aGUgbGFzdCBwYXRoIGNvbXBvbmVudCAoaS5lLiBiZSBhIGRvdCB0aGF0IHNpZ25pZmllcyBhCiAgICAvLyBoaWRkZW4gZmlsZSBpbiBVTklYKS4KICAgIHJldHVybiBkb3QgPD0gc2xhc2ggKyAxID8gJycgOiBwYXRoLnN1YnN0cmluZyhkb3QpOwp9OwoKCgp9KX07CgovKioqKioqKioqKiBrYW5zby9wZXJtaXNzaW9ucyAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImthbnNvL3Blcm1pc3Npb25zIl0gPSB7bG9hZDogKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUpIHsKCi8qKgogKiBQZXJtaXNzaW9ucyBmdW5jdGlvbnMgYXJlIHVzZWQgb24gYm90aCBGaWVsZHMgYW5kIFR5cGVzIHRvIGNoZWNrIGEgZ2l2ZW4KICogdXNlciBpcyBhdXRob3JpemVkIHRvIG1ha2UgYSBjaGFuZ2UgdG8gYSBkb2N1bWVudC4KICoKICogQG1vZHVsZQogKi8KCgovKioKICogTW9kdWxlIGRlcGVuZGVuY2llcwogKi8KCnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMnKSwKICAgIF8gPSByZXF1aXJlKCcuL3VuZGVyc2NvcmUnKS5fOwoKCi8qKgogKiBGaWVsZCdzIG5ldyB2YWx1ZSBzaG91bGQgbWF0Y2ggY3VycmVudCB1c2VyJ3MgbmFtZQogKgogKiBAbmFtZSBtYXRjaFVzZXJuYW1lKCkKICogQHJldHVybnMge0Z1bmN0aW9ufQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMubWF0Y2hVc2VybmFtZSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBmdW5jdGlvbiAobmV3RG9jLCBvbGREb2MsIG5ld1ZhbCwgb2xkVmFsLCB1c2VyQ3R4KSB7CiAgICAgICAgdmFyIG5hbWUgPSB1c2VyQ3R4Lm5hbWU7CiAgICAgICAgaWYgKG5hbWUgIT09IG5ld1ZhbCkgewogICAgICAgICAgICAvLyBpZiBib3RoIGFyZSBlbXB0eS1saWtlLCB0aGVuIGNvbnNpZGVyIHRoZW0gdGhlIHNhbWUKICAgICAgICAgICAgaWYgKChuYW1lICE9PSBudWxsICYmIG5hbWUgIT09IHVuZGVmaW5lZCAmJiBuYW1lICE9PSAnJykgfHwKICAgICAgICAgICAgICAgIChuZXdWYWwgIT09IG51bGwgJiYgbmV3VmFsICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsICE9PSAnJykpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmllbGQgZG9lcyBub3QgbWF0Y2ggeW91ciB1c2VybmFtZScpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKfTsKCi8qKgogKiBDaGVja3MgaWYgdGhlIHVzZXIgaGFzIGEgc3BlY2lmaWMgcm9sZQogKgogKiBAbmFtZSBoYXNSb2xlKHJvbGUpCiAqIEBwYXJhbSB7U3RyaW5nfSByb2xlCiAqIEByZXR1cm5zIHtGdW5jdGlvbn0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmhhc1JvbGUgPSBmdW5jdGlvbiAocm9sZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uIChuZXdEb2MsIG9sZERvYywgbmV3VmFsLCBvbGRWYWwsIHVzZXJDdHgpIHsKICAgICAgICB2YXIgcm9sZXMgPSB1c2VyQ3R4ID8gKHVzZXJDdHgucm9sZXMgfHwgW10pOiBbXTsKICAgICAgICBpZiAoIV8uaW5jbHVkZShyb2xlcywgcm9sZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VyIG11c3QgaGF2ZSAiJyArIHJvbGUgKyAnIiByb2xlLicpOwogICAgICAgIH0KICAgIH07Cn07CgovKioKICogVGhlIHZhbHVlIG9mIHRoaXMgZmllbGQgc2hvdWxkIG5ldmVyIGNoYW5nZSBhZnRlciB0aGUgZG9jdW1lbnQgaGFzIGJlZW4KICogY3JlYXRlZC4KICoKICogQG5hbWUgZmllbGRVbmVkaXRhYmxlKCkKICogQHJldHVybnMge0Z1bmN0aW9ufQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuZmllbGRVbmVkaXRhYmxlID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGZ1bmN0aW9uIChuZXdEb2MsIG9sZERvYywgbmV3VmFsdWUsIG9sZFZhbHVlLCB1c2VyQ3R4KSB7CiAgICAgICAgaWYgKG9sZERvYykgewogICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpZWxkIGNhbm5vdCBiZSBlZGl0ZWQgb25jZSBjcmVhdGVkJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Owp9OwoKLyoqCiAqIFVzZXIncyBuYW1lIHNob3VsZCBtYXRjaCB0aGUgKm9sZCogdmFsdWUgb2YgdGhlIGdpdmVuIGZpZWxkLiBBIGZpZWxkIGNhbiBiZQogKiBzcGVjaWZpZWQgdXNpbmcgYSBzdHJpbmcgb3IgYW4gYXJyYXkgb2Ygc3RyaW5ncyAobGlrZSBhIHBhdGgpLgogKgogKiA8cHJlPgogKiBlZzogdXNlcm5hbWVNYXRjaGVzRmllbGQoJ2NyZWF0b3InKQogKiAgICAgdXNlcm5hbWVNYXRjaGVzRmllbGQoWydtZXRhJywnY3JlYXRvciddKQogKgogKiAgICAgewogKiAgICAgICAgIGNyZWF0b3I6ICduYW1lJywKICogICAgICAgICBtZXRhOiB7Y3JlYXRvcjogJ25hbWUyJ30KICogICAgIH0KICogPC9wcmU+CiAqCiAqIEBuYW1lIHVzZXJuYW1lTWF0Y2hlc0ZpZWxkKHBhdGgpCiAqIEBwYXJhbSB7U3RyaW5nIHwgQXJyYXl9IHBhdGgKICogQHJldHVybnMge0Z1bmN0aW9ufQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMudXNlcm5hbWVNYXRjaGVzRmllbGQgPSBmdW5jdGlvbiAocGF0aCkgewogICAgaWYgKCFfLmlzQXJyYXkocGF0aCkpIHsKICAgICAgICBwYXRoID0gW3BhdGhdOwogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uIChuZXdEb2MsIG9sZERvYywgbmV3VmFsdWUsIG9sZFZhbHVlLCB1c2VyQ3R4KSB7CiAgICAgICAgdmFyIGZpZWxkID0gdXRpbHMuZ2V0UHJvcGVydHlQYXRoKG9sZERvYywgcGF0aCk7CiAgICAgICAgaWYgKHVzZXJDdHgubmFtZSAhPT0gZmllbGQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VybmFtZSBkb2VzIG5vdCBtYXRjaCBmaWVsZCAnICsgcGF0aC5qb2luKCcuJykpOwogICAgICAgIH0KICAgIH07Cn07CgovKioKICogQ2hlY2tzIHRoYXQgdXNlcidzIGNvbnRleHQgaGFzIGEgdXNlcm5hbWUKICoKICogQG5hbWUgbG9nZ2VkSW4oKQogKiBAcmV0dXJucyB7RnVuY3Rpb259CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5sb2dnZWRJbiA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBmdW5jdGlvbiAobmV3RG9jLCBvbGREb2MsIG5ld1ZhbHVlLCBvbGRWYWx1ZSwgdXNlckN0eCkgewogICAgICAgIGlmICghdXNlckN0eCB8fCAhdXNlckN0eC5uYW1lKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IG11c3QgYmUgbG9nZ2VkIGluJyk7CiAgICAgICAgfQogICAgfTsKfTsKCi8qKgogKiBSdW5zIGFuIGFycmF5IG9mIHBlcm1pc3Npb25zIGZ1bmN0aW9ucyBhbmQgY2hlY2tzIHRoYXQgYWxsIG9mIHRoZW0gcGFzcywKICogcmV0dXJuaW5nIGFsbCBmYWlsdXJlcy4KICoKICogQG5hbWUgYWxsKHBlcm1zKQogKiBAcGFyYW0ge0FycmF5fSBwZXJtcwogKiBAcmV0dXJucyB7RnVuY3Rpb259CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5hbGwgPSBmdW5jdGlvbiAocGVybXMpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIF8ucmVkdWNlKHBlcm1zLCBmdW5jdGlvbiAoZXJycywgcCkgewogICAgICAgICAgICByZXR1cm4gZXJycy5jb25jYXQodXRpbHMuZ2V0RXJyb3JzKHAsIGFyZ3MpKTsKICAgICAgICB9LCBbXSk7CiAgICB9Owp9OwoKLyoqCiAqIFRlc3RzIHRvIHNlZSBpZiBhbnkgb25lIHBlcm1pc3Npb24gZnVuY3Rpb24gcGFzc2VzLCByZXR1cm5pbmcgb24gdGhlCiAqIGZpcnN0IHN1Y2Nlc3MuIElmIGFsbCBwZXJtaXNzaW9ucyBmYWlsLCB0aGVuIGFsbCBlcnJvcnMgYXJlIHJldHVybmVkLgogKgogKiBAbmFtZSBhbnkocGVybXMpCiAqIEBwYXJhbSB7QXJyYXl9IHBlcm1zCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5hbnkgPSBmdW5jdGlvbiAocGVybXMpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGVycnMgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGVybXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBwX2VycnMgPSAocGVybXNbaV0uYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCBbXSk7CiAgICAgICAgICAgICAgICBlcnJzID0gZXJycy5jb25jYXQocF9lcnJzKTsKICAgICAgICAgICAgICAgIGlmICghcF9lcnJzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiBhcyBzb29uIGFzIG9uZSBwYXNzZXMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIC8vIHN0b3JlIHRoZSBmaXJzdCBlcnJvciB0byByZS10aHJvdyBpZiBub25lIHBhc3MKICAgICAgICAgICAgICAgIGVycnMucHVzaChlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXJyczsKICAgIH07Cn07CgovKioKICogVHJlYXQgbmV3IGFuZCBvbGQgdmFsdWVzIGxpa2UgbmV3IGRvY3VtZW50cyBvZiBhIGdpdmVuIHR5cGUsIGFuZCBhdHRlbXB0IHRvCiAqIGF1dGhvcml6ZSB0aGUgdmFsdWUgYWdhaW5zdCB0aGUgdHlwZSdzIHBlcm1pc3Npb25zLiBVc2VmdWwgd2hlbiBoYW5kbGluZwogKiBwZXJtaXNzaW9ucyBmb3IgYW4gZW1iZWRkZWQgdHlwZS4KICoKICogQ2FuIGJlIGNvbWJpbmVkIHdpdGggcGVybWlzc2lvbnMuYW55IG9yIHBlcm1pc3Npb25zLmFsbCB0byBleHRlbmQgdGhlCiAqIHBlcm1pc3Npb25zIGZvciBhbiBlbWJlZGRlZCB0eXBlIGZpZWxkLiBGb3IgZXhhbXBsZSwgdGhlIGZvbGxvd2luZyBtaWdodAogKiBhbGxvdyBib3RoIHRoZSBvd25lciBvZiB0aGUgcGFyZW50IGRvY3VtZW50IGFuZCB0aGUgb3duZXIgb2YgdGhlIGNvbW1lbnQKICogaXRzZWxmIHRvIHJlbW92ZSBpdC4KICoKICogPHByZT48Y29kZSBjbGFzcz0iamF2YXNjcmlwdCI+CiAqICAgICBjb21tZW50OiBmaWVsZHMuZW1iZWQoewogKiAgICAgICAgIHR5cGU6IHR5cGVzLmNvbW1lbnQsCiAqICAgICAgICAgcGVybWlzc2lvbnM6IHsKICogICAgICAgICAgICAgcmVtb3ZlOiBwZXJtaXNzaW9ucy5hbnkoWwogKiAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnMudXNlcm5hbWVNYXRjaGVzRmllbGQoJ2NyZWF0b3InKSwKICogICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zLmluaGVyaXQodHlwZXMuY29tbWVudCkKICogICAgICAgICAgICAgXSkKICogICAgICAgICB9CiAqICAgICB9KTsKICogPC9jb2RlPjwvcHJlPgogKgogKiBAbmFtZSBpbmhlcml0KHR5cGUpCiAqIEBwYXJhbSB7VHlwZX0gdHlwZQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuaW5oZXJpdCA9IGZ1bmN0aW9uICh0eXBlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKG5ld0RvYywgb2xkRG9jLCBuZXdWYWx1ZSwgb2xkVmFsdWUsIHVzZXJDdHgpIHsKICAgICAgICByZXR1cm4gdHlwZS5hdXRob3JpemUobmV3VmFsdWUgfHwge19kZWxldGVkOiB0cnVlfSwgb2xkVmFsdWUsIHVzZXJDdHgpOwogICAgfTsKfTsKCgp9KX07CgovKioqKioqKioqKiBrYW5zby9xdWVyeXN0cmluZyAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImthbnNvL3F1ZXJ5c3RyaW5nIl0gPSB7bG9hZDogKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUpIHsKCnZhciBfID0gcmVxdWlyZSgnLi91bmRlcnNjb3JlJykuXzsKCi8qKgogKiBRdWVyeXN0cmluZyBmdW5jdGlvbnMgcG9ydGVkIGZyb20gbm9kZS5qcyB0byB3b3JrIGluIENvdWNoREIgYW5kIHRoZSBicm93c2VyLgogKiBUaGlzIG1vZHVsZSBpcyB1c2VkIGludGVybmFsbHkgYnkgS2Fuc28sIGFsdGhvdWdoIHlvdSBjYW4gdXNlIGl0IGluIHlvdXIKICogYXBwcyB0b28gaWYgeW91IGZpbmQgdGhlIGZ1bmN0aW9ucyB1c2VmdWwuCiAqCiAqIEBtb2R1bGUKICovCgoKLy8gQ29weXJpZ2h0IEpveWVudCwgSW5jLiBhbmQgb3RoZXIgTm9kZSBjb250cmlidXRvcnMuCi8vCi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhCi8vIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUKLy8gIlNvZnR3YXJlIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZwovLyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsCi8vIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQKLy8gcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlCi8vIGZvbGxvd2luZyBjb25kaXRpb25zOgovLwovLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZAovLyBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KLy8KLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MKLy8gT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRgovLyBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOCi8vIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLAovLyBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IKLy8gT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRQovLyBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoKLy8gUXVlcnkgU3RyaW5nIFV0aWxpdGllcwoKdmFyIFF1ZXJ5U3RyaW5nID0gZXhwb3J0czsKCi8qKgogKiBEZWNvZGVzIGEgVVJJIENvbXBvbmVudCwgcHJvdmlkZWQgc28gdGhhdCBpdCBjb3VsZCBiZSBvdmVycmlkZGVuIGlmCiAqIG5lY2Vzc2FyeS4KICoKICogQG5hbWUgdW5lc2NhcGUoc3RyKQogKiBAcGFyYW0ge1N0cmluZ30gc3RyCiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqIEBhcGkgcHVibGljCiAqLwoKUXVlcnlTdHJpbmcudW5lc2NhcGUgPSBmdW5jdGlvbiAoc3RyKSB7CiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHN0cik7Cn07CgovKioKICogRW5jb2RlcyBhIFVSSSBDb21wb25lbnQsIHByb3ZpZGVkIHNvIHRoYXQgaXQgY291bGQgYmUgb3ZlcnJpZGRlbiBpZgogKiBuZWNlc3NhcnkuCiAqCiAqIEBuYW1lIGVzY2FwZShzdHIpCiAqIEBwYXJhbSB7U3RyaW5nfSBzdHIKICogQHJldHVybnMge1N0cmluZ30KICogQGFwaSBwdWJsaWMKICovCgpRdWVyeVN0cmluZy5lc2NhcGUgPSBmdW5jdGlvbiAoc3RyKSB7CiAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHN0cik7Cn07Cgp2YXIgc3RyaW5naWZ5UHJpbWl0aXZlID0gZnVuY3Rpb24gKHYpIHsKICAgIHN3aXRjaCAodHlwZW9mIHYpIHsKICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgICAgcmV0dXJuIHY7CgogICAgY2FzZSAnYm9vbGVhbic6CiAgICAgICAgcmV0dXJuIHYgPyAndHJ1ZScgOiAnZmFsc2UnOwoKICAgIGNhc2UgJ251bWJlcic6CiAgICAgICAgcmV0dXJuIGlzRmluaXRlKHYpID8gdiA6ICcnOwoKICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuICcnOwogICAgfQp9OwoKLyoqCiAqIFNlcmlhbGl6ZSBhbiBvYmplY3QgdG8gYSBxdWVyeSBzdHJpbmcuIE9wdGlvbmFsbHkgb3ZlcnJpZGUgdGhlIGRlZmF1bHQKICogc2VwYXJhdG9yIGFuZCBhc3NpZ25tZW50IGNoYXJhY3RlcnMuCiAqCiAqICoqRXhhbXBsZToqKgogKgogKiA8cHJlPjxjb2RlIGNsYXNzPSJqYXZhc2NyaXB0Ij4KICogcXVlcnlzdHJpbmcuc3RyaW5naWZ5KHtmb286ICdiYXInfSkKICogLy8gcmV0dXJucwogKiAnZm9vPWJhcicKICoKICogcXVlcnlzdHJpbmcuc3RyaW5naWZ5KHtmb286ICdiYXInLCBiYXo6ICdib2InfSwgJzsnLCAnOicpCiAqIC8vIHJldHVybnMKICogJ2ZvbzpiYXI7YmF6OmJvYicKICogPC9jb2RlPjwvcHJlPgogKgogKiBAbmFtZSBzdHJpbmdpZnkob2JqLCBbc2VwLCBlcSwgbmFtZV0pCiAqIEBwYXJhbSB7T2JqZWN0fSBvYmoKICogQHBhcmFtIHtTdHJpbmd9IHNlcAogKiBAcGFyYW0ge1N0cmluZ30gZXEKICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICogQHJldHVybnMge1N0cmluZ30KICogQGFwaSBwdWJsaWMKICovCgpRdWVyeVN0cmluZy5zdHJpbmdpZnkgPSBRdWVyeVN0cmluZy5lbmNvZGUgPSBmdW5jdGlvbiAob2JqLCBzZXAsIGVxLCBuYW1lKSB7CiAgICBzZXAgPSBzZXAgfHwgJyYnOwogICAgZXEgPSBlcSB8fCAnPSc7CiAgICBvYmogPSAob2JqID09PSBudWxsKSA/IHVuZGVmaW5lZCA6IG9iajsKCiAgICBpZiAodHlwZW9mIG9iaiA9PT0gJ29iamVjdCcpIHsKICAgICAgICByZXR1cm4gXy5tYXAoXy5rZXlzKG9iaiksIGZ1bmN0aW9uIChrKSB7CiAgICAgICAgICAgIGlmIChfLmlzQXJyYXkob2JqW2tdKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIF8ubWFwKG9ialtrXSwgZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUXVlcnlTdHJpbmcuZXNjYXBlKHN0cmluZ2lmeVByaW1pdGl2ZShrKSkgKwogICAgICAgICAgICAgICAgICAgICAgICAgICBlcSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgIFF1ZXJ5U3RyaW5nLmVzY2FwZShzdHJpbmdpZnlQcmltaXRpdmUodikpOwogICAgICAgICAgICAgICAgfSkuam9pbihzZXApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIFF1ZXJ5U3RyaW5nLmVzY2FwZShzdHJpbmdpZnlQcmltaXRpdmUoaykpICsKICAgICAgICAgICAgICAgICAgICAgICBlcSArCiAgICAgICAgICAgICAgICAgICAgICAgUXVlcnlTdHJpbmcuZXNjYXBlKHN0cmluZ2lmeVByaW1pdGl2ZShvYmpba10pKTsKICAgICAgICAgICAgfQogICAgICAgIH0pLmpvaW4oc2VwKTsKICAgIH0KICAgIGlmICghbmFtZSkgewogICAgICAgIHJldHVybiAnJzsKICAgIH0KICAgIHJldHVybiBRdWVyeVN0cmluZy5lc2NhcGUoc3RyaW5naWZ5UHJpbWl0aXZlKG5hbWUpKSArIGVxICsKICAgICAgICAgICBRdWVyeVN0cmluZy5lc2NhcGUoc3RyaW5naWZ5UHJpbWl0aXZlKG9iaikpOwp9OwoKLyoqCiAqIERlc2VyaWFsaXplIGEgcXVlcnkgc3RyaW5nIHRvIGFuIG9iamVjdC4gT3B0aW9uYWxseSBvdmVycmlkZSB0aGUgZGVmYXVsdAogKiBzZXBhcmF0b3IgYW5kIGFzc2lnbm1lbnQgY2hhcmFjdGVycy4KICoKICogKipFeGFtcGxlOioqCiAqCiAqIDxwcmU+PGNvZGUgY2xhc3M9ImphdmFzY3JpcHQiPgogKiBxdWVyeXN0cmluZy5wYXJzZSgnYT1iJmI9YycpCiAqIC8vIHJldHVybnMKICogLy8geyBhOiAnYicsIGI6ICdjJyB9CiAqIDwvY29kZT48L3ByZT4KICoKICogQG5hbWUgZGVjb2RlKHFzLCBbc2VwLCBlcV0pCiAqIEBwYXJhbSB7U3RyaW5nfSBxcwogKiBAcGFyYW0ge1N0cmluZ30gc2VwCiAqIEBwYXJhbSB7U3RyaW5nfSBlcQogKiBAcmV0dXJucyB7T2JqZWN0fQogKiBAYXBpIHB1YmxpYwogKi8KClF1ZXJ5U3RyaW5nLnBhcnNlID0gUXVlcnlTdHJpbmcuZGVjb2RlID0gZnVuY3Rpb24gKHFzLCBzZXAsIGVxKSB7CiAgICBzZXAgPSBzZXAgfHwgJyYnOwogICAgZXEgPSBlcSB8fCAnPSc7CiAgICB2YXIgb2JqID0ge307CgogICAgaWYgKHR5cGVvZiBxcyAhPT0gJ3N0cmluZycgfHwgcXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIG9iajsKICAgIH0KCiAgICBxcy5zcGxpdChzZXApLmZvckVhY2goZnVuY3Rpb24gKGt2cCkgewogICAgICAgIHZhciB4ID0ga3ZwLnNwbGl0KGVxKTsKICAgICAgICB2YXIgayA9IFF1ZXJ5U3RyaW5nLnVuZXNjYXBlKHhbMF0pOwogICAgICAgIHZhciB2ID0gUXVlcnlTdHJpbmcudW5lc2NhcGUoeC5zbGljZSgxKS5qb2luKGVxKSk7CgogICAgICAgIGlmICghKGsgaW4gb2JqKSkgewogICAgICAgICAgICBvYmpba10gPSB2OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICghXy5pc0FycmF5KG9ialtrXSkpIHsKICAgICAgICAgICAgb2JqW2tdID0gW29ialtrXSwgdl07CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBvYmpba10ucHVzaCh2KTsKICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gb2JqOwp9OwoKCn0pfTsKCi8qKioqKioqKioqIGthbnNvL3JlbmRlciAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImthbnNvL3JlbmRlciJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKioKICogUmVuZGVyZXIgY29uc3RydWN0b3JzIGFuZCBnZW5lcmFsIHV0aWxpdGllcyBmb3IgcmVuZGVyaW5nIEZvcm0gb2JqZWN0cwogKiBhcyBIVE1MLgogKgogKiBAbW9kdWxlCiAqLwoKLyoqCiAqIE1vZHVsZSBkZXBlbmRlbmNpZXMKICovCgp2YXIgZXZlbnRzID0gcmVxdWlyZSgna2Fuc28vZXZlbnRzJyksCiAgICBzYW5pdGl6ZSA9IHJlcXVpcmUoJ2thbnNvL3Nhbml0aXplJyksCiAgICBfID0gcmVxdWlyZSgnLi91bmRlcnNjb3JlJykuXzsKCnZhciBoID0gc2FuaXRpemUuZXNjYXBlSHRtbDsKCgovKioKICogR2VuZXJhdGVzIGEgc2NyaXB0IHRhZyB0aGF0IGZpcmVzIHRoZSBldmVudCBuYW1lZCB7bmFtZX0uCiAqLwoKZXhwb3J0cy5zY3JpcHRUYWdGb3JFdmVudCA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICB2YXIgcnYgPSAoCiAgICAgICAgJzxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4nICsKICAgICAgICAiLy8gPCFbQ0RBVEFbXG4iICsKICAgICAgICAgICAgInJlcXVpcmUoJ2thbnNvL2V2ZW50cycpLmVtaXQoJyIgKwogICAgICAgICAgICAgICAgc2FuaXRpemUuY2RhdGEoc2FuaXRpemUuanMobmFtZSkpICsKICAgICAgICAgICAgIicpOyIgKwogICAgICAgICIvLyBdXT4iICsKICAgICAgICAnPC9zY3JpcHQ+JwogICAgKTsKCiAgICByZXR1cm4gcnY7Cn07IAoKLyoqCiAqIFJlbmRlcnMgSFRNTCBmb3IgZXJyb3IgbWVzc2FnZXMuCiAqCiAqIEBuYW1lIGVycm9ySFRNTChlcnJvcnMpCiAqIEBwYXJhbSB7QXJyYXl9IGVycm9ycwogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuZXJyb3JIVE1MID0gZnVuY3Rpb24gKGVycm9ycykgewogICAgaWYgKGVycm9ycyAmJiBlcnJvcnMubGVuZ3RoKSB7CiAgICAgICAgdmFyIGh0bWwgPSAnPHVsIGNsYXNzPSJlcnJvcnMgcmlnaHQiPic7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlcnJvcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaHRtbCArPSAoCiAgICAgICAgICAgICAgICAnPGxpIGNsYXNzPSJlcnJvcl9tc2ciPicgKwogICAgICAgICAgICAgICAgICAgIGgoZXJyb3JzW2ldLm1lc3NhZ2UgfHwgZXJyb3JzW2ldLnRvU3RyaW5nKCkpICsKICAgICAgICAgICAgICAgICc8L2xpPicKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaHRtbCArPSAnPC91bD4nOwogICAgICAgIHJldHVybiBodG1sOwogICAgfQogICAgcmV0dXJuICcnOwp9OwoKLyoqCiAqIEdlbmVyYXRlcyB0aGUgdGV4dCBmb3IgYSBmaWVsZCdzIGxhYmVsLCBkZXBlbmRpbmcgb24gd2hldGhlcgogKiBhIGN1c3RvbSBsYWJlbCBpcyBkZWZpbmVkIG9yIG5vdC4gSWYgbm90LCB0aGUgbmFtZSBpcyBjYXB0aWFsaXplZCBhbmQKICogdW5kZXJzY29yZXMgYXJlIHJlcGxhY2VzIHdpdGggc3BhY2VzIHRvIHByb2R1Y2UgdGhlIGxhYmVsJ3MgdGV4dC4KICoKICogQG5hbWUgbGFiZWxUZXh0KGZpZWxkLCBuYW1lKQogKiBAcGFyYW0ge09iamVjdH0gZmllbGQKICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICogQHJldHVybnMge1N0cmluZ30KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmxhYmVsVGV4dCA9IGZ1bmN0aW9uIChmaWVsZCwgbmFtZSkgewogICAgaWYgKGZpZWxkLmxhYmVsKSB7CiAgICAgICAgcmV0dXJuIGZpZWxkLmxhYmVsOwogICAgfQogICAgcmV0dXJuIG5hbWUuc3Vic3RyKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyBuYW1lLnN1YnN0cigxKS5yZXBsYWNlKC9fL2csICcgJyk7Cn07CgovKioKICogR2VuZXJhdGVzIEhUTUwgZm9yIGxhYmVsIHRhZ3MuCiAqCiAqIEBuYW1lIGxhYmVsSFRNTChmaWVsZCwgbmFtZSwgaWQpCiAqIEBwYXJhbSB7T2JqZWN0fSBmaWVsZAogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogKiBAcGFyYW0ge1N0cmluZ30gaWQKICogQHJldHVybnMge1N0cmluZ30KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmxhYmVsSFRNTCA9IGZ1bmN0aW9uIChmaWVsZCwgbmFtZSwgaWQpIHsKICAgIHJldHVybiAnPGxhYmVsIGZvcj0iJyArIGgoaWQgfHwgc2FuaXRpemUuaWQobmFtZSkpICsgJyI+JyArCiAgICAgICAgaChleHBvcnRzLmxhYmVsVGV4dChmaWVsZCwgbmFtZSwgaWQpKSArCiAgICAnPC9sYWJlbD4nOwp9OwoKLyoqCiAqIEdlbmVyYXRlcyBIVE1MIGZvciBmaWVsZCBkZXNjcmlwdGlvbnMgKGlmIGRlZmluZWQpLgogKgogKiBAbmFtZSBkZXNjcmlwdGlvbkhUTUwob2JqKQogKiBAcGFyYW0ge09iamVjdH0gb2JqCiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5kZXNjcmlwdGlvbkhUTUwgPSBmdW5jdGlvbiAob2JqKSB7CiAgICBpZiAob2JqLmRlc2NyaXB0aW9uKSB7CiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+JyArIGgob2JqLmRlc2NyaXB0aW9uKSArICc8L2Rpdj4nOwogICAgfQogICAgcmV0dXJuICcnOwp9OwoKLyoqCiAqIEdlbmVyYXRlcyBIVE1MIGZvciBmaWVsZCBoaW50cyAoaWYgZGVmaW5lZCkuCiAqCiAqIEBuYW1lIGhpbnRIVE1MKG9iaikKICogQHBhcmFtIHtPYmplY3R9IG9iagogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuaGludEhUTUwgPSBmdW5jdGlvbiAob2JqKSB7CiAgICBpZiAob2JqLmhpbnQpIHsKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9ImhpbnQiPicgKyBoKG9iai5oaW50KSArICc8L2Rpdj4nOwogICAgfQogICAgcmV0dXJuICcnOwp9OwoKLyoqCiAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgZGVmYXVsdCBjbGFzcyBuYW1lcyBmb3IgYSBmaWVsZC4gVGhpcyBpbmNsdWRlcwogKiAncmVxdWlyZWQnIGZvciByZXF1aXJlZCBmaWVsZHMgYW5kICdlcnJvcicgZm9yIGZpZWxkcyBmYWlsaW5nIHZhbGlkYXRpb24uCiAqCiAqIEFsbCBmaWVsZHMgYXJlIGdpdmVuIGEgJ2ZpZWxkJyBjbGFzcy4KICoKICogQG5hbWUgY2xhc3NlcyhmaWVsZCwgZXJyb3JzKQogKiBAcGFyYW0ge09iamVjdH0gZmllbGQKICogQHBhcmFtIHtBcnJheX0gZXJyb3JzCiAqIEByZXR1cm5zIHtBcnJheX0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmNsYXNzZXMgPSBmdW5jdGlvbiAoZmllbGQsIGVycm9ycykgewogICAgdmFyIHIgPSBbJ2ZpZWxkJ107CiAgICBpZiAoZXJyb3JzICYmIGVycm9ycy5sZW5ndGgpIHsKICAgICAgICByLnB1c2goJ2Vycm9yJyk7CiAgICB9CiAgICBpZiAoZmllbGQucmVxdWlyZWQpIHsKICAgICAgICByLnB1c2goJ3JlcXVpcmVkJyk7CiAgICB9CiAgICByZXR1cm4gcjsKfTsKCi8qKgogKiBEZXRlcm1pbmVzIHRoZSBkZWZhdWx0IHJlbmRlcmVyIGNsYXNzLCB0byBiZSB1c2VkIGdsb2JhbGx5IGJ5IAogKiBpbnN0YW5jZXMgb2YgZm9ybXMuRm9ybSB0aGF0IGZhaWwgdG8gc3BlY2lmeSBhIHJlbmRlcmVyIGNsYXNzLgogKgogKiBAbmFtZSBkZWZhdWx0UmVuZGVyZXIoKQogKiBAcmV0dXJucyB7RnVuY3Rpb259CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5kZWZhdWx0UmVuZGVyZXIgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gZXhwb3J0cy50YWJsZTsKfTsKCi8qKgogKiBUaGUgZGVmYXVsdCB0YWJsZSByZW5kZXJlciBjbGFzcywgcGFzc2VkIHRvIHRoZSB0b0hUTUwgbWV0aG9kIG9mIGEKICogZm9ybS4gUmVuZGVycyBhIGZvcm0gdXNpbmcgYSBzaW5nbGUgdGFibGUsIHdpdGggPHRib2R5PiB0YWdzIHRvCiAqIHJlcHJlc2VudCBuZXN0ZWQgZmllbGQgZ3JvdXBzLiBUaGUgPHRib2R5PnMgYXJlIGxhYmVsbGVkIHdpdGgKICogc3BlY2lmaWMgQ1NTIGNsYXNzZXMsIGluY2x1ZGluZyBkZXB0aCBpbmZvcm1hdGlvbi4gU2VlIHN0eWxlLmNzcwogKiBmb3IgZGV0YWlscyBvbiBob3cgdG8gc3R5bGUgdGhpcyBvdXRwdXQuCiAqCiAqIEBuYW1lIHRhYmxlCiAqIEBjb25zdHJ1Y3RvcgogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMudGFibGUgPSBmdW5jdGlvbiAoKSB7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvciBmb3IgcmVuZGVyZXI7IGluaXRpYWxpemVzIG9iamVjdC4gVGhlIHN0cmluZyByZXR1cm5lZAogICAgICogZnJvbSB0aGlzIGZ1bmN0aW9uIGlzIHByZXBlbmRlZCB0byB0aGUgZm9ybSdzIG1hcmt1cC4KICAgICAqCiAgICAgKiBAY29uc3RydWN0b3IKICAgICovCiAgICB0aGlzLnN0YXJ0ID0gZnVuY3Rpb24gKGVycnMpIHsKICAgICAgICB0aGlzLmRlcHRoID0gMDsKICAgICAgICB2YXIgaHRtbCA9ICc8dGFibGUgY2xhc3M9InJlbmRlci10YWJsZSI+JzsKICAgICAgICBpZiAoZXJycyAmJiBlcnJzLmxlbmd0aCkgewogICAgICAgICAgICBodG1sICs9ICc8dWwgY2xhc3M9ImZvcm0tZXJyb3JzIj4nOwogICAgICAgICAgICBfLmVhY2goZXJycywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxsaT4nICsgKGUubWVzc2FnZSB8fCBlLnRvU3RyaW5nKCkpICsgJzwvbGk+JzsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGh0bWwgKz0gJzwvdWw+JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGh0bWw7CiAgICB9OwoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5IHRoZSBmb3JtcyBsYXllciB3aGVuIGl0IGVuY291bnRlcnMgYSBuZXcKICAgICAqIG5lc3RpbmcgY29udGV4dCAoaS5lLiBhIG5ldyBncm91cGluZyBvZiBmaWVsZHMpLiBUaGUKICAgICAqIHBhdGggcGFyYW1ldGVyIGlzIGFuIGFycmF5IG9mIHN0cmluZ3MgdGhhdCBkZXNjcmliZXMKICAgICAqIHRoZSBwYXRoIChpbiB0ZXJtcyBvZiBkb2N1bWVudCBrZXlzKSB0byB0aGUgbmV3IGdyb3VwLgogICAgICogV2hlbiBjb25jYXRlbmF0ZWQgdG9nZXRoZXIgd2l0aCBhIGRvdCwgdGhpcyBhcnJheSB5aWVsZHMKICAgICAqIHRoZSBuZXcgcHJlZml4IGZvciBuYW1lZCBIVE1MIGZvcm0gZmllbGRzLgogICAgICoKICAgICAqIEBwYXJhbSB7QXJyYXl9IHBhdGgKICAgICovCiAgICB0aGlzLmJlZ2luR3JvdXAgPSBmdW5jdGlvbiAocGF0aCkgewogICAgICAgIHRoaXMuZGVwdGggKz0gMTsKICAgICAgICB2YXIgbmFtZSA9IF8ubGFzdChwYXRoKTsKICAgICAgICB2YXIgY3NzX2NsYXNzID0gJ2xldmVsLScgKyB0aGlzLmRlcHRoOwoKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAnPHRib2R5IGNsYXNzPSJoZWFkICcgKyBoKGNzc19jbGFzcykgKyAnIj4nICsKICAgICAgICAgICAgJzx0cj4nICsKICAgICAgICAgICAgICAgICc8dGggY29sc3Bhbj0iMyI+JyArCiAgICAgICAgICAgICAgICAgICAgaChuYW1lLnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpICsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5zdWJzdHIoMSkucmVwbGFjZSgvXy9nLCAnICcpKSArCiAgICAgICAgICAgICAgICAnPC90aD4nICsKICAgICAgICAgICAgJzwvdHI+JyArCiAgICAgICAgICAgICc8L3Rib2R5PicgKwogICAgICAgICAgICAnPHRib2R5IGNsYXNzPSJncm91cCAnICsgaChjc3NfY2xhc3MpICsgJyI+JwogICAgICAgICk7CiAgICB9OwoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5IHRoZSBmb3JtcyBsYXllciB3aGVuIGl0IGVuY291bnRlcnMgdGhlIGVuZAogICAgICogb2YgYSBuZXN0aW5nIGNvbnRleHQuIEluIHRoZSBhYnNlbmNlIG9mIGVycm9ycywgdGhpcwogICAgICogZnVuY3Rpb24gaXMgZ3VhcmFudGVlZCB0byBiZSBjYWxsZWQgb25jZSBmb3IgZWFjaCB0aW1lCiAgICAgKiB0aGF0IGJlZ2luR3JvdXAgaXMgY2FsbGVkOyB0aGUgb3JkZXIgd2lsbCBiZSBuZXN0ZWQgYW5kCiAgICAgKiBwcm9wZXJseSBiYWxhbmNlZC4gVGhlIHBhdGggYXJndW1lbnQgaXMgdGhlIHNhbWUgYXMgaXQgd2FzCiAgICAgKiBmb3IgdGhlIGNvcnJlc3BvbmRpbmcgYmVnaW5Hcm91cCBjYWxsOyBzZWUgYmVnaW5Hcm91cC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwYXRoCiAgICAgKi8KICAgIHRoaXMuZW5kR3JvdXAgPSBmdW5jdGlvbiAocGF0aCkgewogICAgICAgIHRoaXMuZGVwdGggLT0gMTsKICAgICAgICByZXR1cm4gJzwvdGJvZHk+JzsKICAgIH07CgogICAgLyoqCiAgICAgKiBDYWxsZWQgYnkgdGhlIGZvcm1zIGxheWVyIHdoZW4gaXQgZW5jb3VudGVycyBhbnkgcmVndWxhcgogICAgICogZmllbGQgLS0gaS5lLiBvbmUgdGhhdCBpcyBuZWl0aGVyIGFuIGVtYmVkIG5vciBhbiBlbWJlZExpc3QuCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IGZpZWxkCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwYXRoCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWUKICAgICAqIEBwYXJhbSB7U3RyaW5nfSByYXcKICAgICAqIEBwYXJhbSB7QXJyYXl9IGVycm9ycwogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgd2lkZ2V0IG9wdGlvbnMsIHdoaWNoCiAgICAgKiAgICAgICAgICB3aWxsIHVsdGltYXRlbHkgYmUgcHJvdmlkZWQgdG8gZWFjaCB3aWRnZXQncyB0b0hUTUwgbWV0aG9kLgogICAgICovCiAgICB0aGlzLmZpZWxkID0gZnVuY3Rpb24gKGZpZWxkLCBwYXRoLCB2YWx1ZSwgcmF3LCBlcnJvcnMsIG9wdGlvbnMpIHsKICAgICAgICB2YXIgbmFtZSA9IHBhdGguam9pbignLicpOwogICAgICAgIHZhciBpZCA9IChwYXRoLmpvaW4oJ18nKSArICdfZmllbGQnKTsKICAgICAgICB2YXIgY2FwdGlvbiA9IHBhdGguc2xpY2UodGhpcy5kZXB0aCkuam9pbignICcpOwoKICAgICAgICBldmVudHMub25jZSgncmVuZGVyRmluaXNoJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoZmllbGQud2lkZ2V0LmNsaWVudEluaXQpIHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGZpZWxkLndpZGdldC5jbGllbnRJbml0KAogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZCwgcGF0aCwgdmFsdWUsIHJhdywgZXJyb3JzLCAob3B0aW9ucyB8fCB7fSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgaWYgKGZpZWxkLndpZGdldC50eXBlID09PSAnaGlkZGVuJykgewogICAgICAgICAgICByZXR1cm4gZmllbGQud2lkZ2V0LnRvSFRNTCgKICAgICAgICAgICAgICAgIG5hbWUsIHZhbHVlLCByYXcsIGZpZWxkLCAob3B0aW9ucyB8fCB7fSkKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIHZhciBydiA9ICgKICAgICAgICAgICAgJzx0ciBpZD0iJyArIGlkICsgJyIgY2xhc3M9IicgKwogICAgICAgICAgICAgICAgZXhwb3J0cy5jbGFzc2VzKGZpZWxkLCBlcnJvcnMpLmpvaW4oJyAnKSArICciPicgKwogICAgICAgICAgICAgICAgJzx0aD4nICsKICAgICAgICAgICAgICAgICAgICBleHBvcnRzLmxhYmVsSFRNTChmaWVsZCwgY2FwdGlvbikgKwogICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuZGVzY3JpcHRpb25IVE1MKGZpZWxkKSArCiAgICAgICAgICAgICAgICAnPC90aD4nICsKICAgICAgICAgICAgICAgICc8dGQ+JyArCiAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5lcnJvckhUTUwoZXJyb3JzKSArCiAgICAgICAgICAgICAgICAgICAgZmllbGQud2lkZ2V0LnRvSFRNTCgKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSwgdmFsdWUsIHJhdywgZmllbGQsIChvcHRpb25zIHx8IHt9KQogICAgICAgICAgICAgICAgICAgICkgKwogICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuaGludEhUTUwoZmllbGQpICsKICAgICAgICAgICAgICAgICc8L3RkPicgKwogICAgICAgICAgICAnPC90cj4nCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gcnY7CiAgICB9OwoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5IHRoZSBmb3JtcyBsYXllciB3aGVuIGl0IGlzIGZpbmlzaGVkIHJlbmRlcmluZyBhIGZvcm0uCiAgICAgKiBNYXJrdXAgcmV0dXJuZWQgZnJvbSB0aGlzIGZ1bmN0aW9uIGlzIGFwcGVuZGVkIHRvIHRoZSBmb3JtIG91dHB1dC4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZmllbGQKICAgICAqIEBwYXJhbSB7QXJyYXl9IHBhdGgKICAgICAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZQogICAgICogQHBhcmFtIHtTdHJpbmd9IHJhdwogICAgICogQHBhcmFtIHtBcnJheX0gZXJyb3JzCiAgICAqLwogICAgdGhpcy5lbmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICc8L3RhYmxlPic7CiAgICB9OwoKfTsKCi8qKgogKiAgUmVuZGVycyBhIGZvcm0gdXNpbmcgYSBzZXJpZXMgb2YgcHJvcGVybHktbmVzdGVkIDxkaXY+IHRhZ3MuCiAqICBUaGVzZSA8ZGl2PnMgYXJlIGxhYmVsbGVkIHdpdGggc3BlY2lmaWMgQ1NTIGNsYXNzZXMsIHNvbWUgb2Ygd2hpY2gKICogIHByb3ZpZGUgZGVwdGggaW5mb3JtYXRpb24gKHdpdGggdGhlIGFpbSBvZiBzaW1wbGlmeWluZyBDU1MgcnVsZXMpLgogKiAgU2VlIHN0eWxlLmNzcyBmb3IgZGV0YWlscyBvbiBob3cgdG8gc3R5bGUgdGhpcyBvdXRwdXQuCiAqLwpleHBvcnRzLmRpdiA9IGZ1bmN0aW9uICgpIHsKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IgZm9yIHJlbmRlcmVyOyBpbml0aWFsaXplcyBvYmplY3QuIFRoZSBzdHJpbmcgcmV0dXJuZWQKICAgICAqIGZyb20gdGhpcyBmdW5jdGlvbiBpcyBwcmVwZW5kZWQgdG8gdGhlIGZvcm0ncyBtYXJrdXAuCiAgICAgKgogICAgICogQGNvbnN0cnVjdG9yCiAgICAqLwogICAgdGhpcy5zdGFydCA9IGZ1bmN0aW9uIChlcnJzKSB7CiAgICAgICAgdGhpcy5kZXB0aCA9IDA7CiAgICAgICAgdmFyIGh0bWwgPSAnPGRpdiBjbGFzcz0icmVuZGVyLWRpdiI+JzsKICAgICAgICBpZiAoZXJycyAmJiBlcnJzLmxlbmd0aCkgewogICAgICAgICAgICBodG1sICs9ICc8dWwgY2xhc3M9ImVycm9ycyI+JzsKICAgICAgICAgICAgXy5lYWNoKGVycnMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBodG1sICs9ICc8bGk+JyArIChlLm1lc3NhZ2UgfHwgZS50b1N0cmluZygpKSArICc8L2xpPic7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBodG1sICs9ICc8L3VsPic7CiAgICAgICAgfQogICAgICAgIHJldHVybiBodG1sOwogICAgfTsKCiAgICAvKioKICAgICAqIENhbGxlZCBieSB0aGUgZm9ybXMgbGF5ZXIgd2hlbiBpdCBlbmNvdW50ZXJzIGEgbmV3CiAgICAgKiBuZXN0aW5nIGNvbnRleHQgKGkuZS4gYSBuZXcgZ3JvdXBpbmcgb2YgZmllbGRzKS4gVGhlCiAgICAgKiBwYXRoIHBhcmFtZXRlciBpcyBhbiBhcnJheSBvZiBzdHJpbmdzIHRoYXQgZGVzY3JpYmVzCiAgICAgKiB0aGUgcGF0aCAoaW4gdGVybXMgb2YgZG9jdW1lbnQga2V5cykgdG8gdGhlIG5ldyBncm91cC4KICAgICAqIFdoZW4gY29uY2F0ZW5hdGVkIHRvZ2V0aGVyIHdpdGggYSBkb3QsIHRoaXMgYXJyYXkgeWllbGRzCiAgICAgKiB0aGUgbmV3IHByZWZpeCBmb3IgbmFtZWQgSFRNTCBmb3JtIGZpZWxkcy4KICAgICAqCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwYXRoCiAgICAqLwogICAgdGhpcy5iZWdpbkdyb3VwID0gZnVuY3Rpb24gKHBhdGgpIHsKICAgICAgICB0aGlzLmRlcHRoICs9IDE7CiAgICAgICAgdmFyIG5hbWUgPSBfLmxhc3QocGF0aCk7CiAgICAgICAgdmFyIGNzc19jbGFzcyA9ICdsZXZlbC0nICsgdGhpcy5kZXB0aDsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAnPGRpdiBjbGFzcz0iZ3JvdXAgJyArIGgoY3NzX2NsYXNzKSArICciPicgKwogICAgICAgICAgICAnPGRpdiBjbGFzcz0iaGVhZGluZyI+JyArCiAgICAgICAgICAgICAgICBoKG5hbWUuc3Vic3RyKDAsIDEpLnRvVXBwZXJDYXNlKCkgKwogICAgICAgICAgICAgICAgICAgIG5hbWUuc3Vic3RyKDEpLnJlcGxhY2UoL18vZywgJyAnKSkgKwogICAgICAgICAgICAnPC9kaXY+JwogICAgICAgICk7CiAgICB9OwoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5IHRoZSBmb3JtcyBsYXllciB3aGVuIGl0IGVuY291bnRlcnMgdGhlIGVuZAogICAgICogb2YgYSBuZXN0aW5nIGNvbnRleHQuIEluIHRoZSBhYnNlbmNlIG9mIGVycm9ycywgdGhpcwogICAgICogZnVuY3Rpb24gaXMgZ3VhcmFudGVlZCB0byBiZSBjYWxsZWQgb25jZSBmb3IgZWFjaCB0aW1lCiAgICAgKiB0aGF0IGJlZ2luR3JvdXAgaXMgY2FsbGVkOyB0aGUgb3JkZXIgd2lsbCBiZSBuZXN0ZWQgYW5kCiAgICAgKiBwcm9wZXJseSBiYWxhbmNlZC4gVGhlIHBhdGggYXJndW1lbnQgaXMgdGhlIHNhbWUgYXMgaXQgd2FzCiAgICAgKiBmb3IgdGhlIGNvcnJlc3BvbmRpbmcgYmVnaW5Hcm91cCBjYWxsOyBzZWUgYmVnaW5Hcm91cC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwYXRoCiAgICAqLwogICAgdGhpcy5lbmRHcm91cCA9IGZ1bmN0aW9uIChwYXRoKSB7CiAgICAgICAgdGhpcy5kZXB0aCAtPSAxOwogICAgICAgIHJldHVybiAnPC9kaXY+JzsKICAgIH07CgogICAgLyoqCiAgICAgKiBDYWxsZWQgYnkgdGhlIGZvcm1zIGxheWVyIHdoZW4gaXQgZW5jb3VudGVycyBhbnkgcmVndWxhcgogICAgICogZmllbGQgLS0gaS5lLiBvbmUgdGhhdCBpcyBuZWl0aGVyIGFuIGVtYmVkIG5vciBhbiBlbWJlZExpc3QuCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IGZpZWxkCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwYXRoCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWUKICAgICAqIEBwYXJhbSB7U3RyaW5nfSByYXcKICAgICAqIEBwYXJhbSB7QXJyYXl9IGVycm9ycwogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgd2lkZ2V0IG9wdGlvbnMsIHdoaWNoCiAgICAgKiAgICAgICAgICB3aWxsIHVsdGltYXRlbHkgYmUgcHJvdmlkZWQgdG8gZWFjaCB3aWRnZXQncyB0b0hUTUwgbWV0aG9kLgogICAgKi8KICAgIHRoaXMuZmllbGQgPSBmdW5jdGlvbiAoZmllbGQsIHBhdGgsIHZhbHVlLCByYXcsIGVycm9ycywgb3B0aW9ucykgewogICAgICAgIHZhciBuYW1lID0gcGF0aC5qb2luKCcuJyk7CiAgICAgICAgdmFyIGNhcHRpb24gPSBwYXRoLnNsaWNlKHRoaXMuZGVwdGgpLmpvaW4oJyAnKTsKICAgICAgICBpZiAoZmllbGQud2lkZ2V0LnR5cGUgPT09ICdoaWRkZW4nKSB7CiAgICAgICAgICAgIHJldHVybiBmaWVsZC53aWRnZXQudG9IVE1MKAogICAgICAgICAgICAgICAgbmFtZSwgdmFsdWUsIHJhdywgZmllbGQsIChvcHRpb25zIHx8IHt9KQogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAnPGRpdiBjbGFzcz0iJyArCiAgICAgICAgICAgICAgICBleHBvcnRzLmNsYXNzZXMoZmllbGQsIGVycm9ycykuam9pbignICcpICsgJyI+JyArCiAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJzY2FsYXIiPicgKwogICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImxhYmVsIj4nICsKICAgICAgICAgICAgICAgICAgICAnPGxhYmVsIGZvcj0iJyArIGgobmFtZSkgKyAnIj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5sYWJlbEhUTUwoZmllbGQsIGNhcHRpb24pICsKICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5kZXNjcmlwdGlvbkhUTUwoZmllbGQpICsKICAgICAgICAgICAgICAgICAgICAnPC9sYWJlbD4nICsKICAgICAgICAgICAgICAgICc8L2Rpdj4nICsKICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJjb250ZW50Ij4nICsKICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iaW5uZXIiPicgKwogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC53aWRnZXQudG9IVE1MKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSwgdmFsdWUsIHJhdywgZmllbGQsIChvcHRpb25zIHx8IHt9KQogICAgICAgICAgICAgICAgICAgICAgICApICsKICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyArCiAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImhpbnQiPicgKwogICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzLmhpbnRIVE1MKGZpZWxkKSArCiAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicgKwogICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJlcnJvcnMiPicgKwogICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzLmVycm9ySFRNTChlcnJvcnMpICsKICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyArCiAgICAgICAgICAgICAgICAnPC9kaXY+JyArCiAgICAgICAgICAgICc8L2Rpdj4nICsKICAgICAgICAgICAgJzwvZGl2PicKICAgICAgICApOwogICAgfTsKCiAgICAvKioKICAgICAqIENhbGxlZCBieSB0aGUgZm9ybXMgbGF5ZXIgd2hlbiBpdCBpcyBmaW5pc2hlZCByZW5kZXJpbmcgYSBmb3JtLgogICAgICogTWFya3VwIHJldHVybmVkIGZyb20gdGhpcyBmdW5jdGlvbiBpcyBhcHBlbmRlZCB0byB0aGUgZm9ybSBvdXRwdXQuCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IGZpZWxkCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwYXRoCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWUKICAgICAqIEBwYXJhbSB7U3RyaW5nfSByYXcKICAgICAqIEBwYXJhbSB7QXJyYXl9IGVycm9ycwogICAgKi8KICAgIHRoaXMuZW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAnPC9kaXY+JzsKICAgIH07Cn07CgoKCn0pfTsKCi8qKioqKioqKioqIGthbnNvL2ZpZWxkcyAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImthbnNvL2ZpZWxkcyJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKioKICogVGhlIGJ1aWxkaW5nIGJsb2NrcyBvZiBUeXBlcyBhbmQgRm9ybXMsIEZpZWxkcyBoZWxwIHRvIHZhbGlkYXRlIGFuZCBhdXRob3JpemUKICogY2hhbmdlcyB0byBkb2N1ZW1udCB2YWx1ZXMuCiAqCiAqIEBtb2R1bGUKICovCgoKLyoqCiAqIE1vZHVsZSBkZXBlbmRlbmNpZXMKICovCgp2YXIgcGVybWlzc2lvbnMgPSByZXF1aXJlKCcuL3Blcm1pc3Npb25zJyksCiAgICB2YWxpZGF0b3JzID0gcmVxdWlyZSgnLi92YWxpZGF0b3JzJyksCiAgICB3aWRnZXRzID0gcmVxdWlyZSgnLi93aWRnZXRzJyksCiAgICB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMnKSwKICAgIF8gPSByZXF1aXJlKCcuL3VuZGVyc2NvcmUnKS5fOwoKCi8qKgogKiBGaWVsZCBvYmplY3RzIGFyZSB1c2VkIHdoZW4gY29uc3RydWN0aW5nIGNvbnRlbnQgdHlwZXMgYW5kIGZvcm1zLgogKgogKiAjIyMjIE9wdGlvbnMgIyMjIwogKgogKiAqICoqb21pdF9lbXB0eSoqICAqQm9vbGVhbiogLSB3aGV0aGVyIHRvIG9taXQgdGhlIGZpZWxkIGZyb20gYSBkb2N1bWVudCB3aGVuCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBmaWVsZCBpcyBlbXB0eQogKiAqICoqcGVybWlzc2lvbnMqKiAqT2JqZWN0KiAgLSBhIHBlcm1pc3Npb25zIGNoZWNrIGZ1bmN0aW9uIG9yIGFuIG9iamVjdAogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluaW5nIHNlcGFyYXRlIGZ1bmN0aW9ucyB0byBydW4gb24gY3JlYXRlLAogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0IGFuZCB1cGRhdGUgb3BlcmF0aW9ucy4KICogKiAqKnZhbGlkYXRvcnMqKiAgKkFycmF5KiAgIC0gYW4gYXJyYXkgb2YgdmFsaWRhdGlvbiBmdW5jdGlvbnMgKGRlZmF1bHQ6IFtdKQogKiAqICoqcmVxdWlyZWQqKiAgICAqQm9vbGVhbiogLSB3aGV0aGVyIHRoZSBmaWVsZCBpcyByZXF1aXJlZCAoZGVmYXVsdDogdHJ1ZSkKICoKICogQGNvbnN0cnVjdG9yCiAqIEBuYW1lIEZpZWxkCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAqIEBhcGkgcHVibGljCiAqLwoKdmFyIEZpZWxkID0gZXhwb3J0cy5GaWVsZCA9IGZ1bmN0aW9uIEZpZWxkKG9wdGlvbnMpIHsKICAgIF8uZXh0ZW5kKHRoaXMsIF8uZGVmYXVsdHMob3B0aW9ucyB8fCB7fSwgewogICAgICAgIHdpZGdldDogd2lkZ2V0cy50ZXh0KCksCiAgICAgICAgb21pdF9lbXB0eTogZmFsc2UsCiAgICAgICAgcGVybWlzc2lvbnM6IHt9LAogICAgICAgIHZhbGlkYXRvcnM6IFtdLAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9KSk7CiAgICByZXR1cm4gdGhpczsKfTsKCgovKioKICogUGFyc2VzIGEgcmF3IHZhbHVlIHJldHVybmluZyB0aGUgY29ycmVjdCBKYXZhU2NyaXB0IHR5cGUgZm9yIHRoaXMgZmllbGQuCiAqIFRoaXMgd2lsbCB1c3VhbGx5IGJlIG92ZXJyaWRkZW4gYnkgb3RoZXIgZmllbGQgdHlwZXMuCiAqCiAqIEBuYW1lIEZpZWxkLnBhcnNlKHJhdykKICogQHBhcmFtIHJhdwogKiBAYXBpIHB1YmxpYwogKi8KCkZpZWxkLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChyYXcpIHsKICAgIHJldHVybiByYXc7Cn07CgoKLyoqCiAqIFRlc3QgdmFsdWVzIHRvIHNlZSBpZiBmaWVsZCBpcyBjb25zaWRlcmVkIGVtcHR5LgogKgogKiBUaGlzIGZ1bmN0aW9uIGFjY2VwdHMgdGhlIHJhdyB2YWx1ZSBldmVuIHRob3VnaCBieSBkZWZhdWx0IGl0IG9ubHkKICogY2hlY2tzIHRoZSBwYXJzZWQgdmFsdWUsIHNvIHRoYXQgb3RoZXIgZmllbGQgdHlwZXMgb3ZlcnJpZGRpbmcgdGhpcyBtZXRob2QKICogaGF2ZSB0aGUgcmF3IGRhdGEgYXZhaWxhYmxlLgogKgogKiBAbmFtZSBGaWVsZC5pc0VtcHR5KHZhbHVlLCByYXcpCiAqIEBwYXJhbSB2YWx1ZSAtIHRoZSBwYXJzZWQgdmFsdWUgZm9yIHRoZSBmaWVsZAogKiBAcGFyYW0gcmF3IC0gdGhlIHJhdyB2YWx1ZSBmb3IgdGhpcyBmaWVsZAogKiBAcmV0dXJucyB7Qm9vbGVhbn0KICogQGFwaSBwdWJsaWMKICovCgpGaWVsZC5wcm90b3R5cGUuaXNFbXB0eSA9IGZ1bmN0aW9uICh2YWx1ZSwgcmF3KSB7CiAgICBpZiAocmF3ID09PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiBpc05hTih2YWx1ZSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJhdyA9IHZhbHVlOwogICAgfQogICAgcmV0dXJuIChyYXcgPT09ICcnIHx8IHJhdyA9PT0gbnVsbCB8fCByYXcgPT09IHVuZGVmaW5lZCk7Cn07CgovKioKICogUnVuIHRoZSBmaWVsZCdzIHZhbGlkYXRpb24gZnVuY3Rpb25zIGFnYWluc3QgYSB2YWx1ZS4gUmV0dXJucyBhbgogKiBhcnJheSBvZiB2YWxpZGF0aW9uIGVycm9ycywgb3IgYW4gZW1wdHkgYXJyYXkgaWYgdmFsaWQuCiAqCiAqIEBuYW1lIEZpZWxkLnZhbGlkYXRlKGRvYywgdmFsdWUsIHJhdykKICogQHBhcmFtIHtPYmplY3R9IGRvYwogKiBAcGFyYW0gdmFsdWUKICogQHBhcmFtIHJhdwogKiBAcmV0dXJucyB7QXJyYXl9CiAqIEBhcGkgcHVibGljCiAqLwoKRmllbGQucHJvdG90eXBlLnZhbGlkYXRlID0gZnVuY3Rpb24gKGRvYywgdmFsdWUsIHJhdykgewogICAgLy8gZG9uJ3QgdmFsaWRhdGUgZW1wdHkgZmllbGRzLCBidXQgY2hlY2sgaWYgcmVxdWlyZWQKICAgIGlmICh0aGlzLmlzRW1wdHkodmFsdWUsIHJhdykpIHsKICAgICAgICBpZiAodGhpcy5yZXF1aXJlZCkgewogICAgICAgICAgICByZXR1cm4gWyBuZXcgRXJyb3IoJ1JlcXVpcmVkIGZpZWxkJykgXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgcmV0dXJuIF8ucmVkdWNlKHRoaXMudmFsaWRhdG9ycywgZnVuY3Rpb24gKGVycnMsIHYpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBjaGVjayB0aGF0IHYgaXMgYWN0dWFsbHkgYSBmdW5jdGlvbiwgc2luY2UgSUUgbGlrZXMgdG8KICAgICAgICAgICAgLy8gaW5zZXJ0IG51bGxzIGhlcmUgZm9yIHNvbWUgcmVhc29uCiAgICAgICAgICAgIGlmICh2KSB7CiAgICAgICAgICAgICAgICBlcnJzID0gZXJycy5jb25jYXQodihkb2MsIHZhbHVlLCByYXcpIHx8IFtdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICBlcnJzLnB1c2goZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBlcnJzOwogICAgfSwgW10pOwp9OwoKLyoqCiAqIENoZWNrIHJlbGV2YW50IGZpZWxkIHBlcm1pc3Npb25zIHRvIHNlZSBpZiB1c2VyIGlzIGF1dGhvcmlzZWQgdG8gbWFrZQogKiBjaGFuZ2VzLiBSZXR1cm5zIGFuIGFycmF5IG9mIHBlcm1pc3Npb25zIGVycm9ycywgb3IgYW4gZW1wdHkgYXJyYXkgaWYgdGhlCiAqIGNoYW5nZXMgYXJlIHBlcm1pc3NpYmxlLgogKgogKiBAbmFtZSBGaWVsZC5hdXRob3JpemUobmV3RG9jLCBvbGREb2MsIG5ld1ZhbCwgb2xkVmFsLCB1c2VyQ3R4KQogKiBAcGFyYW0ge09iamVjdH0gbmV3RG9jCiAqIEBwYXJhbSB7T2JqZWN0fSBvbGREb2MKICogQHBhcmFtIG5ld1ZhbAogKiBAcGFyYW0gb2xkVmFsCiAqIEBwYXJhbSB7T2JqZWN0fSB1c2VyQ3R4CiAqIEByZXR1cm5zIHtBcnJheX0KICogQGFwaSBwdWJsaWMKICovCgpGaWVsZC5wcm90b3R5cGUuYXV0aG9yaXplID0gZnVuY3Rpb24gKG5ld0RvYywgb2xkRG9jLCBuZXdWYWwsIG9sZFZhbCwgdXNlckN0eCkgewogICAgdmFyIHBlcm1zID0gdGhpcy5wZXJtaXNzaW9uczsKICAgIHZhciBlcnJvcnMgPSBbXTsKICAgIGlmIChfLmlzRnVuY3Rpb24ocGVybXMpKSB7CiAgICAgICAgZXJyb3JzID0gZXJyb3JzLmNvbmNhdCgKICAgICAgICAgICAgdXRpbHMuZ2V0RXJyb3JzKHBlcm1zLCBhcmd1bWVudHMpCiAgICAgICAgKTsKICAgIH0KICAgIC8vIG9uIHVwZGF0ZQogICAgdmFyIGZuOwogICAgLy8gb24gYWRkCiAgICBpZiAobmV3RG9jICYmICFvbGREb2MpIHsKICAgICAgICBmbiA9IHBlcm1zLmFkZDsKICAgIH0KICAgIC8vIG9uIHJlbW92ZQogICAgZWxzZSBpZiAoIW5ld0RvYyB8fCBuZXdEb2MuX2RlbGV0ZWQpIHsKICAgICAgICBmbiA9IHBlcm1zLnJlbW92ZTsKICAgIH0KICAgIC8vIG9uIHVwZGF0ZQogICAgZWxzZSBpZiAobmV3VmFsICE9PSBvbGRWYWwpIHsKICAgICAgICBmbiA9IHBlcm1zLnVwZGF0ZTsKICAgIH0KICAgIGlmIChmbikgewogICAgICAgIGVycm9ycyA9IGVycm9ycy5jb25jYXQoCiAgICAgICAgICAgIHV0aWxzLmdldEVycm9ycyhmbiwgYXJndW1lbnRzKQogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4gZXJyb3JzOwp9OwoKCi8qKgogKiBFbWJlZGRlZCBvYmplY3RzIHJlcHJlc2VudCBhIFR5cGUgZW1iZWRkZWQgd2l0aGluIGFub3RoZXIgVHlwZSBvciBzZXQgb2YKICogRmllbGRzLiBJdHMgbm90IGEgdHJ1ZSBmaWVsZCwgYnV0IGxpa2UgdGhlIEZpZWxkIGNvbnN0cnVjdG9yIGl0IGFjdHMgYXMgYQogKiBtYXJrZXIgd2hlbiB3YWxraW5nIHRocm91Z2ggdGhlIHN1Yi1vYmplY3RzIHRoYXQgbWFrZSB1cCBhIHNjaGVtYS4KICoKICogRXhwb3NlcyB0aGUgc2FtZSBtZXRob2RzIGFzIEZpZWxkIG9iamVjdHMuCiAqCiAqICMjIyMgT3B0aW9ucyAjIyMjCiAqCiAqICogKip0eXBlKiogICAgICAgICpUeXBlIE9iamVjdCogIC0gUmVxdWlyZWQsIHRoZSBUeXBlIGRlZmluaXRpb24gdG8gZW1iZWQKICogKiAqKm9taXRfZW1wdHkqKiAgKkJvb2xlYW4qIC0gd2hldGhlciB0byBvbWl0IHRoZSBmaWVsZCBmcm9tIGEgZG9jdW1lbnQgd2hlbgogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgZmllbGQgaXMgZW1wdHkKICogKiAqKnBlcm1pc3Npb25zKiogKk9iamVjdCogIC0gYSBwZXJtaXNzaW9ucyBjaGVjayBmdW5jdGlvbiBvciBhbiBvYmplY3QKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmluZyBzZXBhcmF0ZSBmdW5jdGlvbnMgdG8gcnVuIG9uIGNyZWF0ZSwKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdCBhbmQgdXBkYXRlIG9wZXJhdGlvbnMuCiAqICogKip2YWxpZGF0b3JzKiogICpBcnJheSogICAtIGFuIGFycmF5IG9mIHZhbGlkYXRpb24gZnVuY3Rpb25zIChkZWZhdWx0OiBbXSkKICogKiAqKnJlcXVpcmVkKiogICAgKkJvb2xlYW4qIC0gd2hldGhlciB0aGUgZmllbGQgaXMgcmVxdWlyZWQgKGRlZmF1bHQ6IHRydWUpCiAqCiAqIEBuYW1lIEVtYmVkZGVkCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAqIEBjb25zdHJ1Y3RvcgogKiBAYXBpIHB1YmxpYwogKi8KCnZhciBFbWJlZGRlZCA9IGV4cG9ydHMuRW1iZWRkZWQgPSBmdW5jdGlvbiBFbWJlZGRlZChvcHRpb25zKSB7CiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgIHZhciB0eXBlID0gb3B0aW9ucy50eXBlOwogICAgaWYgKCF0eXBlKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyB0eXBlIHNwZWNpZmllZCcpOwogICAgfQogICAgb3B0aW9ucy5wZXJtaXNzaW9ucyA9IF8uZGVmYXVsdHMoKG9wdGlvbnMucGVybWlzc2lvbnMgfHwge30pLCB7CiAgICAgICAgYWRkOiBwZXJtaXNzaW9ucy5pbmhlcml0KHR5cGUpLAogICAgICAgIHJlbW92ZTogcGVybWlzc2lvbnMuaW5oZXJpdCh0eXBlKSwKICAgICAgICB1cGRhdGU6ICAgcGVybWlzc2lvbnMuaW5oZXJpdCh0eXBlKQogICAgfSk7CiAgICBfLmV4dGVuZCh0aGlzLCBfLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgfSkpOwogICAgdGhpcy50eXBlID0gdHlwZTsKfTsKCi8qKgogKiBUZXN0IHZhbHVlcyB0byBzZWUgaWYgZmllbGQgaXMgY29uc2lkZXJlZCBlbXB0eS4KICoKICogVGhpcyBmdW5jdGlvbiBhY2NlcHRzIHRoZSByYXcgdmFsdWUgZXZlbiB0aG91Z2ggYnkgZGVmYXVsdCBpdCBvbmx5CiAqIGNoZWNrcyB0aGUgcGFyc2VkIHZhbHVlLCBzbyB0aGF0IG90aGVyIGZpZWxkIHR5cGVzIG92ZXJyaWRkaW5nIHRoaXMgbWV0aG9kCiAqIGhhdmUgdGhlIHJhdyBkYXRhIGF2YWlsYWJsZS4KICoKICogQG5hbWUgRW1iZWRkZWQuaXNFbXB0eSh2YWx1ZSwgcmF3KQogKiBAcGFyYW0gdmFsdWUgLSB0aGUgcGFyc2VkIHZhbHVlIGZvciB0aGUgZmllbGQKICogQHBhcmFtIHJhdyAtIHRoZSByYXcgdmFsdWUgZm9yIHRoaXMgZmllbGQKICogQGFwaSBwdWJsaWMKICovCgpFbWJlZGRlZC5wcm90b3R5cGUuaXNFbXB0eSA9IGZ1bmN0aW9uICh2YWx1ZSwgcmF3KSB7CiAgICByZXR1cm4gKHZhbHVlID09PSAnJyB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKTsKfTsKCi8qKgogKiBSdW4gdGhlIHR5cGUncyB2YWxpZGF0ZSBmdW5jdGlvbiBhZ2FpbnN0IGEgdmFsdWUuIFJldHVybnMgYW4KICogYXJyYXkgb2YgdmFsaWRhdGlvbiBlcnJvcnMsIG9yIGFuIGVtcHR5IGFycmF5IGlmIHZhbGlkLgogKgogKiBAbmFtZSBFbWJlZGRlZC52YWxpZGF0ZShkb2MsIHZhbHVlLCByYXcpCiAqIEBwYXJhbSB7T2JqZWN0fSBkb2MKICogQHBhcmFtIHZhbHVlCiAqIEBwYXJhbSByYXcKICogQHJldHVybnMge0FycmF5fQogKiBAYXBpIHB1YmxpYwogKi8KCkVtYmVkZGVkLnByb3RvdHlwZS52YWxpZGF0ZSA9IGZ1bmN0aW9uIChkb2MsIHZhbHVlLCByYXcpIHsKICAgIC8vIGRvbid0IHZhbGlkYXRlIGVtcHR5IGZpZWxkcywgYnV0IGNoZWNrIGlmIHJlcXVpcmVkCiAgICBpZiAodGhpcy5pc0VtcHR5KHZhbHVlLCByYXcpKSB7CiAgICAgICAgaWYgKHRoaXMucmVxdWlyZWQpIHsKICAgICAgICAgICAgcmV0dXJuIFsgbmV3IEVycm9yKCdSZXF1aXJlZCBmaWVsZCcpIF07CiAgICAgICAgfQogICAgICAgIHJldHVybiBbXTsKICAgIH0KICAgIGlmICghdmFsdWUuX2lkKSB7CiAgICAgICAgcmV0dXJuIFtuZXcgRXJyb3IoJ0VtYmVkZGVkIGRvY3VtZW50IG1pc3NpbmcgX2lkJyldOwogICAgfQogICAgcmV0dXJuIHRoaXMudHlwZS52YWxpZGF0ZSh2YWx1ZSwgcmF3KTsKfTsKCi8qKgogKiBDaGVjayByZWxldmFudCB0eXBlIHBlcm1pc3Npb25zIHRvIHNlZSBpZiB1c2VyIGlzIGF1dGhvcmlzZWQgdG8gbWFrZQogKiBjaGFuZ2VzLiBSZXR1cm5zIGFuIGFycmF5IG9mIHBlcm1pc3Npb25zIGVycm9ycywgb3IgYW4gZW1wdHkgYXJyYXkgaWYgdGhlCiAqIGNoYW5nZXMgYXJlIHBlcm1pc3NpYmxlLgogKgogKiBAbmFtZSBFbWJlZGRlZC5hdXRob3JpemUobmV3RG9jLCBvbGREb2MsIG5ld1ZhbCwgb2xkVmFsLCB1c2VyKQogKiBAcGFyYW0ge09iamVjdH0gbmV3RG9jCiAqIEBwYXJhbSB7T2JqZWN0fSBvbGREb2MKICogQHBhcmFtIG5ld1ZhbAogKiBAcGFyYW0gb2xkVmFsCiAqIEBwYXJhbSB7T2JqZWN0fSB1c2VyCiAqIEByZXR1cm5zIHtBcnJheX0KICogQGFwaSBwdWJsaWMKICovCgpFbWJlZGRlZC5wcm90b3R5cGUuYXV0aG9yaXplID0gZnVuY3Rpb24gKG5ld0RvYywgb2xkRG9jLCBuZXdWYWwsIG9sZFZhbCwgdXNlcikgewogICAgaWYgKG5ld1ZhbCAmJiBvbGRWYWwgJiYgbmV3VmFsLl9pZCAhPT0gb2xkVmFsLl9pZCkgewogICAgICAgIG9sZFZhbCA9IHVuZGVmaW5lZDsKICAgIH0KICAgIHJldHVybiB0aGlzLnR5cGUuYXV0aG9yaXplKG5ld1ZhbCB8fCB7X2RlbGV0ZWQ6IHRydWV9LCBvbGRWYWwsIHVzZXIpOwp9OwoKLyoqCiAqIEVtYmVkZGVkTGlzdCBvYmplY3RzIHJlcHJlc2VudCBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgYSBUeXBlIGVtYmVkZGVkIHdpdGhpbgogKiBhbm90aGVyIFR5cGUgb3Igc2V0IG9mIEZpZWxkcy4gSXRzIG5vdCBhIHRydWUgZmllbGQsIGJ1dCBsaWtlIHRoZSBGaWVsZAogKiBjb25zdHJ1Y3RvciBpdCBhY3RzIGFzIGEgbWFya2VyIHdoZW4gd2Fsa2luZyB0aHJvdWdoIHRoZSBzdWItb2JqZWN0cyB0aGF0CiAqIG1ha2UgdXAgYSBzY2hlbWEuCiAqCiAqIEV4cG9zZXMgdGhlIHNhbWUgbWV0aG9kcyBhcyBGaWVsZCBvYmplY3RzLgogKgogKiAjIyMjIE9wdGlvbnMgIyMjIwogKgogKiAqICoqdHlwZSoqICAgICAgICAqVHlwZSBPYmplY3QqICAtIFJlcXVpcmVkLCB0aGUgVHlwZSBkZWZpbml0aW9uIHRvIGVtYmVkCiAqICogKipvbWl0X2VtcHR5KiogICpCb29sZWFuKiAtIHdoZXRoZXIgdG8gb21pdCB0aGUgZmllbGQgZnJvbSBhIGRvY3VtZW50IHdoZW4KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGZpZWxkIGlzIGVtcHR5CiAqICogKipwZXJtaXNzaW9ucyoqICpPYmplY3QqICAtIGEgcGVybWlzc2lvbnMgY2hlY2sgZnVuY3Rpb24gb3IgYW4gb2JqZWN0CiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5pbmcgc2VwYXJhdGUgZnVuY3Rpb25zIHRvIHJ1biBvbiBjcmVhdGUsCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXQgYW5kIHVwZGF0ZSBvcGVyYXRpb25zLgogKiAqICoqdmFsaWRhdG9ycyoqICAqQXJyYXkqICAgLSBhbiBhcnJheSBvZiB2YWxpZGF0aW9uIGZ1bmN0aW9ucyAoZGVmYXVsdDogW10pCiAqICogKipyZXF1aXJlZCoqICAgICpCb29sZWFuKiAtIHdoZXRoZXIgdGhlIGZpZWxkIGlzIHJlcXVpcmVkIChkZWZhdWx0OiB0cnVlKQogKgogKiBAbmFtZSBFbWJlZGRlZExpc3QKICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICogQGNvbnN0cnVjdG9yCiAqIEBhcGkgcHVibGljCiAqLwoKdmFyIEVtYmVkZGVkTGlzdCA9IGV4cG9ydHMuRW1iZWRkZWRMaXN0ID0gZnVuY3Rpb24gRW1iZWRkZWRMaXN0KG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgdmFyIHR5cGUgPSBvcHRpb25zLnR5cGU7CiAgICBpZiAoIXR5cGUpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHR5cGUgc3BlY2lmaWVkJyk7CiAgICB9CiAgICBvcHRpb25zLnBlcm1pc3Npb25zID0gXy5kZWZhdWx0cygob3B0aW9ucy5wZXJtaXNzaW9ucyB8fCB7fSksIHsKICAgICAgICBhZGQ6IHBlcm1pc3Npb25zLmluaGVyaXQodHlwZSksCiAgICAgICAgcmVtb3ZlOiBwZXJtaXNzaW9ucy5pbmhlcml0KHR5cGUpLAogICAgICAgIHVwZGF0ZTogICBwZXJtaXNzaW9ucy5pbmhlcml0KHR5cGUpCiAgICB9KTsKICAgIF8uZXh0ZW5kKHRoaXMsIF8uZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9KSk7CiAgICB0aGlzLnR5cGUgPSB0eXBlOwp9OwoKLyoqCiAqIFRlc3QgdmFsdWVzIHRvIHNlZSBpZiBmaWVsZCBpcyBjb25zaWRlcmVkIGVtcHR5LgogKgogKiBUaGlzIGZ1bmN0aW9uIGFjY2VwdHMgdGhlIHJhdyB2YWx1ZSBldmVuIHRob3VnaCBieSBkZWZhdWx0IGl0IG9ubHkKICogY2hlY2tzIHRoZSBwYXJzZWQgdmFsdWUsIHNvIHRoYXQgb3RoZXIgZmllbGQgdHlwZXMgb3ZlcnJpZGRpbmcgdGhpcyBtZXRob2QKICogaGF2ZSB0aGUgcmF3IGRhdGEgYXZhaWxhYmxlLgogKgogKiBAbmFtZSBFbWJlZGRlZExpc3QuaXNFbXB0eSh2YWx1ZSwgcmF3KQogKiBAcGFyYW0gdmFsdWUgLSB0aGUgcGFyc2VkIHZhbHVlIGZvciB0aGUgZmllbGQKICogQHBhcmFtIHJhdyAtIHRoZSByYXcgdmFsdWUgZm9yIHRoaXMgZmllbGQKICogQGFwaSBwdWJsaWMKICovCgpFbWJlZGRlZExpc3QucHJvdG90eXBlLmlzRW1wdHkgPSBmdW5jdGlvbiAodmFsdWUsIHJhdykgewogICAgcmV0dXJuICh2YWx1ZSA9PT0gJycgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCk7Cn07CgovKioKICogRGV0ZWN0cyBlbWJlZGRlZCBkb2N1bWVudHMgd2l0aCBtaXNzaW5nIF9pZCBwcm9wZXJ0aWVzIGFuZCByZXR1cm5zIGFuCiAqIGFycmF5IG9mIEVycm9yIG9iamVjdHMgZm9yIGVhY2ggb2NjdXJlbmNlLiBSZXR1cm5zIGFuIGVtcHR5IGFycmF5IGlmCiAqIGFsbCBkb2N1bWVudHMgaGF2ZSBhIHBvcHVsYXRlZCBfaWQgcHJvcGVydHkuCiAqCiAqIEBuYW1lIEVtYmVkZGVkTGlzdC5taXNzaW5nSURzKGxpc3QpCiAqIEBwYXJhbSB7QXJyYXl9IGxpc3QKICogQHJldHVybnMge0FycmF5fQogKiBAYXBpIHB1YmxpYwogKi8KCkVtYmVkZGVkTGlzdC5wcm90b3R5cGUubWlzc2luZ0lEcyA9IGZ1bmN0aW9uIChsaXN0KSB7CiAgICB2YXIgZXJycyA9IFtdOwogICAgXy5lYWNoKGxpc3QsIGZ1bmN0aW9uICh2LCBpKSB7CiAgICAgICAgaWYgKCF2Ll9pZCkgewogICAgICAgICAgICB2YXIgZSA9IG5ldyBFcnJvcignRW1iZWRkZWQgZG9jdW1lbnQgbWlzc2luZyBfaWQnKTsKICAgICAgICAgICAgZS5maWVsZCA9IFtpXTsKICAgICAgICAgICAgZXJycy5wdXNoKGUpOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIGVycnM7Cn07CgovKioKICogRGV0ZWN0cyBlbWJlZGRlZCBkb2N1bWVudHMgd2l0aCBkdXBsaWNhdGUgX2lkIHByb3BlcnRpZXMgYW5kIHJldHVybnMgYW4KICogYXJyYXkgb2YgRXJyb3Igb2JqZWN0cyBmb3IgZWFjaCBvY2N1cmVuY2UuIFJldHVybnMgYW4gZW1wdHkgYXJyYXkgaWYKICogYWxsIGRvY3VtZW50cyBoYXZlIGEgdW5pcXVlIF9pZCBwcm9wZXJ0eS4KICoKICogQG5hbWUgRW1iZWRkZWRMaXN0LmR1cGxpY2F0ZUlEcyhsaXN0KQogKiBAcGFyYW0ge0FycmF5fSBsaXN0CiAqIEByZXR1cm5zIHtBcnJheX0KICogQGFwaSBwdWJsaWMKICovCgpFbWJlZGRlZExpc3QucHJvdG90eXBlLmR1cGxpY2F0ZUlEcyA9IGZ1bmN0aW9uIChsaXN0KSB7CiAgICB2YXIgaWRzID0ge307CiAgICB2YXIgZXJycyA9IFtdOwogICAgXy5lYWNoKGxpc3QsIGZ1bmN0aW9uICh2LCBpKSB7CiAgICAgICAgaWYgKHYuX2lkIGluIGlkcykgewogICAgICAgICAgICB2YXIgZSA9IG5ldyBFcnJvcignRW1iZWRkZWQgZG9jdW1lbnQgZHVwbGljYXRlcyBhbiBleGlzdGluZyBfaWQnKTsKICAgICAgICAgICAgZS5maWVsZCA9IFtpXTsKICAgICAgICAgICAgZXJycy5wdXNoKGUpOwogICAgICAgIH0KICAgICAgICBpZHNbdi5faWRdID0gdHJ1ZTsKICAgIH0pOwogICAgcmV0dXJuIGVycnM7Cn07CgovKioKICogQ2hlY2tzIGZvciBtaXNzaW5nIG9yIGR1cGxpY2F0ZSBfaWRzIHRoZW4gcnVucyB0aGUgdHlwZSdzIHZhbGlkYXRlIGZ1bmN0aW9uCiAqIGFnYWluc3QgZWFjaCBlbWJlZGRlZCBkb2N1bWVudC4gUmV0dXJucyBhbiBhcnJheSBvZiB2YWxpZGF0aW9uIGVycm9ycywgb3IKICogYW4gZW1wdHkgYXJyYXkgaWYgdmFsaWQuCiAqCiAqIEBuYW1lIEVtYmVkZGVkTGlzdC52YWxpZGF0ZShkb2MsIHZhbHVlLCByYXcpCiAqIEBwYXJhbSB7T2JqZWN0fSBkb2MKICogQHBhcmFtIHZhbHVlCiAqIEBwYXJhbSByYXcKICogQHJldHVybnMge0FycmF5fQogKiBAYXBpIHB1YmxpYwogKi8KCkVtYmVkZGVkTGlzdC5wcm90b3R5cGUudmFsaWRhdGUgPSBmdW5jdGlvbiAoZG9jLCB2YWx1ZSwgcmF3KSB7CiAgICB2YXIgdHlwZSA9IHRoaXMudHlwZTsKCiAgICAvLyBkb24ndCB2YWxpZGF0ZSBlbXB0eSBmaWVsZHMsIGJ1dCBjaGVjayBpZiByZXF1aXJlZAogICAgaWYgKHRoaXMuaXNFbXB0eSh2YWx1ZSwgcmF3KSkgewogICAgICAgIGlmICh0aGlzLnJlcXVpcmVkKSB7CiAgICAgICAgICAgIHJldHVybiBbIG5ldyBFcnJvcignUmVxdWlyZWQgZmllbGQnKSBdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gW107CiAgICB9CgogICAgLy8gY2hlY2sgYWxsIHZhbHVlcyBhcmUgb2JqZWN0cwogICAgdmFyIG5vbl9vYmplY3RzID0gXy5maWx0ZXIodmFsdWUsIGZ1bmN0aW9uICh2KSB7CgogICAgICAgIC8qIFdvcmthcm91bmQgZm9yIGludGVycHJldGVyIGJ1ZzoKICAgICAgICAgICAgU2F2aW5nIGVtYmVkTGlzdCgpIGRhdGEgdGhyb3dzIGFuIGVycm9yIHdoZW4gcnVubmluZyBpbiBhCiAgICAgICAgICAgIENvdWNoREIgbGlua2VkIGFnYWluc3QganMtMS44LjAuIFdlIGVuY291bnRlciBhIHNpdHVhdGlvbiB3aGVyZQogICAgICAgICAgICB0eXBlb2YodikgPT09ICdvYmplY3QnLCBidXQgdGhlICd2IGluc3RhbmNlb2YgT2JqZWN0JyB0ZXN0CiAgICAgICAgICAgIGluY29ycmVjdGx5IHJldHVybnMgZmFsc2UuIFdlIHN1c3BlY3QgYW4gaW50ZXJwcmV0ZXIgYnVnLgogICAgICAgICAgICBQbGVhc2UgcmV2aXNpdCB0aGlzIHVzaW5nIGEgQ291Y2hEQiBsaW5rZWQgYWdhaW5zdCBqcy0xLjguNS4KICAgICAgICAgICAgV2UgZG9uJ3QgY3VycmVudGx5IGhhdmUgdGhlIGluZnJhc3RydWN0dXJlIGZvciBhIHRlc3QgY2FzZS4gKi8KICAgICAgICAKICAgICAgICAvKiBCZWZvcmU6IHJldHVybiAhKHYgaW5zdGFuY2VvZiBPYmplY3QpIHx8IF8uaXNBcnJheSh2KTsgKi8KICAgICAgICByZXR1cm4gKHR5cGVvZih2KSAhPT0gJ29iamVjdCcgfHwgXy5pc0FycmF5KHYpKTsKICAgIH0pOwogICAgaWYgKG5vbl9vYmplY3RzLmxlbmd0aCkgewogICAgICAgIHJldHVybiBfLm1hcChub25fb2JqZWN0cywgZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBFcnJvcih2ICsgJyBpcyBub3QgYW4gb2JqZWN0Jyk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gY2hlY2sgZm9yIG1pc3NpbmcgaWRzCiAgICB2YXIgbWlzc2luZyA9IHRoaXMubWlzc2luZ0lEcyh2YWx1ZSk7CiAgICBpZiAobWlzc2luZy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gbWlzc2luZzsKICAgIH0KCiAgICAvLyBjaGVjayBmb3IgZHVwbGljYXRlIGlkcwogICAgdmFyIGR1cGxpY2F0ZXMgPSB0aGlzLmR1cGxpY2F0ZUlEcyh2YWx1ZSk7CiAgICBpZiAoZHVwbGljYXRlcy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gZHVwbGljYXRlczsKICAgIH0KCiAgICAvLyBydW4gdHlwZSB2YWxpZGF0aW9uIGFnYWluc3QgZWFjaCBlbWJlZGRlZCBkb2N1bWVudAogICAgcmV0dXJuIF8ucmVkdWNlKHZhbHVlLCBmdW5jdGlvbiAoZXJycywgdiwgaSkgewogICAgICAgIHZhciByID0gcmF3ID8gcmF3W2ldOiB1bmRlZmluZWQ7CiAgICAgICAgcmV0dXJuIGVycnMuY29uY2F0KAogICAgICAgICAgICBfLm1hcCh0eXBlLnZhbGlkYXRlKHYsIHIpLCBmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgICBlcnIuZmllbGQgPSBbaV0uY29uY2F0KGVyci5maWVsZCB8fCBbXSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZXJyOwogICAgICAgICAgICB9KQogICAgICAgICk7CiAgICB9LCBbXSk7Cn07CgovKioKICogQ2hlY2sgcmVsZXZhbnQgdHlwZSBwZXJtaXNzaW9ucyB0byBzZWUgaWYgdXNlciBpcyBhdXRob3Jpc2VkIHRvIG1ha2UKICogY2hhbmdlcy4gUmV0dXJucyBhbiBhcnJheSBvZiBwZXJtaXNzaW9ucyBlcnJvcnMsIG9yIGFuIGVtcHR5IGFycmF5IGlmIHRoZQogKiBjaGFuZ2VzIGFyZSBwZXJtaXNzaWJsZS4KICoKICogQG5hbWUgRW1iZWRkZWRMaXN0LmF1dGhvcml6ZShuRG9jLCBvRG9jLCBuVmFsLCBvVmFsLCB1c2VyKQogKiBAcGFyYW0ge09iamVjdH0gbkRvYwogKiBAcGFyYW0ge09iamVjdH0gb0RvYwogKiBAcGFyYW0gblZhbAogKiBAcGFyYW0gb1ZhbAogKiBAcGFyYW0ge09iamVjdH0gdXNlcgogKiBAcmV0dXJucyB7QXJyYXl9CiAqIEBhcGkgcHVibGljCiAqLwoKRW1iZWRkZWRMaXN0LnByb3RvdHlwZS5hdXRob3JpemUgPSBmdW5jdGlvbiAobkRvYywgb0RvYywgblZhbCwgb1ZhbCwgdXNlcikgewogICAgdmFyIHR5cGUgPSB0aGlzLnR5cGU7CiAgICB2YXIgcGVybXMgPSB0aGlzLnBlcm1pc3Npb25zOwoKICAgIG5WYWwgPSBuVmFsIHx8IFtdOwogICAgb1ZhbCA9IG9WYWwgfHwgW107CgogICAgLy8gYSB1bmlxdWUgbGlzdCBvZiBlbWJlZGRlZCBpZHMgZnJvbSBib3RoIHRoZSBvbGQgYW5kIG5ldyBkb2N1bWVudAogICAgdmFyIGlkcyA9IF8udW5pcShfLnBsdWNrKG5WYWwsICdfaWQnKS5jb25jYXQoXy5wbHVjayhvVmFsLCAnX2lkJykpKTsKCiAgICByZXR1cm4gXy5yZWR1Y2UoaWRzLCBmdW5jdGlvbiAoZXJycywgaWQsIGkpIHsKCiAgICAgICAgdmFyIGN1cnJfZXJycyA9IFtdOwogICAgICAgIHZhciBuZCA9IF8uZGV0ZWN0KG5WYWwsIGZ1bmN0aW9uICh2KSB7CiAgICAgICAgICAgIHJldHVybiB2ICYmIHYuX2lkID09PSBpZDsKICAgICAgICB9KTsKICAgICAgICBuZCA9IG5kIHx8IHtfZGVsZXRlZDogdHJ1ZX07CiAgICAgICAgdmFyIG9kID0gXy5kZXRlY3Qob1ZhbCwgZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgcmV0dXJuIHYgJiYgdi5faWQgPT09IGlkOwogICAgICAgIH0pOwogICAgICAgIHZhciBhcmdzID0gW25Eb2MsIG9Eb2MsIG5kLCBvZCwgdXNlcl07CgogICAgICAgIGlmIChfLmlzRnVuY3Rpb24ocGVybXMpKSB7CiAgICAgICAgICAgIGN1cnJfZXJycyA9IHV0aWxzLmdldEVycm9ycyhwZXJtcywgYXJncyk7CiAgICAgICAgfQogICAgICAgIHZhciBmbjsKICAgICAgICAvLyBvbiBhZGQKICAgICAgICBpZiAobmQgJiYgIW9kKSB7CiAgICAgICAgICAgIGZuID0gcGVybXMuYWRkOwogICAgICAgIH0KICAgICAgICAvLyBvbiByZW1vdmUKICAgICAgICBlbHNlIGlmIChuZC5fZGVsZXRlZCkgewogICAgICAgICAgICBmbiA9IHBlcm1zLnJlbW92ZTsKICAgICAgICB9CiAgICAgICAgLy8gb24gdXBkYXRlCiAgICAgICAgZWxzZSBpZiAoSlNPTi5zdHJpbmdpZnkobmQpICE9PSBKU09OLnN0cmluZ2lmeShvZCkpIHsKICAgICAgICAgICAgZm4gPSBwZXJtcy51cGRhdGU7CiAgICAgICAgfQogICAgICAgIGlmIChmbikgewogICAgICAgICAgICBjdXJyX2VycnMgPSBjdXJyX2VycnMuY29uY2F0KHV0aWxzLmdldEVycm9ycyhmbiwgYXJncykpOwogICAgICAgIH0KICAgICAgICBjdXJyX2VycnMgPSBfLm1hcChjdXJyX2VycnMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGUuZmllbGQgPSBbaV0uY29uY2F0KGUuZmllbGQgfHwgW10pOwogICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZXJycy5jb25jYXQoY3Vycl9lcnJzKTsKCiAgICB9LCBbXSk7Cn07CgoKLyoqCiAqIFByZXBlbmRzIGEgdmFsaWRhdG9yIHRvIGFuIGFycmF5IG9mIHZhbGlkYXRvciBmdW5jdGlvbnMuCiAqCiAqIEBwYXJhbSB7QXJyYXl9IGFycgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogKiBAYXBpIHByaXZhdGUKICovCgp2YXIgcHJlcGVuZFZhbGlkYXRvciA9IGZ1bmN0aW9uIChvcHRpb25zLCBmbikgewogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICBvcHRpb25zLnZhbGlkYXRvcnMgPSBbZm5dLmNvbmNhdChvcHRpb25zLnZhbGlkYXRvcnMgfHwgW10pOwogICAgcmV0dXJuIG9wdGlvbnM7Cn07CgoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgc3RyaW5nIEZpZWxkCiAqCiAqIEBuYW1lIHN0cmluZyhbb3B0aW9uc10pCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5zdHJpbmcgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgcmV0dXJuIG5ldyBGaWVsZChfLmRlZmF1bHRzKChvcHRpb25zIHx8IHt9KSwgewogICAgICAgIHBhcnNlOiBmdW5jdGlvbiAocmF3KSB7CiAgICAgICAgICAgIGlmIChyYXcgPT09IG51bGwgfHwgcmF3ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJycgKyByYXc7CiAgICAgICAgfQogICAgfSkpOwp9OwoKCi8qKgogKiBDcmVhdGVzIGEgbmV3IG51bWJlciBGaWVsZAogKgogKiBAbmFtZSBudW1iZXIoW29wdGlvbnNdKQogKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMubnVtYmVyID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBwcmVwZW5kVmFsaWRhdG9yKG9wdGlvbnMsIGZ1bmN0aW9uIChkb2MsIHZhbHVlKSB7CiAgICAgICAgaWYgKGlzTmFOKHZhbHVlKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBhIG51bWJlcicpOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG5ldyBGaWVsZChfLmRlZmF1bHRzKChvcHRpb25zIHx8IHt9KSwgewogICAgICAgIHBhcnNlOiBmdW5jdGlvbiAocmF3KSB7CiAgICAgICAgICAgIGlmIChyYXcgPT09ICcnIHx8IHJhdyA9PT0gbnVsbCB8fCByYXcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIE5hTjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gTnVtYmVyKHJhdyk7CiAgICAgICAgfQogICAgfSkpOwp9OwoKCi8qKgogKiBDcmVhdGVzIGEgbmV3IGJvb2xlYW4gRmllbGQKICoKICogQG5hbWUgYm9vbGVhbihbb3B0aW9uc10pCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5ib29sZWFuID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIHJldHVybiBuZXcgRmllbGQoXy5kZWZhdWx0cygob3B0aW9ucyB8fCB7fSksIHsKICAgICAgICB3aWRnZXQ6IHdpZGdldHMuY2hlY2tib3goKSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgcGFyc2U6IEJvb2xlYW4KICAgIH0pKTsKfTsKCgovKioKICogQ3JlYXRlcyBhIFVSTCBGaWVsZAogKgogKiBAbmFtZSB1cmwoW29wdGlvbnNdKQogKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMudXJsID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBwcmVwZW5kVmFsaWRhdG9yKG9wdGlvbnMsIHZhbGlkYXRvcnMudXJsKCkpOwogICAgcmV0dXJuIGV4cG9ydHMuc3RyaW5nKG9wdGlvbnMpOwp9OwoKCi8qKgogKiBDcmVhdGVzIGFuIGVtYWlsIEZpZWxkCiAqCiAqIEBuYW1lIGVtYWlsKFtvcHRpb25zXSkKICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmVtYWlsID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBwcmVwZW5kVmFsaWRhdG9yKG9wdGlvbnMsIHZhbGlkYXRvcnMuZW1haWwoKSk7CiAgICByZXR1cm4gZXhwb3J0cy5zdHJpbmcob3B0aW9ucyk7Cn07CgoKLyoqCiAqIENyZWF0ZXMgYSBjcmVhdG9yIEZpZWxkCiAqCiAqIEBuYW1lIGNyZWF0b3IoW29wdGlvbnNdKQogKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuY3JlYXRvciA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgIGlmICghb3B0aW9ucy5wZXJtaXNzaW9ucykgewogICAgICAgIG9wdGlvbnMucGVybWlzc2lvbnMgPSB7fTsKICAgIH0KICAgIHZhciBwID0gb3B0aW9ucy5wZXJtaXNzaW9uczsKICAgIGlmIChwLmFkZCkgewogICAgICAgIHAuYWRkID0gcGVybWlzc2lvbnMuYWxsKFsKICAgICAgICAgICAgcGVybWlzc2lvbnMubWF0Y2hVc2VybmFtZSgpLAogICAgICAgICAgICBwLmFkZAogICAgICAgIF0pOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgcC5hZGQgPSBwZXJtaXNzaW9ucy5tYXRjaFVzZXJuYW1lKCk7CiAgICB9CiAgICBpZiAocC51cGRhdGUpIHsKICAgICAgICBwLnVwZGF0ZSA9IHBlcm1pc3Npb25zLmFsbChbCiAgICAgICAgICAgIHBlcm1pc3Npb25zLmZpZWxkVW5lZGl0YWJsZSgpLAogICAgICAgICAgICBwLnVwZGF0ZQogICAgICAgIF0pOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgcC51cGRhdGUgPSBwZXJtaXNzaW9ucy5maWVsZFVuZWRpdGFibGUoKTsKICAgIH0KICAgIHJldHVybiBleHBvcnRzLnN0cmluZyhfLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgd2lkZ2V0OiB3aWRnZXRzLmNyZWF0b3IoKSwKICAgICAgICBkZWZhdWx0X3ZhbHVlOiBmdW5jdGlvbiAocmVxKSB7CiAgICAgICAgICAgIHJldHVybiAocmVxLnVzZXJDdHggJiYgcmVxLnVzZXJDdHgubmFtZSkgfHwgJyc7CiAgICAgICAgfQogICAgfSkpOwp9OwoKCi8qKgogKiBDcmVhdGVzIGEgY3JlYXRlZFRpbWUgdGltZXN0YW1wIEZpZWxkCiAqCiAqIEBuYW1lIGNyZWF0ZWRUaW1lKFtvcHRpb25zXSkKICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmNyZWF0ZWRUaW1lID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgaWYgKCFvcHRpb25zLnBlcm1pc3Npb25zKSB7CiAgICAgICAgb3B0aW9ucy5wZXJtaXNzaW9ucyA9IHt9OwogICAgfQogICAgdmFyIHAgPSBvcHRpb25zLnBlcm1pc3Npb25zOwogICAgaWYgKHAudXBkYXRlKSB7CiAgICAgICAgcC51cGRhdGUgPSBwZXJtaXNzaW9ucy5hbGwoWwogICAgICAgICAgICBwZXJtaXNzaW9ucy5maWVsZFVuZWRpdGFibGUoKSwKICAgICAgICAgICAgcC51cGRhdGUKICAgICAgICBdKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHAudXBkYXRlID0gcGVybWlzc2lvbnMuZmllbGRVbmVkaXRhYmxlKCk7CiAgICB9CiAgICByZXR1cm4gZXhwb3J0cy5udW1iZXIoXy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgd2lkZ2V0OiB3aWRnZXRzLmNvbXB1dGVkKCksCiAgICAgICAgZGVmYXVsdF92YWx1ZTogZnVuY3Rpb24gKHJlcSkgewogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgfQogICAgfSkpOwp9OwoKCi8qKgogKiBDcmVhdGVzIGEgY2hvaWNlIEZpZWxkCiAqCiAqIFJlcXVpcmVkIG9wdGlvbjogdmFsdWVzIC0gYW4gYXJyYXkgb2YgcG9zc2libGUgY2hvaWNlcywgZWFjaCBhbiBhcnJheQogKiB3aXRoIHRoZSBmaXJzdCBpdGVtIGFzIHRoZSB2YWx1ZSBhbmQgdGhlIHNlY29uZCBhcyBpdHMgbGFiZWwuCiAqCiAqIEBuYW1lIGNob2ljZShbb3B0aW9uc10pCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5jaG9pY2UgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgaWYgKCFvcHRpb25zIHx8ICFvcHRpb25zLnZhbHVlcykgewogICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gdmFsdWVzIGRlZmluZWQnKTsKICAgIH0KICAgIG9wdGlvbnMgPSBwcmVwZW5kVmFsaWRhdG9yKG9wdGlvbnMsIGZ1bmN0aW9uIChkb2MsIHZhbHVlKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLnZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodmFsdWUgPT09IG9wdGlvbnMudmFsdWVzW2ldWzBdKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGNob2ljZScpOwogICAgfSk7CiAgICAvLyB1c2UgdmFsdWUgYXMgbGFiZWwgaWYgbm8gbGFiZWwgZGVmaW5lZAogICAgb3B0aW9ucy52YWx1ZXMgPSBfLm1hcChvcHRpb25zLnZhbHVlcywgZnVuY3Rpb24gKHYpIHsKICAgICAgICByZXR1cm4gXy5pc0FycmF5KHYpID8gdjogW3YsIHZdOwogICAgfSk7CiAgICByZXR1cm4gbmV3IEZpZWxkKF8uZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIHdpZGdldDogd2lkZ2V0cy5zZWxlY3Qoe3ZhbHVlczogb3B0aW9ucy52YWx1ZXN9KQogICAgfSkpOwp9OwoKCi8qKgogKiBDcmVhdGVzIGEgbnVtYmVyIGNob2ljZSBGaWVsZAogKgogKiBAbmFtZSBudW1iZXJDaG9pY2UoW29wdGlvbnNdKQogKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMubnVtYmVyQ2hvaWNlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgcHJlcGVuZFZhbGlkYXRvcihvcHRpb25zLCBmdW5jdGlvbiAoZG9jLCB2YWx1ZSkgewogICAgICAgIGlmIChpc05hTih2YWx1ZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgYSBudW1iZXInKTsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBleHBvcnRzLmNob2ljZShfLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBwYXJzZTogZnVuY3Rpb24gKHJhdykgewogICAgICAgICAgICBpZiAocmF3ID09PSBudWxsIHx8IHJhdyA9PT0gJycpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gTnVtYmVyKHJhdyk7CiAgICAgICAgfQogICAgfSkpOwp9OwoKCi8qKgogKiBDcmVhdGVzIGFuIEVtYmVkZGVkIEZpZWxkCiAqCiAqIFJlcXVpcmVkIG9wdGlvbjogdHlwZSAtIHRoZSBUeXBlIGRlZmluaXRpb24gdG8gZW1iZWQKICoKICogQG5hbWUgZW1iZWQoW29wdGlvbnNdKQogKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuZW1iZWQgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgcmV0dXJuIG5ldyBFbWJlZGRlZChfLmRlZmF1bHRzKChvcHRpb25zIHx8IHt9KSwgewogICAgICAgIHdpZGdldDogd2lkZ2V0cy5lbWJlZExpc3QoewogICAgICAgICAgICBzaW5nbGV0b246IHRydWUsCiAgICAgICAgICAgIHdpZGdldDogd2lkZ2V0cy5kZWZhdWx0RW1iZWRkZWQoKQogICAgICAgIH0pCiAgICB9KSk7Cn07CgoKLyoqCiAqIENyZWF0ZXMgYW4gRW1iZWRkZWRMaXN0IEZpZWxkCiAqCiAqIFJlcXVpcmVkIG9wdGlvbjogdHlwZSAtIHRoZSBUeXBlIGRlZmluaXRpb24gdG8gZW1iZWQKICoKICogQG5hbWUgZW1iZWRMaXN0KFtvcHRpb25zXSkKICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmVtYmVkTGlzdCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICByZXR1cm4gbmV3IEVtYmVkZGVkTGlzdChfLmRlZmF1bHRzKChvcHRpb25zIHx8IHt9KSwgewogICAgICAgIHdpZGdldDogd2lkZ2V0cy5lbWJlZExpc3QoewogICAgICAgICAgICBzaW5nbGV0b246IGZhbHNlLAogICAgICAgICAgICB3aWRnZXQ6IHdpZGdldHMuZGVmYXVsdEVtYmVkZGVkKCkKICAgICAgICB9KQogICAgfSkpOwp9OwoKCi8qKgogKiBDcmVhdGVzIGEgYXJyYXkgRmllbGQuIFRoZSBkZWZhdWx0IHBhcnNlIGZ1bmN0aW9uIGV4cGVjdHMgYSBzaW5nbGUgcm93IG9mCiAqIGNvbW1hIHNlcGFyYXRlZCB2YWx1ZXMuCiAqCiAqIFRvIGFjY2VwdCBhbiBhcnJheSBvZiB2YWx1ZXMgb3RoZXIgdGhhbiBzdHJpbmdzLCBhZGQgYSBmdW5jdGlvbiB0byBvcHRpb25zCiAqIGNhbGxlZCBwYXJzZUVhY2ggd2hpY2ggYWNjZXB0cyB0aGUgc3RyaW5nIHZhbHVlIGZvciBlYWNoIGl0ZW0gYW5kIHBlcmZvcm1zCiAqIHRoZSB0cmFuc2Zvcm1hdGlvbi4KICoKICogQG5hbWUgYXJyYXkoW29wdGlvbnNdKQogKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuYXJyYXkgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICBvcHRpb25zLmhpbnQgPSBvcHRpb25zLmhpbnQgfHwgIlZhbHVlcyBzaG91bGQgYmUgY29tbWEgc2VwYXJhdGVkIjsKICAgIHByZXBlbmRWYWxpZGF0b3Iob3B0aW9ucywgZnVuY3Rpb24gKGRvYywgdmFsdWUpIHsKICAgICAgICBpZiAoIV8uaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgYW4gYXJyYXknKTsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBleHBvcnRzLnN0cmluZyhfLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBwYXJzZTogZnVuY3Rpb24gKHJhdykgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gdXRpbHMucGFyc2VDU1YocmF3IHx8ICcnKVswXSB8fCBbXTsKICAgICAgICAgICAgaWYgKG9wdGlvbnMucGFyc2VFYWNoKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBfLm1hcChyZXN1bHQsIG9wdGlvbnMucGFyc2VFYWNoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH0pKTsKfTsKCi8qKgogKiBDcmVhdGVzIGEgbnVtYmVyIGFycmF5IEZpZWxkLCBzYW1lIGFzIHRoZSBhcnJheSBmaWVsZCBvbmx5IGVhY2ggdmFsdWUgaXMKICogcGFyc2VkIGFzIGEgbnVtYmVyIGluc3RlYWQgb2YgYSBzdHJpbmcuCiAqCiAqIEBuYW1lIG51bWJlckFycmF5KFtvcHRpb25zXSkKICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLm51bWJlckFycmF5ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgb3B0aW9ucy5wYXJzZUVhY2ggPSBvcHRpb25zLnBhcnNlRWFjaCB8fCBmdW5jdGlvbiAodikgewogICAgICAgIHJldHVybiBOdW1iZXIodik7CiAgICB9OwogICAgcHJlcGVuZFZhbGlkYXRvcihvcHRpb25zLCBmdW5jdGlvbiAoZG9jLCB2YWx1ZSkgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB2YWx1ZS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBpZiAoaXNOYU4odmFsdWVbaV0pKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBhIG51bWJlcicpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gZXhwb3J0cy5hcnJheShvcHRpb25zKTsKfTsKCgoKfSl9OwoKLyoqKioqKioqKioga2Fuc28vc2FuaXRpemUgKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJrYW5zby9zYW5pdGl6ZSJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKioKICogSW5wdXQgc2FuaXRpemF0aW9uLCBlc2NhcGluZywgYW5kIGNvbnN0cnVjdGlvbiBmdW5jdGlvbnMKICogY292ZXJpbmcgc2VjdXJpdHktc2Vuc2l0aXZlIGFyZWFzLgogKgogKiBAbW9kdWxlCiAqLwoKLyoqCiAqIE1vZHVsZSBkZXBlbmRlbmNpZXMKICovCgp2YXIgXyA9IHJlcXVpcmUoJy4vdW5kZXJzY29yZScpLl87CgoKLyoqCiAqIEVuY29kZXMgcmVxdWlyZWQgY2hhcmFjdGVycyBhcyBIVE1MIGVudGl0aWVzIHNvIGEgc3RyaW5nCiAqIGNhbiBiZSBpbmNsdWRlZCBpbiBhIHBhZ2UuIFRoaXMgZnVuY3Rpb24gbXVzdCBiZSB1c2VkIHRvCiAqIGF2b2lkIENyb3NzLXNpdGUgU2NyaXB0aW5nIGF0dGFja3MuCiAqCiAqIEBuYW1lIGVzY2FwZUh0bWwocykKICogQHBhcmFtIHtTdHJpbmd9IHMKICogQHJldHVybnMge1N0cmluZ30KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmVzY2FwZUh0bWwgPSBleHBvcnRzLmggPSBmdW5jdGlvbiAocykKewogICAgcyA9ICgnJyArIHMpOyAvKiBDb2VyY2UgdG8gc3RyaW5nICovCiAgICBzID0gcy5yZXBsYWNlKC8mL2csICcmYW1wOycpOwogICAgcyA9IHMucmVwbGFjZSgvPC9nLCAnJmx0OycpOwogICAgcyA9IHMucmVwbGFjZSgvPi9nLCAnJmd0OycpOwogICAgcyA9IHMucmVwbGFjZSgvIi9nLCAnJnF1b3Q7Jyk7CiAgICBzID0gcy5yZXBsYWNlKC8nL2csICcmIzM5OycpOwogICAgcmV0dXJuIHM7Cn07CgoKLyoqCiAqIEVuY29kZXMgc2VsZWN0ZWQgY2hhcmFjdGVycyBpbiBhIHN0cmluZywgc28gdGhhdCB0aGUgc3RyaW5nCiAqIGNhbiBiZSBzYWZlbHkgdXNlZCB3aXRoaW4gYSBKYXZhc2NyaXB0IHN0cmluZyBjb25zdGFudC4gVGhpcwogKiBmdW5jdGlvbiBtdXN0IGJlIHVzZWQgdG8gYXZvaWQgY3Jvc3Mtc2l0ZSBzY3JpcHRpbmcgYXR0YWNrcwogKiAob3IsIGluIHNvbWUgY2FzZXMsIGFyYml0cmFyeSBzZXJ2ZXItc2lkZSBjb2RlIGV4ZWN1dGlvbikuCiAqCiAqIEBuYW1lIGVzY2FwZUphdmFzY3JpcHRTdHJpbmcocykKICogQHBhcmFtIHtTdHJpbmd9IHMKICogQHJldHVybnMge1N0cmluZ30KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmVzY2FwZUphdmFzY3JpcHRTdHJpbmcgPSBleHBvcnRzLmpzID0gZnVuY3Rpb24gKHMpCnsKICAgIHMgPSAoJycgKyBzKTsgLyogQ29lcmNlIHRvIHN0cmluZyAqLwogICAgcyA9IHMucmVwbGFjZSgvJy9nLCAiXFwnIik7CiAgICBzID0gcy5yZXBsYWNlKC8nL2csICJcXCciKTsKICAgIHMgPSBzLnJlcGxhY2UoLycvZywgIlxcJyIpOwogICAgcyA9IHMucmVwbGFjZSgvIi9nLCAnXFwiJyk7CiAgICByZXR1cm4gczsKfTsKCgovKioKICogRW5jb2RlcyBzZWxlY3RlZCBjaGFyYWN0ZXJzIGluIGEgc3RyaW5nLCBzbyB0aGF0IHRoZSBzdHJpbmcKICogY2FuIGJlIHNhZmVseSB1c2VkIHdpdGhpbiBhbiBYTUwgY2hhcmFjdGVyIGRhdGEgc2VjdGlvbi4KICogVGhpcyBmdW5jdGlvbiBtdXN0IGJlIHVzZWQgdG8gYXZvaWQgY3Jvc3Mtc2l0ZSBzY3JpcHRpbmcgYXR0YWNrcy4KICoKICogQG5hbWUgZXNjYXBlSmF2YXNjcmlwdFN0cmluZyhzKQogKiBAcGFyYW0ge1N0cmluZ30gcwogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuZXNjYXBlWG1sQ2hhcmFjdGVyRGF0YSA9IGV4cG9ydHMuY2RhdGEgPSBmdW5jdGlvbiAocykKewogICAgcyA9ICgnJyArIHMpOyAvKiBDb2VyY2UgdG8gc3RyaW5nICovCiAgICBzID0gcy5yZXBsYWNlKC9cXVxdPi9nLCAnJyk7CiAgICByZXR1cm4gczsKfTsKCgovKioKICogVGFrZXMgYW55IG51bWJlciBvZiBhcmd1bWVudHMsIGFuZCBjb21iaW5lcyB0aGVtIHRvZ2V0aGVyCiAqIHRvIHNhZmVseSBmb3JtIGEgc3RyaW5nIHRoYXQncyBzdWl0YWJsZSBmb3IgdXNlIGFzIGEgRE9NCiAqIGVsZW1lbnQgaWRlbnRpZmllci4KICoKICogQG5hbWUgZ2VuZXJhdGVEb21JZGVudGlmaWVyKHMpCiAqIEBwYXJhbSB7U3RyaW5nfSBzCiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5nZW5lcmF0ZURvbUlkZW50aWZpZXIgPSBleHBvcnRzLmlkID0gZnVuY3Rpb24gKC8qIC4uLiAqLykgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPD0gMCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgdmFyIHJ2ID0gWyAnaWQnIF07CiAgICB2YXIgZXNjID0gZnVuY3Rpb24gKHgpIHsKICAgICAgICByZXR1cm4gKCcnICsgeCkucmVwbGFjZSgvW15BLVphLXowLTlfXSsvLCAnXycpOwogICAgfTsKCiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgdmFyIGFyZyA9IGFyZ3VtZW50c1tpXTsKICAgICAgICBpZiAoYXJnICE9PSB1bmRlZmluZWQgJiYgYXJnICE9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfLmlzQXJyYXkoYXJnKSkgewogICAgICAgICAgICAgICAgLyogQXZvaWQgcmVjdXJzaW9uOyBsaW1pdCB0byBvbmUgbGV2ZWwgZGVlcCAqLwogICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGxlbmogPSBhcmcubGVuZ3RoOyBqIDwgbGVuajsgKytqKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ1tqXSAhPT0gdW5kZWZpbmVkICYmIGFyZ1tqXSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBydi5wdXNoKGVzYyhhcmdbal0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBydi5wdXNoKGVzYyhhcmcpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBydi5qb2luKCdfJyk7Cn07CgoKLyoqCiAqIFRha2VzIGFueSBudW1iZXIgb2YgYXJndW1lbnRzLCBhbmQgY29tYmluZXMgdGhlbSB0b2dldGhlcgogKiB0byBzYWZlbHkgZm9ybSBhIHN0cmluZyB0aGF0J3Mgc3VpdGFibGUgZm9yIHVzZSBpbiBhIERPTQogKiBlbGVtZW50J3MgbmFtZSBhdHRyaWJ1dGUuCiAqCiAqIEBuYW1lIGdlbmVyYXRlRG9tTmFtZShzKQogKiBAcGFyYW0ge1N0cmluZ30gcwogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuZ2VuZXJhdGVEb21OYW1lID0gZXhwb3J0cy5uYW1lID0gZnVuY3Rpb24gKC8qIC4uLiAqLykgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPD0gMCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgdmFyIHJ2ID0gW107CiAgICB2YXIgZXNjID0gZnVuY3Rpb24gKHgpIHsKICAgICAgICByZXR1cm4gKCcnICsgeCkucmVwbGFjZSgvW1wnXCJdKy8sICdfJyk7CiAgICB9OwoKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICB2YXIgYXJnID0gYXJndW1lbnRzW2ldOwogICAgICAgIGlmIChhcmcgIT09IHVuZGVmaW5lZCAmJiBhcmcgIT09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF8uaXNBcnJheShhcmcpKSB7CiAgICAgICAgICAgICAgICAvKiBBdm9pZCByZWN1cnNpb247IGxpbWl0IHRvIG9uZSBsZXZlbCBkZWVwICovCiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgbGVuaiA9IGFyZy5sZW5ndGg7IGogPCBsZW5qOyArK2opIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYXJnW2pdICE9PSB1bmRlZmluZWQgJiYgYXJnW2pdICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJ2LnB1c2goZXNjKGFyZ1tqXSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJ2LnB1c2goZXNjKGFyZykpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHJ2LmpvaW4oJy4nKTsKfTsKCgoKCn0pfTsKCi8qKioqKioqKioqIGthbnNvL3Nlc3Npb24gKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJrYW5zby9zZXNzaW9uIl0gPSB7bG9hZDogKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUpIHsKCi8qKgogKiBGdW5jdGlvbnMgcmVsYXRlZCB0byB0aGUgbWFuYWdlbWVudCBvZiB1c2VyIHNlc3Npb25zIGFuZCBhY2NvdW50IGluZm9ybWF0aW9uLgogKgogKiBAbW9kdWxlCiAqLwoKLyoqCiAqIE1vZHVsZSBkZXBlbmRlbmNpZXMKICovCgp2YXIgZGIgPSByZXF1aXJlKCcuL2RiJyksCiAgICBzaGExID0gcmVxdWlyZSgnLi9zaGExJyksCiAgICBjb29raWVzID0gcmVxdWlyZSgnLi9jb29raWVzJyksCiAgICBldmVudHMgPSByZXF1aXJlKCcuL2V2ZW50cycpLAogICAgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyk7CgoKLyoqCiAqIENyZWF0ZXMgYSBmYWtlIHJlcXVlc3QgdG8gL19zZXNzaW9uIHRvIHBhc3MgdG8gc2Vzc2lvbkNoYW5nZSwgdXNlZnVsCiAqIHdoZW4gdXNpbmcgZnVuY3Rpb25zIHN1Y2ggYXMgdGVtcGxhdGVzLnJlbmRlcgogKgogKiBAbmFtZSBmYWtlUmVxdWVzdCh1c2VyQ3R4LCBjYWxsYmFjaykKICogQHBhcmFtIHtPYmplY3R9IHVzZXJDdHgKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmZha2VSZXF1ZXN0ID0gZnVuY3Rpb24gKHVzZXJDdHgsIGNhbGxiYWNrKSB7CiAgICBkYi5uZXdVVUlEKDEwMCwgZnVuY3Rpb24gKGVyciwgdXVpZCkgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7CiAgICAgICAgfQogICAgICAgIGNhbGxiYWNrKG51bGwsIHsKICAgICAgICAgICAgdXNlckN0eDogdXNlckN0eCwKICAgICAgICAgICAgdXVpZDogdXVpZCwKICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgcXVlcnk6IHt9LAogICAgICAgICAgICBoZWFkZXJzOiB7fSwKICAgICAgICAgICAgcGF0aDogWydfc2Vzc2lvbiddLAogICAgICAgICAgICBjbGllbnQ6IHRydWUsCiAgICAgICAgICAgIGluaXRpYWxfaGl0OiB1dGlscy5pbml0aWFsX2hpdCwKICAgICAgICAgICAgY29va2llOiBjb29raWVzLnJlYWRCcm93c2VyQ29va2llcygpCiAgICAgICAgfSk7CiAgICB9KTsKfTsKCi8qKgogKiBDYWxscyBzZXNzaW9uQ2hhbmdlIGlmIGV4cG9ydGVkIGZyb20gdGhlIGN1cnJlbnRseSBsb2FkZWQgYXBwLgogKgogKiBAbmFtZSBzZXNzaW9uQ2hhbmdlKHVzZXJDdHgsIGNhbGxiYWNrKQogKiBAcGFyYW0ge09iamVjdH0gdXNlckN0eAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuc2Vzc2lvbkNoYW5nZSA9IGZ1bmN0aW9uICh1c2VyQ3R4LCBjYWxsYmFjaykgewogICAgdmFyIHJlcSA9IGV4cG9ydHMuZmFrZVJlcXVlc3QodXNlckN0eCwgZnVuY3Rpb24gKGVyciwgcmVxKSB7CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICB9CiAgICAgICAgZXZlbnRzLmVtaXQoJ3Nlc3Npb25DaGFuZ2UnLCB1c2VyQ3R4LCByZXEpOwogICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgIH0KICAgIH0pOwp9OwoKLyoqCiAqIExvZ3Mgb3V0IHRoZSBjdXJyZW50IHVzZXIuCiAqCiAqIEBuYW1lIGxvZ291dChjYWxsYmFjaykKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmxvZ291dCA9IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgaWYgKCF1dGlscy5pc0Jyb3dzZXIoKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignbG9nb3V0IGNhbm5vdCBiZSBjYWxsZWQgc2VydmVyLXNpZGUnKTsKICAgIH0KICAgIGRiLnJlcXVlc3QoewogICAgICAgIHR5cGU6ICJERUxFVEUiLAogICAgICAgIHVybDogIi9fc2Vzc2lvbiIsIC8vIGRvbid0IG5lZWQgYmFzZVVSTCwgL19zZXNzaW9uIGFsd2F5cyBhdmFpbGFibGUKICAgICAgICB1c2VybmFtZTogIl8iLAogICAgICAgIHBhc3N3b3JkIDogIl8iCiAgICB9LAogICAgZnVuY3Rpb24gKGVyciwgcmVzcCkgewogICAgICAgIGlmIChyZXNwICYmIHJlc3Aub2spIHsKICAgICAgICAgICAgdXRpbHMudXNlckN0eCA9IHtuYW1lOiBudWxsLCByb2xlczogW119OwogICAgICAgICAgICB1dGlscy5zZXNzaW9uID0ge3VzZXJDdHg6IHV0aWxzLnVzZXJDdHh9OwogICAgICAgICAgICBleHBvcnRzLnNlc3Npb25DaGFuZ2UodXRpbHMudXNlckN0eCk7CiAgICAgICAgfQogICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICBjYWxsYmFjayhlcnIsIHJlc3ApOwogICAgICAgIH0KICAgIH0pOwp9OwoKLyoqCiAqIEF0dGVtcHQgdG8gbG9naW4gdXNpbmcgdGhlIHVzZXJuYW1lIGFuZCBwYXNzd29yZCBwcm92aWRlZC4KICoKICogQG5hbWUgbG9naW4odXNlcm5hbWUsIHBhc3N3b3JkLCBjYWxsYmFjaykKICogQHBhcmFtIHtTdHJpbmd9IHVzZXJuYW1lCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXNzd29yZAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMubG9naW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkLCBjYWxsYmFjaykgewogICAgaWYgKCF1dGlscy5pc0Jyb3dzZXIoKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignbG9naW4gY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpOwogICAgfQogICAgZGIucmVxdWVzdCh7CiAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgIHVybDogIi9fc2Vzc2lvbiIsCiAgICAgICAgZGF0YToge25hbWU6IHVzZXJuYW1lLCBwYXNzd29yZDogcGFzc3dvcmR9CiAgICB9LAogICAgZnVuY3Rpb24gKGVyciwgcmVzcCkgewogICAgICAgIGlmIChyZXNwICYmIHJlc3Aub2spIHsKICAgICAgICAgICAgLy8gVE9ETzogZm9yIHNvbWUgcmVhc29uIHJlc3AubmFtZSBpcyBzZXQgdG8gbnVsbCBpbiB0aGUgcmVzcG9uc2UKICAgICAgICAgICAgLy8gZXZlbiB0aG91Z2ggdGhlIHJvbGVzIGFyZSBjb3JyZWN0IGZvciB0aGUgdXNlciEgTG9vayBpbnRvIHRoaXMKICAgICAgICAgICAgLy8gYW5kIHNlZSBpZiBpdHMgYSBidWcgaW4gY291Y2hkYiwgZm9yIG5vdywganVzdCB1c2luZyB0aGUgdXNlcm5hbWUKICAgICAgICAgICAgLy8gZ2l2ZW4gdG8gdGhlIGxvZ2luIGZ1bmN0aW9uIGluc3RlYWQsIHNpbmNlIHdlIGtub3cgdGhlIGxvZ2luCiAgICAgICAgICAgIC8vIHJlcXVlc3Qgd2FzIGFjY2VwdGVkLgogICAgICAgICAgICAvL3V0aWxzLnVzZXJDdHggPSB7bmFtZTogcmVzcC5uYW1lLCByb2xlczogcmVzcC5yb2xlc307CiAgICAgICAgICAgIHV0aWxzLnVzZXJDdHggPSB7bmFtZTogdXNlcm5hbWUsIHJvbGVzOiByZXNwLnJvbGVzfTsKICAgICAgICAgICAgdXRpbHMuc2Vzc2lvbiA9IHt1c2VyQ3R4OiB1dGlscy51c2VyQ3R4fTsKICAgICAgICAgICAgZXhwb3J0cy5zZXNzaW9uQ2hhbmdlKHV0aWxzLnVzZXJDdHgpOwogICAgICAgIH0KICAgICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgY2FsbGJhY2soZXJyLCByZXNwKTsKICAgICAgICB9CiAgICB9KTsKfTsKCgovKioKICogUmV0dXJucyB0aGUgY3VycmVudCB1c2VyJ3Mgc2Vzc2lvbiBpbmZvcm1hdGlvbi4KICoKICogQG5hbWUgaW5mbyhjYWxsYmFjaykKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmluZm8gPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgIGlmICghdXRpbHMuaXNCcm93c2VyKCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2luZm8gY2Fubm90IGJlIGNhbGxlZCBzZXJ2ZXItc2lkZScpOwogICAgfQogICAgZGIucmVxdWVzdCh7CiAgICAgICAgdHlwZTogIkdFVCIsCiAgICAgICAgdXJsOiAiL19zZXNzaW9uIgogICAgfSwKICAgIGZ1bmN0aW9uIChlcnIsIHJlc3ApIHsKICAgICAgICB2YXIgb2xkVXNlckN0eCA9IHV0aWxzLnVzZXJDdHg7CiAgICAgICAgdXRpbHMuc2Vzc2lvbiA9IHJlc3A7CiAgICAgICAgdXRpbHMudXNlckN0eCA9IChyZXNwICYmIHJlc3AudXNlckN0eCkgfHwge25hbWU6IG51bGwsIHJvbGVzOiBbXX07CiAgICAgICAgLy8gVE9ETzogc2hvdWxkIHRoaXMgY2hlY2sgZm9yIGRpZmZlcmVuY2VzIGluIG1vcmUgdGhhbiBqdXN0IG5hbWU/CiAgICAgICAgaWYgKCFvbGRVc2VyQ3R4IHx8IG9sZFVzZXJDdHgubmFtZSAhPT0gdXRpbHMudXNlckN0eC5uYW1lKSB7CiAgICAgICAgICAgIGV4cG9ydHMuc2Vzc2lvbkNoYW5nZSh1dGlscy51c2VyQ3R4KTsKICAgICAgICB9CiAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKGVyciwgcmVzcCk7CiAgICAgICAgfQogICAgfSk7Cn07CgovKioKICogUmV0dXJucyB0aGUgYXV0aGVudGljYXRpb24gZGF0YWJhc2UgZm9yIHRoZSBjdXJyZW50IHVzZXIncyBzZXNzaW9uLgogKgogKiBAbmFtZSB1c2VyRGIoY2FsbGJhY2spCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy51c2VyRGIgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgIGlmICh1dGlscy5zZXNzaW9uICYmIHV0aWxzLnNlc3Npb24uYXV0aGVudGljYXRpb25fZGIpIHsKICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgdXRpbHMuc2Vzc2lvbi5hdXRoZW50aWNhdGlvbl9kYik7CiAgICB9CiAgICBleHBvcnRzLmluZm8oZnVuY3Rpb24gKGVyciwgc2Vzc2lvbikgewogICAgICAgIGNhbGxiYWNrKGVyciwgc2Vzc2lvbiA/IHNlc3Npb24uaW5mby5hdXRoZW50aWNhdGlvbl9kYjogbnVsbCk7CiAgICB9KTsKfTsKCi8qKgogKiBDcmVhdGVzIGEgbmV3IHVzZXIgZG9jdW1lbnQgd2l0aCBnaXZlbiB1c2VybmFtZSBhbmQgcGFzc3dvcmQuCiAqCiAqIEBuYW1lIHNpZ251cCh1c2VybmFtZSwgcGFzc3dvcmQsIGNhbGxiYWNrKQogKiBAcGFyYW0ge1N0cmluZ30gdXNlcm5hbWUKICogQHBhcmFtIHtTdHJpbmd9IHBhc3N3b3JkCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5zaWdudXAgPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkLCBjYWxsYmFjaykgewogICAgdmFyIGRvYyA9IHt9OwogICAgZG9jLl9pZCA9ICdvcmcuY291Y2hkYi51c2VyOicgKyB1c2VybmFtZTsKICAgIGRvYy5uYW1lID0gdXNlcm5hbWU7CiAgICBkb2MudHlwZSA9ICd1c2VyJzsKICAgIGRvYy5yb2xlcyA9IFtdOwoKICAgIGRiLm5ld1VVSUQoMTAwLCBmdW5jdGlvbiAoZXJyLCB1dWlkKSB7CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTsKICAgICAgICB9CiAgICAgICAgZG9jLnNhbHQgPSB1dWlkOwogICAgICAgIGRvYy5wYXNzd29yZF9zaGEgPSBzaGExLmhleChwYXNzd29yZCArIGRvYy5zYWx0KTsKICAgICAgICBleHBvcnRzLnVzZXJEYihmdW5jdGlvbiAoZXJyLCB1c2VyZGIpIHsKICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHVybCA9ICcvJyArIHVzZXJkYiArICcvJyArIGRvYy5faWQ7CiAgICAgICAgICAgIHZhciByZXEgPSB7CiAgICAgICAgICAgICAgICB0eXBlOiAnUFVUJywKICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoZG9jKSwKICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSwKICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZGIucmVxdWVzdChyZXEsIGNhbGxiYWNrKTsKICAgICAgICB9KTsKICAgIH0pOwp9OwoKCn0pfTsKCi8qKioqKioqKioqIGthbnNvL3NoYTEgKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJrYW5zby9zaGExIl0gPSB7bG9hZDogKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUpIHsKCi8qKg0KICogQSBKYXZhU2NyaXB0IGltcGxlbWVudGF0aW9uIG9mIHRoZSBTZWN1cmUgSGFzaCBBbGdvcml0aG0sIFNIQS0xLCBhcyBkZWZpbmVkDQogKiBpbiBGSVBTIFBVQiAxODAtMS4gVGhpcyBtb2R1bGUgaXMgdXNlZCB0byBoYXNoIHVzZXIgcGFzc3dvcmRzIGluIGEgd2F5IHRoYXQncw0KICogY29tcGF0aWJsZSB3aXRoIENvdWNoREIuDQogKg0KICogVGhpcyBtb2R1bGUgaXMgQ29weXJpZ2h0IFBhdWwgSm9obnN0b24gMjAwMCAtIDIwMDIgYW5kIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZQ0KICogQlNEIExpY2Vuc2UuIFNlZSBodHRwOi8vcGFqaG9tZS5vcmcudWsvY3J5cHQvbWQ1IGZvciBkZXRhaWxzLg0KICoNCiAqIEBtb2R1bGUNCiAqLw0KDQovKg0KICogQSBKYXZhU2NyaXB0IGltcGxlbWVudGF0aW9uIG9mIHRoZSBTZWN1cmUgSGFzaCBBbGdvcml0aG0sIFNIQS0xLCBhcyBkZWZpbmVkDQogKiBpbiBGSVBTIFBVQiAxODAtMQ0KICogVmVyc2lvbiAyLjFhIENvcHlyaWdodCBQYXVsIEpvaG5zdG9uIDIwMDAgLSAyMDAyLg0KICogT3RoZXIgY29udHJpYnV0b3JzOiBHcmVnIEhvbHQsIEFuZHJldyBLZXBlcnQsIFlkbmFyLCBMb3N0aW5ldA0KICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBMaWNlbnNlDQogKiBTZWUgaHR0cDovL3BhamhvbWUub3JnLnVrL2NyeXB0L21kNSBmb3IgZGV0YWlscy4NCiAqLw0KDQovKg0KICogQ29uZmlndXJhYmxlIHZhcmlhYmxlcy4gWW91IG1heSBuZWVkIHRvIHR3ZWFrIHRoZXNlIHRvIGJlIGNvbXBhdGlibGUgd2l0aA0KICogdGhlIHNlcnZlci1zaWRlLCBidXQgdGhlIGRlZmF1bHRzIHdvcmsgaW4gbW9zdCBjYXNlcy4NCiAqLw0KdmFyIGhleGNhc2UgPSAwOyAgLyogaGV4IG91dHB1dCBmb3JtYXQuIDAgLSBsb3dlcmNhc2U7IDEgLSB1cHBlcmNhc2UgICAgICAgICovDQp2YXIgYjY0cGFkICA9ICI9IjsgLyogYmFzZS02NCBwYWQgY2hhcmFjdGVyLiAiPSIgZm9yIHN0cmljdCBSRkMgY29tcGxpYW5jZSAgICovDQp2YXIgY2hyc3ogICA9IDg7ICAvKiBiaXRzIHBlciBpbnB1dCBjaGFyYWN0ZXIuIDggLSBBU0NJSTsgMTYgLSBVbmljb2RlICAgICAgKi8NCg0KLyoNCiAqIFRoZXNlIGFyZSB0aGUgZnVuY3Rpb25zIHlvdSdsbCB1c3VhbGx5IHdhbnQgdG8gY2FsbA0KICogVGhleSB0YWtlIHN0cmluZyBhcmd1bWVudHMgYW5kIHJldHVybiBlaXRoZXIgaGV4IG9yIGJhc2UtNjQgZW5jb2RlZCBzdHJpbmdzDQogKi8NCmZ1bmN0aW9uIGhleF9zaGExKHMpe3JldHVybiBiaW5iMmhleChjb3JlX3NoYTEoc3RyMmJpbmIocykscy5sZW5ndGggKiBjaHJzeikpO30NCmZ1bmN0aW9uIGI2NF9zaGExKHMpe3JldHVybiBiaW5iMmI2NChjb3JlX3NoYTEoc3RyMmJpbmIocykscy5sZW5ndGggKiBjaHJzeikpO30NCmZ1bmN0aW9uIHN0cl9zaGExKHMpe3JldHVybiBiaW5iMnN0cihjb3JlX3NoYTEoc3RyMmJpbmIocykscy5sZW5ndGggKiBjaHJzeikpO30NCmZ1bmN0aW9uIGhleF9obWFjX3NoYTEoa2V5LCBkYXRhKXsgcmV0dXJuIGJpbmIyaGV4KGNvcmVfaG1hY19zaGExKGtleSwgZGF0YSkpO30NCmZ1bmN0aW9uIGI2NF9obWFjX3NoYTEoa2V5LCBkYXRhKXsgcmV0dXJuIGJpbmIyYjY0KGNvcmVfaG1hY19zaGExKGtleSwgZGF0YSkpO30NCmZ1bmN0aW9uIHN0cl9obWFjX3NoYTEoa2V5LCBkYXRhKXsgcmV0dXJuIGJpbmIyc3RyKGNvcmVfaG1hY19zaGExKGtleSwgZGF0YSkpO30NCg0KLyoNCiAqIFBlcmZvcm0gYSBzaW1wbGUgc2VsZi10ZXN0IHRvIHNlZSBpZiB0aGUgVk0gaXMgd29ya2luZw0KICovDQpmdW5jdGlvbiBzaGExX3ZtX3Rlc3QoKQ0Kew0KICByZXR1cm4gaGV4X3NoYTEoImFiYyIpID09ICJhOTk5M2UzNjQ3MDY4MTZhYmEzZTI1NzE3ODUwYzI2YzljZDBkODlkIjsNCn0NCg0KLyoNCiAqIENhbGN1bGF0ZSB0aGUgU0hBLTEgb2YgYW4gYXJyYXkgb2YgYmlnLWVuZGlhbiB3b3JkcywgYW5kIGEgYml0IGxlbmd0aA0KICovDQpmdW5jdGlvbiBjb3JlX3NoYTEoeCwgbGVuKQ0Kew0KICAvKiBhcHBlbmQgcGFkZGluZyAqLw0KICB4W2xlbiA+PiA1XSB8PSAweDgwIDw8ICgyNCAtIGxlbiAlIDMyKTsNCiAgeFsoKGxlbiArIDY0ID4+IDkpIDw8IDQpICsgMTVdID0gbGVuOw0KDQogIHZhciB3ID0gQXJyYXkoODApOw0KICB2YXIgYSA9ICAxNzMyNTg0MTkzOw0KICB2YXIgYiA9IC0yNzE3MzM4Nzk7DQogIHZhciBjID0gLTE3MzI1ODQxOTQ7DQogIHZhciBkID0gIDI3MTczMzg3ODsNCiAgdmFyIGUgPSAtMTAwOTU4OTc3NjsNCg0KICBmb3IodmFyIGkgPSAwOyBpIDwgeC5sZW5ndGg7IGkgKz0gMTYpDQogIHsNCiAgICB2YXIgb2xkYSA9IGE7DQogICAgdmFyIG9sZGIgPSBiOw0KICAgIHZhciBvbGRjID0gYzsNCiAgICB2YXIgb2xkZCA9IGQ7DQogICAgdmFyIG9sZGUgPSBlOw0KDQogICAgZm9yKHZhciBqID0gMDsgaiA8IDgwOyBqKyspDQogICAgew0KICAgICAgaWYoaiA8IDE2KSB3W2pdID0geFtpICsgal07DQogICAgICBlbHNlIHdbal0gPSByb2wod1tqLTNdIF4gd1tqLThdIF4gd1tqLTE0XSBeIHdbai0xNl0sIDEpOw0KICAgICAgdmFyIHQgPSBzYWZlX2FkZChzYWZlX2FkZChyb2woYSwgNSksIHNoYTFfZnQoaiwgYiwgYywgZCkpLA0KICAgICAgICAgICAgICAgICAgICAgICBzYWZlX2FkZChzYWZlX2FkZChlLCB3W2pdKSwgc2hhMV9rdChqKSkpOw0KICAgICAgZSA9IGQ7DQogICAgICBkID0gYzsNCiAgICAgIGMgPSByb2woYiwgMzApOw0KICAgICAgYiA9IGE7DQogICAgICBhID0gdDsNCiAgICB9DQoNCiAgICBhID0gc2FmZV9hZGQoYSwgb2xkYSk7DQogICAgYiA9IHNhZmVfYWRkKGIsIG9sZGIpOw0KICAgIGMgPSBzYWZlX2FkZChjLCBvbGRjKTsNCiAgICBkID0gc2FmZV9hZGQoZCwgb2xkZCk7DQogICAgZSA9IHNhZmVfYWRkKGUsIG9sZGUpOw0KICB9DQogIHJldHVybiBBcnJheShhLCBiLCBjLCBkLCBlKTsNCg0KfQ0KDQovKg0KICogUGVyZm9ybSB0aGUgYXBwcm9wcmlhdGUgdHJpcGxldCBjb21iaW5hdGlvbiBmdW5jdGlvbiBmb3IgdGhlIGN1cnJlbnQNCiAqIGl0ZXJhdGlvbg0KICovDQpmdW5jdGlvbiBzaGExX2Z0KHQsIGIsIGMsIGQpDQp7DQogIGlmKHQgPCAyMCkgcmV0dXJuIChiICYgYykgfCAoKH5iKSAmIGQpOw0KICBpZih0IDwgNDApIHJldHVybiBiIF4gYyBeIGQ7DQogIGlmKHQgPCA2MCkgcmV0dXJuIChiICYgYykgfCAoYiAmIGQpIHwgKGMgJiBkKTsNCiAgcmV0dXJuIGIgXiBjIF4gZDsNCn0NCg0KLyoNCiAqIERldGVybWluZSB0aGUgYXBwcm9wcmlhdGUgYWRkaXRpdmUgY29uc3RhbnQgZm9yIHRoZSBjdXJyZW50IGl0ZXJhdGlvbg0KICovDQpmdW5jdGlvbiBzaGExX2t0KHQpDQp7DQogIHJldHVybiAodCA8IDIwKSA/ICAxNTE4NTAwMjQ5IDogKHQgPCA0MCkgPyAgMTg1OTc3NTM5MyA6DQogICAgICAgICAodCA8IDYwKSA/IC0xODk0MDA3NTg4IDogLTg5OTQ5NzUxNDsNCn0NCg0KLyoNCiAqIENhbGN1bGF0ZSB0aGUgSE1BQy1TSEExIG9mIGEga2V5IGFuZCBzb21lIGRhdGENCiAqLw0KZnVuY3Rpb24gY29yZV9obWFjX3NoYTEoa2V5LCBkYXRhKQ0Kew0KICB2YXIgYmtleSA9IHN0cjJiaW5iKGtleSk7DQogIGlmKGJrZXkubGVuZ3RoID4gMTYpIGJrZXkgPSBjb3JlX3NoYTEoYmtleSwga2V5Lmxlbmd0aCAqIGNocnN6KTsNCg0KICB2YXIgaXBhZCA9IEFycmF5KDE2KSwgb3BhZCA9IEFycmF5KDE2KTsNCiAgZm9yKHZhciBpID0gMDsgaSA8IDE2OyBpKyspDQogIHsNCiAgICBpcGFkW2ldID0gYmtleVtpXSBeIDB4MzYzNjM2MzY7DQogICAgb3BhZFtpXSA9IGJrZXlbaV0gXiAweDVDNUM1QzVDOw0KICB9DQoNCiAgdmFyIGhhc2ggPSBjb3JlX3NoYTEoaXBhZC5jb25jYXQoc3RyMmJpbmIoZGF0YSkpLCA1MTIgKyBkYXRhLmxlbmd0aCAqIGNocnN6KTsNCiAgcmV0dXJuIGNvcmVfc2hhMShvcGFkLmNvbmNhdChoYXNoKSwgNTEyICsgMTYwKTsNCn0NCg0KLyoNCiAqIEFkZCBpbnRlZ2Vycywgd3JhcHBpbmcgYXQgMl4zMi4gVGhpcyB1c2VzIDE2LWJpdCBvcGVyYXRpb25zIGludGVybmFsbHkNCiAqIHRvIHdvcmsgYXJvdW5kIGJ1Z3MgaW4gc29tZSBKUyBpbnRlcnByZXRlcnMuDQogKi8NCmZ1bmN0aW9uIHNhZmVfYWRkKHgsIHkpDQp7DQogIHZhciBsc3cgPSAoeCAmIDB4RkZGRikgKyAoeSAmIDB4RkZGRik7DQogIHZhciBtc3cgPSAoeCA+PiAxNikgKyAoeSA+PiAxNikgKyAobHN3ID4+IDE2KTsNCiAgcmV0dXJuIChtc3cgPDwgMTYpIHwgKGxzdyAmIDB4RkZGRik7DQp9DQoNCi8qDQogKiBCaXR3aXNlIHJvdGF0ZSBhIDMyLWJpdCBudW1iZXIgdG8gdGhlIGxlZnQuDQogKi8NCmZ1bmN0aW9uIHJvbChudW0sIGNudCkNCnsNCiAgcmV0dXJuIChudW0gPDwgY250KSB8IChudW0gPj4+ICgzMiAtIGNudCkpOw0KfQ0KDQovKg0KICogQ29udmVydCBhbiA4LWJpdCBvciAxNi1iaXQgc3RyaW5nIHRvIGFuIGFycmF5IG9mIGJpZy1lbmRpYW4gd29yZHMNCiAqIEluIDgtYml0IGZ1bmN0aW9uLCBjaGFyYWN0ZXJzID4yNTUgaGF2ZSB0aGVpciBoaS1ieXRlIHNpbGVudGx5IGlnbm9yZWQuDQogKi8NCmZ1bmN0aW9uIHN0cjJiaW5iKHN0cikNCnsNCiAgdmFyIGJpbiA9IEFycmF5KCk7DQogIHZhciBtYXNrID0gKDEgPDwgY2hyc3opIC0gMTsNCiAgZm9yKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGggKiBjaHJzejsgaSArPSBjaHJzeikNCiAgICBiaW5baT4+NV0gfD0gKHN0ci5jaGFyQ29kZUF0KGkgLyBjaHJzeikgJiBtYXNrKSA8PCAoMzIgLSBjaHJzeiAtIGklMzIpOw0KICByZXR1cm4gYmluOw0KfQ0KDQovKg0KICogQ29udmVydCBhbiBhcnJheSBvZiBiaWctZW5kaWFuIHdvcmRzIHRvIGEgc3RyaW5nDQogKi8NCmZ1bmN0aW9uIGJpbmIyc3RyKGJpbikNCnsNCiAgdmFyIHN0ciA9ICIiOw0KICB2YXIgbWFzayA9ICgxIDw8IGNocnN6KSAtIDE7DQogIGZvcih2YXIgaSA9IDA7IGkgPCBiaW4ubGVuZ3RoICogMzI7IGkgKz0gY2hyc3opDQogICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGJpbltpPj41XSA+Pj4gKDMyIC0gY2hyc3ogLSBpJTMyKSkgJiBtYXNrKTsNCiAgcmV0dXJuIHN0cjsNCn0NCg0KLyoNCiAqIENvbnZlcnQgYW4gYXJyYXkgb2YgYmlnLWVuZGlhbiB3b3JkcyB0byBhIGhleCBzdHJpbmcuDQogKi8NCmZ1bmN0aW9uIGJpbmIyaGV4KGJpbmFycmF5KQ0Kew0KICB2YXIgaGV4X3RhYiA9IGhleGNhc2UgPyAiMDEyMzQ1Njc4OUFCQ0RFRiIgOiAiMDEyMzQ1Njc4OWFiY2RlZiI7DQogIHZhciBzdHIgPSAiIjsNCiAgZm9yKHZhciBpID0gMDsgaSA8IGJpbmFycmF5Lmxlbmd0aCAqIDQ7IGkrKykNCiAgew0KICAgIHN0ciArPSBoZXhfdGFiLmNoYXJBdCgoYmluYXJyYXlbaT4+Ml0gPj4gKCgzIC0gaSU0KSo4KzQpKSAmIDB4RikgKw0KICAgICAgICAgICBoZXhfdGFiLmNoYXJBdCgoYmluYXJyYXlbaT4+Ml0gPj4gKCgzIC0gaSU0KSo4ICApKSAmIDB4Rik7DQogIH0NCiAgcmV0dXJuIHN0cjsNCn0NCg0KLyoNCiAqIENvbnZlcnQgYW4gYXJyYXkgb2YgYmlnLWVuZGlhbiB3b3JkcyB0byBhIGJhc2UtNjQgc3RyaW5nDQogKi8NCmZ1bmN0aW9uIGJpbmIyYjY0KGJpbmFycmF5KQ0Kew0KICB2YXIgdGFiID0gIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8iOw0KICB2YXIgc3RyID0gIiI7DQogIGZvcih2YXIgaSA9IDA7IGkgPCBiaW5hcnJheS5sZW5ndGggKiA0OyBpICs9IDMpDQogIHsNCiAgICB2YXIgdHJpcGxldCA9ICgoKGJpbmFycmF5W2kgICA+PiAyXSA+PiA4ICogKDMgLSAgaSAgICU0KSkgJiAweEZGKSA8PCAxNikNCiAgICAgICAgICAgICAgICB8ICgoKGJpbmFycmF5W2krMSA+PiAyXSA+PiA4ICogKDMgLSAoaSsxKSU0KSkgJiAweEZGKSA8PCA4ICkNCiAgICAgICAgICAgICAgICB8ICAoKGJpbmFycmF5W2krMiA+PiAyXSA+PiA4ICogKDMgLSAoaSsyKSU0KSkgJiAweEZGKTsNCiAgICBmb3IodmFyIGogPSAwOyBqIDwgNDsgaisrKQ0KICAgIHsNCiAgICAgIGlmKGkgKiA4ICsgaiAqIDYgPiBiaW5hcnJheS5sZW5ndGggKiAzMikgc3RyICs9IGI2NHBhZDsNCiAgICAgIGVsc2Ugc3RyICs9IHRhYi5jaGFyQXQoKHRyaXBsZXQgPj4gNiooMy1qKSkgJiAweDNGKTsNCiAgICB9DQogIH0NCiAgcmV0dXJuIHN0cjsNCn0NCg0KDQovKioNCiAqIEhhc2hlcyBhIHN0cmluZyB1c2luZyBTSEExIGFuZCByZXR1cm5zIGEgaGV4IHJlcHJlc2VudGF0aW9uIG9mIGl0Lg0KICoNCiAqIEBuYW1lIGhleChzKQ0KICogQHBhcmFtIHtTdHJpbmd9IHMNCiAqIEByZXR1cm5zIHtTdHJpbmd9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCmV4cG9ydHMuaGV4ID0gaGV4X3NoYTE7DQoNCi8qKg0KICogSGFzaGVzIGEgc3RyaW5nIHVzaW5nIFNIQTEgYW5kIHJldHVybnMgYSBiYXNlNjQgcmVwcmVzZW50YXRpb24gb2YgaXQuDQogKg0KICogQG5hbWUgYmFzZTY0KHMpDQogKiBAcGFyYW0ge1N0cmluZ30gcw0KICogQHJldHVybnMge1N0cmluZ30NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KZXhwb3J0cy5iYXNlNjQgPSBiNjRfc2hhMTsNCg0KLyoqDQogKiBIYXNoZXMgYSBzdHJpbmcgdXNpbmcgU0hBMSBhbmQgcmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiBpdC4NCiAqDQogKiBAbmFtZSBzdHIocykNCiAqIEBwYXJhbSB7U3RyaW5nfSBzDQogKiBAcmV0dXJucyB7U3RyaW5nfQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpleHBvcnRzLnN0ciA9IHN0cl9zaGExOw0KDQovKioNCiAqIENhbGN1bGF0ZXMgdGhlIEhNQUMtU0hBMSBvZiBhIGtleSBhbmQgc29tZSBkYXRhLCByZXR1cm5pbmcgYSBoZXgNCiAqIHJlcHJlc2VudGF0aW9uIG9mIGl0Lg0KICoNCiAqIEBuYW1lIGhleF9obWFjKGtleSwgZGF0YSkNCiAqIEBwYXJhbSB7U3RyaW5nfSBrZXkNCiAqIEBwYXJhbSB7U3RyaW5nfSBkYXRhDQogKiBAcmV0dXJucyB7U3RyaW5nfQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpleHBvcnRzLmhleF9obWFjID0gaGV4X2htYWNfc2hhMTsNCg0KLyoqDQogKiBDYWxjdWxhdGVzIHRoZSBITUFDLVNIQTEgb2YgYSBrZXkgYW5kIHNvbWUgZGF0YSwgcmV0dXJuaW5nIGEgYmFzZTY0DQogKiByZXByZXNlbnRhdGlvbiBvZiBpdC4NCiAqDQogKiBAbmFtZSBiYXNlNjRfaG1hYyhrZXksIGRhdGEpDQogKiBAcGFyYW0ge1N0cmluZ30ga2V5DQogKiBAcGFyYW0ge1N0cmluZ30gZGF0YQ0KICogQHJldHVybnMge1N0cmluZ30NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KZXhwb3J0cy5iYXNlNjRfaG1hYyA9IGI2NF9obWFjX3NoYTE7DQoNCi8qKg0KICogQ2FsY3VsYXRlcyB0aGUgSE1BQy1TSEExIG9mIGEga2V5IGFuZCBzb21lIGRhdGEsIHJldHVybmluZyBhIHN0cmluZw0KICogcmVwcmVzZW50YXRpb24gb2YgaXQuDQogKg0KICogQG5hbWUgc3RyX2htYWMoa2V5LCBkYXRhKQ0KICogQHBhcmFtIHtTdHJpbmd9IGtleQ0KICogQHBhcmFtIHtTdHJpbmd9IGRhdGENCiAqIEByZXR1cm5zIHtTdHJpbmd9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCmV4cG9ydHMuc3RyX2htYWMgPSBzdHJfaG1hY19zaGExOw0KCgp9KX07CgovKioqKioqKioqKiBrYW5zby90eXBlcyAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImthbnNvL3R5cGVzIl0gPSB7bG9hZDogKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUpIHsKCi8qKgogKiBEb2N1bWVudCB0eXBlcyBjYW4gYmUgdXNlZCB0byBlYXNlIHRoZSB2YWxpZGF0aW9uIG9mIHVwZGF0ZXMgYW5kIGNoZWNrCiAqIHBlcm1pc3Npb25zIHdoZW4gY3JlYXRpbmcsIGVkaXRpbmcgb3IgZGVsZXRpbmcgZG9jdW1lbnRzLgogKgogKiBAbW9kdWxlCiAqLwoKCi8qKgogKiBNb2R1bGUgZGVwZW5kZW5jaWVzCiAqLwoKdmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpLAogICAga2Fuc29fdXRpbHMgPSByZXF1aXJlKCdrYW5zby91dGlscycpLAogICAgZGIgPSByZXF1aXJlKCcuL2RiJyksCiAgICBmaWVsZHMgPSByZXF1aXJlKCcuL2ZpZWxkcycpLAogICAgZmllbGRzZXQgPSByZXF1aXJlKCcuL2ZpZWxkc2V0JyksCiAgICB3aWRnZXRzID0gcmVxdWlyZSgnLi93aWRnZXRzJyksCiAgICBwZXJtaXNzaW9ucyA9IHJlcXVpcmUoJy4vcGVybWlzc2lvbnMnKSwKICAgIF8gPSByZXF1aXJlKCcuL3VuZGVyc2NvcmUnKS5fOwoKCi8qKgogKiBDcmVhdGVzIGEgbmV3IFR5cGUgb2JqZWN0CiAqCiAqICMjIyMgT3B0aW9ucyAjIyMjCiAqCiAqICogKipmaWVsZHMqKiAgICAgICAqT2JqZWN0KiAtIEZpZWxkIG9iamVjdHMgdG8gdXNlIGFzIHRoZSBUeXBlcydzIHNjaGVtYQogKiAqICoqcGVybWlzc2lvbnMqKiAgKk9iamVjdCogLSBhIHBlcm1pc3Npb25zIGNoZWNrIGZ1bmN0aW9uIG9yIGFuIG9iamVjdAogKiAgICAgICAgICAgICAgICAgICAgY29udGFpbmluZyBzZXBhcmF0ZSBmdW5jdGlvbnMgdG8gcnVuIG9uIGFkZCwgcmVtb3ZlCiAqICAgICAgICAgICAgICAgICAgICBhbmQgdXBkYXRlIG9wZXJhdGlvbnMuCiAqICogKipkaXNwbGF5X25hbWUqKiAqRnVuY3Rpb258U3RyaW5nfEFycmF5KiAtIG5hbWUgdG8gYmUgdXNlZCB3aGVuIGRpc3BsYXlpbmcKICogICAgICAgICAgICAgICAgICAgIHRoZSBkb2N1bWVudCBpbiB0aGUgYWRtaW4gdG9vbC4gQSBzdHJpbmcgb3IgYXJyYXkKICogICAgICAgICAgICAgICAgICAgIHdpbGwgYmVjb21lIHRoZSBwcm9wZXJ0eSB0byBkaXNwbGF5LiBBIGZ1bmN0aW9uCiAqICAgICAgICAgICAgICAgICAgICBzaG91bGQgdGFrZSB0aGUgZG9jdW1lbnQgYXMgYSBvYmplY3QgYW5kIHJldHVybgogKiAgICAgICAgICAgICAgICAgICAgdGhlIGRpc3BsYXkgbmFtZS4KICoKICogQG5hbWUgVHlwZShuYW1lLCBvcHRpb25zKQogKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogKiBAY29uc3RydWN0b3IKICogQGFwaSBwdWJsaWMKICovCgp2YXIgVHlwZSA9IGV4cG9ydHMuVHlwZSA9IGZ1bmN0aW9uIFR5cGUobmFtZSwgb3B0aW9ucykgewogICAgaWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJykgewogICAgICAgIHRocm93IG5ldyBFcnJvcignRmlyc3QgYXJndW1lbnQgbXVzdCBiZSB0aGUgdHlwZSBuYW1lJyk7CiAgICB9CiAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgdmFyIGYgPSB7fTsKICAgIGYuX2lkID0gZmllbGRzLnN0cmluZyh7CiAgICAgICAgb21pdF9lbXB0eTogdHJ1ZSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgd2lkZ2V0OiB3aWRnZXRzLmhpZGRlbigpLAogICAgICAgIHBlcm1pc3Npb25zOiB7CiAgICAgICAgICAgIHVwZGF0ZTogcGVybWlzc2lvbnMuZmllbGRVbmVkaXRhYmxlKCkKICAgICAgICB9LAogICAgICAgIGRlZmF1bHRfdmFsdWU6IGZ1bmN0aW9uIChyZXEpIHsKICAgICAgICAgICAgcmV0dXJuIHJlcS51dWlkOwogICAgICAgIH0KICAgIH0pOwogICAgZi5fcmV2ID0gZmllbGRzLnN0cmluZyh7CiAgICAgICAgb21pdF9lbXB0eTogdHJ1ZSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgd2lkZ2V0OiB3aWRnZXRzLmhpZGRlbigpCiAgICB9KTsKICAgIGYuX2RlbGV0ZWQgPSBmaWVsZHMuYm9vbGVhbih7CiAgICAgICAgb21pdF9lbXB0eTogdHJ1ZSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgd2lkZ2V0OiB3aWRnZXRzLmhpZGRlbigpCiAgICB9KTsKICAgIGYudHlwZSA9IGZpZWxkcy5zdHJpbmcoewogICAgICAgIGRlZmF1bHRfdmFsdWU6IG5hbWUsCiAgICAgICAgd2lkZ2V0OiB3aWRnZXRzLmhpZGRlbigpLAogICAgICAgIHZhbGlkYXRvcnM6IFsKICAgICAgICAgICAgZnVuY3Rpb24gKGRvYywgdmFsLCByYXcpIHsKICAgICAgICAgICAgICAgIGlmICh2YWwgIT09IG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuZXhwZWN0ZWQgdmFsdWUgZm9yIHR5cGUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICBdCiAgICB9KTsKICAgIGZvciAodmFyIGsgaW4gb3B0aW9ucy5maWVsZHMpIHsKICAgICAgICBpZiAob3B0aW9ucy5maWVsZHMuaGFzT3duUHJvcGVydHkoaykpIHsKICAgICAgICAgICAgZltrXSA9IG9wdGlvbnMuZmllbGRzW2tdOwogICAgICAgIH0KICAgIH0KCiAgICBvcHRpb25zLmZpZWxkcyA9IGY7CiAgICBfLmV4dGVuZCh0aGlzLCBfLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBwZXJtaXNzaW9uczogW10KICAgIH0pKTsKCiAgICBpZiAob3B0aW9ucy5kaXNwbGF5X25hbWUpIHsKICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuZGlzcGxheV9uYW1lICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHRoaXMuZGlzcGxheV9uYW1lID0gZnVuY3Rpb24gKGRvYykgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmRpc3BsYXlfbmFtZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRpc3BsYXlfbmFtZSA9IFtvcHRpb25zLmRpc3BsYXlfbmFtZV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4ga2Fuc29fdXRpbHMuZ2V0UHJvcGVydHlQYXRoKGRvYywgb3B0aW9ucy5kaXNwbGF5X25hbWUpOwogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KfTsKCi8qKgogKiBSdW4gZmllbGQgdmFsaWRhdG9ycyBhZ2FpbnN0IGRvY3VtZW50IGFuZCBjaGVjayBmb3IgbWlzc2luZyByZXF1aXJlZAogKiBmaWVsZHMgb3IgZXh0cmEgZmllbGRzIHdoZW4gdGhlIFR5cGVzJ3MgYWxsb3dfZXh0cmFfZmllbGRzIHByb3BlcnR5IGlzCiAqIHNldCB0byBmYWxzZS4KICoKICogQG5hbWUgVHlwZS52YWxpZGF0ZShkb2MsIHJhd0RvYykKICogQHBhcmFtIHtPYmplY3R9IGRvYwogKiBAcGFyYW0ge09iamVjdH0gcmF3RG9jCiAqIEByZXR1cm5zIHtBcnJheX0KICogQGFwaSBwdWJsaWMKICovCgpUeXBlLnByb3RvdHlwZS52YWxpZGF0ZSA9IGZ1bmN0aW9uIChkb2MsIHJhd0RvYykgewogICAgcmF3RG9jID0gcmF3RG9jIHx8IGRvYzsKICAgIHJldHVybiBmaWVsZHNldC52YWxpZGF0ZSgKICAgICAgICB0aGlzLmZpZWxkcywKICAgICAgICBkb2MsCiAgICAgICAgZG9jLAogICAgICAgIHJhd0RvYywKICAgICAgICBbXSwKICAgICAgICB0aGlzLmFsbG93X2V4dHJhX2ZpZWxkcwogICAgKTsKfTsKCgovKioKICogUnVuIGZpZWxkIHBlcm1pc3Npb25zIGNoZWNrcyBhZ2FpbnN0IHVzZXJDdHggYW5kIGRvY3VtZW50LgogKgogKiBAbmFtZSBUeXBlLmF1dGhvcml6ZShuRG9jLCBvRG9jLCB1c2VyKQogKiBAcGFyYW0ge09iamVjdH0gbkRvYyAtIG5ldyBkb2N1bWVudAogKiBAcGFyYW0ge09iamVjdH0gb0RvYyAtIG9sZCBkb2N1bWVudAogKiBAcGFyYW0ge09iamVjdH0gdXNlckN0eCAtIHVzZXIgY29udGV4dCBvYmplY3QKICogQHJldHVybnMge0FycmF5fQogKiBAYXBpIHB1YmxpYwogKi8KClR5cGUucHJvdG90eXBlLmF1dGhvcml6ZSA9IGZ1bmN0aW9uIChuRG9jLCBvRG9jLCB1c2VyKSB7CiAgICB2YXIgZXJycyA9IHRoaXMuYXV0aG9yaXplVHlwZUxldmVsKG5Eb2MsIG9Eb2MsIHVzZXIpOwogICAgcmV0dXJuIGVycnMuY29uY2F0KGZpZWxkc2V0LmF1dGhGaWVsZFNldCgKICAgICAgICB0aGlzLmZpZWxkcywgbkRvYywgb0RvYywgbkRvYywgb0RvYywgdXNlciwgW10sIHRoaXMuYWxsb3dfZXh0cmFfZmllbGRzCiAgICApKTsKfTsKCi8qKgogKiBSdW5zIHRvcCB0eXBlLWxldmVsIHBlcm1pc3Npb25zIGNoZWNrcyBvbmx5LgogKgogKiBAbmFtZSBUeXBlLmF1dGhvcml6ZVR5cGVMZXZlbChuRG9jLCBvRG9jLCB1c2VyKQogKiBAcGFyYW0ge09iamVjdH0gbkRvYyAtIG5ldyBkb2N1bWVudAogKiBAcGFyYW0ge09iamVjdH0gb0RvYyAtIG9sZCBkb2N1bWVudAogKiBAcGFyYW0ge09iamVjdH0gdXNlckN0eCAtIHVzZXIgY29udGV4dCBvYmplY3QKICogQHJldHVybnMge0FycmF5fQogKiBAYXBpIHB1YmxpYwogKi8KClR5cGUucHJvdG90eXBlLmF1dGhvcml6ZVR5cGVMZXZlbCA9IGZ1bmN0aW9uIChuRG9jLCBvRG9jLCB1c2VyKSB7CiAgICB2YXIgcGVybXMgPSB0aGlzLnBlcm1pc3Npb25zOwogICAgdmFyIGVycnMgPSBbXTsKICAgIGlmIChfLmlzRnVuY3Rpb24ocGVybXMpKSB7CiAgICAgICAgZXJycyA9IGVycnMuY29uY2F0KAogICAgICAgICAgICB1dGlscy5nZXRFcnJvcnMocGVybXMsIFtuRG9jLCBvRG9jLCBudWxsLCBudWxsLCB1c2VyXSkKICAgICAgICApOwogICAgfQogICAgLy8gb24gdXBkYXRlCiAgICB2YXIgZm4gPSBwZXJtcy51cGRhdGU7CiAgICAvLyBvbiBhZGQKICAgIGlmIChuRG9jICYmICFvRG9jKSB7CiAgICAgICAgZm4gPSBwZXJtcy5hZGQ7CiAgICB9CiAgICAvLyBvbiByZW1vdmUKICAgIGVsc2UgaWYgKCFuRG9jIHx8IG5Eb2MuX2RlbGV0ZWQpIHsKICAgICAgICBmbiA9IHBlcm1zLnJlbW92ZTsKICAgIH0KICAgIGlmIChmbikgewogICAgICAgIGVycnMgPSBlcnJzLmNvbmNhdCgKICAgICAgICAgICAgdXRpbHMuZ2V0RXJyb3JzKGZuLCBbbkRvYywgb0RvYywgbnVsbCwgbnVsbCwgdXNlcl0pCiAgICAgICAgKTsKICAgIH0KICAgIHJldHVybiBlcnJzOwp9OwoKLyoqCiAqIENyZWF0ZSdzIGEgbmV3IG9iamVjdCBmb3IgdGhpcyBUeXBlLiBQcmUtZmlsbGluZyBhbnkgZGVmYXVsdCB2YWx1ZXMgYW5kCiAqIHByb3ZpZGluZyBhIG5ldyBfaWQgdmFsdWUuIFRoaXMgaXMgYSBjb252ZW5pZW50IGZ1bmN0aW9uIHRvIHVzZSB3aGVuIGNyZWF0aW5nCiAqIGEgdHlwZSB0byBlbWJlZCB3aXRoaW4gYW5vdGhlci4KICoKICogQG5hbWUgVHlwZS5jcmVhdGUodXNlckN0eCwgY2FsbGJhY2spCiAqIEBwYXJhbSB7T2JqZWN0fSB1c2VyQ3R4CiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAqIEBhcGkgcHVibGljCiAqLwoKVHlwZS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKHVzZXJDdHgsIGNhbGxiYWNrKSB7CiAgICB2YXIgZG9jID0gZmllbGRzZXQuY3JlYXRlRGVmYXVsdHModGhpcy5maWVsZHMsIHt1c2VyQ3R4OiB1c2VyQ3R4fSk7CiAgICBkYi5uZXdVVUlEKDEwMCwgZnVuY3Rpb24gKGVyciwgdXVpZCkgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7CiAgICAgICAgfQogICAgICAgIGRvYy5faWQgPSB1dWlkOwogICAgICAgIGNhbGxiYWNrKG51bGwsIGRvYyk7CiAgICB9KTsKfTsKCi8qKgogKiBDYWxscyB2YWxpZGF0aW9uIGFuZCBwZXJtaXNzaW9ucyBmdW5jdGlvbnMgcmVsZXZhbnQgdG8gYSBkb2N1bWVudCB1cGRhdGUuCiAqIFRoaXMgc2hvdWxkIGJlIGNhbGxlZCBmcm9tIHlvdXIgYXBwJ3MgZXhwb3J0ZWQgdmFsaWRhdGVfZG9jX3VwZGF0ZSBmdW5jdGlvbgogKiBpZiB5b3Ugd2lzaCB0byB1c2Uga2Fuc28gVHlwZXMgaW4geW91IHByb2plY3QuCiAqCiAqIFRocm93cyBvbiBlcnJvci4KICoKICogQG5hbWUgdmFsaWRhdGVfZG9jX3VwZGF0ZSh0eXBlcywgbmV3RG9jLCBvbGREb2MsIHVzZXJDdHgpCiAqIEBwYXJhbSB7T2JqZWN0fSB0eXBlcwogKiBAcGFyYW0ge09iamVjdH0gbmV3RG9jCiAqIEBwYXJhbSB7T2JqZWN0fSBvbGREb2MKICogQHBhcmFtIHtPYmplY3R9IHVzZXJDdHgKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnZhbGlkYXRlX2RvY191cGRhdGUgPSBmdW5jdGlvbiAodHlwZXMsIG5ld0RvYywgb2xkRG9jLCB1c2VyQ3R4KSB7CiAgICB2YXIgdHlwZSA9IChvbGREb2MgJiYgb2xkRG9jLnR5cGUpIHx8IG5ld0RvYy50eXBlOwogICAgaWYgKHR5cGUgJiYgdHlwZXNbdHlwZV0pIHsKICAgICAgICB2YXIgdCA9IHR5cGVzW3R5cGVdOwogICAgICAgIGlmICghbmV3RG9jLl9kZWxldGVkKSB7CiAgICAgICAgICAgIHZhciB2YWxpZGF0aW9uX2Vycm9ycyA9IHQudmFsaWRhdGUobmV3RG9jKTsKICAgICAgICAgICAgaWYgKHZhbGlkYXRpb25fZXJyb3JzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgdmFyIGVyciA9IHZhbGlkYXRpb25fZXJyb3JzWzBdOwogICAgICAgICAgICAgICAgdmFyIG1zZyA9IGVyci5tZXNzYWdlIHx8IGVyci50b1N0cmluZygpOwogICAgICAgICAgICAgICAgaWYgKGVyci5maWVsZCAmJiBlcnIuZmllbGQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgbXNnID0gZXJyLmZpZWxkLmpvaW4oJy4nKSArICc6ICcgKyBtc2c7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aHJvdyB7Zm9yYmlkZGVuOiBtc2d9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBwZXJtaXNzaW9uc19lcnJvcnMgPSB0LmF1dGhvcml6ZShuZXdEb2MsIG9sZERvYywgdXNlckN0eCk7CiAgICAgICAgaWYgKHBlcm1pc3Npb25zX2Vycm9ycy5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGVycjIgPSBwZXJtaXNzaW9uc19lcnJvcnNbMF07CiAgICAgICAgICAgIHZhciBtc2cyID0gZXJyMi5tZXNzYWdlIHx8IGVycjIudG9TdHJpbmcoKTsKICAgICAgICAgICAgaWYgKGVycjIuZmllbGQgJiYgZXJyMi5maWVsZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIG1zZzIgPSBlcnIyLmZpZWxkLmpvaW4oJy4nKSArICc6ICcgKyBtc2cyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IHt1bmF1dGhvcml6ZWQ6IG1zZzJ9OwogICAgICAgIH0KICAgICAgICBpZiAodC52YWxpZGF0ZV9kb2NfdXBkYXRlKSB7CiAgICAgICAgICAgIHQudmFsaWRhdGVfZG9jX3VwZGF0ZShuZXdEb2MsIG9sZERvYywgdXNlckN0eCk7CiAgICAgICAgfQogICAgfQp9OwoKLyoqCiAqIFRoaXMgdHlwZSB3cmFwcyBhIHJlZmVyZW5jZSB0byBhIGRvY3VtZW50LiBUaGUgX2lkIGF0dHJpYnV0ZSBpcwogKiBhdXRvLWdlbmVyYXRlZCBhcyB1c3VhbDsgdGhlIGlkIG9mIHRoZSBkb2N1bWVudCBiZWluZyByZWZlcnJlZCB0bwogKiBpcyBzdG9yZWQgaW4gdGhlICdyZWYnIGF0dHJpYnV0ZS4gSW4gbGlzdHMsIHRoaXMgaGFzIHRoZSBlZmZlY3Qgb2YKICogYWxsb3dpbmcgbXVsdGlwbGUgcmVmZXJlbmNlcyB0byBhIHNpbmdsZSBkb2N1bWVudC4KICovCgpleHBvcnRzLnJlZmVyZW5jZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICBpZiAoIShvcHRpb25zLnR5cGUgaW5zdGFuY2VvZiBUeXBlKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgJ3JlZmVyZW5jZTogVGhlIGB0eXBlYCBvcHRpb24gd2FzIG5vdCBzcGVjaWZpZWQsJyArCiAgICAgICAgICAgICAgICAnb3IgaXMgbm90IGFuIGluc3RhbmNlIG9mIHRoZSBgVHlwZWAgY2xhc3MuJwogICAgICAgICk7CiAgICB9CiAgICB2YXIgdHlwZSA9IG5ldyBUeXBlKCdyZWZlcmVuY2UnLCB7CiAgICAgICAgZmllbGRzOiB7CiAgICAgICAgICAgIHJlZjogZmllbGRzLnN0cmluZyh7CiAgICAgICAgICAgICAgICBvbWl0X2VtcHR5OiB0cnVlLAogICAgICAgICAgICAgICAgcmVxdWlyZWQ6ICEhb3B0aW9ucy5yZXF1aXJlZCwKICAgICAgICAgICAgICAgIHdpZGdldDogd2lkZ2V0cy5oaWRkZW4oKSwKICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zOiB7fSwKICAgICAgICAgICAgICAgIGRlZmF1bHRfdmFsdWU6IGZ1bmN0aW9uIChyZXEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgIH0pOwogICAgdHlwZS50eXBlID0gb3B0aW9ucy50eXBlOwogICAgcmV0dXJuIHR5cGU7Cn07CgovKioKICogVGhpcyB0eXBlIHdyYXBzIGEgcmVmZXJlbmNlIHRvIGEgZG9jdW1lbnQuIFRoZSBfaWQgYXR0cmlidXRlIGlzCiAqIG1hZGUgd3JpdGVhYmxlLCBhbmQgaXMgdXNlZCB0byBzdG9yZSB0aGUgaWQgb2YgdGhlIGRvY3VtZW50IGJlaW5nCiAqIHJlZmVycmVkIHRvLiBJbiBsaXN0cywgaGFzIHRoZSBlZmZlY3Qgb2YgY29uc3RyYWluaW5nIGVhY2ggcmVmZXJlbmNlCiAqIHRvIGFwcGVhciBubyBtb3JlIHRoYW4gb25jZS4KICovCgpleHBvcnRzLnVuaXF1ZVJlZmVyZW5jZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICBpZiAoIShvcHRpb25zLnR5cGUgaW5zdGFuY2VvZiBUeXBlKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgJ3VuaXF1ZVJlZmVyZW5jZTogVGhlIGB0eXBlYCBvcHRpb24gd2FzIG5vdCBzcGVjaWZpZWQsJyArCiAgICAgICAgICAgICAgICAnb3IgaXMgbm90IGFuIGluc3RhbmNlIG9mIHRoZSBgVHlwZWAgY2xhc3MuJwogICAgICAgICk7CiAgICB9CiAgICB2YXIgdHlwZSA9IG5ldyBUeXBlKCd1bmlxdWVfcmVmZXJlbmNlJywgewogICAgICAgIGZpZWxkczoge30KICAgIH0pOwogICAgdHlwZS5maWVsZHMuX2lkID0gZmllbGRzLnN0cmluZyh7CiAgICAgICAgb21pdF9lbXB0eTogdHJ1ZSwKICAgICAgICByZXF1aXJlZDogISFvcHRpb25zLnJlcXVpcmVkLAogICAgICAgIHdpZGdldDogd2lkZ2V0cy5oaWRkZW4oKSwKICAgICAgICBwZXJtaXNzaW9uczoge30sCiAgICAgICAgZGVmYXVsdF92YWx1ZTogZnVuY3Rpb24gKHJlcSkgewogICAgICAgICAgICByZXR1cm4gcmVxLnV1aWQ7CiAgICAgICAgfQogICAgfSk7CiAgICB0eXBlLnR5cGUgPSBvcHRpb25zLnR5cGU7CiAgICByZXR1cm4gdHlwZTsKfTsKCgp9KX07CgovKioqKioqKioqKiBrYW5zby91bmRlcnNjb3JlICoqKioqKioqKiovCgprYW5zby5tb2R1bGVDYWNoZVsia2Fuc28vdW5kZXJzY29yZSJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKioKICogVXNlZCBieSBLYW5zbyBpbnRlcm5hbGx5LCB0aGUgZXhjZWxsZW50IFVuZGVyc2NvcmUuanMgbGlicmFyeSBpcyBhbHNvCiAqIGluY2x1ZGVkIGluIHRoZSBzdGFuZGFyZCBzZXQgb2YgQ29tbW9uSlMgbW9kdWxlcyBwdXNoZWQgd2l0aCB5b3VyIGFwcC4KICoKICogRm9yIG1vcmUgaW5mb3JtYXRpb24gb24gdGhlIFVuZGVyc2NvcmUuanMgQVBJLCBzZWUgdGhlIHdlYnNpdGU6CiAqIGh0dHA6Ly9kb2N1bWVudGNsb3VkLmdpdGh1Yi5jb20vdW5kZXJzY29yZS8KICoKICogQG1vZHVsZQogKi8KCgovLyAgICAgVW5kZXJzY29yZS5qcyAxLjEuNQovLyAgICAgKGMpIDIwMTEgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIEluYy4KLy8gICAgIFVuZGVyc2NvcmUgaXMgZnJlZWx5IGRpc3RyaWJ1dGFibGUgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgovLyAgICAgUG9ydGlvbnMgb2YgVW5kZXJzY29yZSBhcmUgaW5zcGlyZWQgb3IgYm9ycm93ZWQgZnJvbSBQcm90b3R5cGUsCi8vICAgICBPbGl2ZXIgU3RlZWxlJ3MgRnVuY3Rpb25hbCwgYW5kIEpvaG4gUmVzaWcncyBNaWNyby1UZW1wbGF0aW5nLgovLyAgICAgRm9yIGFsbCBkZXRhaWxzIGFuZCBkb2N1bWVudGF0aW9uOgovLyAgICAgaHR0cDovL2RvY3VtZW50Y2xvdWQuZ2l0aHViLmNvbS91bmRlcnNjb3JlCgooZnVuY3Rpb24oKSB7CgogIC8vIEJhc2VsaW5lIHNldHVwCiAgLy8gLS0tLS0tLS0tLS0tLS0KCiAgLy8gRXN0YWJsaXNoIHRoZSByb290IG9iamVjdCwgYHdpbmRvd2AgaW4gdGhlIGJyb3dzZXIsIG9yIGBnbG9iYWxgIG9uIHRoZSBzZXJ2ZXIuCiAgdmFyIHJvb3QgPSB0aGlzOwoKICAvLyBTYXZlIHRoZSBwcmV2aW91cyB2YWx1ZSBvZiB0aGUgYF9gIHZhcmlhYmxlLgogIHZhciBwcmV2aW91c1VuZGVyc2NvcmUgPSByb290Ll87CgogIC8vIEVzdGFibGlzaCB0aGUgb2JqZWN0IHRoYXQgZ2V0cyByZXR1cm5lZCB0byBicmVhayBvdXQgb2YgYSBsb29wIGl0ZXJhdGlvbi4KICB2YXIgYnJlYWtlciA9IHt9OwoKICAvLyBTYXZlIGJ5dGVzIGluIHRoZSBtaW5pZmllZCAoYnV0IG5vdCBnemlwcGVkKSB2ZXJzaW9uOgogIHZhciBBcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlLCBPYmpQcm90byA9IE9iamVjdC5wcm90b3R5cGUsIEZ1bmNQcm90byA9IEZ1bmN0aW9uLnByb3RvdHlwZTsKCiAgLy8gQ3JlYXRlIHF1aWNrIHJlZmVyZW5jZSB2YXJpYWJsZXMgZm9yIHNwZWVkIGFjY2VzcyB0byBjb3JlIHByb3RvdHlwZXMuCiAgdmFyIHNsaWNlICAgICAgICAgICAgPSBBcnJheVByb3RvLnNsaWNlLAogICAgICB1bnNoaWZ0ICAgICAgICAgID0gQXJyYXlQcm90by51bnNoaWZ0LAogICAgICB0b1N0cmluZyAgICAgICAgID0gT2JqUHJvdG8udG9TdHJpbmcsCiAgICAgIGhhc093blByb3BlcnR5ICAgPSBPYmpQcm90by5oYXNPd25Qcm9wZXJ0eTsKCiAgLy8gQWxsICoqRUNNQVNjcmlwdCA1KiogbmF0aXZlIGZ1bmN0aW9uIGltcGxlbWVudGF0aW9ucyB0aGF0IHdlIGhvcGUgdG8gdXNlCiAgLy8gYXJlIGRlY2xhcmVkIGhlcmUuCiAgdmFyCiAgICBuYXRpdmVGb3JFYWNoICAgICAgPSBBcnJheVByb3RvLmZvckVhY2gsCiAgICBuYXRpdmVNYXAgICAgICAgICAgPSBBcnJheVByb3RvLm1hcCwKICAgIG5hdGl2ZVJlZHVjZSAgICAgICA9IEFycmF5UHJvdG8ucmVkdWNlLAogICAgbmF0aXZlUmVkdWNlUmlnaHQgID0gQXJyYXlQcm90by5yZWR1Y2VSaWdodCwKICAgIG5hdGl2ZUZpbHRlciAgICAgICA9IEFycmF5UHJvdG8uZmlsdGVyLAogICAgbmF0aXZlRXZlcnkgICAgICAgID0gQXJyYXlQcm90by5ldmVyeSwKICAgIG5hdGl2ZVNvbWUgICAgICAgICA9IEFycmF5UHJvdG8uc29tZSwKICAgIG5hdGl2ZUluZGV4T2YgICAgICA9IEFycmF5UHJvdG8uaW5kZXhPZiwKICAgIG5hdGl2ZUxhc3RJbmRleE9mICA9IEFycmF5UHJvdG8ubGFzdEluZGV4T2YsCiAgICBuYXRpdmVJc0FycmF5ICAgICAgPSBBcnJheS5pc0FycmF5LAogICAgbmF0aXZlS2V5cyAgICAgICAgID0gT2JqZWN0LmtleXMsCiAgICBuYXRpdmVCaW5kICAgICAgICAgPSBGdW5jUHJvdG8uYmluZDsKCiAgLy8gQ3JlYXRlIGEgc2FmZSByZWZlcmVuY2UgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0IGZvciB1c2UgYmVsb3cuCiAgdmFyIF8gPSBmdW5jdGlvbihvYmopIHsgcmV0dXJuIG5ldyB3cmFwcGVyKG9iaik7IH07CgogIC8vIEV4cG9ydCB0aGUgVW5kZXJzY29yZSBvYmplY3QgZm9yICoqQ29tbW9uSlMqKiwgd2l0aCBiYWNrd2FyZHMtY29tcGF0aWJpbGl0eQogIC8vIGZvciB0aGUgb2xkIGByZXF1aXJlKClgIEFQSS4gSWYgd2UncmUgbm90IGluIENvbW1vbkpTLCBhZGQgYF9gIHRvIHRoZQogIC8vIGdsb2JhbCBvYmplY3QuCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IF87CiAgICBfLl8gPSBfOwogIH0gZWxzZSB7CiAgICByb290Ll8gPSBfOwogIH0KCiAgLy8gQ3VycmVudCB2ZXJzaW9uLgogIF8uVkVSU0lPTiA9ICcxLjEuNSc7CgogIC8vIENvbGxlY3Rpb24gRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gVGhlIGNvcm5lcnN0b25lLCBhbiBgZWFjaGAgaW1wbGVtZW50YXRpb24sIGFrYSBgZm9yRWFjaGAuCiAgLy8gSGFuZGxlcyBvYmplY3RzIGltcGxlbWVudGluZyBgZm9yRWFjaGAsIGFycmF5cywgYW5kIHJhdyBvYmplY3RzLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBmb3JFYWNoYCBpZiBhdmFpbGFibGUuCiAgdmFyIGVhY2ggPSBfLmVhY2ggPSBfLmZvckVhY2ggPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybjsKICAgIGlmIChuYXRpdmVGb3JFYWNoICYmIG9iai5mb3JFYWNoID09PSBuYXRpdmVGb3JFYWNoKSB7CiAgICAgIG9iai5mb3JFYWNoKGl0ZXJhdG9yLCBjb250ZXh0KTsKICAgIH0gZWxzZSBpZiAoXy5pc051bWJlcihvYmoubGVuZ3RoKSkgewogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG9iai5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpbaV0sIGksIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewogICAgICAgICAgaWYgKGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqW2tleV0sIGtleSwgb2JqKSA9PT0gYnJlYWtlcikgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8vIFJldHVybiB0aGUgcmVzdWx0cyBvZiBhcHBseWluZyB0aGUgaXRlcmF0b3IgdG8gZWFjaCBlbGVtZW50LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBtYXBgIGlmIGF2YWlsYWJsZS4KICBfLm1hcCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHRzID0gW107CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiByZXN1bHRzOwogICAgaWYgKG5hdGl2ZU1hcCAmJiBvYmoubWFwID09PSBuYXRpdmVNYXApIHJldHVybiBvYmoubWFwKGl0ZXJhdG9yLCBjb250ZXh0KTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgcmVzdWx0c1tyZXN1bHRzLmxlbmd0aF0gPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vICoqUmVkdWNlKiogYnVpbGRzIHVwIGEgc2luZ2xlIHJlc3VsdCBmcm9tIGEgbGlzdCBvZiB2YWx1ZXMsIGFrYSBgaW5qZWN0YCwKICAvLyBvciBgZm9sZGxgLiBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgcmVkdWNlYCBpZiBhdmFpbGFibGUuCiAgXy5yZWR1Y2UgPSBfLmZvbGRsID0gXy5pbmplY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBtZW1vLCBjb250ZXh0KSB7CiAgICB2YXIgaW5pdGlhbCA9IG1lbW8gIT09IHZvaWQgMDsKICAgIGlmIChvYmogPT0gbnVsbCkgb2JqID0gW107CiAgICBpZiAobmF0aXZlUmVkdWNlICYmIG9iai5yZWR1Y2UgPT09IG5hdGl2ZVJlZHVjZSkgewogICAgICBpZiAoY29udGV4dCkgaXRlcmF0b3IgPSBfLmJpbmQoaXRlcmF0b3IsIGNvbnRleHQpOwogICAgICByZXR1cm4gaW5pdGlhbCA/IG9iai5yZWR1Y2UoaXRlcmF0b3IsIG1lbW8pIDogb2JqLnJlZHVjZShpdGVyYXRvcik7CiAgICB9CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmICghaW5pdGlhbCAmJiBpbmRleCA9PT0gMCkgewogICAgICAgIG1lbW8gPSB2YWx1ZTsKICAgICAgICBpbml0aWFsID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZW1vID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCBtZW1vLCB2YWx1ZSwgaW5kZXgsIGxpc3QpOwogICAgICB9CiAgICB9KTsKICAgIGlmICghaW5pdGlhbCkgdGhyb3cgbmV3IFR5cGVFcnJvcigiUmVkdWNlIG9mIGVtcHR5IGFycmF5IHdpdGggbm8gaW5pdGlhbCB2YWx1ZSIpOwogICAgcmV0dXJuIG1lbW87CiAgfTsKCiAgLy8gVGhlIHJpZ2h0LWFzc29jaWF0aXZlIHZlcnNpb24gb2YgcmVkdWNlLCBhbHNvIGtub3duIGFzIGBmb2xkcmAuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYHJlZHVjZVJpZ2h0YCBpZiBhdmFpbGFibGUuCiAgXy5yZWR1Y2VSaWdodCA9IF8uZm9sZHIgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBtZW1vLCBjb250ZXh0KSB7CiAgICBpZiAob2JqID09IG51bGwpIG9iaiA9IFtdOwogICAgaWYgKG5hdGl2ZVJlZHVjZVJpZ2h0ICYmIG9iai5yZWR1Y2VSaWdodCA9PT0gbmF0aXZlUmVkdWNlUmlnaHQpIHsKICAgICAgaWYgKGNvbnRleHQpIGl0ZXJhdG9yID0gXy5iaW5kKGl0ZXJhdG9yLCBjb250ZXh0KTsKICAgICAgcmV0dXJuIG1lbW8gIT09IHZvaWQgMCA/IG9iai5yZWR1Y2VSaWdodChpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlUmlnaHQoaXRlcmF0b3IpOwogICAgfQogICAgdmFyIHJldmVyc2VkID0gKF8uaXNBcnJheShvYmopID8gb2JqLnNsaWNlKCkgOiBfLnRvQXJyYXkob2JqKSkucmV2ZXJzZSgpOwogICAgcmV0dXJuIF8ucmVkdWNlKHJldmVyc2VkLCBpdGVyYXRvciwgbWVtbywgY29udGV4dCk7CiAgfTsKCiAgLy8gUmV0dXJuIHRoZSBmaXJzdCB2YWx1ZSB3aGljaCBwYXNzZXMgYSB0cnV0aCB0ZXN0LiBBbGlhc2VkIGFzIGBkZXRlY3RgLgogIF8uZmluZCA9IF8uZGV0ZWN0ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgdmFyIHJlc3VsdDsKICAgIGFueShvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSB7CiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyB0aGF0IHBhc3MgYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBmaWx0ZXJgIGlmIGF2YWlsYWJsZS4KICAvLyBBbGlhc2VkIGFzIGBzZWxlY3RgLgogIF8uZmlsdGVyID0gXy5zZWxlY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0czsKICAgIGlmIChuYXRpdmVGaWx0ZXIgJiYgb2JqLmZpbHRlciA9PT0gbmF0aXZlRmlsdGVyKSByZXR1cm4gb2JqLmZpbHRlcihpdGVyYXRvciwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpIHJlc3VsdHNbcmVzdWx0cy5sZW5ndGhdID0gdmFsdWU7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIGZvciB3aGljaCBhIHRydXRoIHRlc3QgZmFpbHMuCiAgXy5yZWplY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0czsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKCFpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpIHJlc3VsdHNbcmVzdWx0cy5sZW5ndGhdID0gdmFsdWU7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIERldGVybWluZSB3aGV0aGVyIGFsbCBvZiB0aGUgZWxlbWVudHMgbWF0Y2ggYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBldmVyeWAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYGFsbGAuCiAgXy5ldmVyeSA9IF8uYWxsID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgaXRlcmF0b3IgPSBpdGVyYXRvciB8fCBfLmlkZW50aXR5OwogICAgdmFyIHJlc3VsdCA9IHRydWU7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiByZXN1bHQ7CiAgICBpZiAobmF0aXZlRXZlcnkgJiYgb2JqLmV2ZXJ5ID09PSBuYXRpdmVFdmVyeSkgcmV0dXJuIG9iai5ldmVyeShpdGVyYXRvciwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmICghKHJlc3VsdCA9IHJlc3VsdCAmJiBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpKSByZXR1cm4gYnJlYWtlcjsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBEZXRlcm1pbmUgaWYgYXQgbGVhc3Qgb25lIGVsZW1lbnQgaW4gdGhlIG9iamVjdCBtYXRjaGVzIGEgdHJ1dGggdGVzdC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgc29tZWAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYGFueWAuCiAgdmFyIGFueSA9IF8uc29tZSA9IF8uYW55ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgaXRlcmF0b3IgPSBpdGVyYXRvciB8fCBfLmlkZW50aXR5OwogICAgdmFyIHJlc3VsdCA9IGZhbHNlOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0OwogICAgaWYgKG5hdGl2ZVNvbWUgJiYgb2JqLnNvbWUgPT09IG5hdGl2ZVNvbWUpIHJldHVybiBvYmouc29tZShpdGVyYXRvciwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChyZXN1bHQgPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpIHJldHVybiBicmVha2VyOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIERldGVybWluZSBpZiBhIGdpdmVuIHZhbHVlIGlzIGluY2x1ZGVkIGluIHRoZSBhcnJheSBvciBvYmplY3QgdXNpbmcgYD09PWAuCiAgLy8gQWxpYXNlZCBhcyBgY29udGFpbnNgLgogIF8uaW5jbHVkZSA9IF8uY29udGFpbnMgPSBmdW5jdGlvbihvYmosIHRhcmdldCkgewogICAgdmFyIGZvdW5kID0gZmFsc2U7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiBmb3VuZDsKICAgIGlmIChuYXRpdmVJbmRleE9mICYmIG9iai5pbmRleE9mID09PSBuYXRpdmVJbmRleE9mKSByZXR1cm4gb2JqLmluZGV4T2YodGFyZ2V0KSAhPSAtMTsKICAgIGFueShvYmosIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIGlmIChmb3VuZCA9IHZhbHVlID09PSB0YXJnZXQpIHJldHVybiB0cnVlOwogICAgfSk7CiAgICByZXR1cm4gZm91bmQ7CiAgfTsKCiAgLy8gSW52b2tlIGEgbWV0aG9kICh3aXRoIGFyZ3VtZW50cykgb24gZXZlcnkgaXRlbSBpbiBhIGNvbGxlY3Rpb24uCiAgXy5pbnZva2UgPSBmdW5jdGlvbihvYmosIG1ldGhvZCkgewogICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICByZXR1cm4gXy5tYXAob2JqLCBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKG1ldGhvZCA/IHZhbHVlW21ldGhvZF0gOiB2YWx1ZSkuYXBwbHkodmFsdWUsIGFyZ3MpOwogICAgfSk7CiAgfTsKCiAgLy8gQ29udmVuaWVuY2UgdmVyc2lvbiBvZiBhIGNvbW1vbiB1c2UgY2FzZSBvZiBgbWFwYDogZmV0Y2hpbmcgYSBwcm9wZXJ0eS4KICBfLnBsdWNrID0gZnVuY3Rpb24ob2JqLCBrZXkpIHsKICAgIHJldHVybiBfLm1hcChvYmosIGZ1bmN0aW9uKHZhbHVlKXsgcmV0dXJuIHZhbHVlW2tleV07IH0pOwogIH07CgogIC8vIFJldHVybiB0aGUgbWF4aW11bSBlbGVtZW50IG9yIChlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS4KICBfLm1heCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGlmICghaXRlcmF0b3IgJiYgXy5pc0FycmF5KG9iaikpIHJldHVybiBNYXRoLm1heC5hcHBseShNYXRoLCBvYmopOwogICAgdmFyIHJlc3VsdCA9IHtjb21wdXRlZCA6IC1JbmZpbml0eX07CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHZhciBjb21wdXRlZCA9IGl0ZXJhdG9yID8gaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpIDogdmFsdWU7CiAgICAgIGNvbXB1dGVkID49IHJlc3VsdC5jb21wdXRlZCAmJiAocmVzdWx0ID0ge3ZhbHVlIDogdmFsdWUsIGNvbXB1dGVkIDogY29tcHV0ZWR9KTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdC52YWx1ZTsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG1pbmltdW0gZWxlbWVudCAob3IgZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuCiAgXy5taW4gPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAoIWl0ZXJhdG9yICYmIF8uaXNBcnJheShvYmopKSByZXR1cm4gTWF0aC5taW4uYXBwbHkoTWF0aCwgb2JqKTsKICAgIHZhciByZXN1bHQgPSB7Y29tcHV0ZWQgOiBJbmZpbml0eX07CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHZhciBjb21wdXRlZCA9IGl0ZXJhdG9yID8gaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpIDogdmFsdWU7CiAgICAgIGNvbXB1dGVkIDwgcmVzdWx0LmNvbXB1dGVkICYmIChyZXN1bHQgPSB7dmFsdWUgOiB2YWx1ZSwgY29tcHV0ZWQgOiBjb21wdXRlZH0pOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0LnZhbHVlOwogIH07CgogIC8vIFNvcnQgdGhlIG9iamVjdCdzIHZhbHVlcyBieSBhIGNyaXRlcmlvbiBwcm9kdWNlZCBieSBhbiBpdGVyYXRvci4KICBfLnNvcnRCeSA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHJldHVybiBfLnBsdWNrKF8ubWFwKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWUgOiB2YWx1ZSwKICAgICAgICBjcml0ZXJpYSA6IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KQogICAgICB9OwogICAgfSkuc29ydChmdW5jdGlvbihsZWZ0LCByaWdodCkgewogICAgICB2YXIgYSA9IGxlZnQuY3JpdGVyaWEsIGIgPSByaWdodC5jcml0ZXJpYTsKICAgICAgcmV0dXJuIGEgPCBiID8gLTEgOiBhID4gYiA/IDEgOiAwOwogICAgfSksICd2YWx1ZScpOwogIH07CgogIC8vIFVzZSBhIGNvbXBhcmF0b3IgZnVuY3Rpb24gdG8gZmlndXJlIG91dCBhdCB3aGF0IGluZGV4IGFuIG9iamVjdCBzaG91bGQKICAvLyBiZSBpbnNlcnRlZCBzbyBhcyB0byBtYWludGFpbiBvcmRlci4gVXNlcyBiaW5hcnkgc2VhcmNoLgogIF8uc29ydGVkSW5kZXggPSBmdW5jdGlvbihhcnJheSwgb2JqLCBpdGVyYXRvcikgewogICAgaXRlcmF0b3IgPSBpdGVyYXRvciB8fCBfLmlkZW50aXR5OwogICAgdmFyIGxvdyA9IDAsIGhpZ2ggPSBhcnJheS5sZW5ndGg7CiAgICB3aGlsZSAobG93IDwgaGlnaCkgewogICAgICB2YXIgbWlkID0gKGxvdyArIGhpZ2gpID4+IDE7CiAgICAgIGl0ZXJhdG9yKGFycmF5W21pZF0pIDwgaXRlcmF0b3Iob2JqKSA/IGxvdyA9IG1pZCArIDEgOiBoaWdoID0gbWlkOwogICAgfQogICAgcmV0dXJuIGxvdzsKICB9OwoKICAvLyBTYWZlbHkgY29udmVydCBhbnl0aGluZyBpdGVyYWJsZSBpbnRvIGEgcmVhbCwgbGl2ZSBhcnJheS4KICBfLnRvQXJyYXkgPSBmdW5jdGlvbihpdGVyYWJsZSkgewogICAgaWYgKCFpdGVyYWJsZSkgICAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgaWYgKGl0ZXJhYmxlLnRvQXJyYXkpICAgICAgICAgcmV0dXJuIGl0ZXJhYmxlLnRvQXJyYXkoKTsKICAgIGlmIChfLmlzQXJyYXkoaXRlcmFibGUpKSAgICAgIHJldHVybiBpdGVyYWJsZTsKICAgIGlmIChfLmlzQXJndW1lbnRzKGl0ZXJhYmxlKSkgIHJldHVybiBzbGljZS5jYWxsKGl0ZXJhYmxlKTsKICAgIHJldHVybiBfLnZhbHVlcyhpdGVyYWJsZSk7CiAgfTsKCiAgLy8gUmV0dXJuIHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaW4gYW4gb2JqZWN0LgogIF8uc2l6ZSA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8udG9BcnJheShvYmopLmxlbmd0aDsKICB9OwoKICAvLyBBcnJheSBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0KCiAgLy8gR2V0IHRoZSBmaXJzdCBlbGVtZW50IG9mIGFuIGFycmF5LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIHRoZSBmaXJzdCBOCiAgLy8gdmFsdWVzIGluIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgaGVhZGAuIFRoZSAqKmd1YXJkKiogY2hlY2sgYWxsb3dzIGl0IHRvIHdvcmsKICAvLyB3aXRoIGBfLm1hcGAuCiAgXy5maXJzdCA9IF8uaGVhZCA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkgewogICAgcmV0dXJuIChuICE9IG51bGwpICYmICFndWFyZCA/IHNsaWNlLmNhbGwoYXJyYXksIDAsIG4pIDogYXJyYXlbMF07CiAgfTsKCiAgLy8gUmV0dXJucyBldmVyeXRoaW5nIGJ1dCB0aGUgZmlyc3QgZW50cnkgb2YgdGhlIGFycmF5LiBBbGlhc2VkIGFzIGB0YWlsYC4KICAvLyBFc3BlY2lhbGx5IHVzZWZ1bCBvbiB0aGUgYXJndW1lbnRzIG9iamVjdC4gUGFzc2luZyBhbiAqKmluZGV4Kiogd2lsbCByZXR1cm4KICAvLyB0aGUgcmVzdCBvZiB0aGUgdmFsdWVzIGluIHRoZSBhcnJheSBmcm9tIHRoYXQgaW5kZXggb253YXJkLiBUaGUgKipndWFyZCoqCiAgLy8gY2hlY2sgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgXy5tYXBgLgogIF8ucmVzdCA9IF8udGFpbCA9IGZ1bmN0aW9uKGFycmF5LCBpbmRleCwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAoaW5kZXggPT0gbnVsbCkgfHwgZ3VhcmQgPyAxIDogaW5kZXgpOwogIH07CgogIC8vIEdldCB0aGUgbGFzdCBlbGVtZW50IG9mIGFuIGFycmF5LgogIF8ubGFzdCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICByZXR1cm4gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07CiAgfTsKCiAgLy8gVHJpbSBvdXQgYWxsIGZhbHN5IHZhbHVlcyBmcm9tIGFuIGFycmF5LgogIF8uY29tcGFjdCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICByZXR1cm4gXy5maWx0ZXIoYXJyYXksIGZ1bmN0aW9uKHZhbHVlKXsgcmV0dXJuICEhdmFsdWU7IH0pOwogIH07CgogIC8vIFJldHVybiBhIGNvbXBsZXRlbHkgZmxhdHRlbmVkIHZlcnNpb24gb2YgYW4gYXJyYXkuCiAgXy5mbGF0dGVuID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHJldHVybiBfLnJlZHVjZShhcnJheSwgZnVuY3Rpb24obWVtbywgdmFsdWUpIHsKICAgICAgaWYgKF8uaXNBcnJheSh2YWx1ZSkpIHJldHVybiBtZW1vLmNvbmNhdChfLmZsYXR0ZW4odmFsdWUpKTsKICAgICAgbWVtb1ttZW1vLmxlbmd0aF0gPSB2YWx1ZTsKICAgICAgcmV0dXJuIG1lbW87CiAgICB9LCBbXSk7CiAgfTsKCiAgLy8gUmV0dXJuIGEgdmVyc2lvbiBvZiB0aGUgYXJyYXkgdGhhdCBkb2VzIG5vdCBjb250YWluIHRoZSBzcGVjaWZpZWQgdmFsdWUocykuCiAgXy53aXRob3V0ID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHZhciB2YWx1ZXMgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICByZXR1cm4gXy5maWx0ZXIoYXJyYXksIGZ1bmN0aW9uKHZhbHVlKXsgcmV0dXJuICFfLmluY2x1ZGUodmFsdWVzLCB2YWx1ZSk7IH0pOwogIH07CgogIC8vIFByb2R1Y2UgYSBkdXBsaWNhdGUtZnJlZSB2ZXJzaW9uIG9mIHRoZSBhcnJheS4gSWYgdGhlIGFycmF5IGhhcyBhbHJlYWR5CiAgLy8gYmVlbiBzb3J0ZWQsIHlvdSBoYXZlIHRoZSBvcHRpb24gb2YgdXNpbmcgYSBmYXN0ZXIgYWxnb3JpdGhtLgogIC8vIEFsaWFzZWQgYXMgYHVuaXF1ZWAuCiAgXy51bmlxID0gXy51bmlxdWUgPSBmdW5jdGlvbihhcnJheSwgaXNTb3J0ZWQpIHsKICAgIHJldHVybiBfLnJlZHVjZShhcnJheSwgZnVuY3Rpb24obWVtbywgZWwsIGkpIHsKICAgICAgaWYgKDAgPT0gaSB8fCAoaXNTb3J0ZWQgPT09IHRydWUgPyBfLmxhc3QobWVtbykgIT0gZWwgOiAhXy5pbmNsdWRlKG1lbW8sIGVsKSkpIG1lbW9bbWVtby5sZW5ndGhdID0gZWw7CiAgICAgIHJldHVybiBtZW1vOwogICAgfSwgW10pOwogIH07CgogIC8vIFByb2R1Y2UgYW4gYXJyYXkgdGhhdCBjb250YWlucyBldmVyeSBpdGVtIHNoYXJlZCBiZXR3ZWVuIGFsbCB0aGUKICAvLyBwYXNzZWQtaW4gYXJyYXlzLgogIF8uaW50ZXJzZWN0ID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHZhciByZXN0ID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgcmV0dXJuIF8uZmlsdGVyKF8udW5pcShhcnJheSksIGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgcmV0dXJuIF8uZXZlcnkocmVzdCwgZnVuY3Rpb24ob3RoZXIpIHsKICAgICAgICByZXR1cm4gXy5pbmRleE9mKG90aGVyLCBpdGVtKSA+PSAwOwogICAgICB9KTsKICAgIH0pOwogIH07CgogIC8vIFppcCB0b2dldGhlciBtdWx0aXBsZSBsaXN0cyBpbnRvIGEgc2luZ2xlIGFycmF5IC0tIGVsZW1lbnRzIHRoYXQgc2hhcmUKICAvLyBhbiBpbmRleCBnbyB0b2dldGhlci4KICBfLnppcCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICB2YXIgbGVuZ3RoID0gXy5tYXgoXy5wbHVjayhhcmdzLCAnbGVuZ3RoJykpOwogICAgdmFyIHJlc3VsdHMgPSBuZXcgQXJyYXkobGVuZ3RoKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHJlc3VsdHNbaV0gPSBfLnBsdWNrKGFyZ3MsICIiICsgaSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICAvLyBJZiB0aGUgYnJvd3NlciBkb2Vzbid0IHN1cHBseSB1cyB3aXRoIGluZGV4T2YgKEknbSBsb29raW5nIGF0IHlvdSwgKipNU0lFKiopLAogIC8vIHdlIG5lZWQgdGhpcyBmdW5jdGlvbi4gUmV0dXJuIHRoZSBwb3NpdGlvbiBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhbgogIC8vIGl0ZW0gaW4gYW4gYXJyYXksIG9yIC0xIGlmIHRoZSBpdGVtIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgYXJyYXkuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGluZGV4T2ZgIGlmIGF2YWlsYWJsZS4KICAvLyBJZiB0aGUgYXJyYXkgaXMgbGFyZ2UgYW5kIGFscmVhZHkgaW4gc29ydCBvcmRlciwgcGFzcyBgdHJ1ZWAKICAvLyBmb3IgKippc1NvcnRlZCoqIHRvIHVzZSBiaW5hcnkgc2VhcmNoLgogIF8uaW5kZXhPZiA9IGZ1bmN0aW9uKGFycmF5LCBpdGVtLCBpc1NvcnRlZCkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiAtMTsKICAgIHZhciBpLCBsOwogICAgaWYgKGlzU29ydGVkKSB7CiAgICAgIGkgPSBfLnNvcnRlZEluZGV4KGFycmF5LCBpdGVtKTsKICAgICAgcmV0dXJuIGFycmF5W2ldID09PSBpdGVtID8gaSA6IC0xOwogICAgfQogICAgaWYgKG5hdGl2ZUluZGV4T2YgJiYgYXJyYXkuaW5kZXhPZiA9PT0gbmF0aXZlSW5kZXhPZikgcmV0dXJuIGFycmF5LmluZGV4T2YoaXRlbSk7CiAgICBmb3IgKGkgPSAwLCBsID0gYXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHJldHVybiBpOwogICAgcmV0dXJuIC0xOwogIH07CgoKICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgbGFzdEluZGV4T2ZgIGlmIGF2YWlsYWJsZS4KICBfLmxhc3RJbmRleE9mID0gZnVuY3Rpb24oYXJyYXksIGl0ZW0pIHsKICAgIGlmIChhcnJheSA9PSBudWxsKSByZXR1cm4gLTE7CiAgICBpZiAobmF0aXZlTGFzdEluZGV4T2YgJiYgYXJyYXkubGFzdEluZGV4T2YgPT09IG5hdGl2ZUxhc3RJbmRleE9mKSByZXR1cm4gYXJyYXkubGFzdEluZGV4T2YoaXRlbSk7CiAgICB2YXIgaSA9IGFycmF5Lmxlbmd0aDsKICAgIHdoaWxlIChpLS0pIGlmIChhcnJheVtpXSA9PT0gaXRlbSkgcmV0dXJuIGk7CiAgICByZXR1cm4gLTE7CiAgfTsKCiAgLy8gR2VuZXJhdGUgYW4gaW50ZWdlciBBcnJheSBjb250YWluaW5nIGFuIGFyaXRobWV0aWMgcHJvZ3Jlc3Npb24uIEEgcG9ydCBvZgogIC8vIHRoZSBuYXRpdmUgUHl0aG9uIGByYW5nZSgpYCBmdW5jdGlvbi4gU2VlCiAgLy8gW3RoZSBQeXRob24gZG9jdW1lbnRhdGlvbl0oaHR0cDovL2RvY3MucHl0aG9uLm9yZy9saWJyYXJ5L2Z1bmN0aW9ucy5odG1sI3JhbmdlKS4KICBfLnJhbmdlID0gZnVuY3Rpb24oc3RhcnQsIHN0b3AsIHN0ZXApIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDw9IDEpIHsKICAgICAgc3RvcCA9IHN0YXJ0IHx8IDA7CiAgICAgIHN0YXJ0ID0gMDsKICAgIH0KICAgIHN0ZXAgPSBhcmd1bWVudHNbMl0gfHwgMTsKCiAgICB2YXIgbGVuID0gTWF0aC5tYXgoTWF0aC5jZWlsKChzdG9wIC0gc3RhcnQpIC8gc3RlcCksIDApOwogICAgdmFyIGlkeCA9IDA7CiAgICB2YXIgcmFuZ2UgPSBuZXcgQXJyYXkobGVuKTsKCiAgICB3aGlsZShpZHggPCBsZW4pIHsKICAgICAgcmFuZ2VbaWR4KytdID0gc3RhcnQ7CiAgICAgIHN0YXJ0ICs9IHN0ZXA7CiAgICB9CgogICAgcmV0dXJuIHJhbmdlOwogIH07CgogIC8vIEZ1bmN0aW9uIChhaGVtKSBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gQ3JlYXRlIGEgZnVuY3Rpb24gYm91bmQgdG8gYSBnaXZlbiBvYmplY3QgKGFzc2lnbmluZyBgdGhpc2AsIGFuZCBhcmd1bWVudHMsCiAgLy8gb3B0aW9uYWxseSkuIEJpbmRpbmcgd2l0aCBhcmd1bWVudHMgaXMgYWxzbyBrbm93biBhcyBgY3VycnlgLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBGdW5jdGlvbi5iaW5kYCBpZiBhdmFpbGFibGUuCiAgXy5iaW5kID0gZnVuY3Rpb24oZnVuYywgb2JqKSB7CiAgICBpZiAobmF0aXZlQmluZCAmJiBmdW5jLmJpbmQgPT09IG5hdGl2ZUJpbmQpIHJldHVybiBmdW5jLmJpbmQuYXBwbHkoZnVuYywgc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZnVuYy5hcHBseShvYmosIGFyZ3MuY29uY2F0KHNsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgfTsKICB9OwoKICAvLyBCaW5kIGFsbCBvZiBhbiBvYmplY3QncyBtZXRob2RzIHRvIHRoYXQgb2JqZWN0LiBVc2VmdWwgZm9yIGVuc3VyaW5nIHRoYXQKICAvLyBhbGwgY2FsbGJhY2tzIGRlZmluZWQgb24gYW4gb2JqZWN0IGJlbG9uZyB0byBpdC4KICBfLmJpbmRBbGwgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBmdW5jcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIGlmIChmdW5jcy5sZW5ndGggPT0gMCkgZnVuY3MgPSBfLmZ1bmN0aW9ucyhvYmopOwogICAgZWFjaChmdW5jcywgZnVuY3Rpb24oZikgeyBvYmpbZl0gPSBfLmJpbmQob2JqW2ZdLCBvYmopOyB9KTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gTWVtb2l6ZSBhbiBleHBlbnNpdmUgZnVuY3Rpb24gYnkgc3RvcmluZyBpdHMgcmVzdWx0cy4KICBfLm1lbW9pemUgPSBmdW5jdGlvbihmdW5jLCBoYXNoZXIpIHsKICAgIHZhciBtZW1vID0ge307CiAgICBoYXNoZXIgPSBoYXNoZXIgfHwgXy5pZGVudGl0eTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGtleSA9IGhhc2hlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChtZW1vLCBrZXkpID8gbWVtb1trZXldIDogKG1lbW9ba2V5XSA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICB9OwogIH07CgogIC8vIERlbGF5cyBhIGZ1bmN0aW9uIGZvciB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcywgYW5kIHRoZW4gY2FsbHMKICAvLyBpdCB3aXRoIHRoZSBhcmd1bWVudHMgc3VwcGxpZWQuCiAgXy5kZWxheSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgcmV0dXJuIGZ1bmMuYXBwbHkoZnVuYywgYXJncyk7IH0sIHdhaXQpOwogIH07CgogIC8vIERlZmVycyBhIGZ1bmN0aW9uLCBzY2hlZHVsaW5nIGl0IHRvIHJ1biBhZnRlciB0aGUgY3VycmVudCBjYWxsIHN0YWNrIGhhcwogIC8vIGNsZWFyZWQuCiAgXy5kZWZlciA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIHJldHVybiBfLmRlbGF5LmFwcGx5KF8sIFtmdW5jLCAxXS5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKSk7CiAgfTsKCiAgLy8gSW50ZXJuYWwgZnVuY3Rpb24gdXNlZCB0byBpbXBsZW1lbnQgYF8udGhyb3R0bGVgIGFuZCBgXy5kZWJvdW5jZWAuCiAgdmFyIGxpbWl0ID0gZnVuY3Rpb24oZnVuYywgd2FpdCwgZGVib3VuY2UpIHsKICAgIHZhciB0aW1lb3V0OwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY29udGV4dCA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgIHZhciB0aHJvdHRsZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICB9OwogICAgICBpZiAoZGVib3VuY2UpIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgaWYgKGRlYm91bmNlIHx8ICF0aW1lb3V0KSB0aW1lb3V0ID0gc2V0VGltZW91dCh0aHJvdHRsZXIsIHdhaXQpOwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIHdoZW4gaW52b2tlZCwgd2lsbCBvbmx5IGJlIHRyaWdnZXJlZCBhdCBtb3N0IG9uY2UKICAvLyBkdXJpbmcgYSBnaXZlbiB3aW5kb3cgb2YgdGltZS4KICBfLnRocm90dGxlID0gZnVuY3Rpb24oZnVuYywgd2FpdCkgewogICAgcmV0dXJuIGxpbWl0KGZ1bmMsIHdhaXQsIGZhbHNlKTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIGFzIGxvbmcgYXMgaXQgY29udGludWVzIHRvIGJlIGludm9rZWQsIHdpbGwgbm90CiAgLy8gYmUgdHJpZ2dlcmVkLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgaXQgc3RvcHMgYmVpbmcgY2FsbGVkIGZvcgogIC8vIE4gbWlsbGlzZWNvbmRzLgogIF8uZGVib3VuY2UgPSBmdW5jdGlvbihmdW5jLCB3YWl0KSB7CiAgICByZXR1cm4gbGltaXQoZnVuYywgd2FpdCwgdHJ1ZSk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBhdCBtb3N0IG9uZSB0aW1lLCBubyBtYXR0ZXIgaG93CiAgLy8gb2Z0ZW4geW91IGNhbGwgaXQuIFVzZWZ1bCBmb3IgbGF6eSBpbml0aWFsaXphdGlvbi4KICBfLm9uY2UgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB2YXIgcmFuID0gZmFsc2UsIG1lbW87CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChyYW4pIHJldHVybiBtZW1vOwogICAgICByYW4gPSB0cnVlOwogICAgICByZXR1cm4gbWVtbyA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyB0aGUgZmlyc3QgZnVuY3Rpb24gcGFzc2VkIGFzIGFuIGFyZ3VtZW50IHRvIHRoZSBzZWNvbmQsCiAgLy8gYWxsb3dpbmcgeW91IHRvIGFkanVzdCBhcmd1bWVudHMsIHJ1biBjb2RlIGJlZm9yZSBhbmQgYWZ0ZXIsIGFuZAogIC8vIGNvbmRpdGlvbmFsbHkgZXhlY3V0ZSB0aGUgb3JpZ2luYWwgZnVuY3Rpb24uCiAgXy53cmFwID0gZnVuY3Rpb24oZnVuYywgd3JhcHBlcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IFtmdW5jXS5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKTsKICAgICAgcmV0dXJuIHdyYXBwZXIuYXBwbHkodGhpcywgYXJncyk7CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IGlzIHRoZSBjb21wb3NpdGlvbiBvZiBhIGxpc3Qgb2YgZnVuY3Rpb25zLCBlYWNoCiAgLy8gY29uc3VtaW5nIHRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIGZ1bmN0aW9uIHRoYXQgZm9sbG93cy4KICBfLmNvbXBvc2UgPSBmdW5jdGlvbigpIHsKICAgIHZhciBmdW5jcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIGZvciAodmFyIGk9ZnVuY3MubGVuZ3RoLTE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgYXJncyA9IFtmdW5jc1tpXS5hcHBseSh0aGlzLCBhcmdzKV07CiAgICAgIH0KICAgICAgcmV0dXJuIGFyZ3NbMF07CiAgICB9OwogIH07CgogIC8vIE9iamVjdCBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJldHJpZXZlIHRoZSBuYW1lcyBvZiBhbiBvYmplY3QncyBwcm9wZXJ0aWVzLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBPYmplY3Qua2V5c2AKICBfLmtleXMgPSBuYXRpdmVLZXlzIHx8IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiAhPT0gT2JqZWN0KG9iaikpIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgb2JqZWN0Jyk7CiAgICB2YXIga2V5cyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKGhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSBrZXlzW2tleXMubGVuZ3RoXSA9IGtleTsKICAgIHJldHVybiBrZXlzOwogIH07CgogIC8vIFJldHJpZXZlIHRoZSB2YWx1ZXMgb2YgYW4gb2JqZWN0J3MgcHJvcGVydGllcy4KICBfLnZhbHVlcyA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8ubWFwKG9iaiwgXy5pZGVudGl0eSk7CiAgfTsKCiAgLy8gUmV0dXJuIGEgc29ydGVkIGxpc3Qgb2YgdGhlIGZ1bmN0aW9uIG5hbWVzIGF2YWlsYWJsZSBvbiB0aGUgb2JqZWN0LgogIC8vIEFsaWFzZWQgYXMgYG1ldGhvZHNgCiAgXy5mdW5jdGlvbnMgPSBfLm1ldGhvZHMgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBfLmZpbHRlcihfLmtleXMob2JqKSwgZnVuY3Rpb24oa2V5KXsgcmV0dXJuIF8uaXNGdW5jdGlvbihvYmpba2V5XSk7IH0pLnNvcnQoKTsKICB9OwoKICAvLyBFeHRlbmQgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIHByb3BlcnRpZXMgaW4gcGFzc2VkLWluIG9iamVjdChzKS4KICBfLmV4dGVuZCA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewogICAgICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkgb2JqW3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgfSk7CiAgICByZXR1cm4gb2JqOwogIH07CgogIC8vIEZpbGwgaW4gYSBnaXZlbiBvYmplY3Qgd2l0aCBkZWZhdWx0IHByb3BlcnRpZXMuCiAgXy5kZWZhdWx0cyA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewogICAgICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkgaWYgKG9ialtwcm9wXSA9PSBudWxsKSBvYmpbcHJvcF0gPSBzb3VyY2VbcHJvcF07CiAgICB9KTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gQ3JlYXRlIGEgKHNoYWxsb3ctY2xvbmVkKSBkdXBsaWNhdGUgb2YgYW4gb2JqZWN0LgogIF8uY2xvbmUgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBfLmlzQXJyYXkob2JqKSA/IG9iai5zbGljZSgpIDogXy5leHRlbmQoe30sIG9iaik7CiAgfTsKCiAgLy8gSW52b2tlcyBpbnRlcmNlcHRvciB3aXRoIHRoZSBvYmosIGFuZCB0aGVuIHJldHVybnMgb2JqLgogIC8vIFRoZSBwcmltYXJ5IHB1cnBvc2Ugb2YgdGhpcyBtZXRob2QgaXMgdG8gInRhcCBpbnRvIiBhIG1ldGhvZCBjaGFpbiwgaW4KICAvLyBvcmRlciB0byBwZXJmb3JtIG9wZXJhdGlvbnMgb24gaW50ZXJtZWRpYXRlIHJlc3VsdHMgd2l0aGluIHRoZSBjaGFpbi4KICBfLnRhcCA9IGZ1bmN0aW9uKG9iaiwgaW50ZXJjZXB0b3IpIHsKICAgIGludGVyY2VwdG9yKG9iaik7CiAgICByZXR1cm4gb2JqOwogIH07CgogIC8vIFBlcmZvcm0gYSBkZWVwIGNvbXBhcmlzb24gdG8gY2hlY2sgaWYgdHdvIG9iamVjdHMgYXJlIGVxdWFsLgogIF8uaXNFcXVhbCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIC8vIENoZWNrIG9iamVjdCBpZGVudGl0eS4KICAgIGlmIChhID09PSBiKSByZXR1cm4gdHJ1ZTsKICAgIC8vIERpZmZlcmVudCB0eXBlcz8KICAgIHZhciBhdHlwZSA9IHR5cGVvZihhKSwgYnR5cGUgPSB0eXBlb2YoYik7CiAgICBpZiAoYXR5cGUgIT0gYnR5cGUpIHJldHVybiBmYWxzZTsKICAgIC8vIEJhc2ljIGVxdWFsaXR5IHRlc3QgKHdhdGNoIG91dCBmb3IgY29lcmNpb25zKS4KICAgIGlmIChhID09IGIpIHJldHVybiB0cnVlOwogICAgLy8gT25lIGlzIGZhbHN5IGFuZCB0aGUgb3RoZXIgdHJ1dGh5LgogICAgaWYgKCghYSAmJiBiKSB8fCAoYSAmJiAhYikpIHJldHVybiBmYWxzZTsKICAgIC8vIFVud3JhcCBhbnkgd3JhcHBlZCBvYmplY3RzLgogICAgaWYgKGEuX2NoYWluKSBhID0gYS5fd3JhcHBlZDsKICAgIGlmIChiLl9jaGFpbikgYiA9IGIuX3dyYXBwZWQ7CiAgICAvLyBPbmUgb2YgdGhlbSBpbXBsZW1lbnRzIGFuIGlzRXF1YWwoKT8KICAgIGlmIChhLmlzRXF1YWwpIHJldHVybiBhLmlzRXF1YWwoYik7CiAgICAvLyBDaGVjayBkYXRlcycgaW50ZWdlciB2YWx1ZXMuCiAgICBpZiAoXy5pc0RhdGUoYSkgJiYgXy5pc0RhdGUoYikpIHJldHVybiBhLmdldFRpbWUoKSA9PT0gYi5nZXRUaW1lKCk7CiAgICAvLyBCb3RoIGFyZSBOYU4/CiAgICBpZiAoXy5pc05hTihhKSAmJiBfLmlzTmFOKGIpKSByZXR1cm4gZmFsc2U7CiAgICAvLyBDb21wYXJlIHJlZ3VsYXIgZXhwcmVzc2lvbnMuCiAgICBpZiAoXy5pc1JlZ0V4cChhKSAmJiBfLmlzUmVnRXhwKGIpKQogICAgICByZXR1cm4gYS5zb3VyY2UgICAgID09PSBiLnNvdXJjZSAmJgogICAgICAgICAgICAgYS5nbG9iYWwgICAgID09PSBiLmdsb2JhbCAmJgogICAgICAgICAgICAgYS5pZ25vcmVDYXNlID09PSBiLmlnbm9yZUNhc2UgJiYKICAgICAgICAgICAgIGEubXVsdGlsaW5lICA9PT0gYi5tdWx0aWxpbmU7CiAgICAvLyBJZiBhIGlzIG5vdCBhbiBvYmplY3QgYnkgdGhpcyBwb2ludCwgd2UgY2FuJ3QgaGFuZGxlIGl0LgogICAgaWYgKGF0eXBlICE9PSAnb2JqZWN0JykgcmV0dXJuIGZhbHNlOwogICAgLy8gQ2hlY2sgZm9yIGRpZmZlcmVudCBhcnJheSBsZW5ndGhzIGJlZm9yZSBjb21wYXJpbmcgY29udGVudHMuCiAgICBpZiAoYS5sZW5ndGggJiYgKGEubGVuZ3RoICE9PSBiLmxlbmd0aCkpIHJldHVybiBmYWxzZTsKICAgIC8vIE5vdGhpbmcgZWxzZSB3b3JrZWQsIGRlZXAgY29tcGFyZSB0aGUgY29udGVudHMuCiAgICB2YXIgYUtleXMgPSBfLmtleXMoYSksIGJLZXlzID0gXy5rZXlzKGIpOwogICAgLy8gRGlmZmVyZW50IG9iamVjdCBzaXplcz8KICAgIGlmIChhS2V5cy5sZW5ndGggIT0gYktleXMubGVuZ3RoKSByZXR1cm4gZmFsc2U7CiAgICAvLyBSZWN1cnNpdmUgY29tcGFyaXNvbiBvZiBjb250ZW50cy4KICAgIGZvciAodmFyIGtleSBpbiBhKSBpZiAoIShrZXkgaW4gYikgfHwgIV8uaXNFcXVhbChhW2tleV0sIGJba2V5XSkpIHJldHVybiBmYWxzZTsKICAgIHJldHVybiB0cnVlOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gYXJyYXkgb3Igb2JqZWN0IGVtcHR5PwogIF8uaXNFbXB0eSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKF8uaXNBcnJheShvYmopIHx8IF8uaXNTdHJpbmcob2JqKSkgcmV0dXJuIG9iai5sZW5ndGggPT09IDA7CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHJldHVybiBmYWxzZTsKICAgIHJldHVybiB0cnVlOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYSBET00gZWxlbWVudD8KICBfLmlzRWxlbWVudCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuICEhKG9iaiAmJiBvYmoubm9kZVR5cGUgPT0gMSk7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhbiBhcnJheT8KICAvLyBEZWxlZ2F0ZXMgdG8gRUNNQTUncyBuYXRpdmUgQXJyYXkuaXNBcnJheQogIF8uaXNBcnJheSA9IG5hdGl2ZUlzQXJyYXkgfHwgZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBBcnJheV0nOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFyaWFibGUgYW4gYXJndW1lbnRzIG9iamVjdD8KICBfLmlzQXJndW1lbnRzID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gISEob2JqICYmIGhhc093blByb3BlcnR5LmNhbGwob2JqLCAnY2FsbGVlJykpOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYSBmdW5jdGlvbj8KICBfLmlzRnVuY3Rpb24gPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiAhIShvYmogJiYgb2JqLmNvbnN0cnVjdG9yICYmIG9iai5jYWxsICYmIG9iai5hcHBseSk7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIHN0cmluZz8KICBfLmlzU3RyaW5nID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gISEob2JqID09PSAnJyB8fCAob2JqICYmIG9iai5jaGFyQ29kZUF0ICYmIG9iai5zdWJzdHIpKTsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgbnVtYmVyPwogIF8uaXNOdW1iZXIgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiAhIShvYmogPT09IDAgfHwgKG9iaiAmJiBvYmoudG9FeHBvbmVudGlhbCAmJiBvYmoudG9GaXhlZCkpOwogIH07CgogIC8vIElzIHRoZSBnaXZlbiB2YWx1ZSBgTmFOYD8gYE5hTmAgaGFwcGVucyB0byBiZSB0aGUgb25seSB2YWx1ZSBpbiBKYXZhU2NyaXB0CiAgLy8gdGhhdCBkb2VzIG5vdCBlcXVhbCBpdHNlbGYuCiAgXy5pc05hTiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiAhPT0gb2JqOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYSBib29sZWFuPwogIF8uaXNCb29sZWFuID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gb2JqID09PSB0cnVlIHx8IG9iaiA9PT0gZmFsc2U7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIGRhdGU/CiAgXy5pc0RhdGUgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiAhIShvYmogJiYgb2JqLmdldFRpbWV6b25lT2Zmc2V0ICYmIG9iai5zZXRVVENGdWxsWWVhcik7CiAgfTsKCiAgLy8gSXMgdGhlIGdpdmVuIHZhbHVlIGEgcmVndWxhciBleHByZXNzaW9uPwogIF8uaXNSZWdFeHAgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiAhIShvYmogJiYgb2JqLnRlc3QgJiYgb2JqLmV4ZWMgJiYgKG9iai5pZ25vcmVDYXNlIHx8IG9iai5pZ25vcmVDYXNlID09PSBmYWxzZSkpOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgZXF1YWwgdG8gbnVsbD8KICBfLmlzTnVsbCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gbnVsbDsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhcmlhYmxlIHVuZGVmaW5lZD8KICBfLmlzVW5kZWZpbmVkID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gb2JqID09PSB2b2lkIDA7CiAgfTsKCiAgLy8gVXRpbGl0eSBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSdW4gVW5kZXJzY29yZS5qcyBpbiAqbm9Db25mbGljdCogbW9kZSwgcmV0dXJuaW5nIHRoZSBgX2AgdmFyaWFibGUgdG8gaXRzCiAgLy8gcHJldmlvdXMgb3duZXIuIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8ubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgcm9vdC5fID0gcHJldmlvdXNVbmRlcnNjb3JlOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLy8gS2VlcCB0aGUgaWRlbnRpdHkgZnVuY3Rpb24gYXJvdW5kIGZvciBkZWZhdWx0IGl0ZXJhdG9ycy4KICBfLmlkZW50aXR5ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZTsKICB9OwoKICAvLyBSdW4gYSBmdW5jdGlvbiAqKm4qKiB0aW1lcy4KICBfLnRpbWVzID0gZnVuY3Rpb24gKG4sIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykgaXRlcmF0b3IuY2FsbChjb250ZXh0LCBpKTsKICB9OwoKICAvLyBBZGQgeW91ciBvd24gY3VzdG9tIGZ1bmN0aW9ucyB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QsIGVuc3VyaW5nIHRoYXQKICAvLyB0aGV5J3JlIGNvcnJlY3RseSBhZGRlZCB0byB0aGUgT09QIHdyYXBwZXIgYXMgd2VsbC4KICBfLm1peGluID0gZnVuY3Rpb24ob2JqKSB7CiAgICBlYWNoKF8uZnVuY3Rpb25zKG9iaiksIGZ1bmN0aW9uKG5hbWUpewogICAgICBhZGRUb1dyYXBwZXIobmFtZSwgX1tuYW1lXSA9IG9ialtuYW1lXSk7CiAgICB9KTsKICB9OwoKICAvLyBHZW5lcmF0ZSBhIHVuaXF1ZSBpbnRlZ2VyIGlkICh1bmlxdWUgd2l0aGluIHRoZSBlbnRpcmUgY2xpZW50IHNlc3Npb24pLgogIC8vIFVzZWZ1bCBmb3IgdGVtcG9yYXJ5IERPTSBpZHMuCiAgdmFyIGlkQ291bnRlciA9IDA7CiAgXy51bmlxdWVJZCA9IGZ1bmN0aW9uKHByZWZpeCkgewogICAgdmFyIGlkID0gaWRDb3VudGVyKys7CiAgICByZXR1cm4gcHJlZml4ID8gcHJlZml4ICsgaWQgOiBpZDsKICB9OwoKICAvLyBCeSBkZWZhdWx0LCBVbmRlcnNjb3JlIHVzZXMgRVJCLXN0eWxlIHRlbXBsYXRlIGRlbGltaXRlcnMsIGNoYW5nZSB0aGUKICAvLyBmb2xsb3dpbmcgdGVtcGxhdGUgc2V0dGluZ3MgdG8gdXNlIGFsdGVybmF0aXZlIGRlbGltaXRlcnMuCiAgXy50ZW1wbGF0ZVNldHRpbmdzID0gewogICAgZXZhbHVhdGUgICAgOiAvPCUoW1xzXFNdKz8pJT4vZywKICAgIGludGVycG9sYXRlIDogLzwlPShbXHNcU10rPyklPi9nCiAgfTsKCiAgLy8gSmF2YVNjcmlwdCBtaWNyby10ZW1wbGF0aW5nLCBzaW1pbGFyIHRvIEpvaG4gUmVzaWcncyBpbXBsZW1lbnRhdGlvbi4KICAvLyBVbmRlcnNjb3JlIHRlbXBsYXRpbmcgaGFuZGxlcyBhcmJpdHJhcnkgZGVsaW1pdGVycywgcHJlc2VydmVzIHdoaXRlc3BhY2UsCiAgLy8gYW5kIGNvcnJlY3RseSBlc2NhcGVzIHF1b3RlcyB3aXRoaW4gaW50ZXJwb2xhdGVkIGNvZGUuCiAgXy50ZW1wbGF0ZSA9IGZ1bmN0aW9uKHN0ciwgZGF0YSkgewogICAgdmFyIGMgID0gXy50ZW1wbGF0ZVNldHRpbmdzOwogICAgdmFyIHRtcGwgPSAndmFyIF9fcD1bXSxwcmludD1mdW5jdGlvbigpe19fcC5wdXNoLmFwcGx5KF9fcCxhcmd1bWVudHMpO307JyArCiAgICAgICd3aXRoKG9ianx8e30pe19fcC5wdXNoKFwnJyArCiAgICAgIHN0ci5yZXBsYWNlKC9cXC9nLCAnXFxcXCcpCiAgICAgICAgIC5yZXBsYWNlKC8nL2csICJcXCciKQogICAgICAgICAucmVwbGFjZShjLmludGVycG9sYXRlLCBmdW5jdGlvbihtYXRjaCwgY29kZSkgewogICAgICAgICAgIHJldHVybiAiJywiICsgY29kZS5yZXBsYWNlKC9cXCcvZywgIiciKSArICIsJyI7CiAgICAgICAgIH0pCiAgICAgICAgIC5yZXBsYWNlKGMuZXZhbHVhdGUgfHwgbnVsbCwgZnVuY3Rpb24obWF0Y2gsIGNvZGUpIHsKICAgICAgICAgICByZXR1cm4gIicpOyIgKyBjb2RlLnJlcGxhY2UoL1xcJy9nLCAiJyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXHJcblx0XS9nLCAnICcpICsgIl9fcC5wdXNoKCciOwogICAgICAgICB9KQogICAgICAgICAucmVwbGFjZSgvXHIvZywgJ1xccicpCiAgICAgICAgIC5yZXBsYWNlKC9cbi9nLCAnXFxuJykKICAgICAgICAgLnJlcGxhY2UoL1x0L2csICdcXHQnKQogICAgICAgICArICInKTt9cmV0dXJuIF9fcC5qb2luKCcnKTsiOwogICAgdmFyIGZ1bmMgPSBuZXcgRnVuY3Rpb24oJ29iaicsIHRtcGwpOwogICAgcmV0dXJuIGRhdGEgPyBmdW5jKGRhdGEpIDogZnVuYzsKICB9OwoKICAvLyBUaGUgT09QIFdyYXBwZXIKICAvLyAtLS0tLS0tLS0tLS0tLS0KCiAgLy8gSWYgVW5kZXJzY29yZSBpcyBjYWxsZWQgYXMgYSBmdW5jdGlvbiwgaXQgcmV0dXJucyBhIHdyYXBwZWQgb2JqZWN0IHRoYXQKICAvLyBjYW4gYmUgdXNlZCBPTy1zdHlsZS4gVGhpcyB3cmFwcGVyIGhvbGRzIGFsdGVyZWQgdmVyc2lvbnMgb2YgYWxsIHRoZQogIC8vIHVuZGVyc2NvcmUgZnVuY3Rpb25zLiBXcmFwcGVkIG9iamVjdHMgbWF5IGJlIGNoYWluZWQuCiAgdmFyIHdyYXBwZXIgPSBmdW5jdGlvbihvYmopIHsgdGhpcy5fd3JhcHBlZCA9IG9iajsgfTsKCiAgLy8gRXhwb3NlIGB3cmFwcGVyLnByb3RvdHlwZWAgYXMgYF8ucHJvdG90eXBlYAogIF8ucHJvdG90eXBlID0gd3JhcHBlci5wcm90b3R5cGU7CgogIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjb250aW51ZSBjaGFpbmluZyBpbnRlcm1lZGlhdGUgcmVzdWx0cy4KICB2YXIgcmVzdWx0ID0gZnVuY3Rpb24ob2JqLCBjaGFpbikgewogICAgcmV0dXJuIGNoYWluID8gXyhvYmopLmNoYWluKCkgOiBvYmo7CiAgfTsKCiAgLy8gQSBtZXRob2QgdG8gZWFzaWx5IGFkZCBmdW5jdGlvbnMgdG8gdGhlIE9PUCB3cmFwcGVyLgogIHZhciBhZGRUb1dyYXBwZXIgPSBmdW5jdGlvbihuYW1lLCBmdW5jKSB7CiAgICB3cmFwcGVyLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgICAgdW5zaGlmdC5jYWxsKGFyZ3MsIHRoaXMuX3dyYXBwZWQpOwogICAgICByZXR1cm4gcmVzdWx0KGZ1bmMuYXBwbHkoXywgYXJncyksIHRoaXMuX2NoYWluKTsKICAgIH07CiAgfTsKCiAgLy8gQWRkIGFsbCBvZiB0aGUgVW5kZXJzY29yZSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIgb2JqZWN0LgogIF8ubWl4aW4oXyk7CgogIC8vIEFkZCBhbGwgbXV0YXRvciBBcnJheSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIuCiAgZWFjaChbJ3BvcCcsICdwdXNoJywgJ3JldmVyc2UnLCAnc2hpZnQnLCAnc29ydCcsICdzcGxpY2UnLCAndW5zaGlmdCddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIHdyYXBwZXIucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIG1ldGhvZC5hcHBseSh0aGlzLl93cmFwcGVkLCBhcmd1bWVudHMpOwogICAgICByZXR1cm4gcmVzdWx0KHRoaXMuX3dyYXBwZWQsIHRoaXMuX2NoYWluKTsKICAgIH07CiAgfSk7CgogIC8vIEFkZCBhbGwgYWNjZXNzb3IgQXJyYXkgZnVuY3Rpb25zIHRvIHRoZSB3cmFwcGVyLgogIGVhY2goWydjb25jYXQnLCAnam9pbicsICdzbGljZSddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIHdyYXBwZXIucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiByZXN1bHQobWV0aG9kLmFwcGx5KHRoaXMuX3dyYXBwZWQsIGFyZ3VtZW50cyksIHRoaXMuX2NoYWluKTsKICAgIH07CiAgfSk7CgogIC8vIFN0YXJ0IGNoYWluaW5nIGEgd3JhcHBlZCBVbmRlcnNjb3JlIG9iamVjdC4KICB3cmFwcGVyLnByb3RvdHlwZS5jaGFpbiA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fY2hhaW4gPSB0cnVlOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLy8gRXh0cmFjdHMgdGhlIHJlc3VsdCBmcm9tIGEgd3JhcHBlZCBhbmQgY2hhaW5lZCBvYmplY3QuCiAgd3JhcHBlci5wcm90b3R5cGUudmFsdWUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl93cmFwcGVkOwogIH07Cgp9KSgpOwoKCn0pfTsKCi8qKioqKioqKioqIGthbnNvL3VybCAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImthbnNvL3VybCJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKioKICogVVJMIGZ1bmN0aW9ucyBwb3J0ZWQgZnJvbSBub2RlLmpzIHRvIHdvcmsgaW4gQ291Y2hEQiBhbmQgdGhlIGJyb3dzZXIuCiAqIFRoaXMgbW9kdWxlIGlzIHVzZWQgaW50ZXJuYWxseSBieSBLYW5zbywgYWx0aG91Z2ggeW91IGNhbiB1c2UgaXQgaW4geW91cgogKiBhcHBzIHRvbyBpZiB5b3UgZmluZCB0aGUgZnVuY3Rpb25zIHVzZWZ1bC4KICoKICogQG1vZHVsZQogKi8KCi8vIENvcHlyaWdodCBKb3llbnQsIEluYy4gYW5kIG90aGVyIE5vZGUgY29udHJpYnV0b3JzLgovLwovLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQovLyBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlCi8vICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcKLy8gd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLAovLyBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0Ci8vIHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZQovLyBmb2xsb3dpbmcgY29uZGl0aW9uczoKLy8KLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQKLy8gaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCi8vCi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCi8vIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YKLy8gTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTgovLyBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwKLy8gREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SCi8vIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUKLy8gVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KCi8qKgogKiBGcm9tIG5vZGUuanMgdjAuMi42CiAqLwoKdmFyIHBhdGggPSByZXF1aXJlKCdrYW5zby9wYXRoJyksCiAgICBxdWVyeXN0cmluZyA9IHJlcXVpcmUoJ2thbnNvL3F1ZXJ5c3RyaW5nJyksCiAgICBfID0gcmVxdWlyZSgna2Fuc28vdW5kZXJzY29yZScpLl87CgoKLy8gZGVmaW5lIHRoZXNlIGhlcmUgc28gYXQgbGVhc3QgdGhleSBvbmx5IGhhdmUgdG8gYmUgY29tcGlsZWQgb25jZSBvbiB0aGUKLy8gZmlyc3QgbW9kdWxlIGxvYWQuCnZhciBwcm90b2NvbFBhdHRlcm4gPSAvXihbYS16MC05XSs6KS8sCiAgICBwb3J0UGF0dGVybiA9IC86WzAtOV0rJC8sCiAgICBub25Ib3N0Q2hhcnMgPSBbIi8iLCAiPyIsICI7IiwgIiMiXSwKICAgIGhvc3RsZXNzUHJvdG9jb2wgPSB7CiAgICAgICAgImZpbGUiOiB0cnVlLAogICAgICAgICJmaWxlOiI6IHRydWUKICAgIH0sCiAgICBzbGFzaGVkUHJvdG9jb2wgPSB7CiAgICAgICAgImh0dHAiOiB0cnVlLAogICAgICAgICJodHRwcyI6IHRydWUsCiAgICAgICAgImZ0cCI6IHRydWUsCiAgICAgICAgImdvcGhlciI6IHRydWUsCiAgICAgICAgImZpbGUiOiB0cnVlLAogICAgICAgICJodHRwOiI6IHRydWUsCiAgICAgICAgImh0dHBzOiI6IHRydWUsCiAgICAgICAgImZ0cDoiOiB0cnVlLAogICAgICAgICJnb3BoZXI6IjogdHJ1ZSwKICAgICAgICAiZmlsZToiOiB0cnVlCiAgICB9OwoKCmZ1bmN0aW9uIHBhcnNlSG9zdChob3N0KSB7CiAgICB2YXIgb3V0ID0ge307CiAgICB2YXIgYXQgPSBob3N0LmluZGV4T2YoIkAiKTsKICAgIGlmIChhdCAhPT0gLTEpIHsKICAgICAgICBvdXQuYXV0aCA9IGhvc3Quc3Vic3RyKDAsIGF0KTsKICAgICAgICBob3N0ID0gaG9zdC5zdWJzdHIoYXQgKyAxKTsgLy8gZHJvcCB0aGUgQAogICAgfQogICAgdmFyIHBvcnQgPSBwb3J0UGF0dGVybi5leGVjKGhvc3QpOwogICAgaWYgKHBvcnQpIHsKICAgICAgICBwb3J0ID0gcG9ydFswXTsKICAgICAgICBvdXQucG9ydCA9IHBvcnQuc3Vic3RyKDEpOwogICAgICAgIGhvc3QgPSBob3N0LnN1YnN0cigwLCBob3N0Lmxlbmd0aCAtIHBvcnQubGVuZ3RoKTsKICAgIH0KICAgIGlmIChob3N0KSB7CiAgICAgICAgb3V0Lmhvc3RuYW1lID0gaG9zdDsKICAgIH0KICAgIHJldHVybiBvdXQ7Cn0KCi8qKgogKiBUYWtlIGEgVVJMIHN0cmluZywgYW5kIHJldHVybiBhbiBvYmplY3QuIFBhc3MgdHJ1ZSBhcyB0aGUgc2Vjb25kIGFyZ3VtZW50CiAqIHRvIGFsc28gcGFyc2UgdGhlIHF1ZXJ5IHN0cmluZyB1c2luZyB0aGUgcXVlcnlzdHJpbmcgbW9kdWxlLgogKgogKiBAbmFtZSBwYXJzZSh1cmwsIFtwYXJzZVF1ZXJ5U3RyaW5nLCBzbGFzaGVzRGVub3RlSG9zdF0pCiAqIEBwYXJhbSB7U3RyaW5nfSB1cmwKICogQHBhcmFtIHtCb29sZWFufSBwYXJzZVF1ZXJ5U3RyaW5nCiAqIEBwYXJhbSB7Qm9vbGVhbn0gc2xhc2hlc0Rlbm90ZUhvc3QKICogQHJldHVybnMgT2JqZWN0CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5wYXJzZSA9IGZ1bmN0aW9uICh1cmwsIHBhcnNlUXVlcnlTdHJpbmcsIHNsYXNoZXNEZW5vdGVIb3N0KSB7CiAgICBpZiAodXJsICYmIHR5cGVvZih1cmwpID09PSAib2JqZWN0IiAmJiB1cmwuaHJlZikgewogICAgICAgIHJldHVybiB1cmw7CiAgICB9CgogICAgdmFyIG91dCA9IHsgaHJlZiA6IHVybCB9LAogICAgICAgIHJlc3QgPSB1cmw7CgogICAgdmFyIHByb3RvID0gcHJvdG9jb2xQYXR0ZXJuLmV4ZWMocmVzdCk7CiAgICBpZiAocHJvdG8pIHsKICAgICAgICBwcm90byA9IHByb3RvWzBdOwogICAgICAgIG91dC5wcm90b2NvbCA9IHByb3RvOwogICAgICAgIHJlc3QgPSByZXN0LnN1YnN0cihwcm90by5sZW5ndGgpOwogICAgfQoKICAgIC8vIGZpZ3VyZSBvdXQgaWYgaXQncyBnb3QgYSBob3N0CiAgICAvLyB1c2VyQHNlcnZlciBpcyAqYWx3YXlzKiBpbnRlcnByZXRlZCBhcyBhIGhvc3RuYW1lLCBhbmQgdXJsCiAgICAvLyByZXNvbHV0aW9uIHdpbGwgdHJlYXQgLy9mb28vYmFyIGFzIGhvc3Q9Zm9vLHBhdGg9YmFyIGJlY2F1c2UgdGhhdCdzCiAgICAvLyBob3cgdGhlIGJyb3dzZXIgcmVzb2x2ZXMgcmVsYXRpdmUgVVJMcy4KICAgIHZhciBzbGFzaGVzOwogICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgnXlxcL1xcL1teQFxcL10rQFteQFxcL10rJyk7CiAgICBpZiAoc2xhc2hlc0Rlbm90ZUhvc3QgfHwgcHJvdG8gfHwgcmVzdC5tYXRjaChyZSkpIHsKICAgICAgICBzbGFzaGVzID0gcmVzdC5zdWJzdHIoMCwgMikgPT09ICIvLyI7CiAgICAgICAgaWYgKHNsYXNoZXMgJiYgIShwcm90byAmJiBob3N0bGVzc1Byb3RvY29sW3Byb3RvXSkpIHsKICAgICAgICAgICAgcmVzdCA9IHJlc3Quc3Vic3RyKDIpOwogICAgICAgICAgICBvdXQuc2xhc2hlcyA9IHRydWU7CiAgICAgICAgfQogICAgfQogICAgaWYgKCFob3N0bGVzc1Byb3RvY29sW3Byb3RvXSAmJiAoc2xhc2hlcyB8fCAocHJvdG8gJiYgIXNsYXNoZWRQcm90b2NvbFtwcm90b10pKSkgewogICAgICAgIC8vIHRoZXJlJ3MgYSBob3N0bmFtZS4KICAgICAgICAvLyB0aGUgZmlyc3QgaW5zdGFuY2Ugb2YgLywgPywgOywgb3IgIyBlbmRzIHRoZSBob3N0LgogICAgICAgIC8vIGRvbid0IGVuZm9yY2UgZnVsbCBSRkMgY29ycmVjdG5lc3MsIGp1c3QgYmUgdW5zdHVwaWQgYWJvdXQgaXQuCiAgICAgICAgdmFyIGZpcnN0Tm9uSG9zdCA9IC0xOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbm9uSG9zdENoYXJzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICB2YXIgaW5kZXggPSByZXN0LmluZGV4T2Yobm9uSG9zdENoYXJzW2ldKTsKICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSAmJiAoZmlyc3ROb25Ib3N0IDwgMCB8fCBpbmRleCA8IGZpcnN0Tm9uSG9zdCkpIHsKICAgICAgICAgICAgICAgIGZpcnN0Tm9uSG9zdCA9IGluZGV4OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChmaXJzdE5vbkhvc3QgIT09IC0xKSB7CiAgICAgICAgICAgIG91dC5ob3N0ID0gcmVzdC5zdWJzdHIoMCwgZmlyc3ROb25Ib3N0KTsKICAgICAgICAgICAgcmVzdCA9IHJlc3Quc3Vic3RyKGZpcnN0Tm9uSG9zdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb3V0Lmhvc3QgPSByZXN0OwogICAgICAgICAgICByZXN0ID0gIiI7CiAgICAgICAgfQoKICAgICAgICAvLyBwdWxsIG91dCB0aGUgYXV0aCBhbmQgcG9ydC4KICAgICAgICB2YXIgcCA9IHBhcnNlSG9zdChvdXQuaG9zdCk7CiAgICAgICAgdmFyIGtleXMgPSBfLmtleXMocCk7CiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGwyID0ga2V5cy5sZW5ndGg7IGogPCBsMjsgaisrKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBrZXlzW2pdOwogICAgICAgICAgICBvdXRba2V5XSA9IHBba2V5XTsKICAgICAgICB9CiAgICAgICAgLy8gd2UndmUgaW5kaWNhdGVkIHRoYXQgdGhlcmUgaXMgYSBob3N0bmFtZSwgc28gZXZlbiBpZiBpdCdzIGVtcHR5LCBpdCBoYXMgdG8gYmUgcHJlc2VudC4KICAgICAgICBvdXQuaG9zdG5hbWUgPSBvdXQuaG9zdG5hbWUgfHwgIiI7CiAgICB9CgogICAgLy8gbm93IHJlc3QgaXMgc2V0IHRvIHRoZSBwb3N0LWhvc3Qgc3R1ZmYuCiAgICAvLyBjaG9wIG9mZiBmcm9tIHRoZSB0YWlsIGZpcnN0LgogICAgdmFyIGhhc2ggPSByZXN0LmluZGV4T2YoIiMiKTsKICAgIGlmIChoYXNoICE9PSAtMSkgewogICAgICAgIC8vIGdvdCBhIGZyYWdtZW50IHN0cmluZy4KICAgICAgICBvdXQuaGFzaCA9IHJlc3Quc3Vic3RyKGhhc2gpOwogICAgICAgIHJlc3QgPSByZXN0LnNsaWNlKDAsIGhhc2gpOwogICAgfQogICAgdmFyIHFtID0gcmVzdC5pbmRleE9mKCI/Iik7CiAgICBpZiAocW0gIT09IC0xKSB7CiAgICAgICAgb3V0LnNlYXJjaCA9IHJlc3Quc3Vic3RyKHFtKTsKICAgICAgICBvdXQucXVlcnkgPSByZXN0LnN1YnN0cihxbSArIDEpOwogICAgICAgIGlmIChwYXJzZVF1ZXJ5U3RyaW5nKSB7CiAgICAgICAgICAgIG91dC5xdWVyeSA9IHF1ZXJ5c3RyaW5nLnBhcnNlKG91dC5xdWVyeSk7CiAgICAgICAgfQogICAgICAgIHJlc3QgPSByZXN0LnNsaWNlKDAsIHFtKTsKICAgIH0KICAgIGlmIChyZXN0KSB7CiAgICAgICAgb3V0LnBhdGhuYW1lID0gcmVzdDsKICAgIH0KCiAgICByZXR1cm4gb3V0Owp9OwoKLyoqCiAqIFRha2UgYSBwYXJzZWQgVVJMIG9iamVjdCwgYW5kIHJldHVybiBhIGZvcm1hdHRlZCBVUkwgc3RyaW5nLgogKgogKiBAbmFtZSBmb3JtYXQob2JqKQogKiBAcGFyYW0ge09iamVjdH0gb2JqCiAqIEBhcGkgcHVibGljCiAqLwoKLy8gZm9ybWF0IGEgcGFyc2VkIG9iamVjdCBpbnRvIGEgdXJsIHN0cmluZwpleHBvcnRzLmZvcm1hdCA9IGZ1bmN0aW9uIChvYmopIHsKICAgIC8vIGVuc3VyZSBpdCdzIGFuIG9iamVjdCwgYW5kIG5vdCBhIHN0cmluZyB1cmwuIElmIGl0J3MgYW4gb2JqLCB0aGlzIGlzIGEgbm8tb3AuCiAgICAvLyB0aGlzIHdheSwgeW91IGNhbiBjYWxsIHVybF9mb3JtYXQoKSBvbiBzdHJpbmdzIHRvIGNsZWFuIHVwIHBvdGVudGlhbGx5IHdvbmt5IHVybHMuCiAgICBpZiAodHlwZW9mKG9iaikgPT09ICJzdHJpbmciKSB7CiAgICAgICAgb2JqID0gZXhwb3J0cy5wYXJzZShvYmopOwogICAgfQoKICAgIHZhciBwcm90b2NvbCA9IG9iai5wcm90b2NvbCB8fCAiIiwKICAgICAgICBob3N0ID0gKG9iai5ob3N0ICE9PSB1bmRlZmluZWQpID8gb2JqLmhvc3QKICAgICAgICAgICAgOiBvYmouaG9zdG5hbWUgIT09IHVuZGVmaW5lZCA/ICgob2JqLmF1dGggPyBvYmouYXV0aCArICJAIiA6ICIiKSArIG9iai5ob3N0bmFtZSArIChvYmoucG9ydCA/ICI6IiArIG9iai5wb3J0IDogIiIpKQogICAgICAgICAgICA6IGZhbHNlLAogICAgICAgIHBhdGhuYW1lID0gb2JqLnBhdGhuYW1lIHx8ICIiLAogICAgICAgIHNlYXJjaCA9IG9iai5zZWFyY2ggfHwgKAogICAgICAgICAgICAgICAgb2JqLnF1ZXJ5ICYmICgiPyIgKyAodHlwZW9mKG9iai5xdWVyeSkgPT09ICJvYmplY3QiID8gcXVlcnlzdHJpbmcuc3RyaW5naWZ5KG9iai5xdWVyeSkgOiBTdHJpbmcob2JqLnF1ZXJ5KSkpCiAgICAgICAgICAgICAgICApIHx8ICIiLAogICAgICAgIGhhc2ggPSBvYmouaGFzaCB8fCAiIjsKCiAgICBpZiAocHJvdG9jb2wgJiYgcHJvdG9jb2wuc3Vic3RyKC0xKSAhPT0gIjoiKSB7CiAgICAgICAgcHJvdG9jb2wgKz0gIjoiOwogICAgfQoKICAgIC8vIG9ubHkgdGhlIHNsYXNoZWRQcm90b2NvbHMgZ2V0IHRoZSAvLy4gIE5vdCBtYWlsdG86LCB4bXBwOiwgZXRjLgogICAgLy8gdW5sZXNzIHRoZXkgaGFkIHRoZW0gdG8gYmVnaW4gd2l0aC4KICAgIGlmIChvYmouc2xhc2hlcyB8fCAoIXByb3RvY29sIHx8IHNsYXNoZWRQcm90b2NvbFtwcm90b2NvbF0pICYmIGhvc3QgIT09IGZhbHNlKSB7CiAgICAgICAgaG9zdCA9ICIvLyIgKyAoaG9zdCB8fCAiIik7CiAgICAgICAgaWYgKHBhdGhuYW1lICYmIHBhdGhuYW1lLmNoYXJBdCgwKSAhPT0gIi8iKSB7CiAgICAgICAgICAgIHBhdGhuYW1lID0gIi8iICsgcGF0aG5hbWU7CiAgICAgICAgfQogICAgfQogICAgZWxzZSBpZiAoIWhvc3QpIHsKICAgICAgICBob3N0ID0gIiI7CiAgICB9CgogICAgaWYgKGhhc2ggJiYgaGFzaC5jaGFyQXQoMCkgIT09ICIjIikgewogICAgICAgIGhhc2ggPSAiIyIgKyBoYXNoOwogICAgfQogICAgaWYgKHNlYXJjaCAmJiBzZWFyY2guY2hhckF0KDApICE9PSAiPyIpIHsKICAgICAgICBzZWFyY2ggPSAiPyIgKyBzZWFyY2g7CiAgICB9CgogICAgcmV0dXJuIHByb3RvY29sICsgaG9zdCArIHBhdGhuYW1lICsgc2VhcmNoICsgaGFzaDsKfTsKCi8qKgogKiBUYWtlIGEgYmFzZSBVUkwsIGFuZCBhIGhyZWYgVVJMLCBhbmQgcmVzb2x2ZSB0aGVtIGFzIGEgYnJvd3NlciB3b3VsZCBmb3IKICogYW4gYW5jaG9yIHRhZy4KICoKICogQG5hbWUgcmVzb2x2ZShzb3VyY2UsIHJlbGF0aXZlKQogKiBAcGFyYW0ge1N0cmluZ30gc291cmNlCiAqIEBwYXJhbSB7U3RyaW5nfSByZWxhdGl2ZQogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMucmVzb2x2ZSA9IGZ1bmN0aW9uIChzb3VyY2UsIHJlbGF0aXZlKSB7CiAgICByZXR1cm4gZXhwb3J0cy5mb3JtYXQoZXhwb3J0cy5yZXNvbHZlT2JqZWN0KHNvdXJjZSwgcmVsYXRpdmUpKTsKfTsKCmV4cG9ydHMucmVzb2x2ZU9iamVjdCA9IGZ1bmN0aW9uIChzb3VyY2UsIHJlbGF0aXZlKSB7CiAgICBpZiAoIXNvdXJjZSkgewogICAgICAgIHJldHVybiByZWxhdGl2ZTsKICAgIH0KICAgIHZhciByZWxQYXRoOwoKICAgIHNvdXJjZSA9IGV4cG9ydHMucGFyc2UoZXhwb3J0cy5mb3JtYXQoc291cmNlKSwgZmFsc2UsIHRydWUpOwogICAgcmVsYXRpdmUgPSBleHBvcnRzLnBhcnNlKGV4cG9ydHMuZm9ybWF0KHJlbGF0aXZlKSwgZmFsc2UsIHRydWUpOwoKICAgIC8vIGhhc2ggaXMgYWx3YXlzIG92ZXJyaWRkZW4sIG5vIG1hdHRlciB3aGF0LgogICAgc291cmNlLmhhc2ggPSByZWxhdGl2ZS5oYXNoOwoKICAgIGlmIChyZWxhdGl2ZS5ocmVmID09PSAiIikgewogICAgICAgIHJldHVybiBzb3VyY2U7CiAgICB9CgogICAgLy8gaHJlZnMgbGlrZSAvL2Zvby9iYXIgYWx3YXlzIGN1dCB0byB0aGUgcHJvdG9jb2wuCiAgICBpZiAocmVsYXRpdmUuc2xhc2hlcyAmJiAhcmVsYXRpdmUucHJvdG9jb2wpIHsKICAgICAgICByZWxhdGl2ZS5wcm90b2NvbCA9IHNvdXJjZS5wcm90b2NvbDsKICAgICAgICByZXR1cm4gcmVsYXRpdmU7CiAgICB9CgogICAgaWYgKHJlbGF0aXZlLnByb3RvY29sICYmIHJlbGF0aXZlLnByb3RvY29sICE9PSBzb3VyY2UucHJvdG9jb2wpIHsKICAgICAgICAvLyBpZiBpdCdzIGEga25vd24gdXJsIHByb3RvY29sLCB0aGVuIGNoYW5naW5nIHRoZSBwcm90b2NvbCBkb2VzIHdlaXJkIHRoaW5ncwogICAgICAgIC8vIGZpcnN0LCBpZiBpdCdzIG5vdCBmaWxlOiwgdGhlbiB3ZSBNVVNUIGhhdmUgYSBob3N0LCBhbmQgaWYgdGhlcmUgd2FzIGEgcGF0aAogICAgICAgIC8vIHRvIGJlZ2luIHdpdGgsIHRoZW4gd2UgTVVTVCBoYXZlIGEgcGF0aC4KICAgICAgICAvLyBpZiBpdCBpcyBmaWxlOiwgdGhlbiB0aGUgaG9zdCBpcyBkcm9wcGVkLCBiZWNhdXNlIHRoYXQncyBrbm93biB0byBiZSBob3N0bGVzcy4KICAgICAgICAvLyBhbnl0aGluZyBlbHNlIGlzIGFzc3VtZWQgdG8gYmUgYWJzb2x1dGUuCgogICAgICAgIGlmICghc2xhc2hlZFByb3RvY29sW3JlbGF0aXZlLnByb3RvY29sXSkgewogICAgICAgICAgICByZXR1cm4gcmVsYXRpdmU7CiAgICAgICAgfQoKICAgICAgICBzb3VyY2UucHJvdG9jb2wgPSByZWxhdGl2ZS5wcm90b2NvbDsKICAgICAgICBpZiAoIXJlbGF0aXZlLmhvc3QgJiYgIWhvc3RsZXNzUHJvdG9jb2xbcmVsYXRpdmUucHJvdG9jb2xdKSB7CiAgICAgICAgICAgIHJlbFBhdGggPSAocmVsYXRpdmUucGF0aG5hbWUgfHwgIiIpLnNwbGl0KCIvIik7CiAgICAgICAgICAgIHdoaWxlIChyZWxQYXRoLmxlbmd0aCAmJiAhKHJlbGF0aXZlLmhvc3QgPSByZWxQYXRoLnNoaWZ0KCkpKSB7fQogICAgICAgICAgICBpZiAoIXJlbGF0aXZlLmhvc3QpIHsKICAgICAgICAgICAgICAgIHJlbGF0aXZlLmhvc3QgPSAiIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVsUGF0aFswXSAhPT0gIiIpIHsKICAgICAgICAgICAgICAgIHJlbFBhdGgudW5zaGlmdCgiIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJlbFBhdGgubGVuZ3RoIDwgMikgewogICAgICAgICAgICAgICAgcmVsUGF0aC51bnNoaWZ0KCIiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZWxhdGl2ZS5wYXRobmFtZSA9IHJlbFBhdGguam9pbigiLyIpOwogICAgICAgIH0KICAgICAgICBzb3VyY2UucGF0aG5hbWUgPSByZWxhdGl2ZS5wYXRobmFtZTsKICAgICAgICBzb3VyY2Uuc2VhcmNoID0gcmVsYXRpdmUuc2VhcmNoOwogICAgICAgIHNvdXJjZS5xdWVyeSA9IHJlbGF0aXZlLnF1ZXJ5OwogICAgICAgIHNvdXJjZS5ob3N0ID0gcmVsYXRpdmUuaG9zdCB8fCAiIjsKICAgICAgICBkZWxldGUgc291cmNlLmF1dGg7CiAgICAgICAgZGVsZXRlIHNvdXJjZS5ob3N0bmFtZTsKICAgICAgICBzb3VyY2UucG9ydCA9IHJlbGF0aXZlLnBvcnQ7CiAgICAgICAgcmV0dXJuIHNvdXJjZTsKICAgIH0KCiAgICB2YXIgaXNTb3VyY2VBYnMgPSAoc291cmNlLnBhdGhuYW1lICYmIHNvdXJjZS5wYXRobmFtZS5jaGFyQXQoMCkgPT09ICIvIiksCiAgICAgICAgaXNSZWxBYnMgPSAocmVsYXRpdmUuaG9zdCAhPT0gdW5kZWZpbmVkIHx8IHJlbGF0aXZlLnBhdGhuYW1lICYmIHJlbGF0aXZlLnBhdGhuYW1lLmNoYXJBdCgwKSA9PT0gIi8iKSwKICAgICAgICBtdXN0RW5kQWJzID0gKGlzUmVsQWJzIHx8IGlzU291cmNlQWJzIHx8IChzb3VyY2UuaG9zdCAmJiByZWxhdGl2ZS5wYXRobmFtZSkpLAogICAgICAgIHJlbW92ZUFsbERvdHMgPSBtdXN0RW5kQWJzLAogICAgICAgIHNyY1BhdGggPSBzb3VyY2UucGF0aG5hbWUgJiYgc291cmNlLnBhdGhuYW1lLnNwbGl0KCIvIikgfHwgW10sCiAgICAgICAgcHN5Y2hvdGljID0gc291cmNlLnByb3RvY29sICYmICFzbGFzaGVkUHJvdG9jb2xbc291cmNlLnByb3RvY29sXSAmJiBzb3VyY2UuaG9zdCAhPT0gdW5kZWZpbmVkOwogICAgcmVsUGF0aCA9IHJlbGF0aXZlLnBhdGhuYW1lICYmIHJlbGF0aXZlLnBhdGhuYW1lLnNwbGl0KCIvIikgfHwgW107CgogICAgLy8gaWYgdGhlIHVybCBpcyBhIG5vbi1zbGFzaGVkIHVybCwgdGhlbiByZWxhdGl2ZSBsaW5rcyBsaWtlIC4uLy4uIHNob3VsZCBiZSBhYmxlCiAgICAvLyB0byBjcmF3bCB1cCB0byB0aGUgaG9zdG5hbWUsIGFzIHdlbGwuICBUaGlzIGlzIHN0cmFuZ2UuCiAgICAvLyBzb3VyY2UucHJvdG9jb2wgaGFzIGFscmVhZHkgYmVlbiBzZXQgYnkgbm93LgogICAgLy8gTGF0ZXIgb24sIHB1dCB0aGUgZmlyc3QgcGF0aCBwYXJ0IGludG8gdGhlIGhvc3QgZmllbGQuCiAgICBpZiAocHN5Y2hvdGljKSB7CgogICAgICAgIGRlbGV0ZSBzb3VyY2UuaG9zdG5hbWU7CiAgICAgICAgZGVsZXRlIHNvdXJjZS5hdXRoOwogICAgICAgIGRlbGV0ZSBzb3VyY2UucG9ydDsKICAgICAgICBpZiAoc291cmNlLmhvc3QpIHsKICAgICAgICAgICAgaWYgKHNyY1BhdGhbMF0gPT09ICIiKSB7CiAgICAgICAgICAgICAgICBzcmNQYXRoWzBdID0gc291cmNlLmhvc3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBzcmNQYXRoLnVuc2hpZnQoc291cmNlLmhvc3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBzb3VyY2UuaG9zdDsKCiAgICAgICAgaWYgKHJlbGF0aXZlLnByb3RvY29sKSB7CiAgICAgICAgICAgIGRlbGV0ZSByZWxhdGl2ZS5ob3N0bmFtZTsKICAgICAgICAgICAgZGVsZXRlIHJlbGF0aXZlLmF1dGg7CiAgICAgICAgICAgIGRlbGV0ZSByZWxhdGl2ZS5wb3J0OwogICAgICAgICAgICBpZiAocmVsYXRpdmUuaG9zdCkgewogICAgICAgICAgICAgICAgaWYgKHJlbFBhdGhbMF0gPT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgcmVsUGF0aFswXSA9IHJlbGF0aXZlLmhvc3Q7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZWxQYXRoLnVuc2hpZnQocmVsYXRpdmUuaG9zdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVsZXRlIHJlbGF0aXZlLmhvc3Q7CiAgICAgICAgfQogICAgICAgIG11c3RFbmRBYnMgPSBtdXN0RW5kQWJzICYmIChyZWxQYXRoWzBdID09PSAiIiB8fCBzcmNQYXRoWzBdID09PSAiIik7CiAgICB9CgogICAgaWYgKGlzUmVsQWJzKSB7CiAgICAgICAgLy8gaXQncyBhYnNvbHV0ZS4KICAgICAgICBzb3VyY2UuaG9zdCA9IChyZWxhdGl2ZS5ob3N0IHx8IHJlbGF0aXZlLmhvc3QgPT09ICIiKSA/IHJlbGF0aXZlLmhvc3QgOiBzb3VyY2UuaG9zdDsKICAgICAgICBzb3VyY2Uuc2VhcmNoID0gcmVsYXRpdmUuc2VhcmNoOwogICAgICAgIHNvdXJjZS5xdWVyeSA9IHJlbGF0aXZlLnF1ZXJ5OwogICAgICAgIHNyY1BhdGggPSByZWxQYXRoOwogICAgICAgIC8vIGZhbGwgdGhyb3VnaCB0byB0aGUgZG90LWhhbmRsaW5nIGJlbG93LgogICAgfQogICAgZWxzZSBpZiAocmVsUGF0aC5sZW5ndGgpIHsKICAgICAgICAvLyBpdCdzIHJlbGF0aXZlCiAgICAgICAgLy8gdGhyb3cgYXdheSB0aGUgZXhpc3RpbmcgZmlsZSwgYW5kIHRha2UgdGhlIG5ldyBwYXRoIGluc3RlYWQuCiAgICAgICAgaWYgKCFzcmNQYXRoKSB7CiAgICAgICAgICAgIHNyY1BhdGggPSBbXTsKICAgICAgICB9CiAgICAgICAgc3JjUGF0aC5wb3AoKTsKICAgICAgICBzcmNQYXRoID0gc3JjUGF0aC5jb25jYXQocmVsUGF0aCk7CiAgICAgICAgc291cmNlLnNlYXJjaCA9IHJlbGF0aXZlLnNlYXJjaDsKICAgICAgICBzb3VyY2UucXVlcnkgPSByZWxhdGl2ZS5xdWVyeTsKICAgIH0KICAgIGVsc2UgaWYgKCJzZWFyY2giIGluIHJlbGF0aXZlKSB7CiAgICAgICAgLy8ganVzdCBwdWxsIG91dCB0aGUgc2VhcmNoLgogICAgICAgIC8vIGxpa2UgaHJlZj0iP2ZvbyIuCiAgICAgICAgLy8gUHV0IHRoaXMgYWZ0ZXIgdGhlIG90aGVyIHR3byBjYXNlcyBiZWNhdXNlIGl0IHNpbXBsaWZpZXMgdGhlIGJvb2xlYW5zCiAgICAgICAgaWYgKHBzeWNob3RpYykgewogICAgICAgICAgICBzb3VyY2UuaG9zdCA9IHNyY1BhdGguc2hpZnQoKTsKICAgICAgICB9CiAgICAgICAgc291cmNlLnNlYXJjaCA9IHJlbGF0aXZlLnNlYXJjaDsKICAgICAgICBzb3VyY2UucXVlcnkgPSByZWxhdGl2ZS5xdWVyeTsKICAgICAgICByZXR1cm4gc291cmNlOwogICAgfQogICAgaWYgKCFzcmNQYXRoLmxlbmd0aCkgewogICAgICAgIC8vIG5vIHBhdGggYXQgYWxsLiAgZWFzeS4KICAgICAgICAvLyB3ZSd2ZSBhbHJlYWR5IGhhbmRsZWQgdGhlIG90aGVyIHN0dWZmIGFib3ZlLgogICAgICAgIGRlbGV0ZSBzb3VyY2UucGF0aG5hbWU7CiAgICAgICAgcmV0dXJuIHNvdXJjZTsKICAgIH0KCiAgICAvLyByZXNvbHZlIGRvdHMuCiAgICAvLyBpZiBhIHVybCBFTkRzIGluIC4gb3IgLi4sIHRoZW4gaXQgbXVzdCBnZXQgYSB0cmFpbGluZyBzbGFzaC4KICAgIC8vIGhvd2V2ZXIsIGlmIGl0IGVuZHMgaW4gYW55dGhpbmcgZWxzZSBub24tc2xhc2h5LCB0aGVuIGl0IG11c3QgTk9UIGdldCBhIHRyYWlsaW5nIHNsYXNoLgogICAgdmFyIGxhc3QgPSBzcmNQYXRoLnNsaWNlKC0xKVswXTsKICAgIHZhciBoYXNUcmFpbGluZ1NsYXNoID0gKChzb3VyY2UuaG9zdCB8fCByZWxhdGl2ZS5ob3N0KSAmJiAobGFzdCA9PT0gIi4iIHx8IGxhc3QgPT09ICIuLiIpIHx8IGxhc3QgPT09ICIiKTsKCiAgICAvLyBGaWd1cmUgb3V0IGlmIHRoaXMgaGFzIHRvIGVuZCB1cCBhcyBhbiBhYnNvbHV0ZSB1cmwsIG9yIHNob3VsZCBjb250aW51ZSB0byBiZSByZWxhdGl2ZS4KICAgIHNyY1BhdGggPSBwYXRoLm5vcm1hbGl6ZUFycmF5KHNyY1BhdGgsIHRydWUpOwogICAgaWYgKHNyY1BhdGgubGVuZ3RoID09PSAxICYmIHNyY1BhdGhbMF0gPT09ICIuIikgewogICAgICAgIHNyY1BhdGggPSBbXTsKICAgIH0KICAgIGlmIChtdXN0RW5kQWJzIHx8IHJlbW92ZUFsbERvdHMpIHsKICAgICAgICAvLyBhbGwgZG90cyBtdXN0IGdvLgogICAgICAgIHZhciBkaXJzID0gW107CiAgICAgICAgc3JjUGF0aC5mb3JFYWNoKGZ1bmN0aW9uIChkaXIsIGkpIHsKICAgICAgICAgICAgaWYgKGRpciA9PT0gIi4uIikgewogICAgICAgICAgICAgICAgZGlycy5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChkaXIgIT09ICIuIikgewogICAgICAgICAgICAgICAgZGlycy5wdXNoKGRpcik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgaWYgKG11c3RFbmRBYnMgJiYgZGlyc1swXSAhPT0gIiIpIHsKICAgICAgICAgICAgZGlycy51bnNoaWZ0KCIiKTsKICAgICAgICB9CiAgICAgICAgc3JjUGF0aCA9IGRpcnM7CiAgICB9CiAgICBpZiAoaGFzVHJhaWxpbmdTbGFzaCAmJiAoc3JjUGF0aC5sZW5ndGggPCAyIHx8IHNyY1BhdGguc2xpY2UoLTEpWzBdICE9PSAiIikpIHsKICAgICAgICBzcmNQYXRoLnB1c2goIiIpOwogICAgfQoKICAgIC8vIHB1dCB0aGUgaG9zdCBiYWNrCiAgICBpZiAocHN5Y2hvdGljKSB7CiAgICAgICAgc291cmNlLmhvc3QgPSBzcmNQYXRoWzBdID09PSAiIiA/ICIiIDogc3JjUGF0aC5zaGlmdCgpOwogICAgfQoKICAgIG11c3RFbmRBYnMgPSBtdXN0RW5kQWJzIHx8IChzb3VyY2UuaG9zdCAmJiBzcmNQYXRoLmxlbmd0aCk7CgogICAgaWYgKG11c3RFbmRBYnMgJiYgc3JjUGF0aFswXSAhPT0gIiIpIHsKICAgICAgICBzcmNQYXRoLnVuc2hpZnQoIiIpOwogICAgfQoKICAgIHNvdXJjZS5wYXRobmFtZSA9IHNyY1BhdGguam9pbigiLyIpOwoKICAgIHJldHVybiBzb3VyY2U7Cn07CgoKfSl9OwoKLyoqKioqKioqKioga2Fuc28vdXRpbHMgKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJrYW5zby91dGlscyJdID0ge2xvYWQ6IChmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCByZXF1aXJlKSB7CgovKmdsb2JhbCB3aW5kb3c6IGZhbHNlLCBfX2thbnNvanNfY3VycmVudF9yZXF1ZXN0OiB0cnVlKi8KCgovKioKICogR2VuZXJhbCB1dGlsaXR5IGZ1bmN0aW9ucyB1c2VkIGJ5IEthbnNvLiBTb21lIGZ1bmN0aW9ucyB3ZXJlIG1vdmVkIGhlcmUgZnJvbQogKiBvdGhlciBtb2R1bGVzIChzdWNoIGFzIGNvcmUpLCB0byBhdm9pZCBhIGNpcmN1bGFyIGRlcGVuZGVuY3kgYnVnIGluIENvdWNoREIuCiAqCiAqIFRoaXMgbW9kdWxlIGFsc28gc3RvcmVzIHNvbWUgdXNlZnVsIHByb3BlcnRpZXMgc3VjaCBhcyAnaXNCcm93c2VyJywgd2hpY2ggaXMKICogdHJ1ZSBpZiB0aGUgY29kZSBpcyBydW5uaW5nIGluIGEgYnJvd3NlciBlbnZpcm9ubWVudCwgYW5kICdpbml0aWFsX2hpdCcgd2hpY2gKICogaXMgc2V0IHRvIHRydWUgd2hlbiBhIHBhZ2UgaXMgZmlyc3QgcmVxdWVzdGVkIGZyb20gQ291Y2hEQiAoYW5kIHNldCB0byBmYWxzZQogKiBmb3Igc3Vic2VxdWVudCByZXF1ZXN0cykuCiAqCiAqIEBtb2R1bGUKICovCgovKioKICogTW9kdWxlIGRlcGVuZGVuY2llcwogKi8KCnZhciBzZXR0aW5ncyA9IHJlcXVpcmUoJy4vc2V0dGluZ3MnKSwgLy8gc2V0dGluZ3MgbW9kdWxlIGlzIGF1dG8tZ2VuZXJhdGVkCiAgICBldmVudHMgPSByZXF1aXJlKCcuL2V2ZW50cycpLAogICAgXyA9IHJlcXVpcmUoJy4vdW5kZXJzY29yZScpLl87CgoKLyoqCiAqIFNvbWUgZnVuY3Rpb25zIGNhbGN1bGF0ZSByZXN1bHRzIGRpZmZlcmVudGx5IGRlcGVuZGluZyBvbiB0aGUgZXhlY3V0aW9uCiAqIGVudmlyb25tZW50LiBUaGUgaXNCcm93c2VyIHZhbHVlIGlzIHVzZWQgdG8gc2V0IHRoZSBjb3JyZWN0IGVudmlyb25tZW50CiAqIGZvciB0aGVzZSBmdW5jdGlvbnMsIGFuZCBpcyBvbmx5IGV4cG9ydGVkIHRvIG1ha2UgdW5pdCB0ZXN0aW5nIGVhc2llci4KICovCgpleHBvcnRzLmlzQnJvd3NlciA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnKTsKfTsKCi8qKgogKiBLZWVwcyB0cmFjayBvZiB0aGUgbGFzdCAqdHJpZ2dlcmVkKiByZXF1ZXN0LiBUaGlzIGlzIHRvIGF2b2lkIGEgcmFjZQogKiBjb25kaXRpb24gd2hlcmUgdHdvIGxpbmsgY2xpY2tzIGluIHF1aWNrIHN1Y2Nlc3Npb24gY2FuIGNhdXNlIHRoZSByZW5kZXJlZAogKiBwYWdlIHRvIG5vdCBtYXRjaCB0aGUgY3VycmVudCBVUkwuIElmIHRoZSBmaXJzdCBsaW5rJ3MgZG9jdW1lbnQgb3IgdmlldyB0YWtlcwogKiBsb25nZXIgdG8gcmV0dXJuIHRoYW4gdGhlIHNlY29uZCwgdGhlIFVSTCB3YXMgdXBkYXRlZCBmb3IgdGhlIHNlY29uZCBsaW5rCiAqIGNsaWNrIGJ1dCB0aGUgcGFnZSBmb3IgdGhlIGZpcnN0IGxpbmsgd2lsbCByZW5kZXIgbGFzdCwgb3ZlcndyaXRpbmcgdGhlCiAqIGNvcnJlY3QgcGFnZS4gTm93LCBjYWxsYmFja3MgZm9yIGZldGNoaW5nIGRvY3VtZW50cyBhbmQgdmlld3MgY2hlY2sgYWdhaW5zdAogKiB0aGlzIHZhbHVlIHRvIHNlZSBpZiB0aGV5IHNob3VsZCBjb250aW51ZSByZW5kZXJpbmcgdGhlIHJlc3VsdCBvciBub3QuCiAqLwoKZXhwb3J0cy5jdXJyZW50UmVxdWVzdCA9IGZ1bmN0aW9uICh2KSB7CiAgICBpZiAodikgewogICAgICAgIF9fa2Fuc29qc19jdXJyZW50X3JlcXVlc3QgPSB2OwogICAgfSBlbHNlIGlmICh0eXBlb2YoX19rYW5zb2pzX2N1cnJlbnRfcmVxdWVzdCkgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgX19rYW5zb2pzX2N1cnJlbnRfcmVxdWVzdCA9IG51bGw7CiAgICB9CiAgICByZXR1cm4gX19rYW5zb2pzX2N1cnJlbnRfcmVxdWVzdDsKfTsKCi8vIG1ha2Ugc3VyZSBjdXJyZW50UmVxdWVzdCgpIGFsd2F5cyBwcm92aWRlZCB0aGUgbGF0ZXN0IHNlc3Npb24gaW5mb3JtYXRpb24KZXZlbnRzLm9uKCdzZXNzaW9uQ2hhbmdlJywgZnVuY3Rpb24gKHVzZXJDdHgsIHJlcSkgewogICAgdmFyIGN1cnJfcmVxID0gZXhwb3J0cy5jdXJyZW50UmVxdWVzdCgpOwogICAgaWYgKGN1cnJfcmVxKSB7CiAgICAgICAgY3Vycl9yZXEudXNlckN0eCA9IHVzZXJDdHg7CiAgICAgICAgZXhwb3J0cy5jdXJyZW50UmVxdWVzdChjdXJyX3JlcSk7CiAgICB9Cn0pOwoKLyoqCiAqIFRoaXMgaXMgYmVjYXVzZSB0aGUgZmlyc3QgcGFnZSBoaXQgYWxzbyB0cmlnZ2VycyBrYW5zbyB0byBoYW5kbGUgdGhlIHVybAogKiBjbGllbnQtc2lkZS4gS25vd2luZyBpdCBpcyB0aGUgZmlyc3QgcGFnZSBiZWluZyBsb2FkZWQgbWVhbnMgd2UgY2FuIHN0b3AKICogdGhlIHBhZ2VUcmFja2VyIGNvZGUgZnJvbSBzdWJtaXR0aW5nIHRoZSBVUkwgdHdpY2UuIEV4cG9ydGVkIGJlY2F1c2UgdGhpcwogKiBtaWdodCBiZSB1c2VmdWwgaW5mb3JtYXRpb24gdG8gb3RoZXIgbW9kdWxlcywgaXQgc2hvdWxkIG5vdCBiZSBtb2RpZmllZAogKiBieSB0aGVtLgogKi8KCi8vIFRPRE86IHRoaXMgd2FzIG1vdmVkIHRvIHRoaXMgbW9kdWxlIGZyb20gY29yZS5qcyB0byBhdm9pZCBhIGNpcmN1bGFyCi8vIGRlcGVuZGVuY3kgYmV0d2VlbiBjb3JlLmpzIGFuZCBzZXNzaW9uLmpzCgpleHBvcnRzLmluaXRpYWxfaGl0ID0gdHJ1ZTsKCi8qKgogKiBVc2VkIHRvIHN0b3JlIHVzZXJDdHgsIHBlcmlvZGljYWxseSB1cGRhdGVkIGxpa2Ugb24gc2Vzc2lvbi5sb2dpbiBhbmQKICogc2Vzc2lvbi5sb2dvdXQuCiAqLwoKLy8gVE9ETzogYWRkZWQgdG8gdXRpbHMgdG8gYXZvaWQgY2lyY3VsYXIgZGVwZW5kZW5jeSBidWcgaW4gY291Y2hkYgoKZXhwb3J0cy51c2VyQ3R4ID0gbnVsbDsKCi8qKgogKiBDYWNoZXMgZXh0ZW5kZWQgc2Vzc2lvbiBpbmZvIChsaWtlIHRoZSBjdXJyZW50IGF1dGhlbnRpY2F0aW9uIGRiKSBhZnRlcgogKiBhIGNhbGwgdG8gc2Vzc2lvbi5pbmZvCiAqLwpleHBvcnRzLnNlc3Npb24gPSBudWxsOwoKLyoqCiAqIFRoaXMgaXMgdXNlZCB0byBtYWtlIHVuaXQgdGVzdGluZyBpbiB0aGUgYnJvd3NlciBlYXNpZXIuCiAqIEJlY2F1c2UgaXQgY2FuIGJlIG92ZXJyaWRkZW4gd2l0aG91dCBhY3R1YWxseSBjaGFuZ2luZyB0aGUgd2luZG93J3MgbG9jYXRpb24uCiAqIChhbmQgbmF2aWdhdGluZyBhd2F5IGZyb20gdGhlIHRlc3Qgc3VpdGUpCiAqLwoKZXhwb3J0cy5nZXRXaW5kb3dMb2NhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB3aW5kb3cubG9jYXRpb247Cn07CgovKioKICogUmV0dXJucyB0aGUgcGF0aCB0byBwcmVmaXggdG8gYW55IFVSTHMuIFdoZW4gcnVubmluZyBiZWhpbmQgYQogKiB2aXJ0dWFsIGhvc3QsIHRoZXJlIGlzIG5vdGhpbmcgdG8gcHJlZml4IFVSTHMgd2l0aC4gV2hlbiBhY2Nlc3NpbmcgdGhlCiAqIGFwcCBkaXJlY3RseSwgVVJMcyBuZWVkIHRvIGJlIHByZWZpeGVkIHdpdGggL2RiL19kZXNpZ24vYXBwbmFtZS9fcmV3cml0ZS4KICoKICogVGhlIHJlcXVlc3Qgb2JqZWN0IGFyZ3VtZW50IGlzIG9ubHkgcmVxdWlyZWQgd2hlbiBydW4gc2VydmVyLXNpZGUsIGJ1dCBpdHMKICogYSBnb29kIGlkZWEgdG8gaW5jbHVkZSBpdCB3aGVuZXZlciB5b3UgY2FsbCBnZXRCYXNlVVJMLgogKgogKiBAbmFtZSBnZXRCYXNlVVJMKHJlcSkKICogQHBhcmFtIHtPYmplY3R9IHJlcQogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCi8vIFRPRE86IHRoaXMgd2FzIG1vdmVkIHRvIHRoaXMgbW9kdWxlIGZyb20gY29yZS5qcyB0byBhdm9pZCBhIGNpcmN1bGFyCi8vIGRlcGVuZGVuY3kgYmV0d2VlbiBjb3JlLmpzIGFuZCBkYi5qcyAuLi5vbmNlIGNpcmN1bGFyIGRlcGVuZGVuY2llcyBpbgovLyBjb3VjaGRiJ3MgY29tbW9uanMgaW1wbGVtZW50YXRpb24gYXJlIGZpeGVkIGl0IGNhbiBiZSBtb3ZlZCBiYWNrIGludG8KLy8gY29yZS5qcy4gRm9yIG5vdywgdGhpcyBpcyBhbHNvIGV4cG9ydGVkIGZyb20gY29yZS5qcyBhbmQgc2hvdWxkCi8vIGJlIGFjY2Vzc2VkIGZyb20gdGhlcmUuCgpleHBvcnRzLmdldEJhc2VVUkwgPSBmdW5jdGlvbiAoLypvcHRpb25hbCovcmVxKSB7CiAgICBpZiAoIXJlcSkgewogICAgICAgIHJlcSA9IGV4cG9ydHMuY3VycmVudFJlcXVlc3QoKTsKICAgIH0KICAgIGlmICgnYmFzZVVSTCcgaW4gc2V0dGluZ3MpIHsKICAgICAgICByZXR1cm4gc2V0dGluZ3MuYmFzZVVSTDsKICAgIH0KICAgIGlmIChleHBvcnRzLmlzQnJvd3NlcigpKSB7CiAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgnKC4qXFwvX3Jld3JpdGUpLiokJyk7CiAgICAgICAgdmFyIG1hdGNoID0gcmUuZXhlYyhleHBvcnRzLmdldFdpbmRvd0xvY2F0aW9uKCkucGF0aG5hbWUpOwogICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICByZXR1cm4gbWF0Y2hbMV07CiAgICAgICAgfQogICAgICAgIHJldHVybiAnJzsKICAgIH0KICAgIGlmIChyZXEuaGVhZGVyc1sneC1jb3VjaGRiLXZob3N0LXBhdGgnXSkgewogICAgICAgIHJldHVybiAnJzsKICAgIH0KICAgIHJldHVybiAnLycgKyByZXEucGF0aC5zbGljZSgwLCAzKS5qb2luKCcvJykgKyAnL19yZXdyaXRlJzsKfTsKCi8qKgogKiBBIG5hbWVkIGVtcHR5IGZ1bmN0aW9uLiBVc2UgdGhpcyB3aGVuIHlvdSB3aXNoIHRvIHRha2UKICogbm8gYWN0aW9uIGZvciBhIGNhbGxiYWNrIG9yIHN0cmluZy1nZW5lcmF0aW5nICBmdW5jdGlvbi4KICovCgpleHBvcnRzLmVtcHR5RnVuY3Rpb24gPSBmdW5jdGlvbiAoKQp7CiAgICByZXR1cm4gJyc7Cn07CgovKioKICogQSBuYW1lZCBuby1vcGZ1bmN0aW9uLiBVc2UgdGhpcyB3aGVuIHlvdSBuZWVkIHRvIHN1cHBseQogKiBhIG1hcC90cmFuc2Zvcm0gZnVuY3Rpb24sIGJ1dCBkbyBub3Qgd2lzaCB0byBtb2RpZnkgYW55dGhpbmcKICovCgpleHBvcnRzLmlkZW50aXR5ID0gZnVuY3Rpb24gKHgpCnsKICAgIHJldHVybiB4Owp9OwoKLyoqCiAqIFRyYXZlcnNlcyBhbiBvYmplY3QgYW5kIGl0cyBzdWItb2JqZWN0cyB1c2luZyBhbiBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4KICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIG1hdGNoZWQgcGF0aCwgb3IgdW5kZWZpbmVkIGlmIHRoZSBwcm9wZXJ0eSBkb2VzIG5vdAogKiBleGlzdC4KICoKICogSWYgYSBzdHJpbmcgaWYgdXNlZCBmb3IgdGhlIHBhdGgsIGl0IGlzIGFzc3VtZWQgdG8gYmUgYSBwYXRoIHdpdGggYSBzaW5nbGUKICoga2V5ICh0aGUgZ2l2ZW4gc3RyaW5nKS4KICoKICogPHByZT4KICogZ2V0UHJvcGVydHlQYXRoKHthOiB7YjogJ2Zvbyd9fSwgWydhJywnYiddKSAtPiAnZm9vJwogKiBnZXRQcm9wZXJ0eVBhdGgoe2E6IHtiOiAnZm9vJ319LCAnYScpIC0+IHtiOiAnZm9vJ30KICogPC9wcmU+CiAqCiAqIEBuYW1lIGdldFByb3BlcnR5UGF0aChvYmosIHBhdGgpCiAqIEBwYXJhbSB7T2JqZWN0fSBvYmoKICogQHBhcmFtIHtBcnJheXxTdHJpbmd9IHBhdGgKICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmdldFByb3BlcnR5UGF0aCA9IGZ1bmN0aW9uIChvYmosIHBhdGgpIHsKICAgIGlmICghXy5pc0FycmF5KHBhdGgpKSB7CiAgICAgICAgcGF0aCA9IFtwYXRoXTsKICAgIH0KICAgIGlmICghcGF0aC5sZW5ndGggfHwgIW9iaikgewogICAgICAgIHJldHVybiBvYmo7CiAgICB9CiAgICByZXR1cm4gZXhwb3J0cy5nZXRQcm9wZXJ0eVBhdGgob2JqW3BhdGhbMF1dLCBwYXRoLnNsaWNlKDEpKTsKfTsKCi8qKgogKiBUcmF2ZXJzZXMgYW4gb2JqZWN0IGFuZCBpdHMgc3ViLW9iamVjdHMgdXNpbmcgYW4gYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMuCiAqIFNldHMgdGhlIHZhbHVlIG9mIHRoZSBtYXRjaGVkIHByb3BlcnR5LgogKgogKiBJZiBhIHN0cmluZyBpZiB1c2VkIGZvciB0aGUgcGF0aCwgaXQgaXMgYXNzdW1lZCB0byBiZSBhIHBhdGggd2l0aCBhIHNpbmdsZQogKiBrZXkgKHRoZSBnaXZlbiBzdHJpbmcpLgogKgogKiA8cHJlPgogKiBzZXRQcm9wZXJ0eVBhdGgoe30sIFsnYScsJ2InXSwgJ2ZvbycpIC0+IHthOiB7YjogJ2Zvbyd9fQogKiBzZXRQcm9wZXJ0eVBhdGgoe30sICdhJywgJ2ZvbycpIC0+IHthOiAnZm9vJ30KICogPC9wcmU+CiAqCiAqIEBuYW1lIHNldFByb3BlcnR5UGF0aChvYmosIHBhdGgsIHZhbCkKICogQHBhcmFtIHtPYmplY3R9IG9iagogKiBAcGFyYW0ge0FycmF5fFN0cmluZ30gcGF0aAogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuc2V0UHJvcGVydHlQYXRoID0gZnVuY3Rpb24gKG9iaiwgcGF0aCwgdmFsKSB7CiAgICBpZiAoIV8uaXNBcnJheShwYXRoKSkgewogICAgICAgIHBhdGggPSBbcGF0aF07CiAgICB9CiAgICBpZiAoIXBhdGgubGVuZ3RoKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBwcm9wZXJ0eSBwYXRoIGdpdmVuJyk7CiAgICB9CiAgICBpZiAocGF0aC5sZW5ndGggPT09IDEpIHsKICAgICAgICBvYmpbcGF0aFswXV0gPSB2YWw7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgdmFyIG5leHQgPSBwYXRoWzBdOwogICAgcGF0aCA9IHBhdGguc2xpY2UoMSk7CiAgICBpZiAob2JqW25leHRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICBvYmpbbmV4dF0gPSB7fTsKICAgIH0KICAgIGVsc2UgaWYgKHR5cGVvZiBvYmpbbmV4dF0gIT09ICdvYmplY3QnICYmIHBhdGgubGVuZ3RoKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQcm9wZXJ0eSBwYXRoIGNvbmZsaWN0cyB3aXRoIGV4aXN0aW5nIHZhbHVlJyk7CiAgICB9CiAgICBleHBvcnRzLnNldFByb3BlcnR5UGF0aChvYmpbbmV4dF0sIHBhdGgsIHZhbCk7Cn07CgovKioKICogQ2FsbCBmdW5jdGlvbiB3aXRoIGFyZ3VtZW50cywgY2F0Y2ggYW55IGVycm9ycyBhbmQgYWRkIHRvIGFuIGFycmF5LAogKiByZXR1cm5pbmcgdGhlIG1vZGlmaWVkIGFycmF5LgogKgogKiBAcGFyYW0ge0FycmF5fSBhcnIKICogQHBhcmFtIHtGdW5jdGlvbn0gZm4KICogQHBhcmFtIHtBcnJheX0gYXJncwogKiBAcmV0dXJucyB7QXJyYXl9CiAqIEBhcGkgcHJpdmF0ZQogKi8KCmV4cG9ydHMuZ2V0RXJyb3JzID0gZnVuY3Rpb24gKGZuLCBhcmdzKSB7CiAgICB2YXIgYXJyID0gW107CiAgICB0cnkgewogICAgICAgIGFyciA9IGFyci5jb25jYXQoZm4uYXBwbHkodGhpcywgYXJncykgfHwgW10pOwogICAgfQogICAgY2F0Y2ggKGUpIHsKICAgICAgICBhcnIucHVzaChlKTsKICAgIH0KICAgIHJldHVybiBhcnI7Cn07CgovKioKICogRW5jb2RlcyByZXF1aXJlZCBjaGFyYWN0ZXJzIGFzIEhUTUwgZW50aXRpZXMgc28gYSBzdHJpbmcgY2FuIGJlIGluY2x1ZGVkCiAqIGluIGEgcGFnZS4KICoKICogQG5hbWUgZXNjYXBlSFRNTChzKQogKiBAcGFyYW0ge1N0cmluZ30gcwogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuZXNjYXBlSFRNTCA9IGZ1bmN0aW9uIChzKSB7CiAgICBzID0gJycgKyBzOyAvKiBDb2VyY2UgdG8gc3RyaW5nICovCiAgICBzID0gcy5yZXBsYWNlKC8mL2csICcmYW1wOycpOwogICAgcyA9IHMucmVwbGFjZSgvPC9nLCAnJmx0OycpOwogICAgcyA9IHMucmVwbGFjZSgvPi9nLCAnJmd0OycpOwogICAgcyA9IHMucmVwbGFjZSgvIi9nLCAnJnF1b3Q7Jyk7CiAgICBzID0gcy5yZXBsYWNlKC8nL2csICcmIzM5OycpOwogICAgcmV0dXJuIHM7Cn07CgovKioKICogUGFyc2UgQ1NWIHN0cmluZ3MgaW50byBhbiBhcnJheSBvZiByb3dzLCBlYWNoIHJvdyBhbiBhcnJheSBvZiB2YWx1ZXMuCiAqIFVzZWQgYnkgdGhlIGFycmF5IGZpZWxkJ3MgZGVmYXVsdCBDU1Ygd2lkZ2V0LgogKgogKiBAbmFtZSBwYXJzZUNTVihjc3ZTdHJpbmcpCiAqIEBwYXJhbSB7U3RyaW5nfSBjc3ZTdHJpbmcKICogQHJldHVybnMge0FycmF5fQogKiBAYXBpIHB1YmxpYwogKi8KCi8vIFBhcnNpbmcgY29tbWEtc2VwYXJhdGVkIHZhbHVlcyAoQ1NWKSBpbiBKYXZhU2NyaXB0IGJ5IE0uIEEuIFNSSURIQVIKLy8gaHR0cDovL3lhd2diLmJsb2dzcG90LmNvbS8yMDA5LzAzL3BhcnNpbmctY29tbWEtc2VwYXJhdGVkLXZhbHVlcy1pbi5odG1sCmV4cG9ydHMucGFyc2VDU1YgPSBmdW5jdGlvbiAoY3N2U3RyaW5nKSB7CiAgICB2YXIgZmllbGRFbmRNYXJrZXIgID0gLyhbLFwwMTVcMDEyXSAqKS9nOwogICAgdmFyIHFGaWVsZEVuZE1hcmtlciA9IC8oIiIpKiIoWyxcMDE1XDAxMl0gKikvZzsKICAgIHZhciBzdGFydEluZGV4ID0gMDsKICAgIHZhciByZWNvcmRzID0gW10sIGN1cnJlbnRSZWNvcmQgPSBbXTsKICAgIGRvIHsKICAgICAgICB2YXIgY2ggPSBjc3ZTdHJpbmcuY2hhckF0KHN0YXJ0SW5kZXgpOwogICAgICAgIHZhciBlbmRNYXJrZXJSRSA9IChjaCA9PT0gJyInKSA/IHFGaWVsZEVuZE1hcmtlciA6IGZpZWxkRW5kTWFya2VyOwogICAgICAgIGVuZE1hcmtlclJFLmxhc3RJbmRleCA9IHN0YXJ0SW5kZXg7CiAgICAgICAgdmFyIG1hdGNoQXJyYXkgPSBlbmRNYXJrZXJSRS5leGVjKGNzdlN0cmluZyk7CiAgICAgICAgaWYgKCFtYXRjaEFycmF5IHx8ICFtYXRjaEFycmF5Lmxlbmd0aCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgdmFyIGVuZEluZGV4ID0gZW5kTWFya2VyUkUubGFzdEluZGV4OwogICAgICAgIGVuZEluZGV4IC09IG1hdGNoQXJyYXlbbWF0Y2hBcnJheS5sZW5ndGggLSAxXS5sZW5ndGg7CiAgICAgICAgdmFyIG1hdGNoID0gY3N2U3RyaW5nLnN1YnN0cmluZyhzdGFydEluZGV4LCBlbmRJbmRleCk7CiAgICAgICAgaWYgKG1hdGNoLmNoYXJBdCgwKSA9PT0gJyInKSB7CiAgICAgICAgICAgIG1hdGNoID0gbWF0Y2guc3Vic3RyaW5nKDEsIG1hdGNoLmxlbmd0aCAtIDEpLnJlcGxhY2UoLyIiL2csICciJyk7CiAgICAgICAgfQogICAgICAgIGN1cnJlbnRSZWNvcmQucHVzaChtYXRjaCk7CiAgICAgICAgdmFyIG1hcmtlciA9IG1hdGNoQXJyYXlbMF07CiAgICAgICAgaWYgKG1hcmtlci5pbmRleE9mKCcsJykgPCAwKSB7CiAgICAgICAgICAgIHJlY29yZHMucHVzaChjdXJyZW50UmVjb3JkKTsKICAgICAgICAgICAgY3VycmVudFJlY29yZCA9IFtdOwogICAgICAgIH0KICAgICAgICBzdGFydEluZGV4ID0gZW5kTWFya2VyUkUubGFzdEluZGV4OwogICAgfSB3aGlsZSAodHJ1ZSk7CiAgICBpZiAoc3RhcnRJbmRleCA8IGNzdlN0cmluZy5sZW5ndGgpIHsKICAgICAgICB2YXIgcmVtYWluaW5nID0gY3N2U3RyaW5nLnN1YnN0cmluZyhzdGFydEluZGV4KS50cmltKCk7CiAgICAgICAgaWYgKHJlbWFpbmluZykgewogICAgICAgICAgICBjdXJyZW50UmVjb3JkLnB1c2gocmVtYWluaW5nKTsKICAgICAgICB9CiAgICB9CiAgICBpZiAoY3VycmVudFJlY29yZC5sZW5ndGggPiAwKSB7CiAgICAgICAgcmVjb3Jkcy5wdXNoKGN1cnJlbnRSZWNvcmQpOwogICAgfQogICAgcmV0dXJuIHJlY29yZHM7Cn07CgovKioKICogQ3JlYXRlcyBDb3VjaERCIHJlc3BvbnNlIG9iamVjdCBmb3IgcmV0dXJuaW5nIGZyb20gYSBzaG93LCBsaXN0IG9yIHVwZGF0ZQogKiBmdW5jdGlvbiwgd2hpY2ggcmVkaXJlY3RzIHRvIHRoZSBnaXZlbiBhcHAgdXJsIChhdXRvbWF0aWNhbGx5IHByZXBlbmRpbmcgdGhlCiAqIGJhc2VVUkwpCiAqCiAqIEBuYW1lIHJlZGlyZWN0KHJlcSwgdXJsKQogKiBAcGFyYW0ge09iamVjdH0gcmVxCiAqIEBwYXJhbSB7U3RyaW5nfSB1cmwKICogQHJldHVybnMge09iamVjdH0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnJlZGlyZWN0ID0gZnVuY3Rpb24gKC8qb3B0aW9uYWwqL3JlcSwgdXJsKSB7CiAgICBpZiAoIXVybCkgewogICAgICAgIC8qIEFyaXR5ID0gMTogdXJsIG9ubHkgKi8KICAgICAgICB1cmwgPSByZXE7CiAgICAgICAgcmVxID0gZXhwb3J0cy5jdXJyZW50UmVxdWVzdCgpOwogICAgfQogICAgdmFyIGJhc2VVUkwgPSBleHBvcnRzLmdldEJhc2VVUkwocmVxKTsKICAgIHJldHVybiB7Y29kZTogMzAyLCBoZWFkZXJzOiB7J0xvY2F0aW9uJzogYmFzZVVSTCArIHVybH19Owp9OwoKLyoqCiAqIFRlc3RzIGlmIHBhdGggYiBpcyBlcXVhbCB0byBvciBhIHN1Yi1wYXRoIG9mIGEuCiAqCiAqIEBuYW1lIGlzU3ViUGF0aChhLCBiKQogKiBAcGFyYW0ge0FycmF5fSBhCiAqIEBwYXJhbSB7QXJyYXl9IGIKICogQHJldHVybnMge0Jvb2xlYW59CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5pc1N1YlBhdGggPSBmdW5jdGlvbiAoYSwgYikgewogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGEubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBpZiAoYVtpXSAhPT0gYltpXSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7Cn07CgovKioKICogUmV0dXJuIGEgdGl0bGUtY2FzZSB2ZXJzaW9uIG9mIHRoZSBzdXBwbGllZCBzdHJpbmcuCiAqIEBuYW1lIHRpdGxlaXplKHN0cikKICogQHBhcmFtIHN0ciBUaGUgc3RyaW5nIHRvIHRyYW5zZm9ybS4KICogQHJldHVybnMge1N0cmluZ30KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnRpdGxlaXplID0gZnVuY3Rpb24gKHN0cikgewogICAgcmV0dXJuIChzdHIgfHwgJycpLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvKD86XnxccyspXHcvZywgZnVuY3Rpb24gKG0pIHsKICAgICAgICByZXR1cm4gbS50b1VwcGVyQ2FzZSgpOwogICAgfSk7Cn07CgovKioKICogUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgZXhlY3V0ZXMge2Nsb3N1cmV9IGluIHRoZSBjb250ZXh0IG9mIHtjb250ZXh0fS4KICogVXNlIHRoaXMgZnVuY3Rpb24gaWYgeW91J2QgbGlrZSB0byBwcmVzZXJ2ZSB0aGUgY3VycmVudCBjb250ZXh0CiAqIGFjcm9zcyBjYWxsYmFja3MsIGV2ZW50IGhhbmRsZXJzLCBhbmQgb3RoZXIgY2FzZXMgd2hlcmUgdGhlIHZhbHVlIG9mCiAqIHt0aGlzfSBpcyBzZXQgZm9yIHlvdS4KICoKICogQG5hbWUgYmluZENvbnRleHQoY29udGV4dCwgY2xvc3VyZSkKICogQHBhcmFtIHtPYmplY3R9IGNvbnRleHQgVGhlIGNvbnRleHQgdG8gdXNlIHdoZW4gZXhlY3V0aW5nIGNsb3N1cmUuCiAqICAgICAgICAgIFVzdWFsbHksIHlvdSB3aWxsIHNwZWNpZnkgdGhlIGN1cnJlbnQgdmFsdWUgb2YgJ3RoaXMnLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjbG9zdXJlIFRoZSBmdW5jdGlvbiB0byB0byBiaW5kIHRvIHtjb250ZXh0fS4KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmJpbmRDb250ZXh0ID0gZnVuY3Rpb24gKGNvbnRleHQsIGNsb3N1cmUpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGNsb3N1cmUuYXBwbHkoY29udGV4dCwgYXJndW1lbnRzKTsKICAgIH07Cn07CgoKCn0pfTsKCi8qKioqKioqKioqIGthbnNvL3ZhbGlkYXRvcnMgKioqKioqKioqKi8KCmthbnNvLm1vZHVsZUNhY2hlWyJrYW5zby92YWxpZGF0b3JzIl0gPSB7bG9hZDogKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUpIHsKCi8qKgogKiBWYWxpZGF0aW9uIGZ1bmN0aW9ucyB1c2VkIHRvIHZhbGlkYXRlIEZpZWxkIGNvbnRlbnRzLgogKgogKiBAbW9kdWxlCiAqLwoKdmFyIF8gPSByZXF1aXJlKCcuL3VuZGVyc2NvcmUnKS5fOwoKCi8qKgogKiBUZXN0cyB0aGF0IHRoZSBmaWVsZCdzIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiAnbWluJy4KICoKICogQG5hbWUgbWluKG1pbikKICogQHBhcmFtIHtOdW1iZXJ9IG1pbgogKiBAcmV0dXJucyB7RnVuY3Rpb259CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5taW4gPSBmdW5jdGlvbiAobWluKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKGRvYywgdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPCBtaW4pIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICAgICAgICAgJ1BsZWFzZSBlbnRlciBhIHZhbHVlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byAnICsgbWluCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfTsKfTsKCi8qKgogKiBUZXN0cyB0aGF0IHRoZSBmaWVsZCdzIHZhbHVlIGlzIGxlc3MgdGhhbiAnbWF4JwogKgogKiBAbmFtZSBtYXgobWF4KQogKiBAcGFyYW0ge051bWJlcn0gbWF4CiAqIEByZXR1cm5zIHtGdW5jdGlvbn0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLm1heCA9IGZ1bmN0aW9uIChtYXgpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoZG9jLCB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA+IG1heCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgICAgICAgICAnUGxlYXNlIGVudGVyIGEgdmFsdWUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvICcgKyBtYXgKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9Owp9OwoKLyoqCiAqIFRlc3RzIHRoYXQgdGhlIGZpZWxkJ3MgdmFsdWUgaXMgZ3JlYXRlciB0aGFuICdtaW4nIEFORCBsZXNzIHRoYW4gJ21heCcKICoKICogQG5hbWUgcmFuZ2UobWluLCBtYXgpCiAqIEBwYXJhbSB7TnVtYmVyfSBtaW4KICogQHBhcmFtIHtOdW1iZXJ9IG1heAogKiBAcmV0dXJucyB7RnVuY3Rpb259CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5yYW5nZSA9IGZ1bmN0aW9uIChtaW4sIG1heCkgewogICAgcmV0dXJuIGZ1bmN0aW9uIChkb2MsIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlIDwgbWluIHx8IHZhbHVlID4gbWF4KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgICAgICdQbGVhc2UgZW50ZXIgYSB2YWx1ZSBiZXR3ZWVuICcgKyBtaW4gKyAnIGFuZCAnICsgbWF4CiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfTsKfTsKCi8qKgogKiBUZXN0cyB0aGF0IHRoZSBmaWVsZCdzIHZhbHVlIGxlbmd0aCBpcyBncmVhdGVyIHRoYW4gJ3ZhbCcKICoKICogQG5hbWUgbWlubGVuZ3RoKHZhbCkKICogQHBhcmFtIHtOdW1iZXJ9IHZhbAogKiBAcmV0dXJucyB7RnVuY3Rpb259CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5taW5sZW5ndGggPSBmdW5jdGlvbiAodmFsKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKGRvYywgdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUubGVuZ3RoIDwgdmFsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUGxlYXNlIGVudGVyIGF0IGxlYXN0ICcgKyB2YWwgKyAnIGNoYXJhY3RlcnMnKTsKICAgICAgICB9CiAgICB9Owp9OwoKLyoqCiAqIFRlc3RzIHRoYXQgdGhlIGZpZWxkJ3MgdmFsdWUgbGVuZ3RoIGlzIGxlc3MgdGhhbiAndmFsJwogKgogKiBAbmFtZSBtYXhsZW5ndGgodmFsKQogKiBAcGFyYW0ge051bWJlcn0gdmFsCiAqIEByZXR1cm5zIHtGdW5jdGlvbn0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLm1heGxlbmd0aCA9IGZ1bmN0aW9uICh2YWwpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoZG9jLCB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiB2YWwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQbGVhc2UgZW50ZXIgbm8gbW9yZSB0aGFuICcgKyB2YWwgKyAnIGNoYXJhY3RlcnMnKTsKICAgICAgICB9CiAgICB9Owp9OwoKLyoqCiAqIFRlc3RzIHRoYXQgdGhlIGZpZWxkJ3MgdmFsdWUgbGVuZ3RoIGlzIGdyZWF0ZXIgdGhhbiAnbWluJyBBTkQgbGVzcyB0aGFuICdtYXgnCiAqCiAqIEBuYW1lIHJhbmdlbGVuZ3RoKG1pbiwgbWF4KQogKiBAcGFyYW0ge051bWJlcn0gbWluCiAqIEBwYXJhbSB7TnVtYmVyfSBtYXgKICogQHJldHVybnMge0Z1bmN0aW9ufQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMucmFuZ2VsZW5ndGggPSBmdW5jdGlvbiAobWluLCBtYXgpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoZG9jLCB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPCBtaW4gfHwgdmFsdWUubGVuZ3RoID4gbWF4KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgICAgICdQbGVhc2UgZW50ZXIgYSB2YWx1ZSBiZXR3ZWVuICcgKyBtaW4gKyAnIGFuZCAnICsgbWF4ICsKICAgICAgICAgICAgICAgICcgY2hhcmFjdGVycyBsb25nJwogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH07Cn07CgovKioKICogVGVzdHMgZmllbGQncyB2YWx1ZSBhZ2FpbnN0IGEgcmVndWxhciBleHByZXNzaW9uCiAqCiAqIEBuYW1lIHJlZ2V4cChyZSwgbWVzc2FnZSkKICogQHBhcmFtIHtSZWdFeHB9IHJlIC0gY2FuIGJlIGEgc3RyaW5nIG9yIFJlZ0V4cCBvYmplY3QKICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgLSAob3B0aW9uYWwpIGEgY3VzdG9tIGVycm9yIG1lc3NhZ2UgdG8gdGhyb3cKICogQHJldHVybnMge0Z1bmN0aW9ufQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMucmVnZXhwID0gZnVuY3Rpb24gKHJlLCBtZXNzYWdlKSB7CiAgICByZSA9ICh0eXBlb2YgcmUgPT09ICdzdHJpbmcnKSA/IG5ldyBSZWdFeHAocmUpOiByZTsKICAgIHJldHVybiBmdW5jdGlvbiAoZG9jLCB2YWx1ZSkgewogICAgICAgIGlmICghcmUudGVzdCh2YWx1ZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UgfHwgJ0ludmFsaWQgZm9ybWF0Jyk7CiAgICAgICAgfQogICAgfTsKfTsKCi8qKgogKiBUZXN0cyB0aGF0IGZpZWxkJ3MgdmFsdWUgaXMgYSB2YWxpZCBlbWFpbCBhZGRyZXNzIHVzaW5nIGEgcmVndWxhciBleHByZXNzaW9uLgogKgogKiBAbmFtZSBlbWFpbCgpCiAqIEByZXR1cm5zIHtGdW5jdGlvbn0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmVtYWlsID0gZnVuY3Rpb24gKCkgewogICAgLy8gcmVndWxhciBleHByZXNzaW9uIGJ5IFNjb3R0IEdvbnphbGV6OgogICAgLy8gaHR0cDovL3Byb2plY3RzLnNjb3R0c3BsYXlncm91bmQuY29tL2VtYWlsX2FkZHJlc3NfdmFsaWRhdGlvbi8KICAgIHJldHVybiBleHBvcnRzLnJlZ2V4cChuZXcgUmVnRXhwKCJeKCgoW2Etel18XFxkfFshI1xcJCUmJ1xcKlxcK1xcLVxcLz1cXD9cXF5fYHtcXHx9fl18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKyhcXC4oW2Etel18XFxkfFshI1xcJCUmJ1xcKlxcK1xcLVxcLz1cXD9cXF5fYHtcXHx9fl18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKykqKXwoKFxceDIyKSgoKChcXHgyMHxcXHgwOSkqKFxceDBkXFx4MGEpKT8oXFx4MjB8XFx4MDkpKyk/KChbXFx4MDEtXFx4MDhcXHgwYlxceDBjXFx4MGUtXFx4MWZcXHg3Zl18XFx4MjF8W1xceDIzLVxceDViXXxbXFx4NWQtXFx4N2VdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoXFxcXChbXFx4MDEtXFx4MDlcXHgwYlxceDBjXFx4MGQtXFx4N2ZdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSkpKSooKChcXHgyMHxcXHgwOSkqKFxceDBkXFx4MGEpKT8oXFx4MjB8XFx4MDkpKyk/KFxceDIyKSkpQCgoKFthLXpdfFxcZHxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KChbYS16XXxcXGR8W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKihbYS16XXxcXGR8W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKSlcXC4pKygoW2Etel18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCgoW2Etel18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKihbYS16XXxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkpKVxcLj8kIiwgImkiKSwgJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsIGFkZHJlc3MnKTsKfTsKCi8qKgogKiBUZXN0cyB0aGF0IGZpZWxkJ3MgdmFsdWUgaXMgYSB2YWxpZCBVUkwgdXNpbmcgYSByZWd1bGFyIGV4cHJlc3Npb24uCiAqCiAqIEBuYW1lIHVybCgpCiAqIEByZXR1cm5zIHtGdW5jdGlvbn0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnVybCA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIHJlZ3VsYXIgZXhwcmVzc2lvbiBieSBTY290dCBHb256YWxlejoKICAgIC8vIGh0dHA6Ly9wcm9qZWN0cy5zY290dHNwbGF5Z3JvdW5kLmNvbS9pcmkvCiAgICByZXR1cm4gZXhwb3J0cy5yZWdleHAobmV3IFJlZ0V4cCgiXihodHRwcz98ZnRwKTpcXC9cXC8oKCgoW2Etel18XFxkfC18XFwufF98fnxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KCVbXFxkYS1mXXsyfSl8WyFcXCQmJ1xcKFxcKVxcKlxcKyw7PV18OikqQCk/KCgoXFxkfFsxLTldXFxkfDFcXGRcXGR8MlswLTRdXFxkfDI1WzAtNV0pXFwuKFxcZHxbMS05XVxcZHwxXFxkXFxkfDJbMC00XVxcZHwyNVswLTVdKVxcLihcXGR8WzEtOV1cXGR8MVxcZFxcZHwyWzAtNF1cXGR8MjVbMC01XSlcXC4oXFxkfFsxLTldXFxkfDFcXGRcXGR8MlswLTRdXFxkfDI1WzAtNV0pKXwoKChbYS16XXxcXGR8W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCgoW2Etel18XFxkfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKShbYS16XXxcXGR8LXxcXC58X3x+fFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSooW2Etel18XFxkfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSkpXFwuKSsoKFthLXpdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoKFthLXpdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKShbYS16XXxcXGR8LXxcXC58X3x+fFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSooW2Etel18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKSlcXC4/KSg6XFxkKik/KShcXC8oKChbYS16XXxcXGR8LXxcXC58X3x+fFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoJVtcXGRhLWZdezJ9KXxbIVxcJCYnXFwoXFwpXFwqXFwrLDs9XXw6fEApKyhcXC8oKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCglW1xcZGEtZl17Mn0pfFshXFwkJidcXChcXClcXCpcXCssOz1dfDp8QCkqKSopPyk/KFxcPygoKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCglW1xcZGEtZl17Mn0pfFshXFwkJidcXChcXClcXCpcXCssOz1dfDp8QCl8W1xcdUUwMDAtXFx1RjhGRl18XFwvfFxcPykqKT8oXFwjKCgoW2Etel18XFxkfC18XFwufF98fnxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KCVbXFxkYS1mXXsyfSl8WyFcXCQmJ1xcKFxcKVxcKlxcKyw7PV18OnxAKXxcXC98XFw/KSopPyQiLCAiaSIpLCAnUGxlYXNlIGVudGVyIGEgdmFsaWQgVVJMJyk7Cn07CgovKioKICogRGV0ZWN0cyBlbWJlZGRlZCBkb2N1bWVudHMgd2l0aCBtaXNzaW5nIF9pZCBwcm9wZXJ0aWVzIGFuZCByZXR1cm5zIGFuCiAqIGFycmF5IG9mIEVycm9yIG9iamVjdHMgZm9yIGVhY2ggb2NjdXJlbmNlLiBSZXR1cm5zIGFuIGVtcHR5IGFycmF5IGlmCiAqIGFsbCBkb2N1bWVudHMgaGF2ZSBhIHBvcHVsYXRlZCBfaWQgcHJvcGVydHkuCiAqCiAqIFVzZWQgYnkgdGhlIEVtYmVkZGVkTGlzdCBmaWVsZCB0eXBlLgogKgogKiBAbmFtZSBtaXNzaW5nSURzKCkKICogQHBhcmFtIHtPYmplY3R9IGRvYwogKiBAcGFyYW0ge0FycmF5fSB2YWx1ZQogKiBAcmV0dXJucyB7QXJyYXl9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5taXNzaW5nSURzID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGZ1bmN0aW9uIChkb2MsIHZhbHVlKSB7CiAgICAgICAgdmFyIGVycnMgPSBbXTsKICAgICAgICBfLmVhY2godmFsdWUsIGZ1bmN0aW9uICh2LCBpKSB7CiAgICAgICAgICAgIGlmICghdi5faWQpIHsKICAgICAgICAgICAgICAgIHZhciBlID0gbmV3IEVycm9yKCdFbWJlZGRlZCBkb2N1bWVudCBtaXNzaW5nIF9pZCcpOwogICAgICAgICAgICAgICAgZS5maWVsZCA9IFtpXTsKICAgICAgICAgICAgICAgIGVycnMucHVzaChlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBlcnJzOwogICAgfTsKfTsKCgoKfSl9OwoKLyoqKioqKioqKioga2Fuc28vd2lkZ2V0cyAqKioqKioqKioqLwoKa2Fuc28ubW9kdWxlQ2FjaGVbImthbnNvL3dpZGdldHMiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKLypnbG9iYWwgJDogZmFsc2UsIGthbnNvOiB0cnVlKi8KCi8qKgogKiBXaWRnZXRzIGRlZmluZSB0aGUgd2F5IGEgRmllbGQgb2JqZWN0IGlzIGRpc3BsYXllZCB3aGVuIHJlbmRlcmVkIGFzIHBhcnQgb2YgYQogKiBGb3JtLiBDaGFuZ2luZyBhIEZpZWxkJ3Mgd2lkZ2V0IHdpbGwgYmUgcmVmbGVjdGVkIGluIHRoZSBhZG1pbiBhcHAuCiAqCiAqIEBtb2R1bGUKICovCgovKioKICogTW9kdWxlIGRlcGVuZGVuY2llcwogKi8KCnZhciBkYiA9IHJlcXVpcmUoJy4vZGInKSwKICAgIGZvcm1zID0gcmVxdWlyZSgnLi9mb3JtcycpLAogICAgYWN0aW9ucyA9IHJlcXVpcmUoJy4vYWN0aW9ucycpLAogICAgcmVuZGVyID0gcmVxdWlyZSgnLi9yZW5kZXInKSwKICAgIHNhbml0aXplID0gcmVxdWlyZSgnLi9zYW5pdGl6ZScpLAogICAgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyksCiAgICBldmVudHMgPSByZXF1aXJlKCcuL2V2ZW50cycpLAogICAgcXVlcnlzdHJpbmcgPSByZXF1aXJlKCcuL3F1ZXJ5c3RyaW5nJyksCiAgICBfID0gcmVxdWlyZSgnLi91bmRlcnNjb3JlJykuXzsKCnZhciBoID0gc2FuaXRpemUuZXNjYXBlSHRtbDsKCgovKioKICogV2lkZ2V0IGNvbnN0cnVjdG9yLCBjcmVhdGVzIGEgbmV3IFdpZGdldCBvYmplY3QuCiAqCiAqIEBuYW1lIFdpZGdldCh0eXBlLCBbb3B0aW9uc10pCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAqIEBjb25zdHJ1Y3RvcgogKiBAcmV0dXJucyB7V2lkZ2V0IE9iamVjdH0KICogQGFwaSBwdWJsaWMKICovCgp2YXIgV2lkZ2V0ID0gZXhwb3J0cy5XaWRnZXQgPSBmdW5jdGlvbiBXaWRnZXQodHlwZSwgb3B0aW9ucykgewogICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KTsKICAgIHRoaXMuY2xhc3NlcyA9IChvcHRpb25zLmNsYXNzZXMgfHwgW10pOwogICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQ7CiAgICB0aGlzLnR5cGUgPSB0eXBlOwp9OwoKLyoqCiAqIEdlbmVyYXRlcyBhbiBpZCBzdHJpbmcgZm9yIGEgd2lkZ2V0LgogKgogKiBAcGFyYW0ge1N0cmluZ30gbmFtZSAtIGZpZWxkIG5hbWUgb24gdGhlIEhUTUwgZm9ybQogKiBAcGFyYW0ge1N0cmluZ30gZXh0ZW5zaW9uIC0gb3B0aW9uYWw7IGEgc3RyaW5nIHRvIGJlIGFkZGVkCiAqICAgICAgICAgICAgICAgICAgdG8gdGhlIGdlbmVyYXRlZCBpZGVudGlmaWVyLiBVc2UgdGhpcyB3aGVuIHlvdQogKiAgICAgICAgICAgICAgICAgIHdhbnQgdG8gbWFrZSBhbiBpZGVudGlmaWVyIHRoYXQgaXMgcmVsYXRlZCB0bwogKiAgICAgICAgICAgICAgICAgIGFuIGV4aXN0aW5nIGlkZW50aWZpZXIsIGJ1dCBpcyBzdGlsbCB1bmlxdWUuCiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqLwoKV2lkZ2V0LnByb3RvdHlwZS5faWQgPSBmdW5jdGlvbiAobmFtZSAvKiAsIC4uLiAqLykgewogICAgcmV0dXJuIHNhbml0aXplLmdlbmVyYXRlRG9tSWRlbnRpZmllci5hcHBseSgKICAgICAgICB0aGlzLCBbIHRoaXMuaWQgfHwgbmFtZSBdLmNvbmNhdCgKICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKQogICAgICAgICkKICAgICk7Cn07CgovKioKICogR2VuZXJhdGVzIGEgbmFtZSBzdHJpbmcgZm9yIGEgd2lkZ2V0LgogKgogKiBAcGFyYW0ge1N0cmluZ30gbmFtZSAtIGZpZWxkIG5hbWUgb24gdGhlIEhUTUwgZm9ybQogKiBAcGFyYW0ge1N0cmluZ30gZXh0ZW5zaW9uIC0gb3B0aW9uYWw7IGEgc3RyaW5nIHRvIGJlIGFkZGVkCiAqICAgICAgICAgICAgICAgICAgdG8gdGhlIGdlbmVyYXRlZCBpZGVudGlmaWVyLiBVc2UgdGhpcyB3aGVuIHlvdQogKiAgICAgICAgICAgICAgICAgIHdhbnQgdG8gbWFrZSBhbiBpZGVudGlmaWVyIHRoYXQgaXMgcmVsYXRlZCB0bwogKiAgICAgICAgICAgICAgICAgIGFuIGV4aXN0aW5nIGlkZW50aWZpZXIsIGJ1dCBpcyBzdGlsbCB1bmlxdWUuCiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqLwoKV2lkZ2V0LnByb3RvdHlwZS5fbmFtZSA9IGZ1bmN0aW9uIChuYW1lIC8qICwgLi4uICovKSB7CiAgICByZXR1cm4gc2FuaXRpemUuZ2VuZXJhdGVEb21OYW1lLmFwcGx5KAogICAgICAgIHRoaXMsIFsgbmFtZSBdLmNvbmNhdCgKICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKQogICAgICAgICkKICAgICk7Cn07CgovKioKICogQ29udmVydHMgYW4gaW5wdXQgZWxlbWVudCdzIHZhbHVlIGF0dHJpYnV0ZSB0byBhIHZhbGlkCiAqIGluLW1lbW9yeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgZG9jdW1lbnQgb3IgZG9jdW1lbnQgZnJhZ21lbnQuCiAqIFRoaXMgZnVuY3Rpb24gdHJpZXMgdG8gaW50ZXJwcmV0IHRoZSBzdHJpbmcgYXMgSlNPTiBpZiBpdCdzCiAqIGFwcHJvcHJpYXRlOyBvdGhlcndpc2UgdGhlIHN0cmluZyBpcyBsZWZ0IGFsb25lLgogKgogKiBAbmFtZSBfcGFyc2VfdmFsdWUoc3RyLCB0eXBlX25hbWUpCiAqIEBwYXJhbSB7U3RyaW5nfSBzdHIgVGhlIHN0cmluZyB2YWx1ZSB0byBwYXJzZQogKiBAcGFyYW0ge1N0cmluZ30gdHlwZV9uYW1lIFRoZSB0eXBlIG9mIGZpZWxkIHRoYXQgdGhlIGlucHV0IGNvbnRyb2wKICogICAgICAgICAgYmVsb25ncyB0by4gVGhpcyB2YWx1ZSBtYXkgaW5mbHVlbmNlIGhvdyBzdHIgaXMgcGFyc2VkLgogKiBAcmV0dXJucyB7T2JqZWN0fQogKi8KCldpZGdldC5wcm90b3R5cGUuX3BhcnNlX3ZhbHVlID0gZnVuY3Rpb24gKHN0ciwgdHlwZV9uYW1lKQp7CiAgICAvKiBUT0RPOgogICAgICAgIFRoaXMgZnVuY3Rpb24gbmVlZHMgdG8gYWN0dWFsbHkgY2hlY2sgdHlwZV9uYW1lLiAqLwoKICAgIHZhciBydiA9IG51bGw7CgogICAgdHJ5IHsKICAgICAgICBydiA9IEpTT04ucGFyc2Uoc3RyKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBydiA9IHN0cjsKICAgIH0KCiAgICByZXR1cm4gcnY7Cn07CgovKioKICogQ29udmVydHMgYW4gaW4tbWVtb3J5IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBkb2N1bWVudCBvcgogKiBkb2N1bWVudCBmcmFnbWVudCBpbiB0byBhbiBlbmNvZGVkIHN0cmluZy4gSWYgdGhlIHZhbHVlCiAqIHBhc3NlZCBpcyBhbHJlYWR5IGVuY29kZWQsIHRoaXMgZnVuY3Rpb24gZG9lcyBub3RoaW5nLgogKgogKiBAbmFtZSBfc3RyaW5naWZ5X3ZhbHVlKHN0ciwgdHlwZV9uYW1lKQogKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgVGhlIHZhbHVlIHRvIGVuY29kZS4KICogQHBhcmFtIHtTdHJpbmd9IHR5cGVfbmFtZSBUaGUgdHlwZSBvZiBmaWVsZCB0aGF0IHRoZSBpbnB1dCBjb250cm9sCiAqICAgICAgICAgIGJlbG9uZ3MgdG8uIFRoaXMgdmFsdWUgbWF5IGluZmx1ZW5jZSBob3cgdmFsdWUgaXMgZW5jb2RlZC4KICogQHJldHVybnMge09iamVjdH0KICovCgpXaWRnZXQucHJvdG90eXBlLl9zdHJpbmdpZnlfdmFsdWUgPSBmdW5jdGlvbiAodmFsdWUsIHR5cGVfbmFtZSkKewogICAgLyogVE9ETzoKICAgICAgICBUaGlzIGZ1bmN0aW9uIG5lZWRzIHRvIGFjdHVhbGx5IGNoZWNrIHR5cGVfbmFtZS4gKi8KCiAgICB2YXIgcnYgPSBudWxsOwoKICAgIHRyeSB7CiAgICAgICAgcnYgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcnYgPSB2YWx1ZTsKICAgIH0KCiAgICByZXR1cm4gcnY7Cn07CgovKioKICogQ29udmVydHMgYSB3aWRnZXQgdG8gSFRNTCB1c2luZyB0aGUgcHJvdmlkZWQgbmFtZSBhbmQgcGFyc2VkIGFuZCByYXcgdmFsdWVzCiAqCiAqIEBuYW1lIFdpZGdldC50b0hUTUwobmFtZSwgdmFsdWUsIHJhdywgZmllbGQsIG9wdGlvbnMpCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAqIEBwYXJhbSB2YWx1ZQogKiBAcGFyYW0gcmF3CiAqIEBwYXJhbSBmaWVsZAogKiBAcGFyYW0gb3B0aW9ucwogKiBAcmV0dXJucyB7U3RyaW5nfQogKiBAYXBpIHB1YmxpYwogKi8KCldpZGdldC5wcm90b3R5cGUudG9IVE1MID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlLCByYXcsIGZpZWxkLCBvcHRpb25zKSB7CiAgICBpZiAocmF3ID09PSB1bmRlZmluZWQpIHsKICAgICAgICByYXcgPSAodmFsdWUgPT09IHVuZGVmaW5lZCkgPyAnJzogJycgKyB2YWx1ZTsKICAgIH0KICAgIGlmIChyYXcgPT09IG51bGwgfHwgcmF3ID09PSB1bmRlZmluZWQpIHsKICAgICAgICByYXcgPSAnJzsKICAgIH0KICAgIHZhciBodG1sID0gJzxpbnB1dCc7CiAgICBodG1sICs9ICh0aGlzLnR5cGUgPyAnIHR5cGU9IicgKyBoKHRoaXMudHlwZSkgKyAnIic6ICcnKTsKICAgIGh0bWwgKz0gJyB2YWx1ZT0iJyArIGgocmF3KSArICciJzsKICAgIGh0bWwgKz0gJyBuYW1lPSInICsgdGhpcy5fbmFtZShuYW1lLCBvcHRpb25zLm9mZnNldCkgKyAnIiBpZD0iJzsKICAgIGh0bWwgKz0gdGhpcy5faWQobmFtZSwgb3B0aW9ucy5vZmZzZXQsIG9wdGlvbnMucGF0aF9leHRyYSkgKyAnIic7CiAgICByZXR1cm4gaHRtbCArICcgLz4nOwp9OwoKLyoqCiAqIEluaXRpYWxpemVzIGEgd2lkZ2V0IG9uIHRoZSBjbGllbnQtc2lkZSBvbmx5LCB1c2luZyB0aGUgYnJvd3NlcidzCiAqIHNjcmlwdCBpbnRlcnByZXRlci4gVGhpcyBmdW5jdGlvbiBpcyBndWFyYW50ZWVkIHRvIGJlIGNhbGxlZAogKiBhZnRlciB0b0hUTUwsIGFuZCBhbnkgRE9NIGVsZW1lbnRzIGNyZWF0ZWQgYnkgdG9IVE1MIGFyZQogKiBndWFyYW50ZWVkIHRvIGJlIGFjY2Vzc2libGUKICoKICogQG5hbWUgV2lkZ2V0LmNsaWVudEluaXQocGF0aCwgdmFsdWUsIHJhdywgZmllbGQsIG9wdGlvbnMpCiAqIEBwYXJhbSB7QXJyYXl9IHBhdGgKICogQHBhcmFtIHZhbHVlCiAqIEBwYXJhbSByYXcKICogQHBhcmFtIGZpZWxkCiAqIEBwYXJhbSBvcHRpb25zCiAqIEByZXR1cm5zIHtCb29sZWFufQogKiBAYXBpIHB1YmxpYwogKi8KCldpZGdldC5wcm90b3R5cGUuY2xpZW50SW5pdCA9IGZ1bmN0aW9uIChwYXRoLCB2YWx1ZSwgcmF3LCBmaWVsZCwgb3B0aW9ucykgewogICAgcmV0dXJuIHRydWU7Cn07CgovKioKICogQ2FsbGVkIGJ5IEthbnNvIHdoZW4gaXQgYmVjb21lcyBuZWNlc3NhcnkgdG8gcmVuYW1lIHRoaXMgd2lkZ2V0CiAqIGluc3RhbmNlLiBUaGUgd2lkZ2V0IHNob3VsZCByZXNwb25kIGJ5IHVwZGF0aW5nIHRoZSBpZCBhbmQgbmFtZQogKiBhdHRyaWJ1dGVzLgogKgogKiBAbmFtZSBXaWRnZXQudXBkYXRlTmFtZShwYXRoKQogKiBAcGFyYW0ge1N0cmluZ30gZWx0IEFuIGVsZW1lbnQgdGhhdCBjb250YWlucyBvbmUgb3IKICogICAgICAgICAgbW9yZSBpbnN0YW5jZXMgb2YgdGhlIHdpZGdldCByZWZlcmVuY2VkIGJ5IGB0aGlzJy4KICogQHBhcmFtIHtTdHJpbmd9IHBhdGggVGhlIHdpZGdldCdzIG5ldyBwYXRoOyBjb21iaW5lIHRoaXMgdXNpbmcKICogICAgICAgICAgdGhlIF9uYW1lIG9yIF9pZCBmdW5jdGlvbiB0byBnZW5lcmF0ZSBhIHVzYWJsZSBzdHJpbmcuCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIEEgbmV3IHNldCBvZiB0b0hUTUwvY2xpZW50SW5pdCBvcHRpb25zLgogKiAgICAgICAgICBUaGlzIG1heSBvciBtYXkgbm90IGluZmx1ZW5jZSB0aGUgd2lkZ2V0J3MgbmFtZS4KICogQGFwaSBwdWJsaWMKICovCgpXaWRnZXQucHJvdG90eXBlLnVwZGF0ZU5hbWUgPSBmdW5jdGlvbiAoZWx0LCBwYXRoLCBvcHRpb25zKSB7CiAgICB2YXIgZSA9ICQoJ2lucHV0W3R5cGU9aGlkZGVuXScsIGVsdCk7CiAgICBlLmF0dHIoJ2lkJywgdGhpcy5faWQocGF0aCwgb3B0aW9ucy5vZmZzZXQsIG9wdGlvbnMucGF0aF9leHRyYSkpOwogICAgZS5hdHRyKCduYW1lJywgdGhpcy5fbmFtZShwYXRoLCBvcHRpb25zLm9mZnNldCwgb3B0aW9ucy5wYXRoX2V4dHJhKSk7Cn07CgovKioKICogQ2FsbGVkIGJ5IEthbnNvIHdoZW4gaXQgYmVjb21lcyBuZWNlc3NhcnkgdG8gcmVuYW1lIHRoaXMgd2lkZ2V0CiAqIGluc3RhbmNlLiBUaGUgd2lkZ2V0IHNob3VsZCByZXNwb25kIGJ5IHVwZGF0aW5nIHRoZSB2YWx1ZSBhdHRyaWJ1dGUuCiAqCiAqIEBuYW1lIFdpZGdldC51cGRhdGVWYWx1ZShlbHQsIHBhdGgsIHZhbHVlLCBvcHRpb25zKQogKiBAcGFyYW0ge1N0cmluZ30gZWx0IEFuIGVsZW1lbnQgdGhhdCBjb250YWlucyBvbmUgb3IKICogICAgICAgICAgbW9yZSBpbnN0YW5jZXMgb2YgdGhlIHdpZGdldCByZWZlcmVuY2VkIGJ5IGB0aGlzJy4KICogQHBhcmFtIHtTdHJpbmd9IHBhdGggVGhlIHBhdGggdG8gdGhlIHdpZGdldC4KICogQHBhcmFtIHtPYmplY3R9IHZhbHVlIFRoZSBuZXcgdmFsdWUgZm9yIHRoZSB3aWRnZXQsIHVuZW5jb2RlZC4KICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgQW4gdXAtdG8tZGF0ZSBzZXQgb2YgdG9IVE1ML2NsaWVudEluaXQgb3B0aW9ucy4KICogQGFwaSBwdWJsaWMKICovCgpXaWRnZXQucHJvdG90eXBlLnVwZGF0ZVZhbHVlID0gZnVuY3Rpb24gKGVsdCwgcGF0aCwgdmFsdWUsIG9wdGlvbnMpIHsKICAgIGVsdCA9ICQoZWx0KS5jbG9zZXN0Q2hpbGQoJ2lucHV0W3R5cGU9aGlkZGVuXScpOwogICAgZWx0LnZhbCh0aGlzLl9zdHJpbmdpZnlfdmFsdWUodmFsdWUpKTsKfTsKCi8qKgogKiBDYWxsZWQgYnkgS2Fuc28gd2hlbiBpdCBiZWNvbWVzIG5lY2Vzc2FyeSB0byBpbnRlcnJvZ2F0ZSB0aGlzCiAqIHdpZGdldCB0byBkZXRlcm1pbmUgaXRzIHZhbHVlLiBUaGUgd2lkZ2V0IHNob3VsZCByZXNwb25kIGJ5CiAqIHJldHVybmluZyBhbiB1bmVuY29kZWQgdmFsdWUgKHR5cGljYWxseSBhcyBhbiBvYmplY3QpLgogKgogKiBAbmFtZSBXaWRnZXQuZ2V0VmFsdWUoZWx0LCBwYXRoLCBvcHRpb25zKQogKiBAcGFyYW0ge1N0cmluZ30gZWx0IEFuIGVsZW1lbnQgdGhhdCBjb250YWlucyBvbmUgb3IKICogICAgICAgICAgbW9yZSBpbnN0YW5jZXMgb2YgdGhlIHdpZGdldCByZWZlcmVuY2VkIGJ5IGB0aGlzJy4KICogQHBhcmFtIHtTdHJpbmd9IHBhdGggVGhlIHBhdGggdG8gdGhlIHdpZGdldC4KICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgQW4gdXAtdG8tZGF0ZSBzZXQgb2YgdG9IVE1ML2NsaWVudEluaXQgb3B0aW9ucy4KICogQGFwaSBwdWJsaWMKICovCgpXaWRnZXQucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKGVsdCwgcGF0aCwgb3B0aW9ucykgewogICAgcmV0dXJuIHRoaXMuX3BhcnNlX3ZhbHVlKAogICAgICAgICQoZWx0KS5jbG9zZXN0Q2hpbGQoJ2lucHV0W3R5cGU9aGlkZGVuXScpLnZhbCgpCiAgICApOwp9OwoKLyoqCiAqIENhbGxlZCBieSBLYW5zbyB3aGVuIGl0IGJlY29tZXMgbmVjZXNzYXJ5IHRvIHZhbGlkYXRlIHRoZQogKiBjb250ZW50cyBvZiB0aGlzIHdpZGdldCAtLSBpLmUuIHRvIGVuc3VyZSBpdCdzIGluIGEgY29uc2lzdGVudAogKiBzdGF0ZSBiZWZvcmUgdXNpbmcgaXRzIHZhbHVlIG9yIHByb2NlZWRpbmcuIE1vc3Qgd2lkZ2V0cyB3aWxsCiAqIG5vdCBpbXBsZW1lbnQgdGhpcyBtZXRob2Q7IGl0cyBwcmltYXJ5IHVzZSBpcyBjb21wbGV4IHdpZGdldHMKICogdGhhdCBob3N0IHZhbGlkYXRpb24tZW5hYmxlZCBmb3JtcyBhbmQvb3IgdHlwZXMuIFJldHVybnMgdHJ1ZQogKiBpZiB0aGUgY29udGVudHMgaXMgY29uc2lzdGVudCBhbmQgdmFsaWQ7IGZhbHNlIG90aGVyd2lzZS4KICoKICogQG5hbWUgV2lkZ2V0LnZhbGlkYXRlKGVsdCwgcGF0aCwgb3B0aW9ucykKICogQHBhcmFtIHtTdHJpbmd9IGVsdCBBbiBlbGVtZW50IHRoYXQgY29udGFpbnMgb25lIG9yCiAqICAgICAgICAgIG1vcmUgaW5zdGFuY2VzIG9mIHRoZSB3aWRnZXQgcmVmZXJlbmNlZCBieSBgdGhpcycuCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoIFRoZSBwYXRoIHRvIHRoZSB3aWRnZXQuCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIEFuIHVwLXRvLWRhdGUgc2V0IG9mIHRvSFRNTC9jbGllbnRJbml0IG9wdGlvbnMuCiAqIEBhcGkgcHVibGljCiAqLwoKV2lkZ2V0LnByb3RvdHlwZS52YWxpZGF0ZSA9IGZ1bmN0aW9uIChlbHQsIHBhdGgsIG9wdGlvbnMpIHsKICAgIHJldHVybiB0cnVlOwp9OwoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgdGV4dCBpbnB1dCB3aWRnZXQuCiAqCiAqIEBuYW1lIHRleHQoW29wdGlvbnNdKQogKiBAcGFyYW0gb3B0aW9ucwogKiBAcmV0dXJucyB7V2lkZ2V0IE9iamVjdH0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnRleHQgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgcmV0dXJuIG5ldyBXaWRnZXQoJ3RleHQnLCBvcHRpb25zKTsKfTsKCi8qKgogKiBDcmVhdGVzIGEgbmV3IHBhc3N3b3JkIGlucHV0IHdpZGdldC4KICoKICogQG5hbWUgcGFzc3dvcmQoW29wdGlvbnNdKQogKiBAcGFyYW0gb3B0aW9ucwogKiBAcmV0dXJucyB7V2lkZ2V0IE9iamVjdH0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLnBhc3N3b3JkID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIHJldHVybiBuZXcgV2lkZ2V0KCdwYXNzd29yZCcsIG9wdGlvbnMpOwp9OwoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgaGlkZGVuIGlucHV0IHdpZGdldC4KICoKICogQG5hbWUgaGlkZGVuKFtvcHRpb25zXSkKICogQHBhcmFtIG9wdGlvbnMKICogQHJldHVybnMge1dpZGdldCBPYmplY3R9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5oaWRkZW4gPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgcmV0dXJuIG5ldyBXaWRnZXQoJ2hpZGRlbicsIG9wdGlvbnMpOwp9OwoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgdGV4dGFyZWEgd2lkZ2V0LgogKgogKiBAbmFtZSB0ZXh0YXJlYShbb3B0aW9uc10pCiAqIEBwYXJhbSBvcHRpb25zCiAqIEByZXR1cm5zIHtXaWRnZXQgT2JqZWN0fQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMudGV4dGFyZWEgPSBmdW5jdGlvbiAoX29wdGlvbnMpIHsKICAgIHZhciB3ID0gbmV3IFdpZGdldCgndGV4dGFyZWEnLCBfb3B0aW9ucyB8fCB7fSk7CiAgICB3Lm9wdGlvbnMgPSBfb3B0aW9uczsKICAgIHcudG9IVE1MID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlLCByYXcsIGZpZWxkLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKHJhdyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJhdyA9ICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSA/ICcnOiAnJyArIHZhbHVlOwogICAgICAgIH0KICAgICAgICBpZiAocmF3ID09PSBudWxsIHx8IHJhdyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJhdyA9ICcnOwogICAgICAgIH0KICAgICAgICB2YXIgaHRtbCA9ICc8dGV4dGFyZWEnOwogICAgICAgIGh0bWwgKz0gJyBuYW1lPSInICsgdGhpcy5fbmFtZShuYW1lLCBvcHRpb25zLm9mZnNldCkgKyAnIiBpZD0iJzsKICAgICAgICBodG1sICs9IHRoaXMuX2lkKG5hbWUsIG9wdGlvbnMub2Zmc2V0LCBvcHRpb25zLnBhdGhfZXh0cmEpICsgJyInOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhhc093blByb3BlcnR5KCdjb2xzJykpIHsKICAgICAgICAgICAgaHRtbCArPSAnIGNvbHM9IicgKyBoKHRoaXMub3B0aW9ucy5jb2xzKSArICciJzsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgncm93cycpKSB7CiAgICAgICAgICAgIGh0bWwgKz0gJyByb3dzPSInICsgaCh0aGlzLm9wdGlvbnMucm93cykgKyAnIic7CiAgICAgICAgfQogICAgICAgIGh0bWwgKz0gJz4nICsgaChyYXcpOwogICAgICAgIGh0bWwgKz0gJzwvdGV4dGFyZWE+JzsKICAgICAgICByZXR1cm4gaHRtbDsKICAgIH07CiAgICByZXR1cm4gdzsKfTsKCi8qKgogKiBDcmVhdGVzIGEgbmV3IGNoZWNrYm94IHdpZGdldC4KICoKICogQG5hbWUgY2hlY2tib3goW29wdGlvbnNdKQogKiBAcGFyYW0gb3B0aW9ucwogKiBAcmV0dXJucyB7V2lkZ2V0IE9iamVjdH0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmNoZWNrYm94ID0gZnVuY3Rpb24gKF9vcHRpb25zKSB7CiAgICB2YXIgdyA9IG5ldyBXaWRnZXQoJ2NoZWNrYm94JywgX29wdGlvbnMgfHwge30pOwogICAgdy50b0hUTUwgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUsIHJhdywgZmllbGQsIG9wdGlvbnMpIHsKICAgICAgICB2YXIgaHRtbCA9ICc8aW5wdXQgdHlwZT0iY2hlY2tib3giJzsKICAgICAgICBodG1sICs9ICcgbmFtZT0iJyArIHRoaXMuX25hbWUobmFtZSwgb3B0aW9ucy5vZmZzZXQpICsgJyIgaWQ9Iic7CiAgICAgICAgaHRtbCArPSB0aGlzLl9pZChuYW1lLCBvcHRpb25zLm9mZnNldCwgb3B0aW9ucy5wYXRoX2V4dHJhKSArICciJzsKICAgICAgICBodG1sICs9ICh2YWx1ZSA/ICcgY2hlY2tlZD0iY2hlY2tlZCInOiAnJyk7CiAgICAgICAgcmV0dXJuIChodG1sICsgJyAvPicpOwogICAgfTsKICAgIHJldHVybiB3Owp9OwoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgc2VsZWN0IHdpZGdldC4KICoKICogQG5hbWUgc2VsZWN0KFtvcHRpb25zXSkKICogQHBhcmFtIG9wdGlvbnMKICogQHJldHVybnMge1dpZGdldCBPYmplY3R9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5zZWxlY3QgPSBmdW5jdGlvbiAoX29wdGlvbnMpIHsKICAgIHZhciB3ID0gbmV3IFdpZGdldCgnc2VsZWN0JywgX29wdGlvbnMgfHwge30pOwogICAgdy52YWx1ZXMgPSBfb3B0aW9ucy52YWx1ZXM7CiAgICB3LnRvSFRNTCA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSwgcmF3LCBmaWVsZCwgb3B0aW9ucykgewogICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHZhbHVlID0gJyc7CiAgICAgICAgfQoKICAgICAgICB2YXIgaHRtbCA9ICc8c2VsZWN0JzsKICAgICAgICBodG1sICs9ICcgbmFtZT0iJyArIHRoaXMuX25hbWUobmFtZSwgb3B0aW9ucy5vZmZzZXQpICsgJyIgaWQ9Iic7CiAgICAgICAgaHRtbCArPSB0aGlzLl9pZChuYW1lLCBvcHRpb25zLm9mZnNldCwgb3B0aW9ucy5wYXRoX2V4dHJhKSArICciPic7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy52YWx1ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIG9wdCA9IHRoaXMudmFsdWVzW2ldOwogICAgICAgICAgICBodG1sICs9ICc8b3B0aW9uIHZhbHVlPSInICsgaChvcHRbMF0pICsgJyInOwogICAgICAgICAgICBpZiAob3B0WzBdID09PSB2YWx1ZSkgewogICAgICAgICAgICAgICAgaHRtbCArPSAnIHNlbGVjdGVkPSJzZWxlY3RlZCInOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGh0bWwgKz0gJz4nOwogICAgICAgICAgICBodG1sICs9IGgob3B0WzFdKTsKICAgICAgICAgICAgaHRtbCArPSAnPC9vcHRpb24+JzsKICAgICAgICB9CiAgICAgICAgaHRtbCArPSAnPC9zZWxlY3Q+JzsKICAgICAgICByZXR1cm4gaHRtbDsKICAgIH07CiAgICByZXR1cm4gdzsKfTsKCi8qKgogKiBDcmVhdGVzIGEgbmV3IGNvbXB1dGVkIHdpZGdldC4gQ29tcHV0ZWQgd2lkZ2V0cyBkaXNwbGF5IGEgc3RyaW5nLCBidXQgYXJlCiAqIHVuZWRpdGFibGUsIHdvcmtpbmcgYXMgYSBoaWRkZW4gZmllbGQgYmVoaW5kIHRoZSBzY2VuZXMuCiAqCiAqIEBuYW1lIGNvbXB1dGVkKFtvcHRpb25zXSkKICogQHBhcmFtIG9wdGlvbnMKICogQHJldHVybnMge1dpZGdldCBPYmplY3R9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5jb21wdXRlZCA9IGZ1bmN0aW9uIChfb3B0aW9ucykgewogICAgdmFyIHcgPSBuZXcgV2lkZ2V0KCdjb21wdXRlZCcsIF9vcHRpb25zKTsKICAgIHcudG9IVE1MID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlLCByYXcsIGZpZWxkLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKHJhdyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJhdyA9ICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSA/ICcnOiAnJyArIHZhbHVlOwogICAgICAgIH0KICAgICAgICBpZiAocmF3ID09PSBudWxsIHx8IHJhdyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJhdyA9ICcnOwogICAgICAgIH0KICAgICAgICB2YXIgaHRtbCA9ICc8ZGl2IGlkPSInOwogICAgICAgIGh0bWwgKz0gdGhpcy5faWQobmFtZSwgb3B0aW9ucy5vZmZzZXQsIG9wdGlvbnMucGF0aF9leHRyYSkgKyAnIj4nOwogICAgICAgIGh0bWwgKz0gJzxpbnB1dCB0eXBlPSJoaWRkZW4iIHZhbHVlPSInICsgaChyYXcpICsgJyInOwogICAgICAgIGh0bWwgKz0gJyBuYW1lPSInICsgdGhpcy5fbmFtZShuYW1lLCBvcHRpb25zLm9mZnNldCkgKyAnIiAvPic7CiAgICAgICAgaHRtbCArPSAnPHNwYW4+JyArIGgocmF3KSArICc8L3NwYW4+JzsKICAgICAgICBodG1sICs9ICc8L2Rpdj4nOwogICAgICAgIHJldHVybiBodG1sOwogICAgfTsKICAgIHJldHVybiB3Owp9OwoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgY29tcHV0ZWQgaW5wdXQgd2lkZ2V0IHdoaWNoIHNldHMgdGhlIHZhbHVlIG9mIHRoZSBmaWVsZCB0bwogKiB0aGUgY3VycmVudCB1c2VyIG9uIG5ldyBkb2N1bWVudHMsIHJlc3BvbmRpbmcgdG8gc2Vzc2lvbkNoYW5nZSBldmVudHMKICoKICogQG5hbWUgY3JlYXRvcihbb3B0aW9uc10pCiAqIEBwYXJhbSBvcHRpb25zCiAqIEByZXR1cm5zIHtXaWRnZXQgT2JqZWN0fQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuY3JlYXRvciA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICB2YXIgdyA9IGV4cG9ydHMuY29tcHV0ZWQob3B0aW9ucyk7CiAgICB2YXIgX3RvSFRNTCA9IHcudG9IVE1MOwogICAgdmFyIGVsX25hbWU7IC8vIHN0b3JlIGlucHV0IG5hbWUgcHJvdmlkZWQgYnkgcmVuZGVyZXIKICAgIHZhciBlbDsgLy8gc3RvcmUgcmVmZXJlbmNlIHRvIGVsZW1lbnQgc28gd2UgY2FuIGRldGVjdCB3aGVuIGl0cyBiZWVuIHJlbW92ZWQKCiAgICB3LnRvSFRNTCA9IGZ1bmN0aW9uIChuYW1lLyosIC4uLiovKSB7CiAgICAgICAgZWxfbmFtZSA9IG5hbWU7CiAgICAgICAgcmV0dXJuIF90b0hUTUwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgICB3LmNsaWVudEluaXQgPSBmdW5jdGlvbiAoZmllbGQsIHBhdGgsIHZhbHVlLCByYXcsIGVycm9ycywgb3B0aW9ucykgewogICAgICAgIGlmIChvcHRpb25zLm9wZXJhdGlvbiA9PT0gJ2FkZCcpIHsKCiAgICAgICAgICAgIHZhciBpZCA9IHcuX2lkKGVsX25hbWUsIG9wdGlvbnMub2Zmc2V0LCBvcHRpb25zLnBhdGhfZXh0cmEpOwoKICAgICAgICAgICAgLy8gc3RvcmUgcmVmZXJlbmNlIHRvIGNvbnRhaW5lciBlbGVtZW50CiAgICAgICAgICAgIGVsID0gJCgnIycgKyBpZClbMF07CgogICAgICAgICAgICB2YXIgdXBkYXRlX3ZhbCA9IGZ1bmN0aW9uICh1c2VyQ3R4LCByZXEpIHsKICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSAkKCcjJyArIGlkKVswXTsKICAgICAgICAgICAgICAgIGlmIChlbCAhPT0gY29udGFpbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCBoYXMgYmVlbiByZW1vdmVkCiAgICAgICAgICAgICAgICAgICAgZXZlbnRzLnJlbW92ZUxpc3RlbmVyKCdzZXNzaW9uQ2hhbmdlJywgdXBkYXRlX3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5lcikgewogICAgICAgICAgICAgICAgICAgICQoJ2lucHV0JywgY29udGFpbmVyKS52YWwodXNlckN0eC5uYW1lIHx8ICcnKTsKICAgICAgICAgICAgICAgICAgICAkKCdzcGFuJywgY29udGFpbmVyKS50ZXh0KHVzZXJDdHgubmFtZSB8fCAnJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSBwYWdlIChvciB3YXMgbmV2ZXIgdGhlcmU/KQogICAgICAgICAgICAgICAgICAgIGV2ZW50cy5yZW1vdmVMaXN0ZW5lcignc2Vzc2lvbkNoYW5nZScsIHVwZGF0ZV92YWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBldmVudHMub24oJ3Nlc3Npb25DaGFuZ2UnLCB1cGRhdGVfdmFsKTsKICAgICAgICB9CiAgICB9OwogICAgcmV0dXJuIHc7Cn07CgoKCi8qKgogKiBDcmVhdGVzIGEgbmV3IGZpZWxkIGZvciBzdG9yaW5nL2Rpc3BsYXlpbmcgYW4gZW1iZWRkZWQgb2JqZWN0LgogKiBUaGlzIGlzIGF1dG9tYXRpY2FsbHkgYWRkZWQgdG8gZW1iZWQgYW5kIGVtYmVkTGlzdCBmaWVsZCB0eXBlcwogKiB0aGF0IGRvbid0IHNwZWNpZnkgYSB3aWRnZXQuCiAqCiAqIEBuYW1lIGVtYmVkZGVkKFtvcHRpb25zXSkKICogQHBhcmFtIG9wdGlvbnMKICogQHJldHVybnMge1dpZGdldCBPYmplY3R9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5lbWJlZExpc3QgPSBmdW5jdGlvbiAoX29wdGlvbnMpIHsKICAgIHZhciB3ID0gbmV3IFdpZGdldCgnZW1iZWRMaXN0JywgX29wdGlvbnMpOwoKICAgIHcuc29ydGFibGUgPSBfb3B0aW9ucy5zb3J0YWJsZTsKICAgIHcuc2luZ2xldG9uID0gX29wdGlvbnMuc2luZ2xldG9uOwogICAgdy53aWRnZXQgPSAoX29wdGlvbnMud2lkZ2V0IHx8IGV4cG9ydHMuZGVmYXVsdEVtYmVkZGVkKCkpOwogICAgdy5hY3Rpb25zID0gYWN0aW9ucy5wYXJzZShfb3B0aW9ucy5hY3Rpb25zIHx8IHt9KTsKCiAgICB3LnRvSFRNTCA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSwgcmF3LCBmaWVsZCwgb3B0aW9ucykgewoKICAgICAgICB0aGlzLmNhY2hlSW5pdCgpOwogICAgICAgIHZhbHVlID0gdGhpcy5ub3JtYWxpemVWYWx1ZSh2YWx1ZSk7CgogICAgICAgIHRoaXMuZmllbGQgPSBmaWVsZDsKICAgICAgICB0aGlzLnJlbmRlcl9vcHRpb25zID0gKG9wdGlvbnMgfHwge30pOwoKICAgICAgICB2YXIgaWQgPSB0aGlzLl9pZCgKICAgICAgICAgICAgbmFtZSwgJ2xpc3QnLCB0aGlzLnJlbmRlcl9vcHRpb25zLm9mZnNldCwKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyX29wdGlvbnMucGF0aF9leHRyYQogICAgICAgICk7CiAgICAgICAgdmFyIGh0bWwgPSAoCiAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJlbWJlZGxpc3QiIHJlbD0iJyArCiAgICAgICAgICAgICAgICBoKHRoaXMuZmllbGQudHlwZS5uYW1lKSArICciIGlkPSInICsgaChpZCkgKyAnIj4nCiAgICAgICAgKTsKCiAgICAgICAgdmFsdWUgPSAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSA/IHZhbHVlIDogW10pOwogICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9Iml0ZW1zIiByZWw9IicgKyBoKG5hbWUpICsgJyI+JzsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHZhbHVlLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgIGh0bWwgKz0gdGhpcy5odG1sRm9yTGlzdEl0ZW0oewogICAgICAgICAgICAgICAgb2Zmc2V0OiAodGhpcy5zaW5nbGV0b24gPyBudWxsIDogaSksCiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlW2ldLAogICAgICAgICAgICAgICAgcmF3OiByYXcKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGh0bWwgKz0gKAogICAgICAgICAgICAgICAgJzwvZGl2PicgKwogICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImFjdGlvbnMiPicgKwogICAgICAgICAgICAgICAgICAgIHRoaXMuaHRtbEZvckFkZEJ1dHRvbigpICsKICAgICAgICAgICAgICAgICc8L2Rpdj4nICsKICAgICAgICAgICAgJzwvZGl2PicKICAgICAgICApOwogICAgICAgIHJldHVybiBodG1sOwogICAgfTsKCiAgICB3LmNsaWVudEluaXQgPSBmdW5jdGlvbiAoZmllbGQsIHBhdGgsIHZhbHVlLCByYXcsIGVycm9ycywgb3B0aW9ucykgewoKICAgICAgICB0aGlzLmNhY2hlSW5pdCgpOwogICAgICAgIHZhbHVlID0gdGhpcy5ub3JtYWxpemVWYWx1ZSh2YWx1ZSk7CgogICAgICAgIHRoaXMucGF0aCA9IHBhdGg7CiAgICAgICAgdGhpcy5maWVsZCA9IGZpZWxkOwogICAgICAgIHRoaXMucmVuZGVyX29wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSk7CgogICAgICAgIHZhciBpdGVtX2VsdHMgPSAoCiAgICAgICAgICAgIHRoaXMuZGlzY292ZXJMaXN0SXRlbXNFbGVtZW50KCkuY2hpbGRyZW4oJy5pdGVtJykKICAgICAgICApOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaXRlbV9lbHRzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgIHRoaXMuYmluZEV2ZW50c0Zvckxpc3RJdGVtKGl0ZW1fZWx0c1tpXSk7CgogICAgICAgICAgICBpZiAoXy5pc0Z1bmN0aW9uKHRoaXMud2lkZ2V0LmNsaWVudEluaXQpKSB7CiAgICAgICAgICAgICAgICB0aGlzLndpZGdldC5jbGllbnRJbml0KAogICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGQsIHRoaXMucGF0aCwgdmFsdWVbaV0sIHZhbHVlW2ldLCBbXSwgewogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6ICh0aGlzLnNpbmdsZXRvbiA/IG51bGwgOiBpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMucmVudW1iZXJMaXN0KCk7CiAgICAgICAgdGhpcy5iaW5kRXZlbnRzRm9yTGlzdCgpOwogICAgfTsKCiAgICAvKiogcHJpdmF0ZTogKiovCgogICAgdy5jYWNoZUluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5kaXNjb3Zlckxpc3RFbGVtZW50ID0gXy5tZW1vaXplKHRoaXMuX2Rpc2NvdmVyTGlzdEVsZW1lbnQpOwogICAgICAgIHRoaXMuZGlzY292ZXJMaXN0TmFtZSA9IF8ubWVtb2l6ZSh0aGlzLl9kaXNjb3Zlckxpc3ROYW1lKTsKICAgICAgICB0aGlzLmRpc2NvdmVyTGlzdFR5cGUgPSBfLm1lbW9pemUodGhpcy5fZGlzY292ZXJMaXN0VHlwZSk7CiAgICAgICAgdGhpcy5kaXNjb3Zlckxpc3RJdGVtc0VsZW1lbnQgPSBfLm1lbW9pemUodGhpcy5fZGlzY292ZXJMaXN0SXRlbXNFbGVtZW50KTsKICAgIH07CgogICAgdy5ub3JtYWxpemVWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIGlmICh0aGlzLnNpbmdsZXRvbikgewogICAgICAgICAgICBpZiAodmFsdWUgJiYgIV8uaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gWyB2YWx1ZSBdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CgogICAgdy5fZGlzY292ZXJMaXN0RWxlbWVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gJCgnIycgKyB0aGlzLl9pZCgKICAgICAgICAgICAgdGhpcy5wYXRoLCAnbGlzdCcsIHRoaXMucmVuZGVyX29wdGlvbnMub2Zmc2V0LAogICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJfb3B0aW9ucy5wYXRoX2V4dHJhCiAgICAgICAgKSk7CiAgICB9OwoKICAgIHcuX2Rpc2NvdmVyTGlzdE5hbWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxpc3RfZWx0ID0gdGhpcy5kaXNjb3Zlckxpc3RFbGVtZW50KCk7CiAgICAgICAgdmFyIGFjdGlvbnNfZWx0ID0gJChsaXN0X2VsdCkuY2xvc2VzdENoaWxkKCcuYWN0aW9ucycpOwogICAgICAgIHJldHVybiBhY3Rpb25zX2VsdC5hdHRyKCdyZWwnKTsKICAgIH07CiAgICAKICAgIHcuX2Rpc2NvdmVyTGlzdFR5cGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxpc3RfZWx0ID0gdGhpcy5kaXNjb3Zlckxpc3RFbGVtZW50KCk7CiAgICAgICAgcmV0dXJuIGxpc3RfZWx0LmF0dHIoJ3JlbCcpOwogICAgfTsKCiAgICB3Ll9kaXNjb3Zlckxpc3RJdGVtc0VsZW1lbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxpc3RfZWx0ID0gdGhpcy5kaXNjb3Zlckxpc3RFbGVtZW50KCk7CiAgICAgICAgcmV0dXJuIGxpc3RfZWx0LmNsb3Nlc3RDaGlsZCgnLml0ZW1zJyk7CiAgICB9OwoKICAgIHcuZGlzY292ZXJMaXN0SXRlbXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgdGhpcy5kaXNjb3Zlckxpc3RJdGVtc0VsZW1lbnQoKS5jaGlsZHJlbignLml0ZW0nKQogICAgICAgICk7CiAgICB9OwoKICAgIHcuY291bnRMaXN0SXRlbXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZGlzY292ZXJMaXN0SXRlbXMoKS5sZW5ndGg7CiAgICB9OwoKICAgIHcuYmluZEV2ZW50c0Zvckxpc3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxpc3RfZWx0ID0gdGhpcy5kaXNjb3Zlckxpc3RFbGVtZW50KCk7CiAgICAgICAgdmFyIGFkZF9lbHQgPSAkKGxpc3RfZWx0KS5jbG9zZXN0Q2hpbGQoJy5hY3Rpb25zIC5hZGQnKTsKCiAgICAgICAgYWRkX2VsdC5iaW5kKCdjbGljaycsIHV0aWxzLmJpbmRDb250ZXh0KHRoaXMsIGZ1bmN0aW9uIChldikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVBZGRCdXR0b25DbGljayhldik7CiAgICAgICAgfSkpOwogICAgfTsKCiAgICB3LmJpbmRFdmVudHNGb3JMaXN0SXRlbSA9IGZ1bmN0aW9uIChpdGVtX2VsdCkgewogICAgICAgIGl0ZW1fZWx0ID0gJChpdGVtX2VsdCk7CiAgICAgICAgdmFyIGVkaXRfZWx0ID0gaXRlbV9lbHQuY2xvc2VzdENoaWxkKCcuYWN0aW9ucyAuZWRpdCcpOwogICAgICAgIHZhciBkZWxldGVfZWx0ID0gaXRlbV9lbHQuY2xvc2VzdENoaWxkKCcuYWN0aW9ucyAuZGVsZXRlJyk7CgogICAgICAgIGVkaXRfZWx0LmJpbmQoJ2NsaWNrJywgdXRpbHMuYmluZENvbnRleHQodGhpcywgZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUVkaXRCdXR0b25DbGljayhldik7CiAgICAgICAgfSkpOwoKICAgICAgICBkZWxldGVfZWx0LmJpbmQoJ2NsaWNrJywgdXRpbHMuYmluZENvbnRleHQodGhpcywgZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZURlbGV0ZUJ1dHRvbkNsaWNrKGV2KTsKICAgICAgICB9KSk7CgogICAgICAgIGlmICh0aGlzLnNvcnRhYmxlKSB7CiAgICAgICAgICAgIHZhciB1cF9lbHQgPSBpdGVtX2VsdC5jbG9zZXN0Q2hpbGQoJy5hY3Rpb25zIC51cCcpOwogICAgICAgICAgICB2YXIgZG93bl9lbHQgPSBpdGVtX2VsdC5jbG9zZXN0Q2hpbGQoJy5hY3Rpb25zIC5kb3duJyk7CgogICAgICAgICAgICB1cF9lbHQuYmluZCgnY2xpY2snLCB1dGlscy5iaW5kQ29udGV4dCh0aGlzLCBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZVVwQnV0dG9uQ2xpY2soZXYpOwogICAgICAgICAgICB9KSk7CgogICAgICAgICAgICBkb3duX2VsdC5iaW5kKCdjbGljaycsIHV0aWxzLmJpbmRDb250ZXh0KHRoaXMsIGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlRG93bkJ1dHRvbkNsaWNrKGV2KTsKICAgICAgICAgICAgfSkpOwogICAgICAgIH0KICAgIH07CgogICAgdy5yZW51bWJlckxpc3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGl0ZW1fZWx0cyA9CiAgICAgICAgICAgIHRoaXMuZGlzY292ZXJMaXN0SXRlbXNFbGVtZW50KCkuY2hpbGRyZW4oJy5pdGVtJyk7CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBpdGVtX2VsdHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKGl0ZW1fZWx0c1tpXSk7CiAgICAgICAgICAgIHRoaXMucmVudW1iZXJMaXN0SXRlbShpdGVtLCBpKTsKICAgICAgICAgICAgdGhpcy51cGRhdGVMaXN0SXRlbUFjdGlvbnMoaXRlbSwgaSwgbGVuKTsKCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZUxpc3RBY3Rpb25zKGxlbik7CiAgICB9OwoKICAgIHcucmVudW1iZXJMaXN0SXRlbSA9IGZ1bmN0aW9uIChlbHQsIG9mZnNldCkgewogICAgICAgIHZhciB3aWRnZXRfb3B0aW9ucyA9IHsKICAgICAgICAgICAgb2Zmc2V0OiAodGhpcy5zaW5nbGV0b24gPyBudWxsIDogb2Zmc2V0KQogICAgICAgIH07CiAgICAgICAgaWYgKF8uaXNGdW5jdGlvbih0aGlzLndpZGdldC51cGRhdGVOYW1lKSkgewogICAgICAgICAgICB0aGlzLndpZGdldC51cGRhdGVOYW1lKGVsdCwgdGhpcy5wYXRoLCB3aWRnZXRfb3B0aW9ucyk7CiAgICAgICAgfQogICAgfTsKCiAgICB3LnVwZGF0ZUxpc3RBY3Rpb25zID0gZnVuY3Rpb24gKG9mZnNldCkgewogICAgICAgIHZhciBsaXN0X2VsdCA9IHRoaXMuZGlzY292ZXJMaXN0RWxlbWVudCgpOwogICAgICAgIHZhciBhZGRfZWx0ID0gbGlzdF9lbHQuY2xvc2VzdENoaWxkKCcuYWN0aW9ucyAuYWRkJyk7CgogICAgICAgIGlmICh0aGlzLnNpbmdsZXRvbiAmJiBvZmZzZXQgPiAwKSB7CiAgICAgICAgICAgIGFkZF9lbHQuaGlkZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFkZF9lbHQuc2hvdygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gb2Zmc2V0OwogICAgfTsKCiAgICB3LnVwZGF0ZUxpc3RJdGVtQWN0aW9ucyA9IGZ1bmN0aW9uIChpdGVtX2VsdCwgb2Zmc2V0LCBjb3VudCkgewogICAgICAgIGlmICh0aGlzLnNvcnRhYmxlKSB7CiAgICAgICAgICAgIHZhciBhdHRyID0gJ2Rpc2FibGVkJzsKICAgICAgICAgICAgdmFyIHVwX2VsdCA9IGl0ZW1fZWx0LmNsb3Nlc3RDaGlsZCgnLmFjdGlvbnMgLnVwJyk7CiAgICAgICAgICAgIHZhciBkb3duX2VsdCA9IGl0ZW1fZWx0LmNsb3Nlc3RDaGlsZCgnLmFjdGlvbnMgLmRvd24nKTsKCiAgICAgICAgICAgIGlmIChvZmZzZXQgPD0gMCkgewogICAgICAgICAgICAgICAgdXBfZWx0LmF0dHIoYXR0ciwgYXR0cik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB1cF9lbHQucmVtb3ZlQXR0cihhdHRyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob2Zmc2V0ICsgMSA+PSBjb3VudCkgewogICAgICAgICAgICAgICAgZG93bl9lbHQuYXR0cihhdHRyLCBhdHRyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRvd25fZWx0LnJlbW92ZUF0dHIoYXR0cik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIHcubW92ZUV4aXN0aW5nSXRlbSA9IGZ1bmN0aW9uIChhZnRlcl9lbHQsIGl0ZW1fZWx0KSB7CiAgICAgICAgaWYgKGFmdGVyX2VsdCkgewogICAgICAgICAgICAkKGFmdGVyX2VsdCkuYWZ0ZXIoaXRlbV9lbHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBpdGVtc19lbHQgPSB0aGlzLmRpc2NvdmVyTGlzdEl0ZW1zRWxlbWVudCgpOwogICAgICAgICAgICBpdGVtc19lbHQuYXBwZW5kKGl0ZW1fZWx0KTsKICAgICAgICB9CiAgICAgICAgdGhpcy5yZW51bWJlckxpc3QoKTsKICAgICAgICB0aGlzLmJpbmRFdmVudHNGb3JMaXN0SXRlbShpdGVtX2VsdCk7CiAgICB9OwoKICAgIHcuZGVsZXRlRXhpc3RpbmdJdGVtID0gZnVuY3Rpb24gKGl0ZW1fZWx0KSB7CiAgICAgICAgJChpdGVtX2VsdCkucmVtb3ZlKCk7CiAgICAgICAgdGhpcy5yZW51bWJlckxpc3QoKTsKICAgIH07CgogICAgdy5pbnNlcnROZXdJdGVtQXRFbmQgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgICB2YXIgbGlzdF9lbHQgPSB0aGlzLmRpc2NvdmVyTGlzdEVsZW1lbnQoKTsKCiAgICAgICAgdmFyIGl0ZW1fZWx0cyA9CiAgICAgICAgICAgIHRoaXMuZGlzY292ZXJMaXN0SXRlbXNFbGVtZW50KCkuY2hpbGRyZW4oJy5pdGVtJyk7CgogICAgICAgIHZhciBsYXN0X2VsdCA9IGl0ZW1fZWx0cy5sYXN0KCk7CgogICAgICAgIHJldHVybiB0aGlzLmluc2VydE5ld0l0ZW0oCiAgICAgICAgICAgICh0aGlzLnNpbmdsZXRvbiA/IG51bGwgOiBpdGVtX2VsdHMubGVuZ3RoKSwKICAgICAgICAgICAgICAgIGxhc3RfZWx0WzBdLCBjYWxsYmFjawogICAgICAgICk7CiAgICB9OwoKICAgIHcuaW5zZXJ0TmV3SXRlbSA9IGZ1bmN0aW9uIChvZmZzZXQsIGFmdGVyX2VsdCwgY2FsbGJhY2spIHsKICAgICAgICB2YXIgbGlzdF9lbHQgPSB0aGlzLmRpc2NvdmVyTGlzdEVsZW1lbnQoKTsKICAgICAgICB2YXIgbGlzdF90eXBlID0gdGhpcy5kaXNjb3Zlckxpc3RUeXBlKCk7CgogICAgICAgIGRiLm5ld1VVSUQoMTAwLCB1dGlscy5iaW5kQ29udGV4dCh0aGlzLCBmdW5jdGlvbiAoZXJyLCB1dWlkKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHsgdHlwZTogbGlzdF90eXBlLCBfaWQ6IHV1aWQgfTsKCiAgICAgICAgICAgIHZhciBpdGVtX2VsdCA9ICQodGhpcy5odG1sRm9yTGlzdEl0ZW0oewogICAgICAgICAgICAgICAgbmFtZTogdGhpcy5fbmFtZSh0aGlzLnBhdGgpLAogICAgICAgICAgICAgICAgb2Zmc2V0OiBvZmZzZXQsCiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICByYXc6IHZhbHVlCiAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIHRoaXMubW92ZUV4aXN0aW5nSXRlbShhZnRlcl9lbHQsIGl0ZW1fZWx0KTsKCiAgICAgICAgICAgIGlmIChfLmlzRnVuY3Rpb24odGhpcy53aWRnZXQuY2xpZW50SW5pdCkpIHsKICAgICAgICAgICAgICAgIHRoaXMud2lkZ2V0LmNsaWVudEluaXQoCiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZCwgdGhpcy5wYXRoLCB2YWx1ZSwgbnVsbCwgW10sIHsKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiAodGhpcy5zaW5nbGV0b24gPyBudWxsIDogb2Zmc2V0KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgY2FsbGJhY2soaXRlbV9lbHRbMF0pOwogICAgICAgICAgICB9CiAgICAgICAgfSkpOwogICAgfTsKCiAgICB3LnNldExpc3RJdGVtVmFsdWUgPSBmdW5jdGlvbiAoZWx0LCB2YWx1ZSwgb2Zmc2V0KSB7CiAgICAgICAgaWYgKHRoaXMud2lkZ2V0LnVwZGF0ZVZhbHVlKSB7CiAgICAgICAgICAgIHRoaXMud2lkZ2V0LnVwZGF0ZVZhbHVlKAogICAgICAgICAgICAgICAgZWx0LCB0aGlzLnBhdGgsIHZhbHVlLCB7IG9mZnNldDogb2Zmc2V0IH0KICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9OwoKICAgIHcuaHRtbEZvckxpc3RJdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICB2YXIgaHRtbCA9ICgKICAgICAgICAgICAgJzxkaXYgY2xhc3M9Iml0ZW0iPicgKwogICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImFjdGlvbnMiPicgKwogICAgICAgICAgICAgICAgICAgICh0aGlzLnNvcnRhYmxlID8KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5odG1sRm9yRG93bkJ1dHRvbigpIDogJycpICsKICAgICAgICAgICAgICAgICAgICAodGhpcy5zb3J0YWJsZSA/CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaHRtbEZvclVwQnV0dG9uKCkgOiAnJykgKwogICAgICAgICAgICAgICAgICAgIHRoaXMuaHRtbEZvckVkaXRCdXR0b24oKSArCiAgICAgICAgICAgICAgICAgICAgdGhpcy5odG1sRm9yRGVsZXRlQnV0dG9uKCkgKwogICAgICAgICAgICAgICAgJzwvZGl2PicgKwogICAgICAgICAgICAgICAgdGhpcy53aWRnZXQudG9IVE1MKAogICAgICAgICAgICAgICAgICAgIGl0ZW0ubmFtZSwgaXRlbS52YWx1ZSwgaXRlbS5yYXcsIHRoaXMuZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgIHsgb2Zmc2V0OiBpdGVtLm9mZnNldCB9CiAgICAgICAgICAgICAgICApICsKICAgICAgICAgICAgJzwvZGl2PicKICAgICAgICApOwogICAgICAgIHJldHVybiBodG1sOwogICAgfTsKCiAgICB3Lmh0bWxGb3JBZGRCdXR0b24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgJzxpbnB1dCB0eXBlPSJidXR0b24iIGNsYXNzPSJhZGQgYWN0aW9uIiB2YWx1ZT0iQWRkIiAvPicKICAgICAgICApOwogICAgfTsKCiAgICB3Lmh0bWxGb3JFZGl0QnV0dG9uID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICc8aW5wdXQgdHlwZT0iYnV0dG9uIiBjbGFzcz0iZWRpdCBhY3Rpb24iIHZhbHVlPSJFZGl0IiAvPicKICAgICAgICApOwogICAgfTsKCiAgICB3Lmh0bWxGb3JEZWxldGVCdXR0b24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgJzxpbnB1dCB0eXBlPSJidXR0b24iIGNsYXNzPSJkZWxldGUgYWN0aW9uIiB2YWx1ZT0iRGVsZXRlIiAvPicKICAgICAgICApOwogICAgfTsKCiAgICB3Lmh0bWxGb3JVcEJ1dHRvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAnPGlucHV0IHR5cGU9ImJ1dHRvbiIgY2xhc3M9InVwIGFjdGlvbiIgdmFsdWU9IiZ1YXJyOyIgLz4nCiAgICAgICAgKTsKICAgIH07CgogICAgdy5odG1sRm9yRG93bkJ1dHRvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAnPGlucHV0IHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImRvd24gYWN0aW9uIiB2YWx1ZT0iJmRhcnI7IiAvPicKICAgICAgICApOwogICAgfTsKCiAgICB3LmRpc3BhdGNoRXZlbnRUb0FjdGlvbiA9IGZ1bmN0aW9uICh0YXJnZXRfZWx0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX25hbWUsIGNhbGxiYWNrKSB7CiAgICAgICAgdmFyIG5hbWUgPSB0aGlzLl9uYW1lKHRoaXMucGF0aCk7CiAgICAgICAgdmFyIHR5cGVfbmFtZSA9IHRoaXMuZGlzY292ZXJMaXN0VHlwZSgpOwogICAgICAgIHZhciBpdGVtX2VsdCA9ICQodGFyZ2V0X2VsdCkuY2xvc2VzdCgnLml0ZW0nKTsKICAgICAgICB2YXIgb2Zmc2V0ID0gaXRlbV9lbHQucHJldkFsbCgnLml0ZW0nKS5sZW5ndGg7CiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy53aWRnZXQuZ2V0VmFsdWUoCiAgICAgICAgICAgIGl0ZW1fZWx0LCB0aGlzLnBhdGgsIHRoaXMucmVuZGVyX29wdGlvbnMKICAgICAgICApOwoKICAgICAgICB2YXIgd2lkZ2V0X29wdGlvbnMgPSB7CiAgICAgICAgICAgIG9mZnNldDogb2Zmc2V0LAogICAgICAgICAgICBwYXRoX2V4dHJhOiAodGhpcy5yZW5kZXJfb3B0aW9ucy5wYXRoX2V4dHJhIHx8IFtdKQogICAgICAgIH07CgogICAgICAgIC8qIEFjdGlvbiBoYW5kbGVyIHdpbGwgdHJhbnNmZXIgY29udHJvbCBoZXJlIHdoZW4gZmluaXNoZWQgKi8KICAgICAgICB2YXIgY2IgPSB1dGlscy5iaW5kQ29udGV4dCh0aGlzLCBmdW5jdGlvbiAoc3VjY2Vzc2Z1bCwgbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbCgKICAgICAgICAgICAgICAgICAgICB0aGlzLCB0YXJnZXRfZWx0LCBvZmZzZXQsIHN1Y2Nlc3NmdWwsIG5ld192YWx1ZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgYWN0aW9uX2hhbmRsZXIgPSAoCiAgICAgICAgICAgIHRoaXMuYWN0aW9uc1thY3Rpb25fbmFtZV0gfHwKICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdEFjdGlvbkZvcihhY3Rpb25fbmFtZSkKICAgICAgICApOwoKICAgICAgICBpZiAoYWN0aW9uX2hhbmRsZXIpIHsKICAgICAgICAgICAgYWN0aW9uX2hhbmRsZXIoCiAgICAgICAgICAgICAgICBhY3Rpb25fbmFtZSwgdHlwZV9uYW1lLCB0aGlzLmZpZWxkLCB0aGlzLnBhdGgsCiAgICAgICAgICAgICAgICAgICAgdmFsdWUsIG51bGwsIFtdLCB3aWRnZXRfb3B0aW9ucywgY2IKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9OwoKICAgIHcuaGFuZGxlVXBCdXR0b25DbGljayA9IGZ1bmN0aW9uIChldikgewogICAgICAgIHZhciBpdGVtX2VsdCA9ICQoZXYudGFyZ2V0KS5jbG9zZXN0KCcuaXRlbScpOwogICAgICAgIGl0ZW1fZWx0Lmluc2VydEJlZm9yZShpdGVtX2VsdC5wcmV2KCcuaXRlbScpKTsKICAgICAgICB0aGlzLnJlbnVtYmVyTGlzdCgpOwogICAgfTsKCiAgICB3LmhhbmRsZURvd25CdXR0b25DbGljayA9IGZ1bmN0aW9uIChldikgewogICAgICAgIHZhciBpdGVtX2VsdCA9ICQoZXYudGFyZ2V0KS5jbG9zZXN0KCcuaXRlbScpOwogICAgICAgIGl0ZW1fZWx0Lmluc2VydEFmdGVyKGl0ZW1fZWx0Lm5leHQoJy5pdGVtJykpOwogICAgICAgIHRoaXMucmVudW1iZXJMaXN0KCk7CiAgICB9OwoKICAgIHcuaGFuZGxlQWRkQnV0dG9uQ2xpY2sgPSBmdW5jdGlvbiAoZXYpIHsKICAgICAgICB2YXIgY2FsbGJhY2sgPSB1dGlscy5iaW5kQ29udGV4dCgKICAgICAgICAgICAgdGhpcywgdGhpcy5oYW5kbGVBZGRDb21wbGV0aW9uCiAgICAgICAgKTsKICAgICAgICB0aGlzLmluc2VydE5ld0l0ZW1BdEVuZCgKICAgICAgICAgICAgdXRpbHMuYmluZENvbnRleHQodGhpcywgZnVuY3Rpb24gKGl0ZW1fZWx0KSB7CiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnRUb0FjdGlvbihpdGVtX2VsdCwgJ2FkZCcsIGNhbGxiYWNrKTsKICAgICAgICAgICAgfSkKICAgICAgICApOwogICAgfTsKCiAgICB3LmhhbmRsZUVkaXRCdXR0b25DbGljayA9IGZ1bmN0aW9uIChldikgewogICAgICAgIHZhciBjYWxsYmFjayA9IHV0aWxzLmJpbmRDb250ZXh0KAogICAgICAgICAgICB0aGlzLCB0aGlzLmhhbmRsZUVkaXRDb21wbGV0aW9uCiAgICAgICAgKTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnRUb0FjdGlvbihldi50YXJnZXQsICdlZGl0JywgY2FsbGJhY2spOwogICAgfTsKCiAgICB3LmhhbmRsZURlbGV0ZUJ1dHRvbkNsaWNrID0gZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgdmFyIGNhbGxiYWNrID0gdXRpbHMuYmluZENvbnRleHQoCiAgICAgICAgICAgIHRoaXMsIHRoaXMuaGFuZGxlRGVsZXRlQ29tcGxldGlvbgogICAgICAgICk7CiAgICAgICAgdmFyIGl0ZW1fZWx0ID0gJChldi50YXJnZXQpLmNsb3Nlc3QoJy5pdGVtJywgdGhpcyk7CiAgICAgICAgdGhpcy5kZWxldGVFeGlzdGluZ0l0ZW0oaXRlbV9lbHQpOwogICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudFRvQWN0aW9uKGV2LCAnZGVsZXRlJyk7CiAgICB9OwoKICAgIHcuaGFuZGxlQWRkQ29tcGxldGlvbiA9IGZ1bmN0aW9uICh0YXJnZXRfZWx0LCBvZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfc3VjY2Vzc2Z1bCwgbmV3X3ZhbHVlKSB7CiAgICAgICAgdmFyIGl0ZW1fZWx0ID0gJCh0YXJnZXRfZWx0KS5jbG9zZXN0KCcuaXRlbScsIHRoaXMpOwoKICAgICAgICBpZiAoaXNfc3VjY2Vzc2Z1bCkgewogICAgICAgICAgICB0aGlzLnNldExpc3RJdGVtVmFsdWUoCiAgICAgICAgICAgICAgICBpdGVtX2VsdCwgbmV3X3ZhbHVlLCBvZmZzZXQKICAgICAgICAgICAgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmRlbGV0ZUV4aXN0aW5nSXRlbShpdGVtX2VsdCk7CiAgICAgICAgfQogICAgfTsKCiAgICB3LmhhbmRsZUVkaXRDb21wbGV0aW9uID0gZnVuY3Rpb24gKHRhcmdldF9lbHQsIG9mZnNldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfc3VjY2Vzc2Z1bCwgbmV3X3ZhbHVlKSB7CiAgICAgICAgaWYgKGlzX3N1Y2Nlc3NmdWwpIHsKICAgICAgICAgICAgdmFyIGl0ZW1fZWx0ID0gJCh0YXJnZXRfZWx0KS5jbG9zZXN0KCcuaXRlbScsIHRoaXMpOwogICAgICAgICAgICB0aGlzLnNldExpc3RJdGVtVmFsdWUoCiAgICAgICAgICAgICAgICBpdGVtX2VsdCwgbmV3X3ZhbHVlLCBvZmZzZXQKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9OwoKICAgIHcuaGFuZGxlRGVsZXRlQ29tcGxldGlvbiA9IGZ1bmN0aW9uICh0YXJnZXRfZWx0LCBvZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfc3VjY2Vzc2Z1bCwgbmV3X3ZhbHVlKSB7CiAgICAgICAgcmV0dXJuOwogICAgfTsKCiAgICB3LmRlZmF1bHRBY3Rpb25Gb3IgPSBmdW5jdGlvbiAoYWN0aW9uX25hbWUpIHsKICAgICAgICBzd2l0Y2ggKGFjdGlvbl9uYW1lKSB7CiAgICAgICAgY2FzZSAnYWRkJzoKICAgICAgICBjYXNlICdlZGl0JzoKICAgICAgICAgICAgcmV0dXJuIHV0aWxzLmJpbmRDb250ZXh0KHRoaXMsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBhY3Rpb25fb3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgICAgICB3aWRnZXQ6IGV4cG9ydHMuZW1iZWRGb3JtKHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy5maWVsZC50eXBlCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5hcHBseShhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgYWN0aW9ucy5tb2RhbERpYWxvZy5hcHBseSgKICAgICAgICAgICAgICAgICAgICB0aGlzLCBbIGFjdGlvbl9vcHRpb25zIF0uY29uY2F0KGFyZ3MpCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLyogYnJlYWsgKi8KICAgICAgICBjYXNlICdkZWxldGUnOgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwoKICAgIHJldHVybiB3Owp9OwoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgZmllbGQgZm9yIHN0b3JpbmcvZGlzcGxheWluZyBhbiBlbWJlZGRlZCBvYmplY3QuCiAqIFRoaXMgaXMgYXV0b21hdGljYWxseSBhZGRlZCB0byBlbWJlZCBhbmQgZW1iZWRMaXN0IGZpZWxkIHR5cGVzCiAqIHRoYXQgZG9uJ3Qgc3BlY2lmeSBhIHdpZGdldC4KICoKICogQG5hbWUgZGVmYXVsdEVtYmVkZGVkKFtvcHRpb25zXSkKICogQHBhcmFtIG9wdGlvbnMKICogQHJldHVybnMge1dpZGdldCBPYmplY3R9CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5kZWZhdWx0RW1iZWRkZWQgPSBmdW5jdGlvbiAoX29wdGlvbnMpIHsKICAgIHZhciB3ID0gbmV3IFdpZGdldCgnZGVmYXVsdEVtYmVkZGVkJywgX29wdGlvbnMpOwogICAgdy50b0hUTUwgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUsIHJhdywgZmllbGQsIG9wdGlvbnMpIHsKICAgICAgICB2YXIgZGlzcGxheV9uYW1lID0gKHZhbHVlID8gdmFsdWUuX2lkOiAnJyk7CiAgICAgICAgdmFyIGZ2YWwgPSAodmFsdWUgPyB0aGlzLl9zdHJpbmdpZnlfdmFsdWUodmFsdWUpIDogJycpOwoKICAgICAgICBpZiAoZmllbGQgJiYgZmllbGQudHlwZS5kaXNwbGF5X25hbWUgJiYgdmFsdWUpIHsKICAgICAgICAgICAgZGlzcGxheV9uYW1lID0gZmllbGQudHlwZS5kaXNwbGF5X25hbWUodmFsdWUpOwogICAgICAgIH0KICAgICAgICB2YXIgaHRtbCA9ICgKICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImVtYmVkZGVkIGVtYmVkIj4nICsKICAgICAgICAgICAgICAgICc8aW5wdXQgdHlwZT0iaGlkZGVuIiB2YWx1ZT0iJyArIGgoZnZhbCkgKyAnIiBuYW1lPSInICsKICAgICAgICAgICAgICAgICAgICBoKHRoaXMuX25hbWUobmFtZSwgb3B0aW9ucy5vZmZzZXQpKSArICciIC8+JyArCiAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9InZhbHVlIj4nICsgaChkaXNwbGF5X25hbWUpICsgJzwvc3Bhbj4nICsKICAgICAgICAgICAgJzwvZGl2PicKICAgICAgICApOwogICAgICAgIHJldHVybiBodG1sOwogICAgfTsKICAgIHJldHVybiB3Owp9OwoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgYW4gZW1iZWRkZWQgKmZvcm0qIGZvciB0aGUgc3BlY2lmaWVkIHR5cGUuCiAqIFRoaXMgaXMgdGhlIGJhc2lzIGZvciB0aGUgcHJlc2VudGF0aW9uIG9mIGNvbXBsZXggZGF0YSB0eXBlcyBpbiBLYW5zbywKICogYW5kIGlzIHVzZWQgd2l0aGluIGFuIGVtYmVkTGlzdCB0byBhZGQgYW5kL29yIGVkaXQgaXRlbXMuCiAqCiAqIEBuYW1lIGVtYmVkRm9ybShbb3B0aW9uc10pCiAqIEBwYXJhbSBvcHRpb25zCiAqIEByZXR1cm5zIHtXaWRnZXQgT2JqZWN0fQogKiBAYXBpIHB1YmxpYwogKi8KCmV4cG9ydHMuZW1iZWRGb3JtID0gZnVuY3Rpb24gKF9vcHRpb25zKSB7CiAgICB2YXIgdyA9IG5ldyBXaWRnZXQoJ2VtYmVkRm9ybScsIF9vcHRpb25zKTsKCiAgICB3LmVtYmVkZGVkX3R5cGUgPSBfb3B0aW9ucy50eXBlOwogICAgdy5mb3JtID0gbmV3IGZvcm1zLkZvcm0ody5lbWJlZGRlZF90eXBlKTsKCiAgICB3LnRvSFRNTCA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSwgcmF3LCBmaWVsZCwgb3B0aW9ucykgewoKICAgICAgICB0aGlzLmZpZWxkID0gZmllbGQ7CiAgICAgICAgdGhpcy5mb3JtLnZhbHVlcyA9IHZhbHVlOwogICAgICAgIHRoaXMucmVuZGVyX29wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSk7CgogICAgICAgIHZhciBpZCA9IHRoaXMuX2lkKAogICAgICAgICAgICBuYW1lLCAnZm9ybScsIHRoaXMucmVuZGVyX29wdGlvbnMub2Zmc2V0LAogICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJfb3B0aW9ucy5wYXRoX2V4dHJhCiAgICAgICAgKTsKICAgICAgICB2YXIgaHRtbCA9ICgKICAgICAgICAgICAgJzxkaXYgaWQ9IicgKyBpZCArICciIGNsYXNzPSJlbWJlZGRlZCBmb3JtIj4nICsKICAgICAgICAgICAgICAgICc8Zm9ybT4nICsKICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm0udG9IVE1MKAogICAgICAgICAgICAgICAgICAgICAgICBudWxsLCByZW5kZXIuZGVmYXVsdFJlbmRlcmVyKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcl9vcHRpb25zLCB0cnVlIC8qIGNyZWF0ZSBkZWZhdWx0cyAqLwogICAgICAgICAgICAgICAgICAgICkgKwogICAgICAgICAgICAgICAgJzwvZm9ybT4nICsKICAgICAgICAgICAgJzwvZGl2PicKICAgICAgICApOwogICAgICAgIHJldHVybiBodG1sOwogICAgfTsKCiAgICB3LmdldFZhbHVlID0gZnVuY3Rpb24gKGVsdCwgcGF0aCwgb3B0aW9ucykgewogICAgICAgIHZhciBjb250YWluZXJfZWx0ID0gdGhpcy5fZGlzY292ZXJDb250YWluZXJFbGVtZW50KHBhdGgpOwogICAgICAgIHZhciBmb3JtX2VsdCA9IGNvbnRhaW5lcl9lbHQuY2xvc2VzdENoaWxkKCdmb3JtJyk7CiAgICAgICAgdmFyIHJ2ID0gcXVlcnlzdHJpbmcucGFyc2UoCiAgICAgICAgICAgIGZvcm1fZWx0LnNlcmlhbGl6ZSgpLnJlcGxhY2UoL1wrL2csICclMjAnKQogICAgICAgICk7CiAgICAgICAgcmV0dXJuIHJ2OwogICAgfTsKCiAgICB3LnZhbGlkYXRlID0gZnVuY3Rpb24gKGVsdCwgcGF0aCwgb3B0aW9ucykgewogICAgICAgIHRoaXMuZm9ybS52YWxpZGF0ZSh7CiAgICAgICAgICAgIGZvcm06IHRoaXMuZ2V0VmFsdWUoZWx0LCBwYXRoLCBvcHRpb25zKSwKICAgICAgICAgICAgdXNlckN0eDogKHV0aWxzLnVzZXJDdHggfHwgdXRpbHMuY3VycmVudFJlcXVlc3QoKS51c2VyQ3R4KQogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0aGlzLmZvcm0uZXJyb3JzOwogICAgfTsKCiAgICAvKiogcHJpdmF0ZTogKiovCgogICAgdy5fZGlzY292ZXJDb250YWluZXJFbGVtZW50ID0gZnVuY3Rpb24gKHBhdGgpIHsKICAgICAgICB2YXIgaWQgPSB0aGlzLl9pZCgKICAgICAgICAgICAgcGF0aCwgJ2Zvcm0nLCB0aGlzLnJlbmRlcl9vcHRpb25zLm9mZnNldCwKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyX29wdGlvbnMucGF0aF9leHRyYQogICAgICAgICk7CiAgICAgICAgcmV0dXJuICQoJyMnICsgaWQpOwogICAgfTsKCiAgICByZXR1cm4gdzsKfTsKCi8qKgogKiBDcmVhdGVzIGEgbmV3IGRvY3VtZW50IHNlbGVjdG9yIHdpZGdldC4gVGhpcyB3aWRnZXQgYWxsb3dzIHRoZQogKiB1c2VyIHRvIHNlbGVjdCBhIGRvY3VtZW50IGZyb20gYSBDb3VjaERCIHZpZXcgKHNwZWNpZmllZCBpbiBvcHRpb25zKS4KICogVGhlIG9wdGlvbnMgYXZhaWxhYmxlIGZvciB0aGlzIHdpZGdldCBhcmUgZXhwbGFpbmVkIGJyaWVmbHkgYmVsb3c6CiAqCiAqIDx0YWJsZSBjbGFzcz0ib3B0aW9ucyI+CiAqICAgPHRyPgogKiAgICAgIDx0ZCBjbGFzcz0ibmFtZSI+dmlld05hbWU8L3RkPgogKiAgICAgIDx0ZCBjbGFzcz0idHlwZSI+U3RyaW5nPC90ZD4KICogICAgICA8dGQgY2xhc3M9ImRlc2NyaXB0aW9uIj4KICogICAgICAgICAgVGhlIG5hbWUgb2YgdGhlIENvdWNoREIgdmlldyB0aGF0IHlvdSdkIGxpa2UgdG8gc2VsZWN0CiAqICAgICAgICAgIGRvY3VtZW50cyBmcm9tLiBJZiB0aGlzIG9wdGlvbiBpcyBub3Qgc3BlY2lmaWVkLCBpdCB3aWxsCiAqICAgICAgICAgIGxvb2sgZm9yIGEgdmlldyB3aXRoIHRoZSBzYW1lIG5hbWUgYXMgdGhpcyB3aWRnZXQncyBmaWVsZC4KICogICAgICA8L3RkPgogKiAgIDwvdHI+CiAqICAgPHRyPgogKiAgICAgIDx0ZCBjbGFzcz0ibmFtZSI+ZGI8L3RkPgogKiAgICAgIDx0ZCBjbGFzcz0idHlwZSI+U3RyaW5nPC90ZD4KICogICAgICA8dGQgY2xhc3M9ImRlc2NyaXB0aW9uIj4KICogICAgICAgICAgVGhlIENvdWNoREIgZGF0YWJhc2UgY29udGFpbmluZyB0aGUgdmlldyBmb3IgdGhpcyB3aWRnZXQuIElmCiAqICAgICAgICAgIHRoaXMgb3B0aW9uIGlzIG5vdCBzcGVjaWZpZWQsIHRoZSBjdXJyZW50IGRhdGFiYXNlIHdpbGwgYmUgdXNlZC4KICogICAgICA8L3RkPgogKiAgIDwvdHI+CiAqICAgPHRyPgogKiAgICAgIDx0ZCBjbGFzcz0ibmFtZSI+dXNlSlNPTjwvdGQ+CiAqICAgICAgPHRkIGNsYXNzPSJ0eXBlIj5TdHJpbmc8L3RkPgogKiAgICAgIDx0ZCBjbGFzcz0iZGVzY3JpcHRpb24iPgogKiAgICAgICAgICBTZXQgdGhpcyBvcHRpb24gdG8gZmFsc2UgaWYgdGhpcyB3aWRnZXQgc2hvdWxkIHlpZWxkIGEgc3RyaW5nCiAqICAgICAgICAgIGNvbnRhaW5pbmcgYSBzaW5nbGUgZG9jdW1lbnQgaWQuIFNldCB0aGlzIG9wdGlvbiB0byB0cnVlICh0aGUKICogICAgICAgICAgZGVmYXVsdCkgdG8geWllbGQgYSBKU09OIHN0cmluZy4KICogICAgICA8L3RkPgogKiAgIDwvdHI+CiAqICAgPHRyPgogKiAgICAgIDx0ZCBjbGFzcz0ibmFtZSI+c3RvcmVFbnRpcmVEb2N1bWVudDwvdGQ+CiAqICAgICAgPHRkIGNsYXNzPSJ0eXBlIj5TdHJpbmc8L3RkPgogKiAgICAgIDx0ZCBjbGFzcz0iZGVzY3JpcHRpb24iPgogKiAgICAgICAgICBTZXQgdGhpcyBvcHRpb24gdG8gZmFsc2UgaWYgdGhpcyB3aWRnZXQgc2hvdWxkIHlpZWxkICpvbmx5KgogKiAgICAgICAgICBhIGRvY3VtZW50IGlkZW50aWZpZXIsIGVmZmVjdGl2ZWx5IHN0b3JpbmcgYSByZWZlcmVuY2UgdG8gYQogKiAgICAgICAgICBkb2N1bWVudC4gU2V0IHRoaXMgb3B0aW9uIHRvIHRydWUgKHRoZSBkZWZhdWx0KSB0byBpbmNsdWRlCiAqICAgICAgICAgIGFsbCBmaWVsZHMgZnJvbSB0aGUgc2VsZWN0ZWQgZG9jdW1lbnQuIElmIHVzZUpTT04gaXMgZmFsc2UsCiAqICAgICAgICAgIHRoZW4gdGhpcyBvcHRpb24gaXMgaWdub3JlZCBhbmQgdHJlYXRlZCBhcyBpZiBpdCB3ZXJlIGZhbHNlLgogKiAgICAgIDwvdGQ+CiAqICAgPC90cj4KICogPC90YWJsZT4KICoKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSBvcHRpb25zCiAqLwoKZXhwb3J0cy5kb2N1bWVudFNlbGVjdG9yID0gZnVuY3Rpb24gKF9vcHRpb25zKSB7CiAgICB2YXIgdyA9IG5ldyBXaWRnZXQoJ2RvY3VtZW50U2VsZWN0b3InLCBfb3B0aW9ucyk7CgogICAgdy5vcHRpb25zID0gXy5kZWZhdWx0cyhfb3B0aW9ucyB8fCB7fSwgewogICAgICAgIHVzZUpTT046IHRydWUsCiAgICAgICAgc3RvcmVFbnRpcmVEb2N1bWVudDogdHJ1ZQogICAgfSk7CgogICAgdy50b0hUTUwgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUsIHJhdywgZmllbGQsIG9wdGlvbnMpIHsKICAgICAgICB0aGlzLmNhY2hlSW5pdCgpOwogICAgICAgIHZhciBodG1sX25hbWUgPSB0aGlzLl9uYW1lKAogICAgICAgICAgICBuYW1lLCBvcHRpb25zLm9mZnNldAogICAgICAgICk7CiAgICAgICAgdmFyIGNvbnRhaW5lcl9pZCA9IHRoaXMuX2lkKAogICAgICAgICAgICBuYW1lLCAnc2VsZWN0b3InLCBvcHRpb25zLm9mZnNldCwgb3B0aW9ucy5wYXRoX2V4dHJhCiAgICAgICAgKTsKICAgICAgICB2YXIgaGlkZGVuX2lkID0gdGhpcy5faWQoCiAgICAgICAgICAgIG5hbWUsIG9wdGlvbnMub2Zmc2V0LCBvcHRpb25zLnBhdGhfZXh0cmEKICAgICAgICApOwogICAgICAgIHZhciBzZWxlY3RfaWQgPSB0aGlzLl9pZCgKICAgICAgICAgICAgbmFtZSwgJ3NlbGVjdCcsIG9wdGlvbnMub2Zmc2V0LCBvcHRpb25zLnBhdGhfZXh0cmEKICAgICAgICApOwogICAgICAgIHZhciBpbnB1dF9odG1sID0gKAogICAgICAgICAgICAnPGlucHV0IGNsYXNzPSJiYWNraW5nIiB0eXBlPSJoaWRkZW4iIHZhbHVlPSIiJyArCiAgICAgICAgICAgICAgICAnaWQ9IicgKyBoaWRkZW5faWQgKyAnIiBuYW1lPSInICsgaHRtbF9uYW1lICsgJyIgLz4nCiAgICAgICAgKTsKICAgICAgICB2YXIgc2VsZWN0X2h0bWwgPSAoCiAgICAgICAgICAgICc8c2VsZWN0IGNsYXNzPSJzZWxlY3RvciIgaWQ9IicgKyBzZWxlY3RfaWQgKyAnIj48L3NlbGVjdD4nCiAgICAgICAgKTsKICAgICAgICB2YXIgaHRtbCA9ICgKICAgICAgICAgICAgJzxkaXYgaWQ9IicgKyBjb250YWluZXJfaWQgKyAnIiBjbGFzcz0ic2VsZWN0b3Igd2lkZ2V0Ij4nICsKICAgICAgICAgICAgICAgIGlucHV0X2h0bWwgKyBzZWxlY3RfaHRtbCArCiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0ic3Bpbm5lciIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij48L2Rpdj4nICsKICAgICAgICAgICAgJzwvZGl2PicKICAgICAgICApOwoKICAgICAgICByZXR1cm4gaHRtbDsKICAgIH07CgogICAgdy51cGRhdGVOYW1lID0gZnVuY3Rpb24gKGVsdCwgcGF0aCwgb3B0aW9ucykgewogICAgICAgIHRoaXMuY2FjaGVJbml0KCk7CiAgICAgICAgdmFyIGhpZGRlbl9lbHQgPSB0aGlzLmRpc2NvdmVyQmFja2luZ0VsZW1lbnQoZWx0KTsKICAgICAgICB2YXIgc2VsZWN0X2VsdCA9IHRoaXMuZGlzY292ZXJTZWxlY3Rpb25FbGVtZW50KGVsdCk7CgogICAgICAgIHNlbGVjdF9lbHQuYXR0cignaWQnLCB0aGlzLl9pZCgKICAgICAgICAgICAgcGF0aCwgJ3NlbGVjdCcsIG9wdGlvbnMub2Zmc2V0LCBvcHRpb25zLnBhdGhfZXh0cmEKICAgICAgICApKTsKICAgICAgICBoaWRkZW5fZWx0LmF0dHIoJ2lkJywgdGhpcy5faWQoCiAgICAgICAgICAgIHBhdGgsIG9wdGlvbnMub2Zmc2V0LCBvcHRpb25zLnBhdGhfZXh0cmEKICAgICAgICApKTsKICAgICAgICBoaWRkZW5fZWx0LmF0dHIoJ25hbWUnLCB0aGlzLl9uYW1lKAogICAgICAgICAgICBwYXRoLCBvcHRpb25zLm9mZnNldAogICAgICAgICkpOwogICAgfTsKCiAgICB3LnVwZGF0ZVZhbHVlID0gZnVuY3Rpb24gKGVsdCwgcGF0aCwgdmFsdWUsIG9wdGlvbnMpIHsKICAgICAgICBlbHQgPSAkKGVsdCk7CiAgICAgICAgdmFsdWUgPSB0aGlzLl9zdHJpbmdpZnlfdmFsdWUodmFsdWUpOwoKICAgICAgICB2YXIgaGlkZGVuX2VsdCA9IHRoaXMuZGlzY292ZXJCYWNraW5nRWxlbWVudChlbHQpOwogICAgICAgIHZhciBzZWxlY3RfZWx0ID0gdGhpcy5kaXNjb3ZlclNlbGVjdGlvbkVsZW1lbnQoZWx0KTsKCiAgICAgICAgaGlkZGVuX2VsdC52YWwodmFsdWUpOwogICAgICAgIHNlbGVjdF9lbHQudmFsKHZhbHVlKTsKICAgIH07CgogICAgdy5nZXRWYWx1ZSA9IGZ1bmN0aW9uIChlbHQsIHBhdGgsIG9wdGlvbnMpIHsKICAgICAgICB2YXIgaGlkZGVuX2VsdCA9IHRoaXMuZGlzY292ZXJCYWNraW5nRWxlbWVudChlbHQpOwogICAgICAgIHJldHVybiB0aGlzLl9wYXJzZV92YWx1ZShoaWRkZW5fZWx0LmF0dHIoJ3ZhbHVlJykpOwogICAgfTsKCiAgICB3LmNsaWVudEluaXQgPSBmdW5jdGlvbiAoZmllbGQsIHBhdGgsIHZhbHVlLCByYXcsIGVycm9ycywgb3B0aW9ucykgewogICAgICAgIHZhciBpZCA9IHRoaXMuX2lkKAogICAgICAgICAgICBwYXRoLCAnc2VsZWN0b3InLCBvcHRpb25zLm9mZnNldCwgb3B0aW9ucy5wYXRoX2V4dHJhCiAgICAgICAgKTsKICAgICAgICB2YXIgY29udGFpbmVyX2VsdCA9ICQoJyMnICsgaWQpOwogICAgICAgIHZhciB3aWRnZXRfb3B0aW9ucyA9ICh0aGlzLm9wdGlvbnMgfHwge30pOwogICAgICAgIHZhciBzcGlubmVyX2VsdCA9IGNvbnRhaW5lcl9lbHQuY2xvc2VzdENoaWxkKCcuc3Bpbm5lcicpOwogICAgICAgIHZhciBzZWxlY3RfZWx0ID0gdGhpcy5kaXNjb3ZlclNlbGVjdGlvbkVsZW1lbnQoY29udGFpbmVyX2VsdCk7CiAgICAgICAgdmFyIGhpZGRlbl9lbHQgPSB0aGlzLmRpc2NvdmVyQmFja2luZ0VsZW1lbnQoY29udGFpbmVyX2VsdCk7CgogICAgICAgIC8qIFN0YXJ0IHByb2dyZXNzICovCiAgICAgICAgc3Bpbm5lcl9lbHQuc2hvdygpOwoKICAgICAgICAvKiBDb3B5IGRhdGEgdG8gYmFja2luZyBlbGVtZW50ICovCiAgICAgICAgc2VsZWN0X2VsdC5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGhpZGRlbl9lbHQudmFsKHNlbGVjdF9lbHQudmFsKCkpOwogICAgICAgIH0pOwoKICAgICAgICB0aGlzLnBvcHVsYXRlU2VsZWN0RWxlbWVudCgKICAgICAgICAgICAgc2VsZWN0X2VsdCwgZmllbGQsIHBhdGgsIHZhbHVlLCB3aWRnZXRfb3B0aW9ucywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc3Bpbm5lcl9lbHQuaGlkZSgpOwogICAgICAgICAgICB9CiAgICAgICAgKTsKICAgIH07CgogICAgLyoqIHByaXZhdGU6ICoqLwoKICAgIHcucG9wdWxhdGVTZWxlY3RFbGVtZW50ID0gZnVuY3Rpb24gKGVsdCwgZmllbGQsIHBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwsIG9wdGlvbnMsIGNhbGxiYWNrKSB7CgogICAgICAgIGRiLmdldFZpZXcoCiAgICAgICAgICAgIG9wdGlvbnMudmlld05hbWUsCiAgICAgICAgICAgIHsgaW5jbHVkZV9kb2NzOiBvcHRpb25zLnN0b3JlRW50aXJlRG9jdW1lbnQgfSwKICAgICAgICAgICAgeyBkYjogb3B0aW9ucy5kYiB9LAogICAgICAgICAgICB1dGlscy5iaW5kQ29udGV4dCh0aGlzLCBmdW5jdGlvbiAoZXJyLCBydikgewogICAgICAgICAgICAgICAgLyogRXJyb3IgaGFuZGxpbmcgKi8KICAgICAgICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgICdGYWlsZWQgdG8gcmVxdWVzdCBjb250ZW50IGZyb20gdmlldyBgJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnZpZXdOYW1lICsgJ2AnCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8qIE9wdGlvbiBlbGVtZW50IGZvciAnbm8gc2VsZWN0aW9uJyAqLwogICAgICAgICAgICAgICAgdmFyIG5pbF9vcHRpb24gPSAkKCc8b3B0aW9uIC8+Jyk7CiAgICAgICAgICAgICAgICBpZiAoIXZhbCkgewogICAgICAgICAgICAgICAgICAgIG5pbF9vcHRpb24uYXR0cignc2VsZWN0ZWQnLCAnc2VsZWN0ZWQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsdC5hcHBlbmQobmlsX29wdGlvbik7CgogICAgICAgICAgICAgICAgLyogQWxsIG90aGVyIG9wdGlvbiBlbGVtZW50cyAqLwogICAgICAgICAgICAgICAgXy5lYWNoKHJ2LnJvd3MgfHwgW10sIHV0aWxzLmJpbmRDb250ZXh0KHRoaXMsIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbl9lbHQgPSAkKCc8b3B0aW9uIC8+Jyk7CgogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzT3B0aW9uU2VsZWN0ZWQociwgdmFsLCBvcHRpb25zKSkgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25fZWx0LmF0dHIoJ3NlbGVjdGVkJywgJ3NlbGVjdGVkJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVPcHRpb25WYWx1ZSgKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQsIHIsIHZhbCwgb3B0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuYmluZENvbnRleHQodGhpcywgZnVuY3Rpb24gKGVyciwgdikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZhaWxlZCB0byBnZW5lcmF0ZSBpZGVudGlmaWVyIGZvcicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyBmaWVsZCBgJyArIHRoaXMuX25hbWUocGF0aCkgKyAnYCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uX2VsdC52YWwodik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25fZWx0LnRleHQoci52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHQuYXBwZW5kKG9wdGlvbl9lbHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWx0LnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgICAgfSkKICAgICAgICApOwogICAgfTsKCiAgICB3LmlzT3B0aW9uU2VsZWN0ZWQgPSBmdW5jdGlvbiAocm93LCB2YWx1ZSwgb3B0aW9ucykgewogICAgICAgIGlmIChvcHRpb25zLnVzZUpTT04pIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3RvcmVFbnRpcmVEb2N1bWVudCB8fCBvcHRpb25zLnVuaXF1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICgodmFsdWUgfHwge30pLl9pZCA9PT0gcm93LmlkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAoKHZhbHVlIHx8IHt9KS5yZWYgPT09IHJvdy5pZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gKHZhbHVlID09PSByb3cuaWQpOwogICAgICAgIH0KICAgIH07CgogICAgdy5nZW5lcmF0ZU9wdGlvblZhbHVlID0gZnVuY3Rpb24gKGZpZWxkLCByb3csIHZhbHVlLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgIGlmIChvcHRpb25zLnVzZUpTT04pIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3RvcmVFbnRpcmVEb2N1bWVudCkgewoKICAgICAgICAgICAgICAgIC8qIEVtYmVkIGFjdHVhbCBkb2N1bWVudDoKICAgICAgICAgICAgICAgICAgICBEdXBsaWNhdGVzIGFyZSBhdXRvbWF0aWNhbGx5IGRpc2FsbG93ZWQuICovCgogICAgICAgICAgICAgICAgY2FsbGJhY2soZmFsc2UsIEpTT04uc3RyaW5naWZ5KHJvdy5kb2MpKTsKCiAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy51bmlxdWUpIHsKCiAgICAgICAgICAgICAgICAvKiBSZWZlcmVuY2UsIGR1cGxpY2F0ZXMgZGlzYWxsb3dlZDoKICAgICAgICAgICAgICAgICAgICBTdG9yZSBpZCBpbnNpZGUgb2YgX2lkIGF0dHJpYnV0ZS4gKi8KCiAgICAgICAgICAgICAgICBjYWxsYmFjayhmYWxzZSwgSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgIF9pZDogcm93LmlkLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IGZpZWxkLnR5cGUubmFtZQogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICAvKiBSZWZlcmVuY2UsIGR1cGxpY2F0ZXMgYWxsb3dlZDoKICAgICAgICAgICAgICAgICAgICBTdG9yZSBpZCBpbnNpZGUgb2YgdGhlIHJlZiBhdHRyaWJ1dGUsIGFuZCBnZW5lcmF0ZQogICAgICAgICAgICAgICAgICAgIGEgbmV3IFVVSUQgZm9yIHRoZSBfaWQgYXR0cmlidXRlIGlmIGl0J3MgbmVjZXNzYXJ5LiAqLwoKICAgICAgICAgICAgICAgIHZhciByZXR1cm5fdmFsdWUgPSBmdW5jdGlvbiAodXVpZCkgewogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGZhbHNlLCBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgIF9pZDogdXVpZCwKICAgICAgICAgICAgICAgICAgICAgICAgcmVmOiByb3cuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGZpZWxkLnR5cGUubmFtZQogICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgdmFyIGZvcndhcmRfZXJyb3IgPSBmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyLCBudWxsKTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLl9pZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybl92YWx1ZSh2YWx1ZS5faWQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkYi5uZXdVVUlEKDEwMCwgZnVuY3Rpb24gKGVyciwgdXVpZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3J3YXJkX2Vycm9yKGVycik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5fdmFsdWUodXVpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICAvKiBOb3QgdXNpbmcgSlNPTjoKICAgICAgICAgICAgICAgIFRoZSB0eXBlIGlzIGEgc2NhbGFyOyBqdXN0IHVzZSB0aGUgX2lkLiAqLwoKICAgICAgICAgICAgY2FsbGJhY2soZmFsc2UsIHJvdy5pZCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgogICAgdy5jYWNoZUluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5kaXNjb3ZlckJhY2tpbmdFbGVtZW50ID0gdGhpcy5fZGlzY292ZXJCYWNraW5nRWxlbWVudDsKICAgICAgICB0aGlzLmRpc2NvdmVyU2VsZWN0aW9uRWxlbWVudCA9IHRoaXMuX2Rpc2NvdmVyU2VsZWN0aW9uRWxlbWVudDsKICAgIH07CgogICAgdy5fZGlzY292ZXJCYWNraW5nRWxlbWVudCA9IGZ1bmN0aW9uIChjb250YWluZXJfZWx0KSB7CiAgICAgICAgcmV0dXJuICQoY29udGFpbmVyX2VsdCkuY2xvc2VzdENoaWxkKCdpbnB1dFt0eXBlPWhpZGRlbl0uYmFja2luZycpOwogICAgfTsKCiAgICB3Ll9kaXNjb3ZlclNlbGVjdGlvbkVsZW1lbnQgPSBmdW5jdGlvbiAoY29udGFpbmVyX2VsdCkgewogICAgICAgIHJldHVybiAkKGNvbnRhaW5lcl9lbHQpLmNsb3Nlc3RDaGlsZCgnc2VsZWN0LnNlbGVjdG9yJyk7CiAgICB9OwoKICAgIHJldHVybiB3Owp9OwoKLyogCiAqIGNsb3Nlc3RDaGlsZCBmb3IgalF1ZXJ5CiAqIENvcHlyaWdodCAyMDExLCBUb2JpYXMgTGluZGlnCiAqIAogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBhbmQgR1BMIGxpY2Vuc2VzOgogKiAgIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwCiAqICAgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9ncGwtbGljZW5zZS5waHAKICogCiAqLwoKaWYgKHV0aWxzLmlzQnJvd3NlcigpKSB7CiAgICAoZnVuY3Rpb24gKCQpIHsKICAgICAgICAkLmZuLmNsb3Nlc3RDaGlsZCA9IGZ1bmN0aW9uIChzZWxlY3RvcikgewogICAgICAgICAgICAvKiBCcmVhZHRoLWZpcnN0IHNlYXJjaCBmb3IgdGhlIGZpcnN0IG1hdGNoZWQgbm9kZSAqLwogICAgICAgICAgICBpZiAoc2VsZWN0b3IgJiYgc2VsZWN0b3IgIT09ICcnKSB7CiAgICAgICAgICAgICAgICB2YXIgcXVldWUgPSBbXTsKICAgICAgICAgICAgICAgIHF1ZXVlLnB1c2godGhpcyk7CiAgICAgICAgICAgICAgICB3aGlsZSAocXVldWUubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHZhciBub2RlID0gcXVldWUuc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuKCk7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSAkKGNoaWxkcmVuW2ldKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLmlzKHNlbGVjdG9yKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlLnB1c2goY2hpbGQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJCgpOyAvKiBOb3RoaW5nIGZvdW5kICovCiAgICAgICAgfTsKICAgIH0oJCkpOwp9CgoKCn0pfTsKCi8qKioqKioqKioqIGthbnNvL3NldHRpbmdzICoqKioqKioqKiovCgprYW5zby5tb2R1bGVDYWNoZVsia2Fuc28vc2V0dGluZ3MiXSA9IHtsb2FkOiAoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSkgewoKbW9kdWxlLmV4cG9ydHMgPSB7Im5hbWUiOiJucmFtYSIsImxvYWQiOiJsaWIvYXBwIiwibW9kdWxlcyI6ImxpYiIsInRlbXBsYXRlcyI6InRlbXBsYXRlcyIsImF0dGFjaG1lbnRzIjpbInN0YXRpYyIsInhkbSIsImJrbXJrbHQiXSwiYmFzZV90ZW1wbGF0ZSI6ImJhc2UuaHRtbCJ9OwoKfSl9OwoKCmthbnNvLmluaXQoKTs="
        }
    },
    "kanso": {
        "templates": "var dust_module = {exports: {}};\n(function (module, exports) {\nvar dust = {};\n\n(function(dust) {\n\ndust.cache = {};\n\ndust.register = function(name, tmpl) {\n  if (!name) return;\n  dust.cache[name] = tmpl;\n};\n\ndust.render = function(name, context, callback) {\n  var chunk = new Stub(callback).head;\n  dust.load(name, chunk, Context.wrap(context)).end();\n};\n\ndust.stream = function(name, context) {\n  var stream = new Stream();\n  dust.nextTick(function() {\n    dust.load(name, stream.head, Context.wrap(context)).end();\n  });\n  return stream;\n};\n\ndust.renderSource = function(source, context, callback) {\n  return dust.compileFn(source)(context, callback);\n};\n\ndust.compileFn = function(source, name) {\n  var tmpl = dust.loadSource(dust.compile(source, name));\n  return function(context, callback) {\n    var master = callback ? new Stub(callback) : new Stream();\n    dust.nextTick(function() {\n      tmpl(master.head, Context.wrap(context)).end();\n    });\n    return master;\n  }\n};\n\ndust.load = function(name, chunk, context) {\n  var tmpl = dust.cache[name];\n  if (tmpl) {\n    return tmpl(chunk, context);\n  } else {\n    if (dust.onLoad) {\n      return chunk.map(function(chunk) {\n        dust.onLoad(name, function(err, src) {\n          if (err) return chunk.setError(err);\n          if (!dust.cache[name]) dust.loadSource(dust.compile(src, name));\n          dust.cache[name](chunk, context).end();\n        });\n      });\n    }\n    return chunk.setError(new Error(\"Template Not Found: \" + name));\n  }\n};\n\ndust.loadSource = function(source, path) {\n  return eval(source);\n};\n\nif (Array.isArray) {\n  dust.isArray = Array.isArray;\n} else {\n  dust.isArray = function(arr) {\n    return Object.prototype.toString.call(arr) == \"[object Array]\";\n  };\n}\n\ndust.nextTick = function(callback) {\n  setTimeout(callback, 0);\n}\n\ndust.isEmpty = function(value) {\n  if (dust.isArray(value) && !value.length) return true;\n  if (value === 0) return false;\n  return (!value);\n};\n\ndust.filter = function(string, auto, filters) {\n  if (filters) {\n    for (var i=0, len=filters.length; i<len; i++) {\n      var name = filters[i];\n      if (name === \"s\") {\n        auto = null;\n      } else {\n        string = dust.filters[name](string);\n      }\n    }\n  }\n  if (auto) {\n    string = dust.filters[auto](string);\n  }\n  return string;\n};\n\ndust.filters = {\n  h: function(value) { return dust.escapeHtml(value); },\n  j: function(value) { return dust.escapeJs(value); },\n  u: encodeURI,\n  uc: encodeURIComponent\n}\n\nfunction Context(stack, global, blocks) {\n  this.stack  = stack;\n  this.global = global;\n  this.blocks = blocks;\n}\n\ndust.makeBase = function(global) {\n  return new Context(new Stack(), global);\n}\n\nContext.wrap = function(context) {\n  if (context instanceof Context) {\n    return context;\n  }\n  return new Context(new Stack(context));\n}\n\nContext.prototype.get = function(key) {\n  var ctx = this.stack, value;\n\n  while(ctx) {\n    if (ctx.isObject) {\n      value = ctx.head[key];\n      if (!(value === undefined)) {\n        return value;\n      }\n    }\n    ctx = ctx.tail;\n  }\n  return this.global ? this.global[key] : undefined;\n};\n\nContext.prototype.getPath = function(cur, down) {\n  var ctx = this.stack,\n      len = down.length;\n\n  if (cur && len === 0) return ctx.head;\n  if (!ctx.isObject) return undefined;\n  ctx = ctx.head;\n  var i = 0;\n  while(ctx && i < len) {\n    ctx = ctx[down[i]];\n    i++;\n  }\n  return ctx;\n};\n\nContext.prototype.push = function(head, idx, len) {\n  return new Context(new Stack(head, this.stack, idx, len), this.global, this.blocks);\n};\n\nContext.prototype.rebase = function(head) {\n  return new Context(new Stack(head), this.global, this.blocks);\n};\n\nContext.prototype.current = function() {\n  return this.stack.head;\n};\n\nContext.prototype.getBlock = function(key) {\n  var blocks = this.blocks;\n\n  if (!blocks) return;\n  var len = blocks.length, fn;\n  while (len--) {\n    fn = blocks[len][key];\n    if (fn) return fn;\n  }\n}\n\nContext.prototype.shiftBlocks = function(locals) {\n  var blocks = this.blocks;\n\n  if (locals) {\n    if (!blocks) {\n      newBlocks = [locals];\n    } else {\n      newBlocks = blocks.concat([locals]);\n    }\n    return new Context(this.stack, this.global, newBlocks);\n  }\n  return this;\n}\n\nfunction Stack(head, tail, idx, len) {\n  this.tail = tail;\n  this.isObject = !dust.isArray(head) && head && typeof head === \"object\";\n  this.head = head;\n  this.index = idx;\n  this.of = len;\n}\n\nfunction Stub(callback) {\n  this.head = new Chunk(this);\n  this.callback = callback;\n  this.out = '';\n}\n\nStub.prototype.flush = function() {\n  var chunk = this.head;\n\n  while (chunk) {\n    if (chunk.flushable) {\n      this.out += chunk.data;\n    } else if (chunk.error) {\n      this.callback(chunk.error);\n      this.flush = function() {};\n      return;\n    } else {\n      return;\n    }\n    chunk = chunk.next;\n    this.head = chunk;\n  }\n  this.callback(null, this.out);\n}\n\nfunction Stream() {\n  this.head = new Chunk(this);\n}\n\nStream.prototype.flush = function() {\n  var chunk = this.head;\n\n  while(chunk) {\n    if (chunk.flushable) {\n      this.emit('data', chunk.data);\n    } else if (chunk.error) {\n      this.emit('error', chunk.error);\n      this.flush = function() {};\n      return;\n    } else {\n      return;\n    }\n    chunk = chunk.next;\n    this.head = chunk;\n  }\n  this.emit('end');\n}\n\nStream.prototype.emit = function(type, data) {\n  var events = this.events;\n\n  if (events && events[type]) {\n    events[type](data);\n  }\n}\n\nStream.prototype.on = function(type, callback) {\n  if (!this.events) {\n    this.events = {};\n  }\n  this.events[type] = callback;\n  return this;\n}\n\nfunction Chunk(root, next, taps) {\n  this.root = root;\n  this.next = next;\n  this.data = '';\n  this.flushable = false;\n  this.taps = taps;\n}\n\nChunk.prototype.write = function(data) {\n  var taps  = this.taps;\n\n  if (taps) {\n    data = taps.go(data);\n  }\n  this.data += data;\n  return this;\n}\n\nChunk.prototype.end = function(data) {\n  if (data) {\n    this.write(data);\n  }\n  this.flushable = true;\n  this.root.flush();\n  return this;\n}\n\nChunk.prototype.map = function(callback) {\n  var cursor = new Chunk(this.root, this.next, this.taps),\n      branch = new Chunk(this.root, cursor, this.taps);\n\n  this.next = branch;\n  this.flushable = true;\n  callback(branch);\n  return cursor;\n}\n\nChunk.prototype.tap = function(tap) {\n  var taps = this.taps;\n\n  if (taps) {\n    this.taps = taps.push(tap);\n  } else {\n    this.taps = new Tap(tap);\n  }\n  return this;\n}\n\nChunk.prototype.untap = function() {\n  this.taps = this.taps.tail;\n  return this;\n}\n\nChunk.prototype.render = function(body, context) {\n  return body(this, context);\n}\n\nChunk.prototype.reference = function(elem, context, auto, filters) {\n  if (typeof elem === \"function\") {\n    elem = elem(this, context, null, {auto: auto, filters: filters});\n    if (elem instanceof Chunk) {\n      return elem;\n    }\n  }\n  if (!dust.isEmpty(elem)) {\n    return this.write(dust.filter(elem, auto, filters));\n  } else {\n    return this;\n  }\n};\n\nChunk.prototype.section = function(elem, context, bodies, params) {\n  if (typeof elem === \"function\") {\n    elem = elem(this, context, bodies, params);\n    if (elem instanceof Chunk) {\n      return elem;\n    }\n  }\n\n  var body = bodies.block,\n      skip = bodies['else'];\n\n  if (params) {\n    context = context.push(params);\n  }\n\n  if (dust.isArray(elem)) {\n    if (body) {\n      var len = elem.length, chunk = this;\n      for (var i=0; i<len; i++) {\n        chunk = body(chunk, context.push(elem[i], i, len));\n      }\n      return chunk;\n    }\n  } else if (elem === true) {\n    if (body) return body(this, context);\n  } else if (elem || elem === 0) {\n    if (body) return body(this, context.push(elem));\n  } else if (skip) {\n    return skip(this, context);\n  }\n  return this;\n};\n\nChunk.prototype.exists = function(elem, context, bodies) {\n  var body = bodies.block,\n      skip = bodies['else'];\n\n  if (!dust.isEmpty(elem)) {\n    if (body) return body(this, context);\n  } else if (skip) {\n    return skip(this, context);\n  }\n  return this;\n}\n\nChunk.prototype.notexists = function(elem, context, bodies) {\n  var body = bodies.block,\n      skip = bodies['else'];\n\n  if (dust.isEmpty(elem)) {\n    if (body) return body(this, context);\n  } else if (skip) {\n    return skip(this, context);\n  }\n  return this;\n}\n\nChunk.prototype.block = function(elem, context, bodies) {\n  var body = bodies.block;\n\n  if (elem) {\n    body = elem;\n  }\n\n  if (body) {\n    return body(this, context);\n  }\n  return this;\n};\n\nChunk.prototype.partial = function(elem, context) {\n  if (typeof elem === \"function\") {\n    return this.capture(elem, context, function(name, chunk) {\n      dust.load(name, chunk, context).end();\n    });\n  }\n  return dust.load(elem, this, context);\n};\n\nChunk.prototype.helper = function(name, context, bodies, params) {\n  return dust.helpers[name](this, context, bodies, params);\n};\n\nChunk.prototype.capture = function(body, context, callback) {\n  return this.map(function(chunk) {\n    var stub = new Stub(function(err, out) {\n      if (err) {\n        chunk.setError(err);\n      } else {\n        callback(out, chunk);\n      }\n    });\n    body(stub.head, context).end();\n  });\n};\n\nChunk.prototype.setError = function(err) {\n  this.error = err;\n  this.root.flush();\n  return this;\n};\n\ndust.helpers = {\n  sep: function(chunk, context, bodies) {\n    if (context.stack.index === context.stack.of - 1) {\n      return chunk;\n    }\n    return bodies.block(chunk, context);\n  },\n\n  idx: function(chunk, context, bodies) {\n    return bodies.block(chunk, context.push(context.stack.index));\n  }\n}\n\nfunction Tap(head, tail) {\n  this.head = head;\n  this.tail = tail;\n}\n\nTap.prototype.push = function(tap) {\n  return new Tap(tap, this);\n};\n\nTap.prototype.go = function(value) {\n  var tap = this;\n\n  while(tap) {\n    value = tap.head(value);\n    tap = tap.tail;\n  }\n  return value;\n};\n\nvar HCHARS = new RegExp(/[&<>\\\"]/),\n    AMP    = /&/g,\n    LT     = /</g,\n    GT     = />/g,\n    QUOT   = /\\\"/g;\n\ndust.escapeHtml = function(s) {\n  if (typeof s === \"string\") {\n    if (!HCHARS.test(s)) {\n      return s;\n    }\n    return s.replace(AMP,'&amp;').replace(LT,'&lt;').replace(GT,'&gt;').replace(QUOT,'&quot;');\n  }\n  return s;\n};\n\nvar BS = /\\\\/g,\n    CR = /\\r/g,\n    LS = /\\u2028/g,\n    PS = /\\u2029/g,\n    NL = /\\n/g,\n    LF = /\\f/g,\n    SQ = /'/g,\n    DQ = /\"/g,\n    TB = /\\t/g;\n\ndust.escapeJs = function(s) {\n  if (typeof s === \"string\") {\n    return s\n      .replace(BS, '\\\\\\\\')\n      .replace(DQ, '\\\\\"')\n      .replace(SQ, \"\\\\'\")\n      .replace(CR, '\\\\r')\n      .replace(LS, '\\\\u2028')\n      .replace(PS, '\\\\u2029')\n      .replace(NL, '\\\\n')\n      .replace(LF, '\\\\f')\n      .replace(TB, \"\\\\t\");\n  }\n  return s;\n};\n\n})(dust);\n\nif (typeof exports !== \"undefined\") {\n  if (typeof process !== \"undefined\") {\n      require('./server')(dust);\n  }\n  module.exports = dust;\n}\n(function(){dust.register(\"404.html\",body_0);function body_0(chk,ctx){return chk.write(\"<h1>404 - Not Found</h1>\").write(\"\\n\");}return body_0;})();(function(){dust.register(\"all_users.html\",body_0);function body_0(chk,ctx){return chk.write(\"<h1>note-o-rama users</h1>\").write(\"\\n\").write(\"\\n\").write(\"<ul class=\\\"users\\\">\").write(\"\\n  \").section(ctx.get(\"users\"),ctx,{\"block\":body_1},null).write(\"\\n\").write(\"</ul>\").write(\"\\n\");}function body_1(chk,ctx){return chk.write(\"\\n    \").write(\"<li class=\\\"user-line\\\">\").write(\"\\n        \").write(\"<h2 class=\\\"user-line\\\"><a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.get(\"user_id\"),ctx,\"h\",[\"uc\"]).write(\"\\\" class=\\\"user_id\\\">\").reference(ctx.get(\"user_id\"),ctx,\"h\").write(\"</a></h2>\").write(\"\\n        \").write(\"<div class='updated-line'>\").write(\"\\n            \").write(\"Updated <abbr class=\\\"updated_time _timeago\\\" title=\\\"\").reference(ctx.get(\"updated_time\"),ctx,\"h\").write(\"\\\">\").reference(ctx.get(\"updated_time\"),ctx,\"h\").write(\"</abbr>.\").write(\"\\n        \").write(\"</div>\").write(\"\\n    \").write(\"</li>\").write(\"\\n    \");}return body_0;})();(function(){dust.register(\"authors.html\",body_0);var blocks={what:body_1};function body_0(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.partial(\"user_header.html\",ctx).write(\"\\n\").write(\"\\n\").write(\"<div class=\\\"navigation\\\">\").write(\"\\n    \").write(\"--\").write(\"\\n    \").notexists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_5},null).write(\"\\n    \").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_8},null).write(\"\\n\").write(\"</div>\").write(\"\\n\").write(\"\\n\").write(\"\\n\").section(ctx.get(\"authors\"),ctx,{\"block\":body_11},null).write(\"\\n\").notexists(ctx.get(\"authors\"),ctx,{\"block\":body_16},null).write(\"\\n\");}function body_1(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.exists(ctx.get(\"query_author\"),ctx,{\"else\":body_2,\"block\":body_4},null);}function body_2(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.exists(ctx.get(\"query_user\"),ctx,{\"block\":body_3},null).write(\"authors\");}function body_3(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.reference(ctx.getPath(false,[\"authors\",\"length\"]),ctx,\"h\").write(\" \");}function body_4(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"sources\");}function body_5(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").exists(ctx.get(\"query_user\"),ctx,{\"block\":body_6},null).write(\"\\n    \");}function body_6(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"see \").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/sources\\\">\").reference(ctx.get(\"query_user\"),ctx,\"h\").write(\"'s sources</a> or\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/tags\\\">tags</a>\").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_7},null).write(\"\\n        \");}function body_7(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"; <br />-- \");}function body_8(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").write(\"go to \").write(\"\\n        \").notexists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_9},null).write(\"\\n        \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/sources\\\">\").exists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_10},null).write(\"sources</a> or\").write(\"\\n        \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/tags\\\">tags</a>\").write(\"\\n    \");}function body_9(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/authors\\\">your authors</a>,\").write(\"\\n        \");}function body_10(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"your \");}function body_11(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n    \").write(\"<h1>\").write(\"\\n        \").reference(ctx.get(\"author_name\"),ctx,\"h\").write(\"\\n    \").write(\"</h1>\").write(\"\\n\").write(\"\\n    \").write(\"<ul class=\\\"sources\\\">\").write(\"\\n        \").section(ctx.get(\"sources\"),ctx,{\"block\":body_12},null).write(\"\\n    \").write(\"</ul>\").write(\"\\n\");}function body_12(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"<li class=\\\"source\\\">\").write(\"\\n                \").write(\"<div class=\\\"title-line\\\">\").write(\"\\n                    \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.get(\"user_id\"),ctx,\"h\",[\"uc\"]).write(\"/sources/\").reference(ctx.get(\"page_id\"),ctx,\"h\",[\"uc\"]).write(\"\\\">\").reference(ctx.get(\"TITLE\"),ctx,\"h\").reference(ctx.get(\"page_title\"),ctx,\"h\").notexists(ctx.get(\"TITLE\"),ctx,{\"block\":body_13},null).write(\"</a>\").write(\"\\n                    \").write(\"\\n                    \").exists(ctx.get(\"YEAR\"),ctx,{\"block\":body_15},null).write(\"\\n                    \").write(\"\\n                    \").write(\"\\n                \").write(\"</div>\").write(\"\\n                \").write(\"<div class=\\\"citation\\\">\").partial(\"bibliographic_details.html\",ctx).write(\"</div>\").write(\"\\n            \").write(\"</li>\").write(\"\\n        \");}function body_13(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.notexists(ctx.get(\"page_title\"),ctx,{\"block\":body_14},null);}function body_14(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"untitled\");}function body_15(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"(<span class=\\\"year\\\">\").reference(ctx.get(\"YEAR\"),ctx,\"h\").write(\"</span>)\");}function body_16(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n    \").notexists(ctx.get(\"query_author\"),ctx,{\"block\":body_17},null).write(\"\\n\");}function body_17(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").exists(ctx.get(\"query_user\"),ctx,{\"block\":body_18},null).write(\"\\n    \");}function body_18(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"<p>\").exists(ctx.get(\"is_users_own_page\"),ctx,{\"else\":body_19,\"block\":body_20},null).write(\" no sources with authors yet.</a>\").write(\"\\n        \");}function body_19(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.reference(ctx.get(\"query_user\"),ctx,\"h\").write(\" has\");}function body_20(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"You have\");}return body_0;})();(function(){dust.register(\"base.html\",body_0);function body_0(chk,ctx){return chk.write(\"<!DOCTYPE html PUBLIC \\\"-//W3C//DTD XHTML 1.0 Strict//EN\\\" \\\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\\\"> \").write(\"\\n\").write(\"<html xmlns=\\\"http://www.w3.org/1999/xhtml\\\" xml:lang=\\\"en\\\" lang=\\\"en\\\"> \").write(\"\\n  \").write(\"<head> \").write(\"\\n    \").write(\"<meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html; charset=UTF-8\\\" /> \").write(\"\\n    \").write(\"<link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/static/style.css\\\" />\").write(\"\\n    \").write(\"<title>\").reference(ctx.get(\"title\"),ctx,\"h\").write(\"</title> \").write(\"\\n  \").write(\"</head> \").write(\"\\n  \").write(\"<body>\").write(\"\\n    \").write(\"\\n    \").write(\"<!-- session management -->\").write(\"\\n    \").write(\"<div id=\\\"session-container\\\">\").write(\"\\n      \").write(\"<div id=\\\"nrama_logo\\\"><a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"\\\">Note-o-rama</a></div>\").write(\"\\n      \").partial(\"session.html\",ctx).write(\"\\n    \").write(\"</div>\").write(\"\\n\").write(\"\\n    \").write(\"<div id=\\\"content\\\">\").write(\"\\n      \").reference(ctx.get(\"content\"),ctx,\"h\",[\"s\"]).write(\"\\n    \").write(\"</div>\").write(\"\\n    \").write(\"<script src=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/static/js/jquery-1.5.2.min.js\\\"></script>\").write(\"\\n    \").write(\"<script src=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/static/js/jquery-ui.min.js\\\"></script>\").write(\"\\n    \").write(\"<script src=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/static/js/json2.js\\\"></script>\").write(\"\\n    \").write(\"<script src=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/static/js/jquery.simplemodal-1.4.1.js\\\"></script>\").write(\"\\n    \").write(\"<script src=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/static/js/jquery.autogrow-textarea.js\\\"></script>\").write(\"\\n    \").write(\"<script src=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/static/js/jquery.sortlist.js\\\"></script>\").write(\"\\n    \").write(\"<script src=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/static/js/jquery.timeago.js\\\"></script>\").write(\"\\n    \").write(\"<script src=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/static/js/jquery.jqcloud.min.js\\\"></script>\").write(\"\\n    \").write(\"<script src=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/kanso.js\\\"></script>\").write(\"\\n    \").write(\"\\n  \").write(\"</body>\").write(\"\\n\").write(\"</html>\").write(\"\\n\");}return body_0;})();(function(){dust.register(\"bibliographic_details.html\",body_0);function body_0(chk,ctx){return chk.write(\"<div class=\\\"bibliographic-details\\\">\").write(\"\\n    \").exists(ctx.get(\"AUTHOR\"),ctx,{\"block\":body_1},null).write(\"\\n    \").exists(ctx.get(\"JOURNAL\"),ctx,{\"block\":body_5},null).write(\"\\n    \").exists(ctx.get(\"BOOKTITLE\"),ctx,{\"block\":body_7},null).write(\"\\n    \").exists(ctx.get(\"url\"),ctx,{\"block\":body_10},null).write(\"\\n    \").exists(ctx.get(\"updated_time\"),ctx,{\"block\":body_11},null).write(\"\\n\").write(\"</div>\");}function body_1(chk,ctx){return chk.write(\"\\n        \").write(\"<div class=\\\"authors\\\">\").write(\"\\n            \").section(ctx.get(\"AUTHOR\"),ctx,{\"block\":body_2},null).write(\".\").write(\"\\n        \").write(\"</div>\").write(\"\\n    \");}function body_2(chk,ctx){return chk.write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/authors/\").reference(ctx.getPath(true,[]),ctx,\"h\",[\"uc\"]).write(\"\\\"\").write(\"\\n                        \").write(\"class=\\\"author author_\").helper(\"idx\",ctx,{\"block\":body_3},null).write(\"\\\"\").write(\"\\n                    \").write(\">\").reference(ctx.getPath(true,[]),ctx,\"h\").write(\"</a>\").helper(\"sep\",ctx,{\"block\":body_4},null);}function body_3(chk,ctx){return chk.reference(ctx.getPath(true,[]),ctx,\"h\");}function body_4(chk,ctx){return chk.write(\" and \");}function body_5(chk,ctx){return chk.write(\"\\n        \").write(\"<div>\").write(\"\\n            \").write(\"<span class=\\\"journal\\\">\").reference(ctx.get(\"JOURNAL\"),ctx,\"h\").write(\"</span>\").write(\"\\n            \").reference(ctx.get(\"VOLUME\"),ctx,\"h\").write(\"(\").reference(ctx.get(\"NUMBER\"),ctx,\"h\").write(\").\").write(\"\\n            \").exists(ctx.get(\"PAGES\"),ctx,{\"block\":body_6},null).write(\"\\n        \").write(\"</div>\").write(\"\\n    \");}function body_6(chk,ctx){return chk.write(\"\\n                \").write(\"pp. <span class=\\\"PAGES\\\">\").reference(ctx.get(\"PAGES\"),ctx,\"h\").write(\"</span>.\").write(\"\\n            \");}function body_7(chk,ctx){return chk.write(\"\\n        \").write(\"<div>\").write(\"\\n            \").write(\"In <span class=\\\"booktitle\\\">\").reference(ctx.get(\"BOOKTITLE\"),ctx,\"h\").write(\"</span>\").write(\"\\n            \").exists(ctx.get(\"EDITOR\"),ctx,{\"block\":body_8},null).write(\"\\n            \").write(\"<span class=\\\"publisher\\\">\").reference(ctx.get(\"PUBLISHER\"),ctx,\"h\").write(\"</span>:\").write(\"\\n            \").write(\"<span class=\\\"address\\\">\").reference(ctx.get(\"ADDRESS\"),ctx,\"h\").write(\"</span>.\").write(\"\\n            \").exists(ctx.get(\"PAGES\"),ctx,{\"block\":body_9},null).write(\"\\n        \").write(\"</div>\").write(\"\\n    \");}function body_8(chk,ctx){return chk.write(\"\\n                \").write(\"(eds.) <span class=\\\"editor\\\">\").reference(ctx.get(\"EDITOR\"),ctx,\"h\").write(\"</span>.\").write(\"\\n            \");}function body_9(chk,ctx){return chk.write(\"\\n                \").write(\"pp. <span class=\\\"PAGES\\\">\").reference(ctx.get(\"PAGES\"),ctx,\"h\").write(\"</span>.\").write(\"\\n            \");}function body_10(chk,ctx){return chk.write(\"\\n        \").write(\"<div>\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"url\"),ctx,\"h\").write(\"\\\" target=\\\"_blank\\\" class=\\\"title\\\">\").reference(ctx.get(\"url\"),ctx,\"h\").write(\"</a>\").write(\"\\n        \").write(\"</div>\").write(\"\\n    \");}function body_11(chk,ctx){return chk.write(\"\\n        \").write(\"<div>\").write(\"\\n            \").write(\"Updated <abbr class=\\\"_timeago\\\" title=\\\"\").reference(ctx.get(\"updated_time\"),ctx,\"h\").write(\"\\\">\").reference(ctx.get(\"updated_time\"),ctx,\"h\").write(\"</abbr>.\").write(\"\\n        \").write(\"</div>\").write(\"\\n    \");}return body_0;})();(function(){dust.register(\"bibliographic_details_compact.html\",body_0);function body_0(chk,ctx){return chk.write(\"<div class=\\\"bibliographic-details compact\\\">\").write(\"\\n    \").write(\"<div>\").write(\"\\n        \").write(\"&mdash;\").write(\"\\n        \").exists(ctx.get(\"AUTHOR\"),ctx,{\"block\":body_1},null).write(\"\\n        \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/sources/\").reference(ctx.get(\"page_id\"),ctx,\"h\",[\"uc\"]).write(\"\\\">\").write(\"\\n            \").reference(ctx.get(\"TITLE\"),ctx,\"h\").notexists(ctx.get(\"TITLE\"),ctx,{\"block\":body_6},null).write(\"\\n        \").write(\"</a>\").write(\"\\n    \").write(\"</div>\").write(\"\\n    \").write(\"<div>\").write(\"\\n        \").exists(ctx.get(\"JOURNAL\"),ctx,{\"block\":body_8},null).write(\"\\n        \").exists(ctx.get(\"BOOKTITLE\"),ctx,{\"block\":body_10},null).write(\"\\n    \").write(\"</div>\").write(\"\\n    \").write(\"<div>\").write(\"\\n        \").exists(ctx.get(\"url\"),ctx,{\"block\":body_13},null).write(\"\\n    \").write(\"</div>\").write(\"\\n    \").exists(ctx.get(\"updated_time\"),ctx,{\"block\":body_14},null).write(\"\\n\").write(\"</div>\");}function body_1(chk,ctx){return chk.write(\"\\n            \").write(\"<span class=\\\"authors\\\">\").write(\"\\n                \").section(ctx.get(\"AUTHOR\"),ctx,{\"block\":body_2},null).write(\".\").write(\"\\n            \").write(\"</span>\").write(\"\\n            \").exists(ctx.get(\"YEAR\"),ctx,{\"block\":body_5},null).write(\"\\n        \");}function body_2(chk,ctx){return chk.write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/authors/\").reference(ctx.getPath(true,[]),ctx,\"h\",[\"uc\"]).write(\"\\\"\").write(\"\\n                            \").write(\"class=\\\"author author_\").helper(\"idx\",ctx,{\"block\":body_3},null).write(\"\\\"\").write(\"\\n                        \").write(\">\").reference(ctx.getPath(true,[]),ctx,\"h\").write(\"</a>\").helper(\"sep\",ctx,{\"block\":body_4},null);}function body_3(chk,ctx){return chk.reference(ctx.getPath(true,[]),ctx,\"h\");}function body_4(chk,ctx){return chk.write(\" and \");}function body_5(chk,ctx){return chk.write(\"(<span class=\\\"year\\\">\").reference(ctx.get(\"YEAR\"),ctx,\"h\").write(\"</span>)\");}function body_6(chk,ctx){return chk.reference(ctx.get(\"page_title\"),ctx,\"h\").notexists(ctx.get(\"page_title\"),ctx,{\"block\":body_7},null);}function body_7(chk,ctx){return chk.write(\"untitled\");}function body_8(chk,ctx){return chk.write(\"\\n            \").write(\"<span>\").write(\"\\n                \").write(\"<span class=\\\"journal\\\">\").reference(ctx.get(\"JOURNAL\"),ctx,\"h\").write(\"</span>\").write(\"\\n                \").reference(ctx.get(\"VOLUME\"),ctx,\"h\").write(\"(\").reference(ctx.get(\"NUMBER\"),ctx,\"h\").write(\").\").write(\"\\n                \").exists(ctx.get(\"PAGES\"),ctx,{\"block\":body_9},null).write(\"\\n            \").write(\"</span>\").write(\"\\n        \");}function body_9(chk,ctx){return chk.write(\"\\n                    \").write(\"pp. <span class=\\\"PAGES\\\">\").reference(ctx.get(\"PAGES\"),ctx,\"h\").write(\"</span>.\").write(\"\\n                \");}function body_10(chk,ctx){return chk.write(\"\\n            \").write(\"<span>\").write(\"\\n                \").write(\"In <span class=\\\"booktitle\\\">\").reference(ctx.get(\"BOOKTITLE\"),ctx,\"h\").write(\"</span>\").write(\"\\n                \").exists(ctx.get(\"EDITOR\"),ctx,{\"block\":body_11},null).write(\"\\n                \").write(\"<span class=\\\"publisher\\\">\").reference(ctx.get(\"PUBLISHER\"),ctx,\"h\").write(\"</span>:\").write(\"\\n                \").write(\"<span class=\\\"address\\\">\").reference(ctx.get(\"ADDRESS\"),ctx,\"h\").write(\"</span>.\").write(\"\\n                \").exists(ctx.get(\"PAGES\"),ctx,{\"block\":body_12},null).write(\"\\n            \").write(\"</span>\").write(\"\\n        \");}function body_11(chk,ctx){return chk.write(\"\\n                    \").write(\"(eds.) <span class=\\\"editor\\\">\").reference(ctx.get(\"EDITOR\"),ctx,\"h\").write(\"</span>.\").write(\"\\n                \");}function body_12(chk,ctx){return chk.write(\"\\n                    \").write(\"pp. <span class=\\\"PAGES\\\">\").reference(ctx.get(\"PAGES\"),ctx,\"h\").write(\"</span>.\").write(\"\\n                \");}function body_13(chk,ctx){return chk.write(\"\\n            \").write(\"<span>\").write(\"\\n                \").write(\"<a href=\\\"\").reference(ctx.get(\"url\"),ctx,\"h\").write(\"\\\" target=\\\"_blank\\\" class=\\\"title\\\">\").reference(ctx.get(\"url\"),ctx,\"h\").write(\"</a>\").write(\"\\n            \").write(\"</span>\").write(\"\\n        \");}function body_14(chk,ctx){return chk.write(\"\\n        \").write(\"<div>\").write(\"\\n            \").write(\"Updated <abbr class=\\\"_timeago\\\" title=\\\"\").reference(ctx.get(\"updated_time\"),ctx,\"h\").write(\"\\\">\").reference(ctx.get(\"updated_time\"),ctx,\"h\").write(\"</abbr>.\").write(\"\\n        \").write(\"</div>\").write(\"\\n    \");}return body_0;})();(function(){dust.register(\"flow.html\",body_0);var blocks={what:body_1};function body_0(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.partial(\"user_header.html\",ctx).write(\"\\n\").write(\"\\n\").write(\"<div class=\\\"navigation\\\" >\").write(\"\\n    \").notexists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_2},null).write(\"\\n    \").write(\"\\n    \").notexists(ctx.get(\"is_users_own_page\"),ctx,{\"else\":body_11,\"block\":body_13},null).write(\"\\n\").write(\"\\n\").write(\"</div>\").write(\"\\n\").write(\"\\n\").exists(ctx.get(\"query_tag\"),ctx,{\"block\":body_18},null).write(\"\\n    \").write(\"\\n\").write(\"\\n\").section(ctx.get(\"quotes\"),ctx,{\"block\":body_19},null).write(\"\\n\").write(\"\\n\").write(\"\\n\").write(\"\\n\").partial(\"footer_event.html\",ctx);}function body_1(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"notes\");}function body_2(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_3},null).write(\"\\n    \");}function body_3(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").exists(ctx.get(\"query_user\"),ctx,{\"else\":body_4,\"block\":body_8},null).write(\"\\n        \");}function body_4(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").notexists(ctx.get(\"no_sources\"),ctx,{\"block\":body_5},null).write(\"\\n            \");}function body_5(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                    \").write(\"-- see &amp; edit <a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).reference(ctx.get(\"query_source_url\"),ctx,\"h\").reference(ctx.get(\"query_tag_url\"),ctx,\"h\").write(\"\\\">only your notes \").exists(ctx.get(\"query_tag\"),ctx,{\"block\":body_6},null).exists(ctx.get(\"query_source\"),ctx,{\"block\":body_7},null).write(\"</a>; <br />\").write(\"\\n                \");}function body_6(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"with this tag\");}function body_7(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"on this source\");}function body_8(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").write(\"-- see &amp; edit <a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).reference(ctx.get(\"query_source_url\"),ctx,\"h\").reference(ctx.get(\"query_tag_url\"),ctx,\"h\").write(\"\\\">your notes \").exists(ctx.get(\"query_tag\"),ctx,{\"block\":body_9},null).exists(ctx.get(\"query_source\"),ctx,{\"block\":body_10},null).write(\"</a>; <br />\").write(\"\\n            \");}function body_9(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"with this tag\");}function body_10(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"on this source\");}function body_11(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_12},null).write(\"\\n    \");}function body_12(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"--        \").write(\"\\n            \").write(\"go to \").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/sources\\\">your sources</a>,\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/authors\\\">authors</a> or\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/tags\\\">tags</a> \").write(\"\\n        \");}function body_13(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").exists(ctx.get(\"query_user\"),ctx,{\"else\":body_14,\"block\":body_16},null).write(\"\\n    \");}function body_14(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"\\n            \").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_15},null).write(\"\\n        \");}function body_15(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").write(\"--        \").write(\"\\n                \").write(\"go to \").write(\"\\n                \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/sources\\\">your sources</a>,\").write(\"\\n                \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/authors\\\">authors</a> or\").write(\"\\n                \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/tags\\\">tags</a> \").write(\"\\n            \");}function body_16(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"--        \").write(\"\\n            \").write(\"see\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/sources\\\">\").reference(ctx.get(\"query_user\"),ctx,\"h\").write(\"'s sources</a>,\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/authors\\\">authors</a> or\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/tags\\\">tags</a>\").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_17},null).write(\"\\n        \");}function body_17(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"; \");}function body_18(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n    \").write(\"<h1>#\").reference(ctx.get(\"query_tag\"),ctx,\"h\").write(\"</h1>\").write(\"\\n\");}function body_19(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n    \").write(\"<div class=\\\"_nrama-quote\\\" id=\\\"\").reference(ctx.get(\"hash\"),ctx,\"h\").write(\"\\\" >\").write(\"\\n        \").write(\"<div class=\\\"quote-line flow\\\">\").write(\"\\n            \").write(\"\\\"<span class=\\\"quote-content\\\">\").reference(ctx.get(\"content\"),ctx,\"h\").write(\"</span>\\\"\").write(\"\\n            \").write(\"\\n            \").exists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_20},null).write(\"\\n        \").write(\"</div>\").write(\"\\n        \").write(\"\\n        \").write(\"<div class=\\\"source-for-single-quote\\\">\").write(\"\\n            \").section(ctx.get(\"source\"),ctx,{\"block\":body_21},null).write(\"\\n            \").write(\"<div class=\\\"cited-by\\\">\").write(\"\\n                \").notexists(ctx.get(\"query_user\"),ctx,{\"block\":body_22},null).write(\"\\n            \").write(\"</div>\").write(\"\\n        \").write(\"</div>\").write(\"\\n        \").write(\"<ul class=\\\"notes _sort-me \").notexists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_25},null).write(\"\\\">\").write(\"\\n            \").section(ctx.get(\"notes\"),ctx,{\"block\":body_26},null).write(\"\\n        \").write(\"</ul>\").write(\"\\n    \").write(\"</div>\").write(\"\\n\");}function body_20(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").write(\"<a class=\\\"add-a-note\\\">[+]</a>\").write(\"\\n                \").write(\"\\n            \");}function body_21(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").partial(\"bibliographic_details_compact.html\",ctx).write(\"\\n            \");}function body_22(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                    \").write(\"[cited by\").write(\"\\n                    \").section(ctx.get(\"users\"),ctx,{\"block\":body_23},null).write(\"]\").write(\"\\n                \");}function body_23(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                        \").write(\"<span class='quote-user_id'><a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(true,[]),ctx,\"h\",[\"uc\"]).write(\"\\\">\").reference(ctx.getPath(true,[]),ctx,\"h\").write(\"</a></span>\").helper(\"sep\",ctx,{\"block\":body_24},null).write(\"\\n                    \");}function body_24(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\", \");}function body_25(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"_not_user_page\");}function body_26(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").write(\"<li id=\\\"\").reference(ctx.get(\"_id\"),ctx,\"h\").write(\"\\\" class=\\\"_nrama-note\\\">\").write(\"\\n                    \").exists(ctx.get(\"is_users_own_page\"),ctx,{\"else\":body_27,\"block\":body_29},null).write(\"\\n                \").write(\"</li>\").write(\"\\n            \");}function body_27(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                        \").notexists(ctx.get(\"query_user\"),ctx,{\"block\":body_28},null).write(\"\\n                        \").write(\"<span class=\\\"_nrama-note-content\\\">\").reference(ctx.get(\"content\"),ctx,\"h\").write(\"</span>\").write(\"\\n                    \");}function body_28(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                            \").write(\"<span class='quote-user_id'><a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.get(\"user_id\"),ctx,\"h\",[\"uc\"]).write(\"\\\">\").reference(ctx.get(\"user_id\"),ctx,\"h\").write(\"</a></span>]\").write(\"\\n                        \");}function body_29(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                        \").write(\"<textarea class=\\\"_nrama-note-content\\\" rows=\\\"1\\\">\").reference(ctx.get(\"content\"),ctx,\"h\").write(\"</textarea>\").write(\"\\n                    \");}return body_0;})();(function(){dust.register(\"footer_event.html\",body_0);function body_0(chk,ctx){return chk.write(\"<script>\").write(\"\\n    \").write(\"if( typeof $ !== 'undefined' ) {\").write(\"\\n        \").write(\"$(document).trigger('nrama_page_loaded');\").write(\"\\n    \").write(\"}\").write(\"\\n\").write(\"</script>\").write(\"\\n\").write(\"\\n\");}return body_0;})();(function(){dust.register(\"quotes.html\",body_0);var blocks={what:body_1};function body_0(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.partial(\"user_header.html\",ctx).write(\"\\n\").write(\"\\n\").write(\"<div class=\\\"navigation\\\" >\").write(\"\\n    \").exists(ctx.get(\"is_users_own_page\"),ctx,{\"else\":body_2,\"block\":body_14},null).write(\"\\n    \").write(\"\\n    \").notexists(ctx.get(\"is_users_own_page\"),ctx,{\"else\":body_17,\"block\":body_19},null).write(\"\\n\").write(\"\\n\").write(\"</div>\").write(\"\\n\").write(\"\\n\").write(\"\\n\").write(\"<h1>\").write(\"\\n    \").exists(ctx.get(\"query_tag\"),ctx,{\"block\":body_24},null).write(\"\\n    \").reference(ctx.get(\"query_author\"),ctx,\"h\").write(\"\\n\").write(\"</h1>\").write(\"\\n\").write(\"\\n\").section(ctx.get(\"sources\"),ctx,{\"block\":body_25},null).write(\"\\n\").exists(ctx.get(\"no_sources\"),ctx,{\"block\":body_46},null).write(\"\\n\").write(\"\\n\").partial(\"footer_event.html\",ctx);}function body_1(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"notes\");}function body_2(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"else\":body_3,\"block\":body_5},null).write(\"\\n    \");}function body_3(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").exists(ctx.get(\"query_user\"),ctx,{\"block\":body_4},null).write(\"\\n        \");}function body_4(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").write(\"-- see <a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_source_url\"),ctx,\"h\").write(\"\\\">everyone's notes on this</a>;\").write(\"\\n            \");}function body_5(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").exists(ctx.get(\"query_user\"),ctx,{\"else\":body_6,\"block\":body_11},null).write(\"\\n        \");}function body_6(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").notexists(ctx.get(\"no_sources\"),ctx,{\"else\":body_7,\"block\":body_8},null).write(\"\\n            \");}function body_7(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \");}function body_8(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                    \").write(\"-- see &amp; edit <a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).reference(ctx.get(\"query_source_url\"),ctx,\"h\").reference(ctx.get(\"query_tag_url\"),ctx,\"h\").write(\"\\\">only your notes \").exists(ctx.get(\"query_tag\"),ctx,{\"block\":body_9},null).exists(ctx.get(\"query_source\"),ctx,{\"block\":body_10},null).write(\"</a>;\").write(\"\\n                \");}function body_9(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"with this tag\");}function body_10(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"on this source\");}function body_11(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").write(\"-- see &amp; edit <a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).reference(ctx.get(\"query_source_url\"),ctx,\"h\").reference(ctx.get(\"query_tag_url\"),ctx,\"h\").write(\"\\\">your notes \").exists(ctx.get(\"query_tag\"),ctx,{\"block\":body_12},null).exists(ctx.get(\"query_source\"),ctx,{\"block\":body_13},null).write(\"</a>;\").write(\"\\n            \");}function body_12(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"with this tag\");}function body_13(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"on this source\");}function body_14(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").write(\"-- see <a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_tag_url\"),ctx,\"h\").reference(ctx.get(\"query_source_url\"),ctx,\"h\").write(\"\\\">everyone's notes \").exists(ctx.get(\"query_tag\"),ctx,{\"block\":body_15},null).exists(ctx.get(\"query_source\"),ctx,{\"block\":body_16},null).write(\"</a>;\").write(\"\\n    \");}function body_15(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"with this tag\");}function body_16(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"on this source\");}function body_17(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_18},null).write(\"\\n    \");}function body_18(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"<br />--        \").write(\"\\n            \").write(\"go to \").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/sources\\\">your sources</a>,\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/authors\\\">authors</a> or\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/tags\\\">tags</a> \").write(\"\\n        \");}function body_19(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").exists(ctx.get(\"query_user\"),ctx,{\"else\":body_20,\"block\":body_22},null).write(\"\\n    \");}function body_20(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"\\n            \").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_21},null).write(\"\\n        \");}function body_21(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").write(\"<br />--        \").write(\"\\n                \").write(\"go to \").write(\"\\n                \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/sources\\\">your sources</a>,\").write(\"\\n                \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/authors\\\">authors</a> or\").write(\"\\n                \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/tags\\\">tags</a> \").write(\"\\n            \");}function body_22(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"<br />--        \").write(\"\\n            \").write(\"see\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/sources\\\">\").reference(ctx.get(\"query_user\"),ctx,\"h\").write(\"'s sources</a>,\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/authors\\\">authors</a> or\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/tags\\\">tags</a>\").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_23},null).write(\"\\n        \");}function body_23(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"; \");}function body_24(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"#\").reference(ctx.get(\"query_tag\"),ctx,\"h\");}function body_25(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n    \").write(\"<h2 class=\\\"title-line\\\">\").write(\"\\n        \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/sources/\").reference(ctx.get(\"page_id\"),ctx,\"h\",[\"uc\"]).write(\"\\\">\").write(\"\\n        \").reference(ctx.get(\"TITLE\"),ctx,\"h\").notexists(ctx.get(\"TITLE\"),ctx,{\"block\":body_26},null).write(\"\\n        \").write(\"</a>\").write(\"\\n        \").exists(ctx.get(\"YEAR\"),ctx,{\"block\":body_28},null).write(\"\\n    \").write(\"</h2>\").write(\"\\n    \").partial(\"bibliographic_details.html\",ctx).write(\"\\n    \").write(\"\\n    \").write(\"<div class='quotes'>\").write(\"\\n        \").exists(ctx.get(\"quotes\"),ctx,{\"else\":body_29,\"block\":body_34},null).write(\"\\n    \").write(\"</div>\").write(\"\\n\");}function body_26(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.reference(ctx.get(\"page_title\"),ctx,\"h\").notexists(ctx.get(\"page_title\"),ctx,{\"block\":body_27},null);}function body_27(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"untitled\");}function body_28(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"(<span class=\\\"year\\\">\").reference(ctx.get(\"YEAR\"),ctx,\"h\").write(\"</span>)\");}function body_29(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").exists(ctx.get(\"is_users_own_page\"),ctx,{\"else\":body_30,\"block\":body_33},null).write(\"\\n        \");}function body_30(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").exists(ctx.get(\"query_user\"),ctx,{\"else\":body_31,\"block\":body_32},null).write(\"\\n            \");}function body_31(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                    \").write(\"<p>There are no notes on this source.</p>\").write(\"\\n                \");}function body_32(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                    \").write(\"<p>\").reference(ctx.get(\"query_user\"),ctx,\"h\").write(\" has notes on this source.</p>\").write(\"\\n                \");}function body_33(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").write(\"<p>You have no notes on this source.</p>\").write(\"\\n            \");}function body_34(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").section(ctx.get(\"quotes\"),ctx,{\"block\":body_35},null).write(\"\\n        \");}function body_35(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").write(\"<div class=\\\"_nrama-quote\\\" id=\\\"\").reference(ctx.get(\"hash\"),ctx,\"h\").write(\"\\\" >\").write(\"\\n                    \").write(\"<div class=\\\"quote-line\\\">\").write(\"\\n                        \").write(\"\\\"<span class=\\\"quote-content\\\">\").reference(ctx.get(\"content\"),ctx,\"h\").write(\"</span>\\\"\").write(\"\\n                        \").write(\"\\n                        \").exists(ctx.get(\"is_users_own_page\"),ctx,{\"else\":body_36,\"block\":body_40},null).write(\"\\n                    \").write(\"</div>\").write(\"\\n                    \").write(\"\\n                    \").write(\"<ul class=\\\"notes _sort-me \").notexists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_41},null).write(\"\\\">\").write(\"\\n                        \").section(ctx.get(\"notes\"),ctx,{\"block\":body_42},null).write(\"\\n                    \").write(\"</ul>\").write(\"\\n                \").write(\"</div>\").write(\"\\n            \");}function body_36(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                            \").notexists(ctx.get(\"query_user\"),ctx,{\"block\":body_37},null).write(\"\\n                            \").write(\"\\n                        \");}function body_37(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                                \").write(\"[cited by\").write(\"\\n                                \").section(ctx.get(\"users\"),ctx,{\"block\":body_38},null).write(\"]\").write(\"\\n                            \");}function body_38(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                                    \").write(\"<span class='quote-user_id'><a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(true,[]),ctx,\"h\",[\"uc\"]).write(\"\\\">\").reference(ctx.getPath(true,[]),ctx,\"h\").write(\"</a></span>\").helper(\"sep\",ctx,{\"block\":body_39},null).write(\"\\n                                \");}function body_39(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\", \");}function body_40(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                            \").write(\"<a class=\\\"add-a-note\\\">[+]</a>\").write(\"\\n                        \");}function body_41(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"_not_user_page\");}function body_42(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                            \").write(\"<li id=\\\"\").reference(ctx.get(\"_id\"),ctx,\"h\").write(\"\\\" class=\\\"_nrama-note\\\">\").write(\"\\n                                \").exists(ctx.get(\"is_users_own_page\"),ctx,{\"else\":body_43,\"block\":body_45},null).write(\"\\n                            \").write(\"</li>\").write(\"\\n                        \");}function body_43(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                                    \").notexists(ctx.get(\"query_user\"),ctx,{\"block\":body_44},null).write(\"\\n                                    \").write(\"<span class=\\\"_nrama-note-content\\\">\").reference(ctx.get(\"content\"),ctx,\"h\").write(\"</span>\").write(\"\\n                                \");}function body_44(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                                        \").write(\"<span class='quote-user_id'><a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.get(\"user_id\"),ctx,\"h\",[\"uc\"]).write(\"\\\">\").reference(ctx.get(\"user_id\"),ctx,\"h\").write(\"</a></span>]\").write(\"\\n                                    \");}function body_45(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                                    \").write(\"<textarea class=\\\"_nrama-note-content\\\" rows=\\\"1\\\">\").reference(ctx.get(\"content\"),ctx,\"h\").write(\"</textarea>\").write(\"\\n                                \");}function body_46(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n    \").write(\"<p>\").write(\"\\n        \").exists(ctx.get(\"is_users_own_page\"),ctx,{\"else\":body_47,\"block\":body_50},null).write(\"\\n        \").write(\"no notes\").write(\"\\n        \").exists(ctx.get(\"query_source\"),ctx,{\"else\":body_51,\"block\":body_56},null).write(\"\\n    \").write(\"</p>\").write(\"\\n\");}function body_47(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").exists(ctx.get(\"query_user\"),ctx,{\"else\":body_48,\"block\":body_49},null).write(\"\\n        \");}function body_48(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").write(\"No one has\").write(\"\\n            \");}function body_49(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").reference(ctx.get(\"query_user\"),ctx,\"h\").write(\" has no notes\").write(\"\\n            \");}function body_50(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"You have\").write(\"\\n        \");}function body_51(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").exists(ctx.get(\"query_tag\"),ctx,{\"else\":body_52,\"block\":body_55},null).write(\"\\n        \");}function body_52(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").exists(ctx.get(\"query_author\"),ctx,{\"else\":body_53,\"block\":body_54},null).write(\"\\n            \");}function body_53(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                    \").write(\"on this.\").write(\"\\n                \");}function body_54(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                    \").write(\"for author \").reference(ctx.get(\"query_author\"),ctx,\"h\").write(\"\\n                \");}function body_55(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").write(\"tagged with #\").reference(ctx.get(\"query_tag\"),ctx,\"h\").write(\"\\n            \");}function body_56(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"on this source\").write(\"\\n        \");}return body_0;})();(function(){dust.register(\"registration.html\",body_0);function body_0(chk,ctx){return chk.section(ctx.get(\"userCtx\"),ctx,{\"block\":body_1},null).write(\"\\n\");}function body_1(chk,ctx){return chk.write(\"\\n  \").write(\"<div id=\\\"registration\\\">\").write(\"\\n    \").write(\"\\n    \").write(\"<div class=\\\"column-container\\\" style=\\\"position:relative;\\\">\").write(\"\\n      \").write(\"<div class=\\\"left-column\\\"\").write(\"\\n           \").write(\"style=\\\"width: 375px\\\" >\").write(\"\\n        \").write(\"<div class=\\\"left-column-inner\\\"\").write(\"\\n             \").write(\"style=\\\"padding-right: 15px;\\\">\").write(\"\\n            \").write(\"<h2 >Get it</h2>\").write(\"\\n              \").write(\"<p>Step 1: \").write(\"\\n                \").notexists(ctx.get(\"name\"),ctx,{\"else\":body_2,\"block\":body_3},null).write(\"\\n                \").write(\"<br />\").write(\"\\n                \").write(\"<span \").exists(ctx.get(\"name\"),ctx,{\"block\":body_4},null).write(\">\").write(\"\\n                  \").write(\"(You don't need to sign up, but if you choose not to others may edit\").write(\"\\n                  \").write(\"or delete your notes.)\").write(\"\\n                \").write(\"<span>\").write(\"\\n              \").write(\"</p>\").write(\"\\n            \").write(\"\\n              \").write(\"<p>Step 2: drag the link below to the bookmark bar in your browser (or otherwise bookmark it).</p>\").write(\"\\n              \").write(\"\\n              \").write(\"<p style=\\\"text-align:center\\\">\").write(\"\\n                \").notexists(ctx.get(\"name\"),ctx,{\"else\":body_5,\"block\":body_6},null).write(\"\\n              \").write(\"</p>\").write(\"\\n            \").write(\"</div>\").write(\"\\n          \").write(\"</div>\").write(\"\\n        \").write(\"\\n        \").write(\"<div class=\\\"right-column\\\"\").write(\"\\n             \").write(\"style=\\\"position:absolute; right:0; top:0; width: 374px;\").write(\"\\n                    \").write(\"border-left: 1px solid #BBB;\").write(\"\\n                    \").exists(ctx.get(\"name\"),ctx,{\"block\":body_8},null).write(\"\\\">\").write(\"\\n            \").write(\"<div class=\\\"right-column-inner\\\"\").write(\"\\n                 \").write(\"style=\\\"padding-left: 25px\\\" >\").write(\"\\n                \").write(\"<h2 style=\\\"margin-top: 0;\\\">... or try it first</h2>\").write(\"\\n                \").write(\"<p>Click to\").write(\"\\n                    \").notexists(ctx.get(\"name\"),ctx,{\"else\":body_9,\"block\":body_10},null).write(\"\\n                \").write(\"</p>\").write(\"\\n                \").write(\"<ul class=\\\"instructions\\\" >\").write(\"\\n                    \").write(\"<li>Selecting text highlights it and adds it to\").write(\"\\n                        \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").notexists(ctx.get(\"name\"),ctx,{\"else\":body_11,\"block\":body_12},null).write(\"\\\">\").write(\"\\n                            \").write(\"your quotes\").write(\"\\n                        \").write(\"</a>\").write(\"\\n                    \").write(\"</li>\").write(\"\\n                    \").write(\"<li>Clicking highlighted text adds a note to the page.\").write(\"\\n                    \").write(\"</li>\").write(\"\\n                    \").write(\"<li>You can\").write(\"\\n                        \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").notexists(ctx.get(\"name\"),ctx,{\"else\":body_13,\"block\":body_14},null).write(\"\\\">\").write(\"\\n                            \").write(\"review your notes\").write(\"\\n                        \").write(\"</a>\").write(\"\\n                    \").write(\"</li>\").write(\"\\n                    \").write(\"<li>If you come back to this page, notes will\").write(\"\\n                        \").write(\"re-load when you\").write(\"\\n                        \").notexists(ctx.get(\"name\"),ctx,{\"else\":body_15,\"block\":body_16},null).write(\"\\n                    \").write(\"</li>\").write(\"\\n                \").write(\"</ul>\").write(\"\\n            \").write(\"</div>\").write(\"\\n        \").write(\"</div>\").write(\"\\n    \").write(\"</div>\").write(\"\\n  \").write(\"</div>\").write(\"\\n\");}function body_2(chk,ctx){return chk.write(\"\\n                  \").write(\"done! (welcome \").reference(ctx.get(\"name\"),ctx,\"h\").write(\")\").write(\"\\n                \");}function body_3(chk,ctx){return chk.write(\"\\n                  \").write(\"(optional)\").write(\"\\n                  \").write(\"<span class=\\\"signup\\\"><a href=\\\"#\\\">Sign up</a></span>\").write(\"\\n                  \").write(\"or\").write(\"\\n                  \").write(\"<span class=\\\"login\\\"><a href=\\\"#\\\">login</a></span>.\").write(\"\\n                \");}function body_4(chk,ctx){return chk.write(\"style=\\\"color:grey; text-decoration: line-through;\\\"\");}function body_5(chk,ctx){return chk.write(\"\\n                \").write(\"<a href=\\\"javascript:(function(){delete module;delete exports;_nrama_bkmklt=true;_nrama_user='\").reference(ctx.get(\"name\"),ctx,\"h\").write(\"';document.body.appendChild(document.createElement('script')).src='http://localhost:5984/nrama/_design/nrama/bkmrklt/nrama2.js?now=new Date().getTime()'; })();\\\">\").write(\"\\n                  \").write(\"!Note-o-rama Bookmarklet -- \").reference(ctx.get(\"name\"),ctx,\"h\").write(\"\\n                \").write(\"</a>\").write(\"\\n                \");}function body_6(chk,ctx){return chk.write(\"\\n                \").write(\"<a href=\\\"javascript:(function(){delete module;delete exports;_nrama_bkmklt=true;\").exists(ctx.get(\"anon_user_name\"),ctx,{\"block\":body_7},null).write(\"document.body.appendChild(document.createElement('script')).src='http://localhost:5984/nrama/_design/nrama/bkmrklt/nrama2.js?now=new Date().getTime()'; })();\\\">\").write(\"\\n                  \").write(\"!Note-o-rama Bookmarklet -- Anon. User \").reference(ctx.get(\"anon_user_name\"),ctx,\"h\").write(\"\\n                \").write(\"</a>\").write(\"\\n                \");}function body_7(chk,ctx){return chk.write(\"_nrama_user='\").reference(ctx.get(\"anon_user_name\"),ctx,\"h\").write(\"';\");}function body_8(chk,ctx){return chk.write(\"color:grey; text-decoration: line-through;\");}function body_9(chk,ctx){return chk.write(\"\\n                        \").write(\"enable note-o-rama for this page.\").write(\"\\n                    \");}function body_10(chk,ctx){return chk.write(\"\\n                    \").write(\"<a href=\\\"javascript:(function(){delete module;delete exports;_nrama_bkmklt=true;_nrama_user='*tryit';document.body.appendChild(document.createElement('script')).src='http://localhost:5984/nrama/_design/nrama/bkmrklt/nrama2.js?now=new Date().getTime()'; })();\\\">\").write(\"\\n                        \").write(\"enable note-o-rama for this page.\").write(\"\\n                    \").write(\"</a>\").write(\"\\n                    \");}function body_11(chk,ctx){return chk.reference(ctx.get(\"name\"),ctx,\"h\",[\"uc\"]);}function body_12(chk,ctx){return chk.write(\"*tryit\");}function body_13(chk,ctx){return chk.reference(ctx.get(\"name\"),ctx,\"h\",[\"uc\"]);}function body_14(chk,ctx){return chk.write(\"*tryit\");}function body_15(chk,ctx){return chk.write(\"\\n                          \").write(\"enable note-o-rama.\").write(\"\\n                        \");}function body_16(chk,ctx){return chk.write(\"\\n                          \").write(\"<a href=\\\"javascript:(function(){delete module;delete exports;_nrama_bkmklt=true;_nrama_user='*tryit';document.body.appendChild(document.createElement('script')).src='http://localhost:5984/nrama/_design/nrama/bkmrklt/nrama2.js?now=new Date().getTime()'; })();\\\">\").write(\"\\n                              \").write(\"enable note-o-rama</a>.\").write(\"\\n                        \");}return body_0;})();(function(){dust.register(\"session.html\",body_0);function body_0(chk,ctx){return chk.section(ctx.get(\"userCtx\"),ctx,{\"block\":body_1},null).write(\"\\n\");}function body_1(chk,ctx){return chk.write(\"\\n  \").write(\"<div id=\\\"session\\\" class=\\\"\").exists(ctx.get(\"name\"),ctx,{\"else\":body_2,\"block\":body_3},null).write(\"\\\">\").write(\"\\n    \").write(\"<span class=\\\"username\\\"><a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.get(\"name\"),ctx,\"h\",[\"uc\"]).write(\"\\\">\").reference(ctx.get(\"name\"),ctx,\"h\").write(\"</a></span>\").write(\"\\n    \").write(\"<ul class=\\\"actions\\\">\").write(\"\\n      \").write(\"<li class=\\\"logout\\\"><a href=\\\"#\\\">Logout</a></li>\").write(\"\\n      \").write(\"<li class=\\\"signup\\\"><a href=\\\"#\\\">Signup</a></li>\").write(\"\\n      \").write(\"<li class=\\\"login\\\"><a href=\\\"#\\\">Login</a></li>\").write(\"\\n    \").write(\"</ul>\").write(\"\\n  \").write(\"</div>\").write(\"\\n\");}function body_2(chk,ctx){return chk.write(\"loggedout\");}function body_3(chk,ctx){return chk.write(\"loggedin\");}return body_0;})();(function(){dust.register(\"sources.html\",body_0);var blocks={what:body_1};function body_0(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.partial(\"user_header.html\",ctx).write(\"\\n\").write(\"\\n\").write(\"<div class=\\\"navigation\\\">\").write(\"\\n    \").write(\"--\").write(\"\\n    \").notexists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_2},null).write(\"\\n    \").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_5},null).write(\"\\n\").write(\"</div>\").write(\"\\n\").write(\"\\n\").write(\"\\n\").write(\"\\n\").write(\"<ul class=\\\"sources\\\">\").write(\"\\n    \").section(ctx.get(\"sources\"),ctx,{\"block\":body_8},null).write(\"\\n\").write(\"</ul>\").write(\"\\n\").notexists(ctx.get(\"sources\"),ctx,{\"block\":body_12},null).write(\"\\n\").write(\"\\n\").write(\"\\n\");}function body_1(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.reference(ctx.getPath(false,[\"sources\",\"length\"]),ctx,\"h\").write(\" sources\");}function body_2(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").exists(ctx.get(\"query_user\"),ctx,{\"block\":body_3},null).write(\"\\n    \");}function body_3(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"see \").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/authors\\\">\").reference(ctx.get(\"query_user\"),ctx,\"h\").write(\"'s authors</a> or\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/tags\\\">tags</a>\").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_4},null).write(\"\\n        \");}function body_4(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"; <br />-- \");}function body_5(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").write(\"go to\").write(\"\\n        \").notexists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_6},null).write(\"\\n        \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/authors\\\">\").exists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_7},null).write(\"authors</a> or\").write(\"\\n        \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/tags\\\">tags</a>\").write(\"\\n    \");}function body_6(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/sources\\\">your sources</a>,\").write(\"\\n        \");}function body_7(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"your \");}function body_8(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").write(\"<li class=\\\"source\\\">\").write(\"\\n            \").write(\"<div class=\\\"title-line\\\">\").write(\"\\n                \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.get(\"user_id\"),ctx,\"h\",[\"uc\"]).write(\"/sources/\").reference(ctx.get(\"page_id\"),ctx,\"h\",[\"uc\"]).write(\"\\\">\").reference(ctx.get(\"TITLE\"),ctx,\"h\").notexists(ctx.get(\"TITLE\"),ctx,{\"block\":body_9},null).write(\"</a>\").write(\"\\n                \").write(\"\\n                \").exists(ctx.get(\"YEAR\"),ctx,{\"block\":body_11},null).write(\"\\n                \").write(\"\\n                \").write(\"\\n            \").write(\"</div>\").write(\"\\n            \").write(\"<div class=\\\"citation\\\">\").partial(\"bibliographic_details.html\",ctx).write(\"</div>\").write(\"\\n        \").write(\"</li>\").write(\"\\n    \");}function body_9(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.reference(ctx.get(\"page_title\"),ctx,\"h\").notexists(ctx.get(\"page_title\"),ctx,{\"block\":body_10},null);}function body_10(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"untitled\");}function body_11(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"(<span class=\\\"year\\\">\").reference(ctx.get(\"YEAR\"),ctx,\"h\").write(\"</span>)\");}function body_12(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n    \").write(\"<p>\").write(\"\\n        \").exists(ctx.get(\"query_user\"),ctx,{\"else\":body_13,\"block\":body_14},null).write(\"\\n        \").write(\"sources\").write(\"\\n        \").exists(ctx.get(\"query_author\"),ctx,{\"block\":body_15},null).write(\"\\n    \").write(\"</p>\").write(\"\\n\");}function body_13(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"No one has \").write(\"\\n        \");}function body_14(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").reference(ctx.get(\"query_user\"),ctx,\"h\").write(\" has no \").write(\"\\n        \");}function body_15(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"by \").reference(ctx.get(\"query_author\"),ctx,\"h\").write(\"\\n        \");}return body_0;})();(function(){dust.register(\"tags.html\",body_0);var blocks={what:body_1};function body_0(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.partial(\"user_header.html\",ctx).write(\"\\n\").write(\"\\n\").write(\"<div class=\\\"navigation\\\">\").write(\"\\n    \").write(\"--\").write(\"\\n    \").notexists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_2},null).write(\"\\n    \").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_5},null).write(\"\\n\").write(\"</div>\").write(\"\\n\").write(\"\\n\").write(\"<div style=\\\"position:relative;\\\">\").write(\"\\n    \").write(\"<div style=\\\"margin-right: 551px\\\">\").write(\"\\n        \").write(\"<ul class='tags-list' >\").write(\"\\n            \").section(ctx.get(\"tags\"),ctx,{\"block\":body_8},null).write(\"\\n        \").write(\"</ul>\").write(\"\\n    \").write(\"</div>\").write(\"\\n    \").write(\"<div class='tags-cloud' id=\\\"tag_cloud\\\"\").write(\"\\n         \").write(\"style=\\\"position:absolute; right:0; top:0; width: 550px; height: 350px;\\\">\").write(\"\\n    \").write(\"</div>\").write(\"\\n\").write(\"</div>\").write(\"\\n\").write(\"\\n\").partial(\"footer_event.html\",ctx);}function body_1(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"tags\");}function body_2(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").exists(ctx.get(\"query_user\"),ctx,{\"block\":body_3},null).write(\"\\n    \");}function body_3(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"see \").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/sources\\\">\").reference(ctx.get(\"query_user\"),ctx,\"h\").write(\"'s sources</a> or\").write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/authors\\\">authors</a>\").exists(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,{\"block\":body_4},null).write(\"\\n        \");}function body_4(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"; <br />-- \");}function body_5(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n        \").write(\"go to \").write(\"\\n        \").notexists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_6},null).write(\"\\n        \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/sources\\\">\").exists(ctx.get(\"is_users_own_page\"),ctx,{\"block\":body_7},null).write(\"sources</a> or\").write(\"\\n        \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/authors\\\">authors</a>\").write(\"\\n    \");}function body_6(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"/tags\\\">your tags</a>,\").write(\"\\n        \");}function body_7(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"your \");}function body_8(chk,ctx){ctx=ctx.shiftBlocks(blocks);return chk.write(\"\\n                \").write(\"<li class=\\\"tag\\\"><a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"/tags/\").reference(ctx.get(\"text\"),ctx,\"h\",[\"uc\"]).write(\"\\\">\").reference(ctx.get(\"text\"),ctx,\"h\").write(\"</a></li>\").write(\"\\n            \");}return body_0;})();(function(){dust.register(\"user_header.html\",body_0);function body_0(chk,ctx){return chk.write(\"<h2 class=\\\"user-line\\\">\").write(\"\\n    \").write(\"<span class=\\\"user-name\\\">\").write(\"\\n        \").exists(ctx.get(\"is_users_own_page\"),ctx,{\"else\":body_1,\"block\":body_4},null).write(\"\\n    \").write(\"</span>\").write(\"\\n    \").block(ctx.getBlock(\"what\"),ctx,{\"block\":body_5},null).write(\"\\n\").write(\"</h2>\").write(\"\\n\");}function body_1(chk,ctx){return chk.write(\"\\n            \").exists(ctx.get(\"query_user\"),ctx,{\"else\":body_2,\"block\":body_3},null).write(\"\\n        \");}function body_2(chk,ctx){return chk.write(\"\\n                \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/sources\\\">Everyone</a>'s\").write(\"\\n            \");}function body_3(chk,ctx){return chk.write(\"\\n                \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"\\\">\").reference(ctx.get(\"query_user\"),ctx,\"h\").write(\"</a>'s\").write(\"\\n            \");}function body_4(chk,ctx){return chk.write(\"\\n            \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").reference(ctx.get(\"query_user_url\"),ctx,\"h\").write(\"\\\">Your</a>\").write(\"\\n        \");}function body_5(chk,ctx){return chk.write(\"\\n        \").write(\"things\").write(\"\\n    \");}return body_0;})();(function(){dust.register(\"welcome.html\",body_0);function body_0(chk,ctx){return chk.write(\"<h1 style=\\\"margin-bottom:0;\\\">Note-o-rama</h1>\").write(\"\\n\").write(\"\\n\").write(\"<div class=\\\"instructions\\\">\").write(\"\\n    \").write(\"<p style=\\\"margin-top:0;\\\">Add notes and highlights to any web page.\").write(\"\\n        \").write(\"<br />Organise and review your notes by source, author and #tag.\").write(\"\\n    \").write(\"<p>\").write(\"\\n    \").write(\"\\n    \").write(\"<div>\").write(\"\\n        \").write(\"<img src=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/static/img/nrama_demo.png\\\"\").write(\"\\n             \").write(\"style=\\\"display: block; margin-left: auto; margin-right: auto;\\\" />\").write(\"\\n        \").write(\"<p style=\\\"text-align: center\\\">\").write(\"\\n            \").write(\"<i>Figure</i>.\").write(\"\\n            \").write(\"Left panel: annotate any web page.\").write(\"\\n            \").write(\"Right panel: organise your notes.\").write(\"\\n        \").write(\"</p>\").write(\"\\n    \").write(\"</div>\").write(\"\\n    \").write(\"\\n    \").write(\"\\n    \").write(\"\\n    \").partial(\"registration.html\",ctx).write(\"\\n            \").write(\"\\n    \").write(\"\\n    \").write(\"<h2>How to use it</h2>\").write(\"\\n    \").write(\"<p>You can use Note-o-rama on any page you visit.</p>\").write(\"\\n    \").write(\"<p>When browsing a page, hit the bookmark you just made (step 2 above) to start making notes.\").write(\"\\n    \").write(\"(This bookmark won't take you to another page, it just injects some code.)\").write(\"\\n    \").write(\"\\n    \").write(\"<p>\").write(\"\\n        \").section(ctx.get(\"userCtx\"),ctx,{\"block\":body_1},null).write(\"\\n    \").write(\"</p>\").write(\"\\n\").write(\"\\n    \").write(\"<hr />\").write(\"\\n    \").write(\"\\n    \").write(\"<h2>Problems?</h2>\").write(\"\\n    \").write(\"<p>\").write(\"\\n        \").write(\"Note-o-rama should work in recent versions of Firefox, Chrome and Safari.\").write(\"\\n        \").write(\"<br />\").write(\"\\n        \").write(\"We don't promise that it will work in older browsers or Internet Explorer. <i>Tant pis</i>.\").write(\"\\n        \").write(\"<br />\").write(\"\\n    \").write(\"</p><p>\").write(\"\\n        \").write(\"If it doesn't work, you may need to set your browser to accept cookies\").write(\"\\n        \").write(\"from all websites (sorry).\").write(\"\\n    \").write(\"</p><p>\").write(\"\\n        \").write(\"Issues <a href=\\\"https://github.com/butterfill/note-o-rama/issues\\\">may be reported here</a>.\").write(\"\\n    \").write(\"</p>\").write(\"\\n    \").write(\"\\n        \").write(\"\\n    \").write(\"<h2>Pro tips</h2>\").write(\"\\n    \").write(\"<ul class=\\\"instructions\\\" >\").write(\"\\n        \").write(\"<li>Move notes by dragging any edge.</li>\").write(\"\\n        \").write(\"<li>alt- or meta- click a quote to delete it.</li>\").write(\"\\n        \").write(\"<li>Use #tags in notes (***LINK your tags).</li>\").write(\"\\n        \").write(\"<li>Paste a bibtex entry into a note to organise by author (***LINK your authors).</li>\").write(\"\\n    \").write(\"</ul>\").write(\"\\n    \").write(\"\\n    \").write(\"<hr />\").write(\"\\n\").write(\"\\n    \").write(\"<h2>About</h2>\").write(\"\\n    \").write(\"<p>Note-o-rama is copyright (c) 2007-11 Stephen A. Butterfill.\").write(\"\\n        \").write(\"<a href=\\\"https://github.com/butterfill/note-o-rama\\\" target=\\\"_blank\\\">Source code is publicly availble.</a>\").write(\"\\n    \").write(\"</p>\").write(\"\\n\").write(\"</div>\").write(\"\\n\");}function body_1(chk,ctx){return chk.write(\"\\n            \").write(\"To see all your notes\").notexists(ctx.get(\"name\"),ctx,{\"block\":body_2},null).write(\",\").write(\"\\n            \").write(\"click your user name on the top right of this page\").exists(ctx.get(\"name\"),ctx,{\"block\":body_3},null).write(\".\").write(\"\\n        \");}function body_2(chk,ctx){return chk.write(\" sign up or log in, then\");}function body_3(chk,ctx){return chk.write(\"\\n                \").write(\"<a href=\\\"\").reference(ctx.get(\"baseURL\"),ctx,\"h\").write(\"/users/\").reference(ctx.getPath(false,[\"userCtx\",\"name\"]),ctx,\"h\",[\"uc\"]).write(\"\\\">\").write(\"\\n                    \").write(\"or here</a>\");}return body_0;})();\n}(dust_module, dust_module.exports));\nvar dust = dust_module.exports;\n/*global dust: true, log: false */\n\n/**\n * CAUTION WHEN EDITING THIS FILE!\n *\n * The rest of this  module is automatically generated by kanso when the app\n * is pushed to the database.\n *\n * This is to work around the fact that dust templates store state\n * on the module itself but couchdb doesn't yet provide a module cache,\n * meaning state does not persist between each require(). The workaround\n * involves writing all templates directly into the module, so they are added on\n * each require.\n *\n * TODO: When a module cache is implemented in CouchDB, stop this module from\n * being auto-generated, see: https://issues.apache.org/jira/browse/COUCHDB-890\n *\n * For the code that generates the rest of this file, see: lib/templates.js\n */\n\n/**\n * Kanso uses Dust templates for rendering pages.\n * To learn more about the syntax, see the\n * <a href=\"http://akdubya.github.com/dustjs/\">Dust site</a>.\n *\n * Since Dust stores compiled templates on the module itself, the\n * templates module does some interesting things to work around the lack\n * of a module cache in CouchDB. Because of this, compiled templates are\n * automatically added to this module from your templates folder each time\n * your app is pushed to CouchDB. You can see a list of the loaded template\n * names on the 'loaded' property of this module.\n *\n * @module\n */\n\n\n/**\n * Module dependencies\n */\n\nvar utils = require('./utils'),\n    flashmessages = require('./flashmessages');\n\n\n/**\n * Synchronously render dust template and return result, automatically adding\n * baseURL to the template's context. The request object is required so we\n * can determine the value of baseURL.\n *\n * @name render(name, req, context)\n * @param {String} name\n * @param {Object} req\n * @param {Object} context\n * @returns {String}\n * @api public\n */\n\nexports.render = function (name, req, context) {\n    context.baseURL = utils.getBaseURL(req);\n    context.isBrowser = utils.isBrowser();\n    context.userCtx = req.userCtx;\n    if (!context.flashMessages) {\n        context.flashMessages = flashmessages.getMessages(req);\n    }\n    var r = '';\n    dust.render(name, context, function (err, result) {\n        if (err) {\n            throw err;\n        }\n        r = result;\n    });\n    return r;\n};\n\n\n/**\n * Exports the names of all templates loaded into the dust cache\n */\n\nexports.loaded = [];\nfor (var k in dust.cache) {\n    if (dust.cache.hasOwnProperty(k)) {\n        exports.loaded.push(k);\n    }\n}\n",
        "actions": "/*global $: false, kanso: true*/\n\nvar utils = require('./utils');\n\n/**\n * Implementation of widget actions. These are procedures\n * that can be referenced by widgets to present/collect information,\n * manipulate the DOM, or otherwise affect the application state\n * when a widget is acted upon.\n *\n * @module\n */\n\n/**\n * Module dependencies\n */\n\nvar widgets = require('./widgets'),\n    sanitize = require('./sanitize'),\n    _ = require('./underscore')._;\n\nvar h = sanitize.escapeHtml;\n\n/**\n * Create a closure that loads {module}, and invokes {method}\n * on it. The {options} parameter is prepenced to the method's\n * argument list. This separate function silences a lint warning.\n * See the parse method for details.\n */\nexports.make_action_handler = function (module, method, options) {\n    return function () {\n        var args = [ options ].concat(\n            Array.prototype.slice.apply(arguments)\n        );\n        return require(module)[method].apply(null, args);\n    };\n};\n\n/**\n * Convert an object containing several [ module, callback ] or\n * { module: x, callback: y } items in to an object containing\n * several native javascript functions, by using require.\n *\n * @param actions An object, containing items describing a\n *          function that can be obtained via require().\n */\nexports.parse = function (actions) {\n    var rv = {};\n    for (var k in actions) {\n        var module, callback, options;\n        var action = actions[k];\n        if (action === false) {\n            rv[k] = utils.emptyFunction;\n        } else {\n            if (_.isArray(action)) {\n                module = action[0];\n                callback = action[1];\n                options = action[2];\n            } else if (_.isFunction(action)) {\n                rv[k] = action;\n                continue;\n            } else if (typeof(action) === 'object') {\n                module = action.module;\n                callback = action.callback;\n                options = action.options;\n            } else {\n                throw new Error(\n                    'Action `' + k + '` is `' + typeof(action) + '`, ' +\n                        \"which this function doesn't know how to interpret\"\n                );\n            }\n            /* Resolve function description to actual function */\n            rv[k] = exports.make_action_handler(module, callback, options);\n        }\n    }\n    return rv;\n};\n\n/**\n * An action that produces a modal dialog box, with buttons along\n * its bottom. The contents of the dialog can be controlled by\n * setting either options.widget or options.type. If both are\n * specified, the widget will be used. If only type is specified,\n * this function transparently instansiates an embedForm widget,\n * which does the actual form rendering and presentation.\n */\n\nexports.modalDialog = function (action_options, action_name,\n                                type_name, field, path, value,\n                                raw, errors, options, callback) {\n    options = (options || {});\n    action_options = (action_options || {});\n\n    var widget = action_options.widget;\n    var name = sanitize.generateDomName(path);\n    var path_extra = (options.path_extra || []).concat([ 'modal' ]);\n    var operation = 'update';\n    if (action_name !== 'edit') {\n        operation = action_name;\n    }\n    var widget_options = {\n        path_extra: path_extra,\n        operation: operation\n    };\n\n    /* Resolve widget */\n    if (!widget && action_options.type) {\n        widget = widgets.embedForm(\n            _.defaults(action_options.options || {}, {\n                type: action_options.type\n            })\n        );\n    }\n\n    if (!widget) {\n        throw new Error(\n            'modalDialog: Unable to determine the widget to' +\n            ' use for the field named `' + path.join('.') + '`;' +\n            ' widget or field type was not correctly specified'\n        );\n    }\n\n    /* Dialog setup and event handling:\n        This is wrapped in a closure to allow it to easily be\n        used inside both synchronous and asynchronous functions. */\n\n    var generateModalDialog = function () {\n\n        /* Generate strings for content */\n        var cancel_label = 'Cancel';\n        var type_label = utils.titleize(type_name);\n        var action_label = utils.titleize(action_name);\n\n        /* Generate inner elements */\n        var title_elt = $(\n            '<h2>' + [ action_label, type_label ].join(' ') + '</h2>'\n        );\n        var ok_elt = $(\n            '<input type=\"submit\" value=\"' + h(action_label) + '\" />'\n        );\n        var cancel_elt = $(\n            '<input type=\"button\" value=\"' + h(cancel_label) + '\" />'\n        );\n        var actions_elt = $(\n            '<div class=\"actions\" />'\n        );\n\n        /* Create widget's parent element */\n        var div = $('<div />');\n\n        /* Add dialog title */\n        div.append(title_elt);\n\n        /* Draw widget */\n        div.append(\n            widget.toHTML(\n                name, value, raw, field, widget_options\n            )\n        );\n\n        /* Find the form element:\n            This is created by the call to widget.toHTML, above. */\n\n        var form_elt = div.closestChild('form');\n\n        if (form_elt.length <= 0) {\n\n            /* No form element found?\n                Generate one and wrap the contents of the dialog with it.\n                This provides support for widgets other than embedForm. */\n\n            var wrapper_elt = $('<div />');\n            form_elt = $('<form />');\n            form_elt.append(div);\n            wrapper_elt.append(form_elt);\n            div = wrapper_elt;\n        }\n\n        /* Handle success */\n        ok_elt.click(function (ev) {\n\n            /* Validate widget:\n                This usually defers to a form type's implementation.\n                Most simple widgets just return true for this method. */\n\n            errors = widget.validate(div, path, widget_options);\n\n            if (errors.length > 0) {\n\n                /* Repost dialog box:\n                    This will replace the current dialog box.\n                    The modal dialog returns to the event loop before\n                    actually removing its elements, so we do the same. */\n\n                $.modal.close();\n\n                setTimeout(function () {\n                    exports.modalDialog(\n                        action_options, action_name, type_name, field,\n                            path, value, raw, errors, options, callback\n                    );\n                }, 0);\n\n            } else {\n\n                /* Close the dialog box:\n                    Again, note that the dialog box won't actually disappear\n                    until we've unwound and returned to the main event\n                    loop. If you depend upon closure, use setTimeout(). */\n\n                callback(\n                    true, widget.getValue(div, path, widget_options)\n                );\n\n                /* Order matters:\n                    The callback may refer to elements inside of the modal\n                    dialog, so don't destroy it until after it returns, and\n                    has had a chance to register any callbacks / timeouts. */\n\n                $.modal.close();\n            }\n\n            ev.preventDefault();\n        });\n\n        /* Handle failure */\n        cancel_elt.click(function () {\n            callback(\n                false, widget.getValue(div, path, widget_options)\n            );\n            $.modal.close();\n        });\n\n        /* Make default form action 'ok' */\n        form_elt.submit(function (ev) {\n            ev.preventDefault();\n            ok_elt.click();\n            return false;\n        });\n\n        /* Insert dialog-managed elements */\n        actions_elt.append(ok_elt);\n        actions_elt.append(cancel_elt);\n        form_elt.append(actions_elt);\n\n        /* Launch dialog */\n        div.modal();\n\n        /* Initialize widget:\n            We do this last -- this makes sure all elements are present\n            and initialized prior to client-side widget initialization. */\n\n        widget.clientInit(\n            field, path, value, raw, errors, widget_options\n        );\n    };\n\n    return generateModalDialog();\n};\n\n",
        "cookies": "/*global escape: false */\n\n/**\n * Functions related to the manipulation and reading of cookies.\n *\n * @module\n */\n\nvar utils = require('./utils');\n\n\n/**\n * Read cookies currently stored in the browser, returning an object\n * keyed by cookie name.\n *\n * @name readBrowserCookies()\n * @returns Object\n * @api public\n */\n\nexports.readBrowserCookies = function () {\n    if (!utils.isBrowser()) {\n        throw new Error('readBrowserCookies cannot be called server-side');\n    }\n    var cookies = {};\n    var parts = document.cookie.split(';');\n    for (var i = 0, len = parts.length; i < len; i++) {\n        var name = parts[i].split('=')[0];\n        var value = parts[i].split('=').slice(1).join('=');\n        cookies[name] = value;\n    }\n    return cookies;\n};\n\n/**\n * Reads browser cookies and returned the value of the named cookie.\n *\n * @name readBrowserCookie(name)\n * @returns {String}\n * @api public\n */\n\nexports.readBrowserCookie = function (name) {\n    return exports.readBrowserCookies()[name];\n};\n\n/**\n * Creates a string for storing a cookie on the browser.\n *\n * @name cookieString(req, opt)\n * @param {Request Object} req\n * @param {Object} opt\n * @returns {String}\n * @api public\n */\n\nexports.cookieString = function (req, opt) {\n    var path = opt.path || utils.getBaseURL(req) + '/';\n    var str = escape(opt.name) + '=' + escape(opt.value) + '; path=' + path;\n    if (opt.days) {\n        var expires = new Date().setTime(\n            new Date().getTime() + 1000 * 60 * 60 * 24 * opt.days\n        );\n        str += '; expires=' + expires.toGMTString();\n    }\n    return str;\n};\n\n/**\n * Sets a cookie on the browser, for use client-side only.\n *\n * @name setBrowserCookie(req, opt)\n * @param {Request Object} req\n * @param {Object} opt\n * @api public\n */\n\nexports.setBrowserCookie = function (req, opt) {\n    if (!utils.isBrowser()) {\n        throw new Error('setBrowserCookie cannot be called server-side');\n    }\n    var str = (typeof opt === 'string') ? opt: exports.cookieString(req, opt);\n    //console.log('document.cookie = ' + str);\n    document.cookie = str;\n};\n\n/**\n * Creates a Set-Cookie header on a response object.\n *\n * @name setResponseCookie(req, res, opt)\n * @param {Request Object} req\n * @param {Response Object} res\n * @param {Object} opt\n * @api public\n */\n\nexports.setResponseCookie = function (req, res, opt) {\n    var str = (typeof opt === 'string') ? opt: exports.cookieString(req, opt);\n    if (typeof res !== 'object') {\n        res = {code: 200, body: res};\n    }\n    if (!res.headers) {\n        res.headers = {};\n    }\n    // TODO: is it possible to send multiple set-cookie headers by turning\n    // headers into an array like in node?\n    // XXX: just replacing all cookies for now - not ideal!\n    res.headers['Set-Cookie'] = str;\n};\n",
        "core": "/*global window: false, getRow: true, start: true, $: false, pageTracker: true,\n  kanso: true, log: true, console: true, send: true */\n\n/**\n * The core module contains functions used by kanso to facilitate the running\n * of your app. You shouldn't need to use any of the functions here directly\n * unless you're messing with the internals of Kanso.\n *\n * @module\n */\n\n\n/**\n * Module dependencies\n */\n\nvar settings = require('./settings'), // module auto-generated\n    url = require('./url'),\n    db = require('./db'),\n    utils = require('./utils'),\n    session = require('./session'),\n    cookies = require('./cookies'),\n    flashmessages = require('./flashmessages'),\n    templates = require('./templates'),\n    events = require('./events'),\n    urlParse = url.parse,\n    urlFormat = url.format,\n    _ = require('./underscore')._;\n\n\n/**\n * This is because the first page hit also triggers kanso to handle the url\n * client-side. Knowing it is the first page being loaded means we can stop\n * the pageTracker code from submitting the URL twice. Exported because this\n * might be useful information to other modules, it should not be modified\n * by them.\n */\n\n//exports.initial_hit = utils.initial_hit;\n\n\n/**\n * This variable keeps track of whether or not the browser supports\n * pushstate for manipulating browser history.\n */\n\nexports.history_support = false;\n\n/**\n * Stores the current html5 history state to detect duplicate popstate events\n */\n\nexports.current_state = null;\n\n/**\n * Set to true when setURL is called so the onpopstate which fires afterwards\n * knows it is the result of an explicit call to setURL (as opposed to clicking\n * the back, forward or reload buttons). This means we can avoid showing a\n * confirmation dialog for POST requests in these circumstances.\n */\n\nexports.set_called = false;\n\n\nif (typeof window !== 'undefined') {\n    if (!window.console) {\n        // console.log is going to cause errors, just stub the functions\n        // for now. TODO: add logging utility for IE?\n        window.console = {\n            log: function () {},\n            error: function () {},\n            info: function () {},\n            warn: function () {}\n        };\n    }\n    var console = window.console;\n}\n\n\n/**\n * Global functions required to match the CouchDB JavaScript environment.\n */\n\nif (typeof getRow === 'undefined' && typeof window !== 'undefined') {\n    window.getRow = function () {\n        return null;\n    };\n}\nif (typeof start === 'undefined' && typeof window !== 'undefined') {\n    window.start = function (options) {\n        //console.log('start');\n        //console.log(options);\n    };\n}\nif (typeof send === 'undefined' && typeof window !== 'undefined') {\n    window.send = function (options) {\n        //console.log('send');\n        //console.log(options);\n    };\n}\nif (typeof log === 'undefined' && typeof window !== 'undefined') {\n    window.log = function () {\n        return console.log.apply(console, arguments);\n    };\n}\n\n\n/**\n * Used to store userCtx, periodically updated like on session.login and\n * session.logout. TODO: Or if a permissions error is returned from a db method?\n */\n\n// TODO: added to utils to avoid circular dependency bug in couchdb\n//exports.userCtx = utils.userCtx;\n\n\n\n\n/**\n * The module loaded as the design document (load property in kanso.json).\n * Likely to cause circular require in couchdb so only run browser side.\n * TODO: when circular requires are fixed in couchdb, remove the isBrowser check\n */\n\nif (utils.isBrowser) {\n    exports.app = {};\n    if (settings.load) {\n        exports.app = require(settings.load);\n    }\n}\n\n\n/**\n * Called by kanso.js once the design doc has been loaded.\n */\n\nexports.init = function () {\n\n    if (window.history && history.pushState) {\n        exports.history_support = true;\n\n        $('form').live('submit', function (ev) {\n            var action = $(this).attr('action') || exports.getURL();\n            var method = $(this).attr('method').toUpperCase();\n\n            // _session is a special case always available at the root url\n            if (action !== '/_session' && exports.isAppURL(action)) {\n                var url = exports.appPath(action);\n                ev.preventDefault();\n                var fields = $(this).serializeArray();\n                var data = {};\n                for (var i = 0; i < fields.length; i++) {\n                    data[fields[i].name] = fields[i].value;\n                }\n                exports.setURL(method, url, data);\n            }\n        });\n\n        $('a').live('click', function (ev) {\n            var href = $(this).attr('href');\n\n            if (href && exports.isAppURL(href)) {\n                var url = exports.appPath(href);\n                ev.preventDefault();\n                exports.setURL('GET', url, {});\n            }\n        });\n\n        window.onpopstate = function (ev) {\n            var url = exports.getURL();\n            var state = ev.state || {};\n            var method = state.method || 'GET';\n            var data = state.data;\n            var count = state.history_count;\n\n            if (method !== 'GET' && method !== 'HEAD') {\n                // unsafe method, unless caused by an explicit call to setURL\n                // show a confirmation dialog\n                if (!exports.set_called) {\n                    // TODO: at this point is it too late to undo the popstate?\n                    var resend = confirm(\n                        'In order to complete this request the browser will ' +\n                        'have to re-send information, repeating any ' +\n                        'previous action (such as creating a document).\\n\\n' +\n                        'Re-send information?'\n                    );\n                    if (!resend) {\n                        var curr_count = exports.current_state.history_count;\n                        window.history.go(curr_count - count);\n                        return;\n                    }\n                }\n            }\n            // reset set_called\n            exports.set_called = false;\n\n            var curr = exports.current_state;\n            if (curr &&\n                curr.url === url &&\n                curr.timestamp === state.timestamp &&\n                (curr.method || 'GET') === (state.method || 'GET')) {\n                // duplicate popstate event\n                // console.log('duplicate popstate event');\n                return;\n            }\n            exports.current_state = {\n                method: method,\n                url: url,\n                data: data,\n                timestamp: state.timestamp,\n                history_count: count\n            };\n            exports.handle(method, url, data);\n        };\n        window.onpopstate({});\n    }\n    else {\n        // This browser has no html5  history support, attempt to\n        // enhance the page anyway\n        // TODO: figure out the data from the initial request as this\n        // re-rendering might wipe relevant data from the response\n        // TODO: figure out the method from the initial request\n        // because the initial request may have been a POST (pointing to\n        // an update function instead of the show this GET might render)\n        //\n        // - perhaps use cookies to pass the method and data back to the client?\n        //\n        exports.handle('GET', exports.getURL(), {});\n    }\n\n    // TODO: should this be after userCtx is available??\n    // call init on app too\n    events.emit('init');\n};\n\n\n/**\n * Extracts groups from a url, eg:\n * '/some/path' with pattern '/some/:name' -> {name: 'path'}\n *\n * @name rewriteGroups(pattern, url)\n * @param {String} pattern\n * @param {String} url\n * @returns {Object}\n * @api public\n */\n\nexports.rewriteGroups = function (pattern, url) {\n    var pathname = urlParse(url).pathname;\n    var re = new RegExp(\n        '^' + pattern.replace(/:\\w+/g, '([^/]+)').replace(/\\*/g, '.*') + '$'\n    );\n    var m = re.exec(pathname);\n    if (!m) {\n        return [];\n    }\n    var values = m.slice(1);\n    var keys = [];\n    var matches = pattern.match(/:\\w+/g) || [];\n    for (var i = 0; i < matches.length; i++) {\n        keys.push(matches[i].substr(1));\n    }\n    var groups = {};\n    for (var j = 0; j < keys.length; j++) {\n        groups[keys[j]] = values[j];\n    }\n    return groups;\n};\n\n/**\n * Extracts a splat value from a rewrite pattern and matching URL.\n *\n * @name rewriteSplat(pattern, url)\n * @param {String} pattern\n * @param {String} url\n * @returns {String}\n * @api public\n */\n\nexports.rewriteSplat = function (pattern, url) {\n    // splats are only supported at the end of a rewrite pattern\n    if (pattern.charAt(pattern.length - 1) === '*') {\n        var re = new RegExp(pattern.substr(0, pattern.length - 1) + '(.*)');\n        var match = re.exec(url);\n        if (match) {\n            return match[1];\n        }\n    }\n};\n\n\n/**\n * Attempts to match rewrite from patterns to a URL, returning the\n * matching rewrite object if successful.\n *\n * @name matchURL(method, url)\n * @param {String} method\n * @param {String} url\n * @returns {Object}\n * @api public\n */\n\nexports.matchURL = function (method, url) {\n    var pathname = urlParse(url).pathname;\n    var rewrites = kanso.app.rewrites;\n    for (var i = 0; i < rewrites.length; i++) {\n        var r = rewrites[i];\n        if (!r.method || method === r.method) {\n            var from = r.from;\n            from = from.replace(/\\*$/, '(.*)');\n            from = from.replace(/:\\w+/g, '([^/]+)');\n            var re = new RegExp('^' + from + '$');\n            if (re.test(pathname)) {\n                return r;\n            }\n        }\n    }\n};\n\n/**\n * Replace group names in a string with the value of that group\n * eg: \"/:name\" with groups {name: 'test'} -> \"/test\"\n *\n * @name replaceGroups(val, groups, splat)\n * @param {String} val\n * @param {Object} groups\n * @param {String} splat\n * @returns {String}\n * @api public\n */\n\nexports.replaceGroups = function (val, groups, splat) {\n    var k, match, result = val;\n\n    if (typeof val === 'string') {\n        result = val.split('/');\n        for (var i = 0; i < result.length; i++) {\n            match = false;\n            for (k in groups) {\n                if (result[i] === ':' + k) {\n                    result[i] = decodeURIComponent(groups[k]);\n                    match = true;\n                }\n            }\n            if (!match && result[i] === '*') {\n                result[i] = splat;\n            }\n        }\n        result = result.join('/');\n    }\n    else if (val.length) {\n        result = val.slice();\n        for (var j = 0; j < val.length; j++) {\n            match = false;\n            for (k in groups) {\n                if (val[j] === ':' + k) {\n                    result[j] = decodeURIComponent(groups[k]);\n                    match = true;\n                }\n            }\n            if (!match && val[j] === '*') {\n                result[j] = splat;\n            }\n        }\n    }\n    return result;\n};\n\n\n/**\n * Creates a new request object from a url and matching rewrite object.\n * Query parameters are automatically populated from rewrite pattern.\n *\n * @name createRequest(method, url, data, match, callback)\n * @param {String} method\n * @param {String} url\n * @param {Object} data\n * @param {Object} match\n * @param {Function} callback\n * @api public\n */\n\nexports.createRequest = function (method, url, data, match, callback) {\n    var groups = exports.rewriteGroups(match.from, url);\n    var query = urlParse(url, true).query || {};\n    var k;\n    if (match.query) {\n        for (k in match.query) {\n            if (match.query.hasOwnProperty(k)) {\n                query[k] = exports.replaceGroups(match.query[k], groups);\n            }\n        }\n    }\n    if (groups) {\n        for (k in groups) {\n            if (groups.hasOwnProperty(k)) {\n                query[k] = decodeURIComponent(groups[k]);\n            }\n        }\n    }\n    // splats are available for rewriting match.to, but not accessible on\n    // the request object (couchdb 1.1.x), storing in a separate variable\n    // for now\n    var splat = exports.rewriteSplat(match.from, url);\n    var to = exports.replaceGroups(match.to, query, splat);\n    var req = {\n        method: method,\n        query: query,\n        headers: {},\n        path: to.split('/'),\n        client: true,\n        initial_hit: utils.initial_hit,\n        cookie: cookies.readBrowserCookies()\n    };\n    if (data) {\n        req.form = data;\n    }\n\n    db.newUUID(100, function (err, uuid) {\n        if (err) {\n            return callback(err);\n        }\n        req.uuid = uuid;\n\n        if (utils.userCtx) {\n            req.userCtx = utils.userCtx;\n            return callback(null, req);\n        }\n        else {\n            session.info(function (err, session) {\n                if (err) {\n                    return callback(err);\n                }\n                req.userCtx = session.userCtx;\n                callback(null, req);\n            });\n        }\n    });\n};\n\n\n/**\n * Handles return values from show / list / update functions\n */\n\nexports.handleResponse = function (req, res) {\n    //console.log('response');\n    //console.log(res);\n    if (req && typeof res === 'object') {\n        if (res.headers) {\n            if (res.headers['Set-Cookie']) {\n                document.cookie = res.headers['Set-Cookie'];\n            }\n            var loc = res.headers['Location'];\n            if (loc && _.indexOf([301, 302, 303, 307], res.code) !== -1) {\n                if (exports.isAppURL(loc)) {\n                    // reset method to GET unless response is a 307\n                    var method = res.code === 307 ? req.method || 'GET': 'GET';\n                    exports.setURL(method, exports.appPath(loc));\n                }\n                else {\n                    document.location = loc;\n                }\n            }\n        }\n    }\n};\n\n\n/**\n * Fetches the relevant document and calls the named show function.\n *\n * @name runShowBrowser(req, name, docid, callback)\n * @param {Object} req\n * @param {String} name\n * @param {String} docid\n * @param {Function} callback\n * @api public\n */\n\nexports.runShowBrowser = function (req, name, docid, callback) {\n    var result;\n    var fn = kanso.app.shows[name];\n\n    var info = {\n        type: 'show',\n        name: name,\n        target: docid,\n        query: req.query,\n        fn: fn\n    };\n    events.emit('beforeResource', info);\n\n    if (docid) {\n        db.getDoc(docid, req.query, function (err, doc) {\n            var current_req = (utils.currentRequest() || {});\n            if (current_req.uuid === req.uuid) {\n                if (err) {\n                    return callback(err);\n                }\n                var res = exports.runShow(fn, doc, req);\n                events.emit('afterResponse', info, req, res);\n                if (res) {\n                    exports.handleResponse(req, res);\n                }\n                else {\n                    // returned without response, meaning cookies won't be set\n                    // by handleResponseHeaders\n                    if (req.outgoing_flash_messages) {\n                        flashmessages.setCookieBrowser(\n                            req, req.outgoing_flash_messages\n                        );\n                    }\n                }\n                callback();\n            }\n        });\n    }\n    else {\n        var res = exports.runShow(fn, null, req);\n        events.emit('afterResponse', info, req, res);\n        if (res) {\n            exports.handleResponse(req, res);\n        }\n        else {\n            // returned without response, meaning cookies won't be set by\n            // handleResponseHeaders\n            if (req.outgoing_flash_messages) {\n                flashmessages.setCookieBrowser(\n                    req, req.outgoing_flash_messages\n                );\n            }\n        }\n        callback();\n    }\n};\n\n/**\n * Helper for runShow/runList.\n *\n * @name parseResponse(req, res)\n * @param {Object} req\n * @param {Object} res\n * @api public\n */\n\nexports.parseResponse = function (req, res) {\n    var ids = _.without(_.keys(res), 'title', 'code', 'headers', 'body');\n    if (req.client) {\n        if (res.title) {\n            document.title = res.title;\n        }\n        _.each(ids, function (id) {\n            $('#' + id).html(res[id]);\n        });\n    }\n    else if (!res.body) {\n        var context = {title: res.title || ''};\n        _.each(ids, function (id) {\n            context[id] = res[id];\n        });\n        var body = templates.render(\n            settings.base_template || 'base.html', req, context\n        );\n        res = {\n            body: body,\n            code: res.code || 200,\n            headers: res.headers\n        };\n    }\n    return {\n        body: res.body,\n        code: res.code,\n        headers: res.headers\n    };\n};\n\n/**\n * Runs a show function with the given document and request object,\n * emitting relevant events. This function runs both server and client-side.\n *\n * @name runShow(fn, doc, req)\n * @param {Function} fn\n * @param {Object} doc\n * @param {Object} req\n * @api public\n */\n\nexports.parseResponse = function (req, res) {\n    var ids = _.without(_.keys(res), 'title', 'code', 'headers', 'body');\n    if (req.client) {\n        if (res.title) {\n            document.title = res.title;\n        }\n        _.each(ids, function (id) {\n            $('#' + id).html(res[id]);\n        });\n    }\n    else if (!res.body) {\n        var context = {title: res.title || ''};\n        _.each(ids, function (id) {\n            context[id] = res[id];\n        });\n        var body = templates.render(\n            settings.base_template || 'base.html', req, context\n        );\n        res = {\n            body: body,\n            code: res.code || 200,\n            headers: res.headers\n        };\n    }\n    return {\n        body: res.body,\n        code: res.code,\n        headers: res.headers\n    };\n};\n\nexports.runShow = function (fn, doc, req) {\n    req = flashmessages.updateRequest(req);\n    utils.currentRequest(req);\n    var info = {\n        type: 'show',\n        name: req.path[1],\n        target: req.path[2],\n        query: req.query,\n        fn: fn\n    };\n    events.emit('beforeRequest', info, req);\n    var res = fn(doc, req);\n\n    if (!(res instanceof Object)) {\n        res = {code: 200, body: res};\n    }\n    else {\n        res = exports.parseResponse(req, res);\n    }\n    events.emit('beforeResponseStart', info, req, res);\n    events.emit('beforeResponseData', info, req, res, res.body || '');\n\n    res = flashmessages.updateResponse(req, res);\n    req.response_received = true;\n    return res;\n};\n\n/**\n * Fetches the relevant document and calls the named update function.\n *\n * @name runUpdateBrowser(req, name, docid, callback)\n * @param {Object} req\n * @param {String} name\n * @param {String} docid\n * @param {Function} callback\n * @api public\n */\n\nexports.runUpdateBrowser = function (req, name, docid, callback) {\n    var result;\n    var fn = kanso.app.updates[name];\n\n    var info = {\n        type: 'update',\n        name: name,\n        target: docid,\n        query: req.query,\n        fn: fn\n    };\n    events.emit('beforeResource', info);\n\n    if (docid) {\n        db.getDoc(docid, req.query, function (err, doc) {\n            var current_req = (utils.currentRequest() || {});\n            if (current_req.uuid === req.uuid) {\n                if (err) {\n                    return callback(err);\n                }\n                exports.runUpdate(fn, doc, req, function (err, res) {\n                    if (err) {\n                        events.emit('updateFailure', err, info, req, res, doc);\n                        return callback(err);\n                    }\n                    events.emit('afterResponse', info, req, res);\n                    if (res) {\n                        exports.handleResponse(req, res[1]);\n                    }\n                    else {\n                        // returned without response, meaning cookies won't be\n                        // set by handleResponseHeaders\n                        if (req.outgoing_flash_messages) {\n                            flashmessages.setCookieBrowser(\n                                req, req.outgoing_flash_messages\n                            );\n                        }\n                    }\n                    callback();\n                });\n            }\n        });\n    }\n    else {\n        exports.runUpdate(fn, null, req, function (err, res) {\n            if (err) {\n                events.emit('updateFailure', err, info, req, res, null);\n                return callback(err);\n            }\n            events.emit('afterResponse', info, req, res);\n            if (res) {\n                exports.handleResponse(req, res[1]);\n            }\n            else {\n                // returned without response, meaning cookies won't be set by\n                // handleResponseHeaders\n                if (req.outgoing_flash_messages) {\n                    flashmessages.setCookieBrowser(\n                        req, req.outgoing_flash_messages\n                    );\n                }\n            }\n            callback();\n        });\n    }\n};\n\n/**\n * Runs a update function with the given document and request object,\n * emitting relevant events. This function runs both server and client-side.\n *\n * @name runUpdate(fn, doc, req)\n * @param {Function} fn\n * @param {Object} doc\n * @param {Object} req\n * @api public\n */\n\nexports.runUpdate = function (fn, doc, req, cb) {\n    req = flashmessages.updateRequest(req);\n    utils.currentRequest(req);\n    var info = {\n        type: 'update',\n        name: req.path[1],\n        target: req.path[2],\n        query: req.query,\n        fn: fn\n    };\n    events.emit('beforeRequest', info, req);\n    var val = fn(doc, req);\n\n    var res = val ? val[1]: null;\n    if (!(res instanceof Object)) {\n        res = {code: 200, body: res};\n    }\n    else {\n        res = exports.parseResponse(req, res);\n    }\n    events.emit('beforeResponseStart', info, req, res);\n    events.emit('beforeResponseData', info, req, res, res.body || '');\n\n    var r = [\n        val ? val[0]: null,\n        flashmessages.updateResponse(req, res)\n    ];\n    if (req.client && r[0]) {\n        db.saveDoc(r[0], function (err, res) {\n            if (err) {\n                return cb(err);\n            }\n            req.response_received = true;\n            cb(null, r);\n        });\n    }\n    else {\n        req.response_received = true;\n        cb(null, r);\n    }\n};\n\n\n/**\n * Creates a fake head object from view results for passing to a list function\n * being run client-side.\n *\n * @name createHead(data)\n * @param {Object} data\n * @returns {Object}\n * @api public\n */\n\nexports.createHead = function (data) {\n    var head = {};\n    for (var k in data) {\n        if (k !== 'rows') {\n            head[k] = data[k];\n        }\n    }\n    return head;\n};\n\n\n/**\n * Fetches the relevant view and calls the named list function with the results.\n *\n * @name runListBrowser(req, name, view, callback)\n * @param {Object} req\n * @param {String} name\n * @param {String} view\n * @param {Function} callback\n * @api public\n */\n\nexports.runListBrowser = function (req, name, view, callback) {\n    var fn = kanso.app.lists[name];\n\n    var info = {\n        type: 'list',\n        name: name,\n        target: view,\n        query: req.query,\n        fn: fn\n    };\n    events.emit('beforeResource', info);\n\n    if (view) {\n        // update_seq used in head parameter passed to list function\n        req.query.update_seq = true;\n        db.getView(view, req.query, function (err, data) {\n            var current_req = (utils.currentRequest() || {});\n            if (current_req.uuid === req.uuid) {\n                if (err) {\n                    return callback(err);\n                }\n                getRow = function () {\n                    return data.rows.shift();\n                };\n                start = function (res) {\n                    //console.log('start');\n                    //console.log(res);\n                    exports.handleResponse(req, res);\n                };\n                var head = exports.createHead(data);\n                var res = exports.runList(fn, head, req);\n                events.emit('afterResponse', info, req, res);\n                if (res) {\n                    exports.handleResponse(req, res);\n                }\n                else {\n                    // returned without response, meaning cookies won't be set\n                    // by handleResponseHeaders\n                    if (req.outgoing_flash_messages) {\n                        flashmessages.setCookieBrowser(\n                            req, req.outgoing_flash_messages\n                        );\n                    }\n                }\n                getRow = function () {\n                    return null;\n                };\n                callback();\n            }\n        });\n    }\n    // TODO: check if it should throw here\n    else {\n        var e = new Error('no view specified');\n        if (callback) {\n            callback(e);\n        }\n        else {\n            throw e;\n        }\n    }\n};\n\n/**\n * Runs a list function with the given document and request object,\n * emitting relevant events. This function runs both server and client-side.\n *\n * @name runList(fn, head, req)\n * @param {Function} fn\n * @param {Object} head\n * @param {Object} req\n * @api public\n */\n\nexports.runList = function (fn, head, req) {\n    req = flashmessages.updateRequest(req);\n    utils.currentRequest(req);\n    var info = {\n        type: 'list',\n        name: req.path[1],\n        target: req.path[2],\n        query: req.query,\n        fn: fn\n    };\n    // cache response from start call\n    var start_res;\n    var _start = start;\n    start = function (res) {\n        start_res = res;\n        events.emit('beforeResponseStart', info, req, res);\n        if (res.body) {\n            events.emit('beforeResponseData', info, req, res, res.body);\n        }\n        _start(flashmessages.updateResponse(req, res));\n    };\n    var _send = send;\n    send = function (data) {\n        if (!start_res.body) {\n            start_res.body = '';\n        }\n        // TODO: does it make sense to store data here and use up memory\n        // on the server?\n        start_res.body += data;\n        events.emit('beforeResponseData', info, req, start_res, data);\n        _send(data);\n    };\n    events.emit('beforeRequest', info, req);\n    var val = fn(head, req);\n\n    if (val instanceof Object) {\n        val = exports.parseResponse(req, val).body;\n    }\n    if (!start_res) {\n        start_res = {code: 200, body: val};\n        events.emit('beforeResponseStart', info, req, start_res);\n        events.emit('beforeResponseData', info, req, start_res, val);\n        start = _start;\n        send = _send;\n    }\n    else {\n        start_res.body = start_res.body ? start_res.body + val: val;\n        events.emit('beforeResponseData', info, req, start_res, val);\n    }\n    start = _start;\n    send = _send;\n    req.response_received = true;\n    return val;\n};\n\n\n/**\n * Creates a request object for the url and runs appropriate show, list or\n * update functions.\n *\n * @name handle(method, url, data)\n * @param {String} method\n * @param {String} url\n * @param {Object} data\n * @api public\n */\n\nexports.handle = function (method, url, data) {\n    var match = exports.matchURL(method, url);\n    if (match) {\n        var parsed = urlParse(url);\n        exports.createRequest(method, url, data, match, function (err, req) {\n            if (err) {\n                throw err;\n            }\n            //console.log(req);\n\n            var msg = method + ' ' + url + ' -> ' +\n                JSON.stringify(req.path.join('/')) + ' ' +\n                JSON.stringify(req.query);\n\n            if (data) {\n                msg += ' data: ' + JSON.stringify(data);\n            }\n\n            console.log(msg);\n            utils.currentRequest(req);\n\n            var after = function () {\n                if (parsed.hash) {\n                    // we have to handle in-page anchors manually because we've\n                    // hijacked the hash part of the url\n                    // TODO: don't re-handle the page if only the hash has\n                    // changed\n\n                    // test if a valid element name or id\n                    if (/#[A-Za-z_\\-:\\.]+/.test(parsed.hash)) {\n                        var el = $(parsed.hash);\n                        if (el.length) {\n                            window.scrollTo(0, el.offset().top);\n                        }\n                    }\n                    else if (parsed.hash === '#') {\n                        // scroll to top of page\n                        window.scrollTo(0, 0);\n                    }\n                    // TODO: handle invalid values?\n                }\n            };\n\n            var src, fn, name;\n\n            if (req.path[0] === '_show') {\n                exports.runShowBrowser(\n                    req, req.path[1], req.path.slice(2).join('/'), after\n                );\n            }\n            else if (req.path[0] === '_list') {\n                exports.runListBrowser(\n                    req, req.path[1], req.path.slice(2).join('/'), after\n                );\n            }\n            else if (req.path[0] === '_update') {\n                exports.runUpdateBrowser(\n                    req, req.path[1], req.path.slice(2).join('/'), after\n                );\n            }\n            else {\n                console.log('Unknown rewrite target: ' + req.path.join('/'));\n                var newurl = exports.getBaseURL() + '/_db/_design/' +\n                    settings.name + '/' + req.path.join('/');\n                console.log('redirecting to: ' + newurl);\n                window.location = newurl;\n            }\n\n        });\n    }\n    else {\n        console.log(method + ' ' + url + ' -> [404]');\n        window.location = exports.getBaseURL() + url;\n    }\n\n    /**\n     * if google analytics is included on the page, and this url\n     * has not been tracked (not the initial hit) then manually\n     * track a page view. This is done consistently for hash-based\n     * and pushState urls\n     */\n    if (window.pageTracker && !utils.initial_hit) {\n        pageTracker._trackPageview(url);\n    }\n    utils.initial_hit = false;\n};\n\n\n/**\n * Add a history entry for the given url, prefixed with the baseURL for the app.\n *\n * @name setURL(method, url, data)\n * @param {String} method\n * @param {String} url\n * @param {Object} data (optional)\n * @api public\n */\n\nexports.setURL = function (method, url, data) {\n    var fullurl = exports.getBaseURL() + url;\n    var state = {\n        method: method,\n        data: data,\n        timestamp: new Date().getTime(),\n        history_count: window.history.length + 1\n    };\n    // this is the result of a direct call to setURL\n    // (don't show confirmation dialog for unsafe states needing to re-submit)\n    exports.set_called = true;\n\n    /**\n     * if the current request is unsafe, we replace it so clicking the back\n     * button 'skips' it without showing a dialog.\n     *\n     * This means GET1, POST2, GET3 would result in a history of GET1, GET3.\n     * Clicking back after GET3 wouldn't re-submit a form.\n     *\n     * Doing GET1, POST2, then clicking back and forward again would result\n     * in a confirmation dialog asking if you want to re-submit.\n     */\n\n    var curr_state = exports.current_state;\n    var curr_method = curr_state ? (curr_state.method || 'GET'): 'GET';\n\n    if (curr_method !== 'GET' && curr_method !== 'HEAD') {\n        // unsafe method on current request, replace it\n        window.history.replaceState(state, document.title, fullurl);\n    }\n    else {\n        // last request was safe, add a new entry in the history\n        window.history.pushState(state, document.title, fullurl);\n    }\n    // manually fire popstate event\n    window.onpopstate({state: state});\n};\n\n\n/**\n * This was moved to utils to avoid a circular dependency between\n * core.js and db.js... however, it should be accessed via the core.js module\n * as it may get moved back once circular dependencies are fixed in couchdb's\n * commonjs implementation.\n */\n\nexports.getBaseURL = utils.getBaseURL;\n\n\n/**\n * Gets the current app-level URL (without baseURL prefix).\n *\n * @name getURL()\n * @returns {String}\n * @api public\n */\n\nexports.getURL = function () {\n    var re = new RegExp('\\\\/_rewrite(.*)$');\n\n    var loc = urlParse(window.location),\n        match = re.exec(loc.pathname);\n\n    if (match) {\n        var newurl = {\n            pathname: match[1] || '/',\n            hash: loc.hash\n        };\n        if (loc.search) {\n            newurl.search = loc.search;\n        }\n        return urlFormat(newurl) || '/';\n    }\n    return '' + window.location || '/';\n};\n\n/**\n * Tests is two urls are of the same origin. Accepts parsed url objects\n * or strings as arguments.\n *\n * @name sameOrigin(a, b)\n * @param a\n * @param b\n * @returns Boolean\n * @api public\n */\n\nexports.sameOrigin = function (a, b) {\n    var ap = (typeof a === 'string') ? urlParse(a): a;\n    var bp = (typeof b === 'string') ? urlParse(b): b;\n    // if one url is relative to current origin, return true\n    if (ap.protocol === undefined || bp.protocol === undefined) {\n        return true;\n    }\n    return (\n        ap.protocol === bp.protocol &&\n        ap.hostname === bp.hostname &&\n        ap.port === bp.port\n    );\n};\n\n/**\n * Converts a full url to an app-level url (without baseURL prefix).\n * example: {baseURL}/some/path -> /some/path\n *\n * @name appPath(p)\n * @param {String} p\n * @returns {String}\n * @api public\n */\n\nexports.appPath = function (p) {\n    // hash links need current URL prepending\n    if (p.charAt(0) === '#') {\n        var newurl = urlParse(exports.getURL());\n        newurl.hash = p;\n        return exports.appPath(urlFormat(newurl));\n    }\n    else if (p.charAt(0) === '?') {\n        // if the request is just a query, then prepend the current app path\n        // as a browser would\n        var newurl2 = urlParse(exports.getURL());\n        delete newurl2.query;\n        delete newurl2.search;\n        delete newurl2.href;\n        newurl2.search = p;\n        return exports.appPath(urlFormat(newurl2));\n    }\n    else if (/\\w+:/.test(p)) {\n        // include protocol\n        var origin = p.split('/').slice(0, 3).join('/');\n        // coerce window.location to a real string so we can use split in IE\n        var loc = '' + window.location;\n        if (origin === loc.split('/').slice(0, 3).join('/')) {\n            // remove origin, set p to pathname only\n            // IE often adds this to a tags, hence why we strip it out now\n            p = p.substr(origin.length);\n        }\n        else {\n            // not same origin, return original full path\n            return p;\n        }\n    }\n    var base = exports.getBaseURL();\n    if (p.substr(0, base.length) === base) {\n        return p.substr(base.length);\n    }\n    return p;\n};\n\n\n/**\n * Used to decide whether to handle a link or not. Should detect app vs.\n * external urls.\n *\n * @name isAppURL(url)\n * @param {String} url\n * @returns {Boolean}\n * @api public\n */\n\nexports.isAppURL = function (url) {\n    // coerce window.location to a real string in IE\n    return exports.sameOrigin(url, '' + window.location);\n};\n",
        "events": "/*global __kansojs_event_listeners: true*/\n\n/**\n * The events module handles events emitted by Kanso as well as custom\n * events defined by a Kanso app. These events can be used client-side\n * or server-side. Although you are limited to synchronous operation on\n * the server, so events are less likely to be useful there.\n *\n * @module\n */\n\n/**\n * Module dependencies\n */\n\nvar _ = require('./underscore')._;\n\n\n/**\n * Stores the bound listeners\n *\n * These must be stored in a global since the forms code fires some events using\n * script tags, which will fail to reference the listeners object if a local var\n * is used.\n *\n * We test for a pre-existing global as admin app might require this module\n * in multiple contexts, and we don't want to lose previous event listeners.\n */\n\nif (typeof __kansojs_event_listeners === 'undefined') {\n    __kansojs_event_listeners = {};\n}\n\n\n/**\n * Adds a listener function for the given event name.\n *\n * @name on(name, listener)\n * @param {String} name\n * @param {Function} listener\n * @api public\n */\n\nexports.on = function (name, listener) {\n    if (!__kansojs_event_listeners[name]) {\n        __kansojs_event_listeners[name] = [];\n    }\n    __kansojs_event_listeners[name].push(listener);\n};\n\n/**\n * Binds an event listener to the given event name, but unbinds it\n * after its first invocation.\n *\n * @name once(name, listener)\n * @param {String} name\n * @param {Function} listener\n * @api public\n */\n\nexports.once = function (name, listener) {\n    var fn = function () {\n        var result = listener.apply(this, arguments);\n        exports.removeListener(name, listener);\n        return result;\n    };\n    fn.listener = listener;\n    exports.on(name, fn);\n};\n\n/**\n * Triggers any event listeners bound to the given event name. Listeners\n * are called in the order they were bound. If a listener returns false\n * subsequent event listeners in the chain are not called.\n *\n * The first argument is the event name to emit any additional arguments\n * are used as arguments to the bound event listeners.\n *\n * @name emit(name, [...])\n * @param {String} name\n * @param ...\n * @api public\n */\n\nexports.emit = function (name) {\n    var args = Array.prototype.slice.call(arguments, 1);\n    var fns = exports.listeners(name);\n    for (var i = 0, len = fns.length; i < len; i++) {\n        var result = fns[i].apply(null, args);\n        if (result === false) {\n            return;\n        }\n    }\n};\n\n/**\n * Returns an array of the bound event listeners for the given event name.\n * If no events are bound, an empty array is returned.\n *\n * @name listeners(name)\n * @param {String} name\n * @returns {Array}\n * @api public\n */\n\nexports.listeners = function (name) {\n    var fns = __kansojs_event_listeners[name] || [];\n    return __kansojs_event_listeners[name] || [];\n};\n\n/**\n * Removes all bound event listeners for a given event name.\n *\n * @name removeAllListeners(name)\n * @param {String} name\n * @api public\n */\n\nexports.removeAllListeners = function (name) {\n    delete __kansojs_event_listeners[name];\n};\n\n/**\n * Removes a specific event listener for a given event name.\n *\n * @name removeListener(name, listener)\n * @param {String} name\n * @param {Function} listener\n * @api public\n */\n\nexports.removeListener = function (name, listener) {\n    __kansojs_event_listeners[name] = _.filter(exports.listeners(name), function (l) {\n        return l !== listener && (!l.listener || l.listener !== listener);\n    });\n};\n",
        "db": "/*global $: false, kanso: true */\n\n/**\n * Contains functions for querying and storing data in CouchDB.\n *\n * @module\n */\n\n\n/**\n * Module dependencies\n */\n\nvar utils = require('./utils'),\n    settings = require('./settings'),\n    session = null;\n\n/* Avoid a circular require in CouchDB */\n\nif (utils.isBrowser) {\n    session = require('./session');\n}\n\n\n/**\n * When a db call results in an unauthorized response, the user's session is\n * checked to see if their session has timed out or they've logged out in\n * another screen.\n *\n * This check is throttled to once per second, to avoid flooding the server if\n * multiple requests are made with incorrect permissions.\n */\n\nvar last_session_check = 0;\n\n\n/**\n * Cache for design documents fetched via getDesignDoc.\n */\n\nexports.design_docs = {};\n\n\n/**\n * Taken from jQuery 1.4.4 so we can support more recent versions of jQuery.\n */\n\nvar httpData = function (xhr, type, s) {\n    var ct = xhr.getResponseHeader(\"content-type\") || \"\",\n        xml = type === \"xml\" || !type && ct.indexOf(\"xml\") >= 0,\n        data = xml ? xhr.responseXML : xhr.responseText;\n\n    if (xml && data.documentElement.nodeName === \"parsererror\") {\n        $.error(\"parsererror\");\n    }\n    if (s && s.dataFilter) {\n        data = s.dataFilter(data, type);\n    }\n    if (typeof data === \"string\") {\n        if (type === \"json\" || !type && ct.indexOf(\"json\") >= 0) {\n            data = $.parseJSON(data);\n        }\n        else if (type === \"script\" || !type && ct.indexOf(\"javascript\") >= 0) {\n            $.globalEval(data);\n        }\n    }\n    return data;\n};\n\n\n/**\n * Returns a function for handling ajax responsed from jquery and calls\n * the callback with the data or appropriate error.\n *\n * @param {Function} callback\n * @api private\n */\n\nfunction onComplete(options, callback) {\n    return function (req) {\n        var resp;\n        var ctype = req.getResponseHeader('Content-Type');\n        if (ctype === 'application/json' || ctype === 'text/json') {\n            try {\n                resp = httpData(req, \"json\");\n            }\n            catch (e) {\n                return callback(e);\n            }\n        }\n        else {\n            if (options.expect_json) {\n                return callback(\n                    new Error('Expected JSON response, got ' + ctype)\n                );\n            }\n            resp = req.responseText;\n        }\n        if (req.status === 401) {\n            // returned 'Unauthorized', check the user's session if it's not\n            // been checked on an 'Unauthorized' repsonse in the last second\n            if (session && last_session_check < new Date().getTime() - 1000) {\n                session.info();\n            }\n        }\n        if (req.status === 200 || req.status === 201 || req.status === 202) {\n            callback(null, resp);\n        }\n        else if (resp.error) {\n            var err = new Error(resp.reason || resp.error);\n            err.error = resp.error;\n            err.reason = resp.reason;\n            err.status = req.status;\n            callback(err);\n        }\n        else {\n            // TODO: map status code to meaningful error message\n            callback(new Error('Returned status code: ' + req.status));\n        }\n    };\n}\n\n/**\n * Encodes a document id or view, list or show name.\n *\n * @name encode(str)\n * @param {String} str\n * @returns {String}\n * @api public\n */\n\nexports.encode = function (str) {\n    return encodeURIComponent(str).replace(/^_design%2F/, '_design/');\n};\n\n\n/**\n * Make a request, with some default settings and proper callback\n * handling. Used behind-the-scenes by most other DB module functions.\n *\n * @name request(options, callback)\n * @param {Object} options\n * @param {Function} callback\n * @api public\n */\n\nexports.request = function (options, callback) {\n    options.complete = onComplete(options, callback);\n    options.dataType = 'json';\n    $.ajax(options);\n};\n\n\n/**\n * Fetches a rewrite from the database the app is running on. Results\n * are passed to the callback, with the first argument of the callback\n * reserved for any exceptions that occurred (node.js style).\n *\n * @name getRewrite(path, [q], callback)\n * @param {String} path\n * @param {Object} q (optional)\n * @param {Function} callback\n * @api public\n */\n\nexports.getRewrite = function (path, /*optional*/q, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('getRewrite cannot be called server-side');\n    }\n    if (!callback) {\n        callback = q;\n        q = {};\n    }\n    // prepend forward-slash if missing\n    path = (path[0] === '/') ? path: '/' + path;\n\n    var base = utils.getBaseURL();\n    var name = exports.encode(settings.name);\n    var req = {\n        url: base + '/_db/_design/' + name + '/_rewrite' + path,\n        data: exports.stringifyQuery(q)\n    };\n    exports.request(req, callback);\n};\n\n\n/**\n * Fetches a document from the database the app is running on. Results are\n * passed to the callback, with the first argument of the callback reserved\n * for any exceptions that occurred (node.js style).\n *\n * @name getDoc(id, [q, options], callback)\n * @param {String} id\n * @param {Object} q (optional)\n * @param {Object} options (optional)\n * @param {Function} callback\n * @api public\n */\n\nexports.getDoc = function (id, /*optional*/q, /*optional*/options, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('getDoc cannot be called server-side');\n    }\n    if (!id) {\n        throw new Error('getDoc requires an id parameter to work properly');\n    }\n    if (!callback) {\n        if (!options) {\n            /* Arity = 2: Omits q, options */\n            callback = q;\n            options = {};\n            q = {};\n        } else {\n          /* Arity = 3: Omits options */\n            callback = options;\n            options = {};\n        }\n    }\n    var url;\n    if (options.db) {\n        /* Force leading slash; make absolute path */\n        url = (options.db.substr(0, 1) !== '/' ? '/' : '') + options.db;\n    } else {\n        url = utils.getBaseURL() + '/_db';\n    }\n    var req = {\n        url: url + '/' + exports.encode(id),\n        data: exports.stringifyQuery(q),\n        expect_json: true\n    };\n    exports.request(req, callback);\n};\n\n\n/**\n * Saves a document to the database the app is running on. Results are\n * passed to the callback, with the first argument of the callback reserved\n * for any exceptions that occurred (node.js style).\n *\n * @name saveDoc(doc, [options], callback)\n * @param {Object} doc\n * @param {Object} options (optional)\n * @param {Function} callback\n * @api public\n */\n\nexports.saveDoc = function (doc, /*optional*/options, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('saveDoc cannot be called server-side');\n    }\n    var method, url;\n    if (options.db) {\n        /* Force leading slash; make absolute path */\n        url = (options.db.substr(0, 1) !== '/' ? '/' : '') + options.db;\n    } else {\n        url = utils.getBaseURL() + '/_db';\n    }\n    if (!callback) {\n        /* Arity = 2: Omits options */\n        callback = options;\n        options = {};\n    }\n    if (doc._id === undefined) {\n        method = \"POST\";\n    }\n    else {\n        method = \"PUT\";\n        url += '/' + doc._id;\n    }\n    var req = {\n        type: method,\n        url: url,\n        data: JSON.stringify(doc),\n        processData: false,\n        contentType: 'application/json',\n        expect_json: true\n    };\n    exports.request(req, callback);\n};\n\n/**\n * Deletes a document from the database the app is running on. Results are\n * passed to the callback, with the first argument of the callback reserved\n * for any exceptions that occurred (node.js style).\n *\n * @name removeDoc(doc, [options], callback)\n * @param {Object} doc\n * @param {Function} callback\n * @api public\n */\n\nexports.removeDoc = function (doc, /*optional*/options, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('removeDoc cannot be called server-side');\n    }\n    if (!doc._id) {\n        throw new Error('removeDoc requires an _id field in your document');\n    }\n    if (!doc._rev) {\n        throw new Error('removeDoc requires a _rev field in your document');\n    }\n    if (!callback) {\n        /* Arity = 2: Omits options */\n        callback = options;\n        options = {};\n    }\n    var url;\n    if (options.db) {\n        /* Force leading slash; make absolute path */\n        url = (options.db.substr(0, 1) !== '/' ? '/' : '') + options.db + '/';\n    } else {\n        url = utils.getBaseURL() + '/_db/';\n    }\n    url += exports.encode(doc._id) + '?rev=' + exports.encode(doc._rev);\n    var req = {\n        type: 'DELETE',\n        url: url\n    };\n    exports.request(req, callback);\n};\n\n\n/**\n * Fetches a view from the database the app is running on. Results are\n * passed to the callback, with the first argument of the callback reserved\n * for any exceptions that occurred (node.js style).\n *\n * @name getView(view, [q], callback)\n * @param {String} view\n * @param {Object} q (optional)\n * @param {Function} callback\n * @api public\n */\n\nexports.getView = function (view, /*optional*/q, /*optional*/options, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('getView cannot be called server-side');\n    }\n    if (!callback) {\n        if (!options) {\n            /* Arity = 2: Omits q, options */\n            callback = q;\n            options = {};\n            q = {};\n        } else {\n          /* Arity = 3: Omits options */\n            callback = options;\n            options = {};\n        }\n    }\n    var base;\n    if (options.db) {\n        /* Force leading slash; make absolute path */\n        base = (options.db.substr(0, 1) !== '/' ? '/' : '') + options.db;\n    } else {\n        base = utils.getBaseURL();\n    }\n    var name = exports.encode(settings.name);\n    var viewname = exports.encode(view);\n    var req = {\n        url: (\n            base + (options.db ? '' : '/_db') + '/_design/' +\n                (options.db || name) + '/_view/' + viewname\n        ),\n        data: exports.stringifyQuery(q),\n        expect_json: true\n    };\n    exports.request(req, callback);\n};\n\n\n/**\n * Transforms and fetches a view through a list from the database the app\n * is running on. Results are passed to the callback, with the first\n * argument of the callback reserved for any exceptions that occurred\n * (node.js style).\n *\n * @name getList(list, view, [q], callback)\n * @param {String} list\n * @param {String} view\n * @param {Object} q (optional)\n * @param {Function} callback\n * @api public\n */\n\n// TODO: run list function client-side?\nexports.getList = function (list, view, /*optional*/q, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('getList cannot be called server-side');\n    }\n    if (!callback) {\n        callback = q;\n        q = {};\n    }\n    var base = utils.getBaseURL();\n    var name = exports.encode(settings.name);\n    var listname = exports.encode(list);\n    var viewname = exports.encode(view);\n    var req = {\n        url: base + '/_db/_design/' + name + '/_list/' + listname +\n             '/' + viewname,\n        data: exports.stringifyQuery(q)\n    };\n    exports.request(req, callback);\n};\n\n/**\n * Transforms and fetches a document through a show from the database the app\n * is running on. Results are passed to the callback, with the first\n * argument of the callback reserved for any exceptions that occurred\n * (node.js style).\n *\n * @name getShow(show, docid, [q], callback)\n * @param {String} show\n * @param {String} docid\n * @param {Object} q (optional)\n * @param {Function} callback\n * @api public\n */\n\n// TODO: run show function client-side?\nexports.getShow = function (show, docid, /*optional*/q, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('getShow cannot be called server-side');\n    }\n    if (!callback) {\n        callback = q;\n        q = {};\n    }\n    var base = utils.getBaseURL();\n    var name = exports.encode(settings.name);\n    var showname = exports.encode(show);\n    var show_url = base + '/_db/_design/' + name + '/_show/' + showname;\n    var req = {\n        url: show_url + (docid ? '/' + exports.encode(docid): ''),\n        data: exports.stringifyQuery(q)\n    };\n    exports.request(req, callback);\n};\n\n\n/**\n * Get all documents (including design docs).\n *\n * @name all([q], callback)\n * @param {Object} q (optional)\n * @param {Function} callback\n * @api public\n */\n\nexports.all = function (/*optional*/q, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('all cannot be called server-side');\n    }\n    if (!callback) {\n        callback = q;\n        q = {};\n    }\n    var base = utils.getBaseURL();\n    var req = {\n        url: base + '/_db/_all_docs',\n        data: exports.stringifyQuery(q),\n        expect_json: true\n    };\n    exports.request(req, callback);\n};\n\n\n/**\n * Properly encodes query parameters to CouchDB views etc. Handle complex\n * keys and other non-string parameters by passing through JSON.stringify.\n * Returns a shallow-copied clone of the original query after complex values\n * have been stringified.\n *\n * @name stringifyQuery(query)\n * @param {Object} query\n * @returns {Object}\n * @api public\n */\n\nexports.stringifyQuery = function (query) {\n    var q = {};\n    for (var k in query) {\n        if (typeof query[k] !== 'string') {\n            q[k] = JSON.stringify(query[k]);\n        }\n        else {\n            q[k] = query[k];\n        }\n    }\n    return q;\n};\n\n\n/**\n * Returns a new UUID generated by CouchDB. Its possible to cache\n * multiple UUIDs for later use, to avoid making too many requests.\n *\n * @name newUUID(cacheNum, callback)\n * @param {Number} cacheNum (optional, default: 1)\n * @param {Function} callback\n * @api public\n */\n\nvar uuidCache = [];\n\nexports.newUUID = function (cacheNum, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('newUUID cannot be called server-side');\n    }\n    if (!callback) {\n        callback = cacheNum;\n        cacheNum = 1;\n    }\n    if (uuidCache.length) {\n        return callback(null, uuidCache.shift());\n    }\n    var base = utils.getBaseURL();\n    var req = {\n        url: '/_uuids',\n        data: {count: cacheNum},\n        expect_json: true\n    };\n    exports.request(req, function (err, resp) {\n        if (err) {\n            return callback(err);\n        }\n        uuidCache = resp.uuids;\n        callback(null, uuidCache.shift());\n    });\n};\n\n/**\n * Creates a CouchDB database.\n *\n * If you're running behind a virtual host you'll need to set up\n * appropriate rewrites for a PUT request to '/' and turn off safe rewrites.\n *\n * @name createDatabase(name, callback)\n * @param {String} name\n * @param {Function} callback\n * @api public\n */\n\nexports.createDatabase = function (name, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('createDatabase cannot be called server-side');\n    }\n    var req = {\n        type: 'PUT',\n        url: '/' + exports.encode(name.replace(/^\\/+/, ''))\n    };\n    exports.request(req, callback);\n};\n\n/**\n * Deletes a CouchDB database.\n *\n * If you're running behind a virtual host you'll need to set up\n * appropriate rewrites for a DELETE request to '/' and turn off safe rewrites.\n *\n * @name deleteDatabase(name, callback)\n * @param {String} name\n * @param {Function} callback\n * @api public\n */\n\nexports.deleteDatabase = function (name, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('deleteDatabase cannot be called server-side');\n    }\n    var req = {\n        type: 'DELETE',\n        url: '/' + exports.encode(name.replace(/^\\/+/, ''))\n    };\n    exports.request(req, callback);\n};\n\n\n/**\n * Fetches the most recent revision of the replication document\n * referred to by the id parameter.\n *\n * If you're running behind a virtual host you'll need to set up\n * appropriate rewrites to /_replicator, which will also mean turning\n * off safe rewrites.\n *\n * This function only works with CouchDB >= 1.1, since it uses the\n * _replicator database.\n *\n * @name getReplication(id, callback)\n * @param {String} id\n * @param {Function} callback\n * @api public\n */\n\nexports.getReplication = function (id, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('getReplication cannot be called server-side');\n    }\n    var req = {\n        url: '/_replicator/' + exports.encode(id),\n        cache: false /* Work around IE7 issue */\n    };\n    exports.request(req, callback);\n};\n\n/**\n * Replicates options.source to options.target. The strings\n * options.source and options.target are each either a\n * CouchDB database name or a CouchDB database URI.\n *\n * If you're running behind a virtual host you'll need to set up\n * appropriate rewrites to /_replicator, which will also mean turning\n * off safe rewrites.\n *\n * This function only works with CouchDB >= 1.1, since it uses the\n * _replicator database.\n *\n * @name startReplication(options, callback)\n * @param {Object} options\n * @param {Function} callback\n * @api public\n */\n\nexports.startReplication = function (options, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('startReplication cannot be called server-side');\n    }\n    if (!options.source) {\n        throw new Error('source parameter must be provided');\n    }\n    if (!options.target) {\n        throw new Error('target parameter must be provided');\n    }\n    var req = {\n        type: 'POST',\n        url: '/_replicator',\n        data: JSON.stringify(options),\n        contentType: 'application/json'\n    };\n    exports.request(req, callback);\n};\n\n/**\n * Waits for a replication operation to enter a specific state.\n * waitReplication polls the _replication database using the\n * doc provided, and evaluates state_function(doc) at each iteration.\n * This function stops polling and invokes callback when the\n * state_function evaluates to true. If state_function is not\n * provided, waitReplication waits for the doc's _replication_state\n * to change from 'triggered' to 'completed' (or 'error').\n *\n * If you're running behind a virtual host you'll need to set up\n * appropriate rewrites to /_replicator, which will also mean turning\n * off safe rewrites.\n *\n * This function only works with CouchDB >= 1.1, since it uses the\n * _replicator database.\n *\n * @name waitReplication(doc, [options, state_function], callback)\n * @param {Object} doc\n * @param {Function} state_function (optional)\n * @param {Function} callback\n * @api public\n */\n\nexports.waitReplication = function (doc, /*optional*/options, /*optional*/state_function, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('waitReplication cannot be called server-side');\n    }\n    var default_state_function = function (recent_doc, initial_doc) {\n        return (\n          recent_doc._replication_state === 'completed' ||\n              recent_doc._replication_state === 'error'\n        );\n    };\n    if (!callback) {\n        if (!state_function) {\n            /* Arity = 2: doc, callback */\n            callback = options;\n            options = {};\n            state_function = default_state_function;\n        } else {\n            /* Arity = 3: doc, options, callback */\n            callback = state_function;\n            state_function = default_state_function;\n        }\n    }\n    if (options === undefined) {\n        options = {};\n    }\n    if (options.limit === undefined) {\n        options.limit = 100; /* times */\n    }\n    if (options.delay === undefined) {\n        options.delay = 2000; /* ms */\n    }\n\n    /* Fetch latest revision */\n    exports.getReplication(doc.id, function (err, rv) {\n\n        /* Check for error, then for an interesting event */\n        if (err || state_function(rv, doc)) {\n            return callback(err, rv, doc);\n        }\n        /* Termination condition for recursion... */\n        if (options.limit > 0) {\n\n            /* ...with well-defined progress toward it */\n            options.limit -= 1;\n\n            /* Go around */\n            return setTimeout(function () {\n                return exports.waitReplication(\n                    doc, options, state_function, callback\n                );\n            }, options.delay);\n        }\n    });\n};\n\n/**\n * Stops a replication operation already in progress.\n * The doc parameter can be obtained by calling getReplication.\n *\n * If you're running behind a virtual host you'll need to set up\n * appropriate rewrites to /_replicator, which will also mean turning\n * off safe rewrites.\n *\n * This function only works with CouchDB >= 1.1, since it uses the\n * _replicator database.\n *\n * @name stopReplication(doc, callback, [options])\n * @param {String} id\n * @param {Function} callback\n * @param {Function} options\n * @api public\n */\n\nexports.stopReplication = function (doc, callback, /*optional*/options) {\n\n    if (!utils.isBrowser()) {\n        throw new Error('stopReplication cannot be called server-side');\n    }\n\n    if (options === undefined) {\n        options = {};\n    }\n    if (options.limit === undefined || options.limit === null) {\n        options.limit = 3; /* times */\n    }\n    if (options.delay === undefined || options.delay === null) {\n        options.delay = 500; /* ms */\n    }\n\n    var req = {\n        type: 'DELETE',\n        url: '/_replicator/' +\n          exports.encode(doc._id) +\n          '?rev=' + exports.encode(doc._rev)\n    };\n\n    exports.request(req, function (err, rv) {\n\n        if (err && err.status === 409) {  /* Document update conflict */\n\n            /* Race condition:\n                The CouchDB replication finished (or was updated) between\n                the caller's getReplication and now. Subject to restrictions\n                in options, call getReplication and then try again. */\n\n            /* Termination condition for recursion... */\n            if (options.limit > 0) {\n\n                /* ...with well-defined progress toward it */\n                options.limit -= 1;\n\n                return exports.getReplication(doc._id, function (e, d) {\n                    if (e) {\n                        throw new Error(\n                          'The specified replication document changed ' +\n                          'since last read, and we failed to re-request it'\n                        );\n                    }\n                    /* Go around */\n                    setTimeout(function () {\n                        return exports.stopReplication(d, callback, options);\n                    }, options.delay);\n                });\n            }\n\n        } else {\n\n            /* Normal case:\n                Replication document was not changed since the last\n                read; go ahead and invoke the callback and return. */\n\n            return callback(err, rv);\n        }\n\n        /* Not reached */\n        return false;\n\n    });\n\n};\n\n/**\n * Deletes an existing user document, given its username. You\n * must be logged in as an administrative user for this function\n * to succeed.\n *\n * @name deleteUser(username, callback)\n * @param {String} username\n * @param {Function} callback\n * @api public\n */\n\nexports.deleteUser = function (username, callback) {\n    var id = 'org.couchdb.user:' + username;\n\n    exports.userDb(function (err, userdb) {\n        if (err) {\n            return callback(err);\n        }\n        var req = {\n            type: 'DELETE',\n            url: '/' + exports.encode(userdb) + '/' + exports.encode(id),\n            contentType: 'application/json'\n        };\n        exports.request(req, callback);\n    });\n};\n\n/**\n * Fetch a design document from CouchDB. By default, the\n * results of this function are cached within the javascript\n * engine. To avoid this, pass true for the no_cache argument.\n *\n * @name getDesignDoc(name, callback, no_cache)\n * @param name The name of (i.e. path to) the design document.\n * @param callback The callback to invoke when the request completes.\n * @param no_cache optional; true to force a cache miss for this request.\n * @api public\n */\n\nexports.getDesignDoc = function (name, callback, no_cache) {\n    if (!no_cache && exports.design_docs[name]) {\n        return callback(null, exports.design_docs[name]);\n    }\n    exports.getDoc('_design/' + name, {}, function (err, ddoc) {\n        if (err) {\n            return callback(err);\n        }\n        exports.design_docs[name] = ddoc;\n        return callback(null, exports.design_docs[name]);\n    });\n};\n\n",
        "fieldset": "/**\n * Functions for dealing with collections of fields. Used by both the\n * types and forms modules.\n *\n * @module\n */\n\n/**\n * Module dependencies\n */\n\nvar _ = require('./underscore')._,\n    utils = require('./utils');\n\n\n/**\n * Returns a hierachy of default values for a given set of Field objects\n *\n * @name createDefaults(fields, req)\n * @param {Object} fields\n * @param {Object} req - the request object to pass to default_value functions\n * @returns {Object}\n * @api public\n */\n\nexports.createDefaults = function (fields, /*optional*/req) {\n    if (!req) {\n        req = utils.currentRequest();\n    }\n    var fields_module = require('./fields');\n    return _.reduce(_.keys(fields), function (result, k) {\n        var f = fields[k];\n        if (f instanceof fields_module.Field ||\n            f instanceof fields_module.Embedded ||\n            f instanceof fields_module.EmbeddedList) {\n            if (f.hasOwnProperty('default_value')) {\n                if (_.isFunction(f.default_value)) {\n                    result[k] = f.default_value(req);\n                }\n                else {\n                    result[k] = f.default_value;\n                }\n            }\n        }\n        else if (f instanceof Object) {\n            result[k] = exports.createDefaults(f, req);\n        } else {\n            throw new Error(\n                'The field type `' + (typeof f) + '` is not supported.'\n            );\n        }\n        return result;\n    }, {});\n};\n\n/**\n * Validate a specific field, returning all validation errors as an array with\n * each error's field property prefixed by the current path.\n *\n * @name validateField(field, doc, value, raw, path)\n * @param {Field} field\n * @param {Object} doc\n * @param value\n * @param raw\n * @param {Array} path\n * @returns {Array}\n * @api public\n */\n\nexports.validateField = function (field, doc, value, raw, path) {\n    return _.map(field.validate(doc, value, raw), function (err) {\n        err.field = path.concat(err.field || []);\n        err.has_field = true;\n        return err;\n    });\n};\n\n/**\n * Validates an object containing fields or other sub-objects, iterating over\n * each property and recursing through sub-objects to find all Fields.\n *\n * Returns an array of validation errors, each with a field property set to the\n * path of the field which caused the error.\n *\n * @name validate(fields, doc, values, raw, path, extra)\n * @param {Object} fields\n * @param {Object} doc\n * @param {Object} values\n * @param {Object} raw\n * @param {Array} path\n * @param {Boolean} extra - whether to allow extra values not covered by a field\n * @returns {Array}\n * @api public\n */\n\nexports.validate = function (fields, doc, values, raw, path, extra) {\n    values = values || {};\n    fields = fields || {};\n    raw = raw || {};\n\n    // Expecting sub-object, not a value\n    if (typeof values !== 'object') {\n        var e = new Error('Unexpected property - validation 1');\n        e.field = path;\n        e.has_field = false;\n        return [e];\n    }\n\n    // Ensure we walk through all paths of both fields and values by combining\n    // the keys of both. Otherwise, we might miss out checking for missing\n    // required fields, or may not detect the presence of extra fields.\n\n    var keys = _.uniq(_.keys(fields).concat(_.keys(values)));\n    var fields_module = require('./fields');\n\n    return _.reduce(keys, function (errs, k) {\n        var f = fields[k];\n        if (f === undefined) {\n            // Extra value with no associated field detected\n            if (!extra) {\n                // ignore system properties\n                if (!(path.length === 0 && k.charAt(0) === '_')) {\n                    var e = new Error('Unexpected property - validation 2');\n                    e.field = path.concat([k]);\n                    e.has_field = false;\n                    errs.push(e);\n                }\n            }\n            return errs;\n        }\n        var fn = exports.validate;\n        if (f instanceof fields_module.Field ||\n            f instanceof fields_module.Embedded ||\n            f instanceof fields_module.EmbeddedList) {\n            fn = exports.validateField;\n        }\n        return errs.concat(\n            fn.call(this, f, doc, values[k], raw[k], path.concat([k]), extra)\n        );\n    }, []);\n};\n\n/**\n * Authorize a specific field, returning all permissions errors as an array with\n * each error's field property prefixed by the current path.\n *\n * @name authField(f, nDoc, oDoc, nVal, oVal, user, path)\n * @param {Field} f     - field object\n * @param {Object} nDoc - new document\n * @param {Object} oDoc - old document\n * @param nVal          - new field value\n * @param oVal          - old field value\n * @param {Object} user - user context object\n * @param {Array} path  - current path\n * @returns {Array}\n * @api public\n */\n\nexports.authField = function (f, nDoc, oDoc, nVal, oVal, user, path) {\n    //log('authField: ' + path.join('.'));\n    return _.map(f.authorize(nDoc, oDoc, nVal, oVal, user), function (err) {\n        err.field = path.concat(err.field || []);\n        err.has_field = true;\n        return err;\n    });\n};\n\n/**\n * Authorizes an object containing fields or other sub-objects, iterating over\n * each property and recursing through sub-objects to find all Fields.\n *\n * Returns an array of permissions errors, each with a field property set to the\n * path of the field which caused the error.\n *\n * @name authFieldSet(f, nDoc, oDoc, nVal, oVal, user, path)\n * @param {Field} f     - field object\n * @param {Object} nDoc - new document\n * @param {Object} oDoc - old document\n * @param nVal          - new field value\n * @param oVal          - old field value\n * @param {Object} user - user context object\n * @param {Array} path  - current path\n * @param {Boolean} extra - whether to raise an error on additional fields\n * @returns {Array}\n * @api public\n */\n\nexports.authFieldSet = function (f, nDoc, oDoc, nVal, oVal, user, path, extra) {\n    //log('authFieldSet: ' + path.join('.'));\n    nVal = nVal || {};\n    oVal = oVal || {};\n    f = f || {};\n\n    // Expecting sub-object, not a value\n    // This *should* be picked up by validation, and be raised as a validation\n    // error before it gets to the auth stage\n    if (typeof nVal !== 'object') {\n        var e = new Error('Unexpected property 1');\n        e.field = path;\n        e.has_field = false;\n        return [e];\n    }\n\n    // Ensure we walk through all paths of both fields and values by combining\n    // the keys of both. Otherwise, we might miss out checking for missing\n    // required fields, or may not detect the presence of extra fields.\n\n    var fKeys = _.keys(f);\n    var newKeys = _.keys(nVal);\n    var oldKeys = _.keys(oVal);\n    var keys = _.uniq(fKeys.concat(newKeys).concat(oldKeys));\n\n    var fields_module = require('./fields');\n\n    return _.reduce(keys, function (errs, k) {\n        var field = f[k];\n        if (field === undefined) {\n            // Extra value with no associated field detected\n            // This *should* be picked up by validation, and be raised as a\n            // validation error before it gets to the auth stage\n            if (!extra) {\n                // ignore system properties\n                if (!(path.length === 0 && k.charAt(0) === '_')) {\n                    var e = new Error('Unexpected property 2');\n                    e.field = path.concat([k]);\n                    e.has_field = false;\n                    errs.push(e);\n                }\n            }\n            return errs;\n        }\n        var fn = exports.authFieldSet;\n        if (field instanceof fields_module.Field ||\n            field instanceof fields_module.Embedded ||\n            field instanceof fields_module.EmbeddedList) {\n            fn = exports.authField;\n        }\n        return errs.concat(fn(\n            field, nDoc, oDoc, nVal[k], oVal[k], user, path.concat([k]), extra\n        ));\n    }, []);\n};\n\n",
        "flashmessages": "/*global unescape: false */\n\n/**\n * Flash messages help you store state between requests, such as reporting a\n * successful or failed operation after a redirect.\n *\n * The flash message implementation in this module handles both fallback couchdb\n * mode, using cookies to persist state between requests, as well as supporting\n * client-side operation, correctly handling new messages even inside the\n * callbacks of async functions.\n *\n * Flash messages only persist for the next request or the next template render!\n * That means 2 redirects without explicitly currying the flash messages will\n * cause the messages to be lost.\n *\n * @module\n */\n\n/**\n * Module dependencies\n */\n\nvar utils = require('./utils'),\n    cookies = require('./cookies'),\n    _ = require('./underscore');\n\n\n/**\n * Reads the flash messages cookie from a request object, returning an\n * array of incoming messages.\n *\n * @name readRequestCookie(req)\n * @param {Object} req\n * @returns {Array}\n * @api public\n */\n\nexports.readRequestCookie = function (req) {\n    var cookie = req.cookie._kanso_flash;\n    var messages = cookie ? JSON.parse(unescape(cookie)): [];\n    return _.map(messages, function (val) {\n        val.incoming = true;\n        val.outgoing = false;\n        return val;\n    });\n};\n\n/**\n * Reads the flash messages cookie from the browser, returning an\n * array of incoming messages.\n *\n * @name readBrowserCookie()\n * @returns {Array}\n * @api public\n */\n\nexports.readBrowserCookie = function () {\n    var cookie = cookies.readBrowserCookie('_kanso_flash');\n    var messages = cookie ? JSON.parse(unescape(cookie)): [];\n    return _.map(messages, function (val) {\n        val.incoming = true;\n        val.outgoing = false;\n        return val;\n    });\n};\n\n/**\n * Adds a flash_messages property to a request containing all incoming\n * messages.\n *\n * @name updateRequest(req)\n * @param {Object} req\n * @returns {Request Object}\n * @api public\n */\n\nexports.updateRequest = function (req) {\n    var messages = exports.readRequestCookie(req);\n    req.flash_messages = _.map(messages, function (val) {\n        val.incoming = true;\n        val.outgoing = false;\n        return val;\n    });\n    return req;\n};\n\n/**\n * Get's all current flash messages, stopping them from being outgoing on the\n * next request so they're not repeated.\n *\n * @name getMessages(req)\n * @param {Object} req\n * @returns {Array}\n * @api public\n */\n\nexports.getMessages = function (req) {\n    if (utils.isBrowser()) {\n        // also remove any messages from this request already set in the cookie\n        var cookie_messages = exports.readBrowserCookie();\n        var bmessages = _.filter(cookie_messages, function (val) {\n            return val.req !== req.uuid;\n        });\n        if (bmessages.length !== cookie_messages.length) {\n            exports.setBrowserCookie(req, bmessages);\n        }\n    }\n\n    var messages = _.map(req.flash_messages, function (val) {\n        val.outgoing = false;\n        return val;\n    });\n    req.flash_messages = messages;\n\n    return _.map(messages, function (val) {\n        return val.data;\n    });\n};\n\n/**\n * Filters all available messages on a request object, returning only those\n * flagged as outgoing (sending in the response to be made available to the next\n * request).\n *\n * @name getOutgoingMessages(req)\n * @param {Object} req\n * @returns {Array}\n * @api public\n */\n\nexports.getOutgoingMessages = function (req) {\n    return _.filter(req.flash_messages, function (val) {\n        return val.outgoing;\n    });\n};\n\n/**\n * Updates a response object after a list, show or update function has returned,\n * setting the flash messages cookie to include the outgoing messages.\n *\n * @name updateResponse(req, res)\n * @param {Object} req\n * @param {Object} res\n * @returns {Response Object}\n * @api public\n */\n\nexports.updateResponse = function (req, res) {\n    var messages = _.map(exports.getOutgoingMessages(req), function (val) {\n        delete val.outgoing;\n        delete val.incoming;\n        return val;\n    });\n    if (req.response_received) {\n        exports.setBrowserCookie(req, messages);\n    }\n    else {\n        cookies.setResponseCookie(req, res, {\n            name: '_kanso_flash',\n            value: JSON.stringify(messages)\n        });\n    }\n    return res;\n};\n\n/**\n * Creates a new flash message object, associating it with the given request.\n *\n * @name createMessage(req, msg)\n * @param {Object} req\n * @param {String} msg\n * @returns {Object}\n * @api public\n */\n\nexports.createMessage = function (req, msg) {\n    return {\n        req: req.uuid,\n        data: msg\n    };\n};\n\n/**\n * Stores a list of messages in the flash messages cookie. This function is for\n * client-side use.\n *\n * @name setBrowserCookie(req, messages)\n * @param {Object} req\n * @param {Array} messages\n * @api public\n */\n\nexports.setBrowserCookie = function (req, messages) {\n    cookies.setBrowserCookie(req, {\n        name: '_kanso_flash',\n        value: JSON.stringify(messages)\n    });\n};\n\n/**\n * Adds a new flash message for the current request. If the list, show or update\n * function has not returned, it's added to the response Set-Cookie header,\n * otherwise (if its the result of a client-side async operation) it's added\n * directly to the browsers cookies.\n *\n * @name addMessage(req, msg)\n * @param {Object} req\n * @param {String} msg\n * @api public\n */\n\nexports.addMessage = function (req, msg) {\n    if (!req.flash_messages) {\n        req.flash_messages = [];\n    }\n    var message = exports.createMessage(req, msg);\n    if (req.response_received) {\n        // the function has already returned, addMessage must have been called\n        // in a callback for some client-side only function, set the cookie\n        // directly\n        var messages = exports.readBrowserCookie();\n\n        messages.push(message);\n        exports.setBrowserCookie(req, messages);\n        req.flash_messages.push(message);\n    }\n    else {\n        message.outgoing = true;\n        req.flash_messages.push(message);\n    }\n};\n\n",
        "forms": "/**\n * Functions for the rendering, parsing and validation of forms.\n *\n * @module\n */\n\n/**\n * Module dependencies\n */\n\nvar core = require('./core'),\n    utils = require('./utils'),\n    fieldset = require('./fieldset'),\n    render = require('./render'),\n    _ = require('./underscore')._;\n\n\n/**\n * Form object, presents fields and parses responses.\n *\n * #### Options ####\n *\n * <table class=\"options\">\n *   <tr>\n *      <td class=\"name\">exclude</td>\n *      <td class=\"type\">Array</td>\n *      <td class=\"description\">a list of field names to exclude</td>\n *   </tr>\n *   <tr>\n *      <td class=\"name\">fields</td>\n *      <td class=\"type\">Array</td>\n *      <td class=\"description\">\n *          a subset of fields to use (inverse of excluded)\n *      </td>\n *   </tr>\n * </table>\n *\n * @name Form(fields | type, [doc])\n * @param {Object} fields  - an object literal containing fields or a Type\n * @param {Object} doc     - (optional) the original document being edited\n * @param {Object} options - (optional) see available options above\n * @constructor\n * @api public\n */\n\nvar Form = exports.Form = function Form(fields, doc, options) {\n    this.options = options || {};\n\n    this.values = null;\n    if (doc) {\n        this.values = JSON.parse(JSON.stringify(doc)); /* Copy */\n        this.initial_doc = doc;\n    }\n    if (fields && fields.fields) {\n        this.type = fields;\n        this.fields = this.type.fields;\n    }\n    else {\n        this.fields = fields;\n    }\n    /*if (utils.constructorName(fields) === 'Type') {\n        this.type = fields;\n        this.fields = this.type.field;\n    }\n    else {\n        this.fields = fields;\n    }*/\n};\n\n\n/**\n * Overrides values in doc_a with values in doc_b, only when a field is present\n * for that value. This means properties not in fields (or in excluded fields)\n * are retained, while properties which are covered by the fieldset are\n * replaced.\n *\n * This is used when updating the form's values with a request when its been\n * initiated with a previous document. You shouldn't normally need to call this\n * directly.\n *\n * Returns the updated doc_a object.\n *\n * @name override(excludes, field_subset, fields, doc_a, doc_b, path)\n * @param {Array | null} excludes\n * @param {Array | null} field_subset\n * @param {Object} Fields\n * @param {Object} doc_a\n * @param {Object} doc_b\n * @param {Array} path\n * @returns {Object}\n * @api public\n */\n\nexports.override = function (excludes, field_subset, fields, doc_a, doc_b, path) {\n    fields = fields || {};\n    doc_a = doc_a || {};\n\n    var fields_module = require('./fields');\n    var exclude_paths = _.map((excludes || []), function (p) {\n        return p.split('.');\n    });\n    var subset_paths = _.map((field_subset || []), function (p) {\n        return p.split('.');\n    });\n\n    var keys = _.keys(doc_b);\n\n    _.each(keys, function (k) {\n        var f = fields[k];\n        var b = doc_b[k];\n        var f_path = path.concat([k]);\n\n        if (typeof b !== 'object' ||\n            f instanceof fields_module.Field ||\n            f instanceof fields_module.Embedded ||\n            f instanceof fields_module.EmbeddedList) {\n\n            if (excludes) {\n                for (var i = 0; i < exclude_paths.length; i++) {\n                    if (utils.isSubPath(exclude_paths[i], f_path)) {\n                        return;\n                    }\n                }\n            }\n            if (field_subset) {\n                var in_subset = false;\n                for (var j = 0; j < subset_paths.length; j++) {\n                    if (utils.isSubPath(subset_paths[j], f_path)) {\n                        in_subset = true;\n                    }\n                }\n                if (!in_subset) {\n                    return;\n                }\n            }\n            doc_a[k] = b;\n        }\n        else {\n            doc_a[k] = exports.override(\n                excludes, field_subset, fields[k], doc_a[k], b, f_path\n            );\n        }\n    });\n    return doc_a;\n};\n\n/**\n * Parses a request and validates the result, binding values and errors to\n * the form instance.\n *\n * @name Form.validate(req)\n * @param {Object} req\n * @returns {Form}\n * @api public\n */\n\nForm.prototype.validate = function (/*optional*/req) {\n    if (!req) {\n        req = utils.currentRequest();\n    }\n\n    /* This is the request payload:\n        This contains all of the form fields that are used by\n        formValuesToTree and parseRaw, and must be copied first. */\n\n    this.raw = (req.form || {});\n\n    var type_class = require('./types').Type;\n    var tree = exports.formValuesToTree(this.raw);\n\n    this.values = exports.override(\n        this.options.exclude,\n        this.options.fields,\n        this.fields,\n        this.values || fieldset.createDefaults(this.fields, req) || {},\n        exports.parseRaw(this.fields, tree),\n        []\n    );\n    \n    this.errors = fieldset.validate(\n        this.fields, this.values, this.values, this.raw, [], false\n    );\n\n    if (this.type) {\n        if (this.type instanceof type_class) {\n            // run top level permissions first\n            var type_errs = this.type.authorizeTypeLevel(\n                this.values, this.initial_doc, req.userCtx\n            );\n            if (type_errs.length) {\n                this.errors = this.errors.concat(type_errs);\n            }\n            else {\n                // if no top-level permissions errors, check each field\n                this.errors = this.errors.concat(\n                    this.type.authorize(\n                        this.values, this.initial_doc, req.userCtx\n                    )\n                );\n            }\n        } else {\n            /* Programmer error: display a useful diagnostic message */\n            throw new Error(\n                'Encountered a type object that is not an instance of' +\n                    ' `Type`; check lib/types.js for proper instansiation'\n            );\n        }\n        \n    }\n    else {\n        this.errors = this.errors.concat(fieldset.authFieldSet(\n            this.fields, this.values, this.initial_doc, this.values,\n            this.initial_doc, req.userCtx, [], true\n        ));\n    }\n\n    // clear field properties on errors for excluded fields\n    var excludes = this.options.exclude;\n    if (excludes) {\n        var excl_paths = _.map(excludes, function (p) {\n            return p.split('.');\n        });\n        this.errors = _.map(this.errors, function (e) {\n            if (!e.field) {\n                return e;\n            }\n            for (var i = 0, len = excl_paths.length; i < len; i++) {\n                var path = excl_paths[i];\n                if (utils.isSubPath(path, e.field)) {\n                    e.message = e.field.join('.') + ': ' + (\n                        e.message || e.toString()\n                    );\n                    delete e.field;\n                    return e;\n                }\n            }\n            return e;\n        });\n    }\n\n    // clear field properties on errors not in fields subset\n    var field_subset = this.options.fields;\n    if (field_subset) {\n        var subset_paths = _.map(field_subset, function (p) {\n            return p.split('.');\n        });\n        this.errors = _.map(this.errors, function (e) {\n            if (!e.field) {\n                return e;\n            }\n            for (var i = 0, len = subset_paths.length; i < len; i++) {\n                var path = subset_paths[i];\n                if (!utils.isSubPath(path, e.field)) {\n                    e.message = e.field.join('.') + ': ' + (\n                        e.message || e.toString()\n                    );\n                    delete e.field;\n                    return e;\n                }\n            }\n            return e;\n        });\n    }\n\n    return this;\n};\n\n/**\n * After a form has called validate, this function will return true if the form\n * is valid, false otherwise.\n *\n * @name Form.isValid()\n * @returns {Boolean}\n * @api public\n */\n\nForm.prototype.isValid = function () {\n    return !(this.errors && this.errors.length);\n};\n\n/**\n * Filters an array of errors, returning only those below a specific field path\n *\n * @param {Array} errs\n * @param {Array} path\n * @returns {Array}\n */\n\nvar errsBelowPath = function (errs, path) {\n    if (!path || !path.length) {\n        return errs;\n    }\n    return _.filter(errs, function (e) {\n        if (!e.field) {\n            return false;\n        }\n        return utils.isSubPath(path, e.field);\n    });\n};\n\n/**\n * Filters a list of errors, returning only those without a field property.\n * This is used to populate the errors at the top of the form, which apply\n * generally, or cannot be attributed to a single field.\n *\n * @param {Array} errs\n * @returns {Array}\n */\n\nvar errsWithoutFields = function (errs) {\n    return _.filter(errs, function (e) {\n        return !e.field;\n    });\n};\n\n/**\n * Converts current form to a HTML string, using an optional renderer class.\n *\n * @name Form.toHTML(req, [RendererClass])\n * @param {Object} req Kanso request object; null for most recent. (optional)\n * @param {Renderer} RendererClass (optional)\n * @param {Object} options An object containing widget options, which\n *          will ultimately be provided to each widget's toHTML method.\n * @param {Boolean} create_defaults (optional) Set this to true if you've\n *          provided a document in {doc}, but would still like default\n *          values to be merged in to it via createDefaults. For a field f,\n *          the default value is added to {doc} if and only if doc[f]\n *          is undefined, null, or not present. Defaults to off.\n * @returns {String}\n * @returns {String}\n * @api public\n */\n\nForm.prototype.toHTML = function (/* optional */ req,\n                                  /* optional */ RendererClass,\n                                  /* optional */ options,\n                                  /* optional */ create_defaults) {\n    if (!req) {\n        req = utils.currentRequest();\n    }\n    var values = this.values;\n\n    options = options || {};\n    options.operation = options.operation || (values ? 'update': 'add');\n\n    if (create_defaults) {\n        values = _.defaults(\n            values, fieldset.createDefaults(this.fields, req)\n        );\n    } else if (!values) {\n        values = fieldset.createDefaults(this.fields, req);\n    }\n\n    RendererClass = (RendererClass || render.defaultRenderer());\n    var renderer = new RendererClass();\n    return (\n        renderer.start(\n            errsWithoutFields(this.errors)\n        ) +\n        this.renderFields(\n            renderer, this.fields, values, this.raw, this.errors, [], options\n        ) +\n        renderer.end() +\n        render.scriptTagForEvent('renderFinish')\n    );\n};\n\n/**\n * Filters an array of errors, returning only those below a specific field path\n *\n * @param {Array} errs\n * @param {Array} path\n * @returns {Array}\n */\n\nvar errsBelowPath = function (errs, path) {\n    return _.filter(errs, function (e) {\n        for (var i = 0, len = path.length; i < len; ++i) {\n            if (path[i] !== e.field[i]) {\n                return false;\n            }\n        }\n        return true;\n    });\n};\n\n/**\n * Iterates over fields and sub-objects calling the correct renderer function on\n * each. Returns a HTML representation of the fields. Used internally by the\n * toHTML method, you should not need to call this function directly.\n *\n * @name Form.renderFields(renderer, fields, values, raw, err, path)\n * @param {Object} renderer\n * @param {Object} fields\n * @param {Object} values\n * @param {Array} errs\n * @param {Array} path\n * @param {Object} options An object containing widget options, which\n *          will ultimately be provided to each widget's toHTML method.\n * @returns {String}\n * @api public\n */\n\nForm.prototype.renderFields = function (renderer, fields, values,\n                                        raw, errs, path, options) {\n    fields = fields || {};\n    values = values || {};\n    raw = raw || {};\n    errs = errs || [];\n    path = path || [];\n\n    var that = this;\n    var excludes = this.options.exclude;\n    var field_subset = this.options.fields;\n    var keys = _.keys(fields);\n\n    var fields_module = require('./fields');\n\n    return _.reduce(keys, function (html, k) {\n\n        var f_path = path.concat([k]);\n\n        if (excludes) {\n            if (_.indexOf(excludes, f_path.join('.')) !== -1) {\n                return html;\n            }\n        }\n        if (field_subset) {\n            if (_.indexOf(field_subset, f_path.join('.')) === -1) {\n                return html;\n            }\n        }\n\n        var f_errs = errsBelowPath(errs, f_path);\n        var f = fields[k];\n\n        if (f instanceof fields_module.Field ||\n            f instanceof fields_module.Embedded ||\n            f instanceof fields_module.EmbeddedList) {\n\n            return html + renderer.field(\n                f,\n                f_path,\n                values[k],\n                (raw[k] === undefined) ? values[k]: raw[k],\n                f_errs,\n                (options || {})\n            );\n        }\n        else if (f instanceof Object) {\n            return html + (k ? renderer.beginGroup(f_path) : '') +\n                that.renderFields(\n                    renderer,\n                    f,\n                    values[k],\n                    (raw[k] === undefined) ? values[k]: raw[k],\n                    errs,\n                    f_path,\n                    (options || {})\n                ) + (k ? renderer.endGroup(f_path) : '');\n        } else {\n            throw new Error(\n                'The field type `' + (typeof f) + '` is not supported.'\n            );\n        }\n    }, '');\n};\n\n\n/**\n * Transforms a flat object from a request query to a proper\n * hierarchy of properties.\n *\n * <pre>{'one.two': 'val'} --> {one: {two: 'val'}}</pre>\n *\n * @name formValuesToTree(form)\n * @param {Object} query\n * @api public\n */\n\nexports.formValuesToTree = function (form) {\n    var tree = {};\n    for (var k in form) {\n        utils.setPropertyPath(tree, k.split('.'), form[k]);\n    }\n    return tree;\n};\n\n\n/**\n * Transforms a raw query object from formValuesToTree to a\n * document which follows the schema for the given type.\n *\n * @name parseRaw(fields, raw)\n * @param {Object} fields\n * @param {Object} raw\n * @returns {Object}\n * @api public\n */\n\nexports.parseRaw = function (fields, raw) {\n    var doc = {};\n    raw = raw || {};\n    var fields_module = require('./fields');\n\n    for (var k in fields) {\n        var f = fields[k];\n        var r = raw[k];\n\n        if (f instanceof fields_module.Field) {\n            if (!f.isEmpty(r)) {\n                doc[k] = f.parse(r);\n            }\n            else if (!f.omit_empty) {\n                doc[k] = undefined;\n            }\n        }\n        else if (f instanceof fields_module.Embedded) {\n            if (!f.isEmpty(r)) {\n                if (typeof r === 'string') {\n                    if (r !== '') {\n                        doc[k] = JSON.parse(r);\n                    } else {\n                        doc[k] = {};\n                    }\n                }\n                else {\n                    doc[k] = exports.parseRaw(f.type.fields, r);\n                }\n            }\n        }\n        else if (f instanceof fields_module.EmbeddedList) {\n            doc[k] = [];\n            for (var i in r) {\n                if (typeof r[i] === 'string') {\n                    if (r[i] !== '') {\n                        doc[k][i] = JSON.parse(r[i]);\n                    } else {\n                        doc[k][i] = {};\n                    }\n                }\n                else {\n                    doc[k][i] = exports.parseRaw(f.type.fields, r[i]);\n                }\n            }\n            if (!doc[k].length && f.omit_empty) {\n                delete doc[k];\n            }\n        }\n        else if (f instanceof Object) {\n            doc[k] = exports.parseRaw(f, r);\n        } else {\n            throw new Error(\n                'The field type `' + (typeof f) + '` is not supported.'\n            );\n        }\n    }\n    return doc;\n};\n\n",
        "path": "/**\n * Path functions ported from node.js to work in CouchDB and the browser.\n * This module is used internally by Kanso, although you can use it in your\n * apps too if you find the functions useful.\n *\n * @module\n */\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n/**\n * From node.js v0.2.6\n */\n\n/**\n * Joins multiple paths together using '/'. Accepts a arbitrary number of\n * strings as arguments, returning the joined result as a single string.\n *\n * @name join(path, [...])\n * @returns {String}\n * @api public\n */\n\nexports.join = function () {\n    return exports.normalize(Array.prototype.join.call(arguments, \"/\"));\n};\n\n/**\n * Normalizes a path split into an array, taking care of '..' and '.' parts.\n *\n * @name normalizeArray(parts, [keepBlanks])\n * @param {Array} parts\n * @param {Boolean} keepBlanks\n * @returns {Array}\n * @api public\n */\n\nexports.normalizeArray = function (parts, keepBlanks) {\n    var directories = [], prev;\n    for (var i = 0, l = parts.length - 1; i <= l; i++) {\n        var directory = parts[i];\n\n        // if it's blank, but it's not the first thing, and not the last\n        // thing, skip it.\n        if (directory === \"\" && i !== 0 && i !== l && !keepBlanks) {\n            continue;\n        }\n\n        // if it's a dot, and there was some previous dir already, then\n        // skip it.\n        if (directory === \".\" && prev !== undefined) {\n            continue;\n        }\n\n        // if it starts with \"\", and is a . or .., then skip it.\n        if (directories.length === 1 && directories[0] === \"\" && (directory === \".\" || directory === \"..\")) {\n            continue;\n        }\n\n        if (directory === \"..\" && directories.length && prev !== \"..\" && prev !== \".\" && prev !== undefined && (prev !== \"\" || keepBlanks)) {\n            directories.pop();\n            prev = directories.slice(-1)[0];\n        }\n        else {\n            if (prev === \".\") {\n                directories.pop();\n            }\n            directories.push(directory);\n            prev = directory;\n        }\n    }\n    return directories;\n};\n\n/**\n * Normalize a string path, taking care of '..' and '.' parts.\n *\n * @name normalize(path, [keepBlanks])\n * @param {String} path\n * @param {Boolean} keepBlanks\n * @returns string\n * @api public\n */\n\nexports.normalize = function (path, keepBlanks) {\n    return exports.normalizeArray(path.split(\"/\"), keepBlanks).join(\"/\");\n};\n\n/**\n * Return the directory name of a path. Similar to the Unix dirname command.\n *\n * @name dirname(path)\n * @param {String} path\n * @returns {String}\n * @api public\n */\n\nexports.dirname = function (path) {\n    if (path.length > 1 && '/' === path[path.length - 1]) {\n        path = path.replace(/\\/+$/, '');\n    }\n    var lastSlash = path.lastIndexOf('/');\n    switch (lastSlash) {\n    case -1:\n        return '.';\n    case 0:\n        return '/';\n    default:\n        return path.substring(0, lastSlash);\n    }\n};\n\n/**\n * Return the last portion of a path. Similar to the Unix basename command.\n *\n * **Example**\n * <pre><code class=\"javascript\">path.basename('/foo/bar/baz/asdf/quux.html')\n * // returns\n * 'quux.html'\n *\n * path.basename('/foo/bar/baz/asdf/quux.html', '.html')\n * // returns\n * 'quux'\n * </code></pre>\n *\n * @name basename(path, ext)\n * @param {String} path\n * @param {String} ext\n * @returns {String}\n * @api public\n */\n\nexports.basename = function (path, ext) {\n    var f = path.substr(path.lastIndexOf(\"/\") + 1);\n    if (ext && f.substr(-1 * ext.length) === ext) {\n        f = f.substr(0, f.length - ext.length);\n    }\n    return f;\n};\n\n/**\n * Return the extension of the path. Everything after the last '.' in the last\n * portion of the path. If there is no '.' in the last portion of the path or\n * the only '.' is the first character, then it returns an empty string.\n *\n * <pre><code class=\"javascript\">path.extname('index.html')\n * // returns\n * '.html'\n *\n * path.extname('index')\n * // returns\n * ''\n * </code></pre>\n *\n * @name extname(path)\n * @param {String} path\n * @returns {String}\n * @api public\n */\n\nexports.extname = function (path) {\n    var dot = path.lastIndexOf('.'),\n        slash = path.lastIndexOf('/');\n    // The last dot must be in the last path component, and it (the last dot)\n    // must not start the last path component (i.e. be a dot that signifies a\n    // hidden file in UNIX).\n    return dot <= slash + 1 ? '' : path.substring(dot);\n};\n\n",
        "permissions": "/**\n * Permissions functions are used on both Fields and Types to check a given\n * user is authorized to make a change to a document.\n *\n * @module\n */\n\n\n/**\n * Module dependencies\n */\n\nvar utils = require('./utils'),\n    _ = require('./underscore')._;\n\n\n/**\n * Field's new value should match current user's name\n *\n * @name matchUsername()\n * @returns {Function}\n * @api public\n */\n\nexports.matchUsername = function () {\n    return function (newDoc, oldDoc, newVal, oldVal, userCtx) {\n        var name = userCtx.name;\n        if (name !== newVal) {\n            // if both are empty-like, then consider them the same\n            if ((name !== null && name !== undefined && name !== '') ||\n                (newVal !== null && newVal !== undefined && newVal !== '')) {\n                throw new Error('Field does not match your username');\n            }\n        }\n    };\n};\n\n/**\n * Checks if the user has a specific role\n *\n * @name hasRole(role)\n * @param {String} role\n * @returns {Function}\n * @api public\n */\n\nexports.hasRole = function (role) {\n    return function (newDoc, oldDoc, newVal, oldVal, userCtx) {\n        var roles = userCtx ? (userCtx.roles || []): [];\n        if (!_.include(roles, role)) {\n            throw new Error('User must have \"' + role + '\" role.');\n        }\n    };\n};\n\n/**\n * The value of this field should never change after the document has been\n * created.\n *\n * @name fieldUneditable()\n * @returns {Function}\n * @api public\n */\n\nexports.fieldUneditable = function () {\n    return function (newDoc, oldDoc, newValue, oldValue, userCtx) {\n        if (oldDoc) {\n            if (newValue !== oldValue) {\n                throw new Error('Field cannot be edited once created');\n            }\n        }\n    };\n};\n\n/**\n * User's name should match the *old* value of the given field. A field can be\n * specified using a string or an array of strings (like a path).\n *\n * <pre>\n * eg: usernameMatchesField('creator')\n *     usernameMatchesField(['meta','creator'])\n *\n *     {\n *         creator: 'name',\n *         meta: {creator: 'name2'}\n *     }\n * </pre>\n *\n * @name usernameMatchesField(path)\n * @param {String | Array} path\n * @returns {Function}\n * @api public\n */\n\nexports.usernameMatchesField = function (path) {\n    if (!_.isArray(path)) {\n        path = [path];\n    }\n    return function (newDoc, oldDoc, newValue, oldValue, userCtx) {\n        var field = utils.getPropertyPath(oldDoc, path);\n        if (userCtx.name !== field) {\n            throw new Error('Username does not match field ' + path.join('.'));\n        }\n    };\n};\n\n/**\n * Checks that user's context has a username\n *\n * @name loggedIn()\n * @returns {Function}\n * @api public\n */\n\nexports.loggedIn = function () {\n    return function (newDoc, oldDoc, newValue, oldValue, userCtx) {\n        if (!userCtx || !userCtx.name) {\n            throw new Error('You must be logged in');\n        }\n    };\n};\n\n/**\n * Runs an array of permissions functions and checks that all of them pass,\n * returning all failures.\n *\n * @name all(perms)\n * @param {Array} perms\n * @returns {Function}\n * @api public\n */\n\nexports.all = function (perms) {\n    return function () {\n        var args = arguments;\n        return _.reduce(perms, function (errs, p) {\n            return errs.concat(utils.getErrors(p, args));\n        }, []);\n    };\n};\n\n/**\n * Tests to see if any one permission function passes, returning on the\n * first success. If all permissions fail, then all errors are returned.\n *\n * @name any(perms)\n * @param {Array} perms\n * @api public\n */\n\nexports.any = function (perms) {\n    return function () {\n        var errs = [];\n        for (var i = 0, len = perms.length; i < len; i++) {\n            try {\n                var p_errs = (perms[i].apply(this, arguments) || []);\n                errs = errs.concat(p_errs);\n                if (!p_errs.length) {\n                    // return as soon as one passes\n                    return [];\n                }\n            }\n            catch (e) {\n                // store the first error to re-throw if none pass\n                errs.push(e);\n            }\n        }\n        return errs;\n    };\n};\n\n/**\n * Treat new and old values like new documents of a given type, and attempt to\n * authorize the value against the type's permissions. Useful when handling\n * permissions for an embedded type.\n *\n * Can be combined with permissions.any or permissions.all to extend the\n * permissions for an embedded type field. For example, the following might\n * allow both the owner of the parent document and the owner of the comment\n * itself to remove it.\n *\n * <pre><code class=\"javascript\">\n *     comment: fields.embed({\n *         type: types.comment,\n *         permissions: {\n *             remove: permissions.any([\n *                 permissions.usernameMatchesField('creator'),\n *                 permissions.inherit(types.comment)\n *             ])\n *         }\n *     });\n * </code></pre>\n *\n * @name inherit(type)\n * @param {Type} type\n * @api public\n */\n\nexports.inherit = function (type) {\n    return function (newDoc, oldDoc, newValue, oldValue, userCtx) {\n        return type.authorize(newValue || {_deleted: true}, oldValue, userCtx);\n    };\n};\n",
        "querystring": "var _ = require('./underscore')._;\n\n/**\n * Querystring functions ported from node.js to work in CouchDB and the browser.\n * This module is used internally by Kanso, although you can use it in your\n * apps too if you find the functions useful.\n *\n * @module\n */\n\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// Query String Utilities\n\nvar QueryString = exports;\n\n/**\n * Decodes a URI Component, provided so that it could be overridden if\n * necessary.\n *\n * @name unescape(str)\n * @param {String} str\n * @returns {String}\n * @api public\n */\n\nQueryString.unescape = function (str) {\n    return decodeURIComponent(str);\n};\n\n/**\n * Encodes a URI Component, provided so that it could be overridden if\n * necessary.\n *\n * @name escape(str)\n * @param {String} str\n * @returns {String}\n * @api public\n */\n\nQueryString.escape = function (str) {\n    return encodeURIComponent(str);\n};\n\nvar stringifyPrimitive = function (v) {\n    switch (typeof v) {\n    case 'string':\n        return v;\n\n    case 'boolean':\n        return v ? 'true' : 'false';\n\n    case 'number':\n        return isFinite(v) ? v : '';\n\n    default:\n        return '';\n    }\n};\n\n/**\n * Serialize an object to a query string. Optionally override the default\n * separator and assignment characters.\n *\n * **Example:**\n *\n * <pre><code class=\"javascript\">\n * querystring.stringify({foo: 'bar'})\n * // returns\n * 'foo=bar'\n *\n * querystring.stringify({foo: 'bar', baz: 'bob'}, ';', ':')\n * // returns\n * 'foo:bar;baz:bob'\n * </code></pre>\n *\n * @name stringify(obj, [sep, eq, name])\n * @param {Object} obj\n * @param {String} sep\n * @param {String} eq\n * @param {String} name\n * @returns {String}\n * @api public\n */\n\nQueryString.stringify = QueryString.encode = function (obj, sep, eq, name) {\n    sep = sep || '&';\n    eq = eq || '=';\n    obj = (obj === null) ? undefined : obj;\n\n    if (typeof obj === 'object') {\n        return _.map(_.keys(obj), function (k) {\n            if (_.isArray(obj[k])) {\n                return _.map(obj[k], function (v) {\n                    return QueryString.escape(stringifyPrimitive(k)) +\n                           eq +\n                           QueryString.escape(stringifyPrimitive(v));\n                }).join(sep);\n            }\n            else {\n                return QueryString.escape(stringifyPrimitive(k)) +\n                       eq +\n                       QueryString.escape(stringifyPrimitive(obj[k]));\n            }\n        }).join(sep);\n    }\n    if (!name) {\n        return '';\n    }\n    return QueryString.escape(stringifyPrimitive(name)) + eq +\n           QueryString.escape(stringifyPrimitive(obj));\n};\n\n/**\n * Deserialize a query string to an object. Optionally override the default\n * separator and assignment characters.\n *\n * **Example:**\n *\n * <pre><code class=\"javascript\">\n * querystring.parse('a=b&b=c')\n * // returns\n * // { a: 'b', b: 'c' }\n * </code></pre>\n *\n * @name decode(qs, [sep, eq])\n * @param {String} qs\n * @param {String} sep\n * @param {String} eq\n * @returns {Object}\n * @api public\n */\n\nQueryString.parse = QueryString.decode = function (qs, sep, eq) {\n    sep = sep || '&';\n    eq = eq || '=';\n    var obj = {};\n\n    if (typeof qs !== 'string' || qs.length === 0) {\n        return obj;\n    }\n\n    qs.split(sep).forEach(function (kvp) {\n        var x = kvp.split(eq);\n        var k = QueryString.unescape(x[0]);\n        var v = QueryString.unescape(x.slice(1).join(eq));\n\n        if (!(k in obj)) {\n            obj[k] = v;\n        }\n        else if (!_.isArray(obj[k])) {\n            obj[k] = [obj[k], v];\n        }\n        else {\n            obj[k].push(v);\n        }\n    });\n\n    return obj;\n};\n",
        "render": "/**\n * Renderer constructors and general utilities for rendering Form objects\n * as HTML.\n *\n * @module\n */\n\n/**\n * Module dependencies\n */\n\nvar events = require('kanso/events'),\n    sanitize = require('kanso/sanitize'),\n    _ = require('./underscore')._;\n\nvar h = sanitize.escapeHtml;\n\n\n/**\n * Generates a script tag that fires the event named {name}.\n */\n\nexports.scriptTagForEvent = function (name) {\n    var rv = (\n        '<script type=\"text/javascript\">' +\n        \"// <![CDATA[\\n\" +\n            \"require('kanso/events').emit('\" +\n                sanitize.cdata(sanitize.js(name)) +\n            \"');\" +\n        \"// ]]>\" +\n        '</script>'\n    );\n\n    return rv;\n}; \n\n/**\n * Renders HTML for error messages.\n *\n * @name errorHTML(errors)\n * @param {Array} errors\n * @returns {String}\n * @api public\n */\n\nexports.errorHTML = function (errors) {\n    if (errors && errors.length) {\n        var html = '<ul class=\"errors right\">';\n        for (var i = 0; i < errors.length; i++) {\n            html += (\n                '<li class=\"error_msg\">' +\n                    h(errors[i].message || errors[i].toString()) +\n                '</li>'\n            );\n        }\n        html += '</ul>';\n        return html;\n    }\n    return '';\n};\n\n/**\n * Generates the text for a field's label, depending on whether\n * a custom label is defined or not. If not, the name is captialized and\n * underscores are replaces with spaces to produce the label's text.\n *\n * @name labelText(field, name)\n * @param {Object} field\n * @param {String} name\n * @returns {String}\n * @api public\n */\n\nexports.labelText = function (field, name) {\n    if (field.label) {\n        return field.label;\n    }\n    return name.substr(0, 1).toUpperCase() + name.substr(1).replace(/_/g, ' ');\n};\n\n/**\n * Generates HTML for label tags.\n *\n * @name labelHTML(field, name, id)\n * @param {Object} field\n * @param {String} name\n * @param {String} id\n * @returns {String}\n * @api public\n */\n\nexports.labelHTML = function (field, name, id) {\n    return '<label for=\"' + h(id || sanitize.id(name)) + '\">' +\n        h(exports.labelText(field, name, id)) +\n    '</label>';\n};\n\n/**\n * Generates HTML for field descriptions (if defined).\n *\n * @name descriptionHTML(obj)\n * @param {Object} obj\n * @returns {String}\n * @api public\n */\n\nexports.descriptionHTML = function (obj) {\n    if (obj.description) {\n        return '<div class=\"description\">' + h(obj.description) + '</div>';\n    }\n    return '';\n};\n\n/**\n * Generates HTML for field hints (if defined).\n *\n * @name hintHTML(obj)\n * @param {Object} obj\n * @returns {String}\n * @api public\n */\n\nexports.hintHTML = function (obj) {\n    if (obj.hint) {\n        return '<div class=\"hint\">' + h(obj.hint) + '</div>';\n    }\n    return '';\n};\n\n/**\n * Creates an array of default class names for a field. This includes\n * 'required' for required fields and 'error' for fields failing validation.\n *\n * All fields are given a 'field' class.\n *\n * @name classes(field, errors)\n * @param {Object} field\n * @param {Array} errors\n * @returns {Array}\n * @api public\n */\n\nexports.classes = function (field, errors) {\n    var r = ['field'];\n    if (errors && errors.length) {\n        r.push('error');\n    }\n    if (field.required) {\n        r.push('required');\n    }\n    return r;\n};\n\n/**\n * Determines the default renderer class, to be used globally by \n * instances of forms.Form that fail to specify a renderer class.\n *\n * @name defaultRenderer()\n * @returns {Function}\n * @api public\n */\n\nexports.defaultRenderer = function () {\n    return exports.table;\n};\n\n/**\n * The default table renderer class, passed to the toHTML method of a\n * form. Renders a form using a single table, with <tbody> tags to\n * represent nested field groups. The <tbody>s are labelled with\n * specific CSS classes, including depth information. See style.css\n * for details on how to style this output.\n *\n * @name table\n * @constructor\n * @api public\n */\n\nexports.table = function () {\n\n    /**\n     * Constructor for renderer; initializes object. The string returned\n     * from this function is prepended to the form's markup.\n     *\n     * @constructor\n    */\n    this.start = function (errs) {\n        this.depth = 0;\n        var html = '<table class=\"render-table\">';\n        if (errs && errs.length) {\n            html += '<ul class=\"form-errors\">';\n            _.each(errs, function (e) {\n                html += '<li>' + (e.message || e.toString()) + '</li>';\n            });\n            html += '</ul>';\n        }\n        return html;\n    };\n\n    /**\n     * Called by the forms layer when it encounters a new\n     * nesting context (i.e. a new grouping of fields). The\n     * path parameter is an array of strings that describes\n     * the path (in terms of document keys) to the new group.\n     * When concatenated together with a dot, this array yields\n     * the new prefix for named HTML form fields.\n     *\n     * @param {Array} path\n    */\n    this.beginGroup = function (path) {\n        this.depth += 1;\n        var name = _.last(path);\n        var css_class = 'level-' + this.depth;\n\n        return (\n            '<tbody class=\"head ' + h(css_class) + '\">' +\n            '<tr>' +\n                '<th colspan=\"3\">' +\n                    h(name.substr(0, 1).toUpperCase() +\n                        name.substr(1).replace(/_/g, ' ')) +\n                '</th>' +\n            '</tr>' +\n            '</tbody>' +\n            '<tbody class=\"group ' + h(css_class) + '\">'\n        );\n    };\n\n    /**\n     * Called by the forms layer when it encounters the end\n     * of a nesting context. In the absence of errors, this\n     * function is guaranteed to be called once for each time\n     * that beginGroup is called; the order will be nested and\n     * properly balanced. The path argument is the same as it was\n     * for the corresponding beginGroup call; see beginGroup.\n     *\n     * @param {Array} path\n     */\n    this.endGroup = function (path) {\n        this.depth -= 1;\n        return '</tbody>';\n    };\n\n    /**\n     * Called by the forms layer when it encounters any regular\n     * field -- i.e. one that is neither an embed nor an embedList.\n     *\n     * @param {Object} field\n     * @param {Array} path\n     * @param {Object} value\n     * @param {String} raw\n     * @param {Array} errors\n     * @param {Object} options An object containing widget options, which\n     *          will ultimately be provided to each widget's toHTML method.\n     */\n    this.field = function (field, path, value, raw, errors, options) {\n        var name = path.join('.');\n        var id = (path.join('_') + '_field');\n        var caption = path.slice(this.depth).join(' ');\n\n        events.once('renderFinish', function () {\n            if (field.widget.clientInit) {\n                setTimeout(function () {\n                    field.widget.clientInit(\n                        field, path, value, raw, errors, (options || {})\n                    );\n                }, 0);\n            }\n        });\n\n        if (field.widget.type === 'hidden') {\n            return field.widget.toHTML(\n                name, value, raw, field, (options || {})\n            );\n        }\n\n        var rv = (\n            '<tr id=\"' + id + '\" class=\"' +\n                exports.classes(field, errors).join(' ') + '\">' +\n                '<th>' +\n                    exports.labelHTML(field, caption) +\n                    exports.descriptionHTML(field) +\n                '</th>' +\n                '<td>' +\n                    exports.errorHTML(errors) +\n                    field.widget.toHTML(\n                        name, value, raw, field, (options || {})\n                    ) +\n                    exports.hintHTML(field) +\n                '</td>' +\n            '</tr>'\n        );\n        return rv;\n    };\n\n    /**\n     * Called by the forms layer when it is finished rendering a form.\n     * Markup returned from this function is appended to the form output.\n     *\n     * @param {String} field\n     * @param {Array} path\n     * @param {Object} value\n     * @param {String} raw\n     * @param {Array} errors\n    */\n    this.end = function () {\n        return '</table>';\n    };\n\n};\n\n/**\n *  Renders a form using a series of properly-nested <div> tags.\n *  These <div>s are labelled with specific CSS classes, some of which\n *  provide depth information (with the aim of simplifying CSS rules).\n *  See style.css for details on how to style this output.\n */\nexports.div = function () {\n    /**\n     * Constructor for renderer; initializes object. The string returned\n     * from this function is prepended to the form's markup.\n     *\n     * @constructor\n    */\n    this.start = function (errs) {\n        this.depth = 0;\n        var html = '<div class=\"render-div\">';\n        if (errs && errs.length) {\n            html += '<ul class=\"errors\">';\n            _.each(errs, function (e) {\n                html += '<li>' + (e.message || e.toString()) + '</li>';\n            });\n            html += '</ul>';\n        }\n        return html;\n    };\n\n    /**\n     * Called by the forms layer when it encounters a new\n     * nesting context (i.e. a new grouping of fields). The\n     * path parameter is an array of strings that describes\n     * the path (in terms of document keys) to the new group.\n     * When concatenated together with a dot, this array yields\n     * the new prefix for named HTML form fields.\n     *\n     * @param {Array} path\n    */\n    this.beginGroup = function (path) {\n        this.depth += 1;\n        var name = _.last(path);\n        var css_class = 'level-' + this.depth;\n        return (\n            '<div class=\"group ' + h(css_class) + '\">' +\n            '<div class=\"heading\">' +\n                h(name.substr(0, 1).toUpperCase() +\n                    name.substr(1).replace(/_/g, ' ')) +\n            '</div>'\n        );\n    };\n\n    /**\n     * Called by the forms layer when it encounters the end\n     * of a nesting context. In the absence of errors, this\n     * function is guaranteed to be called once for each time\n     * that beginGroup is called; the order will be nested and\n     * properly balanced. The path argument is the same as it was\n     * for the corresponding beginGroup call; see beginGroup.\n     *\n     * @param {Array} path\n    */\n    this.endGroup = function (path) {\n        this.depth -= 1;\n        return '</div>';\n    };\n\n    /**\n     * Called by the forms layer when it encounters any regular\n     * field -- i.e. one that is neither an embed nor an embedList.\n     *\n     * @param {Object} field\n     * @param {Array} path\n     * @param {Object} value\n     * @param {String} raw\n     * @param {Array} errors\n     * @param {Object} options An object containing widget options, which\n     *          will ultimately be provided to each widget's toHTML method.\n    */\n    this.field = function (field, path, value, raw, errors, options) {\n        var name = path.join('.');\n        var caption = path.slice(this.depth).join(' ');\n        if (field.widget.type === 'hidden') {\n            return field.widget.toHTML(\n                name, value, raw, field, (options || {})\n            );\n        }\n        return (\n            '<div class=\"' +\n                exports.classes(field, errors).join(' ') + '\">' +\n            '<div class=\"scalar\">' +\n                '<div class=\"label\">' +\n                    '<label for=\"' + h(name) + '\">' +\n                        exports.labelHTML(field, caption) +\n                        exports.descriptionHTML(field) +\n                    '</label>' +\n                '</div>' +\n                '<div class=\"content\">' +\n                    '<div class=\"inner\">' +\n                        field.widget.toHTML(\n                            name, value, raw, field, (options || {})\n                        ) +\n                    '</div>' +\n                    '<div class=\"hint\">' +\n                        exports.hintHTML(field) +\n                    '</div>' +\n                    '<div class=\"errors\">' +\n                        exports.errorHTML(errors) +\n                    '</div>' +\n                '</div>' +\n            '</div>' +\n            '</div>'\n        );\n    };\n\n    /**\n     * Called by the forms layer when it is finished rendering a form.\n     * Markup returned from this function is appended to the form output.\n     *\n     * @param {String} field\n     * @param {Array} path\n     * @param {Object} value\n     * @param {String} raw\n     * @param {Array} errors\n    */\n    this.end = function () {\n        return '</div>';\n    };\n};\n\n",
        "fields": "/**\n * The building blocks of Types and Forms, Fields help to validate and authorize\n * changes to docuemnt values.\n *\n * @module\n */\n\n\n/**\n * Module dependencies\n */\n\nvar permissions = require('./permissions'),\n    validators = require('./validators'),\n    widgets = require('./widgets'),\n    utils = require('./utils'),\n    _ = require('./underscore')._;\n\n\n/**\n * Field objects are used when constructing content types and forms.\n *\n * #### Options ####\n *\n * * **omit_empty**  *Boolean* - whether to omit the field from a document when\n *                               the field is empty\n * * **permissions** *Object*  - a permissions check function or an object\n *                               containing separate functions to run on create,\n *                               edit and update operations.\n * * **validators**  *Array*   - an array of validation functions (default: [])\n * * **required**    *Boolean* - whether the field is required (default: true)\n *\n * @constructor\n * @name Field\n * @param {Object} options\n * @api public\n */\n\nvar Field = exports.Field = function Field(options) {\n    _.extend(this, _.defaults(options || {}, {\n        widget: widgets.text(),\n        omit_empty: false,\n        permissions: {},\n        validators: [],\n        required: true\n    }));\n    return this;\n};\n\n\n/**\n * Parses a raw value returning the correct JavaScript type for this field.\n * This will usually be overridden by other field types.\n *\n * @name Field.parse(raw)\n * @param raw\n * @api public\n */\n\nField.prototype.parse = function (raw) {\n    return raw;\n};\n\n\n/**\n * Test values to see if field is considered empty.\n *\n * This function accepts the raw value even though by default it only\n * checks the parsed value, so that other field types overridding this method\n * have the raw data available.\n *\n * @name Field.isEmpty(value, raw)\n * @param value - the parsed value for the field\n * @param raw - the raw value for this field\n * @returns {Boolean}\n * @api public\n */\n\nField.prototype.isEmpty = function (value, raw) {\n    if (raw === undefined) {\n        if (typeof value === 'number' && isNaN(value)) {\n            return true;\n        }\n        raw = value;\n    }\n    return (raw === '' || raw === null || raw === undefined);\n};\n\n/**\n * Run the field's validation functions against a value. Returns an\n * array of validation errors, or an empty array if valid.\n *\n * @name Field.validate(doc, value, raw)\n * @param {Object} doc\n * @param value\n * @param raw\n * @returns {Array}\n * @api public\n */\n\nField.prototype.validate = function (doc, value, raw) {\n    // don't validate empty fields, but check if required\n    if (this.isEmpty(value, raw)) {\n        if (this.required) {\n            return [ new Error('Required field') ];\n        }\n        return [];\n    }\n    return _.reduce(this.validators, function (errs, v) {\n        try {\n            // check that v is actually a function, since IE likes to\n            // insert nulls here for some reason\n            if (v) {\n                errs = errs.concat(v(doc, value, raw) || []);\n            }\n        }\n        catch (e) {\n            errs.push(e);\n        }\n        return errs;\n    }, []);\n};\n\n/**\n * Check relevant field permissions to see if user is authorised to make\n * changes. Returns an array of permissions errors, or an empty array if the\n * changes are permissible.\n *\n * @name Field.authorize(newDoc, oldDoc, newVal, oldVal, userCtx)\n * @param {Object} newDoc\n * @param {Object} oldDoc\n * @param newVal\n * @param oldVal\n * @param {Object} userCtx\n * @returns {Array}\n * @api public\n */\n\nField.prototype.authorize = function (newDoc, oldDoc, newVal, oldVal, userCtx) {\n    var perms = this.permissions;\n    var errors = [];\n    if (_.isFunction(perms)) {\n        errors = errors.concat(\n            utils.getErrors(perms, arguments)\n        );\n    }\n    // on update\n    var fn;\n    // on add\n    if (newDoc && !oldDoc) {\n        fn = perms.add;\n    }\n    // on remove\n    else if (!newDoc || newDoc._deleted) {\n        fn = perms.remove;\n    }\n    // on update\n    else if (newVal !== oldVal) {\n        fn = perms.update;\n    }\n    if (fn) {\n        errors = errors.concat(\n            utils.getErrors(fn, arguments)\n        );\n    }\n    return errors;\n};\n\n\n/**\n * Embedded objects represent a Type embedded within another Type or set of\n * Fields. Its not a true field, but like the Field constructor it acts as a\n * marker when walking through the sub-objects that make up a schema.\n *\n * Exposes the same methods as Field objects.\n *\n * #### Options ####\n *\n * * **type**        *Type Object*  - Required, the Type definition to embed\n * * **omit_empty**  *Boolean* - whether to omit the field from a document when\n *                               the field is empty\n * * **permissions** *Object*  - a permissions check function or an object\n *                               containing separate functions to run on create,\n *                               edit and update operations.\n * * **validators**  *Array*   - an array of validation functions (default: [])\n * * **required**    *Boolean* - whether the field is required (default: true)\n *\n * @name Embedded\n * @param {Object} options\n * @constructor\n * @api public\n */\n\nvar Embedded = exports.Embedded = function Embedded(options) {\n    options = options || {};\n    var type = options.type;\n    if (!type) {\n        throw new Error('No type specified');\n    }\n    options.permissions = _.defaults((options.permissions || {}), {\n        add: permissions.inherit(type),\n        remove: permissions.inherit(type),\n        update:   permissions.inherit(type)\n    });\n    _.extend(this, _.defaults(options, {\n        required: true\n    }));\n    this.type = type;\n};\n\n/**\n * Test values to see if field is considered empty.\n *\n * This function accepts the raw value even though by default it only\n * checks the parsed value, so that other field types overridding this method\n * have the raw data available.\n *\n * @name Embedded.isEmpty(value, raw)\n * @param value - the parsed value for the field\n * @param raw - the raw value for this field\n * @api public\n */\n\nEmbedded.prototype.isEmpty = function (value, raw) {\n    return (value === '' || value === null || value === undefined);\n};\n\n/**\n * Run the type's validate function against a value. Returns an\n * array of validation errors, or an empty array if valid.\n *\n * @name Embedded.validate(doc, value, raw)\n * @param {Object} doc\n * @param value\n * @param raw\n * @returns {Array}\n * @api public\n */\n\nEmbedded.prototype.validate = function (doc, value, raw) {\n    // don't validate empty fields, but check if required\n    if (this.isEmpty(value, raw)) {\n        if (this.required) {\n            return [ new Error('Required field') ];\n        }\n        return [];\n    }\n    if (!value._id) {\n        return [new Error('Embedded document missing _id')];\n    }\n    return this.type.validate(value, raw);\n};\n\n/**\n * Check relevant type permissions to see if user is authorised to make\n * changes. Returns an array of permissions errors, or an empty array if the\n * changes are permissible.\n *\n * @name Embedded.authorize(newDoc, oldDoc, newVal, oldVal, user)\n * @param {Object} newDoc\n * @param {Object} oldDoc\n * @param newVal\n * @param oldVal\n * @param {Object} user\n * @returns {Array}\n * @api public\n */\n\nEmbedded.prototype.authorize = function (newDoc, oldDoc, newVal, oldVal, user) {\n    if (newVal && oldVal && newVal._id !== oldVal._id) {\n        oldVal = undefined;\n    }\n    return this.type.authorize(newVal || {_deleted: true}, oldVal, user);\n};\n\n/**\n * EmbeddedList objects represent multiple instances of a Type embedded within\n * another Type or set of Fields. Its not a true field, but like the Field\n * constructor it acts as a marker when walking through the sub-objects that\n * make up a schema.\n *\n * Exposes the same methods as Field objects.\n *\n * #### Options ####\n *\n * * **type**        *Type Object*  - Required, the Type definition to embed\n * * **omit_empty**  *Boolean* - whether to omit the field from a document when\n *                               the field is empty\n * * **permissions** *Object*  - a permissions check function or an object\n *                               containing separate functions to run on create,\n *                               edit and update operations.\n * * **validators**  *Array*   - an array of validation functions (default: [])\n * * **required**    *Boolean* - whether the field is required (default: true)\n *\n * @name EmbeddedList\n * @param {Object} options\n * @constructor\n * @api public\n */\n\nvar EmbeddedList = exports.EmbeddedList = function EmbeddedList(options) {\n    options = options || {};\n    var type = options.type;\n    if (!type) {\n        throw new Error('No type specified');\n    }\n    options.permissions = _.defaults((options.permissions || {}), {\n        add: permissions.inherit(type),\n        remove: permissions.inherit(type),\n        update:   permissions.inherit(type)\n    });\n    _.extend(this, _.defaults(options, {\n        required: true\n    }));\n    this.type = type;\n};\n\n/**\n * Test values to see if field is considered empty.\n *\n * This function accepts the raw value even though by default it only\n * checks the parsed value, so that other field types overridding this method\n * have the raw data available.\n *\n * @name EmbeddedList.isEmpty(value, raw)\n * @param value - the parsed value for the field\n * @param raw - the raw value for this field\n * @api public\n */\n\nEmbeddedList.prototype.isEmpty = function (value, raw) {\n    return (value === '' || value === null || value === undefined);\n};\n\n/**\n * Detects embedded documents with missing _id properties and returns an\n * array of Error objects for each occurence. Returns an empty array if\n * all documents have a populated _id property.\n *\n * @name EmbeddedList.missingIDs(list)\n * @param {Array} list\n * @returns {Array}\n * @api public\n */\n\nEmbeddedList.prototype.missingIDs = function (list) {\n    var errs = [];\n    _.each(list, function (v, i) {\n        if (!v._id) {\n            var e = new Error('Embedded document missing _id');\n            e.field = [i];\n            errs.push(e);\n        }\n    });\n    return errs;\n};\n\n/**\n * Detects embedded documents with duplicate _id properties and returns an\n * array of Error objects for each occurence. Returns an empty array if\n * all documents have a unique _id property.\n *\n * @name EmbeddedList.duplicateIDs(list)\n * @param {Array} list\n * @returns {Array}\n * @api public\n */\n\nEmbeddedList.prototype.duplicateIDs = function (list) {\n    var ids = {};\n    var errs = [];\n    _.each(list, function (v, i) {\n        if (v._id in ids) {\n            var e = new Error('Embedded document duplicates an existing _id');\n            e.field = [i];\n            errs.push(e);\n        }\n        ids[v._id] = true;\n    });\n    return errs;\n};\n\n/**\n * Checks for missing or duplicate _ids then runs the type's validate function\n * against each embedded document. Returns an array of validation errors, or\n * an empty array if valid.\n *\n * @name EmbeddedList.validate(doc, value, raw)\n * @param {Object} doc\n * @param value\n * @param raw\n * @returns {Array}\n * @api public\n */\n\nEmbeddedList.prototype.validate = function (doc, value, raw) {\n    var type = this.type;\n\n    // don't validate empty fields, but check if required\n    if (this.isEmpty(value, raw)) {\n        if (this.required) {\n            return [ new Error('Required field') ];\n        }\n        return [];\n    }\n\n    // check all values are objects\n    var non_objects = _.filter(value, function (v) {\n\n        /* Workaround for interpreter bug:\n            Saving embedList() data throws an error when running in a\n            CouchDB linked against js-1.8.0. We encounter a situation where\n            typeof(v) === 'object', but the 'v instanceof Object' test\n            incorrectly returns false. We suspect an interpreter bug.\n            Please revisit this using a CouchDB linked against js-1.8.5.\n            We don't currently have the infrastructure for a test case. */\n        \n        /* Before: return !(v instanceof Object) || _.isArray(v); */\n        return (typeof(v) !== 'object' || _.isArray(v));\n    });\n    if (non_objects.length) {\n        return _.map(non_objects, function (v) {\n            return new Error(v + ' is not an object');\n        });\n    }\n\n    // check for missing ids\n    var missing = this.missingIDs(value);\n    if (missing.length) {\n        return missing;\n    }\n\n    // check for duplicate ids\n    var duplicates = this.duplicateIDs(value);\n    if (duplicates.length) {\n        return duplicates;\n    }\n\n    // run type validation against each embedded document\n    return _.reduce(value, function (errs, v, i) {\n        var r = raw ? raw[i]: undefined;\n        return errs.concat(\n            _.map(type.validate(v, r), function (err) {\n                err.field = [i].concat(err.field || []);\n                return err;\n            })\n        );\n    }, []);\n};\n\n/**\n * Check relevant type permissions to see if user is authorised to make\n * changes. Returns an array of permissions errors, or an empty array if the\n * changes are permissible.\n *\n * @name EmbeddedList.authorize(nDoc, oDoc, nVal, oVal, user)\n * @param {Object} nDoc\n * @param {Object} oDoc\n * @param nVal\n * @param oVal\n * @param {Object} user\n * @returns {Array}\n * @api public\n */\n\nEmbeddedList.prototype.authorize = function (nDoc, oDoc, nVal, oVal, user) {\n    var type = this.type;\n    var perms = this.permissions;\n\n    nVal = nVal || [];\n    oVal = oVal || [];\n\n    // a unique list of embedded ids from both the old and new document\n    var ids = _.uniq(_.pluck(nVal, '_id').concat(_.pluck(oVal, '_id')));\n\n    return _.reduce(ids, function (errs, id, i) {\n\n        var curr_errs = [];\n        var nd = _.detect(nVal, function (v) {\n            return v && v._id === id;\n        });\n        nd = nd || {_deleted: true};\n        var od = _.detect(oVal, function (v) {\n            return v && v._id === id;\n        });\n        var args = [nDoc, oDoc, nd, od, user];\n\n        if (_.isFunction(perms)) {\n            curr_errs = utils.getErrors(perms, args);\n        }\n        var fn;\n        // on add\n        if (nd && !od) {\n            fn = perms.add;\n        }\n        // on remove\n        else if (nd._deleted) {\n            fn = perms.remove;\n        }\n        // on update\n        else if (JSON.stringify(nd) !== JSON.stringify(od)) {\n            fn = perms.update;\n        }\n        if (fn) {\n            curr_errs = curr_errs.concat(utils.getErrors(fn, args));\n        }\n        curr_errs = _.map(curr_errs, function (e) {\n            e.field = [i].concat(e.field || []);\n            return e;\n        });\n        return errs.concat(curr_errs);\n\n    }, []);\n};\n\n\n/**\n * Prepends a validator to an array of validator functions.\n *\n * @param {Array} arr\n * @param {Function} fn\n * @api private\n */\n\nvar prependValidator = function (options, fn) {\n    options = options || {};\n    options.validators = [fn].concat(options.validators || []);\n    return options;\n};\n\n\n/**\n * Creates a new string Field\n *\n * @name string([options])\n * @param {Object} options\n * @api public\n */\n\nexports.string = function (options) {\n    return new Field(_.defaults((options || {}), {\n        parse: function (raw) {\n            if (raw === null || raw === undefined) {\n                return '';\n            }\n            return '' + raw;\n        }\n    }));\n};\n\n\n/**\n * Creates a new number Field\n *\n * @name number([options])\n * @param {Object} options\n * @api public\n */\n\nexports.number = function (options) {\n    options = prependValidator(options, function (doc, value) {\n        if (isNaN(value)) {\n            throw new Error('Not a number');\n        }\n    });\n    return new Field(_.defaults((options || {}), {\n        parse: function (raw) {\n            if (raw === '' || raw === null || raw === undefined) {\n                return NaN;\n            }\n            return Number(raw);\n        }\n    }));\n};\n\n\n/**\n * Creates a new boolean Field\n *\n * @name boolean([options])\n * @param {Object} options\n * @api public\n */\n\nexports.boolean = function (options) {\n    return new Field(_.defaults((options || {}), {\n        widget: widgets.checkbox(),\n        required: false,\n        parse: Boolean\n    }));\n};\n\n\n/**\n * Creates a URL Field\n *\n * @name url([options])\n * @param {Object} options\n * @api public\n */\n\nexports.url = function (options) {\n    options = prependValidator(options, validators.url());\n    return exports.string(options);\n};\n\n\n/**\n * Creates an email Field\n *\n * @name email([options])\n * @param {Object} options\n * @api public\n */\n\nexports.email = function (options) {\n    options = prependValidator(options, validators.email());\n    return exports.string(options);\n};\n\n\n/**\n * Creates a creator Field\n *\n * @name creator([options])\n * @param {Object} options\n * @api public\n */\n\nexports.creator = function (options) {\n    options = options || {};\n    if (!options.permissions) {\n        options.permissions = {};\n    }\n    var p = options.permissions;\n    if (p.add) {\n        p.add = permissions.all([\n            permissions.matchUsername(),\n            p.add\n        ]);\n    }\n    else {\n        p.add = permissions.matchUsername();\n    }\n    if (p.update) {\n        p.update = permissions.all([\n            permissions.fieldUneditable(),\n            p.update\n        ]);\n    }\n    else {\n        p.update = permissions.fieldUneditable();\n    }\n    return exports.string(_.defaults(options, {\n        required: false,\n        widget: widgets.creator(),\n        default_value: function (req) {\n            return (req.userCtx && req.userCtx.name) || '';\n        }\n    }));\n};\n\n\n/**\n * Creates a createdTime timestamp Field\n *\n * @name createdTime([options])\n * @param {Object} options\n * @api public\n */\n\nexports.createdTime = function (options) {\n    options = options || {};\n    if (!options.permissions) {\n        options.permissions = {};\n    }\n    var p = options.permissions;\n    if (p.update) {\n        p.update = permissions.all([\n            permissions.fieldUneditable(),\n            p.update\n        ]);\n    }\n    else {\n        p.update = permissions.fieldUneditable();\n    }\n    return exports.number(_.defaults(options, {\n        widget: widgets.computed(),\n        default_value: function (req) {\n            return new Date().getTime();\n        }\n    }));\n};\n\n\n/**\n * Creates a choice Field\n *\n * Required option: values - an array of possible choices, each an array\n * with the first item as the value and the second as its label.\n *\n * @name choice([options])\n * @param {Object} options\n * @api public\n */\n\nexports.choice = function (options) {\n    if (!options || !options.values) {\n        throw new Error('No values defined');\n    }\n    options = prependValidator(options, function (doc, value) {\n        for (var i = 0; i < options.values.length; i++) {\n            if (value === options.values[i][0]) {\n                return;\n            }\n        }\n        throw new Error('Invalid choice');\n    });\n    // use value as label if no label defined\n    options.values = _.map(options.values, function (v) {\n        return _.isArray(v) ? v: [v, v];\n    });\n    return new Field(_.defaults(options, {\n        widget: widgets.select({values: options.values})\n    }));\n};\n\n\n/**\n * Creates a number choice Field\n *\n * @name numberChoice([options])\n * @param {Object} options\n * @api public\n */\n\nexports.numberChoice = function (options) {\n    options = options || {};\n    prependValidator(options, function (doc, value) {\n        if (isNaN(value)) {\n            throw new Error('Not a number');\n        }\n    });\n    return exports.choice(_.defaults(options, {\n        parse: function (raw) {\n            if (raw === null || raw === '') {\n                return '';\n            }\n            return Number(raw);\n        }\n    }));\n};\n\n\n/**\n * Creates an Embedded Field\n *\n * Required option: type - the Type definition to embed\n *\n * @name embed([options])\n * @param {Object} options\n * @api public\n */\n\nexports.embed = function (options) {\n    return new Embedded(_.defaults((options || {}), {\n        widget: widgets.embedList({\n            singleton: true,\n            widget: widgets.defaultEmbedded()\n        })\n    }));\n};\n\n\n/**\n * Creates an EmbeddedList Field\n *\n * Required option: type - the Type definition to embed\n *\n * @name embedList([options])\n * @param {Object} options\n * @api public\n */\n\nexports.embedList = function (options) {\n    return new EmbeddedList(_.defaults((options || {}), {\n        widget: widgets.embedList({\n            singleton: false,\n            widget: widgets.defaultEmbedded()\n        })\n    }));\n};\n\n\n/**\n * Creates a array Field. The default parse function expects a single row of\n * comma separated values.\n *\n * To accept an array of values other than strings, add a function to options\n * called parseEach which accepts the string value for each item and performs\n * the transformation.\n *\n * @name array([options])\n * @param {Object} options\n * @api public\n */\n\nexports.array = function (options) {\n    options = options || {};\n    options.hint = options.hint || \"Values should be comma separated\";\n    prependValidator(options, function (doc, value) {\n        if (!_.isArray(value)) {\n            throw new Error('Not an array');\n        }\n    });\n    return exports.string(_.defaults(options, {\n        parse: function (raw) {\n            var result = utils.parseCSV(raw || '')[0] || [];\n            if (options.parseEach) {\n                result = _.map(result, options.parseEach);\n            }\n            return result;\n        }\n    }));\n};\n\n/**\n * Creates a number array Field, same as the array field only each value is\n * parsed as a number instead of a string.\n *\n * @name numberArray([options])\n * @param {Object} options\n * @api public\n */\n\nexports.numberArray = function (options) {\n    options = options || {};\n    options.parseEach = options.parseEach || function (v) {\n        return Number(v);\n    };\n    prependValidator(options, function (doc, value) {\n        for (var i = 0, len = value.length; i < len; i++) {\n            if (isNaN(value[i])) {\n                throw new Error('Not a number');\n            }\n        }\n    });\n    return exports.array(options);\n};\n\n",
        "sanitize": "/**\n * Input sanitization, escaping, and construction functions\n * covering security-sensitive areas.\n *\n * @module\n */\n\n/**\n * Module dependencies\n */\n\nvar _ = require('./underscore')._;\n\n\n/**\n * Encodes required characters as HTML entities so a string\n * can be included in a page. This function must be used to\n * avoid Cross-site Scripting attacks.\n *\n * @name escapeHtml(s)\n * @param {String} s\n * @returns {String}\n * @api public\n */\n\nexports.escapeHtml = exports.h = function (s)\n{\n    s = ('' + s); /* Coerce to string */\n    s = s.replace(/&/g, '&amp;');\n    s = s.replace(/</g, '&lt;');\n    s = s.replace(/>/g, '&gt;');\n    s = s.replace(/\"/g, '&quot;');\n    s = s.replace(/'/g, '&#39;');\n    return s;\n};\n\n\n/**\n * Encodes selected characters in a string, so that the string\n * can be safely used within a Javascript string constant. This\n * function must be used to avoid cross-site scripting attacks\n * (or, in some cases, arbitrary server-side code execution).\n *\n * @name escapeJavascriptString(s)\n * @param {String} s\n * @returns {String}\n * @api public\n */\n\nexports.escapeJavascriptString = exports.js = function (s)\n{\n    s = ('' + s); /* Coerce to string */\n    s = s.replace(/'/g, \"\\\\'\");\n    s = s.replace(/'/g, \"\\\\'\");\n    s = s.replace(/'/g, \"\\\\'\");\n    s = s.replace(/\"/g, '\\\\\"');\n    return s;\n};\n\n\n/**\n * Encodes selected characters in a string, so that the string\n * can be safely used within an XML character data section.\n * This function must be used to avoid cross-site scripting attacks.\n *\n * @name escapeJavascriptString(s)\n * @param {String} s\n * @returns {String}\n * @api public\n */\n\nexports.escapeXmlCharacterData = exports.cdata = function (s)\n{\n    s = ('' + s); /* Coerce to string */\n    s = s.replace(/\\]\\]>/g, '');\n    return s;\n};\n\n\n/**\n * Takes any number of arguments, and combines them together\n * to safely form a string that's suitable for use as a DOM\n * element identifier.\n *\n * @name generateDomIdentifier(s)\n * @param {String} s\n * @returns {String}\n * @api public\n */\n\nexports.generateDomIdentifier = exports.id = function (/* ... */) {\n    if (arguments.length <= 0) {\n        return null;\n    }\n    var rv = [ 'id' ];\n    var esc = function (x) {\n        return ('' + x).replace(/[^A-Za-z0-9_]+/, '_');\n    };\n\n    for (var i = 0, len = arguments.length; i < len; ++i) {\n        var arg = arguments[i];\n        if (arg !== undefined && arg !== null) {\n            if (_.isArray(arg)) {\n                /* Avoid recursion; limit to one level deep */\n                for (var j = 0, lenj = arg.length; j < lenj; ++j) {\n                    if (arg[j] !== undefined && arg[j] !== null) {\n                        rv.push(esc(arg[j]));\n                    }\n                }\n            } else {\n                rv.push(esc(arg));\n            }\n        }\n    }\n    return rv.join('_');\n};\n\n\n/**\n * Takes any number of arguments, and combines them together\n * to safely form a string that's suitable for use in a DOM\n * element's name attribute.\n *\n * @name generateDomName(s)\n * @param {String} s\n * @returns {String}\n * @api public\n */\n\nexports.generateDomName = exports.name = function (/* ... */) {\n    if (arguments.length <= 0) {\n        return null;\n    }\n    var rv = [];\n    var esc = function (x) {\n        return ('' + x).replace(/[\\'\\\"]+/, '_');\n    };\n\n    for (var i = 0, len = arguments.length; i < len; ++i) {\n        var arg = arguments[i];\n        if (arg !== undefined && arg !== null) {\n            if (_.isArray(arg)) {\n                /* Avoid recursion; limit to one level deep */\n                for (var j = 0, lenj = arg.length; j < lenj; ++j) {\n                    if (arg[j] !== undefined && arg[j] !== null) {\n                        rv.push(esc(arg[j]));\n                    }\n                }\n            } else {\n                rv.push(esc(arg));\n            }\n        }\n    }\n    return rv.join('.');\n};\n\n\n",
        "session": "/**\n * Functions related to the management of user sessions and account information.\n *\n * @module\n */\n\n/**\n * Module dependencies\n */\n\nvar db = require('./db'),\n    sha1 = require('./sha1'),\n    cookies = require('./cookies'),\n    events = require('./events'),\n    utils = require('./utils');\n\n\n/**\n * Creates a fake request to /_session to pass to sessionChange, useful\n * when using functions such as templates.render\n *\n * @name fakeRequest(userCtx, callback)\n * @param {Object} userCtx\n * @param {Function} callback\n * @api public\n */\n\nexports.fakeRequest = function (userCtx, callback) {\n    db.newUUID(100, function (err, uuid) {\n        if (err) {\n            return callback(err);\n        }\n        callback(null, {\n            userCtx: userCtx,\n            uuid: uuid,\n            method: 'GET',\n            query: {},\n            headers: {},\n            path: ['_session'],\n            client: true,\n            initial_hit: utils.initial_hit,\n            cookie: cookies.readBrowserCookies()\n        });\n    });\n};\n\n/**\n * Calls sessionChange if exported from the currently loaded app.\n *\n * @name sessionChange(userCtx, callback)\n * @param {Object} userCtx\n * @param {Function} callback\n * @api public\n */\n\nexports.sessionChange = function (userCtx, callback) {\n    var req = exports.fakeRequest(userCtx, function (err, req) {\n        if (err) {\n            if (callback) {\n                return callback(err);\n            }\n            throw err;\n        }\n        events.emit('sessionChange', userCtx, req);\n        if (callback) {\n            callback();\n        }\n    });\n};\n\n/**\n * Logs out the current user.\n *\n * @name logout(callback)\n * @param {Function} callback\n * @api public\n */\n\nexports.logout = function (callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('logout cannot be called server-side');\n    }\n    db.request({\n        type: \"DELETE\",\n        url: \"/_session\", // don't need baseURL, /_session always available\n        username: \"_\",\n        password : \"_\"\n    },\n    function (err, resp) {\n        if (resp && resp.ok) {\n            utils.userCtx = {name: null, roles: []};\n            utils.session = {userCtx: utils.userCtx};\n            exports.sessionChange(utils.userCtx);\n        }\n        if (callback) {\n            callback(err, resp);\n        }\n    });\n};\n\n/**\n * Attempt to login using the username and password provided.\n *\n * @name login(username, password, callback)\n * @param {String} username\n * @param {String} password\n * @param {Function} callback\n * @api public\n */\n\nexports.login = function (username, password, callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('login cannot be called server-side');\n    }\n    db.request({\n        type: \"POST\",\n        url: \"/_session\",\n        data: {name: username, password: password}\n    },\n    function (err, resp) {\n        if (resp && resp.ok) {\n            // TODO: for some reason resp.name is set to null in the response\n            // even though the roles are correct for the user! Look into this\n            // and see if its a bug in couchdb, for now, just using the username\n            // given to the login function instead, since we know the login\n            // request was accepted.\n            //utils.userCtx = {name: resp.name, roles: resp.roles};\n            utils.userCtx = {name: username, roles: resp.roles};\n            utils.session = {userCtx: utils.userCtx};\n            exports.sessionChange(utils.userCtx);\n        }\n        if (callback) {\n            callback(err, resp);\n        }\n    });\n};\n\n\n/**\n * Returns the current user's session information.\n *\n * @name info(callback)\n * @param {Function} callback\n * @api public\n */\n\nexports.info = function (callback) {\n    if (!utils.isBrowser()) {\n        throw new Error('info cannot be called server-side');\n    }\n    db.request({\n        type: \"GET\",\n        url: \"/_session\"\n    },\n    function (err, resp) {\n        var oldUserCtx = utils.userCtx;\n        utils.session = resp;\n        utils.userCtx = (resp && resp.userCtx) || {name: null, roles: []};\n        // TODO: should this check for differences in more than just name?\n        if (!oldUserCtx || oldUserCtx.name !== utils.userCtx.name) {\n            exports.sessionChange(utils.userCtx);\n        }\n        if (callback) {\n            callback(err, resp);\n        }\n    });\n};\n\n/**\n * Returns the authentication database for the current user's session.\n *\n * @name userDb(callback)\n * @param {Function} callback\n * @api public\n */\n\nexports.userDb = function (callback) {\n    if (utils.session && utils.session.authentication_db) {\n        return callback(null, utils.session.authentication_db);\n    }\n    exports.info(function (err, session) {\n        callback(err, session ? session.info.authentication_db: null);\n    });\n};\n\n/**\n * Creates a new user document with given username and password.\n *\n * @name signup(username, password, callback)\n * @param {String} username\n * @param {String} password\n * @param {Function} callback\n * @api public\n */\n\nexports.signup = function (username, password, callback) {\n    var doc = {};\n    doc._id = 'org.couchdb.user:' + username;\n    doc.name = username;\n    doc.type = 'user';\n    doc.roles = [];\n\n    db.newUUID(100, function (err, uuid) {\n        if (err) {\n            return callback(err);\n        }\n        doc.salt = uuid;\n        doc.password_sha = sha1.hex(password + doc.salt);\n        exports.userDb(function (err, userdb) {\n            if (err) {\n                return callback(err);\n            }\n            var url = '/' + userdb + '/' + doc._id;\n            var req = {\n                type: 'PUT',\n                url: url,\n                data: JSON.stringify(doc),\n                processData: false,\n                contentType: 'application/json'\n            };\n            db.request(req, callback);\n        });\n    });\n};\n",
        "sha1": "/**\r\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined\r\n * in FIPS PUB 180-1. This module is used to hash user passwords in a way that's\r\n * compatible with CouchDB.\r\n *\r\n * This module is Copyright Paul Johnston 2000 - 2002 and distributed under the\r\n * BSD License. See http://pajhome.org.uk/crypt/md5 for details.\r\n *\r\n * @module\r\n */\r\n\r\n/*\r\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined\r\n * in FIPS PUB 180-1\r\n * Version 2.1a Copyright Paul Johnston 2000 - 2002.\r\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\r\n * Distributed under the BSD License\r\n * See http://pajhome.org.uk/crypt/md5 for details.\r\n */\r\n\r\n/*\r\n * Configurable variables. You may need to tweak these to be compatible with\r\n * the server-side, but the defaults work in most cases.\r\n */\r\nvar hexcase = 0;  /* hex output format. 0 - lowercase; 1 - uppercase        */\r\nvar b64pad  = \"=\"; /* base-64 pad character. \"=\" for strict RFC compliance   */\r\nvar chrsz   = 8;  /* bits per input character. 8 - ASCII; 16 - Unicode      */\r\n\r\n/*\r\n * These are the functions you'll usually want to call\r\n * They take string arguments and return either hex or base-64 encoded strings\r\n */\r\nfunction hex_sha1(s){return binb2hex(core_sha1(str2binb(s),s.length * chrsz));}\r\nfunction b64_sha1(s){return binb2b64(core_sha1(str2binb(s),s.length * chrsz));}\r\nfunction str_sha1(s){return binb2str(core_sha1(str2binb(s),s.length * chrsz));}\r\nfunction hex_hmac_sha1(key, data){ return binb2hex(core_hmac_sha1(key, data));}\r\nfunction b64_hmac_sha1(key, data){ return binb2b64(core_hmac_sha1(key, data));}\r\nfunction str_hmac_sha1(key, data){ return binb2str(core_hmac_sha1(key, data));}\r\n\r\n/*\r\n * Perform a simple self-test to see if the VM is working\r\n */\r\nfunction sha1_vm_test()\r\n{\r\n  return hex_sha1(\"abc\") == \"a9993e364706816aba3e25717850c26c9cd0d89d\";\r\n}\r\n\r\n/*\r\n * Calculate the SHA-1 of an array of big-endian words, and a bit length\r\n */\r\nfunction core_sha1(x, len)\r\n{\r\n  /* append padding */\r\n  x[len >> 5] |= 0x80 << (24 - len % 32);\r\n  x[((len + 64 >> 9) << 4) + 15] = len;\r\n\r\n  var w = Array(80);\r\n  var a =  1732584193;\r\n  var b = -271733879;\r\n  var c = -1732584194;\r\n  var d =  271733878;\r\n  var e = -1009589776;\r\n\r\n  for(var i = 0; i < x.length; i += 16)\r\n  {\r\n    var olda = a;\r\n    var oldb = b;\r\n    var oldc = c;\r\n    var oldd = d;\r\n    var olde = e;\r\n\r\n    for(var j = 0; j < 80; j++)\r\n    {\r\n      if(j < 16) w[j] = x[i + j];\r\n      else w[j] = rol(w[j-3] ^ w[j-8] ^ w[j-14] ^ w[j-16], 1);\r\n      var t = safe_add(safe_add(rol(a, 5), sha1_ft(j, b, c, d)),\r\n                       safe_add(safe_add(e, w[j]), sha1_kt(j)));\r\n      e = d;\r\n      d = c;\r\n      c = rol(b, 30);\r\n      b = a;\r\n      a = t;\r\n    }\r\n\r\n    a = safe_add(a, olda);\r\n    b = safe_add(b, oldb);\r\n    c = safe_add(c, oldc);\r\n    d = safe_add(d, oldd);\r\n    e = safe_add(e, olde);\r\n  }\r\n  return Array(a, b, c, d, e);\r\n\r\n}\r\n\r\n/*\r\n * Perform the appropriate triplet combination function for the current\r\n * iteration\r\n */\r\nfunction sha1_ft(t, b, c, d)\r\n{\r\n  if(t < 20) return (b & c) | ((~b) & d);\r\n  if(t < 40) return b ^ c ^ d;\r\n  if(t < 60) return (b & c) | (b & d) | (c & d);\r\n  return b ^ c ^ d;\r\n}\r\n\r\n/*\r\n * Determine the appropriate additive constant for the current iteration\r\n */\r\nfunction sha1_kt(t)\r\n{\r\n  return (t < 20) ?  1518500249 : (t < 40) ?  1859775393 :\r\n         (t < 60) ? -1894007588 : -899497514;\r\n}\r\n\r\n/*\r\n * Calculate the HMAC-SHA1 of a key and some data\r\n */\r\nfunction core_hmac_sha1(key, data)\r\n{\r\n  var bkey = str2binb(key);\r\n  if(bkey.length > 16) bkey = core_sha1(bkey, key.length * chrsz);\r\n\r\n  var ipad = Array(16), opad = Array(16);\r\n  for(var i = 0; i < 16; i++)\r\n  {\r\n    ipad[i] = bkey[i] ^ 0x36363636;\r\n    opad[i] = bkey[i] ^ 0x5C5C5C5C;\r\n  }\r\n\r\n  var hash = core_sha1(ipad.concat(str2binb(data)), 512 + data.length * chrsz);\r\n  return core_sha1(opad.concat(hash), 512 + 160);\r\n}\r\n\r\n/*\r\n * Add integers, wrapping at 2^32. This uses 16-bit operations internally\r\n * to work around bugs in some JS interpreters.\r\n */\r\nfunction safe_add(x, y)\r\n{\r\n  var lsw = (x & 0xFFFF) + (y & 0xFFFF);\r\n  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\r\n  return (msw << 16) | (lsw & 0xFFFF);\r\n}\r\n\r\n/*\r\n * Bitwise rotate a 32-bit number to the left.\r\n */\r\nfunction rol(num, cnt)\r\n{\r\n  return (num << cnt) | (num >>> (32 - cnt));\r\n}\r\n\r\n/*\r\n * Convert an 8-bit or 16-bit string to an array of big-endian words\r\n * In 8-bit function, characters >255 have their hi-byte silently ignored.\r\n */\r\nfunction str2binb(str)\r\n{\r\n  var bin = Array();\r\n  var mask = (1 << chrsz) - 1;\r\n  for(var i = 0; i < str.length * chrsz; i += chrsz)\r\n    bin[i>>5] |= (str.charCodeAt(i / chrsz) & mask) << (32 - chrsz - i%32);\r\n  return bin;\r\n}\r\n\r\n/*\r\n * Convert an array of big-endian words to a string\r\n */\r\nfunction binb2str(bin)\r\n{\r\n  var str = \"\";\r\n  var mask = (1 << chrsz) - 1;\r\n  for(var i = 0; i < bin.length * 32; i += chrsz)\r\n    str += String.fromCharCode((bin[i>>5] >>> (32 - chrsz - i%32)) & mask);\r\n  return str;\r\n}\r\n\r\n/*\r\n * Convert an array of big-endian words to a hex string.\r\n */\r\nfunction binb2hex(binarray)\r\n{\r\n  var hex_tab = hexcase ? \"0123456789ABCDEF\" : \"0123456789abcdef\";\r\n  var str = \"\";\r\n  for(var i = 0; i < binarray.length * 4; i++)\r\n  {\r\n    str += hex_tab.charAt((binarray[i>>2] >> ((3 - i%4)*8+4)) & 0xF) +\r\n           hex_tab.charAt((binarray[i>>2] >> ((3 - i%4)*8  )) & 0xF);\r\n  }\r\n  return str;\r\n}\r\n\r\n/*\r\n * Convert an array of big-endian words to a base-64 string\r\n */\r\nfunction binb2b64(binarray)\r\n{\r\n  var tab = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\r\n  var str = \"\";\r\n  for(var i = 0; i < binarray.length * 4; i += 3)\r\n  {\r\n    var triplet = (((binarray[i   >> 2] >> 8 * (3 -  i   %4)) & 0xFF) << 16)\r\n                | (((binarray[i+1 >> 2] >> 8 * (3 - (i+1)%4)) & 0xFF) << 8 )\r\n                |  ((binarray[i+2 >> 2] >> 8 * (3 - (i+2)%4)) & 0xFF);\r\n    for(var j = 0; j < 4; j++)\r\n    {\r\n      if(i * 8 + j * 6 > binarray.length * 32) str += b64pad;\r\n      else str += tab.charAt((triplet >> 6*(3-j)) & 0x3F);\r\n    }\r\n  }\r\n  return str;\r\n}\r\n\r\n\r\n/**\r\n * Hashes a string using SHA1 and returns a hex representation of it.\r\n *\r\n * @name hex(s)\r\n * @param {String} s\r\n * @returns {String}\r\n * @api public\r\n */\r\n\r\nexports.hex = hex_sha1;\r\n\r\n/**\r\n * Hashes a string using SHA1 and returns a base64 representation of it.\r\n *\r\n * @name base64(s)\r\n * @param {String} s\r\n * @returns {String}\r\n * @api public\r\n */\r\n\r\nexports.base64 = b64_sha1;\r\n\r\n/**\r\n * Hashes a string using SHA1 and returns a string representation of it.\r\n *\r\n * @name str(s)\r\n * @param {String} s\r\n * @returns {String}\r\n * @api public\r\n */\r\n\r\nexports.str = str_sha1;\r\n\r\n/**\r\n * Calculates the HMAC-SHA1 of a key and some data, returning a hex\r\n * representation of it.\r\n *\r\n * @name hex_hmac(key, data)\r\n * @param {String} key\r\n * @param {String} data\r\n * @returns {String}\r\n * @api public\r\n */\r\n\r\nexports.hex_hmac = hex_hmac_sha1;\r\n\r\n/**\r\n * Calculates the HMAC-SHA1 of a key and some data, returning a base64\r\n * representation of it.\r\n *\r\n * @name base64_hmac(key, data)\r\n * @param {String} key\r\n * @param {String} data\r\n * @returns {String}\r\n * @api public\r\n */\r\n\r\nexports.base64_hmac = b64_hmac_sha1;\r\n\r\n/**\r\n * Calculates the HMAC-SHA1 of a key and some data, returning a string\r\n * representation of it.\r\n *\r\n * @name str_hmac(key, data)\r\n * @param {String} key\r\n * @param {String} data\r\n * @returns {String}\r\n * @api public\r\n */\r\n\r\nexports.str_hmac = str_hmac_sha1;\r\n",
        "types": "/**\n * Document types can be used to ease the validation of updates and check\n * permissions when creating, editing or deleting documents.\n *\n * @module\n */\n\n\n/**\n * Module dependencies\n */\n\nvar utils = require('./utils'),\n    kanso_utils = require('kanso/utils'),\n    db = require('./db'),\n    fields = require('./fields'),\n    fieldset = require('./fieldset'),\n    widgets = require('./widgets'),\n    permissions = require('./permissions'),\n    _ = require('./underscore')._;\n\n\n/**\n * Creates a new Type object\n *\n * #### Options ####\n *\n * * **fields**       *Object* - Field objects to use as the Types's schema\n * * **permissions**  *Object* - a permissions check function or an object\n *                    containing separate functions to run on add, remove\n *                    and update operations.\n * * **display_name** *Function|String|Array* - name to be used when displaying\n *                    the document in the admin tool. A string or array\n *                    will become the property to display. A function\n *                    should take the document as a object and return\n *                    the display name.\n *\n * @name Type(name, options)\n * @param {Object} options\n * @constructor\n * @api public\n */\n\nvar Type = exports.Type = function Type(name, options) {\n    if (typeof name !== 'string') {\n        throw new Error('First argument must be the type name');\n    }\n    this.name = name;\n    options = options || {};\n\n    var f = {};\n    f._id = fields.string({\n        omit_empty: true,\n        required: false,\n        widget: widgets.hidden(),\n        permissions: {\n            update: permissions.fieldUneditable()\n        },\n        default_value: function (req) {\n            return req.uuid;\n        }\n    });\n    f._rev = fields.string({\n        omit_empty: true,\n        required: false,\n        widget: widgets.hidden()\n    });\n    f._deleted = fields.boolean({\n        omit_empty: true,\n        required: false,\n        widget: widgets.hidden()\n    });\n    f.type = fields.string({\n        default_value: name,\n        widget: widgets.hidden(),\n        validators: [\n            function (doc, val, raw) {\n                if (val !== name) {\n                    throw new Error('Unexpected value for type');\n                }\n            },\n        ]\n    });\n    for (var k in options.fields) {\n        if (options.fields.hasOwnProperty(k)) {\n            f[k] = options.fields[k];\n        }\n    }\n\n    options.fields = f;\n    _.extend(this, _.defaults(options, {\n        permissions: []\n    }));\n\n    if (options.display_name) {\n        if (typeof options.display_name !== 'function') {\n            this.display_name = function (doc) {\n                if (typeof options.display_name === 'string') {\n                    options.display_name = [options.display_name];\n                }\n                return kanso_utils.getPropertyPath(doc, options.display_name);\n            };\n        }\n    }\n};\n\n/**\n * Run field validators against document and check for missing required\n * fields or extra fields when the Types's allow_extra_fields property is\n * set to false.\n *\n * @name Type.validate(doc, rawDoc)\n * @param {Object} doc\n * @param {Object} rawDoc\n * @returns {Array}\n * @api public\n */\n\nType.prototype.validate = function (doc, rawDoc) {\n    rawDoc = rawDoc || doc;\n    return fieldset.validate(\n        this.fields,\n        doc,\n        doc,\n        rawDoc,\n        [],\n        this.allow_extra_fields\n    );\n};\n\n\n/**\n * Run field permissions checks against userCtx and document.\n *\n * @name Type.authorize(nDoc, oDoc, user)\n * @param {Object} nDoc - new document\n * @param {Object} oDoc - old document\n * @param {Object} userCtx - user context object\n * @returns {Array}\n * @api public\n */\n\nType.prototype.authorize = function (nDoc, oDoc, user) {\n    var errs = this.authorizeTypeLevel(nDoc, oDoc, user);\n    return errs.concat(fieldset.authFieldSet(\n        this.fields, nDoc, oDoc, nDoc, oDoc, user, [], this.allow_extra_fields\n    ));\n};\n\n/**\n * Runs top type-level permissions checks only.\n *\n * @name Type.authorizeTypeLevel(nDoc, oDoc, user)\n * @param {Object} nDoc - new document\n * @param {Object} oDoc - old document\n * @param {Object} userCtx - user context object\n * @returns {Array}\n * @api public\n */\n\nType.prototype.authorizeTypeLevel = function (nDoc, oDoc, user) {\n    var perms = this.permissions;\n    var errs = [];\n    if (_.isFunction(perms)) {\n        errs = errs.concat(\n            utils.getErrors(perms, [nDoc, oDoc, null, null, user])\n        );\n    }\n    // on update\n    var fn = perms.update;\n    // on add\n    if (nDoc && !oDoc) {\n        fn = perms.add;\n    }\n    // on remove\n    else if (!nDoc || nDoc._deleted) {\n        fn = perms.remove;\n    }\n    if (fn) {\n        errs = errs.concat(\n            utils.getErrors(fn, [nDoc, oDoc, null, null, user])\n        );\n    }\n    return errs;\n};\n\n/**\n * Create's a new object for this Type. Pre-filling any default values and\n * providing a new _id value. This is a convenient function to use when creating\n * a type to embed within another.\n *\n * @name Type.create(userCtx, callback)\n * @param {Object} userCtx\n * @param {Function} callback\n * @api public\n */\n\nType.prototype.create = function (userCtx, callback) {\n    var doc = fieldset.createDefaults(this.fields, {userCtx: userCtx});\n    db.newUUID(100, function (err, uuid) {\n        if (err) {\n            return callback(err);\n        }\n        doc._id = uuid;\n        callback(null, doc);\n    });\n};\n\n/**\n * Calls validation and permissions functions relevant to a document update.\n * This should be called from your app's exported validate_doc_update function\n * if you wish to use kanso Types in you project.\n *\n * Throws on error.\n *\n * @name validate_doc_update(types, newDoc, oldDoc, userCtx)\n * @param {Object} types\n * @param {Object} newDoc\n * @param {Object} oldDoc\n * @param {Object} userCtx\n * @api public\n */\n\nexports.validate_doc_update = function (types, newDoc, oldDoc, userCtx) {\n    var type = (oldDoc && oldDoc.type) || newDoc.type;\n    if (type && types[type]) {\n        var t = types[type];\n        if (!newDoc._deleted) {\n            var validation_errors = t.validate(newDoc);\n            if (validation_errors.length) {\n                var err = validation_errors[0];\n                var msg = err.message || err.toString();\n                if (err.field && err.field.length) {\n                    msg = err.field.join('.') + ': ' + msg;\n                }\n                throw {forbidden: msg};\n            }\n        }\n        var permissions_errors = t.authorize(newDoc, oldDoc, userCtx);\n        if (permissions_errors.length) {\n            var err2 = permissions_errors[0];\n            var msg2 = err2.message || err2.toString();\n            if (err2.field && err2.field.length) {\n                msg2 = err2.field.join('.') + ': ' + msg2;\n            }\n            throw {unauthorized: msg2};\n        }\n        if (t.validate_doc_update) {\n            t.validate_doc_update(newDoc, oldDoc, userCtx);\n        }\n    }\n};\n\n/**\n * This type wraps a reference to a document. The _id attribute is\n * auto-generated as usual; the id of the document being referred to\n * is stored in the 'ref' attribute. In lists, this has the effect of\n * allowing multiple references to a single document.\n */\n\nexports.reference = function (options) {\n    if (!(options.type instanceof Type)) {\n        throw new Error(\n            'reference: The `type` option was not specified,' +\n                'or is not an instance of the `Type` class.'\n        );\n    }\n    var type = new Type('reference', {\n        fields: {\n            ref: fields.string({\n                omit_empty: true,\n                required: !!options.required,\n                widget: widgets.hidden(),\n                permissions: {},\n                default_value: function (req) {\n                    return undefined;\n                }\n            })\n        }\n    });\n    type.type = options.type;\n    return type;\n};\n\n/**\n * This type wraps a reference to a document. The _id attribute is\n * made writeable, and is used to store the id of the document being\n * referred to. In lists, has the effect of constraining each reference\n * to appear no more than once.\n */\n\nexports.uniqueReference = function (options) {\n    if (!(options.type instanceof Type)) {\n        throw new Error(\n            'uniqueReference: The `type` option was not specified,' +\n                'or is not an instance of the `Type` class.'\n        );\n    }\n    var type = new Type('unique_reference', {\n        fields: {}\n    });\n    type.fields._id = fields.string({\n        omit_empty: true,\n        required: !!options.required,\n        widget: widgets.hidden(),\n        permissions: {},\n        default_value: function (req) {\n            return req.uuid;\n        }\n    });\n    type.type = options.type;\n    return type;\n};\n",
        "underscore": "/**\n * Used by Kanso internally, the excellent Underscore.js library is also\n * included in the standard set of CommonJS modules pushed with your app.\n *\n * For more information on the Underscore.js API, see the website:\n * http://documentcloud.github.com/underscore/\n *\n * @module\n */\n\n\n//     Underscore.js 1.1.5\n//     (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.\n//     Underscore is freely distributable under the MIT license.\n//     Portions of Underscore are inspired or borrowed from Prototype,\n//     Oliver Steele's Functional, and John Resig's Micro-Templating.\n//     For all details and documentation:\n//     http://documentcloud.github.com/underscore\n\n(function() {\n\n  // Baseline setup\n  // --------------\n\n  // Establish the root object, `window` in the browser, or `global` on the server.\n  var root = this;\n\n  // Save the previous value of the `_` variable.\n  var previousUnderscore = root._;\n\n  // Establish the object that gets returned to break out of a loop iteration.\n  var breaker = {};\n\n  // Save bytes in the minified (but not gzipped) version:\n  var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;\n\n  // Create quick reference variables for speed access to core prototypes.\n  var slice            = ArrayProto.slice,\n      unshift          = ArrayProto.unshift,\n      toString         = ObjProto.toString,\n      hasOwnProperty   = ObjProto.hasOwnProperty;\n\n  // All **ECMAScript 5** native function implementations that we hope to use\n  // are declared here.\n  var\n    nativeForEach      = ArrayProto.forEach,\n    nativeMap          = ArrayProto.map,\n    nativeReduce       = ArrayProto.reduce,\n    nativeReduceRight  = ArrayProto.reduceRight,\n    nativeFilter       = ArrayProto.filter,\n    nativeEvery        = ArrayProto.every,\n    nativeSome         = ArrayProto.some,\n    nativeIndexOf      = ArrayProto.indexOf,\n    nativeLastIndexOf  = ArrayProto.lastIndexOf,\n    nativeIsArray      = Array.isArray,\n    nativeKeys         = Object.keys,\n    nativeBind         = FuncProto.bind;\n\n  // Create a safe reference to the Underscore object for use below.\n  var _ = function(obj) { return new wrapper(obj); };\n\n  // Export the Underscore object for **CommonJS**, with backwards-compatibility\n  // for the old `require()` API. If we're not in CommonJS, add `_` to the\n  // global object.\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = _;\n    _._ = _;\n  } else {\n    root._ = _;\n  }\n\n  // Current version.\n  _.VERSION = '1.1.5';\n\n  // Collection Functions\n  // --------------------\n\n  // The cornerstone, an `each` implementation, aka `forEach`.\n  // Handles objects implementing `forEach`, arrays, and raw objects.\n  // Delegates to **ECMAScript 5**'s native `forEach` if available.\n  var each = _.each = _.forEach = function(obj, iterator, context) {\n    if (obj == null) return;\n    if (nativeForEach && obj.forEach === nativeForEach) {\n      obj.forEach(iterator, context);\n    } else if (_.isNumber(obj.length)) {\n      for (var i = 0, l = obj.length; i < l; i++) {\n        if (iterator.call(context, obj[i], i, obj) === breaker) return;\n      }\n    } else {\n      for (var key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n          if (iterator.call(context, obj[key], key, obj) === breaker) return;\n        }\n      }\n    }\n  };\n\n  // Return the results of applying the iterator to each element.\n  // Delegates to **ECMAScript 5**'s native `map` if available.\n  _.map = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeMap && obj.map === nativeMap) return obj.map(iterator, context);\n    each(obj, function(value, index, list) {\n      results[results.length] = iterator.call(context, value, index, list);\n    });\n    return results;\n  };\n\n  // **Reduce** builds up a single result from a list of values, aka `inject`,\n  // or `foldl`. Delegates to **ECMAScript 5**'s native `reduce` if available.\n  _.reduce = _.foldl = _.inject = function(obj, iterator, memo, context) {\n    var initial = memo !== void 0;\n    if (obj == null) obj = [];\n    if (nativeReduce && obj.reduce === nativeReduce) {\n      if (context) iterator = _.bind(iterator, context);\n      return initial ? obj.reduce(iterator, memo) : obj.reduce(iterator);\n    }\n    each(obj, function(value, index, list) {\n      if (!initial && index === 0) {\n        memo = value;\n        initial = true;\n      } else {\n        memo = iterator.call(context, memo, value, index, list);\n      }\n    });\n    if (!initial) throw new TypeError(\"Reduce of empty array with no initial value\");\n    return memo;\n  };\n\n  // The right-associative version of reduce, also known as `foldr`.\n  // Delegates to **ECMAScript 5**'s native `reduceRight` if available.\n  _.reduceRight = _.foldr = function(obj, iterator, memo, context) {\n    if (obj == null) obj = [];\n    if (nativeReduceRight && obj.reduceRight === nativeReduceRight) {\n      if (context) iterator = _.bind(iterator, context);\n      return memo !== void 0 ? obj.reduceRight(iterator, memo) : obj.reduceRight(iterator);\n    }\n    var reversed = (_.isArray(obj) ? obj.slice() : _.toArray(obj)).reverse();\n    return _.reduce(reversed, iterator, memo, context);\n  };\n\n  // Return the first value which passes a truth test. Aliased as `detect`.\n  _.find = _.detect = function(obj, iterator, context) {\n    var result;\n    any(obj, function(value, index, list) {\n      if (iterator.call(context, value, index, list)) {\n        result = value;\n        return true;\n      }\n    });\n    return result;\n  };\n\n  // Return all the elements that pass a truth test.\n  // Delegates to **ECMAScript 5**'s native `filter` if available.\n  // Aliased as `select`.\n  _.filter = _.select = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeFilter && obj.filter === nativeFilter) return obj.filter(iterator, context);\n    each(obj, function(value, index, list) {\n      if (iterator.call(context, value, index, list)) results[results.length] = value;\n    });\n    return results;\n  };\n\n  // Return all the elements for which a truth test fails.\n  _.reject = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    each(obj, function(value, index, list) {\n      if (!iterator.call(context, value, index, list)) results[results.length] = value;\n    });\n    return results;\n  };\n\n  // Determine whether all of the elements match a truth test.\n  // Delegates to **ECMAScript 5**'s native `every` if available.\n  // Aliased as `all`.\n  _.every = _.all = function(obj, iterator, context) {\n    iterator = iterator || _.identity;\n    var result = true;\n    if (obj == null) return result;\n    if (nativeEvery && obj.every === nativeEvery) return obj.every(iterator, context);\n    each(obj, function(value, index, list) {\n      if (!(result = result && iterator.call(context, value, index, list))) return breaker;\n    });\n    return result;\n  };\n\n  // Determine if at least one element in the object matches a truth test.\n  // Delegates to **ECMAScript 5**'s native `some` if available.\n  // Aliased as `any`.\n  var any = _.some = _.any = function(obj, iterator, context) {\n    iterator = iterator || _.identity;\n    var result = false;\n    if (obj == null) return result;\n    if (nativeSome && obj.some === nativeSome) return obj.some(iterator, context);\n    each(obj, function(value, index, list) {\n      if (result = iterator.call(context, value, index, list)) return breaker;\n    });\n    return result;\n  };\n\n  // Determine if a given value is included in the array or object using `===`.\n  // Aliased as `contains`.\n  _.include = _.contains = function(obj, target) {\n    var found = false;\n    if (obj == null) return found;\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) return obj.indexOf(target) != -1;\n    any(obj, function(value) {\n      if (found = value === target) return true;\n    });\n    return found;\n  };\n\n  // Invoke a method (with arguments) on every item in a collection.\n  _.invoke = function(obj, method) {\n    var args = slice.call(arguments, 2);\n    return _.map(obj, function(value) {\n      return (method ? value[method] : value).apply(value, args);\n    });\n  };\n\n  // Convenience version of a common use case of `map`: fetching a property.\n  _.pluck = function(obj, key) {\n    return _.map(obj, function(value){ return value[key]; });\n  };\n\n  // Return the maximum element or (element-based computation).\n  _.max = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj)) return Math.max.apply(Math, obj);\n    var result = {computed : -Infinity};\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      computed >= result.computed && (result = {value : value, computed : computed});\n    });\n    return result.value;\n  };\n\n  // Return the minimum element (or element-based computation).\n  _.min = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj)) return Math.min.apply(Math, obj);\n    var result = {computed : Infinity};\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      computed < result.computed && (result = {value : value, computed : computed});\n    });\n    return result.value;\n  };\n\n  // Sort the object's values by a criterion produced by an iterator.\n  _.sortBy = function(obj, iterator, context) {\n    return _.pluck(_.map(obj, function(value, index, list) {\n      return {\n        value : value,\n        criteria : iterator.call(context, value, index, list)\n      };\n    }).sort(function(left, right) {\n      var a = left.criteria, b = right.criteria;\n      return a < b ? -1 : a > b ? 1 : 0;\n    }), 'value');\n  };\n\n  // Use a comparator function to figure out at what index an object should\n  // be inserted so as to maintain order. Uses binary search.\n  _.sortedIndex = function(array, obj, iterator) {\n    iterator = iterator || _.identity;\n    var low = 0, high = array.length;\n    while (low < high) {\n      var mid = (low + high) >> 1;\n      iterator(array[mid]) < iterator(obj) ? low = mid + 1 : high = mid;\n    }\n    return low;\n  };\n\n  // Safely convert anything iterable into a real, live array.\n  _.toArray = function(iterable) {\n    if (!iterable)                return [];\n    if (iterable.toArray)         return iterable.toArray();\n    if (_.isArray(iterable))      return iterable;\n    if (_.isArguments(iterable))  return slice.call(iterable);\n    return _.values(iterable);\n  };\n\n  // Return the number of elements in an object.\n  _.size = function(obj) {\n    return _.toArray(obj).length;\n  };\n\n  // Array Functions\n  // ---------------\n\n  // Get the first element of an array. Passing **n** will return the first N\n  // values in the array. Aliased as `head`. The **guard** check allows it to work\n  // with `_.map`.\n  _.first = _.head = function(array, n, guard) {\n    return (n != null) && !guard ? slice.call(array, 0, n) : array[0];\n  };\n\n  // Returns everything but the first entry of the array. Aliased as `tail`.\n  // Especially useful on the arguments object. Passing an **index** will return\n  // the rest of the values in the array from that index onward. The **guard**\n  // check allows it to work with `_.map`.\n  _.rest = _.tail = function(array, index, guard) {\n    return slice.call(array, (index == null) || guard ? 1 : index);\n  };\n\n  // Get the last element of an array.\n  _.last = function(array) {\n    return array[array.length - 1];\n  };\n\n  // Trim out all falsy values from an array.\n  _.compact = function(array) {\n    return _.filter(array, function(value){ return !!value; });\n  };\n\n  // Return a completely flattened version of an array.\n  _.flatten = function(array) {\n    return _.reduce(array, function(memo, value) {\n      if (_.isArray(value)) return memo.concat(_.flatten(value));\n      memo[memo.length] = value;\n      return memo;\n    }, []);\n  };\n\n  // Return a version of the array that does not contain the specified value(s).\n  _.without = function(array) {\n    var values = slice.call(arguments, 1);\n    return _.filter(array, function(value){ return !_.include(values, value); });\n  };\n\n  // Produce a duplicate-free version of the array. If the array has already\n  // been sorted, you have the option of using a faster algorithm.\n  // Aliased as `unique`.\n  _.uniq = _.unique = function(array, isSorted) {\n    return _.reduce(array, function(memo, el, i) {\n      if (0 == i || (isSorted === true ? _.last(memo) != el : !_.include(memo, el))) memo[memo.length] = el;\n      return memo;\n    }, []);\n  };\n\n  // Produce an array that contains every item shared between all the\n  // passed-in arrays.\n  _.intersect = function(array) {\n    var rest = slice.call(arguments, 1);\n    return _.filter(_.uniq(array), function(item) {\n      return _.every(rest, function(other) {\n        return _.indexOf(other, item) >= 0;\n      });\n    });\n  };\n\n  // Zip together multiple lists into a single array -- elements that share\n  // an index go together.\n  _.zip = function() {\n    var args = slice.call(arguments);\n    var length = _.max(_.pluck(args, 'length'));\n    var results = new Array(length);\n    for (var i = 0; i < length; i++) results[i] = _.pluck(args, \"\" + i);\n    return results;\n  };\n\n  // If the browser doesn't supply us with indexOf (I'm looking at you, **MSIE**),\n  // we need this function. Return the position of the first occurrence of an\n  // item in an array, or -1 if the item is not included in the array.\n  // Delegates to **ECMAScript 5**'s native `indexOf` if available.\n  // If the array is large and already in sort order, pass `true`\n  // for **isSorted** to use binary search.\n  _.indexOf = function(array, item, isSorted) {\n    if (array == null) return -1;\n    var i, l;\n    if (isSorted) {\n      i = _.sortedIndex(array, item);\n      return array[i] === item ? i : -1;\n    }\n    if (nativeIndexOf && array.indexOf === nativeIndexOf) return array.indexOf(item);\n    for (i = 0, l = array.length; i < l; i++) if (array[i] === item) return i;\n    return -1;\n  };\n\n\n  // Delegates to **ECMAScript 5**'s native `lastIndexOf` if available.\n  _.lastIndexOf = function(array, item) {\n    if (array == null) return -1;\n    if (nativeLastIndexOf && array.lastIndexOf === nativeLastIndexOf) return array.lastIndexOf(item);\n    var i = array.length;\n    while (i--) if (array[i] === item) return i;\n    return -1;\n  };\n\n  // Generate an integer Array containing an arithmetic progression. A port of\n  // the native Python `range()` function. See\n  // [the Python documentation](http://docs.python.org/library/functions.html#range).\n  _.range = function(start, stop, step) {\n    if (arguments.length <= 1) {\n      stop = start || 0;\n      start = 0;\n    }\n    step = arguments[2] || 1;\n\n    var len = Math.max(Math.ceil((stop - start) / step), 0);\n    var idx = 0;\n    var range = new Array(len);\n\n    while(idx < len) {\n      range[idx++] = start;\n      start += step;\n    }\n\n    return range;\n  };\n\n  // Function (ahem) Functions\n  // ------------------\n\n  // Create a function bound to a given object (assigning `this`, and arguments,\n  // optionally). Binding with arguments is also known as `curry`.\n  // Delegates to **ECMAScript 5**'s native `Function.bind` if available.\n  _.bind = function(func, obj) {\n    if (nativeBind && func.bind === nativeBind) return func.bind.apply(func, slice.call(arguments, 1));\n    var args = slice.call(arguments, 2);\n    return function() {\n      return func.apply(obj, args.concat(slice.call(arguments)));\n    };\n  };\n\n  // Bind all of an object's methods to that object. Useful for ensuring that\n  // all callbacks defined on an object belong to it.\n  _.bindAll = function(obj) {\n    var funcs = slice.call(arguments, 1);\n    if (funcs.length == 0) funcs = _.functions(obj);\n    each(funcs, function(f) { obj[f] = _.bind(obj[f], obj); });\n    return obj;\n  };\n\n  // Memoize an expensive function by storing its results.\n  _.memoize = function(func, hasher) {\n    var memo = {};\n    hasher = hasher || _.identity;\n    return function() {\n      var key = hasher.apply(this, arguments);\n      return hasOwnProperty.call(memo, key) ? memo[key] : (memo[key] = func.apply(this, arguments));\n    };\n  };\n\n  // Delays a function for the given number of milliseconds, and then calls\n  // it with the arguments supplied.\n  _.delay = function(func, wait) {\n    var args = slice.call(arguments, 2);\n    return setTimeout(function(){ return func.apply(func, args); }, wait);\n  };\n\n  // Defers a function, scheduling it to run after the current call stack has\n  // cleared.\n  _.defer = function(func) {\n    return _.delay.apply(_, [func, 1].concat(slice.call(arguments, 1)));\n  };\n\n  // Internal function used to implement `_.throttle` and `_.debounce`.\n  var limit = function(func, wait, debounce) {\n    var timeout;\n    return function() {\n      var context = this, args = arguments;\n      var throttler = function() {\n        timeout = null;\n        func.apply(context, args);\n      };\n      if (debounce) clearTimeout(timeout);\n      if (debounce || !timeout) timeout = setTimeout(throttler, wait);\n    };\n  };\n\n  // Returns a function, that, when invoked, will only be triggered at most once\n  // during a given window of time.\n  _.throttle = function(func, wait) {\n    return limit(func, wait, false);\n  };\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds.\n  _.debounce = function(func, wait) {\n    return limit(func, wait, true);\n  };\n\n  // Returns a function that will be executed at most one time, no matter how\n  // often you call it. Useful for lazy initialization.\n  _.once = function(func) {\n    var ran = false, memo;\n    return function() {\n      if (ran) return memo;\n      ran = true;\n      return memo = func.apply(this, arguments);\n    };\n  };\n\n  // Returns the first function passed as an argument to the second,\n  // allowing you to adjust arguments, run code before and after, and\n  // conditionally execute the original function.\n  _.wrap = function(func, wrapper) {\n    return function() {\n      var args = [func].concat(slice.call(arguments));\n      return wrapper.apply(this, args);\n    };\n  };\n\n  // Returns a function that is the composition of a list of functions, each\n  // consuming the return value of the function that follows.\n  _.compose = function() {\n    var funcs = slice.call(arguments);\n    return function() {\n      var args = slice.call(arguments);\n      for (var i=funcs.length-1; i >= 0; i--) {\n        args = [funcs[i].apply(this, args)];\n      }\n      return args[0];\n    };\n  };\n\n  // Object Functions\n  // ----------------\n\n  // Retrieve the names of an object's properties.\n  // Delegates to **ECMAScript 5**'s native `Object.keys`\n  _.keys = nativeKeys || function(obj) {\n    if (obj !== Object(obj)) throw new TypeError('Invalid object');\n    var keys = [];\n    for (var key in obj) if (hasOwnProperty.call(obj, key)) keys[keys.length] = key;\n    return keys;\n  };\n\n  // Retrieve the values of an object's properties.\n  _.values = function(obj) {\n    return _.map(obj, _.identity);\n  };\n\n  // Return a sorted list of the function names available on the object.\n  // Aliased as `methods`\n  _.functions = _.methods = function(obj) {\n    return _.filter(_.keys(obj), function(key){ return _.isFunction(obj[key]); }).sort();\n  };\n\n  // Extend a given object with all the properties in passed-in object(s).\n  _.extend = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      for (var prop in source) obj[prop] = source[prop];\n    });\n    return obj;\n  };\n\n  // Fill in a given object with default properties.\n  _.defaults = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      for (var prop in source) if (obj[prop] == null) obj[prop] = source[prop];\n    });\n    return obj;\n  };\n\n  // Create a (shallow-cloned) duplicate of an object.\n  _.clone = function(obj) {\n    return _.isArray(obj) ? obj.slice() : _.extend({}, obj);\n  };\n\n  // Invokes interceptor with the obj, and then returns obj.\n  // The primary purpose of this method is to \"tap into\" a method chain, in\n  // order to perform operations on intermediate results within the chain.\n  _.tap = function(obj, interceptor) {\n    interceptor(obj);\n    return obj;\n  };\n\n  // Perform a deep comparison to check if two objects are equal.\n  _.isEqual = function(a, b) {\n    // Check object identity.\n    if (a === b) return true;\n    // Different types?\n    var atype = typeof(a), btype = typeof(b);\n    if (atype != btype) return false;\n    // Basic equality test (watch out for coercions).\n    if (a == b) return true;\n    // One is falsy and the other truthy.\n    if ((!a && b) || (a && !b)) return false;\n    // Unwrap any wrapped objects.\n    if (a._chain) a = a._wrapped;\n    if (b._chain) b = b._wrapped;\n    // One of them implements an isEqual()?\n    if (a.isEqual) return a.isEqual(b);\n    // Check dates' integer values.\n    if (_.isDate(a) && _.isDate(b)) return a.getTime() === b.getTime();\n    // Both are NaN?\n    if (_.isNaN(a) && _.isNaN(b)) return false;\n    // Compare regular expressions.\n    if (_.isRegExp(a) && _.isRegExp(b))\n      return a.source     === b.source &&\n             a.global     === b.global &&\n             a.ignoreCase === b.ignoreCase &&\n             a.multiline  === b.multiline;\n    // If a is not an object by this point, we can't handle it.\n    if (atype !== 'object') return false;\n    // Check for different array lengths before comparing contents.\n    if (a.length && (a.length !== b.length)) return false;\n    // Nothing else worked, deep compare the contents.\n    var aKeys = _.keys(a), bKeys = _.keys(b);\n    // Different object sizes?\n    if (aKeys.length != bKeys.length) return false;\n    // Recursive comparison of contents.\n    for (var key in a) if (!(key in b) || !_.isEqual(a[key], b[key])) return false;\n    return true;\n  };\n\n  // Is a given array or object empty?\n  _.isEmpty = function(obj) {\n    if (_.isArray(obj) || _.isString(obj)) return obj.length === 0;\n    for (var key in obj) if (hasOwnProperty.call(obj, key)) return false;\n    return true;\n  };\n\n  // Is a given value a DOM element?\n  _.isElement = function(obj) {\n    return !!(obj && obj.nodeType == 1);\n  };\n\n  // Is a given value an array?\n  // Delegates to ECMA5's native Array.isArray\n  _.isArray = nativeIsArray || function(obj) {\n    return toString.call(obj) === '[object Array]';\n  };\n\n  // Is a given variable an arguments object?\n  _.isArguments = function(obj) {\n    return !!(obj && hasOwnProperty.call(obj, 'callee'));\n  };\n\n  // Is a given value a function?\n  _.isFunction = function(obj) {\n    return !!(obj && obj.constructor && obj.call && obj.apply);\n  };\n\n  // Is a given value a string?\n  _.isString = function(obj) {\n    return !!(obj === '' || (obj && obj.charCodeAt && obj.substr));\n  };\n\n  // Is a given value a number?\n  _.isNumber = function(obj) {\n    return !!(obj === 0 || (obj && obj.toExponential && obj.toFixed));\n  };\n\n  // Is the given value `NaN`? `NaN` happens to be the only value in JavaScript\n  // that does not equal itself.\n  _.isNaN = function(obj) {\n    return obj !== obj;\n  };\n\n  // Is a given value a boolean?\n  _.isBoolean = function(obj) {\n    return obj === true || obj === false;\n  };\n\n  // Is a given value a date?\n  _.isDate = function(obj) {\n    return !!(obj && obj.getTimezoneOffset && obj.setUTCFullYear);\n  };\n\n  // Is the given value a regular expression?\n  _.isRegExp = function(obj) {\n    return !!(obj && obj.test && obj.exec && (obj.ignoreCase || obj.ignoreCase === false));\n  };\n\n  // Is a given value equal to null?\n  _.isNull = function(obj) {\n    return obj === null;\n  };\n\n  // Is a given variable undefined?\n  _.isUndefined = function(obj) {\n    return obj === void 0;\n  };\n\n  // Utility Functions\n  // -----------------\n\n  // Run Underscore.js in *noConflict* mode, returning the `_` variable to its\n  // previous owner. Returns a reference to the Underscore object.\n  _.noConflict = function() {\n    root._ = previousUnderscore;\n    return this;\n  };\n\n  // Keep the identity function around for default iterators.\n  _.identity = function(value) {\n    return value;\n  };\n\n  // Run a function **n** times.\n  _.times = function (n, iterator, context) {\n    for (var i = 0; i < n; i++) iterator.call(context, i);\n  };\n\n  // Add your own custom functions to the Underscore object, ensuring that\n  // they're correctly added to the OOP wrapper as well.\n  _.mixin = function(obj) {\n    each(_.functions(obj), function(name){\n      addToWrapper(name, _[name] = obj[name]);\n    });\n  };\n\n  // Generate a unique integer id (unique within the entire client session).\n  // Useful for temporary DOM ids.\n  var idCounter = 0;\n  _.uniqueId = function(prefix) {\n    var id = idCounter++;\n    return prefix ? prefix + id : id;\n  };\n\n  // By default, Underscore uses ERB-style template delimiters, change the\n  // following template settings to use alternative delimiters.\n  _.templateSettings = {\n    evaluate    : /<%([\\s\\S]+?)%>/g,\n    interpolate : /<%=([\\s\\S]+?)%>/g\n  };\n\n  // JavaScript micro-templating, similar to John Resig's implementation.\n  // Underscore templating handles arbitrary delimiters, preserves whitespace,\n  // and correctly escapes quotes within interpolated code.\n  _.template = function(str, data) {\n    var c  = _.templateSettings;\n    var tmpl = 'var __p=[],print=function(){__p.push.apply(__p,arguments);};' +\n      'with(obj||{}){__p.push(\\'' +\n      str.replace(/\\\\/g, '\\\\\\\\')\n         .replace(/'/g, \"\\\\'\")\n         .replace(c.interpolate, function(match, code) {\n           return \"',\" + code.replace(/\\\\'/g, \"'\") + \",'\";\n         })\n         .replace(c.evaluate || null, function(match, code) {\n           return \"');\" + code.replace(/\\\\'/g, \"'\")\n                              .replace(/[\\r\\n\\t]/g, ' ') + \"__p.push('\";\n         })\n         .replace(/\\r/g, '\\\\r')\n         .replace(/\\n/g, '\\\\n')\n         .replace(/\\t/g, '\\\\t')\n         + \"');}return __p.join('');\";\n    var func = new Function('obj', tmpl);\n    return data ? func(data) : func;\n  };\n\n  // The OOP Wrapper\n  // ---------------\n\n  // If Underscore is called as a function, it returns a wrapped object that\n  // can be used OO-style. This wrapper holds altered versions of all the\n  // underscore functions. Wrapped objects may be chained.\n  var wrapper = function(obj) { this._wrapped = obj; };\n\n  // Expose `wrapper.prototype` as `_.prototype`\n  _.prototype = wrapper.prototype;\n\n  // Helper function to continue chaining intermediate results.\n  var result = function(obj, chain) {\n    return chain ? _(obj).chain() : obj;\n  };\n\n  // A method to easily add functions to the OOP wrapper.\n  var addToWrapper = function(name, func) {\n    wrapper.prototype[name] = function() {\n      var args = slice.call(arguments);\n      unshift.call(args, this._wrapped);\n      return result(func.apply(_, args), this._chain);\n    };\n  };\n\n  // Add all of the Underscore functions to the wrapper object.\n  _.mixin(_);\n\n  // Add all mutator Array functions to the wrapper.\n  each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {\n    var method = ArrayProto[name];\n    wrapper.prototype[name] = function() {\n      method.apply(this._wrapped, arguments);\n      return result(this._wrapped, this._chain);\n    };\n  });\n\n  // Add all accessor Array functions to the wrapper.\n  each(['concat', 'join', 'slice'], function(name) {\n    var method = ArrayProto[name];\n    wrapper.prototype[name] = function() {\n      return result(method.apply(this._wrapped, arguments), this._chain);\n    };\n  });\n\n  // Start chaining a wrapped Underscore object.\n  wrapper.prototype.chain = function() {\n    this._chain = true;\n    return this;\n  };\n\n  // Extracts the result from a wrapped and chained object.\n  wrapper.prototype.value = function() {\n    return this._wrapped;\n  };\n\n})();\n",
        "url": "/**\n * URL functions ported from node.js to work in CouchDB and the browser.\n * This module is used internally by Kanso, although you can use it in your\n * apps too if you find the functions useful.\n *\n * @module\n */\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n/**\n * From node.js v0.2.6\n */\n\nvar path = require('kanso/path'),\n    querystring = require('kanso/querystring'),\n    _ = require('kanso/underscore')._;\n\n\n// define these here so at least they only have to be compiled once on the\n// first module load.\nvar protocolPattern = /^([a-z0-9]+:)/,\n    portPattern = /:[0-9]+$/,\n    nonHostChars = [\"/\", \"?\", \";\", \"#\"],\n    hostlessProtocol = {\n        \"file\": true,\n        \"file:\": true\n    },\n    slashedProtocol = {\n        \"http\": true,\n        \"https\": true,\n        \"ftp\": true,\n        \"gopher\": true,\n        \"file\": true,\n        \"http:\": true,\n        \"https:\": true,\n        \"ftp:\": true,\n        \"gopher:\": true,\n        \"file:\": true\n    };\n\n\nfunction parseHost(host) {\n    var out = {};\n    var at = host.indexOf(\"@\");\n    if (at !== -1) {\n        out.auth = host.substr(0, at);\n        host = host.substr(at + 1); // drop the @\n    }\n    var port = portPattern.exec(host);\n    if (port) {\n        port = port[0];\n        out.port = port.substr(1);\n        host = host.substr(0, host.length - port.length);\n    }\n    if (host) {\n        out.hostname = host;\n    }\n    return out;\n}\n\n/**\n * Take a URL string, and return an object. Pass true as the second argument\n * to also parse the query string using the querystring module.\n *\n * @name parse(url, [parseQueryString, slashesDenoteHost])\n * @param {String} url\n * @param {Boolean} parseQueryString\n * @param {Boolean} slashesDenoteHost\n * @returns Object\n * @api public\n */\n\nexports.parse = function (url, parseQueryString, slashesDenoteHost) {\n    if (url && typeof(url) === \"object\" && url.href) {\n        return url;\n    }\n\n    var out = { href : url },\n        rest = url;\n\n    var proto = protocolPattern.exec(rest);\n    if (proto) {\n        proto = proto[0];\n        out.protocol = proto;\n        rest = rest.substr(proto.length);\n    }\n\n    // figure out if it's got a host\n    // user@server is *always* interpreted as a hostname, and url\n    // resolution will treat //foo/bar as host=foo,path=bar because that's\n    // how the browser resolves relative URLs.\n    var slashes;\n    var re = new RegExp('^\\\\/\\\\/[^@\\\\/]+@[^@\\\\/]+');\n    if (slashesDenoteHost || proto || rest.match(re)) {\n        slashes = rest.substr(0, 2) === \"//\";\n        if (slashes && !(proto && hostlessProtocol[proto])) {\n            rest = rest.substr(2);\n            out.slashes = true;\n        }\n    }\n    if (!hostlessProtocol[proto] && (slashes || (proto && !slashedProtocol[proto]))) {\n        // there's a hostname.\n        // the first instance of /, ?, ;, or # ends the host.\n        // don't enforce full RFC correctness, just be unstupid about it.\n        var firstNonHost = -1;\n        for (var i = 0, l = nonHostChars.length; i < l; i++) {\n            var index = rest.indexOf(nonHostChars[i]);\n            if (index !== -1 && (firstNonHost < 0 || index < firstNonHost)) {\n                firstNonHost = index;\n            }\n        }\n        if (firstNonHost !== -1) {\n            out.host = rest.substr(0, firstNonHost);\n            rest = rest.substr(firstNonHost);\n        } else {\n            out.host = rest;\n            rest = \"\";\n        }\n\n        // pull out the auth and port.\n        var p = parseHost(out.host);\n        var keys = _.keys(p);\n        for (var j = 0, l2 = keys.length; j < l2; j++) {\n            var key = keys[j];\n            out[key] = p[key];\n        }\n        // we've indicated that there is a hostname, so even if it's empty, it has to be present.\n        out.hostname = out.hostname || \"\";\n    }\n\n    // now rest is set to the post-host stuff.\n    // chop off from the tail first.\n    var hash = rest.indexOf(\"#\");\n    if (hash !== -1) {\n        // got a fragment string.\n        out.hash = rest.substr(hash);\n        rest = rest.slice(0, hash);\n    }\n    var qm = rest.indexOf(\"?\");\n    if (qm !== -1) {\n        out.search = rest.substr(qm);\n        out.query = rest.substr(qm + 1);\n        if (parseQueryString) {\n            out.query = querystring.parse(out.query);\n        }\n        rest = rest.slice(0, qm);\n    }\n    if (rest) {\n        out.pathname = rest;\n    }\n\n    return out;\n};\n\n/**\n * Take a parsed URL object, and return a formatted URL string.\n *\n * @name format(obj)\n * @param {Object} obj\n * @api public\n */\n\n// format a parsed object into a url string\nexports.format = function (obj) {\n    // ensure it's an object, and not a string url. If it's an obj, this is a no-op.\n    // this way, you can call url_format() on strings to clean up potentially wonky urls.\n    if (typeof(obj) === \"string\") {\n        obj = exports.parse(obj);\n    }\n\n    var protocol = obj.protocol || \"\",\n        host = (obj.host !== undefined) ? obj.host\n            : obj.hostname !== undefined ? ((obj.auth ? obj.auth + \"@\" : \"\") + obj.hostname + (obj.port ? \":\" + obj.port : \"\"))\n            : false,\n        pathname = obj.pathname || \"\",\n        search = obj.search || (\n                obj.query && (\"?\" + (typeof(obj.query) === \"object\" ? querystring.stringify(obj.query) : String(obj.query)))\n                ) || \"\",\n        hash = obj.hash || \"\";\n\n    if (protocol && protocol.substr(-1) !== \":\") {\n        protocol += \":\";\n    }\n\n    // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n    // unless they had them to begin with.\n    if (obj.slashes || (!protocol || slashedProtocol[protocol]) && host !== false) {\n        host = \"//\" + (host || \"\");\n        if (pathname && pathname.charAt(0) !== \"/\") {\n            pathname = \"/\" + pathname;\n        }\n    }\n    else if (!host) {\n        host = \"\";\n    }\n\n    if (hash && hash.charAt(0) !== \"#\") {\n        hash = \"#\" + hash;\n    }\n    if (search && search.charAt(0) !== \"?\") {\n        search = \"?\" + search;\n    }\n\n    return protocol + host + pathname + search + hash;\n};\n\n/**\n * Take a base URL, and a href URL, and resolve them as a browser would for\n * an anchor tag.\n *\n * @name resolve(source, relative)\n * @param {String} source\n * @param {String} relative\n * @returns {String}\n * @api public\n */\n\nexports.resolve = function (source, relative) {\n    return exports.format(exports.resolveObject(source, relative));\n};\n\nexports.resolveObject = function (source, relative) {\n    if (!source) {\n        return relative;\n    }\n    var relPath;\n\n    source = exports.parse(exports.format(source), false, true);\n    relative = exports.parse(exports.format(relative), false, true);\n\n    // hash is always overridden, no matter what.\n    source.hash = relative.hash;\n\n    if (relative.href === \"\") {\n        return source;\n    }\n\n    // hrefs like //foo/bar always cut to the protocol.\n    if (relative.slashes && !relative.protocol) {\n        relative.protocol = source.protocol;\n        return relative;\n    }\n\n    if (relative.protocol && relative.protocol !== source.protocol) {\n        // if it's a known url protocol, then changing the protocol does weird things\n        // first, if it's not file:, then we MUST have a host, and if there was a path\n        // to begin with, then we MUST have a path.\n        // if it is file:, then the host is dropped, because that's known to be hostless.\n        // anything else is assumed to be absolute.\n\n        if (!slashedProtocol[relative.protocol]) {\n            return relative;\n        }\n\n        source.protocol = relative.protocol;\n        if (!relative.host && !hostlessProtocol[relative.protocol]) {\n            relPath = (relative.pathname || \"\").split(\"/\");\n            while (relPath.length && !(relative.host = relPath.shift())) {}\n            if (!relative.host) {\n                relative.host = \"\";\n            }\n            if (relPath[0] !== \"\") {\n                relPath.unshift(\"\");\n            }\n            if (relPath.length < 2) {\n                relPath.unshift(\"\");\n            }\n            relative.pathname = relPath.join(\"/\");\n        }\n        source.pathname = relative.pathname;\n        source.search = relative.search;\n        source.query = relative.query;\n        source.host = relative.host || \"\";\n        delete source.auth;\n        delete source.hostname;\n        source.port = relative.port;\n        return source;\n    }\n\n    var isSourceAbs = (source.pathname && source.pathname.charAt(0) === \"/\"),\n        isRelAbs = (relative.host !== undefined || relative.pathname && relative.pathname.charAt(0) === \"/\"),\n        mustEndAbs = (isRelAbs || isSourceAbs || (source.host && relative.pathname)),\n        removeAllDots = mustEndAbs,\n        srcPath = source.pathname && source.pathname.split(\"/\") || [],\n        psychotic = source.protocol && !slashedProtocol[source.protocol] && source.host !== undefined;\n    relPath = relative.pathname && relative.pathname.split(\"/\") || [];\n\n    // if the url is a non-slashed url, then relative links like ../.. should be able\n    // to crawl up to the hostname, as well.  This is strange.\n    // source.protocol has already been set by now.\n    // Later on, put the first path part into the host field.\n    if (psychotic) {\n\n        delete source.hostname;\n        delete source.auth;\n        delete source.port;\n        if (source.host) {\n            if (srcPath[0] === \"\") {\n                srcPath[0] = source.host;\n            }\n            else {\n                srcPath.unshift(source.host);\n            }\n        }\n        delete source.host;\n\n        if (relative.protocol) {\n            delete relative.hostname;\n            delete relative.auth;\n            delete relative.port;\n            if (relative.host) {\n                if (relPath[0] === \"\") {\n                    relPath[0] = relative.host;\n                }\n                else {\n                    relPath.unshift(relative.host);\n                }\n            }\n            delete relative.host;\n        }\n        mustEndAbs = mustEndAbs && (relPath[0] === \"\" || srcPath[0] === \"\");\n    }\n\n    if (isRelAbs) {\n        // it's absolute.\n        source.host = (relative.host || relative.host === \"\") ? relative.host : source.host;\n        source.search = relative.search;\n        source.query = relative.query;\n        srcPath = relPath;\n        // fall through to the dot-handling below.\n    }\n    else if (relPath.length) {\n        // it's relative\n        // throw away the existing file, and take the new path instead.\n        if (!srcPath) {\n            srcPath = [];\n        }\n        srcPath.pop();\n        srcPath = srcPath.concat(relPath);\n        source.search = relative.search;\n        source.query = relative.query;\n    }\n    else if (\"search\" in relative) {\n        // just pull out the search.\n        // like href=\"?foo\".\n        // Put this after the other two cases because it simplifies the booleans\n        if (psychotic) {\n            source.host = srcPath.shift();\n        }\n        source.search = relative.search;\n        source.query = relative.query;\n        return source;\n    }\n    if (!srcPath.length) {\n        // no path at all.  easy.\n        // we've already handled the other stuff above.\n        delete source.pathname;\n        return source;\n    }\n\n    // resolve dots.\n    // if a url ENDs in . or .., then it must get a trailing slash.\n    // however, if it ends in anything else non-slashy, then it must NOT get a trailing slash.\n    var last = srcPath.slice(-1)[0];\n    var hasTrailingSlash = ((source.host || relative.host) && (last === \".\" || last === \"..\") || last === \"\");\n\n    // Figure out if this has to end up as an absolute url, or should continue to be relative.\n    srcPath = path.normalizeArray(srcPath, true);\n    if (srcPath.length === 1 && srcPath[0] === \".\") {\n        srcPath = [];\n    }\n    if (mustEndAbs || removeAllDots) {\n        // all dots must go.\n        var dirs = [];\n        srcPath.forEach(function (dir, i) {\n            if (dir === \"..\") {\n                dirs.pop();\n            }\n            else if (dir !== \".\") {\n                dirs.push(dir);\n            }\n        });\n\n        if (mustEndAbs && dirs[0] !== \"\") {\n            dirs.unshift(\"\");\n        }\n        srcPath = dirs;\n    }\n    if (hasTrailingSlash && (srcPath.length < 2 || srcPath.slice(-1)[0] !== \"\")) {\n        srcPath.push(\"\");\n    }\n\n    // put the host back\n    if (psychotic) {\n        source.host = srcPath[0] === \"\" ? \"\" : srcPath.shift();\n    }\n\n    mustEndAbs = mustEndAbs || (source.host && srcPath.length);\n\n    if (mustEndAbs && srcPath[0] !== \"\") {\n        srcPath.unshift(\"\");\n    }\n\n    source.pathname = srcPath.join(\"/\");\n\n    return source;\n};\n",
        "utils": "/*global window: false, __kansojs_current_request: true*/\n\n\n/**\n * General utility functions used by Kanso. Some functions were moved here from\n * other modules (such as core), to avoid a circular dependency bug in CouchDB.\n *\n * This module also stores some useful properties such as 'isBrowser', which is\n * true if the code is running in a browser environment, and 'initial_hit' which\n * is set to true when a page is first requested from CouchDB (and set to false\n * for subsequent requests).\n *\n * @module\n */\n\n/**\n * Module dependencies\n */\n\nvar settings = require('./settings'), // settings module is auto-generated\n    events = require('./events'),\n    _ = require('./underscore')._;\n\n\n/**\n * Some functions calculate results differently depending on the execution\n * environment. The isBrowser value is used to set the correct environment\n * for these functions, and is only exported to make unit testing easier.\n */\n\nexports.isBrowser = function () {\n    return (typeof(window) !== 'undefined');\n};\n\n/**\n * Keeps track of the last *triggered* request. This is to avoid a race\n * condition where two link clicks in quick succession can cause the rendered\n * page to not match the current URL. If the first link's document or view takes\n * longer to return than the second, the URL was updated for the second link\n * click but the page for the first link will render last, overwriting the\n * correct page. Now, callbacks for fetching documents and views check against\n * this value to see if they should continue rendering the result or not.\n */\n\nexports.currentRequest = function (v) {\n    if (v) {\n        __kansojs_current_request = v;\n    } else if (typeof(__kansojs_current_request) === 'undefined') {\n        __kansojs_current_request = null;\n    }\n    return __kansojs_current_request;\n};\n\n// make sure currentRequest() always provided the latest session information\nevents.on('sessionChange', function (userCtx, req) {\n    var curr_req = exports.currentRequest();\n    if (curr_req) {\n        curr_req.userCtx = userCtx;\n        exports.currentRequest(curr_req);\n    }\n});\n\n/**\n * This is because the first page hit also triggers kanso to handle the url\n * client-side. Knowing it is the first page being loaded means we can stop\n * the pageTracker code from submitting the URL twice. Exported because this\n * might be useful information to other modules, it should not be modified\n * by them.\n */\n\n// TODO: this was moved to this module from core.js to avoid a circular\n// dependency between core.js and session.js\n\nexports.initial_hit = true;\n\n/**\n * Used to store userCtx, periodically updated like on session.login and\n * session.logout.\n */\n\n// TODO: added to utils to avoid circular dependency bug in couchdb\n\nexports.userCtx = null;\n\n/**\n * Caches extended session info (like the current authentication db) after\n * a call to session.info\n */\nexports.session = null;\n\n/**\n * This is used to make unit testing in the browser easier.\n * Because it can be overridden without actually changing the window's location.\n * (and navigating away from the test suite)\n */\n\nexports.getWindowLocation = function () {\n    return window.location;\n};\n\n/**\n * Returns the path to prefix to any URLs. When running behind a\n * virtual host, there is nothing to prefix URLs with. When accessing the\n * app directly, URLs need to be prefixed with /db/_design/appname/_rewrite.\n *\n * The request object argument is only required when run server-side, but its\n * a good idea to include it whenever you call getBaseURL.\n *\n * @name getBaseURL(req)\n * @param {Object} req\n * @returns {String}\n * @api public\n */\n\n// TODO: this was moved to this module from core.js to avoid a circular\n// dependency between core.js and db.js ...once circular dependencies in\n// couchdb's commonjs implementation are fixed it can be moved back into\n// core.js. For now, this is also exported from core.js and should\n// be accessed from there.\n\nexports.getBaseURL = function (/*optional*/req) {\n    if (!req) {\n        req = exports.currentRequest();\n    }\n    if ('baseURL' in settings) {\n        return settings.baseURL;\n    }\n    if (exports.isBrowser()) {\n        var re = new RegExp('(.*\\\\/_rewrite).*$');\n        var match = re.exec(exports.getWindowLocation().pathname);\n        if (match) {\n            return match[1];\n        }\n        return '';\n    }\n    if (req.headers['x-couchdb-vhost-path']) {\n        return '';\n    }\n    return '/' + req.path.slice(0, 3).join('/') + '/_rewrite';\n};\n\n/**\n * A named empty function. Use this when you wish to take\n * no action for a callback or string-generating  function.\n */\n\nexports.emptyFunction = function ()\n{\n    return '';\n};\n\n/**\n * A named no-opfunction. Use this when you need to supply\n * a map/transform function, but do not wish to modify anything\n */\n\nexports.identity = function (x)\n{\n    return x;\n};\n\n/**\n * Traverses an object and its sub-objects using an array of property names.\n * Returns the value of the matched path, or undefined if the property does not\n * exist.\n *\n * If a string if used for the path, it is assumed to be a path with a single\n * key (the given string).\n *\n * <pre>\n * getPropertyPath({a: {b: 'foo'}}, ['a','b']) -> 'foo'\n * getPropertyPath({a: {b: 'foo'}}, 'a') -> {b: 'foo'}\n * </pre>\n *\n * @name getPropertyPath(obj, path)\n * @param {Object} obj\n * @param {Array|String} path\n * @api public\n */\n\nexports.getPropertyPath = function (obj, path) {\n    if (!_.isArray(path)) {\n        path = [path];\n    }\n    if (!path.length || !obj) {\n        return obj;\n    }\n    return exports.getPropertyPath(obj[path[0]], path.slice(1));\n};\n\n/**\n * Traverses an object and its sub-objects using an array of property names.\n * Sets the value of the matched property.\n *\n * If a string if used for the path, it is assumed to be a path with a single\n * key (the given string).\n *\n * <pre>\n * setPropertyPath({}, ['a','b'], 'foo') -> {a: {b: 'foo'}}\n * setPropertyPath({}, 'a', 'foo') -> {a: 'foo'}\n * </pre>\n *\n * @name setPropertyPath(obj, path, val)\n * @param {Object} obj\n * @param {Array|String} path\n * @api public\n */\n\nexports.setPropertyPath = function (obj, path, val) {\n    if (!_.isArray(path)) {\n        path = [path];\n    }\n    if (!path.length) {\n        throw new Error('No property path given');\n    }\n    if (path.length === 1) {\n        obj[path[0]] = val;\n        return;\n    }\n    var next = path[0];\n    path = path.slice(1);\n    if (obj[next] === undefined) {\n        obj[next] = {};\n    }\n    else if (typeof obj[next] !== 'object' && path.length) {\n        throw new Error('Property path conflicts with existing value');\n    }\n    exports.setPropertyPath(obj[next], path, val);\n};\n\n/**\n * Call function with arguments, catch any errors and add to an array,\n * returning the modified array.\n *\n * @param {Array} arr\n * @param {Function} fn\n * @param {Array} args\n * @returns {Array}\n * @api private\n */\n\nexports.getErrors = function (fn, args) {\n    var arr = [];\n    try {\n        arr = arr.concat(fn.apply(this, args) || []);\n    }\n    catch (e) {\n        arr.push(e);\n    }\n    return arr;\n};\n\n/**\n * Encodes required characters as HTML entities so a string can be included\n * in a page.\n *\n * @name escapeHTML(s)\n * @param {String} s\n * @returns {String}\n * @api public\n */\n\nexports.escapeHTML = function (s) {\n    s = '' + s; /* Coerce to string */\n    s = s.replace(/&/g, '&amp;');\n    s = s.replace(/</g, '&lt;');\n    s = s.replace(/>/g, '&gt;');\n    s = s.replace(/\"/g, '&quot;');\n    s = s.replace(/'/g, '&#39;');\n    return s;\n};\n\n/**\n * Parse CSV strings into an array of rows, each row an array of values.\n * Used by the array field's default CSV widget.\n *\n * @name parseCSV(csvString)\n * @param {String} csvString\n * @returns {Array}\n * @api public\n */\n\n// Parsing comma-separated values (CSV) in JavaScript by M. A. SRIDHAR\n// http://yawgb.blogspot.com/2009/03/parsing-comma-separated-values-in.html\nexports.parseCSV = function (csvString) {\n    var fieldEndMarker  = /([,\\015\\012] *)/g;\n    var qFieldEndMarker = /(\"\")*\"([,\\015\\012] *)/g;\n    var startIndex = 0;\n    var records = [], currentRecord = [];\n    do {\n        var ch = csvString.charAt(startIndex);\n        var endMarkerRE = (ch === '\"') ? qFieldEndMarker : fieldEndMarker;\n        endMarkerRE.lastIndex = startIndex;\n        var matchArray = endMarkerRE.exec(csvString);\n        if (!matchArray || !matchArray.length) {\n            break;\n        }\n        var endIndex = endMarkerRE.lastIndex;\n        endIndex -= matchArray[matchArray.length - 1].length;\n        var match = csvString.substring(startIndex, endIndex);\n        if (match.charAt(0) === '\"') {\n            match = match.substring(1, match.length - 1).replace(/\"\"/g, '\"');\n        }\n        currentRecord.push(match);\n        var marker = matchArray[0];\n        if (marker.indexOf(',') < 0) {\n            records.push(currentRecord);\n            currentRecord = [];\n        }\n        startIndex = endMarkerRE.lastIndex;\n    } while (true);\n    if (startIndex < csvString.length) {\n        var remaining = csvString.substring(startIndex).trim();\n        if (remaining) {\n            currentRecord.push(remaining);\n        }\n    }\n    if (currentRecord.length > 0) {\n        records.push(currentRecord);\n    }\n    return records;\n};\n\n/**\n * Creates CouchDB response object for returning from a show, list or update\n * function, which redirects to the given app url (automatically prepending the\n * baseURL)\n *\n * @name redirect(req, url)\n * @param {Object} req\n * @param {String} url\n * @returns {Object}\n * @api public\n */\n\nexports.redirect = function (/*optional*/req, url) {\n    if (!url) {\n        /* Arity = 1: url only */\n        url = req;\n        req = exports.currentRequest();\n    }\n    var baseURL = exports.getBaseURL(req);\n    return {code: 302, headers: {'Location': baseURL + url}};\n};\n\n/**\n * Tests if path b is equal to or a sub-path of a.\n *\n * @name isSubPath(a, b)\n * @param {Array} a\n * @param {Array} b\n * @returns {Boolean}\n * @api public\n */\n\nexports.isSubPath = function (a, b) {\n    for (var i = 0, len = a.length; i < len; i++) {\n        if (a[i] !== b[i]) {\n            return false;\n        }\n    }\n    return true;\n};\n\n/**\n * Return a title-case version of the supplied string.\n * @name titleize(str)\n * @param str The string to transform.\n * @returns {String}\n * @api public\n */\n\nexports.titleize = function (str) {\n    return (str || '').toLowerCase().replace(/(?:^|\\s+)\\w/g, function (m) {\n        return m.toUpperCase();\n    });\n};\n\n/**\n * Returns a function that executes {closure} in the context of {context}.\n * Use this function if you'd like to preserve the current context\n * across callbacks, event handlers, and other cases where the value of\n * {this} is set for you.\n *\n * @name bindContext(context, closure)\n * @param {Object} context The context to use when executing closure.\n *          Usually, you will specify the current value of 'this'.\n * @param {Function} closure The function to to bind to {context}.\n * @api public\n */\n\nexports.bindContext = function (context, closure) {\n    return function () {\n        return closure.apply(context, arguments);\n    };\n};\n\n",
        "validators": "/**\n * Validation functions used to validate Field contents.\n *\n * @module\n */\n\nvar _ = require('./underscore')._;\n\n\n/**\n * Tests that the field's value is greater than 'min'.\n *\n * @name min(min)\n * @param {Number} min\n * @returns {Function}\n * @api public\n */\n\nexports.min = function (min) {\n    return function (doc, value) {\n        if (value < min) {\n            throw new Error(\n                'Please enter a value greater than or equal to ' + min\n            );\n        }\n    };\n};\n\n/**\n * Tests that the field's value is less than 'max'\n *\n * @name max(max)\n * @param {Number} max\n * @returns {Function}\n * @api public\n */\n\nexports.max = function (max) {\n    return function (doc, value) {\n        if (value > max) {\n            throw new Error(\n                'Please enter a value less than or equal to ' + max\n            );\n        }\n    };\n};\n\n/**\n * Tests that the field's value is greater than 'min' AND less than 'max'\n *\n * @name range(min, max)\n * @param {Number} min\n * @param {Number} max\n * @returns {Function}\n * @api public\n */\n\nexports.range = function (min, max) {\n    return function (doc, value) {\n        if (value < min || value > max) {\n            throw new Error(\n                'Please enter a value between ' + min + ' and ' + max\n            );\n        }\n    };\n};\n\n/**\n * Tests that the field's value length is greater than 'val'\n *\n * @name minlength(val)\n * @param {Number} val\n * @returns {Function}\n * @api public\n */\n\nexports.minlength = function (val) {\n    return function (doc, value) {\n        if (value.length < val) {\n            throw new Error('Please enter at least ' + val + ' characters');\n        }\n    };\n};\n\n/**\n * Tests that the field's value length is less than 'val'\n *\n * @name maxlength(val)\n * @param {Number} val\n * @returns {Function}\n * @api public\n */\n\nexports.maxlength = function (val) {\n    return function (doc, value) {\n        if (value.length > val) {\n            throw new Error('Please enter no more than ' + val + ' characters');\n        }\n    };\n};\n\n/**\n * Tests that the field's value length is greater than 'min' AND less than 'max'\n *\n * @name rangelength(min, max)\n * @param {Number} min\n * @param {Number} max\n * @returns {Function}\n * @api public\n */\n\nexports.rangelength = function (min, max) {\n    return function (doc, value) {\n        if (value.length < min || value.length > max) {\n            throw new Error(\n                'Please enter a value between ' + min + ' and ' + max +\n                ' characters long'\n            );\n        }\n    };\n};\n\n/**\n * Tests field's value against a regular expression\n *\n * @name regexp(re, message)\n * @param {RegExp} re - can be a string or RegExp object\n * @param {String} message - (optional) a custom error message to throw\n * @returns {Function}\n * @api public\n */\n\nexports.regexp = function (re, message) {\n    re = (typeof re === 'string') ? new RegExp(re): re;\n    return function (doc, value) {\n        if (!re.test(value)) {\n            throw new Error(message || 'Invalid format');\n        }\n    };\n};\n\n/**\n * Tests that field's value is a valid email address using a regular expression.\n *\n * @name email()\n * @returns {Function}\n * @api public\n */\n\nexports.email = function () {\n    // regular expression by Scott Gonzalez:\n    // http://projects.scottsplayground.com/email_address_validation/\n    return exports.regexp(new RegExp(\"^((([a-z]|\\\\d|[!#\\\\$%&'\\\\*\\\\+\\\\-\\\\/=\\\\?\\\\^_`{\\\\|}~]|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])+(\\\\.([a-z]|\\\\d|[!#\\\\$%&'\\\\*\\\\+\\\\-\\\\/=\\\\?\\\\^_`{\\\\|}~]|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])+)*)|((\\\\x22)((((\\\\x20|\\\\x09)*(\\\\x0d\\\\x0a))?(\\\\x20|\\\\x09)+)?(([\\\\x01-\\\\x08\\\\x0b\\\\x0c\\\\x0e-\\\\x1f\\\\x7f]|\\\\x21|[\\\\x23-\\\\x5b]|[\\\\x5d-\\\\x7e]|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])|(\\\\\\\\([\\\\x01-\\\\x09\\\\x0b\\\\x0c\\\\x0d-\\\\x7f]|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF]))))*(((\\\\x20|\\\\x09)*(\\\\x0d\\\\x0a))?(\\\\x20|\\\\x09)+)?(\\\\x22)))@((([a-z]|\\\\d|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])|(([a-z]|\\\\d|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])([a-z]|\\\\d|-|\\\\.|_|~|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])*([a-z]|\\\\d|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])))\\\\.)+(([a-z]|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])|(([a-z]|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])([a-z]|\\\\d|-|\\\\.|_|~|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])*([a-z]|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])))\\\\.?$\", \"i\"), 'Please enter a valid email address');\n};\n\n/**\n * Tests that field's value is a valid URL using a regular expression.\n *\n * @name url()\n * @returns {Function}\n * @api public\n */\n\nexports.url = function () {\n    // regular expression by Scott Gonzalez:\n    // http://projects.scottsplayground.com/iri/\n    return exports.regexp(new RegExp(\"^(https?|ftp):\\\\/\\\\/(((([a-z]|\\\\d|-|\\\\.|_|~|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])|(%[\\\\da-f]{2})|[!\\\\$&'\\\\(\\\\)\\\\*\\\\+,;=]|:)*@)?(((\\\\d|[1-9]\\\\d|1\\\\d\\\\d|2[0-4]\\\\d|25[0-5])\\\\.(\\\\d|[1-9]\\\\d|1\\\\d\\\\d|2[0-4]\\\\d|25[0-5])\\\\.(\\\\d|[1-9]\\\\d|1\\\\d\\\\d|2[0-4]\\\\d|25[0-5])\\\\.(\\\\d|[1-9]\\\\d|1\\\\d\\\\d|2[0-4]\\\\d|25[0-5]))|((([a-z]|\\\\d|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])|(([a-z]|\\\\d|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])([a-z]|\\\\d|-|\\\\.|_|~|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])*([a-z]|\\\\d|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])))\\\\.)+(([a-z]|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])|(([a-z]|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])([a-z]|\\\\d|-|\\\\.|_|~|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])*([a-z]|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])))\\\\.?)(:\\\\d*)?)(\\\\/((([a-z]|\\\\d|-|\\\\.|_|~|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])|(%[\\\\da-f]{2})|[!\\\\$&'\\\\(\\\\)\\\\*\\\\+,;=]|:|@)+(\\\\/(([a-z]|\\\\d|-|\\\\.|_|~|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])|(%[\\\\da-f]{2})|[!\\\\$&'\\\\(\\\\)\\\\*\\\\+,;=]|:|@)*)*)?)?(\\\\?((([a-z]|\\\\d|-|\\\\.|_|~|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])|(%[\\\\da-f]{2})|[!\\\\$&'\\\\(\\\\)\\\\*\\\\+,;=]|:|@)|[\\\\uE000-\\\\uF8FF]|\\\\/|\\\\?)*)?(\\\\#((([a-z]|\\\\d|-|\\\\.|_|~|[\\\\u00A0-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF])|(%[\\\\da-f]{2})|[!\\\\$&'\\\\(\\\\)\\\\*\\\\+,;=]|:|@)|\\\\/|\\\\?)*)?$\", \"i\"), 'Please enter a valid URL');\n};\n\n/**\n * Detects embedded documents with missing _id properties and returns an\n * array of Error objects for each occurence. Returns an empty array if\n * all documents have a populated _id property.\n *\n * Used by the EmbeddedList field type.\n *\n * @name missingIDs()\n * @param {Object} doc\n * @param {Array} value\n * @returns {Array}\n * @api public\n */\n\nexports.missingIDs = function () {\n    return function (doc, value) {\n        var errs = [];\n        _.each(value, function (v, i) {\n            if (!v._id) {\n                var e = new Error('Embedded document missing _id');\n                e.field = [i];\n                errs.push(e);\n            }\n        });\n        return errs;\n    };\n};\n\n",
        "widgets": "/*global $: false, kanso: true*/\n\n/**\n * Widgets define the way a Field object is displayed when rendered as part of a\n * Form. Changing a Field's widget will be reflected in the admin app.\n *\n * @module\n */\n\n/**\n * Module dependencies\n */\n\nvar db = require('./db'),\n    forms = require('./forms'),\n    actions = require('./actions'),\n    render = require('./render'),\n    sanitize = require('./sanitize'),\n    utils = require('./utils'),\n    events = require('./events'),\n    querystring = require('./querystring'),\n    _ = require('./underscore')._;\n\nvar h = sanitize.escapeHtml;\n\n\n/**\n * Widget constructor, creates a new Widget object.\n *\n * @name Widget(type, [options])\n * @param {String} type\n * @param {Object} options\n * @constructor\n * @returns {Widget Object}\n * @api public\n */\n\nvar Widget = exports.Widget = function Widget(type, options) {\n    options = (options || {});\n    this.classes = (options.classes || []);\n    this.id = options.id;\n    this.type = type;\n};\n\n/**\n * Generates an id string for a widget.\n *\n * @param {String} name - field name on the HTML form\n * @param {String} extension - optional; a string to be added\n *                  to the generated identifier. Use this when you\n *                  want to make an identifier that is related to\n *                  an existing identifier, but is still unique.\n * @returns {String}\n */\n\nWidget.prototype._id = function (name /* , ... */) {\n    return sanitize.generateDomIdentifier.apply(\n        this, [ this.id || name ].concat(\n            Array.prototype.slice.call(arguments, 1)\n        )\n    );\n};\n\n/**\n * Generates a name string for a widget.\n *\n * @param {String} name - field name on the HTML form\n * @param {String} extension - optional; a string to be added\n *                  to the generated identifier. Use this when you\n *                  want to make an identifier that is related to\n *                  an existing identifier, but is still unique.\n * @returns {String}\n */\n\nWidget.prototype._name = function (name /* , ... */) {\n    return sanitize.generateDomName.apply(\n        this, [ name ].concat(\n            Array.prototype.slice.call(arguments, 1)\n        )\n    );\n};\n\n/**\n * Converts an input element's value attribute to a valid\n * in-memory representation of the document or document fragment.\n * This function tries to interpret the string as JSON if it's\n * appropriate; otherwise the string is left alone.\n *\n * @name _parse_value(str, type_name)\n * @param {String} str The string value to parse\n * @param {String} type_name The type of field that the input control\n *          belongs to. This value may influence how str is parsed.\n * @returns {Object}\n */\n\nWidget.prototype._parse_value = function (str, type_name)\n{\n    /* TODO:\n        This function needs to actually check type_name. */\n\n    var rv = null;\n\n    try {\n        rv = JSON.parse(str);\n    } catch (e) {\n        rv = str;\n    }\n\n    return rv;\n};\n\n/**\n * Converts an in-memory representation of the document or\n * document fragment in to an encoded string. If the value\n * passed is already encoded, this function does nothing.\n *\n * @name _stringify_value(str, type_name)\n * @param {String} value The value to encode.\n * @param {String} type_name The type of field that the input control\n *          belongs to. This value may influence how value is encoded.\n * @returns {Object}\n */\n\nWidget.prototype._stringify_value = function (value, type_name)\n{\n    /* TODO:\n        This function needs to actually check type_name. */\n\n    var rv = null;\n\n    try {\n        rv = JSON.stringify(value);\n    } catch (e) {\n        rv = value;\n    }\n\n    return rv;\n};\n\n/**\n * Converts a widget to HTML using the provided name and parsed and raw values\n *\n * @name Widget.toHTML(name, value, raw, field, options)\n * @param {String} name\n * @param value\n * @param raw\n * @param field\n * @param options\n * @returns {String}\n * @api public\n */\n\nWidget.prototype.toHTML = function (name, value, raw, field, options) {\n    if (raw === undefined) {\n        raw = (value === undefined) ? '': '' + value;\n    }\n    if (raw === null || raw === undefined) {\n        raw = '';\n    }\n    var html = '<input';\n    html += (this.type ? ' type=\"' + h(this.type) + '\"': '');\n    html += ' value=\"' + h(raw) + '\"';\n    html += ' name=\"' + this._name(name, options.offset) + '\" id=\"';\n    html += this._id(name, options.offset, options.path_extra) + '\"';\n    return html + ' />';\n};\n\n/**\n * Initializes a widget on the client-side only, using the browser's\n * script interpreter. This function is guaranteed to be called\n * after toHTML, and any DOM elements created by toHTML are\n * guaranteed to be accessible\n *\n * @name Widget.clientInit(path, value, raw, field, options)\n * @param {Array} path\n * @param value\n * @param raw\n * @param field\n * @param options\n * @returns {Boolean}\n * @api public\n */\n\nWidget.prototype.clientInit = function (path, value, raw, field, options) {\n    return true;\n};\n\n/**\n * Called by Kanso when it becomes necessary to rename this widget\n * instance. The widget should respond by updating the id and name\n * attributes.\n *\n * @name Widget.updateName(path)\n * @param {String} elt An element that contains one or\n *          more instances of the widget referenced by `this'.\n * @param {String} path The widget's new path; combine this using\n *          the _name or _id function to generate a usable string.\n * @param {Object} options A new set of toHTML/clientInit options.\n *          This may or may not influence the widget's name.\n * @api public\n */\n\nWidget.prototype.updateName = function (elt, path, options) {\n    var e = $('input[type=hidden]', elt);\n    e.attr('id', this._id(path, options.offset, options.path_extra));\n    e.attr('name', this._name(path, options.offset, options.path_extra));\n};\n\n/**\n * Called by Kanso when it becomes necessary to rename this widget\n * instance. The widget should respond by updating the value attribute.\n *\n * @name Widget.updateValue(elt, path, value, options)\n * @param {String} elt An element that contains one or\n *          more instances of the widget referenced by `this'.\n * @param {String} path The path to the widget.\n * @param {Object} value The new value for the widget, unencoded.\n * @param {Object} options An up-to-date set of toHTML/clientInit options.\n * @api public\n */\n\nWidget.prototype.updateValue = function (elt, path, value, options) {\n    elt = $(elt).closestChild('input[type=hidden]');\n    elt.val(this._stringify_value(value));\n};\n\n/**\n * Called by Kanso when it becomes necessary to interrogate this\n * widget to determine its value. The widget should respond by\n * returning an unencoded value (typically as an object).\n *\n * @name Widget.getValue(elt, path, options)\n * @param {String} elt An element that contains one or\n *          more instances of the widget referenced by `this'.\n * @param {String} path The path to the widget.\n * @param {Object} options An up-to-date set of toHTML/clientInit options.\n * @api public\n */\n\nWidget.prototype.getValue = function (elt, path, options) {\n    return this._parse_value(\n        $(elt).closestChild('input[type=hidden]').val()\n    );\n};\n\n/**\n * Called by Kanso when it becomes necessary to validate the\n * contents of this widget -- i.e. to ensure it's in a consistent\n * state before using its value or proceeding. Most widgets will\n * not implement this method; its primary use is complex widgets\n * that host validation-enabled forms and/or types. Returns true\n * if the contents is consistent and valid; false otherwise.\n *\n * @name Widget.validate(elt, path, options)\n * @param {String} elt An element that contains one or\n *          more instances of the widget referenced by `this'.\n * @param {String} path The path to the widget.\n * @param {Object} options An up-to-date set of toHTML/clientInit options.\n * @api public\n */\n\nWidget.prototype.validate = function (elt, path, options) {\n    return true;\n};\n\n/**\n * Creates a new text input widget.\n *\n * @name text([options])\n * @param options\n * @returns {Widget Object}\n * @api public\n */\n\nexports.text = function (options) {\n    return new Widget('text', options);\n};\n\n/**\n * Creates a new password input widget.\n *\n * @name password([options])\n * @param options\n * @returns {Widget Object}\n * @api public\n */\n\nexports.password = function (options) {\n    return new Widget('password', options);\n};\n\n/**\n * Creates a new hidden input widget.\n *\n * @name hidden([options])\n * @param options\n * @returns {Widget Object}\n * @api public\n */\n\nexports.hidden = function (options) {\n    return new Widget('hidden', options);\n};\n\n/**\n * Creates a new textarea widget.\n *\n * @name textarea([options])\n * @param options\n * @returns {Widget Object}\n * @api public\n */\n\nexports.textarea = function (_options) {\n    var w = new Widget('textarea', _options || {});\n    w.options = _options;\n    w.toHTML = function (name, value, raw, field, options) {\n        if (raw === undefined) {\n            raw = (value === undefined) ? '': '' + value;\n        }\n        if (raw === null || raw === undefined) {\n            raw = '';\n        }\n        var html = '<textarea';\n        html += ' name=\"' + this._name(name, options.offset) + '\" id=\"';\n        html += this._id(name, options.offset, options.path_extra) + '\"';\n\n        if (this.options.hasOwnProperty('cols')) {\n            html += ' cols=\"' + h(this.options.cols) + '\"';\n        }\n        if (this.options.hasOwnProperty('rows')) {\n            html += ' rows=\"' + h(this.options.rows) + '\"';\n        }\n        html += '>' + h(raw);\n        html += '</textarea>';\n        return html;\n    };\n    return w;\n};\n\n/**\n * Creates a new checkbox widget.\n *\n * @name checkbox([options])\n * @param options\n * @returns {Widget Object}\n * @api public\n */\n\nexports.checkbox = function (_options) {\n    var w = new Widget('checkbox', _options || {});\n    w.toHTML = function (name, value, raw, field, options) {\n        var html = '<input type=\"checkbox\"';\n        html += ' name=\"' + this._name(name, options.offset) + '\" id=\"';\n        html += this._id(name, options.offset, options.path_extra) + '\"';\n        html += (value ? ' checked=\"checked\"': '');\n        return (html + ' />');\n    };\n    return w;\n};\n\n/**\n * Creates a new select widget.\n *\n * @name select([options])\n * @param options\n * @returns {Widget Object}\n * @api public\n */\n\nexports.select = function (_options) {\n    var w = new Widget('select', _options || {});\n    w.values = _options.values;\n    w.toHTML = function (name, value, raw, field, options) {\n        if (value === null || value === undefined) {\n            value = '';\n        }\n\n        var html = '<select';\n        html += ' name=\"' + this._name(name, options.offset) + '\" id=\"';\n        html += this._id(name, options.offset, options.path_extra) + '\">';\n\n        for (var i = 0; i < this.values.length; i++) {\n            var opt = this.values[i];\n            html += '<option value=\"' + h(opt[0]) + '\"';\n            if (opt[0] === value) {\n                html += ' selected=\"selected\"';\n            }\n            html += '>';\n            html += h(opt[1]);\n            html += '</option>';\n        }\n        html += '</select>';\n        return html;\n    };\n    return w;\n};\n\n/**\n * Creates a new computed widget. Computed widgets display a string, but are\n * uneditable, working as a hidden field behind the scenes.\n *\n * @name computed([options])\n * @param options\n * @returns {Widget Object}\n * @api public\n */\n\nexports.computed = function (_options) {\n    var w = new Widget('computed', _options);\n    w.toHTML = function (name, value, raw, field, options) {\n        if (raw === undefined) {\n            raw = (value === undefined) ? '': '' + value;\n        }\n        if (raw === null || raw === undefined) {\n            raw = '';\n        }\n        var html = '<div id=\"';\n        html += this._id(name, options.offset, options.path_extra) + '\">';\n        html += '<input type=\"hidden\" value=\"' + h(raw) + '\"';\n        html += ' name=\"' + this._name(name, options.offset) + '\" />';\n        html += '<span>' + h(raw) + '</span>';\n        html += '</div>';\n        return html;\n    };\n    return w;\n};\n\n/**\n * Creates a new computed input widget which sets the value of the field to\n * the current user on new documents, responding to sessionChange events\n *\n * @name creator([options])\n * @param options\n * @returns {Widget Object}\n * @api public\n */\n\nexports.creator = function (options) {\n    var w = exports.computed(options);\n    var _toHTML = w.toHTML;\n    var el_name; // store input name provided by renderer\n    var el; // store reference to element so we can detect when its been removed\n\n    w.toHTML = function (name/*, ...*/) {\n        el_name = name;\n        return _toHTML.apply(this, arguments);\n    };\n    w.clientInit = function (field, path, value, raw, errors, options) {\n        if (options.operation === 'add') {\n\n            var id = w._id(el_name, options.offset, options.path_extra);\n\n            // store reference to container element\n            el = $('#' + id)[0];\n\n            var update_val = function (userCtx, req) {\n                var container = $('#' + id)[0];\n                if (el !== container) {\n                    // element has been removed\n                    events.removeListener('sessionChange', update_val);\n                    return;\n                }\n                if (container) {\n                    $('input', container).val(userCtx.name || '');\n                    $('span', container).text(userCtx.name || '');\n                }\n                else {\n                    // element has been removed from page (or was never there?)\n                    events.removeListener('sessionChange', update_val);\n                }\n            };\n            events.on('sessionChange', update_val);\n        }\n    };\n    return w;\n};\n\n\n\n/**\n * Creates a new field for storing/displaying an embedded object.\n * This is automatically added to embed and embedList field types\n * that don't specify a widget.\n *\n * @name embedded([options])\n * @param options\n * @returns {Widget Object}\n * @api public\n */\n\nexports.embedList = function (_options) {\n    var w = new Widget('embedList', _options);\n\n    w.sortable = _options.sortable;\n    w.singleton = _options.singleton;\n    w.widget = (_options.widget || exports.defaultEmbedded());\n    w.actions = actions.parse(_options.actions || {});\n\n    w.toHTML = function (name, value, raw, field, options) {\n\n        this.cacheInit();\n        value = this.normalizeValue(value);\n\n        this.field = field;\n        this.render_options = (options || {});\n\n        var id = this._id(\n            name, 'list', this.render_options.offset,\n                this.render_options.path_extra\n        );\n        var html = (\n            '<div class=\"embedlist\" rel=\"' +\n                h(this.field.type.name) + '\" id=\"' + h(id) + '\">'\n        );\n\n        value = (value instanceof Array ? value : []);\n        html += '<div class=\"items\" rel=\"' + h(name) + '\">';\n\n        for (var i = 0, len = value.length; i < len; ++i) {\n            html += this.htmlForListItem({\n                offset: (this.singleton ? null : i),\n                name: name,\n                value: value[i],\n                raw: raw\n            });\n        }\n        html += (\n                '</div>' +\n                '<div class=\"actions\">' +\n                    this.htmlForAddButton() +\n                '</div>' +\n            '</div>'\n        );\n        return html;\n    };\n\n    w.clientInit = function (field, path, value, raw, errors, options) {\n\n        this.cacheInit();\n        value = this.normalizeValue(value);\n\n        this.path = path;\n        this.field = field;\n        this.render_options = (options || {});\n\n        var item_elts = (\n            this.discoverListItemsElement().children('.item')\n        );\n\n        for (var i = 0, len = item_elts.length; i < len; ++i) {\n            this.bindEventsForListItem(item_elts[i]);\n\n            if (_.isFunction(this.widget.clientInit)) {\n                this.widget.clientInit(\n                    this.field, this.path, value[i], value[i], [], {\n                        offset: (this.singleton ? null : i)\n                    }\n                );\n            }\n        }\n\n        this.renumberList();\n        this.bindEventsForList();\n    };\n\n    /** private: **/\n\n    w.cacheInit = function () {\n        this.discoverListElement = _.memoize(this._discoverListElement);\n        this.discoverListName = _.memoize(this._discoverListName);\n        this.discoverListType = _.memoize(this._discoverListType);\n        this.discoverListItemsElement = _.memoize(this._discoverListItemsElement);\n    };\n\n    w.normalizeValue = function (value) {\n        if (this.singleton) {\n            if (value && !_.isArray(value)) {\n                value = [ value ];\n            }\n        }\n        return value;\n    };\n\n    w._discoverListElement = function () {\n        return $('#' + this._id(\n            this.path, 'list', this.render_options.offset,\n                this.render_options.path_extra\n        ));\n    };\n\n    w._discoverListName = function () {\n        var list_elt = this.discoverListElement();\n        var actions_elt = $(list_elt).closestChild('.actions');\n        return actions_elt.attr('rel');\n    };\n    \n    w._discoverListType = function () {\n        var list_elt = this.discoverListElement();\n        return list_elt.attr('rel');\n    };\n\n    w._discoverListItemsElement = function () {\n        var list_elt = this.discoverListElement();\n        return list_elt.closestChild('.items');\n    };\n\n    w.discoverListItems = function () {\n        return (\n            this.discoverListItemsElement().children('.item')\n        );\n    };\n\n    w.countListItems = function () {\n        return this.discoverListItems().length;\n    };\n\n    w.bindEventsForList = function () {\n        var list_elt = this.discoverListElement();\n        var add_elt = $(list_elt).closestChild('.actions .add');\n\n        add_elt.bind('click', utils.bindContext(this, function (ev) {\n            return this.handleAddButtonClick(ev);\n        }));\n    };\n\n    w.bindEventsForListItem = function (item_elt) {\n        item_elt = $(item_elt);\n        var edit_elt = item_elt.closestChild('.actions .edit');\n        var delete_elt = item_elt.closestChild('.actions .delete');\n\n        edit_elt.bind('click', utils.bindContext(this, function (ev) {\n            return this.handleEditButtonClick(ev);\n        }));\n\n        delete_elt.bind('click', utils.bindContext(this, function (ev) {\n            return this.handleDeleteButtonClick(ev);\n        }));\n\n        if (this.sortable) {\n            var up_elt = item_elt.closestChild('.actions .up');\n            var down_elt = item_elt.closestChild('.actions .down');\n\n            up_elt.bind('click', utils.bindContext(this, function (ev) {\n                return this.handleUpButtonClick(ev);\n            }));\n\n            down_elt.bind('click', utils.bindContext(this, function (ev) {\n                return this.handleDownButtonClick(ev);\n            }));\n        }\n    };\n\n    w.renumberList = function () {\n        var item_elts =\n            this.discoverListItemsElement().children('.item');\n\n        for (var i = 0, len = item_elts.length; i < len; ++i) {\n            var item = $(item_elts[i]);\n            this.renumberListItem(item, i);\n            this.updateListItemActions(item, i, len);\n\n        }\n        return this.updateListActions(len);\n    };\n\n    w.renumberListItem = function (elt, offset) {\n        var widget_options = {\n            offset: (this.singleton ? null : offset)\n        };\n        if (_.isFunction(this.widget.updateName)) {\n            this.widget.updateName(elt, this.path, widget_options);\n        }\n    };\n\n    w.updateListActions = function (offset) {\n        var list_elt = this.discoverListElement();\n        var add_elt = list_elt.closestChild('.actions .add');\n\n        if (this.singleton && offset > 0) {\n            add_elt.hide();\n        } else {\n            add_elt.show();\n        }\n        return offset;\n    };\n\n    w.updateListItemActions = function (item_elt, offset, count) {\n        if (this.sortable) {\n            var attr = 'disabled';\n            var up_elt = item_elt.closestChild('.actions .up');\n            var down_elt = item_elt.closestChild('.actions .down');\n\n            if (offset <= 0) {\n                up_elt.attr(attr, attr);\n            } else {\n                up_elt.removeAttr(attr);\n            }\n            if (offset + 1 >= count) {\n                down_elt.attr(attr, attr);\n            } else {\n                down_elt.removeAttr(attr);\n            }\n        }\n    };\n\n    w.moveExistingItem = function (after_elt, item_elt) {\n        if (after_elt) {\n            $(after_elt).after(item_elt);\n        } else {\n            var items_elt = this.discoverListItemsElement();\n            items_elt.append(item_elt);\n        }\n        this.renumberList();\n        this.bindEventsForListItem(item_elt);\n    };\n\n    w.deleteExistingItem = function (item_elt) {\n        $(item_elt).remove();\n        this.renumberList();\n    };\n\n    w.insertNewItemAtEnd = function (callback) {\n        var list_elt = this.discoverListElement();\n\n        var item_elts =\n            this.discoverListItemsElement().children('.item');\n\n        var last_elt = item_elts.last();\n\n        return this.insertNewItem(\n            (this.singleton ? null : item_elts.length),\n                last_elt[0], callback\n        );\n    };\n\n    w.insertNewItem = function (offset, after_elt, callback) {\n        var list_elt = this.discoverListElement();\n        var list_type = this.discoverListType();\n\n        db.newUUID(100, utils.bindContext(this, function (err, uuid) {\n            var value = { type: list_type, _id: uuid };\n\n            var item_elt = $(this.htmlForListItem({\n                name: this._name(this.path),\n                offset: offset,\n                value: value,\n                raw: value\n            }));\n\n            this.moveExistingItem(after_elt, item_elt);\n\n            if (_.isFunction(this.widget.clientInit)) {\n                this.widget.clientInit(\n                    this.field, this.path, value, null, [], {\n                        offset: (this.singleton ? null : offset)\n                    }\n                );\n            }\n\n            if (callback) {\n                callback(item_elt[0]);\n            }\n        }));\n    };\n\n    w.setListItemValue = function (elt, value, offset) {\n        if (this.widget.updateValue) {\n            this.widget.updateValue(\n                elt, this.path, value, { offset: offset }\n            );\n        }\n    };\n\n    w.htmlForListItem = function (item) {\n        var html = (\n            '<div class=\"item\">' +\n                '<div class=\"actions\">' +\n                    (this.sortable ?\n                        this.htmlForDownButton() : '') +\n                    (this.sortable ?\n                        this.htmlForUpButton() : '') +\n                    this.htmlForEditButton() +\n                    this.htmlForDeleteButton() +\n                '</div>' +\n                this.widget.toHTML(\n                    item.name, item.value, item.raw, this.field,\n                        { offset: item.offset }\n                ) +\n            '</div>'\n        );\n        return html;\n    };\n\n    w.htmlForAddButton = function () {\n        return (\n            '<input type=\"button\" class=\"add action\" value=\"Add\" />'\n        );\n    };\n\n    w.htmlForEditButton = function () {\n        return (\n            '<input type=\"button\" class=\"edit action\" value=\"Edit\" />'\n        );\n    };\n\n    w.htmlForDeleteButton = function () {\n        return (\n            '<input type=\"button\" class=\"delete action\" value=\"Delete\" />'\n        );\n    };\n\n    w.htmlForUpButton = function () {\n        return (\n            '<input type=\"button\" class=\"up action\" value=\"&uarr;\" />'\n        );\n    };\n\n    w.htmlForDownButton = function () {\n        return (\n            '<input type=\"button\" class=\"down action\" value=\"&darr;\" />'\n        );\n    };\n\n    w.dispatchEventToAction = function (target_elt,\n                                        action_name, callback) {\n        var name = this._name(this.path);\n        var type_name = this.discoverListType();\n        var item_elt = $(target_elt).closest('.item');\n        var offset = item_elt.prevAll('.item').length;\n        var value = this.widget.getValue(\n            item_elt, this.path, this.render_options\n        );\n\n        var widget_options = {\n            offset: offset,\n            path_extra: (this.render_options.path_extra || [])\n        };\n\n        /* Action handler will transfer control here when finished */\n        var cb = utils.bindContext(this, function (successful, new_value) {\n            if (callback) {\n                callback.call(\n                    this, target_elt, offset, successful, new_value\n                );\n            }\n        });\n\n        var action_handler = (\n            this.actions[action_name] ||\n                this.defaultActionFor(action_name)\n        );\n\n        if (action_handler) {\n            action_handler(\n                action_name, type_name, this.field, this.path,\n                    value, null, [], widget_options, cb\n            );\n        }\n    };\n\n    w.handleUpButtonClick = function (ev) {\n        var item_elt = $(ev.target).closest('.item');\n        item_elt.insertBefore(item_elt.prev('.item'));\n        this.renumberList();\n    };\n\n    w.handleDownButtonClick = function (ev) {\n        var item_elt = $(ev.target).closest('.item');\n        item_elt.insertAfter(item_elt.next('.item'));\n        this.renumberList();\n    };\n\n    w.handleAddButtonClick = function (ev) {\n        var callback = utils.bindContext(\n            this, this.handleAddCompletion\n        );\n        this.insertNewItemAtEnd(\n            utils.bindContext(this, function (item_elt) {\n                this.dispatchEventToAction(item_elt, 'add', callback);\n            })\n        );\n    };\n\n    w.handleEditButtonClick = function (ev) {\n        var callback = utils.bindContext(\n            this, this.handleEditCompletion\n        );\n        this.dispatchEventToAction(ev.target, 'edit', callback);\n    };\n\n    w.handleDeleteButtonClick = function (ev) {\n        var callback = utils.bindContext(\n            this, this.handleDeleteCompletion\n        );\n        var item_elt = $(ev.target).closest('.item', this);\n        this.deleteExistingItem(item_elt);\n        this.dispatchEventToAction(ev, 'delete');\n    };\n\n    w.handleAddCompletion = function (target_elt, offset,\n                                      is_successful, new_value) {\n        var item_elt = $(target_elt).closest('.item', this);\n\n        if (is_successful) {\n            this.setListItemValue(\n                item_elt, new_value, offset\n            );\n        } else {\n            this.deleteExistingItem(item_elt);\n        }\n    };\n\n    w.handleEditCompletion = function (target_elt, offset,\n                                       is_successful, new_value) {\n        if (is_successful) {\n            var item_elt = $(target_elt).closest('.item', this);\n            this.setListItemValue(\n                item_elt, new_value, offset\n            );\n        }\n    };\n\n    w.handleDeleteCompletion = function (target_elt, offset,\n                                         is_successful, new_value) {\n        return;\n    };\n\n    w.defaultActionFor = function (action_name) {\n        switch (action_name) {\n        case 'add':\n        case 'edit':\n            return utils.bindContext(this, function () {\n                var action_options = {\n                    widget: exports.embedForm({\n                        type: this.field.type\n                    })\n                };\n                var args = Array.prototype.slice.apply(arguments);\n                actions.modalDialog.apply(\n                    this, [ action_options ].concat(args)\n                );\n            });\n            /* break */\n        case 'delete':\n            break;\n        }\n        return null;\n    };\n\n    return w;\n};\n\n/**\n * Creates a new field for storing/displaying an embedded object.\n * This is automatically added to embed and embedList field types\n * that don't specify a widget.\n *\n * @name defaultEmbedded([options])\n * @param options\n * @returns {Widget Object}\n * @api public\n */\n\nexports.defaultEmbedded = function (_options) {\n    var w = new Widget('defaultEmbedded', _options);\n    w.toHTML = function (name, value, raw, field, options) {\n        var display_name = (value ? value._id: '');\n        var fval = (value ? this._stringify_value(value) : '');\n\n        if (field && field.type.display_name && value) {\n            display_name = field.type.display_name(value);\n        }\n        var html = (\n            '<div class=\"embedded embed\">' +\n                '<input type=\"hidden\" value=\"' + h(fval) + '\" name=\"' +\n                    h(this._name(name, options.offset)) + '\" />' +\n                '<span class=\"value\">' + h(display_name) + '</span>' +\n            '</div>'\n        );\n        return html;\n    };\n    return w;\n};\n\n/**\n * Creates a new instance of an embedded *form* for the specified type.\n * This is the basis for the presentation of complex data types in Kanso,\n * and is used within an embedList to add and/or edit items.\n *\n * @name embedForm([options])\n * @param options\n * @returns {Widget Object}\n * @api public\n */\n\nexports.embedForm = function (_options) {\n    var w = new Widget('embedForm', _options);\n\n    w.embedded_type = _options.type;\n    w.form = new forms.Form(w.embedded_type);\n\n    w.toHTML = function (name, value, raw, field, options) {\n\n        this.field = field;\n        this.form.values = value;\n        this.render_options = (options || {});\n\n        var id = this._id(\n            name, 'form', this.render_options.offset,\n                this.render_options.path_extra\n        );\n        var html = (\n            '<div id=\"' + id + '\" class=\"embedded form\">' +\n                '<form>' +\n                    this.form.toHTML(\n                        null, render.defaultRenderer(),\n                            this.render_options, true /* create defaults */\n                    ) +\n                '</form>' +\n            '</div>'\n        );\n        return html;\n    };\n\n    w.getValue = function (elt, path, options) {\n        var container_elt = this._discoverContainerElement(path);\n        var form_elt = container_elt.closestChild('form');\n        var rv = querystring.parse(\n            form_elt.serialize().replace(/\\+/g, '%20')\n        );\n        return rv;\n    };\n\n    w.validate = function (elt, path, options) {\n        this.form.validate({\n            form: this.getValue(elt, path, options),\n            userCtx: (utils.userCtx || utils.currentRequest().userCtx)\n        });\n        return this.form.errors;\n    };\n\n    /** private: **/\n\n    w._discoverContainerElement = function (path) {\n        var id = this._id(\n            path, 'form', this.render_options.offset,\n                this.render_options.path_extra\n        );\n        return $('#' + id);\n    };\n\n    return w;\n};\n\n/**\n * Creates a new document selector widget. This widget allows the\n * user to select a document from a CouchDB view (specified in options).\n * The options available for this widget are explained briefly below:\n *\n * <table class=\"options\">\n *   <tr>\n *      <td class=\"name\">viewName</td>\n *      <td class=\"type\">String</td>\n *      <td class=\"description\">\n *          The name of the CouchDB view that you'd like to select\n *          documents from. If this option is not specified, it will\n *          look for a view with the same name as this widget's field.\n *      </td>\n *   </tr>\n *   <tr>\n *      <td class=\"name\">db</td>\n *      <td class=\"type\">String</td>\n *      <td class=\"description\">\n *          The CouchDB database containing the view for this widget. If\n *          this option is not specified, the current database will be used.\n *      </td>\n *   </tr>\n *   <tr>\n *      <td class=\"name\">useJSON</td>\n *      <td class=\"type\">String</td>\n *      <td class=\"description\">\n *          Set this option to false if this widget should yield a string\n *          containing a single document id. Set this option to true (the\n *          default) to yield a JSON string.\n *      </td>\n *   </tr>\n *   <tr>\n *      <td class=\"name\">storeEntireDocument</td>\n *      <td class=\"type\">String</td>\n *      <td class=\"description\">\n *          Set this option to false if this widget should yield *only*\n *          a document identifier, effectively storing a reference to a\n *          document. Set this option to true (the default) to include\n *          all fields from the selected document. If useJSON is false,\n *          then this option is ignored and treated as if it were false.\n *      </td>\n *   </tr>\n * </table>\n *\n * @constructor\n * @param options\n */\n\nexports.documentSelector = function (_options) {\n    var w = new Widget('documentSelector', _options);\n\n    w.options = _.defaults(_options || {}, {\n        useJSON: true,\n        storeEntireDocument: true\n    });\n\n    w.toHTML = function (name, value, raw, field, options) {\n        this.cacheInit();\n        var html_name = this._name(\n            name, options.offset\n        );\n        var container_id = this._id(\n            name, 'selector', options.offset, options.path_extra\n        );\n        var hidden_id = this._id(\n            name, options.offset, options.path_extra\n        );\n        var select_id = this._id(\n            name, 'select', options.offset, options.path_extra\n        );\n        var input_html = (\n            '<input class=\"backing\" type=\"hidden\" value=\"\"' +\n                'id=\"' + hidden_id + '\" name=\"' + html_name + '\" />'\n        );\n        var select_html = (\n            '<select class=\"selector\" id=\"' + select_id + '\"></select>'\n        );\n        var html = (\n            '<div id=\"' + container_id + '\" class=\"selector widget\">' +\n                input_html + select_html +\n                '<div class=\"spinner\" style=\"display: none;\"></div>' +\n            '</div>'\n        );\n\n        return html;\n    };\n\n    w.updateName = function (elt, path, options) {\n        this.cacheInit();\n        var hidden_elt = this.discoverBackingElement(elt);\n        var select_elt = this.discoverSelectionElement(elt);\n\n        select_elt.attr('id', this._id(\n            path, 'select', options.offset, options.path_extra\n        ));\n        hidden_elt.attr('id', this._id(\n            path, options.offset, options.path_extra\n        ));\n        hidden_elt.attr('name', this._name(\n            path, options.offset\n        ));\n    };\n\n    w.updateValue = function (elt, path, value, options) {\n        elt = $(elt);\n        value = this._stringify_value(value);\n\n        var hidden_elt = this.discoverBackingElement(elt);\n        var select_elt = this.discoverSelectionElement(elt);\n\n        hidden_elt.val(value);\n        select_elt.val(value);\n    };\n\n    w.getValue = function (elt, path, options) {\n        var hidden_elt = this.discoverBackingElement(elt);\n        return this._parse_value(hidden_elt.attr('value'));\n    };\n\n    w.clientInit = function (field, path, value, raw, errors, options) {\n        var id = this._id(\n            path, 'selector', options.offset, options.path_extra\n        );\n        var container_elt = $('#' + id);\n        var widget_options = (this.options || {});\n        var spinner_elt = container_elt.closestChild('.spinner');\n        var select_elt = this.discoverSelectionElement(container_elt);\n        var hidden_elt = this.discoverBackingElement(container_elt);\n\n        /* Start progress */\n        spinner_elt.show();\n\n        /* Copy data to backing element */\n        select_elt.bind('change', function () {\n            hidden_elt.val(select_elt.val());\n        });\n\n        this.populateSelectElement(\n            select_elt, field, path, value, widget_options, function () {\n                spinner_elt.hide();\n            }\n        );\n    };\n\n    /** private: **/\n\n    w.populateSelectElement = function (elt, field, path,\n                                        val, options, callback) {\n\n        db.getView(\n            options.viewName,\n            { include_docs: options.storeEntireDocument },\n            { db: options.db },\n            utils.bindContext(this, function (err, rv) {\n                /* Error handling */\n                if (err) {\n                    throw new Error(\n                        'Failed to request content from view `' +\n                            options.viewName + '`'\n                    );\n                }\n                /* Option element for 'no selection' */\n                var nil_option = $('<option />');\n                if (!val) {\n                    nil_option.attr('selected', 'selected');\n                }\n                elt.append(nil_option);\n\n                /* All other option elements */\n                _.each(rv.rows || [], utils.bindContext(this, function (r) {\n                    var option_elt = $('<option />');\n\n                    if (this.isOptionSelected(r, val, options)) {\n                        option_elt.attr('selected', 'selected');\n                    }\n                    this.generateOptionValue(\n                        field, r, val, options,\n                        utils.bindContext(this, function (err, v) {\n                            if (err) {\n                                throw new Error(\n                                    'Failed to generate identifier for' +\n                                        ' field `' + this._name(path) + '`'\n                                );\n                            }\n                            option_elt.val(v);\n                            option_elt.text(r.value);\n                            elt.append(option_elt);\n                            elt.trigger('change');\n                        })\n                    );\n\n                }));\n                callback();\n            })\n        );\n    };\n\n    w.isOptionSelected = function (row, value, options) {\n        if (options.useJSON) {\n            if (options.storeEntireDocument || options.unique) {\n                return ((value || {})._id === row.id);\n            } else {\n                return ((value || {}).ref === row.id);\n            }\n        } else {\n            return (value === row.id);\n        }\n    };\n\n    w.generateOptionValue = function (field, row, value, options, callback) {\n        if (options.useJSON) {\n            if (options.storeEntireDocument) {\n\n                /* Embed actual document:\n                    Duplicates are automatically disallowed. */\n\n                callback(false, JSON.stringify(row.doc));\n\n            } else if (options.unique) {\n\n                /* Reference, duplicates disallowed:\n                    Store id inside of _id attribute. */\n\n                callback(false, JSON.stringify({\n                    _id: row.id,\n                    type: field.type.name\n                }));\n\n            } else {\n\n                /* Reference, duplicates allowed:\n                    Store id inside of the ref attribute, and generate\n                    a new UUID for the _id attribute if it's necessary. */\n\n                var return_value = function (uuid) {\n                    callback(false, JSON.stringify({\n                        _id: uuid,\n                        ref: row.id,\n                        type: field.type.name\n                    }));\n                };\n\n                var forward_error = function (err) {\n                    callback(err, null);\n                };\n\n                if (value && value._id) {\n                    return_value(value._id);\n                } else {\n                    db.newUUID(100, function (err, uuid) {\n                        if (err) {\n                            forward_error(err);\n                        } else {\n                            return_value(uuid);\n                        }\n                    });\n                }\n            }\n        } else {\n\n            /* Not using JSON:\n                The type is a scalar; just use the _id. */\n\n            callback(false, row.id);\n        }\n\n        return this;\n    };\n\n    w.cacheInit = function () {\n        this.discoverBackingElement = this._discoverBackingElement;\n        this.discoverSelectionElement = this._discoverSelectionElement;\n    };\n\n    w._discoverBackingElement = function (container_elt) {\n        return $(container_elt).closestChild('input[type=hidden].backing');\n    };\n\n    w._discoverSelectionElement = function (container_elt) {\n        return $(container_elt).closestChild('select.selector');\n    };\n\n    return w;\n};\n\n/* \n * closestChild for jQuery\n * Copyright 2011, Tobias Lindig\n * \n * Dual licensed under the MIT license and GPL licenses:\n *   http://www.opensource.org/licenses/mit-license.php\n *   http://www.opensource.org/licenses/gpl-license.php\n * \n */\n\nif (utils.isBrowser()) {\n    (function ($) {\n        $.fn.closestChild = function (selector) {\n            /* Breadth-first search for the first matched node */\n            if (selector && selector !== '') {\n                var queue = [];\n                queue.push(this);\n                while (queue.length > 0) {\n                    var node = queue.shift();\n                    var children = node.children();\n                    for (var i = 0; i < children.length; ++i) {\n                        var child = $(children[i]);\n                        if (child.is(selector)) {\n                            return child;\n                        }\n                        queue.push(child);\n                    }\n                }\n            }\n            return $(); /* Nothing found */\n        };\n    }($));\n}\n\n",
        "settings": "module.exports = {\"name\":\"nrama\",\"load\":\"lib/app\",\"modules\":\"lib\",\"templates\":\"templates\",\"attachments\":[\"static\",\"xdm\",\"bkmrklt\"],\"base_template\":\"base.html\"};"
    },
    "types": {},
    "shows": {
        "welcome": "function(doc, req){var core = require(\"kanso/core\");var fn = require(\"lib/app\")[\"shows\"][\"welcome\"];return core.runShow(fn, doc, req);}",
        "not_found": "function(doc, req){var core = require(\"kanso/core\");var fn = require(\"lib/app\")[\"shows\"][\"not_found\"];return core.runShow(fn, doc, req);}"
    },
    "lists": {
        "all_users": "function(head, req){var core = require(\"kanso/core\");var fn = require(\"lib/app\")[\"lists\"][\"all_users\"];return core.runList(fn, head, req);}",
        "sources": "function(head, req){var core = require(\"kanso/core\");var fn = require(\"lib/app\")[\"lists\"][\"sources\"];return core.runList(fn, head, req);}",
        "authors": "function(head, req){var core = require(\"kanso/core\");var fn = require(\"lib/app\")[\"lists\"][\"authors\"];return core.runList(fn, head, req);}",
        "tags": "function(head, req){var core = require(\"kanso/core\");var fn = require(\"lib/app\")[\"lists\"][\"tags\"];return core.runList(fn, head, req);}",
        "flow": "function(head, req){var core = require(\"kanso/core\");var fn = require(\"lib/app\")[\"lists\"][\"flow\"];return core.runList(fn, head, req);}",
        "quotes": "function(head, req){var core = require(\"kanso/core\");var fn = require(\"lib/app\")[\"lists\"][\"quotes\"];return core.runList(fn, head, req);}"
    },
    "views": {
        "pageId_type_userId": {
            "map": "function (doc) {\n        if( doc.page_id && doc.type ) {\n            if( doc.user_id ) {\n                emit([doc.page_id, doc.type, doc.user_id],doc);\n            } else {\n            //no user_id\n            emit([doc.page_id, doc.type, null],doc);\n            }\n        }\n    }"
        },
        "all_user_ids": {
            "map": "function (doc) {\n        if( doc.type == 'source' && doc.updated) {\n            emit(doc.user_id, doc.updated);\n        }\n    }",
            "reduce": "_stats"
        },
        "source": {
            "map": "function (doc) {\n        if( doc.type && doc.type == \"source\" ) {\n            if( doc.updated && doc.page_id ) {\n                emit([doc.updated, doc.page_id], null);\n            }\n        }\n    }"
        },
        "userId_source": {
            "map": "function (doc) {\n        if( doc.type && doc.type == \"source\" ) {\n            if( doc.user_id && doc.page_id && doc.updated ) {\n                emit([doc.user_id, doc.updated], null);\n            }\n        }\n    }"
        },
        "pageId_userId": {
            "map": "function (doc) {\n    if( doc.user_id && doc.page_id ) {\n      emit([doc.page_id, doc.user_id], null);\n    }\n  }"
        },
        "userId_author": {
            "map": "function (doc) {\n    if( doc.type && doc.type == 'source' ) {\n      if( doc.AUTHOR && doc.user_id ) {\n        var year = doc.YEAR || 0;    //order is [null, 1965, 1990, 2000],  (typically reversed)\n        for( idx in doc.AUTHOR ) {\n          emit( [ doc.user_id, doc.AUTHOR[idx], 5000-year ], 1 );\n        }\n      }\n    }\n  }",
            "reduce": "_count"
        },
        "author_userId": {
            "map": "function (doc) {\n    if( doc.type && doc.type == 'source' ) {\n      if( doc.AUTHOR && doc.user_id ) {\n        var year_order = 5000 - parseInt(doc.YEAR) || 5000;    //order is [null, 1965, 1990, 2000],  (typically reversed)\n        for( idx in doc.AUTHOR ) {\n          emit( [doc.AUTHOR[idx], doc.user_id, year_order], 1 );\n        }\n      }\n    }\n  }",
            "reduce": "_count"
        },
        "tags_all": {
            "map": "function (doc) {\n    if( doc.type && doc.type == 'note' ) {\n      if( doc.tags ) {\n        for( idx in doc.tags ) {\n          var tag = doc.tags[idx];\n          emit([tag], 1);\n        }\n      }\n    }\n  }",
            "reduce": "_count"
        },
        "tags_user": {
            "map": "function (doc) {\n    if( doc.type && doc.type == 'note' ) {\n      if( doc.tags && doc.user_id ) {\n        for( idx in doc.tags ) {\n          var tag = doc.tags[idx];\n          emit([doc.user_id, tag], 1);\n        }\n      }\n    }\n  }",
            "reduce": "_count"
        },
        "tags": {
            "map": "function (doc) {\n    if( doc.type && doc.type == 'note' ) {\n      var note = doc;\n      if( note.tags ) {\n        if( note.user_id && note.source_id && note.quote_id && note.updated) {\n          for( var idx in note.tags ) {\n            var tag = note.tags[idx];\n            emit([ tag, note.user_id, note.updated ], null);                  //include the note iteself\n            emit([ tag, note.user_id, note.updated ], {_id:note.source_id});  //include the source\n            emit([ tag, note.user_id, note.updated ], {_id:note.quote_id});   //include the quote\n          }\n        }\n      }\n    }\n  }",
            "reduce": "_count"
        },
        "quotes": {
            "map": "function (doc) {\n    if( doc.type && doc.user_id && doc.source_id && doc.updated ) {\n      if( doc.type == 'note' && doc.quote_id ) {\n        var note = doc;\n        emit([ note.user_id, note.updated ], null);                  //include the note iteself\n        emit([ note.user_id, note.updated ], {_id:note.source_id});  //include the source\n        //emit([ note.user_id, note.updated ], {_id:note.quote_id});   //include the quote\n      }\n      if( doc.type == 'quote' ) {\n        var quote = doc;\n        emit([ quote.user_id, quote.created ], null);\n        emit([ quote.user_id, quote.created ], {_id:quote.source_id})\n      }\n    }\n  }"
        }
    },
    "updates": {
        "source": "function(doc, req){var core = require(\"kanso/core\");var fn = require(\"lib/app\")[\"updates\"][\"source\"];var r;core.runUpdate(fn, doc, req, function (err, res) { r = res; });return r;}"
    },
    "filters": {},
    "rewrites": [
        {
            "from": "/kanso.js",
            "to": "kanso.js"
        },
        {
            "from": "/_db/*",
            "to": "../../*"
        },
        {
            "from": "/_db",
            "to": "../.."
        },
        {
            "from": "/static/*",
            "to": "static/*"
        },
        {
            "from": "/xdm/*",
            "to": "xdm/*"
        },
        {
            "from": "/sources",
            "to": "_list/sources/source",
            "query": {
                "include_docs": "true",
                "descending": "true"
            }
        },
        {
            "from": "/users",
            "to": "_list/all_users/all_user_ids",
            "method": "GET",
            "query": {
                "group": "true"
            }
        },
        {
            "from": "/users/:user",
            "to": "_list/flow/quotes",
            "query": {
                "end_key": [
                    ":user"
                ],
                "start_key": [
                    ":user",
                    {}
                ],
                "include_docs": "true",
                "descending": "true"
            }
        },
        {
            "from": "/users/:user/sources",
            "to": "_list/sources/userId_source",
            "query": {
                "end_key": [
                    ":user"
                ],
                "start_key": [
                    ":user",
                    {}
                ],
                "include_docs": "true",
                "descending": "true"
            }
        },
        {
            "from": "/authors",
            "to": "_list/authors/author_userId",
            "query": {
                "include_docs": "true",
                "descending": "false",
                "reduce": "false",
                "author_index_in_key": "0"
            }
        },
        {
            "from": "/authors/:author",
            "to": "_list/authors/author_userId",
            "query": {
                "start_key": [
                    ":author"
                ],
                "end_key": [
                    ":author",
                    {}
                ],
                "include_docs": "true",
                "descending": "false",
                "reduce": "false",
                "author_index_in_key": "0"
            }
        },
        {
            "from": "/users/:user/authors",
            "to": "_list/authors/userId_author",
            "query": {
                "start_key": [
                    ":user"
                ],
                "end_key": [
                    ":user",
                    {}
                ],
                "reduce": "false",
                "include_docs": "true",
                "author_index_in_key": "1"
            }
        },
        {
            "from": "/users/:user/authors/:author",
            "to": "_list/authors/author_userId",
            "query": {
                "start_key": [
                    ":author",
                    ":user"
                ],
                "end_key": [
                    ":author",
                    ":user",
                    {}
                ],
                "include_docs": "true",
                "descending": "false",
                "reduce": "false",
                "author_index_in_key": "0"
            }
        },
        {
            "from": "/sources/:source",
            "to": "_list/quotes/pageId_userId",
            "query": {
                "startkey": [
                    ":source"
                ],
                "endkey": [
                    ":source",
                    {}
                ],
                "include_docs": "true"
            }
        },
        {
            "from": "/users/:user/sources/:source",
            "to": "_list/quotes/pageId_userId",
            "query": {
                "key": [
                    ":source",
                    ":user"
                ],
                "include_docs": "true"
            }
        },
        {
            "from": "/tags",
            "to": "_list/tags/tags_all",
            "query": {
                "group": "true",
                "tag_index_in_key": "0"
            }
        },
        {
            "from": "/tags/:tag",
            "to": "_list/quotes/tags",
            "query": {
                "endkey": [
                    ":tag"
                ],
                "startkey": [
                    ":tag",
                    {}
                ],
                "reduce": "false",
                "descending": "true",
                "include_docs": "true"
            }
        },
        {
            "from": "/tags/:tag/recent",
            "to": "_list/flow/tags",
            "query": {
                "endkey": [
                    ":tag"
                ],
                "startkey": [
                    ":tag",
                    {}
                ],
                "reduce": "false",
                "descending": "true",
                "include_docs": "true"
            }
        },
        {
            "from": "/users/:user/tags",
            "to": "_list/tags/tags_user",
            "query": {
                "startkey": [
                    ":user"
                ],
                "endkey": [
                    ":user",
                    {}
                ],
                "group_level": "2",
                "tag_index_in_key": "1"
            }
        },
        {
            "from": "/users/:user/tags/:tag",
            "to": "_list/quotes/tags",
            "query": {
                "endkey": [
                    ":tag",
                    ":user"
                ],
                "startkey": [
                    ":tag",
                    ":user",
                    {}
                ],
                "reduce": "false",
                "descending": "true",
                "include_docs": "true"
            }
        },
        {
            "from": "/users/:user/tags/:tag/recent",
            "to": "_list/flow/tags",
            "query": {
                "endkey": [
                    ":tag",
                    ":user"
                ],
                "startkey": [
                    ":tag",
                    ":user",
                    {}
                ],
                "reduce": "false",
                "descending": "true",
                "include_docs": "true"
            }
        },
        {
            "from": "/update/source/:id",
            "to": "_update/source/:id"
        },
        {
            "from": "/",
            "to": "_show/welcome"
        },
        {
            "from": "*",
            "to": "_show/not_found"
        }
    ],
    "validate_doc_update": "function(){return require(\"lib/app\")[\"validate_doc_update\"].apply(this, arguments);}",
    "events": {},
    "format": "kanso"
}
