{>"user_header.html"/}
{<what}notes{/what}
<div class="navigation" >
    {?is_users_own_page}
        -- see <a href="{baseURL}{query_source_url}">everyone's notes on this</a>;
    {:else}
        {?userCtx.name}
            {?query_user}
                -- see &amp; edit <a href="{baseURL}/users/{userCtx.name|uc}{query_source_url}{}"> {?query_user}only {/query_user}your notes on this source</a>;
            {:else}
                {?quotes}
                    -- see &amp; edit <a href="{baseURL}/users/{userCtx.name|uc}{query_source_url}"> {?query_user}only {/query_user}your notes on this source</a>;
                {:else}
                {/quotes}
            {/query_user}
        {:else}
            {?query_user}
                -- see <a href="{baseURL}{query_source_url}">everyone's notes on this</a>
            {/query_user}
        {/userCtx.name}
    {/is_users_own_page}
    {?userCtx.name}
        go to <a href="{baseURL}/users/{userCtx.name|uc}">your sources</a>
    {/userCtx.name}
</div>


<div class="source">

    {#source}
        <h1 class="title-line">
            {TITLE}{page_title}{^TITLE}{^page_title}untitled{/page_title}{/TITLE}
            {?YEAR}(<span class="year">{YEAR}</span>){/YEAR}
        </h1>
        <div class="citation">{>"bibliographic_details.html"/}</div>
    {/source}
    
    <div class='quotes'>
        {?quotes}
            {#quotes}
                <div class="quote" id="{_id}" >
                    <div class="quote-line">
                        "<span class="quote-content">{content}</span>"
                        {! TODO add-a-note should be possible provided logged in !}
                        {?is_users_own_page}
                            <a class="add-a-note">[+]</a>
                        {:else}
                            {^query_user}
                                [cited by <span class='quote-user_id'><a href="{baseURL}/users/{user_id|uc}">{user_id}</a></span>]
                            {/query_user}
                            {! TODO re-quote should be possible provided logged in 
                                [&amp;re-quote]
                            !}
                        {/is_users_own_page}
                    </div>
                    {! [{page_order}] !}
                    <ul class="notes _sort-me {^is_users_own_page}_not_user_page{/is_users_own_page}">
                        {#notes}
                            <li class="note">
                                {?is_users_own_page}
                                    <textarea id="{_id}" class="note-content" rows="1">{content}</textarea>
                                {:else}
                                    {^query_user}
                                        <span class='quote-user_id'><a href="{baseURL}/users/{user_id|uc}">{user_id}</a></span>]
                                    {/query_user}
                                    <span class="note-content">{content}</span>
                                {/is_users_own_page}
                            </li>
                        {/notes}
                    </ul>
                </div>
            {/quotes}
        {:else}
            {?is_users_own_page}
                <p>You have no notes on this source.</p>
            {:else}
                {?query_user}
                    <p>{query_user} has notes on this source.</p>
                {:else}
                    <p>There are no notes on this source.</p>
                {/query_user}
            {/is_users_own_page}
        {/quotes}
    </div>
</div>

<script>
    if( typeof($)!='undefined' ) {
        $('._sort-me').sortlist();
        $('textarea.note-content').autogrow();
    }
</script>
